---
title: suggerimenti aaaPerformance - Azure Cosmos database NoSQL | Documenti Microsoft
description: Informazioni su prestazioni del database Azure Cosmos DB tooimprove opzioni configurazione client
keywords: come tooimprove delle prestazioni del database
services: cosmos-db
author: mimig1
manager: jhubbard
editor: 
documentationcenter: 
ms.assetid: 94ff155e-f9bc-488f-8c7a-5e7037091bb9
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/23/2017
ms.author: mimig
ms.openlocfilehash: 4f3e82ae5048e3dbc20b0fd891a2d3aa22adf3fc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="performance-tips-for-azure-cosmos-db"></a><span data-ttu-id="eaa08-104">Suggerimenti sulle prestazioni per Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="eaa08-104">Performance tips for Azure Cosmos DB</span></span>
<span data-ttu-id="eaa08-105">Azure Cosmos DB è un database distribuito veloce e flessibile, facilmente scalabile e con latenza e velocità effettiva garantite.</span><span class="sxs-lookup"><span data-stu-id="eaa08-105">Azure Cosmos DB is a fast and flexible distributed database that scales seamlessly with guaranteed latency and throughput.</span></span> <span data-ttu-id="eaa08-106">Non sono state apportate modifiche di architettura principali toomake o scrivere codice complesso tooscale il database con DB Cosmos.</span><span class="sxs-lookup"><span data-stu-id="eaa08-106">You do not have toomake major architecture changes or write complex code tooscale your database with Cosmos DB.</span></span> <span data-ttu-id="eaa08-107">Aumentare o ridurre le prestazioni è semplice come eseguire una singola chiamata API o una [chiamata al metodo SDK](set-throughput.md#set-throughput-sdk).</span><span class="sxs-lookup"><span data-stu-id="eaa08-107">Scaling up and down is as easy as making a single API call or [SDK method call](set-throughput.md#set-throughput-sdk).</span></span> <span data-ttu-id="eaa08-108">Tuttavia, poiché Cosmos DB è possibile accedere tramite sono chiamate di rete sono ottimizzazioni sul lato client è possibile apportare tooachieve ottenere prestazioni ottimali.</span><span class="sxs-lookup"><span data-stu-id="eaa08-108">However, because Cosmos DB is accessed via network calls there are client-side optimizations you can make tooachieve peak performance.</span></span>

<span data-ttu-id="eaa08-109">Se si vogliono migliorare le prestazioni del database,</span><span class="sxs-lookup"><span data-stu-id="eaa08-109">So if you're asking "How can I improve my database performance?"</span></span> <span data-ttu-id="eaa08-110">prendere in considerazione hello le opzioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="eaa08-110">consider hello following options:</span></span>

## <a name="networking"></a><span data-ttu-id="eaa08-111">Rete</span><span class="sxs-lookup"><span data-stu-id="eaa08-111">Networking</span></span>
<a id="direct-connection"></a>

1. <span data-ttu-id="eaa08-112">**Criteri di connessione: usare la modalità di connessione diretta**</span><span class="sxs-lookup"><span data-stu-id="eaa08-112">**Connection policy: Use direct connection mode**</span></span>

    <span data-ttu-id="eaa08-113">Come un client si connette tooCosmos DB ha implicazioni molto importanti sulle prestazioni, specie in termini di latenza client-side osservata.</span><span class="sxs-lookup"><span data-stu-id="eaa08-113">How a client connects tooCosmos DB has important implications on performance, especially in terms of observed client-side latency.</span></span> <span data-ttu-id="eaa08-114">Sono disponibili due impostazioni di configurazione della chiave per la configurazione del client Criteri di connessione: connessione hello *modalità* hello e [connessione *protocollo*](#connection-protocol).</span><span class="sxs-lookup"><span data-stu-id="eaa08-114">There are two key configuration settings available for configuring client Connection Policy – hello connection *mode* and hello [connection *protocol*](#connection-protocol).</span></span>  <span data-ttu-id="eaa08-115">Hello due modalità disponibili sono:</span><span class="sxs-lookup"><span data-stu-id="eaa08-115">hello two available modes are:</span></span>

   1. <span data-ttu-id="eaa08-116">Modalità gateway (predefinita)</span><span class="sxs-lookup"><span data-stu-id="eaa08-116">Gateway Mode (default)</span></span>
   2. <span data-ttu-id="eaa08-117">Modalità diretta</span><span class="sxs-lookup"><span data-stu-id="eaa08-117">Direct Mode</span></span>

      <span data-ttu-id="eaa08-118">Modalità di gateway è supportata in tutte le piattaforme SDK e hello configurato predefinito.</span><span class="sxs-lookup"><span data-stu-id="eaa08-118">Gateway Mode is supported on all SDK platforms and is hello configured default.</span></span>  <span data-ttu-id="eaa08-119">Se l'applicazione viene eseguita all'interno di una rete aziendale con restrizioni del firewall strict, modalità di Gateway è la scelta migliore hello poiché Usa la porta HTTPS standard hello e un singolo endpoint.</span><span class="sxs-lookup"><span data-stu-id="eaa08-119">If your application runs within a corporate network with strict firewall restrictions, Gateway Mode is hello best choice since it uses hello standard HTTPS port and a single endpoint.</span></span> <span data-ttu-id="eaa08-120">salve compromesso di prestazioni, tuttavia, è che la modalità Gateway implica un hop di rete aggiuntiva ogni volta i dati vengono letti o scritti tooCosmos DB.</span><span class="sxs-lookup"><span data-stu-id="eaa08-120">hello performance tradeoff, however, is that Gateway Mode involves an additional network hop every time data is read or written tooCosmos DB.</span></span> <span data-ttu-id="eaa08-121">Per questo motivo, la modalità diretta offre prestazioni migliori scadenza toofewer hop di rete.</span><span class="sxs-lookup"><span data-stu-id="eaa08-121">Because of this, Direct Mode offers better performance due toofewer network hops.</span></span>
<a id="use-tcp"></a>
2. <span data-ttu-id="eaa08-122">**Criteri di connessione: utilizzare protocollo TCP hello**</span><span class="sxs-lookup"><span data-stu-id="eaa08-122">**Connection policy: Use hello TCP protocol**</span></span>

    <span data-ttu-id="eaa08-123">Quando si usa la modalità diretta, sono disponibili due opzioni del protocollo:</span><span class="sxs-lookup"><span data-stu-id="eaa08-123">When using Direct Mode, there are two protocol options available:</span></span>

   * <span data-ttu-id="eaa08-124">TCP</span><span class="sxs-lookup"><span data-stu-id="eaa08-124">TCP</span></span>
   * <span data-ttu-id="eaa08-125">HTTPS</span><span class="sxs-lookup"><span data-stu-id="eaa08-125">HTTPS</span></span>

     <span data-ttu-id="eaa08-126">Cosmos DB offre un modello di programmazione RESTful su HTTPS semplice e aperto.</span><span class="sxs-lookup"><span data-stu-id="eaa08-126">Cosmos DB offers a simple and open RESTful programming model over HTTPS.</span></span> <span data-ttu-id="eaa08-127">Inoltre, offre un efficiente protocollo TCP, che è anche RESTful nel modello di comunicazione ed è disponibile tramite il client hello .NET SDK.</span><span class="sxs-lookup"><span data-stu-id="eaa08-127">Additionally, it offers an efficient TCP protocol, which is also RESTful in its communication model and is available through hello .NET client SDK.</span></span> <span data-ttu-id="eaa08-128">Sia il protocollo TCP diretto che il protocollo HTTPS usano SSL per l'autenticazione iniziale e la crittografia del traffico.</span><span class="sxs-lookup"><span data-stu-id="eaa08-128">Both Direct TCP and HTTPS use SSL for initial authentication and encrypting traffic.</span></span> <span data-ttu-id="eaa08-129">Per prestazioni ottimali, utilizzare il protocollo TCP hello quando possibile.</span><span class="sxs-lookup"><span data-stu-id="eaa08-129">For best performance, use hello TCP protocol when possible.</span></span>

     <span data-ttu-id="eaa08-130">Quando si utilizza TCP in modalità di Gateway, la porta TCP 443 è hello porta DB Cosmos e 10255 è la porta di MongoDB API hello.</span><span class="sxs-lookup"><span data-stu-id="eaa08-130">When using TCP in Gateway Mode, TCP Port 443 is hello Cosmos DB port, and 10255 is hello MongoDB API port.</span></span> <span data-ttu-id="eaa08-131">Quando si utilizza TCP in modalità diretta, nelle porte di Gateway toohello aggiunta, è necessario porta hello tooensure compreso tra 10000 e 20000 è aperto perché Cosmos DB Usa le porte TCP dinamiche.</span><span class="sxs-lookup"><span data-stu-id="eaa08-131">When using TCP in Direct Mode, in addition toohello Gateway ports, you need tooensure hello port range between 10000 and 20000 is open because Cosmos DB uses dynamic TCP ports.</span></span> <span data-ttu-id="eaa08-132">Se queste porte non sono aperte e si tenta di toouse TCP, viene visualizzato un errore HTTP 503 Servizio non disponibile.</span><span class="sxs-lookup"><span data-stu-id="eaa08-132">If these ports are not open and you attempt toouse TCP, you receive a 503 Service Unavailable error.</span></span>

     <span data-ttu-id="eaa08-133">Modalità di connettività Hello viene configurato durante la costruzione di hello dell'istanza DocumentClient hello con parametro ConnectionPolicy hello.</span><span class="sxs-lookup"><span data-stu-id="eaa08-133">hello Connectivity Mode is configured during hello construction of hello DocumentClient instance with hello ConnectionPolicy parameter.</span></span> <span data-ttu-id="eaa08-134">Se viene utilizzata la modalità diretta, è inoltre possibile impostare hello protocollo nel parametro ConnectionPolicy hello.</span><span class="sxs-lookup"><span data-stu-id="eaa08-134">If Direct Mode is used, hello Protocol can also be set within hello ConnectionPolicy parameter.</span></span>

    ```C#
    var serviceEndpoint = new Uri("https://contoso.documents.net");
    var authKey = new "your authKey from hello Azure portal";
    DocumentClient client = new DocumentClient(serviceEndpoint, authKey,
    new ConnectionPolicy
    {
        ConnectionMode = ConnectionMode.Direct,
        ConnectionProtocol = Protocol.Tcp
    });
    ```

    <span data-ttu-id="eaa08-135">Poiché TCP è supportato solo in modalità diretta, se viene utilizzata la modalità di Gateway, quindi hello il protocollo HTTPS è sempre utilizzato toocommunicate con hello Gateway e il valore di protocollo hello in hello che connectionpolicy viene ignorato.</span><span class="sxs-lookup"><span data-stu-id="eaa08-135">Because TCP is only supported in Direct Mode, if Gateway Mode is used, then hello HTTPS protocol is always used toocommunicate with hello Gateway and hello Protocol value in hello ConnectionPolicy is ignored.</span></span>

    ![Illustrazione di hello Azure Cosmos DB criteri di connessione](./media/performance-tips/connection-policy.png)

3. <span data-ttu-id="eaa08-137">**Chiamare la latenza di avvio tooavoid OpenAsync alla prima richiesta**</span><span class="sxs-lookup"><span data-stu-id="eaa08-137">**Call OpenAsync tooavoid startup latency on first request**</span></span>

    <span data-ttu-id="eaa08-138">Per impostazione predefinita, prima richiesta hello ha una latenza maggiore perché contiene una tabella di routing toofetch hello indirizzo.</span><span class="sxs-lookup"><span data-stu-id="eaa08-138">By default, hello first request has a higher latency because it has toofetch hello address routing table.</span></span> <span data-ttu-id="eaa08-139">tooavoid questa latenza di avvio su hello prima richiesta, è necessario chiamare OpenAsync() come indicato di seguito una volta durante l'inizializzazione.</span><span class="sxs-lookup"><span data-stu-id="eaa08-139">tooavoid this startup latency on hello first request, you should call OpenAsync() once during initialization as follows.</span></span>

        await client.OpenAsync();
   <a id="same-region"></a>
4. <span data-ttu-id="eaa08-140">**Collocare i client nella stessa area di Azure per ottenere prestazioni migliori**</span><span class="sxs-lookup"><span data-stu-id="eaa08-140">**Collocate clients in same Azure region for performance**</span></span>

    <span data-ttu-id="eaa08-141">Quando possibile, sul posto hello di tutte le applicazioni che chiamano DB Cosmos stessa area hello database Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="eaa08-141">When possible, place any applications calling Cosmos DB in hello same region as hello Cosmos DB database.</span></span> <span data-ttu-id="eaa08-142">Per un confronto approssimativo, chiama tooCosmos DB all'interno di hello stessa regione completata entro 1-2 ms, ma la latenza di hello tra hello ovest e costa orientale di hello Stati Uniti sono > 50 ms.</span><span class="sxs-lookup"><span data-stu-id="eaa08-142">For an approximate comparison, calls tooCosmos DB within hello same region complete within 1-2 ms, but hello latency between hello West and East coast of hello US is >50 ms.</span></span> <span data-ttu-id="eaa08-143">Questa latenza probabilmente può variare da toorequest richiesta a seconda della route hello impiegato dalla richiesta hello durante il passaggio dal limite di hello client toohello Data Center di Azure.</span><span class="sxs-lookup"><span data-stu-id="eaa08-143">This latency can likely vary from request toorequest depending on hello route taken by hello request as it passes from hello client toohello Azure datacenter boundary.</span></span> <span data-ttu-id="eaa08-144">Hello più basso possibile latenza scopo è necessario garantire la chiamata di hello applicazione si trova all'interno di hello stessa area Azure hello provisioning Cosmos DB endpoint.</span><span class="sxs-lookup"><span data-stu-id="eaa08-144">hello lowest possible latency is achieved by ensuring hello calling application is located within hello same Azure region as hello provisioned Cosmos DB endpoint.</span></span> <span data-ttu-id="eaa08-145">Per un elenco delle aree disponibili, vedere [Aree di Azure](https://azure.microsoft.com/regions/#services).</span><span class="sxs-lookup"><span data-stu-id="eaa08-145">For a list of available regions, see [Azure Regions](https://azure.microsoft.com/regions/#services).</span></span>

    <span data-ttu-id="eaa08-146">![Illustrazione di hello Azure Cosmos DB criteri di connessione](./media/performance-tips/same-region.png)
   <a id="increase-threads"></a></span><span class="sxs-lookup"><span data-stu-id="eaa08-146">![Illustration of hello Azure Cosmos DB connection policy](./media/performance-tips/same-region.png)
<a id="increase-threads"></a></span></span>
5. <span data-ttu-id="eaa08-147">**Aumentare il numero di thread/attività**</span><span class="sxs-lookup"><span data-stu-id="eaa08-147">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="eaa08-148">Poiché le chiamate tooAzure Cosmos DB vengono eseguite su rete hello, potrebbe essere necessario grado di hello toovary parallelismo delle richieste in modo che un'applicazione client hello impiega molto tempo di attesa tra le richieste.</span><span class="sxs-lookup"><span data-stu-id="eaa08-148">Since calls tooAzure Cosmos DB are made over hello network, you may need toovary hello degree of parallelism of your requests so that hello client application spends very little time waiting between requests.</span></span> <span data-ttu-id="eaa08-149">Ad esempio, se si sta utilizzando. Del NET [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx), creare nell'ordine di hello di 100s delle attività di lettura o scrittura tooCosmos DB.</span><span class="sxs-lookup"><span data-stu-id="eaa08-149">For example, if you're using .NET's [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx), create in hello order of 100s of Tasks reading or writing tooCosmos DB.</span></span>

## <a name="sdk-usage"></a><span data-ttu-id="eaa08-150">Uso dell'SDK</span><span class="sxs-lookup"><span data-stu-id="eaa08-150">SDK Usage</span></span>
1. <span data-ttu-id="eaa08-151">**Installare hello SDK più recente**</span><span class="sxs-lookup"><span data-stu-id="eaa08-151">**Install hello most recent SDK**</span></span>

    <span data-ttu-id="eaa08-152">Hello Cosmos DB SDK vengono costantemente migliorate tooprovide hello migliori prestazioni.</span><span class="sxs-lookup"><span data-stu-id="eaa08-152">hello Cosmos DB SDKs are constantly being improved tooprovide hello best performance.</span></span> <span data-ttu-id="eaa08-153">Vedere hello [Cosmos DB SDK](documentdb-sdk-dotnet.md) toodetermine pagine hello SDK più recente ed esaminare i miglioramenti.</span><span class="sxs-lookup"><span data-stu-id="eaa08-153">See hello [Cosmos DB SDK](documentdb-sdk-dotnet.md) pages toodetermine hello most recent SDK and review improvements.</span></span>
2. <span data-ttu-id="eaa08-154">**Utilizzare un client DB Cosmos singleton per durata hello dell'applicazione**</span><span class="sxs-lookup"><span data-stu-id="eaa08-154">**Use a singleton Cosmos DB client for hello lifetime of your application**</span></span>

    <span data-ttu-id="eaa08-155">Si noti che ogni istanza di DocumentClient è thread-safe ed esegue la gestione efficiente delle connessioni e la memorizzazione nella cache degli indirizzi quando viene usata la modalità diretta.</span><span class="sxs-lookup"><span data-stu-id="eaa08-155">Note that each DocumentClient instance is thread-safe and performs efficient connection management and address caching when operating in Direct Mode.</span></span> <span data-ttu-id="eaa08-156">gestione di connessioni efficiente tooallow e prestazioni migliori da DocumentClient, è consigliabile toouse una singola istanza di DocumentClient per AppDomain per durata hello dell'applicazione hello.</span><span class="sxs-lookup"><span data-stu-id="eaa08-156">tooallow efficient connection management and better performance by DocumentClient, it is recommended toouse a single instance of DocumentClient per AppDomain for hello lifetime of hello application.</span></span>

   <a id="max-connection"></a>
3. <span data-ttu-id="eaa08-157">**Aumentare il valore di System.Net MaxConnections per host se si usa la modalità Gateway**.</span><span class="sxs-lookup"><span data-stu-id="eaa08-157">**Increase System.Net MaxConnections per host when using Gateway mode**</span></span>

    <span data-ttu-id="eaa08-158">COSMOS DB richieste vengono eseguite su HTTPS/REST quando si utilizza la modalità Gateway e sono sottoposti toohello limite di connessioni predefinito per ogni nome host o indirizzo IP.</span><span class="sxs-lookup"><span data-stu-id="eaa08-158">Cosmos DB requests are made over HTTPS/REST when using Gateway mode, and are subjected toohello default connection limit per hostname or IP address.</span></span> <span data-ttu-id="eaa08-159">Potrebbe essere necessario tooset hello MaxConnections tooa valore più alto (100-1000) in modo che hello libreria client può utilizzare più connessioni simultanee tooCosmos DB.</span><span class="sxs-lookup"><span data-stu-id="eaa08-159">You may need tooset hello MaxConnections tooa higher value (100-1000) so that hello client library can utilize multiple simultaneous connections tooCosmos DB.</span></span> <span data-ttu-id="eaa08-160">In .NET SDK 1.8.0 hello e sopra, hello il valore predefinito per [ServicePointManager. DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) è 50 e toochange hello valore, è possibile impostare hello [Documents.Client.ConnectionPolicy.MaxConnectionLimit ](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) tooa di valore più alto.</span><span class="sxs-lookup"><span data-stu-id="eaa08-160">In hello .NET SDK 1.8.0 and above, hello default value for [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) is 50 and toochange hello value, you can set hello [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) tooa higher value.</span></span>   
4. <span data-ttu-id="eaa08-161">**Ottimizzazione delle query parallele per le raccolte partizionate**</span><span class="sxs-lookup"><span data-stu-id="eaa08-161">**Tuning parallel queries for partitioned collections**</span></span>

     <span data-ttu-id="eaa08-162">DocumentDB .NET SDK versione alla 1.9.0 e versioni successive di query parallele di supporto, che consentono di tooquery una raccolta partizionata in parallelo (vedere [utilizzo hello SDK](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) hello correlati e [esempi di codice](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) per altre informazioni).</span><span class="sxs-lookup"><span data-stu-id="eaa08-162">DocumentDB .NET SDK version 1.9.0 and above support parallel queries, which enable you tooquery a partitioned collection in parallel (see [Working with hello SDKs](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) and hello related [code samples](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) for more info).</span></span> <span data-ttu-id="eaa08-163">Query parallele sono progettate tooimprove query latenza e velocità effettiva sulla loro controparte seriale.</span><span class="sxs-lookup"><span data-stu-id="eaa08-163">Parallel queries are designed tooimprove query latency and throughput over their serial counterpart.</span></span> <span data-ttu-id="eaa08-164">Query parallele forniscono due parametri che gli utenti possono ottimizzare toocustom adattamento relativi requisiti, MaxDegreeOfParallelism (): numero massimo di hello toocontrol delle partizioni è quindi possibile eseguire una query in parallelo e (b) MaxBufferedItemCount: numero di hello toocontrol di pre-recupero dei risultati.</span><span class="sxs-lookup"><span data-stu-id="eaa08-164">Parallel queries provide two parameters that users can tune toocustom-fit their requirements, (a) MaxDegreeOfParallelism: toocontrol hello maximum number of partitions then can be queried in parallel, and (b) MaxBufferedItemCount: toocontrol hello number of pre-fetched results.</span></span>

    <span data-ttu-id="eaa08-165">(a) ***Ottimizzazione di MaxDegreeOfParallelism\:*** la query parallela funziona eseguendo query su più partizioni in parallelo.</span><span class="sxs-lookup"><span data-stu-id="eaa08-165">(a) ***Tuning MaxDegreeOfParallelism\:*** Parallel query works by querying multiple partitions in parallel.</span></span> <span data-ttu-id="eaa08-166">Tuttavia, da una raccolta partizionata singoli vengono recuperati in modo seriale con query toohello riguardo.</span><span class="sxs-lookup"><span data-stu-id="eaa08-166">However, data from an individual partitioned collect is fetched serially with respect toohello query.</span></span> <span data-ttu-id="eaa08-167">In tal caso, hello il possibilità massima di raggiungimento di impostazione del numero di partizioni di hello MaxDegreeOfParallelism toohello è hello la maggior parte delle query ad alte prestazioni, purché tutte le altre condizioni di sistema rimangono hello stesso.</span><span class="sxs-lookup"><span data-stu-id="eaa08-167">So, setting hello MaxDegreeOfParallelism toohello number of partitions has hello maximum chance of achieving hello most performant query, provided all other system conditions remain hello same.</span></span> <span data-ttu-id="eaa08-168">Se non si conosce il numero di hello di partizioni, è possibile impostare un numero elevato hello MaxDegreeOfParallelism tooa e sistema hello sceglie minimo hello (numero di partizioni, l'input dell'utente fornito) come hello MaxDegreeOfParallelism.</span><span class="sxs-lookup"><span data-stu-id="eaa08-168">If you don't know hello number of partitions, you can set hello MaxDegreeOfParallelism tooa high number, and hello system chooses hello minimum (number of partitions, user provided input) as hello MaxDegreeOfParallelism.</span></span>

    <span data-ttu-id="eaa08-169">È importante toonote parallele query producono hello migliori vantaggi se dati hello viene distribuito uniformemente tra tutte le partizioni con query toohello riguardo.</span><span class="sxs-lookup"><span data-stu-id="eaa08-169">It is important toonote that parallel queries produce hello best benefits if hello data is evenly distributed across all partitions with respect toohello query.</span></span> <span data-ttu-id="eaa08-170">Se hello partizionata raccolta verrà partizionata modo tale che tutte o una parte dei dati di hello restituiti da una query è concentrato in alcune partizioni (una partizione nel peggiore dei casi), quindi le prestazioni di hello di query hello potrebbero essere un collo di bottiglia da tali partizioni.</span><span class="sxs-lookup"><span data-stu-id="eaa08-170">If hello partitioned collection is partitioned such a way that all or a majority of hello data returned by a query is concentrated in a few partitions (one partition in worst case), then hello performance of hello query would be bottlenecked by those partitions.</span></span>

    <span data-ttu-id="eaa08-171">(b) ***ottimizzazione MaxBufferedItemCount\: *** query parallele è impostato su toopre-fetch progettato durante l'elaborazione batch di risultati corrente hello client hello.</span><span class="sxs-lookup"><span data-stu-id="eaa08-171">(b) ***Tuning MaxBufferedItemCount\:*** Parallel query is designed toopre-fetch results while hello current batch of results is being processed by hello client.</span></span> <span data-ttu-id="eaa08-172">Hello la prelettura consente ottimizzazione Latenza complessiva di una query.</span><span class="sxs-lookup"><span data-stu-id="eaa08-172">hello pre-fetching helps in overall latency improvement of a query.</span></span> <span data-ttu-id="eaa08-173">MaxBufferedItemCount è hello parametro toolimit hello numero di risultati già recuperati.</span><span class="sxs-lookup"><span data-stu-id="eaa08-173">MaxBufferedItemCount is hello parameter toolimit hello number of pre-fetched results.</span></span> <span data-ttu-id="eaa08-174">Impostazione MaxBufferedItemCount toohello previsto hello query tooreceive il massimo vantaggio dalla prelettura consente a numero di risultati restituiti (o un numero più alto).</span><span class="sxs-lookup"><span data-stu-id="eaa08-174">Setting MaxBufferedItemCount toohello expected number of results returned (or a higher number) allows hello query tooreceive maximum benefit from pre-fetching.</span></span>

    <span data-ttu-id="eaa08-175">Si noti che funziona pre-recupero hello stesso modo indipendentemente dal fatto che di hello MaxDegreeOfParallelism ed è un singolo buffer per i dati di hello da tutte le partizioni.</span><span class="sxs-lookup"><span data-stu-id="eaa08-175">Note that pre-fetching works hello same way irrespective of hello MaxDegreeOfParallelism, and there is a single buffer for hello data from all partitions.</span></span>  
5. <span data-ttu-id="eaa08-176">**Attivare GC sul lato server**</span><span class="sxs-lookup"><span data-stu-id="eaa08-176">**Turn on server-side GC**</span></span>

    <span data-ttu-id="eaa08-177">In alcuni casi può essere utile ridurre la frequenza hello di garbage collection.</span><span class="sxs-lookup"><span data-stu-id="eaa08-177">Reducing hello frequency of garbage collection may help in some cases.</span></span> <span data-ttu-id="eaa08-178">In .NET, impostare [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) tootrue.</span><span class="sxs-lookup"><span data-stu-id="eaa08-178">In .NET, set [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) tootrue.</span></span>
6. <span data-ttu-id="eaa08-179">**Implementare il backoff in corrispondenza di intervalli RetryAfter**</span><span class="sxs-lookup"><span data-stu-id="eaa08-179">**Implement backoff at RetryAfter intervals**</span></span>

    <span data-ttu-id="eaa08-180">Durante il test delle prestazioni, è necessario aumentare il carico fino a limitare un numero ridotto di richieste.</span><span class="sxs-lookup"><span data-stu-id="eaa08-180">During performance testing, you should increase load until a small rate of requests get throttled.</span></span> <span data-ttu-id="eaa08-181">Limitate, hello applicazione client deve intervallo tentativi di backoff sulla limitazione per hello specificata dal server.</span><span class="sxs-lookup"><span data-stu-id="eaa08-181">If throttled, hello client application should backoff on throttle for hello server-specified retry interval.</span></span> <span data-ttu-id="eaa08-182">Rispettando hello backoff assicura che si trascorrono quantità minima di tempo di attesa tra i tentativi.</span><span class="sxs-lookup"><span data-stu-id="eaa08-182">Respecting hello backoff ensures that you spend minimal amount of time waiting between retries.</span></span> <span data-ttu-id="eaa08-183">Supporto di criteri di ripetizione è incluso nella versione 1.8.0 e di sopra di hello DocumentDB [.NET](documentdb-sdk-dotnet.md) e [Java](documentdb-sdk-java.md), versione alla 1.9.0 e versioni successive di hello [Node.js](documentdb-sdk-node.md) e [ Python](documentdb-sdk-python.md), e tutte le versioni supportate di hello [.NET Core](documentdb-sdk-dotnet-core.md) SDK.</span><span class="sxs-lookup"><span data-stu-id="eaa08-183">Retry policy support is included in Version 1.8.0 and above of hello DocumentDB [.NET](documentdb-sdk-dotnet.md) and [Java](documentdb-sdk-java.md), version 1.9.0 and above of hello [Node.js](documentdb-sdk-node.md) and [Python](documentdb-sdk-python.md), and all supported versions of hello [.NET Core](documentdb-sdk-dotnet-core.md) SDKs.</span></span> <span data-ttu-id="eaa08-184">Per altre informazioni, vedere [Superamento dei limiti della velocità effettiva riservata](request-units.md#RequestRateTooLarge) e [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span><span class="sxs-lookup"><span data-stu-id="eaa08-184">For more information, see [Exceeding reserved throughput limits](request-units.md#RequestRateTooLarge) and [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span></span>
7. <span data-ttu-id="eaa08-185">**Aumentare il carico di lavoro client**</span><span class="sxs-lookup"><span data-stu-id="eaa08-185">**Scale out your client-workload**</span></span>

    <span data-ttu-id="eaa08-186">Se si sta testando a livelli di velocità effettiva elevata (> 50.000 UR/sec), un'applicazione client hello potrebbe diventare collo di bottiglia hello scadenza toohello macchina coprendo all'utilizzo della CPU o rete.</span><span class="sxs-lookup"><span data-stu-id="eaa08-186">If you are testing at high throughput levels (>50,000 RU/s), hello client application may become hello bottleneck due toohello machine capping out on CPU or Network utilization.</span></span> <span data-ttu-id="eaa08-187">Se si raggiunge questo punto, è possibile continuare ulteriormente account al database Cosmos hello toopush tramite la scalabilità alle applicazioni client in più server.</span><span class="sxs-lookup"><span data-stu-id="eaa08-187">If you reach this point, you can continue toopush hello Cosmos DB account further by scaling out your client applications across multiple servers.</span></span>
8. <span data-ttu-id="eaa08-188">**Memorizzare nella cache gli URI dei documenti per una minore latenza di lettura**</span><span class="sxs-lookup"><span data-stu-id="eaa08-188">**Cache document URIs for lower read latency**</span></span>

    <span data-ttu-id="eaa08-189">Memorizzare nella cache URI ogni volta che è possibile per hello ottimizzare le prestazioni di lettura documento.</span><span class="sxs-lookup"><span data-stu-id="eaa08-189">Cache document URIs whenever possible for hello best read performance.</span></span>
   <a id="tune-page-size"></a>
9. <span data-ttu-id="eaa08-190">**Ottimizzazione delle dimensioni della pagina hello per le query/lettura feed per migliorare le prestazioni**</span><span class="sxs-lookup"><span data-stu-id="eaa08-190">**Tune hello page size for queries/read feeds for better performance**</span></span>

    <span data-ttu-id="eaa08-191">Quando l'esecuzione di un blocco di lettura di documenti tramite lettura feed funzionalità (ad esempio, ReadDocumentFeedAsync) o quando l'esecuzione di una query SQL di DocumentDB, hello vengono restituiti in modo segmentato se il set di risultati hello è troppo grande.</span><span class="sxs-lookup"><span data-stu-id="eaa08-191">When performing a bulk read of documents using read feed functionality (for example, ReadDocumentFeedAsync) or when issuing a DocumentDB SQL query, hello results are returned in a segmented fashion if hello result set is too large.</span></span> <span data-ttu-id="eaa08-192">Per impostazione predefinita, i risultati vengono restituiti in blocchi di 100 elementi o 1 MB, a seconda del limite che viene raggiunto prima.</span><span class="sxs-lookup"><span data-stu-id="eaa08-192">By default, results are returned in chunks of 100 items or 1 MB, whichever limit is hit first.</span></span>

    <span data-ttu-id="eaa08-193">numero di hello tooreduce di rete tooretrieve di andata e ritorno necessari tutti i risultati applicabili, è possibile aumentare la dimensione di pagina hello utilizzando too1000 tooup di intestazione x-ms-max-item-count richiesta.</span><span class="sxs-lookup"><span data-stu-id="eaa08-193">tooreduce hello number of network round trips required tooretrieve all applicable results, you can increase hello page size using x-ms-max-item-count request header tooup too1000.</span></span> <span data-ttu-id="eaa08-194">Nei casi in cui sia necessario toodisplay solo alcuni risultati, ad esempio, se l'API di applicazione o dell'interfaccia utente vengono restituiti solo 10 comporta un tempo, è inoltre possibile ridurre hello dimensioni too10 tooreduce hello velocità effettiva delle pagine utilizzata per letture e le query.</span><span class="sxs-lookup"><span data-stu-id="eaa08-194">In cases where you need toodisplay only a few results, for example, if your user interface or application API returns only 10 results a time, you can also decrease hello page size too10 tooreduce hello throughput consumed for reads and queries.</span></span>

    <span data-ttu-id="eaa08-195">È inoltre possibile impostare le dimensioni di pagina hello utilizzando hello disponibili Cosmos DB SDK.</span><span class="sxs-lookup"><span data-stu-id="eaa08-195">You may also set hello page size using hello available Cosmos DB SDKs.</span></span>  <span data-ttu-id="eaa08-196">ad esempio:</span><span class="sxs-lookup"><span data-stu-id="eaa08-196">For example:</span></span>

        IQueryable<dynamic> authorResults = client.CreateDocumentQuery(documentCollection.SelfLink, "SELECT p.Author FROM Pages p WHERE p.Title = 'About Seattle'", new FeedOptions { MaxItemCount = 1000 });
10. <span data-ttu-id="eaa08-197">**Aumentare il numero di thread/attività**</span><span class="sxs-lookup"><span data-stu-id="eaa08-197">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="eaa08-198">Vedere [aumentare del numero di thread/attività](#increase-threads) nella sezione Networking hello.</span><span class="sxs-lookup"><span data-stu-id="eaa08-198">See [Increase number of threads/tasks](#increase-threads) in hello Networking section.</span></span>

11. <span data-ttu-id="eaa08-199">**Usare processi host a 64 bit**</span><span class="sxs-lookup"><span data-stu-id="eaa08-199">**Use 64-bit host processing**</span></span>

    <span data-ttu-id="eaa08-200">Hello DocumentDB SDK funziona in un processo host a 32 bit quando si utilizza DocumentDB .NET SDK versione 1.11.4 e versioni successive.</span><span class="sxs-lookup"><span data-stu-id="eaa08-200">hello DocumentDB SDK works in a 32-bit host process when you are using DocumentDB .NET SDK version 1.11.4 and above.</span></span> <span data-ttu-id="eaa08-201">Tuttavia, se si usano query tra partizioni, è consigliabile usare l'elaborazione dell'host a 64 bit per migliorare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="eaa08-201">However, if you are using cross partition queries, 64-bit host processing is recommended for improved performance.</span></span> <span data-ttu-id="eaa08-202">elaborazione come valore predefinito di hello, pertanto, in ordine toochange che too64 bit, eseguire la procedura seguente in base al tipo di hello dell'applicazione, Hello seguenti tipi di applicazioni è host a 32 bit:</span><span class="sxs-lookup"><span data-stu-id="eaa08-202">hello following types of applications have 32-bit host process as hello default, so in order toochange that too64-bit, follow these steps based on hello type of your application:</span></span>

    - <span data-ttu-id="eaa08-203">Per le applicazioni eseguibili, questo scopo è possibile hello deselezionando **preferisci 32 bit** opzione hello **le proprietà del progetto** finestra hello **compilare** scheda.</span><span class="sxs-lookup"><span data-stu-id="eaa08-203">For Executable applications, this can be done by unchecking hello **Prefer 32-bit** option in hello **Project Properties** window, on hello **Build** tab.</span></span>

    - <span data-ttu-id="eaa08-204">Per i progetti di test basati su VSTest, questa operazione può essere eseguita selezionando **Test**->**impostazioni Test**->**predefinito architettura del processore X64**, da hello **Test di Visual Studio** opzione di menu.</span><span class="sxs-lookup"><span data-stu-id="eaa08-204">For VSTest based test projects, this can be done by selecting **Test**->**Test Settings**->**Default Processor Architecture as X64**, from hello **Visual Studio Test** menu option.</span></span>

    - <span data-ttu-id="eaa08-205">Per le applicazioni Web ASP.NET distribuite localmente, questa operazione può essere eseguita controllando hello **versione a 64 bit hello utilizzo di IIS Express per progetti e siti web**in **strumenti** ->  **Opzioni**->**progetti e soluzioni**->**progetti Web**.</span><span class="sxs-lookup"><span data-stu-id="eaa08-205">For locally deployed ASP.NET Web applications, this can be done by checking hello **Use hello 64-bit version of IIS Express for web sites and projects**, under **Tools**->**Options**->**Projects and Solutions**->**Web Projects**.</span></span>

    - <span data-ttu-id="eaa08-206">Per le applicazioni Web ASP.NET distribuite in Azure, questa operazione può essere eseguita scegliendo hello **piattaforma a 64 bit** in hello **le impostazioni dell'applicazione** su hello portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="eaa08-206">For ASP.NET Web applications deployed on Azure, this can be done by choosing hello **Platform as 64-bit** in hello **Application Settings** on hello Azure portal.</span></span>

## <a name="indexing-policy"></a><span data-ttu-id="eaa08-207">Criterio di indicizzazione</span><span class="sxs-lookup"><span data-stu-id="eaa08-207">Indexing Policy</span></span>
1. <span data-ttu-id="eaa08-208">**Usare l'indicizzazione differita per frequenze di inserimento più veloci nei momenti di massima attività**</span><span class="sxs-lookup"><span data-stu-id="eaa08-208">**Use lazy indexing for faster peak time ingestion rates**</span></span>

    <span data-ttu-id="eaa08-209">DB COSMOS consente toospecify: a livello di raccolta hello-un criterio di indicizzazione che consente di toochoose se si desidera hello documenti in un insieme di toobe automaticamente indicizzato o meno.</span><span class="sxs-lookup"><span data-stu-id="eaa08-209">Cosmos DB allows you toospecify – at hello collection level – an indexing policy, which enables you toochoose if you want hello documents in a collection toobe automatically indexed or not.</span></span>  <span data-ttu-id="eaa08-210">È anche possibile scegliere tra aggiornamenti sincroni (coerenti) e asincroni (differiti).</span><span class="sxs-lookup"><span data-stu-id="eaa08-210">In addition, you may also choose between synchronous (Consistent) and asynchronous (Lazy) index updates.</span></span> <span data-ttu-id="eaa08-211">Per impostazione predefinita, l'indice di hello viene aggiornato in modo sincrono in ogni istruzione insert, sostituire o eliminazione di una raccolta di toohello del documento.</span><span class="sxs-lookup"><span data-stu-id="eaa08-211">By default, hello index is updated synchronously on each insert, replace, or delete of a document toohello collection.</span></span> <span data-ttu-id="eaa08-212">In modo sincrono in modalità attiva hello query toohonor hello stesso [livello di coerenza](consistency-levels.md) a quella di hello documento legge senza alcun ritardo per l'indice di hello troppo "aggiornarsi".</span><span class="sxs-lookup"><span data-stu-id="eaa08-212">Synchronously mode enables hello queries toohonor hello same [consistency level](consistency-levels.md) as that of hello document reads without any delay for hello index too“catch up".</span></span>

    <span data-ttu-id="eaa08-213">Questo tipo di indicizzazione può essere considerata per gli scenari in cui i dati vengono scritti in aumenti improvvisi e si desidera tooamortize hello lavoro richiesto tooindex contenuto in un periodo di tempo più lungo.</span><span class="sxs-lookup"><span data-stu-id="eaa08-213">Lazy indexing may be considered for scenarios in which data is written in bursts, and you want tooamortize hello work required tooindex content over a longer period of time.</span></span> <span data-ttu-id="eaa08-214">Questo tipo di indicizzazione consente inoltre toouse il provisioning di velocità effettiva in modo efficace e servire richieste di scrittura nei momenti con latenza minima.</span><span class="sxs-lookup"><span data-stu-id="eaa08-214">Lazy indexing also allows you toouse your provisioned throughput effectively and serve write requests at peak times with minimal latency.</span></span> <span data-ttu-id="eaa08-215">È importante toonote, tuttavia, quando è abilitata l'indicizzazione differita, vengono alla fine coerenti indipendentemente dal livello di coerenza hello configurato per l'account Cosmos DB hello risultati della query.</span><span class="sxs-lookup"><span data-stu-id="eaa08-215">It is important toonote, however, that when lazy indexing is enabled, query results are eventually consistent regardless of hello consistency level configured for hello Cosmos DB account.</span></span>

    <span data-ttu-id="eaa08-216">Di conseguenza, la modalità di indicizzazione coerenza (IndexingPolicy.IndexingMode è impostato tooConsistent) comporta hello massima richiesta unità addebito per la scrittura, durante l'indicizzazione di modalità (IndexingPolicy.IndexingMode è impostato tooLazy) e non l'indicizzazione Lazy (IndexingPolicy.Automatic è impostato tooFalse) ha costo pari a zero indicizzazione in fase di hello di scrittura.</span><span class="sxs-lookup"><span data-stu-id="eaa08-216">Hence, Consistent indexing mode (IndexingPolicy.IndexingMode is set tooConsistent) incurs hello highest request unit charge per write, while Lazy indexing mode (IndexingPolicy.IndexingMode is set tooLazy) and no indexing (IndexingPolicy.Automatic is set tooFalse) have zero indexing cost at hello time of write.</span></span>
2. <span data-ttu-id="eaa08-217">**Escludere i percorsi non usati dall'indicizzazione per scritture più veloci**</span><span class="sxs-lookup"><span data-stu-id="eaa08-217">**Exclude unused paths from indexing for faster writes**</span></span>

    <span data-ttu-id="eaa08-218">Criteri di indicizzazione COSMOS DB consentono inoltre toospecify tooinclude percorsi dei documenti o escludere dall'indicizzazione sfruttando l'indicizzazione di percorsi (IndexingPolicy.IncludedPaths e IndexingPolicy.ExcludedPaths).</span><span class="sxs-lookup"><span data-stu-id="eaa08-218">Cosmos DB’s indexing policy also allows you toospecify which document paths tooinclude or exclude from indexing by leveraging Indexing Paths (IndexingPolicy.IncludedPaths and IndexingPolicy.ExcludedPaths).</span></span> <span data-ttu-id="eaa08-219">utilizzo di Hello dei percorsi di indicizzazione può offrire prestazioni di scrittura migliorate e archiviazione dell'indice più basso per gli scenari in cui hello modelli di query sono noti in anticipo, come i costi di indicizzazione sono direttamente correlati toohello svariate univoci percorsi indicizzati.</span><span class="sxs-lookup"><span data-stu-id="eaa08-219">hello use of indexing paths can offer improved write performance and lower index storage for scenarios in which hello query patterns are known beforehand, as indexing costs are directly correlated toohello number of unique paths indexed.</span></span>  <span data-ttu-id="eaa08-220">Ad esempio, hello seguente codice mostra come tooexclude un'intera sezione di hello documenti (anche noto come</span><span class="sxs-lookup"><span data-stu-id="eaa08-220">For example, hello following code shows how tooexclude an entire section of hello documents (a.k.a.</span></span> <span data-ttu-id="eaa08-221">un sottoalbero) dall'indicizzazione mediante hello "*" con caratteri jolly.</span><span class="sxs-lookup"><span data-stu-id="eaa08-221">a subtree) from indexing using hello "*" wildcard.</span></span>

    ```C#
    var collection = new DocumentCollection { Id = "excludedPathCollection" };
    collection.IndexingPolicy.IncludedPaths.Add(new IncludedPath { Path = "/*" });
    collection.IndexingPolicy.ExcludedPaths.Add(new ExcludedPath { Path = "/nonIndexedContent/*");
    collection = await client.CreateDocumentCollectionAsync(UriFactory.CreateDatabaseUri("db"), excluded);
    ```

    <span data-ttu-id="eaa08-222">Per altre informazioni, vedere l'articolo relativo ai [criteri di indicizzazione di Azure Cosmos DB](indexing-policies.md).</span><span class="sxs-lookup"><span data-stu-id="eaa08-222">For more information, see [Azure Cosmos DB indexing policies](indexing-policies.md).</span></span>

## <a name="throughput"></a><span data-ttu-id="eaa08-223">Velocità effettiva</span><span class="sxs-lookup"><span data-stu-id="eaa08-223">Throughput</span></span>
<a id="measure-rus"></a>

1. <span data-ttu-id="eaa08-224">**Misurare e ottimizzare per ottenere un utilizzo minore di unità richiesta al secondo**</span><span class="sxs-lookup"><span data-stu-id="eaa08-224">**Measure and tune for lower request units/second usage**</span></span>

    <span data-ttu-id="eaa08-225">COSMOS DB offre un'ampia gamma di operazioni di database, incluse le query relazionale e gerarchiche con funzioni definite dall'utente, stored procedure e trigger: funzionamento nei documenti di hello all'interno di una raccolta di database.</span><span class="sxs-lookup"><span data-stu-id="eaa08-225">Cosmos DB offers a rich set of database operations including relational and hierarchical queries with UDFs, stored procedures, and triggers – all operating on hello documents within a database collection.</span></span> <span data-ttu-id="eaa08-226">costo Hello associata a ognuna di queste operazioni varia in base hello CPU, i/o e quantità di memoria richiesta toocomplete hello operazione.</span><span class="sxs-lookup"><span data-stu-id="eaa08-226">hello cost associated with each of these operations varies based on hello CPU, IO, and memory required toocomplete hello operation.</span></span> <span data-ttu-id="eaa08-227">Anziché considerare e la gestione delle risorse hardware, può essere considerato di un'unità di richiesta (RU) come una singola misura per hello le risorse necessarie tooperform varie operazioni di database e servizio richiesta di un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="eaa08-227">Instead of thinking about and managing hardware resources, you can think of a request unit (RU) as a single measure for hello resources required tooperform various database operations and service an application request.</span></span>

    <span data-ttu-id="eaa08-228">[Unità richieste](request-units.md) viene effettuato il provisioning per ogni account del database in base al numero di hello unità di capacità acquistato.</span><span class="sxs-lookup"><span data-stu-id="eaa08-228">[Request units](request-units.md) are provisioned for each database account based on hello number of capacity units that you purchase.</span></span> <span data-ttu-id="eaa08-229">Il consumo delle unità di richiesta è valutato in base alla frequenza al secondo.</span><span class="sxs-lookup"><span data-stu-id="eaa08-229">Request unit consumption is evaluated as a rate per second.</span></span> <span data-ttu-id="eaa08-230">Le applicazioni che superano l'unità di richiesta di provisioning hello frequenza per l'account è limitata fino a quando il tasso di hello scende di sotto di hello livello riservato per l'account di hello.</span><span class="sxs-lookup"><span data-stu-id="eaa08-230">Applications that exceed hello provisioned request unit rate for their account is limited until hello rate drops below hello reserved level for hello account.</span></span> <span data-ttu-id="eaa08-231">Se l'applicazione necessita di un livello superiore di velocità effettiva, sarà possibile acquistare unità di capacità aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="eaa08-231">If your application requires a higher level of throughput, you can purchase additional capacity units.</span></span>

    <span data-ttu-id="eaa08-232">complessità Hello di una query ha un impatto quante unità di richiesta vengono utilizzate per un'operazione.</span><span class="sxs-lookup"><span data-stu-id="eaa08-232">hello complexity of a query impacts how many Request Units are consumed for an operation.</span></span> <span data-ttu-id="eaa08-233">numero di Hello di predicati, natura dei predicati hello, numero di funzioni definite dall'utente e dimensioni di hello del set di dati di origine hello tutti influenzare il costo di hello di operazioni di query.</span><span class="sxs-lookup"><span data-stu-id="eaa08-233">hello number of predicates, nature of hello predicates, number of UDFs, and hello size of hello source data set all influence hello cost of query operations.</span></span>

    <span data-ttu-id="eaa08-234">overhead hello toomeasure di qualsiasi operazione (creare, aggiornare o eliminare), esaminare l'intestazione x-ms-richiesta addebito hello (o hello proprietà RequestCharge equivalente in ResourceResponse<T> o FeedResponse<T> in .NET SDK hello) toomeasure numero di Hello di unità di richiesta utilizzato da queste operazioni.</span><span class="sxs-lookup"><span data-stu-id="eaa08-234">toomeasure hello overhead of any operation (create, update, or delete), inspect hello x-ms-request-charge header (or hello equivalent RequestCharge property in ResourceResponse<T> or FeedResponse<T> in hello .NET SDK) toomeasure hello number of request units consumed by these operations.</span></span>

    ```C#
    // Measure hello performance (request units) of writes
    ResourceResponse<Document> response = await client.CreateDocumentAsync(collectionSelfLink, myDocument);
    Console.WriteLine("Insert of document consumed {0} request units", response.RequestCharge);
    // Measure hello performance (request units) of queries
    IDocumentQuery<dynamic> queryable = client.CreateDocumentQuery(collectionSelfLink, queryString).AsDocumentQuery();
    while (queryable.HasMoreResults)
         {
              FeedResponse<dynamic> queryResponse = await queryable.ExecuteNextAsync<dynamic>();
              Console.WriteLine("Query batch consumed {0} request units", queryResponse.RequestCharge);
         }
    ```             

    <span data-ttu-id="eaa08-235">addebito richiesta restituito in questa intestazione Hello rappresenta una frazione della velocità effettiva di provisioning (ad esempio, 2000 RUs al secondo).</span><span class="sxs-lookup"><span data-stu-id="eaa08-235">hello request charge returned in this header is a fraction of your provisioned throughput (i.e., 2000 RUs / second).</span></span> <span data-ttu-id="eaa08-236">Ad esempio, se hello query precedente restituisce documenti con 1000 1KB, il costo di hello dell'operazione di hello è 1000.</span><span class="sxs-lookup"><span data-stu-id="eaa08-236">For example, if hello preceding query returns 1000 1KB-documents, hello cost of hello operation is 1000.</span></span> <span data-ttu-id="eaa08-237">Di conseguenza, all'interno di un secondo, server hello rispetta solo due richieste prima di limitazione delle richieste successive.</span><span class="sxs-lookup"><span data-stu-id="eaa08-237">As such, within one second, hello server honors only two such requests before throttling subsequent requests.</span></span> <span data-ttu-id="eaa08-238">Per ulteriori informazioni, vedere [unità richieste](request-units.md) hello e [calcolatrice unità richiesta](https://www.documentdb.com/capacityplanner).</span><span class="sxs-lookup"><span data-stu-id="eaa08-238">For more information, see [Request units](request-units.md) and hello [request unit calculator](https://www.documentdb.com/capacityplanner).</span></span>
<a id="429"></a>
2. <span data-ttu-id="eaa08-239">**Gestire la limitazione della frequenza o una frequenza di richieste troppo elevata**</span><span class="sxs-lookup"><span data-stu-id="eaa08-239">**Handle rate limiting/request rate too large**</span></span>

    <span data-ttu-id="eaa08-240">Quando un client tenta di velocità effettiva riservati tooexceed hello per un account, è senza riduzione delle prestazioni server hello e Nessun utilizzo della capacità di velocità effettiva oltre il livello di hello riservato.</span><span class="sxs-lookup"><span data-stu-id="eaa08-240">When a client attempts tooexceed hello reserved throughput for an account, there is no performance degradation at hello server and no use of throughput capacity beyond hello reserved level.</span></span> <span data-ttu-id="eaa08-241">server Hello modalità preemptive terminerà richiesta hello con RequestRateTooLarge (codice di stato HTTP 429) e indicando l'intestazione x-ms-nuovo tentativo-dopo-ms hello restituito hello tempo totale, espresso in millisecondi, che hello utente deve attendere prima di eseguire nuovamente la richiesta hello.</span><span class="sxs-lookup"><span data-stu-id="eaa08-241">hello server will preemptively end hello request with RequestRateTooLarge (HTTP status code 429) and return hello x-ms-retry-after-ms header indicating hello amount of time, in milliseconds, that hello user must wait before reattempting hello request.</span></span>

        HTTP Status 429,
        Status Line: RequestRateTooLarge
        x-ms-retry-after-ms :100

    <span data-ttu-id="eaa08-242">SDK Hello tutti implicitamente intercettare questa risposta di, rispettare intestazione hello specificata dal server retry-after e ripetere la richiesta hello.</span><span class="sxs-lookup"><span data-stu-id="eaa08-242">hello SDKs all implicitly catch this response, respect hello server-specified retry-after header, and retry hello request.</span></span> <span data-ttu-id="eaa08-243">A meno che non si accede all'account contemporaneamente da più client, il successivo tentativo di hello avrà esito positivo.</span><span class="sxs-lookup"><span data-stu-id="eaa08-243">Unless your account is being accessed concurrently by multiple clients, hello next retry will succeed.</span></span>

    <span data-ttu-id="eaa08-244">Se si dispone di più di un client in modo cumulativo operano in modo coerente di sopra di frequenza di richieste di hello, hello numero di tentativi predefinito attualmente too9 set internamente dal client hello potrebbe non essere sufficiente; In questo caso, il client di hello genera un DocumentClientException con applicazione toohello 429 in codice stato.</span><span class="sxs-lookup"><span data-stu-id="eaa08-244">If you have more than one client cumulatively operating consistently above hello request rate, hello default retry count currently set too9 internally by hello client may not suffice; in this case, hello client throws a DocumentClientException with status code 429 toohello application.</span></span> <span data-ttu-id="eaa08-245">numero di tentativi di Hello predefinito può essere modificato da hello impostazione RetryOptions nell'istanza ConnectionPolicy hello.</span><span class="sxs-lookup"><span data-stu-id="eaa08-245">hello default retry count can be changed by setting hello RetryOptions on hello ConnectionPolicy instance.</span></span> <span data-ttu-id="eaa08-246">Per impostazione predefinita, se richiesta hello continua toooperate sopra la frequenza di richieste hello hello DocumentClientException con codice di stato 429 viene restituito dopo un periodo di tempo cumulativo di attesa di 30 secondi.</span><span class="sxs-lookup"><span data-stu-id="eaa08-246">By default, hello DocumentClientException with status code 429 is returned after a cumulative wait time of 30 seconds if hello request continues toooperate above hello request rate.</span></span> <span data-ttu-id="eaa08-247">Questo errore si verifica anche quando il numero di tentativi corrente hello è inferiore al conteggio massimo di tentativi di hello, sia essa predefinito hello 9 o un valore definito dall'utente.</span><span class="sxs-lookup"><span data-stu-id="eaa08-247">This occurs even when hello current retry count is less than hello max retry count, be it hello default of 9 or a user-defined value.</span></span>

    <span data-ttu-id="eaa08-248">Mentre hello automatizzata comportamento del nuovo tentativo consente tooimprove flessibilità e facilità d'uso per hello la maggior parte delle applicazioni, potrebbero venire conflittuale quando si esegue il benchmark delle prestazioni, soprattutto quando la misurazione della latenza.</span><span class="sxs-lookup"><span data-stu-id="eaa08-248">While hello automated retry behavior helps tooimprove resiliency and usability for hello most applications, it might come at odds when doing performance benchmarks, especially when measuring latency.</span></span>  <span data-ttu-id="eaa08-249">Latenza osservata client Hello raggiungerà un picco se esperimento hello raggiunge il limite di server hello e fa sì che il client di hello tentativi toosilently SDK.</span><span class="sxs-lookup"><span data-stu-id="eaa08-249">hello client-observed latency will spike if hello experiment hits hello server throttle and causes hello client SDK toosilently retry.</span></span> <span data-ttu-id="eaa08-250">latenza tooavoid picchi durante gli esperimenti di prestazioni, misura hello addebito restituiti da ogni operazione e verificare che le richieste sono opera di sotto di frequenza di richieste riservato hello.</span><span class="sxs-lookup"><span data-stu-id="eaa08-250">tooavoid latency spikes during performance experiments, measure hello charge returned by each operation and ensure that requests are operating below hello reserved request rate.</span></span> <span data-ttu-id="eaa08-251">Per altre informazioni, vedere [Unità richiesta](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="eaa08-251">For more information, see [Request units](request-units.md).</span></span>
3. <span data-ttu-id="eaa08-252">**Progettare documenti di dimensioni minori per ottenere una velocità effettiva maggiore**</span><span class="sxs-lookup"><span data-stu-id="eaa08-252">**Design for smaller documents for higher throughput**</span></span>

    <span data-ttu-id="eaa08-253">Hello addebito richiesta (ad esempio l'elaborazione della richiesta costo) di un'operazione specificata è direttamente correlato toohello dimensioni del documento hello.</span><span class="sxs-lookup"><span data-stu-id="eaa08-253">hello request charge (i.e. request processing cost) of a given operation is directly correlated toohello size of hello document.</span></span> <span data-ttu-id="eaa08-254">Le operazioni sui documenti di grandi dimensioni sono più costose rispetto alle operazioni per i documenti di piccole dimensioni.</span><span class="sxs-lookup"><span data-stu-id="eaa08-254">Operations on large documents cost more than operations for small documents.</span></span>

## <a name="next-steps"></a><span data-ttu-id="eaa08-255">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="eaa08-255">Next steps</span></span>
<span data-ttu-id="eaa08-256">Per un esempio dell'applicazione utilizzata tooevaluate DB Cosmos per scenari ad alte prestazioni in alcuni computer client, vedere [prestazioni e scalabilità test con DB Cosmos](performance-testing.md).</span><span class="sxs-lookup"><span data-stu-id="eaa08-256">For a sample application used tooevaluate Cosmos DB for high-performance scenarios on a few client machines, see [Performance and scale testing with Cosmos DB](performance-testing.md).</span></span>

<span data-ttu-id="eaa08-257">Vedere anche toolearn ulteriori informazioni su progettazione dell'applicazione per la scalabilità e prestazioni elevate, [partizionamento e la scalabilità in Azure Cosmos DB](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="eaa08-257">Also, toolearn more about designing your application for scale and high performance, see [Partitioning and scaling in Azure Cosmos DB](partition-data.md).</span></span>
