---
title: controllo di accesso IP e il supporto di firewall Cosmos DB aaaAzure | Documenti Microsoft
description: Informazioni su come criteri di controllo di accesso toouse IP per firewall il supporto per gli account di database di Azure Cosmos DB.
keywords: controllo di accesso IP, supporto del firewall
services: cosmos-db
author: shahankur11
manager: jhubbard
editor: 
tags: azure-resource-manager
documentationcenter: 
ms.assetid: c1b9ede0-ed93-411a-ac9a-62c113a8e887
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/22/2017
ms.author: ankshah
ms.openlocfilehash: b5cdbdb28e9d7ee0fd0ea54aad277167b699929f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="azure-cosmos-db-firewall-support"></a><span data-ttu-id="6610d-104">Supporto del firewall di Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="6610d-104">Azure Cosmos DB firewall support</span></span>
<span data-ttu-id="6610d-105">toosecure dati archiviati in un account di database di Azure Cosmos DB, Cosmos Azure DB ha fornito il supporto per una chiave privata in base [modello di autorizzazione](https://msdn.microsoft.com/library/azure/dn783368.aspx) che usa un codice di autenticazione di messaggi basato su Hash complessa (HMAC).</span><span class="sxs-lookup"><span data-stu-id="6610d-105">toosecure data stored in an Azure Cosmos DB database account, Azure Cosmos DB has provided support for a secret based [authorization model](https://msdn.microsoft.com/library/azure/dn783368.aspx) that utilizes a strong Hash-based message authentication code (HMAC).</span></span> <span data-ttu-id="6610d-106">A questo punto, inoltre segreto toohello basato sul modello di autorizzazione, Azure Cosmos DB supporta criteri basati sui controlli di accesso basato su IP per il supporto firewall in ingresso.</span><span class="sxs-lookup"><span data-stu-id="6610d-106">Now, in addition toohello secret based authorization model, Azure Cosmos DB supports policy driven IP-based access controls for inbound firewall support.</span></span> <span data-ttu-id="6610d-107">Questo modello è molto simile toohello regole del firewall di un sistema di database tradizionale e fornisce un ulteriore livello di sicurezza toohello Azure Cosmos DB account del database.</span><span class="sxs-lookup"><span data-stu-id="6610d-107">This model is very similar toohello firewall rules of a traditional database system and provides an additional level of security toohello Azure Cosmos DB database account.</span></span> <span data-ttu-id="6610d-108">Con questo modello, è possibile ora configurare un toobe account database Azure Cosmos DB accessibile solo da un set di computer approvati e/o i servizi cloud.</span><span class="sxs-lookup"><span data-stu-id="6610d-108">With this model, you can now configure an Azure Cosmos DB database account toobe accessible only from an approved set of machines and/or cloud services.</span></span> <span data-ttu-id="6610d-109">Accedere alle risorse di DB Cosmos tooAzure da questi set di servizi e macchine approvati richiede comunque hello chiamante toopresent un token di autorizzazione valido.</span><span class="sxs-lookup"><span data-stu-id="6610d-109">Access tooAzure Cosmos DB resources from these approved sets of machines and services still require hello caller toopresent a valid authorization token.</span></span>

## <a name="ip-access-control-overview"></a><span data-ttu-id="6610d-110">Panoramica del controllo di accesso IP</span><span class="sxs-lookup"><span data-stu-id="6610d-110">IP access control overview</span></span>
<span data-ttu-id="6610d-111">Per impostazione predefinita, un account di database DB Cosmos Azure è accessibile da internet pubblico, purché hello richiesta è accompagnata da un token di autorizzazione valido.</span><span class="sxs-lookup"><span data-stu-id="6610d-111">By default, an Azure Cosmos DB database account is accessible from public internet as long as hello request is accompanied by a valid authorization token.</span></span> <span data-ttu-id="6610d-112">controllo di accesso basata su criteri IP tooconfigure, utente hello deve specificare il set di hello di indirizzi IP o intervalli di indirizzi IP in toobe formato CIDR inclusa come hello consentito l'elenco di IP client per un account di database specificato.</span><span class="sxs-lookup"><span data-stu-id="6610d-112">tooconfigure IP policy-based access control, hello user must provide hello set of IP addresses or IP address ranges in CIDR form toobe included as hello allowed list of client IPs for a given database account.</span></span> <span data-ttu-id="6610d-113">Una volta applicata questa configurazione, tutte le richieste provenienti da computer di fuori di questo elenco consentito verranno bloccate dal server hello.</span><span class="sxs-lookup"><span data-stu-id="6610d-113">Once this configuration is applied, all requests originating from machines outside this allowed list will be blocked by hello server.</span></span>  <span data-ttu-id="6610d-114">connessione Hello l'elaborazione del flusso di controllo di accesso basato su IP hello è descritto nel seguente diagramma hello.</span><span class="sxs-lookup"><span data-stu-id="6610d-114">hello connection processing flow for hello IP-based access control is described in hello following diagram.</span></span>

![Diagramma che illustra il processo di connessione hello per il controllo di accesso basato su IP](./media/firewall-support/firewall-support-flow.png)

## <a name="connections-from-cloud-services"></a><span data-ttu-id="6610d-116">Connessioni da servizi cloud</span><span class="sxs-lookup"><span data-stu-id="6610d-116">Connections from cloud services</span></span>
<span data-ttu-id="6610d-117">In Azure, i servizi cloud sono uno strumento molto comune per ospitare la logica del servizio di livello intermedio con Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="6610d-117">In Azure, cloud services are a very common way for hosting middle tier service logic using Azure Cosmos DB.</span></span> <span data-ttu-id="6610d-118">tooenable accesso tooan Azure Cosmos DB account del database da un servizio cloud, indirizzo IP pubblico hello del servizio cloud hello deve essere aggiunto toohello consentito l'elenco di indirizzi IP associati all'account di database di Azure Cosmos DB da [configurazione criteri di controllo di accesso IP Hello](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="6610d-118">tooenable access tooan Azure Cosmos DB database account from a cloud service, hello public IP address of hello cloud service must be added toohello allowed list of IP addresses associated with your Azure Cosmos DB database account by [configuring hello IP access control policy](#configure-ip-policy).</span></span>  <span data-ttu-id="6610d-119">In questo modo si garantisce che tutte le istanze del ruolo di servizi cloud hanno accesso tooyour Azure Cosmos DB account del database.</span><span class="sxs-lookup"><span data-stu-id="6610d-119">This ensures that all role instances of cloud services have access tooyour Azure Cosmos DB database account.</span></span> <span data-ttu-id="6610d-120">È possibile recuperare gli indirizzi IP per i servizi cloud nel portale di Azure hello, come illustrato nella seguente schermata hello.</span><span class="sxs-lookup"><span data-stu-id="6610d-120">You can retrieve IP addresses for your cloud services in hello Azure portal, as shown in hello following screenshot.</span></span>

![Schermata di indirizzo IP pubblico hello per un servizio cloud nel portale di Azure hello](./media/firewall-support/public-ip-addresses.png)

<span data-ttu-id="6610d-122">Quando scala in orizzontale il servizio cloud aggiungendo istanze del ruolo aggiuntivi, tali nuove istanze avranno automaticamente accesso account del database Azure Cosmos DB toohello poiché sono parte di hello stesso servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="6610d-122">When you scale out your cloud service by adding additional role instance(s), those new instances will automatically have access toohello Azure Cosmos DB database account since they are part of hello same cloud service.</span></span>

## <a name="connections-from-virtual-machines"></a><span data-ttu-id="6610d-123">Connessioni da macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="6610d-123">Connections from virtual machines</span></span>
<span data-ttu-id="6610d-124">[Macchine virtuali](https://azure.microsoft.com/services/virtual-machines/) o [set di scalabilità di macchine virtuali](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) può anche essere toohost utilizzati servizi di livello intermedio tramite Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="6610d-124">[Virtual machines](https://azure.microsoft.com/services/virtual-machines/) or [virtual machine scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) can also be used toohost middle tier services using Azure Cosmos DB.</span></span>  <span data-ttu-id="6610d-125">tooconfigure hello Azure Cosmos DB accesso tooallow account al database da macchine virtuali, gli indirizzi IP pubblici di macchina virtuale e/o set di scalabilità della macchina virtuale deve essere configurato come uno degli indirizzi IP per l'account di database di Azure Cosmos DB da consentiti hello [configurazione dei criteri di controllo di accesso IP hello](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="6610d-125">tooconfigure hello Azure Cosmos DB database account tooallow access from virtual machines, public IP addresses of virtual machine and/or virtual machine scale set must be configured as one of hello allowed IP addresses for your Azure Cosmos DB database account by [configuring hello IP access control policy](#configure-ip-policy).</span></span> <span data-ttu-id="6610d-126">È possibile recuperare gli indirizzi IP per le macchine virtuali in hello portale di Azure, come illustrato nella seguente schermata hello.</span><span class="sxs-lookup"><span data-stu-id="6610d-126">You can retrieve IP addresses for virtual machines in hello Azure portal, as shown in hello following screenshot.</span></span>

![Screenshot che illustra un indirizzo IP pubblico per una macchina virtuale visualizzata nel portale di Azure hello](./media/firewall-support/public-ip-addresses-dns.png)

<span data-ttu-id="6610d-128">Quando si aggiunge il gruppo di toohello istanze di macchina virtuale aggiuntiva, vengono fornite automaticamente account di accesso tooyour Azure Cosmos DB del database.</span><span class="sxs-lookup"><span data-stu-id="6610d-128">When you add additional virtual machine instances toohello group, they are automatically provided access tooyour Azure Cosmos DB database account.</span></span>

## <a name="connections-from-hello-internet"></a><span data-ttu-id="6610d-129">Le connessioni da hello internet</span><span class="sxs-lookup"><span data-stu-id="6610d-129">Connections from hello internet</span></span>
<span data-ttu-id="6610d-130">Quando l'accesso di un database di Azure Cosmos account da un computer del database su hello internet, hello indirizzo IP del client o l'intervallo di indirizzi IP della macchina hello deve essere aggiunto toohello elenco degli indirizzi IP per l'account del database Azure Cosmos DB hello consentito.</span><span class="sxs-lookup"><span data-stu-id="6610d-130">When you access an Azure Cosmos DB database account from a computer on hello internet, hello client IP address or IP address range of hello machine must be added toohello allowed list of IP address for hello Azure Cosmos DB database account.</span></span> 

## <span data-ttu-id="6610d-131"><a id="configure-ip-policy"></a>Configurazione dei criteri di controllo di accesso IP hello</span><span class="sxs-lookup"><span data-stu-id="6610d-131"><a id="configure-ip-policy"></a> Configuring hello IP access control policy</span></span>
<span data-ttu-id="6610d-132">criteri di controllo di accesso IP Hello possono essere impostati nel portale di Azure hello o a livello di programmazione tramite [CLI di Azure](cli-samples.md), [Azure Powershell](powershell-samples.md), o hello [API REST](/rest/api/documentdb/) aggiornando hello `ipRangeFilter` proprietà.</span><span class="sxs-lookup"><span data-stu-id="6610d-132">hello IP access control policy can be set in hello Azure portal, or programmatically through [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), or hello [REST API](/rest/api/documentdb/) by updating hello `ipRangeFilter` property.</span></span> <span data-ttu-id="6610d-133">Gli intervalli di indirizzi IP o i singoli indirizzi IP devono essere delimitati da virgole e non devono contenere spazi.</span><span class="sxs-lookup"><span data-stu-id="6610d-133">IP addresses/ranges must be comma separated and must not contain any spaces.</span></span> <span data-ttu-id="6610d-134">Esempio: "13.91.6.132,13.91.6.1/24".</span><span class="sxs-lookup"><span data-stu-id="6610d-134">Example: "13.91.6.132,13.91.6.1/24".</span></span> <span data-ttu-id="6610d-135">Quando si aggiorna l'account del database tramite questi metodi, toopopulate assicurarsi di essere tutti di hello proprietà tooprevent toodefault reimpostazione.</span><span class="sxs-lookup"><span data-stu-id="6610d-135">When updating your database account through these methods, be sure toopopulate all of hello properties tooprevent resetting toodefault settings.</span></span>

> [!NOTE]
> <span data-ttu-id="6610d-136">Abilita un criterio di controllo di accesso IP per l'account di database di Azure Cosmos DB, tutti accesso tooyour account database DB Cosmos Azure dal computer esterni hello configurato consentito elenco di intervalli di indirizzi IP sono bloccati.</span><span class="sxs-lookup"><span data-stu-id="6610d-136">By enabling an IP access control policy for your Azure Cosmos DB database account, all access tooyour Azure Cosmos DB database account from machines outside hello configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="6610d-137">In virtù di questo modello, esplorazione l'operazione di hello dati piano dal portale hello anche sarà bloccato tooensure hello integrità del controllo di accesso.</span><span class="sxs-lookup"><span data-stu-id="6610d-137">By virtue of this model, browsing hello data plane operation from hello portal will also be blocked tooensure hello integrity of access control.</span></span>

<span data-ttu-id="6610d-138">sviluppo toosimplify, hello portale di Azure consente di identificare e aggiungere IP hello del toohello macchina client consentito elenco, in modo che le applicazioni in esecuzione nel computer possono accedere hello account Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="6610d-138">toosimplify development, hello Azure portal helps you identify and add hello IP of your client machine toohello allowed list, so that apps running your machine can access hello Azure Cosmos DB account.</span></span> <span data-ttu-id="6610d-139">Si noti che viene rilevato hello indirizzo IP del client qui indicato dal portale di hello.</span><span class="sxs-lookup"><span data-stu-id="6610d-139">Note that hello client IP address here is detected as seen by hello portal.</span></span> <span data-ttu-id="6610d-140">È possibile indirizzo IP del client hello del computer, ma è anche possibile indirizzo IP di hello del gateway di rete.</span><span class="sxs-lookup"><span data-stu-id="6610d-140">It may be hello client IP address of your machine, but it could also be hello IP address of your network gateway.</span></span> <span data-ttu-id="6610d-141">Non dimenticare tooremove prima tooproduction continua.</span><span class="sxs-lookup"><span data-stu-id="6610d-141">Do not forget tooremove it before going tooproduction.</span></span>

<span data-ttu-id="6610d-142">tooset criteri di controllo di accesso IP a hello in hello portale di Azure, passare a pannello di account Azure Cosmos DB toohello, fare clic su **Firewall** nel menu di navigazione hello, quindi fare clic su **ON**</span><span class="sxs-lookup"><span data-stu-id="6610d-142">tooset hello IP access control policy in hello Azure portal, navigate toohello Azure Cosmos DB account blade, click **Firewall** in hello navigation menu, then click **ON**</span></span> 

![Screenshot che illustra come tooopen hello pannello Firewall in hello portale di Azure](./media/firewall-support/azure-portal-firewall.png)

<span data-ttu-id="6610d-144">Nel riquadro nuova hello, specificare se hello portale di Azure può accedere l'account di hello, aggiungere altri indirizzi e intervalli come appropriato, quindi fare clic su **salvare**.</span><span class="sxs-lookup"><span data-stu-id="6610d-144">In hello new pane, specify whether hello Azure portal can access hello account, and add other addresses and ranges as appropriate, then click **Save**.</span></span>  

> [!NOTE]
> <span data-ttu-id="6610d-145">Quando si abilita un criterio di controllo di accesso IP, è necessario l'indirizzo IP hello tooadd per hello accesso toomaintain portale Azure.</span><span class="sxs-lookup"><span data-stu-id="6610d-145">When you enable an IP access control policy, you need tooadd hello IP address for hello Azure portal toomaintain access.</span></span> <span data-ttu-id="6610d-146">gli indirizzi IP portali Hello sono:</span><span class="sxs-lookup"><span data-stu-id="6610d-146">hello portal IP addresses are:</span></span>
> |<span data-ttu-id="6610d-147">Region</span><span class="sxs-lookup"><span data-stu-id="6610d-147">Region</span></span>|<span data-ttu-id="6610d-148">Indirizzo IP</span><span class="sxs-lookup"><span data-stu-id="6610d-148">IP address</span></span>|
> |------|----------|
> |<span data-ttu-id="6610d-149">Tutte le aree a eccezione di quelle specificate di seguito</span><span class="sxs-lookup"><span data-stu-id="6610d-149">All regions except those specified below</span></span>| <span data-ttu-id="6610d-150">104.42.195.92</span><span class="sxs-lookup"><span data-stu-id="6610d-150">104.42.195.92</span></span>|
> |<span data-ttu-id="6610d-151">Germania</span><span class="sxs-lookup"><span data-stu-id="6610d-151">Germany</span></span>|<span data-ttu-id="6610d-152">51.4.229.218</span><span class="sxs-lookup"><span data-stu-id="6610d-152">51.4.229.218</span></span>|
> |<span data-ttu-id="6610d-153">Cina</span><span class="sxs-lookup"><span data-stu-id="6610d-153">China</span></span>|<span data-ttu-id="6610d-154">139.217.8.252</span><span class="sxs-lookup"><span data-stu-id="6610d-154">139.217.8.252</span></span>|
> |<span data-ttu-id="6610d-155">Governo degli Stati Uniti - Arizona</span><span class="sxs-lookup"><span data-stu-id="6610d-155">US Gov Arizona</span></span>|<span data-ttu-id="6610d-156">52.244.48.71</span><span class="sxs-lookup"><span data-stu-id="6610d-156">52.244.48.71</span></span>|
>

![Screenshot che illustra come impostazioni del firewall tooconfigure in hello portale di Azure](./media/firewall-support/azure-portal-firewall-configure.png)

## <a name="troubleshooting-hello-ip-access-control-policy"></a><span data-ttu-id="6610d-158">Risoluzione dei problemi di criteri di controllo di accesso IP hello</span><span class="sxs-lookup"><span data-stu-id="6610d-158">Troubleshooting hello IP access control policy</span></span>
### <a name="portal-operations"></a><span data-ttu-id="6610d-159">Operazioni nel portale</span><span class="sxs-lookup"><span data-stu-id="6610d-159">Portal operations</span></span>
<span data-ttu-id="6610d-160">Abilita un criterio di controllo di accesso IP per l'account di database di Azure Cosmos DB, tutti accesso tooyour account database DB Cosmos Azure dal computer esterni hello configurato consentito elenco di intervalli di indirizzi IP sono bloccati.</span><span class="sxs-lookup"><span data-stu-id="6610d-160">By enabling an IP access control policy for your Azure Cosmos DB database account, all access tooyour Azure Cosmos DB database account from machines outside hello configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="6610d-161">Pertanto, se si desidera operazioni piano dei dati portale tooenable quali raccolte e query nei documenti di esplorazione, è necessario tooexplicitly consentire l'accesso al portale Azure utilizzando hello **Firewall** pannello nel portale di hello.</span><span class="sxs-lookup"><span data-stu-id="6610d-161">Therefore if you want tooenable portal data plane operations like browsing collections and query documents, you need tooexplicitly allow Azure portal access using hello **Firewall** blade in hello portal.</span></span> 

![Screenshot che illustra come tooenable accesso toohello portale di Azure](./media/firewall-support/azure-portal-access-firewall.png)

### <a name="sdk--rest-api"></a><span data-ttu-id="6610d-163">SDK e API REST</span><span class="sxs-lookup"><span data-stu-id="6610d-163">SDK & Rest API</span></span>
<span data-ttu-id="6610d-164">Per motivi di sicurezza, l'accesso tramite SDK o l'API REST da computer non in elenco consentiti hello restituirà un generico 404 non trovato risposta con nessun ulteriore dettaglio.</span><span class="sxs-lookup"><span data-stu-id="6610d-164">For security reasons, access via SDK or REST API from machines not on hello allowed list will return a generic 404 Not Found response with no additional details.</span></span> <span data-ttu-id="6610d-165">Verificare che Hello IP consentito elenco configurato per la configurazione dei criteri corretti di Azure Cosmos DB database account tooensure hello è applicato tooyour Azure Cosmos DB account del database.</span><span class="sxs-lookup"><span data-stu-id="6610d-165">Please verify hello IP allowed list configured for your Azure Cosmos DB database account tooensure hello correct policy configuration is applied tooyour Azure Cosmos DB database account.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6610d-166">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="6610d-166">Next steps</span></span>
<span data-ttu-id="6610d-167">Per suggerimenti relativi alle prestazioni di rete, vedere [Suggerimenti sulle prestazioni per DocumentDB](performance-tips.md).</span><span class="sxs-lookup"><span data-stu-id="6610d-167">For information about network related performance tips, see [Performance tips](performance-tips.md).</span></span>

