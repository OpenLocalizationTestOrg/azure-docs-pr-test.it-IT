---
title: integrazione di aaaVPN con Azure MFA con l'estensione dei criteri di rete | Documenti Microsoft
description: Questo articolo viene illustrato come integrare l'infrastruttura VPN con Azure MFA con estensione Server dei criteri di rete (NPS) hello per Microsoft Azure.
services: active-directory
keywords: Azure MFA, integrazione VPN, Azure Active Directory, estensione di Server dei criteri di rete
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/15/2017
ms.author: kgremban
ms.reviewer: jsnow
ms.custom: it-pro
ms.openlocfilehash: 5e120f7633121385d9cc5d7bec97ecaa1ec7cf19
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="integrate-your-vpn-infrastructure-with-azure-multi-factor-authentication-mfa-using-hello-network-policy-server-nps-extension-for-azure"></a><span data-ttu-id="03320-104">Integrare l'infrastruttura VPN con Azure multi-Factor Authentication (MFA) tramite l'estensione dei criteri di rete Server () hello per Azure</span><span class="sxs-lookup"><span data-stu-id="03320-104">Integrate your VPN infrastructure with Azure Multi-Factor Authentication (MFA) using hello Network Policy Server (NPS) extension for Azure</span></span>

## <a name="overview"></a><span data-ttu-id="03320-105">Panoramica</span><span class="sxs-lookup"><span data-stu-id="03320-105">Overview</span></span>

<span data-ttu-id="03320-106">Hello estensione dei criteri di rete del servizio () per Azure consente alle organizzazioni utilizzando l'autenticazione di client RADIUS Remote Authentication Dial-In utente Service () toosafeguard basato su cloud [Azure multi-Factor Authentication (MFA)](multi-factor-authentication-get-started-server-rdg.md), che fornisce la verifica in due passaggi.</span><span class="sxs-lookup"><span data-stu-id="03320-106">hello Network Policy Service (NPS) extension for Azure allows organizations toosafeguard Remote Authentication Dial-In User Service (RADIUS) client authentication using cloud-based [Azure Multi-Factor Authentication (MFA)](multi-factor-authentication-get-started-server-rdg.md), which provides two-step verification.</span></span>

<span data-ttu-id="03320-107">Questo articolo vengono fornite istruzioni per l'integrazione dell'infrastruttura Criteri di rete hello con autenticazione a più fattori di Azure utilizzando l'estensione dei criteri di rete hello per la verifica in due passaggi sicura tooenable Azure per gli utenti che tentano di rete tooyour tooconnect utilizzando una connessione VPN.</span><span class="sxs-lookup"><span data-stu-id="03320-107">This article provides instructions for integrating hello NPS infrastructure with Azure MFA using hello NPS extension for Azure tooenable secure two-step verification for users attempting tooconnect tooyour network using a VPN.</span></span> 

<span data-ttu-id="03320-108">Hello servizi di accesso (NPS) e criteri di rete offre alle organizzazioni hello seguenti funzionalità:</span><span class="sxs-lookup"><span data-stu-id="03320-108">hello Network Policy and Access Services (NPS) gives organizations hello following abilities:</span></span>

* <span data-ttu-id="03320-109">Specificare i percorsi centrale per la gestione di hello e controllo di rete richieste toospecify in grado di connettersi, le ore del giorno sono consentite le connessioni, la durata di hello delle connessioni e hello livello di sicurezza che i client devono utilizzare tooconnect e così via.</span><span class="sxs-lookup"><span data-stu-id="03320-109">Specify central locations for hello management and control of network requests toospecify who can connect, what times of day connections are allowed, hello duration of connections, and hello level of security that clients must use tooconnect, and so on.</span></span> <span data-ttu-id="03320-110">Invece che specificare questi criteri in ogni VPN o server Gateway Desktop remoto, è possibile specificarli una sola volta in una posizione centrale.</span><span class="sxs-lookup"><span data-stu-id="03320-110">Rather than specify these policies on each VPN or Remote Desktop (RD) Gateway server, these policies can be specified once in a central location.</span></span> <span data-ttu-id="03320-111">viene utilizzato il protocollo RADIUS Hello tooprovide hello centralizzato di autenticazione, autorizzazione e Accounting (AAA).</span><span class="sxs-lookup"><span data-stu-id="03320-111">hello RADIUS protocol is used tooprovide hello centralized Authentication, Authorization, and Accounting (AAA).</span></span> 
* <span data-ttu-id="03320-112">Stabilire e applicare criteri di integrità client Protezione accesso rete (NAP) che determinano se i dispositivi vengono concesse le risorse toonetwork di accesso con restrizioni o senza restrizioni.</span><span class="sxs-lookup"><span data-stu-id="03320-112">Establish and enforce Network Access Protection (NAP) client health policies that determine whether devices are granted unrestricted or restricted access toonetwork resources.</span></span>
* <span data-ttu-id="03320-113">Forniscono un mezzo tooenforce autenticazione e autorizzazione per accedere ai punti di accesso wireless che supportano too802.1x e commutatori Ethernet.</span><span class="sxs-lookup"><span data-stu-id="03320-113">Provide a means tooenforce authentication and authorization for access too802.1x-capable wireless access points and Ethernet switches.</span></span>    

<span data-ttu-id="03320-114">Per altre informazioni, vedere [Server dei criteri di rete (NPS)](https://docs.microsoft.com/windows-server/networking/technologies/nps/nps-top).</span><span class="sxs-lookup"><span data-stu-id="03320-114">For more information, see [Network Policy Server (NPS)](https://docs.microsoft.com/windows-server/networking/technologies/nps/nps-top).</span></span> 

<span data-ttu-id="03320-115">sicurezza tooenhance e fornire un livello elevato di conformità, le organizzazioni possono integrare dei criteri di rete con Azure MFA tooensure che gli utenti usano verifica in due passaggi toobe in grado di connettersi toohello porta virtuale sul server VPN hello.</span><span class="sxs-lookup"><span data-stu-id="03320-115">tooenhance security and provide high level of compliance, organizations can integrate NPS with Azure MFA tooensure that users use two-step verification toobe able connect toohello virtual port on hello VPN server.</span></span> <span data-ttu-id="03320-116">Per gli utenti toobe consentito l'accesso, è necessario specificare la combinazione di nome utente/password con le informazioni utente hello dispone dei relativi controlli.</span><span class="sxs-lookup"><span data-stu-id="03320-116">For users toobe granted access, they must provide their username/password combination with information that hello user has in their control.</span></span> <span data-ttu-id="03320-117">Queste informazioni devono essere attendibili e non facilmente duplicabili, ad esempio un numero di telefono cellulare, un numero di rete fissa, un'applicazione in un dispositivo mobile e così via.</span><span class="sxs-lookup"><span data-stu-id="03320-117">This information must be trusted and not easily duplicated, such as a cell phone number, landline number, application on a mobile device, and so on.</span></span>

<span data-ttu-id="03320-118">Toohello precedente la disponibilità di hello estensione dei criteri di rete per Azure, i clienti che desideravano tooimplement di verifica in due passaggi per integrato dei criteri di rete e gli ambienti Azure MFA era tooconfigure e gestiscono un Server separato di autenticazione a più fattori nell'ambiente locale hello come documentati in Gateway Desktop remoto e il Server Azure multi-Factor Authentication tramite RADIUS.</span><span class="sxs-lookup"><span data-stu-id="03320-118">Prior toohello availability of hello NPS extension for Azure, customers who wished tooimplement two-step verification for integrated NPS and Azure MFA environments had tooconfigure and maintain a separate MFA Server in hello on-premises environment as documented in Remote Desktop Gateway and Azure Multi-Factor Authentication Server using RADIUS.</span></span>

<span data-ttu-id="03320-119">disponibilità Hello hello estensione di criteri di rete per Azure offre ora organizzazioni hello scelta toodeploy una soluzione di autenticazione a più fattori in locale o un basato su cloud MFA soluzione toosecure client l'autenticazione RADIUS.</span><span class="sxs-lookup"><span data-stu-id="03320-119">hello availability of hello NPS extension for Azure now gives organizations hello choice toodeploy either an on-premises based MFA solution or a cloud-based MFA solution toosecure RADIUS client authentication.</span></span>
 
## <a name="authentication-flow"></a><span data-ttu-id="03320-120">Flusso di autenticazione</span><span class="sxs-lookup"><span data-stu-id="03320-120">Authentication Flow</span></span>
<span data-ttu-id="03320-121">Quando un utente si connette tooa porta virtuale su un server VPN, devono prima autenticarsi usando un'ampia gamma di protocolli, che consente l'uso di hello di una combinazione di nome utente/password e i metodi di autenticazione basata su certificato.</span><span class="sxs-lookup"><span data-stu-id="03320-121">When a user connects tooa virtual port on a VPN server, they must first authenticate using a variety of protocols, which allow hello use of a combination of user name/password and certificate-based authentication methods.</span></span> 

<span data-ttu-id="03320-122">In aggiunta tooauthenticating e verificare l'identità, gli utenti devono disporre hello appropriate autorizzazioni di accesso.</span><span class="sxs-lookup"><span data-stu-id="03320-122">In addition tooauthenticating and verifying identity, users must have hello appropriate dial-in permissions.</span></span> <span data-ttu-id="03320-123">In implementazioni semplici, vengono impostate le autorizzazioni di accesso che consentono l'accesso direttamente negli oggetti utente di Active Directory hello.</span><span class="sxs-lookup"><span data-stu-id="03320-123">In simple implementations, these dial-in permissions that allow access are set directly on hello Active Directory user objects.</span></span> 

 ![Proprietà utente](./media/nps-extension-vpn/image1.png)

<span data-ttu-id="03320-125">Per le implementazioni semplici, ogni server VPN concede o nega l'accesso in base a criteri definiti in ogni server VPN locale.</span><span class="sxs-lookup"><span data-stu-id="03320-125">For simple implementations, each VPN server grants or denies access based on policies defined on each local VPN server.</span></span>

<span data-ttu-id="03320-126">Nelle implementazioni di dimensioni maggiori e più scalabile hello criteri che concedere o negare l'accesso VPN sono centralizzati nei server RADIUS.</span><span class="sxs-lookup"><span data-stu-id="03320-126">In larger and more scalable implementations, hello polices that grant or deny VPN access are centralized on RADIUS servers.</span></span> <span data-ttu-id="03320-127">In questo caso, server VPN hello funge da server RADIUS tooa i messaggi di account e di un server di accesso (client RADIUS) che inoltra le richieste di connessione.</span><span class="sxs-lookup"><span data-stu-id="03320-127">In this case, hello VPN server acts as an access server (RADIUS client) that forwards connection requests and account messages tooa RADIUS server.</span></span> <span data-ttu-id="03320-128">tooconnect toohello porta virtuale sul server VPN hello, gli utenti devono essere autenticati e soddisfano le condizioni di hello definite in modo centralizzato nel server RADIUS.</span><span class="sxs-lookup"><span data-stu-id="03320-128">tooconnect toohello virtual port on hello VPN server, users must be authenticated and meet hello conditions defined centrally on RADIUS servers.</span></span> 

<span data-ttu-id="03320-129">Quando l'estensione dei criteri di rete per Azure hello è integrato con hello dei criteri di rete, il flusso di autenticazione ha esito positivo di hello è il seguente:</span><span class="sxs-lookup"><span data-stu-id="03320-129">When hello NPS extension for Azure is integrated with hello NPS, hello successful authentication flow is as follows:</span></span>

1. <span data-ttu-id="03320-130">server VPN Hello riceve una richiesta di autenticazione da un utente VPN che include hello nome utente e password tooconnect tooa risorsa, ad esempio una sessione Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="03320-130">hello VPN server receives an authentication request from a VPN user that includes hello username and password tooconnect tooa resource, such as a Remote Desktop session.</span></span> 
2. <span data-ttu-id="03320-131">Funge da client RADIUS, server VPN converte messaggio di richiesta di accesso RADIUS tooa richiesta hello e Invia messaggio di hello (password crittografata) server RADIUS (NPS) toohello in cui è installato hello estensione dei criteri di rete.</span><span class="sxs-lookup"><span data-stu-id="03320-131">Acting as a RADIUS client, VPN server converts hello request tooa RADIUS Access-Request message and sends hello message (password is encrypted) toohello RADIUS (NPS) server where hello NPS extension is installed.</span></span> 
3. <span data-ttu-id="03320-132">Hello nome utente e la verifica della combinazione di password in Active Directory.</span><span class="sxs-lookup"><span data-stu-id="03320-132">hello username and password combination is verified in Active Directory.</span></span> <span data-ttu-id="03320-133">Se hello nome utente / password non è corretta, hello Server RADIUS invia un messaggio di rifiuto di accesso.</span><span class="sxs-lookup"><span data-stu-id="03320-133">If hello username / password is incorrect, hello RADIUS Server sends an Access-Reject message.</span></span> 
4. <span data-ttu-id="03320-134">Se tutte le condizioni come specificato in hello richiesta di connessione dei criteri di rete e che siano soddisfatti i criteri di rete (ad esempio, ora del giorno o gruppo di restrizioni di appartenenza), hello estensione dei criteri di rete attiva una richiesta per l'autenticazione secondaria con Azure MFA.</span><span class="sxs-lookup"><span data-stu-id="03320-134">If all conditions as specified in hello NPS Connection Request and Network Policies are met (for example, time of day or group membership restrictions), hello NPS extension triggers a request for secondary authentication with Azure MFA.</span></span> 
5. <span data-ttu-id="03320-135">Azure MFA comunica con Azure Active Directory, recupera i dettagli dell'utente hello ed esegue l'autenticazione secondaria hello utilizzando il metodo hello configurato dall'utente hello (messaggio di testo, app per dispositivi mobili e così via).</span><span class="sxs-lookup"><span data-stu-id="03320-135">Azure MFA communicates with Azure Active Directory, retrieves hello user’s details, and performs hello secondary authentication using hello method configured by hello user (text message, mobile app, and so on).</span></span> 
6. <span data-ttu-id="03320-136">Al completamento dell'operazione di richiesta di autenticazione a più fattori hello Azure MFA comunica l'estensione dei criteri di rete di hello risultato toohello.</span><span class="sxs-lookup"><span data-stu-id="03320-136">Upon success of hello MFA challenge, Azure MFA communicates hello result toohello NPS extension.</span></span>
7. <span data-ttu-id="03320-137">Dopo il tentativo di connessione hello è sia autenticato e autorizzato, server dei criteri di rete hello in cui è installato l'estensione hello invia un concessione di accesso RADIUS messaggio toohello server VPN (client RADIUS).</span><span class="sxs-lookup"><span data-stu-id="03320-137">After hello connection attempt is both authenticated and authorized, hello NPS server where hello extension is installed sends a RADIUS Access-Accept message toohello VPN server (RADIUS client).</span></span>
8. <span data-ttu-id="03320-138">utente Hello viene concesso l'accesso toohello di porta virtuale sul server VPN e di stabilisce un tunnel VPN crittografato.</span><span class="sxs-lookup"><span data-stu-id="03320-138">hello user is granted access toohello virtual port on VPN server and establishes an encrypted VPN tunnel.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="03320-139">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="03320-139">Prerequisites</span></span>
<span data-ttu-id="03320-140">Questa sezione descrive i prerequisiti di hello necessari prima dell'integrazione di Azure MFA con hello Gateway Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="03320-140">This section details hello prerequisites necessary before integrating Azure MFA with hello Remote Desktop Gateway.</span></span> <span data-ttu-id="03320-141">Prima di iniziare, è necessario disporre di hello seguenti prerequisiti soddisfatti.</span><span class="sxs-lookup"><span data-stu-id="03320-141">Before you begin, you must have hello following prerequisites in place.</span></span>

* <span data-ttu-id="03320-142">Infrastruttura VPN</span><span class="sxs-lookup"><span data-stu-id="03320-142">VPN infrastructure</span></span>
* <span data-ttu-id="03320-143">Ruolo Servizi di accesso e criteri di rete</span><span class="sxs-lookup"><span data-stu-id="03320-143">Network Policy and Access Services (NPS) role</span></span>
* <span data-ttu-id="03320-144">Licenza di Azure MFA</span><span class="sxs-lookup"><span data-stu-id="03320-144">Azure MFA License</span></span>
* <span data-ttu-id="03320-145">Software Windows Server</span><span class="sxs-lookup"><span data-stu-id="03320-145">Windows Server software</span></span>
* <span data-ttu-id="03320-146">Librerie</span><span class="sxs-lookup"><span data-stu-id="03320-146">Libraries</span></span>
* <span data-ttu-id="03320-147">Azure AD con sincronizzazione con AD in locale</span><span class="sxs-lookup"><span data-stu-id="03320-147">Azure AD synched with on-premises AD</span></span> 
* <span data-ttu-id="03320-148">ID GUID di Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="03320-148">Azure Active Directory GUID ID</span></span>

### <a name="vpn-infrastructure"></a><span data-ttu-id="03320-149">Infrastruttura VPN</span><span class="sxs-lookup"><span data-stu-id="03320-149">VPN infrastructure</span></span>
<span data-ttu-id="03320-150">In questo articolo si presuppone che si ha un'infrastruttura VPN di lavoro utilizzando Microsoft Windows Server 2016 sul posto e il server VPN hello non è attualmente configurato tooforward connessione richieste tooa RADIUS server.</span><span class="sxs-lookup"><span data-stu-id="03320-150">This article assumes that you have a working VPN infrastructure using Microsoft Windows Server 2016 in place and that hello VPN server is currently not configured tooforward connection requests tooa RADIUS server.</span></span> <span data-ttu-id="03320-151">Si configurerà hello VPN infrastruttura toouse un server RADIUS centrale in questa Guida.</span><span class="sxs-lookup"><span data-stu-id="03320-151">You will configure hello VPN infrastructure toouse a central RADIUS server in this guide.</span></span>

<span data-ttu-id="03320-152">Se si ha un'infrastruttura di lavoro sul posto, è possibile creare rapidamente questa infrastruttura dal seguente hello orientamenti di numerose esercitazioni di programma di installazione VPN che sono disponibili nel Microsoft hello e siti di terze parti.</span><span class="sxs-lookup"><span data-stu-id="03320-152">If you do not have a working infrastructure in place, you can quickly create this infrastructure by following hello guidance provided in numerous VPN setup tutorials you can find on hello Microsoft and third-party sites.</span></span> 

### <a name="network-policy-and-access-services-nps-role"></a><span data-ttu-id="03320-153">Ruolo Servizi di accesso e criteri di rete</span><span class="sxs-lookup"><span data-stu-id="03320-153">Network Policy and Access Services (NPS) role</span></span>

<span data-ttu-id="03320-154">servizio di ruolo dei criteri di rete Hello fornisce funzionalità di client e server RADIUS hello.</span><span class="sxs-lookup"><span data-stu-id="03320-154">hello NPS role service provides hello RADIUS server and client functionality.</span></span> <span data-ttu-id="03320-155">Si presume che è stato installato il ruolo di server NPS hello un server membro o controller di dominio nell'ambiente in uso.</span><span class="sxs-lookup"><span data-stu-id="03320-155">This article assumes you have installed hello NPS role on a member server or domain controller in your environment.</span></span> <span data-ttu-id="03320-156">In questa guida si configurerà il protocollo RADIUS per una configurazione VPN.</span><span class="sxs-lookup"><span data-stu-id="03320-156">You will configure RADIUS for a VPN configuration in this guide.</span></span> <span data-ttu-id="03320-157">Installare il ruolo di server NPS hello in un server _altri_ rispetto al server VPN.</span><span class="sxs-lookup"><span data-stu-id="03320-157">Install hello NPS role on a server _other_ than your VPN server.</span></span>

<span data-ttu-id="03320-158">Per informazioni sull'installazione di ruoli di hello dei criteri di rete servizio Windows Server 2012 o versioni successive, vedere [installare un Server dei criteri di integrità Protezione accesso alla rete](https://technet.microsoft.com/library/dd296890.aspx).</span><span class="sxs-lookup"><span data-stu-id="03320-158">For information on installing hello NPS role service Windows Server 2012 or higher, see [Install a NAP Health Policy Server](https://technet.microsoft.com/library/dd296890.aspx).</span></span> <span data-ttu-id="03320-159">Lo strumento Protezione accesso alla rete è deprecato in Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="03320-159">Network Access Policy (NAP) is deprecated in Windows Server 2016.</span></span> <span data-ttu-id="03320-160">Per una descrizione di procedure consigliate per i criteri di rete, tra cui hello raccomandazione tooinstall dei criteri di rete in un controller di dominio, vedere [procedure consigliate per i criteri di rete](https://technet.microsoft.com/library/cc771746).</span><span class="sxs-lookup"><span data-stu-id="03320-160">For a description of best practices for NPS, including hello recommendation tooinstall NPS on a domain controller, see [Best Practices for NPS](https://technet.microsoft.com/library/cc771746).</span></span>

### <a name="licenses"></a><span data-ttu-id="03320-161">Licenze</span><span class="sxs-lookup"><span data-stu-id="03320-161">Licenses</span></span>

<span data-ttu-id="03320-162">È richiesta una licenza per Azure MFA, disponibile tramite una sottoscrizione di Azure AD Premium, Enterprise Mobility + Security (EMS) o MFA.</span><span class="sxs-lookup"><span data-stu-id="03320-162">Required is a license for Azure MFA, which is available through an Azure AD Premium, Enterprise Mobility plus Security (EMS), or an MFA subscription.</span></span> <span data-ttu-id="03320-163">Per ulteriori informazioni, vedere [come tooget Azure multi-Factor Authentication](multi-factor-authentication-versions-plans.md).</span><span class="sxs-lookup"><span data-stu-id="03320-163">For more information, see [How tooget Azure Multi-Factor Authentication](multi-factor-authentication-versions-plans.md).</span></span> <span data-ttu-id="03320-164">A scopo di test, è possibile usare una sottoscrizione della versione di valutazione gratuita.</span><span class="sxs-lookup"><span data-stu-id="03320-164">For testing purposes, you can use a trial subscription.</span></span>

### <a name="software"></a><span data-ttu-id="03320-165">Software</span><span class="sxs-lookup"><span data-stu-id="03320-165">Software</span></span>

<span data-ttu-id="03320-166">Hello estensione dei criteri di rete richiede Windows Server 2008 R2 SP1 o versione successiva con installato il servizio ruolo dei criteri di rete hello.</span><span class="sxs-lookup"><span data-stu-id="03320-166">hello NPS extension requires Windows Server 2008 R2 SP1 or above with hello NPS role service installed.</span></span> <span data-ttu-id="03320-167">Tutti i passaggi di hello in questa guida sono stati eseguiti usando Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="03320-167">All hello steps in this guide were performed using Windows Server 2016.</span></span>

### <a name="libraries"></a><span data-ttu-id="03320-168">Librerie</span><span class="sxs-lookup"><span data-stu-id="03320-168">Libraries</span></span>

<span data-ttu-id="03320-169">è necessario i seguenti due librerie di Hello:</span><span class="sxs-lookup"><span data-stu-id="03320-169">hello following two libraries are required:</span></span>

* [<span data-ttu-id="03320-170">Visual C++ Redistributable Packages per Visual Studio 2013 (X64)</span><span class="sxs-lookup"><span data-stu-id="03320-170">Visual C++ Redistributable Packages for Visual Studio 2013 (X64)</span></span>](https://www.microsoft.com/download/details.aspx?id=40784)
* <span data-ttu-id="03320-171">_Modulo di Microsoft Azure Active Directory per Windows PowerShell versione 1.1.166.0_ o successiva.</span><span class="sxs-lookup"><span data-stu-id="03320-171">_Microsoft Azure Active Directory Module for Windows PowerShell version 1.1.166.0_ or higher.</span></span> <span data-ttu-id="03320-172">Per la versione più recente di hello e le istruzioni di installazione, vedere [Microsoft Azure Active Directory PowerShell modulo rilasciare cronologia](https://social.technet.microsoft.com/wiki/contents/articles/28552.microsoft-azure-active-directory-powershell-module-version-release-history.aspx).</span><span class="sxs-lookup"><span data-stu-id="03320-172">For hello latest release and installation instructions, see [Microsoft Azure Active Directory PowerShell Module Version Release History](https://social.technet.microsoft.com/wiki/contents/articles/28552.microsoft-azure-active-directory-powershell-module-version-release-history.aspx).</span></span>

<span data-ttu-id="03320-173">Queste librerie non sono incluso nel pacchetto hello NPS estensione file di installazione (versione 0.9.1.2), nonostante la documentazione esistente che dichiara in caso contrario.</span><span class="sxs-lookup"><span data-stu-id="03320-173">These libraries are not packaged with hello NPS extension setup files (version 0.9.1.2), despite existing documentation that states otherwise.</span></span> <span data-ttu-id="03320-174">Come minimo, è necessario installare i pacchetti hello Visual C++ Redistributable per Visual Studio 2013.</span><span class="sxs-lookup"><span data-stu-id="03320-174">At a minimum, you must install hello Visual C++ Redistributable Packages for Visual Studio 2013.</span></span> <span data-ttu-id="03320-175">Hello modulo dei Microsoft Azure Active Directory per Windows PowerShell è installato, se non è già presente, tramite uno script di configurazione che viene eseguito come parte del processo di installazione di hello.</span><span class="sxs-lookup"><span data-stu-id="03320-175">hello Microsoft Azure Active Directory Module for Windows PowerShell is installed, if it is not already present, through a configuration script you run as part of hello setup process.</span></span> <span data-ttu-id="03320-176">Non è disponibile alcuna necessità tooinstall questo modulo anticipatamente se non è già installato.</span><span class="sxs-lookup"><span data-stu-id="03320-176">There is no need tooinstall this module ahead of time if it is not already installed.</span></span>

### <a name="azure-active-directory-synched-with-on-premises-active-directory"></a><span data-ttu-id="03320-177">Azure Active Directory con sincronizzazione con Active Directory locale</span><span class="sxs-lookup"><span data-stu-id="03320-177">Azure Active Directory synched with on-premises Active Directory</span></span> 

<span data-ttu-id="03320-178">hello toouse estensione dei criteri di rete, in locale gli utenti devono essere sincronizzati con Azure Active Directory e abilitati per multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="03320-178">toouse hello NPS extension, on-premises users must be synced with Azure Active Directory and enabled for Multi-Factor Authentication.</span></span> <span data-ttu-id="03320-179">Questa guida presuppone che gli utenti locali siano sincronizzati con Azure Active Directory tramite AD Connect.</span><span class="sxs-lookup"><span data-stu-id="03320-179">This guide assumes that on-premises users are synched with Azure Active Directory using AD Connect.</span></span> <span data-ttu-id="03320-180">Le istruzioni per abilitare gli utenti per MFA sono disponibili più avanti.</span><span class="sxs-lookup"><span data-stu-id="03320-180">Instructions for enabling users for MFA are provided below.</span></span>
<span data-ttu-id="03320-181">Per informazioni su Azure AD Connect, vedere [Integrare le directory locali con Azure Active Directory](../active-directory/connect/active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="03320-181">For information on Azure AD connect, see [Integrate your on-premises directories with Azure Active Directory](../active-directory/connect/active-directory-aadconnect.md).</span></span> 

### <a name="azure-active-directory-guid-id"></a><span data-ttu-id="03320-182">ID GUID di Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="03320-182">Azure Active Directory GUID ID</span></span> 
<span data-ttu-id="03320-183">tooinstall hello dei criteri di rete, è necessario tooknow hello GUID di hello Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="03320-183">tooinstall hello NPS, you need tooknow hello GUID of hello Azure Active Directory.</span></span> <span data-ttu-id="03320-184">Nella sezione successiva hello vengono fornite istruzioni per la ricerca di hello GUID di hello Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="03320-184">Instructions for finding hello GUID of hello Azure Active Directory are provided in hello next section.</span></span>

## <a name="configure-radius-for-vpn-connections"></a><span data-ttu-id="03320-185">Configurare RADIUS per le connessioni VPN</span><span class="sxs-lookup"><span data-stu-id="03320-185">Configure RADIUS for VPN connections</span></span>

<span data-ttu-id="03320-186">Se è stato installato ruolo hello del server dei criteri di rete in un server membro, è necessario tooconfigure tooauthenticate e autorizzare i client VPN che richieda connessioni VPN.</span><span class="sxs-lookup"><span data-stu-id="03320-186">If you have installed hello NPS server role on a member server, you need tooconfigure tooauthenticate and authorize VPN client that request VPN connections.</span></span> 

<span data-ttu-id="03320-187">In questa sezione si presuppone che si è installato il ruolo di Server dei criteri di rete hello ma non configurati per l'utilizzo dell'infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="03320-187">This section assumes that you have installed hello Network Policy Server role but have not configured it for use in your infrastructure.</span></span>

>[!NOTE]
><span data-ttu-id="03320-188">Se si ha già un server VPN funzionante che usa un server RADIUS centralizzato per l'autenticazione, è possibile ignorare questa sezione.</span><span class="sxs-lookup"><span data-stu-id="03320-188">If you already have a working VPN server that uses a centralized RADIUS server for authentication, you can skip this section.</span></span>
>

### <a name="register-server-in-active-directory"></a><span data-ttu-id="03320-189">Registrare il server in Active Directory</span><span class="sxs-lookup"><span data-stu-id="03320-189">Register Server in Active Directory</span></span>
<span data-ttu-id="03320-190">toofunction correttamente in questo scenario, server dei criteri di rete hello deve toobe registrato in Active Directory.</span><span class="sxs-lookup"><span data-stu-id="03320-190">toofunction properly in this scenario, hello NPS server needs toobe registered in Active Directory.</span></span>

1. <span data-ttu-id="03320-191">Aprire Server Manager.</span><span class="sxs-lookup"><span data-stu-id="03320-191">Open Server Manager.</span></span>
2. <span data-ttu-id="03320-192">In Server Manager fare clic su **Strumenti** e quindi su **Server dei criteri di rete**.</span><span class="sxs-lookup"><span data-stu-id="03320-192">In Server Manager, click **Tools**, and then click **Network Policy Server**.</span></span> 
3. <span data-ttu-id="03320-193">Nella console di Server dei criteri di rete hello, fare doppio clic su **dei criteri di rete (locale)**, quindi fare clic su **Registra server in Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="03320-193">In hello Network Policy Server console, right-click **NPS (Local)**, and then click **Register server in Active Directory**.</span></span> <span data-ttu-id="03320-194">Fare clic su **OK** due volte.</span><span class="sxs-lookup"><span data-stu-id="03320-194">Click **OK** two times.</span></span>

 ![Server dei criteri di rete](./media/nps-extension-vpn/image2.png)

4. <span data-ttu-id="03320-196">Lasciare aperta per la procedura successiva hello hello console.</span><span class="sxs-lookup"><span data-stu-id="03320-196">Leave hello console open for hello next procedure.</span></span>

### <a name="use-wizard-tooconfigure-radius-server"></a><span data-ttu-id="03320-197">Utilizzare Configurazione guidata server RADIUS di tooconfigure</span><span class="sxs-lookup"><span data-stu-id="03320-197">Use wizard tooconfigure RADIUS server</span></span>
<span data-ttu-id="03320-198">È possibile utilizzare uno standard (basata su procedura guidata) o server di configurazione avanzate opzione tooconfigure hello RADIUS.</span><span class="sxs-lookup"><span data-stu-id="03320-198">You can use a standard (wizard-based) or advanced configuration option tooconfigure hello RADIUS server.</span></span> <span data-ttu-id="03320-199">In questa sezione si presuppone l'uso di hello hello basata su procedura guidata standard l'opzione di configurazione.</span><span class="sxs-lookup"><span data-stu-id="03320-199">This section assumes hello use of hello wizard-based standard configuration option.</span></span>

1. <span data-ttu-id="03320-200">Nella console di Server dei criteri di rete hello, fare clic su **dei criteri di rete (locale)**.</span><span class="sxs-lookup"><span data-stu-id="03320-200">In hello Network Policy Server console, click **NPS (Local)**.</span></span>
2. <span data-ttu-id="03320-201">In Configurazione standard selezionare **Server RADIUS per connessioni remote o VPN** e quindi fare clic su **Configurazione VPN o connessioni remote**.</span><span class="sxs-lookup"><span data-stu-id="03320-201">Under Standard Configuration, select **RADIUS Server for Dial-Up or VPN Connections**, and then click **Configure VPN or Dial-Up**.</span></span>

 ![Configurare la rete VPN](./media/nps-extension-vpn/image3.png)

3. <span data-ttu-id="03320-203">Pagina hello selezionare remote o tipo di connessioni di rete privata virtuale, selezionare **connessioni di rete privata virtuale**, fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="03320-203">On hello Select Dial-up or Virtual Private Network Connections Type page, select **Virtual Private Network Connections**, and click **Next**.</span></span>

 ![Rete privata virtuale](./media/nps-extension-vpn/image4.png)

4. <span data-ttu-id="03320-205">Nella pagina specificare connessioni remote o VPN hello scegliere **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="03320-205">On hello Specify Dial-Up or VPN Server page, click **Add**.</span></span>
5. <span data-ttu-id="03320-206">In hello **client RADIUS nuovo** nella finestra di dialogo immettere un nome descrittivo, immettere il nome risolvibile hello o l'indirizzo IP del server VPN hello e immettere una password segreta condivisa.</span><span class="sxs-lookup"><span data-stu-id="03320-206">In hello **New RADIUS client** dialog box, provide a friendly name, enter hello resolvable name or IP address of hello VPN server, and enter a shared secret password.</span></span> <span data-ttu-id="03320-207">Creare una password segreta condivisa lunga e complessa.</span><span class="sxs-lookup"><span data-stu-id="03320-207">Make this shared secret password long and complex.</span></span> <span data-ttu-id="03320-208">Registrare la password specificata, in base alle esigenze per i passaggi nella sezione successiva hello.</span><span class="sxs-lookup"><span data-stu-id="03320-208">Record this password, as you need it for steps in hello next section.</span></span>

 ![Nuovo client RADIUS](./media/nps-extension-vpn/image5.png)

6. <span data-ttu-id="03320-210">Fare clic su **OK** e quindi su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="03320-210">Click **OK**, and then **Next**.</span></span>
7. <span data-ttu-id="03320-211">In hello **configurare metodi di autenticazione** accettare selezione predefinita hello (autenticazione crittografata Microsoft versione 2 (MS-CHAPv2) o scegliere un'altra opzione e fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="03320-211">On hello **Configure Authentication Methods** page, accept hello default selection (Microsoft Encrypted Authentication version 2 (MS-CHAPv2) or choose another option, and click **Next**.</span></span>

  >[!NOTE]
  ><span data-ttu-id="03320-212">Se si configura il protocollo EAP (Extensible Authentication Protocol), è necessario usare MS CHAPv2 o PEAP.</span><span class="sxs-lookup"><span data-stu-id="03320-212">If you configure Extensible Authentication Protocol (EAP), you must use either MS CHAPv2 or PEAP.</span></span> <span data-ttu-id="03320-213">Non sono supportate altre opzioni EAP.</span><span class="sxs-lookup"><span data-stu-id="03320-213">No other EAP is supported.</span></span>
 
8. <span data-ttu-id="03320-214">Nella pagina specificare gruppi di utenti hello, fare clic su **Aggiungi** e selezionare un gruppo appropriato, se presente.</span><span class="sxs-lookup"><span data-stu-id="03320-214">On hello Specify User Groups page, click **Add** and select an appropriate group, if one exists.</span></span> <span data-ttu-id="03320-215">In caso contrario, lasciare invariata la selezione hello toogrant vuoto accesso tooall gli utenti.</span><span class="sxs-lookup"><span data-stu-id="03320-215">Otherwise, leave hello selection blank toogrant access tooall users.</span></span>

 ![Specificare i gruppi di utenti](./media/nps-extension-vpn/image7.png)

9. <span data-ttu-id="03320-217">Fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="03320-217">Click **Next**.</span></span>
10. <span data-ttu-id="03320-218">Nella pagina specificare i filtri IP hello, fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="03320-218">On hello Specify IP Filters page, click **Next**.</span></span>
11. <span data-ttu-id="03320-219">Nella pagina specifica impostazioni di crittografia di hello, accettare le impostazioni predefinite di hello e fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="03320-219">On hello Specify Encryption Settings page, accept hello default settings, and click **Next**.</span></span>

 ![Specificare la crittografia](./media/nps-extension-vpn/image8.png)

12. <span data-ttu-id="03320-221">In hello specificare un nome dell'area di autenticazione, lasciare vuoto il nome di hello, accettare l'impostazione predefinita hello e fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="03320-221">On hello Specify a Realm Name, leave hello name blank, accept hello default setting, and click **Next**.</span></span>

 ![Specificare un nome dell'area di autenticazione](./media/nps-extension-vpn/image9.png)

13. <span data-ttu-id="03320-223">Nella pagina di client RADIUS e di connessioni di rete privata virtuale o hello completamento nuove connessioni remote, fare clic su **fine**.</span><span class="sxs-lookup"><span data-stu-id="03320-223">On hello Completing New Dial-up or Virtual Private Network Connections and RADIUS clients page, click **Finish**.</span></span>

 ![Completare le connessioni](./media/nps-extension-vpn/image10.png)

### <a name="verify-radius-configuration"></a><span data-ttu-id="03320-225">Verificare la configurazione RADIUS</span><span class="sxs-lookup"><span data-stu-id="03320-225">Verify RADIUS configuration</span></span>
<span data-ttu-id="03320-226">In questa sezione illustra in dettaglio configurazione hello che è stato creato mediante Creazione guidata hello.</span><span class="sxs-lookup"><span data-stu-id="03320-226">This section details hello configuration you created using hello wizard.</span></span>

1. <span data-ttu-id="03320-227">Nel server dei criteri di rete hello, nella console Criteri di rete (locale) hello, espandere i client RADIUS e selezionare **client RADIUS**.</span><span class="sxs-lookup"><span data-stu-id="03320-227">On hello NPS server, in hello NPS (Local) console, expand RADIUS Clients, and select **RADIUS Clients**.</span></span>
2. <span data-ttu-id="03320-228">Nel riquadro dei dettagli di hello, fare doppio clic su client RADIUS hello è stato creato mediante una procedura guidata e fare clic su **proprietà**.</span><span class="sxs-lookup"><span data-stu-id="03320-228">In hello details pane, right-click hello RADIUS client you created using wizard, and click **Properties**.</span></span> <span data-ttu-id="03320-229">le proprietà di Hello per il client RADIUS (server VPN hello) devono essere simili toothose illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="03320-229">hello properties for your RADIUS client (hello VPN server) should be similar toothose shown below.</span></span>

 ![Proprietà VPN](./media/nps-extension-vpn/image11.png)

3. <span data-ttu-id="03320-231">Fare clic su **Annulla**.</span><span class="sxs-lookup"><span data-stu-id="03320-231">Click **Cancel**.</span></span>
4. <span data-ttu-id="03320-232">Nel server dei criteri di rete hello nella console Criteri di rete (locale) hello espandere **criteri**e selezionare **criteri richiesta di connessione**.</span><span class="sxs-lookup"><span data-stu-id="03320-232">On hello NPS server, in hello NPS (Local) console, expand **Policies**, and select **Connection Request Policies**.</span></span> <span data-ttu-id="03320-233">Dovrebbe essere criteri le connessioni VPN hello simile immagine hello riportata di seguito.</span><span class="sxs-lookup"><span data-stu-id="03320-233">You should see hello VPN Connections policy that resembles hello image below.</span></span>

 ![Richieste di connessione](./media/nps-extension-vpn/image12.png)

5. <span data-ttu-id="03320-235">In Criteri selezionare **Criteri di rete**.</span><span class="sxs-lookup"><span data-stu-id="03320-235">Under Policies, select **Network Policies**.</span></span> <span data-ttu-id="03320-236">È necessario un criterio di connessioni di rete privata virtuale (VPN, Virtual Private Network) che è simile a immagine hello riportata di seguito.</span><span class="sxs-lookup"><span data-stu-id="03320-236">You should a Virtual Private Network (VPN) Connections policy that resembles hello image below.</span></span>

 ![Proprietà di rete](./media/nps-extension-vpn/image13.png)

## <a name="configure-vpn-server-toouse-radius-authentication"></a><span data-ttu-id="03320-238">Configurare l'autenticazione RADIUS toouse Server VPN</span><span class="sxs-lookup"><span data-stu-id="03320-238">Configure VPN Server toouse RADIUS authentication</span></span>
<span data-ttu-id="03320-239">In questa sezione, configurare l'autenticazione RADIUS toouse di hello VPN server.</span><span class="sxs-lookup"><span data-stu-id="03320-239">In this section, you configure hello VPN server toouse RADIUS authentication.</span></span> <span data-ttu-id="03320-240">In questa sezione si presuppone che si dispone di una configurazione di lavoro del server VPN, ma non è stato configurato l'autenticazione RADIUS toouse di hello VPN server.</span><span class="sxs-lookup"><span data-stu-id="03320-240">This section assumes that you have a working configuration of VPN server but have not configured hello VPN server toouse RADIUS authentication.</span></span> <span data-ttu-id="03320-241">Dopo aver configurato il server VPN hello, si conferma che la configurazione funziona come previsto.</span><span class="sxs-lookup"><span data-stu-id="03320-241">After configuring hello VPN server, you confirm that your configuration is working as expected.</span></span>

>[!NOTE]
><span data-ttu-id="03320-242">Se si ha già una configurazione del server VPN funzionante che usa l'autenticazione RADIUS, è possibile ignorare questa sezione.</span><span class="sxs-lookup"><span data-stu-id="03320-242">If you already have a working VPN server configuration that uses RADIUS authentication, you can skip this section.</span></span>
>

### <a name="configure-authentication-provider"></a><span data-ttu-id="03320-243">Configurare il provider di autenticazione</span><span class="sxs-lookup"><span data-stu-id="03320-243">Configure authentication provider</span></span>
1. <span data-ttu-id="03320-244">Sul server VPN hello, aprire Server Manager.</span><span class="sxs-lookup"><span data-stu-id="03320-244">On hello VPN server, open Server Manager.</span></span>
2. <span data-ttu-id="03320-245">In Server Manager fare clic su **Strumenti** e quindi su **Routing e Accesso remoto**.</span><span class="sxs-lookup"><span data-stu-id="03320-245">In Server Manager, click **Tools**, and then **Routing and Remote Access**.</span></span>
3. <span data-ttu-id="03320-246">Nella console di Routing e accesso remoto hello, fare doppio clic su  **\[nome Server\] (local)**, quindi fare clic su **proprietà**.</span><span class="sxs-lookup"><span data-stu-id="03320-246">In hello Routing and Remote Access console, right-click **\[Server Name\] (local)**, and then click **Properties**.</span></span>

 ![Routing e accesso remoto](./media/nps-extension-vpn/image14.png)
 
4. <span data-ttu-id="03320-248">In hello **[nome Server} (locale) proprietà** finestra di dialogo fare clic su hello **sicurezza** scheda.</span><span class="sxs-lookup"><span data-stu-id="03320-248">In hello **[Server Name} (local) Properties** dialog box, click hello **Security** tab.</span></span> 
5. <span data-ttu-id="03320-249">In hello **sicurezza** scheda, in provider di autenticazione, fare clic su **l'autenticazione RADIUS**e quindi **configura**.</span><span class="sxs-lookup"><span data-stu-id="03320-249">On hello **Security** tab, under Authentication provider, click **RADIUS Authentication**, and then **Configure**.</span></span>

 ![Autenticazione RADIUS](./media/nps-extension-vpn/image15.png)
 
6. <span data-ttu-id="03320-251">Nella finestra di dialogo autenticazione RADIUS hello, fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="03320-251">In hello RADIUS Authentication dialog box, click **Add**.</span></span>
7. <span data-ttu-id="03320-252">In hello Aggiungi Server RADIUS, in nome Server, aggiungere hello nome o hello indirizzo IP del server RADIUS hello che è configurato nella sezione precedente hello.</span><span class="sxs-lookup"><span data-stu-id="03320-252">In hello Add RADIUS Server, in Server name, add hello name or hello IP address of hello RADIUS server you configured in hello previous section.</span></span>
8. <span data-ttu-id="03320-253">Segreto condiviso, fare clic su **modifica** e aggiungere hello condivisa password segreta è stato creato e registrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="03320-253">In Shared secret, click **Change** and add hello shared secret password you created and recorded earlier.</span></span>
9. <span data-ttu-id="03320-254">Timeout (secondi), modificare tooa valore hello tra **30** e **60**.</span><span class="sxs-lookup"><span data-stu-id="03320-254">In Time-out (seconds), change hello value tooa value between **30** and **60**.</span></span> <span data-ttu-id="03320-255">Si tratta di un tempo sufficiente toocomplete hello secondo fattore di autenticazione tooallow necessarie.</span><span class="sxs-lookup"><span data-stu-id="03320-255">This is necessary tooallow enough time toocomplete hello second authentication factor.</span></span>
 
 ![Aggiungere il server RADIUS](./media/nps-extension-vpn/image16.png)
 
10. <span data-ttu-id="03320-257">Fare clic su **OK** fino a chiudere tutte le finestre di dialogo.</span><span class="sxs-lookup"><span data-stu-id="03320-257">Click **OK** until you complete closing all dialog boxes.</span></span>

### <a name="test-vpn-connectivity"></a><span data-ttu-id="03320-258">Testare la connettività VPN</span><span class="sxs-lookup"><span data-stu-id="03320-258">Test VPN connectivity</span></span>
<span data-ttu-id="03320-259">In questa sezione si conferma di client VPN hello è autenticato e autorizzato dal server RADIUS hello, quando si tenta di porta virtuale di tooconnect tooVPN.</span><span class="sxs-lookup"><span data-stu-id="03320-259">In this section, you confirm that hello VPN client is authenticated and authorized by hello RADIUS server when you attempt tooconnect tooVPN virtual port.</span></span> <span data-ttu-id="03320-260">Questa sezione presuppone l'uso di Windows 10 come client VPN.</span><span class="sxs-lookup"><span data-stu-id="03320-260">This section assumes you are using Windows 10 as a VPN client.</span></span> 

>[!NOTE]
><span data-ttu-id="03320-261">Se è già configurato un server VPN di VPN client tooconnect toohello e aver salvato le impostazioni di hello, è possibile ignorare hello passaggi correlati tooconfiguring e il salvataggio di un oggetto di connessione VPN.</span><span class="sxs-lookup"><span data-stu-id="03320-261">If you already configured a VPN client tooconnect toohello VPN server and have saved hello settings, you can skip hello steps related tooconfiguring and saving a VPN connection object.</span></span>
>

1. <span data-ttu-id="03320-262">Nel computer client VPN fare clic su **Start** e quindi su **Impostazioni** (icona a forma di ingranaggio).</span><span class="sxs-lookup"><span data-stu-id="03320-262">On your VPN client computer, click **Start**, and then **Settings** (gear icon).</span></span>
2. <span data-ttu-id="03320-263">In Impostazioni di Windows fare clic su **Rete e Internet**.</span><span class="sxs-lookup"><span data-stu-id="03320-263">In Window Settings, click **Network & Internet**.</span></span>
3. <span data-ttu-id="03320-264">Fare clic su **VPN**.</span><span class="sxs-lookup"><span data-stu-id="03320-264">Click **VPN**.</span></span>
4. <span data-ttu-id="03320-265">Fare clic su **Aggiungi connessione VPN**.</span><span class="sxs-lookup"><span data-stu-id="03320-265">Click **Add a VPN connection**.</span></span>
5. <span data-ttu-id="03320-266">Aggiungere una connessione VPN specificare Windows (predefinito) come hello provider VPN, quindi hello completa i campi, come appropriato, rimanenti e fare clic su **salvare**.</span><span class="sxs-lookup"><span data-stu-id="03320-266">In Add a VPN connection, specify Windows (built-in) as hello VPN provider, then complete hello remaining fields, as appropriate, and click **Save**.</span></span> 

 ![Aggiungere la connessione VPN](./media/nps-extension-vpn/image17.png)
 
6. <span data-ttu-id="03320-268">Aprire hello **centro rete e condivisione** nel Pannello di controllo.</span><span class="sxs-lookup"><span data-stu-id="03320-268">Open hello **Network and Sharing Center** in Control Panel.</span></span>
7. <span data-ttu-id="03320-269">Fare clic su **Modifica impostazioni scheda**.</span><span class="sxs-lookup"><span data-stu-id="03320-269">Click **Change adapter settings**.</span></span>

 ![Modificare le impostazioni della scheda](./media/nps-extension-vpn/image18.png)

8. <span data-ttu-id="03320-271">Connessione di rete VPN hello destro, quindi scegliere Proprietà.</span><span class="sxs-lookup"><span data-stu-id="03320-271">Right-click hello VPN network connection, and click Properties.</span></span> 

 ![Proprietà rete VPN](./media/nps-extension-vpn/image19.png)

9. <span data-ttu-id="03320-273">In hello VPN proprietà finestra di dialogo, fare clic su hello **sicurezza** scheda.</span><span class="sxs-lookup"><span data-stu-id="03320-273">In hello VPN properties dialog box, click hello **Security** tab.</span></span> 
10. <span data-ttu-id="03320-274">Nella scheda sicurezza hello garantisce che solo **Microsoft CHAP versione 2 (MS-CHAP v2)** sia selezionata e fare clic su OK.</span><span class="sxs-lookup"><span data-stu-id="03320-274">On hello Security tab, ensure that only **Microsoft CHAP Version 2 (MS-CHAP v2)** is selected, and click OK.</span></span>

 ![Consentire i protocolli](./media/nps-extension-vpn/image20.png)

11. <span data-ttu-id="03320-276">Connessione VPN hello di mouse e scegliere **Connetti**.</span><span class="sxs-lookup"><span data-stu-id="03320-276">Right-click hello VPN connection, and click **Connect**.</span></span>
12. <span data-ttu-id="03320-277">Nella pagina Impostazioni hello, fare clic su **Connetti**.</span><span class="sxs-lookup"><span data-stu-id="03320-277">On hello Settings page, click **Connect**.</span></span>

<span data-ttu-id="03320-278">Una connessione viene visualizzato nel Registro di protezione hello sul server RADIUS hello come 6272 ID evento, come illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="03320-278">A successful connection appears in hello Security log on hello RADIUS server as Event ID 6272, as shown below.</span></span>

 ![Proprietà dell'evento](./media/nps-extension-vpn/image21.png)

## <a name="troubleshoot-guide"></a><span data-ttu-id="03320-280">Guida per la risoluzione dei problemi</span><span class="sxs-lookup"><span data-stu-id="03320-280">Troubleshoot Guide</span></span>
<span data-ttu-id="03320-281">Si supponga che la configurazione VPN era in esecuzione prima configurato hello VPN server toouse un server RADIUS centralizzato per l'autenticazione e autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="03320-281">Assume that your VPN configuration was working before you configured hello VPN server toouse a centralized RADIUS server for authentication and authorization.</span></span> <span data-ttu-id="03320-282">In questo caso, è probabile che hello potrebbe essere causato da una configurazione errata di hello Server RADIUS o hello utilizzo di un nome utente non valido o una password.</span><span class="sxs-lookup"><span data-stu-id="03320-282">In this case, it is likely that hello issue may be caused by a misconfiguration of hello RADIUS Server or hello use of an invalid username or password.</span></span> <span data-ttu-id="03320-283">Ad esempio, se si utilizza il suffisso UPN alternativo di hello nomeutente hello, il tentativo di accesso hello potrebbe non riuscire (è consigliabile utilizzare hello stesso nome dell'Account per ottenere risultati ottimali).</span><span class="sxs-lookup"><span data-stu-id="03320-283">For example, if you use hello alternate UPN suffix in hello username, hello login attempt might fail (you should use hello same Account name for best results).</span></span> 

<span data-ttu-id="03320-284">tootroubleshoot questi problemi, un toostart ideale è tooexamine hello registri eventi di sicurezza su hello server RADIUS.</span><span class="sxs-lookup"><span data-stu-id="03320-284">tootroubleshoot these issues, an ideal place toostart is tooexamine hello Security event logs on hello RADIUS server.</span></span> <span data-ttu-id="03320-285">ricerca toosave per gli eventi, è possibile utilizzare hello in base al ruolo Server di accesso e criteri di rete visualizzazione personalizzata nel Visualizzatore eventi, come illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="03320-285">toosave time searching for events, you can use hello role-based Network Policy and Access Server custom view in Event Viewer, as show below.</span></span> <span data-ttu-id="03320-286">ID evento 6273 indica gli eventi in cui hello Server dei criteri di rete negato l'accesso utente tooa.</span><span class="sxs-lookup"><span data-stu-id="03320-286">Event ID 6273 indicates events where hello Network Policy Server denied access tooa user.</span></span> 

 ![Aprire il Visualizzatore eventi](./media/nps-extension-vpn/image22.png)
 
## <a name="configure-multi-factor-authentication"></a><span data-ttu-id="03320-288">Configurare Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="03320-288">Configure Multi-Factor Authentication</span></span>
<span data-ttu-id="03320-289">Questa sezione fornisce istruzioni per abilitare gli utenti per MFA e configurare gli account per la verifica in due passaggi.</span><span class="sxs-lookup"><span data-stu-id="03320-289">This section provides instructions for enabling users for MFA and for setting up accounts for two-step verification.</span></span> 

### <a name="enable-multi-factor-authentication"></a><span data-ttu-id="03320-290">Abilitare Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="03320-290">Enable multi-factor authentication</span></span>
<span data-ttu-id="03320-291">In questa sezione si abilitano gli account Azure AD per MFA.</span><span class="sxs-lookup"><span data-stu-id="03320-291">In this section, you enable Azure AD accounts for MFA.</span></span> <span data-ttu-id="03320-292">Hello utilizzare **portale classico** tooenable utenti per l'autenticazione a più fattori.</span><span class="sxs-lookup"><span data-stu-id="03320-292">Use hello **classic portal** tooenable users for MFA.</span></span> 

1. <span data-ttu-id="03320-293">Aprire un browser e passare troppo[https://manage.windowsazure.com](https://manage.windowsazure.com).</span><span class="sxs-lookup"><span data-stu-id="03320-293">Open a browser, and navigate too[https://manage.windowsazure.com](https://manage.windowsazure.com).</span></span> 
2. <span data-ttu-id="03320-294">Accedere come amministratore hello.</span><span class="sxs-lookup"><span data-stu-id="03320-294">Log on as hello administrator.</span></span>
3. <span data-ttu-id="03320-295">Nel portale hello spostamento a sinistra di hello, fare clic su **ACTIVE DIRECTORY**.</span><span class="sxs-lookup"><span data-stu-id="03320-295">In hello portal, in hello left navigation, click **ACTIVE DIRECTORY**.</span></span>

 ![Directory predefinita](./media/nps-extension-vpn/image23.png)

4. <span data-ttu-id="03320-297">Nella colonna nome hello, fare clic su **Directory predefinita** (o un'altra directory, se appropriato).</span><span class="sxs-lookup"><span data-stu-id="03320-297">In hello NAME column, click **Default Directory** (or another directory, if appropriate).</span></span>
5. <span data-ttu-id="03320-298">Nella pagina introduttiva hello, fare clic su **configura**.</span><span class="sxs-lookup"><span data-stu-id="03320-298">On hello Quick Start page, click **Configure**.</span></span>

 ![Impostazioni predefinite di configurazione](./media/nps-extension-vpn/image24.png)

6. <span data-ttu-id="03320-300">Nella pagina Configura hello, scorrere verso il basso e, nella sezione di hello multi-factor authentication, fare clic su **Gestisci impostazioni servizio**.</span><span class="sxs-lookup"><span data-stu-id="03320-300">On hello CONFIGURE page, scroll down and, in hello multi-factor authentication section, click **Manage service settings**.</span></span>

 ![Gestire le impostazioni MFA](./media/nps-extension-vpn/image25.png)
 
7. <span data-ttu-id="03320-302">Nella pagina di multi-factor authentication hello, rivedere le impostazioni di servizio predefinito hello e quindi fare clic su **utenti**.</span><span class="sxs-lookup"><span data-stu-id="03320-302">On hello multi-factor authentication page, review hello default service settings, and then click **Users**.</span></span> 

 ![Utenti MFA](./media/nps-extension-vpn/image26.png)
 
8. <span data-ttu-id="03320-304">Nella pagina utenti hello, selezionare gli utenti di hello che desidera tooenable per l'autenticazione a più fattori e quindi fare clic su **abilitare**.</span><span class="sxs-lookup"><span data-stu-id="03320-304">On hello Users page, select hello users that you wish tooenable for MFA, and then click **Enable**.</span></span>

 ![Proprietà](./media/nps-extension-vpn/image27.png)
 
9. <span data-ttu-id="03320-306">Quando viene chiesto, fare clic su **Abilita Multi-Factor Auth**.</span><span class="sxs-lookup"><span data-stu-id="03320-306">When prompted, click **Enable multi-factor auth**.</span></span>

 ![Abilitare MFA](./media/nps-extension-vpn/image28.png)
 
10. <span data-ttu-id="03320-308">Fare clic su **Close**.</span><span class="sxs-lookup"><span data-stu-id="03320-308">Click **Close**.</span></span> 
11. <span data-ttu-id="03320-309">Aggiornare la pagina hello.</span><span class="sxs-lookup"><span data-stu-id="03320-309">Refresh hello page.</span></span> <span data-ttu-id="03320-310">lo stato di autenticazione a più fattori Hello è tooEnabled modificato.</span><span class="sxs-lookup"><span data-stu-id="03320-310">hello MFA status is changed tooEnabled.</span></span>

<span data-ttu-id="03320-311">Per informazioni su come gli utenti tooenable multi-Factor Authentication, vedere [Introduzione ad Azure multi-Factor Authentication nel cloud hello](multi-factor-authentication-get-started-cloud.md).</span><span class="sxs-lookup"><span data-stu-id="03320-311">For information on how tooenable users for Multi-Factor Authentication, see [Getting started with Azure Multi-Factor Authentication in hello cloud](multi-factor-authentication-get-started-cloud.md).</span></span> 

### <a name="configure-accounts-for-two-step-verification"></a><span data-ttu-id="03320-312">Configurare gli account per la verifica in due passaggi</span><span class="sxs-lookup"><span data-stu-id="03320-312">Configure accounts for two-step verification</span></span>
<span data-ttu-id="03320-313">Una volta che un account è stato abilitato per l'autenticazione a più fattori, gli utenti non sono in grado di toosign in tooresources governato dai criteri di autenticazione a più fattori hello fino a quando non sono correttamente configurati toouse un dispositivo attendibile per hello secondo fattore di autenticazione con utilizzato verifica in due passaggi.</span><span class="sxs-lookup"><span data-stu-id="03320-313">Once an account has been enabled for MFA, users are not able toosign in tooresources governed by hello MFA policy until they have successfully configured a trusted device toouse for hello second authentication factor having used two-step verification.</span></span>

<span data-ttu-id="03320-314">In questa sezione si configura un dispositivo attendibile per l'uso con la verifica in due passaggi.</span><span class="sxs-lookup"><span data-stu-id="03320-314">In this section, you configure a trusted device for use with two-step verification.</span></span> <span data-ttu-id="03320-315">Sono disponibili diverse opzioni disponibili per si tooconfigure queste operazioni, tra cui hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="03320-315">There are several options available for you tooconfigure these, including hello following:</span></span>

* <span data-ttu-id="03320-316">**App per dispositivi mobili**.</span><span class="sxs-lookup"><span data-stu-id="03320-316">**Mobile app**.</span></span> <span data-ttu-id="03320-317">Installare l'app Microsoft Authenticator hello in un dispositivo Windows Phone, Android o iOS.</span><span class="sxs-lookup"><span data-stu-id="03320-317">You install hello Microsoft Authenticator app on a Windows Phone, Android, or iOS device.</span></span> <span data-ttu-id="03320-318">A seconda dell'organizzazione, si è applicazione hello toouse richiesto in una delle due modalità: ricevere notifiche per le verifiche (una notifica viene inserita il dispositivo tooyour) o usare il codice di verifica (necessario tooenter una verifica del codice che Aggiorna ogni 30 secondi).</span><span class="sxs-lookup"><span data-stu-id="03320-318">Depending on your organization’s policies, you are required toouse hello app in one of two modes: Receive notifications for verifications (a notification is pushed tooyour device) or Use verification code (you are required tooenter a verification code that updates every 30 seconds).</span></span> 
* <span data-ttu-id="03320-319">**Chiamata o SMS sul telefono cellulare**.</span><span class="sxs-lookup"><span data-stu-id="03320-319">**Mobile phone call or text**.</span></span> <span data-ttu-id="03320-320">È possibile ricevere una chiamata o un SMS automatico.</span><span class="sxs-lookup"><span data-stu-id="03320-320">You can either receive an automated phone call or text message.</span></span> <span data-ttu-id="03320-321">Con l'opzione di chiamata telefonica hello, si risposta chiamata hello e si preme hello # sign tooauthenticate.</span><span class="sxs-lookup"><span data-stu-id="03320-321">With hello phone call option, you answer hello call and press hello # sign tooauthenticate.</span></span> <span data-ttu-id="03320-322">Con l'opzione testo hello, è possibile rispondere toohello SMS o immettere il codice di verifica hello hello sign nell'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="03320-322">With hello text option, you can either reply toohello text message or enter hello verification code into hello sign-in interface.</span></span>
* <span data-ttu-id="03320-323">**Chiamata al telefono dell'ufficio**.</span><span class="sxs-lookup"><span data-stu-id="03320-323">**Office phone call**.</span></span> <span data-ttu-id="03320-324">Questo processo è hello corrisponde a quello descritto per telefonate automatizzate precedente.</span><span class="sxs-lookup"><span data-stu-id="03320-324">This process is hello same as that described for automated phone calls above.</span></span>

<span data-ttu-id="03320-325">Seguire queste istruzioni per la configurazione di una notifica push tooreceive di dispositivo toouse hello app per dispositivi mobili per la verifica.</span><span class="sxs-lookup"><span data-stu-id="03320-325">Follow these instructions for setting up a device toouse hello mobile app tooreceive push notification for verification.</span></span>

1. <span data-ttu-id="03320-326">Accesso troppo[https://aka.ms/mfasetup](https://aka.ms/mfasetup) o in qualsiasi sito, ad esempio [https://portal.azure.com](https://portal.azure.com), in cui è necessario tooauthenticate utilizzando le credenziali di autenticazione a più fattori abilitata.</span><span class="sxs-lookup"><span data-stu-id="03320-326">Log on too[https://aka.ms/mfasetup](https://aka.ms/mfasetup) or any site, such as [https://portal.azure.com](https://portal.azure.com), where you required tooauthenticate using your MFA-enabled credentials.</span></span> 
2. <span data-ttu-id="03320-327">Durante l'accesso con il nome utente e password, viene visualizzata una schermata che richiede tooset account hello per verifica aggiuntiva di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="03320-327">Upon signing in with your username and password, you are presented with a screen that prompts you tooset up hello account for additional security verification.</span></span>

 ![Sicurezza aggiuntiva](./media/nps-extension-vpn/image29.png)

3. <span data-ttu-id="03320-329">Fare clic su **Imposta ora**.</span><span class="sxs-lookup"><span data-stu-id="03320-329">Click **Set it up now**.</span></span>
4. <span data-ttu-id="03320-330">Nella pagina verifica aggiuntiva di sicurezza di hello, selezionare un tipo di contatto (telefono per l'autenticazione, telefono dell'ufficio o app per dispositivi mobili).</span><span class="sxs-lookup"><span data-stu-id="03320-330">On hello Additional security verification page, select a contact type (authentication phone, office phone, or mobile app).</span></span> <span data-ttu-id="03320-331">Selezionare quindi un paese o un'area geografica e un metodo.</span><span class="sxs-lookup"><span data-stu-id="03320-331">Then select a country or region, and select a method.</span></span> <span data-ttu-id="03320-332">metodo Hello varia in base al tipo di contatto selezionato.</span><span class="sxs-lookup"><span data-stu-id="03320-332">hello method varies by contact type you select.</span></span> <span data-ttu-id="03320-333">Ad esempio, se si sceglie di app per dispositivi mobili, è possibile selezionare se le notifiche di tooreceive per verificare o toouse un codice di verifica.</span><span class="sxs-lookup"><span data-stu-id="03320-333">For example, if you choose Mobile app, you can select whether tooreceive notifications for verification or toouse a verification code.</span></span> <span data-ttu-id="03320-334">passaggi di Hello che seguono si supponga di scegliere **app per dispositivi mobili** come hello tipo di contatto.</span><span class="sxs-lookup"><span data-stu-id="03320-334">hello steps that follow assume you choose **Mobile app** as hello contact type.</span></span>

 ![Autenticazione tramite telefono](./media/nps-extension-vpn/image30.png)

5. <span data-ttu-id="03320-336">Selezionare App per dispositivi mobili, fare clic su **Ricevi notifiche per la verifica** e quindi su **Imposta**.</span><span class="sxs-lookup"><span data-stu-id="03320-336">Select Mobile app, click **Receive notifications for verification**, and then **Set up**.</span></span> 

 ![Verifica tramite app per dispositivi mobili](./media/nps-extension-vpn/image31.png)
 
6. <span data-ttu-id="03320-338">Se non è già fatto, installare l'app per dispositivi mobili autenticatore hello sul dispositivo.</span><span class="sxs-lookup"><span data-stu-id="03320-338">If you haven’t done so already, install hello authenticator mobile app on your device.</span></span> 
7. <span data-ttu-id="03320-339">Seguire le istruzioni hello hello app per dispositivi mobili tooscan hello presentato codice a barre o immettere manualmente le informazioni di hello e quindi fare clic su **eseguita**.</span><span class="sxs-lookup"><span data-stu-id="03320-339">Follow hello instructions in hello mobile app tooscan hello presented bar code or enter hello information manually, and then click **Done**.</span></span>

 ![Configurare l'app per dispositivi mobili](./media/nps-extension-vpn/image32.png)

8. <span data-ttu-id="03320-341">Nella pagina verifica aggiuntiva di sicurezza di hello, fare clic su **Contact me** e risposta toonotification inviati tooyour dispositivo.</span><span class="sxs-lookup"><span data-stu-id="03320-341">On hello Additional security verification page, click **Contact me** and reply toonotification sent tooyour device.</span></span>
9. <span data-ttu-id="03320-342">Nella pagina verifica aggiuntiva di sicurezza di hello, immettere un numero di contatto nel caso in cui si perde l'accesso toohello app per dispositivi mobili e fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="03320-342">On hello Additional security verification page, enter a contact number in case you lose access toohello mobile app, and click **Next**.</span></span>

 ![Numero del telefono cellulare](./media/nps-extension-vpn/image33.png)
 
10. <span data-ttu-id="03320-344">In hello verifica aggiuntiva di sicurezza, fare clic su **eseguita**.</span><span class="sxs-lookup"><span data-stu-id="03320-344">On hello Additional security verification, click **Done**.</span></span>

<span data-ttu-id="03320-345">dispositivo Hello è ora configurato tooprovide un secondo metodo di verifica.</span><span class="sxs-lookup"><span data-stu-id="03320-345">hello device is now configured tooprovide a second method of verification.</span></span> <span data-ttu-id="03320-346">Per informazioni sull'impostazione degli account per la verifica in due passaggi, vedere [Configurare l'account per la verifica in due passaggi](./end-user/multi-factor-authentication-end-user-first-time.md).</span><span class="sxs-lookup"><span data-stu-id="03320-346">For information on setting up accounts for two-step verification, see [Set up my account for two-step verification](./end-user/multi-factor-authentication-end-user-first-time.md).</span></span>

## <a name="install-and-configure-nps-extension"></a><span data-ttu-id="03320-347">Installare e configurare l'estensione NPS</span><span class="sxs-lookup"><span data-stu-id="03320-347">Install and configure NPS extension</span></span>

<span data-ttu-id="03320-348">In questa sezione vengono fornite istruzioni per la configurazione VPN toouse Azure MFA per l'autenticazione client con hello Server VPN.</span><span class="sxs-lookup"><span data-stu-id="03320-348">This section provides instructions for configuring VPN toouse Azure MFA for client authentication with hello VPN Server.</span></span>

<span data-ttu-id="03320-349">Quando si installa e configura l'estensione dei criteri di rete hello, tutti l'autenticazione client basata su RADIUS che viene elaborato da questo server è necessario toouse Azure MFA.</span><span class="sxs-lookup"><span data-stu-id="03320-349">Once you install and configure hello NPS extension, all RADIUS-based client authentication that is processed by this server is required toouse Azure MFA.</span></span> <span data-ttu-id="03320-350">Se non tutti gli utenti VPN sono registrati in Azure MFA, è possibile impostare gli utenti di tooauthenticate un altro server RADIUS che non sono configurati toouse autenticazione a più fattori.</span><span class="sxs-lookup"><span data-stu-id="03320-350">If not all your VPN users are enrolled in Azure MFA, you can set up another RADIUS server tooauthenticate users who are not configured toouse MFA.</span></span> <span data-ttu-id="03320-351">Oppure è possibile creare una voce del Registro di sistema che consente agli utenti citata tooprovide secondo fattore di autenticazione, solo se sono registrati nell'autenticazione a più fattori.</span><span class="sxs-lookup"><span data-stu-id="03320-351">Or you can create a registry entry that allows challenged users tooprovide a second authentication factor, only if they are enrolled in MFA.</span></span> 

<span data-ttu-id="03320-352">Creare un nuovo valore stringa denominato _REQUIRE_USER_MATCH in HKLM\SOFTWARE\Microsoft\AzureMfa_e impostare tooTRUE valore hello o FALSE.</span><span class="sxs-lookup"><span data-stu-id="03320-352">Create a new string value named _REQUIRE_USER_MATCH in HKLM\SOFTWARE\Microsoft\AzureMfa_, and set hello value tooTRUE or FALSE.</span></span> 

 ![Richiesta della corrispondenza utente](./media/nps-extension-vpn/image34.png)
 
<span data-ttu-id="03320-354">Se il valore di hello è set tooTRUE o non è impostata, tutte le richieste di autenticazione sono richiesta di autenticazione a più fattori tooan soggetto.</span><span class="sxs-lookup"><span data-stu-id="03320-354">If hello value is set tooTRUE or not set, all authentication requests are subject tooan MFA challenge.</span></span> <span data-ttu-id="03320-355">Se il valore di hello è impostato tooFALSE, problemi di autenticazione a più fattori vengono rilasciati solo toousers registrati in autenticazione a più fattori.</span><span class="sxs-lookup"><span data-stu-id="03320-355">If hello value is set tooFALSE, MFA challenges are issued only toousers that are enrolled in MFA.</span></span> <span data-ttu-id="03320-356">Utilizzare solo hello impostazione FALSE durante il testing o in ambienti di produzione durante un periodo di tempo di caricamento.</span><span class="sxs-lookup"><span data-stu-id="03320-356">Only use hello FALSE setting in testing or in production environments during an onboarding period.</span></span>

### <a name="acquire-azure-active-directory-guid-id"></a><span data-ttu-id="03320-357">Acquisire l'ID GUID di Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="03320-357">Acquire Azure Active Directory GUID ID</span></span>

<span data-ttu-id="03320-358">Come parte della configurazione di hello di hello estensione dei criteri di rete, è necessario toosupply credenziali di amministratore e hello ID Azure Active Directory per il tenant di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="03320-358">As part of hello configuration of hello NPS extension, you need toosupply admin credentials and hello Azure Active Directory ID for your Azure AD tenant.</span></span> <span data-ttu-id="03320-359">Hello passaggi riportata di seguito viene illustrato come tooget hello ID del tenant.</span><span class="sxs-lookup"><span data-stu-id="03320-359">hello steps below show you how tooget hello tenant ID.</span></span>

1. <span data-ttu-id="03320-360">Accedere al portale di Azure toohello [https://portal.azure.com](https://portal.azure.com) come amministratore globale di hello di hello Azure tenant.</span><span class="sxs-lookup"><span data-stu-id="03320-360">Sign in toohello Azure portal at [https://portal.azure.com](https://portal.azure.com) as hello global administrator of hello Azure tenant.</span></span>
2. <span data-ttu-id="03320-361">Nel riquadro di spostamento sinistro di hello, fare clic su hello **Azure Active Directory** icona.</span><span class="sxs-lookup"><span data-stu-id="03320-361">In hello left navigation, click hello **Azure Active Directory** icon.</span></span>
3. <span data-ttu-id="03320-362">Fare clic su **Proprietà**.</span><span class="sxs-lookup"><span data-stu-id="03320-362">Click **Properties**.</span></span>
4. <span data-ttu-id="03320-363">toocopy gli Appunti toohello ID di Directory, seleziona hello **copia** icona.</span><span class="sxs-lookup"><span data-stu-id="03320-363">toocopy your Directory ID toohello clipboard, select hello **Copy** icon.</span></span>
 
 ![ID directory](./media/nps-extension-vpn/image35.png)

### <a name="install-hello-nps-extension"></a><span data-ttu-id="03320-365">Installare l'estensione dei criteri di rete hello</span><span class="sxs-lookup"><span data-stu-id="03320-365">Install hello NPS extension</span></span>
<span data-ttu-id="03320-366">Hello estensione dei criteri di rete deve toobe installato in un server con criteri di rete hello e installato il ruolo Servizi di accesso (NPS) e che funzioni come server RADIUS hello nella progettazione.</span><span class="sxs-lookup"><span data-stu-id="03320-366">hello NPS extension needs toobe installed on a server that has hello Network Policy and Access Services (NPS) role installed and that functions as hello RADIUS server in your design.</span></span> <span data-ttu-id="03320-367">Non installare l'estensione dei criteri di rete hello sul Server di Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="03320-367">Don't install hello NPS extension on your Remote Desktop Server.</span></span>

1. <span data-ttu-id="03320-368">Scaricare l'estensione dei criteri di rete hello da [https://aka.ms/npsmfa](https://aka.ms/npsmfa).</span><span class="sxs-lookup"><span data-stu-id="03320-368">Download hello NPS extension from [https://aka.ms/npsmfa](https://aka.ms/npsmfa).</span></span> 
2. <span data-ttu-id="03320-369">Copia hello il programma di installazione eseguibile (NpsExtnForAzureMfaInstaller.exe) toohello server NPS.</span><span class="sxs-lookup"><span data-stu-id="03320-369">Copy hello setup executable file (NpsExtnForAzureMfaInstaller.exe) toohello NPS server.</span></span>
3. <span data-ttu-id="03320-370">Nel server dei criteri di rete hello, fare doppio clic su **NpsExtnForAzureMfaInstaller.exe**.</span><span class="sxs-lookup"><span data-stu-id="03320-370">On hello NPS server, double-click **NpsExtnForAzureMfaInstaller.exe**.</span></span> <span data-ttu-id="03320-371">Se richiesto, fare clic su **Esegui**.</span><span class="sxs-lookup"><span data-stu-id="03320-371">If prompted, click **Run**.</span></span>
4. <span data-ttu-id="03320-372">In hello estensione dei criteri di rete per la finestra di dialogo di autenticazione a più fattori di Azure, esaminare condizioni di licenza software hello controllare **accetto toohello condizioni di licenza**, fare clic su **installare**.</span><span class="sxs-lookup"><span data-stu-id="03320-372">In hello NPS Extension for Azure MFA dialog box, review hello software license terms, check **I agree toohello license terms and conditions**, and click **Install**.</span></span>

 ![Estensione NPS](./media/nps-extension-vpn/image36.png)
 
5. <span data-ttu-id="03320-374">In hello estensione dei criteri di rete per la finestra di dialogo di autenticazione a più fattori di Azure, fare clic su **Chiudi**.</span><span class="sxs-lookup"><span data-stu-id="03320-374">In hello NPS Extension for Azure MFA dialog box, click **Close**.</span></span>  

 ![Installazione completata](./media/nps-extension-vpn/image37.png) 
 
### <a name="configure-certificates-for-use-with-hello-nps-extension-using-a-powershell-script"></a><span data-ttu-id="03320-376">Configurare i certificati per l'utilizzo con l'estensione dei criteri di rete hello tramite uno script di PowerShell</span><span class="sxs-lookup"><span data-stu-id="03320-376">Configure certificates for use with hello NPS extension using a PowerShell script</span></span>
<span data-ttu-id="03320-377">comunicazioni protette tooensure e la garanzia, è necessario tooconfigure certificati per l'utilizzo dall'estensione dei criteri di rete hello.</span><span class="sxs-lookup"><span data-stu-id="03320-377">tooensure secure communications and assurance, you need tooconfigure certificates for use by hello NPS extension.</span></span> <span data-ttu-id="03320-378">i componenti dei criteri di rete di Hello includono uno script di Windows PowerShell che configura un certificato autofirmato per l'utilizzo con criteri di rete.</span><span class="sxs-lookup"><span data-stu-id="03320-378">hello NPS components include a Windows PowerShell script that configures a self-signed certificate for use with NPS.</span></span> 

<span data-ttu-id="03320-379">lo script di Hello esegue hello seguenti azioni:</span><span class="sxs-lookup"><span data-stu-id="03320-379">hello script performs hello following actions:</span></span>

* <span data-ttu-id="03320-380">Crea un certificato autofirmato</span><span class="sxs-lookup"><span data-stu-id="03320-380">Creates a self-signed certificate</span></span>
* <span data-ttu-id="03320-381">Associa una chiave pubblica del certificato tooservice principale in Azure AD</span><span class="sxs-lookup"><span data-stu-id="03320-381">Associates public key of certificate tooservice principal on Azure AD</span></span>
* <span data-ttu-id="03320-382">Archivi hello certificato nell'archivio computer locale hello</span><span class="sxs-lookup"><span data-stu-id="03320-382">Stores hello cert in hello local machine store</span></span>
* <span data-ttu-id="03320-383">Concede l'accesso toohello chiave privata del certificato toohello utente di rete</span><span class="sxs-lookup"><span data-stu-id="03320-383">Grants access toohello certificate’s private key toohello Network User</span></span>
* <span data-ttu-id="03320-384">Riavvia il servizio Server dei criteri di rete</span><span class="sxs-lookup"><span data-stu-id="03320-384">Restarts Network Policy Server service</span></span>

<span data-ttu-id="03320-385">Se si desidera toouse i propri certificati, è necessario tooassociate hello pubblico del principio di servizio toohello certificato in Azure AD e così via.</span><span class="sxs-lookup"><span data-stu-id="03320-385">If you want toouse your own certificates, you need tooassociate hello public of your certificate toohello service principle on Azure AD, and so on.</span></span>
<span data-ttu-id="03320-386">script di hello toouse, fornire le credenziali amministrative di Azure Active Directory estensione hello e hello ID tenant di Azure Active Directory è stato copiato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="03320-386">toouse hello script, provide hello extension with your Azure Active Directory administrative credentials and hello Azure Active Directory tenant ID you copied earlier.</span></span> <span data-ttu-id="03320-387">Eseguire script hello in ogni server dei criteri di rete in cui si installa l'estensione dei criteri di rete hello.</span><span class="sxs-lookup"><span data-stu-id="03320-387">Run hello script on each NPS server where you install hello NPS extension.</span></span>

1. <span data-ttu-id="03320-388">Aprire un prompt di Windows PowerShell come amministratore.</span><span class="sxs-lookup"><span data-stu-id="03320-388">Open an administrative Windows PowerShell prompt.</span></span>
2. <span data-ttu-id="03320-389">Al prompt di PowerShell hello digitare _cd 'c:\Programmi\Microsoft Files\Microsoft\AzureMfa\Config'_e premere **invio**.</span><span class="sxs-lookup"><span data-stu-id="03320-389">At hello PowerShell prompt, type _cd ‘c:\Program Files\Microsoft\AzureMfa\Config’_, and press **ENTER**.</span></span>
3. <span data-ttu-id="03320-390">Digitare _.\AzureMfsNpsExtnConfigSetup.ps1_ e premere **INVIO**.</span><span class="sxs-lookup"><span data-stu-id="03320-390">Type _.\AzureMfsNpsExtnConfigSetup.ps1_, and press **ENTER**.</span></span> 
 * <span data-ttu-id="03320-391">script Hello controlla toosee se è installato il modulo di Azure Active Directory PowerShell hello.</span><span class="sxs-lookup"><span data-stu-id="03320-391">hello script checks toosee if hello Azure Active Directory PowerShell module is installed.</span></span> <span data-ttu-id="03320-392">Se non è installato, script hello verrà installato il modulo hello.</span><span class="sxs-lookup"><span data-stu-id="03320-392">If it is not installed, hello script installs hello module for you.</span></span>
 
 ![PowerShell](./media/nps-extension-vpn/image38.png)
 
4. <span data-ttu-id="03320-394">Al termine dello script hello verifica installazione hello del modulo di PowerShell hello, Visualizza la finestra di dialogo modulo di Azure Active Directory PowerShell hello.</span><span class="sxs-lookup"><span data-stu-id="03320-394">After hello script verifies hello installation of hello PowerShell module, it displays hello Azure Active Directory PowerShell module dialog box.</span></span> <span data-ttu-id="03320-395">Nella finestra di dialogo hello, immettere le credenziali di amministratore di Azure AD e la password e fare clic su **Accedi**.</span><span class="sxs-lookup"><span data-stu-id="03320-395">In hello dialog box, enter your Azure AD admin credentials and password, and click **Sign in**.</span></span> 
 
 ![Accesso a PowerShell](./media/nps-extension-vpn/image39.png)
 
5. <span data-ttu-id="03320-397">Quando richiesto, incollare l'ID tenant hello copiato negli Appunti toohello in precedenza e premere **invio**.</span><span class="sxs-lookup"><span data-stu-id="03320-397">When prompted, paste hello tenant ID you copied toohello clipboard earlier, and press **ENTER**.</span></span> 

 ![ID tenant](./media/nps-extension-vpn/image40.png)

6. <span data-ttu-id="03320-399">script Hello crea un certificato autofirmato ed esegue altre modifiche alla configurazione.</span><span class="sxs-lookup"><span data-stu-id="03320-399">hello script creates a self-signed certificate and performs other configuration changes.</span></span> <span data-ttu-id="03320-400">output di Hello è come immagine di hello illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="03320-400">hello output is like hello image shown below.</span></span>

 ![Certificato autofirmato](./media/nps-extension-vpn/image41.png)

7. <span data-ttu-id="03320-402">Riavviare il server di hello.</span><span class="sxs-lookup"><span data-stu-id="03320-402">Reboot hello server.</span></span>
 
### <a name="verify-configuration"></a><span data-ttu-id="03320-403">Verificare la configurazione</span><span class="sxs-lookup"><span data-stu-id="03320-403">Verify configuration</span></span>
<span data-ttu-id="03320-404">configurazione di hello tooverify, è necessario tooestablish una nuova connessione VPN con server VPN.</span><span class="sxs-lookup"><span data-stu-id="03320-404">tooverify hello configuration, you need tooestablish a new VPN connection with VPN server.</span></span> <span data-ttu-id="03320-405">Durante l'immissione correttamente le credenziali per l'autenticazione principale, hello connessione VPN attende hello autenticazione secondaria toosucceed prima che venga stabilita connessione hello, come illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="03320-405">Upon successfully entering your credentials for primary authentication, hello VPN connection waits for hello secondary authentication toosucceed before hello connection is established, as shown below.</span></span> 

 ![Verificare la configurazione](./media/nps-extension-vpn/image42.png)

<span data-ttu-id="03320-407">Se si autentica correttamente con il metodo di verifica secondaria hello configurati in precedenza in Azure MFA, si è connesso toohello risorse.</span><span class="sxs-lookup"><span data-stu-id="03320-407">If you successfully authenticate with hello secondary verification method you previously configured in Azure MFA, you are connected toohello resource.</span></span> <span data-ttu-id="03320-408">Tuttavia, se l'autenticazione secondaria hello non ha esito positivo, è stato negato tooresource di accesso.</span><span class="sxs-lookup"><span data-stu-id="03320-408">However, if hello secondary authentication is not successful, you are denied access tooresource.</span></span> 

<span data-ttu-id="03320-409">Nell'esempio riportato di seguito, hello autenticatore hello app su un dispositivo Windows phone è l'autenticazione secondaria hello tooprovide utilizzato.</span><span class="sxs-lookup"><span data-stu-id="03320-409">In hello example below, hello Authenticator app on a Windows phone is used tooprovide hello secondary authentication.</span></span>

 ![Verificare l'account](./media/nps-extension-vpn/image43.png)

<span data-ttu-id="03320-411">Dopo aver eseguito l'autenticazione con metodo secondario hello, sono concesse porta virtuale di accesso toohello sul server VPN hello.</span><span class="sxs-lookup"><span data-stu-id="03320-411">Once you have successfully authenticated using hello secondary method, you are granted access toohello virtual port on hello VPN server.</span></span> <span data-ttu-id="03320-412">Tuttavia, poiché è stato richiesto toouse un metodo di autenticazione secondaria usando un'app per dispositivi mobili in un dispositivo attendibile, hello log nel processo è più sicuro sarebbero utilizzando solo un nome utente o la combinazione di password.</span><span class="sxs-lookup"><span data-stu-id="03320-412">However, because you were required toouse a secondary authentication method using a mobile app on a trusted device, hello log in process is more secure than it would be using only a username / password combination.</span></span>

### <a name="view-event-viewer-logs-for-successful-logon-events"></a><span data-ttu-id="03320-413">Visualizzare i log del Visualizzatore eventi per individuare gli eventi di accesso riusciti</span><span class="sxs-lookup"><span data-stu-id="03320-413">View Event Viewer logs for successful logon events</span></span>
<span data-ttu-id="03320-414">eventi di accesso riusciti tooview hello nei log di Visualizzatore eventi di Windows hello, è possibile emettere hello segue registro protezione di Windows nel server dei criteri di rete hello Windows PowerShell comando tooquery hello.</span><span class="sxs-lookup"><span data-stu-id="03320-414">tooview hello successful logon events in hello Windows Event Viewer logs, you can issue hello following Windows PowerShell command tooquery hello Windows Security log on hello NPS server.</span></span>

<span data-ttu-id="03320-415">eventi di accesso riusciti tooquery nei registri di Visualizzatore eventi di sicurezza hello, utilizzare hello seguente comando,</span><span class="sxs-lookup"><span data-stu-id="03320-415">tooquery successful logon events in hello Security event viewer logs, use hello following command,</span></span>
* <span data-ttu-id="03320-416">_Get-WinEvent -Logname Security_ | where {$_.ID -eq '6272'} | FL</span><span class="sxs-lookup"><span data-stu-id="03320-416">_Get-WinEvent -Logname Security_ | where {$_.ID -eq '6272'} | FL</span></span> 

 ![Visualizzatore eventi di sicurezza](./media/nps-extension-vpn/image44.png)
 
<span data-ttu-id="03320-418">È inoltre possibile visualizzare il Registro di protezione hello o hello servizi di accesso e criteri di rete visualizzazione personalizzata, come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="03320-418">You can also view hello Security log or hello Network Policy and Access Services custom view, as shown below:</span></span>

 ![Accesso ai criteri di rete](./media/nps-extension-vpn/image45.png)

<span data-ttu-id="03320-420">Nel server di hello in cui è installato l'estensione dei criteri di rete hello per Azure MFA, è possibile trovare i registri applicazione Visualizzatore eventi estensione toohello specifico in **applicazioni e servizi Logs\Microsoft\AzureMfa**.</span><span class="sxs-lookup"><span data-stu-id="03320-420">On hello server where you installed hello NPS extension for Azure MFA, you can find Event Viewer application logs specific toohello extension at **Application and Services Logs\Microsoft\AzureMfa**.</span></span> 

* <span data-ttu-id="03320-421">_Get-WinEvent -Logname Security_ | where {$_.ID -eq '6272'} | FL</span><span class="sxs-lookup"><span data-stu-id="03320-421">_Get-WinEvent -Logname Security_ | where {$_.ID -eq '6272'} | FL</span></span>

 ![Numero di eventi](./media/nps-extension-vpn/image46.png)

## <a name="troubleshoot-guide"></a><span data-ttu-id="03320-423">Guida per la risoluzione dei problemi</span><span class="sxs-lookup"><span data-stu-id="03320-423">Troubleshoot Guide</span></span>
<span data-ttu-id="03320-424">Se la configurazione hello non funziona come previsto, tootroubleshoot di toostart un ottimo strumento è tooverify che hello utente è configurato toouse Azure MFA.</span><span class="sxs-lookup"><span data-stu-id="03320-424">If hello configuration is not working as expected, a good place toostart tootroubleshoot is tooverify that hello user is configured toouse Azure MFA.</span></span> <span data-ttu-id="03320-425">Avere utente hello connettersi troppo[https://portal.azure.com](https://portal.azure.com). Se viene richiesta l'autenticazione secondaria ed possibile eseguire l'autenticazione, la configurazione di Azure MFA è corretta.</span><span class="sxs-lookup"><span data-stu-id="03320-425">Have hello user connect too[https://portal.azure.com](https://portal.azure.com). If they are prompted for secondary authentication and can successfully authenticate, you can eliminate an incorrect configuration of Azure MFA.</span></span>

<span data-ttu-id="03320-426">Se l'autenticazione a più fattori di Azure funziona per gli utenti di hello, esaminare i registri eventi rilevanti hello.</span><span class="sxs-lookup"><span data-stu-id="03320-426">If Azure MFA is working for hello user(s), you should review hello relevant Event logs.</span></span> <span data-ttu-id="03320-427">Sono inclusi i registri eventi di protezione, Gateway è operativo e Azure MFA hello discussi sono trattati nella sezione precedente hello.</span><span class="sxs-lookup"><span data-stu-id="03320-427">These include hello Security Event, Gateway operational, and Azure MFA logs that are discussed in hello previous section.</span></span> 

<span data-ttu-id="03320-428">Di seguito è illustrato un esempio di output di un log di sicurezza che mostra un evento di accesso non riuscito (ID evento 6273):</span><span class="sxs-lookup"><span data-stu-id="03320-428">Below is an example output of Security log showing a failed logon event (Event ID 6273):</span></span>

 ![Log di sicurezza](./media/nps-extension-vpn/image47.png)

<span data-ttu-id="03320-430">Di seguito è un evento correlato dai registri AzureMFA hello:</span><span class="sxs-lookup"><span data-stu-id="03320-430">Below is a related event from hello AzureMFA logs:</span></span>

 ![Log di Azure MFA](./media/nps-extension-vpn/image48.png)

<span data-ttu-id="03320-432">tooperform avanzate di risoluzione dei problemi opzioni, consultare hello NPS formato file registro del database in cui è installato hello server NPS.</span><span class="sxs-lookup"><span data-stu-id="03320-432">tooperform advanced troubleshoot options, consult hello NPS database format log files where hello NPS service is installed.</span></span> <span data-ttu-id="03320-433">Questi file di log vengono creati nella cartella _%SystemRoot%\System32\Logs_ come file di testo con valori delimitati da virgole.</span><span class="sxs-lookup"><span data-stu-id="03320-433">These log files are created in _%SystemRoot%\System32\Logs_ folder as comma-delimited text files.</span></span> <span data-ttu-id="03320-434">Per una descrizione di questi file di log, vedere [Interpret NPS Database Format Log Files](https://technet.microsoft.com/library/cc771748.aspx) (Interpretare i file di log in formato database di Server dei criteri di rete).</span><span class="sxs-lookup"><span data-stu-id="03320-434">For a description of these log files, see [Interpret NPS Database Format Log Files](https://technet.microsoft.com/library/cc771748.aspx).</span></span> 

<span data-ttu-id="03320-435">le voci di Hello in questi file di log sono difficile toointerpret senza importarle in un foglio di calcolo o di un database.</span><span class="sxs-lookup"><span data-stu-id="03320-435">hello entries in these log files are difficult toointerpret without importing them into a spreadsheet or a database.</span></span> <span data-ttu-id="03320-436">È possibile trovare un numero di IAS parser online tooassist in interpretazione hello i file di log.</span><span class="sxs-lookup"><span data-stu-id="03320-436">You can find a number of IAS parsers online tooassist you in interpreting hello log files.</span></span> <span data-ttu-id="03320-437">Di seguito è l'output di hello di un tale scaricabile [applicazione shareware](http://www.deepsoftware.com/iasviewer):</span><span class="sxs-lookup"><span data-stu-id="03320-437">Below is hello output of one such downloadable [shareware application](http://www.deepsoftware.com/iasviewer):</span></span> 

 ![Applicazione shareware](./media/nps-extension-vpn/image49.png)

<span data-ttu-id="03320-439">Infine, per altre opzioni di risoluzione dei problemi, è possibile usare uno strumento di analisi di protocolli, ad esempio Wireshark o [Microsoft Message Analyzer](https://technet.microsoft.com/library/jj649776.aspx).</span><span class="sxs-lookup"><span data-stu-id="03320-439">Finally, for additional troubleshoot options, you can use a protocol analyzer such as Wireshark or [Microsoft Message Analyzer](https://technet.microsoft.com/library/jj649776.aspx).</span></span> <span data-ttu-id="03320-440">Hello Wireshark seguente immagine mostra i messaggi di RADIUS hello tra server VPN hello e server dei criteri di rete hello.</span><span class="sxs-lookup"><span data-stu-id="03320-440">hello following image from Wireshark shows hello RADIUS messages between hello VPN server and hello NPS server.</span></span>

 ![Microsoft Message Analyzer](./media/nps-extension-vpn/image50.png)

<span data-ttu-id="03320-442">Per altre informazioni, vedere [Integrare l'infrastruttura NPS esistente con Azure Multi-Factor Authentication](multi-factor-authentication-nps-extension.md).</span><span class="sxs-lookup"><span data-stu-id="03320-442">For more information, see [Integrate your existing NPS infrastructure with Azure Multi-Factor Authentication](multi-factor-authentication-nps-extension.md).</span></span>  

## <a name="next-steps"></a><span data-ttu-id="03320-443">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="03320-443">Next steps</span></span>
[<span data-ttu-id="03320-444">Come tooget Azure multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="03320-444">How tooget Azure Multi-Factor Authentication</span></span>](multi-factor-authentication-versions-plans.md)

[<span data-ttu-id="03320-445">Gateway Desktop remoto e server Azure Multi-Factor Authentication utilizzando RADIUS</span><span class="sxs-lookup"><span data-stu-id="03320-445">Remote Desktop Gateway and Azure Multi-Factor Authentication Server using RADIUS</span></span>](multi-factor-authentication-get-started-server-rdg.md)

[<span data-ttu-id="03320-446">Integrare le directory locali con Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="03320-446">Integrate your on-premises directories with Azure Active Directory</span></span>](../active-directory/connect/active-directory-aadconnect.md)

