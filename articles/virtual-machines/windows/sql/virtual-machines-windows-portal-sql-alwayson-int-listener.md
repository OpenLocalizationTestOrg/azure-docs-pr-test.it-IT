---
title: "Creare un listener per i gruppi di disponibilità di SQL Server nelle macchine virtuali di Azure | Microsoft Docs"
description: "Istruzioni dettagliate per creare un listener per un gruppo di disponibilità Always On per SQL Server nelle macchine virtuali di Azure"
services: virtual-machines
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: monicar
ms.assetid: d1f291e9-9af2-41ba-9d29-9541e3adcfcf
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/01/2017
ms.author: mikeray
ms.openlocfilehash: 09fed7e785708d4afe64905de973becc188181d7
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="configure-a-load-balancer-for-an-always-on-availability-group-in-azure"></a><span data-ttu-id="2d8ab-103">Configurare un servizio di bilanciamento del carico interno per un gruppo di disponibilità Always On in Azure</span><span class="sxs-lookup"><span data-stu-id="2d8ab-103">Configure a load balancer for an Always On availability group in Azure</span></span>
<span data-ttu-id="2d8ab-104">In questo articolo viene illustrato come creare un servizio di bilanciamento del carico per un gruppo di disponibilità SQL Server Always On nelle macchine virtuali in esecuzione con Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-104">This article explains how to create a load balancer for a SQL Server Always On availability group in Azure virtual machines that are running with Azure Resource Manager.</span></span> <span data-ttu-id="2d8ab-105">Un gruppo di disponibilità richiede un servizio di bilanciamento del carico quando le istanze di SQL Server sono in macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-105">An availability group requires a load balancer when the SQL Server instances are on Azure virtual machines.</span></span> <span data-ttu-id="2d8ab-106">Il servizio di bilanciamento del carico archivia l'indirizzo IP per il listener del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-106">The load balancer stores the IP address for the availability group listener.</span></span> <span data-ttu-id="2d8ab-107">Se un gruppo di disponibilità si estende su più aree, è necessario un servizio di bilanciamento del carico per ogni area.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-107">If an availability group spans multiple regions, each region needs a load balancer.</span></span>

<span data-ttu-id="2d8ab-108">Per completare questa attività, è necessario disporre di un gruppo di disponibilità di SQL Server distribuito nelle macchine virtuali di Azure in esecuzione con Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-108">To complete this task, you need to have a SQL Server availability group deployed on Azure virtual machines that are running with Resource Manager.</span></span> <span data-ttu-id="2d8ab-109">Entrambe le macchine virtuali di SQL Server devono appartenere allo stesso set di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-109">Both SQL Server virtual machines must belong to the same availability set.</span></span> <span data-ttu-id="2d8ab-110">È possibile usare il [modello di Microsoft](virtual-machines-windows-portal-sql-alwayson-availability-groups.md) per creare automaticamente il gruppo di disponibilità in Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-110">You can use the [Microsoft template](virtual-machines-windows-portal-sql-alwayson-availability-groups.md) to automatically create the availability group in Resource Manager.</span></span> <span data-ttu-id="2d8ab-111">Questo modello crea automaticamente un servizio di bilanciamento del carico interno.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-111">This template automatically creates an internal load balancer for you.</span></span> 

<span data-ttu-id="2d8ab-112">Se si preferisce, è possibile [configurare manualmente un gruppo di disponibilità](virtual-machines-windows-portal-sql-alwayson-availability-groups-manual.md).</span><span class="sxs-lookup"><span data-stu-id="2d8ab-112">If you prefer, you can [manually configure an availability group](virtual-machines-windows-portal-sql-alwayson-availability-groups-manual.md).</span></span>

<span data-ttu-id="2d8ab-113">Per questo articolo è necessario che i gruppi di disponibilità siano già configurati.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-113">This article requires that your availability groups are already configured.</span></span>  

<span data-ttu-id="2d8ab-114">Gli argomenti correlati includono:</span><span class="sxs-lookup"><span data-stu-id="2d8ab-114">Related topics include:</span></span>

* [<span data-ttu-id="2d8ab-115">Configurare i gruppi di disponibilità Always On in una macchina virtuale di Azure, GUI</span><span class="sxs-lookup"><span data-stu-id="2d8ab-115">Configure Always On availability groups in Azure VM (GUI)</span></span>](virtual-machines-windows-portal-sql-alwayson-availability-groups-manual.md)   
* [<span data-ttu-id="2d8ab-116">Configurare una connessione da VNet a VNet tramite Azure Resource Manager e PowerShell</span><span class="sxs-lookup"><span data-stu-id="2d8ab-116">Configure a VNet-to-VNet connection by using Azure Resource Manager and PowerShell</span></span>](../../../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md)

<span data-ttu-id="2d8ab-117">Completando questo articolo si creerà e configurerà un servizio di bilanciamento del carico nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-117">By walking through this article, you create and configure a load balancer in the Azure portal.</span></span> <span data-ttu-id="2d8ab-118">Al termine del processo, si configurerà il cluster per usare l'indirizzo IP dal servizio di bilanciamento del carico per il listener del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-118">After the process is complete, you configure the cluster to use the IP address from the load balancer for the availability group listener.</span></span>

## <a name="create-and-configure-the-load-balancer-in-the-azure-portal"></a><span data-ttu-id="2d8ab-119">Creare e configurare il servizio di bilanciamento del carico nel portale di Azure</span><span class="sxs-lookup"><span data-stu-id="2d8ab-119">Create and configure the load balancer in the Azure portal</span></span>
<span data-ttu-id="2d8ab-120">In questa parte dell'attività eseguire questi passaggi:</span><span class="sxs-lookup"><span data-stu-id="2d8ab-120">In this portion of the task, do the following:</span></span>

1. <span data-ttu-id="2d8ab-121">Nel portale di Azure creare il servizio di bilanciamento del carico e configurare l'indirizzo IP.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-121">In the Azure portal, create the load balancer and configure the IP address.</span></span>
2. <span data-ttu-id="2d8ab-122">Configurare il pool back-end.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-122">Configure the back-end pool.</span></span>
3. <span data-ttu-id="2d8ab-123">Creare il probe.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-123">Create the probe.</span></span> 
4. <span data-ttu-id="2d8ab-124">Impostare le regole di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-124">Set the load balancing rules.</span></span>

> [!NOTE]
> <span data-ttu-id="2d8ab-125">Se le istanze di SQL Server si trova in diverse aree e gruppi di risorse, eseguire ogni passaggio due volte, una volta per ogni gruppo di risorse.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-125">If the SQL Server instances are in multiple resource groups and regions, perform each step twice, once in each resource group.</span></span>
> 
> 

### <a name="step-1-create-the-load-balancer-and-configure-the-ip-address"></a><span data-ttu-id="2d8ab-126">Passaggio1: Creare il servizio di bilanciamento del carico e configurare l'indirizzo IP</span><span class="sxs-lookup"><span data-stu-id="2d8ab-126">Step 1: Create the load balancer and configure the IP address</span></span>
<span data-ttu-id="2d8ab-127">Per prima cosa creare il servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-127">First, create the load balancer.</span></span> 

1. <span data-ttu-id="2d8ab-128">Nel portale di Azure aprire il gruppo di risorse contenente le macchine virtuali di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-128">In the Azure portal, open the resource group that contains the SQL Server virtual machines.</span></span> 

2. <span data-ttu-id="2d8ab-129">Nel gruppo di risorse fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-129">In the resource group, click **Add**.</span></span>

3. <span data-ttu-id="2d8ab-130">Nei risultati della ricerca cercare il **bilanciamento del carico** e selezionare **Servizio di bilanciamento del carico**, pubblicato da **Microsoft**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-130">Search for **load balancer** and then, in the search results, select **Load Balancer**, which is published by **Microsoft**.</span></span>

4. <span data-ttu-id="2d8ab-131">Nel pannello **Servizio di bilanciamento del carico** fare clic su**Crea**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-131">On the **Load Balancer** blade, click **Create**.</span></span>

5. <span data-ttu-id="2d8ab-132">Bella finestra di dialogo **Crea servizio di bilanciamento del carico** configurare il servizio di bilanciamento del carico come segue:</span><span class="sxs-lookup"><span data-stu-id="2d8ab-132">In the **Create load balancer** dialog box, configure the load balancer as follows:</span></span>

   | <span data-ttu-id="2d8ab-133">Impostazione</span><span class="sxs-lookup"><span data-stu-id="2d8ab-133">Setting</span></span> | <span data-ttu-id="2d8ab-134">Valore</span><span class="sxs-lookup"><span data-stu-id="2d8ab-134">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="2d8ab-135">**Nome**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-135">**Name**</span></span> |<span data-ttu-id="2d8ab-136">Nome che rappresenta il servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-136">A text name representing the load balancer.</span></span> <span data-ttu-id="2d8ab-137">Ad esempio **sqlLB**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-137">For example, **sqlLB**.</span></span> |
   | <span data-ttu-id="2d8ab-138">**Tipo**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-138">**Type**</span></span> |<span data-ttu-id="2d8ab-139">**Interno**: la maggior parte delle implementazioni usano un servizio di bilanciamento del carico interno, che consente alle applicazioni all'interno della stessa rete virtuale di connettersi al gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-139">**Internal**: Most implementations use an internal load balancer, which allows applications within the same virtual network to connect to the availability group.</span></span>  </br> <span data-ttu-id="2d8ab-140">**Esterno**: consente alle applicazioni di connettersi al gruppo di disponibilità tramite una connessione Internet pubblica.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-140">**External**: Allows applications to connect to the availability group through a public Internet connection.</span></span> |
   | <span data-ttu-id="2d8ab-141">**Rete virtuale**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-141">**Virtual network**</span></span> |<span data-ttu-id="2d8ab-142">Selezionare la rete virtuale in cui si trovano le istanze di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-142">Select the virtual network that the SQL Server intances are in.</span></span> |
   | <span data-ttu-id="2d8ab-143">**Subnet**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-143">**Subnet**</span></span> |<span data-ttu-id="2d8ab-144">Selezionare la subnet in cui si trovano le istanze di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-144">Select the subnet that the SQL Server instances are in.</span></span> |
   | <span data-ttu-id="2d8ab-145">**Assegnazione indirizzi IP**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-145">**IP address assignment**</span></span> |<span data-ttu-id="2d8ab-146">**Statico**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-146">**Static**</span></span> |
   | <span data-ttu-id="2d8ab-147">**Indirizzo IP privato**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-147">**Private IP address**</span></span> |<span data-ttu-id="2d8ab-148">Specificare un indirizzo IP disponibile della subnet.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-148">Specify an available IP address from the subnet.</span></span> <span data-ttu-id="2d8ab-149">che verrà usato quando si creerà un listener nel cluster.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-149">Use this IP address when you create a listener on the cluster.</span></span> <span data-ttu-id="2d8ab-150">Più avanti in questo articolo si userà questo indirizzo per la variabile `$ILBIP` in uno script di PowerShell.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-150">In a PowerShell script, later in this article, use this address for the `$ILBIP` variable.</span></span> |
   | <span data-ttu-id="2d8ab-151">**Sottoscrizione**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-151">**Subscription**</span></span> |<span data-ttu-id="2d8ab-152">Se si hanno più sottoscrizioni, può essere visualizzato questo campo.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-152">If you have multiple subscriptions, this field might appear.</span></span> <span data-ttu-id="2d8ab-153">Selezionare la sottoscrizione da associare a questa risorsa.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-153">Select the subscription that you want to associate with this resource.</span></span> <span data-ttu-id="2d8ab-154">In genere è la stessa sottoscrizione di tutte le risorse del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-154">It is normally the same subscription as all the resources for the availability group.</span></span> |
   | <span data-ttu-id="2d8ab-155">**Gruppo di risorse**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-155">**Resource group**</span></span> |<span data-ttu-id="2d8ab-156">Selezionare il gruppo di risorse in cui si trovano le istanze di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-156">Select the resource group that the SQL Server instances are in.</span></span> |
   | <span data-ttu-id="2d8ab-157">**Posizione**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-157">**Location**</span></span> |<span data-ttu-id="2d8ab-158">Selezionare il percorso di Azure in cui si trovano le istanze di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-158">Select the Azure location that the SQL Server instances are in.</span></span> |

6. <span data-ttu-id="2d8ab-159">Fare clic su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-159">Click **Create**.</span></span> 

<span data-ttu-id="2d8ab-160">Azure crea il servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-160">Azure creates the load balancer.</span></span> <span data-ttu-id="2d8ab-161">Il servizio di bilanciamento del carico appartiene a una rete, a una subnet, a un gruppo di risorse e a una località specifici.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-161">The load balancer belongs to a specific network, subnet, resource group, and location.</span></span> <span data-ttu-id="2d8ab-162">Quando Azure termina l'attività, verificare le impostazioni del servizio di bilanciamento del carico in Azure.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-162">After Azure completes the task, verify the load balancer settings in Azure.</span></span> 

### <a name="step-2-configure-the-back-end-pool"></a><span data-ttu-id="2d8ab-163">Passaggio 2: Configurare il pool back-end</span><span class="sxs-lookup"><span data-stu-id="2d8ab-163">Step 2: Configure the back-end pool</span></span>
<span data-ttu-id="2d8ab-164">In Azure il pool di indirizzi back-end è chiamato *pool back-end*.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-164">Azure calls the back-end address pool *backend pool*.</span></span> <span data-ttu-id="2d8ab-165">In questo caso, il pool back-end è costituito dagli indirizzi delle due istanze di SQL Server nel gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-165">In this case, the back-end pool is the addresses of the two SQL Server instances in your availability group.</span></span> 

1. <span data-ttu-id="2d8ab-166">Nel gruppo di risorse fare clic sul servizio di bilanciamento del carico creato.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-166">In your resource group, click the load balancer that you created.</span></span> 

2. <span data-ttu-id="2d8ab-167">In **Impostazioni** fare clic su **Pool back-end**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-167">On **Settings**, click **Backend pools**.</span></span>

3. <span data-ttu-id="2d8ab-168">In **Pool back-end** fare clic su **Aggiungi** per creare un pool di indirizzi back-end.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-168">On **Backend pools**, click **Add** to create a back-end address pool.</span></span> 

4. <span data-ttu-id="2d8ab-169">In **Aggiungi pool back-end**, in **Nome** digitare un nome per il pool back-end.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-169">On **Add backend pool**, under **Name**, type a name for the back-end pool.</span></span>

5. <span data-ttu-id="2d8ab-170">In **Macchine virtuali** fare clic su **Aggiungi una macchina virtuale**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-170">Under **Virtual machines**, click **Add a virtual machine**.</span></span> 

6. <span data-ttu-id="2d8ab-171">In **Scegli macchine virtuali** fare clic su **Scegli un set di disponibilità** e specificare il set di disponibilità a cui appartengono le macchine virtuali di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-171">Under **Choose virtual machines**, click **Choose an availability set**, and then specify the availability set that the SQL Server virtual machines belong to.</span></span>

7. <span data-ttu-id="2d8ab-172">Dopo aver scelto il set di disponibilità, fare clic su **Scegli le macchine virtuali**, selezionare le due macchine virtuali che ospitano le istanze di SQL Server nel gruppo di disponibilità e quindi fare clic su **Seleziona**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-172">After you have chosen the availability set, click **Choose the virtual machines**, select the two virtual machines that host the SQL Server instances in the availability group, and then click **Select**.</span></span> 

8. <span data-ttu-id="2d8ab-173">Fare clic su **OK** per chiudere i pannelli per **Scegliere le macchine virtuali** e **Aggiungi pool back-end**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-173">Click **OK** to close the blades for **Choose virtual machines**, and **Add backend pool**.</span></span> 

<span data-ttu-id="2d8ab-174">Azure aggiorna le impostazioni per il pool di indirizzi back-end.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-174">Azure updates the settings for the back-end address pool.</span></span> <span data-ttu-id="2d8ab-175">Il set di disponibilità ora include un pool di due istanze di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-175">Now your availability set has a pool of two SQL Server instances.</span></span>

### <a name="step-3-create-a-probe"></a><span data-ttu-id="2d8ab-176">Passaggio 3: Creare un probe</span><span class="sxs-lookup"><span data-stu-id="2d8ab-176">Step 3: Create a probe</span></span>
<span data-ttu-id="2d8ab-177">Il probe definisce come Azure deve verificare quali istanze di SQL Server sono attualmente proprietarie del listener del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-177">The probe defines how Azure verifies which of the SQL Server instances currently owns the availability group listener.</span></span> <span data-ttu-id="2d8ab-178">Azure esamina il servizio in base all'indirizzo IP su una porta definita quando si crea il probe.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-178">Azure probes the service based on the IP address on a port that you define when you create the probe.</span></span>

1. <span data-ttu-id="2d8ab-179">Nel pannello **Impostazioni** del servizio di bilanciamento del carico fare clic su **Probe integrità**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-179">On the load balancer **Settings** blade, click **Health probes**.</span></span> 

2. <span data-ttu-id="2d8ab-180">Nel pannello **Probe integrità** fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-180">On the **Health probes** blade, click **Add**.</span></span>

3. <span data-ttu-id="2d8ab-181">Configurare il probe nel pannello **Aggiungi probe** .</span><span class="sxs-lookup"><span data-stu-id="2d8ab-181">Configure the probe on the **Add probe** blade.</span></span> <span data-ttu-id="2d8ab-182">Usare i valori seguenti per configurare il probe.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-182">Use the following values to configure the probe:</span></span>

   | <span data-ttu-id="2d8ab-183">Impostazione</span><span class="sxs-lookup"><span data-stu-id="2d8ab-183">Setting</span></span> | <span data-ttu-id="2d8ab-184">Valore</span><span class="sxs-lookup"><span data-stu-id="2d8ab-184">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="2d8ab-185">**Nome**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-185">**Name**</span></span> |<span data-ttu-id="2d8ab-186">Nome che rappresenta il probe.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-186">A text name representing the probe.</span></span> <span data-ttu-id="2d8ab-187">Ad esempio **SQLAlwaysOnEndPointProbe**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-187">For example, **SQLAlwaysOnEndPointProbe**.</span></span> |
   | <span data-ttu-id="2d8ab-188">**Protocollo**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-188">**Protocol**</span></span> |<span data-ttu-id="2d8ab-189">**TCP**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-189">**TCP**</span></span> |
   | <span data-ttu-id="2d8ab-190">**Porta**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-190">**Port**</span></span> |<span data-ttu-id="2d8ab-191">È possibile usare qualsiasi porta disponibile.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-191">You can use any available port.</span></span> <span data-ttu-id="2d8ab-192">Ad esempio *59999*.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-192">For example, *59999*.</span></span> |
   | <span data-ttu-id="2d8ab-193">**Interval**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-193">**Interval**</span></span> |<span data-ttu-id="2d8ab-194">*5*</span><span class="sxs-lookup"><span data-stu-id="2d8ab-194">*5*</span></span> |
   | <span data-ttu-id="2d8ab-195">**Soglia non integra**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-195">**Unhealthy threshold**</span></span> |<span data-ttu-id="2d8ab-196">*2*</span><span class="sxs-lookup"><span data-stu-id="2d8ab-196">*2*</span></span> |

4.  <span data-ttu-id="2d8ab-197">Fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-197">Click **OK**.</span></span> 

> [!NOTE]
> <span data-ttu-id="2d8ab-198">Verificare che la porta specificata sia aperta nel firewall di entrambe le istanze di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-198">Make sure that the port you specify is open on the firewall of both SQL Server instances.</span></span> <span data-ttu-id="2d8ab-199">Per entrambe le istanze è necessaria una regola in ingresso per la porta TCP usata.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-199">Both instances require an inbound rule for the TCP port that you use.</span></span> <span data-ttu-id="2d8ab-200">Per altre informazioni, vedere [Aggiungere o modificare una regola del firewall](http://technet.microsoft.com/library/cc753558.aspx).</span><span class="sxs-lookup"><span data-stu-id="2d8ab-200">For more information, see [Add or Edit Firewall Rule](http://technet.microsoft.com/library/cc753558.aspx).</span></span> 
> 
> 

<span data-ttu-id="2d8ab-201">Azure crea il probe e lo usa per verificare quale istanza di SQL Server possieda il listener per il gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-201">Azure creates the probe and then uses it to test which SQL Server instance has the listener for the availability group.</span></span>

### <a name="step-4-set-the-load-balancing-rules"></a><span data-ttu-id="2d8ab-202">Passaggio 4: Impostare le regole di bilanciamento del carico</span><span class="sxs-lookup"><span data-stu-id="2d8ab-202">Step 4: Set the load balancing rules</span></span>
<span data-ttu-id="2d8ab-203">Le regole di bilanciamento del carico determinano come il servizio di bilanciamento del carico instrada il traffico alle istanze di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-203">The load balancing rules configure how the load balancer routes traffic to the SQL Server instances.</span></span> <span data-ttu-id="2d8ab-204">Per questo servizio di bilanciamento del carico abilitare Direct Server Return perché solo una per volta delle due istanze di SQL Server è proprietaria della risorsa listener del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-204">For this load balancer, you enable direct server return because only one of the two SQL Server instances owns the availability group listener resource at a time.</span></span>

1. <span data-ttu-id="2d8ab-205">Nel pannello **Impostazioni** del servizio di bilanciamento del carico fare clic su **Regole di bilanciamento del carico**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-205">On the load balancer **Settings** blade, click **Load balancing rules**.</span></span> 

2. <span data-ttu-id="2d8ab-206">Nel pannello **Regole di bilanciamento del carico** fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-206">On the **Load balancing rules** blade, click **Add**.</span></span>

3. <span data-ttu-id="2d8ab-207">Nel pannello **Aggiungi regola di bilanciamento del carico** configurare la regola di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-207">On the **Add load balancing rules** blade, configure the load balancing rule.</span></span> <span data-ttu-id="2d8ab-208">Usare le seguenti impostazioni:</span><span class="sxs-lookup"><span data-stu-id="2d8ab-208">Use the following settings:</span></span> 

   | <span data-ttu-id="2d8ab-209">Impostazione</span><span class="sxs-lookup"><span data-stu-id="2d8ab-209">Setting</span></span> | <span data-ttu-id="2d8ab-210">Valore</span><span class="sxs-lookup"><span data-stu-id="2d8ab-210">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="2d8ab-211">**Nome**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-211">**Name**</span></span> |<span data-ttu-id="2d8ab-212">Nome che rappresenta la regola di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-212">A text name representing the load balancing rules.</span></span> <span data-ttu-id="2d8ab-213">Ad esempio **SQLAlwaysOnEndPointListener**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-213">For example, **SQLAlwaysOnEndPointListener**.</span></span> |
   | <span data-ttu-id="2d8ab-214">**Protocollo**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-214">**Protocol**</span></span> |<span data-ttu-id="2d8ab-215">**TCP**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-215">**TCP**</span></span> |
   | <span data-ttu-id="2d8ab-216">**Porta**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-216">**Port**</span></span> |<span data-ttu-id="2d8ab-217">*1433*</span><span class="sxs-lookup"><span data-stu-id="2d8ab-217">*1433*</span></span> |
   | <span data-ttu-id="2d8ab-218">**Porta back-end**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-218">**Backend Port**</span></span> |<span data-ttu-id="2d8ab-219">*1433*. Questo valore verrà ignorato perché questa regola usa **IP mobile (Direct Server Return)**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-219">*1433*. This value is ignored because this rule uses **Floating IP (direct server return)**.</span></span> |
   | <span data-ttu-id="2d8ab-220">**Probe**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-220">**Probe**</span></span> |<span data-ttu-id="2d8ab-221">Usare il nome del probe creato per questo servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-221">Use the name of the probe that you created for this load balancer.</span></span> |
   | <span data-ttu-id="2d8ab-222">**Persistenza della sessione**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-222">**Session persistence**</span></span> |<span data-ttu-id="2d8ab-223">**Nessuno**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-223">**None**</span></span> |
   | <span data-ttu-id="2d8ab-224">**Timeout di inattività (minuti)**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-224">**Idle timeout (minutes)**</span></span> |<span data-ttu-id="2d8ab-225">*4*</span><span class="sxs-lookup"><span data-stu-id="2d8ab-225">*4*</span></span> |
   | <span data-ttu-id="2d8ab-226">**IP mobile (Direct Server Return)**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-226">**Floating IP (direct server return)**</span></span> |<span data-ttu-id="2d8ab-227">**Enabled**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-227">**Enabled**</span></span> |

   > [!NOTE]
   > <span data-ttu-id="2d8ab-228">Potrebbe essere necessario scorrere il pannello verso il basso per visualizzare tutte le impostazioni.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-228">You might have to scroll down the blade to view all the settings.</span></span>
   > 

4. <span data-ttu-id="2d8ab-229">Fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-229">Click **OK**.</span></span> 
5. <span data-ttu-id="2d8ab-230">Azure configura la regola di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-230">Azure configures the load balancing rule.</span></span> <span data-ttu-id="2d8ab-231">Ora il servizio di bilanciamento del carico è configurato per instradare il traffico all'istanza di SQL Server che ospita il listener per il gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-231">Now the load balancer is configured to route traffic to the SQL Server instance that hosts the listener for the availability group.</span></span> 

<span data-ttu-id="2d8ab-232">A questo punto il gruppo di risorse dispone di un servizio di bilanciamento del carico, che si connette a entrambi i computer SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-232">At this point, the resource group has a load balancer that connects to both SQL Server machines.</span></span> <span data-ttu-id="2d8ab-233">Il servizio di bilanciamento del carico contiene anche un indirizzo IP per il listener del gruppo di disponibilità SQL Server Always On in modo che entrambi i computer possano rispondere alle richieste per i gruppi di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-233">The load balancer also contains an IP address for the SQL Server Always On availability group listener, so that either machine can respond to requests for the availability groups.</span></span>

> [!NOTE]
> <span data-ttu-id="2d8ab-234">Se le istanze di SQL Server si trovano in due aree separate, ripetere i passaggi nell'altra area.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-234">If your SQL Server instances are in two separate regions, repeat the steps in the other region.</span></span> <span data-ttu-id="2d8ab-235">Ogni area richiede un servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-235">Each region requires a load balancer.</span></span> 
> 
> 

## <a name="configure-the-cluster-to-use-the-load-balancer-ip-address"></a><span data-ttu-id="2d8ab-236">Configurare il cluster per usare l'indirizzo IP del servizio di bilanciamento del carico</span><span class="sxs-lookup"><span data-stu-id="2d8ab-236">Configure the cluster to use the load balancer IP address</span></span>
<span data-ttu-id="2d8ab-237">Il passaggio successivo consiste nel configurare il listener nel cluster e nel portare il listener online.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-237">The next step is to configure the listener on the cluster, and bring the listener online.</span></span> <span data-ttu-id="2d8ab-238">Eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="2d8ab-238">Do the following:</span></span> 

1. <span data-ttu-id="2d8ab-239">Creare il listener del gruppo di disponibilità nel cluster di failover.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-239">Create the availability group listener on the failover cluster.</span></span> 

2. <span data-ttu-id="2d8ab-240">Portare online il listener.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-240">Bring the listener online.</span></span>

### <a name="step-5-create-the-availability-group-listener-on-the-failover-cluster"></a><span data-ttu-id="2d8ab-241">Passaggio 5: Creare il listener del gruppo di disponibilità nel cluster di failover</span><span class="sxs-lookup"><span data-stu-id="2d8ab-241">Step 5: Create the availability group listener on the failover cluster</span></span>
<span data-ttu-id="2d8ab-242">In questo passaggio si creerà manualmente il listener del gruppo di disponibilità in Gestione cluster di failover e SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-242">In this step, you manually create the availability group listener in Failover Cluster Manager and SQL Server Management Studio.</span></span>

[!INCLUDE [ag-listener-configure](../../../../includes/virtual-machines-ag-listener-configure.md)]

### <a name="verify-the-configuration-of-the-listener"></a><span data-ttu-id="2d8ab-243">Verificare la configurazione del listener</span><span class="sxs-lookup"><span data-stu-id="2d8ab-243">Verify the configuration of the listener</span></span>

<span data-ttu-id="2d8ab-244">Se le risorse del cluster e le dipendenze sono configurate correttamente, dovrebbe essere visualizzato il listener in SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-244">If the cluster resources and dependencies are correctly configured, you should be able to view the listener in SQL Server Management Studio.</span></span> <span data-ttu-id="2d8ab-245">Per impostare la porta del listener, procedere come segue:</span><span class="sxs-lookup"><span data-stu-id="2d8ab-245">To set the listener port, do the following:</span></span>

1. <span data-ttu-id="2d8ab-246">Avviare SQL Server Management Studio e connettersi alla replica primaria.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-246">Start SQL Server Management Studio, and then connect to the primary replica.</span></span>

2. <span data-ttu-id="2d8ab-247">Passare a **Disponibilità elevata AlwaysOn** > **Gruppi di disponibilità** > **Listener gruppo di disponibilità**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-247">Go to **AlwaysOn High Availability** > **Availability Groups** > **Availability Group Listeners**.</span></span>  
    <span data-ttu-id="2d8ab-248">Viene visualizzato il nome del listener creato in Gestione Cluster di Failover.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-248">You should now see the listener name that you created in Failover Cluster Manager.</span></span> 

3. <span data-ttu-id="2d8ab-249">Fare clic con il pulsante destro del mouse sul nome del listener e quindi su **Proprietà**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-249">Right-click the listener name, and then click **Properties**.</span></span>

4. <span data-ttu-id="2d8ab-250">Nella casella **Porta** specificare il numero di porta per il listener del gruppo di disponibilità usando il valore $EndpointPort usato in precedenza, l'impostazione predefinita era 1433, quindi fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-250">In the **Port** box, specify the port number for the availability group listener by using the $EndpointPort you used earlier (1433 was the default), and then click **OK**.</span></span>

<span data-ttu-id="2d8ab-251">Ora si ha un gruppo di disponibilità nelle macchine virtuali di Azure in esecuzione in modalità Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-251">You now have an availability group in Azure virtual machines running in Resource Manager mode.</span></span> 

## <a name="test-the-connection-to-the-listener"></a><span data-ttu-id="2d8ab-252">Testare la connessione al listener</span><span class="sxs-lookup"><span data-stu-id="2d8ab-252">Test the connection to the listener</span></span>
<span data-ttu-id="2d8ab-253">Verificare la connessione effettuando le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="2d8ab-253">Test the connection by doing the following:</span></span>

1. <span data-ttu-id="2d8ab-254">Usare RDP per connettersi a un'istanza di SQL Server che si trova nella stessa rete virtuale, ma non è proprietaria della replica.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-254">RDP to a SQL Server instance that is in the same virtual network, but does not own the replica.</span></span> <span data-ttu-id="2d8ab-255">Può trattarsi dell'altra istanza di SQL Server nel cluster.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-255">This server can be the other SQL Server instance in the cluster.</span></span>

2. <span data-ttu-id="2d8ab-256">Usare l'utilità **sqlcmd** per testare la connessione.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-256">Use **sqlcmd** utility to test the connection.</span></span> <span data-ttu-id="2d8ab-257">Lo script seguente, ad esempio, stabilisce una connessione **sqlcmd** alla replica primaria tramite il listener con l'autenticazione di Windows:</span><span class="sxs-lookup"><span data-stu-id="2d8ab-257">For example, the following script establishes a **sqlcmd** connection to the primary replica through the listener with Windows authentication:</span></span>
   
        sqlcmd -S <listenerName> -E

<span data-ttu-id="2d8ab-258">La connessione SQLCMD si connette automaticamente all'istanza di SQL Server che ospita la replica primaria.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-258">The SQLCMD connection automatically connects to the SQL Server instance that hosts the primary replica.</span></span> 

## <a name="create-an-ip-address-for-an-additional-availability-group"></a><span data-ttu-id="2d8ab-259">Creare un indirizzo IP per un gruppo di disponibilità aggiuntivo</span><span class="sxs-lookup"><span data-stu-id="2d8ab-259">Create an IP address for an additional availability group</span></span>

<span data-ttu-id="2d8ab-260">Ogni gruppo di disponibilità usa un listener diverso.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-260">Each availability group uses a separate listener.</span></span> <span data-ttu-id="2d8ab-261">Ogni listener ha un proprio indirizzo IP.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-261">Each listener has its own IP address.</span></span> <span data-ttu-id="2d8ab-262">Usare lo stesso bilanciamento del carico per contenere l'indirizzo IP per altri listener.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-262">Use the same load balancer to hold the IP address for additional listeners.</span></span> <span data-ttu-id="2d8ab-263">Dopo aver creato un gruppo di disponibilità, aggiungere l'indirizzo IP al bilanciamento del carico e quindi configurare il listener.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-263">After you create an availability group, add the IP address to the load balancer, and then configure the listener.</span></span>

<span data-ttu-id="2d8ab-264">Per aggiungere un indirizzo IP a un bilanciamento del carico con il portale di Azure, completare i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="2d8ab-264">To add an IP address to a load balancer with the Azure portal, do the following:</span></span>

1. <span data-ttu-id="2d8ab-265">Nel portale di Azure aprire il gruppo di risorse che contiene il bilanciamento del carico e fare clic sul bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-265">In the Azure portal, open the resource group that contains the load balancer, and then click the load balancer.</span></span> 

2. <span data-ttu-id="2d8ab-266">In **IMPOSTAZIONI** fare clic su **Pool di indirizzi IP front-end** e quindi su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-266">Under **SETTINGS**, click **Frontend IP pool**, and then click **Add**.</span></span> 

3. <span data-ttu-id="2d8ab-267">In **Aggiungi indirizzo IP front-end** assegnare un nome per il front-end.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-267">Under **Add frontend IP address**, assign a name for the front end.</span></span> 

4. <span data-ttu-id="2d8ab-268">Verificare che **Rete virtuale** e **Subnet** siano le stesse delle istanze di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-268">Verify that the **Virtual network** and the **Subnet** are the same as the SQL Server instances.</span></span>

5. <span data-ttu-id="2d8ab-269">Impostare l'indirizzo IP per il listener.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-269">Set the IP address for the listener.</span></span> 
   
   >[!TIP]
   ><span data-ttu-id="2d8ab-270">È possibile impostare l'indirizzo IP come statico e digitare un indirizzo che non sia attualmente utilizzato nella subnet.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-270">You can set the IP address to static and type an address that is not currently used in the subnet.</span></span> <span data-ttu-id="2d8ab-271">In alternativa è possibile impostare l'indirizzo IP come dinamico e salvare il nuovo pool di indirizzi IP front-end.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-271">Alternatively, you can set the IP address to dynamic and save the new front-end IP pool.</span></span> <span data-ttu-id="2d8ab-272">In questo caso il portale di Azure assegna automaticamente un indirizzo IP disponibile al pool.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-272">When you do so, the Azure portal automatically assigns an available IP address to the pool.</span></span> <span data-ttu-id="2d8ab-273">È quindi possibile riaprire il pool di indirizzi IP front-end e modificare l'assegnazione in statico.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-273">You can then reopen the front-end IP pool and change the assignment to static.</span></span> 

6. <span data-ttu-id="2d8ab-274">Salvare l'indirizzo IP per il listener.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-274">Save the IP address for the listener.</span></span> 

7. <span data-ttu-id="2d8ab-275">Aggiungere un probe integrità usando le impostazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="2d8ab-275">Add a health probe by using the following settings:</span></span>

   |<span data-ttu-id="2d8ab-276">Impostazione</span><span class="sxs-lookup"><span data-stu-id="2d8ab-276">Setting</span></span> |<span data-ttu-id="2d8ab-277">Valore</span><span class="sxs-lookup"><span data-stu-id="2d8ab-277">Value</span></span>
   |:-----|:----
   |<span data-ttu-id="2d8ab-278">**Nome**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-278">**Name**</span></span> |<span data-ttu-id="2d8ab-279">Un nome per identificare il probe.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-279">A name to identify the probe.</span></span>
   |<span data-ttu-id="2d8ab-280">**Protocollo**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-280">**Protocol**</span></span> |<span data-ttu-id="2d8ab-281">TCP</span><span class="sxs-lookup"><span data-stu-id="2d8ab-281">TCP</span></span>
   |<span data-ttu-id="2d8ab-282">**Porta**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-282">**Port**</span></span> |<span data-ttu-id="2d8ab-283">Una porta TCP non usata che deve essere disponibile in tutte le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-283">An unused TCP port, which must be available on all virtual machines.</span></span> <span data-ttu-id="2d8ab-284">Non può essere usata per altri scopi.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-284">It cannot be used for any other purpose.</span></span> <span data-ttu-id="2d8ab-285">Due listener non possono usare la stessa porta probe.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-285">No two listeners can use the same probe port.</span></span> 
   |<span data-ttu-id="2d8ab-286">**Interval**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-286">**Interval**</span></span> |<span data-ttu-id="2d8ab-287">L'intervallo di tempo tra i tentativi di probe.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-287">The amount of time between probe attempts.</span></span> <span data-ttu-id="2d8ab-288">Usare il valore predefinito (5).</span><span class="sxs-lookup"><span data-stu-id="2d8ab-288">Use the default (5).</span></span>
   |<span data-ttu-id="2d8ab-289">**Soglia non integra**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-289">**Unhealthy threshold**</span></span> |<span data-ttu-id="2d8ab-290">Il numero di soglie consecutive che devono essere superate prima che una macchina virtuale venga considerata non integra.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-290">The number of consecutive thresholds that should fail before a virtual machine is considered unhealthy.</span></span>

8. <span data-ttu-id="2d8ab-291">Fare clic su **OK** per salvare il probe.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-291">Click **OK** to save the probe.</span></span> 

9. <span data-ttu-id="2d8ab-292">Creare una regola di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-292">Create a load balancing rule.</span></span> <span data-ttu-id="2d8ab-293">Fare clic su **Regole di bilanciamento del carico** e quindi fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-293">Click **Load balancing rules**, and then click **Add**.</span></span>

10. <span data-ttu-id="2d8ab-294">Configurare la nuova regola di bilanciamento del carico con le seguenti impostazioni:</span><span class="sxs-lookup"><span data-stu-id="2d8ab-294">Configure the new load balancing rule by using the following settings:</span></span>

   |<span data-ttu-id="2d8ab-295">Impostazione</span><span class="sxs-lookup"><span data-stu-id="2d8ab-295">Setting</span></span> |<span data-ttu-id="2d8ab-296">Valore</span><span class="sxs-lookup"><span data-stu-id="2d8ab-296">Value</span></span>
   |:-----|:----
   |<span data-ttu-id="2d8ab-297">**Nome**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-297">**Name**</span></span> |<span data-ttu-id="2d8ab-298">Un nome per identificare la regola di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-298">A name to identify the load balancing rule.</span></span> 
   |<span data-ttu-id="2d8ab-299">**Indirizzo IP front-end IP**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-299">**Frontend IP address**</span></span> |<span data-ttu-id="2d8ab-300">Selezionare l'indirizzo IP che è stato creato.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-300">Select the IP address you created.</span></span> 
   |<span data-ttu-id="2d8ab-301">**Protocollo**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-301">**Protocol**</span></span> |<span data-ttu-id="2d8ab-302">TCP</span><span class="sxs-lookup"><span data-stu-id="2d8ab-302">TCP</span></span>
   |<span data-ttu-id="2d8ab-303">**Porta**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-303">**Port**</span></span> |<span data-ttu-id="2d8ab-304">Usare la porta che viene utilizzata dalle istanze di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-304">Use the port that the SQL Server instances are using.</span></span> <span data-ttu-id="2d8ab-305">Un'istanza predefinita utilizza la porta 1433, a meno che non venga modificata.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-305">A default instance uses port 1433, unless you changed it.</span></span> 
   |<span data-ttu-id="2d8ab-306">**Porta back-end**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-306">**Backend port**</span></span> |<span data-ttu-id="2d8ab-307">Usare lo stesso valore di **Porta**.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-307">Use the same value as **Port**.</span></span>
   |<span data-ttu-id="2d8ab-308">**Pool back-end**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-308">**Backend pool**</span></span> |<span data-ttu-id="2d8ab-309">Il pool che contiene le macchine virtuali con le istanze di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-309">The pool that contains the virtual machines with the SQL Server instances.</span></span> 
   |<span data-ttu-id="2d8ab-310">**Probe di integrità**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-310">**Health probe**</span></span> |<span data-ttu-id="2d8ab-311">Scegliere il probe che è stato creato.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-311">Choose the probe you created.</span></span>
   |<span data-ttu-id="2d8ab-312">**Persistenza della sessione**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-312">**Session persistence**</span></span> |<span data-ttu-id="2d8ab-313">Nessuno</span><span class="sxs-lookup"><span data-stu-id="2d8ab-313">None</span></span>
   |<span data-ttu-id="2d8ab-314">**Timeout di inattività (minuti)**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-314">**Idle timeout (minutes)**</span></span> |<span data-ttu-id="2d8ab-315">Valore predefinito (4)</span><span class="sxs-lookup"><span data-stu-id="2d8ab-315">Default (4)</span></span>
   |<span data-ttu-id="2d8ab-316">**IP mobile (Direct Server Return)**</span><span class="sxs-lookup"><span data-stu-id="2d8ab-316">**Floating IP (direct server return)**</span></span> | <span data-ttu-id="2d8ab-317">Attivato</span><span class="sxs-lookup"><span data-stu-id="2d8ab-317">Enabled</span></span>

### <a name="configure-the-availability-group-to-use-the-new-ip-address"></a><span data-ttu-id="2d8ab-318">Configurare il gruppo di disponibilità affinché usi il nuovo indirizzo IP</span><span class="sxs-lookup"><span data-stu-id="2d8ab-318">Configure the availability group to use the new IP address</span></span>

<span data-ttu-id="2d8ab-319">Per completare la configurazione del cluster, ripetere i passaggi eseguiti per la creazione del primo gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-319">To finish configuring the cluster, repeat the steps that you followed when you made the first availability group.</span></span> <span data-ttu-id="2d8ab-320">Ovvero configurare il [cluster affinché usi il nuovo indirizzo IP](#configure-the-cluster-to-use-the-load-balancer-ip-address).</span><span class="sxs-lookup"><span data-stu-id="2d8ab-320">That is, configure the [cluster to use the new IP address](#configure-the-cluster-to-use-the-load-balancer-ip-address).</span></span> 

<span data-ttu-id="2d8ab-321">Dopo aver aggiunto un indirizzo IP al listener, configurare il gruppo di disponibilità aggiuntivo effettuando le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="2d8ab-321">After you have added an IP address for the listener, configure the additional availability group by doing the following:</span></span> 

1. <span data-ttu-id="2d8ab-322">Verificare che la porta probe per il nuovo indirizzo IP sia aperta in entrambe le macchine virtuali di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-322">Verify that the probe port for the new IP address is open on both SQL Server virtual machines.</span></span> 

2. <span data-ttu-id="2d8ab-323">[In Cluster Manager aggiungere il punto di accesso client](#addcap).</span><span class="sxs-lookup"><span data-stu-id="2d8ab-323">[In Cluster Manager, add the client access point](#addcap).</span></span>

3. <span data-ttu-id="2d8ab-324">[Configurare la risorsa IP per il gruppo di disponibilità](#congroup).</span><span class="sxs-lookup"><span data-stu-id="2d8ab-324">[Configure the IP resource for the availability group](#congroup).</span></span>

   >[!IMPORTANT]
   ><span data-ttu-id="2d8ab-325">Quando si crea l'indirizzo IP, usare l'indirizzo IP che è stato aggiunto al bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-325">When you create the IP address, use the IP address that you added to the load balancer.</span></span>  

4. <span data-ttu-id="2d8ab-326">[Rendere la risorsa del gruppo di disponibilità di SQL Server dipendente dal punto di accesso client](#dependencyGroup).</span><span class="sxs-lookup"><span data-stu-id="2d8ab-326">[Make the SQL Server availability group resource dependent on the client access point](#dependencyGroup).</span></span>

5. <span data-ttu-id="2d8ab-327">[Rendere la risorsa del punto di accesso client dipendente dall'indirizzo IP](#listname).</span><span class="sxs-lookup"><span data-stu-id="2d8ab-327">[Make the client access point resource dependent on the IP address](#listname).</span></span>
 
6. <span data-ttu-id="2d8ab-328">[Impostare i parametri del cluster in PowerShell](#setparam).</span><span class="sxs-lookup"><span data-stu-id="2d8ab-328">[Set the cluster parameters in PowerShell](#setparam).</span></span>

<span data-ttu-id="2d8ab-329">Dopo avere configurato il gruppo di disponibilità per usare il nuovo indirizzo IP, configurare la connessione al listener.</span><span class="sxs-lookup"><span data-stu-id="2d8ab-329">After you configure the availability group to use the new IP address, configure the connection to the listener.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="2d8ab-330">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="2d8ab-330">Next steps</span></span>

- [<span data-ttu-id="2d8ab-331">Configurare un gruppo di disponibilità SQL Server AlwaysOn nelle macchine virtuali di Azure</span><span class="sxs-lookup"><span data-stu-id="2d8ab-331">Configure a SQL Server Always On availability group on Azure virtual machines in different regions</span></span>](virtual-machines-windows-portal-sql-availability-group-dr.md)
