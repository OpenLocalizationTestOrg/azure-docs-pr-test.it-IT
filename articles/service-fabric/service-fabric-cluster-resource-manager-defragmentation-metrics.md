---
title: aaaDefragmentation di metriche in Azure Service Fabric | Documenti Microsoft
description: Informazioni generali sull'uso della deframmentazione o della compressione come strategia per le metriche in Service Fabric
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: e5ebfae5-c8f7-4d6c-9173-3e22a9730552
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: d09045a6cf196d2771f1a0794637f4579d3eb96b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="defragmentation-of-metrics-and-load-in-service-fabric"></a><span data-ttu-id="cfc92-103">Deframmentazione delle metriche e del carico in Service Fabric</span><span class="sxs-lookup"><span data-stu-id="cfc92-103">Defragmentation of metrics and load in Service Fabric</span></span>
<span data-ttu-id="cfc92-104">strategia predefinita Hello servizio infrastruttura Cluster di gestione risorse per la gestione delle metriche di caricamento nel cluster hello è carico hello toodistribute.</span><span class="sxs-lookup"><span data-stu-id="cfc92-104">hello Service Fabric Cluster Resource Manager's default strategy for managing load metrics in hello cluster is toodistribute hello load.</span></span> <span data-ttu-id="cfc92-105">Assicurare che i nodi vengono utilizzati in modo uniforme evita e calda aree che portano tooboth contesa e uno spreco di risorse.</span><span class="sxs-lookup"><span data-stu-id="cfc92-105">Ensuring that nodes are evenly utilized avoids hot and cold spots that lead tooboth contention and wasted resources.</span></span> <span data-ttu-id="cfc92-106">Distribuzione dei carichi di lavoro nel cluster hello è anche hello più sicuro in termini di sopravvivenza errori dal momento che assicura che un errore di non estrarre una percentuale elevata di un determinato carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="cfc92-106">Distributing workloads in hello cluster is also hello safest in terms of surviving failures since it ensures that a failure doesn’t take out a large percentage of a given workload.</span></span> 

<span data-ttu-id="cfc92-107">Hello gestione delle risorse Cluster di Service Fabric supporta una strategia diversa per la gestione di carico, ovvero la deframmentazione.</span><span class="sxs-lookup"><span data-stu-id="cfc92-107">hello Service Fabric Cluster Resource Manager does support a different strategy for managing load, which is defragmentation.</span></span> <span data-ttu-id="cfc92-108">Deframmentazione significa che anziché tentare di utilizzo di hello toodistribute di una metrica cluster hello, verrà consolidata.</span><span class="sxs-lookup"><span data-stu-id="cfc92-108">Defragmentation means that instead of trying toodistribute hello utilization of a metric across hello cluster, it is consolidated.</span></span> <span data-ttu-id="cfc92-109">Consolidamento è semplicemente un'inversione del valore predefinito di hello strategia: invece di riduzione Media deviazione hello del carico di metrica di bilanciamento del carico, tenta di gestione delle risorse Cluster hello tooincrease è.</span><span class="sxs-lookup"><span data-stu-id="cfc92-109">Consolidation is just an inversion of hello default balancing strategy – instead of minimizing hello average standard deviation of metric load, hello Cluster Resource Manager tries tooincrease it.</span></span>

## <a name="when-toouse-defragmentation"></a><span data-ttu-id="cfc92-110">Quando la deframmentazione toouse</span><span class="sxs-lookup"><span data-stu-id="cfc92-110">When toouse defragmentation</span></span>
<span data-ttu-id="cfc92-111">Distribuzione del carico nel cluster hello utilizza alcune risorse hello in ogni nodo.</span><span class="sxs-lookup"><span data-stu-id="cfc92-111">Distributing load in hello cluster consumes some of hello resources on each node.</span></span> <span data-ttu-id="cfc92-112">Alcuni carichi di lavoro creano servizi di dimensioni eccezionalmente elevate e consumano la maggior parte o tutto un nodo.</span><span class="sxs-lookup"><span data-stu-id="cfc92-112">Some workloads create services that are exceptionally large and consume most or all of a node.</span></span> <span data-ttu-id="cfc92-113">In questi casi, è possibile che quando sono presenti grandi carichi di lavoro recupero creati non è sufficiente una spaziatura su toorun qualsiasi nodo.</span><span class="sxs-lookup"><span data-stu-id="cfc92-113">In these cases, it's possible that when there are large workloads getting created that there isn't enough space on any node toorun them.</span></span> <span data-ttu-id="cfc92-114">I carichi di lavoro di grandi dimensioni non sono un problema nell'infrastruttura del servizio; In questi hello casi Gestione delle risorse Cluster determina che deve tooreorganize hello cluster toomake spazio a questo carico di lavoro di grandi dimensioni.</span><span class="sxs-lookup"><span data-stu-id="cfc92-114">Large workloads aren't a problem in Service Fabric; in these cases hello Cluster Resource Manager determines that it needs tooreorganize hello cluster toomake room for this large workload.</span></span> <span data-ttu-id="cfc92-115">Tuttavia, in hello frattempo tale carico di lavoro ha toobe toowait pianificata cluster hello.</span><span class="sxs-lookup"><span data-stu-id="cfc92-115">However, in hello meantime that workload has toowait toobe scheduled in hello cluster.</span></span>

<span data-ttu-id="cfc92-116">Se sono presenti molti servizi e stato toomove intorno, potrebbero richiedere molto tempo per hello elevato carico di lavoro toobe inserito in cluster hello.</span><span class="sxs-lookup"><span data-stu-id="cfc92-116">If there are many services and state toomove around, then it could take a long time for hello large workload toobe placed in hello cluster.</span></span> <span data-ttu-id="cfc92-117">Questo è più probabile se altri carichi di lavoro in cluster hello inoltre sono di grandi dimensioni e pertanto richiedere tooreorganize più lungo.</span><span class="sxs-lookup"><span data-stu-id="cfc92-117">This is more likely if other workloads in hello cluster are also large and so take longer tooreorganize.</span></span> <span data-ttu-id="cfc92-118">il team di Service Fabric Hello misurata tempi di creazione delle simulazioni di questo scenario.</span><span class="sxs-lookup"><span data-stu-id="cfc92-118">hello Service Fabric team measured creation times in simulations of this scenario.</span></span> <span data-ttu-id="cfc92-119">È stato rilevato che la creazione di servizi di grandi dimensioni ha richiesto molto più tempo quando l'uso del cluster ha superato il valore tra il 30 e il 50%.</span><span class="sxs-lookup"><span data-stu-id="cfc92-119">We found that creating large services took much longer as soon as cluster utilization got above between 30% and 50%.</span></span> <span data-ttu-id="cfc92-120">toohandle questo scenario, è stata introdotta la deframmentazione come strategia di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="cfc92-120">toohandle this scenario, we introduced defragmentation as a balancing strategy.</span></span> <span data-ttu-id="cfc92-121">Si è scoperto che per carichi di lavoro di grandi dimensioni, soprattutto quelli in cui ora di creazione è importante, la deframmentazione ha consentito di questi nuovi carichi di lavoro Pianificazione cluster hello.</span><span class="sxs-lookup"><span data-stu-id="cfc92-121">We found that for large workloads, especially ones where creation time was important, defragmentation really helped those new workloads get scheduled in hello cluster.</span></span>

<span data-ttu-id="cfc92-122">È possibile configurare la deframmentazione metriche toohave hello carico di gestione delle risorse Cluster tooproactively try toocondense hello dei servizi hello in un minor numero di nodi.</span><span class="sxs-lookup"><span data-stu-id="cfc92-122">You can configure defragmentation metrics toohave hello Cluster Resource Manager tooproactively try toocondense hello load of hello services into fewer nodes.</span></span> <span data-ttu-id="cfc92-123">Ciò garantisce che c'è quasi sempre spazio per i servizi di grandi dimensioni senza la riorganizzazione cluster hello.</span><span class="sxs-lookup"><span data-stu-id="cfc92-123">This helps ensure that there is almost always room for large services without reorganizing hello cluster.</span></span> <span data-ttu-id="cfc92-124">Non cluster hello tooreorganize consente di creare rapidamente grandi carichi di lavoro.</span><span class="sxs-lookup"><span data-stu-id="cfc92-124">Not having tooreorganize hello cluster allows creating large workloads quickly.</span></span>

<span data-ttu-id="cfc92-125">La maggior parte degli utenti non avrà bisogno della deframmentazione.</span><span class="sxs-lookup"><span data-stu-id="cfc92-125">Most people don’t need defragmentation.</span></span> <span data-ttu-id="cfc92-126">I servizi sono in genere essere piccolo, pertanto non è una chat room toofind disco per tali cluster hello.</span><span class="sxs-lookup"><span data-stu-id="cfc92-126">Services are usually be small, so it’s not hard toofind room for them in hello cluster.</span></span> <span data-ttu-id="cfc92-127">Quando la riorganizzazione è possibile avviene rapidamente poiché la maggior parte dei servizi sono di dimensioni ridotte e possono essere spostati rapidamente e in parallelo.</span><span class="sxs-lookup"><span data-stu-id="cfc92-127">When reorganization is possible, it goes quickly, again because most services are small and can be moved quickly and in parallel.</span></span> <span data-ttu-id="cfc92-128">Tuttavia, se si dispone di servizi di grandi dimensioni e inutili creati rapidamente hello strategia deframmentazione in linea è per l'utente.</span><span class="sxs-lookup"><span data-stu-id="cfc92-128">However, if you have large services and need them created quickly then hello defragmentation strategy is for you.</span></span> <span data-ttu-id="cfc92-129">Verranno discussi i compromessi hello dell'utilizzo di deframmentazione accanto.</span><span class="sxs-lookup"><span data-stu-id="cfc92-129">We'll discuss hello tradeoffs of using defragmentation next.</span></span> 

## <a name="defragmentation-tradeoffs"></a><span data-ttu-id="cfc92-130">Svantaggi della deframmentazione</span><span class="sxs-lookup"><span data-stu-id="cfc92-130">Defragmentation tradeoffs</span></span>
<span data-ttu-id="cfc92-131">La deframmentazione può aumentare l'impatto degli errori, poiché vengono eseguiti più servizi sui nodi che presentano errori.</span><span class="sxs-lookup"><span data-stu-id="cfc92-131">Defragmentation can increase impactfulness of failures, since more services are running on nodes that fail.</span></span> <span data-ttu-id="cfc92-132">Deframmentazione in linea è possibile aumentare anche i costi, poiché le risorse cluster hello devono essere tenute di riserva in attesa per la creazione di hello di carichi di lavoro di grandi dimensioni.</span><span class="sxs-lookup"><span data-stu-id="cfc92-132">Defragmentation can also increase costs, since resources in hello cluster must be held in reserve, waiting for hello creation of large workloads.</span></span>

<span data-ttu-id="cfc92-133">Hello diagramma seguente offre una rappresentazione visiva di due cluster, che viene deframmentato e uno che non sia.</span><span class="sxs-lookup"><span data-stu-id="cfc92-133">hello following diagram gives a visual representation of two clusters, one that is defragmented and one that is not.</span></span> 

<span data-ttu-id="cfc92-134"><center>
![Confronto tra cluster bilanciati e deframmentati][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="cfc92-134"><center>
![Comparing Balanced and Defragmented Clusters][Image1]
</center></span></span>

<span data-ttu-id="cfc92-135">In caso di hello bilanciato, prendere in considerazione hello numero di spostamenti di tipo che sarebbe necessario tooplace uno degli oggetti servizio più grande hello.</span><span class="sxs-lookup"><span data-stu-id="cfc92-135">In hello balanced case, consider hello number of movements that would be necessary tooplace one of hello largest service objects.</span></span> <span data-ttu-id="cfc92-136">Cluster deframmentato hello, carichi di lavoro elevati hello potrebbe trovarsi in nodi quattro o cinque senza toowait per qualsiasi altro toomove di servizi.</span><span class="sxs-lookup"><span data-stu-id="cfc92-136">In hello defragmented cluster, hello large workload could be placed on nodes four or five without having toowait for any other services toomove.</span></span>

## <a name="defragmentation-pros-and-cons"></a><span data-ttu-id="cfc92-137">Vantaggi e svantaggi della deframmentazione</span><span class="sxs-lookup"><span data-stu-id="cfc92-137">Defragmentation pros and cons</span></span>
<span data-ttu-id="cfc92-138">Quali sono quindi questi altri compromessi concettuali?</span><span class="sxs-lookup"><span data-stu-id="cfc92-138">So what are those other conceptual tradeoffs?</span></span> <span data-ttu-id="cfc92-139">Qui è una tabella rapida di operazioni toothink su:</span><span class="sxs-lookup"><span data-stu-id="cfc92-139">Here’s a quick table of things toothink about:</span></span>

| <span data-ttu-id="cfc92-140">Vantaggi della deframmentazione</span><span class="sxs-lookup"><span data-stu-id="cfc92-140">Defragmentation Pros</span></span> | <span data-ttu-id="cfc92-141">Svantaggi della deframmentazione</span><span class="sxs-lookup"><span data-stu-id="cfc92-141">Defragmentation Cons</span></span> |
| --- | --- |
| <span data-ttu-id="cfc92-142">Consente di creare servizi di grandi dimensioni più rapidamente</span><span class="sxs-lookup"><span data-stu-id="cfc92-142">Allows faster creation of large services</span></span> |<span data-ttu-id="cfc92-143">Concentra i carichi in meno nodi, aumentando il conflitto</span><span class="sxs-lookup"><span data-stu-id="cfc92-143">Concentrates load onto fewer nodes, increasing contention</span></span> |
| <span data-ttu-id="cfc92-144">Consente di ridurre lo spostamento dei dati durante la creazione</span><span class="sxs-lookup"><span data-stu-id="cfc92-144">Enables lower data movement during creation</span></span> |<span data-ttu-id="cfc92-145">Eventuali errori possono impattare più servizi e causare una maggiore varianza</span><span class="sxs-lookup"><span data-stu-id="cfc92-145">Failures can impact more services and cause more churn</span></span> |
| <span data-ttu-id="cfc92-146">Consente una descrizione completa dei requisiti e il recupero di spazio</span><span class="sxs-lookup"><span data-stu-id="cfc92-146">Allows rich description of requirements and reclamation of space</span></span> |<span data-ttu-id="cfc92-147">Configurazione di gestione delle risorse complessiva più complessa</span><span class="sxs-lookup"><span data-stu-id="cfc92-147">More complex overall Resource Management configuration</span></span> |

<span data-ttu-id="cfc92-148">È possibile combinare deframmentato e metriche normale in hello dello stesso cluster.</span><span class="sxs-lookup"><span data-stu-id="cfc92-148">You can mix defragmented and normal metrics in hello same cluster.</span></span> <span data-ttu-id="cfc92-149">Hello gestione delle risorse Cluster tenta tooconsolidate hello deframmentazione metriche quanto possibile durante la distribuzione hello ad altri utenti.</span><span class="sxs-lookup"><span data-stu-id="cfc92-149">hello Cluster Resource Manager tries tooconsolidate hello defragmentation metrics as much as possible while spreading out hello others.</span></span> <span data-ttu-id="cfc92-150">risultati Hello della combinazione di deframmentazione e bilanciamento del carico strategie dipende da diversi fattori, tra cui:</span><span class="sxs-lookup"><span data-stu-id="cfc92-150">hello results of mixing defragmentation and balancing strategies depends on several factors, including:</span></span>
  - <span data-ttu-id="cfc92-151">numero di Hello di bilanciamento del carico metriche rispetto al numero di hello di metriche di deframmentazione in linea</span><span class="sxs-lookup"><span data-stu-id="cfc92-151">hello number of balancing metrics vs. hello number of defragmentation metrics</span></span>
  - <span data-ttu-id="cfc92-152">se un servizio usa entrambi i tipi di metriche</span><span class="sxs-lookup"><span data-stu-id="cfc92-152">Whether any service uses both types of metrics</span></span> 
  - <span data-ttu-id="cfc92-153">pesi metrica Hello</span><span class="sxs-lookup"><span data-stu-id="cfc92-153">hello metric weights</span></span>
  - <span data-ttu-id="cfc92-154">i carichi correnti delle metriche</span><span class="sxs-lookup"><span data-stu-id="cfc92-154">current metric loads</span></span>
  
<span data-ttu-id="cfc92-155">Sperimentazione è obbligatorio toodetermine hello esatta configurazione necessaria.</span><span class="sxs-lookup"><span data-stu-id="cfc92-155">Experimentation is required toodetermine hello exact configuration necessary.</span></span> <span data-ttu-id="cfc92-156">Si consiglia di misurare accuratamente i carichi di lavoro prima di abilitare le metriche di deframmentazione nella produzione.</span><span class="sxs-lookup"><span data-stu-id="cfc92-156">We recommend thorough measurement of your workloads before you enable defragmentation metrics in production.</span></span> <span data-ttu-id="cfc92-157">Ciò vale soprattutto quando la combinazione di deframmentazione in linea e metrica bilanciata in hello stesso servizio.</span><span class="sxs-lookup"><span data-stu-id="cfc92-157">This is especially true when mixing defragmentation and balanced metrics within hello same service.</span></span> 

## <a name="configuring-defragmentation-metrics"></a><span data-ttu-id="cfc92-158">Configurazione delle metriche di deframmentazione</span><span class="sxs-lookup"><span data-stu-id="cfc92-158">Configuring defragmentation metrics</span></span>
<span data-ttu-id="cfc92-159">Configurazione di metriche di deframmentazione in linea è una decisione globale cluster hello e metriche singoli possono essere selezionate per la deframmentazione.</span><span class="sxs-lookup"><span data-stu-id="cfc92-159">Configuring defragmentation metrics is a global decision in hello cluster, and individual metrics can be selected for defragmentation.</span></span> <span data-ttu-id="cfc92-160">Hello configurazione frammenti di codice seguente mostra come tooconfigure metrica per la deframmentazione.</span><span class="sxs-lookup"><span data-stu-id="cfc92-160">hello following config snippets show how tooconfigure metrics for defragmentation.</span></span> <span data-ttu-id="cfc92-161">In questo caso, "Metric1" è configurato come una metrica di deframmentazione in linea, mentre "Metric2" continuerà toobe bilanciato normalmente.</span><span class="sxs-lookup"><span data-stu-id="cfc92-161">In this case, "Metric1" is configured as a defragmentation metric, while "Metric2" will continue toobe balanced normally.</span></span> 

<span data-ttu-id="cfc92-162">ClusterManifest.xml:</span><span class="sxs-lookup"><span data-stu-id="cfc92-162">ClusterManifest.xml:</span></span>

```xml
<Section Name="DefragmentationMetrics">
    <Parameter Name="Metric1" Value="true" />
    <Parameter Name="Metric2" Value="false" />
</Section>
```

<span data-ttu-id="cfc92-163">mediante ClusterConfig.json per le distribuzioni autonome o Template.json per i cluster ospitati in Azure:</span><span class="sxs-lookup"><span data-stu-id="cfc92-163">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "DefragmentationMetrics",
    "parameters": [
      {
          "name": "Metric1",
          "value": "true"
      },
      {
          "name": "Metric2",
          "value": "false"
      }
    ]
  }
]
```


## <a name="next-steps"></a><span data-ttu-id="cfc92-164">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="cfc92-164">Next steps</span></span>
- <span data-ttu-id="cfc92-165">opzioni di man per descrivere il cluster hello Hello gestione delle risorse Cluster.</span><span class="sxs-lookup"><span data-stu-id="cfc92-165">hello Cluster Resource Manager has man options for describing hello cluster.</span></span> <span data-ttu-id="cfc92-166">toofind ulteriori informazioni, consultare questo articolo in [che descrive un cluster di Service Fabric](service-fabric-cluster-resource-manager-cluster-description.md)</span><span class="sxs-lookup"><span data-stu-id="cfc92-166">toofind out more about them, check out this article on [describing a Service Fabric cluster](service-fabric-cluster-resource-manager-cluster-description.md)</span></span>
- <span data-ttu-id="cfc92-167">Le metriche sono la modalità di gestione di consumo e la capacità in cluster hello in hello gestore di risorse Cluster dell'infrastruttura del servizio.</span><span class="sxs-lookup"><span data-stu-id="cfc92-167">Metrics are how hello Service Fabric Cluster Resource Manger manages consumption and capacity in hello cluster.</span></span> <span data-ttu-id="cfc92-168">ulteriori informazioni sulle metriche toolearn come tooconfigure, archiviazione ed estrazione [in questo articolo](service-fabric-cluster-resource-manager-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="cfc92-168">toolearn more about metrics and how tooconfigure them, check out [this article](service-fabric-cluster-resource-manager-metrics.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-defragmentation-metrics/balancing-defrag-compared.png
