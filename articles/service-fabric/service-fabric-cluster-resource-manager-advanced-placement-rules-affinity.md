---
title: "aaaService gestione delle risorse dell'infrastruttura Cluster - affinità | Documenti Microsoft"
description: "Informazioni generali sulla configurazione dell'affinità per i servizi di Service Fabric"
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 678073e1-d08d-46c4-a811-826e70aba6c4
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 7dc9b6d9c18d9d615d39cff7de9d7cba1c040474
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="configuring-and-using-service-affinity-in-service-fabric"></a><span data-ttu-id="4ecfa-103">Configurazione e utilizzo dell'affinità del servizio in Service Fabric</span><span class="sxs-lookup"><span data-stu-id="4ecfa-103">Configuring and using service affinity in Service Fabric</span></span>
<span data-ttu-id="4ecfa-104">Affinità è un controllo che viene fornito principalmente i transizione di hello facilità di toohelp di dimensioni maggiori monolitiche applicazioni nel cloud e microservizi HelloWorld.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-104">Affinity is a control that is provided mainly toohelp ease hello transition of larger monolithic applications into hello cloud and microservices world.</span></span> <span data-ttu-id="4ecfa-105">È utilizzato anche come un'ottimizzazione per migliorare le prestazioni di hello dei servizi, anche se possono avere effetti collaterali.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-105">It is also used as an optimization for improving hello performance of services, although doing so can have side effects.</span></span>

<span data-ttu-id="4ecfa-106">Si supponga che si sta riportare un'app di dimensioni maggiori, o che non è stato progettato con microservizi presente tooService dell'infrastruttura (o qualsiasi ambiente distribuito).</span><span class="sxs-lookup"><span data-stu-id="4ecfa-106">Let’s say you’re bringing a larger app, or one that just wasn’t designed with microservices in mind, tooService Fabric (or any distributed environment).</span></span> <span data-ttu-id="4ecfa-107">Questo tipo di transizione è comune.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-107">This type of transition is common.</span></span> <span data-ttu-id="4ecfa-108">È necessario innanzitutto sollevamento hello intera app nell'ambiente di hello, creandone un pacchetto e assicurandosi che è in esecuzione senza problemi.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-108">You start by lifting hello entire app into hello environment, packaging it, and making sure it is running smoothly.</span></span> <span data-ttu-id="4ecfa-109">Quindi iniziare suddividerla in diversi servizi più piccoli che tutti comunicare tooeach altri.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-109">Then you start breaking it down into different smaller services that all talk tooeach other.</span></span>

<span data-ttu-id="4ecfa-110">Infine è possibile che un'applicazione hello si è verificati alcuni problemi.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-110">Eventually you may find that hello application is experiencing some issues.</span></span> <span data-ttu-id="4ecfa-111">problemi di Hello rientrano in genere in una di queste categorie:</span><span class="sxs-lookup"><span data-stu-id="4ecfa-111">hello issues usually fall into one of these categories:</span></span>

1. <span data-ttu-id="4ecfa-112">Alcuni componenti X nell'app monolitico hello include una dipendenza non trattati nella documentazione sul componente Y, ed è attivata solo tali componenti in servizi separati.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-112">Some component X in hello monolithic app had an undocumented dependency on component Y, and you just turned those components into separate services.</span></span> <span data-ttu-id="4ecfa-113">Poiché questi servizi sono in esecuzione in nodi diversi cluster hello, ma sono interrotti.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-113">Since these services are now running on different nodes in hello cluster, they're broken.</span></span>
2. <span data-ttu-id="4ecfa-114">Questi componenti comunicano tramite (named pipes locale | il protocollo shared memory | file su disco) ed è davvero necessaria toobe toowrite in grado di tooa condiviso locale risorse per motivi di prestazioni ora.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-114">These components communicate via (local named pipes | shared memory | files on disk) and they really need toobe able toowrite tooa shared local resource for performance reasons right now.</span></span> <span data-ttu-id="4ecfa-115">Tale dipendenza rigida viene rimossa, forse, in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-115">That hard dependency gets removed later, maybe.</span></span>
3. <span data-ttu-id="4ecfa-116">La procedura è corretta, ma si scopre che questi due componenti comunicano tra loro o sono sensibili alle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-116">Everything is fine, but it turns out that these two components are actually chatty/performance sensitive.</span></span> <span data-ttu-id="4ecfa-117">Quando sono stati spostati in servizi separati, le prestazioni globali hanno subito dell'applicazione ne hanno risentito pesantemente o hanno aumentato la latenza.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-117">When they moved them into separate services overall application performance tanked or latency increased.</span></span> <span data-ttu-id="4ecfa-118">Di conseguenza, hello complessive dell'applicazione non soddisfa le aspettative dei clienti.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-118">As a result, hello overall application is not meeting expectations.</span></span>

<span data-ttu-id="4ecfa-119">In questi casi, è non deve toolose del lavoro refactoring e non toogo toohello indietro monolito.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-119">In these cases, we don’t want toolose our refactoring work, and don’t want toogo back toohello monolith.</span></span> <span data-ttu-id="4ecfa-120">ultima condizione Hello può anche essere utile come un normale di ottimizzazione.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-120">hello last condition may even be desirable as a plain optimization.</span></span> <span data-ttu-id="4ecfa-121">Tuttavia, fino a quando non è possibile riprogettare hello componenti toowork naturalmente come servizi (o fino a quando non è in grado di risolvere le aspettative di prestazioni hello qualche altro modo) verrà tooneed realistico di località.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-121">However, until we can redesign hello components toowork naturally as services (or until we can solve hello performance expectations some other way) we're going tooneed some sense of locality.</span></span>

<span data-ttu-id="4ecfa-122">Quali toodo?</span><span class="sxs-lookup"><span data-stu-id="4ecfa-122">What toodo?</span></span> <span data-ttu-id="4ecfa-123">Si può provare ad attivare il servizio di affinità.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-123">Well, you could try turning on affinity.</span></span>

## <a name="how-tooconfigure-affinity"></a><span data-ttu-id="4ecfa-124">Come tooconfigure affinità</span><span class="sxs-lookup"><span data-stu-id="4ecfa-124">How tooconfigure affinity</span></span>
<span data-ttu-id="4ecfa-125">tooset l'affinità, definire una relazione di affinità tra due servizi diversi.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-125">tooset up affinity, you define an affinity relationship between two different services.</span></span> <span data-ttu-id="4ecfa-126">Si tratta di fare in modo che un servizio "punti" a un altro servizio affinché il primo possa essere eseguito solo se anche il secondo è in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-126">You can think of affinity as “pointing” one service at another and saying “This service can only run where that service is running.”</span></span> <span data-ttu-id="4ecfa-127">A volte viene fatto riferimento tooaffinity come una relazione padre/figlio (in cui si posiziona il figlio hello padre hello).</span><span class="sxs-lookup"><span data-stu-id="4ecfa-127">Sometimes we refer tooaffinity as a parent/child relationship (where you point hello child at hello parent).</span></span> <span data-ttu-id="4ecfa-128">Affinità assicura che le repliche hello o istanze di un servizio vengano posizionate nel hello stessi nodi di quelli di un altro servizio.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-128">Affinity ensures that hello replicas or instances of one service are placed on hello same nodes as those of another service.</span></span>

```csharp
ServiceCorrelationDescription affinityDescription = new ServiceCorrelationDescription();
affinityDescription.Scheme = ServiceCorrelationScheme.Affinity;
affinityDescription.ServiceName = new Uri("fabric:/otherApplication/parentService");
serviceDescription.Correlations.Add(affinityDescription);
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

> [!NOTE]
> <span data-ttu-id="4ecfa-129">Un servizio figlio può partecipare solo a una relazione di affinità singola.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-129">A child service can only participate in a single affinity relationship.</span></span> <span data-ttu-id="4ecfa-130">Se si desiderava contemporaneamente hello figlio viene creata un'affinità toobe tootwo padre services sono disponibili due opzioni:</span><span class="sxs-lookup"><span data-stu-id="4ecfa-130">If you wanted hello child toobe affinitized tootwo parent services at once you have a couple options:</span></span>
> - <span data-ttu-id="4ecfa-131">Hello relazioni inverse, avere parentService1 e punto di servizio figlio corrente hello parentService2, o</span><span class="sxs-lookup"><span data-stu-id="4ecfa-131">Reverse hello relationships (have parentService1 and parentService2 point at hello current child service), or</span></span>
> - <span data-ttu-id="4ecfa-132">Designare una padri hello come hub per convenzione e dispongono di punti a tale servizio di tutti i servizi.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-132">Designate one of hello parents as a hub by convention and have all services point at that service.</span></span> 
>
> <span data-ttu-id="4ecfa-133">Hello risultante il comportamento di selezione host in cluster hello devono essere hello stesso.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-133">hello resulting placement behavior in hello cluster should be hello same.</span></span>
>

## <a name="different-affinity-options"></a><span data-ttu-id="4ecfa-134">Diverse opzioni di affinità</span><span class="sxs-lookup"><span data-stu-id="4ecfa-134">Different affinity options</span></span>
<span data-ttu-id="4ecfa-135">L'affinità è rappresentata tramite vari possibili schemi di correlazione e ha due modalità diverse.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-135">Affinity is represented via one of several correlation schemes, and has two different modes.</span></span> <span data-ttu-id="4ecfa-136">modalità di affinità tra i più comuni Hello è ciò che viene definito NonAlignedAffinity.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-136">hello most common mode of affinity is what we call NonAlignedAffinity.</span></span> <span data-ttu-id="4ecfa-137">In NonAlignedAffinity, hello repliche o istanze di diversi servizi hello vengono inserite in hello stessi nodi.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-137">In NonAlignedAffinity, hello replicas or instances of hello different services are placed on hello same nodes.</span></span> <span data-ttu-id="4ecfa-138">Hello altre modalità è AlignedAffinity.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-138">hello other mode is AlignedAffinity.</span></span> <span data-ttu-id="4ecfa-139">La modalità AlignedAffinity viene usata solo con i servizi con stato.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-139">Aligned Affinity is useful only with stateful services.</span></span> <span data-ttu-id="4ecfa-140">Configurazione con stato di due servizi toohave allineato affinità assicura che primari hello di tali servizi vengono posizionate in hello stessi nodi come ogni altro.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-140">Configuring two stateful services toohave aligned affinity ensures that hello primaries of those services are placed on hello same nodes as each other.</span></span> <span data-ttu-id="4ecfa-141">Fa inoltre in ogni coppia di repliche secondarie per tali toobe servizi posizionato su hello stessi nodi.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-141">It also causes each pair of secondaries for those services toobe placed on hello same nodes.</span></span> <span data-ttu-id="4ecfa-142">È inoltre possibile (anche se meno comune) tooconfigure NonAlignedAffinity per i servizi con stati.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-142">It is also possible (though less common) tooconfigure NonAlignedAffinity for stateful services.</span></span> <span data-ttu-id="4ecfa-143">Per NonAlignedAffinity, diverse repliche di hello di due servizi con stati vengono eseguite in hello hello stessi nodi, ma i relativi componenti primari potrebbero finire in nodi diversi.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-143">For NonAlignedAffinity, hello different replicas of hello two stateful services would run on hello same nodes, but their primaries could end up on different nodes.</span></span>

<span data-ttu-id="4ecfa-144"><center>
![Modalità di affinità e loro effetti][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="4ecfa-144"><center>
![Affinity Modes and Their Effects][Image1]
</center></span></span>

### <a name="best-effort-desired-state"></a><span data-ttu-id="4ecfa-145">Stato desiderato del massimo sforzo</span><span class="sxs-lookup"><span data-stu-id="4ecfa-145">Best effort desired state</span></span>
<span data-ttu-id="4ecfa-146">Una relazione di affinità è migliore.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-146">An affinity relationship is best effort.</span></span> <span data-ttu-id="4ecfa-147">Non fornisce hello stesse garanzie di affidabilità che stesso processo eseguibile in esecuzione in hello o la collocazione.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-147">It does not provide hello same guarantees of collocation or reliability that running in hello same executable process does.</span></span> <span data-ttu-id="4ecfa-148">servizi Hello in una relazione di affinità sono fondamentalmente diverse entità che può avere esito negativo ed è possibile spostare in modo indipendente.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-148">hello services in an affinity relationship are fundamentally different entities that can fail and be moved independently.</span></span> <span data-ttu-id="4ecfa-149">Una relazione di affinità può anche subire un'interruzione, anche se tali interruzioni sono temporanee.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-149">An affinity relationship could also break, though these breaks are temporary.</span></span> <span data-ttu-id="4ecfa-150">Ad esempio, i limiti di capacità possono significare che solo alcuni degli oggetti servizio hello nella relazione di affinità hello può contenere un nodo specifico.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-150">For example, capacity limitations may mean that only some of hello service objects in hello affinity relationship can fit on a given node.</span></span> <span data-ttu-id="4ecfa-151">In questi casi, anche se è disponibile una relazione di affinità, non può essere imposta scadenza toohello altri vincoli.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-151">In these cases even though there's an affinity relationship in place, it can't be enforced due toohello other constraints.</span></span> <span data-ttu-id="4ecfa-152">Se è pertanto possibile toodo, violazione hello viene corretto automaticamente in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-152">If it is possible toodo so, hello violation is automatically corrected later.</span></span>

### <a name="chains-vs-stars"></a><span data-ttu-id="4ecfa-153">Modelli a catena o a stella</span><span class="sxs-lookup"><span data-stu-id="4ecfa-153">Chains vs. stars</span></span>
<span data-ttu-id="4ecfa-154">Oggi hello gestione delle risorse Cluster non è in grado di toomodel catene di relazioni di affinità.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-154">Today hello Cluster Resource Manager isn't able toomodel chains of affinity relationships.</span></span> <span data-ttu-id="4ecfa-155">Ciò significa che un servizio che è un elemento figlio in una relazione di affinità non potrà essere un elemento padre in un'altra relazione di affinità.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-155">What this means is that a service that is a child in one affinity relationship can’t be a parent in another affinity relationship.</span></span> <span data-ttu-id="4ecfa-156">Se si desidera toomodel questo tipo di relazione, in realtà hanno toomodel come una stella, anziché una catena.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-156">If you want toomodel this type of relationship, you effectively have toomodel it as a star, rather than a chain.</span></span> <span data-ttu-id="4ecfa-157">toomove da una stella tooa catena, hello inferiori figlio sarebbe invece toohello padre prima padre dell'elemento figlio.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-157">toomove from a chain tooa star, hello bottommost child would be parented toohello first child’s parent instead.</span></span> <span data-ttu-id="4ecfa-158">A seconda della disposizione hello dei servizi, è possibile toodo l'operazione più volte.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-158">Depending on hello arrangement of your services, you may have toodo this multiple times.</span></span> <span data-ttu-id="4ecfa-159">Se è presente alcun elemento padre naturale di servizio, è possibile toocreate uno che funge da segnaposto.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-159">If there's no natural parent service, you may have toocreate one that serves as a placeholder.</span></span> <span data-ttu-id="4ecfa-160">A seconda dei requisiti, è inoltre possibile toolook in [gruppi di applicazioni](service-fabric-cluster-resource-manager-application-groups.md).</span><span class="sxs-lookup"><span data-stu-id="4ecfa-160">Depending on your requirements, you may also want toolook into [Application Groups](service-fabric-cluster-resource-manager-application-groups.md).</span></span>

<span data-ttu-id="4ecfa-161"><center>
![Modelli a catena o Stelle nel contesto delle relazioni affinità hello][Image2]
</center></span><span class="sxs-lookup"><span data-stu-id="4ecfa-161"><center>
![Chains vs. Stars in hello Context of Affinity Relationships][Image2]
</center></span></span>

<span data-ttu-id="4ecfa-162">Un altro aspetto toonote sulle relazioni di affinità è oggi che sono direzionale.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-162">Another thing toonote about affinity relationships today is that they are directional.</span></span> <span data-ttu-id="4ecfa-163">Ciò significa che tale regola affinità hello impone solo che i figli hello posizionato con padre hello.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-163">This means that hello affinity rule only enforces that hello child placed with hello parent.</span></span> <span data-ttu-id="4ecfa-164">Non garantisce che padre hello Trova con figlio hello.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-164">It does not ensure that hello parent is located with hello child.</span></span> <span data-ttu-id="4ecfa-165">È anche importante toonote che hello relazione di affinità non può essere ideale o immediatamente imposta poiché diversi servizi e dispone di diversi cicli di vita possono avere esito negativo e spostare in modo indipendente.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-165">It is also important toonote that hello affinity relationship can't be perfect or instantly enforced since different services have with different lifecycles and can fail and move independently.</span></span> <span data-ttu-id="4ecfa-166">Ad esempio, supponiamo padre hello improvvisamente failover tooanother nodo perché è arrestato in modo anomalo.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-166">For example, let's say hello parent suddenly fails over tooanother node because it crashed.</span></span> <span data-ttu-id="4ecfa-167">Hello gestione delle risorse Cluster e gestione Failover handle hello failover prima di tutto, poiché mantenendo servizi hello, coerenti e disponibili priorità hello.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-167">hello Cluster Resource Manager and Failover Manager handle hello failover first, since keeping hello services up, consistent, and available is hello priority.</span></span> <span data-ttu-id="4ecfa-168">Al termine del failover hello, relazione di affinità hello viene interrotta, ma hello tutto ciò che è appropriato fino a quando non viene individuata tale elemento figlio hello ritiene di gestione delle risorse Cluster non viene individuato con elemento padre di hello.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-168">Once hello failover completes, hello affinity relationship is broken, but hello Cluster Resource Manager thinks everything is fine until it notices that hello child is not located with hello parent.</span></span> <span data-ttu-id="4ecfa-169">Questi tipi di controlli vengono eseguiti periodicamente.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-169">These sorts of checks are performed periodically.</span></span> <span data-ttu-id="4ecfa-170">Ulteriori informazioni su come gestore delle risorse Cluster hello valuta vincoli sono disponibile in [questo articolo](service-fabric-cluster-resource-manager-management-integration.md#constraint-types), e [questo](service-fabric-cluster-resource-manager-balancing.md) altre informazioni su come tooconfigure hello frequenza in cui questi vincoli sono valutato.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-170">More information on how hello Cluster Resource Manager evaluates constraints is available in [this article](service-fabric-cluster-resource-manager-management-integration.md#constraint-types), and [this one](service-fabric-cluster-resource-manager-balancing.md) talks more about how tooconfigure hello cadence on which these constraints are evaluated.</span></span>   


### <a name="partitioning-support"></a><span data-ttu-id="4ecfa-171">Supporto del partizionamento</span><span class="sxs-lookup"><span data-stu-id="4ecfa-171">Partitioning support</span></span>
<span data-ttu-id="4ecfa-172">Hello ultimo toonotice sull'affinità è che le relazioni di affinità non sono supportate in padre hello è partizionata.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-172">hello final thing toonotice about affinity is that affinity relationships aren’t supported where hello parent is partitioned.</span></span> <span data-ttu-id="4ecfa-173">I servizi padre partizionati potrebbero essere supportati alla fine, ma attualmente non è consentito.</span><span class="sxs-lookup"><span data-stu-id="4ecfa-173">Partitioned parent services may be supported eventually, but today it is not allowed.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4ecfa-174">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="4ecfa-174">Next steps</span></span>
- <span data-ttu-id="4ecfa-175">Per altre informazioni sulla configurazione dei servizi, [Informazioni sulla configurazione dei servizi](service-fabric-cluster-resource-manager-configure-services.md)</span><span class="sxs-lookup"><span data-stu-id="4ecfa-175">For more information on configuring services, [Learn about configuring Services](service-fabric-cluster-resource-manager-configure-services.md)</span></span>
- <span data-ttu-id="4ecfa-176">i servizi toolimit tooa set ridotto di computer o carico hello aggregazione dei servizi, utilizzare [gruppi di applicazioni](service-fabric-cluster-resource-manager-application-groups.md)</span><span class="sxs-lookup"><span data-stu-id="4ecfa-176">toolimit services tooa small set of machines or aggregating hello load of services, use [Application Groups](service-fabric-cluster-resource-manager-application-groups.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-advanced-placement-rules-affinity/cluster-resrouce-manager-affinity-modes.png
[Image2]:./media/service-fabric-cluster-resource-manager-advanced-placement-rules-affinity/cluster-resource-manager-chains-vs-stars.png