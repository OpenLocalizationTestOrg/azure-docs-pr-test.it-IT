---
title: Failback in Azure Site Recovery per macchine virtuali Hyper-V | Documentazione Microsoft
description: Azure Site Recovery coordina la replica, il failover e il ripristino di macchine virtuali e server fisici. Informazioni su come eseguire il failback da Azure al data center locale.
services: site-recovery
documentationcenter: 
author: ruturaj
manager: gauravd
editor: 
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 08/11/2017
ms.author: ruturajd
ms.openlocfilehash: 719fe167c1298d8a48f5906c4e29e5f5825e5aef
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/18/2017
---
# <a name="failback-in-site-recovery-for-hyper-v-virtual-machines"></a><span data-ttu-id="474d3-104">Failback in Site Recovery per macchine virtuali Hyper-V</span><span class="sxs-lookup"><span data-stu-id="474d3-104">Failback in Site Recovery for Hyper-V virtual machines</span></span>

<span data-ttu-id="474d3-105">Questo articolo descrive come eseguire il failback di macchine virtuali protette da Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="474d3-105">This article describes how to failback virtual machines protected by Site Recovery.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="474d3-106">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="474d3-106">Prerequisites</span></span>
1. <span data-ttu-id="474d3-107">Assicurarsi che il server VMM o Hyper-V del sito primario sia connesso.</span><span class="sxs-lookup"><span data-stu-id="474d3-107">Ensure that the primary site VMM server/Hyper-V server is connected.</span></span>
2. <span data-ttu-id="474d3-108">È necessario aver completato il **commit** nella macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="474d3-108">You should have performed **Commit** on the virtual machine.</span></span>

## <a name="why-is-there-no-button-called-failback"></a><span data-ttu-id="474d3-109">Perché non è disponibile alcun pulsante denominato "Failback"?</span><span class="sxs-lookup"><span data-stu-id="474d3-109">Why is there no button called failback?</span></span>
<span data-ttu-id="474d3-110">Nel portale non esiste alcuna azione esplicita chiamata "Failback".</span><span class="sxs-lookup"><span data-stu-id="474d3-110">On the portal, there is no explicit gesture called failback.</span></span> <span data-ttu-id="474d3-111">Il failback è un passaggio in cui si torna al sito primario.</span><span class="sxs-lookup"><span data-stu-id="474d3-111">Failback is a step where you come back to the primary site.</span></span> <span data-ttu-id="474d3-112">Per definizione, il failover è quando si esegue il failover delle macchine virtuali dal sito primario (locale) al sito di ripristino (Azure) e il failback è quando si esegue il failover delle macchine virtuali dal sito di ripristino al sito primario.</span><span class="sxs-lookup"><span data-stu-id="474d3-112">By definition, failover is when you failover the virtual machines from primary(on-premises) site to recovery (Azure), and failback is when you failover the virtual machines from recovery back to primary.</span></span>

<span data-ttu-id="474d3-113">Quando si avvia un failover, il pannello indica la direzione del processo.</span><span class="sxs-lookup"><span data-stu-id="474d3-113">When you initiate a failover, the blade informs you about the direction of the job.</span></span> <span data-ttu-id="474d3-114">Se la direzione è da Azure al sito locale, è un failback.</span><span class="sxs-lookup"><span data-stu-id="474d3-114">If the direction is from Azure to On-premises, it is a failback.</span></span>

## <a name="why-is-there-only-a-planned-failover-gesture-to-failback"></a><span data-ttu-id="474d3-115">Perché esiste una sola azione di failover pianificata per il failback?</span><span class="sxs-lookup"><span data-stu-id="474d3-115">Why is there only a planned failover gesture to failback?</span></span>
<span data-ttu-id="474d3-116">Azure è un ambiente a elevata disponibilità e le macchine virtuali saranno sempre disponibili.</span><span class="sxs-lookup"><span data-stu-id="474d3-116">Azure is a highly available environment and your virtual machines will be always available.</span></span> <span data-ttu-id="474d3-117">Il failback è un'attività pianificata in cui si decide di accettare un breve tempo di inattività in modo che i carichi di lavoro possano iniziare di nuovo a essere eseguiti in locale.</span><span class="sxs-lookup"><span data-stu-id="474d3-117">Failback is a planned activity where you decide to take a small downtime so that the workloads can start running on-premises again.</span></span> <span data-ttu-id="474d3-118">Non è prevista alcuna perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="474d3-118">This expects no data loss.</span></span> <span data-ttu-id="474d3-119">Pertanto è disponibile una sola azione di failover pianificata, che disattiva le VM in Azure, scarica le modifiche più recenti e verifica che non vi sia alcuna perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="474d3-119">Hence only a planned failover gesture is available, that will turn off the VMs in Azure, download the latest changes and ensure there is no data loss.</span></span>

## <a name="initiate-failback"></a><span data-ttu-id="474d3-120">Avviare il failback</span><span class="sxs-lookup"><span data-stu-id="474d3-120">Initiate failback</span></span>
<span data-ttu-id="474d3-121">Dopo il failover dalla posizione primaria alla posizione secondaria, le macchine virtuali replicate non sono protette da Site Recovery e la posizione secondaria funge da posizione attiva.</span><span class="sxs-lookup"><span data-stu-id="474d3-121">After failover from the primary to secondary location, replicated virtual machines aren't protected by Site Recovery, and the secondary location is now acting as the active location.</span></span> <span data-ttu-id="474d3-122">Utilizzare queste procedure per eseguire il failback al sito primario originale.</span><span class="sxs-lookup"><span data-stu-id="474d3-122">Follow these procedures to fail back to the original primary site.</span></span> <span data-ttu-id="474d3-123">Questa procedura descrive come eseguire un failover pianificato per un piano di ripristino.</span><span class="sxs-lookup"><span data-stu-id="474d3-123">This procedure describes how to run a planned failover for a recovery plan.</span></span> <span data-ttu-id="474d3-124">In alternativa è possibile eseguire il failover per una singola macchina nella scheda **Macchine virtuali** .</span><span class="sxs-lookup"><span data-stu-id="474d3-124">Alternatively you can run the failover for a single virtual machine on the **Virtual Machines** tab.</span></span>

1. <span data-ttu-id="474d3-125">Selezionare **Piani di ripristino** > *nome_pianodiripristino*.</span><span class="sxs-lookup"><span data-stu-id="474d3-125">Select **Recovery Plans** > *recoveryplan_name*.</span></span> <span data-ttu-id="474d3-126">Fare clic su **Failover** > **Planned Failover**.</span><span class="sxs-lookup"><span data-stu-id="474d3-126">Click **Failover** > **Planned Failover**.</span></span>
2. <span data-ttu-id="474d3-127">Nella pagina **Conferma failover pianificato** selezionare i percorsi di origine e di destinazione.</span><span class="sxs-lookup"><span data-stu-id="474d3-127">On the **Confirm Planned Failover **page, choose the source and target locations.</span></span> <span data-ttu-id="474d3-128">Prendere nota della direzione del failover.</span><span class="sxs-lookup"><span data-stu-id="474d3-128">Note the failover direction.</span></span> <span data-ttu-id="474d3-129">Se il failover dal sito primario funziona nel modo previsto e tutte le macchine virtuali si trovano nella posizione secondaria, la direzione ha solo scopo informativo.</span><span class="sxs-lookup"><span data-stu-id="474d3-129">If the failover from primary worked as expect and all virtual machines are in the secondary location this is for information only.</span></span>
3. <span data-ttu-id="474d3-130">Se si esegue il failback da Azure, selezionare le impostazioni in **Sincronizzazione dati**:</span><span class="sxs-lookup"><span data-stu-id="474d3-130">If you're failing back from Azure select settings in **Data Synchronization**:</span></span>

   * <span data-ttu-id="474d3-131">**Sincronizza i dati prima del failover (sincronizza solo modifiche differenziali)**: questa opzione riduce al minimo i tempi di inattività delle macchine virtuali poiché le sincronizza senza arrestarle.</span><span class="sxs-lookup"><span data-stu-id="474d3-131">**Synchronize data before failover(Synchronize delta changes only)**—This option minimizes downtime for virtual machines as it synchronizes without shutting them down.</span></span> <span data-ttu-id="474d3-132">Effettua le seguenti operazioni:</span><span class="sxs-lookup"><span data-stu-id="474d3-132">It does the following:</span></span>
     * <span data-ttu-id="474d3-133">Fase 1: Crea uno snapshot della macchina virtuale in Azure e lo copia negli host Hyper-V in locale.</span><span class="sxs-lookup"><span data-stu-id="474d3-133">Phase 1: Takes snapshot of the virtual machine in Azure and copies it to the on-premises Hyper-V host.</span></span> <span data-ttu-id="474d3-134">La macchina continua l'esecuzione in Azure.</span><span class="sxs-lookup"><span data-stu-id="474d3-134">The machine continues running in Azure.</span></span>
     * <span data-ttu-id="474d3-135">Fase 2: Arresta la macchina virtuale in Azure in modo che non vengano apportate nuove modifiche.</span><span class="sxs-lookup"><span data-stu-id="474d3-135">Phase 2: Shuts down the virtual machine in Azure so that no new changes occur there.</span></span> <span data-ttu-id="474d3-136">Il set finale di modifiche differenziali viene trasferito al server locale e viene avviata la macchina virtuale locale.</span><span class="sxs-lookup"><span data-stu-id="474d3-136">The final set of delta changes are transferred to the on-premises server and the on-premises virtual machine is started up.</span></span>

    - <span data-ttu-id="474d3-137">**Sincronizza i dati durante il failover (download completo)**: usare questa opzione se Azure è in esecuzione da molto tempo.</span><span class="sxs-lookup"><span data-stu-id="474d3-137">**Synchronize data during failover only(full download)**—Use this option if you've been running on Azure for a long time.</span></span> <span data-ttu-id="474d3-138">Questa opzione è più veloce perché si prevede che la maggior parte del disco sia cambiata e non si intende sprecare tempo nel calcolo del checksum.</span><span class="sxs-lookup"><span data-stu-id="474d3-138">This option is faster because we expect that most of the disk has changed and we don't want to spend time in checksum calculation.</span></span> <span data-ttu-id="474d3-139">Esegue il download del disco.</span><span class="sxs-lookup"><span data-stu-id="474d3-139">It performs a download of the disk.</span></span> <span data-ttu-id="474d3-140">Questa opzione è utile anche se la macchina virtuale locale è stata eliminata.</span><span class="sxs-lookup"><span data-stu-id="474d3-140">It is also useful when the on-prem virtual machine has been deleted.</span></span>

    >[!NOTE]
    ><span data-ttu-id="474d3-141">È consigliabile scegliere questa opzione se si usa Azure da molto tempo (un mese o più) o se la macchina virtuale locale è stata eliminata. Questa opzione non esegue alcun calcolo del checksum.</span><span class="sxs-lookup"><span data-stu-id="474d3-141">We recommend you use this option if you've been running Azure for a while (a month or more) or the on-prem virtual machine has been deleted.This option doesn't perform any checksum calculations.</span></span>
    >
    >




4. <span data-ttu-id="474d3-142">Se la crittografia dei dati è abilitata per il cloud, in **Chiave di crittografia** selezionare il certificato emesso quando è stata abilitata la crittografia dei dati durante l'installazione del provider nel server VMM.</span><span class="sxs-lookup"><span data-stu-id="474d3-142">If data encryption is enabled for the cloud, in **Encryption Key** select the certificate that was issued when you enabled data encryption during Provider installation on the VMM server.</span></span>
5. <span data-ttu-id="474d3-143">Avviare il failover.</span><span class="sxs-lookup"><span data-stu-id="474d3-143">Initiate the failover.</span></span> <span data-ttu-id="474d3-144">Nella scheda **Processi** è possibile monitorare l’avanzamento del failover.</span><span class="sxs-lookup"><span data-stu-id="474d3-144">You can follow the failover progress on the **Jobs** tab.</span></span>
6. <span data-ttu-id="474d3-145">Se è stata selezionata l'opzione per sincronizzare i dati prima del failover, dopo la sincronizzazione dati iniziale, quando si è pronti ad arrestare le macchine virtuali in Azure, fare clic su **Processi** nome processo failover pianificato **Failover completo**.</span><span class="sxs-lookup"><span data-stu-id="474d3-145">If you selected the option to synchronize the data before the failover, once the initial data synchronization is complete and you're ready to shut down the virtual machines in Azure, click **Jobs** planned failover job name **Complete Failover**.</span></span> <span data-ttu-id="474d3-146">La macchina Azure viene arrestata e le modifiche più recenti vengono trasferite alla macchina virtuale locale, che viene avviata in locale.</span><span class="sxs-lookup"><span data-stu-id="474d3-146">This shuts down the Azure machine, transfers the latest changes to the on-premises virtual machine, and starts the VM on-premises.</span></span>
7. <span data-ttu-id="474d3-147">A questo punto è possibile accedere alla macchina virtuale per verificare che sia disponibile come previsto.</span><span class="sxs-lookup"><span data-stu-id="474d3-147">You can now log onto the virtual machine to validate it's available as expected.</span></span>
8. <span data-ttu-id="474d3-148">La macchina virtuale è in uno stato di attesa di commit.</span><span class="sxs-lookup"><span data-stu-id="474d3-148">The virtual machine is in a commit pending state.</span></span> <span data-ttu-id="474d3-149">Fare clic su **Commit** per eseguire il commit del failover.</span><span class="sxs-lookup"><span data-stu-id="474d3-149">Click **Commit** to commit the failover.</span></span>
9. <span data-ttu-id="474d3-150">Per completare il failback fare clic su **Replica inversa** per iniziare a proteggere la macchina virtuale nel sito primario.</span><span class="sxs-lookup"><span data-stu-id="474d3-150">Now in order to complete the failback click **Reverse Replicate** to start protecting the virtual machine in the primary site.</span></span>

## <a name="failback-to-an-alternate-location"></a><span data-ttu-id="474d3-151">Failback in una posizione alternativa</span><span class="sxs-lookup"><span data-stu-id="474d3-151">Failback to an alternate location</span></span>
<span data-ttu-id="474d3-152">Se è stata distribuita la protezione tra un [sito Hyper-V e Azure](site-recovery-hyper-v-site-to-azure.md) , è possibile eseguire il failback da Azure a una posizione alternativa locale.</span><span class="sxs-lookup"><span data-stu-id="474d3-152">If you've deployed protection between a [Hyper-V site and Azure](site-recovery-hyper-v-site-to-azure.md) you have to ability to failback from Azure to an alternate on-premises location.</span></span> <span data-ttu-id="474d3-153">Ciò è utile se è necessario configurare nuovo hardware locale.</span><span class="sxs-lookup"><span data-stu-id="474d3-153">This is useful if you need to set up new on-premises hardware.</span></span> <span data-ttu-id="474d3-154">Di seguito viene indicato come procedere.</span><span class="sxs-lookup"><span data-stu-id="474d3-154">Here's how you do it.</span></span>

1. <span data-ttu-id="474d3-155">Se si configura nuovo hardware, installare Windows Server 2012 R2 e il ruolo Hyper-V nel server.</span><span class="sxs-lookup"><span data-stu-id="474d3-155">If you're setting up new hardware install Windows Server 2012 R2 and the Hyper-V role on the server.</span></span>
2. <span data-ttu-id="474d3-156">Creare un commutatore di rete virtuale con lo stesso nome presente nel server originale.</span><span class="sxs-lookup"><span data-stu-id="474d3-156">Create a virtual network switch with the same name that you had on the original server.</span></span>
3. <span data-ttu-id="474d3-157">Selezionare **Elementi protetti** -> **Gruppo protezione dati** -> <ProtectionGroupName> -> <VirtualMachineName>di cui si vuole eseguire il failback e selezionare **Failover pianificato**.</span><span class="sxs-lookup"><span data-stu-id="474d3-157">Select **Protected Items** -> **Protection Group** -> <ProtectionGroupName> -> <VirtualMachineName> you want to fail back, and select **Planned Failover**.</span></span>
4. <span data-ttu-id="474d3-158">Fare clic su **Conferma failover pianificato** select **Crea macchina virtuale locale, se non esiste**.</span><span class="sxs-lookup"><span data-stu-id="474d3-158">In **Confirm Planned Failover** select **Create on-premises virtual machine if it does not exist**.</span></span>
5. <span data-ttu-id="474d3-159">In **Nome host** selezionare il nuovo server host Hyper-V in cui si desidera collocare la macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="474d3-159">In **Host Name** select the new Hyper-V host server on which you want to place the virtual machine.</span></span>
6. <span data-ttu-id="474d3-160">In Sincronizzazione dati è consigliabile selezionare l'opzione **Sincronizzare i dati prima del failover**.</span><span class="sxs-lookup"><span data-stu-id="474d3-160">In Data Synchronization we recommend you select  the option **Synchronize the data before the failover**.</span></span> <span data-ttu-id="474d3-161">Questa opzione riduce al minimo i tempi di inattività per le macchine virtuali senza arrestarle.</span><span class="sxs-lookup"><span data-stu-id="474d3-161">This minimizes downtime for virtual machines as it synchronizes without shutting them down.</span></span> <span data-ttu-id="474d3-162">Effettua le seguenti operazioni:</span><span class="sxs-lookup"><span data-stu-id="474d3-162">It does the following:</span></span>

   * <span data-ttu-id="474d3-163">Fase 1: Crea uno snapshot della macchina virtuale in Azure e lo copia negli host Hyper-V in locale.</span><span class="sxs-lookup"><span data-stu-id="474d3-163">Phase 1: Takes snapshot of the virtual machine in Azure and copies it to the on-premises Hyper-V host.</span></span> <span data-ttu-id="474d3-164">La macchina continua l'esecuzione in Azure.</span><span class="sxs-lookup"><span data-stu-id="474d3-164">The machine continues running in Azure.</span></span>
   * <span data-ttu-id="474d3-165">Fase 2: Arresta la macchina virtuale in Azure in modo che non vengano apportate nuove modifiche.</span><span class="sxs-lookup"><span data-stu-id="474d3-165">Phase 2: Shuts down the virtual machine in Azure so that no new changes occur there.</span></span> <span data-ttu-id="474d3-166">Il set finale di modifiche viene trasferito al server locale e viene avviata la macchina virtuale locale.</span><span class="sxs-lookup"><span data-stu-id="474d3-166">The final set of changes are transferred to the on-premises server and the on-premises virtual machine is started up.</span></span>
7. <span data-ttu-id="474d3-167">Fare clic sul segno di spunta per iniziare il failover (failback).</span><span class="sxs-lookup"><span data-stu-id="474d3-167">Click the checkmark to begin the failover (failback).</span></span>
8. <span data-ttu-id="474d3-168">Quando è stata completata la sincronizzazione iniziale e si è pronti per arrestare la macchina virtuale in Azure, fare clic su **Processi** > <planned failover job> > **Failover completo**.</span><span class="sxs-lookup"><span data-stu-id="474d3-168">After the initial synchronization finishes and you're ready to shut down the virtual machine in Azure, click **Jobs** > <planned failover job> > **Complete Failover**.</span></span> <span data-ttu-id="474d3-169">La macchina Azure viene arrestata e le modifiche più recenti vengono trasferite alla macchina virtuale locale, che viene avviata.</span><span class="sxs-lookup"><span data-stu-id="474d3-169">This shuts down the Azure machine, transfers the latest changes to the on-premises virtual machine and starts it.</span></span>
9. <span data-ttu-id="474d3-170">È possibile accedere alla macchina virtuale locale per verificare che tutto funzioni come previsto.</span><span class="sxs-lookup"><span data-stu-id="474d3-170">You can log onto the on-premises virtual machine to verify everything is working as expected.</span></span> <span data-ttu-id="474d3-171">Fare clic su **Commit** per completare il failover.</span><span class="sxs-lookup"><span data-stu-id="474d3-171">Then click **Commit** to finish the failover.</span></span>
10. <span data-ttu-id="474d3-172">Fare clic su **Replica inversa** per iniziare a proteggere la macchina virtuale in locale.</span><span class="sxs-lookup"><span data-stu-id="474d3-172">Click **Reverse Replicate** to start protecting the on-premises virtual machine.</span></span>

    > [!NOTE]
    > <span data-ttu-id="474d3-173">Se si annulla il processo di failback durante la fase di sincronizzazione dei dati, la macchina virtuale locale ne risulterà corrotta.</span><span class="sxs-lookup"><span data-stu-id="474d3-173">If you cancel the failback job while it is in Data Synchronization step, the on-premises VM will be in a corrupted state.</span></span> <span data-ttu-id="474d3-174">Questo avviene perché la sincronizzazione dei dati copia i dati più recenti dai dischi della macchina virtuale di Azure sui dischi di dati locali e, fino al completamento della sincronizzazione, il disco dati potrebbe non trovarsi in uno stato coerente.</span><span class="sxs-lookup"><span data-stu-id="474d3-174">This is because Data Synchronization copies the latest data from Azure VM disks to the on-prem data disks, and until the synchronization completes, the disk data may not be in a consistent state.</span></span> <span data-ttu-id="474d3-175">La macchina virtuale locale potrebbe non avviarsi dopo aver annullato la sincronizzazione dei dati.</span><span class="sxs-lookup"><span data-stu-id="474d3-175">If the On-prem VM is booted after Data Synchronization is canceled, it may not boot.</span></span> <span data-ttu-id="474d3-176">Riattivare il failover per completare la sincronizzazione dei dati.</span><span class="sxs-lookup"><span data-stu-id="474d3-176">Re-trigger failover to complete the Data Synchronization.</span></span>
    >
    >



## <a name="next-steps"></a><span data-ttu-id="474d3-177">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="474d3-177">Next Steps</span></span>

<span data-ttu-id="474d3-178">Dopo aver completato il processo di failback, eseguire il **commit** della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="474d3-178">Once you have completed the failback job, **Commit** the virtual machine.</span></span> <span data-ttu-id="474d3-179">Il commit elimina la macchina virtuale di Azure e i relativi dischi e prepara la VM a essere protetta di nuovo.</span><span class="sxs-lookup"><span data-stu-id="474d3-179">Commit deletes the Azure virtual machine and its disks and prepares the VM to be protected again.</span></span>

<span data-ttu-id="474d3-180">Dopo aver eseguito il **commit**, è possibile avviare la *replica inversa*.</span><span class="sxs-lookup"><span data-stu-id="474d3-180">After **Commit**, you can initiate the *Reverse Replicate*.</span></span> <span data-ttu-id="474d3-181">In questo modo si inizierà a proteggere la macchina virtuale dalla posizione locale ad Azure.</span><span class="sxs-lookup"><span data-stu-id="474d3-181">This will start protecting the virtual machine from on-premises back to Azure.</span></span> <span data-ttu-id="474d3-182">Si noti che saranno replicate solo le modifiche dal momento in cui la VM è stata disattivata in Azure e pertanto saranno inviate solo le modifiche differenziali.</span><span class="sxs-lookup"><span data-stu-id="474d3-182">Note that this will only replicate the changes since the VM has been turned off in Azure and hence sends differential changes only.</span></span>
