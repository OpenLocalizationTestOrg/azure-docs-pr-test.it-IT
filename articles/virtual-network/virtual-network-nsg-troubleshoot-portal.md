---
title: Risolvere i problemi relativi ai gruppi di sicurezza di rete - Portale | Microsoft Docs
description: Informazioni su come risolvere i problemi dei gruppi di sicurezza di rete nel modello di distribuzione Azure Resource Manager tramite il portale di Azure.
services: virtual-network
documentationcenter: na
author: AnithaAdusumilli
manager: narayan
editor: 
tags: azure-resource-manager
ms.assetid: a54feccf-0123-4e49-a743-eb8d0bdd1ebc
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/23/2016
ms.author: anithaa
ms.openlocfilehash: f01d3b43a7953697a6b03e176dace33448d95cd9
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshoot-network-security-groups-using-the-azure-portal"></a><span data-ttu-id="ab40a-103">Risolvere i problemi relativi ai gruppi di sicurezza di rete tramite il portale di Azure</span><span class="sxs-lookup"><span data-stu-id="ab40a-103">Troubleshoot Network Security Groups using the Azure Portal</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="ab40a-104">Portale di Azure</span><span class="sxs-lookup"><span data-stu-id="ab40a-104">Azure Portal</span></span>](virtual-network-nsg-troubleshoot-portal.md)
> * [<span data-ttu-id="ab40a-105">PowerShell</span><span class="sxs-lookup"><span data-stu-id="ab40a-105">PowerShell</span></span>](virtual-network-nsg-troubleshoot-powershell.md)
> 
> 

<span data-ttu-id="ab40a-106">Se sono stati configurati gruppi di sicurezza di rete nella macchina virtuale (VM) e si verificano problemi di connettività alla VM, questo articolo offre una panoramica delle funzionalità di diagnostica per i gruppi di sicurezza di rete per risolvere il problema.</span><span class="sxs-lookup"><span data-stu-id="ab40a-106">If you configured Network Security Groups (NSGs) on your virtual machine (VM) and are experiencing VM connectivity issues, this article provides an overview of diagnostics capabilities for NSGs to help troubleshoot further.</span></span>

<span data-ttu-id="ab40a-107">I gruppi di sicurezza di rete consentono di controllare i tipi di traffico che scorrono dentro e fuori le macchine virtuali (VM).</span><span class="sxs-lookup"><span data-stu-id="ab40a-107">NSGs enable you to control the types of traffic that flow in and out of your virtual machines (VMs).</span></span> <span data-ttu-id="ab40a-108">I gruppi di sicurezza di rete possono essere applicati alle subnet in una rete virtuale di Azure, nelle interfacce di rete o in entrambe.</span><span class="sxs-lookup"><span data-stu-id="ab40a-108">NSGs can be applied to subnets in an Azure Virtual Network (VNet), network interfaces (NIC), or both.</span></span> <span data-ttu-id="ab40a-109">Le regole effettive applicate a un'interfaccia di rete (NIC) sono un'aggregazione delle regole esistenti nei gruppi di sicurezza di rete applicati a un'interfaccia di rete e alla subnet a cui è connessa.</span><span class="sxs-lookup"><span data-stu-id="ab40a-109">The effective rules applied to a NIC are an aggregation of the rules that exist in the NSGs applied to a NIC and the subnet it is connected to.</span></span> <span data-ttu-id="ab40a-110">Talvolta le regole nei gruppi di sicurezza di rete possono essere in conflitto tra loro e influire sulla connettività di rete della VM.</span><span class="sxs-lookup"><span data-stu-id="ab40a-110">Rules across these NSGs can sometimes conflict with each other and impact a VM's network connectivity.</span></span>  

<span data-ttu-id="ab40a-111">È possibile visualizzare tutte le regole di sicurezza effettive dai gruppi di sicurezza di rete, così come vengono applicate nelle interfacce di rete della VM.</span><span class="sxs-lookup"><span data-stu-id="ab40a-111">You can view all the effective security rules from your NSGs, as applied on your VM's NICs.</span></span> <span data-ttu-id="ab40a-112">Questo articolo illustra come risolvere i problemi di connettività delle VM usando queste regole nel modello di distribuzione Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="ab40a-112">This article shows how to troubleshoot VM connectivity issues using these rules in the Azure Resource Manager deployment model.</span></span> <span data-ttu-id="ab40a-113">Se si ha scarsa dimestichezza con i concetti di rete virtuale e gruppo di sicurezza di rete, vedere gli articoli generali sulle [reti virtuali](virtual-networks-overview.md) e sui [gruppi di sicurezza di rete](virtual-networks-nsg.md).</span><span class="sxs-lookup"><span data-stu-id="ab40a-113">If you're not familiar with VNet and NSG concepts, read the [Virtual network](virtual-networks-overview.md) and [Network security groups](virtual-networks-nsg.md) overview articles.</span></span>

## <a name="using-effective-security-rules-to-troubleshoot-vm-traffic-flow"></a><span data-ttu-id="ab40a-114">Uso di regole di sicurezza effettive per risolvere i problemi di flusso del traffico delle VM</span><span class="sxs-lookup"><span data-stu-id="ab40a-114">Using Effective Security Rules to troubleshoot VM traffic flow</span></span>
<span data-ttu-id="ab40a-115">Lo scenario seguente è un esempio di un problema di connessione comune:</span><span class="sxs-lookup"><span data-stu-id="ab40a-115">The scenario that follows is an example of a common connection problem:</span></span>

<span data-ttu-id="ab40a-116">Una macchina virtuale denominata *VM1* fa parte di una subnet denominata *Subnet1* in una rete virtuale denominata *WestUS-VNet1*.</span><span class="sxs-lookup"><span data-stu-id="ab40a-116">A VM named *VM1* is part of a subnet named *Subnet1* within a VNet named *WestUS-VNet1*.</span></span> <span data-ttu-id="ab40a-117">Un tentativo di connettersi alla VM con RDP su porta TCP 3389 ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="ab40a-117">An attempt to connect to the VM using RDP over TCP port 3389 fails.</span></span> <span data-ttu-id="ab40a-118">I gruppi di sicurezza di rete vengono applicati sia all'interfaccia di rete *VM1-NIC1* che alla subnet *Subnet1*.</span><span class="sxs-lookup"><span data-stu-id="ab40a-118">NSGs are applied at both the NIC *VM1-NIC1* and the subnet *Subnet1*.</span></span> <span data-ttu-id="ab40a-119">Il traffico verso la porta TCP 3389 è consentito nel gruppo di sicurezza di rete associato all'interfaccia di rete *VM1 NIC1*, tuttavia il comando ping TCP per VM1 della porta 3389 ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="ab40a-119">Traffic to TCP port 3389 is allowed in the NSG associated with the network interface *VM1-NIC1*, however TCP ping to VM1's port 3389 fails.</span></span>

<span data-ttu-id="ab40a-120">Sebbene in questo esempio si usi la porta TCP 3389, è possibile attenersi alla procedura seguente per determinare gli errori di connessione in ingresso e in uscita su qualsiasi porta.</span><span class="sxs-lookup"><span data-stu-id="ab40a-120">While this example uses TCP port 3389, the following steps can be used to determine inbound and outbound connection failures over any port.</span></span>

### <span data-ttu-id="ab40a-121"><a name="vm"></a>Visualizzare le regole di sicurezza effettive per una macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="ab40a-121"><a name="vm"></a>View effective security rules for a virtual machine</span></span>
<span data-ttu-id="ab40a-122">Completare i passaggi seguenti per risolvere i problemi dei gruppi di sicurezza di rete per una VM:</span><span class="sxs-lookup"><span data-stu-id="ab40a-122">Complete the following steps to troubleshoot NSGs for a VM:</span></span>

<span data-ttu-id="ab40a-123">È possibile visualizzare l'elenco completo delle regole di sicurezza effettive in un'interfaccia di rete dalla VM stessa.</span><span class="sxs-lookup"><span data-stu-id="ab40a-123">You can view full list of the effective security rules on a NIC, from the VM itself.</span></span> <span data-ttu-id="ab40a-124">È anche possibile aggiungere, modificare ed eliminare le regole dei gruppi di sicurezza di rete per subnet e interfacce di rete usando il pannello delle regole effettive, se si hanno le autorizzazioni per eseguire queste operazioni.</span><span class="sxs-lookup"><span data-stu-id="ab40a-124">You can also add, modify, and delete both NIC and subnet NSG rules from the effective rules blade, if you have permissions to perform these operations.</span></span>

1. <span data-ttu-id="ab40a-125">Accedere al portale di Azure all'indirizzo https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="ab40a-125">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="ab40a-126">Fare clic su **Altri servizi** e quindi su **Macchine virtuali** nell'elenco visualizzato.</span><span class="sxs-lookup"><span data-stu-id="ab40a-126">Click **More services**, then click **Virtual machines** in the list that appears.</span></span>
3. <span data-ttu-id="ab40a-127">Selezionare una VM in cui risolvere i problemi nell'elenco visualizzato. Verrà visualizzato un pannello della VM contenente opzioni.</span><span class="sxs-lookup"><span data-stu-id="ab40a-127">Select a VM to troubleshoot from the list that appears and a VM blade with options appears.</span></span>
4. <span data-ttu-id="ab40a-128">Fare clic su **Diagnostica e risoluzione dei problemi** e quindi selezionare un problema comune.</span><span class="sxs-lookup"><span data-stu-id="ab40a-128">Click **Diagnose & solve problems** and then select a common problem.</span></span> <span data-ttu-id="ab40a-129">Per questo esempio si seleziona **Non è possibile connettersi alla macchina virtuale Windows** .</span><span class="sxs-lookup"><span data-stu-id="ab40a-129">For this example, **I can’t connect to my Windows VM** is selected.</span></span> 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image1.png)
5. <span data-ttu-id="ab40a-130">Sotto il problema vengono visualizzati i passaggi, come illustrato nell'immagine seguente:</span><span class="sxs-lookup"><span data-stu-id="ab40a-130">Steps appear under the problem, as shown in the following picture:</span></span> 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image2.png)
   
    <span data-ttu-id="ab40a-131">Fare clic su *effective security group rules* (regole effettive del gruppo di sicurezza) nell'elenco dei passaggi consigliati.</span><span class="sxs-lookup"><span data-stu-id="ab40a-131">Click *effective security group rules* in the list of recommended steps.</span></span>
6. <span data-ttu-id="ab40a-132">Verrà visualizzato il pannello **Ottieni regole di sicurezza valide** , come illustrato nell'immagine seguente:</span><span class="sxs-lookup"><span data-stu-id="ab40a-132">The **Get effective security rules** blade appears, as shown in the following picture:</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image3.png)
   
    <span data-ttu-id="ab40a-133">Si notino le sezioni seguenti dell'immagine:</span><span class="sxs-lookup"><span data-stu-id="ab40a-133">Notice the following sections of the picture:</span></span>
   
   * <span data-ttu-id="ab40a-134">**Ambito:** impostato su *VM1*, ovvero la VM selezionata nel passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="ab40a-134">**Scope:** Set to *VM1*, the VM selected in step 3.</span></span>
   * <span data-ttu-id="ab40a-135">**Interfaccia di rete:** *VM1-NIC1* .</span><span class="sxs-lookup"><span data-stu-id="ab40a-135">**Network interface:** *VM1-NIC1* is selected.</span></span> <span data-ttu-id="ab40a-136">Una VM può avere più interfacce di rete (NIC).</span><span class="sxs-lookup"><span data-stu-id="ab40a-136">A VM can have multiple network interfaces (NIC).</span></span> <span data-ttu-id="ab40a-137">Ogni interfaccia di rete può avere regole di sicurezza effettive univoche.</span><span class="sxs-lookup"><span data-stu-id="ab40a-137">Each NIC can have unique effective security rules.</span></span> <span data-ttu-id="ab40a-138">Per risolvere il problema può essere necessario visualizzare le regole di sicurezza effettive per ogni interfaccia di rete.</span><span class="sxs-lookup"><span data-stu-id="ab40a-138">When troubleshooting, you may need to view the effective security rules for each NIC.</span></span>
   * <span data-ttu-id="ab40a-139">**Gruppi di sicurezza di rete associati:** i gruppi di sicurezza di rete possono essere applicati sia all'interfaccia di rete che alla subnet cui è connessa l'interfaccia di rete.</span><span class="sxs-lookup"><span data-stu-id="ab40a-139">**Associated NSGs:** NSGs can be applied to both the NIC and the subnet the NIC is connected to.</span></span> <span data-ttu-id="ab40a-140">Nell'immagine, il gruppo di sicurezza di rete è stato applicato sia all'interfaccia di rete che alla subnet cui è connessa.</span><span class="sxs-lookup"><span data-stu-id="ab40a-140">In the picture, an NSG has been applied to both the NIC and the subnet it's connected to.</span></span> <span data-ttu-id="ab40a-141">È possibile fare clic sui nomi dei gruppi di sicurezza di rete per modificare le regole direttamente nei gruppi stessi.</span><span class="sxs-lookup"><span data-stu-id="ab40a-141">You can click on the NSG names to directly modify rules in the NSGs.</span></span>
   * <span data-ttu-id="ab40a-142">**Scheda VM1-nsg:** l'elenco delle regole visualizzate nell'immagine si riferisce al gruppo di sicurezza di rete applicato all'interfaccia di rete.</span><span class="sxs-lookup"><span data-stu-id="ab40a-142">**VM1-nsg tab:** The list of rules displayed in the picture is for the NSG applied to the NIC.</span></span> <span data-ttu-id="ab40a-143">Azure crea diverse regole predefinite quando viene creato un gruppo di sicurezza di rete.</span><span class="sxs-lookup"><span data-stu-id="ab40a-143">Several default rules are created by Azure whenever an NSG is created.</span></span> <span data-ttu-id="ab40a-144">Non è possibile rimuovere le regole predefinite, ma è possibile eseguirne l'override con regole di priorità più alta.</span><span class="sxs-lookup"><span data-stu-id="ab40a-144">You can't remove the default rules, but you can override them with rules of higher priority.</span></span> <span data-ttu-id="ab40a-145">Per altre informazioni sulle regole predefinite, vedere l'articolo generale sui [gruppi di sicurezza di rete](virtual-networks-nsg.md#default-rules) .</span><span class="sxs-lookup"><span data-stu-id="ab40a-145">To learn more about default rules, read the [NSG overview](virtual-networks-nsg.md#default-rules) article.</span></span>
   * <span data-ttu-id="ab40a-146">**Colonna DESTINAZIONE:** alcune regole hanno testo nella colonna, mentre altre hanno prefissi di indirizzo.</span><span class="sxs-lookup"><span data-stu-id="ab40a-146">**DESTINATION column:** Some of the rules have text in the column, while others have address prefixes.</span></span> <span data-ttu-id="ab40a-147">Il testo è il nome dei tag predefiniti applicati alla regola di sicurezza al momento della creazione.</span><span class="sxs-lookup"><span data-stu-id="ab40a-147">The text is the name of default tags applied to the security rule when it was created.</span></span> <span data-ttu-id="ab40a-148">I tag sono identificatori forniti dal sistema che rappresentano più prefissi.</span><span class="sxs-lookup"><span data-stu-id="ab40a-148">The tags are system-provided identifiers that represent multiple prefixes.</span></span> <span data-ttu-id="ab40a-149">Selezionando una regola con un tag, ad esempio *AllowInternetOutBound*, sarà possibile visualizzare i prefissi nel pannello **Prefissi degli indirizzi** .</span><span class="sxs-lookup"><span data-stu-id="ab40a-149">Selecting a rule with a tag, such as *AllowInternetOutBound*, lists the prefixes in the **Address prefixes** blade.</span></span>
   * <span data-ttu-id="ab40a-150">**Scarica:** l'elenco di regole può essere lungo.</span><span class="sxs-lookup"><span data-stu-id="ab40a-150">**Download:** The list of rules can be long.</span></span> <span data-ttu-id="ab40a-151">È possibile fare clic su **Scarica** e salvare un file CSV delle regole per eseguire l'analisi offline.</span><span class="sxs-lookup"><span data-stu-id="ab40a-151">You can download a .csv file of the rules for offline analysis by clicking **Download** and saving the file.</span></span>
   * <span data-ttu-id="ab40a-152">**AllowRDP** : questa regola consente le connessioni RDP alla VM.</span><span class="sxs-lookup"><span data-stu-id="ab40a-152">**AllowRDP** Inbound rule: This rule allows RDP connections to the VM.</span></span>
7. <span data-ttu-id="ab40a-153">Fare clic sulla scheda **Subnet1-NSG** per visualizzare le regole effettive del gruppo di sicurezza di rete applicato alla subnet, come illustrato nell'immagine seguente:</span><span class="sxs-lookup"><span data-stu-id="ab40a-153">Click the **Subnet1-NSG** tab to view the effective rules from the NSG applied to the subnet, as shown in the following picture:</span></span> 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image4.png)
   
    <span data-ttu-id="ab40a-154">Si noti la regola *in ingresso* **denyRDP** .</span><span class="sxs-lookup"><span data-stu-id="ab40a-154">Notice the *denyRDP* **Inbound** rule.</span></span> <span data-ttu-id="ab40a-155">Le regole in ingresso applicate alla subnet vengono valutate prima delle regole applicate all'interfaccia di rete.</span><span class="sxs-lookup"><span data-stu-id="ab40a-155">Inbound rules applied at the subnet are evaluated before rules applied at the network interface.</span></span> <span data-ttu-id="ab40a-156">La regola di accesso negato viene applicata alla subnet, quindi la richiesta di connessione alla porta TCP 3389 ha esito negativo perché la regola di accesso consentito applicata all'interfaccia di rete non viene mai valutata.</span><span class="sxs-lookup"><span data-stu-id="ab40a-156">Since the deny rule is applied at the subnet, the request to connect to TCP 3389 fails, because the allow rule at the NIC is never evaluated.</span></span> 
   
    <span data-ttu-id="ab40a-157">La regola *denyRDP* è il motivo per cui la connessione RDP ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="ab40a-157">The *denyRDP* rule is the reason why the RDP connection is failing.</span></span> <span data-ttu-id="ab40a-158">Rimuovere la regola per risolvere il problema.</span><span class="sxs-lookup"><span data-stu-id="ab40a-158">Removing it should resolve the problem.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="ab40a-159">Se la VM associata all'interfaccia di rete non è in esecuzione oppure non sono stati applicati gruppi di sicurezza di rete all'interfaccia di rete o alla subnet, non verranno visualizzate regole.</span><span class="sxs-lookup"><span data-stu-id="ab40a-159">If the VM associated with the NIC is not in a running state, or NSGs haven't been applied to the NIC or subnet, no rules are shown.</span></span>
   > 
   > 
8. <span data-ttu-id="ab40a-160">Per modificare le regole del gruppo di sicurezza di rete, fare clic su *Subnet1-NSG* nella sezione **Gruppi di sicurezza di rete associati** .</span><span class="sxs-lookup"><span data-stu-id="ab40a-160">To edit NSG rules, click *Subnet1-NSG* in the **Associated NSGs** section.</span></span>
   <span data-ttu-id="ab40a-161">Verrà visualizzato il pannello **Subnet1-NSG** .</span><span class="sxs-lookup"><span data-stu-id="ab40a-161">This opens the **Subnet1-NSG** blade.</span></span> <span data-ttu-id="ab40a-162">È possibile modificare le regole direttamente facendo clic su **Regole di sicurezza in ingresso**.</span><span class="sxs-lookup"><span data-stu-id="ab40a-162">You can directly edit the rules by clicking on **Inbound security rules**.</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image7.png)
9. <span data-ttu-id="ab40a-163">Dopo aver rimosso la regola in ingresso *denyRDP* dal gruppo di sicurezza di rete **Subnet1-NSG** e aver aggiunto una regola *allowRDP*, l'elenco delle regole effettive sarà simile all'immagine seguente:</span><span class="sxs-lookup"><span data-stu-id="ab40a-163">After removing the *denyRDP* inbound rule in the **Subnet1-NSG** and adding an *allowRDP* rule, the effective rules list looks like the following picture:</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image8.png)
   
    <span data-ttu-id="ab40a-164">Verificare che la porta TCP 3389 sia aperta aprendo una connessione RDP alla VM o usando lo strumento PsPing.</span><span class="sxs-lookup"><span data-stu-id="ab40a-164">Confirm that TCP port 3389 is open by opening an RDP connection to the VM or using the PsPing tool.</span></span> <span data-ttu-id="ab40a-165">Per altre informazioni su PsPing, vedere la [pagina di download di PsPing](https://technet.microsoft.com/sysinternals/psping.aspx).</span><span class="sxs-lookup"><span data-stu-id="ab40a-165">You can learn more about PsPing by reading the [PsPing download page](https://technet.microsoft.com/sysinternals/psping.aspx).</span></span>

### <span data-ttu-id="ab40a-166"><a name="nic"></a>Visualizzare le regole di sicurezza effettive per un'interfaccia di rete</span><span class="sxs-lookup"><span data-stu-id="ab40a-166"><a name="nic"></a>View effective security rules for a network interface</span></span>
<span data-ttu-id="ab40a-167">In caso di problemi con il flusso del traffico della VM in un'interfaccia di rete specifica, è possibile visualizzare un elenco completo delle regole effettive nel contesto dell'interfaccia di rete seguendo questa procedura:</span><span class="sxs-lookup"><span data-stu-id="ab40a-167">If your VM traffic flow is impacted for a specific NIC, you can view a full list of the effective rules for the NIC from the network interfaces context by completing the following steps:</span></span>

1. <span data-ttu-id="ab40a-168">Accedere al portale di Azure all'indirizzo https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="ab40a-168">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="ab40a-169">Fare clic su **Altri servizi** e quindi su **Interfacce di rete** nell'elenco visualizzato.</span><span class="sxs-lookup"><span data-stu-id="ab40a-169">Click **More services**, then click **Network interfaces** in the list that appears.</span></span>
3. <span data-ttu-id="ab40a-170">Selezionare un'interfaccia di rete.</span><span class="sxs-lookup"><span data-stu-id="ab40a-170">Select a network interface.</span></span> <span data-ttu-id="ab40a-171">Nell'immagine seguente è stata selezionata un'interfaccia di rete denominata *VM1-NIC1* .</span><span class="sxs-lookup"><span data-stu-id="ab40a-171">In the following picture, a NIC named *VM1-NIC1* is selected.</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image5.png)
   
    <span data-ttu-id="ab40a-172">Si noti che il valore di **Ambito** corrisponde all'interfaccia di rete selezionata.</span><span class="sxs-lookup"><span data-stu-id="ab40a-172">Notice that the **Scope** is set to the network interface selected.</span></span> <span data-ttu-id="ab40a-173">Per informazioni sugli altri dati visualizzati, vedere il passaggio 6 della sezione relativa alla **risoluzione dei problemi dei gruppi di sicurezza di rete per una VM** di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="ab40a-173">To learn more about the additional information shown, read step 6 of the **Troubleshoot NSGs for a VM** section of this article.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="ab40a-174">Se un gruppo di sicurezza di rete viene rimosso da un'interfaccia di rete, il gruppo di sicurezza di rete della subnet è ancora valido per l'interfaccia di rete specificata.</span><span class="sxs-lookup"><span data-stu-id="ab40a-174">If an NSG is removed from a network interface, the subnet NSG is still effective on the given NIC.</span></span> <span data-ttu-id="ab40a-175">In questo caso, l'output visualizzerà solo le regole del gruppo di sicurezza di rete della subnet.</span><span class="sxs-lookup"><span data-stu-id="ab40a-175">In this case, the output would only show rules from the subnet NSG.</span></span> <span data-ttu-id="ab40a-176">Le regole vengono visualizzate solo se l'interfaccia di rete è collegata a una VM.</span><span class="sxs-lookup"><span data-stu-id="ab40a-176">Rules only appear if the NIC is attached to a VM.</span></span>
   > 
   > 
4. <span data-ttu-id="ab40a-177">È possibile modificare direttamente le regole per i gruppi di sicurezza di rete associati a un'interfaccia di rete e a una subnet.</span><span class="sxs-lookup"><span data-stu-id="ab40a-177">You can directly edit rules for NSGs associated with a NIC and a subnet.</span></span> <span data-ttu-id="ab40a-178">Per informazioni su questa procedura, vedere il passaggio 8 della sezione **Visualizzare le regole di sicurezza effettive per una macchina virtuale** di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="ab40a-178">To learn how, read step 8 of the **View effective security rules for a virtual machine** section of this article.</span></span>

## <span data-ttu-id="ab40a-179"><a name="nsg"></a>Visualizzare le regole di sicurezza effettive per un gruppo di sicurezza di rete</span><span class="sxs-lookup"><span data-stu-id="ab40a-179"><a name="nsg"></a>View effective security rules for a network security group (NSG)</span></span>
<span data-ttu-id="ab40a-180">Quando si modificano le regole del gruppo di sicurezza di rete, può essere opportuno esaminare l'impatto delle regole aggiunte in una determinata VM.</span><span class="sxs-lookup"><span data-stu-id="ab40a-180">When modifying NSG rules, you may want to review the impact of the rules being added on a particular VM.</span></span> <span data-ttu-id="ab40a-181">È possibile visualizzare l'elenco completo delle regole di sicurezza effettive per tutte le interfacce di rete a cui è applicato un determinato gruppo di sicurezza di rete, restando nel contesto del pannello dello specifico gruppo di sicurezza di rete.</span><span class="sxs-lookup"><span data-stu-id="ab40a-181">You can view a full list of the effective security rules for all the NICs that a given NSG is applied to, without having to switch context from the given NSG blade.</span></span> <span data-ttu-id="ab40a-182">Per risolvere i problemi delle regole effettive in un gruppo di sicurezza di rete, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="ab40a-182">To troubleshoot effective rules within an NSG, complete the following steps:</span></span>

1. <span data-ttu-id="ab40a-183">Accedere al portale di Azure all'indirizzo https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="ab40a-183">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="ab40a-184">Fare clic su **Altri servizi** e quindi su **Gruppi di sicurezza di rete** nell'elenco visualizzato.</span><span class="sxs-lookup"><span data-stu-id="ab40a-184">Click **More services**, then click **Network security groups** in the list that appears.</span></span>
3. <span data-ttu-id="ab40a-185">Selezionare un gruppo di sicurezza di rete.</span><span class="sxs-lookup"><span data-stu-id="ab40a-185">Select an NSG.</span></span> <span data-ttu-id="ab40a-186">Nell'immagine seguente è stato selezionato un gruppo di sicurezza di rete denominato VM1-nsg.</span><span class="sxs-lookup"><span data-stu-id="ab40a-186">In the following picture, an NSG named VM1-nsg was selected.</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image6.png)
   
    <span data-ttu-id="ab40a-187">Si notino le sezioni seguenti dell'immagine precedente:</span><span class="sxs-lookup"><span data-stu-id="ab40a-187">Notice the following sections of the previous picture:</span></span>
   
   * <span data-ttu-id="ab40a-188">**Ambito:** impostato sul gruppo di sicurezza di rete selezionato.</span><span class="sxs-lookup"><span data-stu-id="ab40a-188">**Scope:** Set to the NSG selected.</span></span>
   * <span data-ttu-id="ab40a-189">**Macchina virtuale:** quando un gruppo di sicurezza di rete è applicato a una subnet, viene applicato a tutte le interfacce di rete collegate a tutte le VM connesse alla subnet.</span><span class="sxs-lookup"><span data-stu-id="ab40a-189">**Virtual machine:** When an NSG is applied to a subnet, it's applied to all network interfaces attached to all VMs connected to the subnet.</span></span> <span data-ttu-id="ab40a-190">Questo elenco indica tutte le VM alle quali è applicato questo gruppo di sicurezza di rete.</span><span class="sxs-lookup"><span data-stu-id="ab40a-190">This list shows all VMs this NSG is applied to.</span></span> <span data-ttu-id="ab40a-191">È possibile selezionare una VM qualsiasi dall'elenco.</span><span class="sxs-lookup"><span data-stu-id="ab40a-191">You can select any VM from the list.</span></span>
     
     > [!NOTE]
     > <span data-ttu-id="ab40a-192">Se un gruppo di sicurezza di rete viene applicato solo a una subnet vuota, le VM non verranno elencate.</span><span class="sxs-lookup"><span data-stu-id="ab40a-192">If an NSG is applied to only an empty subnet, VMs will not be listed.</span></span> <span data-ttu-id="ab40a-193">Se un gruppo di sicurezza di rete viene applicato a un'interfaccia di rete che non è associata a una VM, non verrà elencata neanche quella interfaccia di rete.</span><span class="sxs-lookup"><span data-stu-id="ab40a-193">If an NSG is applied to a NIC which is not associated with a VM, those NICs will also not be listed.</span></span> 
     > 
     > 
   * <span data-ttu-id="ab40a-194">**Interfaccia di rete:** una macchina virtuale può avere più interfacce di rete.</span><span class="sxs-lookup"><span data-stu-id="ab40a-194">**Network Interface:** A VM can have multiple network interfaces.</span></span> <span data-ttu-id="ab40a-195">È possibile selezionare un'interfaccia di rete collegata alla VM selezionata.</span><span class="sxs-lookup"><span data-stu-id="ab40a-195">You can select a network interface attached to the selected VM.</span></span>
   * <span data-ttu-id="ab40a-196">**Gruppi di sicurezza di rete associati:** un'interfaccia di rete può avere sempre fino a due gruppi di sicurezza di rete effettivi, uno applicato all'interfaccia di rete e l'altro alla subnet.</span><span class="sxs-lookup"><span data-stu-id="ab40a-196">**AssociatedNSGs:** At any time, a NIC can have up to two effective NSGs, one applied to the NIC and the other to the subnet.</span></span> <span data-ttu-id="ab40a-197">Anche se per l'ambito viene selezionato VM1-nsg, l'output visualizzerà entrambi i gruppi di sicurezza di rete se l'interfaccia di rete ha un gruppo di sicurezza di rete effettivo per la subnet.</span><span class="sxs-lookup"><span data-stu-id="ab40a-197">Although the scope is selected as VM1-nsg, if the NIC has an effective subnet NSG, the output will show both NSGs.</span></span>
4. <span data-ttu-id="ab40a-198">È possibile modificare direttamente le regole per i gruppi di sicurezza di rete associati a un'interfaccia di rete o a una subnet.</span><span class="sxs-lookup"><span data-stu-id="ab40a-198">You can directly edit rules for NSGs associated with a NIC or subnet.</span></span> <span data-ttu-id="ab40a-199">Per informazioni su questa procedura, vedere il passaggio 8 della sezione **Visualizzare le regole di sicurezza effettive per una macchina virtuale** di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="ab40a-199">To learn how, read step 8 of the **View effective security rules for a virtual machine** section of this article.</span></span>

<span data-ttu-id="ab40a-200">Per informazioni sugli altri dati visualizzati, vedere il passaggio 6 della sezione **Visualizzare le regole di sicurezza effettive per una macchina virtuale** di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="ab40a-200">To learn more about the additional information shown, read step 6 of the **View effective security rules for a virtual machine** section of this article.</span></span>

> [!NOTE]
> <span data-ttu-id="ab40a-201">Anche se è possibile applicare un solo gruppo di sicurezza di rete a una singola subnet o interfaccia di rete, un gruppo di sicurezza di rete può essere associato a più interfacce di rete e più subnet.</span><span class="sxs-lookup"><span data-stu-id="ab40a-201">Though a subnet and NIC can each have only one NSG applied to them, an NSG can be associated to multiple NICs and multiple subnets.</span></span>
> 
> 

## <a name="considerations"></a><span data-ttu-id="ab40a-202">Considerazioni</span><span class="sxs-lookup"><span data-stu-id="ab40a-202">Considerations</span></span>
<span data-ttu-id="ab40a-203">Durante la risoluzione dei problemi di connettività, tenere presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="ab40a-203">Consider the following points when troubleshooting connectivity problems:</span></span>

* <span data-ttu-id="ab40a-204">Le regole predefinite dei gruppi di sicurezza di rete bloccano l'accesso in ingresso da Internet e consentono solo il traffico di rete in ingresso nella rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="ab40a-204">Default NSG rules will block inbound access from the internet and only permit VNet inbound traffic.</span></span> <span data-ttu-id="ab40a-205">È necessario aggiungere regole in modo esplicito per consentire l'accesso in ingresso da Internet, come richiesto.</span><span class="sxs-lookup"><span data-stu-id="ab40a-205">Rules should be explicitly added to allow inbound access from Internet, as required.</span></span>
* <span data-ttu-id="ab40a-206">Se non sono presenti regole dei gruppi di sicurezza di rete che causano un errore di connettività della VM, il problema potrebbe essere dovuto a:</span><span class="sxs-lookup"><span data-stu-id="ab40a-206">If there are no NSG security rules causing a VM’s network connectivity to fail, the problem may be due to:</span></span>
  * <span data-ttu-id="ab40a-207">Software del firewall in esecuzione all'interno del sistema operativo della VM</span><span class="sxs-lookup"><span data-stu-id="ab40a-207">Firewall software running within the VM's operating system</span></span>
  * <span data-ttu-id="ab40a-208">Route configurate per appliance virtuali o traffico locale.</span><span class="sxs-lookup"><span data-stu-id="ab40a-208">Routes configured for virtual appliances or on-premises traffic.</span></span> <span data-ttu-id="ab40a-209">Il traffico Internet può essere reindirizzato al traffico locale tramite tunneling forzato.</span><span class="sxs-lookup"><span data-stu-id="ab40a-209">Internet traffic can be redirected to on-premises via forced-tunneling.</span></span> <span data-ttu-id="ab40a-210">Una connessione RDP o SSH da Internet alla VM potrebbe non funzionare con questa impostazione, a seconda di come l'hardware di rete locale gestisce questo traffico.</span><span class="sxs-lookup"><span data-stu-id="ab40a-210">An RDP/SSH connection from the Internet to your VM may not work with this setting, depending on how the on-premises network hardware handles this traffic.</span></span> <span data-ttu-id="ab40a-211">Per informazioni su come diagnosticare problemi di route che potrebbero impedire il flusso del traffico in ingresso e in uscita dalla VM, vedere l'articolo [Troubleshooting Routes](virtual-network-routes-troubleshoot-powershell.md) (Risoluzione dei problemi di route).</span><span class="sxs-lookup"><span data-stu-id="ab40a-211">Read the [Troubleshooting Routes](virtual-network-routes-troubleshoot-powershell.md) article to learn how to diagnose route problems that may be impeding the flow of traffic in and out of the VM.</span></span> 
* <span data-ttu-id="ab40a-212">Se si hanno reti virtuali con peering, il tag VIRTUAL_NETWORK si espanderà automaticamente per impostazione predefinita in modo da includere i prefissi delle reti virtuali con peering.</span><span class="sxs-lookup"><span data-stu-id="ab40a-212">If you have peered VNets, by default, the VIRTUAL_NETWORK tag will automatically expand to include prefixes for peered VNets.</span></span> <span data-ttu-id="ab40a-213">È possibile vedere questi prefissi nell'elenco **ExpandedAddressPrefix** per risolvere eventuali problemi legati alla connettività di peering della rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="ab40a-213">You can view these prefixes in the **ExpandedAddressPrefix** list, to troubleshoot any issues related to VNet peering connectivity.</span></span> 
* <span data-ttu-id="ab40a-214">Le regole di sicurezza effettive vengono visualizzate solo se c'è un gruppo di sicurezza di rete associato all'interfaccia di rete o alla subnet della VM.</span><span class="sxs-lookup"><span data-stu-id="ab40a-214">Effective security rules are only shown if there is an NSG associated with the VM’s NIC and or subnet.</span></span> 
* <span data-ttu-id="ab40a-215">Se non esistono gruppi di sicurezza di rete associati all'interfaccia di rete o alla subnet e si dispone di un indirizzo IP pubblico assegnato alla VM, tutte le porte saranno aperte per l'accesso in ingresso e in uscita.</span><span class="sxs-lookup"><span data-stu-id="ab40a-215">If there are no NSGs associated with the NIC or subnet and you have a public IP address assigned to your VM, all ports will be open for inbound and outbound access.</span></span> <span data-ttu-id="ab40a-216">Se la VM ha un indirizzo IP pubblico, è consigliabile applicare gruppi di sicurezza di rete all'interfaccia di rete o alla subnet.</span><span class="sxs-lookup"><span data-stu-id="ab40a-216">If the VM has a public IP address, applying NSGs to the NIC or subnet is strongly recommended.</span></span>

