---
title: risoluzione dei problemi di disco crittografia aaaAzure | Documenti Microsoft
description: Questo articolo offre suggerimenti per la risoluzione dei problemi di Crittografia dischi di Microsoft Azure per VM IaaS Windows e Linux.
services: security
documentationcenter: na
author: deventiwari
manager: avibm
editor: yuridio
ms.assetid: ce0e23bd-07eb-43af-a56c-aa1a73bdb747
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/27/2017
ms.author: devtiw
ms.openlocfilehash: 2ecb8df1fb869e3bf8f3be4be4494e6485e75695
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="azure-disk-encryption-troubleshooting-guide"></a><span data-ttu-id="c23d7-103">Guida alla risoluzione dei problemi di Crittografia dischi di Azure</span><span class="sxs-lookup"><span data-stu-id="c23d7-103">Azure Disk Encryption Troubleshooting Guide</span></span>

<span data-ttu-id="c23d7-104">Questa guida è per i professionisti IT (IT), informazioni agli analisti della sicurezza e problemi relativi agli amministratori del cloud il cui organizzazioni utilizzano la crittografia del disco di Azure e disco tootroubleshoot materiale sussidiario per la crittografia è necessario.</span><span class="sxs-lookup"><span data-stu-id="c23d7-104">This guide is for information technology (IT) professionals, information security analysts, and cloud administrators whose organizations are using Azure disk encryption and need guidance tootroubleshoot disk-encryption related issues.</span></span>

## <a name="troubleshooting-linux-os-disk-encryption"></a><span data-ttu-id="c23d7-105">Risoluzione dei problemi relativi alla crittografia del disco del sistema operativo Linux</span><span class="sxs-lookup"><span data-stu-id="c23d7-105">Troubleshooting Linux OS disk encryption</span></span>

<span data-ttu-id="c23d7-106">Crittografia del disco del sistema operativo Linux è necessario smontare hello del sistema operativo unità precedente toorunning tramite processo di crittografia di hello disco pieno.</span><span class="sxs-lookup"><span data-stu-id="c23d7-106">Linux OS disk encryption must unmount hello OS drive prior toorunning it through hello full disk encryption process.</span></span>   <span data-ttu-id="c23d7-107">Se non è possibile, un messaggio di errore "Impossibile toounmount dopo..."</span><span class="sxs-lookup"><span data-stu-id="c23d7-107">If it cannot, an error message of "failed toounmount after…"</span></span> <span data-ttu-id="c23d7-108">messaggio di errore è probabilmente toooccur.</span><span class="sxs-lookup"><span data-stu-id="c23d7-108">error message is likely toooccur.</span></span>

<span data-ttu-id="c23d7-109">È molto probabile che ciò si verifichi quando si tenta di eseguire la crittografia del disco del sistema operativo in un ambiente di VM di destinazione che è stato modificato rispetto all'immagine predefinita supportata della raccolta.</span><span class="sxs-lookup"><span data-stu-id="c23d7-109">This is most likely when OS disk encryption is attempted on a target VM environment that has been modified or changed from its supported stock gallery image.</span></span>  <span data-ttu-id="c23d7-110">Esempi di deviazioni dall'immagine hello è supportato, che può interferire con l'unità di hello del sistema operativo toounmount possibilità dell'estensione hello:</span><span class="sxs-lookup"><span data-stu-id="c23d7-110">Examples of deviations from hello supported image, which can interfere with hello extension’s ability toounmount hello OS drive include:</span></span>
- <span data-ttu-id="c23d7-111">Immagini personalizzate che non corrispondono più al file system e/o allo schema di partizionamento supportato.</span><span class="sxs-lookup"><span data-stu-id="c23d7-111">Customized images that no longer match a supported file system and/or partitioning scheme.</span></span>
- <span data-ttu-id="c23d7-112">Immagini personalizzate con applicazioni, ad esempio antivirus, Docker, SAP, MongoDB o Cassandra Apache in esecuzione in tooencryption di hello del sistema operativo precedente.</span><span class="sxs-lookup"><span data-stu-id="c23d7-112">Customized images with applications such as antivirus, Docker, SAP, MongoDB, or Apache Cassandra running in hello OS prior tooencryption.</span></span>  <span data-ttu-id="c23d7-113">Queste applicazioni sono tooterminate difficile e quando hanno mantenuto unità toohello del sistema operativo gli handle di file aperti, unità hello non può essere disinstallato, causando un errore.</span><span class="sxs-lookup"><span data-stu-id="c23d7-113">These applications are difficult tooterminate, and when they retain open file handles toohello OS drive, hello drive cannot be unmounted, causing failure.</span></span>
- <span data-ttu-id="c23d7-114">Gli script personalizzati eseguiti in chiudono ora passaggio di crittografia di prossimità toohello può interferire e causa questo errore.</span><span class="sxs-lookup"><span data-stu-id="c23d7-114">Custom scripts that run in close time proximity toohello encryption step can interfere and cause this failure.</span></span> <span data-ttu-id="c23d7-115">Questa situazione può verificarsi quando un modello di gestione risorse definisce più estensioni tooexecute contemporaneamente o quando un'estensione script personalizzato o un'altra azione viene eseguita contemporaneamente toodisk crittografia.</span><span class="sxs-lookup"><span data-stu-id="c23d7-115">This can happen when a Resource Manager template defines multiple extensions tooexecute simultaneously, or when a custom script extension or other action is run simultaneously toodisk encryption.</span></span>   <span data-ttu-id="c23d7-116">La serializzazione e l'isolamento di questi passaggi per risolvere il problema di hello.</span><span class="sxs-lookup"><span data-stu-id="c23d7-116">Serializing and isolating such steps may resolve hello issue.</span></span>
- <span data-ttu-id="c23d7-117">Quando non è stato disabilitato tooenabling precedente crittografia SELinux, hello smontare passaggio si verifica un errore.</span><span class="sxs-lookup"><span data-stu-id="c23d7-117">When SELinux has not been disabled prior tooenabling encryption, hello unmount step fails.</span></span>  <span data-ttu-id="c23d7-118">È possibile riabilitare SELinux al termine della crittografia.</span><span class="sxs-lookup"><span data-stu-id="c23d7-118">SELinux can be re-enabled after encryption has completed.</span></span>
- <span data-ttu-id="c23d7-119">Quando il disco del sistema operativo hello utilizza uno schema LVM (anche se il supporto per dischi di dati LVM limitata è disponibile, il disco del sistema operativo LVM non è)</span><span class="sxs-lookup"><span data-stu-id="c23d7-119">When hello OS disk is using an LVM scheme (although limited LVM data disk support is available, LVM OS disk is not)</span></span>
- <span data-ttu-id="c23d7-120">Requisiti minimi di memoria non soddisfatti. Per la crittografia del disco del sistema operativo sono consigliati 7 GB.</span><span class="sxs-lookup"><span data-stu-id="c23d7-120">When minimum memory requirements are not met (7GB is suggested for OS disk encryption)</span></span>
- <span data-ttu-id="c23d7-121">Montaggio ricorsivo delle unità dati nella directory /mnt/ o l'una nell'altra (ad esempio, /mnt/data1, /mnt/data2, /data3 + /data3/data4 e così via).</span><span class="sxs-lookup"><span data-stu-id="c23d7-121">When data drives have been recursively mounted under /mnt/ directory, or each other (for example, /mnt/data1, /mnt/data2, /data3 + /data3/data4, etc.)</span></span>
- <span data-ttu-id="c23d7-122">Altri [prerequisiti](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) di Crittografia dischi di Azure per Linux non soddisfatti.</span><span class="sxs-lookup"><span data-stu-id="c23d7-122">When other Azure Disk Encryption [prerequisites](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) for Linux are not met</span></span>

## <a name="unable-tooencrypt"></a><span data-ttu-id="c23d7-123">Non è possibile tooencrypt</span><span class="sxs-lookup"><span data-stu-id="c23d7-123">Unable tooencrypt</span></span>

<span data-ttu-id="c23d7-124">In alcuni casi, crittografia del disco Linux hello viene toobe bloccata su "Crittografia del disco del sistema operativo avviata" SSH è disabilitata.</span><span class="sxs-lookup"><span data-stu-id="c23d7-124">In some cases, hello Linux disk encryption appears toobe stuck at "OS disk encryption started" and SSH is disabled.</span></span> <span data-ttu-id="c23d7-125">Questo processo può richiedere tra toocomplete 3-16 ore in un'immagine della raccolta titoli.</span><span class="sxs-lookup"><span data-stu-id="c23d7-125">This process can take between 3-16 hours toocomplete on a stock gallery image.</span></span>  <span data-ttu-id="c23d7-126">Se vengono aggiunti i dischi dati di dimensioni più TB, processo hello potrebbero essere necessari giorni.</span><span class="sxs-lookup"><span data-stu-id="c23d7-126">If multi-TB size data disks are added, hello process may take days.</span></span> <span data-ttu-id="c23d7-127">Hello sequenza di crittografia del disco del sistema operativo Linux Smonta temporaneamente unità hello del sistema operativo ed esegue la crittografia a blocchi dell'intero disco del sistema operativo di hello, prima della reinstallazione nello stato crittografato.</span><span class="sxs-lookup"><span data-stu-id="c23d7-127">hello Linux OS disk encryption sequence unmounts hello OS drive temporarily, and performs block by block encryption of hello entire OS disk, before remounting it in its encrypted state.</span></span>   <span data-ttu-id="c23d7-128">A differenza della crittografia del disco di Azure in Windows, Linux crittografia del disco non utilizzo simultaneo di hello VM mentre la crittografia hello è in corso.</span><span class="sxs-lookup"><span data-stu-id="c23d7-128">Unlike Azure Disk Encryption on Windows, Linux Disk Encryption does not allow concurrent use of hello VM while hello encryption is in progress.</span></span>  <span data-ttu-id="c23d7-129">caratteristiche delle prestazioni Hello di hello macchina virtuale, tra cui hello dimensione del disco di hello e se cui account di archiviazione di hello è supportato da archiviazione standard o premium (SSD), possono influenzare notevolmente hello tempi toocomplete crittografia.</span><span class="sxs-lookup"><span data-stu-id="c23d7-129">hello performance characteristics of hello VM, including hello size of hello disk and whether hello storage account is backed by standard or premium (SSD) storage, can greatly influence hello time required toocomplete encryption.</span></span>

<span data-ttu-id="c23d7-130">stato toocheck, campo ProgressMessage hello restituito da hello [Get AzureRmVmDiskEncryptionStatus](https://docs.microsoft.com/powershell/module/azurerm.compute/get-azurermvmdiskencryptionstatus) comando può essere sottoposto a polling.</span><span class="sxs-lookup"><span data-stu-id="c23d7-130">toocheck status, hello ProgressMessage field returned from hello [Get-AzureRmVmDiskEncryptionStatus](https://docs.microsoft.com/powershell/module/azurerm.compute/get-azurermvmdiskencryptionstatus) command can be polled.</span></span>   <span data-ttu-id="c23d7-131">Mentre unità hello del sistema operativo viene crittografato hello VM passa allo stato di manutenzione e SSH è inoltre disabilitato tooprevent eventuali interruzioni toohello in corso.</span><span class="sxs-lookup"><span data-stu-id="c23d7-131">While hello OS drive is being encrypted, hello VM enters a servicing state, and SSH is also disabled tooprevent any disruption toohello ongoing process.</span></span>  <span data-ttu-id="c23d7-132">EncryptionInProgress verranno segnalate per la maggior parte di hello del tempo di hello mentre la crittografia è in corso, seguito diverse ore in un secondo momento con un messaggio di VMRestartPending richiesta hello toorestart macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="c23d7-132">EncryptionInProgress will be reported for hello majority of hello time while encryption is in progress, followed several hours later with a VMRestartPending message prompting toorestart hello VM.</span></span>  <span data-ttu-id="c23d7-133">ad esempio:</span><span class="sxs-lookup"><span data-stu-id="c23d7-133">For example:</span></span>


```
PS > Get-AzureRmVMDiskEncryptionStatus -ResourceGroupName $resourceGroupName -VMName $vmName
OsVolumeEncrypted          : EncryptionInProgress
DataVolumesEncrypted       : EncryptionInProgress
OsVolumeEncryptionSettings : Microsoft.Azure.Management.Compute.Models.DiskEncryptionSettings
ProgressMessage            : OS disk encryption started

PS > Get-AzureRmVMDiskEncryptionStatus -ResourceGroupName $resourceGroupName -VMName $vmName
OsVolumeEncrypted          : VMRestartPending
DataVolumesEncrypted       : Encrypted
OsVolumeEncryptionSettings : Microsoft.Azure.Management.Compute.Models.DiskEncryptionSettings
ProgressMessage            : OS disk successfully encrypted, please reboot hello VM
```

<span data-ttu-id="c23d7-134">Una volta richiesto tooreboot hello VM e dopo il riavvio di hello VM e, offrendo 2-3 minuti per il riavvio di hello e per i passaggi finali toobe eseguita sulla destinazione hello, hello messaggio di stato indicherà che la crittografia infine è stata completata.</span><span class="sxs-lookup"><span data-stu-id="c23d7-134">Once prompted tooreboot hello VM, and after restarting hello VM, and giving 2-3 minutes for hello reboot and for final steps toobe performed on hello target, hello status message will indicate that encryption has finally completed.</span></span>   <span data-ttu-id="c23d7-135">Dopo questo messaggio è disponibile, unità del sistema operativo crittografato hello è previsto toobe pronto per l'utilizzo e per hello VM toobe utilizzabile.</span><span class="sxs-lookup"><span data-stu-id="c23d7-135">Once this message is available, hello encrypted OS drive is expected toobe ready for use and for hello VM toobe usable again.</span></span>

<span data-ttu-id="c23d7-136">Nei casi in cui questa sequenza non è stata individuata, o se le informazioni di avvio, il messaggio di stato di avanzamento o altri indicatori di errore segnalano che la crittografia del sistema operativo non è riuscito il centro di hello del processo (ad esempio se viene visualizzato l'errore "Impossibile toounmount" hello descritti in questa Guida) è consigliabile toorestore hello VM toohello indietro snapshot o backup eseguito tooencryption immediatamente precedente.</span><span class="sxs-lookup"><span data-stu-id="c23d7-136">In cases where this sequence was not seen, or if boot information, progress message, or other error indicators report that OS encryption has failed in hello middle of this process (for example if you are seeing hello "failed toounmount" error described in this guide), it is recommended toorestore hello VM back toohello snapshot or backup taken immediately prior tooencryption.</span></span>  <span data-ttu-id="c23d7-137">Tentativo successivo toohello precedente, è consigliato toore-valutare le caratteristiche di hello di hello macchina virtuale e verificare che tutti i prerequisiti vengono soddisfatti.</span><span class="sxs-lookup"><span data-stu-id="c23d7-137">Prior toohello next attempt, it is suggested toore-evaluate hello characteristics of hello VM and ensure that all prerequisites are satisfied.</span></span>

## <a name="troubleshooting-azure-disk-encryption-behind-a-firewall"></a><span data-ttu-id="c23d7-138">Risoluzione dei problemi di Crittografia dischi di Azure dietro un firewall</span><span class="sxs-lookup"><span data-stu-id="c23d7-138">Troubleshooting Azure Disk Encryption behind a Firewall</span></span>
<span data-ttu-id="c23d7-139">Quando la connettività è limitata in base alla possibilità di hello un firewall, proxy requisito o impostazioni di gruppo () di sicurezza di rete, di hello estensione tooperform necessarie attività possono essere interrotte.</span><span class="sxs-lookup"><span data-stu-id="c23d7-139">When connectivity is restricted by a firewall, proxy requirement, or network security group (NSG) settings, hello ability of hello extension tooperform needed tasks can be disrupted.</span></span>   <span data-ttu-id="c23d7-140">Ciò può generare messaggi di stato, ad esempio "Stato di estensione non disponibile in VM hello" e gli scenari di errore toofinish.</span><span class="sxs-lookup"><span data-stu-id="c23d7-140">This can result in status messages such as "Extension status not available on hello VM" and in expected scenarios failing toofinish.</span></span>  <span data-ttu-id="c23d7-141">Nelle sezioni successive Hello presenta alcuni problemi di firewall comuni che è possibile esaminare.</span><span class="sxs-lookup"><span data-stu-id="c23d7-141">hello sections that follow has some common firewall issues that you may investigate.</span></span>

### <a name="network-security-groups"></a><span data-ttu-id="c23d7-142">Gruppi di sicurezza di rete</span><span class="sxs-lookup"><span data-stu-id="c23d7-142">Network security groups</span></span>
<span data-ttu-id="c23d7-143">Le impostazioni di gruppo di sicurezza di rete applicate devono consentire ancora configurazione di rete di hello endpoint toomeet hello documentato [prerequisiti](https://docs.microsoft.com/azure/security/azure-security-disk-encryption#prerequisites) per la crittografia del disco.</span><span class="sxs-lookup"><span data-stu-id="c23d7-143">Any network security group settings applied must still allow hello endpoint toomeet hello documented network configuration [prerequisites](https://docs.microsoft.com/azure/security/azure-security-disk-encryption#prerequisites) for disk encryption.</span></span>

### <a name="azure-keyvault-behind-firewall"></a><span data-ttu-id="c23d7-144">Azure Key Vault dietro un firewall</span><span class="sxs-lookup"><span data-stu-id="c23d7-144">Azure Keyvault behind firewall</span></span>
<span data-ttu-id="c23d7-145">Hello VM deve essere in grado di tooaccess insieme di credenziali chiave.</span><span class="sxs-lookup"><span data-stu-id="c23d7-145">hello VM must be able tooaccess key vault.</span></span> <span data-ttu-id="c23d7-146">Fare riferimento tooguidance su errore di accesso tookey da dietro un firewall è gestito da hello [insieme di credenziali chiave](https://docs.microsoft.com/azure/key-vault/key-vault-access-behind-firewall) team.</span><span class="sxs-lookup"><span data-stu-id="c23d7-146">Refer tooguidance on access tookey fault from behind a firewall that is maintained by hello [Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-access-behind-firewall) team.</span></span>

### <a name="linux-package-management-behind-firewall"></a><span data-ttu-id="c23d7-147">Gestione pacchetti Linux dietro un firewall</span><span class="sxs-lookup"><span data-stu-id="c23d7-147">Linux package management behind firewall</span></span>
<span data-ttu-id="c23d7-148">In fase di esecuzione, la crittografia del disco di Azure per Linux si basa sulla crittografia tooenabling precedente della distribuzione di destinazione hello pacchetto management system tooinstall necessita componenti dei prerequisiti.</span><span class="sxs-lookup"><span data-stu-id="c23d7-148">At run time, Azure Disk Encryption for Linux relies on hello target distribution’s package management system tooinstall needed prerequisite components prior tooenabling encryption.</span></span>  <span data-ttu-id="c23d7-149">Se le impostazioni del firewall hello VM impediscono toodownload in grado di installare questi componenti, sono previsti errori successivi.</span><span class="sxs-lookup"><span data-stu-id="c23d7-149">If firewall settings prevent hello VM from being able toodownload and install these components, then subsequent failures are expected.</span></span>    <span data-ttu-id="c23d7-150">Questo può variare da distribuzione tooconfigure di passaggi di Hello.</span><span class="sxs-lookup"><span data-stu-id="c23d7-150">hello steps tooconfigure this may vary by distribution.</span></span>  <span data-ttu-id="c23d7-151">In Red Hat, quando è necessario un proxy è essenziale verificare che subscription-manager e yum siano configurati correttamente.</span><span class="sxs-lookup"><span data-stu-id="c23d7-151">On Red Hat, when a proxy is required, ensuring that subscription-manager and yum are set up properly is vital.</span></span>  <span data-ttu-id="c23d7-152">Vedere [questo](https://access.redhat.com/solutions/189533) articolo del supporto Red Hat sull'argomento.</span><span class="sxs-lookup"><span data-stu-id="c23d7-152">See [this](https://access.redhat.com/solutions/189533) Red Hat support article on this topic.</span></span>  

## <a name="troubleshooting-windows-server-2016-server-core"></a><span data-ttu-id="c23d7-153">Risoluzione dei problemi di Server Core di Windows Server 2016</span><span class="sxs-lookup"><span data-stu-id="c23d7-153">Troubleshooting Windows Server 2016 Server Core</span></span>

<span data-ttu-id="c23d7-154">In Server Core di Windows Server 2016, il componente di bdehdcfg hello non è disponibile per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="c23d7-154">On Windows Server 2016 Server Core, hello bdehdcfg component is not available by default.</span></span> <span data-ttu-id="c23d7-155">Questa componente è necessaria per la Crittografia dischi di Azure.</span><span class="sxs-lookup"><span data-stu-id="c23d7-155">This component is required by Azure Disk Encryption.</span></span>

<span data-ttu-id="c23d7-156">tooworkaround questo problema, hello copia i seguenti 4 file da una cartella di c:\windows\system32 toohello VM di Windows Server 2016 Data Center dell'immagine Server Core di hello:</span><span class="sxs-lookup"><span data-stu-id="c23d7-156">tooworkaround this issue, copy hello following 4 files from a Windows Server 2016 Data Center VM toohello c:\windows\system32 folder of hello Server Core image:</span></span>

```
bdehdcfg.exe
bdehdcfglib.dll
bdehdcfglib.dll.mui
bdehdcfg.exe.mui
```

<span data-ttu-id="c23d7-157">Eseguire quindi il comando seguente hello:</span><span class="sxs-lookup"><span data-stu-id="c23d7-157">Then, run hello following command:</span></span>

```
bdehdcfg.exe -target default
```

<span data-ttu-id="c23d7-158">Verrà creata una partizione di sistema 550MB e quindi dopo un riavvio, è possibile usare Diskpart toocheck hello volumi e continuare.</span><span class="sxs-lookup"><span data-stu-id="c23d7-158">This will create a 550MB system partition and then after a reboot, you can use Diskpart toocheck hello volumes, and proceed.</span></span>  

<span data-ttu-id="c23d7-159">ad esempio:</span><span class="sxs-lookup"><span data-stu-id="c23d7-159">For example:</span></span>

```
DISKPART> list vol

  Volume ###  Ltr  Label        Fs     Type        Size     Status     Info
  ----------  ---  -----------  -----  ----------  -------  ---------  --------
  Volume 0     C                NTFS   Partition    126 GB  Healthy    Boot
  Volume 1                      NTFS   Partition    550 MB  Healthy    System
  Volume 2     D   Temporary S  NTFS   Partition     13 GB  Healthy    Pagefile
```
## <a name="see-also"></a><span data-ttu-id="c23d7-160">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="c23d7-160">See also</span></span>
<span data-ttu-id="c23d7-161">In questo documento, si è appreso ulteriori informazioni su alcuni problemi comuni di crittografia del disco di Azure e come tootroubleshoot.</span><span class="sxs-lookup"><span data-stu-id="c23d7-161">In this document, you learned more about some common issues in Azure disk encryption, and how tootroubleshoot.</span></span> <span data-ttu-id="c23d7-162">Per altre informazioni su questo servizio e sulle relative funzionalità, vedere:</span><span class="sxs-lookup"><span data-stu-id="c23d7-162">For more information about this service and its capability read:</span></span>

- [<span data-ttu-id="c23d7-163">Applicare la crittografia dei dischi nel Centro sicurezza di Azure</span><span class="sxs-lookup"><span data-stu-id="c23d7-163">Apply disk encryption in Azure Security Center</span></span>](https://docs.microsoft.com/azure/security-center/security-center-apply-disk-encryption)
- [<span data-ttu-id="c23d7-164">Crittografare una macchina virtuale di Azure</span><span class="sxs-lookup"><span data-stu-id="c23d7-164">Encrypt an Azure Virtual Machine</span></span>](https://docs.microsoft.com/azure/security-center/security-center-disk-encryption)
- [<span data-ttu-id="c23d7-165">Crittografia dei dati inattivi di Azure</span><span class="sxs-lookup"><span data-stu-id="c23d7-165">Azure Data Encryption-at-Rest</span></span>](https://docs.microsoft.com/azure/security/azure-security-encryption-atrest)
