---
title: Backup online e ripristino con Azure Cosmos DB | Microsoft Docs
description: Informazioni su come eseguire il backup automatico e il ripristino in un database Azure Cosmos DB.
keywords: backup e ripristino, backup online
services: cosmos-db
documentationcenter: 
author: RahulPrasad16
manager: jhubbard
editor: monicar
ms.assetid: 98eade4a-7ef4-4667-b167-6603ecd80b79
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 08/11/2017
ms.author: raprasa
ms.openlocfilehash: 130f0eb259621737d6dbdb151e363915fb334ce1
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/18/2017
---
# <a name="automatic-online-backup-and-restore-with-azure-cosmos-db"></a><span data-ttu-id="85f09-104">Backup online automatico e ripristino con Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="85f09-104">Automatic online backup and restore with Azure Cosmos DB</span></span>
<span data-ttu-id="85f09-105">Azure Cosmos DB esegue automaticamente il backup di tutti i dati a intervalli regolari.</span><span class="sxs-lookup"><span data-stu-id="85f09-105">Azure Cosmos DB automatically takes backups of all your data at regular intervals.</span></span> <span data-ttu-id="85f09-106">I backup automatici vengono eseguiti senza impatto sulle prestazioni o sulla disponibilità delle operazioni del database.</span><span class="sxs-lookup"><span data-stu-id="85f09-106">The automatic backups are taken without affecting the performance or availability of your database operations.</span></span> <span data-ttu-id="85f09-107">Tutti i backup vengono archiviati separatamente in un altro servizio di archiviazione, oltre a essere replicati a livello globale per garantire la resilienza in caso di emergenze locali.</span><span class="sxs-lookup"><span data-stu-id="85f09-107">All your backups are stored separately in another storage service, and those backups are globally replicated for resiliency against regional disasters.</span></span> <span data-ttu-id="85f09-108">I backup automatici sono destinati agli scenari in cui si elimina accidentalmente il contenitore Cosmos DB e in un secondo momento è necessario il ripristino dei dati o una soluzione di ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="85f09-108">The automatic backups are intended for scenarios when you accidentally delete your Comos DB container and later require data recovery or a disaster recovery solution.</span></span>  

<span data-ttu-id="85f09-109">L'articolo offre un breve riepilogo iniziale della ridondanza e della disponibilità dei dati in Cosmos DB e quindi illustra i backup.</span><span class="sxs-lookup"><span data-stu-id="85f09-109">This article starts with a quick recap of the data redundancy and availability in Cosmos DB, and then discusses backups.</span></span> 

## <a name="high-availability-with-cosmos-db---a-recap"></a><span data-ttu-id="85f09-110">Disponibilità elevata con Cosmos DB: riepilogo</span><span class="sxs-lookup"><span data-stu-id="85f09-110">High availability with Cosmos DB - a recap</span></span>
<span data-ttu-id="85f09-111">Cosmos DB è progettato per la [distribuzione globale](distribute-data-globally.md) e consente di ridimensionare la velocità effettiva in più aree di Azure con failover basato su criteri e API multihosting trasparenti.</span><span class="sxs-lookup"><span data-stu-id="85f09-111">Cosmos DB is designed to be [globally distributed](distribute-data-globally.md) – it allows you to scale throughput across multiple Azure regions along with policy driven failover and transparent multi-homing APIs.</span></span> <span data-ttu-id="85f09-112">Dato che si tratta di un sistema di database che offre [contratti di servizio con disponibilità del 99,99%](https://azure.microsoft.com/support/legal/sla/cosmos-db), tutte le operazioni di scrittura in Cosmos DB sono sottoposte a commit durevole su dischi locali da un quorum di repliche in un data center locale prima della conferma nel client.</span><span class="sxs-lookup"><span data-stu-id="85f09-112">As a database system offering [99.99% availability SLAs](https://azure.microsoft.com/support/legal/sla/cosmos-db), all the writes in Cosmos DB are durably committed to local disks by a quorum of replicas within a local data center before acknowledging to the client.</span></span> <span data-ttu-id="85f09-113">Si noti che la disponibilità elevata di Cosmos DB si basa sull'archiviazione locale e non dipende da tecnologie di archiviazione esterna.</span><span class="sxs-lookup"><span data-stu-id="85f09-113">Note that the high availability of Cosmos DB relies on local storage and does not depend on any external storage technologies.</span></span> <span data-ttu-id="85f09-114">Inoltre, se l'account di database è associato a più di un'area di Azure, le operazioni di scrittura vengono replicate anche nelle altre aree.</span><span class="sxs-lookup"><span data-stu-id="85f09-114">Additionally, if your database account is associated with more than one Azure region, your writes are replicated across other regions as well.</span></span> <span data-ttu-id="85f09-115">Per scalare la velocità effettiva e accedere ai dati a basse latenze, è possibile avere tutte le aree di lettura associate all'account di database che si vuole.</span><span class="sxs-lookup"><span data-stu-id="85f09-115">To scale your throughput and access data at low latencies, you can have as many read regions associated with your database account as you like.</span></span> <span data-ttu-id="85f09-116">In ogni area di lettura, i dati (replicati) vengono mantenuti in modo permanente in un set di repliche.</span><span class="sxs-lookup"><span data-stu-id="85f09-116">In each read region, the (replicated) data is durably persisted across a replica set.</span></span>  

<span data-ttu-id="85f09-117">Come illustrato nel diagramma seguente, un singolo contenitore Cosmos DB viene sottoposto a [partizionamento orizzontale](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="85f09-117">As illustrated in the following diagram, a single Cosmos DB container is [horizontally partitioned](partition-data.md).</span></span> <span data-ttu-id="85f09-118">Una "partizione" è indicata da un cerchio nel diagramma sotto e ogni partizione viene resa altamente disponibile tramite un set di repliche.</span><span class="sxs-lookup"><span data-stu-id="85f09-118">A “partition” is denoted by a circle in the following diagram, and each partition is made highly available via a replica set.</span></span> <span data-ttu-id="85f09-119">Si tratta della distribuzione locale all'interno di un'unica area di Azure (indicata dall'asse X).</span><span class="sxs-lookup"><span data-stu-id="85f09-119">This is the local distribution within a single Azure region (denoted by the X axis).</span></span> <span data-ttu-id="85f09-120">In più, ogni partizione (con il set di repliche corrispondente) viene successivamente distribuita a livello globale in più aree associate all'account di database (ad esempio, le tre aree geografiche presenti nell'illustrazione, ovvero Stati Uniti orientali, Stati Uniti occidentali e India centrale).</span><span class="sxs-lookup"><span data-stu-id="85f09-120">Further, each partition (with its corresponding replica set) is then globally distributed across multiple regions associated with your database account (for example, in this illustration the three regions – East US, West US and Central India).</span></span> <span data-ttu-id="85f09-121">Il "Set di partizioni" è un'entità distribuita a livello globale che comprende più copie dei dati in ogni area (indicata dall'asse Y).</span><span class="sxs-lookup"><span data-stu-id="85f09-121">The “partition set” is a globally distributed entity comprising of multiple copies of your data in each region (denoted by the Y axis).</span></span> <span data-ttu-id="85f09-122">È possibile assegnare la priorità alle aree associate all'account di database e, in caso di emergenza, verrà effettuato il failover trasparente di Cosmos DB nell'area successiva.</span><span class="sxs-lookup"><span data-stu-id="85f09-122">You can assign priority to the regions associated with your database account and Cosmos DB will transparently failover to the next region in case of disaster.</span></span> <span data-ttu-id="85f09-123">È anche possibile simulare manualmente il failover per testare la disponibilità end-to-end dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="85f09-123">You can also manually simulate failover to test the end-to-end availability of your application.</span></span>  

<span data-ttu-id="85f09-124">L'immagine seguente illustra l'elevato grado di ridondanza con Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="85f09-124">The following image illustrates the high degree of redundancy with Cosmos DB.</span></span>

![Elevato grado di ridondanza con Cosmos DB](./media/online-backup-and-restore/redundancy.png)

![Elevato grado di ridondanza con Cosmos DB](./media/online-backup-and-restore/global-distribution.png)

## <a name="full-automatic-online-backups"></a><span data-ttu-id="85f09-127">Backup online, completi, automatici</span><span class="sxs-lookup"><span data-stu-id="85f09-127">Full, automatic, online backups</span></span>
<span data-ttu-id="85f09-128">È possibile che il contenitore o il database venga eliminato.</span><span class="sxs-lookup"><span data-stu-id="85f09-128">Oops, I deleted my container or database!</span></span> <span data-ttu-id="85f09-129">Con Cosmos DB, non solo i dati ma anche i relativi backup vengono resi altamente ridondanti e resilienti in caso di emergenze locali.</span><span class="sxs-lookup"><span data-stu-id="85f09-129">With Cosmos DB, not only your data, but the backups of your data are also made highly redundant and resilient to regional disasters.</span></span> <span data-ttu-id="85f09-130">I backup automatici vengono attualmente eseguiti ogni quattro ore circa; ogni volta vengono archiviati i due backup più recenti.</span><span class="sxs-lookup"><span data-stu-id="85f09-130">These automated backups are currently taken approximately every four hours and latest 2 backups are stored at all times.</span></span> <span data-ttu-id="85f09-131">Se i dati vengono involontariamente eliminati o danneggiati, [contattare il supporto tecnico di Azure](https://azure.microsoft.com/support/options/) entro 8 ore.</span><span class="sxs-lookup"><span data-stu-id="85f09-131">If the data is accidently dropped or corrupted, please [contact Azure support](https://azure.microsoft.com/support/options/) within 8 hours.</span></span> 

<span data-ttu-id="85f09-132">I backup vengono eseguiti senza influenzare le prestazioni o la disponibilità delle operazioni del database.</span><span class="sxs-lookup"><span data-stu-id="85f09-132">The backups are taken without affecting the performance or availability of your database operations.</span></span> <span data-ttu-id="85f09-133">Cosmos DB esegue il backup in background senza utilizzare le UR di cui è stato effettuato il provisioning o influenzare le prestazioni e senza influire sulla disponibilità del database.</span><span class="sxs-lookup"><span data-stu-id="85f09-133">Cosmos DB takes the backup in the background without consuming your provisioned RUs or affecting the performance and without affecting the availability of your database.</span></span> 

<span data-ttu-id="85f09-134">A differenza dei dati archiviati all'interno di Cosmos DB, i backup automatici vengono memorizzati nel servizio di archiviazione BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="85f09-134">Unlike your data that is stored inside Cosmos DB, the automatic backups are stored in Azure Blob Storage service.</span></span> <span data-ttu-id="85f09-135">Per garantire il caricamento efficiente e a bassa latenza, lo snapshot del backup viene caricato in un'istanza dell'archivio BLOB di Azure nella stessa area dell'area di scrittura corrente dell'account di database Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="85f09-135">To guarantee the low latency/efficient upload, the snapshot of your backup is uploaded to an instance of Azure Blob storage in the same region as the current write region of your Cosmos DB database account.</span></span> <span data-ttu-id="85f09-136">Per garantire la resilienza in caso di emergenze locali, ogni snapshot dei dati di backup nell'archivio BLOB di Azure viene replicato nuovamente tramite l'archiviazione con ridondanza geografica (GRS) in un'altra area.</span><span class="sxs-lookup"><span data-stu-id="85f09-136">For resiliency against regional disaster, each snapshot of your backup data in Azure Blob Storage is again replicated via geo-redundant storage (GRS) to another region.</span></span> <span data-ttu-id="85f09-137">Il diagramma seguente illustra il backup dell'intero contenitore Cosmos DB (in questo esempio con tutte le tre partizioni primarie negli Stati Uniti occidentali) in un account di archiviazione BLOB di Azure remoto negli Stati Uniti occidentali e quindi la replica con archiviazione con ridondanza geografica negli Stati Uniti orientali.</span><span class="sxs-lookup"><span data-stu-id="85f09-137">The following diagram shows that the entire Cosmos DB container (with all three primary partitions in West US, in this example) is backed up in a remote Azure Blob Storage account in West US and then GRS replicated to East US.</span></span> 

<span data-ttu-id="85f09-138">L'immagine di seguito illustra i backup completi periodici di tutte le entità di Cosmos DB nell'archiviazione con ridondanza geografica di Azure.</span><span class="sxs-lookup"><span data-stu-id="85f09-138">The following image illustrates periodic full backups of all Cosmos DB entities in GRS Azure Storage.</span></span>

![Backup completi periodici di tutte le entità di Cosmos DB nell'archiviazione con ridondanza geografica di Azure](./media/online-backup-and-restore/automatic-backup.png)

## <a name="backup-retention-period"></a><span data-ttu-id="85f09-140">Periodo di conservazione dei backup</span><span class="sxs-lookup"><span data-stu-id="85f09-140">Backup retention period</span></span>
<span data-ttu-id="85f09-141">Come descritto sopra, Azure Cosmos DB crea snapshot dei dati ogni quattro ore e conserva gli ultimi due snapshot di ogni partizione per 30 giorni.</span><span class="sxs-lookup"><span data-stu-id="85f09-141">As described above, Azure Cosmos DB takes snapshots of your data every four hours and retains the last two snapshots of every partition for 30 days.</span></span> <span data-ttu-id="85f09-142">In base alle normative di conformità, gli snapshot vengono eliminati dopo 90 giorni.</span><span class="sxs-lookup"><span data-stu-id="85f09-142">Per our compliance regulations, snapshots are purged after 90 days.</span></span>

<span data-ttu-id="85f09-143">Se si vuole mantenere gli snapshot, è possibile usare l'opzione di esportazione in JSON nello [strumento di migrazione dei dati](import-data.md#export-to-json-file) di Azure Cosmos DB per pianificare backup aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="85f09-143">If you want to maintain your own snapshots, you can use the export to JSON option in the Azure Cosmos DB [Data Migration tool](import-data.md#export-to-json-file) to schedule additional backups.</span></span> 

## <a name="restoring-a-database-from-an-online-backup"></a><span data-ttu-id="85f09-144">Ripristino di un database da un backup online</span><span class="sxs-lookup"><span data-stu-id="85f09-144">Restoring a database from an online backup</span></span>
<span data-ttu-id="85f09-145">Se si elimina involontariamente il database o la raccolta, è possibile [creare un ticket di supporto](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) o [contattare il supporto di Azure](https://azure.microsoft.com/support/options/) per ripristinare i dati dall'ultimo backup automatico.</span><span class="sxs-lookup"><span data-stu-id="85f09-145">If you accidentally delete your database or collection, you can [file a support ticket](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) or [call Azure support](https://azure.microsoft.com/support/options/) to restore the data from the last automatic backup.</span></span> <span data-ttu-id="85f09-146">Se è necessario ripristinare il database a causa di un problema di danneggiamento dei dati, vedere [Gestione del danneggiamento dei dati](#handling-data-corruption) perché è necessario eseguire passaggi aggiuntivi per evitare che i dati danneggiati penetrino nei backup.</span><span class="sxs-lookup"><span data-stu-id="85f09-146">If you need to restore your database because of data corruption issue, see [Handling data corruption](#handling-data-corruption) as you need to take additional steps to prevent the corrupted data from penetrating the backups.</span></span> <span data-ttu-id="85f09-147">Per il ripristino di uno snapshot specifico del backup, Cosmos DB richiede che i dati siano stati disponibili per la durata del ciclo di backup per tale snapshot.</span><span class="sxs-lookup"><span data-stu-id="85f09-147">For a specific snapshot of your backup to be restored, Cosmos DB requires that the data was available for the duration of the backup cycle for that snapshot.</span></span>

## <a name="handling-data-corruption"></a><span data-ttu-id="85f09-148">Gestione del danneggiamento dei dati</span><span class="sxs-lookup"><span data-stu-id="85f09-148">Handling data corruption</span></span>
<span data-ttu-id="85f09-149">Azure Cosmos DB conserva gli ultimi due backup di ogni partizione del sistema.</span><span class="sxs-lookup"><span data-stu-id="85f09-149">Azure Cosmos DB retains the last two backups of every partition in the system.</span></span> <span data-ttu-id="85f09-150">Questo modello è ideale quando un contenitore (raccolta di documenti, grafo, tabella) o un database viene eliminato involontariamente perché consente di ripristinare una delle versioni più recenti.</span><span class="sxs-lookup"><span data-stu-id="85f09-150">This model works very well when a container (collection of documents, graph, table) or a database is accidentally deleted since one of the last versions can be restored.</span></span> <span data-ttu-id="85f09-151">Se tuttavia gli utenti causano un problema di danneggiamento dei dati, Azure Cosmos DB potrebbe non rilevare il danneggiamento dei dati che potrebbe quindi penetrare nei backup.</span><span class="sxs-lookup"><span data-stu-id="85f09-151">However, in the case when when users may introduce a data corruption issue, Azure Cosmos DB may be unaware of the data corruption, and it is possible that the corruption may have penetrated the backups.</span></span> <span data-ttu-id="85f09-152">Non appena il danneggiamento viene rilevato, è consigliabile eliminare il contenitore danneggiato (raccolta/grafo/tabella) in modo che i backup siano protetti e non vengano sovrascritti con i dati danneggiati.</span><span class="sxs-lookup"><span data-stu-id="85f09-152">As soon as corruption is detected, you should delete the corrupted container (collection/graph/table) so that backups are protected from being overwritten with corrupted data.</span></span> <span data-ttu-id="85f09-153">Poiché il backup più recente potrebbe risalire a quattro ore prima, l'utente può usare il [feed delle modifiche](change-feed.md) per acquisire e archiviare le ultime quattro ore di dati prima di eliminare il contenitore.</span><span class="sxs-lookup"><span data-stu-id="85f09-153">Since the last backup could be four hours old, the user can employ [change feed](change-feed.md) to capture and store the last four hours worth of data before deleting the container.</span></span>

## <a name="next-steps"></a><span data-ttu-id="85f09-154">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="85f09-154">Next steps</span></span>

<span data-ttu-id="85f09-155">Per replicare il database in più data center, vedere l'articolo su come [distribuire i dati a livello globale con Cosmos DB](distribute-data-globally.md).</span><span class="sxs-lookup"><span data-stu-id="85f09-155">To replicate your database in multiple data centers, see [distribute your data globally with Cosmos DB](distribute-data-globally.md).</span></span> 

<span data-ttu-id="85f09-156">Per contattare il supporto di Azure, [creare un ticket dal portale di Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span><span class="sxs-lookup"><span data-stu-id="85f09-156">To file contact Azure Support, [file a ticket from the Azure portal](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span></span>

