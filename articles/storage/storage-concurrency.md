---
title: Gestione della concorrenza nell'archiviazione di Microsoft Azure
description: Come gestire la concorrenza per i servizi BLOB, di accodamento, di tabelle e file
services: storage
documentationcenter: 
author: jasontang501
manager: tadb
editor: tysonn
ms.assetid: cc6429c4-23ee-46e3-b22d-50dd68bd4680
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 05/11/2017
ms.author: jasontang501
ms.openlocfilehash: 8b894af2f15cd22f04701c545d8250e20b99a094
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="managing-concurrency-in-microsoft-azure-storage"></a><span data-ttu-id="04962-103">Gestione della concorrenza nell'archiviazione di Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="04962-103">Managing Concurrency in Microsoft Azure Storage</span></span>
## <a name="overview"></a><span data-ttu-id="04962-104">Panoramica</span><span class="sxs-lookup"><span data-stu-id="04962-104">Overview</span></span>
<span data-ttu-id="04962-105">Le moderne applicazioni basate su Internet sono in genere caratterizzate dalla presenza simultanea di più utenti che visualizzano e aggiornano dati.</span><span class="sxs-lookup"><span data-stu-id="04962-105">Modern Internet based applications usually have multiple users viewing and updating data simultaneously.</span></span> <span data-ttu-id="04962-106">Ciò richiede agli sviluppatori di applicazioni un'attenta riflessione su come offrire un'esperienza prevedibile ai propri utenti finali, in particolare per gli scenari in cui più utenti possono aggiornare gli stessi dati.</span><span class="sxs-lookup"><span data-stu-id="04962-106">This requires application developers to think carefully about how to provide a predictable experience to their end users, particularly for scenarios where multiple users can update the same data.</span></span> <span data-ttu-id="04962-107">Gli sviluppatori in genere prendono in considerazione tre strategie principali di concorrenza dei dati:</span><span class="sxs-lookup"><span data-stu-id="04962-107">There are three main data concurrency strategies developers will typically consider:</span></span>  

1. <span data-ttu-id="04962-108">Concorrenza ottimistica: un'applicazione che esegue un aggiornamento verificherà, nell'ambito di tale attività, se i dati siano cambiati rispetto all'ultima lettura.</span><span class="sxs-lookup"><span data-stu-id="04962-108">Optimistic concurrency – An application performing an update will as part of its update verify if the data has changed since the application last read that data.</span></span> <span data-ttu-id="04962-109">Ad esempio, se due utenti che visualizzano una pagina wiki effettuano un aggiornamento alla stessa pagina, la piattaforma wiki deve garantire che il secondo aggiornamento non sovrascriva il primo e che entrambi gli utenti sappiano se il proprio aggiornamento è stato effettuato correttamente o meno.</span><span class="sxs-lookup"><span data-stu-id="04962-109">For example, if two users viewing a wiki page make an update to the same page then the wiki platform must ensure that the second update does not overwrite the first update – and that both users understand whether their update was successful or not.</span></span> <span data-ttu-id="04962-110">Questa strategia viene usata con maggiore frequenza nelle applicazioni Web.</span><span class="sxs-lookup"><span data-stu-id="04962-110">This strategy is most often used in web applications.</span></span>
2. <span data-ttu-id="04962-111">Concorrenza pessimistica: un'applicazione che cerca di eseguire un aggiornamento applicherà un blocco a un oggetto, impedendo ad altri utenti di aggiornare i dati fino a quando il blocco non viene rimosso.</span><span class="sxs-lookup"><span data-stu-id="04962-111">Pessimistic concurrency – An application looking to perform an update will take a lock on an object preventing other users from updating the data until the lock is released.</span></span> <span data-ttu-id="04962-112">Ad esempio, in uno scenario di replica dei dati master/slave in cui solo il master eseguirà gli aggiornamenti, il master in genere deterrà un blocco esclusivo per un lungo periodo di tempo sui dati in modo che nessuno possa aggiornarli.</span><span class="sxs-lookup"><span data-stu-id="04962-112">For example, in a master/slave data replication scenario where only the master will perform updates the master will typically hold an exclusive lock for an extended period of time on the data to ensure no one else can update it.</span></span>
3. <span data-ttu-id="04962-113">Prevalenza dell'ultima scrittura: un approccio che consente di eseguire qualsiasi operazione di aggiornamento senza prima verificare se altre applicazioni abbiano aggiornato i dati rispetto alla prima lettura dei dati da parte dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="04962-113">Last writer wins – An approach that allows any update operations to proceed without verifying if any other application has updated the data since the application first read the data.</span></span> <span data-ttu-id="04962-114">Questa strategia (che in realtà denota la mancanza di una strategia ufficiale) è in genere usata quando i dati vengono partizionati in modo tale da escludere qualsiasi possibilità che gli utenti possano accedere agli stessi dati.</span><span class="sxs-lookup"><span data-stu-id="04962-114">This strategy (or lack of a formal strategy) is usually used where data is partitioned in such a way that there is no likelihood that multiple users will access the same data.</span></span> <span data-ttu-id="04962-115">Può inoltre essere utile per l'elaborazione di flussi dei dati di breve durata.</span><span class="sxs-lookup"><span data-stu-id="04962-115">It can also be useful where short-lived data streams are being processed.</span></span>  

<span data-ttu-id="04962-116">In questo articolo viene fornita una panoramica del modo in cui la piattaforma di archiviazione di Azure semplifica lo sviluppo fornendo un supporto eccellente per tutte e tre le strategie di concorrenza descritte.</span><span class="sxs-lookup"><span data-stu-id="04962-116">This article provides an overview of how the Azure Storage platform simplifies development by providing first class support for all three of these concurrency strategies.</span></span>  

## <a name="azure-storage--simplifies-cloud-development"></a><span data-ttu-id="04962-117">Archiviazione di Azure – Semplifica lo sviluppo cloud</span><span class="sxs-lookup"><span data-stu-id="04962-117">Azure Storage – Simplifies Cloud Development</span></span>
<span data-ttu-id="04962-118">Il servizio di archiviazione di Azure supporta tutte e tre le strategie, sebbene si caratterizzi per la sua capacità di fornire un supporto completo per la concorrenza ottimistica e la concorrenza pessimistica. Tale servizio è stato infatti progettato per accogliere un solido modello di coerenza in grado di garantire che quando il servizio di archiviazione esegue il commit di un'operazione di inserimento o aggiornamento dei dati, tutti gli accessi successivi a tali dati visualizzeranno l'aggiornamento più recente.</span><span class="sxs-lookup"><span data-stu-id="04962-118">The Azure storage service supports all three strategies, although it is distinctive in its ability to provide full support for optimistic and pessimistic concurrency because it was designed to embrace a strong consistency model which guarantees that when the Storage service commits a data insert or update operation all further accesses to that data will see the latest update.</span></span> <span data-ttu-id="04962-119">Le piattaforme di archiviazione che usano un modello di coerenza finale prevedono un intervallo tra il momento in cui un utente esegue una scrittura e il momento in cui i dati aggiornati possono essere visti da altri utenti, rendendo in tal modo difficile lo sviluppo di applicazioni client allo scopo di impedire che le incoerenze influiscano sugli utenti finali.</span><span class="sxs-lookup"><span data-stu-id="04962-119">Storage platforms that use an eventual consistency model have a lag between when a write is performed by one user and when the updated data can be seen by other users thus complicating development of client applications in order to prevent inconsistencies from affecting end users.</span></span>  

<span data-ttu-id="04962-120">Oltre a scegliere una strategia di concorrenza appropriata, gli sviluppatori devono inoltre conoscere il modo in cui una piattaforma di archiviazione isola le modifiche, in particolare quelle apportate allo stesso oggetto in più transazioni.</span><span class="sxs-lookup"><span data-stu-id="04962-120">In addition to selecting an appropriate concurrency strategy developers should also be aware of how a storage platform isolates changes – particularly changes to the same object across transactions.</span></span> <span data-ttu-id="04962-121">Il servizio di archiviazione di Azure usa l'isolamento degli snapshot per consentire l'esecuzione simultanea di operazioni di lettura e operazioni di scrittura nell'ambito di una singola partizione.</span><span class="sxs-lookup"><span data-stu-id="04962-121">The Azure storage service uses snapshot isolation to allow read operations to happen concurrently with write operations within a single partition.</span></span> <span data-ttu-id="04962-122">A differenza di altri livelli di isolamento, l'isolamento degli snapshot garantisce che tutte le letture vedano uno snapshot coerente dei dati persino durante l'esecuzione di aggiornamenti, essenzialmente restituendo gli ultimi valori di cui è stato eseguito il commit durante l'elaborazione di una transazione di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="04962-122">Unlike other isolation levels, snapshot isolation guarantees that all reads see a consistent snapshot of the data even while updates are occurring – essentially by returning the last committed values while an update transaction is being processed.</span></span>  

## <a name="managing-concurrency-in-blob-storage"></a><span data-ttu-id="04962-123">Gestione della concorrenza nell'archiviazione BLOB</span><span class="sxs-lookup"><span data-stu-id="04962-123">Managing Concurrency in Blob storage</span></span>
<span data-ttu-id="04962-124">È possibile scegliere di usare modelli di concorrenza ottimistica o pessimistica per gestire l'accesso a BLOB e contenitori nel servizio BLOB.</span><span class="sxs-lookup"><span data-stu-id="04962-124">You can opt to use either optimistic or pessimistic concurrency models to manage access to blobs and containers in the blob service.</span></span> <span data-ttu-id="04962-125">Se non specifica esplicitamente una strategia, per impostazione predefinita prevale l'ultima scrittura.</span><span class="sxs-lookup"><span data-stu-id="04962-125">If you do not explicitly specify a strategy last writes wins is the default.</span></span>  

### <a name="optimistic-concurrency-for-blobs-and-containers"></a><span data-ttu-id="04962-126">Concorrenza ottimistica per BLOB e contenitori</span><span class="sxs-lookup"><span data-stu-id="04962-126">Optimistic concurrency for blobs and containers</span></span>
<span data-ttu-id="04962-127">Il servizio di archiviazione assegna un identificatore a ogni oggetto archiviato,</span><span class="sxs-lookup"><span data-stu-id="04962-127">The Storage service assigns an identifier to every object stored.</span></span> <span data-ttu-id="04962-128">che viene aggiornato ogni volta che un'operazione di aggiornamento viene eseguita su un oggetto.</span><span class="sxs-lookup"><span data-stu-id="04962-128">This identifier is updated every time an update operation is performed on an object.</span></span> <span data-ttu-id="04962-129">L'identificatore viene restituito al client nell'ambito di una risposta HTTP GET mediante l'intestazione (tag di entità) ETag definita all'interno del protocollo HTTP.</span><span class="sxs-lookup"><span data-stu-id="04962-129">The identifier is returned to the client as part of an HTTP GET response using the ETag (entity tag) header that is defined within the HTTP protocol.</span></span> <span data-ttu-id="04962-130">Un utente che esegue un aggiornamento su tale oggetto può inviare l'ETag con un'intestazione condizionale per garantire che un aggiornamento si verificherà solo se una determinata condizione viene soddisfatta. In questo caso la condizione è che un'intestazione "If-Match" che richiede il servizio di archiviazione per garantire il valore ETag specificato nella richiesta di aggiornamento sia uguale a quella archiviata nel servizio di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="04962-130">A user performing an update on such an object can send in the original ETag along with a conditional header to ensure that an update will only occur if a certain condition has been met – in this case the condition is an "If-Match" header which requires the Storage Service to ensure the value of the ETag specified in the update request is the same as that stored in the Storage Service.</span></span>  

<span data-ttu-id="04962-131">Il processo è il seguente:</span><span class="sxs-lookup"><span data-stu-id="04962-131">The outline of this process is as follows:</span></span>  

1. <span data-ttu-id="04962-132">Recuperare un BLOB da un servizio di archiviazione; la risposta include un valore di intestazione HTTP ETag che identifica la versione corrente dell'oggetto nel servizio di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="04962-132">Retrieve a blob from the storage service, the response includes an HTTP ETag Header value that identifies the current version of the object in the storage service.</span></span>
2. <span data-ttu-id="04962-133">Quando si aggiorna il BLOB, includere il valore ETag ricevuto al passaggio 1 nell'intestazione condizionale **If-Match** della richiesta inviata al servizio.</span><span class="sxs-lookup"><span data-stu-id="04962-133">When you update the blob, include the ETag value you received in step 1 in the **If-Match** conditional header of the request you send to the service.</span></span>
3. <span data-ttu-id="04962-134">Il servizio confronta il valore ETag nella richiesta con il valore ETag corrente del BLOB.</span><span class="sxs-lookup"><span data-stu-id="04962-134">The service compares the ETag value in the request with the current ETag value of the blob.</span></span>
4. <span data-ttu-id="04962-135">Se il valore ETag corrente del BLOB è una versione diversa dall'ETag nell'intestazione condizionale **If-Match** , il servizio restituisce un errore 412 al client.</span><span class="sxs-lookup"><span data-stu-id="04962-135">If the current ETag value of the blob is a different version than the ETag in the **If-Match** conditional header in the request, the service returns a 412 error to the client.</span></span> <span data-ttu-id="04962-136">Ciò indica al client che un altro processo ha aggiornato il BLOB rispetto a quando il client lo ha recuperato.</span><span class="sxs-lookup"><span data-stu-id="04962-136">This indicates to the client that another process has updated the blob since the client retrieved it.</span></span>
5. <span data-ttu-id="04962-137">Se il valore ETag corrente del BLOB è la stessa versione dell'Etag nell'intestazione condizionale **If-Match** nella richiesta, il servizio esegue l'operazione richiesta e aggiorna il valore Etag corrente del BLOB per indicare la creazione di una nuova versione.</span><span class="sxs-lookup"><span data-stu-id="04962-137">If the current ETag value of the blob is the same version as the ETag in the **If-Match** conditional header in the request, the service performs the requested operation and updates the current ETag value of the blob to show that it has created a new version.</span></span>  

<span data-ttu-id="04962-138">Il frammento C# seguente (che usa Client Storage Library 4.2.0) mostra un esempio semplice di come costruire una **If-Match AccessCondition** in base al valore ETag al quale viene effettuato l'accesso dalle proprietà di un BLOB precedentemente recuperato o inserito.</span><span class="sxs-lookup"><span data-stu-id="04962-138">The following C# snippet (using the Client Storage Library 4.2.0) shows a simple example of how to construct an **If-Match AccessCondition** based on the ETag value that is accessed from the properties of a blob that was previously either retrieved or inserted.</span></span> <span data-ttu-id="04962-139">Usa quindi l'oggetto **AccessCondition** quando aggiorna il BLOB: l'oggetto **AccessCondition** aggiunge l'intestazione **If-Match** alla richiesta.</span><span class="sxs-lookup"><span data-stu-id="04962-139">It then uses the **AccessCondition** object when it updating the blob: the **AccessCondition** object adds the **If-Match** header to the request.</span></span> <span data-ttu-id="04962-140">Se un altro processo ha aggiornato il BLOB, il servizio BLOB restituisce un messaggio di stato HTTP 412 (Condizione preliminare non riuscita).</span><span class="sxs-lookup"><span data-stu-id="04962-140">If another process has updated the blob, the blob service returns an HTTP 412 (Precondition Failed) status message.</span></span> <span data-ttu-id="04962-141">È possibile scaricare l'intero esempio dalla pagina relativa alla [gestione della concorrenza con Archiviazione di Azure](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="04962-141">You can download the full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>  

```csharp
// Retrieve the ETag from the newly created blob
// Etag is already populated as UploadText should cause a PUT Blob call
// to storage blob service which returns the etag in response.
string orignalETag = blockBlob.Properties.ETag;

// This code simulates an update by a third party.
string helloText = "Blob updated by a third party.";

// No etag, provided so orignal blob is overwritten (thus generating a new etag)
blockBlob.UploadText(helloText);
Console.WriteLine("Blob updated. Updated ETag = {0}",
blockBlob.Properties.ETag);

// Now try to update the blob using the orignal ETag provided when the blob was created
try
{
    Console.WriteLine("Trying to update blob using orignal etag to generate if-match access condition");
    blockBlob.UploadText(helloText,accessCondition:
    AccessCondition.GenerateIfMatchCondition(orignalETag));
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == (int)HttpStatusCode.PreconditionFailed)
    {
        Console.WriteLine("Precondition failure as expected. Blob's orignal etag no longer matches");
        // TODO: client can decide on how it wants to handle the 3rd party updated content.
    }
    else
        throw;
}  
```

<span data-ttu-id="04962-142">Il servizio di archiviazione include anche il supporto di altre intestazioni condizionale quali **If-Modified-Since**, **If-Unmodified-Since** e **If-None-Match** nonché le relative combinazioni.</span><span class="sxs-lookup"><span data-stu-id="04962-142">The Storage Service also includes support for additional conditional headers such as **If-Modified-Since**, **If-Unmodified-Since** and **If-None-Match** as well as combinations thereof.</span></span> <span data-ttu-id="04962-143">Per altre informazioni, vedere [Specifica di intestazioni condizionali per le operazioni del servizio Blob](http://msdn.microsoft.com/library/azure/dd179371.aspx) su MSDN.</span><span class="sxs-lookup"><span data-stu-id="04962-143">For more information see [Specifying Conditional Headers for Blob Service Operations](http://msdn.microsoft.com/library/azure/dd179371.aspx) on MSDN.</span></span>  

<span data-ttu-id="04962-144">Nella tabella seguente sono riepilogate le operazioni contenitore che accettano intestazioni condizionali come **If-Match** nella richiesta e che restituiscono un valore ETag nella risposta.</span><span class="sxs-lookup"><span data-stu-id="04962-144">The following table summarizes the container operations that accept conditional headers such as **If-Match** in the request and that return an ETag value in the response.</span></span>  

| <span data-ttu-id="04962-145">Operazione</span><span class="sxs-lookup"><span data-stu-id="04962-145">Operation</span></span> | <span data-ttu-id="04962-146">Restituisce il valore ETag del contenitore</span><span class="sxs-lookup"><span data-stu-id="04962-146">Returns Container ETag value</span></span> | <span data-ttu-id="04962-147">Accetta intestazioni condizionali</span><span class="sxs-lookup"><span data-stu-id="04962-147">Accepts conditional headers</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="04962-148">Create Container</span><span class="sxs-lookup"><span data-stu-id="04962-148">Create Container</span></span> |<span data-ttu-id="04962-149">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-149">Yes</span></span> |<span data-ttu-id="04962-150">No</span><span class="sxs-lookup"><span data-stu-id="04962-150">No</span></span> |
| <span data-ttu-id="04962-151">Get Container Properties</span><span class="sxs-lookup"><span data-stu-id="04962-151">Get Container Properties</span></span> |<span data-ttu-id="04962-152">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-152">Yes</span></span> |<span data-ttu-id="04962-153">No</span><span class="sxs-lookup"><span data-stu-id="04962-153">No</span></span> |
| <span data-ttu-id="04962-154">Get Container Metadata</span><span class="sxs-lookup"><span data-stu-id="04962-154">Get Container Metadata</span></span> |<span data-ttu-id="04962-155">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-155">Yes</span></span> |<span data-ttu-id="04962-156">No</span><span class="sxs-lookup"><span data-stu-id="04962-156">No</span></span> |
| <span data-ttu-id="04962-157">Set Container Metadata</span><span class="sxs-lookup"><span data-stu-id="04962-157">Set Container Metadata</span></span> |<span data-ttu-id="04962-158">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-158">Yes</span></span> |<span data-ttu-id="04962-159">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-159">Yes</span></span> |
| <span data-ttu-id="04962-160">Get Container ACL</span><span class="sxs-lookup"><span data-stu-id="04962-160">Get Container ACL</span></span> |<span data-ttu-id="04962-161">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-161">Yes</span></span> |<span data-ttu-id="04962-162">No</span><span class="sxs-lookup"><span data-stu-id="04962-162">No</span></span> |
| <span data-ttu-id="04962-163">Set Container ACL</span><span class="sxs-lookup"><span data-stu-id="04962-163">Set Container ACL</span></span> |<span data-ttu-id="04962-164">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-164">Yes</span></span> |<span data-ttu-id="04962-165">Sì (*)</span><span class="sxs-lookup"><span data-stu-id="04962-165">Yes (*)</span></span> |
| <span data-ttu-id="04962-166">Delete Container</span><span class="sxs-lookup"><span data-stu-id="04962-166">Delete Container</span></span> |<span data-ttu-id="04962-167">No</span><span class="sxs-lookup"><span data-stu-id="04962-167">No</span></span> |<span data-ttu-id="04962-168">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-168">Yes</span></span> |
| <span data-ttu-id="04962-169">Lease Container</span><span class="sxs-lookup"><span data-stu-id="04962-169">Lease Container</span></span> |<span data-ttu-id="04962-170">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-170">Yes</span></span> |<span data-ttu-id="04962-171">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-171">Yes</span></span> |
| <span data-ttu-id="04962-172">List Blobs</span><span class="sxs-lookup"><span data-stu-id="04962-172">List Blobs</span></span> |<span data-ttu-id="04962-173">No</span><span class="sxs-lookup"><span data-stu-id="04962-173">No</span></span> |<span data-ttu-id="04962-174">No</span><span class="sxs-lookup"><span data-stu-id="04962-174">No</span></span> |

<span data-ttu-id="04962-175">(*) Le autorizzazioni definite da SetContainerACL sono memorizzate nella cache e la propagazione degli aggiornamenti a queste autorizzazioni richiede 30 secondi durante i quali la coerenza degli aggiornamenti non è garantita.</span><span class="sxs-lookup"><span data-stu-id="04962-175">(*) The permissions defined by SetContainerACL are cached and updates to these permissions take 30 seconds to propagate during which period updates are not guaranteed to be consistent.</span></span>  

<span data-ttu-id="04962-176">Nella tabella seguente sono riepilogate le operazioni BLOB che accettano intestazioni condizionali come **If-Match** nella richiesta e che restituiscono un valore ETag nella risposta.</span><span class="sxs-lookup"><span data-stu-id="04962-176">The following table summarizes the blob operations that accept conditional headers such as **If-Match** in the request and that return an ETag value in the response.</span></span>

| <span data-ttu-id="04962-177">Operazione</span><span class="sxs-lookup"><span data-stu-id="04962-177">Operation</span></span> | <span data-ttu-id="04962-178">Restituisce il valore ETag</span><span class="sxs-lookup"><span data-stu-id="04962-178">Returns ETag value</span></span> | <span data-ttu-id="04962-179">Accetta intestazioni condizionali</span><span class="sxs-lookup"><span data-stu-id="04962-179">Accepts conditional headers</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="04962-180">Put Blob</span><span class="sxs-lookup"><span data-stu-id="04962-180">Put Blob</span></span> |<span data-ttu-id="04962-181">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-181">Yes</span></span> |<span data-ttu-id="04962-182">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-182">Yes</span></span> |
| <span data-ttu-id="04962-183">Get Blob</span><span class="sxs-lookup"><span data-stu-id="04962-183">Get Blob</span></span> |<span data-ttu-id="04962-184">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-184">Yes</span></span> |<span data-ttu-id="04962-185">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-185">Yes</span></span> |
| <span data-ttu-id="04962-186">Get Blob Properties</span><span class="sxs-lookup"><span data-stu-id="04962-186">Get Blob Properties</span></span> |<span data-ttu-id="04962-187">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-187">Yes</span></span> |<span data-ttu-id="04962-188">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-188">Yes</span></span> |
| <span data-ttu-id="04962-189">Set Blob Properties</span><span class="sxs-lookup"><span data-stu-id="04962-189">Set Blob Properties</span></span> |<span data-ttu-id="04962-190">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-190">Yes</span></span> |<span data-ttu-id="04962-191">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-191">Yes</span></span> |
| <span data-ttu-id="04962-192">Get Blob Metadata</span><span class="sxs-lookup"><span data-stu-id="04962-192">Get Blob Metadata</span></span> |<span data-ttu-id="04962-193">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-193">Yes</span></span> |<span data-ttu-id="04962-194">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-194">Yes</span></span> |
| <span data-ttu-id="04962-195">Set Blob Metadata</span><span class="sxs-lookup"><span data-stu-id="04962-195">Set Blob Metadata</span></span> |<span data-ttu-id="04962-196">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-196">Yes</span></span> |<span data-ttu-id="04962-197">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-197">Yes</span></span> |
| <span data-ttu-id="04962-198">Lease Blob (*)</span><span class="sxs-lookup"><span data-stu-id="04962-198">Lease Blob (*)</span></span> |<span data-ttu-id="04962-199">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-199">Yes</span></span> |<span data-ttu-id="04962-200">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-200">Yes</span></span> |
| <span data-ttu-id="04962-201">Snapshot Blob</span><span class="sxs-lookup"><span data-stu-id="04962-201">Snapshot Blob</span></span> |<span data-ttu-id="04962-202">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-202">Yes</span></span> |<span data-ttu-id="04962-203">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-203">Yes</span></span> |
| <span data-ttu-id="04962-204">Copy Blob</span><span class="sxs-lookup"><span data-stu-id="04962-204">Copy Blob</span></span> |<span data-ttu-id="04962-205">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-205">Yes</span></span> |<span data-ttu-id="04962-206">Sì (per il BLOB di origine e destinazione)</span><span class="sxs-lookup"><span data-stu-id="04962-206">Yes (for source and destination blob)</span></span> |
| <span data-ttu-id="04962-207">Abort Copy Blob</span><span class="sxs-lookup"><span data-stu-id="04962-207">Abort Copy Blob</span></span> |<span data-ttu-id="04962-208">No</span><span class="sxs-lookup"><span data-stu-id="04962-208">No</span></span> |<span data-ttu-id="04962-209">No</span><span class="sxs-lookup"><span data-stu-id="04962-209">No</span></span> |
| <span data-ttu-id="04962-210">Delete Blob</span><span class="sxs-lookup"><span data-stu-id="04962-210">Delete Blob</span></span> |<span data-ttu-id="04962-211">No</span><span class="sxs-lookup"><span data-stu-id="04962-211">No</span></span> |<span data-ttu-id="04962-212">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-212">Yes</span></span> |
| <span data-ttu-id="04962-213">Put Block</span><span class="sxs-lookup"><span data-stu-id="04962-213">Put Block</span></span> |<span data-ttu-id="04962-214">No</span><span class="sxs-lookup"><span data-stu-id="04962-214">No</span></span> |<span data-ttu-id="04962-215">No</span><span class="sxs-lookup"><span data-stu-id="04962-215">No</span></span> |
| <span data-ttu-id="04962-216">Put Block List</span><span class="sxs-lookup"><span data-stu-id="04962-216">Put Block List</span></span> |<span data-ttu-id="04962-217">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-217">Yes</span></span> |<span data-ttu-id="04962-218">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-218">Yes</span></span> |
| <span data-ttu-id="04962-219">Get Block List</span><span class="sxs-lookup"><span data-stu-id="04962-219">Get Block List</span></span> |<span data-ttu-id="04962-220">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-220">Yes</span></span> |<span data-ttu-id="04962-221">No</span><span class="sxs-lookup"><span data-stu-id="04962-221">No</span></span> |
| <span data-ttu-id="04962-222">Put Page</span><span class="sxs-lookup"><span data-stu-id="04962-222">Put Page</span></span> |<span data-ttu-id="04962-223">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-223">Yes</span></span> |<span data-ttu-id="04962-224">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-224">Yes</span></span> |
| <span data-ttu-id="04962-225">Get Page Ranges</span><span class="sxs-lookup"><span data-stu-id="04962-225">Get Page Ranges</span></span> |<span data-ttu-id="04962-226">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-226">Yes</span></span> |<span data-ttu-id="04962-227">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-227">Yes</span></span> |

<span data-ttu-id="04962-228">(*) Lease Blob non modifica l'ETag in un BLOB.</span><span class="sxs-lookup"><span data-stu-id="04962-228">(*) Lease Blob does not change the ETag on a blob.</span></span>  

### <a name="pessimistic-concurrency-for-blobs"></a><span data-ttu-id="04962-229">Concorrenza pessimistica per i BLOB</span><span class="sxs-lookup"><span data-stu-id="04962-229">Pessimistic concurrency for blobs</span></span>
<span data-ttu-id="04962-230">Per bloccare un BLOB al fine di usarlo in modo esclusivo, è possibile acquisire un [lease](http://msdn.microsoft.com/library/azure/ee691972.aspx) su di esso.</span><span class="sxs-lookup"><span data-stu-id="04962-230">To lock a blob for exclusive use, you can acquire a [lease](http://msdn.microsoft.com/library/azure/ee691972.aspx) on it.</span></span> <span data-ttu-id="04962-231">Quando si acquisisce un lease, specificarne la durata, che può essere inclusa tra 15 e 60 secondi o essere infinita, il che equivale a un blocco esclusivo.</span><span class="sxs-lookup"><span data-stu-id="04962-231">When you acquire a lease, you specify for how long you need the lease: this can be for between 15 to 60 seconds or infinite which amounts to an exclusive lock.</span></span> <span data-ttu-id="04962-232">È possibile rinnovare un lease finito per estenderlo e rilasciare qualsiasi lease al termine dell'uso.</span><span class="sxs-lookup"><span data-stu-id="04962-232">You can renew a finite lease to extend it, and you can release any lease when you are finished with it.</span></span> <span data-ttu-id="04962-233">Il servizio BLOB rilascia automaticamente i lease finiti alla scadenza.</span><span class="sxs-lookup"><span data-stu-id="04962-233">The blob service automatically releases finite leases when they expire.</span></span>  

<span data-ttu-id="04962-234">I lease abilitano il supporto di strategie di sincronizzazione diverse, tra cui la scrittura esclusiva/la lettura condivisa, la scrittura esclusiva/la lettura esclusiva e la scrittura condivisa/la lettura esclusiva.</span><span class="sxs-lookup"><span data-stu-id="04962-234">Leases enable different synchronization strategies to be supported, including exclusive write / shared read, exclusive write / exclusive read and shared write / exclusive read.</span></span> <span data-ttu-id="04962-235">In presenza di un lease il servizio di archiviazione applica scritture esclusive (operazioni Put, Set e Delete); tuttavia, garantire l'esclusività per le operazioni di lettura richiede allo sviluppatore di verificare che tutte le applicazioni client usino un ID lease e che un solo client alla volta disponga di un ID lease valido.</span><span class="sxs-lookup"><span data-stu-id="04962-235">Where a lease exists the storage service enforces exclusive writes (put, set and delete operations) however ensuring exclusivity for read operations requires the developer to ensure that all client applications use a lease ID and that only one client at a time has a valid lease ID.</span></span> <span data-ttu-id="04962-236">Le operazioni di lettura che non includono un ID lease determinano letture condivise.</span><span class="sxs-lookup"><span data-stu-id="04962-236">Read operations that do not include a lease ID result in shared reads.</span></span>  

<span data-ttu-id="04962-237">Il frammento C# seguente mostra un esempio relativo all'acquisizione di un lease esclusivo per 30 secondi su un BLOB, all'aggiornamento del contenuto del BLOB e al successivo rilascio del lease.</span><span class="sxs-lookup"><span data-stu-id="04962-237">The following C# snippet shows an example of acquiring an exclusive lease for 30 seconds on a blob, updating the content of the blob, and then releasing the lease.</span></span> <span data-ttu-id="04962-238">Se è già presente un lease valido sul BLOB quando si prova ad acquisire un nuovo lease, il servizio BLOB restituisce un risultato di stato "HTTP 409 - Conflitto".</span><span class="sxs-lookup"><span data-stu-id="04962-238">If there is already a valid lease on the blob when you try to acquire a new lease, the blob service returns an "HTTP (409) Conflict" status result.</span></span> <span data-ttu-id="04962-239">Il frammento seguente usa un oggetto **AccessCondition** per incapsulare le informazioni relative al lease quando effettua una richiesta per aggiornare il BLOB nel servizio di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="04962-239">The snippet below uses an **AccessCondition** object to encapsulate the lease information when it makes a request to update the blob in the storage service.</span></span>  <span data-ttu-id="04962-240">È possibile scaricare l'intero esempio dalla pagina relativa alla [gestione della concorrenza con Archiviazione di Azure](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="04962-240">You can download the full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>

```csharp
// Acquire lease for 15 seconds
string lease = blockBlob.AcquireLease(TimeSpan.FromSeconds(15), null);
Console.WriteLine("Blob lease acquired. Lease = {0}", lease);

// Update blob using lease. This operation will succeed
const string helloText = "Blob updated";
var accessCondition = AccessCondition.GenerateLeaseCondition(lease);
blockBlob.UploadText(helloText, accessCondition: accessCondition);
Console.WriteLine("Blob updated using an exclusive lease");

//Simulate third party update to blob without lease
try
{
    // Below operation will fail as no valid lease provided
    Console.WriteLine("Trying to update blob without valid lease");
    blockBlob.UploadText("Update without lease, will fail");
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == (int)HttpStatusCode.PreconditionFailed)
        Console.WriteLine("Precondition failure as expected. Blob's lease does not match");
    else
        throw;
}  
```

<span data-ttu-id="04962-241">Se si prova a effettuare un'operazione di scrittura su un BLOB con lease senza passare l'ID lease, la richiesta ha esito negativo con un errore 412.</span><span class="sxs-lookup"><span data-stu-id="04962-241">If you attempt a write operation on a leased blob without passing the lease ID, the request fails with a 412 error.</span></span> <span data-ttu-id="04962-242">Si noti che la richiesta ha esito negativo con un errore **412** anche se il lease scade prima di chiamare il metodo **UploadText** ma si passa comunque l'ID.</span><span class="sxs-lookup"><span data-stu-id="04962-242">Note that if the lease expires before calling the **UploadText** method but you still pass the lease ID, the request also fails with a **412** error.</span></span> <span data-ttu-id="04962-243">Per altre informazioni sulla gestione degli ID lease e dei tempi di scadenza del lease, vedere la documentazione REST [Lease Blob](http://msdn.microsoft.com/library/azure/ee691972.aspx) .</span><span class="sxs-lookup"><span data-stu-id="04962-243">For more information about managing lease expiry times and lease ids, see the [Lease Blob](http://msdn.microsoft.com/library/azure/ee691972.aspx) REST documentation.</span></span>  

<span data-ttu-id="04962-244">Le operazioni BLOB seguenti possono usare i lease per gestire la concorrenza pessimistica:</span><span class="sxs-lookup"><span data-stu-id="04962-244">The following blob operations can use leases to manage pessimistic concurrency:</span></span>  

* <span data-ttu-id="04962-245">Put Blob</span><span class="sxs-lookup"><span data-stu-id="04962-245">Put Blob</span></span>
* <span data-ttu-id="04962-246">Get Blob</span><span class="sxs-lookup"><span data-stu-id="04962-246">Get Blob</span></span>
* <span data-ttu-id="04962-247">Get Blob Properties</span><span class="sxs-lookup"><span data-stu-id="04962-247">Get Blob Properties</span></span>
* <span data-ttu-id="04962-248">Set Blob Properties</span><span class="sxs-lookup"><span data-stu-id="04962-248">Set Blob Properties</span></span>
* <span data-ttu-id="04962-249">Get Blob Metadata</span><span class="sxs-lookup"><span data-stu-id="04962-249">Get Blob Metadata</span></span>
* <span data-ttu-id="04962-250">Set Blob Metadata</span><span class="sxs-lookup"><span data-stu-id="04962-250">Set Blob Metadata</span></span>
* <span data-ttu-id="04962-251">Delete Blob</span><span class="sxs-lookup"><span data-stu-id="04962-251">Delete Blob</span></span>
* <span data-ttu-id="04962-252">Put Block</span><span class="sxs-lookup"><span data-stu-id="04962-252">Put Block</span></span>
* <span data-ttu-id="04962-253">Put Block List</span><span class="sxs-lookup"><span data-stu-id="04962-253">Put Block List</span></span>
* <span data-ttu-id="04962-254">Get Block List</span><span class="sxs-lookup"><span data-stu-id="04962-254">Get Block List</span></span>
* <span data-ttu-id="04962-255">Put Page</span><span class="sxs-lookup"><span data-stu-id="04962-255">Put Page</span></span>
* <span data-ttu-id="04962-256">Get Page Ranges</span><span class="sxs-lookup"><span data-stu-id="04962-256">Get Page Ranges</span></span>
* <span data-ttu-id="04962-257">Snapshot Blob: ID lease facoltativo se esiste un lease</span><span class="sxs-lookup"><span data-stu-id="04962-257">Snapshot Blob - lease ID optional if a lease exists</span></span>
* <span data-ttu-id="04962-258">Copy Blob: ID lease obbligatorio se esiste un lease nel BLOB di destinazione</span><span class="sxs-lookup"><span data-stu-id="04962-258">Copy Blob - lease ID required if a lease exists on the destination blob</span></span>
* <span data-ttu-id="04962-259">Abort Copy Blob: ID lease obbligatorio se esiste un lease infinito nel BLOB di destinazione</span><span class="sxs-lookup"><span data-stu-id="04962-259">Abort Copy Blob - lease ID required if an infinite lease exists on the destination blob</span></span>
* <span data-ttu-id="04962-260">Lease Blob</span><span class="sxs-lookup"><span data-stu-id="04962-260">Lease Blob</span></span>  

### <a name="pessimistic-concurrency-for-containers"></a><span data-ttu-id="04962-261">Concorrenza pessimistica per i contenitori</span><span class="sxs-lookup"><span data-stu-id="04962-261">Pessimistic concurrency for containers</span></span>
<span data-ttu-id="04962-262">I lease sui contenitori abilitano il supporto delle stesse strategie di sincronizzazione dei BLOB (scrittura esclusiva/lettura condivisa, scrittura esclusiva/lettura esclusiva e scrittura condivisa/lettura esclusiva); tuttavia, a differenza dei BLOB il servizio di archiviazione applica l'esclusività solo alle operazioni Delete.</span><span class="sxs-lookup"><span data-stu-id="04962-262">Leases on containers enable the same synchronization strategies to be supported as on blobs (exclusive write / shared read, exclusive write / exclusive read and shared write / exclusive read) however unlike blobs the storage service only enforces exclusivity on delete operations.</span></span> <span data-ttu-id="04962-263">Per eliminare un contenitore con un lease attivo, un client deve includere l'ID lease attivo con la richiesta di eliminazione.</span><span class="sxs-lookup"><span data-stu-id="04962-263">To delete a container with an active lease, a client must include the active lease ID with the delete request.</span></span> <span data-ttu-id="04962-264">Tutte le altre operazioni contenitore hanno esito positivo su un contenitore con lease senza includere l'ID lease, nel qual caso sono operazioni condivise.</span><span class="sxs-lookup"><span data-stu-id="04962-264">All other container operations succeed on a leased container without including the lease ID in which case they are shared operations.</span></span> <span data-ttu-id="04962-265">Se è richiesta l'esclusività di un'operazione di aggiornamento (Put o Set) o di lettura, gli sviluppatori devono garantire che tutti i client usino un ID lease e che un solo client alla volta abbia un ID lease valido.</span><span class="sxs-lookup"><span data-stu-id="04962-265">If exclusivity of update (put or set) or read operations is required then developers should ensure all clients use a lease ID and that only one client at a time has a valid lease ID.</span></span>  

<span data-ttu-id="04962-266">Le operazioni contenitore seguenti possono usare i lease per gestire la concorrenza pessimistica:</span><span class="sxs-lookup"><span data-stu-id="04962-266">The following container operations can use leases to manage pessimistic concurrency:</span></span>  

* <span data-ttu-id="04962-267">Delete Container</span><span class="sxs-lookup"><span data-stu-id="04962-267">Delete Container</span></span>
* <span data-ttu-id="04962-268">Get Container Properties</span><span class="sxs-lookup"><span data-stu-id="04962-268">Get Container Properties</span></span>
* <span data-ttu-id="04962-269">Get Container Metadata</span><span class="sxs-lookup"><span data-stu-id="04962-269">Get Container Metadata</span></span>
* <span data-ttu-id="04962-270">Set Container Metadata</span><span class="sxs-lookup"><span data-stu-id="04962-270">Set Container Metadata</span></span>
* <span data-ttu-id="04962-271">Get Container ACL</span><span class="sxs-lookup"><span data-stu-id="04962-271">Get Container ACL</span></span>
* <span data-ttu-id="04962-272">Set Container ACL</span><span class="sxs-lookup"><span data-stu-id="04962-272">Set Container ACL</span></span>
* <span data-ttu-id="04962-273">Lease Container</span><span class="sxs-lookup"><span data-stu-id="04962-273">Lease Container</span></span>  

<span data-ttu-id="04962-274">Per altre informazioni, vedere:</span><span class="sxs-lookup"><span data-stu-id="04962-274">For more information see:</span></span>  

* [<span data-ttu-id="04962-275">Specifica di intestazioni condizionali per le operazioni del servizio BLOB</span><span class="sxs-lookup"><span data-stu-id="04962-275">Specifying Conditional Headers for Blob Service Operations</span></span>](http://msdn.microsoft.com/library/azure/dd179371.aspx)
* [<span data-ttu-id="04962-276">Lease Container</span><span class="sxs-lookup"><span data-stu-id="04962-276">Lease Container</span></span>](http://msdn.microsoft.com/library/azure/jj159103.aspx)
* [<span data-ttu-id="04962-277">Lease Blob </span><span class="sxs-lookup"><span data-stu-id="04962-277">Lease Blob </span></span>](http://msdn.microsoft.com/library/azure/ee691972.aspx)

## <a name="managing-concurrency-in-the-table-service"></a><span data-ttu-id="04962-278">Gestione della concorrenza nel servizio tabelle</span><span class="sxs-lookup"><span data-stu-id="04962-278">Managing Concurrency in the Table Service</span></span>
<span data-ttu-id="04962-279">Il servizio tabelle usa i controlli della concorrenza ottimistica come comportamento predefinito quando si usano entità, a differenza del servizio BLOB in cui è necessario scegliere esplicitamente di eseguire controlli di concorrenza ottimistica.</span><span class="sxs-lookup"><span data-stu-id="04962-279">The table service uses optimistic concurrency checks as the default behavior when you are working with entities, unlike the blob service where you must explicitly choose to perform optimistic concurrency checks.</span></span> <span data-ttu-id="04962-280">L'altra differenza tra il servizio tabelle e il servizio BLOB risiede nel fatto che con il primo è possibile gestire solo il comportamento di concorrenza delle entità, mentre con il servizio BLOB è possibile gestire la concorrenza sia dei contenitori sia dei BLOB.</span><span class="sxs-lookup"><span data-stu-id="04962-280">The other difference between the table and blob services is that you can only manage the concurrency behavior of entities whereas with the blob service you can manage the concurrency of both containers and blobs.</span></span>  

<span data-ttu-id="04962-281">Per usare la concorrenza ottimistica e controllare se un altro processo ha modificato un'entità da quando questa è stata recuperata dal servizio di archiviazione tabelle, è possibile usare il valore ETag ricevuto quando il servizio tabelle restituisce un'entità.</span><span class="sxs-lookup"><span data-stu-id="04962-281">To use optimistic concurrency and to check if another process modified an entity since you retrieved it from the table storage service, you can use the ETag value you receive when the table service returns an entity.</span></span> <span data-ttu-id="04962-282">Il processo è il seguente:</span><span class="sxs-lookup"><span data-stu-id="04962-282">The outline of this process is as follows:</span></span>  

1. <span data-ttu-id="04962-283">Recuperare un'entità da un servizio di archiviazione tabelle; la risposta include un valore ETag che identifica l'identificatore corrente associato all'entità nel servizio di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="04962-283">Retrieve an entity from the table storage service, the response includes an ETag value that identifies the current identifier associated with that entity in the storage service.</span></span>
2. <span data-ttu-id="04962-284">Quando si aggiorna l'entità, includere il valore ETag ricevuto al passaggio 1 nell'intestazione **If-Match** obbligatoria della richiesta inviata al servizio.</span><span class="sxs-lookup"><span data-stu-id="04962-284">When you update the entity, include the ETag value you received in step 1 in the mandatory **If-Match** header of the request you send to the service.</span></span>
3. <span data-ttu-id="04962-285">Il servizio confronta il valore ETag nella richiesta con il valore ETag corrente dell'entità.</span><span class="sxs-lookup"><span data-stu-id="04962-285">The service compares the ETag value in the request with the current ETag value of the entity.</span></span>
4. <span data-ttu-id="04962-286">Se il valore ETag corrente del BLOB è diverso dall'ETag nell'intestazione **If-Match** obbligatoria nella richiesta, il servizio restituisce un errore 412 al client.</span><span class="sxs-lookup"><span data-stu-id="04962-286">If the current ETag value of the entity is different than the ETag in the mandatory **If-Match** header in the request, the service returns a 412 error to the client.</span></span> <span data-ttu-id="04962-287">Ciò indica al cliente che un altro processo ha aggiornato l'entità da quando questa è stata recuperata dal client.</span><span class="sxs-lookup"><span data-stu-id="04962-287">This indicates to the client that another process has updated the entity since the client retrieved it.</span></span>
5. <span data-ttu-id="04962-288">Se il valore ETag corrente dell'entità è uguale all'ETag nell'intestazione **If-Match** obbligatoria della richiesta o se l'intestazione **If-Match** contiene il carattere jolly (*), il servizio esegue l'operazione richiesta e aggiorna il valore ETag corrente dell'entità per indicare che è stato aggiornato.</span><span class="sxs-lookup"><span data-stu-id="04962-288">If the current ETag value of the entity is the same as the ETag in the mandatory **If-Match** header in the request or the **If-Match** header contains the wildcard character (*), the service performs the requested operation and updates the current ETag value of the entity to show that it has been updated.</span></span>  

<span data-ttu-id="04962-289">Si noti che, a differenza del servizio BLOB, il servizio tabelle richiede che il client includa un'intestazione **If-Match** nelle richieste di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="04962-289">Note that unlike the blob service, the table service requires the client to include an **If-Match** header in update requests.</span></span> <span data-ttu-id="04962-290">Tuttavia, è possibile forzare un aggiornamento condizionale (strategia della prevalenza dell'ultima scrittura) e ignorare i controlli della concorrenza se il client imposta l'intestazione **If-Match** sul carattere jolly (*) nella richiesta.</span><span class="sxs-lookup"><span data-stu-id="04962-290">However, it is possible to force an unconditional update (last writer wins strategy) and bypass concurrency checks if the client sets the **If-Match** header to the wildcard character (*) in the request.</span></span>  

<span data-ttu-id="04962-291">Il seguente frammento C# mostra un'entità del cliente precedentemente creata o recuperata con l'aggiornamento dell'indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="04962-291">The following C# snippet shows a customer entity that was previously either created or retrieved having their email address updated.</span></span> <span data-ttu-id="04962-292">L'operazione iniziale di inserimento o recupero archivia il valore ETag nell'oggetto del cliente e, poiché l'esempio usa la stessa istanza di oggetto quando esegue l'operazione di sostituzione, invia automaticamente il valore ETag alla tabella, consentendo al servizio di verificare l'eventuale presenza di violazioni della concorrenza.</span><span class="sxs-lookup"><span data-stu-id="04962-292">The initial insert or retrieve operation stores the ETag value in the customer object, and because the sample uses the same object instance when it executes the replace operation, it automatically sends the ETag value back to the table service, enabling the service to check for concurrency violations.</span></span> <span data-ttu-id="04962-293">Se un altro processo ha aggiornato l'entità nella tabella di archiviazione, il servizio restituisce un messaggio di stato HTTP 412 (Condizione preliminare non riuscita).</span><span class="sxs-lookup"><span data-stu-id="04962-293">If another process has updated the entity in table storage, the service returns an HTTP 412 (Precondition Failed) status message.</span></span>  <span data-ttu-id="04962-294">È possibile scaricare l'intero esempio dalla pagina relativa alla [gestione della concorrenza con Archiviazione di Azure](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="04962-294">You can download the full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>

```csharp
try
{
    customer.Email = "updatedEmail@contoso.org";
    TableOperation replaceCustomer = TableOperation.Replace(customer);
    customerTable.Execute(replaceCustomer);
    Console.WriteLine("Replace operation succeeded.");
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == 412)
        Console.WriteLine("Optimistic concurrency violation – entity has changed since it was retrieved.");
    else
        throw;
}  
```

<span data-ttu-id="04962-295">Per disabilitare esplicitamente il controllo della concorrenza, è necessario impostare la proprietà **ETag** dell'oggetto **employee** su "*" prima di eseguire l'operazione di sostituzione.</span><span class="sxs-lookup"><span data-stu-id="04962-295">To explicitly disable the concurrency check, you should set the **ETag** property of the **employee** object to "*" before you execute the replace operation.</span></span>  

```csharp
customer.ETag = "*";  
```

<span data-ttu-id="04962-296">Nella tabella seguente sono riepilogate le modalità in cui le operazioni delle entità di tabella usano i valori ETag:</span><span class="sxs-lookup"><span data-stu-id="04962-296">The following table summarizes how the table entity operations use ETag values:</span></span>

| <span data-ttu-id="04962-297">Operazione</span><span class="sxs-lookup"><span data-stu-id="04962-297">Operation</span></span> | <span data-ttu-id="04962-298">Restituisce il valore ETag</span><span class="sxs-lookup"><span data-stu-id="04962-298">Returns ETag value</span></span> | <span data-ttu-id="04962-299">Richiede l'intestazione della richiesta If-Match</span><span class="sxs-lookup"><span data-stu-id="04962-299">Requires If-Match request header</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="04962-300">Query Entities</span><span class="sxs-lookup"><span data-stu-id="04962-300">Query Entities</span></span> |<span data-ttu-id="04962-301">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-301">Yes</span></span> |<span data-ttu-id="04962-302">No</span><span class="sxs-lookup"><span data-stu-id="04962-302">No</span></span> |
| <span data-ttu-id="04962-303">Insert Entity</span><span class="sxs-lookup"><span data-stu-id="04962-303">Insert Entity</span></span> |<span data-ttu-id="04962-304">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-304">Yes</span></span> |<span data-ttu-id="04962-305">No</span><span class="sxs-lookup"><span data-stu-id="04962-305">No</span></span> |
| <span data-ttu-id="04962-306">Update Entity</span><span class="sxs-lookup"><span data-stu-id="04962-306">Update Entity</span></span> |<span data-ttu-id="04962-307">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-307">Yes</span></span> |<span data-ttu-id="04962-308">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-308">Yes</span></span> |
| <span data-ttu-id="04962-309">Merge Entity</span><span class="sxs-lookup"><span data-stu-id="04962-309">Merge Entity</span></span> |<span data-ttu-id="04962-310">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-310">Yes</span></span> |<span data-ttu-id="04962-311">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-311">Yes</span></span> |
| <span data-ttu-id="04962-312">Delete Entity</span><span class="sxs-lookup"><span data-stu-id="04962-312">Delete Entity</span></span> |<span data-ttu-id="04962-313">No</span><span class="sxs-lookup"><span data-stu-id="04962-313">No</span></span> |<span data-ttu-id="04962-314">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-314">Yes</span></span> |
| <span data-ttu-id="04962-315">Insert or Replace Entity</span><span class="sxs-lookup"><span data-stu-id="04962-315">Insert or Replace Entity</span></span> |<span data-ttu-id="04962-316">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-316">Yes</span></span> |<span data-ttu-id="04962-317">No</span><span class="sxs-lookup"><span data-stu-id="04962-317">No</span></span> |
| <span data-ttu-id="04962-318">Insert or Merge Entity</span><span class="sxs-lookup"><span data-stu-id="04962-318">Insert or Merge Entity</span></span> |<span data-ttu-id="04962-319">Sì</span><span class="sxs-lookup"><span data-stu-id="04962-319">Yes</span></span> |<span data-ttu-id="04962-320">No</span><span class="sxs-lookup"><span data-stu-id="04962-320">No</span></span> |

<span data-ttu-id="04962-321">SI noti che le operazioni **Insert or Replace Entity** e **Insert or Merge Entity** *non* eseguono alcun controllo di concorrenza perché non inviano un valore ETag al servizio tabelle.</span><span class="sxs-lookup"><span data-stu-id="04962-321">Note that the **Insert or Replace Entity** and **Insert or Merge Entity** operations do *not* perform any concurrency checks because they do not send an ETag value to the table service.</span></span>  

<span data-ttu-id="04962-322">In generale gli sviluppatori che usano tabelle devono fare affidamento sulla concorrenza ottimistica quando sviluppano applicazioni scalabili.</span><span class="sxs-lookup"><span data-stu-id="04962-322">In general developers using tables should rely on optimistic concurrency when developing scalable applications.</span></span> <span data-ttu-id="04962-323">Se è necessario un blocco pessimistico, un possibile approccio che gli sviluppatori possono adottare quando effettuano l'accesso alle tabelle è di assegnare un BLOB designato per ciascuna tabella e provare ad acquisire un lease sul BLOB prima di eseguire operazioni sulla tabella.</span><span class="sxs-lookup"><span data-stu-id="04962-323">If pessimistic locking is needed, one approach developers can take when accessing Tables is to assign a designated blob for each table and try to take a lease on the blob before operating on the table.</span></span> <span data-ttu-id="04962-324">Adottando questo approccio è necessario che l'applicazione verifichi che tutti i percorsi di accesso ai dati ottengano il lease prima di eseguire operazioni sulla tabella.</span><span class="sxs-lookup"><span data-stu-id="04962-324">This approach does require the application to ensure all data access paths obtain the lease prior to operating on the table.</span></span> <span data-ttu-id="04962-325">Occorre inoltre notare che il tempo di lease minimo è di 15 secondi, pertanto è necessario prestare una particolare attenzione alla scalabilità.</span><span class="sxs-lookup"><span data-stu-id="04962-325">You should also note that the minimum lease time is 15 seconds which requires careful consideration for scalability.</span></span>  

<span data-ttu-id="04962-326">Per altre informazioni, vedere:</span><span class="sxs-lookup"><span data-stu-id="04962-326">For more information see:</span></span>  

* [<span data-ttu-id="04962-327">Operazioni sulle entità</span><span class="sxs-lookup"><span data-stu-id="04962-327">Operations on Entities</span></span>](http://msdn.microsoft.com/library/azure/dd179375.aspx)  

## <a name="managing-concurrency-in-the-queue-service"></a><span data-ttu-id="04962-328">Gestione della concorrenza nel servizio di accodamento</span><span class="sxs-lookup"><span data-stu-id="04962-328">Managing Concurrency in the Queue Service</span></span>
<span data-ttu-id="04962-329">Uno scenario in cui la concorrenza rappresenta un problema nel servizio di accodamento è quello in cui più client recuperano i messaggi da una coda.</span><span class="sxs-lookup"><span data-stu-id="04962-329">One scenario in which concurrency is a concern in the queueing service is where multiple clients are retrieving messages from a queue.</span></span> <span data-ttu-id="04962-330">Quando un messaggio viene recuperato dalla coda, la risposta include il messaggio e un valore di ricezione POP, necessario per eliminare il messaggio.</span><span class="sxs-lookup"><span data-stu-id="04962-330">When a message is retrieved from the queue, the response includes the message and a pop receipt value, which is required to delete the message.</span></span> <span data-ttu-id="04962-331">Il messaggio non viene eliminato automaticamente dalla coda, ma dopo essere stato recuperato non è visibile agli altri client per l'intervallo di tempo specificato dal parametro visibilitytimeout.</span><span class="sxs-lookup"><span data-stu-id="04962-331">The message is not automatically deleted from the queue, but after it has been retrieved, it is not visible to other clients for the time interval specified by the visibilitytimeout parameter.</span></span> <span data-ttu-id="04962-332">Il client che recupera il messaggio lo elimina dopo che è stato elaborato e prima dell'ora specificata dall'elemento TimeNextVisible della risposta, calcolata in base al valore del parametro visibilitytimeout.</span><span class="sxs-lookup"><span data-stu-id="04962-332">The client that retrieves the message is expected to delete the message after it has been processed, and before the time specified by the TimeNextVisible element of the response, which is calculated based on the value of the visibilitytimeout parameter.</span></span> <span data-ttu-id="04962-333">Il valore di visibilitytimeout viene aggiunto all'ora in cui viene recuperato il messaggio per determinare il valore di TimeNextVisible.</span><span class="sxs-lookup"><span data-stu-id="04962-333">The value of visibilitytimeout is added to the time at which the message is retrieved to determine the value of TimeNextVisible.</span></span>  

<span data-ttu-id="04962-334">Il servizio di accodamento non offre il supporto della concorrenza ottimistica o pessimistica e per questo motivo i client che elaborano messaggi recuperati da una coda devono garantire che vengano recuperati in un modo idempotente.</span><span class="sxs-lookup"><span data-stu-id="04962-334">The queue service does not have support for either optimistic or pessimistic concurrency and for this reason clients processing messages retrieved from a queue should ensure messages are processed in an idempotent manner.</span></span> <span data-ttu-id="04962-335">Una strategia in cui prevale l'ultima scrittura viene usata per aggiornare operazioni quali SetQueueServiceProperties, SetQueueMetaData, SetQueueACL e UpdateMessage.</span><span class="sxs-lookup"><span data-stu-id="04962-335">A last writer wins strategy is used for update operations such as SetQueueServiceProperties, SetQueueMetaData, SetQueueACL and UpdateMessage.</span></span>  

<span data-ttu-id="04962-336">Per altre informazioni, vedere:</span><span class="sxs-lookup"><span data-stu-id="04962-336">For more information see:</span></span>  

* [<span data-ttu-id="04962-337">API REST del servizio di accodamento</span><span class="sxs-lookup"><span data-stu-id="04962-337">Queue Service REST API</span></span>](http://msdn.microsoft.com/library/azure/dd179363.aspx)
* [<span data-ttu-id="04962-338">Get Messages</span><span class="sxs-lookup"><span data-stu-id="04962-338">Get Messages</span></span>](http://msdn.microsoft.com/library/azure/dd179474.aspx)  

## <a name="managing-concurrency-in-the-file-service"></a><span data-ttu-id="04962-339">Gestione della concorrenza nel servizio file</span><span class="sxs-lookup"><span data-stu-id="04962-339">Managing Concurrency in the File Service</span></span>
<span data-ttu-id="04962-340">È possibile accedere al servizio file usando due diversi endpoint di protocollo: SMB e REST.</span><span class="sxs-lookup"><span data-stu-id="04962-340">The file service can be accessed using two different protocol endpoints – SMB and REST.</span></span> <span data-ttu-id="04962-341">Il servizio REST non presenta il supporto per il blocco ottimistico o pessimistico e tutti gli aggiornamenti seguiranno una strategia basata sulla prevalenza dell'ultima scrittura.</span><span class="sxs-lookup"><span data-stu-id="04962-341">The REST service does not have support for either optimistic locking or pessimistic locking and all updates will follow a last writer wins strategy.</span></span> <span data-ttu-id="04962-342">I client SMB che montano condivisioni file possono usare meccanismi di blocco del file system per gestire l'accesso ai file condivisi, inclusa la possibilità di eseguire il blocco pessimistico.</span><span class="sxs-lookup"><span data-stu-id="04962-342">SMB clients that mount file shares can leverage file system locking mechanisms to manage access to shared files – including the ability to perform pessimistic locking.</span></span> <span data-ttu-id="04962-343">Quando un client SMB apre un file, specifica sia l'accesso al file sia la modalità di condivisione.</span><span class="sxs-lookup"><span data-stu-id="04962-343">When an SMB client opens a file, it specifies both the file access and share mode.</span></span> <span data-ttu-id="04962-344">L'impostazione di un'opzione di accesso al file "in scrittura" o "in lettura/scrittura" insieme a una modalità di condivisione file impostata su "nessuna" determinerà il blocco del file da parte di un client SMB fino alla chiusura del file.</span><span class="sxs-lookup"><span data-stu-id="04962-344">Setting a File Access option of "Write" or "Read/Write" along with a File Share mode of "None" will result in the file being locked by an SMB client until the file is closed.</span></span> <span data-ttu-id="04962-345">Se si prova a eseguire l'operazione REST su un file in cui un client SMB ha applicato un blocco, il servizio REST restituirà il codice di stato 409 (Conflitto) con il codice errore SharingViolation.</span><span class="sxs-lookup"><span data-stu-id="04962-345">If REST operation is attempted on a file where an SMB client has the file locked the REST service will return status code 409 (Conflict) with error code SharingViolation.</span></span>  

<span data-ttu-id="04962-346">Quando un client SMB apre un file per eliminarlo, lo contrassegna come in attesa dell'eliminazione fino a quando tutti gli altri handle aperti del client SMB su tale file vengono chiusi.</span><span class="sxs-lookup"><span data-stu-id="04962-346">When an SMB client opens a file for delete, it marks the file as pending delete until all other SMB client open handles on that file are closed.</span></span> <span data-ttu-id="04962-347">Quando un file viene contrassegnato come in attesa di eliminazione, qualsiasi operazione REST su tale file restituirà il codice di stato 409 (Conflitto) con codice errore SMBDeletePending.</span><span class="sxs-lookup"><span data-stu-id="04962-347">While a file is marked as pending delete, any REST operation on that file will return status code 409 (Conflict) with error code SMBDeletePending.</span></span> <span data-ttu-id="04962-348">Il codice di stato 404 (Non trovato) non viene restituito perché è il client SMB può rimuovere il flag di eliminazione in sospeso prima di chiudere il file.</span><span class="sxs-lookup"><span data-stu-id="04962-348">Status code 404 (Not Found) is not returned since it is possible for the SMB client to remove the pending deletion flag prior to closing the file.</span></span> <span data-ttu-id="04962-349">In altre parole, il codice di stato 404 (Non trovato) è previsto solo dopo la rimozione del file.</span><span class="sxs-lookup"><span data-stu-id="04962-349">In other words, status code 404 (Not Found) is only expected when the file has been removed.</span></span> <span data-ttu-id="04962-350">Si noti che se un file si trova in uno stato di attesa dell'eliminazione da parte del client SMB non sarà incluso nei risultati degli elenchi di file. Inoltre, le operazioni di eliminazione dei file e di eliminazione della directory REST vengono sottoposte a commit in modo atomico e non determinano lo stato di eliminazione in sospeso.</span><span class="sxs-lookup"><span data-stu-id="04962-350">Note that while a file is in a SMB pending delete state, it will not be included in the List Files results.Also note that the REST Delete File and REST Delete Directory operations are committed atomically and do not result in pending delete state.</span></span>  

<span data-ttu-id="04962-351">Per altre informazioni, vedere:</span><span class="sxs-lookup"><span data-stu-id="04962-351">For more information see:</span></span>  

* [<span data-ttu-id="04962-352">Managing File Locks</span><span class="sxs-lookup"><span data-stu-id="04962-352">Managing File Locks</span></span>](http://msdn.microsoft.com/library/azure/dn194265.aspx)  

## <a name="summary-and-next-steps"></a><span data-ttu-id="04962-353">Riepilogo e passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="04962-353">Summary and Next Steps</span></span>
<span data-ttu-id="04962-354">Il servizio di archiviazione di Microsoft Azure è stato progettato per soddisfare le esigenze delle applicazioni online più complesse senza obbligare gli sviluppatori a scendere a compromessi o a ridefinire presupposti di progettazione chiave dati per scontate, come la concorrenza e la coerenza dei dati.</span><span class="sxs-lookup"><span data-stu-id="04962-354">The Microsoft Azure Storage service has been designed to meet the needs of the most complex online applications without forcing developers to compromise or rethink key design assumptions such as concurrency and data consistency that they have come to take for granted.</span></span>  

<span data-ttu-id="04962-355">Per l'applicazione di esempio completa alla quale si fa riferimento in questo blog, vedere:</span><span class="sxs-lookup"><span data-stu-id="04962-355">For the complete sample application referenced in this blog:</span></span>  

* [<span data-ttu-id="04962-356">Gestione della concorrenza con l'archiviazione di Azure - Applicazione di esempio</span><span class="sxs-lookup"><span data-stu-id="04962-356">Managing Concurrency using Azure Storage - Sample Application</span></span>](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114)  

<span data-ttu-id="04962-357">Per altre informazioni sull'archiviazione di Azure, vedere:</span><span class="sxs-lookup"><span data-stu-id="04962-357">For more information on Azure Storage see:</span></span>  

* [<span data-ttu-id="04962-358">Home page di Archiviazione di Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="04962-358">Microsoft Azure Storage Home Page</span></span>](https://azure.microsoft.com/services/storage/)
* [<span data-ttu-id="04962-359">Introduzione ad Archiviazione di Azure</span><span class="sxs-lookup"><span data-stu-id="04962-359">Introduction to Azure Storage</span></span>](storage-introduction.md)
* <span data-ttu-id="04962-360">Introduzione all'archiviazione per [BLOB](storage-dotnet-how-to-use-blobs.md), [tabelle](storage-dotnet-how-to-use-tables.md), [code](storage-dotnet-how-to-use-queues.md) e [file](storage-dotnet-how-to-use-files.md)</span><span class="sxs-lookup"><span data-stu-id="04962-360">Storage Getting Started for [Blob](storage-dotnet-how-to-use-blobs.md), [Table](storage-dotnet-how-to-use-tables.md),  [Queues](storage-dotnet-how-to-use-queues.md), and [Files](storage-dotnet-how-to-use-files.md)</span></span>
* <span data-ttu-id="04962-361">Architettura di archiviazione - [Archiviazione di Azure: un servizio di archiviazione cloud a elevata disponibilità con coerenza assoluta](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx)</span><span class="sxs-lookup"><span data-stu-id="04962-361">Storage Architecture – [Azure Storage : A Highly Available Cloud Storage Service with Strong Consistency](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx)</span></span>

