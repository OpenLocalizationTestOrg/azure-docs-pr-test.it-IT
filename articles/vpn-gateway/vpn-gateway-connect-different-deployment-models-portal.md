---
title: 'Connettere le reti virtuali classiche alle reti virtuali di Azure Resource Manager: portale| Documentazione Microsoft'
description: Informazioni su come creare una connessione VPN tra le reti virtuali classiche e le reti virtuali di Resource Manager usando il gateway VPN e il portale
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: timlt
editor: 
tags: azure-service-management,azure-resource-manager
ms.assetid: 5a90498c-4520-4bd3-a833-ad85924ecaf9
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/21/2017
ms.author: cherylmc
ms.openlocfilehash: 1b7b67ec28986b7c20b3e990e3565265f74c28e6
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/03/2017
---
# <a name="connect-virtual-networks-from-different-deployment-models-using-the-portal"></a><span data-ttu-id="5a285-103">Connettere reti virtuali da modelli di distribuzione diversi usando il portale</span><span class="sxs-lookup"><span data-stu-id="5a285-103">Connect virtual networks from different deployment models using the portal</span></span>

<span data-ttu-id="5a285-104">Questo articolo descrive come connettere reti virtuali classiche a reti virtuali di Resource Manager per consentire alle risorse presenti nei modelli di distribuzione separati di comunicare tra di loro.</span><span class="sxs-lookup"><span data-stu-id="5a285-104">This article shows you how to connect classic VNets to Resource Manager VNets to allow the resources located in the separate deployment models to communicate with each other.</span></span> <span data-ttu-id="5a285-105">La procedura descritta in questo articolo utilizza principalmente il portale di Azure, tuttavia è inoltre possibile creare questa configurazione tramite PowerShell selezionando l'articolo da questo elenco.</span><span class="sxs-lookup"><span data-stu-id="5a285-105">The steps in this article primarily use the Azure portal, but you can also create this configuration using the PowerShell by selecting the article from this list.</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="5a285-106">Portale</span><span class="sxs-lookup"><span data-stu-id="5a285-106">Portal</span></span>](vpn-gateway-connect-different-deployment-models-portal.md)
> * [<span data-ttu-id="5a285-107">PowerShell</span><span class="sxs-lookup"><span data-stu-id="5a285-107">PowerShell</span></span>](vpn-gateway-connect-different-deployment-models-powershell.md)
> 
> 

<span data-ttu-id="5a285-108">La connessione di una rete virtuale classica a una rete virtuale di Resource Manager è simile alla connessione di una rete virtuale a una posizione del sito locale.</span><span class="sxs-lookup"><span data-stu-id="5a285-108">Connecting a classic VNet to a Resource Manager VNet is similar to connecting a VNet to an on-premises site location.</span></span> <span data-ttu-id="5a285-109">Entrambi i tipi di connettività utilizzano un gateway VPN per fornire un tunnel sicuro tramite IPsec/IKE.</span><span class="sxs-lookup"><span data-stu-id="5a285-109">Both connectivity types use a VPN gateway to provide a secure tunnel using IPsec/IKE.</span></span> <span data-ttu-id="5a285-110">È possibile creare una connessione tra reti virtuali in sottoscrizioni diverse e in aree diverse.</span><span class="sxs-lookup"><span data-stu-id="5a285-110">You can create a connection between VNets that are in different subscriptions and in different regions.</span></span> <span data-ttu-id="5a285-111">È anche possibile connettere reti virtuali che già dispongono di connessioni alle reti locali, purché il gateway con cui sono state configurate sia dinamico o basato su route.</span><span class="sxs-lookup"><span data-stu-id="5a285-111">You can also connect VNets that already have connections to on-premises networks, as long as the gateway that they have been configured with is dynamic or route-based.</span></span> <span data-ttu-id="5a285-112">Per altre informazioni sulle connessioni da rete virtuale a rete virtuale, vedere la sezione [Domande frequenti relative alla connessione da rete virtuale a rete virtuale](#faq) alla fine di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="5a285-112">For more information about VNet-to-VNet connections, see the [VNet-to-VNet FAQ](#faq) at the end of this article.</span></span> 

<span data-ttu-id="5a285-113">Se le reti virtuali si trovano nella stessa area, è consigliabile considerare invece la possibilità di connetterle tramite peering reti virtuali.</span><span class="sxs-lookup"><span data-stu-id="5a285-113">If your VNets are in the same region, you may want to instead consider connecting them using VNet Peering.</span></span> <span data-ttu-id="5a285-114">Peering reti virtuali non usa un gateway VPN.</span><span class="sxs-lookup"><span data-stu-id="5a285-114">VNet peering does not use a VPN gateway.</span></span> <span data-ttu-id="5a285-115">Per altre informazioni, vedere [Peering reti virtuali](../virtual-network/virtual-network-peering-overview.md).</span><span class="sxs-lookup"><span data-stu-id="5a285-115">For more information, see [VNet peering](../virtual-network/virtual-network-peering-overview.md).</span></span> 

### <a name="prerequisites"></a><span data-ttu-id="5a285-116">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="5a285-116">Prerequisites</span></span>

* <span data-ttu-id="5a285-117">Questa procedura presuppone che entrambe le reti virtuali siano già state create.</span><span class="sxs-lookup"><span data-stu-id="5a285-117">These steps assume that both VNets have already been created.</span></span> <span data-ttu-id="5a285-118">Se si usa questo articolo come esercizio e non si dispone di reti virtuali, nei passaggi sono presenti dei collegamenti che consentono di crearli.</span><span class="sxs-lookup"><span data-stu-id="5a285-118">If you are using this article as an exercise and don't have VNets, there are links in the steps to help you create them.</span></span>
* <span data-ttu-id="5a285-119">Verificare che gli intervalli di indirizzi per le reti virtuali non si sovrappongano tra loro o con gli intervalli di altre connessioni a cui i gateway potrebbero essere connessi.</span><span class="sxs-lookup"><span data-stu-id="5a285-119">Verify that the address ranges for the VNets do not overlap with each other, or overlap with any of the ranges for other connections that the gateways may be connected to.</span></span>
* <span data-ttu-id="5a285-120">Installare i cmdlet PowerShell più recenti per Resource Manager e Gestione dei servizi (classico).</span><span class="sxs-lookup"><span data-stu-id="5a285-120">Install the latest PowerShell cmdlets for both Resource Manager and Service Management (classic).</span></span> <span data-ttu-id="5a285-121">In questo articolo vengono usati sia il portale di Azure che PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5a285-121">In this article, we use both the Azure portal and PowerShell.</span></span> <span data-ttu-id="5a285-122">PowerShell è necessario per creare la connessione dalla rete virtuale classica alla rete virtuale di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5a285-122">PowerShell is required to create the connection from the classic VNet to the Resource Manager VNet.</span></span> <span data-ttu-id="5a285-123">Per altre informazioni, vedere [Come installare e configurare Azure PowerShell](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="5a285-123">For more information, see [How to install and configure Azure PowerShell](/powershell/azure/overview).</span></span> 

### <span data-ttu-id="5a285-124"><a name="values"></a>Impostazioni di esempio</span><span class="sxs-lookup"><span data-stu-id="5a285-124"><a name="values"></a>Example settings</span></span>

<span data-ttu-id="5a285-125">È possibile usare questi valori per creare un ambiente di test o farvi riferimento per comprendere meglio gli esempi di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="5a285-125">You can use these values to create a test environment, or refer to them to better understand the examples in this article.</span></span>

<span data-ttu-id="5a285-126">**Rete virtuale classica**</span><span class="sxs-lookup"><span data-stu-id="5a285-126">**Classic VNet**</span></span>

<span data-ttu-id="5a285-127">Nome rete virtuale = ClassicVNet</span><span class="sxs-lookup"><span data-stu-id="5a285-127">VNet name = ClassicVNet</span></span> <br>
<span data-ttu-id="5a285-128">Spazio indirizzi = 10.0.0.0/24</span><span class="sxs-lookup"><span data-stu-id="5a285-128">Address space = 10.0.0.0/24</span></span> <br>
<span data-ttu-id="5a285-129">Subnet-1 = 10.0.0.0/27</span><span class="sxs-lookup"><span data-stu-id="5a285-129">Subnet-1 = 10.0.0.0/27</span></span> <br>
<span data-ttu-id="5a285-130">Gruppo di risorse = ClassicRG</span><span class="sxs-lookup"><span data-stu-id="5a285-130">Resource Group = ClassicRG</span></span> <br>
<span data-ttu-id="5a285-131">Località = Stati Uniti occidentali</span><span class="sxs-lookup"><span data-stu-id="5a285-131">Location = West US</span></span> <br>
<span data-ttu-id="5a285-132">GatewaySubnet: 10.0.0.32/28</span><span class="sxs-lookup"><span data-stu-id="5a285-132">GatewaySubnet = 10.0.0.32/28</span></span> <br>
<span data-ttu-id="5a285-133">Sito locale = RMVNetLocal</span><span class="sxs-lookup"><span data-stu-id="5a285-133">Local site = RMVNetLocal</span></span> <br>

<span data-ttu-id="5a285-134">**Rete virtuale di Resource Manager**</span><span class="sxs-lookup"><span data-stu-id="5a285-134">**Resource Manager VNet**</span></span>

<span data-ttu-id="5a285-135">Nome della rete virtuale = RMVNet</span><span class="sxs-lookup"><span data-stu-id="5a285-135">VNet name = RMVNet</span></span> <br>
<span data-ttu-id="5a285-136">Spazio indirizzi = 192.168.0.0/16</span><span class="sxs-lookup"><span data-stu-id="5a285-136">Address space = 192.168.0.0/16</span></span> <br>
<span data-ttu-id="5a285-137">Subnet-1 = 192.168.1.0/24</span><span class="sxs-lookup"><span data-stu-id="5a285-137">Subnet-1 = 192.168.1.0/24</span></span> <br>
<span data-ttu-id="5a285-138">GatewaySubnet = 192.168.0.0/26</span><span class="sxs-lookup"><span data-stu-id="5a285-138">GatewaySubnet = 192.168.0.0/26</span></span> <br>
<span data-ttu-id="5a285-139">Gruppo di risorse= RG1</span><span class="sxs-lookup"><span data-stu-id="5a285-139">Resource Group = RG1</span></span> <br>
<span data-ttu-id="5a285-140">Località = Stati Uniti orientali</span><span class="sxs-lookup"><span data-stu-id="5a285-140">Location = East US</span></span> <br>
<span data-ttu-id="5a285-141">Nome gateway di rete virtuale = RMGateway</span><span class="sxs-lookup"><span data-stu-id="5a285-141">Virtual network gateway name = RMGateway</span></span> <br>
<span data-ttu-id="5a285-142">Tipo di gateway = VPN</span><span class="sxs-lookup"><span data-stu-id="5a285-142">Gateway type = VPN</span></span> <br>
<span data-ttu-id="5a285-143">Tipo VPN= Basato su route</span><span class="sxs-lookup"><span data-stu-id="5a285-143">VPN type = Route-based</span></span> <br>
<span data-ttu-id="5a285-144">Nome indirizzo IP pubblico del gateway = rmgwpip</span><span class="sxs-lookup"><span data-stu-id="5a285-144">Gateway Public IP address name = rmgwpip</span></span> <br>
<span data-ttu-id="5a285-145">Gateway di rete locale = ClassicVNetLocal</span><span class="sxs-lookup"><span data-stu-id="5a285-145">Local network gateway = ClassicVNetLocal</span></span> <br>
<span data-ttu-id="5a285-146">Nome della connessione = RMtoClassic</span><span class="sxs-lookup"><span data-stu-id="5a285-146">Connection name = RMtoClassic</span></span>

### <a name="connection-overview"></a><span data-ttu-id="5a285-147">Panoramica sulla connessione</span><span class="sxs-lookup"><span data-stu-id="5a285-147">Connection overview</span></span>

<span data-ttu-id="5a285-148">Per questa configurazione si crea una connessione gateway VPN tramite un tunnel VPN IPsec/IKE tra le reti virtuali.</span><span class="sxs-lookup"><span data-stu-id="5a285-148">For this configuration, you create a VPN gateway connection over an IPsec/IKE VPN tunnel between the virtual networks.</span></span> <span data-ttu-id="5a285-149">Assicurarsi che nessun intervallo di reti virtuali si sovrapponga a un altro o a una delle reti locali alle quali si connette.</span><span class="sxs-lookup"><span data-stu-id="5a285-149">Make sure that none of your VNet ranges overlap with each other, or with any of the local networks that they connect to.</span></span>

<span data-ttu-id="5a285-150">La tabella seguente illustra un esempio di come sono definiti le reti virtuali e i siti locali:</span><span class="sxs-lookup"><span data-stu-id="5a285-150">The following table shows an example of how the example VNets and local sites are defined:</span></span>

| <span data-ttu-id="5a285-151">Rete virtuale</span><span class="sxs-lookup"><span data-stu-id="5a285-151">Virtual Network</span></span> | <span data-ttu-id="5a285-152">Spazio di indirizzi</span><span class="sxs-lookup"><span data-stu-id="5a285-152">Address Space</span></span> | <span data-ttu-id="5a285-153">Region</span><span class="sxs-lookup"><span data-stu-id="5a285-153">Region</span></span> | <span data-ttu-id="5a285-154">Si connette al sito della rete locale</span><span class="sxs-lookup"><span data-stu-id="5a285-154">Connects to local network site</span></span> |
|:--- |:--- |:--- |:--- |
| <span data-ttu-id="5a285-155">ClassicVNet</span><span class="sxs-lookup"><span data-stu-id="5a285-155">ClassicVNet</span></span> |<span data-ttu-id="5a285-156">(10.0.0.0/24)</span><span class="sxs-lookup"><span data-stu-id="5a285-156">(10.0.0.0/24)</span></span> |<span data-ttu-id="5a285-157">Stati Uniti occidentali</span><span class="sxs-lookup"><span data-stu-id="5a285-157">West US</span></span> | <span data-ttu-id="5a285-158">RMVNetLocal (192.168.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="5a285-158">RMVNetLocal (192.168.0.0/16)</span></span> |
| <span data-ttu-id="5a285-159">RMVNet</span><span class="sxs-lookup"><span data-stu-id="5a285-159">RMVNet</span></span> | <span data-ttu-id="5a285-160">(192.168.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="5a285-160">(192.168.0.0/16)</span></span> |<span data-ttu-id="5a285-161">Stati Uniti orientali</span><span class="sxs-lookup"><span data-stu-id="5a285-161">East US</span></span> |<span data-ttu-id="5a285-162">ClassicVNetLocal (10.0.0.0/24)</span><span class="sxs-lookup"><span data-stu-id="5a285-162">ClassicVNetLocal (10.0.0.0/24)</span></span> |

## <span data-ttu-id="5a285-163"><a name="classicvnet"></a>1. Configurare la rete virtuale classica</span><span class="sxs-lookup"><span data-stu-id="5a285-163"><a name="classicvnet"></a>1. Configure the classic VNet settings</span></span>

<span data-ttu-id="5a285-164">In questa sezione vengono creati il gateway di rete locale (sito locale) e il gateway di rete virtuale per la rete virtuale classica.</span><span class="sxs-lookup"><span data-stu-id="5a285-164">In this section, you create the local network (local site) and the virtual network gateway for your classic VNet.</span></span> <span data-ttu-id="5a285-165">Se si eseguono questi passaggi come esercizio e non si dispone di una rete virtuale classica, è possibile creare una rete virtuale usando [questo articolo](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) e i valori delle impostazioni dell'[Esempio](#values) riportati sopra.</span><span class="sxs-lookup"><span data-stu-id="5a285-165">If you don't have a classic VNet and are running these steps as an exercise, you can create a VNet by using [this article](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) and the [Example](#values) settings values from above.</span></span>

<span data-ttu-id="5a285-166">Quando si usa il portale per creare una rete virtuale classica, è necessario passare al pannello della rete virtuale tramite la procedura seguente; in caso contrario l'opzione per creare una rete virtuale classica non viene visualizzata:</span><span class="sxs-lookup"><span data-stu-id="5a285-166">When using the portal to create a classic virtual network, you must navigate to the virtual network blade by using the following steps, otherwise the option to create a classic virtual network does not appear:</span></span>

1. <span data-ttu-id="5a285-167">Fare clic su "+" per aprire il pannello "Nuovo".</span><span class="sxs-lookup"><span data-stu-id="5a285-167">Click the '+' to open the 'New' blade.</span></span>
2. <span data-ttu-id="5a285-168">Nel campo "Cerca nel Marketplace" digitare "Rete virtuale".</span><span class="sxs-lookup"><span data-stu-id="5a285-168">In the 'Search the marketplace' field, type 'Virtual Network'.</span></span> <span data-ttu-id="5a285-169">Se invece si seleziona Rete -> Rete virtuale, non sarà possibile ottenere l'opzione per creare una rete virtuale classica.</span><span class="sxs-lookup"><span data-stu-id="5a285-169">If you instead, select Networking -> Virtual Network, you will not get the option to create a classic VNet.</span></span>
3. <span data-ttu-id="5a285-170">Cercare "Rete virtuale" nell'elenco restituito e fare clic per aprire il pannello Rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="5a285-170">Locate 'Virtual Network' from the returned list and click it to open the Virtual Network blade.</span></span> 
4. <span data-ttu-id="5a285-171">Nel pannello della rete virtuale, selezionare "Classica" per creare una rete virtuale classica.</span><span class="sxs-lookup"><span data-stu-id="5a285-171">On the virtual network blade, select 'Classic' to create a classic VNet.</span></span> 

<span data-ttu-id="5a285-172">Se si dispone già di una rete virtuale con un gateway VPN, verificare che il gateway sia dinamico.</span><span class="sxs-lookup"><span data-stu-id="5a285-172">If you already have a VNet with a VPN gateway, verify that the gateway is Dynamic.</span></span> <span data-ttu-id="5a285-173">Se è statico, è necessario eliminare il gateway VPN prima di procedere.</span><span class="sxs-lookup"><span data-stu-id="5a285-173">If it's Static, you must first delete the VPN gateway, then proceed.</span></span>

<span data-ttu-id="5a285-174">Gli screenshot sono forniti come esempio.</span><span class="sxs-lookup"><span data-stu-id="5a285-174">Screenshots are provided as examples.</span></span> <span data-ttu-id="5a285-175">Sostituire i valori con i valori personalizzati o usare i valori dell'[Esempio](#values).</span><span class="sxs-lookup"><span data-stu-id="5a285-175">Be sure to replace the values with your own, or use the [Example](#values) values.</span></span>

### <a name="part-1---configure-the-local-site"></a><span data-ttu-id="5a285-176">Parte 1: Configurare il sito locale</span><span class="sxs-lookup"><span data-stu-id="5a285-176">Part 1 - Configure the local site</span></span>

<span data-ttu-id="5a285-177">Aprire il [portale di Azure](https://ms.portal.azure.com) e accedere con l'account Azure.</span><span class="sxs-lookup"><span data-stu-id="5a285-177">Open the [Azure portal](https://ms.portal.azure.com) and sign in with your Azure account.</span></span>

1. <span data-ttu-id="5a285-178">Passare a **Tutte le risorse** e individuare la voce **ClassicVNet** nell'elenco.</span><span class="sxs-lookup"><span data-stu-id="5a285-178">Navigate to **All resources** and locate the **ClassicVNet** in the list.</span></span>
2. <span data-ttu-id="5a285-179">Nel pannello **Panoramica** della sezione **Connessioni VPN** fare clic sull'elemento grafico **Gateway** per creare un gateway.</span><span class="sxs-lookup"><span data-stu-id="5a285-179">On the **Overview** blade, in the **VPN connections** section, click the **Gateway** graphic to create a gateway.</span></span>

    <span data-ttu-id="5a285-180">![Configurare un gateway VPN](./media/vpn-gateway-connect-different-deployment-models-portal/gatewaygraphic.png "Configurare un gateway VPN")</span><span class="sxs-lookup"><span data-stu-id="5a285-180">![Configure a VPN gateway](./media/vpn-gateway-connect-different-deployment-models-portal/gatewaygraphic.png "Configure a VPN gateway")</span></span>
3. <span data-ttu-id="5a285-181">Nel pannello **Nuova connessione VPN** selezionare **Da sito a sito** in **Tipo di connessione**.</span><span class="sxs-lookup"><span data-stu-id="5a285-181">On the **New VPN Connection** blade, for **Connection type**, select **Site-to-site**.</span></span>
4. <span data-ttu-id="5a285-182">In **Sito locale** fare clic su **Configurare le impostazioni necessarie**.</span><span class="sxs-lookup"><span data-stu-id="5a285-182">For **Local site**, click **Configure required settings**.</span></span> <span data-ttu-id="5a285-183">Verrà visualizzato il pannello **Sito locale**.</span><span class="sxs-lookup"><span data-stu-id="5a285-183">This opens the **Local site** blade.</span></span>
5. <span data-ttu-id="5a285-184">Nel pannello **Sito locale** creare un nome da usare per fare riferimento alla rete virtuale di Resource Manager,</span><span class="sxs-lookup"><span data-stu-id="5a285-184">On the **Local site** blade, create a name to refer to the Resource Manager VNet.</span></span> <span data-ttu-id="5a285-185">ad esempio "RMVNetLocal".</span><span class="sxs-lookup"><span data-stu-id="5a285-185">For example, 'RMVNetLocal'.</span></span>
6. <span data-ttu-id="5a285-186">Se il gateway VPN per la rete virtuale di Resource Manager ha già un indirizzo IP pubblico, usare il valore del campo **Indirizzo IP del gateway VPN**.</span><span class="sxs-lookup"><span data-stu-id="5a285-186">If the VPN gateway for the Resource Manager VNet already has a Public IP address, use the value for the **VPN gateway IP address** field.</span></span> <span data-ttu-id="5a285-187">Se si stanno eseguendo questi passaggi come esercizio o non si dispone ancora di un gateway di rete virtuale per la rete virtuale di Resource Manager, è possibile creare un indirizzo IP segnaposto.</span><span class="sxs-lookup"><span data-stu-id="5a285-187">If you are doing these steps as an exercise, or don't yet have a virtual network gateway for your Resource Manager VNet, you can make up a placeholder IP address.</span></span> <span data-ttu-id="5a285-188">Assicurarsi che l'indirizzo IP segnaposto usi un formato valido.</span><span class="sxs-lookup"><span data-stu-id="5a285-188">Make sure that the placeholder IP address uses a valid format.</span></span> <span data-ttu-id="5a285-189">In seguito sarà necessario sostituire l'indirizzo IP segnaposto con l'indirizzo IP pubblico del gateway di rete virtuale di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5a285-189">Later, you replace the placeholder IP address with the Public IP address of the Resource Manager virtual network gateway.</span></span>
7. <span data-ttu-id="5a285-190">Per **Spazio indirizzi client** usare i valori per gli spazi di indirizzi IP di rete virtuale per la rete virtuale di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5a285-190">For **Client Address Space**, use the values for the virtual network IP address spaces for the Resource Manager VNet.</span></span> <span data-ttu-id="5a285-191">Questa impostazione viene usata per specificare gli spazi indirizzi per il routing alla rete virtuale di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5a285-191">This setting is used to specify the address spaces to route to the Resource Manager virtual network.</span></span>
8. <span data-ttu-id="5a285-192">Fare clic su **OK** per salvare i valori e tornare al pannello **Nuova connessione VPN**.</span><span class="sxs-lookup"><span data-stu-id="5a285-192">Click **OK** to save the values and return to the **New VPN Connection** blade.</span></span>

### <a name="part-2---create-the-virtual-network-gateway"></a><span data-ttu-id="5a285-193">Parte 2: Creare il gateway di rete virtuale</span><span class="sxs-lookup"><span data-stu-id="5a285-193">Part 2 - Create the virtual network gateway</span></span>

1. <span data-ttu-id="5a285-194">Nel pannello **Nuova connessione VPN** selezionare la casella di controllo **Crea gateway immediatamente** e fare clic su **Configurazione gateway facoltativa** per aprire il pannello **Configurazione gateway**.</span><span class="sxs-lookup"><span data-stu-id="5a285-194">On the **New VPN Connection** blade, select the **Create gateway immediately** checkbox and click **Optional gateway configuration** to open the **Gateway configuration** blade.</span></span> 

    <span data-ttu-id="5a285-195">![Aprire il pannello Configurazione gateway](./media/vpn-gateway-connect-different-deployment-models-portal/optionalgatewayconfiguration.png "Aprire il pannello Configurazione gateway")</span><span class="sxs-lookup"><span data-stu-id="5a285-195">![Open gateway configuration blade](./media/vpn-gateway-connect-different-deployment-models-portal/optionalgatewayconfiguration.png "Open gateway configuration blade")</span></span>
2. <span data-ttu-id="5a285-196">Fare clic su **Subnet - Configurare le impostazioni necessarie** per aprire il pannello **Aggiungi subnet**.</span><span class="sxs-lookup"><span data-stu-id="5a285-196">Click **Subnet - Configure required settings** to open the **Add subnet** blade.</span></span> <span data-ttu-id="5a285-197">Il **Nome** è già configurato con il valore **GatewaySubnet** richiesto.</span><span class="sxs-lookup"><span data-stu-id="5a285-197">The **Name** is already configured with the required value **GatewaySubnet**.</span></span>
3. <span data-ttu-id="5a285-198">**Intervallo indirizzi** si riferisce all'intervallo per la subnet del gateway.</span><span class="sxs-lookup"><span data-stu-id="5a285-198">The **Address range** refers to the range for the gateway subnet.</span></span> <span data-ttu-id="5a285-199">Sebbene sia possibile creare una subnet del gateway con un intervallo di indirizzi /29 (3 indirizzi), è consigliabile creare una subnet del gateway che contiene più indirizzi IP.</span><span class="sxs-lookup"><span data-stu-id="5a285-199">Although you can create a gateway subnet with a /29 address range (3 addresses), we recommend creating a gateway subnet that contains more IP addresses.</span></span> <span data-ttu-id="5a285-200">Questo la rende compatibile con configurazioni future che potrebbero richiedere più indirizzi IP disponibili.</span><span class="sxs-lookup"><span data-stu-id="5a285-200">This will accommodate future configurations that may require more available IP addresses.</span></span> <span data-ttu-id="5a285-201">Se possibile, usare /27 o /28.</span><span class="sxs-lookup"><span data-stu-id="5a285-201">If possible, use /27 or /28.</span></span> <span data-ttu-id="5a285-202">Se si segue questa procedura come esercizio, è possibile usare i valori dell'[Esempio](#values).</span><span class="sxs-lookup"><span data-stu-id="5a285-202">If you are using these steps as an exercise, you can refer to the [Example](#values) values.</span></span> <span data-ttu-id="5a285-203">Fare clic su **OK** per creare la subnet del gateway.</span><span class="sxs-lookup"><span data-stu-id="5a285-203">Click **OK** to create the gateway subnet.</span></span>
4. <span data-ttu-id="5a285-204">Nel pannello **Configurazione gateway**, **Dimensioni** si riferisce allo SKU del gateway.</span><span class="sxs-lookup"><span data-stu-id="5a285-204">On the **Gateway configuration** blade, **Size** refers to the gateway SKU.</span></span> <span data-ttu-id="5a285-205">Selezionare lo SKU del gateway per il gateway VPN.</span><span class="sxs-lookup"><span data-stu-id="5a285-205">Select the gateway SKU for your VPN gateway.</span></span>
5. <span data-ttu-id="5a285-206">Verificare che **Tipo di routing** sia **Dinamico**, quindi fare clic su **OK** per tornare al pannello **Nuova connessione VPN**.</span><span class="sxs-lookup"><span data-stu-id="5a285-206">Verify the **Routing Type** is **Dynamic**, then click **OK** to return to the **New VPN Connection** blade.</span></span>
6. <span data-ttu-id="5a285-207">Nel pannello **Nuova connessione VPN** fare clic su **OK** per iniziare a creare il gateway VPN.</span><span class="sxs-lookup"><span data-stu-id="5a285-207">On the **New VPN Connection** blade, click **OK** to begin creating your VPN gateway.</span></span> <span data-ttu-id="5a285-208">Per completare la creazione di un gateway VPN possono essere necessari fino a 45 minuti.</span><span class="sxs-lookup"><span data-stu-id="5a285-208">Creating a VPN gateway can take up to 45 minutes to complete.</span></span>

### <span data-ttu-id="5a285-209"><a name="ip"></a>Parte 3: Copiare l'indirizzo IP pubblico del gateway di rete virtuale</span><span class="sxs-lookup"><span data-stu-id="5a285-209"><a name="ip"></a>Part 3 - Copy the virtual network gateway Public IP address</span></span>

<span data-ttu-id="5a285-210">Dopo aver creato il gateway di rete virtuale è possibile visualizzare l'indirizzo IP del gateway.</span><span class="sxs-lookup"><span data-stu-id="5a285-210">After the virtual network gateway has been created, you can view the gateway IP address.</span></span> 

1. <span data-ttu-id="5a285-211">Passare alla rete virtuale classica e fare clic su **Panoramica**.</span><span class="sxs-lookup"><span data-stu-id="5a285-211">Navigate to your classic VNet, and click **Overview**.</span></span>
2. <span data-ttu-id="5a285-212">Fare clic su **Connessioni VPN** per aprire il pannello Connessioni VPN.</span><span class="sxs-lookup"><span data-stu-id="5a285-212">Click **VPN connections** to open the VPN connections blade.</span></span> <span data-ttu-id="5a285-213">Nel pannello Connessioni VPN è possibile visualizzare l'indirizzo IP pubblico.</span><span class="sxs-lookup"><span data-stu-id="5a285-213">On the VPN connections blade, you can view the Public IP address.</span></span> <span data-ttu-id="5a285-214">Si tratta dell'indirizzo IP pubblico assegnato al gateway di rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="5a285-214">This is the Public IP address assigned to your virtual network gateway.</span></span> 
3. <span data-ttu-id="5a285-215">Scrivere o copiare l'indirizzo IP.</span><span class="sxs-lookup"><span data-stu-id="5a285-215">Write down or copy the IP address.</span></span> <span data-ttu-id="5a285-216">Sarà necessario nei passaggi successivi quando si useranno le impostazioni di configurazione del gateway di rete locale di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5a285-216">You use it in later steps when you work with your Resource Manager local network gateway configuration settings.</span></span> <span data-ttu-id="5a285-217">È anche possibile visualizzare lo stato delle connessioni gateway.</span><span class="sxs-lookup"><span data-stu-id="5a285-217">You can also view the status of your gateway connections.</span></span> <span data-ttu-id="5a285-218">Si noti che il sito di rete locale creato viene elencato come "Connessione".</span><span class="sxs-lookup"><span data-stu-id="5a285-218">Notice the local network site you created is listed as 'Connecting'.</span></span> <span data-ttu-id="5a285-219">Lo stato verrà modificato dopo aver creato le connessioni.</span><span class="sxs-lookup"><span data-stu-id="5a285-219">The status will change after you have created your connections.</span></span>
4. <span data-ttu-id="5a285-220">Chiudere il pannello dopo aver copiato l'indirizzo IP del gateway.</span><span class="sxs-lookup"><span data-stu-id="5a285-220">Close the blade after copying the gateway IP address.</span></span>

## <span data-ttu-id="5a285-221"><a name="rmvnet"></a>2. Configurare le impostazioni della rete virtuale di Resource Manager</span><span class="sxs-lookup"><span data-stu-id="5a285-221"><a name="rmvnet"></a>2. Configure the Resource Manager VNet settings</span></span>

<span data-ttu-id="5a285-222">In questa sezione vengono creati il gateway di rete virtuale e il gateway di rete locale per la rete virtuale di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5a285-222">In this section, you create the virtual network gateway and the local network gateway for your Resource Manager VNet.</span></span> <span data-ttu-id="5a285-223">Se si eseguono questi passaggi come esercizio e non si dispone di una rete virtuale di Resource Manager, è possibile creare una rete virtuale usando [questo articolo](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) e i valori delle impostazioni dell'[Esempio](#values) riportati sopra.</span><span class="sxs-lookup"><span data-stu-id="5a285-223">If you don't have a Resource Manager VNet and are running these steps as an exercise, you can create a VNet by using [this article](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) and the [Example](#values) settings values from above.</span></span>

<span data-ttu-id="5a285-224">Gli screenshot sono forniti come esempio.</span><span class="sxs-lookup"><span data-stu-id="5a285-224">Screenshots are provided as examples.</span></span> <span data-ttu-id="5a285-225">Sostituire i valori con i valori personalizzati o usare i valori dell'[Esempio](#values).</span><span class="sxs-lookup"><span data-stu-id="5a285-225">Be sure to replace the values with your own, or use the [Example](#values) values.</span></span>

### <a name="part-1---create-a-gateway-subnet"></a><span data-ttu-id="5a285-226">Parte 1 - Creare una subnet del gateway</span><span class="sxs-lookup"><span data-stu-id="5a285-226">Part 1 - Create a gateway subnet</span></span>

<span data-ttu-id="5a285-227">Prima di creare un gateway di rete virtuale è necessario creare una subnet del gateway.</span><span class="sxs-lookup"><span data-stu-id="5a285-227">Before creating a virtual network gateway, you first need to create the gateway subnet.</span></span> <span data-ttu-id="5a285-228">Creare una subnet del gateway con conteggio CIDR /28 o superiore,</span><span class="sxs-lookup"><span data-stu-id="5a285-228">Create a gateway subnet with CIDR count of /28 or larger.</span></span> <span data-ttu-id="5a285-229">ad esempio /27, /26 e così via.</span><span class="sxs-lookup"><span data-stu-id="5a285-229">(/27, /26, etc.)</span></span>

[!INCLUDE [vpn-gateway-no-nsg-include](../../includes/vpn-gateway-no-nsg-include.md)]

[!INCLUDE [vpn-gateway-add-gwsubnet-rm-portal](../../includes/vpn-gateway-add-gwsubnet-rm-portal-include.md)]

### <a name="part-2---create-a-virtual-network-gateway"></a><span data-ttu-id="5a285-230">Parte 2 - Creare un gateway di rete virtuale</span><span class="sxs-lookup"><span data-stu-id="5a285-230">Part 2 - Create a virtual network gateway</span></span>

[!INCLUDE [vpn-gateway-add-gw-rm-portal](../../includes/vpn-gateway-add-gw-rm-portal-include.md)]

### <span data-ttu-id="5a285-231"><a name="createlng"></a>Parte 3: Creare un gateway di rete locale</span><span class="sxs-lookup"><span data-stu-id="5a285-231"><a name="createlng"></a>Part 3 - Create a local network gateway</span></span>

<span data-ttu-id="5a285-232">Il gateway di rete locale specifica l'intervallo di indirizzi e l'indirizzo IP pubblico associati alla rete virtuale classica e al relativo gateway di rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="5a285-232">The local network gateway specifies the address range and the Public IP address associated with your classic VNet and its virtual network gateway.</span></span>

<span data-ttu-id="5a285-233">Se si eseguono questi passaggi come esercizio, fare riferimento alle impostazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="5a285-233">If you are doing these steps as an exercise, refer to these settings:</span></span>

| <span data-ttu-id="5a285-234">Rete virtuale</span><span class="sxs-lookup"><span data-stu-id="5a285-234">Virtual Network</span></span> | <span data-ttu-id="5a285-235">Spazio di indirizzi</span><span class="sxs-lookup"><span data-stu-id="5a285-235">Address Space</span></span> | <span data-ttu-id="5a285-236">Region</span><span class="sxs-lookup"><span data-stu-id="5a285-236">Region</span></span> | <span data-ttu-id="5a285-237">Si connette al sito della rete locale</span><span class="sxs-lookup"><span data-stu-id="5a285-237">Connects to local network site</span></span> |<span data-ttu-id="5a285-238">Indirizzo IP pubblico del gateway</span><span class="sxs-lookup"><span data-stu-id="5a285-238">Gateway Public IP address</span></span>|
|:--- |:--- |:--- |:--- |:--- |
| <span data-ttu-id="5a285-239">ClassicVNet</span><span class="sxs-lookup"><span data-stu-id="5a285-239">ClassicVNet</span></span> |<span data-ttu-id="5a285-240">(10.0.0.0/24)</span><span class="sxs-lookup"><span data-stu-id="5a285-240">(10.0.0.0/24)</span></span> |<span data-ttu-id="5a285-241">Stati Uniti occidentali</span><span class="sxs-lookup"><span data-stu-id="5a285-241">West US</span></span> | <span data-ttu-id="5a285-242">RMVNetLocal (192.168.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="5a285-242">RMVNetLocal (192.168.0.0/16)</span></span> |<span data-ttu-id="5a285-243">L'indirizzo IP pubblico assegnato al gateway ClassicVNet</span><span class="sxs-lookup"><span data-stu-id="5a285-243">The Public IP address that is assigned to the ClassicVNet gateway</span></span>|
| <span data-ttu-id="5a285-244">RMVNet</span><span class="sxs-lookup"><span data-stu-id="5a285-244">RMVNet</span></span> | <span data-ttu-id="5a285-245">(192.168.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="5a285-245">(192.168.0.0/16)</span></span> |<span data-ttu-id="5a285-246">Stati Uniti orientali</span><span class="sxs-lookup"><span data-stu-id="5a285-246">East US</span></span> |<span data-ttu-id="5a285-247">ClassicVNetLocal (10.0.0.0/24)</span><span class="sxs-lookup"><span data-stu-id="5a285-247">ClassicVNetLocal (10.0.0.0/24)</span></span> |<span data-ttu-id="5a285-248">L'indirizzo IP pubblico assegnato al gateway RMVNet.</span><span class="sxs-lookup"><span data-stu-id="5a285-248">The Public IP address that is assigned to the RMVNet gateway.</span></span>|

[!INCLUDE [vpn-gateway-add-lng-rm-portal](../../includes/vpn-gateway-add-lng-rm-portal-include.md)]

## <span data-ttu-id="5a285-249"><a name="modifylng"></a>3. Modificare le impostazioni del sito locale della rete virtuale classica</span><span class="sxs-lookup"><span data-stu-id="5a285-249"><a name="modifylng"></a>3. Modify the classic VNet local site settings</span></span>

<span data-ttu-id="5a285-250">In questa sezione si sostituisce l'indirizzo IP segnaposto usato nella specifica delle impostazioni del sito locale con l'indirizzo IP del gateway VPN di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5a285-250">In this section, you replace the placeholder IP address that you used when specifying the local site settings, with the Resource Manager VPN gateway IP address.</span></span> <span data-ttu-id="5a285-251">Questa sezione usa i cmdlet PowerShell versione classica (SM).</span><span class="sxs-lookup"><span data-stu-id="5a285-251">This section uses the classic (SM) PowerShell cmdlets.</span></span>

1. <span data-ttu-id="5a285-252">Nel portale di Azure passare alla rete virtuale classica.</span><span class="sxs-lookup"><span data-stu-id="5a285-252">In the Azure portal, navigate to the classic virtual network.</span></span>
2. <span data-ttu-id="5a285-253">Nel pannello della rete virtuale fare clic su **Panoramica**.</span><span class="sxs-lookup"><span data-stu-id="5a285-253">On the blade for your virtual network, click **Overview**.</span></span>
3. <span data-ttu-id="5a285-254">Nella sezione **Connessioni VPN** fare clic sul nome del sito locale nell'elemento grafico.</span><span class="sxs-lookup"><span data-stu-id="5a285-254">In the **VPN connections** section, click the name of your local site in the graphic.</span></span>

    <span data-ttu-id="5a285-255">![Connessioni VPN](./media/vpn-gateway-connect-different-deployment-models-portal/vpnconnections.png "Connessioni VPN")</span><span class="sxs-lookup"><span data-stu-id="5a285-255">![VPN-connections](./media/vpn-gateway-connect-different-deployment-models-portal/vpnconnections.png "VPN Connections")</span></span>
4. <span data-ttu-id="5a285-256">Nel pannello **Connessioni VPN da sito a sito** fare clic sul nome del sito.</span><span class="sxs-lookup"><span data-stu-id="5a285-256">On the **Site-to-site VPN connections** blade, click the name of the site.</span></span>

    <span data-ttu-id="5a285-257">![Site-name](./media/vpn-gateway-connect-different-deployment-models-portal/sitetosite3.png "Nome del sito locale")</span><span class="sxs-lookup"><span data-stu-id="5a285-257">![Site-name](./media/vpn-gateway-connect-different-deployment-models-portal/sitetosite3.png "Local site name")</span></span>
5. <span data-ttu-id="5a285-258">Nel pannello della connessione per il sito locale fare clic sul nome del sito locale per aprire il pannello **Sito locale**.</span><span class="sxs-lookup"><span data-stu-id="5a285-258">On the connection blade for your local site, click the name of the local site to open the **Local site** blade.</span></span>

    <span data-ttu-id="5a285-259">![Open-local-site](./media/vpn-gateway-connect-different-deployment-models-portal/openlocal.png "Aprire il sito locale")</span><span class="sxs-lookup"><span data-stu-id="5a285-259">![Open-local-site](./media/vpn-gateway-connect-different-deployment-models-portal/openlocal.png "Open local site")</span></span>
6. <span data-ttu-id="5a285-260">Nel pannello **Sito locale** sostituire l'**indirizzo IP del gateway VPN** con l'indirizzo IP del gateway di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5a285-260">On the **Local site** blade, replace the **VPN gateway IP address** with the IP address of the Resource Manager gateway.</span></span>

    <span data-ttu-id="5a285-261">![Gateway-ip-address](./media/vpn-gateway-connect-different-deployment-models-portal/gwipaddress.png "Indirizzo IP del gateway")</span><span class="sxs-lookup"><span data-stu-id="5a285-261">![Gateway-ip-address](./media/vpn-gateway-connect-different-deployment-models-portal/gwipaddress.png "Gateway IP address")</span></span>
7. <span data-ttu-id="5a285-262">Fare clic su **OK** per aggiornare l'indirizzo IP.</span><span class="sxs-lookup"><span data-stu-id="5a285-262">Click **OK** to update the IP address.</span></span>

## <span data-ttu-id="5a285-263"><a name="RMtoclassic"></a>4. Creare una connessione da Resource Manager alla rete classica</span><span class="sxs-lookup"><span data-stu-id="5a285-263"><a name="RMtoclassic"></a>4. Create Resource Manager to classic connection</span></span>

<span data-ttu-id="5a285-264">In questa procedura si configura la connessione dalla rete virtuale di Resource Manager alla rete virtuale classica tramite il portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="5a285-264">In these steps, you configure the connection from the Resource Manager VNet to the classic VNet using the Azure portal.</span></span>

1. <span data-ttu-id="5a285-265">In **Tutte le risorse** individuare il gateway di rete locale.</span><span class="sxs-lookup"><span data-stu-id="5a285-265">In **All resources**, locate the local network gateway.</span></span> <span data-ttu-id="5a285-266">Nel nostro esempio il gateway di rete locale è **ClassicVNetLocal**.</span><span class="sxs-lookup"><span data-stu-id="5a285-266">In our example, the local network gateway is **ClassicVNetLocal**.</span></span>
2. <span data-ttu-id="5a285-267">Fare clic su **Configurazione** e verificare che il valore dell'indirizzo IP sia il gateway VPN per la rete virtuale classica.</span><span class="sxs-lookup"><span data-stu-id="5a285-267">Click **Configuration** and verify that the IP address value is the VPN gateway for the classic VNet.</span></span> <span data-ttu-id="5a285-268">Se necessario, aggiornare e quindi fare clic su **Salva**.</span><span class="sxs-lookup"><span data-stu-id="5a285-268">Update, if needed, then click **Save**.</span></span> <span data-ttu-id="5a285-269">Chiudere il pannello.</span><span class="sxs-lookup"><span data-stu-id="5a285-269">Close the blade.</span></span>
3. <span data-ttu-id="5a285-270">In **Tutte le risorse** fare clic sul gateway di rete locale.</span><span class="sxs-lookup"><span data-stu-id="5a285-270">In **All resources**, click the local network gateway.</span></span>
4. <span data-ttu-id="5a285-271">Fare clic su **Connessioni** per aprire il pannello Connessioni.</span><span class="sxs-lookup"><span data-stu-id="5a285-271">Click **Connections** to open the Connections blade.</span></span>
5. <span data-ttu-id="5a285-272">Nel pannello **Connessioni** fare clic su **+** per aggiungere una connessione.</span><span class="sxs-lookup"><span data-stu-id="5a285-272">On the **Connections** blade, click **+** to add a connection.</span></span>
6. <span data-ttu-id="5a285-273">Nel pannello **Aggiungi connessione** assegnare un nome alla connessione,</span><span class="sxs-lookup"><span data-stu-id="5a285-273">On the **Add connection** blade, name the connection.</span></span> <span data-ttu-id="5a285-274">ad esempio "RMtoClassic".</span><span class="sxs-lookup"><span data-stu-id="5a285-274">For example, 'RMtoClassic'.</span></span>
7. <span data-ttu-id="5a285-275">**Da sito a sito** è già selezionato nel pannello.</span><span class="sxs-lookup"><span data-stu-id="5a285-275">**Site-to-Site** is already selected on this blade.</span></span>
8. <span data-ttu-id="5a285-276">Selezionare il gateway di rete virtuale che si desidera associare al sito.</span><span class="sxs-lookup"><span data-stu-id="5a285-276">Select the virtual network gateway that you want to associate with this site.</span></span>
9. <span data-ttu-id="5a285-277">Creare una **chiave condivisa**.</span><span class="sxs-lookup"><span data-stu-id="5a285-277">Create a **shared key**.</span></span> <span data-ttu-id="5a285-278">Questa chiave viene usata anche nella connessione creata dalla rete virtuale classica alla rete virtuale di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5a285-278">This key is also used in the connection that you create from the classic VNet to the Resource Manager VNet.</span></span> <span data-ttu-id="5a285-279">È possibile generare la chiave o crearne una.</span><span class="sxs-lookup"><span data-stu-id="5a285-279">You can generate the key or make one up.</span></span> <span data-ttu-id="5a285-280">Per questo esempio è stato usato "abc123", ma è possibile e consigliabile usare un elemento più complesso.</span><span class="sxs-lookup"><span data-stu-id="5a285-280">In our example, we use 'abc123', but you can (and should) use something more complex.</span></span>
10. <span data-ttu-id="5a285-281">Fare clic su **OK** per creare la connessione.</span><span class="sxs-lookup"><span data-stu-id="5a285-281">Click **OK** to create the connection.</span></span>

##<span data-ttu-id="5a285-282"><a name="classictoRM"></a>5. Creare una connessione dalla rete classica a Resource Manager</span><span class="sxs-lookup"><span data-stu-id="5a285-282"><a name="classictoRM"></a>5. Create classic to Resource Manager connection</span></span>

<span data-ttu-id="5a285-283">In questa procedura si configura la connessione dalla rete virtuale classica alla rete virtuale di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5a285-283">In these steps, you configure the connection from the classic VNet to the Resource Manager VNet.</span></span> <span data-ttu-id="5a285-284">Per questa procedura è necessario PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5a285-284">These steps require PowerShell.</span></span> <span data-ttu-id="5a285-285">Non è possibile creare questa connessione nel portale.</span><span class="sxs-lookup"><span data-stu-id="5a285-285">You can't create this connection in the portal.</span></span> <span data-ttu-id="5a285-286">Assicurarsi di aver scaricato e installato sia i cmdlet di PowerShell classici di Gestione dei servizi (SM) che di Resource Manager (RM).</span><span class="sxs-lookup"><span data-stu-id="5a285-286">Make sure you have downloaded and installed both the classic (SM) and Resource Manager (RM) PowerShell cmdlets.</span></span>

### <a name="1-connect-to-your-azure-account"></a><span data-ttu-id="5a285-287">1. Connettersi all'account di Azure</span><span class="sxs-lookup"><span data-stu-id="5a285-287">1. Connect to your Azure account</span></span>

<span data-ttu-id="5a285-288">Aprire la console di PowerShell con diritti elevati e accedere all'account Azure.</span><span class="sxs-lookup"><span data-stu-id="5a285-288">Open the PowerShell console with elevated rights and log in to your Azure account.</span></span> <span data-ttu-id="5a285-289">Il cmdlet seguente richiede le credenziali di accesso per l'account Azure.</span><span class="sxs-lookup"><span data-stu-id="5a285-289">The following cmdlet prompts you for the login credentials for your Azure Account.</span></span> <span data-ttu-id="5a285-290">Dopo l'accesso, vengono scaricate le impostazioni dell'account in modo che siano disponibili per Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5a285-290">After logging in, your account settings are downloaded so that they are available to Azure PowerShell.</span></span>

```powershell
Login-AzureRmAccount
```
   
<span data-ttu-id="5a285-291">Ottenere un elenco delle sottoscrizioni di Azure se si dispone di più di una sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="5a285-291">Get a list of your Azure subscriptions if you have more than one subscription.</span></span>

```powershell
Get-AzureRmSubscription
```

<span data-ttu-id="5a285-292">Specificare la sottoscrizione da usare.</span><span class="sxs-lookup"><span data-stu-id="5a285-292">Specify the subscription that you want to use.</span></span> 

```powershell
Select-AzureRmSubscription -SubscriptionName "Name of subscription"
```

<span data-ttu-id="5a285-293">Aggiungere l'account Azure per usare i cmdlet di PowerShell classici (SM).</span><span class="sxs-lookup"><span data-stu-id="5a285-293">Add your Azure Account to use the classic PowerShell cmdlets (SM).</span></span> <span data-ttu-id="5a285-294">A tale scopo, è possibile usare il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="5a285-294">To do so, you can use the following command:</span></span>

```powershell
Add-AzureAccount
```

### <a name="2-view-the-network-configuration-file-values"></a><span data-ttu-id="5a285-295">2. Visualizzare i valori del file di configurazione di rete</span><span class="sxs-lookup"><span data-stu-id="5a285-295">2. View the network configuration file values</span></span>

<span data-ttu-id="5a285-296">Quando si crea una rete virtuale nel portale di Azure, il nome completo che usa Azure non è visibile nel portale.</span><span class="sxs-lookup"><span data-stu-id="5a285-296">When you create a VNet in the Azure portal, the full name that Azure uses is not visible in the Azure portal.</span></span> <span data-ttu-id="5a285-297">Ad esempio, una rete virtuale che sembra avere il nome di "ClassicVNet" nel portale di Azure potrebbe avere un nome molto più lungo nel file di configurazione di rete.</span><span class="sxs-lookup"><span data-stu-id="5a285-297">For example, a VNet that appears to be named 'ClassicVNet' in the Azure portal may have a much longer name in the network configuration file.</span></span> <span data-ttu-id="5a285-298">Il nome potrebbe essere simile a: "Gruppo ClassicRG ClassicVNet".</span><span class="sxs-lookup"><span data-stu-id="5a285-298">The name might look something like: 'Group ClassicRG ClassicVNet'.</span></span> <span data-ttu-id="5a285-299">In questa procedura si scarica il file di configurazione di rete e si visualizzano i valori.</span><span class="sxs-lookup"><span data-stu-id="5a285-299">In these steps, you download the network configuration file and view the values.</span></span>

<span data-ttu-id="5a285-300">Creare una directory nel computer ed esportarvi il file di configurazione di rete.</span><span class="sxs-lookup"><span data-stu-id="5a285-300">Create a directory on your computer and then export the network configuration file to the directory.</span></span> <span data-ttu-id="5a285-301">In questo esempio il file di configurazione di rete viene esportato in C:\AzureNet.</span><span class="sxs-lookup"><span data-stu-id="5a285-301">In this example, the network configuration file is exported to C:\AzureNet.</span></span>

```powershell
Get-AzureVNetConfig -ExportToFile C:\AzureNet\NetworkConfig.xml
```

<span data-ttu-id="5a285-302">Aprire il file con un editor di testo e visualizzare il nome di una rete virtuale classica.</span><span class="sxs-lookup"><span data-stu-id="5a285-302">Open the file with a text editor and view the name for your classic VNet.</span></span> <span data-ttu-id="5a285-303">Usare i nomi nel file di configurazione di rete durante l'esecuzione dei cmdlet di PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5a285-303">Use the names in the network configuration file when running your PowerShell cmdlets.</span></span>

- <span data-ttu-id="5a285-304">I nomi delle reti virtuali sono elencati come **Nome VirtualNetworkSite =**</span><span class="sxs-lookup"><span data-stu-id="5a285-304">VNet names are listed as **VirtualNetworkSite name =**</span></span>
- <span data-ttu-id="5a285-305">I nomi dei siti sono elencati come **Nome LocalNetworkSite =**</span><span class="sxs-lookup"><span data-stu-id="5a285-305">Site names are listed as **LocalNetworkSite name=**</span></span>

### <a name="3-create-the-connection"></a><span data-ttu-id="5a285-306">3. Creare la connessione</span><span class="sxs-lookup"><span data-stu-id="5a285-306">3. Create the connection</span></span>

<span data-ttu-id="5a285-307">Impostare la chiave condivisa e creare la connessione dalla rete virtuale classica alla rete virtuale di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="5a285-307">Set the shared key and create the connection from the classic VNet to the Resource Manager VNet.</span></span> <span data-ttu-id="5a285-308">Non è possibile impostare la chiave condivisa mediante il portale.</span><span class="sxs-lookup"><span data-stu-id="5a285-308">You cannot set the shared key using the portal.</span></span> <span data-ttu-id="5a285-309">Accertarsi di eseguire questi passaggi durante l'accesso utilizzando la versione classica dei cmdlet di PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5a285-309">Make sure you run these steps while logged in using the classic version of the PowerShell cmdlets.</span></span> <span data-ttu-id="5a285-310">A tale scopo, usare **Add-AzureAccount**.</span><span class="sxs-lookup"><span data-stu-id="5a285-310">To do so, use **Add-AzureAccount**.</span></span> <span data-ttu-id="5a285-311">In caso contrario non sarà possibile impostare '-AzureVNetGatewayKey'.</span><span class="sxs-lookup"><span data-stu-id="5a285-311">Otherwise, you will not be able to set the '-AzureVNetGatewayKey'.</span></span>

- <span data-ttu-id="5a285-312">In questo esempio **-VNetName** è il nome della rete virtuale classica che si trova nel file di configurazione di rete.</span><span class="sxs-lookup"><span data-stu-id="5a285-312">In this example, **-VNetName** is the name of the classic VNet as found in your network configuration file.</span></span> 
- <span data-ttu-id="5a285-313">**-LocalNetworkSiteName** è il nome specificato per il sito locale che si trova nel file di configurazione di rete.</span><span class="sxs-lookup"><span data-stu-id="5a285-313">The **-LocalNetworkSiteName** is the name you specified for the local site, as found in your network configuration file.</span></span>
- <span data-ttu-id="5a285-314">**-SharedKey** è un valore che è possibile generare e specificare.</span><span class="sxs-lookup"><span data-stu-id="5a285-314">The **-SharedKey** is a value that you generate and specify.</span></span> <span data-ttu-id="5a285-315">Per questo esempio è stato usato *abc123*, ma è possibile generare un elemento più complesso.</span><span class="sxs-lookup"><span data-stu-id="5a285-315">For this example, we used *abc123*, but you can generate something more complex.</span></span> <span data-ttu-id="5a285-316">È importante che il valore specificato qui sia identico a quello specificato durante la creazione della connessione tra Resource Manager e la rete virtuale classica.</span><span class="sxs-lookup"><span data-stu-id="5a285-316">The important thing is that the value you specify here must be the same value that you specified when creating your Resource Manager to classic connection.</span></span>

```powershell
Set-AzureVNetGatewayKey -VNetName "Group ClassicRG ClassicVNet" `
-LocalNetworkSiteName "172B9E16_RMVNetLocal" -SharedKey abc123
```

##<span data-ttu-id="5a285-317"><a name="verify"></a>6. Verificare le connessioni</span><span class="sxs-lookup"><span data-stu-id="5a285-317"><a name="verify"></a>6. Verify your connections</span></span>

<span data-ttu-id="5a285-318">È possibile verificare le connessioni usando il portale di Azure o PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5a285-318">You can verify your connections by using the Azure portal or PowerShell.</span></span> <span data-ttu-id="5a285-319">Durante la verifica potrebbe essere necessario attendere un minuto o due per la creazione della connessione.</span><span class="sxs-lookup"><span data-stu-id="5a285-319">When verifying, you may need to wait a minute or two as the connection is being created.</span></span> <span data-ttu-id="5a285-320">Quando una connessione ha esito positivo, lo stato di connettività passa da "Connessione" a "Connesso".</span><span class="sxs-lookup"><span data-stu-id="5a285-320">When a connection is successful, the connectivity state changes from 'Connecting' to 'Connected'.</span></span>

### <a name="to-verify-the-connection-from-your-classic-vnet-to-your-resource-manager-vnet"></a><span data-ttu-id="5a285-321">Per verificare la connessione dalla rete virtuale classica alla rete virtuale di Resource Manager</span><span class="sxs-lookup"><span data-stu-id="5a285-321">To verify the connection from your classic VNet to your Resource Manager VNet</span></span>

[!INCLUDE [vpn-gateway-verify-connection-azureportal-classic](../../includes/vpn-gateway-verify-connection-azureportal-classic-include.md)]

###<a name="to-verify-the-connection-from-your-resource-manager-vnet-to-your-classic-vnet"></a><span data-ttu-id="5a285-322">Per verificare la connessione dalla rete virtuale di Resource Manager alla rete virtuale classica</span><span class="sxs-lookup"><span data-stu-id="5a285-322">To verify the connection from your Resource Manager VNet to your classic VNet</span></span>

[!INCLUDE [vpn-gateway-verify-connection-portal-rm](../../includes/vpn-gateway-verify-connection-portal-rm-include.md)]

## <span data-ttu-id="5a285-323"><a name="faq"></a>Domande frequenti sulle connessioni da rete virtuale a rete virtuale</span><span class="sxs-lookup"><span data-stu-id="5a285-323"><a name="faq"></a>VNet-to-VNet FAQ</span></span>

[!INCLUDE [vpn-gateway-vnet-vnet-faq](../../includes/vpn-gateway-vnet-vnet-faq-include.md)]
