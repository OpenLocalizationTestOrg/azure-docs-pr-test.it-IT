---
title: "Ripristino di emergenza di gruppi di disponibilità Server - macchine virtuali di Azure - aaaSQL | Documenti Microsoft"
description: "Questo articolo spiega come raggruppare i tooconfigure disponibilità di SQL Server in macchine virtuali di Azure con una replica in un'area diversa."
services: virtual-machines
documentationCenter: na
authors: MikeRayMSFT
manager: jhubbard
editor: monicar
tags: azure-service-management
ms.assetid: 388c464e-a16e-4c9d-a0d5-bb7cf5974689
ms.service: virtual-machines-sql
ms.devlang: na
ms.custom: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/02/2017
ms.author: mikeray
ms.openlocfilehash: df6238dc61c5a56879c75c9bf7314c618f43c0ce
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="configure-an-always-on-availability-group-on-azure-virtual-machines-in-different-regions"></a><span data-ttu-id="dd71c-103">Configurare un gruppo di disponibilità AlwaysOn in macchine virtuali di Azure in aree diverse</span><span class="sxs-lookup"><span data-stu-id="dd71c-103">Configure an Always On availability group on Azure virtual machines in different regions</span></span>

<span data-ttu-id="dd71c-104">Questo articolo spiega come tooconfigure una disponibilità di SQL Server Always On gruppo di replica su macchine virtuali di Azure in una posizione remota di Azure.</span><span class="sxs-lookup"><span data-stu-id="dd71c-104">This article explains how tooconfigure a SQL Server Always On availability group replica on Azure virtual machines in a remote Azure location.</span></span> <span data-ttu-id="dd71c-105">Utilizzare il ripristino di emergenza toosupport questa configurazione.</span><span class="sxs-lookup"><span data-stu-id="dd71c-105">Use this configuration toosupport disaster recovery.</span></span>

<span data-ttu-id="dd71c-106">Questo articolo riguarda tooAzure macchine virtuali in modalità di gestione risorse.</span><span class="sxs-lookup"><span data-stu-id="dd71c-106">This article applies tooAzure Virtual Machines in Resource Manager mode.</span></span>

<span data-ttu-id="dd71c-107">Hello immagine seguente mostra una distribuzione comune di un gruppo di disponibilità in macchine virtuali di Azure:</span><span class="sxs-lookup"><span data-stu-id="dd71c-107">hello following image shows a common deployment of an availability group on Azure virtual machines:</span></span>

   ![Gruppo di disponibilità](./media/virtual-machines-windows-portal-sql-availability-group-dr/00-availability-group-basic.png)

<span data-ttu-id="dd71c-109">In questa distribuzione tutte le macchine virtuali sono in un'unica area di Azure.</span><span class="sxs-lookup"><span data-stu-id="dd71c-109">In this deployment, all virtual machines are in one Azure region.</span></span> <span data-ttu-id="dd71c-110">repliche del gruppo di disponibilità Hello possono avere commit sincrono con failover automatico in SQL-1 e 2 di SQL.</span><span class="sxs-lookup"><span data-stu-id="dd71c-110">hello availability group replicas can have synchronous commit with automatic failover on SQL-1 and SQL-2.</span></span> <span data-ttu-id="dd71c-111">toobuild questa architettura, vedere [modello gruppo di disponibilità o esercitazione](virtual-machines-windows-portal-sql-availability-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="dd71c-111">toobuild this architecture, see [Availability Group template or tutorial](virtual-machines-windows-portal-sql-availability-group-overview.md).</span></span>

<span data-ttu-id="dd71c-112">Questa architettura è vulnerabile toodowntime se hello regione di Azure diventa inaccessibile.</span><span class="sxs-lookup"><span data-stu-id="dd71c-112">This architecture is vulnerable toodowntime if hello Azure region becomes inaccessible.</span></span> <span data-ttu-id="dd71c-113">tooovercome questa vulnerabilità, aggiungere una replica in un'area diversa di Azure.</span><span class="sxs-lookup"><span data-stu-id="dd71c-113">tooovercome this vulnerability, add a replica in a different Azure region.</span></span> <span data-ttu-id="dd71c-114">Hello diagramma seguente viene presentata la nuova architettura hello:</span><span class="sxs-lookup"><span data-stu-id="dd71c-114">hello following diagram shows how hello new architecture would look:</span></span>

   ![Ripristino di emergenza del gruppo di disponibilità](./media/virtual-machines-windows-portal-sql-availability-group-dr/00-availability-group-basic-dr.png)

<span data-ttu-id="dd71c-116">Hello diagramma precedente mostra una nuova macchina virtuale denominata SQL-3.</span><span class="sxs-lookup"><span data-stu-id="dd71c-116">hello preceding diagram shows a new virtual machine called SQL-3.</span></span> <span data-ttu-id="dd71c-117">SQL-3 è in un'area di Azure diversa.</span><span class="sxs-lookup"><span data-stu-id="dd71c-117">SQL-3 is in a different Azure region.</span></span> <span data-ttu-id="dd71c-118">SQL-3 viene aggiunto toohello Cluster di Failover di Windows Server.</span><span class="sxs-lookup"><span data-stu-id="dd71c-118">SQL-3 is added toohello Windows Server Failover Cluster.</span></span> <span data-ttu-id="dd71c-119">SQL-3 può ospitare una replica del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="dd71c-119">SQL-3 can host an availability group replica.</span></span> <span data-ttu-id="dd71c-120">Si noti infine che hello regione di Azure per SQL-3 è un nuovo servizio di bilanciamento del carico di Azure.</span><span class="sxs-lookup"><span data-stu-id="dd71c-120">Finally, notice that hello Azure region for SQL-3 has a new Azure load balancer.</span></span>

>[!NOTE]
> <span data-ttu-id="dd71c-121">Un set di disponibilità di Azure è necessario quando più di una macchina virtuale si trova in hello stessa area.</span><span class="sxs-lookup"><span data-stu-id="dd71c-121">An Azure availability set is required when more than one virtual machine is in hello same region.</span></span> <span data-ttu-id="dd71c-122">Se una macchina virtuale è solo nell'area di hello, hello set di disponibilità non è obbligatorio.</span><span class="sxs-lookup"><span data-stu-id="dd71c-122">If only one virtual machine is in hello region, then hello availability set is not required.</span></span> <span data-ttu-id="dd71c-123">È possibile inserire una macchina virtuale in un set di disponibilità solo al momento della creazione.</span><span class="sxs-lookup"><span data-stu-id="dd71c-123">You can only place a virtual machine in an availability set at creation time.</span></span> <span data-ttu-id="dd71c-124">Se macchina virtuale hello è già in un set di disponibilità, è possibile aggiungere una macchina virtuale per un'altra replica in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="dd71c-124">If hello virtual machine is already in an availability set, you can add a virtual machine for an additional replica later.</span></span>

<span data-ttu-id="dd71c-125">In questa architettura, replica hello nell'area remota hello viene normalmente configurato con la modalità di disponibilità con commit asincrono e modalità di failover manuale.</span><span class="sxs-lookup"><span data-stu-id="dd71c-125">In this architecture, hello replica in hello remote region is normally configured with asynchronous commit availability mode and manual failover mode.</span></span>

<span data-ttu-id="dd71c-126">Quando le repliche del gruppo di disponibilità sono nelle macchine virtuali di Azure in aree di Azure diverse, ogni area richiede:</span><span class="sxs-lookup"><span data-stu-id="dd71c-126">When availability group replicas are on Azure virtual machines in different Azure regions, each region requires:</span></span>

* <span data-ttu-id="dd71c-127">Un gateway di rete virtuale</span><span class="sxs-lookup"><span data-stu-id="dd71c-127">A virtual network gateway</span></span>
* <span data-ttu-id="dd71c-128">Una connessione gateway di rete virtuale</span><span class="sxs-lookup"><span data-stu-id="dd71c-128">A virtual network gateway connection</span></span>

<span data-ttu-id="dd71c-129">Hello diagramma seguente mostra come reti hello comunicano tra data center.</span><span class="sxs-lookup"><span data-stu-id="dd71c-129">hello following diagram shows how hello networks communicate between data centers.</span></span>

   ![Gruppo di disponibilità](./media/virtual-machines-windows-portal-sql-availability-group-dr/01-vpngateway-example.png)

>[!IMPORTANT]
><span data-ttu-id="dd71c-131">Questa architettura è soggetta a costi per i dati in uscita replicati tra le aree di Azure.</span><span class="sxs-lookup"><span data-stu-id="dd71c-131">This architecture incurs outbound data charges for data replicated between Azure regions.</span></span> <span data-ttu-id="dd71c-132">Vedere [Prezzi per la larghezza di banda](http://azure.microsoft.com/pricing/details/bandwidth/).</span><span class="sxs-lookup"><span data-stu-id="dd71c-132">See [Bandwidth Pricing](http://azure.microsoft.com/pricing/details/bandwidth/).</span></span>  

## <a name="create-remote-replica"></a><span data-ttu-id="dd71c-133">Creare una replica remota</span><span class="sxs-lookup"><span data-stu-id="dd71c-133">Create remote replica</span></span>

<span data-ttu-id="dd71c-134">una replica in un data center remoto, toocreate hello i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="dd71c-134">toocreate a replica in a remote data center, do hello following steps:</span></span>

1. <span data-ttu-id="dd71c-135">[Creare una rete virtuale nella nuova area hello](../../../virtual-network/virtual-networks-create-vnet-arm-pportal.md).</span><span class="sxs-lookup"><span data-stu-id="dd71c-135">[Create a virtual network in hello new region](../../../virtual-network/virtual-networks-create-vnet-arm-pportal.md).</span></span>

1. <span data-ttu-id="dd71c-136">[Configurare una connessione di rete virtuale a tramite il portale di Azure hello](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md).</span><span class="sxs-lookup"><span data-stu-id="dd71c-136">[Configure a VNet-to-VNet connection using hello Azure portal](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md).</span></span>

   >[!NOTE]
   ><span data-ttu-id="dd71c-137">In alcuni casi, è possibile la connessione di rete virtuale a toouse PowerShell toocreate hello.</span><span class="sxs-lookup"><span data-stu-id="dd71c-137">In some cases, you may have toouse PowerShell toocreate hello VNet-to-VNet connection.</span></span> <span data-ttu-id="dd71c-138">Ad esempio, se si utilizzano diversi account di Azure è possibile configurare la connessione hello nel portale di hello.</span><span class="sxs-lookup"><span data-stu-id="dd71c-138">For example, if you use different Azure accounts you cannot configure hello connection in hello portal.</span></span> <span data-ttu-id="dd71c-139">Vedere in questo caso, [configura una rete virtuale multisito connessione usando il portale di Azure di hello](../../../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md).</span><span class="sxs-lookup"><span data-stu-id="dd71c-139">In this case see, [Configure a VNet-to-VNet connection using hello Azure portal](../../../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md).</span></span>

1. <span data-ttu-id="dd71c-140">[Creare un controller di dominio nella nuova area hello](../../../active-directory/active-directory-new-forest-virtual-machine.md).</span><span class="sxs-lookup"><span data-stu-id="dd71c-140">[Create a domain controller in hello new region](../../../active-directory/active-directory-new-forest-virtual-machine.md).</span></span>

   <span data-ttu-id="dd71c-141">Se il controller di dominio hello nel sito primario di hello non è disponibile, questo controller di dominio fornisce l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="dd71c-141">This domain controller provides authentication if hello domain controller in hello primary site is not available.</span></span>

1. <span data-ttu-id="dd71c-142">[Creare una macchina virtuale di SQL Server nella nuova area hello](virtual-machines-windows-portal-sql-server-provision.md).</span><span class="sxs-lookup"><span data-stu-id="dd71c-142">[Create a SQL Server virtual machine in hello new region](virtual-machines-windows-portal-sql-server-provision.md).</span></span>

1. <span data-ttu-id="dd71c-143">[Creare un servizio di bilanciamento del carico di Azure in rete hello nella nuova area hello](virtual-machines-windows-portal-sql-availability-group-tutorial.md#configure-internal-load-balancer).</span><span class="sxs-lookup"><span data-stu-id="dd71c-143">[Create an Azure load balancer in hello network on hello new region](virtual-machines-windows-portal-sql-availability-group-tutorial.md#configure-internal-load-balancer).</span></span>

   <span data-ttu-id="dd71c-144">Questo servizio di bilanciamento del carico deve:</span><span class="sxs-lookup"><span data-stu-id="dd71c-144">This load balancer must:</span></span>

   - <span data-ttu-id="dd71c-145">In hello stessa rete e subnet come hello nuova macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="dd71c-145">Be in hello same network and subnet as hello new virtual machine.</span></span>
   - <span data-ttu-id="dd71c-146">Avere un indirizzo IP statico per listener del gruppo di disponibilità hello.</span><span class="sxs-lookup"><span data-stu-id="dd71c-146">Have a static IP address for hello availability group listener.</span></span>
   - <span data-ttu-id="dd71c-147">Includere un pool back-end costituito solo macchine virtuali hello in hello stessa area come hello bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="dd71c-147">Include a backend pool consisting of only hello virtual machines in hello same region as hello load balancer.</span></span>
   - <span data-ttu-id="dd71c-148">Usare un indirizzo IP specifico toohello TCP porta probe.</span><span class="sxs-lookup"><span data-stu-id="dd71c-148">Use a TCP port probe specific toohello IP address.</span></span>
   - <span data-ttu-id="dd71c-149">Dispone di una regola specifica toohello SQL Server in hello di bilanciamento del carico stessa area.</span><span class="sxs-lookup"><span data-stu-id="dd71c-149">Have a load balancing rule specific toohello SQL Server in hello same region.</span></span>  

1. <span data-ttu-id="dd71c-150">[Aggiungere toohello funzionalità di Clustering di Failover nuovo Server SQL](virtual-machines-windows-portal-sql-availability-group-prereq.md#add-failover-clustering-features-to-both-sql-server-vms).</span><span class="sxs-lookup"><span data-stu-id="dd71c-150">[Add Failover Clustering feature toohello new SQL Server](virtual-machines-windows-portal-sql-availability-group-prereq.md#add-failover-clustering-features-to-both-sql-server-vms).</span></span>

1. <span data-ttu-id="dd71c-151">[Dominio hello nuovo SQL Server toohello](virtual-machines-windows-portal-sql-availability-group-prereq.md#joinDomain).</span><span class="sxs-lookup"><span data-stu-id="dd71c-151">[Join hello new SQL Server toohello domain](virtual-machines-windows-portal-sql-availability-group-prereq.md#joinDomain).</span></span>

1. <span data-ttu-id="dd71c-152">[Impostare un account di dominio di hello nuovo SQL Server service account toouse](virtual-machines-windows-portal-sql-availability-group-prereq.md#setServiceAccount).</span><span class="sxs-lookup"><span data-stu-id="dd71c-152">[Set hello new SQL Server service account toouse a domain account](virtual-machines-windows-portal-sql-availability-group-prereq.md#setServiceAccount).</span></span>

1. <span data-ttu-id="dd71c-153">[Aggiungere hello toohello di SQL Server nuovo Cluster di Failover di Windows Server](virtual-machines-windows-portal-sql-availability-group-tutorial.md#addNode).</span><span class="sxs-lookup"><span data-stu-id="dd71c-153">[Add hello new SQL Server toohello Windows Server Failover Cluster](virtual-machines-windows-portal-sql-availability-group-tutorial.md#addNode).</span></span>

1. <span data-ttu-id="dd71c-154">Creare una risorsa indirizzo IP nel cluster di hello.</span><span class="sxs-lookup"><span data-stu-id="dd71c-154">Create an IP address resource on hello cluster.</span></span>

   <span data-ttu-id="dd71c-155">È possibile creare la risorsa indirizzo IP hello in Gestione Cluster di Failover.</span><span class="sxs-lookup"><span data-stu-id="dd71c-155">You can create hello IP address resource in Failover Cluster Manager.</span></span> <span data-ttu-id="dd71c-156">Ruolo del gruppo di disponibilità hello destro, fare clic su **Aggiungi risorsa**, **più risorse**, fare clic su **indirizzo IP**.</span><span class="sxs-lookup"><span data-stu-id="dd71c-156">Right-click hello availability group role, click **Add Resource**, **More Resources**, and click **IP Address**.</span></span>

   ![Creare un indirizzo IP](./media/virtual-machines-windows-portal-sql-availability-group-dr/20-add-ip-resource.png)

   <span data-ttu-id="dd71c-158">Configurare l'indirizzo IP come segue:</span><span class="sxs-lookup"><span data-stu-id="dd71c-158">Configure this IP address as follows:</span></span>

   - <span data-ttu-id="dd71c-159">Usare la rete hello hello data center remoto.</span><span class="sxs-lookup"><span data-stu-id="dd71c-159">Use hello network from hello remote data center.</span></span>
   - <span data-ttu-id="dd71c-160">Assegnare l'indirizzo IP hello dal servizio di bilanciamento carico di Azure nuova hello.</span><span class="sxs-lookup"><span data-stu-id="dd71c-160">Assign hello IP address from hello new Azure load balancer.</span></span> 

1. <span data-ttu-id="dd71c-161">Nel nuovo Server SQL in Gestione configurazione SQL Server di hello [abilitare gruppi di disponibilità AlwaysOn](http://msdn.microsoft.com/library/ff878259.aspx).</span><span class="sxs-lookup"><span data-stu-id="dd71c-161">On hello new SQL Server in SQL Server Configuration Manager, [enable Always On Availability Groups](http://msdn.microsoft.com/library/ff878259.aspx).</span></span>

1. <span data-ttu-id="dd71c-162">[Porte del firewall Open in hello nuovo Server SQL](virtual-machines-windows-portal-sql-availability-group-prereq.md#endpoint-firewall).</span><span class="sxs-lookup"><span data-stu-id="dd71c-162">[Open firewall ports on hello new SQL Server](virtual-machines-windows-portal-sql-availability-group-prereq.md#endpoint-firewall).</span></span>

   <span data-ttu-id="dd71c-163">numeri di porta Hello è necessario tooopen variano a seconda dell'ambiente.</span><span class="sxs-lookup"><span data-stu-id="dd71c-163">hello port numbers you need tooopen depend on your environment.</span></span> <span data-ttu-id="dd71c-164">Aprire le porte per il mirroring di endpoint e Azure hello caricare probe di integrità del servizio di bilanciamento.</span><span class="sxs-lookup"><span data-stu-id="dd71c-164">Open ports for hello mirroring endpoint and Azure load balancer health probe.</span></span>

1. <span data-ttu-id="dd71c-165">[Aggiungere un gruppo di disponibilità di replica toohello nella hello nuovo Server SQL](http://msdn.microsoft.com/library/hh213239.aspx).</span><span class="sxs-lookup"><span data-stu-id="dd71c-165">[Add a replica toohello availability group on hello new SQL Server](http://msdn.microsoft.com/library/hh213239.aspx).</span></span>

   <span data-ttu-id="dd71c-166">Per una replica in un'area di Azure remota, impostarla per la replica asincrona con il failover manuale.</span><span class="sxs-lookup"><span data-stu-id="dd71c-166">For a replica in a remote Azure region, set it for asynchronous replication with manual failover.</span></span>  

1. <span data-ttu-id="dd71c-167">Aggiungere la risorsa indirizzo IP hello come una dipendenza per il cluster di hello listener client accesso punto (nome rete).</span><span class="sxs-lookup"><span data-stu-id="dd71c-167">Add hello IP address resource as a dependency for hello listener client access point (network name) cluster.</span></span>

   <span data-ttu-id="dd71c-168">Hello schermata seguente mostra una risorsa cluster di indirizzo IP configurata correttamente:</span><span class="sxs-lookup"><span data-stu-id="dd71c-168">hello following screenshot shows a properly configured IP address cluster resource:</span></span>

   ![Gruppo di disponibilità](./media/virtual-machines-windows-portal-sql-availability-group-dr/50-configure-dependency-multiple-ip.png)

   >[!IMPORTANT]
   ><span data-ttu-id="dd71c-170">gruppo di risorse cluster Hello include entrambi gli indirizzi IP.</span><span class="sxs-lookup"><span data-stu-id="dd71c-170">hello cluster resource group includes both IP addresses.</span></span> <span data-ttu-id="dd71c-171">Entrambi gli indirizzi IP sono le dipendenze per punto di accesso client di hello listener.</span><span class="sxs-lookup"><span data-stu-id="dd71c-171">Both IP addresses are dependencies for hello listener client access point.</span></span> <span data-ttu-id="dd71c-172">Hello utilizzare **o** operatore nella configurazione delle dipendenze hello cluster.</span><span class="sxs-lookup"><span data-stu-id="dd71c-172">Use hello **OR** operator in hello cluster dependency configuration.</span></span>

1. <span data-ttu-id="dd71c-173">[Impostare i parametri del cluster hello in PowerShell](virtual-machines-windows-portal-sql-availability-group-tutorial.md#setparam).</span><span class="sxs-lookup"><span data-stu-id="dd71c-173">[Set hello cluster parameters in PowerShell](virtual-machines-windows-portal-sql-availability-group-tutorial.md#setparam).</span></span>

<span data-ttu-id="dd71c-174">Eseguire script di PowerShell hello con il nome di rete cluster hello, indirizzo IP e porta probe configurate nel servizio di bilanciamento del carico hello nella nuova area hello.</span><span class="sxs-lookup"><span data-stu-id="dd71c-174">Run hello PowerShell script with hello cluster network name, IP address, and probe port that you configured on hello load balancer in hello new region.</span></span>

   ```PowerShell
   $ClusterNetworkName = "<MyClusterNetworkName>" # hello cluster name for hello network in hello new region (Use Get-ClusterNetwork on Windows Server 2012 of higher toofind hello name).
   $IPResourceName = "<IPResourceName>" # hello cluster name for hello new IP Address resource.
   $ILBIP = “<n.n.n.n>” # hello IP Address of hello Internal Load Balancer (ILB) in hello new region. This is hello static IP address for hello load balancer you configured in hello Azure portal.
   [int]$ProbePort = <nnnnn> # hello probe port you set on hello ILB.

   Import-Module FailoverClusters

   Get-ClusterResource $IPResourceName | Set-ClusterParameter -Multiple @{"Address"="$ILBIP";"ProbePort"=$ProbePort;"SubnetMask"="255.255.255.255";"Network"="$ClusterNetworkName";"EnableDhcp"=0}
   ```

## <a name="set-connection-for-multiple-subnets"></a><span data-ttu-id="dd71c-175">Impostare la connessione per più subnet</span><span class="sxs-lookup"><span data-stu-id="dd71c-175">Set connection for multiple subnets</span></span>

<span data-ttu-id="dd71c-176">replica Hello in hello data center remoto fa parte del gruppo di disponibilità hello ma si trova in una subnet diversa.</span><span class="sxs-lookup"><span data-stu-id="dd71c-176">hello replica in hello remote data center is part of hello availability group but it is in a different subnet.</span></span> <span data-ttu-id="dd71c-177">Se la replica diventa la replica primaria di hello, potrebbe verificarsi il timeout di connessione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="dd71c-177">If this replica becomes hello primary replica, application connection time-outs may occur.</span></span> <span data-ttu-id="dd71c-178">Questo comportamento è hello uguale a un gruppo di disponibilità locale in una distribuzione su più subnet.</span><span class="sxs-lookup"><span data-stu-id="dd71c-178">This behavior is hello same as an on-premises availability group in a multi-subnet deployment.</span></span> <span data-ttu-id="dd71c-179">tooallow connessioni dalle applicazioni client, aggiornare la connessione di client hello o configurare la memorizzazione nella cache sulla risorsa nome di rete cluster hello risoluzione dei nomi.</span><span class="sxs-lookup"><span data-stu-id="dd71c-179">tooallow connections from client applications, either update hello client connection or configure name resolution caching on hello cluster network name resource.</span></span>

<span data-ttu-id="dd71c-180">Aggiornare, preferibilmente hello client connessione stringhe tooset `MultiSubnetFailover=Yes`.</span><span class="sxs-lookup"><span data-stu-id="dd71c-180">Preferably, update hello client connection strings tooset `MultiSubnetFailover=Yes`.</span></span> <span data-ttu-id="dd71c-181">Vedere [Connessione con MultiSubnetFailover](http://msdn.microsoft.com/library/gg471494#Anchor_0).</span><span class="sxs-lookup"><span data-stu-id="dd71c-181">See [Connecting With MultiSubnetFailover](http://msdn.microsoft.com/library/gg471494#Anchor_0).</span></span>

<span data-ttu-id="dd71c-182">Se non è possibile modificare le stringhe di connessione hello, è possibile configurare la memorizzazione nella cache di risoluzione nome.</span><span class="sxs-lookup"><span data-stu-id="dd71c-182">If you cannot modify hello connection strings, you can configure name resolution caching.</span></span> <span data-ttu-id="dd71c-183">Vedere [Connection Timeouts in Multi-subnet Availability Group](http://blogs.msdn.microsoft.com/alwaysonpro/2014/06/03/connection-timeouts-in-multi-subnet-availability-group/) (Timeout connessione in un gruppo di disponibilità su più subnet).</span><span class="sxs-lookup"><span data-stu-id="dd71c-183">See [Connection Timeouts in Multi-subnet Availability Group](http://blogs.msdn.microsoft.com/alwaysonpro/2014/06/03/connection-timeouts-in-multi-subnet-availability-group/).</span></span>

## <a name="fail-over-tooremote-region"></a><span data-ttu-id="dd71c-184">Eseguire il failover tooremote area</span><span class="sxs-lookup"><span data-stu-id="dd71c-184">Fail over tooremote region</span></span>

<span data-ttu-id="dd71c-185">tootest listener connettività toohello remoto area, è possibile eseguire il failover regione di hello replica toohello remoto.</span><span class="sxs-lookup"><span data-stu-id="dd71c-185">tootest listener connectivity toohello remote region, you can fail over hello replica toohello remote region.</span></span> <span data-ttu-id="dd71c-186">Durante la replica hello è asincrona, il failover è vulnerabile toopotential perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="dd71c-186">While hello replica is asynchronous, failover is vulnerable toopotential data loss.</span></span> <span data-ttu-id="dd71c-187">toofail failover senza perdita di dati, impostare toosynchronous modalità di disponibilità hello e tooautomatic modalità di failover hello.</span><span class="sxs-lookup"><span data-stu-id="dd71c-187">toofail over without data loss, change hello availability mode toosynchronous and set hello failover mode tooautomatic.</span></span> <span data-ttu-id="dd71c-188">Utilizzare hello alla procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="dd71c-188">Use hello following steps:</span></span>

1. <span data-ttu-id="dd71c-189">In **Esplora oggetti**, connettere toohello istanza di SQL Server che ospita la replica primaria hello.</span><span class="sxs-lookup"><span data-stu-id="dd71c-189">In **Object Explorer**, connect toohello instance of SQL Server that hosts hello primary replica.</span></span>
1. <span data-ttu-id="dd71c-190">In **Gruppi di disponibilità AlwaysOn**, **Gruppi di disponibilità** fare clic con il pulsante destro del mouse sul gruppo di disponibilità e scegliere **Proprietà**.</span><span class="sxs-lookup"><span data-stu-id="dd71c-190">Under **AlwaysOn Availability Groups**, **Availability Groups**, right-click your availability group and click **Properties**.</span></span>
1. <span data-ttu-id="dd71c-191">In hello **generale** nella pagina **le repliche di disponibilità**, replica di secondaria hello set in toouse del sito di ripristino di emergenza hello **Commit sincrono** modalità di disponibilità e **Automatico** modalità di failover.</span><span class="sxs-lookup"><span data-stu-id="dd71c-191">On hello **General** page, under **Availability Replicas**, set hello secondary replica in hello DR site toouse **Synchronous Commit** availability mode and **Automatic** failover mode.</span></span>
1. <span data-ttu-id="dd71c-192">Se si dispone di una replica secondaria nello stesso sito come replica primaria per la disponibilità elevata, impostare questa replica troppo**Commit asincrono** e **manuale**.</span><span class="sxs-lookup"><span data-stu-id="dd71c-192">If you have a secondary replica in same site as your primary replica for high availability, set this replica too**Asynchronous Commit** and **Manual**.</span></span>
1. <span data-ttu-id="dd71c-193">Fare clic su OK.</span><span class="sxs-lookup"><span data-stu-id="dd71c-193">Click OK.</span></span>
1. <span data-ttu-id="dd71c-194">In **Esplora oggetti**destro del mouse il gruppo di disponibilità hello e fare clic su **Mostra Dashboard**.</span><span class="sxs-lookup"><span data-stu-id="dd71c-194">In **Object Explorer**, right-click hello availability group, and click **Show Dashboard**.</span></span>
1. <span data-ttu-id="dd71c-195">Nel dashboard di hello, verificare che hello replica nel sito di ripristino di emergenza hello è sincronizzata.</span><span class="sxs-lookup"><span data-stu-id="dd71c-195">On hello dashboard, verify that hello replica on hello DR site is synchronized.</span></span>
1. <span data-ttu-id="dd71c-196">In **Esplora oggetti**destro del mouse il gruppo di disponibilità hello e fare clic su **Failover...** . SQL Server Management Studio apre una procedura guidata toofail su SQL Server.</span><span class="sxs-lookup"><span data-stu-id="dd71c-196">In **Object Explorer**, right-click hello availability group, and click **Failover...**. SQL Server Management Studios opens a wizard toofail over SQL Server.</span></span>  
1. <span data-ttu-id="dd71c-197">Fare clic su **Avanti**e l'istanza di SQL Server selezionare hello nel sito di ripristino di emergenza hello.</span><span class="sxs-lookup"><span data-stu-id="dd71c-197">Click **Next**, and select hello SQL Server instance in hello DR site.</span></span> <span data-ttu-id="dd71c-198">Fare di nuovo clic su **Avanti** .</span><span class="sxs-lookup"><span data-stu-id="dd71c-198">Click **Next** again.</span></span>
1. <span data-ttu-id="dd71c-199">Connettere toohello istanza di SQL Server nel sito di ripristino di emergenza hello e fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="dd71c-199">Connect toohello SQL Server instance in hello DR site and click **Next**.</span></span>
1. <span data-ttu-id="dd71c-200">In hello **riepilogo** pagina, verificare le impostazioni di hello e fare clic su **fine**.</span><span class="sxs-lookup"><span data-stu-id="dd71c-200">On hello **Summary** page, verify hello settings and click **Finish**.</span></span>

<span data-ttu-id="dd71c-201">Al termine del test di connettività, spostare dati primario di hello replica primaria tooyour indietro center e impostazioni hello disponibilità modalità indietro tootheir normale funzionamento.</span><span class="sxs-lookup"><span data-stu-id="dd71c-201">After testing connectivity, move hello primary replica back tooyour primary data center and set hello availability mode back tootheir normal operating settings.</span></span> <span data-ttu-id="dd71c-202">Hello nella tabella seguente mostra le impostazioni operative normali hello per architettura hello descritte in questo documento:</span><span class="sxs-lookup"><span data-stu-id="dd71c-202">hello following table shows hello normal operational settings for hello architecture described in this document:</span></span>

| <span data-ttu-id="dd71c-203">Percorso</span><span class="sxs-lookup"><span data-stu-id="dd71c-203">Location</span></span> | <span data-ttu-id="dd71c-204">Istanza del server</span><span class="sxs-lookup"><span data-stu-id="dd71c-204">Server Instance</span></span> | <span data-ttu-id="dd71c-205">Ruolo</span><span class="sxs-lookup"><span data-stu-id="dd71c-205">Role</span></span> | <span data-ttu-id="dd71c-206">Modalità di disponibilità</span><span class="sxs-lookup"><span data-stu-id="dd71c-206">Availability Mode</span></span> | <span data-ttu-id="dd71c-207">Modalità di failover</span><span class="sxs-lookup"><span data-stu-id="dd71c-207">Failover Mode</span></span>
| ----- | ----- | ----- | ----- | -----
| <span data-ttu-id="dd71c-208">Data center primario</span><span class="sxs-lookup"><span data-stu-id="dd71c-208">Primary data center</span></span> | <span data-ttu-id="dd71c-209">SQL-1</span><span class="sxs-lookup"><span data-stu-id="dd71c-209">SQL-1</span></span> | <span data-ttu-id="dd71c-210">Primario</span><span class="sxs-lookup"><span data-stu-id="dd71c-210">Primary</span></span> | <span data-ttu-id="dd71c-211">Sincrono</span><span class="sxs-lookup"><span data-stu-id="dd71c-211">Synchronous</span></span> | <span data-ttu-id="dd71c-212">Automatico</span><span class="sxs-lookup"><span data-stu-id="dd71c-212">Automatic</span></span>
| <span data-ttu-id="dd71c-213">Data center primario</span><span class="sxs-lookup"><span data-stu-id="dd71c-213">Primary data center</span></span> | <span data-ttu-id="dd71c-214">SQL-2</span><span class="sxs-lookup"><span data-stu-id="dd71c-214">SQL-2</span></span> | <span data-ttu-id="dd71c-215">Secondario</span><span class="sxs-lookup"><span data-stu-id="dd71c-215">Secondary</span></span> | <span data-ttu-id="dd71c-216">Sincrono</span><span class="sxs-lookup"><span data-stu-id="dd71c-216">Synchronous</span></span> | <span data-ttu-id="dd71c-217">Automatico</span><span class="sxs-lookup"><span data-stu-id="dd71c-217">Automatic</span></span>
| <span data-ttu-id="dd71c-218">Data center secondario o remoto</span><span class="sxs-lookup"><span data-stu-id="dd71c-218">Secondary or remote data center</span></span> | <span data-ttu-id="dd71c-219">SQL-3</span><span class="sxs-lookup"><span data-stu-id="dd71c-219">SQL-3</span></span> | <span data-ttu-id="dd71c-220">Secondario</span><span class="sxs-lookup"><span data-stu-id="dd71c-220">Secondary</span></span> | <span data-ttu-id="dd71c-221">Asincrono</span><span class="sxs-lookup"><span data-stu-id="dd71c-221">Asynchronous</span></span> | <span data-ttu-id="dd71c-222">Manuale</span><span class="sxs-lookup"><span data-stu-id="dd71c-222">Manual</span></span>


### <a name="more-information-about-planned-and-forced-manual-failover"></a><span data-ttu-id="dd71c-223">Altre informazioni sul failover manuale forzato e pianificato</span><span class="sxs-lookup"><span data-stu-id="dd71c-223">More information about planned and forced manual failover</span></span>

<span data-ttu-id="dd71c-224">Per ulteriori informazioni, vedere hello seguenti argomenti:</span><span class="sxs-lookup"><span data-stu-id="dd71c-224">For more information, see hello following topics:</span></span>

- [<span data-ttu-id="dd71c-225">Eseguire un failover manuale pianificato di un gruppo di disponibilità (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="dd71c-225">Perform a Planned Manual Failover of an Availability Group (SQL Server)</span></span>](http://msdn.microsoft.com/library/hh231018.aspx)
- [<span data-ttu-id="dd71c-226">Eseguire un failover manuale forzato di un gruppo di disponibilità (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="dd71c-226">Perform a Forced Manual Failover of an Availability Group (SQL Server)</span></span>](http://msdn.microsoft.com/library/ff877957.aspx)

## <a name="additional-links"></a><span data-ttu-id="dd71c-227">Altri collegamenti</span><span class="sxs-lookup"><span data-stu-id="dd71c-227">Additional Links</span></span>

* [<span data-ttu-id="dd71c-228">Gruppi di disponibilità AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="dd71c-228">Always On Availability Groups</span></span>](http://msdn.microsoft.com/library/hh510230.aspx)
* [<span data-ttu-id="dd71c-229">Macchine virtuali di Azure</span><span class="sxs-lookup"><span data-stu-id="dd71c-229">Azure Virtual Machines</span></span>](http://docs.microsoft.com/azure/virtual-machines/windows/)
* [<span data-ttu-id="dd71c-230">Servizi di bilanciamento del carico di Azure</span><span class="sxs-lookup"><span data-stu-id="dd71c-230">Azure Load Balancers</span></span>](virtual-machines-windows-portal-sql-availability-group-tutorial.md#configure-internal-load-balancer)
* [<span data-ttu-id="dd71c-231">Set di disponibilità di Azure</span><span class="sxs-lookup"><span data-stu-id="dd71c-231">Azure Availability Sets</span></span>](../manage-availability.md)
