---
title: 'Azure AD Connect: Come eseguire il ripristino dal limite di 10 GB per LocalDB | Microsoft Docs'
description: Questo argomento descrive come eseguire il ripristino del servizio di sincronizzazione Azure AD Connect quando incontra il problema del limite di 10 GB per LocalDB.
services: active-directory
documentationcenter: 
author: cychua
manager: femila
editor: 
ms.assetid: 41d081af-ed89-4e17-be34-14f7e80ae358
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: billmath
ms.openlocfilehash: 08e682c51b12d4506019d2f6b68e1eae0798b990
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-how-to-recover-from-localdb-10-gb-limit"></a><span data-ttu-id="df4ca-103">Azure AD Connect: Come eseguire il ripristino dal limite di 10 GB per LocalDB</span><span class="sxs-lookup"><span data-stu-id="df4ca-103">Azure AD Connect: How to recover from LocalDB 10-GB limit</span></span>
<span data-ttu-id="df4ca-104">Per archiviare i dati sull'identità, Azure AD Connect richiede un database SQL.</span><span class="sxs-lookup"><span data-stu-id="df4ca-104">Azure AD Connect requires a SQL Server database to store identity data.</span></span> <span data-ttu-id="df4ca-105">È possibile usare l'istanza predefinita di SQL Server 2012 Express LocalDB installata con Azure AD Connect oppure usare la versione di SQL completa.</span><span class="sxs-lookup"><span data-stu-id="df4ca-105">You can either use the default SQL Server 2012 Express LocalDB installed with Azure AD Connect or use your own full SQL.</span></span> <span data-ttu-id="df4ca-106">SQL Server Express impone un limite di 10 GB.</span><span class="sxs-lookup"><span data-stu-id="df4ca-106">SQL Server Express imposes a 10-GB size limit.</span></span> <span data-ttu-id="df4ca-107">Quando si usa LocalDB e viene raggiunto questo limite, il servizio di sincronizzazione Azure AD Connect non può più essere avviato o eseguire la sincronizzazione correttamente.</span><span class="sxs-lookup"><span data-stu-id="df4ca-107">When using LocalDB and this limit is reached, Azure AD Connect Synchronization Service can no longer start or synchronize properly.</span></span> <span data-ttu-id="df4ca-108">Questo articolo illustra la procedura di ripristino.</span><span class="sxs-lookup"><span data-stu-id="df4ca-108">This article provides the recovery steps.</span></span>

## <a name="symptoms"></a><span data-ttu-id="df4ca-109">Sintomi</span><span class="sxs-lookup"><span data-stu-id="df4ca-109">Symptoms</span></span>
<span data-ttu-id="df4ca-110">Esistono due sintomi comuni:</span><span class="sxs-lookup"><span data-stu-id="df4ca-110">There are two common symptoms:</span></span>

* <span data-ttu-id="df4ca-111">Il servizio di sincronizzazione Azure AD Connect **è in esecuzione** ma non effettua la sincronizzazione e genera l'errore *"stopped-database-disk-full"*.</span><span class="sxs-lookup"><span data-stu-id="df4ca-111">Azure AD Connect Synchronization Service **is running** but fails to synchronize with *“stopped-database-disk-full”* error.</span></span>

* <span data-ttu-id="df4ca-112">Il servizio di sincronizzazione Azure AD Connect **non può essere avviato**.</span><span class="sxs-lookup"><span data-stu-id="df4ca-112">Azure AD Connect Synchronization Service **is unable to start**.</span></span> <span data-ttu-id="df4ca-113">Quando si prova ad avviare il servizio, l'operazione non riesce e vengono generati l'evento 6323 il messaggio di errore *"Errore del server. Spazio su disco insufficiente per SQL Server".*</span><span class="sxs-lookup"><span data-stu-id="df4ca-113">When you attempt to start the service, it fails with event 6323 and error message *"The server encountered an error because SQL Server is out of disk space."*</span></span>

## <a name="short-term-recovery-steps"></a><span data-ttu-id="df4ca-114">Procedura di ripristino a breve termine</span><span class="sxs-lookup"><span data-stu-id="df4ca-114">Short-term recovery steps</span></span>
<span data-ttu-id="df4ca-115">Questa sezione illustra come recuperare lo spazio del DB necessario per ripristinare il funzionamento del servizio di sincronizzazione Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="df4ca-115">This section provides the steps to reclaim DB space required for Azure AD Connect Synchronization Service to resume operation.</span></span> <span data-ttu-id="df4ca-116">I passaggi includono:</span><span class="sxs-lookup"><span data-stu-id="df4ca-116">The steps include:</span></span>
1. [<span data-ttu-id="df4ca-117">Determinare lo stato del servizio di sincronizzazione</span><span class="sxs-lookup"><span data-stu-id="df4ca-117">Determine the Synchronization Service status</span></span>](#determine-the-synchronization-service-status)
2. [<span data-ttu-id="df4ca-118">Compattare il database</span><span class="sxs-lookup"><span data-stu-id="df4ca-118">Shrink the database</span></span>](#shrink-the-database)
3. [<span data-ttu-id="df4ca-119">Eliminare i dati della cronologia di esecuzione</span><span class="sxs-lookup"><span data-stu-id="df4ca-119">Delete run history data</span></span>](#delete-run-history-data)
4. [<span data-ttu-id="df4ca-120">Abbreviare il periodo di conservazione dei dati della cronologia di esecuzione</span><span class="sxs-lookup"><span data-stu-id="df4ca-120">Shorten retention period for run history data</span></span>](#shorten-retention-period-for-run-history-data)

### <a name="determine-the-synchronization-service-status"></a><span data-ttu-id="df4ca-121">Determinare lo stato del servizio di sincronizzazione</span><span class="sxs-lookup"><span data-stu-id="df4ca-121">Determine the Synchronization Service status</span></span>
<span data-ttu-id="df4ca-122">Determinare prima se il servizio di sincronizzazione è ancora in esecuzione:</span><span class="sxs-lookup"><span data-stu-id="df4ca-122">First, determine whether the Synchronization Service is still running or not:</span></span>

1. <span data-ttu-id="df4ca-123">Accedere al server di Azure AD Connect come amministratore.</span><span class="sxs-lookup"><span data-stu-id="df4ca-123">Log in to your Azure AD Connect server as administrator.</span></span>

2. <span data-ttu-id="df4ca-124">Passare a **Gestione controllo servizi**.</span><span class="sxs-lookup"><span data-stu-id="df4ca-124">Go to **Service Control Manager**.</span></span>

3. <span data-ttu-id="df4ca-125">Verificare lo stato di **Microsoft Azure AD Sync**.</span><span class="sxs-lookup"><span data-stu-id="df4ca-125">Check the status of **Microsoft Azure AD Sync**.</span></span>


4. <span data-ttu-id="df4ca-126">Se è in esecuzione, non arrestare o riavviare il servizio.</span><span class="sxs-lookup"><span data-stu-id="df4ca-126">If it is running, do not stop or restart the service.</span></span> <span data-ttu-id="df4ca-127">Ignorare il passaggio [Compattare il database](#shrink-the-database) e proseguire con il passaggio [Eliminare i dati della cronologia di esecuzione](#delete-run-history-data).</span><span class="sxs-lookup"><span data-stu-id="df4ca-127">Skip [Shrink the database](#shrink-the-database) step and go to [Delete run history data](#delete-run-history-data) step.</span></span>

5. <span data-ttu-id="df4ca-128">Se non è in esecuzione, provare ad avviare il servizio.</span><span class="sxs-lookup"><span data-stu-id="df4ca-128">If it is not running, try to start the service.</span></span> <span data-ttu-id="df4ca-129">Se il servizio si avvia, ignorare il passaggio [Compattare il database](#shrink-the-database) e proseguire con il passaggio [Eliminare i dati della cronologia di esecuzione](#delete-run-history-data).</span><span class="sxs-lookup"><span data-stu-id="df4ca-129">If the service starts successfully, skip [Shrink the database](#shrink-the-database) step and go to [Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="df4ca-130">In caso contrario, proseguire con il passaggio [Compattare il database](#shrink-the-database).</span><span class="sxs-lookup"><span data-stu-id="df4ca-130">Otherwise, continue with [Shrink the database](#shrink-the-database) step.</span></span>

### <a name="shrink-the-database"></a><span data-ttu-id="df4ca-131">Compattare il database</span><span class="sxs-lookup"><span data-stu-id="df4ca-131">Shrink the database</span></span>
<span data-ttu-id="df4ca-132">Usare l'operazione di compattazione per liberare spazio del database sufficiente per avviare il servizio di sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="df4ca-132">Use the Shrink operation to free up enough DB space to start the Synchronization Service.</span></span> <span data-ttu-id="df4ca-133">Lo spazio verrà liberato rimuovendo gli spazi vuoti presenti nel database.</span><span class="sxs-lookup"><span data-stu-id="df4ca-133">It frees up DB space by removing whitespaces in the database.</span></span> <span data-ttu-id="df4ca-134">Si tratta del miglior tentativo possibile, dato che non è certo che sia sempre possibile recuperare lo spazio.</span><span class="sxs-lookup"><span data-stu-id="df4ca-134">This step is best-effort as it is not guaranteed that you can always recover space.</span></span> <span data-ttu-id="df4ca-135">Per altre informazioni sull'operazione di compattazione, vedere l'articolo [Compattare un database](https://msdn.microsoft.com/library/ms189035.aspx).</span><span class="sxs-lookup"><span data-stu-id="df4ca-135">To learn more about Shrink operation, read this article [Shrink a database](https://msdn.microsoft.com/library/ms189035.aspx).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="df4ca-136">Ignorare questo passaggio se è possibile eseguire il servizio di sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="df4ca-136">Skip this step if you can get the Synchronization Service to run.</span></span> <span data-ttu-id="df4ca-137">Non è consigliabile compattare il database SQL, perché può causare una riduzione delle prestazioni a causa di una maggiore frammentazione.</span><span class="sxs-lookup"><span data-stu-id="df4ca-137">It is not recommended to shrink the SQL DB as it can lead to poor performance due to increased fragmentation.</span></span>

<span data-ttu-id="df4ca-138">Il nome del database creato per Azure AD Connect è **ADSync**.</span><span class="sxs-lookup"><span data-stu-id="df4ca-138">The name of the database created for Azure AD Connect is **ADSync**.</span></span> <span data-ttu-id="df4ca-139">Per eseguire un'operazione di compattazione è necessario accedere come amministratore di sistema o DBO del database.</span><span class="sxs-lookup"><span data-stu-id="df4ca-139">To perform a Shrink operation, you must log in either as the sysadmin or DBO of the database.</span></span> <span data-ttu-id="df4ca-140">Durante l'installazione di Azure AD Connect vengono concessi diritti di amministratore di sistema agli account seguenti:</span><span class="sxs-lookup"><span data-stu-id="df4ca-140">During Azure AD Connect installation, the following accounts are granted sysadmin rights:</span></span>
* <span data-ttu-id="df4ca-141">Amministratori locali</span><span class="sxs-lookup"><span data-stu-id="df4ca-141">Local Administrators</span></span>
* <span data-ttu-id="df4ca-142">Account utente usato per eseguire l'installazione di Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="df4ca-142">The user account that was used to run Azure AD Connect installation.</span></span>
* <span data-ttu-id="df4ca-143">Account del servizio di sincronizzazione usato come contesto operativo del servizio di sincronizzazione Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="df4ca-143">The Sync Service account that is used as the operating context of Azure AD Connect Synchronization Service.</span></span>
* <span data-ttu-id="df4ca-144">Gruppo locale ADSyncAdmins creato durante l'installazione.</span><span class="sxs-lookup"><span data-stu-id="df4ca-144">The local group ADSyncAdmins that was created during installation.</span></span>

1. <span data-ttu-id="df4ca-145">Eseguire il backup del database copiando in una posizione sicura i file **ADSync.mdf** e **ADSync_log.ldf** presenti in `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data`.</span><span class="sxs-lookup"><span data-stu-id="df4ca-145">Back up the database by copying **ADSync.mdf** and **ADSync_log.ldf** files located under `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` to a safe location.</span></span>

2. <span data-ttu-id="df4ca-146">Avviare una nuova sessione di PowerShell.</span><span class="sxs-lookup"><span data-stu-id="df4ca-146">Start a new PowerShell session.</span></span>

3. <span data-ttu-id="df4ca-147">Passare alla cartella `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span><span class="sxs-lookup"><span data-stu-id="df4ca-147">Navigate to folder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span></span>

4. <span data-ttu-id="df4ca-148">Avviare l'utilità **sqlcmd** eseguendo il comando `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, usando le credenziali di un amministratore di sistema o del DBO del database.</span><span class="sxs-lookup"><span data-stu-id="df4ca-148">Start **sqlcmd** utility by running the command `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, using the credential of a sysadmin or the database DBO.</span></span>

5. <span data-ttu-id="df4ca-149">Per compattare il database, al prompt di sqlcmd (1>) immettere `DBCC Shrinkdatabase(ADSync,1);` seguito da `GO` nella riga successiva.</span><span class="sxs-lookup"><span data-stu-id="df4ca-149">To shrink the database, at the sqlcmd prompt (1>), enter `DBCC Shrinkdatabase(ADSync,1);`, followed by `GO` in the next line.</span></span>

6. <span data-ttu-id="df4ca-150">Se l'operazione ha esito positivo, provare nuovamente ad avviare il servizio di sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="df4ca-150">If the operation is successful, try to start the Synchronization Service again.</span></span> <span data-ttu-id="df4ca-151">Se è possibile avviare il servizio di sincronizzazione, proseguire con il passaggio [Eliminare i dati della cronologia di esecuzione](#delete-run-history-data).</span><span class="sxs-lookup"><span data-stu-id="df4ca-151">If you can start the Synchronization Service, go to [Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="df4ca-152">In caso contrario, contattare il supporto tecnico.</span><span class="sxs-lookup"><span data-stu-id="df4ca-152">If not, contact Support.</span></span>

### <a name="delete-run-history-data"></a><span data-ttu-id="df4ca-153">Eliminare i dati della cronologia di esecuzione</span><span class="sxs-lookup"><span data-stu-id="df4ca-153">Delete run history data</span></span>
<span data-ttu-id="df4ca-154">Per impostazione predefinita, Azure AD Connect conserva i dati della cronologia di esecuzione per sette giorni.</span><span class="sxs-lookup"><span data-stu-id="df4ca-154">By default, Azure AD Connect retains up to seven days’ worth of run history data.</span></span> <span data-ttu-id="df4ca-155">In questo passaggio si eliminano i dati della cronologia di esecuzione per recuperare spazio del database e riavviare il servizio di sincronizzazione Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="df4ca-155">In this step, we delete the run history data to reclaim DB space so that Azure AD Connect Synchronization Service can start syncing again.</span></span>

1.  <span data-ttu-id="df4ca-156">Avviare **Synchronization Service Manager** passando a START → Synchronization Service (Servizio di sincronizzazione).</span><span class="sxs-lookup"><span data-stu-id="df4ca-156">Start **Synchronization Service Manager** by going to START → Synchronization Service.</span></span>

2.  <span data-ttu-id="df4ca-157">Passare alla scheda **Operations** (Operazioni).</span><span class="sxs-lookup"><span data-stu-id="df4ca-157">Go to the **Operations** tab.</span></span>

3.  <span data-ttu-id="df4ca-158">In **Actions** (Azioni) selezionare **Clear Runs** (Cancella esecuzioni).</span><span class="sxs-lookup"><span data-stu-id="df4ca-158">Under **Actions**, select **Clear Runs**…</span></span>

4.  <span data-ttu-id="df4ca-159">È possibile scegliere **Clear all runs** (Cancella tutte le esecuzioni) oppure **Clear runs before<date>** (Cancella esecuzioni precedenti a).</span><span class="sxs-lookup"><span data-stu-id="df4ca-159">You can either choose **Clear all runs** or **Clear runs before… <date>** option.</span></span> <span data-ttu-id="df4ca-160">È consigliabile iniziare cancellando i dati della cronologia di esecuzione che risalgono a più di due giorni di prima.</span><span class="sxs-lookup"><span data-stu-id="df4ca-160">It is recommended that you start by clearing run history data that are older than two days.</span></span> <span data-ttu-id="df4ca-161">Se il problema delle dimensioni del database persiste, scegliere l'opzione **Clear all runs** (Cancella tutte le esecuzioni).</span><span class="sxs-lookup"><span data-stu-id="df4ca-161">If you continue to run into DB size issue, then choose the **Clear all runs** option.</span></span>

### <a name="shorten-retention-period-for-run-history-data"></a><span data-ttu-id="df4ca-162">Abbreviare il periodo di conservazione dei dati della cronologia di esecuzione</span><span class="sxs-lookup"><span data-stu-id="df4ca-162">Shorten retention period for run history data</span></span>
<span data-ttu-id="df4ca-163">Questo passaggio consente di ridurre la probabilità che si verifichi il problema del limite di 10 GB dopo più cicli di sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="df4ca-163">This step is to reduce the likelihood of running into the 10-GB limit issue after multiple sync cycles.</span></span>

1. <span data-ttu-id="df4ca-164">Aprire una nuova sessione di PowerShell.</span><span class="sxs-lookup"><span data-stu-id="df4ca-164">Open a new PowerShell session.</span></span>

2. <span data-ttu-id="df4ca-165">Eseguire `Get-ADSyncScheduler` e prendere nota della proprietà PurgeRunHistoryInterval, che specifica il periodo di conservazione corrente.</span><span class="sxs-lookup"><span data-stu-id="df4ca-165">Run `Get-ADSyncScheduler` and take note of the PurgeRunHistoryInterval property, which specifies the current retention period.</span></span>

3. <span data-ttu-id="df4ca-166">Eseguire `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` per impostare il periodo di conservazione di due giorni.</span><span class="sxs-lookup"><span data-stu-id="df4ca-166">Run `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` to set the retention period to two days.</span></span> <span data-ttu-id="df4ca-167">Modificare il periodo di conservazione secondo le esigenze.</span><span class="sxs-lookup"><span data-stu-id="df4ca-167">Adjust the retention period as appropriate.</span></span>

## <a name="long-term-solution--migrate-to-full-sql"></a><span data-ttu-id="df4ca-168">Soluzione a lungo termine: migrazione alla versione di SQL completa</span><span class="sxs-lookup"><span data-stu-id="df4ca-168">Long-term solution – Migrate to full SQL</span></span>
<span data-ttu-id="df4ca-169">In generale, il problema indica che le dimensioni del database di 10 GB non sono più sufficienti per eseguire la sincronizzazione dall'istanza di Active Directory locale ad Azure AD tramite Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="df4ca-169">In general, the issue is indicative that 10-GB database size is no longer sufficient for Azure AD Connect to synchronize your on-premises Active Directory to Azure AD.</span></span> <span data-ttu-id="df4ca-170">È consigliabile passare alla versione completa di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="df4ca-170">It is recommended that you switch to using the full version of SQL server.</span></span> <span data-ttu-id="df4ca-171">Non è possibile sostituire direttamente il database locale di una distribuzione di Azure AD Connect esistente con il database della versione completa di SQL.</span><span class="sxs-lookup"><span data-stu-id="df4ca-171">You cannot directly replace the LocalDB of an existing Azure AD Connect deployment with the database of the full version of SQL.</span></span> <span data-ttu-id="df4ca-172">È invece necessario distribuire un nuovo server di Azure AD Connect con la versione completa di SQL.</span><span class="sxs-lookup"><span data-stu-id="df4ca-172">Instead, you must deploy a new Azure AD Connect server with the full version of SQL.</span></span> <span data-ttu-id="df4ca-173">È consigliabile eseguire una migrazione swing in cui il nuovo server di Azure AD Connect (con il database SQL) viene distribuito come server di staging, accanto al server di Azure AD Connect esistente (con LocalDB).</span><span class="sxs-lookup"><span data-stu-id="df4ca-173">It is recommended that you do a swing migration where the new Azure AD Connect server (with SQL DB) is deployed as a staging server, next to the existing Azure AD Connect server (with LocalDB).</span></span> 
* <span data-ttu-id="df4ca-174">Per istruzioni su come configurare un'istanza SQL remota con Azure AD Connect, vedere l'articolo [Installazione personalizzata di Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span><span class="sxs-lookup"><span data-stu-id="df4ca-174">For instruction on how to configure remote SQL with Azure AD Connect, refer to article [Custom installation of Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span></span>
* <span data-ttu-id="df4ca-175">Per istruzioni sulla migrazione swing per l'aggiornamento di Azure AD Connect, vedere l'articolo [Azure AD Connect: Eseguire l'aggiornamento da una versione precedente alla versione più recente](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span><span class="sxs-lookup"><span data-stu-id="df4ca-175">For instructions on swing migration for Azure AD Connect upgrade, refer to article [Azure AD Connect: Upgrade from a previous version to the latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span></span>

## <a name="next-steps"></a><span data-ttu-id="df4ca-176">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="df4ca-176">Next steps</span></span>
<span data-ttu-id="df4ca-177">Altre informazioni su [Integrazione delle identità locali con Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="df4ca-177">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
