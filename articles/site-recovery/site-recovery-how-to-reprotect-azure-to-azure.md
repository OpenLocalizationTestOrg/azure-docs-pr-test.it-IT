---
title: Come riproteggere le macchine virtuali di Azure sottoposte a failover nell'area di Azure primaria | Microsoft Docs
description: "Dopo il failover delle macchine virtuali da un'area di Azure a un'altra, è possibile utilizzare Azure Site Recovery per proteggere le macchine nella direzione inversa. Imparare i passaggi per eseguire la riprotezione prima di un failover."
services: site-recovery
documentationcenter: 
author: ruturaj
manager: gauravd
editor: 
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 08/11/2017
ms.author: ruturajd
ms.openlocfilehash: 32f5d2d142940bc515849dcd0edb1bb1f152aa6d
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/18/2017
---
# <a name="reprotect-from-failed-over-azure-region-back-to-primary-region"></a><span data-ttu-id="cc5e4-104">Eseguire la riprotezione dall'area di Azure sottoposta a failover nell'area primaria</span><span class="sxs-lookup"><span data-stu-id="cc5e4-104">Reprotect from failed over Azure region back to primary region</span></span>



>[!NOTE]
>
> <span data-ttu-id="cc5e4-105">La replica di Site Recovery per le macchine virtuali di Azure è attualmente in anteprima.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-105">Site Recovery replication for Azure virtual machines is currently in preview.</span></span>


## <a name="overview"></a><span data-ttu-id="cc5e4-106">Panoramica</span><span class="sxs-lookup"><span data-stu-id="cc5e4-106">Overview</span></span>
<span data-ttu-id="cc5e4-107">Quando si esegue il [failover](site-recovery-failover.md) delle macchine virtuali da un'area di Azure a un'altra, le macchine virtuali si trovano in uno stato non protetto.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-107">When you [failover](site-recovery-failover.md) the virtual machines from one Azure region to another, the virtual machines are in an unprotected state.</span></span> <span data-ttu-id="cc5e4-108">Se si desidera riportarle nell'area primaria, è innanzitutto necessario proteggere le macchine virtuali e sottoporle nuovamente a failover.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-108">If you want to bring them back to the primary region, you need to first protect the virtual machines and then failover again.</span></span> <span data-ttu-id="cc5e4-109">Non vi è differenza tra l'esecuzione del failover in una direzione o nell'altra.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-109">There is no difference between how you failover in one direction or other.</span></span> <span data-ttu-id="cc5e4-110">Analogamente, dopo l'abilitazione della protezione delle macchine virtuali, non vi è differenza tra la riprotezione post failover o post failback.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-110">Similarly, post enable protection of the virtual machines, there is no difference between the reprotect post failover, or post failback.</span></span>
<span data-ttu-id="cc5e4-111">Per spiegare i flussi di lavoro della riprotezione e per evitare confusione, si userà il sito primario delle macchine protette come Asia orientale e il sito di ripristino delle macchine come Asia sudorientale.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-111">To explain the workflows of reprotect, and to avoid confusion, we will use the primary site of the protected machines as East Asia region, and the recovery site of the machines as South East Asia region.</span></span> <span data-ttu-id="cc5e4-112">Durante il failover, si eseguirà il failover delle macchine virtuali nell'area Asia sudorientale.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-112">During failover, you will failover the virtual machines to the South East Asia region.</span></span> <span data-ttu-id="cc5e4-113">Prima di eseguire il failback, è necessario riproteggere le macchine virtuali dall'area Asia sudorientale all'area Asia orientale.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-113">Before you failback, you need to reprotect the virtual machines from South East Asia back to East Asia.</span></span> <span data-ttu-id="cc5e4-114">Questo articolo descrive i passaggi necessari per eseguire la riprotezione.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-114">This article describes the steps on how to reprotect.</span></span>

> [!WARNING]
> <span data-ttu-id="cc5e4-115">Se è stata [completata la migrazione](site-recovery-migrate-to-azure.md#what-do-we-mean-by-migration), la macchina virtuale è stata spostata in un altro gruppo di risorse o la macchina virtuale di Azure è stata eliminata, non è possibile eseguire il failback.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-115">If you have [completed migration](site-recovery-migrate-to-azure.md#what-do-we-mean-by-migration), moved the virtual machine to another resource group, or deleted the Azure virtual machine, you cannot failback after that.</span></span>

<span data-ttu-id="cc5e4-116">Al termine della riprotezione e dopo l'avvio della replica delle macchine virtuali protette, è possibile avviare un failover sulle macchine virtuali per riportarle nell'area Asia orientale.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-116">After reprotect finishes and the protected virtual machines are replicating, you can initiate a failover on the virtual machines to bring them back to East Asia region.</span></span>

<span data-ttu-id="cc5e4-117">Per inviare commenti o domande è possibile usare la parte inferiore di questo articolo oppure il [forum sui Servizi di ripristino di Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="cc5e4-117">Post comments or questions at the end of this article or on the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

## <a name="prerequisites"></a><span data-ttu-id="cc5e4-118">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="cc5e4-118">Prerequisites</span></span>
1. <span data-ttu-id="cc5e4-119">È necessario aver eseguito il commit delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-119">The virtual machines should have been committed.</span></span>
2. <span data-ttu-id="cc5e4-120">Il sito di destinazione, in questo caso l'area di Azure Asia orientale, deve essere disponibile e in grado di accedere/creare nuove risorse in quell'area.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-120">The target site - in this case the East Asia Azure region should be available and should be able to access/create new resources in that region.</span></span>

## <a name="steps-to-reprotect"></a><span data-ttu-id="cc5e4-121">Passaggi della riprotezione</span><span class="sxs-lookup"><span data-stu-id="cc5e4-121">Steps to reprotect</span></span>

<span data-ttu-id="cc5e4-122">Di seguito sono riportati i passaggi necessari per riproteggere una macchina virtuale usando le impostazioni predefinite.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-122">Following are the steps to reprotect a virtual machine using the defaults.</span></span>

1. <span data-ttu-id="cc5e4-123">In **Insieme di credenziali** > **Elementi replicati** fare clic con il pulsante destro del mouse sulla macchina virtuale di cui è stato eseguito il failover e scegliere **Riproteggi**.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-123">In **Vault** > **Replicated items**, right-click the virtual machine that's been failed over, and then select **Re-Protect**.</span></span> <span data-ttu-id="cc5e4-124">È anche possibile fare clic sulla macchina virtuale e selezionare **Riproteggi** dai pulsanti di comando.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-124">You can also click the machine and select **Re-Protect** from the command buttons.</span></span>

![Fare clic con il pulsante destro del mouse per riproteggere](./media/site-recovery-how-to-reprotect-azure-to-azure/reprotect.png)

2. <span data-ttu-id="cc5e4-126">Nel pannello, si noti che la direzione della protezione, **da Asia sudorientale ad Asia orientale**, è già selezionata.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-126">In the blade, notice that the direction of protection, **Southeast Asia to East asia**, is already selected.</span></span>

![Riproteggere il pannello](./media/site-recovery-how-to-reprotect-azure-to-azure/reprotectblade.png)

3. <span data-ttu-id="cc5e4-128">Rivedere le informazioni su **gruppo di risorse, rete, set di disponibilità e archiviazione** e fare clic su OK.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-128">Review the **Resource group, Network, Storage and Availability sets** information and click OK.</span></span> <span data-ttu-id="cc5e4-129">Le eventuali risorse contrassegnate (nuove) verranno create come parte della riprotezione.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-129">If there are any resources marked (new), they will be created as part of the reprotect.</span></span>

<span data-ttu-id="cc5e4-130">Verrà avviato un processo di riprotezione che eseguirà il seeding del sito di destinazione (SEA in questo caso) con i dati più recenti, e al termine, replicherà i valori delta prima di rieseguire il failover nell'area Asia sudorientale.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-130">This will trigger a job reprotect job that will first seed the target site (SEA in this case) with the latest data, and once that completes, will replicate the deltas before you failover back to Southeast Asia.</span></span>

### <a name="reprotect-customization"></a><span data-ttu-id="cc5e4-131">Personalizzazione della riprotezione</span><span class="sxs-lookup"><span data-stu-id="cc5e4-131">Reprotect customization</span></span>
<span data-ttu-id="cc5e4-132">Se si desidera scegliere l'account di archiviazione di estrazione o la rete durante la riprotezione, è possibile usare l'opzione di personalizzazione fornita nel pannello riprotezione.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-132">If you want to choose the extract storage account or the network during reprotect, you can do so using the customize option provided on the reprotect blade.</span></span>

![Opzione di personalizzazione](./media/site-recovery-how-to-reprotect-azure-to-azure/customize.png)

<span data-ttu-id="cc5e4-134">Durante la riprotezione è possibile personalizzare le proprietà seguenti della macchina virtuale di destinazione.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-134">You can customize the following properties of he target virtual machine during reprotect.</span></span>

![Personalizzare il pannello](./media/site-recovery-how-to-reprotect-azure-to-azure/customizeblade.png)

|<span data-ttu-id="cc5e4-136">Proprietà</span><span class="sxs-lookup"><span data-stu-id="cc5e4-136">Property</span></span> |<span data-ttu-id="cc5e4-137">Note</span><span class="sxs-lookup"><span data-stu-id="cc5e4-137">Notes</span></span>  |
|---------|---------|
|<span data-ttu-id="cc5e4-138">Gruppo di risorse di destinazione</span><span class="sxs-lookup"><span data-stu-id="cc5e4-138">Target resource group</span></span>     | <span data-ttu-id="cc5e4-139">È possibile scegliere di modificare il gruppo di risorse di destinazione in cui verrà creata la macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-139">You can choose to change the target resource group in which th virtual machine will be created.</span></span> <span data-ttu-id="cc5e4-140">Nell'ambito della riprotezione, la macchina virtuale di destinazione verrà eliminata, pertanto è possibile scegliere un nuovo gruppo di risorse in cui creare la macchina virtuale post failover</span><span class="sxs-lookup"><span data-stu-id="cc5e4-140">As the part of reprotect, the target virtual machine will be deleted, hence you can choose a new resource group under which you can create the VM post failover</span></span>         |
|<span data-ttu-id="cc5e4-141">Rete virtuale di destinazione</span><span class="sxs-lookup"><span data-stu-id="cc5e4-141">Target Virtual Network</span></span>     | <span data-ttu-id="cc5e4-142">La rete non può essere modificata durante la riprotezione.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-142">Network cannot be changed during the reprotect.</span></span> <span data-ttu-id="cc5e4-143">Per modificare la rete, ripetere il mapping di rete.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-143">To change the network, redo the network mapping.</span></span>         |
|<span data-ttu-id="cc5e4-144">Archiviazione di destinazione</span><span class="sxs-lookup"><span data-stu-id="cc5e4-144">Target Storage</span></span>     | <span data-ttu-id="cc5e4-145">È possibile modificare l'account di archiviazione in cui verrà creata la macchina virtuale post failover.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-145">You can change the storage account to which the virtual machine will be created post failover.</span></span>         |
|<span data-ttu-id="cc5e4-146">Archiviazione cache</span><span class="sxs-lookup"><span data-stu-id="cc5e4-146">Cache Storage</span></span>     | <span data-ttu-id="cc5e4-147">È possibile specificare un account di archiviazione cache che verrà usato durante la replica.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-147">You can specify a cache storage account which will be used during replication.</span></span> <span data-ttu-id="cc5e4-148">Se si procede con i valori predefiniti, se non esiste verrà creato un nuovo account di archiviazione cache.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-148">If you go with the defaults, a new cache storage account will be created, if it does not already exist.</span></span>         |
|<span data-ttu-id="cc5e4-149">Set di disponibilità</span><span class="sxs-lookup"><span data-stu-id="cc5e4-149">Availability Set</span></span>     |<span data-ttu-id="cc5e4-150">Se la macchina virtuale in Asia orientale fa parte di un set di disponibilità, è possibile scegliere un set di disponibilità per la macchina virtuale di destinazione in Asia sudorientale.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-150">If the virtual machine in East Asia is part of an availability set, you can choose an availability set for the target virtual machine in Southeast Asia.</span></span> <span data-ttu-id="cc5e4-151">I valori predefiniti troveranno il set di disponibilità SEA esistente e proveranno a usarlo.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-151">Defaults will find the existing SEA availability set and try to use it.</span></span> <span data-ttu-id="cc5e4-152">Durante la personalizzazione, è possibile specificare un set di disponibilità completamente nuovo.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-152">During customization, you can specify a completely new AV set.</span></span>         |


### <a name="what-happens-during-reprotect"></a><span data-ttu-id="cc5e4-153">Cosa accade durante la riprotezione?</span><span class="sxs-lookup"><span data-stu-id="cc5e4-153">What happens during reprotect?</span></span>

<span data-ttu-id="cc5e4-154">Proprio come dopo la prima azione Abilita protezione, di seguito si trovano gli elementi che vengono creati se si utilizzano le impostazioni predefinite.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-154">Just like after the first enable protection, following are the artefacts that get created if you use the defaults.</span></span>
1. <span data-ttu-id="cc5e4-155">Un account di archiviazione cache viene creato nell'area Asia orientale.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-155">A cache storage account gets created in the East Asia region.</span></span>
2. <span data-ttu-id="cc5e4-156">Se l'account di archiviazione di destinazione (l'account di archiviazione originale della macchina virtuale in Asia sudorientale) non esiste, ne viene creato uno nuovo.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-156">If the target storage account (the original storage account of the Southeast Asia VM) does not exist, a new one is created.</span></span> <span data-ttu-id="cc5e4-157">Il nome è composto dall'account di archiviazione della macchina virtuale in Asia orientale più il suffisso "asr".</span><span class="sxs-lookup"><span data-stu-id="cc5e4-157">The name is the East Asia virtual machine's storage account suffixed with "asr".</span></span>
3. <span data-ttu-id="cc5e4-158">Se il set di disponibilità di destinazione non esiste e le impostazioni predefinite rilevano che è necessario crearne uno nuovo, verrà creato durante il processo di riprotezione.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-158">If the target AV set does not exist, and the defaults detect that it needs to create a new AV set, then it will be created as part of the reprotect job.</span></span> <span data-ttu-id="cc5e4-159">Se la riprotezione è stata personalizzata, verrà usato il set di disponibilità selezionato.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-159">If you have customized the reprotect, then the selected AV set will be used.</span></span>
4.

<span data-ttu-id="cc5e4-160">Di seguito è riportato l'elenco delle azioni che si verificano quando si avvia un processo di riprotezione.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-160">The following are the list of steps that happen when you trigger a reprotect job.</span></span> <span data-ttu-id="cc5e4-161">Questo avviene nel caso in cui la macchina virtuale di destinazione esista.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-161">This is in the case the target side virtual machine exists.</span></span>

1. <span data-ttu-id="cc5e4-162">Gli elementi necessari vengono creati durante la riprotezione.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-162">The required artefacts are created as part of reprotect.</span></span> <span data-ttu-id="cc5e4-163">Se esistono già, vengono riusati.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-163">If they already exist, then they are reused.</span></span>
2. <span data-ttu-id="cc5e4-164">La macchina virtuale di destinazione (Asia sudorientale) viene prima di tutto disattivata, se è in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-164">The target side (Southeast Asia) virtual machine is first turned off, if it is running.</span></span>
3. <span data-ttu-id="cc5e4-165">Il disco della macchina virtuale di destinazione viene copiato da Azure Site Recovery in un contenitore come BLOB di inizializzazione.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-165">The target side virtual machine's disk is copied by Azure Site Recovery into a container as a seed blob.</span></span>
4. <span data-ttu-id="cc5e4-166">La macchina virtuale di destinazione viene quindi eliminata.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-166">The target side virtual machine is then deleted.</span></span>
5. <span data-ttu-id="cc5e4-167">Il BLOB di inizializzazione viene usato dalla macchina virtuale di origine (Asia orientale) per la replica.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-167">The seed blob is used by the current source side (East Asia) virtual machine to replicate.</span></span> <span data-ttu-id="cc5e4-168">In questo modo vengono replicati solo i valori delta.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-168">This ensures that only deltas are replicated.</span></span>
6. <span data-ttu-id="cc5e4-169">Le principali modifiche tra il disco di origine e il BLOB di inizializzazione vengono sincronizzate.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-169">The major changes between the source disk and the seed blob are synchronized.</span></span> <span data-ttu-id="cc5e4-170">Questa operazione può richiedere del tempo.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-170">This can take some time to complete.</span></span>
7. <span data-ttu-id="cc5e4-171">Dopo aver completato il processo di riprotezione, ha inizio la replica dei valori delta che crea un punto di ripristino in base ai criteri.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-171">Once the reprotect job completes, the delta replication begins that creates a recovery point as per the policy.</span></span>

> [!NOTE]
> <span data-ttu-id="cc5e4-172">Non è possibile eseguire la riprotezione a un livello di piano di ripristino.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-172">You cannot protect at a recovery plan level.</span></span> <span data-ttu-id="cc5e4-173">È solo possibile eseguire la riprotezione solo a un livello di macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-173">You can only reprotect at a per VM level.</span></span>

<span data-ttu-id="cc5e4-174">Dopo la riprotezione, la macchina virtuale entrerà in uno stato protetto.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-174">After the reprotect succeed, the virtual machine will enter a protected state.</span></span>

## <a name="next-steps"></a><span data-ttu-id="cc5e4-175">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="cc5e4-175">Next steps</span></span>

<span data-ttu-id="cc5e4-176">Quando la macchina virtuale si trova in uno stato protetto, è possibile avviare un failover.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-176">After the virtual machine has entered a protected state, you can initiate a failover.</span></span> <span data-ttu-id="cc5e4-177">Il failover arresterà la macchina virtuale nell'area di Azure Asia orientale, quindi creerà e avvierà la macchina virtuale dell'area Asia sudorientale.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-177">The failover will shut down the virtual machine in East Asia Azure region and then create and boot the Southeast Asia region virtual machine.</span></span> <span data-ttu-id="cc5e4-178">Ci sarà pertanto un breve tempo di inattività per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-178">Hence there is a small downtime for the application.</span></span> <span data-ttu-id="cc5e4-179">Scegliere un orario per il failover in cui l'inattività dell'applicazione non causerà conseguenze.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-179">So, choose the time for failover when your application can tolerate a downtime.</span></span> <span data-ttu-id="cc5e4-180">È consigliabile sottoporre a failover di test la macchina virtuale per assicurarsi che il processo venga eseguito correttamente, prima di avviare un failover.</span><span class="sxs-lookup"><span data-stu-id="cc5e4-180">It is recommended that you first test failover the virtual machine to make sure it is coming up correctly, before initiating a failover.</span></span>

-   [<span data-ttu-id="cc5e4-181">Passaggi per avviare il failover di test della macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="cc5e4-181">Steps to initiate test failover of the virtual machine</span></span>](site-recovery-test-failover-to-azure.md)

-   [<span data-ttu-id="cc5e4-182">Passaggi per avviare il failover della macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="cc5e4-182">Steps to initiate failover of the virtual machine</span></span>](site-recovery-failover.md)
