---
title: Backup di SAP HANA di Azure a livello di file | Documentazione Microsoft
description: Esistono due opzioni principali per il backup di SAP HANA su macchine virtuali di Azure e questo articolo descrive il backup di SAP HANA di Azure a livello di file.
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 5db0ceb1648b5afa278e1cbe1c42fce8033bfdc1
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/29/2017
---
# <a name="sap-hana-azure-backup-on-file-level"></a><span data-ttu-id="23b90-103">Backup di SAP HANA di Azure a livello di file</span><span class="sxs-lookup"><span data-stu-id="23b90-103">SAP HANA Azure Backup on file level</span></span>

## <a name="introduction"></a><span data-ttu-id="23b90-104">Introduzione</span><span class="sxs-lookup"><span data-stu-id="23b90-104">Introduction</span></span>

<span data-ttu-id="23b90-105">Questo articolo fa parte di una serie di tre articoli correlati dedicati al backup di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="23b90-106">La [Guida del backup per SAP HANA nelle macchine virtuali di Azure](./sap-hana-backup-guide.md) offre una panoramica e le informazioni su come iniziare, mentre [Backup di SAP HANA basato su snapshot di archiviazione](./sap-hana-backup-storage-snapshots.md) riguarda l'opzione di backup basato su snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="23b90-106">[Backup guide for SAP HANA on Azure Virtual Machines](./sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA backup based on storage snapshots](./sap-hana-backup-storage-snapshots.md) covers the storage snapshot-based backup option.</span></span>

<span data-ttu-id="23b90-107">Osservando le dimensioni della macchina virtuale di Azure, è possibile notare che un GS5 consente 64 dischi di dati collegati.</span><span class="sxs-lookup"><span data-stu-id="23b90-107">Looking at the Azure VM sizes, one can see that a GS5 allows 64 attached data disks.</span></span> <span data-ttu-id="23b90-108">Per sistemi SAP HANA di grandi dimensioni, un numero significativo di dischi potrebbe essere già usato per i file di log e di dati, possibilmente in combinazione con RAID software per la velocità effettiva IO ottimale dei dischi.</span><span class="sxs-lookup"><span data-stu-id="23b90-108">For large SAP HANA systems, a significant number of disks might already be taken for data and log files, possibly in combination with software RAID for optimal disk IO throughput.</span></span> <span data-ttu-id="23b90-109">La domanda è dunque dove archiviare i file di backup di SAP HANA e quali file potrebbero riempire i dischi di dati collegati col passare del tempo.</span><span class="sxs-lookup"><span data-stu-id="23b90-109">The question then is where to store SAP HANA backup files, which could fill up the attached data disks over time?</span></span> <span data-ttu-id="23b90-110">Vedere [Sizes for Linux virtual machines in Azure](../../linux/sizes.md) (Dimensioni delle macchine virtuali Linux in Azure) per le tabelle delle dimensioni della macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="23b90-110">See [Sizes for Linux virtual machines in Azure](../../linux/sizes.md) for the Azure VM size tables.</span></span>

<span data-ttu-id="23b90-111">Al momento, non è disponibile alcuna integrazione del backup di SAP HANA con il servizio di Backup di Azure.</span><span class="sxs-lookup"><span data-stu-id="23b90-111">There is no SAP HANA backup integration available with Azure Backup service at this time.</span></span> <span data-ttu-id="23b90-112">Il metodo standard per gestire il backup e il ripristino a livello di file è attraverso un backup basato su file, usando SAP HANA Studio o le istruzioni SQL SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-112">The standard way to manage backup/restore at the file level is with a file-based backup via SAP HANA Studio or via SAP HANA SQL statements.</span></span> <span data-ttu-id="23b90-113">Per altre informazioni, vedere [SAP HANA SQL and System Views Reference](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf) (Riferimento alle visualizzazioni del sistema e di SQL SAP HANA).</span><span class="sxs-lookup"><span data-stu-id="23b90-113">See [SAP HANA SQL and System Views Reference](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf) for more information.</span></span>

![Nella figura viene mostrata la finestra di dialogo della voce di menu del backup in SAP HANA Studio](media/sap-hana-backup-file-level/image022.png)

<span data-ttu-id="23b90-115">Nella figura viene mostrata la finestra di dialogo della voce di menu del backup in SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="23b90-115">This figure shows the dialog of the backup menu item in SAP HANA Studio.</span></span> <span data-ttu-id="23b90-116">Quando si sceglie il &quot;file&quot; del tipo, esso deve specificare un percorso nel file system in cui SAP HANA scrive i file di backup.</span><span class="sxs-lookup"><span data-stu-id="23b90-116">When choosing type &quot;file,&quot; one has to specify a path in the file system where SAP HANA writes the backup files.</span></span> <span data-ttu-id="23b90-117">La funzione di ripristino funziona nello stesso modo.</span><span class="sxs-lookup"><span data-stu-id="23b90-117">Restore works the same way.</span></span>

<span data-ttu-id="23b90-118">Sebbene questa scelta sia semplice e diretta, è opportuno presentare alcune considerazioni.</span><span class="sxs-lookup"><span data-stu-id="23b90-118">While this choice sounds simple and straight forward, there are some considerations.</span></span> <span data-ttu-id="23b90-119">Come accennato in precedenza, una macchina virtuale di Azure presenta una limitazione nel numero di dischi di dati che è possibile collegare.</span><span class="sxs-lookup"><span data-stu-id="23b90-119">As mentioned before, an Azure VM has a limitation of number of data disks that can be attached.</span></span> <span data-ttu-id="23b90-120">Potrebbe non essere disponibile spazio per archiviare i file di backup di SAP HANA nei file system della macchina virtuale, a seconda delle dimensioni del database e dei requisiti di velocità effettiva del disco, che potrebbe comportare che il RAID software usi lo striping su più dischi di dati.</span><span class="sxs-lookup"><span data-stu-id="23b90-120">There might not be capacity to store SAP HANA backup files on the file systems of the VM, depending on the size of the database and disk throughput requirements, which might involve software RAID using striping across multiple data disks.</span></span> <span data-ttu-id="23b90-121">Più avanti in questo articolo vengono fornite varie opzioni per lo spostamento di questi file di backup e per la gestione delle limitazioni relative alle dimensioni dei file e delle prestazioni durante la gestione di terabyte di dati.</span><span class="sxs-lookup"><span data-stu-id="23b90-121">Various options for moving these backup files, and managing file size restrictions and performance when handling terabytes of data, are provided later in this article.</span></span>

<span data-ttu-id="23b90-122">Un'altra opzione, che offre più libertà in relazione alla capacità totale, è l'Archiviazione BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="23b90-122">Another option, which offers more freedom regarding total capacity, is Azure blob storage.</span></span> <span data-ttu-id="23b90-123">Mentre un singolo BLOB è limitato a 1 TB, la capacità totale di un singolo contenitore di BLOB è attualmente pari a 500 TB.</span><span class="sxs-lookup"><span data-stu-id="23b90-123">While a single blob is also restricted to 1 TB, the total capacity of a single blob container is currently 500 TB.</span></span> <span data-ttu-id="23b90-124">In aggiunta, questa opzione offre ai clienti la possibilità di selezionare la cosiddetta archiviazione BLOB ad &quot;accesso sporadico&quot;, che presenta vantaggi sui costi.</span><span class="sxs-lookup"><span data-stu-id="23b90-124">Additionally, it gives customers the choice to select so-called &quot;cool&quot; blob storage, which has a cost benefit.</span></span> <span data-ttu-id="23b90-125">Vedere [Archivio BLOB di Azure: livelli di archiviazione ad accesso frequente e sporadico](../../../storage/blobs/storage-blob-storage-tiers.md) per altre informazioni sull'archiviazione BLOB ad accesso sporadico.</span><span class="sxs-lookup"><span data-stu-id="23b90-125">See [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md) for details about cool blob storage.</span></span>

<span data-ttu-id="23b90-126">Per una maggiore sicurezza, usare un account di archiviazione con replica geografica per archiviare i backup di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-126">For additional safety, use a geo-replicated storage account to store the SAP HANA backups.</span></span> <span data-ttu-id="23b90-127">Per dettagli sulla replica dell'account di archiviazione, vedere [Replica di Archiviazione di Azure](../../../storage/common/storage-redundancy.md).</span><span class="sxs-lookup"><span data-stu-id="23b90-127">See [Azure Storage replication](../../../storage/common/storage-redundancy.md) for details about storage account replication.</span></span>

<span data-ttu-id="23b90-128">È possibile posizionare dischi rigidi virtuali dedicati per i backup di SAP HANA in un account di archiviazione di backup apposito con replica geografica.</span><span class="sxs-lookup"><span data-stu-id="23b90-128">One could place dedicated VHDs for SAP HANA backups in a dedicated backup storage account that is geo-replicated.</span></span> <span data-ttu-id="23b90-129">È anche possibile copiare i dischi rigidi virtuali che mantengono i backup di SAP HANA in un account di archiviazione con replica geografica o in un account di archiviazione in un'area diversa.</span><span class="sxs-lookup"><span data-stu-id="23b90-129">Or else one could copy the VHDs that keep the SAP HANA backups to a geo-replicated storage account, or to a storage account that is in a different region.</span></span>

## <a name="azure-backup-agent"></a><span data-ttu-id="23b90-130">Agente di Backup di Azure</span><span class="sxs-lookup"><span data-stu-id="23b90-130">Azure backup agent</span></span>

<span data-ttu-id="23b90-131">Backup di Azure offre la possibilità di non eseguire solo il backup di macchine virtuali complete, ma anche di file e directory tramite l'agente di backup, che deve essere installato nel sistema operativo guest.</span><span class="sxs-lookup"><span data-stu-id="23b90-131">Azure backup offers the option to not only back up complete VMs, but also files and directories via the backup agent, which has to be installed on the guest OS.</span></span> <span data-ttu-id="23b90-132">Da dicembre 2016, l'agente è supportato solo in Windows (vedere [Eseguire il backup di un client o server Windows in Azure con Backup di Azure usando il modello di distribuzione Resource Manager](../../../backup/backup-configure-vault.md)).</span><span class="sxs-lookup"><span data-stu-id="23b90-132">But as of December 2016, this agent is only supported on Windows (see [Back up a Windows Server or client to Azure using the Resource Manager deployment model](../../../backup/backup-configure-vault.md)).</span></span>

<span data-ttu-id="23b90-133">Una soluzione alternativa consiste innanzitutto nel copiare i file di backup di SAP HANA in una macchina virtuale di Windows in Azure, ad esempio, tramite una condivisione SAMBA, e quindi usare l'agente di backup di Azure da questa posizione.</span><span class="sxs-lookup"><span data-stu-id="23b90-133">A workaround is to first copy SAP HANA backup files to a Windows VM on Azure (for example, via SAMBA share) and then use the Azure backup agent from there.</span></span> <span data-ttu-id="23b90-134">Sebbene sia tecnicamente possibile, questa operazione potrebbe aggiungere complessità e rallentare il processo di backup o di ripristino a causa della copia tra Linux e la macchina virtuale di Windows.</span><span class="sxs-lookup"><span data-stu-id="23b90-134">While it is technically possible, it would add complexity and slow down the backup or restore process quite a bit due to the copy between the Linux and the Windows VM.</span></span> <span data-ttu-id="23b90-135">Non è consigliabile seguire questo approccio.</span><span class="sxs-lookup"><span data-stu-id="23b90-135">It is not recommended to follow this approach.</span></span>

## <a name="azure-blobxfer-utility-details"></a><span data-ttu-id="23b90-136">Dettagli sull'utilità di blobxfer di Azure</span><span class="sxs-lookup"><span data-stu-id="23b90-136">Azure blobxfer utility details</span></span>

<span data-ttu-id="23b90-137">Per archiviare le directory e i file in archiviazione di Azure, è possibile usare PowerShell, l'interfaccia della riga di comando o sviluppare uno strumento usando uno degli [SDK di Azure](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="23b90-137">To store directories and files on Azure storage, one could use CLI or PowerShell, or develop a tool using one of the [Azure SDKs](https://azure.microsoft.com/downloads/).</span></span> <span data-ttu-id="23b90-138">È anche disponibile un'utilità pronta all'uso, AzCopy, che consente di copiare i dati nell'archiviazione di Azure, ma è dedicata esclusivamente a Windows (vedere [Trasferire dati con l'utilità della riga di comando AzCopy](../../../storage/common/storage-use-azcopy.md)).</span><span class="sxs-lookup"><span data-stu-id="23b90-138">There is also a ready-to-use utility, AzCopy, for copying data to Azure storage, but it is Windows only (see [Transfer data with the AzCopy Command-Line Utility](../../../storage/common/storage-use-azcopy.md)).</span></span>

<span data-ttu-id="23b90-139">Blobxfer è stato pertanto usato per la copia dei file di backup di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-139">Therefore blobxfer was used for copying SAP HANA backup files.</span></span> <span data-ttu-id="23b90-140">Si tratta di una risorsa open source, usata da molti clienti negli ambienti di produzione e disponibile su [GitHub](https://github.com/Azure/blobxfer).</span><span class="sxs-lookup"><span data-stu-id="23b90-140">It is open source, used by many customers in production environments, and available on [GitHub](https://github.com/Azure/blobxfer).</span></span> <span data-ttu-id="23b90-141">Questo strumento consente di copiare i dati direttamente nell'archiviazione BLOB di Azure o nella condivisione file di Azure.</span><span class="sxs-lookup"><span data-stu-id="23b90-141">This tool allows one to copy data directly to either Azure blob storage or Azure file share.</span></span> <span data-ttu-id="23b90-142">Offre anche una gamma di funzionalità utili, ad esempio hash md5 o parallelismo automatico durante la copia di una directory con più file.</span><span class="sxs-lookup"><span data-stu-id="23b90-142">It also offers a range of useful features, like md5 hash or automatic parallelism when copying a directory with multiple files.</span></span>

## <a name="sap-hana-backup-performance"></a><span data-ttu-id="23b90-143">Prestazioni del backup SAP HANA</span><span class="sxs-lookup"><span data-stu-id="23b90-143">SAP HANA backup performance</span></span>

![Questa schermata appartiene alla console di backup di SAP HANA in SAP HANA Studio](media/sap-hana-backup-file-level/image023.png)

<span data-ttu-id="23b90-145">Questa schermata appartiene alla console di backup di SAP HANA in SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="23b90-145">This screenshot is of the SAP HANA backup console in SAP HANA Studio.</span></span> <span data-ttu-id="23b90-146">Per eseguire il backup di 230 GB in un disco singolo di archiviazione di Azure standard collegato alla macchina virtuale HANA usando file system XFS sono necessari circa 42 minuti.</span><span class="sxs-lookup"><span data-stu-id="23b90-146">It took about 42 minutes to do the backup of the 230 GB on a single Azure standard storage disk attached to the HANA VM using XFS file system.</span></span>

![Questa schermata è tratta da YaST nella macchina virtuale di test di SAP HANA](media/sap-hana-backup-file-level/image024.png)

<span data-ttu-id="23b90-148">Questa schermata è tratta da YaST nella macchina virtuale di test di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-148">This screenshot is of YaST on the SAP HANA test VM.</span></span> <span data-ttu-id="23b90-149">Come accennato in precedenza, si può osservare il disco singolo da 1 TB per il backup di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-149">One can see the 1-TB single disk for SAP HANA backup as mentioned before.</span></span> <span data-ttu-id="23b90-150">Per il backup di 230 GB sono necessari 42 minuti.</span><span class="sxs-lookup"><span data-stu-id="23b90-150">It took about 42 minutes to backup 230 GB.</span></span> <span data-ttu-id="23b90-151">Sono stati anche associati cinque dischi da 200 GB ed è stato creato il RAID software md0 RAID, con striping su questi cinque dischi di dati di Azure.</span><span class="sxs-lookup"><span data-stu-id="23b90-151">In addition, five 200-GB disks were attached and software RAID md0 created, with striping on top of these five Azure data disks.</span></span>

![Ripetere lo stesso backup sul RAID software con striping in cinque dischi di dati di archiviazione standard di Azure collegati](media/sap-hana-backup-file-level/image025.png)

<span data-ttu-id="23b90-153">Ripetere lo stesso RAID software di backup con striping in cinque dischi di dati di archiviazione standard di Azure collegati riduce il tempo necessario per il backup da 42 a 10 minuti.</span><span class="sxs-lookup"><span data-stu-id="23b90-153">Repeating the same backup on software RAID with striping across five attached Azure standard storage data disks brought the backup time from 42 minutes down to 10 minutes.</span></span> <span data-ttu-id="23b90-154">I dischi sono stati collegati senza la memorizzazione nella cache della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="23b90-154">The disks were attached without caching to the VM.</span></span> <span data-ttu-id="23b90-155">È ovvio quanto sia importante la velocità effettiva di scrittura sul disco per il tempo del backup.</span><span class="sxs-lookup"><span data-stu-id="23b90-155">So it is obvious how important disk write throughput is for the backup time.</span></span> <span data-ttu-id="23b90-156">Si potrebbe quindi passare al servizio di archiviazione premium di Azure per accelerare ulteriormente il processo per prestazioni ottimali.</span><span class="sxs-lookup"><span data-stu-id="23b90-156">One could then switch to Azure premium storage to further accelerate the process for optimal performance.</span></span> <span data-ttu-id="23b90-157">In generale, l'Archiviazione Premium di Azure deve essere usata per i sistemi di produzione.</span><span class="sxs-lookup"><span data-stu-id="23b90-157">In general, Azure premium storage should be used for production systems.</span></span>

## <a name="copy-sap-hana-backup-files-to-azure-blob-storage"></a><span data-ttu-id="23b90-158">Copiare i file di backup di SAP HANA in Archiviazione BLOB di Azure</span><span class="sxs-lookup"><span data-stu-id="23b90-158">Copy SAP HANA backup files to Azure blob storage</span></span>

<span data-ttu-id="23b90-159">A partire da dicembre 2016, l'opzione migliore per archiviare rapidamente i file di backup di SAP HANA è Archiviazione BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="23b90-159">As of December 2016, the best option to quickly store SAP HANA backup files is Azure blob storage.</span></span> <span data-ttu-id="23b90-160">Un contenitore di BLOB singolo ha un limite di 500 TB, sufficiente per la maggior parte dei sistemi SAP HANA in esecuzione in una macchina virtuale GS5 in Azure, per mantenere un numero di backup di SAP HANA sufficiente.</span><span class="sxs-lookup"><span data-stu-id="23b90-160">One single blob container has a limit of 500 TB, enough for most SAP HANA systems, running in a GS5 VM on Azure, to keep sufficient SAP HANA backups.</span></span> <span data-ttu-id="23b90-161">I clienti possono scegliere tra Archiviazione BLOB &quot;ad accesso frequente&quot; e &quot;ad accesso sporadico&quot; (vedere [Archivio BLOB di Azure: livelli di archiviazione ad accesso frequente e sporadico](../../../storage/blobs/storage-blob-storage-tiers.md)).</span><span class="sxs-lookup"><span data-stu-id="23b90-161">Customers have the choice between &quot;hot&quot; and &quot;cold&quot; blob storage (see [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md)).</span></span>

<span data-ttu-id="23b90-162">Con lo strumento blobxfer, è semplice copiare i file di backup di SAP HANA direttamente nell'Archiviazione BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="23b90-162">With the blobxfer tool, it is easy to copy the SAP HANA backup files directly to Azure blob storage.</span></span>

![In questo caso si possono osservare i file di un backup completo di file SAP HANA](media/sap-hana-backup-file-level/image026.png)

<span data-ttu-id="23b90-164">In questo caso si possono osservare i file di un backup completo di file SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-164">Here one can see the files of a full SAP HANA file backup.</span></span> <span data-ttu-id="23b90-165">Esistono quattro file e il più grande ha una dimensione approssimativa di 230 GB.</span><span class="sxs-lookup"><span data-stu-id="23b90-165">There are four files and the biggest one has roughly 230 GB.</span></span>

![La copia di 230 GB in un contenitore di BLOB dell'account di archiviazione standard di Azure ha richiesto circa 3000 secondi](media/sap-hana-backup-file-level/image027.png)

<span data-ttu-id="23b90-167">Non usando l'hash md5 nel test iniziale, la copia di 230 GB in un contenitore di BLOB dell'account di archiviazione standard di Azure ha richiesto circa 3000 secondi.</span><span class="sxs-lookup"><span data-stu-id="23b90-167">Not using md5 hash in the initial test, it took roughly 3000 seconds to copy the 230 GB to an Azure standard storage account blob container.</span></span>

![In questa schermata si può osservare come viene visualizzato nel portale di Azure](media/sap-hana-backup-file-level/image028.png)

<span data-ttu-id="23b90-169">In questa schermata si può osservare come viene visualizzato nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="23b90-169">In this screenshot, one can see how it looks on the Azure portal.</span></span> <span data-ttu-id="23b90-170">È stato creato un contenitore BLOB denominato &quot;sap-hana-backups&quot; contenente i quattro BLOB che rappresentano i file di backup di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-170">A blob container named &quot;sap-hana-backups&quot; was created and includes the four blobs, which represent the SAP HANA backup files.</span></span> <span data-ttu-id="23b90-171">Uno di essi ha una dimensione di circa 230 GB.</span><span class="sxs-lookup"><span data-stu-id="23b90-171">One of them has a size of roughly 230 GB.</span></span>

<span data-ttu-id="23b90-172">La console di backup HANA Studio consente di limitare la dimensione massima dei file di backup di HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-172">The HANA Studio backup console allows one to restrict the max file size of HANA backup files.</span></span> <span data-ttu-id="23b90-173">Nell'ambiente di esempio sono state migliorate le prestazioni rendendo possibile disporre di più file di backup più piccoli, invece di un file grande di 230 GB.</span><span class="sxs-lookup"><span data-stu-id="23b90-173">In the sample environment, it improved performance by making it possible to have multiple smaller backup files, instead of one large 230-GB file.</span></span>

![L'impostazione del limite sulla dimensione del file di backup sul lato HANA non migliora il tempo del backup](media/sap-hana-backup-file-level/image029.png)

<span data-ttu-id="23b90-175">L'impostazione del limite sulla dimensione del file di backup sul lato HANA non migliora il tempo del backup, perché i file vengono scritti in modo sequenziale, come illustrato nella figura seguente.</span><span class="sxs-lookup"><span data-stu-id="23b90-175">Setting the backup file size limit on the HANA side doesn&#39;t improve the backup time, because the files are written sequentially as shown in this figure.</span></span> <span data-ttu-id="23b90-176">Il limite sulla dimensione del file è stato impostato su 60 GB, pertanto il backup ha creato quattro file di dati di grandi dimensioni invece del singolo file da 230 GB.</span><span class="sxs-lookup"><span data-stu-id="23b90-176">The file size limit was set to 60 GB, so the backup created four large data files instead of the 230-GB single file.</span></span>

![Per testare il parallelismo dello strumento blobxfer, la dimensione massima del file per i backup HANA è stata quindi impostata su 15 GB](media/sap-hana-backup-file-level/image030.png)

<span data-ttu-id="23b90-178">Per testare il parallelismo dello strumento blobxfer, la dimensione massima del file per i backup HANA è stata quindi impostata su 15 GB, con la conseguente creazione di 19 file di backup.</span><span class="sxs-lookup"><span data-stu-id="23b90-178">To test parallelism of the blobxfer tool, the max file size for HANA backups was then set to 15 GB, which resulted in 19 backup files.</span></span> <span data-ttu-id="23b90-179">Questa configurazione ha consentito al blobxfer di copiare 230 GB di Archiviazione BLOB di Azure non più in 3000 secondi, ma in 875 secondi.</span><span class="sxs-lookup"><span data-stu-id="23b90-179">This configuration brought the time for blobxfer to copy the 230 GB to Azure blob storage from 3000 seconds down to 875 seconds.</span></span>

<span data-ttu-id="23b90-180">Il risultato è dovuto al limite di 60 MB/sec per la scrittura di un BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="23b90-180">This result is due to the limit of 60 MB/sec for writing an Azure blob.</span></span> <span data-ttu-id="23b90-181">Il parallelismo tramite più BLOB consente di risolvere il problema, ma con uno svantaggio: migliorare le prestazioni dello strumento blobxfer per copiare tutti i file di backup HANA in Archiviazione BLOB di Azure aumenta il carico sulle macchine virtuali e sulla rete HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-181">Parallelism via multiple blobs solves the bottleneck, but there is a downside: increasing performance of the blobxfer tool to copy all these HANA backup files to Azure blob storage puts load on both the HANA VM and the network.</span></span> <span data-ttu-id="23b90-182">Ne è interessato il funzionamento del sistema HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-182">Operation of HANA system becomes impacted.</span></span>

## <a name="blob-copy-of-dedicated-azure-data-disks-in-backup-software-raid"></a><span data-ttu-id="23b90-183">Copia di BLOB dei dischi di dati di Azure dedicati nel RAID software di backup</span><span class="sxs-lookup"><span data-stu-id="23b90-183">Blob copy of dedicated Azure data disks in backup software RAID</span></span>

<span data-ttu-id="23b90-184">A differenza del backup manuale sul disco di dati della macchina virtuale, in questo caso non si esegue il backup di tutti i dischi di dati in una macchina virtuale per salvare l'intera installazione di SAP, compresi i dati HANA, i file di log di HANA e i file di configurazione.</span><span class="sxs-lookup"><span data-stu-id="23b90-184">Unlike the manual VM data disk backup, in this approach one does not back up all the data disks on a VM to save the whole SAP installation, including HANA data, HANA log files, and config files.</span></span> <span data-ttu-id="23b90-185">Al contrario, l'idea è quella di avere un RAID software dedicato con striping tra più dischi rigidi virtuali dei dati di Azure per archiviare un backup completo dei file SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-185">Instead, the idea is to have dedicated software RAID with striping across multiple Azure data VHDs for storing a full SAP HANA file backup.</span></span> <span data-ttu-id="23b90-186">Vengono copiati solo questi dischi contenenti il backup di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-186">One copies only these disks, which have the SAP HANA backup.</span></span> <span data-ttu-id="23b90-187">Questi possono facilmente essere conservati in un account di archiviazione del backup HANA dedicato oppure collegati a una &quot;macchina virtuale di gestione del backup&quot; dedicata per elaborazioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="23b90-187">They could easily be kept in a dedicated HANA backup storage account, or attached to a dedicated &quot;backup management VM&quot; for further processing.</span></span>

![Sono stati copiati tutti i dischi rigidi virtuali coinvolti usando il comando PowerShell **start-azurestorageblobcopy**](media/sap-hana-backup-file-level/image031.png)

<span data-ttu-id="23b90-189">Dopo aver completato il backup per il RAID software locale, tutti i dischi rigidi virtuali coinvolti sono stati copiati tramite il comando di PowerShell **start-azurestorageblobcopy** (vedere [Start-AzureStorageBlobCopy](/powershell/module/azure.storage/start-azurestorageblobcopy)).</span><span class="sxs-lookup"><span data-stu-id="23b90-189">After the backup to the local software RAID was completed, all VHDs involved were copied using the **start-azurestorageblobcopy** PowerShell command (see [Start-AzureStorageBlobCopy](/powershell/module/azure.storage/start-azurestorageblobcopy)).</span></span> <span data-ttu-id="23b90-190">Poiché la conservazione dei file di backup influisce solo sul file system dedicato, non ci sono dubbi sulla coerenza dei file di dati e log SAP HANA sul disco.</span><span class="sxs-lookup"><span data-stu-id="23b90-190">As it only affects the dedicated file system for keeping the backup files, there are no concerns about SAP HANA data or log file consistency on the disk.</span></span> <span data-ttu-id="23b90-191">Un vantaggio di questo comando consiste nel fatto che funziona anche mentre la macchina virtuale è online.</span><span class="sxs-lookup"><span data-stu-id="23b90-191">A benefit of this command is that it works while the VM stays online.</span></span> <span data-ttu-id="23b90-192">Per essere certi che nessun processo scriva al set di striping di backup, assicurarsi di disinstallarlo prima della copia di BLOB e di installarlo nuovamente in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="23b90-192">To be certain that no process writes to the backup stripe set, be sure to unmount it before the blob copy, and mount it again afterwards.</span></span> <span data-ttu-id="23b90-193">In alternativa, è possibile usare un modo appropriato per &quot;bloccare&quot; il file system.</span><span class="sxs-lookup"><span data-stu-id="23b90-193">Or one could use an appropriate way to &quot;freeze&quot; the file system.</span></span> <span data-ttu-id="23b90-194">Ad esempio, tramite xfs\_freeze per il file system XFS.</span><span class="sxs-lookup"><span data-stu-id="23b90-194">For example, via xfs\_freeze for the XFS file system.</span></span>

![La schermata mostra l'elenco di BLOB nel contenitore di dischi rigidi virtuali nel portale di Azure](media/sap-hana-backup-file-level/image032.png)

<span data-ttu-id="23b90-196">La schermata mostra l'elenco di BLOB nel contenitore di &quot;dischi rigidi virtuali&quot; nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="23b90-196">This screenshot shows the list of blobs in the &quot;vhds&quot; container on the Azure portal.</span></span> <span data-ttu-id="23b90-197">La schermata mostra i cinque dischi rigidi virtuali che sono stati collegati alla macchina virtuale del server SAP HANA come RAID software per conservare i file di backup di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-197">The screenshot shows the five VHDs, which were attached to the SAP HANA server VM to serve as the software RAID to keep SAP HANA backup files.</span></span> <span data-ttu-id="23b90-198">Descrive anche le cinque copie che acquisite tramite il comando di copia del BLOB.</span><span class="sxs-lookup"><span data-stu-id="23b90-198">It also shows the five copies, which were taken via the blob copy command.</span></span>

![A scopo di test, le copie dei dischi del RAID software di backup di SAP HANA sono state collegate alla macchina virtuale del server dell'app](media/sap-hana-backup-file-level/image033.png)

<span data-ttu-id="23b90-200">A scopo di test, le copie dei dischi del RAID software di backup di SAP HANA sono state collegate alla macchina virtuale del server dell'app.</span><span class="sxs-lookup"><span data-stu-id="23b90-200">For testing purposes, the copies of the SAP HANA backup software RAID disks were attached to the app server VM.</span></span>

![La macchina virtuale del server dell'app è stata arrestata per collegare le copie del disco](media/sap-hana-backup-file-level/image034.png)

<span data-ttu-id="23b90-202">La macchina virtuale del server dell'app è stata arrestata per collegare le copie del disco.</span><span class="sxs-lookup"><span data-stu-id="23b90-202">The app server VM was shut down to attach the disk copies.</span></span> <span data-ttu-id="23b90-203">Dopo l'avvio della macchina virtuale, i dischi e i RAID sono stati rilevati correttamente (montati tramite UUID).</span><span class="sxs-lookup"><span data-stu-id="23b90-203">After starting the VM, the disks and the RAID were discovered correctly (mounted via UUID).</span></span> <span data-ttu-id="23b90-204">Mancava solo il punto di montaggio, che è stato creato tramite il partitioner YaST.</span><span class="sxs-lookup"><span data-stu-id="23b90-204">Only the mount point was missing, which was created via the YaST partitioner.</span></span> <span data-ttu-id="23b90-205">In un secondo momento le copie dei file di backup di SAP HANA sono diventate visibili a livello di sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="23b90-205">Afterwards the SAP HANA backup file copies became visible on OS level.</span></span>

## <a name="copy-sap-hana-backup-files-to-nfs-share"></a><span data-ttu-id="23b90-206">Copiare i file di backup di SAP HANA in condivisione NFS</span><span class="sxs-lookup"><span data-stu-id="23b90-206">Copy SAP HANA backup files to NFS share</span></span>

<span data-ttu-id="23b90-207">Per ridurre il potenziale impatto sul sistema SAP HANA in termini di prestazioni o di spazio su disco, è possibile archiviare i file di backup di SAP HANA in una condivisione NFS.</span><span class="sxs-lookup"><span data-stu-id="23b90-207">To lessen the potential impact on the SAP HANA system from a performance or disk space perspective, one might consider storing the SAP HANA backup files on an NFS share.</span></span> <span data-ttu-id="23b90-208">Tecnicamente questa operazione funziona, ma significa usare una seconda macchina virtuale di Azure come host della condivisione NFS.</span><span class="sxs-lookup"><span data-stu-id="23b90-208">Technically it works, but it means using a second Azure VM as the host of the NFS share.</span></span> <span data-ttu-id="23b90-209">Non deve essere una macchina virtuale di dimensioni ridotte, a causa della larghezza di banda della rete della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="23b90-209">It should not be a small VM size, due to the VM network bandwidth.</span></span> <span data-ttu-id="23b90-210">Sarebbe dunque utile arrestare questa &quot;macchina virtuale di backup&quot; e riavviarla solo per l'esecuzione del backup di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-210">It would make sense then to shut down this &quot;backup VM&quot; and only bring it up for executing the SAP HANA backup.</span></span> <span data-ttu-id="23b90-211">La scrittura in una condivisione NFS sovraccarica la rete e ha un impatto sul sistema SAP HANA, ma la semplice gestione dei file di backup in un secondo momento sulla &quot;macchina virtuale di backup&quot; non influenza affatto il sistema SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-211">Writing on an NFS share puts load on the network and impacts the SAP HANA system, but merely managing the backup files afterwards on the &quot;backup VM&quot; would not influence the SAP HANA system at all.</span></span>

![Una condivisione NFS da un'altra macchina virtuale di Azure è stata montata sulla macchina virtuale del server SAP HANA](media/sap-hana-backup-file-level/image035.png)

<span data-ttu-id="23b90-213">Per verificare il caso dell'uso di NFS, una condivisione NFS da un'altra macchina virtuale di Azure è stata montata sulla macchina virtuale del server SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-213">To verify the NFS use case, an NFS share from another Azure VM was mounted to the SAP HANA server VM.</span></span> <span data-ttu-id="23b90-214">Non è stata applicata alcuna ottimizzazione NFS particolare.</span><span class="sxs-lookup"><span data-stu-id="23b90-214">There was no special NFS tuning applied.</span></span>

![Il backup diretto ha richiesto 1 ora e 46 minuti.](media/sap-hana-backup-file-level/image036.png)

<span data-ttu-id="23b90-216">La condivisione NFS era un set di striping veloce, come quella nel server SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="23b90-216">The NFS share was a fast stripe set, like the one on the SAP HANA server.</span></span> <span data-ttu-id="23b90-217">Tuttavia, il backup diretto sulla condivisione NFS ha richiesto 1 ora e 46 minuti invece dei 10 minuti necessari per scrivere in un set di striping locale.</span><span class="sxs-lookup"><span data-stu-id="23b90-217">Nevertheless, it took 1 hour and 46 minutes to do the backup directly on the NFS share instead of 10 minutes, when writing to a local stripe set.</span></span>

![L'alternativa non è stata molto più rapida e ha impiegato 1 ora e 43 minuti.](media/sap-hana-backup-file-level/image037.png)

<span data-ttu-id="23b90-219">L'alternativa di eseguire un backup in un set di striping locale e di copiarlo nella condivisione NFS a livello di sistema operativo (un semplice comando **cp - avr**) non è stata molto più rapida.</span><span class="sxs-lookup"><span data-stu-id="23b90-219">The alternative of doing a backup to a local stripe set and copying to the NFS share on OS level (a simple **cp -avr** command) wasn't much quicker.</span></span> <span data-ttu-id="23b90-220">Ha impiegato 1 ora e 43 minuti.</span><span class="sxs-lookup"><span data-stu-id="23b90-220">It took 1 hour and 43 minutes.</span></span>

<span data-ttu-id="23b90-221">Funziona, ma le prestazioni non sono state buone per il test di backup di 230 GB.</span><span class="sxs-lookup"><span data-stu-id="23b90-221">So it works, but performance wasn't good for the 230-GB backup test.</span></span> <span data-ttu-id="23b90-222">La situazione dovrebbe essere ancora più grave per più terabyte.</span><span class="sxs-lookup"><span data-stu-id="23b90-222">It would look even worse for multi terabytes.</span></span>

## <a name="copy-sap-hana-backup-files-to-azure-file-service"></a><span data-ttu-id="23b90-223">Copiare i file di backup di SAP HANA nel Servizio file di Azure</span><span class="sxs-lookup"><span data-stu-id="23b90-223">Copy SAP HANA backup files to Azure file service</span></span>

<span data-ttu-id="23b90-224">È possibile montare una condivisione di file di Azure all'interno di una macchina virtuale Linux di Azure.</span><span class="sxs-lookup"><span data-stu-id="23b90-224">It is possible to mount an Azure file share inside an Azure Linux VM.</span></span> <span data-ttu-id="23b90-225">L'articolo [Come usare l'archiviazione file di Azure con Linux](../../../storage/files/storage-how-to-use-files-linux.md) descrive l'uso in dettaglio.</span><span class="sxs-lookup"><span data-stu-id="23b90-225">The article [How to use Azure File storage with Linux](../../../storage/files/storage-how-to-use-files-linux.md) provides details on how to do it.</span></span> <span data-ttu-id="23b90-226">Tenere presente che esiste attualmente un limite di quota di 5 TB di una condivisione di file di Azure e un limite di dimensione del file di 1 TB per ogni file.</span><span class="sxs-lookup"><span data-stu-id="23b90-226">Keep in mind that there is currently a 5-TB quota limit of one Azure file share, and a file size limit of 1 TB per file.</span></span> <span data-ttu-id="23b90-227">Per altre informazioni sui limiti di archiviazione, vedere [Obiettivi di scalabilità e prestazioni per Archiviazione di Azure](../../../storage/common/storage-scalability-targets.md).</span><span class="sxs-lookup"><span data-stu-id="23b90-227">See [Azure Storage Scalability and Performance Targets](../../../storage/common/storage-scalability-targets.md) for information on storage limits.</span></span>

<span data-ttu-id="23b90-228">I test hanno dimostrato, tuttavia, che il backup di SAP HANA non funziona direttamente con questo tipo di montaggio CIFS.</span><span class="sxs-lookup"><span data-stu-id="23b90-228">Tests have shown, however, that SAP HANA backup doesn&#39;t currently work directly with this kind of CIFS mount.</span></span> <span data-ttu-id="23b90-229">Nella [Nota SAP 1820529](https://launchpad.support.sap.com/#/notes/1820529) si dichiara anche che il CIFS non è consigliato.</span><span class="sxs-lookup"><span data-stu-id="23b90-229">It is also stated in [SAP Note 1820529](https://launchpad.support.sap.com/#/notes/1820529) that CIFS is not recommended.</span></span>

![In questa figura è mostrato un errore nella finestra di dialogo del backup in SAP HANA Studio](media/sap-hana-backup-file-level/image038.png)

<span data-ttu-id="23b90-231">In questa figura è mostrato un errore nella finestra di dialogo del backup in SAP HANA Studio, quando si tenta di eseguire il backup direttamente in una condivisione di file di Azure montata su CIFS.</span><span class="sxs-lookup"><span data-stu-id="23b90-231">This figure shows an error in the backup dialog in SAP HANA Studio, when trying to back up directly to a CIFS-mounted Azure file share.</span></span> <span data-ttu-id="23b90-232">Pertanto, è necessario innanzitutto eseguire un backup standard di SAP HANA in un file system della macchina virtuale e quindi copiare i file di backup da questa posizione nel servizio file di Azure.</span><span class="sxs-lookup"><span data-stu-id="23b90-232">So one has to do a standard SAP HANA backup into a VM file system first, and then copy the backup files from there to Azure file service.</span></span>

![La figura seguente mostra che sono stati necessari circa 929 secondi per copiare 19 file di backup SAP HANA](media/sap-hana-backup-file-level/image039.png)

<span data-ttu-id="23b90-234">La figura seguente mostra che sono stati necessari circa 929 secondi per copiare 19 file di backup SAP HANA con una dimensione totale di circa 230 GB nella condivisione di file di Azure.</span><span class="sxs-lookup"><span data-stu-id="23b90-234">This figure shows that it took about 929 seconds to copy 19 SAP HANA backup files with a total size of roughly 230 GB to the Azure file share.</span></span>

![La struttura della directory di origine nella macchina virtuale SAP HANA è stata copiata nella condivisione di file di Azure](media/sap-hana-backup-file-level/image040.png)

<span data-ttu-id="23b90-236">In questa schermata si può osservare che la struttura della directory di origine nella macchina virtuale SAP HANA è stata copiata nella condivisione di file di Azure: una directory (hana\_backup\_fsl\_15 gb) e 19 singoli file di backup.</span><span class="sxs-lookup"><span data-stu-id="23b90-236">In this screenshot, one can see that the source directory structure on the SAP HANA VM was copied to the Azure file share: one directory (hana\_backup\_fsl\_15gb) and 19 individual backup files.</span></span>

<span data-ttu-id="23b90-237">Archiviare i file di backup di SAP HANA nei file di Azure può rappresentare un'opzione interessante in futuro, quando i backup dei file di SAP HANA supporteranno direttamente questa archiviazione.</span><span class="sxs-lookup"><span data-stu-id="23b90-237">Storing SAP HANA backup files on Azure files could be an interesting option in the future when SAP HANA file backups support it directly.</span></span> <span data-ttu-id="23b90-238">oppure quando sarà possibile montare i file di Azure tramite NFS e il limite massimo di quota sarà nettamente superiore a 5 TB.</span><span class="sxs-lookup"><span data-stu-id="23b90-238">Or when it becomes possible to mount Azure files via NFS and the maximum quota limit is considerably higher than 5 TB.</span></span>

## <a name="next-steps"></a><span data-ttu-id="23b90-239">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="23b90-239">Next steps</span></span>
* <span data-ttu-id="23b90-240">La [Guida del backup di SAP HANA in Macchine virtuali di Azure](sap-hana-backup-guide.md) offre una panoramica e informazioni introduttive.</span><span class="sxs-lookup"><span data-stu-id="23b90-240">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="23b90-241">[Backup di SAP HANA basato su snapshot di archiviazione](sap-hana-backup-storage-snapshots.md) descrive l'opzione di backup basato su snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="23b90-241">[SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md) describes the storage snapshot-based backup option.</span></span>
* <span data-ttu-id="23b90-242">Per informazioni su come stabilire la disponibilità elevata e un piano di ripristino di emergenza di SAP HANA in Azure (istanze di grandi dimensioni), vedere [Disponibilità elevata e ripristino di emergenza di SAP HANA (istanze di grandi dimensioni) in Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="23b90-242">To learn how to establish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>
