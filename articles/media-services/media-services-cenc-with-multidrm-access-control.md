---
title: 'CENC con DRM multiplo e controllo di accesso: progettazione di riferimento e implementazione in Azure e in Servizi multimediali di Azure | Microsoft Docs'
description: "Informazioni su come toolicensing hello Microsoft® Smooth Streaming Client Porting Kit."
services: media-services
documentationcenter: 
author: willzhan
manager: cfowler
editor: 
ms.assetid: 7814739b-cea9-4b9b-8370-538702e5c615
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: willzhan;kilroyh;yanmf;juliako
ms.openlocfilehash: 033fb618650c4fbe9069d467159a8734da759bba
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="cenc-with-multi-drm-and-access-control-a-reference-design-and-implementation-on-azure-and-azure-media-services"></a><span data-ttu-id="2edf8-103">CENC con DRM multiplo e controllo di accesso: progettazione di riferimento e implementazione in Azure e in Servizi multimediali di Azure</span><span class="sxs-lookup"><span data-stu-id="2edf8-103">CENC with Multi-DRM and Access Control: A Reference Design and Implementation on Azure and Azure Media Services</span></span>
 
## <a name="introduction"></a><span data-ttu-id="2edf8-104">Introduzione</span><span class="sxs-lookup"><span data-stu-id="2edf8-104">Introduction</span></span>
<span data-ttu-id="2edf8-105">È noto che è un toodesign attività complesse e compilare un sottosistema DRM per un OTT o streaming soluzione online.</span><span class="sxs-lookup"><span data-stu-id="2edf8-105">It is well known that it is a complex task toodesign and build a DRM subsystem for an OTT or online streaming solution.</span></span> <span data-ttu-id="2edf8-106">Ed è una pratica comune per toooutsource provider video online/operatori questo provider di servizi di parte toospecialized DRM.</span><span class="sxs-lookup"><span data-stu-id="2edf8-106">And it is a common practice for operators/online video providers toooutsource this part toospecialized DRM service providers.</span></span> <span data-ttu-id="2edf8-107">obiettivo di Hello di questo documento è toopresent un progetto di riferimento e l'implementazione del sottosistema DRM end-to-end OTT o una soluzione di flusso in linea.</span><span class="sxs-lookup"><span data-stu-id="2edf8-107">hello goal of this document is toopresent a reference design and implementation of end-to-end DRM subsystem in OTT or online streaming solution.</span></span>

<span data-ttu-id="2edf8-108">i lettori di Hello di destinazione di questo documento sono ingegneri nel sottosistema DRM di OTT streaming/multi-screen soluzioni online o qualsiasi lettore interessati nel sottosistema DRM.</span><span class="sxs-lookup"><span data-stu-id="2edf8-108">hello targeted readers of this document are engineers working in DRM subsystem of OTT or online streaming/multi-screen solutions, or any readers interested in DRM subsystem.</span></span> <span data-ttu-id="2edf8-109">il presupposto di Hello è che familiarità con almeno una delle tecnologie DRM hello sul mercato hello, ad esempio PlayReady, Widevine, FairPlay o accesso Adobe Reader.</span><span class="sxs-lookup"><span data-stu-id="2edf8-109">hello assumption is that readers are familiar with at least one of hello DRM technologies on hello market, such as PlayReady, Widevine, FairPlay or Adobe Access.</span></span>

<span data-ttu-id="2edf8-110">DRM include anche CENC (Common Encryption) con DRM multiplo.</span><span class="sxs-lookup"><span data-stu-id="2edf8-110">By DRM, we also include CENC (Common Encryption) with multi-DRM.</span></span> <span data-ttu-id="2edf8-111">Una tendenza principale nel flusso in linea e del settore OTT è toouse CENC con multi-native-DRM su varie piattaforme client, ovvero un turno dalla tendenza precedente di hello dell'utilizzo di un singolo DRM e il relativo client SDK per diverse piattaforme client.</span><span class="sxs-lookup"><span data-stu-id="2edf8-111">A major trend in online streaming and OTT industry is toouse CENC with multi-native-DRM on various client platforms, which is a shift from hello previous trend of using a single DRM and its client SDK for various client platforms.</span></span> <span data-ttu-id="2edf8-112">Quando si utilizza CENC con DRM multi-native, PlayReady sia Widevine vengono crittografati in base hello [Common Encryption (CENC ISO/IEC 23001-7)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) specifica.</span><span class="sxs-lookup"><span data-stu-id="2edf8-112">When using CENC with multi-native-DRM, both PlayReady and Widevine are encrypted per hello [Common Encryption (ISO/IEC 23001-7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) specification.</span></span>

<span data-ttu-id="2edf8-113">vantaggi di Hello di CENC con multi-DRM sono i seguenti:</span><span class="sxs-lookup"><span data-stu-id="2edf8-113">hello benefits of CENC with multi-DRM are as follows:</span></span>

1. <span data-ttu-id="2edf8-114">Riduce il costo della crittografia perché viene usata una sola elaborazione crittografica per piattaforme diverse con i DRM nativi.</span><span class="sxs-lookup"><span data-stu-id="2edf8-114">Reduces encryption cost since a single encryption processing is used targeting different platforms with its native DRMs;</span></span>
2. <span data-ttu-id="2edf8-115">Consente di ridurre il costo di hello di gestire gli asset crittografati poiché è necessaria una sola copia di un asset crittografato.</span><span class="sxs-lookup"><span data-stu-id="2edf8-115">Reduces hello cost of managing encrypted assets since only a single copy of encrypted assets is needed;</span></span>
3. <span data-ttu-id="2edf8-116">Elimina client DRM costi della licenza poiché hello native DRM client è in genere disponibile nella piattaforma nativa.</span><span class="sxs-lookup"><span data-stu-id="2edf8-116">Eliminates DRM client licensing cost since hello native DRM client is usually free on its native platform.</span></span>

<span data-ttu-id="2edf8-117">Microsoft, insieme ad alcuni dei principali leader di settore, ha promosso attivamente DASH e CENC.</span><span class="sxs-lookup"><span data-stu-id="2edf8-117">Microsoft has been an active promoter of DASH and CENC together with some major industry players.</span></span> <span data-ttu-id="2edf8-118">Servizi multimediali di Microsoft Azure ha fornito il supporto di DASH e CENC.</span><span class="sxs-lookup"><span data-stu-id="2edf8-118">Microsoft Azure Media Services has been providing support of DASH and CENC.</span></span> <span data-ttu-id="2edf8-119">Per gli annunci recenti, vedere i blog di Mingfei relativi all'[annuncio dell'anteprima pubblica dei servizi di distribuzione delle licenze Google Widevine in Servizi multimediali di Azure](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/) e all'[aggiunta in Servizi multimediali di Azure del pacchetto Google Widevine per la distribuzione del flusso DRM multiplo](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/).</span><span class="sxs-lookup"><span data-stu-id="2edf8-119">For recent announcements, please see Mingfei’s blogs: [Announcing Google Widevine license delivery services in Azure Media Services](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/), and [Azure Media Services adds Google Widevine packaging for delivering multi-DRM stream](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/).</span></span>  

### <a name="overview-of-this-article"></a><span data-ttu-id="2edf8-120">Panoramica dell'articolo</span><span class="sxs-lookup"><span data-stu-id="2edf8-120">Overview of this article</span></span>
<span data-ttu-id="2edf8-121">obiettivo di Hello di questo articolo include seguente hello:</span><span class="sxs-lookup"><span data-stu-id="2edf8-121">hello goal of this article includes hello following:</span></span>

1. <span data-ttu-id="2edf8-122">Fornire una progettazione di riferimento del sottosistema DRM usando CENC con DRM multiplo.</span><span class="sxs-lookup"><span data-stu-id="2edf8-122">Provides a reference design of DRM subsystem using CENC with multi-DRM;</span></span>
2. <span data-ttu-id="2edf8-123">Fornire un'implementazione di riferimento nella piattaforma Microsoft Azure/Servizi multimediali di Azure.</span><span class="sxs-lookup"><span data-stu-id="2edf8-123">Provides a reference implementation on Microsoft Azure/Azure Media Services platform;</span></span>
3. <span data-ttu-id="2edf8-124">Illustrare alcuni argomenti relativi alla progettazione e all'implementazione.</span><span class="sxs-lookup"><span data-stu-id="2edf8-124">Discusses some design and implementation topics.</span></span>

<span data-ttu-id="2edf8-125">Nell'articolo hello, "multi-DRM" vengono trattati i seguenti hello:</span><span class="sxs-lookup"><span data-stu-id="2edf8-125">In hello article, “multi-DRM” covers hello following:</span></span>

1. <span data-ttu-id="2edf8-126">Microsoft PlayReady</span><span class="sxs-lookup"><span data-stu-id="2edf8-126">Microsoft PlayReady</span></span>
2. <span data-ttu-id="2edf8-127">Google Widevine</span><span class="sxs-lookup"><span data-stu-id="2edf8-127">Google Widevine</span></span>
3. <span data-ttu-id="2edf8-128">Apple FairPlay</span><span class="sxs-lookup"><span data-stu-id="2edf8-128">Apple FairPlay</span></span> 

<span data-ttu-id="2edf8-129">Hello nella tabella seguente vengono riepilogate app di piattaforma nativa/nativo hello e browser supportati da ogni DRM.</span><span class="sxs-lookup"><span data-stu-id="2edf8-129">hello following table summarizes hello native platform/native app, and browsers supported by each DRM.</span></span>

| <span data-ttu-id="2edf8-130">**Piattaforma client**</span><span class="sxs-lookup"><span data-stu-id="2edf8-130">**Client Platform**</span></span> | <span data-ttu-id="2edf8-131">**Supporto DRM nativo**</span><span class="sxs-lookup"><span data-stu-id="2edf8-131">**Native DRM Support**</span></span> | <span data-ttu-id="2edf8-132">**Browser/App**</span><span class="sxs-lookup"><span data-stu-id="2edf8-132">**Browser/App**</span></span> | <span data-ttu-id="2edf8-133">**Formati di streaming**</span><span class="sxs-lookup"><span data-stu-id="2edf8-133">**Streaming Formats**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="2edf8-134">**Smart TV, STB operatore, STB OTT**</span><span class="sxs-lookup"><span data-stu-id="2edf8-134">**Smart TVs, operator STBs, OTT STBs**</span></span> |<span data-ttu-id="2edf8-135">Principalmente PlayReady e/o Widevine e/o altro</span><span class="sxs-lookup"><span data-stu-id="2edf8-135">PlayReady primarily, and/or Widevine, and/or other</span></span> |<span data-ttu-id="2edf8-136">Linux, Opera, WebKit, altri</span><span class="sxs-lookup"><span data-stu-id="2edf8-136">Linux, Opera, WebKit, Other</span></span> |<span data-ttu-id="2edf8-137">Vari formati</span><span class="sxs-lookup"><span data-stu-id="2edf8-137">Various formats</span></span> |
| <span data-ttu-id="2edf8-138">**Dispositivi Windows 10 (PC Windows, tablet Windows, Windows Phone, Xbox)**</span><span class="sxs-lookup"><span data-stu-id="2edf8-138">**Windows 10 devices (Windows PC, Windows Tablets, Windows Phone, Xbox)**</span></span> |<span data-ttu-id="2edf8-139">PlayReady</span><span class="sxs-lookup"><span data-stu-id="2edf8-139">PlayReady</span></span> |<span data-ttu-id="2edf8-140">MS Edge/IE11/EME</span><span class="sxs-lookup"><span data-stu-id="2edf8-140">MS Edge/IE11/EME</span></span><br/><br/><br/><span data-ttu-id="2edf8-141">UWP</span><span class="sxs-lookup"><span data-stu-id="2edf8-141">UWP</span></span> |<span data-ttu-id="2edf8-142">DASH (per HLS, PlayReady non è supportato)</span><span class="sxs-lookup"><span data-stu-id="2edf8-142">DASH (For HLS, PlayReady is not supported)</span></span><br/><br/><span data-ttu-id="2edf8-143">DASH, Smooth Streaming (per HLS, PlayReady non è supportato)</span><span class="sxs-lookup"><span data-stu-id="2edf8-143">DASH, Smooth Streaming (For HLS, PlayReady is not supported)</span></span> |
| <span data-ttu-id="2edf8-144">**Dispositivi Android (telefoni, tablet, TV)**</span><span class="sxs-lookup"><span data-stu-id="2edf8-144">**Android devices (Phone, Tablet, TV)**</span></span> |<span data-ttu-id="2edf8-145">Widevine</span><span class="sxs-lookup"><span data-stu-id="2edf8-145">Widevine</span></span> |<span data-ttu-id="2edf8-146">Chrome/EME</span><span class="sxs-lookup"><span data-stu-id="2edf8-146">Chrome/EME</span></span> |<span data-ttu-id="2edf8-147">DASH, HLS</span><span class="sxs-lookup"><span data-stu-id="2edf8-147">DASH,HLS</span></span> |
| <span data-ttu-id="2edf8-148">**iOS (iPhone, iPad), client OS X e Apple TV**</span><span class="sxs-lookup"><span data-stu-id="2edf8-148">**iOS (iPhone, iPad), OS X clients and Apple TV**</span></span> |<span data-ttu-id="2edf8-149">FairPlay</span><span class="sxs-lookup"><span data-stu-id="2edf8-149">FairPlay</span></span> |<span data-ttu-id="2edf8-150">Safari 8+/EME</span><span class="sxs-lookup"><span data-stu-id="2edf8-150">Safari 8+/EME</span></span> |<span data-ttu-id="2edf8-151">HLS</span><span class="sxs-lookup"><span data-stu-id="2edf8-151">HLS</span></span> |


<span data-ttu-id="2edf8-152">Considerando lo stato corrente di hello di distribuzione per ogni DRM, un servizio in genere consigliabile toomake DRMs tooimplement 2 o 3 che si risolve tutti i tipi di endpoint in hello migliore hello modo.</span><span class="sxs-lookup"><span data-stu-id="2edf8-152">Considering hello current state of deployment for each DRM, a service will typically want tooimplement 2 or 3 DRMs toomake sure you address all hello types of endpoints in hello best way.</span></span>

<span data-ttu-id="2edf8-153">Non c'è un compromesso tra complessità hello della logica di hello del servizio e complessità hello in hello client side tooreach un certo livello di utente esperienza hello di vari client.</span><span class="sxs-lookup"><span data-stu-id="2edf8-153">There is a tradeoff between hello complexity of hello service logic and hello complexity on hello client side tooreach a certain level of user experience on hello various clients.</span></span>

<span data-ttu-id="2edf8-154">toomake la selezione, tenere presente questi fact:</span><span class="sxs-lookup"><span data-stu-id="2edf8-154">toomake your selection, keep in mind these facts:</span></span>

* <span data-ttu-id="2edf8-155">PlayReady viene implementato in modo nativo in tutti i dispositivi Windows e in alcuni dispositivi Android ed è disponibile tramite SDK software su praticamente qualsiasi piattaforma.</span><span class="sxs-lookup"><span data-stu-id="2edf8-155">PlayReady is natively implemented in every Windows device, on some Android devices, and available through software SDKs on virtually any platform</span></span>
* <span data-ttu-id="2edf8-156">Widevine viene implementato in modo nativo in tutti i dispositivi Android, in Chrome e in alcuni altri dispositivi.</span><span class="sxs-lookup"><span data-stu-id="2edf8-156">Widevine is natively implemented in every Android device, in Chrome, and in some other devices</span></span>
* <span data-ttu-id="2edf8-157">FairPlay è disponibile solo in iOS e nei client Mac OS o tramite iTunes.</span><span class="sxs-lookup"><span data-stu-id="2edf8-157">FairPlay is available only on iOS and Mac OS clients or through iTunes.</span></span>

<span data-ttu-id="2edf8-158">Quindi, un DRM multiplo tipico corrisponde ai seguenti:</span><span class="sxs-lookup"><span data-stu-id="2edf8-158">So a typical multi-DRM would be:</span></span>

* <span data-ttu-id="2edf8-159">Opzione 1: PlayReady e Widevine</span><span class="sxs-lookup"><span data-stu-id="2edf8-159">Option 1: PlayReady and Widevine</span></span>
* <span data-ttu-id="2edf8-160">Opzione 2: PlayReady, Widevine e FairPlay</span><span class="sxs-lookup"><span data-stu-id="2edf8-160">Option 2: PlayReady, Widevine and FairPlay</span></span>

## <a name="a-reference-design"></a><span data-ttu-id="2edf8-161">Progettazione di riferimento</span><span class="sxs-lookup"><span data-stu-id="2edf8-161">A reference design</span></span>
<span data-ttu-id="2edf8-162">In questa sezione verrà presentata una progettazione di riferimento che è tooimplement tootechnologies agnostico utilizzato è.</span><span class="sxs-lookup"><span data-stu-id="2edf8-162">In this section, we will present a reference design which is agnostic tootechnologies used tooimplement it.</span></span>

<span data-ttu-id="2edf8-163">Un sottosistema DRM può contenere hello seguenti componenti:</span><span class="sxs-lookup"><span data-stu-id="2edf8-163">A DRM subsystem may contain hello following components:</span></span>

1. <span data-ttu-id="2edf8-164">Gestione della chiave</span><span class="sxs-lookup"><span data-stu-id="2edf8-164">Key management</span></span>
2. <span data-ttu-id="2edf8-165">Creazione pacchetto DRM</span><span class="sxs-lookup"><span data-stu-id="2edf8-165">DRM packaging</span></span>
3. <span data-ttu-id="2edf8-166">Distribuzione di licenze DRM</span><span class="sxs-lookup"><span data-stu-id="2edf8-166">DRM license delivery</span></span>
4. <span data-ttu-id="2edf8-167">Controllo dei diritti</span><span class="sxs-lookup"><span data-stu-id="2edf8-167">Entitlement check</span></span>
5. <span data-ttu-id="2edf8-168">Autenticazione/autorizzazione</span><span class="sxs-lookup"><span data-stu-id="2edf8-168">Authentication/authorization</span></span>
6. <span data-ttu-id="2edf8-169">Lettore</span><span class="sxs-lookup"><span data-stu-id="2edf8-169">Player</span></span>
7. <span data-ttu-id="2edf8-170">Origine/rete CDN</span><span class="sxs-lookup"><span data-stu-id="2edf8-170">Origin/CDN</span></span>

<span data-ttu-id="2edf8-171">Hello diagramma seguente viene illustrata hello elevata livello interazione tra i componenti di hello in un sottosistema DRM.</span><span class="sxs-lookup"><span data-stu-id="2edf8-171">hello following diagram illustrates hello high level interaction among hello components in a DRM subsystem.</span></span>

![Sottosistema DRM con CENC](./media/media-services-cenc-with-multidrm-access-control/media-services-generic-drm-subsystem-with-cenc.png)

<span data-ttu-id="2edf8-173">In Progettazione hello sono disponibili tre base "a livelli":</span><span class="sxs-lookup"><span data-stu-id="2edf8-173">There are three basic “layers” in hello design:</span></span>

1. <span data-ttu-id="2edf8-174">Livello back office (in nero) non esposto esternamente.</span><span class="sxs-lookup"><span data-stu-id="2edf8-174">Back office layer (in black) which are not exposed externally;</span></span>
2. <span data-ttu-id="2edf8-175">Livello "DMZ" (blu) che contiene tutti gli endpoint di hello affiancate pubblici.</span><span class="sxs-lookup"><span data-stu-id="2edf8-175">“DMZ” layer (blue) containing all hello endpoints facing public;</span></span>
3. <span data-ttu-id="2edf8-176">Livello Internet pubblico (azzurro) contenente la rete CDN e i lettori con traffico su Internet pubblico.</span><span class="sxs-lookup"><span data-stu-id="2edf8-176">Public Internet layer (light blue) containing CDN and players with traffic across public Internet.</span></span>

<span data-ttu-id="2edf8-177">Deve essere presente uno strumento di gestione del contenuto per controllare la protezione DRM, indipendentemente dal fatto che si tratti di crittografia statica o dinamica.</span><span class="sxs-lookup"><span data-stu-id="2edf8-177">There should be a content management tool for controlling DRM protection, regardless it is static or dynamic encryption.</span></span> <span data-ttu-id="2edf8-178">input Hello per la crittografia DRM deve includere:</span><span class="sxs-lookup"><span data-stu-id="2edf8-178">hello inputs for DRM encryption should include:</span></span>

1. <span data-ttu-id="2edf8-179">Contenuto video con velocità in bit multipla.</span><span class="sxs-lookup"><span data-stu-id="2edf8-179">MBR video content;</span></span>
2. <span data-ttu-id="2edf8-180">Chiave simmetrica.</span><span class="sxs-lookup"><span data-stu-id="2edf8-180">Content key;</span></span>
3. <span data-ttu-id="2edf8-181">URL di acquisizione delle licenze.</span><span class="sxs-lookup"><span data-stu-id="2edf8-181">License acquisition URLs.</span></span>

<span data-ttu-id="2edf8-182">Durante la fase di riproduzione, flusso di livello elevato di hello è:</span><span class="sxs-lookup"><span data-stu-id="2edf8-182">During playback time, hello high level flow is:</span></span>

1. <span data-ttu-id="2edf8-183">L'utente viene autenticato.</span><span class="sxs-lookup"><span data-stu-id="2edf8-183">User is authenticated;</span></span>
2. <span data-ttu-id="2edf8-184">Token di autorizzazione viene creato per utente hello.</span><span class="sxs-lookup"><span data-stu-id="2edf8-184">Authorization token is created for hello user;</span></span>
3. <span data-ttu-id="2edf8-185">Il contenuto protetto con DRM (manifesto) viene scaricato tooplayer;</span><span class="sxs-lookup"><span data-stu-id="2edf8-185">DRM protected content (manifest) is downloaded tooplayer;</span></span>
4. <span data-ttu-id="2edf8-186">Giocatore invia server con ID chiave e l'autorizzazione toolicense licenze acquisizione richiesta di token.</span><span class="sxs-lookup"><span data-stu-id="2edf8-186">Player submits license acquisition request toolicense servers together with key ID and authorization token.</span></span>

<span data-ttu-id="2edf8-187">Prima di spostare argomento successivo toohello, alcune parole su hello progettare della gestione delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="2edf8-187">Before moving toohello next topic, a few words about hello design of key management.</span></span>

| <span data-ttu-id="2edf8-188">**Chiave simmetrica-ad-asset**</span><span class="sxs-lookup"><span data-stu-id="2edf8-188">**ContentKey–to-Asset**</span></span> | <span data-ttu-id="2edf8-189">**Scenario**</span><span class="sxs-lookup"><span data-stu-id="2edf8-189">**Scenario**</span></span> |
| --- | --- |
| <span data-ttu-id="2edf8-190">1-a-1</span><span class="sxs-lookup"><span data-stu-id="2edf8-190">1–to-1</span></span> |<span data-ttu-id="2edf8-191">caso più semplice Hello.</span><span class="sxs-lookup"><span data-stu-id="2edf8-191">hello simplest case.</span></span> <span data-ttu-id="2edf8-192">Fornisce un controllo finest hello.</span><span class="sxs-lookup"><span data-stu-id="2edf8-192">It provides hello finest control.</span></span> <span data-ttu-id="2edf8-193">Tuttavia, ciò comporta in genere il costo più elevato licenza recapito hello.</span><span class="sxs-lookup"><span data-stu-id="2edf8-193">But this generally results in hello highest license delivery cost.</span></span> <span data-ttu-id="2edf8-194">È necessaria almeno una richiesta di licenza per ogni asset protetto.</span><span class="sxs-lookup"><span data-stu-id="2edf8-194">At minimum one license request is required for each protected asset.</span></span> |
| <span data-ttu-id="2edf8-195">1-a-molti</span><span class="sxs-lookup"><span data-stu-id="2edf8-195">1–to-Many</span></span> |<span data-ttu-id="2edf8-196">È possibile utilizzare hello stesso contenuto della chiave di più risorse.</span><span class="sxs-lookup"><span data-stu-id="2edf8-196">You could use hello same content key for multiple assets.</span></span> <span data-ttu-id="2edf8-197">Ad esempio, per tutti gli asset hello in un gruppo logico, ad esempio un genere o un sottoinsieme di genere (o film Gene), è possibile utilizzare una singola chiave simmetrica.</span><span class="sxs-lookup"><span data-stu-id="2edf8-197">For example, for all hello assets in a logical group such as a genre or subset of genre (or Movie Gene), you could use a single content key.</span></span> |
| <span data-ttu-id="2edf8-198">Molti-a-1</span><span class="sxs-lookup"><span data-stu-id="2edf8-198">Many–to-1</span></span> |<span data-ttu-id="2edf8-199">Per ogni asset sono necessarie più chiavi simmetriche.</span><span class="sxs-lookup"><span data-stu-id="2edf8-199">Multiple content keys are needed for each asset.</span></span> <br/><br/><span data-ttu-id="2edf8-200">Ad esempio, se è necessario protezione CENC dinamica tooapply con multi-DRM per MPEG-DASH e la crittografia dinamica AES-128 per HLS, è necessario due chiavi di contenuto separate, ognuna con il proprio ContentKeyType.</span><span class="sxs-lookup"><span data-stu-id="2edf8-200">For example, if you need tooapply dynamic CENC protection with multi-DRM for MPEG-DASH, and dynamic AES-128 encryption for HLS, you need two separate content keys, each with its own ContentKeyType.</span></span> <span data-ttu-id="2edf8-201">(Per chiave simmetrica hello utilizzati per la protezione CENC dinamica, ContentKeyType.CommonEncryption deve essere utilizzata, mentre per hello contenuto chiave utilizzata per la crittografia dinamica AES-128, ContentKeyType.EnvelopeEncryption deve essere utilizzata.)</span><span class="sxs-lookup"><span data-stu-id="2edf8-201">(For hello content key used for dynamic CENC protection, ContentKeyType.CommonEncryption should be used, while for hello content key used for dynamic AES-128 encryption, ContentKeyType.EnvelopeEncryption should be used.)</span></span><br/><br/><span data-ttu-id="2edf8-202">Contenuto di un altro esempio, la protezione di trattino CENC, in teoria, una chiave simmetrica può essere utilizzato tooprotect video flusso e un altro tooprotect chiave contenuto audio.</span><span class="sxs-lookup"><span data-stu-id="2edf8-202">Another example, in CENC protection of DASH content, in theory, one content key can be used tooprotect video stream and another content key tooprotect audio stream.</span></span> |
| <span data-ttu-id="2edf8-203">Molti – troppo-molti</span><span class="sxs-lookup"><span data-stu-id="2edf8-203">Many – too- Many</span></span> |<span data-ttu-id="2edf8-204">Combinazione di hello sopra due scenari: un set di chiavi vengono usate per ogni contenuto hello più asset in hello stesso asset "gruppo di".</span><span class="sxs-lookup"><span data-stu-id="2edf8-204">Combination of hello above two scenarios: one set of content keys are used for each of hello multiple assets in hello same asset “group”.</span></span> |

<span data-ttu-id="2edf8-205">Un altro fattore importante tooconsider è utilizzare hello di licenze permanenti e non persistente.</span><span class="sxs-lookup"><span data-stu-id="2edf8-205">Another important factor tooconsider is hello use of persistent and non-persistent licenses.</span></span>

<span data-ttu-id="2edf8-206">Perché queste considerazioni sono importanti?</span><span class="sxs-lookup"><span data-stu-id="2edf8-206">Why are these considerations important?</span></span>

<span data-ttu-id="2edf8-207">Hanno recapito toolicense impatto diretto costo se si utilizza cloud pubblico per il recapito di licenza.</span><span class="sxs-lookup"><span data-stu-id="2edf8-207">They have direct impact toolicense delivery cost if you use public cloud for license delivery.</span></span> <span data-ttu-id="2edf8-208">Si consideri hello seguenti due tooillustrate di casi di progettazione diverse:</span><span class="sxs-lookup"><span data-stu-id="2edf8-208">Let’s consider hello following two different design cases tooillustrate:</span></span>

1. <span data-ttu-id="2edf8-209">Sottoscrizione mensile: usare una licenza persistente e il mapping chiave simmetrica-ad-asset 1-a-molti.</span><span class="sxs-lookup"><span data-stu-id="2edf8-209">Monthly subscription: Use persistent license, and 1-to-many content key-to-asset mapping.</span></span> <span data-ttu-id="2edf8-210">Ad esempio,</span><span class="sxs-lookup"><span data-stu-id="2edf8-210">E.g.</span></span> <span data-ttu-id="2edf8-211">per tutti i filmati bambini hello, utilizziamo una singola chiave simmetrica per la crittografia.</span><span class="sxs-lookup"><span data-stu-id="2edf8-211">for all hello kids movies, we use a single content key for encryption.</span></span> <span data-ttu-id="2edf8-212">In questo caso:</span><span class="sxs-lookup"><span data-stu-id="2edf8-212">In this case:</span></span>

    <span data-ttu-id="2edf8-213">N. totale di licenze richieste per tutti i film per bambini/dispositivo = 1</span><span class="sxs-lookup"><span data-stu-id="2edf8-213">Total # licenses requested for all kids movies/device = 1</span></span>
2. <span data-ttu-id="2edf8-214">Sottoscrizione mensile: usare una licenza non persistente e il mapping 1-a-1 tra la chiave simmetrica e l'asset.</span><span class="sxs-lookup"><span data-stu-id="2edf8-214">Monthly subscription: Use non-persistent license, and 1-to-1 mapping between content key and asset.</span></span> <span data-ttu-id="2edf8-215">In questo caso:</span><span class="sxs-lookup"><span data-stu-id="2edf8-215">In this case:</span></span>

    <span data-ttu-id="2edf8-216">N. totale di licenze richieste per tutti i film per bambini/dispositivo = [n. di film guardati] x [n. di sessioni]</span><span class="sxs-lookup"><span data-stu-id="2edf8-216">Total # licenses requested for all kids movies/device = [# movies watched] x [# sessions]</span></span>

<span data-ttu-id="2edf8-217">Come è possibile visualizzare facilmente, hello due diverse progettazioni comportare licenza molto diverso richiedere modelli pertanto il recapito di licenza dei costi se il servizio di recapito licenza viene fornito da un cloud pubblico, ad esempio servizi multimediali di Azure.</span><span class="sxs-lookup"><span data-stu-id="2edf8-217">As you can easily see, hello two different designs result in very different license request patterns hence license delivery cost if license delivery service is provided by a public cloud such as Azure Media Services.</span></span>

## <a name="mapping-design-tootechnology-for-implementation"></a><span data-ttu-id="2edf8-218">Mapping tootechnology di progettazione per l'implementazione</span><span class="sxs-lookup"><span data-stu-id="2edf8-218">Mapping design tootechnology for implementation</span></span>
<span data-ttu-id="2edf8-219">Successivamente, vengono mappate tootechnologies la struttura generica sulla piattaforma Microsoft Azure/Azure Media Services, specificando quali toouse di tecnologia per ogni blocco di compilazione.</span><span class="sxs-lookup"><span data-stu-id="2edf8-219">Next, we map our generic design tootechnologies on Microsoft Azure/Azure Media Services platform, by specifying which technology toouse for each building block.</span></span>

<span data-ttu-id="2edf8-220">Hello nella tabella seguente viene illustrato il mapping di hello:</span><span class="sxs-lookup"><span data-stu-id="2edf8-220">hello following table shows hello mapping:</span></span>

| <span data-ttu-id="2edf8-221">**Blocco predefinito**</span><span class="sxs-lookup"><span data-stu-id="2edf8-221">**Building Block**</span></span> | <span data-ttu-id="2edf8-222">**Technology**</span><span class="sxs-lookup"><span data-stu-id="2edf8-222">**Technology**</span></span> |
| --- | --- |
| <span data-ttu-id="2edf8-223">**Lettore**</span><span class="sxs-lookup"><span data-stu-id="2edf8-223">**Player**</span></span> |[<span data-ttu-id="2edf8-224">Azure Media Player</span><span class="sxs-lookup"><span data-stu-id="2edf8-224">Azure Media Player</span></span>](https://azure.microsoft.com/services/media-services/media-player/) |
| <span data-ttu-id="2edf8-225">**Provider di identità (IdP)**</span><span class="sxs-lookup"><span data-stu-id="2edf8-225">**Identity Provider (IDP)**</span></span> |<span data-ttu-id="2edf8-226">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="2edf8-226">Azure Active Directory</span></span> |
| <span data-ttu-id="2edf8-227">**Servizio token di sicurezza**</span><span class="sxs-lookup"><span data-stu-id="2edf8-227">**Secure Token Service (STS)**</span></span> |<span data-ttu-id="2edf8-228">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="2edf8-228">Azure Active Directory</span></span> |
| <span data-ttu-id="2edf8-229">**Flusso di lavoro protezione DRM**</span><span class="sxs-lookup"><span data-stu-id="2edf8-229">**DRM Protection Workflow**</span></span> |<span data-ttu-id="2edf8-230">Protezione dinamica di Servizi multimediali di Azure</span><span class="sxs-lookup"><span data-stu-id="2edf8-230">Azure Media Services Dynamic Protection</span></span> |
| <span data-ttu-id="2edf8-231">**Distribuzione di licenze DRM**</span><span class="sxs-lookup"><span data-stu-id="2edf8-231">**DRM License Delivery**</span></span> |<span data-ttu-id="2edf8-232">1. Distribuzione delle licenze di Servizi multimediali di Azure (PlayReady, Widevine, FairPlay) o</span><span class="sxs-lookup"><span data-stu-id="2edf8-232">1. Azure Media Services License Delivery (PlayReady, Widevine, FairPlay), or</span></span> <br/><span data-ttu-id="2edf8-233">2. Server licenze Axinom,</span><span class="sxs-lookup"><span data-stu-id="2edf8-233">2. Axinom License Server,</span></span> <br/><span data-ttu-id="2edf8-234">3. Server licenze PlayReady personalizzato</span><span class="sxs-lookup"><span data-stu-id="2edf8-234">3. Custom PlayReady License Server</span></span> |
| <span data-ttu-id="2edf8-235">**Origine**</span><span class="sxs-lookup"><span data-stu-id="2edf8-235">**Origin**</span></span> |<span data-ttu-id="2edf8-236">Endpoint di streaming di Servizi multimediali di Azure</span><span class="sxs-lookup"><span data-stu-id="2edf8-236">Azure Media Services Streaming Endpoint</span></span> |
| <span data-ttu-id="2edf8-237">**Gestione della chiave**</span><span class="sxs-lookup"><span data-stu-id="2edf8-237">**Key Management**</span></span> |<span data-ttu-id="2edf8-238">Non necessaria per l'implementazione di riferimento</span><span class="sxs-lookup"><span data-stu-id="2edf8-238">Not needed for reference implementation</span></span> |
| <span data-ttu-id="2edf8-239">**Gestione del contenuto**</span><span class="sxs-lookup"><span data-stu-id="2edf8-239">**Content Management**</span></span> |<span data-ttu-id="2edf8-240">Applicazione console in C#</span><span class="sxs-lookup"><span data-stu-id="2edf8-240">A C# console application</span></span> |

<span data-ttu-id="2edf8-241">In altre parole, sia il provider di identità (IdP) che il servizio token di sicurezza saranno Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2edf8-241">In other words, both Identity Provider (IDP) and Secure Token Service (STS) will be Azure AD.</span></span> <span data-ttu-id="2edf8-242">Come lettore si userà l' [API di Azure Media Player](http://amp.azure.net/libs/amp/latest/docs/).</span><span class="sxs-lookup"><span data-stu-id="2edf8-242">For player, we will use [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="2edf8-243">Sia Servizi multimediali di Azure che Azure Media Player supportano DASH e CENC con DRM multiplo.</span><span class="sxs-lookup"><span data-stu-id="2edf8-243">Both Azure Media Services and Azure Media Player support DASH and CENC with multi-DRM.</span></span>

<span data-ttu-id="2edf8-244">Hello seguente diagramma illustra hello struttura e il flusso generale con hello sopra il mapping di tecnologia.</span><span class="sxs-lookup"><span data-stu-id="2edf8-244">hello following diagram shows hello overall structure and flow with hello above technology mapping.</span></span>

![CENC in AMS](./media/media-services-cenc-with-multidrm-access-control/media-services-cenc-subsystem-on-AMS-platform.png)

<span data-ttu-id="2edf8-246">In tooset di ordine di crittografia CENC dinamica, lo strumento di gestione dei contenuti hello utilizzerà hello seguenti input:</span><span class="sxs-lookup"><span data-stu-id="2edf8-246">In order tooset up dynamic CENC encryption, hello content management tool will use hello following inputs:</span></span>

1. <span data-ttu-id="2edf8-247">Contenuto aperto.</span><span class="sxs-lookup"><span data-stu-id="2edf8-247">Open content;</span></span>
2. <span data-ttu-id="2edf8-248">Chiave simmetrica dalla generazione/gestione delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="2edf8-248">Content key from key generation/management;</span></span>
3. <span data-ttu-id="2edf8-249">URL di acquisizione delle licenze.</span><span class="sxs-lookup"><span data-stu-id="2edf8-249">License acquisition URLs;</span></span>
4. <span data-ttu-id="2edf8-250">Un elenco di informazioni da Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2edf8-250">A list of information from Azure AD.</span></span>

<span data-ttu-id="2edf8-251">output di Hello dello strumento di gestione dei contenuti hello sarà:</span><span class="sxs-lookup"><span data-stu-id="2edf8-251">hello output of hello content management tool will be:</span></span>

1. <span data-ttu-id="2edf8-252">ContentKeyAuthorizationPolicy contenente hello specifica in modo recapito licenza verifica specifiche di licenza DRM; e un token JWT</span><span class="sxs-lookup"><span data-stu-id="2edf8-252">ContentKeyAuthorizationPolicy containing hello specification on how license delivery verifies a JWT token and DRM license specifications;</span></span>
2. <span data-ttu-id="2edf8-253">AssetDeliveryPolicy contenente le specifiche sul formato di streaming, sulla protezione DRM e sugli URL di acquisizione delle licenze.</span><span class="sxs-lookup"><span data-stu-id="2edf8-253">AssetDeliveryPolicy containing specifications on streaming format, DRM protection and license acquisition URLs.</span></span>

<span data-ttu-id="2edf8-254">Durante la fase di esecuzione, il flusso di hello è come di seguito:</span><span class="sxs-lookup"><span data-stu-id="2edf8-254">During runtime, hello flow is as below:</span></span>

1. <span data-ttu-id="2edf8-255">Durante l'autenticazione utente, viene generato un token JWT.</span><span class="sxs-lookup"><span data-stu-id="2edf8-255">Upon user authentication, a JWT token is generated;</span></span>
2. <span data-ttu-id="2edf8-256">Una delle attestazioni hello contenute nel token JWT hello è attestazione "groups" contenente l'ID di oggetto gruppo hello di "EntitledUserGroup".</span><span class="sxs-lookup"><span data-stu-id="2edf8-256">One of hello claims contained in hello JWT token is “groups” claim containing hello group object ID of “EntitledUserGroup”.</span></span> <span data-ttu-id="2edf8-257">Questa attestazione verrà usata per superare il controllo "entitlement check".</span><span class="sxs-lookup"><span data-stu-id="2edf8-257">This claim will be used for passing “entitlement check”.</span></span>
3. <span data-ttu-id="2edf8-258">Manifesto di client Windows Media Player download di un CENC contenuto protetto e "Visualizza" seguente hello:</span><span class="sxs-lookup"><span data-stu-id="2edf8-258">Player downloads client manifest of a CENC protected content and “sees” hello following:</span></span>

   1. <span data-ttu-id="2edf8-259">ID chiave.</span><span class="sxs-lookup"><span data-stu-id="2edf8-259">key ID,</span></span>
   2. <span data-ttu-id="2edf8-260">il contenuto di Hello è CENC protetto,</span><span class="sxs-lookup"><span data-stu-id="2edf8-260">hello content is CENC protected,</span></span>
   3. <span data-ttu-id="2edf8-261">URL di acquisizione delle licenze.</span><span class="sxs-lookup"><span data-stu-id="2edf8-261">License acquisition URLs.</span></span>
4. <span data-ttu-id="2edf8-262">Windows Media Player effettua una richiesta di acquisizione della licenza basata su browser/DRM di hello è supportato.</span><span class="sxs-lookup"><span data-stu-id="2edf8-262">Player makes a license acquisition request based on hello browser/DRM supported.</span></span> <span data-ttu-id="2edf8-263">ID e hello JWT di richiesta di acquisizione licenza hello, chiave token è inoltre possibile avviare.</span><span class="sxs-lookup"><span data-stu-id="2edf8-263">In hello license acquisition request, key ID and hello JWT token will also be submitted.</span></span> <span data-ttu-id="2edf8-264">Il servizio di distribuzione di licenze verificherà token JWT hello e attestazioni hello contenute prima di rilasciare hello necessaria licenza.</span><span class="sxs-lookup"><span data-stu-id="2edf8-264">License delivery service will verify hello JWT token and hello claims contained before issuing hello needed license.</span></span>

## <a name="implementation"></a><span data-ttu-id="2edf8-265">Implementazione</span><span class="sxs-lookup"><span data-stu-id="2edf8-265">Implementation</span></span>
### <a name="implementation-procedures"></a><span data-ttu-id="2edf8-266">Procedure di implementazione</span><span class="sxs-lookup"><span data-stu-id="2edf8-266">Implementation procedures</span></span>
<span data-ttu-id="2edf8-267">implementazione di Hello includerà hello alla procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="2edf8-267">hello implementation will include hello following steps:</span></span>

1. <span data-ttu-id="2edf8-268">Preparare l'asset di test: codificare/creazione pacchetto di un test toomulti-velocità in bit video frammentato MP4 in servizi multimediali di Azure.</span><span class="sxs-lookup"><span data-stu-id="2edf8-268">Prepare test asset(s): encode/package a test video toomulti-bitrate fragmented MP4 in Azure Media Services.</span></span> <span data-ttu-id="2edf8-269">Questo asset NON è protetto da DRM.</span><span class="sxs-lookup"><span data-stu-id="2edf8-269">This asset is NOT DRM protected.</span></span> <span data-ttu-id="2edf8-270">La protezione DRM verrà applicata più avanti con la protezione dinamica.</span><span class="sxs-lookup"><span data-stu-id="2edf8-270">DRM protection will be done by dynamic protection later.</span></span>
2. <span data-ttu-id="2edf8-271">Creare l'ID chiave e la chiave simmetrica (facoltativamente dal seme chiave).</span><span class="sxs-lookup"><span data-stu-id="2edf8-271">Create key ID and content key (optionally from key seed).</span></span> <span data-ttu-id="2edf8-272">In questo caso, non è necessario un sistema di gestione delle chiavi perché viene usato un solo set di ID chiave e chiave simmetrica per un paio di asset di test.</span><span class="sxs-lookup"><span data-stu-id="2edf8-272">For our purpose, key management system is not needed since we are dealing with only a single set of key ID and content key for a couple of test assets;</span></span>
3. <span data-ttu-id="2edf8-273">Utilizzare API AMS tooconfigure multi-DRM licenza servizi per la distribuzione per asset test hello.</span><span class="sxs-lookup"><span data-stu-id="2edf8-273">Use AMS API tooconfigure multi-DRM license delivery services for hello test asset.</span></span> <span data-ttu-id="2edf8-274">Se si utilizza il server licenze personalizzati dall'azienda o fornitori della società anziché servizi di licenza in servizi multimediali di Azure, è possibile ignorare questo passaggio e specificare gli URL di acquisizione licenza nel passaggio hello per la configurazione di recapito di licenza.</span><span class="sxs-lookup"><span data-stu-id="2edf8-274">If you are using custom license servers by your company or your company’s vendors instead of license services in Azure Media Services, you can skip this step and specify license acquisition URLs in hello step for configuring license delivery.</span></span> <span data-ttu-id="2edf8-275">API di sistema AMS è necessario toospecify dettagliate alcune configurazioni, ad esempio restrizione dei criteri di autorizzazione, licenza modelli di risposta per diversi servizi di licenza DRM e così via. In questo momento, hello portale di Azure non ancora fornire hello necessari dell'interfaccia utente per questa configurazione.</span><span class="sxs-lookup"><span data-stu-id="2edf8-275">AMS API is needed toospecify some detailed configurations, such as authorization policy restriction, license response templates for different DRM license services, etc. At this time, hello Azure portal does not yet provide hello needed UI for this configuration.</span></span> <span data-ttu-id="2edf8-276">Le info relative all'API e il codice di esempio sono disponibili nel documento di Julia Kornich: [Uso della crittografia comune dinamica PlayReady e/o Widevine](media-services-protect-with-drm.md).</span><span class="sxs-lookup"><span data-stu-id="2edf8-276">You can find API level info and sample code in Julia Kornich’s document: [Using PlayReady and/or Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span></span>
4. <span data-ttu-id="2edf8-277">Utilizzare criteri di distribuzione di API AMS tooconfigure asset per asset test hello.</span><span class="sxs-lookup"><span data-stu-id="2edf8-277">Use AMS API tooconfigure asset delivery policy for hello test asset.</span></span> <span data-ttu-id="2edf8-278">Le info relative all'API e il codice di esempio sono disponibili nel documento di Julia Kornich: [Uso della crittografia comune dinamica PlayReady e/o Widevine](media-services-protect-with-drm.md).</span><span class="sxs-lookup"><span data-stu-id="2edf8-278">You can find API level info and sample code in Julia Kornich’s document: [Using PlayReady and/or Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span></span>
5. <span data-ttu-id="2edf8-279">Creare e configurare un tenant di Azure Active Directory in Azure.</span><span class="sxs-lookup"><span data-stu-id="2edf8-279">Create and configure an Azure Active Directory tenant in Azure;</span></span>
6. <span data-ttu-id="2edf8-280">Creare alcuni gruppi e account utente nel tenant di Azure Active Directory: è necessario creare almeno "EntitledUser" e aggiungere un gruppo di utenti toothis.</span><span class="sxs-lookup"><span data-stu-id="2edf8-280">Create a few user accounts and groups in your Azure Active Directory tenant: you should create at least “EntitledUser” group and add a user toothis group.</span></span> <span data-ttu-id="2edf8-281">Gli utenti di questo gruppo verranno passato il controllo sui diritti acquisizione della licenza e gli utenti non di questo gruppo non supererà il controllo di autenticazione toopass e non sarà in grado di tooacquire alcuna licenza.</span><span class="sxs-lookup"><span data-stu-id="2edf8-281">Users in this group will pass entitlement check in license acquisition and users not in this group will fail toopass authentication check and will not be able tooacquire any license.</span></span> <span data-ttu-id="2edf8-282">Un membro del gruppo "EntitledUser" è un'attestazione "groups" necessario nel token JWT hello emesso da Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2edf8-282">Being a member of this “EntitledUser” group is a required “groups” claim in hello JWT token issued by Azure AD.</span></span> <span data-ttu-id="2edf8-283">Questo requisito di attestazione deve essere specificato nel passaggio relativo alla configurazione dei servizi di distribuzione di licenze con DRM multiplo.</span><span class="sxs-lookup"><span data-stu-id="2edf8-283">This claim requirement should be specified in configuring multi-DRM license delivery services step.</span></span>
7. <span data-ttu-id="2edf8-284">Creare un'app MVC ASP.NET che ospiterà il lettore video.</span><span class="sxs-lookup"><span data-stu-id="2edf8-284">Create an ASP.NET MVC app which will be hosting your video player.</span></span> <span data-ttu-id="2edf8-285">Questa applicazione ASP.NET sarà protetti con l'autenticazione utente nel tenant di Azure Active Directory hello.</span><span class="sxs-lookup"><span data-stu-id="2edf8-285">This ASP.NET app will be protected with user authentication against hello Azure Active Directory tenant.</span></span> <span data-ttu-id="2edf8-286">Attestazioni appropriate verranno inclusi nei token di accesso hello ottenuto dopo l'autenticazione utente.</span><span class="sxs-lookup"><span data-stu-id="2edf8-286">Proper claims will be included in hello access tokens obtained after user authentication.</span></span> <span data-ttu-id="2edf8-287">Per questo passaggio, è consigliata l'API OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="2edf8-287">OpenID Connect API is recommended for this step.</span></span> <span data-ttu-id="2edf8-288">È necessario hello tooinstall pacchetti NuGet seguenti:</span><span class="sxs-lookup"><span data-stu-id="2edf8-288">You need tooinstall hello following NuGet packages:</span></span>
   * <span data-ttu-id="2edf8-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span><span class="sxs-lookup"><span data-stu-id="2edf8-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span></span>
   * <span data-ttu-id="2edf8-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span><span class="sxs-lookup"><span data-stu-id="2edf8-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span></span>
   * <span data-ttu-id="2edf8-291">Install-Package Microsoft.Owin.Security.Cookies</span><span class="sxs-lookup"><span data-stu-id="2edf8-291">Install-Package Microsoft.Owin.Security.Cookies</span></span>
   * <span data-ttu-id="2edf8-292">Install-Package Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="2edf8-292">Install-Package Microsoft.Owin.Host.SystemWeb</span></span>
   * <span data-ttu-id="2edf8-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span><span class="sxs-lookup"><span data-stu-id="2edf8-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span></span>
8. <span data-ttu-id="2edf8-294">Creare un lettore usando l' [API di Azure Media Player](http://amp.azure.net/libs/amp/latest/docs/).</span><span class="sxs-lookup"><span data-stu-id="2edf8-294">Create a player using [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="2edf8-295">[API di Azure Media Player ProtectionInfo](http://amp.azure.net/libs/amp/latest/docs/) consente toospecify quali toouse tecnologia DRM su piattaforma DRM diversa.</span><span class="sxs-lookup"><span data-stu-id="2edf8-295">[Azure Media Player’s ProtectionInfo API](http://amp.azure.net/libs/amp/latest/docs/) allows you toospecify which DRM technology toouse on different DRM platform.</span></span>
9. <span data-ttu-id="2edf8-296">Testare la matrice:</span><span class="sxs-lookup"><span data-stu-id="2edf8-296">Test matrix:</span></span>

| <span data-ttu-id="2edf8-297">**DRM**</span><span class="sxs-lookup"><span data-stu-id="2edf8-297">**DRM**</span></span> | <span data-ttu-id="2edf8-298">**Browser**</span><span class="sxs-lookup"><span data-stu-id="2edf8-298">**Browser**</span></span> | <span data-ttu-id="2edf8-299">**Risultato per un utente idoneo**</span><span class="sxs-lookup"><span data-stu-id="2edf8-299">**Result for Entitled User**</span></span> | <span data-ttu-id="2edf8-300">**Risultato per un utente non idoneo**</span><span class="sxs-lookup"><span data-stu-id="2edf8-300">**Result for Un-entitled User**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="2edf8-301">**PlayReady**</span><span class="sxs-lookup"><span data-stu-id="2edf8-301">**PlayReady**</span></span> |<span data-ttu-id="2edf8-302">MS Edge o IE11 in Windows 10</span><span class="sxs-lookup"><span data-stu-id="2edf8-302">MS Edge or IE11 on Windows 10</span></span> |<span data-ttu-id="2edf8-303">Succeed</span><span class="sxs-lookup"><span data-stu-id="2edf8-303">Succeed</span></span> |<span data-ttu-id="2edf8-304">Fail</span><span class="sxs-lookup"><span data-stu-id="2edf8-304">Fail</span></span> |
| <span data-ttu-id="2edf8-305">**Widevine**</span><span class="sxs-lookup"><span data-stu-id="2edf8-305">**Widevine**</span></span> |<span data-ttu-id="2edf8-306">Chrome in Windows 10</span><span class="sxs-lookup"><span data-stu-id="2edf8-306">Chrome on Windows 10</span></span> |<span data-ttu-id="2edf8-307">Succeed</span><span class="sxs-lookup"><span data-stu-id="2edf8-307">Succeed</span></span> |<span data-ttu-id="2edf8-308">Fail</span><span class="sxs-lookup"><span data-stu-id="2edf8-308">Fail</span></span> |
| <span data-ttu-id="2edf8-309">**FairPlay**</span><span class="sxs-lookup"><span data-stu-id="2edf8-309">**FairPlay**</span></span> |<span data-ttu-id="2edf8-310">Da definire</span><span class="sxs-lookup"><span data-stu-id="2edf8-310">TBD</span></span> | | |

<span data-ttu-id="2edf8-311">George Trifonov del team di Servizi multimediali di Azure ha scritto un blog con i passaggi dettagliati per configurare Azure Active Directory per un'app lettore ASP.NET MVC: [Integrare l'app basata su OWIN MVC di Servizi multimediali di Azure con Azure Active Directory e limitare la distribuzione di chiavi simmetriche in base ad attestazioni JWT](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).</span><span class="sxs-lookup"><span data-stu-id="2edf8-311">George Trifonov of Azure Media Services Team has written a blog providing detailed steps in setting up Azure Active Directory for an ASP.NET MVC player app: [Integrate Azure Media Services OWIN MVC based app with Azure Active Directory and restrict content key delivery based on JWT claims](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).</span></span>

<span data-ttu-id="2edf8-312">George ha scritto anche un blog relativo all' [autenticazione di token JWT in Servizi multimediali di Azure e alla crittografia dinamica](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span><span class="sxs-lookup"><span data-stu-id="2edf8-312">George has also written a blog on [JWT token Authentication in Azure Media Services and Dynamic Encryption](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span></span> <span data-ttu-id="2edf8-313">Qui invece è disponibile il suo [esempio di integrazione di Azure AD con la distribuzione delle chiavi di Servizi multimediali di Azure](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/).</span><span class="sxs-lookup"><span data-stu-id="2edf8-313">And here is his [sample on Azure AD integration with Azure Media Services key delivery](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/).</span></span>

<span data-ttu-id="2edf8-314">Per informazioni su Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="2edf8-314">For information on Azure Active Directory:</span></span>

* <span data-ttu-id="2edf8-315">Le informazioni per gli sviluppatori sono disponibili nella [Guida per gli sviluppatori di Azure Active Directory](../active-directory/active-directory-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="2edf8-315">You can find developer information in [Azure Active Directory Developer’s Guide](../active-directory/active-directory-developers-guide.md).</span></span>
* <span data-ttu-id="2edf8-316">Le informazioni per gli amministratori sono disponibili in [Amministrare la directory di Azure AD](../active-directory/active-directory-administer.md).</span><span class="sxs-lookup"><span data-stu-id="2edf8-316">You can find administrator information in [Administer Your Azure AD Directory](../active-directory/active-directory-administer.md).</span></span>

### <a name="some-gotchas-in-implementation"></a><span data-ttu-id="2edf8-317">Problematiche di implementazione</span><span class="sxs-lookup"><span data-stu-id="2edf8-317">Some gotchas in implementation</span></span>
<span data-ttu-id="2edf8-318">Esistono alcuni problemi"" nell'implementazione di hello.</span><span class="sxs-lookup"><span data-stu-id="2edf8-318">There are some “gotchas” in hello implementation.</span></span> <span data-ttu-id="2edf8-319">Probabilmente seguente elenco di "trucchi" hello consentono la risoluzione dei problemi nel caso in cui si verifichino problemi.</span><span class="sxs-lookup"><span data-stu-id="2edf8-319">Hopefully hello following list of “gotchas” can help you troubleshooting in case you run into issues.</span></span>

1. <span data-ttu-id="2edf8-320">L'URL dell'**autorità di certificazione** deve terminare con **"/"**.</span><span class="sxs-lookup"><span data-stu-id="2edf8-320">**Issuer** URL should end with **"/"**.</span></span>  

    <span data-ttu-id="2edf8-321">**Gruppo di destinatari** deve essere hello ID client dell'applicazione di Windows Media player e aggiungere anche **"/"** alla fine di hello dell'URL dell'autorità di certificazione hello.</span><span class="sxs-lookup"><span data-stu-id="2edf8-321">**Audience** should be hello player application client ID and you should also add **"/"** at hello end of hello issuer URL.</span></span>

        <add key="ida:audience" value="[Application Client ID GUID]" />
        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/" />

    <span data-ttu-id="2edf8-322">In [JWT decodificatore](http://jwt.calebb.net/), dovrebbe essere **aud** e **iss** come indicato di seguito nel token JWT hello:</span><span class="sxs-lookup"><span data-stu-id="2edf8-322">In [JWT Decoder](http://jwt.calebb.net/), you should see **aud** and **iss** as below in hello JWT token:</span></span>

    ![Primo trabocchetto](./media/media-services-cenc-with-multidrm-access-control/media-services-1st-gotcha.png)
2. <span data-ttu-id="2edf8-324">Aggiungere l'applicazione toohello autorizzazioni in AAD (nella scheda Configura dell'applicazione hello).</span><span class="sxs-lookup"><span data-stu-id="2edf8-324">Add Permissions toohello application in AAD (on Configure tab of hello application).</span></span> <span data-ttu-id="2edf8-325">Questa operazione è obbligatoria per ogni applicazione (versioni locali e distribuite).</span><span class="sxs-lookup"><span data-stu-id="2edf8-325">This is required for each application (local and deployed versions).</span></span>

    ![Secondo trabocchetto](./media/media-services-cenc-with-multidrm-access-control/media-services-perms-to-other-apps.png)
3. <span data-ttu-id="2edf8-327">Utilizzare hello destra dell'autorità di certificazione nella configurazione della protezione CENC dinamica:</span><span class="sxs-lookup"><span data-stu-id="2edf8-327">Use hello right issuer in setting up dynamic CENC protection:</span></span>

        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/"/>

    <span data-ttu-id="2edf8-328">Hello segue non funzionerà:</span><span class="sxs-lookup"><span data-stu-id="2edf8-328">hello following will not work:</span></span>

        <add key="ida:issuer" value="https://willzhanad.onmicrosoft.com/" />

    <span data-ttu-id="2edf8-329">Hello GUID è l'ID del tenant hello AAD.</span><span class="sxs-lookup"><span data-stu-id="2edf8-329">hello GUID is hello AAD tenant ID.</span></span> <span data-ttu-id="2edf8-330">Hello GUID è reperibile nella finestra popup di endpoint nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="2edf8-330">hello GUID can be found in Endpoints popup in Azure portal.</span></span>
4. <span data-ttu-id="2edf8-331">Concedere i privilegi delle attestazioni di appartenenza al gruppo.</span><span class="sxs-lookup"><span data-stu-id="2edf8-331">Grant group membership claims privileges.</span></span> <span data-ttu-id="2edf8-332">Assicurarsi che nel file manifesto dell'applicazione AAD, abbiamo seguente hello</span><span class="sxs-lookup"><span data-stu-id="2edf8-332">Make sure in AAD application manifest file, we have hello following</span></span>

    <span data-ttu-id="2edf8-333">"groupMembershipClaims": "All", (valore predefinito di hello è null)</span><span class="sxs-lookup"><span data-stu-id="2edf8-333">"groupMembershipClaims": "All",    (hello default value is null)</span></span>
5. <span data-ttu-id="2edf8-334">Impostare l'oggetto TokenType appropriato quando si creano i requisiti relativi alle restrizioni.</span><span class="sxs-lookup"><span data-stu-id="2edf8-334">Setting proper TokenType when creating restriction requirements.</span></span>

        objTokenRestrictionTemplate.TokenType = TokenType.JWT;

    <span data-ttu-id="2edf8-335">Poiché l'aggiunta del supporto di JWT (AAD) inoltre tooSWT (ACS), predefinito hello TokenType è TokenType.JWT.</span><span class="sxs-lookup"><span data-stu-id="2edf8-335">Since adding support of JWT (AAD) in addition tooSWT (ACS), hello default TokenType is TokenType.JWT.</span></span> <span data-ttu-id="2edf8-336">Se si usa SWT/ACS, è necessario impostare tooTokenType.SWT.</span><span class="sxs-lookup"><span data-stu-id="2edf8-336">If you use SWT/ACS, you must set tooTokenType.SWT.</span></span>

## <a name="additional-topics-for-implementation"></a><span data-ttu-id="2edf8-337">Argomenti aggiuntivi per l'implementazione</span><span class="sxs-lookup"><span data-stu-id="2edf8-337">Additional Topics for Implementation</span></span>
<span data-ttu-id="2edf8-338">Verranno ora illustrati alcuni argomenti aggiuntivi sulla progettazione e l'implementazione.</span><span class="sxs-lookup"><span data-stu-id="2edf8-338">Next we will disc uss some additional topics in our design and implementation.</span></span>

### <a name="http-or-https"></a><span data-ttu-id="2edf8-339">HTTP o HTTPS?</span><span class="sxs-lookup"><span data-stu-id="2edf8-339">HTTP or HTTPS?</span></span>
<span data-ttu-id="2edf8-340">applicazione di Windows Media player ASP.NET MVC è compilate Hello deve supportare seguente hello:</span><span class="sxs-lookup"><span data-stu-id="2edf8-340">hello ASP.NET MVC player application we built must support hello following:</span></span>

1. <span data-ttu-id="2edf8-341">Autenticazione degli utenti tramite Azure AD che deve toobe in HTTPS.</span><span class="sxs-lookup"><span data-stu-id="2edf8-341">User authentication through Azure AD which needs toobe under HTTPS;</span></span>
2. <span data-ttu-id="2edf8-342">Scambio di token JWT tra client e Azure AD che deve toobe in HTTPS.</span><span class="sxs-lookup"><span data-stu-id="2edf8-342">JWT token exchange between client and Azure AD which needs toobe under HTTPS;</span></span>
3. <span data-ttu-id="2edf8-343">Acquisizione della licenza DRM dal client hello che è necessario toobe in HTTPS se il recapito di licenza viene fornito da servizi multimediali di Azure.</span><span class="sxs-lookup"><span data-stu-id="2edf8-343">DRM license acquisition by hello client which is required toobe under HTTPS if license delivery is provided by Azure Media Services.</span></span> <span data-ttu-id="2edf8-344">Naturalmente, la famiglia di prodotti PlayReady non obbliga a usare HTTPS per la distribuzione delle licenze.</span><span class="sxs-lookup"><span data-stu-id="2edf8-344">Of course, PlayReady product suite does not mandate HTTPS for license delivery.</span></span> <span data-ttu-id="2edf8-345">Se il server delle licenze PlayReady non rientra nei Servizi multimediali di Azure, usare HTTP o HTTPS.</span><span class="sxs-lookup"><span data-stu-id="2edf8-345">If your PlayReady license server is outside of Azure Media Services, either HTTP or HTTPS could be used.</span></span>

<span data-ttu-id="2edf8-346">Pertanto, hello applicazione player ASP.NET verrà utilizzato HTTPS come procedura consigliata.</span><span class="sxs-lookup"><span data-stu-id="2edf8-346">Therefore, hello ASP.NET player application will use HTTPS as a best practice.</span></span> <span data-ttu-id="2edf8-347">Ciò significa hello che Azure Media Player verranno eseguite su una pagina in HTTPS.</span><span class="sxs-lookup"><span data-stu-id="2edf8-347">This means hello Azure Media Player will be on a page under HTTPS.</span></span> <span data-ttu-id="2edf8-348">Tuttavia, per lo streaming preferiamo HTTP, è necessario pertanto tooconsider problema contenuto misto.</span><span class="sxs-lookup"><span data-stu-id="2edf8-348">However, for streaming we prefer HTTP, hence we need tooconsider mixed content issue.</span></span>

1. <span data-ttu-id="2edf8-349">Il browser non consente il contenuto misto,</span><span class="sxs-lookup"><span data-stu-id="2edf8-349">Browser does not allow mixed content.</span></span> <span data-ttu-id="2edf8-350">ma lo consentono i plug-in come Silverlight e il plug-in OSMF per Smooth e DASH.</span><span class="sxs-lookup"><span data-stu-id="2edf8-350">But plugins like Silverlight and OSMF plugin for smooth and DASH allow.</span></span> <span data-ttu-id="2edf8-351">Contenuto misto è un problema di sicurezza, in scadenza toohello minaccia di hello possibilità tooinject JS dannosi che possono causare hello toobe dati cliente a rischio.</span><span class="sxs-lookup"><span data-stu-id="2edf8-351">Mixed content is a security concern - This is due toohello threat of hello ability tooinject malicious JS which can cause hello customer data toobe at risk.</span></span>  <span data-ttu-id="2edf8-352">Browser blocca questa operazione per impostazione predefinita e finora hello solo modo toowork intorno a esso è sul lato server (origine) hello tooallow tutti i domini (indipendentemente dal fatto che https o http).</span><span class="sxs-lookup"><span data-stu-id="2edf8-352">Browsers block this by default and so far hello only way toowork around it is on hello server (origin) side, tooallow all domains (regardless https or http).</span></span> <span data-ttu-id="2edf8-353">ma probabilmente nemmeno questa è una buona idea.</span><span class="sxs-lookup"><span data-stu-id="2edf8-353">This is probably not a good idea either.</span></span>
2. <span data-ttu-id="2edf8-354">È consigliabile evitare il contenuto misto: entrambi devono usare HTTP o HTTPS.</span><span class="sxs-lookup"><span data-stu-id="2edf8-354">We should avoid mixed content: either both use HTTP or both use HTTPS.</span></span> <span data-ttu-id="2edf8-355">Quando gestisce il contenuto misto, la tecnologia silverlightSS richiede la cancellazione di un avviso di contenuto misto.</span><span class="sxs-lookup"><span data-stu-id="2edf8-355">When playing mixed content, silverlightSS tech requires clearing a mixed content warning.</span></span> <span data-ttu-id="2edf8-356">La tecnologia flashSS gestisce il contenuto misto senza avvisi di contenuto misto.</span><span class="sxs-lookup"><span data-stu-id="2edf8-356">flashSS tech handles mixed content without mixed content warning.</span></span>
3. <span data-ttu-id="2edf8-357">Se l'endpoint di streaming è stato creato prima di agosto 2014, non supporterà HTTPS.</span><span class="sxs-lookup"><span data-stu-id="2edf8-357">If your streaming endpoint was created before August 2014, it will not support HTTPS.</span></span> <span data-ttu-id="2edf8-358">In questo caso, creare e usare un nuovo endpoint di streaming per HTTPS.</span><span class="sxs-lookup"><span data-stu-id="2edf8-358">In this case, please create and use a new streaming endpoint for HTTPS.</span></span>

<span data-ttu-id="2edf8-359">Nell'implementazione di riferimento hello, per il contenuto protetto con DRM, applicazione e il flusso saranno in HTTTPS.</span><span class="sxs-lookup"><span data-stu-id="2edf8-359">In hello reference implementation, for DRM protected contents, both application and streaming will be under HTTTPS.</span></span> <span data-ttu-id="2edf8-360">Per aprire contenuto, Windows Media player hello non è necessario l'autenticazione o licenza, in modo che sia hello liberty toouse HTTP o HTTPS.</span><span class="sxs-lookup"><span data-stu-id="2edf8-360">For open contents, hello player does not need authentication or license, so you have hello liberty toouse either HTTP or HTTPS.</span></span>

### <a name="azure-active-directory-signing-key-rollover"></a><span data-ttu-id="2edf8-361">Rollover della chiave per la firma di Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="2edf8-361">Azure Active Directory signing key rollover</span></span>
<span data-ttu-id="2edf8-362">Si tratta di un tootake punto importante in considerazione dell'implementazione.</span><span class="sxs-lookup"><span data-stu-id="2edf8-362">This is an important point tootake into consideration of your implementation.</span></span> <span data-ttu-id="2edf8-363">Se non si considerano nell'implementazione, il sistema hello completato infine smetteranno di funzionare completamente all'interno di al massimo 6 settimane.</span><span class="sxs-lookup"><span data-stu-id="2edf8-363">If you do not consider this in your implementation, hello completed system will eventually stop working completely within at most 6 weeks.</span></span>

<span data-ttu-id="2edf8-364">Azure AD Usa trust tooestablish standard di settore tra l'elemento e le applicazioni con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2edf8-364">Azure AD uses industry standard tooestablish trust between itself and applications using Azure AD.</span></span> <span data-ttu-id="2edf8-365">In particolare, Azure AD usa una chiave per la firma costituita da una coppia di chiavi pubblica e privata.</span><span class="sxs-lookup"><span data-stu-id="2edf8-365">Specifically, Azure AD uses a signing key that consists of a public and private key pair.</span></span> <span data-ttu-id="2edf8-366">Quando Azure AD crea un token di sicurezza che contiene informazioni sull'utente hello, questo token viene firmato da Azure AD usando la relativa chiave privata prima di inviarlo applicazione toohello indietro.</span><span class="sxs-lookup"><span data-stu-id="2edf8-366">When Azure AD creates a security token that contains information about hello user, this token is signed by Azure AD using its private key before it is sent back toohello application.</span></span> <span data-ttu-id="2edf8-367">tooverify che hello token sia valido e provenga effettivamente da Azure AD, un'applicazione hello deve convalidare hello firma tramite la chiave pubblica hello esposta da Azure AD che è contenuto nel documento di metadati di federazione del tenant hello.</span><span class="sxs-lookup"><span data-stu-id="2edf8-367">tooverify that hello token is valid and actually originated from Azure AD, hello application must validate hello token’s signature using hello public key exposed by Azure AD that is contained in hello tenant’s federation metadata document.</span></span> <span data-ttu-id="2edf8-368">Questa chiave pubblica e hello chiave da cui deriva la firma, è hello identico a quello utilizzato per tutti i tenant di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2edf8-368">This public key – and hello signing key from which it derives – is hello same one used for all tenants in Azure AD.</span></span>

<span data-ttu-id="2edf8-369">Informazioni dettagliate sul rollover della chiave di Azure AD possono essere trovato nel documento hello: [informazioni importanti sul Rollover della chiave di firma in Azure AD](../active-directory/active-directory-signing-key-rollover.md).</span><span class="sxs-lookup"><span data-stu-id="2edf8-369">Detailed info on Azure AD key rollover can be found in hello document: [Important Information about Signing Key Rollover in Azure AD](../active-directory/active-directory-signing-key-rollover.md).</span></span>

<span data-ttu-id="2edf8-370">Tra hello [coppia di chiavi pubblica / privata](https://login.microsoftonline.com/common/discovery/keys/),</span><span class="sxs-lookup"><span data-stu-id="2edf8-370">Between hello [public-private key pair](https://login.microsoftonline.com/common/discovery/keys/),</span></span>

* <span data-ttu-id="2edf8-371">la chiave privata di Hello viene utilizzata da Azure Active Directory toogenerate un token JWT.</span><span class="sxs-lookup"><span data-stu-id="2edf8-371">hello private key is used by Azure Active Directory toogenerate a JWT token;</span></span>
* <span data-ttu-id="2edf8-372">la chiave pubblica di Hello viene utilizzata da un'applicazione, ad esempio servizi di recapito licenza DRM in token JWT di AMS tooverify hello;</span><span class="sxs-lookup"><span data-stu-id="2edf8-372">hello public key is used by an application such as DRM License Delivery Services in AMS tooverify hello JWT token;</span></span>

<span data-ttu-id="2edf8-373">Per motivi di sicurezza, Azure Active Directory fa girare questo certificato periodicamente (ogni 6 settimane).</span><span class="sxs-lookup"><span data-stu-id="2edf8-373">For security purpose, Azure Active Directory rotates this certificate periodically (every 6 weeks).</span></span> <span data-ttu-id="2edf8-374">In caso di violazioni della sicurezza, rollover della chiave hello può verificarsi a qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="2edf8-374">In case of security breaches, hello key rollover can occur any time.</span></span> <span data-ttu-id="2edf8-375">Pertanto, servizi di recapito hello licenza nel sistema AMS necessario tooupdate hello della chiave pubblica utilizzata come Azure AD ruota coppia di chiavi hello, in caso contrario l'autenticazione token nel sistema AMS non riuscirà e non verrà generata alcuna licenza.</span><span class="sxs-lookup"><span data-stu-id="2edf8-375">Therefore, hello license delivery services in AMS need tooupdate hello public key used as Azure AD rotates hello key pair, otherwise token authentication in AMS will fail and no license will be issued.</span></span>

<span data-ttu-id="2edf8-376">Questo risultato viene ottenuto impostando TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument quando si configurano i servizi di distribuzione delle licenze DRM.</span><span class="sxs-lookup"><span data-stu-id="2edf8-376">This is achieved by setting TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument when configuring DRM license delivery services.</span></span>

<span data-ttu-id="2edf8-377">flusso di token JWT Hello è come di seguito:</span><span class="sxs-lookup"><span data-stu-id="2edf8-377">hello JWT token flow is as below:</span></span>

1. <span data-ttu-id="2edf8-378">Azure AD emetta token JWT hello con chiave privata hello corrente per un utente autenticato.</span><span class="sxs-lookup"><span data-stu-id="2edf8-378">Azure AD will issue hello JWT token with hello current private key for an authenticated user;</span></span>
2. <span data-ttu-id="2edf8-379">Quando un lettore rileva un CENC con contenuto protetto con DRM a multipla, individuerà innanzitutto token JWT hello emesso da Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2edf8-379">When a player sees a CENC with multi-DRM protected content, it will first locate hello JWT token issued by Azure AD.</span></span>
3. <span data-ttu-id="2edf8-380">Windows Media player Hello invia una richiesta di acquisizione di licenza con i servizi di recapito toolicense token JWT hello in AMS;</span><span class="sxs-lookup"><span data-stu-id="2edf8-380">hello player sends license acquisition request with hello JWT token toolicense delivery services in AMS;</span></span>
4. <span data-ttu-id="2edf8-381">servizi di recapito Hello licenza nel sistema AMS utilizzerà hello corrente o una chiave pubblica valida dal token JWT hello tooverify Azure AD prima di rilasciare le licenze.</span><span class="sxs-lookup"><span data-stu-id="2edf8-381">hello license delivery services in AMS will use hello current/valid public key from Azure AD tooverify hello JWT token, before issuing licenses.</span></span>

<span data-ttu-id="2edf8-382">Servizi multimediali di licenza DRM verranno sempre eseguita la verifica per hello corrente o una chiave pubblica valida da Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2edf8-382">DRM license delivery services will always be checking for hello current/valid public key from Azure AD.</span></span> <span data-ttu-id="2edf8-383">chiave pubblica di Hello presentata da Azure AD verrà chiave hello utilizzata per la verifica per determinare se un token JWT rilasciato da Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2edf8-383">hello public key presented by Azure AD will be hello key used for verifying a JWT token issued by Azure AD.</span></span>

<span data-ttu-id="2edf8-384">Cosa accade se rollover della chiave hello avviene dopo AAD genera un token JWT ma prima di hello JWT token viene inviato da lettori tooDRM licenza servizi per la distribuzione nel sistema AMS per la verifica?</span><span class="sxs-lookup"><span data-stu-id="2edf8-384">What if hello key rollover happens after AAD generates a JWT token but before hello JWT token is sent by players tooDRM license delivery services in AMS for verification?</span></span>

<span data-ttu-id="2edf8-385">Poiché una chiave può essere eseguito il rollback in qualsiasi momento, è sempre più di una chiave pubblica valida nel documento di metadati di federazione hello disponibili.</span><span class="sxs-lookup"><span data-stu-id="2edf8-385">Because a key may be rolled at any moment, there is always more than one valid public key available in hello federation metadata document.</span></span> <span data-ttu-id="2edf8-386">Distribuzione di licenze di servizi multimediali Azure è possibile utilizzare uno qualsiasi dei hello chiavi specificato nel documento hello, poiché una chiave può essere implementata a breve, un altro può essere relativa sostituzione e così via.</span><span class="sxs-lookup"><span data-stu-id="2edf8-386">Azure Media Services license delivery can use any of hello keys specified in hello document, since one key may be rolled soon, another may be its replacement, and so forth.</span></span>

### <a name="where-is-hello-access-token"></a><span data-ttu-id="2edf8-387">In cui è hello Token di accesso?</span><span class="sxs-lookup"><span data-stu-id="2edf8-387">Where is hello Access Token?</span></span>
<span data-ttu-id="2edf8-388">Se si osserva come un'app web chiama un'API app in [identità applicazione con concessione di credenziali Client OAuth 2.0](../active-directory/develop/active-directory-authentication-scenarios.md#web-application-to-web-api), flusso di autenticazione hello è come di seguito:</span><span class="sxs-lookup"><span data-stu-id="2edf8-388">If you look at how a web app calls an API app under [Application Identity with OAuth 2.0 Client Credentials Grant](../active-directory/develop/active-directory-authentication-scenarios.md#web-application-to-web-api), hello authentication flow is as below:</span></span>

1. <span data-ttu-id="2edf8-389">Un utente ha effettuato l'accesso tooAzure AD nell'applicazione web hello (vedere hello [tooWeb Web Browser applicazione](../active-directory/develop/active-directory-authentication-scenarios.md#web-browser-to-web-application).</span><span class="sxs-lookup"><span data-stu-id="2edf8-389">A user is signed in tooAzure AD in hello web application (see hello [Web Browser tooWeb Application](../active-directory/develop/active-directory-authentication-scenarios.md#web-browser-to-web-application).</span></span>
2. <span data-ttu-id="2edf8-390">endpoint di autorizzazione Hello Azure AD reindirizza l'applicazione client toohello indietro hello utente agente con un codice di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="2edf8-390">hello Azure AD authorization endpoint redirects hello user agent back toohello client application with an authorization code.</span></span> <span data-ttu-id="2edf8-391">agente utente Hello restituisce l'URI di reindirizzamento dell'applicazione di autorizzazione codice toohello client.</span><span class="sxs-lookup"><span data-stu-id="2edf8-391">hello user agent returns authorization code toohello client application’s redirect URI.</span></span>
3. <span data-ttu-id="2edf8-392">un'applicazione web Hello deve tooacquire un token di accesso in modo che possa autenticare toohello web API e recuperare la risorsa hello desiderato.</span><span class="sxs-lookup"><span data-stu-id="2edf8-392">hello web application needs tooacquire an access token so that it can authenticate toohello web API and retrieve hello desired resource.</span></span> <span data-ttu-id="2edf8-393">In questo modo l'endpoint token tooAzure una richiesta di AD, fornendo credenziali hello, ID client e URI ID applicazione dell'API web.</span><span class="sxs-lookup"><span data-stu-id="2edf8-393">It makes a request tooAzure AD’s token endpoint, providing hello credential, client ID, and web API’s application ID URI.</span></span> <span data-ttu-id="2edf8-394">Presenta tooprove codice di autorizzazione hello che hello utente ha acconsentito.</span><span class="sxs-lookup"><span data-stu-id="2edf8-394">It presents hello authorization code tooprove that hello user has consented.</span></span>
4. <span data-ttu-id="2edf8-395">Azure AD autentica l'applicazione hello e restituisce un token di accesso JWT usato toocall hello web API.</span><span class="sxs-lookup"><span data-stu-id="2edf8-395">Azure AD authenticates hello application and returns a JWT access token that is used toocall hello web API.</span></span>
5. <span data-ttu-id="2edf8-396">Su HTTPS, un'applicazione web hello Usa hello restituito hello tooadd token di accesso JWT stringa JWT con una designazione "Bearer" nell'intestazione di autorizzazione hello API Web di toohello richiesta hello.</span><span class="sxs-lookup"><span data-stu-id="2edf8-396">Over HTTPS, hello web application uses hello returned JWT access token tooadd hello JWT string with a “Bearer” designation in hello Authorization header of hello request toohello web API.</span></span> <span data-ttu-id="2edf8-397">API web Hello quindi convalida token JWT hello e se la convalida ha esito positivo, restituisce hello desiderato di risorse.</span><span class="sxs-lookup"><span data-stu-id="2edf8-397">hello web API then validates hello JWT token, and if validation is successful, returns hello desired resource.</span></span>

<span data-ttu-id="2edf8-398">In questo flusso di "application identity", API web hello trust utente autenticato hello hello applicazione web.</span><span class="sxs-lookup"><span data-stu-id="2edf8-398">In this “application identity” flow, hello web API trusts that hello web application authenticated hello user.</span></span> <span data-ttu-id="2edf8-399">Per questo motivo il modello è definito sottosistema attendibile.</span><span class="sxs-lookup"><span data-stu-id="2edf8-399">For this reason, this pattern is called a trusted subsystem.</span></span> <span data-ttu-id="2edf8-400">Hello [diagramma in questa pagina](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) viene descritto come codice di autorizzazione è consentire il funzionamento del flusso.</span><span class="sxs-lookup"><span data-stu-id="2edf8-400">hello [diagram on this page](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) describes how authorization code grant flow works.</span></span>

<span data-ttu-id="2edf8-401">Acquisizione licenza con restrizione token, ci stiamo seguente hello stesso modello di sottosistema attendibile.</span><span class="sxs-lookup"><span data-stu-id="2edf8-401">In license acquisition with token restriction, we are following hello same trusted subsystem pattern.</span></span> <span data-ttu-id="2edf8-402">E servizio di recapito hello licenze in servizi multimediali di Azure è risorsa API web hello, hello "back-end resource" un'applicazione web deve tooaccess.</span><span class="sxs-lookup"><span data-stu-id="2edf8-402">And hello license delivery service in Azure Media Services is hello web API resource, hello “backend resource” a web application needs tooaccess.</span></span> <span data-ttu-id="2edf8-403">Pertanto, dove è il token di accesso di hello?</span><span class="sxs-lookup"><span data-stu-id="2edf8-403">So where is hello access token?</span></span>

<span data-ttu-id="2edf8-404">In realtà il token di accesso viene ottenuto da Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2edf8-404">Indeed, we are obtaining access token from Azure AD.</span></span> <span data-ttu-id="2edf8-405">Al termine dell'autenticazione utente, viene restituito il codice di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="2edf8-405">After successful user authentication, authorization code is returned.</span></span> <span data-ttu-id="2edf8-406">codice di autorizzazione Hello viene quindi utilizzato, insieme alle app e l'ID chiave client, tooexchange di token di accesso.</span><span class="sxs-lookup"><span data-stu-id="2edf8-406">hello authorization code is then used, together with client ID and app key, tooexchange for access token.</span></span> <span data-ttu-id="2edf8-407">E token di accesso hello è per l'accesso a un'applicazione di "puntatore" che punta oppure rappresentano servizio di distribuzione di licenze di servizi multimediali di Azure.</span><span class="sxs-lookup"><span data-stu-id="2edf8-407">And hello access token is for accessing a “pointer” application pointing or representing Azure Media Services license delivery service.</span></span>

<span data-ttu-id="2edf8-408">È necessario tooregister e configurare app "puntatore" hello in Azure AD eseguendo hello procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="2edf8-408">We need tooregister and configure hello “pointer” app in Azure AD by following hello steps below:</span></span>

1. <span data-ttu-id="2edf8-409">Nel tenant di hello Azure AD</span><span class="sxs-lookup"><span data-stu-id="2edf8-409">In hello Azure AD tenant</span></span>

   * <span data-ttu-id="2edf8-410">aggiungere un'applicazione (risorsa) con l'URL di accesso:</span><span class="sxs-lookup"><span data-stu-id="2edf8-410">add an application (resource) with sign-on URL:</span></span>

   <span data-ttu-id="2edf8-411">https://[nome_risorsa].azurewebsites.net/ e</span><span class="sxs-lookup"><span data-stu-id="2edf8-411">https://[resource_name].azurewebsites.net/ and</span></span>

   * <span data-ttu-id="2edf8-412">l'URL dell'ID app:</span><span class="sxs-lookup"><span data-stu-id="2edf8-412">app ID URL:</span></span>

   <span data-ttu-id="2edf8-413">https://[nome_tenant_aad].onmicrosoft.com/[nome_risorsa];</span><span class="sxs-lookup"><span data-stu-id="2edf8-413">https://[aad_tenant_name].onmicrosoft.com/[resource_name];</span></span>
2. <span data-ttu-id="2edf8-414">Aggiungere una nuova chiave per l'app risorse hello;</span><span class="sxs-lookup"><span data-stu-id="2edf8-414">Add a new key for hello resource app;</span></span>
3. <span data-ttu-id="2edf8-415">Aggiornare i file manifesto dell'applicazione hello in modo che disponga di proprietà groupMembershipClaims hello hello il valore seguente: "groupMembershipClaims": "All",</span><span class="sxs-lookup"><span data-stu-id="2edf8-415">Update hello app manifest file so that hello groupMembershipClaims property has hello following value: "groupMembershipClaims": "All",</span></span>  
4. <span data-ttu-id="2edf8-416">Nell'app di Azure AD hello verso toohello lettore web app, nella sezione hello "autorizzazioni tooother applicazioni", aggiungere hello risorsa app che è stato aggiunto nel passaggio 1 sopra.</span><span class="sxs-lookup"><span data-stu-id="2edf8-416">In hello Azure AD app pointing toohello player web app, in hello section “permissions tooother applications”, add hello resource app which was added in step 1 above.</span></span> <span data-ttu-id="2edf8-417">In "Autorizzazioni delegate" selezionare la casella di controllo "Accedi a [nome_risorsa]".</span><span class="sxs-lookup"><span data-stu-id="2edf8-417">Under “delegated permissions” check “Access [resource_name]” checkmark.</span></span> <span data-ttu-id="2edf8-418">In questo modo dell'autorizzazione dell'app web hello toocreate i token di accesso per l'accesso alle app risorse hello.</span><span class="sxs-lookup"><span data-stu-id="2edf8-418">This gives hello web app permission toocreate access tokens for accessing hello resource app.</span></span> <span data-ttu-id="2edf8-419">Eseguire questa operazione sia locali che distribuite versione di hello web app se si sviluppa con app web di Visual Studio e Azure.</span><span class="sxs-lookup"><span data-stu-id="2edf8-419">You should do this for both local and deployed version of hello web app if you are developing with Visual Studio and Azure web app.</span></span>

<span data-ttu-id="2edf8-420">Pertanto, token JWT hello emesso da Azure AD è effettivamente i token di accesso hello per accedere alla risorsa di tipo "puntatore".</span><span class="sxs-lookup"><span data-stu-id="2edf8-420">Therefore, hello JWT token issued by Azure AD is indeed hello access token for accessing this “pointer” resource.</span></span>

### <a name="what-about-live-streaming"></a><span data-ttu-id="2edf8-421">Come funziona lo streaming live?</span><span class="sxs-lookup"><span data-stu-id="2edf8-421">What about Live Streaming?</span></span>
<span data-ttu-id="2edf8-422">In hello precedente, la discussione si occupa della asset su richiesta.</span><span class="sxs-lookup"><span data-stu-id="2edf8-422">In hello above, our discussion has been focusing on on-demand assets.</span></span> <span data-ttu-id="2edf8-423">Come funziona lo streaming live?</span><span class="sxs-lookup"><span data-stu-id="2edf8-423">What about live streaming?</span></span>

<span data-ttu-id="2edf8-424">Hello buone notizie sono che è possibile utilizzare esattamente hello stessa progettazione e implementazione per la protezione di streaming in tempo reale in servizi multimediali di Azure, considerando asset hello associata a un programma come "asset VOD".</span><span class="sxs-lookup"><span data-stu-id="2edf8-424">hello good news is that you can use exactly hello same design and implementation for protecting live streaming in Azure Media Services, by treating hello asset associated with a program as a “VOD asset”.</span></span>

<span data-ttu-id="2edf8-425">In particolare, è noto che toodo live streaming con servizi multimediali di Azure, è necessario toocreate un canale, quindi un programma in canale hello.</span><span class="sxs-lookup"><span data-stu-id="2edf8-425">Specifically, it is well known that toodo live streaming in Azure Media Services, you need toocreate a channel, then a program under hello channel.</span></span> <span data-ttu-id="2edf8-426">programma hello toocreate, è necessario un asset che conterrà l'archivio in tempo reale di hello per programma hello toocreate.</span><span class="sxs-lookup"><span data-stu-id="2edf8-426">toocreate hello program, you need toocreate an asset which will contain hello live archive for hello program.</span></span> <span data-ttu-id="2edf8-427">In ordine tooprovide CENC con protezione multi-DRM contenuto hello in tempo reale, è sufficiente, toodo è tooapply hello stesso programma di installazione o l'elaborazione dei toohello asset come se fosse un asset"VOD" prima di avviare il programma hello.</span><span class="sxs-lookup"><span data-stu-id="2edf8-427">In order tooprovide CENC with multi-DRM protection of hello live content, all you need toodo, is tooapply hello same setup/processing toohello asset as if it was a “VOD asset” before you start hello program.</span></span>

### <a name="what-about-license-servers-outside-of-azure-media-services"></a><span data-ttu-id="2edf8-428">Come funzionano i server licenze al di fuori di Servizi multimediali di Azure?</span><span class="sxs-lookup"><span data-stu-id="2edf8-428">What about license servers outside of Azure Media Services?</span></span>
<span data-ttu-id="2edf8-429">I clienti spesso investono in una farm di server licenze nel proprio data center o ospitata da provider di servizi DRM.</span><span class="sxs-lookup"><span data-stu-id="2edf8-429">Often, customers may have invested in license server farm either in their own data center or hosted by DRM service providers.</span></span> <span data-ttu-id="2edf8-430">Fortunatamente, la protezione del contenuto di Azure Media Services consente toooperate in modalità ibrida: contenuto ospitato e protetti in modo dinamico in servizi multimediali di Azure, mentre le licenze DRM vengono recapitate dal server all'esterno di servizi multimediali di Azure.</span><span class="sxs-lookup"><span data-stu-id="2edf8-430">Fortunately, Azure Media Services Content Protection allows you toooperate in hybrid mode: contents hosted and dynamically protected in Azure Media Services, while DRM licenses are delivered by servers outside Azure Media Services.</span></span> <span data-ttu-id="2edf8-431">In questo caso, esistono hello seguenti considerazioni di modifiche:</span><span class="sxs-lookup"><span data-stu-id="2edf8-431">In this case, there are hello following considerations of changes:</span></span>

1. <span data-ttu-id="2edf8-432">Hello servizio Token di sicurezza esigenze tooissue i token che sono accettabili e possono essere verificati dalla farm di server licenze hello.</span><span class="sxs-lookup"><span data-stu-id="2edf8-432">hello Secure Token Service needs tooissue tokens which are acceptable and can be verified by hello license server farm.</span></span> <span data-ttu-id="2edf8-433">Ad esempio, i server delle licenze Widevine hello fornito da Axinom richiede un token JWT specifico che contiene "messaggio il diritto".</span><span class="sxs-lookup"><span data-stu-id="2edf8-433">For example, hello Widevine license servers provided by Axinom requires a specific JWT token which contains “entitlement message”.</span></span> <span data-ttu-id="2edf8-434">Pertanto, è necessario toohave tooissue un servizio token di sicurezza tali token JWT.</span><span class="sxs-lookup"><span data-stu-id="2edf8-434">Therefore, you need toohave an STS tooissue such JWT token.</span></span> <span data-ttu-id="2edf8-435">gli autori di Hello hanno completato un'implementazione di questo tipo e sono disponibili dettagli hello hello seguente documento in [Centro documentazione di Azure](https://azure.microsoft.com/documentation/): [toodeliver Axinom utilizzando Widevine licenze di servizi multimediali tooAzure](media-services-axinom-integration.md).</span><span class="sxs-lookup"><span data-stu-id="2edf8-435">hello authors have completed such an implementation and you can find hello details in hello following document in [Azure Documentation Center](https://azure.microsoft.com/documentation/): [Using Axinom toodeliver Widevine licenses tooAzure Media Services](media-services-axinom-integration.md).</span></span>
2. <span data-ttu-id="2edf8-436">Non è più necessario tooconfigure servizio di recapito licenza (ContentKeyAuthorizationPolicy) in servizi multimediali di Azure.</span><span class="sxs-lookup"><span data-stu-id="2edf8-436">You no longer need tooconfigure license delivery service (ContentKeyAuthorizationPolicy) in Azure Media Services.</span></span> <span data-ttu-id="2edf8-437">È necessario toodo è l'URL di acquisizione licenza hello tooprovide (per PlayReady, Widevine e FairPlay) quando si configura AssetDeliveryPolicy nell'impostazione CENC con multi-DRM.</span><span class="sxs-lookup"><span data-stu-id="2edf8-437">What you need toodo is tooprovide hello license acquisition URLs (for PlayReady, Widevine and FairPlay) when you configure AssetDeliveryPolicy in setting up CENC with multi-DRM.</span></span>

### <a name="what-if-i-want-toouse-a-custom-sts"></a><span data-ttu-id="2edf8-438">Cosa accade se si desidera toouse un servizio token di sicurezza personalizzato?</span><span class="sxs-lookup"><span data-stu-id="2edf8-438">What if I want toouse a custom STS?</span></span>
<span data-ttu-id="2edf8-439">Potrebbe esserci una serie di motivi che un cliente può scegliere toouse un STS personalizzato (servizio Token di sicurezza) per fornire i token JWT.</span><span class="sxs-lookup"><span data-stu-id="2edf8-439">There could be a few reasons that a customer may choose toouse a custom STS (Secure Token Service) for providing JWT tokens.</span></span> <span data-ttu-id="2edf8-440">Eccone alcuni:</span><span class="sxs-lookup"><span data-stu-id="2edf8-440">Some of them are:</span></span>

1. <span data-ttu-id="2edf8-441">Provider di identità (IDP) utilizzato dal cliente hello Hello non supporta servizio token di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="2edf8-441">hello Identity Provider (IDP) used by hello customer does not support STS.</span></span> <span data-ttu-id="2edf8-442">In questo caso un servizio token di sicurezza personalizzato può essere una soluzione.</span><span class="sxs-lookup"><span data-stu-id="2edf8-442">In this case a custom STS may be an option.</span></span>
2. <span data-ttu-id="2edf8-443">cliente Hello potrebbe essere necessario controllo più flessibile o una stretta integrazione servizio token di sicurezza con server di sottoscrizione del cliente sistema di fatturazione.</span><span class="sxs-lookup"><span data-stu-id="2edf8-443">hello customer may need more flexible or tighter control in integrating STS with customer’s subscriber billing system.</span></span> <span data-ttu-id="2edf8-444">Ad esempio, un operatore MVPD può offrire più pacchetti di sottoscrittore OTT come premium, basic, sport, operatore hello e così via. potrebbe essere toomatch hello attestazioni in un token con il pacchetto di un sottoscrittore in modo che solo contenuto nel pacchetto corretto hello viene reso disponibile.</span><span class="sxs-lookup"><span data-stu-id="2edf8-444">For example, an MVPD operator may offer multiple OTT subscriber packages such as premium, basic, sports, etc. hello operator may want toomatch hello claims in a token with a subscriber’s package so that only contents in hello right package is made available.</span></span> <span data-ttu-id="2edf8-445">In questo caso, un servizio token di sicurezza personalizzata fornisce hello necessari flessibilità e controllo.</span><span class="sxs-lookup"><span data-stu-id="2edf8-445">In this case, a custom STS provides hello needed flexibility and control.</span></span>

<span data-ttu-id="2edf8-446">Due modifiche necessario toobe apportate quando si utilizza un servizio token di sicurezza personalizzato:</span><span class="sxs-lookup"><span data-stu-id="2edf8-446">Two changes need toobe made when using a custom STS:</span></span>

1. <span data-ttu-id="2edf8-447">Quando si configura il servizio di recapito licenze per un asset, è necessario chiave di sicurezza hello toospecify utilizzata per la verifica dal servizio token personalizzata hello (ulteriori dettagli di seguito) anziché la chiave corrente di hello da Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="2edf8-447">When configuring license delivery service for an asset, you need toospecify hello security key used for verification by hello custom STS (more details below) instead of hello current key from Azure Active Directory.</span></span>
2. <span data-ttu-id="2edf8-448">Quando viene generato un token JTW, anziché la chiave privata di hello del certificato X509 corrente hello in Azure Active Directory viene specificata una chiave di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="2edf8-448">When a JTW token is generated, a security key is specified instead of hello private key of hello current X509 certificate in Azure Active Directory.</span></span>

<span data-ttu-id="2edf8-449">Esistono due tipi di chiavi di sicurezza:</span><span class="sxs-lookup"><span data-stu-id="2edf8-449">There are two types of security keys:</span></span>

1. <span data-ttu-id="2edf8-450">Chiave simmetrica: hello stessa chiave verrà usata per la generazione e la verifica di un token JWT.</span><span class="sxs-lookup"><span data-stu-id="2edf8-450">Symmetric key: hello same key is used for both generating and verifying a JWT token;</span></span>
2. <span data-ttu-id="2edf8-451">Chiave asimmetrica: una coppia di chiavi pubblica / privata in un certificato viene usato con la chiave privata per la crittografia o la generazione di un JWT hello e token di chiave pubblica per verifica token hello di X509.</span><span class="sxs-lookup"><span data-stu-id="2edf8-451">Asymmetric key: a public-private key pair in an X509 certificate is used with private key for encrypting/generating a JWT token and hello public key for verifying hello token.</span></span>

#### <a name="tech-note"></a><span data-ttu-id="2edf8-452">Nota tecnica</span><span class="sxs-lookup"><span data-stu-id="2edf8-452">Tech note</span></span>
<span data-ttu-id="2edf8-453">Se si utilizza .NET Framework / c# come piattaforma di sviluppo, hello X509 certificato utilizzato per la chiave di sicurezza asimmetrica deve avere una lunghezza della chiave almeno 2048.</span><span class="sxs-lookup"><span data-stu-id="2edf8-453">If you use .NET Framework/C# as your development platform, hello X509 certificate used for asymmetric security key must have key length at least 2048.</span></span> <span data-ttu-id="2edf8-454">Questo è un requisito della classe hello System.IdentityModel.Tokens.X509AsymmetricSecurityKey in .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="2edf8-454">This is a requirement of hello class System.IdentityModel.Tokens.X509AsymmetricSecurityKey in .NET Framework.</span></span> <span data-ttu-id="2edf8-455">In caso contrario, verrà generata l'eccezione seguente hello:</span><span class="sxs-lookup"><span data-stu-id="2edf8-455">Otherwise, hello following exception will be thrown:</span></span>

<span data-ttu-id="2edf8-456">IDX10630: hello 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' per la firma non può essere minore di '2048' bit.</span><span class="sxs-lookup"><span data-stu-id="2edf8-456">IDX10630: hello 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' for signing cannot be smaller than '2048' bits.</span></span>

## <a name="hello-completed-system-and-test"></a><span data-ttu-id="2edf8-457">test e sistema di hello completata</span><span class="sxs-lookup"><span data-stu-id="2edf8-457">hello completed system and test</span></span>
<span data-ttu-id="2edf8-458">Esamineremo alcuni scenari nel sistema end-to-end hello completata in modo che i lettori possono avere un' "immagine" del comportamento di hello basic prima di ottenere un account di accesso.</span><span class="sxs-lookup"><span data-stu-id="2edf8-458">We will walk through a few scenarios in hello completed end-to-end system so that readers can have a basic “picture” of hello behavior before getting a login account.</span></span>

<span data-ttu-id="2edf8-459">Hello applicazione web di Windows Media player e del relativo account di accesso sono disponibili [qui](https://openidconnectweb.azurewebsites.net/).</span><span class="sxs-lookup"><span data-stu-id="2edf8-459">hello player web application and its login can be found [here](https://openidconnectweb.azurewebsites.net/).</span></span>

<span data-ttu-id="2edf8-460">Se è necessario è "non integrata" scenario: risorse video ospitati in servizi multimediali di Azure che sono uno non protetto o protetto DRM ma senza l'autenticazione con token (un toowhoever di licenza con la richiesta di rilascio), è possibile eseguirne il test senza account di accesso (passando tooHTTP se il flusso di dati video su HTTP).</span><span class="sxs-lookup"><span data-stu-id="2edf8-460">If what you need is “non-integrated” scenario: video assets hosted in Azure Media Services which are either unprotected, or DRM protected but without token authentication (issuing a license toowhoever requesting it), you can test it without login (by switching tooHTTP if your video streaming is over HTTP).</span></span>

<span data-ttu-id="2edf8-461">Se è necessario scenari end-to-end di installazione integrata: risorse video è dinamica DRM la protezione dati in servizi multimediali di Azure, con l'autenticazione del token e il token JWT viene generato da Azure AD, è necessario toologin.</span><span class="sxs-lookup"><span data-stu-id="2edf8-461">If what you need is end-to-end integrated scenario: video assets is under dynamic DRM protection in Azure Media Services, with token authentication and JWT token being generated by Azure AD, you need toologin.</span></span>

### <a name="user-login"></a><span data-ttu-id="2edf8-462">Accesso utente</span><span class="sxs-lookup"><span data-stu-id="2edf8-462">User login</span></span>
<span data-ttu-id="2edf8-463">In ordine tootest hello end-to-end integrato sistema DRM, è necessario toohave un "account" creati o aggiunti.</span><span class="sxs-lookup"><span data-stu-id="2edf8-463">In order tootest hello end-to-end integrated DRM system, you need toohave an “account” created or added.</span></span>

<span data-ttu-id="2edf8-464">Quale account?</span><span class="sxs-lookup"><span data-stu-id="2edf8-464">What account?</span></span>

<span data-ttu-id="2edf8-465">Anche se in origine l'accesso ad Azure era consentito solo agli utenti con account Microsoft, ora è invece consentito l'accesso agli utenti di entrambi i sistemi.</span><span class="sxs-lookup"><span data-stu-id="2edf8-465">Although Azure originally allowed access only by Microsoft account users, it now allows access by users from both systems.</span></span> <span data-ttu-id="2edf8-466">Questa operazione viene eseguita con tutti i trust di Azure di proprietà hello Azure AD per l'autenticazione con Azure AD autenticare gli utenti dell'organizzazione e la creazione di una relazione di federazione in cui Azure AD considera attendibile il sistema identità utente di hello Microsoft account tooauthenticate degli utenti.</span><span class="sxs-lookup"><span data-stu-id="2edf8-466">This was done by having all hello Azure properties trust Azure AD for authentication, having Azure AD authenticate organizational users, and by creating a federation relationship where Azure AD trusts hello Microsoft account consumer identity system tooauthenticate consumer users.</span></span> <span data-ttu-id="2edf8-467">Di conseguenza, Azure AD è tooauthenticate in grado di account di Microsoft "guest", nonché account di Azure AD "nativo".</span><span class="sxs-lookup"><span data-stu-id="2edf8-467">As a result, Azure AD is able tooauthenticate “guest” Microsoft accounts as well as “native” Azure AD accounts.</span></span>

<span data-ttu-id="2edf8-468">Poiché Azure AD considera attendibile il dominio Account Microsoft (MSA), è possibile aggiungere qualsiasi account da uno qualsiasi dei seguenti domini toohello personalizzato AD Azure hello tenant e utilizzare toologin account hello:</span><span class="sxs-lookup"><span data-stu-id="2edf8-468">Since Azure AD trusts Microsoft Account (MSA) domain, you can add any accounts from any of hello following domains toohello custom Azure AD tenant and use hello account toologin:</span></span>

| <span data-ttu-id="2edf8-469">**Nome di dominio**</span><span class="sxs-lookup"><span data-stu-id="2edf8-469">**Domain Name**</span></span> | <span data-ttu-id="2edf8-470">**Dominio**</span><span class="sxs-lookup"><span data-stu-id="2edf8-470">**Domain**</span></span> |
| --- | --- |
| <span data-ttu-id="2edf8-471">**Dominio del tenant di Azure AD personalizzato**</span><span class="sxs-lookup"><span data-stu-id="2edf8-471">**Custom Azure AD tenant domain**</span></span> |<span data-ttu-id="2edf8-472">nome.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="2edf8-472">somename.onmicrosoft.com</span></span> |
| <span data-ttu-id="2edf8-473">**Dominio aziendale**</span><span class="sxs-lookup"><span data-stu-id="2edf8-473">**Corporate domain**</span></span> |<span data-ttu-id="2edf8-474">microsoft.com</span><span class="sxs-lookup"><span data-stu-id="2edf8-474">microsoft.com</span></span> |
| <span data-ttu-id="2edf8-475">**Dominio account Microsoft (MSA)**</span><span class="sxs-lookup"><span data-stu-id="2edf8-475">**Microsoft Account (MSA) domain**</span></span> |<span data-ttu-id="2edf8-476">outlook.com, live.com, hotmail.com</span><span class="sxs-lookup"><span data-stu-id="2edf8-476">outlook.com, live.com, hotmail.com</span></span> |

<span data-ttu-id="2edf8-477">È possibile contattare uno qualsiasi dei hello autori toohave un account creati o aggiunti automaticamente.</span><span class="sxs-lookup"><span data-stu-id="2edf8-477">You may contact any of hello authors toohave an account created or added for you.</span></span>

<span data-ttu-id="2edf8-478">Di seguito sono riportati screenshot hello di pagine di diversi account di accesso utilizzate da diversi account di dominio.</span><span class="sxs-lookup"><span data-stu-id="2edf8-478">Below are hello screenshots of different login pages used by different domain accounts.</span></span>

<span data-ttu-id="2edf8-479">**Account di dominio del tenant AD Azure personalizzato**: In questo caso, si vedere pagina di accesso personalizzata hello del dominio tenant hello personalizzato AD Azure.</span><span class="sxs-lookup"><span data-stu-id="2edf8-479">**Custom Azure AD tenant domain account**: In this case, you see hello customized login page of hello custom Azure AD tenant domain.</span></span>

![Account dominio del tenant di Azure AD personalizzato](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain1.png)

<span data-ttu-id="2edf8-481">**Account di dominio di Microsoft con smart card**: In questo caso si vedere pagina di accesso hello personalizzata da aziendale di Microsoft IT con l'autenticazione a due fattori.</span><span class="sxs-lookup"><span data-stu-id="2edf8-481">**Microsoft domain account with smart card**: In this case you see hello login page customized by Microsoft corporate IT with two-factor authentication.</span></span>

![Account dominio del tenant di Azure AD personalizzato](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain2.png)

<span data-ttu-id="2edf8-483">**Account Microsoft (MSA)**: In questo caso, si vedere la pagina di accesso hello dell'Account Microsoft per i consumer.</span><span class="sxs-lookup"><span data-stu-id="2edf8-483">**Microsoft Account (MSA)**: In this case, you see hello login page of Microsoft Account for consumers.</span></span>

![Account dominio del tenant di Azure AD personalizzato](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain3.png)

### <a name="using-encrypted-media-extensions-for-playready"></a><span data-ttu-id="2edf8-485">Uso di Encrypted Media Extensions per PlayReady</span><span class="sxs-lookup"><span data-stu-id="2edf8-485">Using Encrypted Media Extensions for PlayReady</span></span>
<span data-ttu-id="2edf8-486">In un browser moderno con crittografati supporti le estensioni (EME) per il supporto, ad esempio i browser Internet Explorer 11 su Windows 8.1 e successive e Microsoft Edge in Windows 10, PlayReady sarà PlayReady hello DRM sottostante per EME.</span><span class="sxs-lookup"><span data-stu-id="2edf8-486">On a modern browser with Encrypted Media Extensions (EME) for PlayReady support, such as IE 11 on Windows 8.1 and up, and Microsoft Edge browser on Windows 10, PlayReady will be hello underlying DRM for EME.</span></span>

![Uso di EME per PlayReady](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready1.png)

<span data-ttu-id="2edf8-488">a causa delle tabelle dei fatti toohello tale protezione PlayReady impedisce l'uno dall'acquisizione schermo di video protetto effettua l'area di Windows Media player scuro Hello è.</span><span class="sxs-lookup"><span data-stu-id="2edf8-488">hello dark player area is due toohello fact that PlayReady protection prevents one from making screen capture of protected video.</span></span>

<span data-ttu-id="2edf8-489">Hello schermata seguente mostra i plug-in Windows Media player hello e supporto MSE/EME.</span><span class="sxs-lookup"><span data-stu-id="2edf8-489">hello following screen shows hello player plugins and MSE/EME support.</span></span>

![Uso di EME per PlayReady](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready2.png)

<span data-ttu-id="2edf8-491">EME in Microsoft Edge e IE 11 in Windows 10 consente di chiamare [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) sui dispositivi Windows 10 che lo supportano.</span><span class="sxs-lookup"><span data-stu-id="2edf8-491">EME in Microsoft Edge and IE 11 on Windows 10 allows invoking of [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) on Windows 10 devices which support it.</span></span> <span data-ttu-id="2edf8-492">PlayReady SL3000 Sblocca flusso hello del contenuto premium migliorate (4 KB, HDR, e così via) e i nuovi modelli di distribuzione di contenuti (finestra iniziale per il contenuto avanzata).</span><span class="sxs-lookup"><span data-stu-id="2edf8-492">PlayReady SL3000 unlocks hello flow of enhanced premium content (4K, HDR, etc.) and new content delivery models (early window for Enhanced Content).</span></span>

<span data-ttu-id="2edf8-493">Concentrarsi sui dispositivi Windows hello: PlayReady è hello solo DRM in HW hello disponibili nei dispositivi Windows (PlayReady SL3000).</span><span class="sxs-lookup"><span data-stu-id="2edf8-493">Focus on hello Windows devices: PlayReady is hello only DRM in hello HW available on Windows devices (PlayReady SL3000).</span></span> <span data-ttu-id="2edf8-494">Un servizio di streaming può usare PlayReady tramite EME o un'applicazione UWP e offrire una migliore qualità video usando PlayReady SL3000 anziché un altro DRM.</span><span class="sxs-lookup"><span data-stu-id="2edf8-494">A streaming service can use PlayReady through EME or through a UWP application and offer a higher video quality using PlayReady SL3000 than another DRM.</span></span> <span data-ttu-id="2edf8-495">In genere, tramite Chrome o Firefox del flusso del contenuto di 2 KB e 4 K contenuto tramite Microsoft Edge/IE11 o un'applicazione UWP in hello stesso dispositivo (a seconda delle impostazioni di servizio e nell'implementazione).</span><span class="sxs-lookup"><span data-stu-id="2edf8-495">Typically, 2K content will flow through Chrome or Firefox, and 4K content through Microsoft Edge/IE11 or a UWP application on hello same device (depending on service settings and implementation).</span></span>

#### <a name="using-eme-for-widevine"></a><span data-ttu-id="2edf8-496">Uso di EME per Widevine</span><span class="sxs-lookup"><span data-stu-id="2edf8-496">Using EME for Widevine</span></span>
<span data-ttu-id="2edf8-497">In un browser moderno grazie al supporto EME/Widevine, ad esempio Chrome 41 + in Windows 10, Windows 8.1, Mac OSX Yosemite e Chrome in Android 4.4.4, Google Widevine è hello DRM dietro EME.</span><span class="sxs-lookup"><span data-stu-id="2edf8-497">On a modern browser with EME/Widevine support, such as Chrome 41+ on Windows 10, Windows 8.1, Mac OSX Yosemite, and Chrome on Android 4.4.4, Google Widevine is hello DRM behind EME.</span></span>

![Uso di EME per Widevine](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine1.png)

<span data-ttu-id="2edf8-499">Si noti che Widevine non impedisce di acquisire schermate da un video protetto.</span><span class="sxs-lookup"><span data-stu-id="2edf8-499">Notice that Widevine does not prevent one from making screen capture of protected video.</span></span>

![Uso di EME per Widevine](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine2.png)

### <a name="not-entitled-users"></a><span data-ttu-id="2edf8-501">Utenti non idonei</span><span class="sxs-lookup"><span data-stu-id="2edf8-501">Not entitled users</span></span>
<span data-ttu-id="2edf8-502">Se un utente non è un membro del gruppo "Utenti intitolata", hello non sarà in grado di toopass "Controlla il diritto" e il servizio licenze multi-DRM hello rifiuterà tooissue hello richiesta licenza come illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="2edf8-502">If a user is not a member of "Entitled Users" group, hello user will not be able toopass “entitlement check” and hello multi-DRM license service will refuse tooissue hello requested license as shown below.</span></span> <span data-ttu-id="2edf8-503">Hello dettagliate descrizione è "acquisire licenze non riuscita", che è quello previsto.</span><span class="sxs-lookup"><span data-stu-id="2edf8-503">hello detailed description is “License acquire failed”, which is as designed.</span></span>

![Utenti non idonei](./media/media-services-cenc-with-multidrm-access-control/media-services-unentitledusers.png)

### <a name="running-custom-secure-token-service"></a><span data-ttu-id="2edf8-505">Esecuzione del servizio token di sicurezza personalizzato</span><span class="sxs-lookup"><span data-stu-id="2edf8-505">Running custom Secure Token Service</span></span>
<span data-ttu-id="2edf8-506">Scenario di hello di esecuzione personalizzato Secure Token Service (STS), hello JWT verrà emesso alcun token dal servizio token di sicurezza personalizzata hello tramite chiave simmetrica o asimmetrica.</span><span class="sxs-lookup"><span data-stu-id="2edf8-506">For hello scenario of running custom Secure Token Service (STS), hello JWT token will be issued by hello custom STS using either symmetric or asymmetric key.</span></span>

<span data-ttu-id="2edf8-507">caso Hello di utilizzando la chiave simmetrica (con Chrome):</span><span class="sxs-lookup"><span data-stu-id="2edf8-507">hello case of using symmetric key (using Chrome):</span></span>

![Esecuzione del servizio token di sicurezza personalizzato](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts1.png)

<span data-ttu-id="2edf8-509">caso di utilizzo chiave asimmetrica tramite un X509 Hello (tramite browser moderno Microsoft) del certificato.</span><span class="sxs-lookup"><span data-stu-id="2edf8-509">hello case of using asymmetric key via an X509 certificate (using Microsoft modern browser).</span></span>

![Esecuzione del servizio token di sicurezza personalizzato](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts2.png)

<span data-ttu-id="2edf8-511">In entrambi hello sopra i casi, l'autenticazione utente mantiene invariato: hello tramite Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2edf8-511">In both of hello above cases, user authentication stays hello same – through Azure AD.</span></span> <span data-ttu-id="2edf8-512">Hello unica differenza è che i token JWT vengono emessi da hello STS personalizzato invece di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2edf8-512">hello only difference is that JWT tokens are issued by hello custom STS instead of Azure AD.</span></span> <span data-ttu-id="2edf8-513">Naturalmente, quando si configura la protezione CENC dinamica, restrizione hello del servizio di recapito licenza specifica il tipo di hello del token JWT, la chiave simmetrica o asimmetrica.</span><span class="sxs-lookup"><span data-stu-id="2edf8-513">Of course, when configuring dynamic CENC protection, hello restriction of license delivery service specifies hello type of JWT token, either symmetric or asymmetric key.</span></span>

## <a name="summary"></a><span data-ttu-id="2edf8-514">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="2edf8-514">Summary</span></span>
<span data-ttu-id="2edf8-515">In questo documento è stata illustrata la crittografia CENC con DRM nativo multiplo e il controllo di accesso tramite l'autenticazione token: la progettazione e l'implementazione con Azure, Servizi multimediali di Azure e Azure Media Player.</span><span class="sxs-lookup"><span data-stu-id="2edf8-515">In this document, we discussed CENC with multi-native-DRM and access control via token authentication: its design and its implementation using Azure, Azure Media Services and Azure Media Player.</span></span>

* <span data-ttu-id="2edf8-516">Viene presentato un progetto di riferimento che contiene tutti i componenti necessari di hello in un sottosistema DRM/CENC;</span><span class="sxs-lookup"><span data-stu-id="2edf8-516">A reference design is presented which contains all hello necessary components in a DRM/CENC subsystem;</span></span>
* <span data-ttu-id="2edf8-517">Implementazione di riferimento in Azure, Servizi multimediali di Azure e Azure Media Player.</span><span class="sxs-lookup"><span data-stu-id="2edf8-517">A reference implementation on Azure, Azure Media Services and Azure Media Player.</span></span>
* <span data-ttu-id="2edf8-518">Vengono descritte anche alcuni argomenti partecipano hello progettazione e implementazione.</span><span class="sxs-lookup"><span data-stu-id="2edf8-518">Some topics directly involved in hello design and implementation are also discussed.</span></span>

## <a name="media-services-learning-paths"></a><span data-ttu-id="2edf8-519">Percorsi di apprendimento di Servizi multimediali</span><span class="sxs-lookup"><span data-stu-id="2edf8-519">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="2edf8-520">Fornire commenti e suggerimenti</span><span class="sxs-lookup"><span data-stu-id="2edf8-520">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]
 
