---
title: aaaDeploy connesso nel gruppo di Azure IoT gateway factory | Documenti Microsoft
description: "Modalità di connessione delle factory toodeploy un gateway in Windows o Linux toohello connettività tooenable preconfigurato soluzione."
services: 
suite: iot-suite
documentationcenter: na
author: dominicbetts
manager: timlt
editor: 
ms.service: iot-suite
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/24/2017
ms.author: dobett
ms.openlocfilehash: 72436dec60eda0de20143f362fe740b0c4412f36
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="deploy-a-gateway-on-windows-or-linux-for-hello-connected-factory-preconfigured-solution"></a><span data-ttu-id="5e211-103">Distribuire un gateway in Windows o Linux per la soluzione factory preconfigurato hello connesso</span><span class="sxs-lookup"><span data-stu-id="5e211-103">Deploy a gateway on Windows or Linux for hello connected factory preconfigured solution</span></span>

<span data-ttu-id="5e211-104">Hello software necessario toodeploy un gateway per la soluzione factory preconfigurato hello connesso include due componenti:</span><span class="sxs-lookup"><span data-stu-id="5e211-104">hello software required toodeploy a gateway for hello connected factory preconfigured solution has two components:</span></span>

* <span data-ttu-id="5e211-105">Hello *OPC Proxy* stabilisce un tooIoT connessione Hub.</span><span class="sxs-lookup"><span data-stu-id="5e211-105">hello *OPC Proxy* establishes a connection tooIoT Hub.</span></span> <span data-ttu-id="5e211-106">Hello *OPC Proxy* quindi attende i messaggi di comando e controllo da hello integrate OPC Browser che viene eseguita nel portale di soluzione hello factory connesso.</span><span class="sxs-lookup"><span data-stu-id="5e211-106">hello *OPC Proxy* then waits for command and control messages from hello integrated OPC Browser that runs in hello connected factory solution portal.</span></span>
* <span data-ttu-id="5e211-107">Hello *Publisher OPC* connette tooexisting locale OPC UA server e inoltra i messaggi di dati di telemetria da essi tooIoT Hub.</span><span class="sxs-lookup"><span data-stu-id="5e211-107">hello *OPC Publisher* connects tooexisting on-premises OPC UA servers and forwards telemetry messages from them tooIoT Hub.</span></span>

<span data-ttu-id="5e211-108">Entrambi i componenti sono open source e disponibili come origine in GitHub e come contenitori di Docker:</span><span class="sxs-lookup"><span data-stu-id="5e211-108">Both components are open-source and are available as source on GitHub and as Docker containers:</span></span>

| <span data-ttu-id="5e211-109">GitHub</span><span class="sxs-lookup"><span data-stu-id="5e211-109">GitHub</span></span> | <span data-ttu-id="5e211-110">DockerHub</span><span class="sxs-lookup"><span data-stu-id="5e211-110">DockerHub</span></span> |
| ------ | --------- |
| <span data-ttu-id="5e211-111">[Server di pubblicazione OPC][lnk-publisher-github]</span><span class="sxs-lookup"><span data-stu-id="5e211-111">[OPC Publisher][lnk-publisher-github]</span></span> | <span data-ttu-id="5e211-112">[Server di pubblicazione OPC][lnk-publisher-docker]</span><span class="sxs-lookup"><span data-stu-id="5e211-112">[OPC Publisher][lnk-publisher-docker]</span></span> |
| <span data-ttu-id="5e211-113">[Proxy OPC][lnk-proxy-github]</span><span class="sxs-lookup"><span data-stu-id="5e211-113">[OPC Proxy][lnk-proxy-github]</span></span> | <span data-ttu-id="5e211-114">[Proxy OPC][lnk-proxy-docker]</span><span class="sxs-lookup"><span data-stu-id="5e211-114">[OPC Proxy][lnk-proxy-docker]</span></span> |

<span data-ttu-id="5e211-115">Nessun indirizzo IP pubblico o problemi di firewall gateway hello sono necessari per uno dei due componenti.</span><span class="sxs-lookup"><span data-stu-id="5e211-115">No public-facing IP address or holes in hello gateway firewall are required for either component.</span></span> <span data-ttu-id="5e211-116">Hello OPC Proxy e server di pubblicazione OPC utilizzare solo le porte in uscita 443, 5671 e 8883.</span><span class="sxs-lookup"><span data-stu-id="5e211-116">hello OPC Proxy and OPC Publisher use only outbound ports 443, 5671, and 8883.</span></span>

<span data-ttu-id="5e211-117">Hello passaggi in questo articolo viene illustrato come toodeploy un gateway uno usando Docker [Windows](#windows-deployment) o [Linux](#linux-deployment).</span><span class="sxs-lookup"><span data-stu-id="5e211-117">hello steps in this article show you how toodeploy a gateway using Docker on either [Windows](#windows-deployment) or [Linux](#linux-deployment).</span></span> <span data-ttu-id="5e211-118">gateway di Hello consente soluzione di connettività toohello connesso factory preconfigurato.</span><span class="sxs-lookup"><span data-stu-id="5e211-118">hello gateway enables connectivity toohello connected factory preconfigured solution.</span></span>

> [!NOTE]
> <span data-ttu-id="5e211-119">il software gateway Hello viene eseguita nel contenitore Docker hello è [Azure IoT Edge].</span><span class="sxs-lookup"><span data-stu-id="5e211-119">hello gateway software that runs in hello Docker container is [Azure IoT Edge].</span></span>

## <a name="windows-deployment"></a><span data-ttu-id="5e211-120">Distribuzione in Windows</span><span class="sxs-lookup"><span data-stu-id="5e211-120">Windows deployment</span></span>

> [!NOTE]
> <span data-ttu-id="5e211-121">Se non si ha ancora un dispositivo gateway, Microsoft consiglia di acquistare un gateway commerciale da uno dei partner.</span><span class="sxs-lookup"><span data-stu-id="5e211-121">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="5e211-122">Visitare hello [catalogo dispositivi Azure IoT] per un elenco di dispositivi gateway compatibili con hello connesso soluzione factory.</span><span class="sxs-lookup"><span data-stu-id="5e211-122">Visit hello [Azure IoT device catalog] for a list of gateway devices compatible with hello connected factory solution.</span></span> <span data-ttu-id="5e211-123">Seguire le istruzioni di hello forniti con hello dispositivo tooset di gateway hello.</span><span class="sxs-lookup"><span data-stu-id="5e211-123">Follow hello instructions that come with hello device tooset up hello gateway.</span></span> <span data-ttu-id="5e211-124">In alternativa, utilizzare hello seguendo le istruzioni toomanually impostare uno dei gateway esistente.</span><span class="sxs-lookup"><span data-stu-id="5e211-124">Alternatively, use hello following instructions toomanually set up one of your existing gateways.</span></span>

### <a name="install-docker"></a><span data-ttu-id="5e211-125">Installare Docker</span><span class="sxs-lookup"><span data-stu-id="5e211-125">Install Docker</span></span>

<span data-ttu-id="5e211-126">Installare [Docker per Windows] nel dispositivo gateway basato su Windows.</span><span class="sxs-lookup"><span data-stu-id="5e211-126">Install [Docker for Windows] on your Windows-based gateway device.</span></span> <span data-ttu-id="5e211-127">Durante l'installazione di Docker di Windows, selezionare un'unità il tooshare macchina host con Docker.</span><span class="sxs-lookup"><span data-stu-id="5e211-127">During Windows Docker setup, select a drive on your host machine tooshare with Docker.</span></span> <span data-ttu-id="5e211-128">Hello seguente schermata mostra la condivisione di unità D hello sul sistema di Windows:</span><span class="sxs-lookup"><span data-stu-id="5e211-128">hello following screenshot shows sharing hello D drive on your Windows system:</span></span>

![Installare Docker][img-install-docker]

<span data-ttu-id="5e211-130">Quindi creare una cartella denominata **docker** nella radice di hello di hello le unità condivise.</span><span class="sxs-lookup"><span data-stu-id="5e211-130">Then create a folder called **docker** in hello root of hello shared drive.</span></span>
<span data-ttu-id="5e211-131">È anche possibile eseguire questo passaggio dopo l'installazione di docker da hello **impostazioni** menu.</span><span class="sxs-lookup"><span data-stu-id="5e211-131">You can also perform this step after installing docker from hello **Settings** menu.</span></span>

### <a name="configure-hello-gateway"></a><span data-ttu-id="5e211-132">Configurare il gateway hello</span><span class="sxs-lookup"><span data-stu-id="5e211-132">Configure hello gateway</span></span>

1. <span data-ttu-id="5e211-133">È necessario hello **iothubowner** stringa di connessione del gruppo di IoT di Azure connessa factory distribuzione toocomplete hello gateway distribuzione.</span><span class="sxs-lookup"><span data-stu-id="5e211-133">You need hello **iothubowner** connection string of your Azure IoT Suite connected factory deployment toocomplete hello gateway deployment.</span></span> <span data-ttu-id="5e211-134">In hello [portale di Azure], passare tooyour IoT Hub nel gruppo di risorse hello creato per la distribuzione di soluzioni factory hello connesso.</span><span class="sxs-lookup"><span data-stu-id="5e211-134">In hello [Azure portal], navigate tooyour IoT Hub in hello resource group created when you deployed hello connected factory solution.</span></span> <span data-ttu-id="5e211-135">Fare clic su **criteri di accesso condiviso** tooaccess hello **iothubowner** stringa di connessione:</span><span class="sxs-lookup"><span data-stu-id="5e211-135">Click **Shared access policies** tooaccess hello **iothubowner** connection string:</span></span>

    ![Trovare la stringa di connessione IoT Hub hello][img-hub-connection]

    <span data-ttu-id="5e211-137">Hello copia **stringa di connessione - chiave primaria** valore.</span><span class="sxs-lookup"><span data-stu-id="5e211-137">Copy hello **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="5e211-138">Configurare il gateway di hello per l'IoT Hub eseguendo i moduli di hello due gateway **una volta** da un prompt dei comandi con:</span><span class="sxs-lookup"><span data-stu-id="5e211-138">Configure hello gateway for your IoT Hub by running hello two gateway modules **once** from a command prompt with:</span></span>

    `docker run -it --rm -h <ApplicationName> -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="5e211-139">**&lt;ApplicationName&gt;**  è hello Nome toogive tooyour OPC UA Publisher in formato hello **server di pubblicazione.&lt; il nome di dominio completo&gt;**.</span><span class="sxs-lookup"><span data-stu-id="5e211-139">**&lt;ApplicationName&gt;** is hello name toogive tooyour OPC UA Publisher in hello format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="5e211-140">Ad esempio, se la rete factory viene chiamata **myfactorynetwork.com**, hello **ApplicationName** valore **publisher.myfactorynetwork.com**.</span><span class="sxs-lookup"><span data-stu-id="5e211-140">For example, if your factory network is called **myfactorynetwork.com**, hello **ApplicationName** value is **publisher.myfactorynetwork.com**.</span></span>
    * <span data-ttu-id="5e211-141">**&lt;IoTHubOwnerConnectionString&gt;**  è hello **iothubowner** stringa di connessione è stato copiato nel passaggio precedente hello.</span><span class="sxs-lookup"><span data-stu-id="5e211-141">**&lt;IoTHubOwnerConnectionString&gt;** is hello **iothubowner** connection string you copied in hello previous step.</span></span> <span data-ttu-id="5e211-142">La stringa di connessione viene utilizzata solo in questo passaggio, non è necessario in hello alla procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="5e211-142">This connection string is only used in this step, you don’t need it in hello following steps:</span></span>

    <span data-ttu-id="5e211-143">Utilizzare hello mappato d:\\cartella docker (hello `-v` argomento) toopersist successive hello due certificati x. 509 che utilizzano moduli di hello gateway.</span><span class="sxs-lookup"><span data-stu-id="5e211-143">You use hello mapped D:\\docker folder (hello `-v` argument) later toopersist hello two X.509 certificates that hello gateway modules use.</span></span>

### <a name="run-hello-gateway"></a><span data-ttu-id="5e211-144">Eseguire hello gateway</span><span class="sxs-lookup"><span data-stu-id="5e211-144">Run hello gateway</span></span>

1. <span data-ttu-id="5e211-145">Riavviare il gateway di hello tramite hello seguenti comandi:</span><span class="sxs-lookup"><span data-stu-id="5e211-145">Restart hello gateway using hello following commands:</span></span>

    `docker run -it --rm -h <ApplicationName> --expose 62222 -p 62222:62222 -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/shared -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="5e211-146">Per motivi di sicurezza, i certificati x. 509 hello due persistente nell'unità d: hello\\cartella docker contiene la chiave privata di hello.</span><span class="sxs-lookup"><span data-stu-id="5e211-146">For security reasons, hello two X.509 certificates persisted in hello D:\\docker folder contain hello private key.</span></span> <span data-ttu-id="5e211-147">Limitare le credenziali di accesso toothis cartella toohello (in genere **amministratori**) si utilizza toorun hello Docker contenitore.</span><span class="sxs-lookup"><span data-stu-id="5e211-147">Limit access toothis folder toohello credentials (typically **Administrators**) you use toorun hello Docker container.</span></span> <span data-ttu-id="5e211-148">Pulsante destro del mouse hello d:\\cartella docker, scegliere **proprietà**, quindi **sicurezza**e quindi **modifica**.</span><span class="sxs-lookup"><span data-stu-id="5e211-148">Right-click hello D:\\docker folder, choose **Properties**, then **Security**, and then **Edit**.</span></span> <span data-ttu-id="5e211-149">Assegnare ad **Administrators** (Amministratori) il controllo completo e rimuovere tutti gli altri utenti:</span><span class="sxs-lookup"><span data-stu-id="5e211-149">Give **Administrators** full control and remove everyone else:</span></span>

    ![Condivisione di concedere autorizzazioni tooDocker][img-docker-share]

1. <span data-ttu-id="5e211-151">Verificare la connettività di rete.</span><span class="sxs-lookup"><span data-stu-id="5e211-151">Verify network connectivity.</span></span> <span data-ttu-id="5e211-152">Da un prompt dei comandi, immettere il comando di hello `ping publisher.<your fully qualified domain name>` tooping il gateway.</span><span class="sxs-lookup"><span data-stu-id="5e211-152">From a command prompt, enter hello command `ping publisher.<your fully qualified domain name>` tooping your gateway.</span></span> <span data-ttu-id="5e211-153">Se la destinazione hello è raggiungibile, aggiungere l'indirizzo IP hello e il nome del file host gateway toohello sul gateway.</span><span class="sxs-lookup"><span data-stu-id="5e211-153">If hello destination is unreachable, add hello IP address and name of your gateway toohello hosts file on your gateway.</span></span> <span data-ttu-id="5e211-154">file hosts di Hello è disponibile in hello **Windows\\System32\\driver\\via** cartella.</span><span class="sxs-lookup"><span data-stu-id="5e211-154">hello hosts file is located in hello **Windows\\System32\\drivers\\etc** folder.</span></span>

1. <span data-ttu-id="5e211-155">Successivamente, provare a tooconnect toohello server di pubblicazione utilizzando un client OPC UA locale che esegue gateway hello.</span><span class="sxs-lookup"><span data-stu-id="5e211-155">Next, try tooconnect toohello publisher using a local OPC UA client running on hello gateway.</span></span> <span data-ttu-id="5e211-156">Hello OPC UA URL dell'endpoint è `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="5e211-156">hello OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="5e211-157">Se non si ha un client OPC UA, è possibile scaricare e usare un [client OPC UA open source].</span><span class="sxs-lookup"><span data-stu-id="5e211-157">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="5e211-158">Quando questi test locali è stata completata, passare toohello **connettere il proprio Server UA OPC** hello factory connesso soluzione portale.</span><span class="sxs-lookup"><span data-stu-id="5e211-158">When you have successfully completed these local tests, browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="5e211-159">Immettere l'URL dell'endpoint server di pubblicazione hello (`tcp://publisher.<your fully qualified domain name>:62222`) e fare clic su **Connetti**.</span><span class="sxs-lookup"><span data-stu-id="5e211-159">Enter hello publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="5e211-160">Viene visualizzato un avviso relativo al certificato. Fare clic su **Proceed** (Continua).</span><span class="sxs-lookup"><span data-stu-id="5e211-160">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="5e211-161">Successivamente si verifica un errore che hello server di pubblicazione non ritiene attendibile hello Client Web agente utente.</span><span class="sxs-lookup"><span data-stu-id="5e211-161">Next you get an error that hello publisher doesn’t trust hello UA Web Client.</span></span> <span data-ttu-id="5e211-162">tooresolve questo errore, hello copia **Client Web UA** certificato da hello **unità d:\\docker\\rifiutato certificati\\certificati** cartella toohello **Unità d:\\docker\\applicazioni UA\\certificati** cartella gateway hello.</span><span class="sxs-lookup"><span data-stu-id="5e211-162">tooresolve this error, copy hello **UA Web Client** certificate from hello **D:\\docker\\Rejected Certificates\\certs** folder toohello **D:\\docker\\UA Applications\\certs** folder on hello gateway.</span></span> <span data-ttu-id="5e211-163">Non è necessario toorestart del gateway hello.</span><span class="sxs-lookup"><span data-stu-id="5e211-163">You do not need toorestart of hello gateway.</span></span> <span data-ttu-id="5e211-164">Ripetere questo passaggio.</span><span class="sxs-lookup"><span data-stu-id="5e211-164">Repeat this step.</span></span> <span data-ttu-id="5e211-165">È ora possibile connettersi toohello gateway dal cloud hello e si è pronti tooadd soluzione di toohello server UA OPC.</span><span class="sxs-lookup"><span data-stu-id="5e211-165">You can now connect toohello gateway from hello cloud, and you are ready tooadd OPC UA servers toohello solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="5e211-166">Aggiungere i server OPC UA</span><span class="sxs-lookup"><span data-stu-id="5e211-166">Add your OPC UA servers</span></span>

1. <span data-ttu-id="5e211-167">Sfoglia toohello **connettere il proprio Server UA OPC** hello factory connesso soluzione portale.</span><span class="sxs-lookup"><span data-stu-id="5e211-167">Browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="5e211-168">Attenersi alla stessa procedura come esempio hello precedente sezione tooestablish attendibilità tra hello portale factory connesso e hello server OPC UA hello.</span><span class="sxs-lookup"><span data-stu-id="5e211-168">Follow hello same steps as in hello preceding section tooestablish trust between hello connected factory portal and hello OPC UA server.</span></span> <span data-ttu-id="5e211-169">Questo passaggio stabilisce una relazione di trust reciproca dei certificati hello da hello connesso portale factory e i server OPC UA hello e crea una connessione.</span><span class="sxs-lookup"><span data-stu-id="5e211-169">This step establishes a mutual trust of hello certificates from hello connected factory portal and hello OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="5e211-170">Sfoglia hello albero di nodi OPC UA del server OPC UA, nodi OPC hello e scegliere **pubblicare**.</span><span class="sxs-lookup"><span data-stu-id="5e211-170">Browse hello OPC UA nodes tree of your OPC UA server, right-click hello OPC nodes, and select **publish**.</span></span> <span data-ttu-id="5e211-171">Per pubblicazione toowork in questo modo, i server OPC UA hello e publisher hello deve trovarsi in hello stessa rete.</span><span class="sxs-lookup"><span data-stu-id="5e211-171">For publishing toowork this way, hello OPC UA server and hello publisher must be on hello same network.</span></span> <span data-ttu-id="5e211-172">In altre parole, se hello completo il nome di dominio del server di pubblicazione hello è **publisher.mydomain.com** il nome di dominio completo di hello di hello OPC UA server deve essere, ad esempio, **myopcuaserver.mydomain.com**. Se il programma di installazione è diversa, è possibile aggiungere manualmente i nodi toohello publishesnodes.json file nel hello **unità d:\\docker** cartella.</span><span class="sxs-lookup"><span data-stu-id="5e211-172">In other words, if hello fully qualified domain name of hello publisher is **publisher.mydomain.com** then hello fully qualified domain name of hello OPC UA server must be, for example, **myopcuaserver.mydomain.com**. If your setup is different, you can manually add nodes toohello publishesnodes.json file found in hello **D:\\docker** folder.</span></span> <span data-ttu-id="5e211-173">Hello publishesnodes.json file viene generato automaticamente in hello innanzitutto corretta pubblicazione di un nodo OPC.</span><span class="sxs-lookup"><span data-stu-id="5e211-173">hello publishesnodes.json file is automatically generated on hello first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="5e211-174">Dati di telemetria passerà da dispositivo gateway hello.</span><span class="sxs-lookup"><span data-stu-id="5e211-174">Telemetry now flows from hello gateway device.</span></span> <span data-ttu-id="5e211-175">È possibile visualizzare i dati di telemetria hello in hello **percorsi Factory** Visualizza del portale di factory connesso hello in **nuova Factory**.</span><span class="sxs-lookup"><span data-stu-id="5e211-175">You can view hello telemetry in hello **Factory Locations** view of hello connected factory portal under **New Factory**.</span></span>

## <a name="linux-deployment"></a><span data-ttu-id="5e211-176">Distribuzione in Linux</span><span class="sxs-lookup"><span data-stu-id="5e211-176">Linux deployment</span></span>

> [!NOTE]
> <span data-ttu-id="5e211-177">Se non si ha ancora un dispositivo gateway, Microsoft consiglia di acquistare un gateway commerciale da uno dei partner.</span><span class="sxs-lookup"><span data-stu-id="5e211-177">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="5e211-178">Visitare hello [catalogo dispositivi Azure IoT] per un elenco di dispositivi gateway compatibili con hello connesso soluzione factory.</span><span class="sxs-lookup"><span data-stu-id="5e211-178">Visit hello [Azure IoT device catalog] for a list of gateway devices compatible with hello connected factory solution.</span></span> <span data-ttu-id="5e211-179">Seguire le istruzioni di hello forniti con hello dispositivo tooset di gateway hello.</span><span class="sxs-lookup"><span data-stu-id="5e211-179">Follow hello instructions that come with hello device tooset up hello gateway.</span></span> <span data-ttu-id="5e211-180">In alternativa, utilizzare hello seguendo le istruzioni toomanually impostare uno dei gateway esistente.</span><span class="sxs-lookup"><span data-stu-id="5e211-180">Alternatively, use hello following instructions toomanually set up one of your existing gateways.</span></span>

<span data-ttu-id="5e211-181">[Installare Docker] nel dispositivo gateway Linux.</span><span class="sxs-lookup"><span data-stu-id="5e211-181">[Install Docker] on your Linux gateway device.</span></span>

### <a name="configure-hello-gateway"></a><span data-ttu-id="5e211-182">Configurare il gateway hello</span><span class="sxs-lookup"><span data-stu-id="5e211-182">Configure hello gateway</span></span>

1. <span data-ttu-id="5e211-183">È necessario hello **iothubowner** stringa di connessione del gruppo di IoT di Azure connessa factory distribuzione toocomplete hello gateway distribuzione.</span><span class="sxs-lookup"><span data-stu-id="5e211-183">You need hello **iothubowner** connection string of your Azure IoT Suite connected factory deployment toocomplete hello gateway deployment.</span></span> <span data-ttu-id="5e211-184">In hello [portale di Azure], passare tooyour IoT Hub nel gruppo di risorse hello creato per la distribuzione di soluzioni factory hello connesso.</span><span class="sxs-lookup"><span data-stu-id="5e211-184">In hello [Azure portal], navigate tooyour IoT Hub in hello resource group created when you deployed hello connected factory solution.</span></span> <span data-ttu-id="5e211-185">Fare clic su **criteri di accesso condiviso** tooaccess hello **iothubowner** stringa di connessione:</span><span class="sxs-lookup"><span data-stu-id="5e211-185">Click **Shared access policies** tooaccess hello **iothubowner** connection string:</span></span>

    ![Trovare la stringa di connessione IoT Hub hello][img-hub-connection]

    <span data-ttu-id="5e211-187">Hello copia **stringa di connessione - chiave primaria** valore.</span><span class="sxs-lookup"><span data-stu-id="5e211-187">Copy hello **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="5e211-188">Configurare il gateway di hello per l'IoT Hub eseguendo i moduli di hello due gateway **una volta** da una shell con:</span><span class="sxs-lookup"><span data-stu-id="5e211-188">Configure hello gateway for your IoT Hub by running hello two gateway modules **once** from a shell with:</span></span>

    `sudo docker run -it --rm -h <ApplicationName> -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/ -v /shared:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `sudo docker run --rm -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="5e211-189">**&lt;ApplicationName&gt;**  è il nome di hello del gateway di OPC UA applicazione hello viene creato nel formato di hello hello **server di pubblicazione.&lt; il nome di dominio completo&gt;**.</span><span class="sxs-lookup"><span data-stu-id="5e211-189">**&lt;ApplicationName&gt;** is hello name of hello OPC UA application hello gateway creates in hello format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="5e211-190">Ad esempio, **publisher.microsoft.com**.</span><span class="sxs-lookup"><span data-stu-id="5e211-190">For example, **publisher.microsoft.com**.</span></span>
    * <span data-ttu-id="5e211-191">**&lt;IoTHubOwnerConnectionString&gt;**  è hello **iothubowner** stringa di connessione è stato copiato nel passaggio precedente hello.</span><span class="sxs-lookup"><span data-stu-id="5e211-191">**&lt;IoTHubOwnerConnectionString&gt;** is hello **iothubowner** connection string you copied in hello previous step.</span></span> <span data-ttu-id="5e211-192">La stringa di connessione viene utilizzata solo in questo passaggio, non è necessario in hello alla procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="5e211-192">This connection string is only used in this step, you don’t need it in hello following steps:</span></span>

    <span data-ttu-id="5e211-193">Utilizzare hello **/ condiviso** cartella (hello `-v` argomento) toopersist successive hello due certificati x. 509 che utilizzano moduli di hello gateway.</span><span class="sxs-lookup"><span data-stu-id="5e211-193">You use hello **/shared** folder (hello `-v` argument) later toopersist hello two X.509 certificates that hello gateway modules use.</span></span>

### <a name="run-hello-gateway"></a><span data-ttu-id="5e211-194">Eseguire hello gateway</span><span class="sxs-lookup"><span data-stu-id="5e211-194">Run hello gateway</span></span>

1. <span data-ttu-id="5e211-195">Riavviare il gateway di hello tramite hello seguenti comandi:</span><span class="sxs-lookup"><span data-stu-id="5e211-195">Restart hello gateway using hello following commands:</span></span>

    `sudo docker run -it -h <ApplicationName> --expose 62222 -p 62222:62222 –-rm -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v /shared:/shared -v /shared:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `sudo docker run -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="5e211-196">Per motivi di sicurezza, i certificati x. 509 hello due persistente in hello **/ condiviso** cartella contiene la chiave privata di hello.</span><span class="sxs-lookup"><span data-stu-id="5e211-196">For security reasons, hello two X.509 certificates persisted in hello **/shared** folder contain hello private key.</span></span> <span data-ttu-id="5e211-197">Limite toothis cartella toohello le credenziali di accesso è utilizzare toorun hello contenitore Docker.</span><span class="sxs-lookup"><span data-stu-id="5e211-197">Limit access toothis folder toohello credentials you use toorun hello Docker container.</span></span> <span data-ttu-id="5e211-198">le autorizzazioni di hello tooset per **radice** solo, utilizzare hello `chmod` comando nella cartella hello della shell.</span><span class="sxs-lookup"><span data-stu-id="5e211-198">tooset hello permissions for **root** only, use hello `chmod` shell command on hello folder.</span></span>

1. <span data-ttu-id="5e211-199">Verificare la connettività di rete.</span><span class="sxs-lookup"><span data-stu-id="5e211-199">Verify network connectivity.</span></span> <span data-ttu-id="5e211-200">Da una shell, immettere il comando hello `ping publisher.<your fully qualified domain name>` tooping il gateway.</span><span class="sxs-lookup"><span data-stu-id="5e211-200">From a shell, enter hello command `ping publisher.<your fully qualified domain name>` tooping your gateway.</span></span> <span data-ttu-id="5e211-201">Se la destinazione hello è raggiungibile, aggiungere l'indirizzo IP hello e il nome del file host gateway tooyour sul gateway.</span><span class="sxs-lookup"><span data-stu-id="5e211-201">If hello destination is unreachable, add hello IP address and name of your gateway tooyour hosts file on your gateway.</span></span> <span data-ttu-id="5e211-202">file hosts di Hello è disponibile in hello **e così via** cartella.</span><span class="sxs-lookup"><span data-stu-id="5e211-202">hello hosts file is located in hello **/etc** folder.</span></span>

1. <span data-ttu-id="5e211-203">Successivamente, provare a tooconnect toohello server di pubblicazione utilizzando un client OPC UA locale che esegue gateway hello.</span><span class="sxs-lookup"><span data-stu-id="5e211-203">Next, try tooconnect toohello publisher using a local OPC UA client running on hello gateway.</span></span> <span data-ttu-id="5e211-204">Hello OPC UA URL dell'endpoint è `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="5e211-204">hello OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="5e211-205">Se non si ha un client OPC UA, è possibile scaricare e usare un [client OPC UA open source].</span><span class="sxs-lookup"><span data-stu-id="5e211-205">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="5e211-206">Quando questi test locali è stata completata, passare toohello **connettere il proprio Server UA OPC** hello factory connesso soluzione portale.</span><span class="sxs-lookup"><span data-stu-id="5e211-206">When you have successfully completed these local tests, browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="5e211-207">Immettere l'URL dell'endpoint server di pubblicazione hello (`tcp://publisher.<your fully qualified domain name>:62222`) e fare clic su **Connetti**.</span><span class="sxs-lookup"><span data-stu-id="5e211-207">Enter hello publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="5e211-208">Viene visualizzato un avviso relativo al certificato. Fare clic su **Proceed** (Continua).</span><span class="sxs-lookup"><span data-stu-id="5e211-208">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="5e211-209">Successivamente si verifica un errore che hello server di pubblicazione non ritiene attendibile hello Client Web agente utente.</span><span class="sxs-lookup"><span data-stu-id="5e211-209">Next you get an error that hello publisher doesn’t trust hello UA Web Client.</span></span> <span data-ttu-id="5e211-210">tooresolve questo errore, hello copia **Client Web UA** certificato da hello **/shared/rifiutato con certificati/certificati** cartella toohello **/shared/UA applicazioni/certificati** cartella gateway hello.</span><span class="sxs-lookup"><span data-stu-id="5e211-210">tooresolve this error, copy hello **UA Web Client** certificate from hello **/shared/Rejected Certificates/certs** folder toohello **/shared/UA Applications/certs** folder on hello gateway.</span></span> <span data-ttu-id="5e211-211">Non è necessario toorestart del gateway hello.</span><span class="sxs-lookup"><span data-stu-id="5e211-211">You do not need toorestart of hello gateway.</span></span> <span data-ttu-id="5e211-212">Ripetere questo passaggio.</span><span class="sxs-lookup"><span data-stu-id="5e211-212">Repeat this step.</span></span> <span data-ttu-id="5e211-213">È ora possibile connettersi toohello gateway dal cloud hello e si è pronti tooadd soluzione di toohello server UA OPC.</span><span class="sxs-lookup"><span data-stu-id="5e211-213">You can now connect toohello gateway from hello cloud, and you are ready tooadd OPC UA servers toohello solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="5e211-214">Aggiungere i server OPC UA</span><span class="sxs-lookup"><span data-stu-id="5e211-214">Add your OPC UA servers</span></span>

1. <span data-ttu-id="5e211-215">Sfoglia toohello **connettere il proprio Server UA OPC** hello factory connesso soluzione portale.</span><span class="sxs-lookup"><span data-stu-id="5e211-215">Browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="5e211-216">Attenersi alla stessa procedura come esempio hello precedente sezione tooestablish attendibilità tra hello portale factory connesso e hello server OPC UA hello.</span><span class="sxs-lookup"><span data-stu-id="5e211-216">Follow hello same steps as in hello preceding section tooestablish trust between hello connected factory portal and hello OPC UA server.</span></span> <span data-ttu-id="5e211-217">Questo passaggio stabilisce una relazione di trust reciproca dei certificati hello da hello connesso portale factory e i server OPC UA hello e crea una connessione.</span><span class="sxs-lookup"><span data-stu-id="5e211-217">This step establishes a mutual trust of hello certificates from hello connected factory portal and hello OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="5e211-218">Sfoglia hello albero di nodi OPC UA del server OPC UA, nodi OPC hello e scegliere **pubblicare**.</span><span class="sxs-lookup"><span data-stu-id="5e211-218">Browse hello OPC UA nodes tree of your OPC UA server, right-click hello OPC nodes, and select **publish**.</span></span> <span data-ttu-id="5e211-219">Per pubblicazione toowork in questo modo, i server OPC UA hello e publisher hello deve trovarsi in hello stessa rete.</span><span class="sxs-lookup"><span data-stu-id="5e211-219">For publishing toowork this way, hello OPC UA server and hello publisher must be on hello same network.</span></span> <span data-ttu-id="5e211-220">In altre parole, se hello completo il nome di dominio del server di pubblicazione hello è **publisher.mydomain.com** il nome di dominio completo di hello di hello OPC UA server deve essere, ad esempio, **myopcuaserver.mydomain.com**. Se il programma di installazione è diversa, è possibile aggiungere manualmente i nodi toohello publishesnodes.json file nel hello **/ condiviso** cartella.</span><span class="sxs-lookup"><span data-stu-id="5e211-220">In other words, if hello fully qualified domain name of hello publisher is **publisher.mydomain.com** then hello fully qualified domain name of hello OPC UA server must be, for example, **myopcuaserver.mydomain.com**. If your setup is different, you can manually add nodes toohello publishesnodes.json file found in hello **/shared** folder.</span></span> <span data-ttu-id="5e211-221">Hello publishesnodes.json viene generato automaticamente in hello innanzitutto corretta pubblicazione di un nodo OPC.</span><span class="sxs-lookup"><span data-stu-id="5e211-221">hello publishesnodes.json is automatically generated on hello first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="5e211-222">Dati di telemetria passerà da dispositivo gateway hello.</span><span class="sxs-lookup"><span data-stu-id="5e211-222">Telemetry now flows from hello gateway device.</span></span> <span data-ttu-id="5e211-223">È possibile visualizzare i dati di telemetria hello in hello **percorsi Factory** Visualizza del portale di factory connesso hello in **nuova Factory**.</span><span class="sxs-lookup"><span data-stu-id="5e211-223">You can view hello telemetry in hello **Factory Locations** view of hello connected factory portal under **New Factory**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="5e211-224">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="5e211-224">Next steps</span></span>

<span data-ttu-id="5e211-225">toolearn più informazioni sull'architettura di hello della factory connesso hello preconfigurato soluzione, vedere [factory connesso preconfigurato procedura dettagliata sulla soluzione][lnk-walkthrough].</span><span class="sxs-lookup"><span data-stu-id="5e211-225">toolearn more about hello architecture of hello connected factory preconfigured solution, see [Connected factory preconfigured solution walkthrough][lnk-walkthrough].</span></span>

[img-install-docker]: ./media/iot-suite-connected-factory-gateway-deployment/image1.png
[img-hub-connection]: ./media/iot-suite-connected-factory-gateway-deployment/image2.png
[img-docker-share]: ./media/iot-suite-connected-factory-gateway-deployment/image3.png

[Docker per Windows]: https://www.docker.com/docker-windows
[catalogo dispositivi Azure IoT]: https://catalog.azureiotsuite.com/?q=opc
[portale di Azure]: http://portal.azure.com/
[client OPC UA open source]: https://github.com/OPCFoundation/UA-.NETStandardLibrary/tree/master/SampleApplications/Samples/Client.Net4
[Installare Docker]: https://www.docker.com/community-edition#/download
[lnk-walkthrough]: iot-suite-connected-factory-sample-walkthrough.md
[Azure IoT Edge]: https://github.com/Azure/iot-edge

[lnk-publisher-github]: https://github.com/Azure/iot-edge-opc-publisher
[lnk-publisher-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua
[lnk-proxy-github]: https://github.com/Azure/iot-edge-opc-proxy
[lnk-proxy-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua-proxy