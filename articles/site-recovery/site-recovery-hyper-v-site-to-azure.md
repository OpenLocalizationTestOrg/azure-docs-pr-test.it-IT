---
title: Replicare le macchine vistuali Hyper-V in Azure | Microsoft Docs
description: Questo articolo descrive come orchestrare la replica, il failover e il ripristino di macchine virtuali locali Hyper-V in Azure.
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: 
ms.assetid: 1777e0eb-accb-42b5-a747-11272e131a52
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 04/05/2017
ms.author: raynew
ROBOTS: NOINDEX, NOFOLLOW
redirect_url: hyper-v-site-walkthrough-overview
ms.openlocfilehash: 8a2ea92759a777b1178fbfe8084a97eec931f709
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="replicate-hyper-v-virtual-machines-without-vmm-to-azure-using-azure-site-recovery-with-the-azure-portal"></a><span data-ttu-id="4898b-103">Replicare macchine virtuali Hyper-V (senza Virtual Machine Manager) in Azure usando Azure Site Recovery con il portale di Azure</span><span class="sxs-lookup"><span data-stu-id="4898b-103">Replicate Hyper-V virtual machines (without VMM) to Azure using Azure Site Recovery with the Azure portal</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="4898b-104">Portale di Azure</span><span class="sxs-lookup"><span data-stu-id="4898b-104">Azure portal</span></span>](site-recovery-hyper-v-site-to-azure.md)
> * [<span data-ttu-id="4898b-105">Azure classico</span><span class="sxs-lookup"><span data-stu-id="4898b-105">Azure classic</span></span>](site-recovery-hyper-v-site-to-azure-classic.md)
> * [<span data-ttu-id="4898b-106">PowerShell - Gestione risorse</span><span class="sxs-lookup"><span data-stu-id="4898b-106">PowerShell - Resource Manager</span></span>](site-recovery-deploy-with-powershell-resource-manager.md)
>
>

<span data-ttu-id="4898b-107">Questo articolo illustra come eseguire la replica di macchine virtuali Hyper-V locali in Azure usando [Azure Site Recovery](site-recovery-overview.md) nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="4898b-107">This article describes how to replicate on-premises Hyper-V virtual machines to Azure, using [Azure Site Recovery](site-recovery-overview.md) in the Azure portal.</span></span> <span data-ttu-id="4898b-108">In questa distribuzione le macchine virtuali Hyper-V non vengono gestite tramite la soluzione Virtual Machine Manager (VMM) di System Center.</span><span class="sxs-lookup"><span data-stu-id="4898b-108">In this deployment Hyper-V VMs aren't managed by System Center Virtual Machine Manager (VMM).</span></span>

<span data-ttu-id="4898b-109">Dopo la lettura di questo articolo, è possibile inserire commenti nella parte inferiore oppure porre domande tecniche nel [forum sui servizi di ripristino di Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="4898b-109">After reading this article, post any comments at the bottom, or ask technical questions on the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

<span data-ttu-id="4898b-110">Se si desidera eseguire la migrazione di macchine in Azure (senza failback), leggere ulteriori informazioni in [questo articolo](site-recovery-migrate-to-azure.md).</span><span class="sxs-lookup"><span data-stu-id="4898b-110">If you want to migrate machines to Azure (without failback), learn more in [this article](site-recovery-migrate-to-azure.md).</span></span>



## <a name="deployment-steps"></a><span data-ttu-id="4898b-111">Passaggi di distribuzione</span><span class="sxs-lookup"><span data-stu-id="4898b-111">Deployment steps</span></span>

<span data-ttu-id="4898b-112">Seguire l'articolo per completare i passaggi di distribuzione seguenti:</span><span class="sxs-lookup"><span data-stu-id="4898b-112">Follow the article to complete these deployment steps:</span></span>

1. <span data-ttu-id="4898b-113">Ottenere [altre informazioni ](site-recovery-components.md#hyper-v-to-azure) sull'architettura di questa distribuzione.</span><span class="sxs-lookup"><span data-stu-id="4898b-113">[Learn more](site-recovery-components.md#hyper-v-to-azure) about the architecture for this deployment.</span></span> <span data-ttu-id="4898b-114">Ottenere inoltre [altre informazioni](site-recovery-hyper-v-azure-architecture.md) sul funzionamento della replica Hyper-V in Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="4898b-114">In addition, [learn about](site-recovery-hyper-v-azure-architecture.md) how Hyper-V replication works in Site Recovery.</span></span>
2. <span data-ttu-id="4898b-115">Verificare i prerequisiti e le limitazioni.</span><span class="sxs-lookup"><span data-stu-id="4898b-115">Verify prerequisites and limitations.</span></span>
3. <span data-ttu-id="4898b-116">Configurare la rete e gli account di archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="4898b-116">Set up Azure network and storage accounts.</span></span>
4. <span data-ttu-id="4898b-117">Preparare gli host Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="4898b-117">Prepare Hyper-V hosts.</span></span>
5. <span data-ttu-id="4898b-118">Creare un insieme di credenziali dei servizi di ripristino.</span><span class="sxs-lookup"><span data-stu-id="4898b-118">Create a Recovery Services vault.</span></span> <span data-ttu-id="4898b-119">L'insieme di credenziali contiene le impostazioni di configurazione e orchestra la replica.</span><span class="sxs-lookup"><span data-stu-id="4898b-119">The vault contains configuration settings, and orchestrates replication.</span></span>
6. <span data-ttu-id="4898b-120">Specificare le impostazioni di origine.</span><span class="sxs-lookup"><span data-stu-id="4898b-120">Specify source settings.</span></span> <span data-ttu-id="4898b-121">Creare un sito Hyper-V che contenga gli host Hyper-V e registrare il sito nell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="4898b-121">Create a Hyper-V site that contains the Hyper-V hosts, and register the site in the vault.</span></span> <span data-ttu-id="4898b-122">Installare il provider di Azure Site Recovery e l'agente di Servizi di ripristino di Microsoft sugli host Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="4898b-122">Install the Azure Site Recovery Provider, and the Microsoft Recovery Services agent, on the Hyper-V hosts.</span></span>
7. <span data-ttu-id="4898b-123">Specificare le impostazioni di replica e di destinazione.</span><span class="sxs-lookup"><span data-stu-id="4898b-123">Set up target and replication settings.</span></span>
8. <span data-ttu-id="4898b-124">Abilitare la replica per le VM.</span><span class="sxs-lookup"><span data-stu-id="4898b-124">Enable replication for the VMs.</span></span>
9. <span data-ttu-id="4898b-125">Eseguire un failover di test per verificare che tutti gli elementi funzionino come previsto.</span><span class="sxs-lookup"><span data-stu-id="4898b-125">Run a test failover to make sure everything's working as expected.</span></span>



## <a name="prerequisites"></a><span data-ttu-id="4898b-126">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="4898b-126">Prerequisites</span></span>


<span data-ttu-id="4898b-127">**Requisito**</span><span class="sxs-lookup"><span data-stu-id="4898b-127">**Requirement**</span></span> | <span data-ttu-id="4898b-128">**Dettagli**</span><span class="sxs-lookup"><span data-stu-id="4898b-128">**Details**</span></span> |
--- | --- |
<span data-ttu-id="4898b-129">**Azure**</span><span class="sxs-lookup"><span data-stu-id="4898b-129">**Azure**</span></span> | <span data-ttu-id="4898b-130">Vedere i [requisiti di Azure](site-recovery-prereq.md#azure-requirements).</span><span class="sxs-lookup"><span data-stu-id="4898b-130">Learn about [Azure requirements](site-recovery-prereq.md#azure-requirements).</span></span>
<span data-ttu-id="4898b-131">**Server locali**</span><span class="sxs-lookup"><span data-stu-id="4898b-131">**On-premises servers**</span></span> | <span data-ttu-id="4898b-132">Leggere altre informazioni sui requisiti per gli host Hyper-V locali [qui](site-recovery-prereq.md#disaster-recovery-of-hyper-v-virtual-machines-to-azure-no-virtual-machine-manager).</span><span class="sxs-lookup"><span data-stu-id="4898b-132">[Learn more](site-recovery-prereq.md#disaster-recovery-of-hyper-v-virtual-machines-to-azure-no-virtual-machine-manager) about requirements for the on-premises Hyper-V hosts.</span></span>
<span data-ttu-id="4898b-133">**VM Hyper-V locali**</span><span class="sxs-lookup"><span data-stu-id="4898b-133">**On-premises Hyper-V VMs**</span></span> | <span data-ttu-id="4898b-134">Le VM da replicare devono eseguire un [sistema operativo supportato](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions) ed essere conformi ai [prerequisiti di Azure](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).</span><span class="sxs-lookup"><span data-stu-id="4898b-134">VMs you want to replicate should be running a [supported operating system](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions), and conform with [Azure prerequisites](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).</span></span>
<span data-ttu-id="4898b-135">**URL di Azure**</span><span class="sxs-lookup"><span data-stu-id="4898b-135">**Azure URLs**</span></span> | <span data-ttu-id="4898b-136">Gli host Hyper-V devono accedere agli URL seguenti:</span><span class="sxs-lookup"><span data-stu-id="4898b-136">Hyper-V hosts need access to these URLs:</span></span><br/><br/> [!INCLUDE [site-recovery-URLS](../../includes/site-recovery-URLS.md)]<br/><br/> <span data-ttu-id="4898b-137">Se sono presenti regole del firewall basate sull'indirizzo IP, verificare che consentano la comunicazione con Azure.</span><span class="sxs-lookup"><span data-stu-id="4898b-137">If you have IP address-based firewall rules, ensure they allow communication to Azure.</span></span><br/></br> <span data-ttu-id="4898b-138">Consentire gli [intervalli IP del data center di Azure ](https://www.microsoft.com/download/confirmation.aspx?id=41653) e la porta HTTPS (443).</span><span class="sxs-lookup"><span data-stu-id="4898b-138">Allow the [Azure Datacenter IP Ranges](https://www.microsoft.com/download/confirmation.aspx?id=41653), and the HTTPS (443) port.</span></span><br/></br> <span data-ttu-id="4898b-139">Consentire gli intervalli di indirizzi IP per l'area di Azure della sottoscrizione e per gli Stati Uniti occidentali (usati per il controllo di accesso e la gestione delle identità).</span><span class="sxs-lookup"><span data-stu-id="4898b-139">Allow IP address ranges for the Azure region of your subscription, and for West US (used for Access Control and Identity Management).</span></span>



## <a name="prepare-for-deployment"></a><span data-ttu-id="4898b-140">Preparare la distribuzione</span><span class="sxs-lookup"><span data-stu-id="4898b-140">Prepare for deployment</span></span>

<span data-ttu-id="4898b-141">Per preparare la distribuzione è necessario:</span><span class="sxs-lookup"><span data-stu-id="4898b-141">To prepare for deployment you need to:</span></span>

1. <span data-ttu-id="4898b-142">[Configurare una rete di Azure](#set-up-an-azure-network) in cui verranno collocate le VM di Azure al momento della creazione, dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="4898b-142">[Set up an Azure network](#set-up-an-azure-network) in which Azure VMs will be located when they're created after failover.</span></span>
2. <span data-ttu-id="4898b-143">[Configurare un account di archiviazione di Azure](#set-up-an-azure-storage-account) per i dati replicati.</span><span class="sxs-lookup"><span data-stu-id="4898b-143">[Set up an Azure storage account](#set-up-an-azure-storage-account) for replicated data.</span></span>
3. <span data-ttu-id="4898b-144">[Preparare gli host Hyper-V](#prepare-the-hyper-v-hosts) e assicurarsi che possano accedere agli URL necessari.</span><span class="sxs-lookup"><span data-stu-id="4898b-144">[Prepare the Hyper-V hosts](#prepare-the-hyper-v-hosts) to ensure they can access the required URLs.</span></span>

### <a name="set-up-an-azure-network"></a><span data-ttu-id="4898b-145">Configurare una rete di Azure</span><span class="sxs-lookup"><span data-stu-id="4898b-145">Set up an Azure network</span></span>

<span data-ttu-id="4898b-146">Configurare una rete di Azure.</span><span class="sxs-lookup"><span data-stu-id="4898b-146">Set up an Azure network.</span></span> <span data-ttu-id="4898b-147">È necessario configurare una rete di Azure affinché le macchine virtuali di Azure siano connesse a una rete dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="4898b-147">You’ll need this so that the Azure VMs created after failover are connected to a network.</span></span>

* <span data-ttu-id="4898b-148">La rete deve trovarsi nella stessa area dell'insieme di credenziali di Servizi di ripristino.</span><span class="sxs-lookup"><span data-stu-id="4898b-148">The network should be in the same region as the Recovery Services vault.</span></span>
* <span data-ttu-id="4898b-149">A seconda del modello di risorsa da usare per le VM di Azure di cui si esegue il failover, la rete di Azure viene configurata in [modalità Resource Manager](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) o in [modalità classica](../virtual-network/virtual-networks-create-vnet-classic-pportal.md).</span><span class="sxs-lookup"><span data-stu-id="4898b-149">Depending on the resource model you want to use for failed over Azure VMs, you set up the Azure network in [Resource Manager mode](../virtual-network/virtual-networks-create-vnet-arm-pportal.md), or [classic mode](../virtual-network/virtual-networks-create-vnet-classic-pportal.md).</span></span>
* <span data-ttu-id="4898b-150">È consigliabile configurare una rete prima di iniziare.</span><span class="sxs-lookup"><span data-stu-id="4898b-150">We recommend you set up a network before you begin.</span></span> <span data-ttu-id="4898b-151">In caso contrario sarà necessario eseguire l'operazione durante la distribuzione di Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="4898b-151">If you don't, you need to do it during Site Recovery deployment.</span></span>
- <span data-ttu-id="4898b-152">Gli account di archiviazione usati per Site Recovery non possono essere [spostati](../azure-resource-manager/resource-group-move-resources.md) all'interno della stessa sottoscrizione o tra sottoscrizioni diverse.</span><span class="sxs-lookup"><span data-stu-id="4898b-152">Storage accounts used by Site Recovery can't be [moved](../azure-resource-manager/resource-group-move-resources.md) within the same, or across different, subscriptions.</span></span>


### <a name="set-up-an-azure-storage-account"></a><span data-ttu-id="4898b-153">Configurare un account di archiviazione di Azure</span><span class="sxs-lookup"><span data-stu-id="4898b-153">Set up an Azure storage account</span></span>

- <span data-ttu-id="4898b-154">Per contenere i dati replicati in Azure è necessario un account di archiviazione di Azure Standard/Premium. [Archiviazione Premium](../storage/storage-premium-storage.md) viene generalmente usata per le macchine virtuali che necessitano costantemente di prestazioni I/O elevate e bassa latenza per ospitare carichi di lavoro di I/O intensivi.</span><span class="sxs-lookup"><span data-stu-id="4898b-154">You need a standard/premium Azure storage account to hold data replicated to Azure.[Premium storage](../storage/storage-premium-storage.md) is typically used for virtual machines that need a consistently high IO performance, and low latency to host IO intensive workloads.</span></span>
- <span data-ttu-id="4898b-155">Se si vuole usare un account Premium per archiviare i dati replicati, sarà necessario anche un account di archiviazione standard per l'archiviazione dei log di replica in cui vengono acquisite le modifiche in corso ai dati locali.</span><span class="sxs-lookup"><span data-stu-id="4898b-155">If you want to use a premium account to store replicated data, you also need a standard storage account to store replication logs that capture ongoing changes to on-premises data.</span></span>
- <span data-ttu-id="4898b-156">A seconda del modello di risorsa da usare per le macchine virtuali di Azure di cui si esegue il failover, l'account deve essere configurato in [modalità Resource Manager](../storage/storage-create-storage-account.md) o in [modalità classica](../storage/storage-create-storage-account-classic-portal.md).</span><span class="sxs-lookup"><span data-stu-id="4898b-156">Depending on the resource model you want to use for failed over Azure VMs, you set up an account in [Resource Manager mode](../storage/storage-create-storage-account.md), or [classic mode](../storage/storage-create-storage-account-classic-portal.md).</span></span>
- <span data-ttu-id="4898b-157">È consigliabile configurare un account di archiviazione prima di iniziare.</span><span class="sxs-lookup"><span data-stu-id="4898b-157">We recommend that you set up a storage account before you begin.</span></span> <span data-ttu-id="4898b-158">In caso contrario sarà necessario eseguire l'operazione durante la distribuzione di Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="4898b-158">If you don't you need to do it during Site Recovery deployment.</span></span> <span data-ttu-id="4898b-159">L'account deve trovarsi nella stessa area dell'insieme di credenziali di Servizi di ripristino.</span><span class="sxs-lookup"><span data-stu-id="4898b-159">The accounts must be in the same region as the Recovery Services vault.</span></span>
- <span data-ttu-id="4898b-160">Non è possibile spostare gli account di archiviazione usati da Site Recovery tra gruppi di risorse nella stessa sottoscrizione o in diverse sottoscrizioni.</span><span class="sxs-lookup"><span data-stu-id="4898b-160">You can't move storage accounts used by Site Recovery across resource groups within the same subscription, or across different subscriptions.</span></span>


### <a name="prepare-the-hyper-v-hosts"></a><span data-ttu-id="4898b-161">Preparare gli host Hyper-V</span><span class="sxs-lookup"><span data-stu-id="4898b-161">Prepare the Hyper-V hosts</span></span>

* <span data-ttu-id="4898b-162">Assicurarsi che gli host Hyper-V soddisfino i [prerequisiti](site-recovery-prereq.md#disaster-recovery-of-hyper-v-virtual-machines-to-azure-no-virtual-machine-manager).</span><span class="sxs-lookup"><span data-stu-id="4898b-162">Make sure that the Hyper-V hosts meet the [prerequisites](site-recovery-prereq.md#disaster-recovery-of-hyper-v-virtual-machines-to-azure-no-virtual-machine-manager).</span></span>
- <span data-ttu-id="4898b-163">Assicurarsi che gli host possano accedere agli URL necessari.</span><span class="sxs-lookup"><span data-stu-id="4898b-163">Make sure that the hosts can access the required URLs.</span></span>


## <a name="create-a-recovery-services-vault"></a><span data-ttu-id="4898b-164">Creare un insieme di credenziali di Servizi di ripristino</span><span class="sxs-lookup"><span data-stu-id="4898b-164">Create a Recovery Services vault</span></span>
1. <span data-ttu-id="4898b-165">Accedere al [portale di Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="4898b-165">Sign in to the [Azure portal](https://portal.azure.com).</span></span>
2. <span data-ttu-id="4898b-166">Fare clic su **Nuovo** > **Monitoraggio e gestione** > **Backup e Site Recovery (OMS)**.</span><span class="sxs-lookup"><span data-stu-id="4898b-166">Click **New** > **Monitoring + Management** > **Backup and Site Recovery (OMS)**.</span></span>  

    ![Nuovo insieme di credenziali](./media/site-recovery-hyper-v-site-to-azure/new-vault.png)

3. <span data-ttu-id="4898b-168">In **Nome**specificare un nome descrittivo per identificare l'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="4898b-168">In **Name**, specify a friendly name to identify the vault.</span></span> <span data-ttu-id="4898b-169">Se è disponibile più di una sottoscrizione, selezionarne una.</span><span class="sxs-lookup"><span data-stu-id="4898b-169">If you have more than one subscription, select one of them.</span></span>

4. <span data-ttu-id="4898b-170">[Creare un nuovo gruppo di risorse](../azure-resource-manager/resource-group-template-deploy-portal.md) o selezionarne uno esistente e specificare un'area di Azure.</span><span class="sxs-lookup"><span data-stu-id="4898b-170">[Create a new resource group](../azure-resource-manager/resource-group-template-deploy-portal.md) or select an existing one, and specify an Azure region.</span></span> <span data-ttu-id="4898b-171">I computer verranno replicati in quest'area.</span><span class="sxs-lookup"><span data-stu-id="4898b-171">Machines will be replicated to this region.</span></span> <span data-ttu-id="4898b-172">Per verificare le aree geografiche supportate, vedere la sezione Disponibilità a livello geografico in [Prezzi di Azure Site Recovery](https://azure.microsoft.com/pricing/details/site-recovery/).</span><span class="sxs-lookup"><span data-stu-id="4898b-172">To check supported regions, see Geographic Availability in [Azure Site Recovery Pricing Details](https://azure.microsoft.com/pricing/details/site-recovery/).</span></span>

5. <span data-ttu-id="4898b-173">Per accedere rapidamente all'insieme di credenziali dal dashboard, fare clic su **Aggiungi al dashboard** e quindi su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="4898b-173">If you want to quickly access the vault from the Dashboard, click **Pin to dashboard**, and then click **Create**.</span></span>

    ![Nuovo insieme di credenziali](./media/site-recovery-hyper-v-site-to-azure/new-vault-settings.png)

<span data-ttu-id="4898b-175">Il nuovo insieme di credenziali verrà visualizzato nell'elenco **Dashboard** > **Tutte le risorse** e nel pannello **Insiemi di credenziali dei servizi di ripristino** principale.</span><span class="sxs-lookup"><span data-stu-id="4898b-175">The new vault appears in the **Dashboard** > **All resources** list, and on the main **Recovery Services vaults** blade.</span></span>



## <a name="select-the-protection-goal"></a><span data-ttu-id="4898b-176">Selezionare l'obiettivo di protezione</span><span class="sxs-lookup"><span data-stu-id="4898b-176">Select the protection goal</span></span>

<span data-ttu-id="4898b-177">Selezionare gli elementi da replicare e la posizione in cui eseguire la replica.</span><span class="sxs-lookup"><span data-stu-id="4898b-177">Select what you want to replicate, and where you want to replicate to.</span></span>

1. <span data-ttu-id="4898b-178">In **Insiemi di credenziali dei servizi di ripristino** selezionare l'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="4898b-178">In the **Recovery Services vaults**, select the vault.</span></span>
2. <span data-ttu-id="4898b-179">In **Introduzione** fare clic su **Site Recovery** > **Preparare l'infrastruttura** > **Obiettivo di protezione**.</span><span class="sxs-lookup"><span data-stu-id="4898b-179">In **Getting Started**, click **Site Recovery** > **Prepare Infrastructure** > **Protection goal**.</span></span>

    ![Scegliere gli obiettivi](./media/site-recovery-hyper-v-site-to-azure/choose-goals.png)
3. <span data-ttu-id="4898b-181">In **Obiettivo di protezione** selezionare **In Azure** e scegliere **Sì, con Hyper-V**.</span><span class="sxs-lookup"><span data-stu-id="4898b-181">In **Protection goal**, select **To Azure**, and select **Yes, with Hyper-V**.</span></span> <span data-ttu-id="4898b-182">Scegliere **No** per confermare che non si sta usando VMM.</span><span class="sxs-lookup"><span data-stu-id="4898b-182">Select **No** to confirm you're not using VMM.</span></span> <span data-ttu-id="4898b-183">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="4898b-183">Then click **OK**.</span></span>

    ![Scegliere gli obiettivi](./media/site-recovery-hyper-v-site-to-azure/choose-goals2.png)

## <a name="set-up-the-source-environment"></a><span data-ttu-id="4898b-185">Configurare l'ambiente di origine</span><span class="sxs-lookup"><span data-stu-id="4898b-185">Set up the source environment</span></span>

<span data-ttu-id="4898b-186">Configurare il sito Hyper-V, installare il provider di Azure Site Recovery e l'agente di Servizi di ripristino di Azure negli host Hyper-V e registrare il sito nell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="4898b-186">Set up the Hyper-V site, install the Azure Site Recovery Provider and the Azure Recovery Services agent on Hyper-V hosts, and register the site in the vault.</span></span>

1. <span data-ttu-id="4898b-187">In **Preparare l'infrastruttura** fare clic su **Origine**.</span><span class="sxs-lookup"><span data-stu-id="4898b-187">In **Prepare Infrastructure**, click **Source**.</span></span> <span data-ttu-id="4898b-188">Per aggiungere un nuovo sito Hyper-V come contenitore per i cluster o gli host Hyper-V, fare clic su **+ Sito Hyper-V**.</span><span class="sxs-lookup"><span data-stu-id="4898b-188">To add a new Hyper-V site as a container for your Hyper-V hosts or clusters, click **+Hyper-V Site**.</span></span>

    ![Impostare l'origine](./media/site-recovery-hyper-v-site-to-azure/set-source1.png)
2. <span data-ttu-id="4898b-190">In **Crea il sito Hyper-V** specificare un nome per il sito.</span><span class="sxs-lookup"><span data-stu-id="4898b-190">In **Create Hyper-V site**, specify a name for the site.</span></span> <span data-ttu-id="4898b-191">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="4898b-191">Then click **OK**.</span></span> <span data-ttu-id="4898b-192">A questo punto, selezionare il sito creato e fare clic su **+Server Hyper-V** per aggiungere un server al sito.</span><span class="sxs-lookup"><span data-stu-id="4898b-192">Now, select the site you created, and click **+Hyper-V Server** to add a server to the site.</span></span>

    ![Impostare l'origine](./media/site-recovery-hyper-v-site-to-azure/set-source2.png)

3. <span data-ttu-id="4898b-194">In **Aggiungi server** > **Tipo di server** verificare che sia visualizzato **Server Hyper-V**.</span><span class="sxs-lookup"><span data-stu-id="4898b-194">In **Add Server** > **Server type**, check that **Hyper-V server** is displayed.</span></span>

    - <span data-ttu-id="4898b-195">Verificare che il server Hyper-V che si desidera aggiungere sia conforme ai [prerequisiti](#on-premises-prerequisites) e sia in grado di accedere agli URL specificati.</span><span class="sxs-lookup"><span data-stu-id="4898b-195">Make sure that the Hyper-V server you want to add complies with the [prerequisites](#on-premises-prerequisites), and is able to access the specified URLs.</span></span>
    - <span data-ttu-id="4898b-196">Scaricare il file di installazione del provider di Azure Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="4898b-196">Download the Azure Site Recovery Provider installation file.</span></span> <span data-ttu-id="4898b-197">Eseguire questo file per installare il provider e l'agente di Servizi di ripristino in ogni host Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="4898b-197">You run this file to install the Provider and the Recovery Services agent on each Hyper-V host.</span></span>

    ![Impostare l'origine](./media/site-recovery-hyper-v-site-to-azure/set-source3.png)


## <a name="install-the-provider-and-agent"></a><span data-ttu-id="4898b-199">Installare provider e agente</span><span class="sxs-lookup"><span data-stu-id="4898b-199">Install the Provider and agent</span></span>

1. <span data-ttu-id="4898b-200">Eseguire il file di installazione del provider in ogni host aggiunto al sito Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="4898b-200">Run the Provider setup file on each host you added to the Hyper-V site.</span></span> <span data-ttu-id="4898b-201">Se l'installazione viene eseguita in un cluster Hyper-V, eseguire il file di installazione in ogni nodo del cluster.</span><span class="sxs-lookup"><span data-stu-id="4898b-201">If you're installing on a Hyper-V cluster, run setup on each cluster node.</span></span> <span data-ttu-id="4898b-202">L'installazione e la registrazione di ogni nodo del cluster Hyper-V garantisce che le macchine virtuali siano protette anche se ne viene eseguita la migrazione tra i nodi.</span><span class="sxs-lookup"><span data-stu-id="4898b-202">Installing and registering each Hyper-V cluster node ensures that VMs are protected, even if they migrate across nodes.</span></span>
2. <span data-ttu-id="4898b-203">In **Microsoft Update** è possibile acconsentire esplicitamente agli aggiornamenti in modo che gli aggiornamenti del provider vengano installati in base ai criteri di Microsoft Update.</span><span class="sxs-lookup"><span data-stu-id="4898b-203">In **Microsoft Update**, you can opt in for updates so that Provider updates are installed in accordance with your Microsoft Update policy.</span></span>
3. <span data-ttu-id="4898b-204">In **Installazione** accettare o modificare il percorso predefinito di installazione del provider e quindi fare clic su **Installa**.</span><span class="sxs-lookup"><span data-stu-id="4898b-204">In **Installation**, accept or modify the default Provider installation location and click **Install**.</span></span>
4. <span data-ttu-id="4898b-205">In **Impostazioni dell'insieme di credenziali** fare clic su **Esplora** per selezionare il file di chiave dell'insieme di credenziali scaricato.</span><span class="sxs-lookup"><span data-stu-id="4898b-205">In **Vault Settings**, click **Browse** to select the vault key file that you downloaded.</span></span> <span data-ttu-id="4898b-206">Specificare la sottoscrizione di Azure Site Recovery, il nome dell'insieme di credenziali e il sito Hyper-V a cui appartiene il server Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="4898b-206">Specify the Azure Site Recovery subscription, the vault name, and the Hyper-V site to which the Hyper-V server belongs.</span></span>

    ![Server registration](./media/site-recovery-hyper-v-site-to-azure/provider3.png)

5. <span data-ttu-id="4898b-208">In **Impostazioni proxy** specificare in che modo il provider in esecuzione negli host Hyper-V si connette ad Azure Site Recovery tramite Internet.</span><span class="sxs-lookup"><span data-stu-id="4898b-208">In **Proxy Settings**, specify how the Provider running on Hyper-V hosts connects to Azure Site Recovery over the internet.</span></span>

    * <span data-ttu-id="4898b-209">Per fare in modo che il provider si connetta direttamente, selezionare **Connetti direttamente ad Azure Site Recovery senza server proxy**.</span><span class="sxs-lookup"><span data-stu-id="4898b-209">If you want the Provider to connect directly select **Connect directly to Azure Site Recovery without a proxy**.</span></span>
    * <span data-ttu-id="4898b-210">Se per il proxy esistente è necessaria l'autenticazione o si desidera usare un proxy personalizzato per la connessione al provider, selezionare **Connetti ad Azure Site Recovery usando un server proxy**.</span><span class="sxs-lookup"><span data-stu-id="4898b-210">If your existing proxy requires authentication, or you want to use a custom proxy for the Provider connection, select **Connect to Azure Site Recovery using a proxy server**.</span></span>
    * <span data-ttu-id="4898b-211">Se si usa un proxy:</span><span class="sxs-lookup"><span data-stu-id="4898b-211">If you use a proxy:</span></span>
        - <span data-ttu-id="4898b-212">Specificare l'indirizzo, la porta e le credenziali.</span><span class="sxs-lookup"><span data-stu-id="4898b-212">Specify the address, port, and credentials</span></span>
        - <span data-ttu-id="4898b-213">Assicurarsi che sia possibile accedere tramite il proxy agli URL indicati nei [prerequisiti](#prerequisites) .</span><span class="sxs-lookup"><span data-stu-id="4898b-213">Make sure the URLs described in the [prerequisites](#prerequisites) are allowed through the proxy.</span></span>

    ![Internet](./media/site-recovery-hyper-v-site-to-azure/provider7.PNG)

6. <span data-ttu-id="4898b-215">Al termine dell'installazione fare clic su **Registra** per registrare il server nell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="4898b-215">After installation finishes, click **Register** to register the server in the vault.</span></span>

    ![Percorso di installazione](./media/site-recovery-hyper-v-site-to-azure/provider2.png)

7. <span data-ttu-id="4898b-217">Al termine della registrazione, i metadati del server Hyper-V vengono recuperati da Azure Site Recovery e il server viene visualizzato in **Site Recovery Infrastructure** >  (Infrastruttura di Site Recovery)**Hyper-V Hosts** (Host Hyper-V).</span><span class="sxs-lookup"><span data-stu-id="4898b-217">After registration finishes, metadata from the Hyper-V server is retrieved by Azure Site Recovery, and the server is displayed in **Site Recovery Infrastructure** > **Hyper-V Hosts**.</span></span>


## <a name="set-up-the-target-environment"></a><span data-ttu-id="4898b-218">Configurare l'ambiente di destinazione</span><span class="sxs-lookup"><span data-stu-id="4898b-218">Set up the target environment</span></span>

<span data-ttu-id="4898b-219">Specificare l'account di archiviazione di Azure per la replica e la rete di Azure a cui le macchine virtuali di Azure dovranno connettersi dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="4898b-219">Specify the Azure storage account for replication, and the Azure network to which Azure VMs will connect after failover.</span></span>

1. <span data-ttu-id="4898b-220">Fare clic su **Preparare l'infrastruttura** > **Destinazione**.</span><span class="sxs-lookup"><span data-stu-id="4898b-220">Click **Prepare infrastructure** > **Target**.</span></span>
2. <span data-ttu-id="4898b-221">Selezionare la sottoscrizione e il gruppo di risorse in cui si desidera creare le macchine virtuali di Azure dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="4898b-221">Select the subscription and the resource group in which you want to create the Azure VMs after failover.</span></span> <span data-ttu-id="4898b-222">Scegliere il modello di distribuzione (classica o Resource Manager) da usare in Azure per le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="4898b-222">Choose the deployment model that you want to use in Azure (classic or resource management) for the VMs.</span></span>

3. <span data-ttu-id="4898b-223">Site Recovery verifica la disponibilità di uno o più account di archiviazione di Azure e reti compatibili.</span><span class="sxs-lookup"><span data-stu-id="4898b-223">Site Recovery checks that you have one or more compatible Azure storage accounts and networks.</span></span>

    - <span data-ttu-id="4898b-224">Se non si dispone di un account di archiviazione, fare clic su **+ Archiviazione** per creare un account basato su Resource Manager inline.</span><span class="sxs-lookup"><span data-stu-id="4898b-224">If you don't have a storage account, click **+Storage** to create a Resource Manager-based account inline.</span></span> <span data-ttu-id="4898b-225">Leggere i [requisiti per l'archiviazione](site-recovery-prereq.md#azure-requirements).</span><span class="sxs-lookup"><span data-stu-id="4898b-225">Read about [storage requirements](site-recovery-prereq.md#azure-requirements).</span></span>
    - <span data-ttu-id="4898b-226">Se non si dispone di una rete Azure, fare clic su **+Rete** per creare una rete basata su Resource Manager inline.</span><span class="sxs-lookup"><span data-stu-id="4898b-226">If you don't have a Azure network, click **+Network** to create a Resource Manager-based network inline.</span></span>

    ![Archiviazione](./media/site-recovery-vmware-to-azure/enable-rep3.png)




## <a name="configure-replication-settings"></a><span data-ttu-id="4898b-228">Configurare le impostazioni di replica</span><span class="sxs-lookup"><span data-stu-id="4898b-228">Configure replication settings</span></span>

1. <span data-ttu-id="4898b-229">Per creare nuovi criteri di replica, fare clic su **Preparare l'infrastruttura** > **Impostazioni della replica** > **+Crea e associa**.</span><span class="sxs-lookup"><span data-stu-id="4898b-229">To create a new replication policy, click **Prepare infrastructure** > **Replication Settings** > **+Create and associate**.</span></span>

    ![Rete](./media/site-recovery-hyper-v-site-to-azure/gs-replication.png)
2. <span data-ttu-id="4898b-231">In **Criteri di creazione e associazione**specificare il nome dei criteri.</span><span class="sxs-lookup"><span data-stu-id="4898b-231">In **Create and associate policy**, specify a policy name.</span></span>
3. <span data-ttu-id="4898b-232">In **Frequenza di copia**specificare la frequenza con cui replicare i dati differenziali dopo la replica iniziale, ogni 30 secondi oppure ogni 5 o 15 minuti.</span><span class="sxs-lookup"><span data-stu-id="4898b-232">In **Copy frequency**, specify how often you want to replicate delta data after the initial replication (every 30 seconds, 5 or 15 minutes).</span></span>

    > [!NOTE]
    > <span data-ttu-id="4898b-233">Quando si esegue la replica in archiviazione Premium la frequenza di 30 secondi non è supportata.</span><span class="sxs-lookup"><span data-stu-id="4898b-233">A 30 second frequency isn't supported when replicating to premium storage.</span></span> <span data-ttu-id="4898b-234">Il limite è determinato dal numero di snapshot per BLOB (100) supportato dal servizio di archiviazione Premium.</span><span class="sxs-lookup"><span data-stu-id="4898b-234">The limitation is determined by the number of snapshots per blob (100) supported by premium storage.</span></span> <span data-ttu-id="4898b-235">[Altre informazioni](../storage/storage-premium-storage.md#snapshots-and-copy-blob).</span><span class="sxs-lookup"><span data-stu-id="4898b-235">[Learn more](../storage/storage-premium-storage.md#snapshots-and-copy-blob).</span></span>

4. <span data-ttu-id="4898b-236">In **Conservazione del punto di recupero** specificare la durata in ore dell'intervallo di conservazione per ogni punto di recupero.</span><span class="sxs-lookup"><span data-stu-id="4898b-236">In **Recovery point retention**, specify in hours how long the retention window is for each recovery point.</span></span> <span data-ttu-id="4898b-237">Le macchine virtuali possono essere ripristinate in qualsiasi punto all'interno di un intervallo.</span><span class="sxs-lookup"><span data-stu-id="4898b-237">VMs can be recovered to any point within a window.</span></span>
5. <span data-ttu-id="4898b-238">In **Frequenza snapshot coerenti con l'app** specificare la frequenza, da 1 a 12 ore, per la creazione di punti di ripristino contenenti snapshot coerenti con l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4898b-238">In **App-consistent snapshot frequency**, specify how frequently (1-12 hours) recovery points containing application-consistent snapshots are created.</span></span>

    - <span data-ttu-id="4898b-239">Hyper-V utilizza due tipi di snapshot, uno snapshot standard che fornisce uno snapshot incrementale dell'intera macchina virtuale e uno snapshot coerente con l'applicazione che accetta uno snapshot temporizzato dei dati dell'applicazione all'interno della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="4898b-239">Hyper-V uses two types of snapshots — a standard snapshot that provides an incremental snapshot of the entire virtual machine, and an application-consistent snapshot that takes a point-in-time snapshot of the application data inside the virtual machine.</span></span>
    - <span data-ttu-id="4898b-240">Negli snapshot coerenti dell'applicazione viene usato il servizio Copia Shadow del volume (VSS) per garantire che le applicazioni siano coerenti durante la creazione dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="4898b-240">Application-consistent snapshots use Volume Shadow Copy Service (VSS) to ensure that applications are in a consistent state when the snapshot is taken.</span></span>
    - <span data-ttu-id="4898b-241">L'abilitazione di snapshot coerenti con l'applicazione influirà sulle prestazioni delle applicazioni in esecuzione nelle macchine virtuali di origine.</span><span class="sxs-lookup"><span data-stu-id="4898b-241">If you enable application-consistent snapshots, it will affect the performance of applications running on source virtual machines.</span></span> <span data-ttu-id="4898b-242">Assicurarsi che il valore impostato sia inferiore al numero di punti di ripristino aggiuntivi configurati.</span><span class="sxs-lookup"><span data-stu-id="4898b-242">Ensure that the value you set is less than the number of additional recovery points you configure.</span></span>

6. <span data-ttu-id="4898b-243">In **Ora di inizio della replica iniziale** specificare quando deve essere avviata la replica iniziale.</span><span class="sxs-lookup"><span data-stu-id="4898b-243">In **Initial replication start time**, specify when to start the initial replication.</span></span> <span data-ttu-id="4898b-244">La replica avviene sulla larghezza di banda Internet. È quindi consigliabile pianificarla al di fuori dell'orario di lavoro.</span><span class="sxs-lookup"><span data-stu-id="4898b-244">The replication occurs over your internet bandwidth so you might want to schedule it outside your busy hours.</span></span> <span data-ttu-id="4898b-245">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="4898b-245">Then click **OK**.</span></span>

    ![Criteri di replica](./media/site-recovery-hyper-v-site-to-azure/gs-replication2.png)

<span data-ttu-id="4898b-247">Quando si creano nuovi criteri, questi vengono associati automaticamente al sito Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="4898b-247">When you create a new policy, it's automatically associated with the Hyper-V site.</span></span> <span data-ttu-id="4898b-248">È possibile associare un sito Hyper-V e le VM che contiene a più criteri di replica in **Replica** > nome-criteri > **Associate Hyper-V Site** (Associa sito Hyper-V).</span><span class="sxs-lookup"><span data-stu-id="4898b-248">You can associate a Hyper-V site (and the VMs in it) with multiple replication policies in **Replication** > policy-name > **Associate Hyper-V Site**.</span></span>

## <a name="capacity-planning"></a><span data-ttu-id="4898b-249">Pianificazione della capacità</span><span class="sxs-lookup"><span data-stu-id="4898b-249">Capacity planning</span></span>

<span data-ttu-id="4898b-250">Dopo aver configurato l'infrastruttura di base è possibile passare alla pianificazione della capacità e valutare se sono necessarie altre risorse.</span><span class="sxs-lookup"><span data-stu-id="4898b-250">Now that you have your basic infrastructure set up, you can think about capacity planning, and figure out whether you need additional resources.</span></span>

<span data-ttu-id="4898b-251">In Site Recovery è disponibile lo strumento Capacity Planner, che permette di allocare le risorse appropriate per il calcolo, la rete e l'archiviazione.</span><span class="sxs-lookup"><span data-stu-id="4898b-251">Site Recovery provides a capacity planner to help you allocate the right resources for compute, networking, and storage.</span></span> <span data-ttu-id="4898b-252">È possibile eseguire lo strumento di pianificazione in modalità rapida, per ottenere stime basate su un numero medio di macchine virtuali, dischi e risorse di archiviazione oppure in modalità dettagliata, con numeri personalizzati a livello di carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="4898b-252">You can run the planner in quick mode for estimations based on an average number of VMs, disks, and storage, or in detailed mode with customized numbers at the workload level.</span></span> <span data-ttu-id="4898b-253">Prima di iniziare è necessario:</span><span class="sxs-lookup"><span data-stu-id="4898b-253">Before you start you need to:</span></span>

* <span data-ttu-id="4898b-254">Raccogliere informazioni sull'ambiente di replica, incluse le macchine virtuali, i dischi per ogni macchina virtuale e le risorse di archiviazione per ogni disco.</span><span class="sxs-lookup"><span data-stu-id="4898b-254">Gather information about your replication environment, including VMs, disks per VMs, and storage per disk.</span></span>
* <span data-ttu-id="4898b-255">Stimare la frequenza di modifica giornaliera (varianza) per i dati replicati.</span><span class="sxs-lookup"><span data-stu-id="4898b-255">Estimate the daily change (churn) rate for your replicated data.</span></span> <span data-ttu-id="4898b-256">A questo scopo è possibile usare lo strumento [Capacity Planner for Hyper-V Replica](https://www.microsoft.com/download/details.aspx?id=39057) .</span><span class="sxs-lookup"><span data-stu-id="4898b-256">You can use the [Capacity Planner for Hyper-V Replica](https://www.microsoft.com/download/details.aspx?id=39057) to help you do this.</span></span>

1. <span data-ttu-id="4898b-257">Fare clic su **Download** per scaricare lo strumento e quindi eseguirlo.</span><span class="sxs-lookup"><span data-stu-id="4898b-257">Click **Download** to download the tool, and then run it.</span></span> <span data-ttu-id="4898b-258">[Vedere l'articolo](site-recovery-capacity-planner.md) fornito con lo strumento.</span><span class="sxs-lookup"><span data-stu-id="4898b-258">[Read the article](site-recovery-capacity-planner.md) that accompanies the tool.</span></span>
2. <span data-ttu-id="4898b-259">Al termine scegliere **Sì** in **Have you run the Capacity Planner**(È stato eseguito lo strumento Capacity Planner?).</span><span class="sxs-lookup"><span data-stu-id="4898b-259">When you’re done, select **Yes** in **Have you run the Capacity Planner**?</span></span>

   ![Pianificazione della capacità](./media/site-recovery-hyper-v-site-to-azure/gs-capacity-planning.png)

<span data-ttu-id="4898b-261">Ulteriori informazioni sul [controllo della larghezza di banda di rete](#network-bandwidth-considerations)</span><span class="sxs-lookup"><span data-stu-id="4898b-261">Learn more about [controlling network bandwidth](#network-bandwidth-considerations)</span></span>



## <a name="enable-replication"></a><span data-ttu-id="4898b-262">Abilitare la replica</span><span class="sxs-lookup"><span data-stu-id="4898b-262">Enable replication</span></span>

<span data-ttu-id="4898b-263">Prima di iniziare, verificare che l'account utente di Azure disponga delle [autorizzazioni](site-recovery-role-based-linked-access-control.md#permissions-required-to-enable-replication-for-new-virtual-machines) necessarie per abilitare la replica di una nuova macchina virtuale in Azure.</span><span class="sxs-lookup"><span data-stu-id="4898b-263">Before you start, ensure that your Azure user account has the required  [permissions](site-recovery-role-based-linked-access-control.md#permissions-required-to-enable-replication-for-new-virtual-machines) to enable replication of a new virtual machine to Azure.</span></span>

<span data-ttu-id="4898b-264">Abilitare la replica per le macchine virtuali nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="4898b-264">Enable replication for VMs as follows:</span></span>          

1. <span data-ttu-id="4898b-265">Fare clic su **Eseguire la replica dell'applicazione** > **Origine**.</span><span class="sxs-lookup"><span data-stu-id="4898b-265">Click **Replicate application** > **Source**.</span></span> <span data-ttu-id="4898b-266">Dopo avere configurato la replica per la prima volta, è possibile fare clic su **+Replica** per abilitare la replica per altri computer.</span><span class="sxs-lookup"><span data-stu-id="4898b-266">After you've set up replication for the first time, you can click **+Replicate** to enable replication for additional machines.</span></span>

    ![Abilitare la replica](./media/site-recovery-hyper-v-site-to-azure/enable-replication.png)
2. <span data-ttu-id="4898b-268">In **Origine** selezionare il sito Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="4898b-268">In **Source**, select the Hyper-V site.</span></span> <span data-ttu-id="4898b-269">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="4898b-269">Then click **OK**.</span></span>
3. <span data-ttu-id="4898b-270">In **Destinazione** selezionare la sottoscrizione dell'insieme di credenziali e il modello di failover da usare in Azure (modalità classica o Resource Manager) dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="4898b-270">In **Target**, select the vault subscription, and the failover model you want to use in Azure (classic or resource management) after failover.</span></span>
4. <span data-ttu-id="4898b-271">Selezionare l'account di archiviazione da usare.</span><span class="sxs-lookup"><span data-stu-id="4898b-271">Select the storage account you want to use.</span></span> <span data-ttu-id="4898b-272">Se non si dispone di un account da usare, è possibile [crearne uno](#set-up-an-azure-storage-account).</span><span class="sxs-lookup"><span data-stu-id="4898b-272">If you don't have an account you want to use, you can [create one](#set-up-an-azure-storage-account).</span></span> <span data-ttu-id="4898b-273">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="4898b-273">Then click **OK**.</span></span>
5. <span data-ttu-id="4898b-274">Selezionare la rete di Azure e la subnet a cui dovranno connettersi le macchine virtuali di Azure create dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="4898b-274">Select the Azure network and subnet to which Azure VMs will connect when they're created failover.</span></span>

    - <span data-ttu-id="4898b-275">Per applicare le impostazioni di rete a tutti i computer selezionati per la replica, selezionare **Configurare ora per le macchine virtuali selezionate**.</span><span class="sxs-lookup"><span data-stu-id="4898b-275">To apply the network settings to all machines you enable for replication, select **Configure now for selected machines**.</span></span>
    - <span data-ttu-id="4898b-276">Scegliere **Configurare in seguito** per selezionare la rete di Azure per ogni computer.</span><span class="sxs-lookup"><span data-stu-id="4898b-276">Select **Configure later** to select the Azure network per machine.</span></span>
    - <span data-ttu-id="4898b-277">Se non si dispone di una rete da usare, è possibile [crearne una](#set-up-an-azure-network).</span><span class="sxs-lookup"><span data-stu-id="4898b-277">If you don't have a network you want to use, you can [create one](#set-up-an-azure-network).</span></span> <span data-ttu-id="4898b-278">Selezionare una subnet, se applicabile.</span><span class="sxs-lookup"><span data-stu-id="4898b-278">Select a subnet if applicable.</span></span> <span data-ttu-id="4898b-279">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="4898b-279">Then click **OK**.</span></span>

   ![Abilitare la replica](./media/site-recovery-hyper-v-site-to-azure/enable-replication11.png)

6. <span data-ttu-id="4898b-281">In **Macchine virtuali** > **Seleziona macchine virtuali** fare clic per selezionare tutte le macchine virtuali da replicare.</span><span class="sxs-lookup"><span data-stu-id="4898b-281">In **Virtual Machines** > **Select virtual machines**, click and select each machine you want to replicate.</span></span> <span data-ttu-id="4898b-282">È possibile selezionare solo i computer per cui è possibile abilitare la replica.</span><span class="sxs-lookup"><span data-stu-id="4898b-282">You can only select machines for which replication can be enabled.</span></span> <span data-ttu-id="4898b-283">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="4898b-283">Then click **OK**.</span></span>

    ![Abilitare la replica](./media/site-recovery-hyper-v-site-to-azure/enable-replication5-for-exclude-disk.png)

7. <span data-ttu-id="4898b-285">In **Proprietà** > **Configura proprietà**selezionare il sistema operativo per le VM selezionate e il disco del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="4898b-285">In **Properties** > **Configure properties**, select the operating system for the selected VMs, and the OS disk.</span></span>
8. <span data-ttu-id="4898b-286">Verificare che il nome della VM di Azure (nome di destinazione) sia conforme ai [requisiti per le macchine virtuali di Azure](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).</span><span class="sxs-lookup"><span data-stu-id="4898b-286">Verify that the Azure VM name (target name) complies with [Azure virtual machine requirements](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).</span></span>
9. <span data-ttu-id="4898b-287">Per impostazione predefinita, tutti i dischi della VM sono selezionati per la replica. È tuttavia possibile cancellarli per escluderli,</span><span class="sxs-lookup"><span data-stu-id="4898b-287">By default all the disks of the VM are selected for replication, but you can clear disks to exclude them.</span></span>
    - <span data-ttu-id="4898b-288">ad esempio per ridurre la larghezza di banda di replica.</span><span class="sxs-lookup"><span data-stu-id="4898b-288">You might want to exclude disks to reduce replication bandwidth.</span></span> <span data-ttu-id="4898b-289">È possibile evitare, ad esempio, di replicare i dischi con dati temporanei o dati che vengono aggiornati ad ogni riavvio di un computer o di un'applicazione, come pagefile.sys o tempdb di Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4898b-289">For example, you might not want to replicate disks with temporary data, or data that's refreshed each time a machine or apps restarts (such as pagefile.sys or Microsoft SQL Server tempdb).</span></span> <span data-ttu-id="4898b-290">Per escludere un disco dalla replica, è sufficiente selezionarlo.</span><span class="sxs-lookup"><span data-stu-id="4898b-290">You can exclude the disk from replication by unselecting the disk.</span></span>
    - <span data-ttu-id="4898b-291">Solo i dischi di base possono essere esclusi dalla replica.</span><span class="sxs-lookup"><span data-stu-id="4898b-291">Only basic disks can be exclude.</span></span> <span data-ttu-id="4898b-292">Non è possibile escludere dischi del sistema operativo</span><span class="sxs-lookup"><span data-stu-id="4898b-292">You can't exclude OS disks.</span></span>
    - <span data-ttu-id="4898b-293">e non è consigliabile escludere dischi dinamici.</span><span class="sxs-lookup"><span data-stu-id="4898b-293">We recommend that you don't exclude dynamic disks.</span></span> <span data-ttu-id="4898b-294">Site Recovery non può determinare se un disco rigido virtuale all'interno della macchina virtuale guest è di base o dinamico.</span><span class="sxs-lookup"><span data-stu-id="4898b-294">Site Recovery can't identify whether a virtual hard disk inside a guest VM is basic or dynamic.</span></span> <span data-ttu-id="4898b-295">Se non sono esclusi tutti i volumi dinamici dipendenti, in caso di failover della VM il disco dinamico protetto risulterà guasto e non sarà possibile accedere ai dati presenti su tale disco.</span><span class="sxs-lookup"><span data-stu-id="4898b-295">If all dependent dynamic volume disks aren't excluded, the protected dynamic disk will show as a failed disk when the VM fails over, and the data on that disk won't be accessible.</span></span>
        - <span data-ttu-id="4898b-296">Dopo aver abilitato la replica, non è più possibile aggiungere o rimuovere dischi da replicare.</span><span class="sxs-lookup"><span data-stu-id="4898b-296">After replication is enabled, you can't add or remove disks for replication.</span></span> <span data-ttu-id="4898b-297">Se si desidera aggiungere o escludere un disco, è necessario disabilitare la protezione della macchina virtuale e riabilitarla al termine dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="4898b-297">If you want to add or exclude a disk, you need to disable protection for the VM, and then re-enable it.</span></span>
        - <span data-ttu-id="4898b-298">Per i dischi creati manualmente in Azure non viene eseguito il failback.</span><span class="sxs-lookup"><span data-stu-id="4898b-298">Disks you create manually in Azure aren't failed back.</span></span> <span data-ttu-id="4898b-299">Ad esempio, se si esegue il failover di tre dischi e se ne creano due direttamente in Azure, verrà eseguito il failback da Azure a Hyper-V soltanto dei tre dischi.</span><span class="sxs-lookup"><span data-stu-id="4898b-299">For example, if you fail over three disks, and create two directly in Azure VM, only the three disks which were failed over will be failed back from Azure to Hyper-V.</span></span> <span data-ttu-id="4898b-300">Non è possibile includere nel failback o nella replica inversa da Hyper-V ad Azure i dischi creati manualmente.</span><span class="sxs-lookup"><span data-stu-id="4898b-300">You can't include disks created manually in failback, or in reverse replication from Hyper-V to Azure.</span></span>
        - <span data-ttu-id="4898b-301">Se si esclude un disco necessario per il funzionamento di un'applicazione, dopo il failover in Azure è necessario crearlo manualmente in Azure per consentire l'esecuzione dell'applicazione replicata.</span><span class="sxs-lookup"><span data-stu-id="4898b-301">If you exclude a disk that's needed for an application to operate, after failover to Azure you need to create it manually in Azure, so that the replicated application can run.</span></span> <span data-ttu-id="4898b-302">È possibile in alternativa integrare Automazione di Azure in un piano di ripristino per creare il disco durante il failover del computer.</span><span class="sxs-lookup"><span data-stu-id="4898b-302">Alternatively, you could integrate Azure automation into a recovery plan, to create the disk during failover of the machine.</span></span>

10. <span data-ttu-id="4898b-303">Fare clic su **OK** per salvare le modifiche.</span><span class="sxs-lookup"><span data-stu-id="4898b-303">Click **OK** to save changes.</span></span> <span data-ttu-id="4898b-304">È possibile impostare proprietà aggiuntive in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="4898b-304">You can set additional properties later.</span></span>

    ![Abilitare la replica](./media/site-recovery-hyper-v-site-to-azure/enable-replication6-with-exclude-disk.png)

11. <span data-ttu-id="4898b-306">In **Impostazioni della replica** > **Configurare le impostazioni di replica** selezionare i criteri di replica da applicare per le VM protette.</span><span class="sxs-lookup"><span data-stu-id="4898b-306">In **Replication settings** > **Configure replication settings**, select the replication policy you want to apply for the protected VMs.</span></span> <span data-ttu-id="4898b-307">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="4898b-307">Then click **OK**.</span></span> <span data-ttu-id="4898b-308">È possibile modificare i criteri di replica in **Criteri di replica** > nome-criterio > **Modifica impostazioni**.</span><span class="sxs-lookup"><span data-stu-id="4898b-308">You can modify the replication policy in **Replication policies** > policy-name > **Edit Settings**.</span></span> <span data-ttu-id="4898b-309">Le modifiche applicate verranno usate per i computer di cui è già in corso la replica e per i nuovi computer.</span><span class="sxs-lookup"><span data-stu-id="4898b-309">Changes you apply will be used for machines that are already replicating, and new machines.</span></span>


   ![Abilitare la replica](./media/site-recovery-hyper-v-site-to-azure/enable-replication7.png)

<span data-ttu-id="4898b-311">È possibile tenere traccia dello stato del processo **Abilita protezione** in **Processi** > **Site Recovery jobs** (Processi di Site Recovery).</span><span class="sxs-lookup"><span data-stu-id="4898b-311">You can track progress of the **Enable Protection** job in **Jobs** > **Site Recovery jobs**.</span></span> <span data-ttu-id="4898b-312">Dopo l'esecuzione del processo **Finalizza protezione** la macchina virtuale è pronta per il failover.</span><span class="sxs-lookup"><span data-stu-id="4898b-312">After the **Finalize Protection** job runs the machine is ready for failover.</span></span>

### <a name="view-and-manage-vm-properties"></a><span data-ttu-id="4898b-313">Visualizzare e gestire le proprietà della macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="4898b-313">View and manage VM properties</span></span>

<span data-ttu-id="4898b-314">È consigliabile verificare le proprietà del computer di origine.</span><span class="sxs-lookup"><span data-stu-id="4898b-314">We recommend that you verify the properties of the source machine.</span></span>

1. <span data-ttu-id="4898b-315">In **Elementi protetti** fare clic su **Elementi replicati** e selezionare il computer.</span><span class="sxs-lookup"><span data-stu-id="4898b-315">In **Protected Items**, click **Replicated Items**, and select the machine.</span></span>

    ![Abilitare la replica](./media/site-recovery-hyper-v-site-to-azure/test-failover1.png)
2. <span data-ttu-id="4898b-317">In **Proprietà** sono disponibili le informazioni su replica e failover per la VM.</span><span class="sxs-lookup"><span data-stu-id="4898b-317">In **Properties**, you can view replication and failover information for the VM.</span></span>

    ![Abilitare la replica](./media/site-recovery-hyper-v-site-to-azure/test-failover2.png)
3. <span data-ttu-id="4898b-319">In **Calcolo e rete** > **Proprietà di calcolo** è possibile specificare le dimensioni di destinazione e il nome della VM di Azure.</span><span class="sxs-lookup"><span data-stu-id="4898b-319">In **Compute and Network** > **Compute properties**, you can specify the Azure VM name and target size.</span></span> <span data-ttu-id="4898b-320">Se necessario, modificare il nome in modo che sia conforme ai requisiti di Azure.</span><span class="sxs-lookup"><span data-stu-id="4898b-320">Modify the name to comply with Azure requirements if you need to.</span></span> <span data-ttu-id="4898b-321">È anche possibile visualizzare e modificare le informazioni sulla rete di destinazione, la subnet e l'indirizzo IP che verranno assegnati alla macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="4898b-321">You can also view and modify information about the target network, subnet, and IP address that will be assigned to the Azure VM.</span></span> <span data-ttu-id="4898b-322">Tenere presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="4898b-322">Note the following:</span></span>

   * <span data-ttu-id="4898b-323">È possibile impostare l'indirizzo IP di destinazione.</span><span class="sxs-lookup"><span data-stu-id="4898b-323">You can set the target IP address.</span></span> <span data-ttu-id="4898b-324">Se non si specifica un indirizzo, il computer di cui è stato eseguito il failover usa DHCP.</span><span class="sxs-lookup"><span data-stu-id="4898b-324">If you don't provide an address, the failed over machine will use DHCP.</span></span> <span data-ttu-id="4898b-325">Se si imposta un indirizzo che non è disponibile al momento del failover, il failover ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="4898b-325">If you set an address that isn't available at failover, the failover will fail.</span></span> <span data-ttu-id="4898b-326">Se l'indirizzo è disponibile nella rete di failover di test, è possibile usare lo stesso indirizzo IP di destinazione per il failover di test.</span><span class="sxs-lookup"><span data-stu-id="4898b-326">The same target IP address can be used for test failover if the address is available in the test failover network.</span></span>
   * <span data-ttu-id="4898b-327">Il numero di schede di rete dipende dalle dimensioni specificate per la macchina virtuale di destinazione, come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="4898b-327">The number of network adapters is dictated by the size you specify for the target virtual machine, as follows:</span></span>

     * <span data-ttu-id="4898b-328">Se il numero di schede di rete nella macchina di origine è minore o uguale al numero di schede consentite per la macchina di destinazione, la destinazione avrà lo stesso numero di schede dell’origine.</span><span class="sxs-lookup"><span data-stu-id="4898b-328">If the number of network adapters on the source machine is less than or equal to the number of adapters allowed for the target machine size, then the target will have the same number of adapters as the source.</span></span>
     * <span data-ttu-id="4898b-329">Se il numero di schede per la macchina virtuale di origine supera il numero consentito per le dimensioni di destinazione, verrà utilizzata la dimensione di destinazione massima.</span><span class="sxs-lookup"><span data-stu-id="4898b-329">If the number of adapters for the source virtual machine exceeds the number allowed for the target size then the target size maximum will be used.</span></span>
     * <span data-ttu-id="4898b-330">Ad esempio, se una macchina di origine dispone di due schede di rete e le dimensioni della macchina di destinazione ne supportano quattro, la macchina di destinazione avrà due schede.</span><span class="sxs-lookup"><span data-stu-id="4898b-330">For example if a source machine has two network adapters and the target machine size supports four, the target machine will have two adapters.</span></span> <span data-ttu-id="4898b-331">Se la macchina di origine dispone di due schede ma le dimensioni di destinazione supportate ne consentono solo una, la macchina di destinazione avrà una sola scheda.</span><span class="sxs-lookup"><span data-stu-id="4898b-331">If the source machine has two adapters but the supported target size only supports one then the target machine will have only one adapter.</span></span>     
     * <span data-ttu-id="4898b-332">Se la macchina virtuale ha più schede di rete, si connetteranno tutte alla stessa rete.</span><span class="sxs-lookup"><span data-stu-id="4898b-332">If the VM has multiple network adapters they will all connect to the same network.</span></span>
     * <span data-ttu-id="4898b-333">Se la macchina virtuale ha più schede di rete, la prima nell'elenco diventa la scheda di rete *predefinita* nella macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="4898b-333">If the virtual machine has multiple network adapters then the first one shown in the list becomes the *Default* network adapter in the Azure virtual machine.</span></span>

     ![Abilitare la replica](./media/site-recovery-hyper-v-site-to-azure/test-failover4.png)

4. <span data-ttu-id="4898b-335">In **Dischi** è possibile visualizzare il sistema operativo e i dischi dati della VM che verranno replicati.</span><span class="sxs-lookup"><span data-stu-id="4898b-335">In **Disks**, you can see the operating system and data disks on the VM that will be replicated.</span></span>

#### <a name="managed-disks"></a><span data-ttu-id="4898b-336">Dischi gestiti</span><span class="sxs-lookup"><span data-stu-id="4898b-336">Managed disks</span></span>

<span data-ttu-id="4898b-337">In **Calcolo e rete** > **Proprietà di calcolo** è possibile impostare l'opzione "Usa dischi gestiti" della macchina virtuale su "Sì" per collegare i dischi gestiti al computer in uso al momento della migrazione in Azure.</span><span class="sxs-lookup"><span data-stu-id="4898b-337">In **Compute and Network** > **Compute properties**, you can set "Use managed disks" setting to "Yes" for the VM if you want to attach managed disks to your machine on migration to Azure.</span></span> <span data-ttu-id="4898b-338">Managed Disks semplifica la gestione dei dischi per le macchine virtuali IaaS di Azure grazie alla gestione degli account di archiviazione associati ai dischi delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="4898b-338">Managed disks simplifies disk management for Azure IaaS VMs by managing the storage accounts associated with the VM disks.</span></span> <span data-ttu-id="4898b-339">[Altre informazioni su Managed Disks](https://docs.microsoft.com/en-us/azure/storage/storage-managed-disks-overview).</span><span class="sxs-lookup"><span data-stu-id="4898b-339">[Learn More about managed disks](https://docs.microsoft.com/en-us/azure/storage/storage-managed-disks-overview).</span></span>

   - <span data-ttu-id="4898b-340">I dischi gestiti vengono creati e collegati alla macchina virtuale solo in caso di failover in Azure.</span><span class="sxs-lookup"><span data-stu-id="4898b-340">Managed disks are created and attached to the virtual machine only on a failover to Azure.</span></span> <span data-ttu-id="4898b-341">Abilitando la protezione, i dati verranno comunque replicati dai computer locali agli account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="4898b-341">On enabling protection, data from on-premises machines will continue to replicate to storage accounts.</span></span>
   <span data-ttu-id="4898b-342">È possibile creare dischi gestiti solo per le macchine virtuali distribuite tramite il modello di distribuzione di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="4898b-342">Managed disks can be created only for virtual machines deployed using the Resource manager deployment model.</span></span>

  > [!NOTE]
  > <span data-ttu-id="4898b-343">Il failback da Azure all'ambiente Hyper-V locale non è al momento supportato per i computer con dischi gestiti.</span><span class="sxs-lookup"><span data-stu-id="4898b-343">Failback from Azure to on-premises Hyper-V environment is not currently supported for machines with managed disks.</span></span> <span data-ttu-id="4898b-344">Impostare l'opzione "Usa dischi gestiti" su "Sì" solo se si prevede di eseguire la migrazione della macchina in Azure.</span><span class="sxs-lookup"><span data-stu-id="4898b-344">Set "Use managed disks" to "Yes" only if you intend to migrate this machine to Azure.</span></span>

   - <span data-ttu-id="4898b-345">Quando l'opzione "Usa dischi gestiti" viene impostata su "Sì", nel gruppo di risorse è possibile selezionare solo i set di disponibilità con l'opzione "Usa dischi gestiti" impostata su "Sì".</span><span class="sxs-lookup"><span data-stu-id="4898b-345">When you set "Use managed disks" to "Yes", only availability sets in the resource group with "Use managed disks" set to "Yes" would be available for selection.</span></span> <span data-ttu-id="4898b-346">Infatti, le macchine virtuali con dischi gestiti possono solo far parte di set di disponibilità la cui proprietà "Usa dischi gestiti" è impostata su "Sì".</span><span class="sxs-lookup"><span data-stu-id="4898b-346">This is because virtual machines with managed disks can only be part of availability sets with "Use managed disks" property set to "Yes".</span></span> <span data-ttu-id="4898b-347">Verificare di creare set di disponibilità con la proprietà "Usa dischi gestiti" impostata in funzione dell'intenzione di usare i dischi gestiti in caso di failover.</span><span class="sxs-lookup"><span data-stu-id="4898b-347">Make sure that you create availability sets with "Use managed disks" property set based on your intent to use managed disks on failover.</span></span> <span data-ttu-id="4898b-348">Allo stesso modo, quando l'opzione "Usa dischi gestiti" è impostata su "No", nel gruppo di risorse è possibile selezionare solo i set di disponibilità con la proprietà "Usa dischi gestiti" impostata su "No".</span><span class="sxs-lookup"><span data-stu-id="4898b-348">Likewise, when you set "Use managed disks" to "No", only availability sets in the resource group with "Use managed disks" property set to "No" would be available for selection.</span></span> <span data-ttu-id="4898b-349">[Altre informazioni sui dischi gestiti e i set di disponibilità](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/manage-availability#use-managed-disks-for-vms-in-an-availability-set).</span><span class="sxs-lookup"><span data-stu-id="4898b-349">[Learn more about managed disks and availability sets](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/manage-availability#use-managed-disks-for-vms-in-an-availability-set).</span></span>

  > [!NOTE]
  > <span data-ttu-id="4898b-350">Se l'account di archiviazione usato per la replica è stato crittografato con Crittografia del servizio di archiviazione in un qualsiasi momento, la creazione dei dischi gestiti durante il failover non avrà esito positivo.</span><span class="sxs-lookup"><span data-stu-id="4898b-350">If the storage account used for replication was encrypted with Storage Service Encryption at any point in time, creation of managed disks during failover will fail.</span></span> <span data-ttu-id="4898b-351">È possibile impostare "Usa dischi gestiti" su "No" e ripetere il failover oppure disabilitare la protezione per la macchina virtuale e proteggerla in un account di archiviazione per il quale non sia attivata la Crittografia del servizio di archiviazione in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="4898b-351">You can either set "Use managed disks" to "No" and retry failover or disable protection for the virtual machine and protect it to a storage account which did not have Storage service encryption enabled at any point in time.</span></span>
  > <span data-ttu-id="4898b-352">[Altre informazioni su Crittografia del servizio di archiviazione e dischi gestiti](https://docs.microsoft.com/en-us/azure/storage/storage-managed-disks-overview#managed-disks-and-encryption).</span><span class="sxs-lookup"><span data-stu-id="4898b-352">[Learn more about Storage service encryption and managed disks](https://docs.microsoft.com/en-us/azure/storage/storage-managed-disks-overview#managed-disks-and-encryption).</span></span>


## <a name="test-the-deployment"></a><span data-ttu-id="4898b-353">Test della distribuzione</span><span class="sxs-lookup"><span data-stu-id="4898b-353">Test the deployment</span></span>

<span data-ttu-id="4898b-354">Per testare la distribuzione è possibile eseguire un failover di test per una singola macchina virtuale o un piano di ripristino che contenga una o più macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="4898b-354">To test the deployment you can run a test failover for a single virtual machine or a recovery plan that contains one or more virtual machines.</span></span>

### <a name="before-you-start"></a><span data-ttu-id="4898b-355">Prima di iniziare</span><span class="sxs-lookup"><span data-stu-id="4898b-355">Before you start</span></span>

 - <span data-ttu-id="4898b-356">Per connettersi alle macchine virtuali di Azure con RDP dopo il failover, seguire le istruzioni per la [preparazione alla connessione](site-recovery-test-failover-to-azure.md#prepare-to-connect-to-azure-vms-after-failover).</span><span class="sxs-lookup"><span data-stu-id="4898b-356">If you want to connect to Azure VMs using RDP after failover, learn about [preparing to connect](site-recovery-test-failover-to-azure.md#prepare-to-connect-to-azure-vms-after-failover).</span></span>
 - <span data-ttu-id="4898b-357">Per un test completo è necessario copiare Active Directory e DNS nell'ambiente di test.</span><span class="sxs-lookup"><span data-stu-id="4898b-357">To fully test you need to copy of Active Directory and DNS in your test environment.</span></span> <span data-ttu-id="4898b-358">[Altre informazioni](site-recovery-active-directory.md#test-failover-considerations).</span><span class="sxs-lookup"><span data-stu-id="4898b-358">[Learn more](site-recovery-active-directory.md#test-failover-considerations).</span></span>

### <a name="run-a-test-failover"></a><span data-ttu-id="4898b-359">Eseguire un failover di test</span><span class="sxs-lookup"><span data-stu-id="4898b-359">Run a test failover</span></span>

1. <span data-ttu-id="4898b-360">Per eseguire il failover di una singola macchina, in **Elementi replicati** fare clic sulla VM e quindi sull'icona **+Failover di test**.</span><span class="sxs-lookup"><span data-stu-id="4898b-360">To fail over a single machine, in **Replicated Items**, click the VM > **+Test Failover** icon.</span></span>
2. <span data-ttu-id="4898b-361">Per eseguire il failover di un piano di ripristino, in **Piani di ripristino** fare clic con il pulsante destro del mouse sul piano e quindi su **Failover di test**.</span><span class="sxs-lookup"><span data-stu-id="4898b-361">To fail over a recovery plan, in **Recovery Plans**, right-click the plan > **Test Failover**.</span></span> <span data-ttu-id="4898b-362">Per creare un piano di ripristino, [seguire queste istruzioni](site-recovery-create-recovery-plans.md).</span><span class="sxs-lookup"><span data-stu-id="4898b-362">To create a recovery plan, [follow these instructions](site-recovery-create-recovery-plans.md).</span></span>
3. <span data-ttu-id="4898b-363">In **Failover di test** selezionare la rete di Azure a cui dovranno connettersi le VM di Azure dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="4898b-363">In **Test Failover**, select the Azure network to which Azure VMs will be connected after failover occurs.</span></span>
4. <span data-ttu-id="4898b-364">Fare clic su **OK** per iniziare il failover.</span><span class="sxs-lookup"><span data-stu-id="4898b-364">Click **OK** to begin the failover.</span></span> <span data-ttu-id="4898b-365">Per tenere traccia dello stato del processo, fare clic sulla VM per visualizzarne le proprietà oppure fare clic sul processo **Failover di test** nel nome dell'insieme di credenziali > **Processi** > **Site Recovery jobs** (Processi di Site Recovery).</span><span class="sxs-lookup"><span data-stu-id="4898b-365">You can track progress by clicking on the VM to open its properties, or on the **Test Failover** job in vault name > **Jobs** > **Site Recovery jobs**.</span></span>
5. <span data-ttu-id="4898b-366">Al termine del failover sarà possibile visualizzare la macchina virtuale di Azure di replica in **Macchine virtuali** nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="4898b-366">After the failover completes, you should also be able to see the replica Azure machine appear in the Azure portal > **Virtual Machines**.</span></span> <span data-ttu-id="4898b-367">Assicurarsi che la macchina virtuale sia delle dimensioni appropriate, che sia connessa alla rete giusta e che sia in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="4898b-367">You should make sure that the VM is the appropriate size, that it's connected to the appropriate network, and that it's running.</span></span>
6. <span data-ttu-id="4898b-368">Se sono state preparate le connessioni dopo il failover, sarà possibile connettersi alla VM di Azure.</span><span class="sxs-lookup"><span data-stu-id="4898b-368">If you prepared for connections after failover, you should be able to connect to the Azure VM.</span></span>
7. <span data-ttu-id="4898b-369">Al termine, fare clic su **Cleanup test failover** (Pulizia failover di test) nel piano di ripristino.</span><span class="sxs-lookup"><span data-stu-id="4898b-369">Once you're done, click on **Cleanup test failover** on the recovery plan.</span></span> <span data-ttu-id="4898b-370">Fare clic su **Note** per registrare e salvare eventuali osservazioni associate al failover di test.</span><span class="sxs-lookup"><span data-stu-id="4898b-370">In **Notes** record and save any observations associated with the test failover.</span></span> <span data-ttu-id="4898b-371">Verranno eliminate le macchine virtuali create durante il failover di test.</span><span class="sxs-lookup"><span data-stu-id="4898b-371">This will delete the virtual machines that were created during test failover.</span></span>

<span data-ttu-id="4898b-372">Per altre informazioni, vedere l'articolo [Failover di test in Azure](site-recovery-test-failover-to-azure.md).</span><span class="sxs-lookup"><span data-stu-id="4898b-372">For more details, read the [Test failover to Azure](site-recovery-test-failover-to-azure.md) article.</span></span>



## <a name="monitor-the-deployment"></a><span data-ttu-id="4898b-373">Monitorare la distribuzione</span><span class="sxs-lookup"><span data-stu-id="4898b-373">Monitor the deployment</span></span>

<span data-ttu-id="4898b-374">Per monitorare le impostazioni di configurazione, lo stato e l'integrità della distribuzione di Site Recovery, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="4898b-374">Monitor the configuration settings, status, and health for your Site Recovery deployment:</span></span>

1. <span data-ttu-id="4898b-375">Fare clic sul nome dell'insieme di credenziali per accedere al dashboard **Informazioni di base** .</span><span class="sxs-lookup"><span data-stu-id="4898b-375">Click on the vault name to access the **Essentials** dashboard.</span></span> <span data-ttu-id="4898b-376">In questo dashboard è possibile rilevare i processi di Site Recovery, lo stato della replica, i piani di ripristino, l'integrità del server e gli eventi.</span><span class="sxs-lookup"><span data-stu-id="4898b-376">In this dashboard you can track Site Recovery jobs, replication status, recovery plans, server health, and events.</span></span>  

    ![Informazioni di base](./media/site-recovery-hyper-v-site-to-azure/essentials.png)
2. <span data-ttu-id="4898b-378">Nel riquadro **Integrità** è possibile monitorare i server del sito in cui si verifica il problema e gli eventi generati da Site Recovery nelle ultime 24 ore.</span><span class="sxs-lookup"><span data-stu-id="4898b-378">In the **Health** tile you can monitor site servers that are experiencing issue, and the events raised by Site Recovery in the last 24 hours.</span></span> <span data-ttu-id="4898b-379">Il dashboard Informazioni di base può essere personalizzato con i riquadri e i layout più utili all'utente, incluso lo stato degli insiemi di credenziali di Backup e di Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="4898b-379">You can customize Essentials to show the tiles and layouts that are most useful to you, including the status of other Site Recovery and Backup vaults.</span></span>
3. <span data-ttu-id="4898b-380">È possibile gestire e monitorare la replica nei riquadri **Elementi replicati**, **Piani di ripristino** e **Processi di Site Recovery**.</span><span class="sxs-lookup"><span data-stu-id="4898b-380">You can manage and monitor replication in the **Replicated Items**, **Recovery Plans**, and **Site Recovery Jobs** tiles.</span></span> <span data-ttu-id="4898b-381">È possibile eseguire il drill-down dei processi altri dettagli in **Processi** > **Site Recovery Jobs** (Processi di Site Recovery).</span><span class="sxs-lookup"><span data-stu-id="4898b-381">You can drill into jobs for more details in **Jobs** > **Site Recovery Jobs**.</span></span>

## <a name="command-line-provider-and-agent-installation"></a><span data-ttu-id="4898b-382">Installazione del provider e dell'agente dalla riga di comando</span><span class="sxs-lookup"><span data-stu-id="4898b-382">Command-line Provider and agent installation</span></span>

<span data-ttu-id="4898b-383">Il provider di Azure Site Recovery può essere installato anche usando la riga di comando seguente.</span><span class="sxs-lookup"><span data-stu-id="4898b-383">The Azure Site Recovery Provider and agent can also be installed using the following command line.</span></span> <span data-ttu-id="4898b-384">Questo metodo può essere usato per installare il provider in un Server Core per Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="4898b-384">This method can be used to install the provider on a Server Core for Windows Server 2012 R2.</span></span>

1. <span data-ttu-id="4898b-385">Scaricare il file di installazione del provider e il codice di registrazione in una cartella,</span><span class="sxs-lookup"><span data-stu-id="4898b-385">Download the Provider installation file and registration key to a folder.</span></span> <span data-ttu-id="4898b-386">ad esempio C:\ASR.</span><span class="sxs-lookup"><span data-stu-id="4898b-386">For example C:\ASR.</span></span>
2. <span data-ttu-id="4898b-387">Da un prompt dei comandi con privilegi elevati eseguire questi comandi per estrarre il programma di installazione del provider:</span><span class="sxs-lookup"><span data-stu-id="4898b-387">From an elevated command prompt, run these commands to extract the Provider installer:</span></span>

            C:\Windows\System32> CD C:\ASR
            C:\ASR> AzureSiteRecoveryProvider.exe /x:. /q
3. <span data-ttu-id="4898b-388">Eseguire questo comando per installare i componenti:</span><span class="sxs-lookup"><span data-stu-id="4898b-388">Run this command to install the components:</span></span>

            C:\ASR> setupdr.exe /i
4. <span data-ttu-id="4898b-389">Quindi eseguire questi comandi per registrare il server nell'insieme di credenziali:</span><span class="sxs-lookup"><span data-stu-id="4898b-389">Then run these commands to register the server in the vault:</span></span>

            CD C:\Program Files\Microsoft Azure Site Recovery Provider\
            C:\Program Files\Microsoft Azure Site Recovery Provider\> DRConfigurator.exe /r  /Friendlyname <friendly name of the server> /Credentials <path of the credentials file>

<br/>
<span data-ttu-id="4898b-390">Dove:</span><span class="sxs-lookup"><span data-stu-id="4898b-390">Where:</span></span>

* <span data-ttu-id="4898b-391">**/Credentials**: parametro obbligatorio che specifica la posizione in cui si trova il file della chiave di registrazione.</span><span class="sxs-lookup"><span data-stu-id="4898b-391">**/Credentials**: Mandatory parameter that specifies the location in which the registration key file is located</span></span>  
* <span data-ttu-id="4898b-392">**/FriendlyName**: parametro obbligatorio per il nome del server host Hyper-V visualizzato nel portale di Azure Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="4898b-392">**/FriendlyName**: Mandatory parameter for the name of the Hyper-V host server that appears in the Azure Site Recovery portal.</span></span>
* <span data-ttu-id="4898b-393">**/proxyAddress**: parametro facoltativo che specifica l'indirizzo del server proxy.</span><span class="sxs-lookup"><span data-stu-id="4898b-393">**/proxyAddress**: Optional parameter that specifies the address of the proxy server.</span></span>
* <span data-ttu-id="4898b-394">**/proxyport** : parametro facoltativo che specifica la porta del server proxy.</span><span class="sxs-lookup"><span data-stu-id="4898b-394">**/proxyport** : Optional parameter that specifies the port of the proxy server.</span></span>
* <span data-ttu-id="4898b-395">**/proxyUsername**: parametro facoltativo che specifica il nome utente proxy, se il proxy richiede l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="4898b-395">**/proxyUsername**: Optional parameter that specifies the Proxy user name (if proxy requires authentication).</span></span>
* <span data-ttu-id="4898b-396">**/proxyPassword**: parametro facoltativo che specifica la password per l'autenticazione nel server proxy, se il proxy richiede l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="4898b-396">**/proxyPassword**: Optional parameter that specifies the Password for authenticating with the proxy server (if proxy requires authentication).</span></span>


## <a name="network-bandwidth-considerations"></a><span data-ttu-id="4898b-397">Considerazioni sulla larghezza di banda di rete</span><span class="sxs-lookup"><span data-stu-id="4898b-397">Network bandwidth considerations</span></span>
<span data-ttu-id="4898b-398">Lo [strumento Capacity Planner di Hyper-V](site-recovery-capacity-planner.md) può essere usato per calcolare la larghezza di banda necessaria per la replica iniziale e poi quella differenziale.</span><span class="sxs-lookup"><span data-stu-id="4898b-398">You can use the [Hyper-V capacity planner tool](site-recovery-capacity-planner.md) to calculate the bandwidth you need for replication (initial replication and then delta).</span></span> <span data-ttu-id="4898b-399">Per controllare la quantità di larghezza di banda usata per la replica è possibile scegliere una delle opzioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="4898b-399">To control the amount of bandwidth use for replication you have a few options:</span></span>

* <span data-ttu-id="4898b-400">**Limitare la larghezza di banda**: il traffico Hyper-V che viene replicato in Azure passa per un host Hyper-V specifico.</span><span class="sxs-lookup"><span data-stu-id="4898b-400">**Throttle bandwidth**: Hyper-V traffic that replicates to Azure goes through a specific Hyper-V host.</span></span> <span data-ttu-id="4898b-401">È possibile limitare la larghezza di banda nel server host.</span><span class="sxs-lookup"><span data-stu-id="4898b-401">You can throttle bandwidth on the host server.</span></span>
* <span data-ttu-id="4898b-402">**Perfezionare la larghezza di banda**: è possibile influire sulla larghezza di banda usata per la replica tramite una coppia di chiavi del Registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="4898b-402">**Tweak bandwidth**: You can influence the bandwidth used for replication using a couple of registry keys.</span></span>

### <a name="throttle-bandwidth"></a><span data-ttu-id="4898b-403">Limitare la larghezza di banda</span><span class="sxs-lookup"><span data-stu-id="4898b-403">Throttle bandwidth</span></span>
1. <span data-ttu-id="4898b-404">Aprire lo snap-in di MMC di Backup di Microsoft Azure nel server host Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="4898b-404">Open the Microsoft Azure Backup MMC snap-in on the Hyper-V host server.</span></span> <span data-ttu-id="4898b-405">Per impostazione predefinita, un collegamento a Backup di Microsoft Azure è disponibile sul desktop oppure in: C:\Program Files\Microsoft Azure Recovery Services Agent\bin\wabadmin.</span><span class="sxs-lookup"><span data-stu-id="4898b-405">By default a shortcut for Microsoft Azure Backup is available on the desktop or in C:\Program Files\Microsoft Azure Recovery Services Agent\bin\wabadmin.</span></span>
2. <span data-ttu-id="4898b-406">Nello snap-in fare clic su **Modifica proprietà**.</span><span class="sxs-lookup"><span data-stu-id="4898b-406">In the snap-in click **Change Properties**.</span></span>
3. <span data-ttu-id="4898b-407">Nella scheda **Limitazione larghezza di banda rete** selezionare **Abilita la limitazione all'uso della larghezza di banda Internet per le operazioni di backup** e impostare i limiti per le ore lavorative e non lavorative.</span><span class="sxs-lookup"><span data-stu-id="4898b-407">On the **Throttling** tab select **Enable internet bandwidth usage throttling for backup operations**, and set the limits for work and non-work hours.</span></span> <span data-ttu-id="4898b-408">Gli intervalli validi sono compresi tra 512 Kbps e 102 Mbps al secondo.</span><span class="sxs-lookup"><span data-stu-id="4898b-408">Valid ranges are from 512 Kbps to 102 Mbps per second.</span></span>

    ![Limitare la larghezza di banda](./media/site-recovery-hyper-v-site-to-azure/throttle2.png)

<span data-ttu-id="4898b-410">È anche possibile usare il cmdlet [Set-OBMachineSetting](https://technet.microsoft.com/library/hh770409.aspx) per impostare la limitazione.</span><span class="sxs-lookup"><span data-stu-id="4898b-410">You can also use the [Set-OBMachineSetting](https://technet.microsoft.com/library/hh770409.aspx) cmdlet to set throttling.</span></span> <span data-ttu-id="4898b-411">Di seguito è riportato un esempio:</span><span class="sxs-lookup"><span data-stu-id="4898b-411">Here's a sample:</span></span>

    $mon = [System.DayOfWeek]::Monday
    $tue = [System.DayOfWeek]::Tuesday
    Set-OBMachineSetting -WorkDay $mon, $tue -StartWorkHour "9:00:00" -EndWorkHour "18:00:00" -WorkHourBandwidth  (512*1024) -NonWorkHourBandwidth (2048*1024)

<span data-ttu-id="4898b-412">**Set-OBMachineSetting -NoThrottle** indica che non è necessaria alcuna limitazione.</span><span class="sxs-lookup"><span data-stu-id="4898b-412">**Set-OBMachineSetting -NoThrottle** indicates that no throttling is required.</span></span>

### <a name="influence-network-bandwidth"></a><span data-ttu-id="4898b-413">Influire sulla larghezza di banda di rete</span><span class="sxs-lookup"><span data-stu-id="4898b-413">Influence network bandwidth</span></span>
1. <span data-ttu-id="4898b-414">Nel Registro di sistema passare a **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Replication**.</span><span class="sxs-lookup"><span data-stu-id="4898b-414">In the registry navigate to **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Replication**.</span></span>
   * <span data-ttu-id="4898b-415">Per intervenire sul traffico della larghezza di banda in un disco di replica, modificare il valore di **UploadThreadsPerVM**oppure creare la chiave, se non esiste.</span><span class="sxs-lookup"><span data-stu-id="4898b-415">To influence the bandwidth traffic on a replicating disk, modify the value the **UploadThreadsPerVM**, or create the key if it doesn't exist.</span></span>
   * <span data-ttu-id="4898b-416">Per intervenire sulla larghezza di banda per il traffico di failback da Azure, modificare il valore di **DownloadThreadsPerVM**.</span><span class="sxs-lookup"><span data-stu-id="4898b-416">To influence the bandwidth for failback traffic from Azure, modify the value **DownloadThreadsPerVM**.</span></span>
2. <span data-ttu-id="4898b-417">Il valore predefinito è 4.</span><span class="sxs-lookup"><span data-stu-id="4898b-417">The default value is 4.</span></span> <span data-ttu-id="4898b-418">In una rete con provisioning eccessivo è necessario modificare i valori predefiniti di queste chiavi del Registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="4898b-418">In an “overprovisioned” network, these registry keys should be changed from the default values.</span></span> <span data-ttu-id="4898b-419">Il valore massimo è 32.</span><span class="sxs-lookup"><span data-stu-id="4898b-419">The maximum is 32.</span></span> <span data-ttu-id="4898b-420">Monitorare il traffico per ottimizzare il valore.</span><span class="sxs-lookup"><span data-stu-id="4898b-420">Monitor traffic to optimize the value.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4898b-421">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="4898b-421">Next steps</span></span>

<span data-ttu-id="4898b-422">Al termine della replica iniziale e dei test della distribuzione, è possibile chiamare i failover in caso di necessità.</span><span class="sxs-lookup"><span data-stu-id="4898b-422">After initial replication is complete, and you've tested the deployment, you can invoke failovers as the need arises.</span></span> <span data-ttu-id="4898b-423">Altre informazioni sui diversi tipi di failover e su come eseguirli sono disponibili [qui](site-recovery-failover.md).</span><span class="sxs-lookup"><span data-stu-id="4898b-423">[Learn more](site-recovery-failover.md) about different types of failovers and how to run them.</span></span>
