---
title: "Procedure consigliate per la scalabilità automatica | Microsoft Docs"
description: "Modelli di scalabilità automatica in Azure per App Web, set di scalabilità di macchine virtuali e Servizi cloud"
author: anirudhcavale
manager: orenr
editor: 
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics
ms.assetid: 9fa2b94b-dfa5-4106-96ff-74fd1fba4657
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/07/2017
ms.author: ancav
ms.openlocfilehash: 54dad831287376db7fb2dc46e4591be1499dc072
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/03/2017
---
# <a name="best-practices-for-autoscale"></a><span data-ttu-id="0a961-103">Procedure consigliate per la scalabilità automatica</span><span class="sxs-lookup"><span data-stu-id="0a961-103">Best practices for Autoscale</span></span>
<span data-ttu-id="0a961-104">Questo articolo illustra le procedure consigliate per applicare la scalabilità automatica in Azure.</span><span class="sxs-lookup"><span data-stu-id="0a961-104">This article teaches best practices to autoscale in Azure.</span></span> <span data-ttu-id="0a961-105">Il ridimensionamento automatico di Monitoraggio di Azure si applica solo a [set di scalabilità di macchine virtuali](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [Servizi cloud](https://azure.microsoft.com/services/cloud-services/) e [app Web del servizio app](https://azure.microsoft.com/services/app-service/web/).</span><span class="sxs-lookup"><span data-stu-id="0a961-105">Azure Monitor autoscale applies only to [Virtual Machine Scale Sets](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [Cloud Services](https://azure.microsoft.com/services/cloud-services/), and [App Service - Web Apps](https://azure.microsoft.com/services/app-service/web/).</span></span> <span data-ttu-id="0a961-106">Altri servizi Azure usano metodi di ridimensionamento diversi.</span><span class="sxs-lookup"><span data-stu-id="0a961-106">Other Azure services use different scaling methods.</span></span>

## <a name="autoscale-concepts"></a><span data-ttu-id="0a961-107">Concetti di scalabilità automatica</span><span class="sxs-lookup"><span data-stu-id="0a961-107">Autoscale concepts</span></span>
* <span data-ttu-id="0a961-108">Una risorsa può avere *una* sola impostazione di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="0a961-108">A resource can have only *one* autoscale setting</span></span>
* <span data-ttu-id="0a961-109">Un'impostazione di scalabilità automatica può avere uno o più profili e ogni profilo può avere una o più regole di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="0a961-109">An autoscale setting can have one or more profiles and each profile can have one or more autoscale rules.</span></span>
* <span data-ttu-id="0a961-110">Un'impostazione di scalabilità automatica scala le istanze orizzontalmente, ovvero *aumenta* e *riduce* il numero delle istanze.</span><span class="sxs-lookup"><span data-stu-id="0a961-110">An autoscale setting scales instances horizontally, which is *out* by increasing the instances and *in* by decreasing the number of instances.</span></span>
  <span data-ttu-id="0a961-111">Un'impostazione di scalabilità automatica ha un valore massimo, uno minimo e uno predefinito di istanze.</span><span class="sxs-lookup"><span data-stu-id="0a961-111">An autoscale setting has a maximum, minimum, and default value of instances.</span></span>
* <span data-ttu-id="0a961-112">Un processo di scalabilità automatica legge sempre la metrica associata alla scala controllando se ha superato la soglia configurata per l'aumento o la riduzione del numero di istanze.</span><span class="sxs-lookup"><span data-stu-id="0a961-112">An autoscale job always reads the associated metric to scale by, checking if it has crossed the configured threshold for scale-out or scale-in.</span></span> <span data-ttu-id="0a961-113">Per un elenco delle metriche in base alle quali può essere applicata la scalabilità automatica, vedere [Metriche comuni per la scalabilità automatica di Monitoraggio di Azure](insights-autoscale-common-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="0a961-113">You can view a list of metrics that autoscale can scale by at [Azure Monitor autoscaling common metrics](insights-autoscale-common-metrics.md).</span></span>
* <span data-ttu-id="0a961-114">Tutte le soglie vengono calcolate a livello di istanza.</span><span class="sxs-lookup"><span data-stu-id="0a961-114">All thresholds are calculated at an instance level.</span></span> <span data-ttu-id="0a961-115">Ad esempio, "aumentare il numero di istanze di 1 quando la media CPU > 80% quando il conteggio delle istanze è 2", significa aumentare il numero di istanze quando la media CPU in tutte le istanze è superiore all'80%.</span><span class="sxs-lookup"><span data-stu-id="0a961-115">For example, "scale out by 1 instance when average CPU > 80% when instance count is 2", means scale-out when the average CPU across all instances is greater than 80%.</span></span>
* <span data-ttu-id="0a961-116">Le notifiche di errore vengono sempre ricevute tramite posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="0a961-116">You always receive failure notifications via email.</span></span> <span data-ttu-id="0a961-117">In particolare, è il proprietario, il collaboratore e i lettori della risorsa di destinazione a ricevere il messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="0a961-117">Specifically, the owner, contributor, and readers of the target resource receive email.</span></span> <span data-ttu-id="0a961-118">Si riceverà sempre un messaggio di posta elettronica di *ripristino* anche quando la scalabilità automatica viene ripristinata dopo un errore e inizia a funzionare normalmente.</span><span class="sxs-lookup"><span data-stu-id="0a961-118">You also always receive a *recovery* email when autoscale recovers from a failure and starts functioning normally.</span></span>
* <span data-ttu-id="0a961-119">È possibile acconsentire esplicitamente a ricevere una notifica relativa a un'azione di scalabilità riuscita tramite posta elettronica e webhook.</span><span class="sxs-lookup"><span data-stu-id="0a961-119">You can opt-in to receive a successful scale action notification via email and webhooks.</span></span>

## <a name="autoscale-best-practices"></a><span data-ttu-id="0a961-120">Procedure consigliate per la scalabilità automatica</span><span class="sxs-lookup"><span data-stu-id="0a961-120">Autoscale best practices</span></span>
<span data-ttu-id="0a961-121">Usare le procedure consigliate seguenti quando si usa la scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="0a961-121">Use the following best practices as you use autoscale.</span></span>

### <a name="ensure-the-maximum-and-minimum-values-are-different-and-have-an-adequate-margin-between-them"></a><span data-ttu-id="0a961-122">Assicurarsi che i valori massimo e minimo siano diversi e che tra di essi ci sia un margine adeguato</span><span class="sxs-lookup"><span data-stu-id="0a961-122">Ensure the maximum and minimum values are different and have an adequate margin between them</span></span>
<span data-ttu-id="0a961-123">Se il valore minimo di un'impostazione è 2 e il valore massimo è 2 e il conteggio di istanze correnti è 2, non può verificarsi alcuna azione di scalabilità.</span><span class="sxs-lookup"><span data-stu-id="0a961-123">If you have a setting that has minimum=2, maximum=2 and the current instance count is 2, no scale action can occur.</span></span> <span data-ttu-id="0a961-124">Mantenere un margine adeguato tra i conteggi massimo e minimo delle istanze, che sono valori inclusivi.</span><span class="sxs-lookup"><span data-stu-id="0a961-124">Keep an adequate margin between the maximum and minimum instance counts, which are inclusive.</span></span> <span data-ttu-id="0a961-125">La scalabilità automatica viene sempre applicata entro questi limiti.</span><span class="sxs-lookup"><span data-stu-id="0a961-125">Autoscale always scales between these limits.</span></span>

### <a name="manual-scaling-is-reset-by-autoscale-min-and-max"></a><span data-ttu-id="0a961-126">La scalabilità manuale viene reimpostata dai valori minimo e massimo della scalabilità automatica</span><span class="sxs-lookup"><span data-stu-id="0a961-126">Manual scaling is reset by autoscale min and max</span></span>
<span data-ttu-id="0a961-127">Se si aggiorna manualmente il conteggio delle istanze impostandolo su un valore al di sopra o al di sotto di quello massimo, il motore di scalabilità automatica utilizza automaticamente il valore minimo (se al di sotto) o il valore massimo (se al di sopra).</span><span class="sxs-lookup"><span data-stu-id="0a961-127">If you manually update the instance count to a value above or below the maximum, the autoscale engine automatically scales back to the minimum (if below) or the maximum (if above).</span></span> <span data-ttu-id="0a961-128">Ad esempio, se l'utente imposta l'intervallo tra i valori e 3 e 6,</span><span class="sxs-lookup"><span data-stu-id="0a961-128">For example, you set the range between 3 and 6.</span></span> <span data-ttu-id="0a961-129">in presenza di un'istanza in esecuzione, il motore di scalabilità automatica esegue il ridimensionamento a 3 istanze alla successiva esecuzione.</span><span class="sxs-lookup"><span data-stu-id="0a961-129">If you have one running instance, the autoscale engine scales to 3 instances on its next run.</span></span> <span data-ttu-id="0a961-130">Analogamente, eseguirà il ridimensionamento di 8 istanze a 6 alla successiva esecuzione.</span><span class="sxs-lookup"><span data-stu-id="0a961-130">Likewise, it would scale-in 8 instances back to 6 on its next run.</span></span>  <span data-ttu-id="0a961-131">La scalabilità manuale è molto temporanea, a meno che non si reimpostino anche le regole di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="0a961-131">Manual scaling is very temporary unless you reset the autoscale rules as well.</span></span>

### <a name="always-use-a-scale-out-and-scale-in-rule-combination-that-performs-an-increase-and-decrease"></a><span data-ttu-id="0a961-132">Usare sempre una combinazione di regole di aumento e di riduzione del numero di istanze</span><span class="sxs-lookup"><span data-stu-id="0a961-132">Always use a scale-out and scale-in rule combination that performs an increase and decrease</span></span>
<span data-ttu-id="0a961-133">Se si usa solo una parte della combinazione, la scalabilità automatica viene applicata solo per aumentare o ridurre il numero di istanze fino a raggiungere il valore massimo o minimo.</span><span class="sxs-lookup"><span data-stu-id="0a961-133">If you use only one part of the combination, autoscale scale-in that single out, or in, until the maximum, or minimum, is reached.</span></span>

### <a name="do-not-switch-between-the-azure-portal-and-the-azure-classic-portal-when-managing-autoscale"></a><span data-ttu-id="0a961-134">Non passare dal portale di Azure al portale di Azure classico e viceversa quando si gestisce la scalabilità automatica</span><span class="sxs-lookup"><span data-stu-id="0a961-134">Do not switch between the Azure portal and the Azure classic portal when managing Autoscale</span></span>
<span data-ttu-id="0a961-135">Per i servizi cloud e i servizi app (App Web), usare il portale di Azure (portal.azure.com) per creare e gestire le impostazioni di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="0a961-135">For Cloud Services and App Services (Web Apps), use the Azure portal (portal.azure.com) to create and manage autoscale settings.</span></span> <span data-ttu-id="0a961-136">Per i set di scalabilità di macchine virtuali, usare PowerShell, l'interfaccia della riga di comando o l'API REST per creare e gestire l'impostazione di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="0a961-136">For Virtual Machine Scale Sets use PowerShell, CLI or REST API to create and manage autoscale setting.</span></span> <span data-ttu-id="0a961-137">Non passare dal portale di Azure classico (manage.windowsazure.com) al portale di Azure (portal.azure.com) e viceversa quando si gestiscono le configurazioni di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="0a961-137">Do not switch between the Azure classic portal (manage.windowsazure.com) and the Azure portal (portal.azure.com) when managing autoscale configurations.</span></span> <span data-ttu-id="0a961-138">Il portale di Azure classico e il back-end sottostante presentano delle limitazioni.</span><span class="sxs-lookup"><span data-stu-id="0a961-138">The Azure classic portal and its underlying backend has limitations.</span></span> <span data-ttu-id="0a961-139">Passare al portale di Azure per gestire la scalabilità automatica con un'interfaccia utente grafica.</span><span class="sxs-lookup"><span data-stu-id="0a961-139">Move to the Azure portal to manage autoscale using a graphical user interface.</span></span> <span data-ttu-id="0a961-140">Le opzioni prevedono l'uso di PowerShell, dell'interfaccia della riga di comando o dell'API REST (tramite Esplora risorse di Azure) per la scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="0a961-140">The options are to use the autoscale PowerShell, CLI or REST API (via Azure Resource Explorer).</span></span>

### <a name="choose-the-appropriate-statistic-for-your-diagnostics-metric"></a><span data-ttu-id="0a961-141">Scegliere la statistica appropriata per la metrica di diagnostica</span><span class="sxs-lookup"><span data-stu-id="0a961-141">Choose the appropriate statistic for your diagnostics metric</span></span>
<span data-ttu-id="0a961-142">Per le metriche di diagnostica, è possibile scegliere tra *Medio*, *Minimo*, *Massimo* e *Totale* come metrica per il ridimensionamento.</span><span class="sxs-lookup"><span data-stu-id="0a961-142">For diagnostics metrics, you can choose among *Average*, *Minimum*, *Maximum* and *Total* as a metric to scale by.</span></span> <span data-ttu-id="0a961-143">La statistica più comune è *Medio*.</span><span class="sxs-lookup"><span data-stu-id="0a961-143">The most common statistic is *Average*.</span></span>

### <a name="choose-the-thresholds-carefully-for-all-metric-types"></a><span data-ttu-id="0a961-144">Scegliere attentamente le soglie per tutti i tipi di metriche</span><span class="sxs-lookup"><span data-stu-id="0a961-144">Choose the thresholds carefully for all metric types</span></span>
<span data-ttu-id="0a961-145">È consigliabile scegliere con attenzione soglie diverse per aumentare e ridurre il numero di istanze a seconda delle situazioni concrete.</span><span class="sxs-lookup"><span data-stu-id="0a961-145">We recommend carefully choosing different thresholds for scale-out and scale-in based on practical situations.</span></span>

<span data-ttu-id="0a961-146">*Non sono consigliate* impostazioni di scalabilità automatica come quelle degli esempi seguenti con valori di soglia uguali o molto simili per le condizioni di aumento o di riduzione del numero di istanze:</span><span class="sxs-lookup"><span data-stu-id="0a961-146">We *do not recommend* autoscale settings like the examples below with the same or very similar threshold values for out and in conditions:</span></span>

* <span data-ttu-id="0a961-147">Aumentare le istanze di 1 quando il conteggio dei thread è <= 600</span><span class="sxs-lookup"><span data-stu-id="0a961-147">Increase instances by 1 count when Thread Count <= 600</span></span>
* <span data-ttu-id="0a961-148">Ridurre le istanze di 1 quando il conteggio dei thread è >= 600</span><span class="sxs-lookup"><span data-stu-id="0a961-148">Decrease instances by 1 count when Thread Count >= 600</span></span>

<span data-ttu-id="0a961-149">Verrà ora esaminato un esempio di come si può arrivare a un comportamento che può sembrare poco chiaro.</span><span class="sxs-lookup"><span data-stu-id="0a961-149">Let's look at an example of what can lead to a behavior that may seem confusing.</span></span> <span data-ttu-id="0a961-150">Considerare la sequenza indicata di seguito.</span><span class="sxs-lookup"><span data-stu-id="0a961-150">Consider the following sequence.</span></span>

1. <span data-ttu-id="0a961-151">Si supponga di iniziare con 2 istanze e che poi il numero medio di thread per ogni istanza cresca fino a 625.</span><span class="sxs-lookup"><span data-stu-id="0a961-151">Assume there are 2 instances to begin with and then the average number of threads per instance grows to 625.</span></span>
2. <span data-ttu-id="0a961-152">Il numero di istanze viene aumentato automaticamente aggiungendo una terza istanza.</span><span class="sxs-lookup"><span data-stu-id="0a961-152">Autoscale scales out adding a 3rd instance.</span></span>
3. <span data-ttu-id="0a961-153">Si supponga ora che il conteggio medio dei thread nell'istanza scenda a 575.</span><span class="sxs-lookup"><span data-stu-id="0a961-153">Next, assume that the average thread count across instance falls to 575.</span></span>
4. <span data-ttu-id="0a961-154">Prima di ridurre le prestazioni, la scalabilità automatica cerca di stimare quale sarà lo stato finale in caso di riduzione del numero di istanze.</span><span class="sxs-lookup"><span data-stu-id="0a961-154">Before scaling down, autoscale tries to estimate what the final state will be if it scaled in.</span></span> <span data-ttu-id="0a961-155">Ad esempio, 575 x 3 (conteggio corrente delle istanze) = 1.725 / 2 (numero finale di istanze dopo la riduzione delle prestazioni) = 862,5 thread.</span><span class="sxs-lookup"><span data-stu-id="0a961-155">For example, 575 x  3 (current instance count) = 1,725 / 2 (final number of instances when scaled down) = 862.5 threads.</span></span> <span data-ttu-id="0a961-156">La scalabilità automatica dovrà quindi immediatamente aumentare di nuovo il numero di istanze anche dopo averlo ridotto, se il conteggio medio dei thread rimane invariato o scende anche solo di poco.</span><span class="sxs-lookup"><span data-stu-id="0a961-156">This means autoscale would have to immediately scale-out again even after it scaled in, if the average thread count remains the same or even falls only a small amount.</span></span> <span data-ttu-id="0a961-157">Se, tuttavia, aumentasse di nuovo le prestazioni, l'intero processo si ripeterebbe, generando un loop infinito.</span><span class="sxs-lookup"><span data-stu-id="0a961-157">However, if it scaled up again, the whole process would repeat, leading to an infinite loop.</span></span>
5. <span data-ttu-id="0a961-158">Per evitare questa situazione (definita "instabile"), la scalabilità automatica non riduce affatto le prestazioni,</span><span class="sxs-lookup"><span data-stu-id="0a961-158">To avoid this situation (termed "flapping"), autoscale does not scale down at all.</span></span> <span data-ttu-id="0a961-159">ma ignora la condizione e la valuta nuovamente la volta successiva che il processo del servizio viene eseguito.</span><span class="sxs-lookup"><span data-stu-id="0a961-159">Instead, it skips and reevaluates the condition again the next time the service's job executes.</span></span> <span data-ttu-id="0a961-160">Questo potrebbe generare confusione perché sembra che la scalabilità automatica non funzioni quando il conteggio medio dei thread è 575.</span><span class="sxs-lookup"><span data-stu-id="0a961-160">This could confuse many people because autoscale wouldn't appear to work when the average thread count was 575.</span></span>

<span data-ttu-id="0a961-161">La stima durante la riduzione è necessaria per evitare situazioni di instabilità, in cui vengono eseguite continuamente azioni di riduzione e aumento del numero di istanze.</span><span class="sxs-lookup"><span data-stu-id="0a961-161">Estimation during a scale-in is intended to avoid "flapping" situations, where scale-in and scale-out actions continually go back and forth.</span></span> <span data-ttu-id="0a961-162">Tenere presente questo comportamento quando si scelgono le stesse soglie per l'aumento e la riduzione del numero di istanze.</span><span class="sxs-lookup"><span data-stu-id="0a961-162">Keep this behavior in mind when you choose the same thresholds for scale-out and in.</span></span>

<span data-ttu-id="0a961-163">È consigliabile scegliere un margine adeguato tra le soglie di aumento e di riduzione del numero di istanze.</span><span class="sxs-lookup"><span data-stu-id="0a961-163">We recommend choosing an adequate margin between the scale-out and in thresholds.</span></span> <span data-ttu-id="0a961-164">Ad esempio, considerare la combinazione di regole seguente, che è migliore.</span><span class="sxs-lookup"><span data-stu-id="0a961-164">As an example, consider the following better rule combination.</span></span>

* <span data-ttu-id="0a961-165">Aumentare le istanze di 1 quando la percentuale di CPU è >= 80</span><span class="sxs-lookup"><span data-stu-id="0a961-165">Increase instances by 1 count when CPU%  >= 80</span></span>
* <span data-ttu-id="0a961-166">Ridurre le istanze di 1 quando la percentuale di CPU è <= 60</span><span class="sxs-lookup"><span data-stu-id="0a961-166">Decrease instances by 1 count when CPU% <= 60</span></span>

<span data-ttu-id="0a961-167">In questo caso</span><span class="sxs-lookup"><span data-stu-id="0a961-167">In this case</span></span>  

1. <span data-ttu-id="0a961-168">Si supponga di iniziare con 2 istanze.</span><span class="sxs-lookup"><span data-stu-id="0a961-168">Assume there are 2 instances to start with.</span></span>
2. <span data-ttu-id="0a961-169">Se la % di CPU media nelle istanze arriva a 80, la scalabilità automatica aumenta il numero di istanze aggiungendone una terza.</span><span class="sxs-lookup"><span data-stu-id="0a961-169">If the average CPU% across instances goes to 80, autoscale scales out adding a third instance.</span></span>
3. <span data-ttu-id="0a961-170">Si supponga che nel corso del tempo la percentuale di CPU scenda a 60.</span><span class="sxs-lookup"><span data-stu-id="0a961-170">Now assume that over time the CPU% falls to 60.</span></span>
4. <span data-ttu-id="0a961-171">La regola di riduzione del numero di istanze della scalabilità automatica valuta lo stato finale se venisse applicata la riduzione del numero di istanze.</span><span class="sxs-lookup"><span data-stu-id="0a961-171">Autoscale's scale-in rule estimates the final state if it were to scale-in.</span></span> <span data-ttu-id="0a961-172">Ad esempio, 60 x 3 (conteggio corrente delle istanze) = 180 / 2 (numero finale di istanze dopo la riduzione delle prestazioni) = 90.</span><span class="sxs-lookup"><span data-stu-id="0a961-172">For example, 60 x 3 (current instance count) = 180 / 2 (final number of instances when scaled down) = 90.</span></span> <span data-ttu-id="0a961-173">La scalabilità automatica quindi non riduce il numero di istanze perché dovrebbe aumentarlo di nuovo immediatamente.</span><span class="sxs-lookup"><span data-stu-id="0a961-173">So autoscale does not scale-in because it would have to scale-out again immediately.</span></span> <span data-ttu-id="0a961-174">Al contrario, evita di ridurre le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="0a961-174">Instead, it skips scaling down.</span></span>
5. <span data-ttu-id="0a961-175">Al successivo controllo, la percentuale di CPU continua a scendere fino a 50.</span><span class="sxs-lookup"><span data-stu-id="0a961-175">The next time autoscale checks, the CPU continues to fall to 50.</span></span> <span data-ttu-id="0a961-176">Viene quindi eseguita una nuova stima: 50 x 3 istanze = 150 / 2 istanze = 75, che è al di sotto della soglia di aumento del numero di istanze pari a 80, quindi il numero di istanze viene correttamente ridotto a 2.</span><span class="sxs-lookup"><span data-stu-id="0a961-176">It estimates again -  50 x 3 instance = 150 / 2 instances = 75, which is below the scale-out threshold of 80, so it scales in successfully to 2 instances.</span></span>

### <a name="considerations-for-scaling-threshold-values-for-special-metrics"></a><span data-ttu-id="0a961-177">Considerazioni sul ridimensionamento dei valori di soglia per le metriche speciali</span><span class="sxs-lookup"><span data-stu-id="0a961-177">Considerations for scaling threshold values for special metrics</span></span>
 <span data-ttu-id="0a961-178">Per le metriche speciali, ad esempio la metrica di archiviazione o la metrica di lunghezza della coda del bus di servizio, la soglia è il numero medio di messaggi disponibile per il numero corrente di istanze.</span><span class="sxs-lookup"><span data-stu-id="0a961-178">For special metrics such as Storage or Service Bus Queue length metric, the threshold is the average number of messages available per current number of instances.</span></span> <span data-ttu-id="0a961-179">Scegliere con attenzione il valore di soglia per questa metrica.</span><span class="sxs-lookup"><span data-stu-id="0a961-179">Carefully choose the choose the threshold value for this metric.</span></span>

<span data-ttu-id="0a961-180">Per far comprendere meglio il comportamento, verrà illustrato con esempio.</span><span class="sxs-lookup"><span data-stu-id="0a961-180">Let's illustrate it with an example to ensure you understand the behavior better.</span></span>

* <span data-ttu-id="0a961-181">Aumentare le istanze di 1 quando il conteggio dei messaggi della coda di archiviazione è >= 50</span><span class="sxs-lookup"><span data-stu-id="0a961-181">Increase instances by 1 count when Storage Queue message count >= 50</span></span>
* <span data-ttu-id="0a961-182">Ridurre le istanze di 1 quando il conteggio dei messaggi della coda di archiviazione è <= 10</span><span class="sxs-lookup"><span data-stu-id="0a961-182">Decrease instances by 1 count when Storage Queue message count <= 10</span></span>

<span data-ttu-id="0a961-183">Considerare la sequenza seguente:</span><span class="sxs-lookup"><span data-stu-id="0a961-183">Consider the following sequence:</span></span>

1. <span data-ttu-id="0a961-184">Esistono 2 istanze di coda di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="0a961-184">There are 2 storage queue instances.</span></span>
2. <span data-ttu-id="0a961-185">Continuano ad arrivare messaggi e, quando si controlla la coda di archiviazione, il conteggio totale è pari a 50.</span><span class="sxs-lookup"><span data-stu-id="0a961-185">Messages keep coming and when you review the storage queue, the total count reads 50.</span></span> <span data-ttu-id="0a961-186">Si potrebbe pensare che la scalabilità automatica debba avviare un'azione di aumento del numero di istanze.</span><span class="sxs-lookup"><span data-stu-id="0a961-186">You might assume that autoscale should start a scale-out action.</span></span> <span data-ttu-id="0a961-187">Si noti tuttavia che si tratta comunque di 50/2 = 25 messaggi per ogni istanza.</span><span class="sxs-lookup"><span data-stu-id="0a961-187">However, note that it is still 50/2 = 25 messages per instance.</span></span> <span data-ttu-id="0a961-188">L'aumento del numero di istanze non viene quindi eseguito.</span><span class="sxs-lookup"><span data-stu-id="0a961-188">So, scale-out does not occur.</span></span> <span data-ttu-id="0a961-189">Perché venga eseguito il primo aumento del numero di istanze, il conteggio totale dei messaggi nella coda di archiviazione deve essere pari a 100.</span><span class="sxs-lookup"><span data-stu-id="0a961-189">For the first scale-out to happen, the total message count in the storage queue should be 100.</span></span>
3. <span data-ttu-id="0a961-190">Si supponga ora che il conteggio totale dei messaggi raggiunga i 100.</span><span class="sxs-lookup"><span data-stu-id="0a961-190">Next, assume that the total message count reaches 100.</span></span>
4. <span data-ttu-id="0a961-191">Viene aggiunta una terza istanza di coda di archiviazione in seguito a un'azione di aumento del numero di istanze.</span><span class="sxs-lookup"><span data-stu-id="0a961-191">A 3rd storage queue instance is added due to a scale-out action.</span></span>  <span data-ttu-id="0a961-192">L'azione successiva di aumento del numero di istanze verrà eseguita solo dopo che il conteggio totale dei messaggi nella coda avrà raggiunto il numero di 150, poiché 150/3 = 50.</span><span class="sxs-lookup"><span data-stu-id="0a961-192">The next scale-out action will not happen until the total message count in the queue reaches 150 because 150/3 = 50.</span></span>
5. <span data-ttu-id="0a961-193">Ora il numero di messaggi nella coda si riduce.</span><span class="sxs-lookup"><span data-stu-id="0a961-193">Now the number of messages in the queue gets smaller.</span></span> <span data-ttu-id="0a961-194">Con 3 istanze, la prima azione di riduzione del numero di istanze viene eseguita quando i messaggi totali in tutte le code raggiungono il numero di 30, ovvero 30/3 = 10 messaggi per istanza, che corrisponde alla soglia di riduzione del numero di istanze.</span><span class="sxs-lookup"><span data-stu-id="0a961-194">With 3 instances, the first scale-in action happens when the total messages in all queues add up to 30 because 30/3 = 10 messages per instance, which is the scale-in threshold.</span></span>

### <a name="considerations-for-scaling-when-multiple-profiles-are-configured-in-an-autoscale-setting"></a><span data-ttu-id="0a961-195">Considerazioni sul ridimensionamento quando vengono configurati più profili in un'impostazione di scalabilità automatica</span><span class="sxs-lookup"><span data-stu-id="0a961-195">Considerations for scaling when multiple profiles are configured in an autoscale setting</span></span>
<span data-ttu-id="0a961-196">In un'impostazione di scalabilità automatica è possibile scegliere un profilo predefinito, che viene sempre applicato indipendentemente da qualsiasi pianificazione o orario, oppure è possibile scegliere un profilo ricorrente o un profilo per un periodo fisso con un intervallo di data e ora.</span><span class="sxs-lookup"><span data-stu-id="0a961-196">In an autoscale setting, you can choose a default profile, which is always applied without any dependency on schedule or time, or you can choose a recurring profile or a profile for a fixed period with a date and time range.</span></span>

<span data-ttu-id="0a961-197">Quando il servizio di scalabilità automatica elabora questi profili, li controlla sempre nell'ordine seguente:</span><span class="sxs-lookup"><span data-stu-id="0a961-197">When autoscale service processes them, it always checks in the following order:</span></span>

1. <span data-ttu-id="0a961-198">Profilo con data fissa</span><span class="sxs-lookup"><span data-stu-id="0a961-198">Fixed Date profile</span></span>
2. <span data-ttu-id="0a961-199">Profilo ricorrente</span><span class="sxs-lookup"><span data-stu-id="0a961-199">Recurring profile</span></span>
3. <span data-ttu-id="0a961-200">Profilo predefinito ("sempre")</span><span class="sxs-lookup"><span data-stu-id="0a961-200">Default ("Always") profile</span></span>

<span data-ttu-id="0a961-201">Se la condizione di un profilo viene soddisfatta, la scalabilità automatica non controlla la condizione del profilo successivo.</span><span class="sxs-lookup"><span data-stu-id="0a961-201">If a profile condition is met, autoscale does not check the next profile condition below it.</span></span> <span data-ttu-id="0a961-202">La scalabilità automatica elabora solo un profilo alla volta.</span><span class="sxs-lookup"><span data-stu-id="0a961-202">Autoscale only processes one profile at a time.</span></span> <span data-ttu-id="0a961-203">Quindi, per includere anche una condizione di elaborazione da un profilo di livello inferiore, è necessario includere anche tali regole nel profilo corrente.</span><span class="sxs-lookup"><span data-stu-id="0a961-203">This means if you want to also include a processing condition from a lower-tier profile, you must include those rules as well in the current profile.</span></span>

<span data-ttu-id="0a961-204">Per spiegarlo, verrà usato un esempio:</span><span class="sxs-lookup"><span data-stu-id="0a961-204">Let's review this using an example:</span></span>

<span data-ttu-id="0a961-205">L'immagine seguente illustra un'impostazione di scalabilità automatica con un profilo predefinito con un numero minimo di istanze = 2 e un numero massimo = 10.</span><span class="sxs-lookup"><span data-stu-id="0a961-205">The image below shows an autoscale setting with a default profile of minimum instances = 2 and maximum instances = 10.</span></span> <span data-ttu-id="0a961-206">In questo esempio, le regole vengono configurate per aumentare il numero di istanze quando il conteggio dei messaggi nella coda è maggiore di 10 e per ridurlo quando il conteggio dei messaggi nella coda è minore di 3.</span><span class="sxs-lookup"><span data-stu-id="0a961-206">In this example, rules are configured to scale-out when the message count in the queue is greater than 10 and scale-in when the message count in the queue is less than 3.</span></span> <span data-ttu-id="0a961-207">Ora la risorsa può quindi essere ridimensionata tra le 2 e le 10 istanze.</span><span class="sxs-lookup"><span data-stu-id="0a961-207">So now the resource can scale between 2 and 10 instances.</span></span>

<span data-ttu-id="0a961-208">È anche stato impostato un profilo ricorrente per il lunedì.</span><span class="sxs-lookup"><span data-stu-id="0a961-208">In addition, there is a recurring profile set for Monday.</span></span> <span data-ttu-id="0a961-209">È stato impostato per un numero minimo di istanze = 2 e un numero massimo di istanze = 12.</span><span class="sxs-lookup"><span data-stu-id="0a961-209">It is set for minimum instances = 2 and maximum instances = 12.</span></span> <span data-ttu-id="0a961-210">Quindi il lunedì, la prima volta che la scalabilità automatica controlla questa condizione, se il conteggio delle istanze è 2, lo ridimensiona al nuovo valore minimo pari a 3.</span><span class="sxs-lookup"><span data-stu-id="0a961-210">This means on Monday, the first time autoscale checks for this condition, if the instance count is 2, it scales to the new minimum of 3.</span></span> <span data-ttu-id="0a961-211">Finché la scalabilità automatica continua a trovare una corrispondenza per la condizione di questo profilo (lunedì), elabora sole le regole di aumento/riduzione del numero di istanze basate sulla CPU configurate per questo profilo.</span><span class="sxs-lookup"><span data-stu-id="0a961-211">As long as autoscale continues to find this profile condition matched (Monday), it only processes the CPU-based scale-out/in rules configured for this profile.</span></span> <span data-ttu-id="0a961-212">Al momento non controlla la lunghezza della coda.</span><span class="sxs-lookup"><span data-stu-id="0a961-212">At this time, it does not check for the queue length.</span></span> <span data-ttu-id="0a961-213">Se, tuttavia, si vuole controllare anche la condizione della lunghezza della coda, è necessario includere anche le regole del profilo predefinito nel profilo del lunedì.</span><span class="sxs-lookup"><span data-stu-id="0a961-213">However, if you also want the queue length condition to be checked, you should include those rules from the default profile as well in your Monday profile.</span></span>

<span data-ttu-id="0a961-214">Allo stesso modo, quando la scalabilità automatica torna al profilo predefinito, per prima cosa controlla se sono soddisfatte le condizioni minima e massima.</span><span class="sxs-lookup"><span data-stu-id="0a961-214">Similarly, when autoscale switches back to the default profile, it first checks if the minimum and maximum conditions are met.</span></span> <span data-ttu-id="0a961-215">Se al momento il numero di istanze è 12, ne riduce il numero a 10, il massimo consentito per il profilo predefinito.</span><span class="sxs-lookup"><span data-stu-id="0a961-215">If the number of instances at the time is 12, it scales in to 10, the maximum allowed for the default profile.</span></span>

![Impostazioni di scalabilità automatica](./media/insights-autoscale-best-practices/insights-autoscale-best-practices-2.png)

### <a name="considerations-for-scaling-when-multiple-rules-are-configured-in-a-profile"></a><span data-ttu-id="0a961-217">Considerazioni sul ridimensionamento quando vengono configurate più regole in un profilo</span><span class="sxs-lookup"><span data-stu-id="0a961-217">Considerations for scaling when multiple rules are configured in a profile</span></span>
<span data-ttu-id="0a961-218">In alcuni casi potrebbe essere necessario impostare più regole in un profilo.</span><span class="sxs-lookup"><span data-stu-id="0a961-218">There are cases where you may have to set multiple rules in a profile.</span></span> <span data-ttu-id="0a961-219">Il set di regole di scalabilità automatica seguente viene usato dai servizi quando vengono impostate più regole.</span><span class="sxs-lookup"><span data-stu-id="0a961-219">The following set of autoscale rules are used by services use when multiple rules are set.</span></span>

<span data-ttu-id="0a961-220">In caso di *aumento del numero di istanze*, la scalabilità automatica viene eseguita se risulta soddisfatta una regola qualsiasi.</span><span class="sxs-lookup"><span data-stu-id="0a961-220">On *scale out*, autoscale runs if any rule is met.</span></span>
<span data-ttu-id="0a961-221">In caso di *riduzione del numero di istanze*, la scalabilità automatica richiede che tutte le regole siano soddisfatte.</span><span class="sxs-lookup"><span data-stu-id="0a961-221">On *scale-in*, autoscale require all rules to be met.</span></span>

<span data-ttu-id="0a961-222">Per illustrare questo concetto, si supponga di avere le 4 regole di scalabilità automatica seguenti:</span><span class="sxs-lookup"><span data-stu-id="0a961-222">To illustrate, assume that you have the following 4 autoscale rules:</span></span>

* <span data-ttu-id="0a961-223">Se la CPU è < 30%, ridurre il numero di istanze di 1</span><span class="sxs-lookup"><span data-stu-id="0a961-223">If CPU < 30 %, scale-in by 1</span></span>
* <span data-ttu-id="0a961-224">Se la memoria è < 50%, ridurre il numero di istanze di 1</span><span class="sxs-lookup"><span data-stu-id="0a961-224">If Memory < 50%, scale-in by 1</span></span>
* <span data-ttu-id="0a961-225">Se la CPU è > 75%, aumentare il numero di istanze di 1</span><span class="sxs-lookup"><span data-stu-id="0a961-225">If CPU > 75%, scale-out by 1</span></span>
* <span data-ttu-id="0a961-226">Se la memoria è > 75%, aumentare il numero di istanze di 1</span><span class="sxs-lookup"><span data-stu-id="0a961-226">If Memory > 75%, scale-out by 1</span></span>

<span data-ttu-id="0a961-227">Si verifica quindi quanto segue:</span><span class="sxs-lookup"><span data-stu-id="0a961-227">Then the follow occurs:</span></span>

* <span data-ttu-id="0a961-228">Se la CPU è pari al 76% e la memoria è pari al 50%, il numero di istanze viene aumentato.</span><span class="sxs-lookup"><span data-stu-id="0a961-228">If CPU is 76% and Memory is 50%, we scale-out.</span></span>
* <span data-ttu-id="0a961-229">Se la CPU è pari al 50% e la memoria è pari al 76%, il numero di istanze viene aumentato.</span><span class="sxs-lookup"><span data-stu-id="0a961-229">If CPU is 50% and Memory is 76% we scale-out.</span></span>

<span data-ttu-id="0a961-230">Ma, se la CPU è pari al 25% e la memoria è pari al 51%, la scalabilità automatica **non** riduce il numero di istanze.</span><span class="sxs-lookup"><span data-stu-id="0a961-230">On the other hand, if CPU is 25% and memory is 51% autoscale does **not** scale-in.</span></span> <span data-ttu-id="0a961-231">Per ridurre il numero di istanze, la CPU deve essere al 29% e la memoria al 49%.</span><span class="sxs-lookup"><span data-stu-id="0a961-231">In order to scale-in, CPU must be 29% and Memory 49%.</span></span>

### <a name="always-select-a-safe-default-instance-count"></a><span data-ttu-id="0a961-232">Selezionare sempre un conteggio di istanze predefinito sicuro</span><span class="sxs-lookup"><span data-stu-id="0a961-232">Always select a safe default instance count</span></span>
<span data-ttu-id="0a961-233">Il conteggio predefinito delle istanze è importante perché è in base a tale conteggio che la scalabilità automatica ridimensiona il servizio quando le metriche non sono disponibili.</span><span class="sxs-lookup"><span data-stu-id="0a961-233">The default instance count is important autoscale scales your service to that count when metrics are not available.</span></span> <span data-ttu-id="0a961-234">Selezionare quindi un conteggio di istanze predefinito sicuro per i carichi di lavoro.</span><span class="sxs-lookup"><span data-stu-id="0a961-234">Therefore, select a default instance count that's safe for your workloads.</span></span>

### <a name="configure-autoscale-notifications"></a><span data-ttu-id="0a961-235">Configurare le notifiche relative alla scalabilità automatica</span><span class="sxs-lookup"><span data-stu-id="0a961-235">Configure autoscale notifications</span></span>
<span data-ttu-id="0a961-236">La scalabilità automatica invia una notifica tramite posta elettronica agli amministratori e ai collaboratori della risorsa se si verifica una delle condizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="0a961-236">Autoscale notifies the administrators and contributors of the resource by email if any of the following conditions occur:</span></span>

* <span data-ttu-id="0a961-237">Il servizio di scalabilità automatica non riesce a eseguire un'azione.</span><span class="sxs-lookup"><span data-stu-id="0a961-237">autoscale service fails to take an action.</span></span>
* <span data-ttu-id="0a961-238">Non sono disponibili metriche che consentono al servizio di scalabilità automatica di prendere una decisione sulla scalabilità.</span><span class="sxs-lookup"><span data-stu-id="0a961-238">Metrics are not available for autoscale service to make a scale decision.</span></span>
* <span data-ttu-id="0a961-239">Sono di nuovo disponibili metriche (ripristino) che consentono di prendere una decisione sulla scalabilità.</span><span class="sxs-lookup"><span data-stu-id="0a961-239">Metrics are available (recovery) again to make a scale decision.</span></span>
  <span data-ttu-id="0a961-240">Oltre alle condizioni precedenti, è possibile configurare notifiche di posta elettronica o webhook per ricevere notifiche relative alle azioni di scalabilità riuscite.</span><span class="sxs-lookup"><span data-stu-id="0a961-240">In addition to the conditions above, you can configure email or webhook notifications to get notified for successful scale actions.</span></span>
  
<span data-ttu-id="0a961-241">Per monitorare l'integrità del motore di scalabilità automatica si può anche usare un avviso di log attività.</span><span class="sxs-lookup"><span data-stu-id="0a961-241">You can also use an Activity Log alert to monitor the health of the autoscale engine.</span></span> <span data-ttu-id="0a961-242">Di seguito sono riportati esempi di come [creare un avviso di log attività per monitorare tutte le operazioni del motore di scalabilità automatica per la sottoscrizione](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) e per [creare un avviso di log attività per monitorare tutte le operazioni di scalabilità automatica in riduzione e in aumento non riuscite per la sottoscrizione](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).</span><span class="sxs-lookup"><span data-stu-id="0a961-242">Here are examples to [create an Activity Log Alert to monitor all autoscale engine operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) or to [create an Activity Log Alert to monitor all failed autoscale scale in/scale out operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).</span></span>

## <a name="next-steps"></a><span data-ttu-id="0a961-243">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="0a961-243">Next Steps</span></span>
- [<span data-ttu-id="0a961-244">Creare un avviso di log attività per monitorare tutte le operazioni del motore di scalabilità automatica della sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="0a961-244">Create an Activity Log Alert to monitor all autoscale engine operations on your subscription.</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert)
- [<span data-ttu-id="0a961-245">Creare un avviso di log attività per monitorare tutte le operazioni di scalabilità automatica in riduzione e in aumento non riuscite per la sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="0a961-245">Create an Activity Log Alert to monitor all failed autoscale scale in/scale out operations on your subscription</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert)
