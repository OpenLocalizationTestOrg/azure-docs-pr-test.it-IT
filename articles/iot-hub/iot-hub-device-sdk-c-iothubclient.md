---
title: il dispositivo di IoT aaaAzure SDK per C - IoTHubClient | Documenti Microsoft
description: La libreria di IoTHubClient toouse hello nel dispositivo di Azure IoT hello SDK per App per dispositivi toocreate C che comunicano con un hub IoT.
services: iot-hub
documentationcenter: 
author: olivierbloch
manager: timlt
editor: 
ms.assetid: 828cf2bf-999d-4b8a-8a28-c7c901629600
ms.service: iot-hub
ms.devlang: cpp
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/06/2016
ms.author: obloch
ms.openlocfilehash: d1ece79e9ba6d1e5fd45cabb8fca393b24052e07
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="azure-iot-device-sdk-for-c--more-about-iothubclient"></a><span data-ttu-id="aa5ae-103">Azure IoT SDK per dispositivi per C: altre informazioni su IoTHubClient</span><span class="sxs-lookup"><span data-stu-id="aa5ae-103">Azure IoT device SDK for C – more about IoTHubClient</span></span>
<span data-ttu-id="aa5ae-104">Hello [innanzitutto articolo](iot-hub-device-sdk-c-intro.md) in hello questa serie introdotto **dispositivo IoT di Azure SDK per C**. e spiegato che l'SDK comprende due livelli architetturali.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-104">hello [first article](iot-hub-device-sdk-c-intro.md) in this series introduced hello **Azure IoT device SDK for C**. That article explained that there are two architectural layers in SDK.</span></span> <span data-ttu-id="aa5ae-105">In base hello è hello **IoTHubClient** libreria che gestisce direttamente la comunicazione con l'IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-105">At hello base is hello **IoTHubClient** library which directly manages communication with IoT Hub.</span></span> <span data-ttu-id="aa5ae-106">È inoltre disponibile hello **serializzatore** libreria che compila tooprovide in cui servizi di serializzazione.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-106">There's also hello **serializer** library that builds on top of that tooprovide serialization services.</span></span> <span data-ttu-id="aa5ae-107">In questo articolo verranno fornite ulteriori dettagli su hello **IoTHubClient** libreria.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-107">In this article we'll provide additional detail on hello **IoTHubClient** library.</span></span>

<span data-ttu-id="aa5ae-108">articolo di Hello precedente come descritto hello toouse **IoTHubClient** libreria toosend eventi tooIoT Hub e ricevere messaggi.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-108">hello previous article described how toouse hello **IoTHubClient** library toosend events tooIoT Hub and receive messages.</span></span> <span data-ttu-id="aa5ae-109">In questo articolo si estende la discussione di che spiega come gestire precisamente toomore *quando* inviare e ricevere dati, un'introduzione toohello **inferiore a livello di API**.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-109">This article extends that discussion by explaining how toomore precisely manage *when* you send and receive data, introducing you toohello **lower-level APIs**.</span></span> <span data-ttu-id="aa5ae-110">Spiega anche come tooattach proprietà tooevents (e il recupero dei messaggi) utilizzando proprietà hello gestione delle funzionalità in hello **IoTHubClient** libreria.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-110">We'll also explain how tooattach properties tooevents (and retrieve them from messages) using hello property handling features in hello **IoTHubClient** library.</span></span> <span data-ttu-id="aa5ae-111">Infine, verranno fornite ulteriori spiegazioni di toohandle modi i messaggi ricevuti dall'IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-111">Finally, we'll provide additional explanation of different ways toohandle messages received from IoT Hub.</span></span>

<span data-ttu-id="aa5ae-112">Hello articolo si conclude con la copertura di un paio di vari argomenti, inclusi ulteriori informazioni sulle credenziali di dispositivo e come toochange hello comportamento di hello **IoTHubClient** tramite le opzioni di configurazione.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-112">hello article concludes by covering a couple of miscellaneous topics, including more about device credentials and how toochange hello behavior of hello **IoTHubClient** through configuration options.</span></span>

<span data-ttu-id="aa5ae-113">Si userà hello **IoTHubClient** esempi del SDK tooexplain questi argomenti.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-113">We'll use hello **IoTHubClient** SDK samples tooexplain these topics.</span></span> <span data-ttu-id="aa5ae-114">Se si desidera toofollow lungo, vedere hello **l'hub IOT\_client\_esempio\_http** e **l'hub IOT\_client\_esempio\_amqp** applicazioni presenti nel dispositivo di Azure IoT hello SDK per C. tutti gli elementi descritti in hello le sezioni seguenti è illustrato in questi esempi.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-114">If you want toofollow along, see hello **iothub\_client\_sample\_http** and **iothub\_client\_sample\_amqp** applications that are included in hello Azure IoT device SDK for C. Everything described in hello following sections is demonstrated in these samples.</span></span>

<span data-ttu-id="aa5ae-115">È possibile trovare hello [ **dispositivo IoT di Azure SDK per C** ](https://github.com/Azure/azure-iot-sdk-c) GitHub repository e visualizzarne i dettagli di hello API in hello [riferimento all'API C](https://azure.github.io/azure-iot-sdk-c/index.html).</span><span class="sxs-lookup"><span data-stu-id="aa5ae-115">You can find hello [**Azure IoT device SDK for C**](https://github.com/Azure/azure-iot-sdk-c) GitHub repository and view details of hello API in hello [C API reference](https://azure.github.io/azure-iot-sdk-c/index.html).</span></span>

## <a name="hello-lower-level-apis"></a><span data-ttu-id="aa5ae-116">Hello API di livello inferiore</span><span class="sxs-lookup"><span data-stu-id="aa5ae-116">hello lower-level APIs</span></span>
<span data-ttu-id="aa5ae-117">Hello precedente articolo viene descritto il funzionamento di base di hello hello **IotHubClient** contesto hello di hello **l'hub IOT\_client\_esempio\_amqp** applicazione.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-117">hello previous article described hello basic operation of hello **IotHubClient** within hello context of hello **iothub\_client\_sample\_amqp** application.</span></span> <span data-ttu-id="aa5ae-118">Ad esempio, è spiegato come tooinitialize hello libreria con questo codice.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-118">For example, it explained how tooinitialize hello library using this code.</span></span>

```
IOTHUB_CLIENT_HANDLE iotHubClientHandle;
iotHubClientHandle = IoTHubClient_CreateFromConnectionString(connectionString, AMQP_Protocol);
```

<span data-ttu-id="aa5ae-119">Inoltre descritto come eventi toosend usando questa chiamata di funzione.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-119">It also described how toosend events using this function call.</span></span>

```
IoTHubClient_SendEventAsync(iotHubClientHandle, message.messageHandle, SendConfirmationCallback, &message);
```

<span data-ttu-id="aa5ae-120">Hello viene inoltre descritto come tooreceive messaggi tramite la registrazione di una funzione di callback.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-120">hello article also described how tooreceive messages by registering a callback function.</span></span>

```
int receiveContext = 0;
IoTHubClient_SetMessageCallback(iotHubClientHandle, ReceiveMessageCallback, &receiveContext);
```

<span data-ttu-id="aa5ae-121">articolo Hello è stato anche illustrato come risorse toofree tramite codice come illustrato di seguito hello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-121">hello article also showed how toofree resources using code such as hello following.</span></span>

```
IoTHubClient_Destroy(iotHubClientHandle);
```

<span data-ttu-id="aa5ae-122">Esistono tuttavia tooeach funzioni complementare di queste API:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-122">However there are companion functions tooeach of these APIs:</span></span>

* <span data-ttu-id="aa5ae-123">IoTHubClient\_LL\_CreateFromConnectionString</span><span class="sxs-lookup"><span data-stu-id="aa5ae-123">IoTHubClient\_LL\_CreateFromConnectionString</span></span>
* <span data-ttu-id="aa5ae-124">IoTHubClient\_LL\_SendEventAsync</span><span class="sxs-lookup"><span data-stu-id="aa5ae-124">IoTHubClient\_LL\_SendEventAsync</span></span>
* <span data-ttu-id="aa5ae-125">IoTHubClient\_LL\_SetMessageCallback</span><span class="sxs-lookup"><span data-stu-id="aa5ae-125">IoTHubClient\_LL\_SetMessageCallback</span></span>
* <span data-ttu-id="aa5ae-126">IoTHubClient\_LL\_Destroy</span><span class="sxs-lookup"><span data-stu-id="aa5ae-126">IoTHubClient\_LL\_Destroy</span></span>

<span data-ttu-id="aa5ae-127">Tutte queste funzioni includono "LL" nel nome API hello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-127">These functions all include “LL” in hello API name.</span></span> <span data-ttu-id="aa5ae-128">Diverso da quello, parametri di hello di ognuna di queste funzioni sono relative controparti non LL tootheir identici.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-128">Other than that, hello parameters of each of these functions are identical tootheir non-LL counterparts.</span></span> <span data-ttu-id="aa5ae-129">Tuttavia, il comportamento di hello di queste funzioni è diverso per un aspetto importante.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-129">However, hello behavior of these functions is different in one important way.</span></span>

<span data-ttu-id="aa5ae-130">Quando si chiama **IoTHubClient\_CreateFromConnectionString**, librerie sottostante hello creano un nuovo thread che viene eseguito in background hello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-130">When you call **IoTHubClient\_CreateFromConnectionString**, hello underlying libraries create a new thread that runs in hello background.</span></span> <span data-ttu-id="aa5ae-131">Questo thread invia eventi all'hub IoT e ne riceve i messaggi.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-131">This thread sends events to, and receives messages from, IoT Hub.</span></span> <span data-ttu-id="aa5ae-132">Nessun thread di questo tipo viene creato quando si lavora con hello "LL" API.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-132">No such thread is created when working with hello "LL" APIs.</span></span> <span data-ttu-id="aa5ae-133">creazione di Hello di thread in background hello è uno sviluppatore toohello praticità.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-133">hello creation of hello background thread is a convenience toohello developer.</span></span> <span data-ttu-id="aa5ae-134">Non è necessario tooworry sull'invio di eventi in modo esplicito e la ricezione di messaggi dall'IoT Hub - avviene automaticamente in background hello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-134">You don’t have tooworry about explicitly sending events and receiving messages from IoT Hub -- it happens automatically in hello background.</span></span> <span data-ttu-id="aa5ae-135">Al contrario, hello "LL" API consentono di controllare esplicitamente la comunicazione con l'IoT Hub, se è necessario.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-135">In contrast, hello "LL" APIs give you explicit control over communication with IoT Hub, if you need it.</span></span>

<span data-ttu-id="aa5ae-136">toounderstand questa soluzione migliore, esaminiamo un esempio:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-136">toounderstand this better, let’s look at an example:</span></span>

<span data-ttu-id="aa5ae-137">Quando si chiama **IoTHubClient\_SendEventAsync**, ciò che si sta effettivamente eseguendo è l'inserimento di eventi di hello in un buffer.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-137">When you call **IoTHubClient\_SendEventAsync**, what you're actually doing is putting hello event in a buffer.</span></span> <span data-ttu-id="aa5ae-138">thread in background creato quando si chiama Hello **IoTHubClient\_CreateFromConnectionString** monitora questo buffer e i dati vengono inviati continuamente che contenga tooIoT Hub.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-138">hello background thread created when you call **IoTHubClient\_CreateFromConnectionString** continually monitors this buffer and sends any data that it contains tooIoT Hub.</span></span> <span data-ttu-id="aa5ae-139">Ciò si verifica in background hello hello la stessa ora che hello thread principale sta eseguendo altre operazioni.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-139">This happens in hello background at hello same time that hello main thread is performing other work.</span></span>

<span data-ttu-id="aa5ae-140">Analogamente, quando si registra una funzione di callback per i messaggi utilizzando **IoTHubClient\_SetMessageCallback**, si sta per indicare in background di hello hello SDK toohave thread richiamare la funzione di callback hello quando un messaggio ricevuto, indipendentemente dal thread principale di hello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-140">Similarly, when you register a callback function for messages using **IoTHubClient\_SetMessageCallback**, you're instructing hello SDK toohave hello background thread invoke hello callback function when a message is received, independent of hello main thread.</span></span>

<span data-ttu-id="aa5ae-141">Hello "LL" API di non creare un thread in background.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-141">hello "LL" APIs don’t create a background thread.</span></span> <span data-ttu-id="aa5ae-142">Al contrario, una nuova API deve essere chiamato tooexplicitly inviare e ricevere dati da IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-142">Instead, a new API must be called tooexplicitly send and receive data from IoT Hub.</span></span> <span data-ttu-id="aa5ae-143">Come illustrato nell'esempio seguente hello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-143">This is demonstrated in hello following example.</span></span>

<span data-ttu-id="aa5ae-144">Hello **l'hub IOT\_client\_esempio\_http** applicazione che è incluso nel SDK illustra hello hello le API di livello inferiore.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-144">hello **iothub\_client\_sample\_http** application that’s included in hello SDK demonstrates hello lower-level APIs.</span></span> <span data-ttu-id="aa5ae-145">In questo esempio, si invia eventi tooIoT Hub con il codice come illustrato di seguito hello:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-145">In that sample, we send events tooIoT Hub with code such as hello following:</span></span>

```
EVENT_INSTANCE message;
sprintf_s(msgText, sizeof(msgText), "Message_%d_From_IoTHubClient_LL_Over_HTTP", i);
message.messageHandle = IoTHubMessage_CreateFromByteArray((const unsigned char*)msgText, strlen(msgText));

IoTHubClient_LL_SendEventAsync(iotHubClientHandle, message.messageHandle, SendConfirmationCallback, &message)
```

<span data-ttu-id="aa5ae-146">prime tre righe Hello creano messaggio hello e ultima riga hello invia evento hello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-146">hello first three lines create hello message, and hello last line sends hello event.</span></span> <span data-ttu-id="aa5ae-147">Tuttavia, come indicato in precedenza, "invio" evento hello significa che i dati hello semplicemente si trova in un buffer.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-147">However, as mentioned previously, "sending" hello event means that hello data is simply placed in a buffer.</span></span> <span data-ttu-id="aa5ae-148">Non vengono trasmesse nella rete hello quando si chiama **IoTHubClient\_LL\_SendEventAsync**.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-148">Nothing is transmitted on hello network when we call **IoTHubClient\_LL\_SendEventAsync**.</span></span> <span data-ttu-id="aa5ae-149">In ordine tooactually in ingresso hello dati tooIoT Hub, è necessario chiamare **IoTHubClient\_LL\_DoWork**, come nel seguente esempio:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-149">In order tooactually ingress hello data tooIoT Hub, you must call **IoTHubClient\_LL\_DoWork**, as in this example:</span></span>

```
while (1)
{
    IoTHubClient_LL_DoWork(iotHubClientHandle);
    ThreadAPI_Sleep(1000);
}
```

<span data-ttu-id="aa5ae-150">Questo codice (da hello **l'hub IOT\_client\_esempio\_http** applicazione) chiama ripetutamente **IoTHubClient\_LL\_DoWork** .</span><span class="sxs-lookup"><span data-stu-id="aa5ae-150">This code (from hello **iothub\_client\_sample\_http** application) repeatedly calls **IoTHubClient\_LL\_DoWork**.</span></span> <span data-ttu-id="aa5ae-151">Ogni volta che **IoTHubClient\_LL\_DoWork** viene chiamato, invia alcuni eventi dal buffer di hello tooIoT Hub e viene recuperato un messaggio in coda inviato toohello dispositivo.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-151">Each time **IoTHubClient\_LL\_DoWork** is called, it sends some events from hello buffer tooIoT Hub and it retrieves a queued message being sent toohello device.</span></span> <span data-ttu-id="aa5ae-152">quest'ultimo caso Hello significa che se è stata registrata una funzione di callback per i messaggi, quindi viene richiamato il callback di hello (presupponendo che tutti i messaggi vengono accodati fino).</span><span class="sxs-lookup"><span data-stu-id="aa5ae-152">hello latter case means that if we registered a callback function for messages, then hello callback is invoked (assuming any messages are queued up).</span></span> <span data-ttu-id="aa5ae-153">È una funzione di callback verrebbe registrato con codice simile hello seguente:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-153">We would have registered such a callback function with code such as hello following:</span></span>

```
IoTHubClient_LL_SetMessageCallback(iotHubClientHandle, ReceiveMessageCallback, &receiveContext)
```

<span data-ttu-id="aa5ae-154">motivo Hello **IoTHubClient\_LL\_DoWork** viene spesso chiamato in un ciclo è che ogni volta che viene chiamato, invia *alcuni* memorizzato nel buffer gli eventi tooIoT Hub e recupera *hello successivamente* messaggio messo in coda per il dispositivo hello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-154">hello reason that **IoTHubClient\_LL\_DoWork** is often called in a loop is that each time it’s called, it sends *some* buffered events tooIoT Hub and retrieves *hello next* message queued up for hello device.</span></span> <span data-ttu-id="aa5ae-155">Ogni chiamata non è garantito che gli eventi toosend tutti memorizzato nel buffer o in coda tooretrieve tutti i messaggi.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-155">Each call isn’t guaranteed toosend all buffered events or tooretrieve all queued messages.</span></span> <span data-ttu-id="aa5ae-156">Se si desidera toosend tutti gli eventi di hello nel buffer e quindi continueranno con altre attività di elaborazione è possibile sostituire questo ciclo con codice simile hello seguente:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-156">If you want toosend all events in hello buffer and then continue on with other processing you can replace this loop with code such as hello following:</span></span>

```
IOTHUB_CLIENT_STATUS status;

while ((IoTHubClient_LL_GetSendStatus(iotHubClientHandle, &status) == IOTHUB_CLIENT_OK) && (status == IOTHUB_CLIENT_SEND_STATUS_BUSY))
{
    IoTHubClient_LL_DoWork(iotHubClientHandle);
    ThreadAPI_Sleep(1000);
}
```

<span data-ttu-id="aa5ae-157">Questo codice chiama **IoTHubClient\_LL\_DoWork** fino a quando tutti gli eventi nel buffer hello sono stati inviati tooIoT Hub.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-157">This code calls **IoTHubClient\_LL\_DoWork** until all events in hello buffer have been sent tooIoT Hub.</span></span> <span data-ttu-id="aa5ae-158">Non significa però che si siano ricevuti anche tutti i messaggi in coda.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-158">Note this does not also imply that all queued messages have been received.</span></span> <span data-ttu-id="aa5ae-159">Parte del motivo hello è che il controllo dei messaggi "tutto" non è deterministica come un'azione.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-159">Part of hello reason for this is that checking for "all" messages isn’t as deterministic an action.</span></span> <span data-ttu-id="aa5ae-160">Cosa succede se si recuperano "tutti" messaggi hello, ma ne verrà quindi inviati toohello dispositivo subito dopo?</span><span class="sxs-lookup"><span data-stu-id="aa5ae-160">What happens if you retrieve "all" of hello messages, but then another one is sent toohello device immediately after?</span></span> <span data-ttu-id="aa5ae-161">Un migliore toodeal modo con cui è con un timeout programmato.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-161">A better way toodeal with that is with a programmed timeout.</span></span> <span data-ttu-id="aa5ae-162">Ad esempio, funzione di callback messaggio hello è stato possibile reimpostare un timer ogni volta che viene richiamato.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-162">For example, hello message callback function could reset a timer every time it’s invoked.</span></span> <span data-ttu-id="aa5ae-163">È quindi possibile scrivere l'elaborazione di toocontinue logica Se, ad esempio, non sono stati ricevuti messaggi in hello ultima *X* secondi.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-163">You can then write logic toocontinue processing if, for example, no messages have been received in hello last *X* seconds.</span></span>

<span data-ttu-id="aa5ae-164">Quando è finito ingressing eventi e la ricezione di messaggi, che toocall hello corrispondente funzione tooclean delle risorse.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-164">When you’re finished ingressing events and receiving messages, be sure toocall hello corresponding function tooclean up resources.</span></span>

```
IoTHubClient_LL_Destroy(iotHubClientHandle);
```

<span data-ttu-id="aa5ae-165">Si tratta in sostanza di un solo set di API toosend e ricevere dati con un thread in background e un altro set di API che hello stessa operazione senza thread in background hello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-165">Basically there’s only one set of APIs toosend and receive data with a background thread and another set of APIs that does hello same thing without hello background thread.</span></span> <span data-ttu-id="aa5ae-166">Molti sviluppatori preferibile hello LL API non ma hello le API di livello inferiore sono utili quando per sviluppatori di hello richiede un controllo esplicito le trasmissioni in rete.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-166">A lot of developers may prefer hello non-LL APIs, but hello lower-level APIs are useful when hello developer wants explicit control over network transmissions.</span></span> <span data-ttu-id="aa5ae-167">Ad esempio, alcuni dispositivi raccolgono dati nel tempo e solo eventi in ingresso a intervalli specificati, come una volta all'ora o una volta al giorno.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-167">For example, some devices collect data over time and only ingress events at specified intervals (for example, once an hour or once a day).</span></span> <span data-ttu-id="aa5ae-168">Hello offrono le API di livello inferiore hello controllo tooexplicitly possibilità quando si inviano e ricevono dati dall'IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-168">hello lower-level APIs give you hello ability tooexplicitly control when you send and receive data from IoT Hub.</span></span> <span data-ttu-id="aa5ae-169">Altri semplicemente preferiranno semplicità hello che hello che forniscono le API di livello inferiore.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-169">Others will simply prefer hello simplicity that hello lower-level APIs provide.</span></span> <span data-ttu-id="aa5ae-170">Tutto ciò che viene eseguita nel thread principale di hello anziché alcuni eventualità di lavoro in background hello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-170">Everything happens on hello main thread rather than some work happening in hello background.</span></span>

<span data-ttu-id="aa5ae-171">Indipendentemente dal modello scelto, è possibile che toobe coerente nelle quali API utilizzare.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-171">Whichever model you choose, be sure toobe consistent in which APIs you use.</span></span> <span data-ttu-id="aa5ae-172">Se si avvia chiamando **IoTHubClient\_LL\_CreateFromConnectionString**, assicurarsi di utilizzare solo hello corrispondente API di livello inferiore per tutte le operazioni di completamento:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-172">If you start by calling **IoTHubClient\_LL\_CreateFromConnectionString**, be sure you only use hello corresponding lower-level APIs for any follow-up work:</span></span>

* <span data-ttu-id="aa5ae-173">IoTHubClient\_LL\_SendEventAsync</span><span class="sxs-lookup"><span data-stu-id="aa5ae-173">IoTHubClient\_LL\_SendEventAsync</span></span>
* <span data-ttu-id="aa5ae-174">IoTHubClient\_LL\_SetMessageCallback</span><span class="sxs-lookup"><span data-stu-id="aa5ae-174">IoTHubClient\_LL\_SetMessageCallback</span></span>
* <span data-ttu-id="aa5ae-175">IoTHubClient\_LL\_Destroy</span><span class="sxs-lookup"><span data-stu-id="aa5ae-175">IoTHubClient\_LL\_Destroy</span></span>
* <span data-ttu-id="aa5ae-176">IoTHubClient\_LL\_DoWork</span><span class="sxs-lookup"><span data-stu-id="aa5ae-176">IoTHubClient\_LL\_DoWork</span></span>

<span data-ttu-id="aa5ae-177">anche Hello opposto è true.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-177">hello opposite is true as well.</span></span> <span data-ttu-id="aa5ae-178">Se si inizia con **IoTHubClient\_CreateFromConnectionString**, quindi utilizzare hello LL API non per tutte le altre elaborazioni.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-178">If you start with **IoTHubClient\_CreateFromConnectionString**, then use hello non-LL APIs for any additional processing.</span></span>

<span data-ttu-id="aa5ae-179">Nel dispositivo di Azure IoT di hello SDK per C, vedere hello **l'hub IOT\_client\_esempio\_http** inferiore a livello di applicazione per un esempio completo di hello API.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-179">In hello Azure IoT device SDK for C, see hello **iothub\_client\_sample\_http** application for a complete example of hello lower-level APIs.</span></span> <span data-ttu-id="aa5ae-180">Hello **l'hub IOT\_client\_esempio\_amqp** applicazione è possibile fare riferimento per un esempio completo di hello LL API non.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-180">hello **iothub\_client\_sample\_amqp** application can be referenced for a full example of hello non-LL APIs.</span></span>

## <a name="property-handling"></a><span data-ttu-id="aa5ae-181">Gestione delle proprietà</span><span class="sxs-lookup"><span data-stu-id="aa5ae-181">Property handling</span></span>
<span data-ttu-id="aa5ae-182">Finora quando abbiamo descritto l'invio dei dati, è stata stato fa riferimento toohello corpo del messaggio hello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-182">So far when we've described sending data, we've been referring toohello body of hello message.</span></span> <span data-ttu-id="aa5ae-183">Si consideri ad esempio questo codice:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-183">For example, consider this code:</span></span>

```
EVENT_INSTANCE message;
sprintf_s(msgText, sizeof(msgText), "Hello World");
message.messageHandle = IoTHubMessage_CreateFromByteArray((const unsigned char*)msgText, strlen(msgText));
IoTHubClient_LL_SendEventAsync(iotHubClientHandle, message.messageHandle, SendConfirmationCallback, &message)
```

<span data-ttu-id="aa5ae-184">Questo esempio viene inviato un messaggio tooIoT Hub, con testo hello "Hello World".</span><span class="sxs-lookup"><span data-stu-id="aa5ae-184">This example sends a message tooIoT Hub with hello text "Hello World."</span></span> <span data-ttu-id="aa5ae-185">Tuttavia, IoT Hub consente inoltre di messaggio associata tooeach toobe di proprietà.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-185">However, IoT Hub also allows properties toobe attached tooeach message.</span></span> <span data-ttu-id="aa5ae-186">Le proprietà sono coppie nome/valore che possono essere collegato toohello messaggio.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-186">Properties are name/value pairs that can be attached toohello message.</span></span> <span data-ttu-id="aa5ae-187">Ad esempio, che potremo modificare hello tooattach di codice precedente la proprietà toohello message:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-187">For example, we can modify hello previous code tooattach a property toohello message:</span></span>

```
MAP_HANDLE propMap = IoTHubMessage_Properties(message.messageHandle);
sprintf_s(propText, sizeof(propText), "%d", i);
Map_AddOrUpdate(propMap, "SequenceNumber", propText);
```

<span data-ttu-id="aa5ae-188">Viene avviata chiamando **IoTHubMessage\_proprietà** e passando l'handle di hello dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-188">We start by calling **IoTHubMessage\_Properties** and passing it hello handle of our message.</span></span> <span data-ttu-id="aa5ae-189">Cosa viene visualizzato nuovamente un **mappa\_gestire** riferimento che consente di toostart aggiunta di proprietà.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-189">What we get back is a **MAP\_HANDLE** reference that enables us toostart adding properties.</span></span> <span data-ttu-id="aa5ae-190">Hello quest'ultimo viene eseguito chiamando **mappa\_AddOrUpdate**, che accetta un tooa riferimento mappa\_HANDLE, il nome di proprietà hello e valore della proprietà hello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-190">hello latter is accomplished by calling **Map\_AddOrUpdate**, which takes a reference tooa MAP\_HANDLE, hello property name, and hello property value.</span></span> <span data-ttu-id="aa5ae-191">Con questa API è possibile aggiungere tutte le proprietà necessarie.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-191">With this API we can add as many properties as we like.</span></span>

<span data-ttu-id="aa5ae-192">Quando evento hello viene letto dal **hub eventi**, ricevitore hello di enumerare le proprietà di hello e recuperarne i valori corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-192">When hello event is read from **Event Hubs**, hello receiver can enumerate hello properties and retrieve their corresponding values.</span></span> <span data-ttu-id="aa5ae-193">Ad esempio, in .NET questa verrebbe eseguita accedendo hello [raccolta di proprietà nell'oggetto EventData hello](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.eventdata.properties.aspx).</span><span class="sxs-lookup"><span data-stu-id="aa5ae-193">For example, in .NET this would be accomplished by accessing hello [Properties collection on hello EventData object](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.eventdata.properties.aspx).</span></span>

<span data-ttu-id="aa5ae-194">Nell'esempio precedente hello si assocerà evento tooan proprietà che vengono inviate tooIoT Hub.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-194">In hello previous example, we’re attaching properties tooan event that we send tooIoT Hub.</span></span> <span data-ttu-id="aa5ae-195">Le proprietà possono essere collegati toomessages ricevuto dall'IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-195">Properties can also be attached toomessages received from IoT Hub.</span></span> <span data-ttu-id="aa5ae-196">Se si desidera che la proprietà tooretrieve da un messaggio, è possibile utilizzare codice come illustrato di seguito hello nella funzione callback messaggio:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-196">If we want tooretrieve properties from a message, we can use code such as hello following in our message callback function:</span></span>

```
static IOTHUBMESSAGE_DISPOSITION_RESULT ReceiveMessageCallback(IOTHUB_MESSAGE_HANDLE message, void* userContextCallback)
{
    . . .

    // Retrieve properties from hello message
    MAP_HANDLE mapProperties = IoTHubMessage_Properties(message);
    if (mapProperties != NULL)
    {
        const char*const* keys;
        const char*const* values;
        size_t propertyCount = 0;
        if (Map_GetInternals(mapProperties, &keys, &values, &propertyCount) == MAP_OK)
        {
            if (propertyCount > 0)
            {
                printf("Message Properties:\r\n");
                for (size_t index = 0; index < propertyCount; index++)
                {
                    printf("\tKey: %s Value: %s\r\n", keys[index], values[index]);
                }
                printf("\r\n");
            }
        }
    }

    . . .
}
```

<span data-ttu-id="aa5ae-197">Hello chiamata troppo**IoTHubMessage\_proprietà** hello restituisce **mappa\_gestire** riferimento.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-197">hello call too**IoTHubMessage\_Properties** returns hello **MAP\_HANDLE** reference.</span></span> <span data-ttu-id="aa5ae-198">È quindi passare il riferimento troppo**mappa\_GetInternals** tooobtain una matrice di tooan di riferimento di nome/valore hello coppie (oltre a un numero di proprietà hello).</span><span class="sxs-lookup"><span data-stu-id="aa5ae-198">We then pass that reference too**Map\_GetInternals** tooobtain a reference tooan array of hello name/value pairs (as well as a count of hello properties).</span></span> <span data-ttu-id="aa5ae-199">A questo punto è sufficiente enumerazione dei valori di hello proprietà tooget toohello desiderato.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-199">At that point it's a simple matter of enumerating hello properties tooget toohello values we want.</span></span>

<span data-ttu-id="aa5ae-200">Non si dispone di proprietà toouse nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-200">You don't have toouse properties in your application.</span></span> <span data-ttu-id="aa5ae-201">Tuttavia, se è necessario tooset usarle in eventi o recuperarli da messaggi hello **IoTHubClient** libreria rende più semplice.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-201">However, if you need tooset them on events or retrieve them from messages, hello **IoTHubClient** library makes it easy.</span></span>

## <a name="message-handling"></a><span data-ttu-id="aa5ae-202">Gestione dei messaggi</span><span class="sxs-lookup"><span data-stu-id="aa5ae-202">Message handling</span></span>
<span data-ttu-id="aa5ae-203">Come indicato in precedenza, quando i messaggi provenienti da hello IoT Hub **IoTHubClient** libreria risponde richiamando una funzione di callback registrato.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-203">As stated previously, when messages arrive from IoT Hub hello **IoTHubClient** library responds by invoking a registered callback function.</span></span> <span data-ttu-id="aa5ae-204">Un parametro restituito da questa funzione merita tuttavia qualche spiegazione aggiuntiva.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-204">There is a return parameter of this function that deserves some additional explanation.</span></span> <span data-ttu-id="aa5ae-205">Di seguito viene riportato un frammento della funzione di callback hello in hello **l'hub IOT\_client\_esempio\_http** applicazione di esempio:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-205">Here’s an excerpt of hello callback function in hello **iothub\_client\_sample\_http** sample application:</span></span>

```
static IOTHUBMESSAGE_DISPOSITION_RESULT ReceiveMessageCallback(IOTHUB_MESSAGE_HANDLE message, void* userContextCallback)
{
    . . .
    return IOTHUBMESSAGE_ACCEPTED;
}
```

<span data-ttu-id="aa5ae-206">Si noti che il tipo restituito di hello è **IOTHUBMESSAGE\_DISPOSITION\_risultato** e in questo caso restituiamo **IOTHUBMESSAGE\_accettato**.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-206">Note that hello return type is **IOTHUBMESSAGE\_DISPOSITION\_RESULT** and in this particular case we return **IOTHUBMESSAGE\_ACCEPTED**.</span></span> <span data-ttu-id="aa5ae-207">Esistono altri valori di questa funzione è possibile tornare che modifica la modalità hello **IoTHubClient** libreria reagisce callback messaggio toohello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-207">There are other values we can return from this function that change how hello **IoTHubClient** library reacts toohello message callback.</span></span> <span data-ttu-id="aa5ae-208">Ecco le opzioni di hello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-208">Here are hello options.</span></span>

* <span data-ttu-id="aa5ae-209">**IOTHUBMESSAGE\_accettato** : messaggio hello è stata elaborata correttamente.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-209">**IOTHUBMESSAGE\_ACCEPTED** – hello message has been processed successfully.</span></span> <span data-ttu-id="aa5ae-210">Hello **IoTHubClient** libreria non richiama la funzione di callback hello con hello stesso messaggio.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-210">hello **IoTHubClient** library will not invoke hello callback function again with hello same message.</span></span>
* <span data-ttu-id="aa5ae-211">**IOTHUBMESSAGE\_RIFIUTATO** : Impossibile elaborare il messaggio hello e vi è alcun toodo desiderio non hello così in futuro.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-211">**IOTHUBMESSAGE\_REJECTED** – hello message was not processed and there is no desire toodo so in hello future.</span></span> <span data-ttu-id="aa5ae-212">Hello **IoTHubClient** libreria non deve richiamare la funzione di callback hello con hello stesso messaggio.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-212">hello **IoTHubClient** library should not invoke hello callback function again with hello same message.</span></span>
* <span data-ttu-id="aa5ae-213">**IOTHUBMESSAGE\_ABBANDONATO** : messaggio hello non è stata elaborata correttamente, ma hello **IoTHubClient** libreria deve richiamare una funzione di callback hello con hello stesso messaggio.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-213">**IOTHUBMESSAGE\_ABANDONED** – hello message was not processed successfully, but hello **IoTHubClient** library should invoke hello callback function again with hello same message.</span></span>

<span data-ttu-id="aa5ae-214">Per hello innanzitutto due codici restituiti, hello **IoTHubClient** libreria invia un messaggio tooIoT Hub che indica il messaggio hello deve essere eliminato dalla coda dispositivo hello e non recapitato nuovamente.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-214">For hello first two return codes, hello **IoTHubClient** library sends a message tooIoT Hub indicating that hello message should be deleted from hello device queue and not delivered again.</span></span> <span data-ttu-id="aa5ae-215">effetto Hello è hello stesso (messaggio hello viene eliminato dalla coda dispositivo hello), ma se il messaggio hello è stato accettato o rifiutato è ancora registrato.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-215">hello net effect is hello same (hello message is deleted from hello device queue), but whether hello message was accepted or rejected is still recorded.</span></span>  <span data-ttu-id="aa5ae-216">La registrazione di questa distinzione è utile toosenders del messaggio hello in grado di restare in attesa per commenti e suggerimenti e scoprire se un dispositivo ha accettato o rifiutato un messaggio specifico.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-216">Recording this distinction is useful toosenders of hello message who can listen for feedback and find out if a device has accepted or rejected a particular message.</span></span>

<span data-ttu-id="aa5ae-217">Nell'ultimo caso hello viene inviato un messaggio anche tooIoT Hub, ma significa che deve essere recapitato nuovamente il messaggio hello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-217">In hello last case a message is also sent tooIoT Hub, but it indicates that hello message should be redelivered.</span></span> <span data-ttu-id="aa5ae-218">In genere si sarà abbandona un messaggio se si verifica un errore ma si desidera tootry tooprocess hello messaggio nuovo.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-218">Typically you’ll abandon a message if you encounter some error but want tootry tooprocess hello message again.</span></span> <span data-ttu-id="aa5ae-219">Al contrario, un messaggio di rifiuto è appropriato quando si verifica un errore irreversibile (o se si decide semplicemente che non si desidera messaggio hello tooprocess).</span><span class="sxs-lookup"><span data-stu-id="aa5ae-219">In contrast, rejecting a message is appropriate when you encounter an unrecoverable error (or if you simply decide you don’t want tooprocess hello message).</span></span>

<span data-ttu-id="aa5ae-220">In ogni caso, tenere hello diversi codici in modo che è possibile dedurre il comportamento di hello desiderato hello **IoTHubClient** libreria.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-220">In any case, be aware of hello different return codes so that you can elicit hello behavior you want from hello **IoTHubClient** library.</span></span>

## <a name="alternate-device-credentials"></a><span data-ttu-id="aa5ae-221">Credenziali del dispositivo alternative</span><span class="sxs-lookup"><span data-stu-id="aa5ae-221">Alternate device credentials</span></span>
<span data-ttu-id="aa5ae-222">Come illustrato in precedenza, hello in primo luogo toodo quando si lavora con hello **IoTHubClient** libreria è tooobtain un **l'hub IOT\_CLIENT\_gestire** con una chiamata ad esempio hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-222">As explained previously, hello first thing toodo when working with hello **IoTHubClient** library is tooobtain a **IOTHUB\_CLIENT\_HANDLE** with a call such as hello following:</span></span>

```
IOTHUB_CLIENT_HANDLE iotHubClientHandle;
iotHubClientHandle = IoTHubClient_CreateFromConnectionString(connectionString, AMQP_Protocol);
```

<span data-ttu-id="aa5ae-223">Hello argomenti troppo**IoTHubClient\_CreateFromConnectionString** sono stringa di connessione del dispositivo hello e un parametro che indica il protocollo di hello utilizziamo toocommunicate con l'IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-223">hello arguments too**IoTHubClient\_CreateFromConnectionString** are hello device connection string and a parameter that indicates hello protocol we use toocommunicate with IoT Hub.</span></span> <span data-ttu-id="aa5ae-224">stringa di connessione del dispositivo Hello presenta un formato che viene visualizzato come segue:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-224">hello device connection string has a format that appears as follows:</span></span>

```
HostName=IOTHUBNAME.IOTHUBSUFFIX;DeviceId=DEVICEID;SharedAccessKey=SHAREDACCESSKEY
```

<span data-ttu-id="aa5ae-225">Questa stringa contiene quattro informazioni: nome dell'hub IoT, suffisso dell'hub IoT, ID dispositivo e chiave di accesso condivisa.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-225">There are four pieces of information in this string: IoT Hub name, IoT Hub suffix, device ID, and shared access key.</span></span> <span data-ttu-id="aa5ae-226">Ottenere il nome di dominio completo hello (FQDN) di un hub IoT quando si crea l'istanza dell'hub IoT in hello portale di Azure, in questo modo è il nome dell'hub IoT hello (hello prima parte di hello FQDN) e il suffisso di hub IoT hello (rimanente hello hello FQDN).</span><span class="sxs-lookup"><span data-stu-id="aa5ae-226">You obtain hello fully qualified domain name (FQDN) of an IoT hub when you create your IoT hub instance in hello Azure portal — this gives you hello IoT hub name (hello first part of hello FQDN) and hello IoT hub suffix (hello rest of hello FQDN).</span></span> <span data-ttu-id="aa5ae-227">Ottenere ID dispositivo hello e la chiave di accesso condiviso hello quando si registra il dispositivo con l'IoT Hub (come descritto in hello [articolo precedente](iot-hub-device-sdk-c-intro.md)).</span><span class="sxs-lookup"><span data-stu-id="aa5ae-227">You get hello device ID and hello shared access key when you register your device with IoT Hub (as described in hello [previous article](iot-hub-device-sdk-c-intro.md)).</span></span>

<span data-ttu-id="aa5ae-228">**IoTHubClient\_CreateFromConnectionString** offre libreria hello tooinitialize unidirezionale.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-228">**IoTHubClient\_CreateFromConnectionString** gives you one way tooinitialize hello library.</span></span> <span data-ttu-id="aa5ae-229">Se si preferisce, è possibile creare un nuovo **l'hub IOT\_CLIENT\_gestire** utilizzando questi singoli parametri anziché di stringa di connessione del dispositivo hello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-229">If you prefer, you can create a new **IOTHUB\_CLIENT\_HANDLE** by using these individual parameters rather than hello device connection string.</span></span> <span data-ttu-id="aa5ae-230">Questo risultato viene ottenuto con hello seguente codice:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-230">This is achieved with hello following code:</span></span>

```
IOTHUB_CLIENT_CONFIG iotHubClientConfig;
iotHubClientConfig.iotHubName = "";
iotHubClientConfig.deviceId = "";
iotHubClientConfig.deviceKey = "";
iotHubClientConfig.iotHubSuffix = "";
iotHubClientConfig.protocol = HTTP_Protocol;
IOTHUB_CLIENT_HANDLE iotHubClientHandle = IoTHubClient_LL_Create(&iotHubClientConfig);
```

<span data-ttu-id="aa5ae-231">Ciò consente di realizzare hello equivale al **IoTHubClient\_CreateFromConnectionString**.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-231">This accomplishes hello same thing as **IoTHubClient\_CreateFromConnectionString**.</span></span>

<span data-ttu-id="aa5ae-232">Potrebbe sembrare ovvio che desideri toouse **IoTHubClient\_CreateFromConnectionString** invece di questo metodo di inizializzazione più dettagliato.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-232">It may seem obvious that you would want toouse **IoTHubClient\_CreateFromConnectionString** rather than this more verbose method of initialization.</span></span> <span data-ttu-id="aa5ae-233">Tenere però presente che quando si registra un dispositivo nell'hub IoT, si ottiene un ID dispositivo e una chiave del dispositivo, non una stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-233">Keep in mind, however, that when you register a device in IoT Hub what you get is a device ID and device key (not a connection string).</span></span> <span data-ttu-id="aa5ae-234">Hello *Esplora dispositivo* strumento SDK introdotto in hello [articolo precedente](iot-hub-device-sdk-c-intro.md) Usa librerie di hello **SDK di servizi di Azure IoT** toocreate hello dispositivo stringa di connessione ID dispositivo Hello chiave del dispositivo e nome host dell'IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-234">hello *device explorer* SDK tool introduced in hello [previous article](iot-hub-device-sdk-c-intro.md) uses libraries in hello **Azure IoT service SDK** toocreate hello device connection string from hello device ID, device key, and IoT Hub host name.</span></span> <span data-ttu-id="aa5ae-235">Pertanto la chiamata di **IoTHubClient\_LL\_crea** potrebbe essere preferibile perché si salva il passaggio di hello della generazione di una stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-235">So calling **IoTHubClient\_LL\_Create** may be preferable because it saves you hello step of generating a connection string.</span></span> <span data-ttu-id="aa5ae-236">Usare il metodo più pratico.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-236">Use whichever method is convenient.</span></span>

## <a name="configuration-options"></a><span data-ttu-id="aa5ae-237">Opzioni di configurazione</span><span class="sxs-lookup"><span data-stu-id="aa5ae-237">Configuration options</span></span>
<span data-ttu-id="aa5ae-238">Fino a questo punto tutti gli elementi descritti su hello modo hello **IoTHubClient** works libreria riflette il comportamento predefinito.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-238">So far everything described about hello way hello **IoTHubClient** library works reflects its default behavior.</span></span> <span data-ttu-id="aa5ae-239">Tuttavia, esistono alcune opzioni che è possibile impostare toochange funzionamento libreria hello.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-239">However, there are a few options that you can set toochange how hello library works.</span></span> <span data-ttu-id="aa5ae-240">Questa operazione viene eseguita sfruttando hello **IoTHubClient\_LL\_SetOption** API.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-240">This is accomplished by leveraging hello **IoTHubClient\_LL\_SetOption** API.</span></span> <span data-ttu-id="aa5ae-241">Considerare questo esempio:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-241">Consider this example:</span></span>

```
unsigned int timeout = 30000;
IoTHubClient_LL_SetOption(iotHubClientHandle, "timeout", &timeout);
```

<span data-ttu-id="aa5ae-242">Ci sono un paio di opzioni usate comunemente:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-242">There are a couple of options that are commonly used:</span></span>

* <span data-ttu-id="aa5ae-243">**SetBatching** (bool) – se **true**, i dati inviati tooIoT Hub verranno inviate in batch.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-243">**SetBatching** (bool) – If **true**, then data sent tooIoT Hub is sent in batches.</span></span> <span data-ttu-id="aa5ae-244">Se **false**, i messaggi vengono inviati singolarmente.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-244">If **false**, then messages are sent individually.</span></span> <span data-ttu-id="aa5ae-245">valore predefinito di Hello è **false**.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-245">hello default is **false**.</span></span> <span data-ttu-id="aa5ae-246">Si noti che hello **SetBatching** opzione si applica solo il protocollo HTTP toohello e non toohello MQTT o AMQP protocolli.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-246">Note that hello **SetBatching** option only applies toohello HTTP protocol and not toohello MQTT or AMQP protocols.</span></span>
* <span data-ttu-id="aa5ae-247">**Timeout** (unsigned int): questo valore è rappresentato in millisecondi.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-247">**Timeout** (unsigned int) – This value is represented in milliseconds.</span></span> <span data-ttu-id="aa5ae-248">Se l'invio di una richiesta HTTP o la ricezione di una risposta richiede più tempo rispetto a questo momento, quindi hello timeout della connessione.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-248">If sending an HTTP request or receiving a response takes longer than this time, then hello connection times out.</span></span>

<span data-ttu-id="aa5ae-249">opzione di invio in batch Hello è importante.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-249">hello batching option is important.</span></span> <span data-ttu-id="aa5ae-250">Per impostazione predefinita, hello eventi ingresses libreria singolarmente (un singolo evento è qualsiasi elemento passato troppo**IoTHubClient\_LL\_SendEventAsync**).</span><span class="sxs-lookup"><span data-stu-id="aa5ae-250">By default, hello library ingresses events individually (a single event is whatever you pass too**IoTHubClient\_LL\_SendEventAsync**).</span></span> <span data-ttu-id="aa5ae-251">Se l'invio in batch opzione hello **true**, libreria hello raccoglie tutti gli eventi, nonché dal buffer di hello (backup toohello dimensione massima dei messaggi che accetterà IoT Hub).</span><span class="sxs-lookup"><span data-stu-id="aa5ae-251">If hello batching option is **true**, hello library collects as many events as it can from hello buffer (up toohello maximum message size that IoT Hub will accept).</span></span>  <span data-ttu-id="aa5ae-252">Hello evento batch viene inviato tooIoT Hub in una singola chiamata HTTP (singoli eventi hello sono inclusi in una matrice JSON).</span><span class="sxs-lookup"><span data-stu-id="aa5ae-252">hello event batch is sent tooIoT Hub in a single HTTP call (hello individual events are bundled into a JSON array).</span></span> <span data-ttu-id="aa5ae-253">In genere l'abilitazione dell'invio in batch consente di ottenere un miglioramento significativo delle prestazioni, perché si riducono le sequenze di andata e ritorno in rete.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-253">Enabling batching typically results in big performance gains since you’re reducing network round-trips.</span></span> <span data-ttu-id="aa5ae-254">Si riduce in modo significativo anche la larghezza di banda, perché si invia un unico set di intestazioni HTTP con un batch di eventi, invece di un set di intestazioni per ogni singolo evento.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-254">It also significantly reduces bandwidth since you are sending one set of HTTP headers with an event batch rather than a set of headers for each individual event.</span></span> <span data-ttu-id="aa5ae-255">A meno che non si dispone di un toodo motivo specifico, in caso contrario, in genere è opportuno tooenable l'invio in batch.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-255">Unless you have a specific reason toodo otherwise, typically you’ll want tooenable batching.</span></span>

## <a name="next-steps"></a><span data-ttu-id="aa5ae-256">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="aa5ae-256">Next steps</span></span>
<span data-ttu-id="aa5ae-257">In questo articolo viene descritto il comportamento hello dettaglio di hello **IoTHubClient** libreria trovata nel hello **dispositivo IoT di Azure SDK per C**. Con queste informazioni, è necessario avere una buona conoscenza delle funzionalità di hello di hello **IoTHubClient** libreria.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-257">This article describes in detail hello behavior of hello **IoTHubClient** library found in hello **Azure IoT device SDK for C**. With this information, you should have a good understanding of hello capabilities of hello **IoTHubClient** library.</span></span> <span data-ttu-id="aa5ae-258">Hello [articolo successivo](iot-hub-device-sdk-c-serializer.md) fornisce informazioni simili sulle hello **serializzatore** libreria.</span><span class="sxs-lookup"><span data-stu-id="aa5ae-258">hello [next article](iot-hub-device-sdk-c-serializer.md) provides similar detail on hello **serializer** library.</span></span>

<span data-ttu-id="aa5ae-259">toolearn più sullo sviluppo per l'IoT Hub, vedere hello [Azure IoT SDK][lnk-sdks].</span><span class="sxs-lookup"><span data-stu-id="aa5ae-259">toolearn more about developing for IoT Hub, see hello [Azure IoT SDKs][lnk-sdks].</span></span>

<span data-ttu-id="aa5ae-260">toofurther esplorare le funzionalità di hello di IoT Hub, vedere:</span><span class="sxs-lookup"><span data-stu-id="aa5ae-260">toofurther explore hello capabilities of IoT Hub, see:</span></span>

* <span data-ttu-id="aa5ae-261">[Simulazione di un dispositivo con Azure IoT Edge][lnk-iotedge]</span><span class="sxs-lookup"><span data-stu-id="aa5ae-261">[Simulating a device with Azure IoT Edge][lnk-iotedge]</span></span>

[lnk-sdks]: iot-hub-devguide-sdks.md

[lnk-iotedge]: iot-hub-linux-iot-edge-simulated-device.md
