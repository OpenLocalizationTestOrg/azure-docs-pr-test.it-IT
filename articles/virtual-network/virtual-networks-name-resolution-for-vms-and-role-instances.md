---
title: Risoluzione per le macchine virtuali e le istanze del ruolo
description: 'Scenari di risoluzione dei nomi per Azure IaaS, soluzioni ibride, tra diversi servizi cloud, Active Directory e utilizzando il proprio server DNS  '
services: virtual-network
documentationcenter: na
author: GarethBradshawMSFT
manager: carmonm
editor: tysonn
ms.assetid: 5d73edde-979a-470a-b28c-e103fcf07e3e
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 12/06/2016
ms.author: telmos
ms.openlocfilehash: 479cf8cf358d0b242d8ce030d8639b493e4767d8
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="name-resolution-for-vms-and-role-instances"></a><span data-ttu-id="3c789-103">Risoluzione dei nomi per le macchine virtuali e le istanze del ruolo</span><span class="sxs-lookup"><span data-stu-id="3c789-103">Name Resolution for VMs and Role Instances</span></span>
<span data-ttu-id="3c789-104">A seconda di come si usa Azure per ospitare soluzioni IaaS, PaaS e ibride, potrebbe essere necessario consentire la comunicazione tra VM e istanze del ruolo create.</span><span class="sxs-lookup"><span data-stu-id="3c789-104">Depending on how you use Azure to host IaaS, PaaS, and hybrid solutions, you may need to allow the VMs and role instances that you create to communicate with each other.</span></span> <span data-ttu-id="3c789-105">Nonostante questa comunicazione possa avvenire usando indirizzi IP, è molto più semplice usare nomi che possono essere facilmente ricordati e che non cambiano.</span><span class="sxs-lookup"><span data-stu-id="3c789-105">Although this communication can be done by using IP addresses, it is much simpler to use names that can be easily remembered and do not change.</span></span> 

<span data-ttu-id="3c789-106">Quando le istanze del ruolo e le VM ospitate in Azure devono risolvere nomi di dominio trasformandoli in indirizzi IP interni, possono usare uno di questi due metodi:</span><span class="sxs-lookup"><span data-stu-id="3c789-106">When role instances and VMs hosted in Azure need to resolve domain names to internal IP addresses, they can use one of two methods:</span></span>

* [<span data-ttu-id="3c789-107">Risoluzione dei nomi fornita da Azure</span><span class="sxs-lookup"><span data-stu-id="3c789-107">Azure-provided name resolution</span></span>](#azure-provided-name-resolution)
* <span data-ttu-id="3c789-108">[Risoluzione dei nomi usando il server DNS](#name-resolution-using-your-own-dns-server) (che potrebbe inoltrare le query ai server DNS forniti da Azure)</span><span class="sxs-lookup"><span data-stu-id="3c789-108">[Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server) (which may forward queries to the Azure-provided DNS servers)</span></span> 

<span data-ttu-id="3c789-109">Il tipo di risoluzione dei nomi usato dipende dal modo in cui VM e istanze del ruolo devono comunicare.</span><span class="sxs-lookup"><span data-stu-id="3c789-109">The type of name resolution you use depends on how your VMs and role instances need to communicate with each other.</span></span>

<span data-ttu-id="3c789-110">**Nella tabella seguente vengono illustrate diverse ipotesi e le corrispondenti soluzioni di risoluzione dei nomi:**</span><span class="sxs-lookup"><span data-stu-id="3c789-110">**The following table illustrates scenarios and corresponding name resolution solutions:**</span></span>

| <span data-ttu-id="3c789-111">**Scenario**</span><span class="sxs-lookup"><span data-stu-id="3c789-111">**Scenario**</span></span> | <span data-ttu-id="3c789-112">**Soluzione**</span><span class="sxs-lookup"><span data-stu-id="3c789-112">**Solution**</span></span> | <span data-ttu-id="3c789-113">**Suffisso**</span><span class="sxs-lookup"><span data-stu-id="3c789-113">**Suffix**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="3c789-114">Risoluzione dei nomi tra istanze del ruolo o macchine virtuali situate nello stesso servizio cloud o nella stessa rete virtuale</span><span class="sxs-lookup"><span data-stu-id="3c789-114">Name resolution between role instances or VMs located in the same cloud service or virtual network</span></span> |[<span data-ttu-id="3c789-115">Risoluzione dei nomi fornita da Azure</span><span class="sxs-lookup"><span data-stu-id="3c789-115">Azure-provided name resolution</span></span>](#azure-provided-name-resolution) |<span data-ttu-id="3c789-116">nome host o nome di dominio completo</span><span class="sxs-lookup"><span data-stu-id="3c789-116">hostname or FQDN</span></span> |
| <span data-ttu-id="3c789-117">Risoluzione dei nomi tra istanze del ruolo o macchine virtuali situate in diverse reti virtuali</span><span class="sxs-lookup"><span data-stu-id="3c789-117">Name resolution between role instances or VMs located in different virtual networks</span></span> |<span data-ttu-id="3c789-118">Server DNS gestiti dal cliente che inoltrano query tra reti virtuali per la risoluzione da parte di Azure (proxy DNS).</span><span class="sxs-lookup"><span data-stu-id="3c789-118">Customer-managed DNS servers forwarding queries between vnets for resolution by Azure (DNS proxy).</span></span>  <span data-ttu-id="3c789-119">Vedere [Risoluzione dei nomi usando il server DNS](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="3c789-119">see [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="3c789-120">Solo nome di dominio completo</span><span class="sxs-lookup"><span data-stu-id="3c789-120">FQDN only</span></span> |
| <span data-ttu-id="3c789-121">Risoluzione dei nomi servizi e computer locali da istanze del ruolo o macchine virtuali in Azure</span><span class="sxs-lookup"><span data-stu-id="3c789-121">Resolution of on-premises computer and service names from role instances or VMs in Azure</span></span> |<span data-ttu-id="3c789-122">Server DNS gestiti dal cliente, ad esempio controller di dominio locale, controller di dominio di sola lettura locale o server DNS secondario sincronizzati tramite trasferimenti di zona.</span><span class="sxs-lookup"><span data-stu-id="3c789-122">Customer-managed DNS servers (e.g. on-premises domain controller, local read-only domain controller or a DNS secondary synced using zone transfers).</span></span>  <span data-ttu-id="3c789-123">Vedere [Risoluzione dei nomi usando il server DNS](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="3c789-123">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="3c789-124">Solo nome di dominio completo</span><span class="sxs-lookup"><span data-stu-id="3c789-124">FQDN only</span></span> |
| <span data-ttu-id="3c789-125">Risoluzione di nomi host di Azure da computer locali</span><span class="sxs-lookup"><span data-stu-id="3c789-125">Resolution of Azure hostnames from on-premises computers</span></span> |<span data-ttu-id="3c789-126">Inoltra le query a un server proxy DNS gestito dal cliente nella rete virtuale corrispondente. Il server proxy inoltra le query ad Azure per la risoluzione.</span><span class="sxs-lookup"><span data-stu-id="3c789-126">Forward queries to a customer-managed DNS proxy server in the corresponding vnet, the proxy server forwards queries to Azure for resolution.</span></span> <span data-ttu-id="3c789-127">Vedere [Risoluzione dei nomi usando il server DNS](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="3c789-127">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="3c789-128">Solo nome di dominio completo</span><span class="sxs-lookup"><span data-stu-id="3c789-128">FQDN only</span></span> |
| <span data-ttu-id="3c789-129">DNS inversi per indirizzi IP interni</span><span class="sxs-lookup"><span data-stu-id="3c789-129">Reverse DNS for internal IPs</span></span> |[<span data-ttu-id="3c789-130">Risoluzione dei nomi usando il server DNS</span><span class="sxs-lookup"><span data-stu-id="3c789-130">Name resolution using your own DNS server</span></span>](#name-resolution-using-your-own-dns-server) |<span data-ttu-id="3c789-131">n/d</span><span class="sxs-lookup"><span data-stu-id="3c789-131">n/a</span></span> |
| <span data-ttu-id="3c789-132">Risoluzione dei nomi tra macchine virtuali o istanze del ruolo situate in servizi cloud diversi e non in una rete virtuale</span><span class="sxs-lookup"><span data-stu-id="3c789-132">Name resolution between VMs or role instances located in different cloud services, not in a virtual network</span></span> |<span data-ttu-id="3c789-133">Non applicabile</span><span class="sxs-lookup"><span data-stu-id="3c789-133">Not applicable.</span></span> <span data-ttu-id="3c789-134">Connettività tra macchine virtuali e istanze del ruolo in servizi cloud diversi non è supportata esternamente a una rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="3c789-134">Connectivity between VMs and role instances in different cloud services is not supported outside a virtual network.</span></span> |<span data-ttu-id="3c789-135">n/d</span><span class="sxs-lookup"><span data-stu-id="3c789-135">n/a</span></span> |

## <a name="azure-provided-name-resolution"></a><span data-ttu-id="3c789-136">Risoluzione dei nomi fornita da Azure</span><span class="sxs-lookup"><span data-stu-id="3c789-136">Azure-provided name resolution</span></span>
<span data-ttu-id="3c789-137">Oltre alla risoluzione dei nomi DNS pubblici, Azure offre la risoluzione dei nomi interni per VM e istanze del ruolo che si trovano all'interno della stessa rete virtuale o dello stesso servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="3c789-137">Along with resolution of public DNS names, Azure provides internal name resolution for VMs and role instances that reside within the same virtual network or cloud service.</span></span>  <span data-ttu-id="3c789-138">Le VM e le istanze in un servizio cloud condividono lo stesso suffisso DNS, quindi il nome host da solo è sufficiente, tuttavia, nelle reti virtuali classiche, servizi cloud diversi hanno suffissi DNS diversi, quindi è necessario il nome di dominio completo per la risoluzione dei nomi tra diversi servizi cloud.</span><span class="sxs-lookup"><span data-stu-id="3c789-138">VMs/instances in a cloud service share the same DNS suffix (so the hostname alone is sufficient) but in classic virtual networks different cloud services have different DNS suffixes so the FQDN is needed to resolve names between different cloud services.</span></span>  <span data-ttu-id="3c789-139">Nelle reti virtuali nel modello di distribuzione di Resource Manager il suffisso DNS è coerente nella rete virtuale, quindi il nome di dominio completo non è necessario e i nomi DNS possono essere assegnati sia alle schede di interfaccia di rete che alle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="3c789-139">In virtual networks in the Resource Manager deployment model, the DNS suffix is consistent across the virtual network (so the FQDN is not needed) and DNS names can be assigned to both NICs and VMs.</span></span> <span data-ttu-id="3c789-140">Sebbene la risoluzione dei nomi fornita da Azure non richieda alcuna configurazione, non è la scelta più appropriata per tutti gli scenari di distribuzione, come illustrato nella tabella precedente.</span><span class="sxs-lookup"><span data-stu-id="3c789-140">Although Azure-provided name resolution does not require any configuration, it is not the appropriate choice for all deployment scenarios, as seen on the table above.</span></span>

> [!NOTE]
> <span data-ttu-id="3c789-141">Nel caso dei ruoli web e di lavoro, è possibile accedere anche gli indirizzi IP interni delle istanze del ruolo in base al numero di nome e al numero di istanza del ruolo utilizzando l'API REST di gestione dei servizi Azure.</span><span class="sxs-lookup"><span data-stu-id="3c789-141">In the case of web and worker roles, you can also access the internal IP addresses of role instances based on the role name and instance number using the Azure Service Management REST API.</span></span> <span data-ttu-id="3c789-142">Per altre informazioni, vedere [Riferimento all'API REST di gestione dei servizi](https://msdn.microsoft.com/library/azure/ee460799.aspx).</span><span class="sxs-lookup"><span data-stu-id="3c789-142">For more information, see [Service Management REST API Reference](https://msdn.microsoft.com/library/azure/ee460799.aspx).</span></span>
> 
> 

### <a name="features-and-considerations"></a><span data-ttu-id="3c789-143">Funzionalità e considerazioni</span><span class="sxs-lookup"><span data-stu-id="3c789-143">Features and Considerations</span></span>
<span data-ttu-id="3c789-144">**Funzionalità**</span><span class="sxs-lookup"><span data-stu-id="3c789-144">**Features:**</span></span>

* <span data-ttu-id="3c789-145">Facilità di utilizzo: non è necessaria alcuna configurazione per usare la risoluzione dei nomi fornita da Azure.</span><span class="sxs-lookup"><span data-stu-id="3c789-145">Ease of use: No configuration is required in order to use Azure-provided name resolution.</span></span>
* <span data-ttu-id="3c789-146">Il servizio di risoluzione dei nomi fornito da Azure garantisce la disponibilità elevata ed evita così di dover creare e gestire i cluster dei propri server DNS.</span><span class="sxs-lookup"><span data-stu-id="3c789-146">The Azure-provided name resolution service is highly available, saving you the need to create and manage clusters of your own DNS servers.</span></span>
* <span data-ttu-id="3c789-147">Può essere usato in combinazione con i propri server DNS per risolvere i nomi host locali e i nomi host di Azure.</span><span class="sxs-lookup"><span data-stu-id="3c789-147">Can be used in conjunction with your own DNS servers to resolve both on-premises and Azure hostnames.</span></span>
* <span data-ttu-id="3c789-148">La risoluzione dei nomi viene offerta tra istanze del ruolo e VM presenti nello stesso servizio cloud senza necessità di un nome di dominio completo.</span><span class="sxs-lookup"><span data-stu-id="3c789-148">Name resolution is provided between role instances/VMs within the same cloud service without need for a FQDN.</span></span>
* <span data-ttu-id="3c789-149">Viene fornita la risoluzione dei nomi tra VM in reti virtuali che usano il modello di distribuzione di Resource Manager, senza necessità del nome di dominio completo.</span><span class="sxs-lookup"><span data-stu-id="3c789-149">Name resolution is provided between VMs in virtual networks that use the Resource Manager deployment model, without need for the FQDN.</span></span> <span data-ttu-id="3c789-150">Le reti virtuali nel modello di distribuzione classica richiedono il nome di dominio completo per la risoluzione dei nomi in diversi servizi cloud.</span><span class="sxs-lookup"><span data-stu-id="3c789-150">Virtual networks in the classic deployment model require the FQDN when resolving names in different cloud services.</span></span> 
* <span data-ttu-id="3c789-151">È possibile usare nomi host personalizzati in grado di descrivere in modo più adeguato le distribuzioni, anziché usare nomi generati automaticamente.</span><span class="sxs-lookup"><span data-stu-id="3c789-151">You can use hostnames that best describe your deployments, rather than working with auto-generated names.</span></span>

<span data-ttu-id="3c789-152">**Considerazioni:**</span><span class="sxs-lookup"><span data-stu-id="3c789-152">**Considerations:**</span></span>

* <span data-ttu-id="3c789-153">Il suffisso DNS creato da Azure non può essere modificato.</span><span class="sxs-lookup"><span data-stu-id="3c789-153">The Azure-created DNS suffix cannot be modified.</span></span>
* <span data-ttu-id="3c789-154">Non è possibile registrare manualmente i propri record.</span><span class="sxs-lookup"><span data-stu-id="3c789-154">You cannot manually register your own records.</span></span>
* <span data-ttu-id="3c789-155">WINS e NetBIOS non sono supportati.</span><span class="sxs-lookup"><span data-stu-id="3c789-155">WINS and NetBIOS are not supported.</span></span> <span data-ttu-id="3c789-156">Non è possibile visualizzare le macchine virtuali in Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="3c789-156">(You cannot see your VMs in Windows Explorer.)</span></span>
* <span data-ttu-id="3c789-157">I nomi host devono essere compatibili con DNS (devono utilizzare solo 0-9, a-z e '-' e non possono iniziare o terminare con un '-'.</span><span class="sxs-lookup"><span data-stu-id="3c789-157">Hostnames must be DNS-compatible (They must use only 0-9, a-z and '-', and cannot start or end with a '-'.</span></span> <span data-ttu-id="3c789-158">Vedere RFC 3696 sezione 2).</span><span class="sxs-lookup"><span data-stu-id="3c789-158">See RFC 3696 section 2.)</span></span>
* <span data-ttu-id="3c789-159">Il traffico di query DNS è limitato per ogni VM.</span><span class="sxs-lookup"><span data-stu-id="3c789-159">DNS query traffic is throttled for each VM.</span></span> <span data-ttu-id="3c789-160">Questo in genere non comporta alcun impatto sulla maggior parte delle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="3c789-160">This shouldn't impact most applications.</span></span>  <span data-ttu-id="3c789-161">Se viene osservata la limitazione delle richieste, assicurarsi che la memorizzazione nella cache sul lato client sia abilitata.</span><span class="sxs-lookup"><span data-stu-id="3c789-161">If request throttling is observed, ensure that client-side caching is enabled.</span></span>  <span data-ttu-id="3c789-162">Per altre informazioni, vedere l'articolo che illustra [come usare al meglio la risoluzione dei nomi fornita da Azure](#Getting-the-most-from-Azure-provided-name-resolution).</span><span class="sxs-lookup"><span data-stu-id="3c789-162">For more details, see [Getting the most from Azure-provided name resolution](#Getting-the-most-from-Azure-provided-name-resolution).</span></span>
* <span data-ttu-id="3c789-163">Solo le VM nei primi 180 servizi cloud sono registrate per ogni rete virtuale in un modello di distribuzione classica.</span><span class="sxs-lookup"><span data-stu-id="3c789-163">Only VMs in the first 180 cloud services are registered for each virtual network in a classic deployment model.</span></span> <span data-ttu-id="3c789-164">Ciò non si applica alle reti virtuali nei modelli di distribuzione di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="3c789-164">This does not apply to virtual networks in Resource Manager deployment models.</span></span>

### <a name="getting-the-most-from-azure-provided-name-resolution"></a><span data-ttu-id="3c789-165">come usare al meglio la risoluzione dei nomi fornita da Azure</span><span class="sxs-lookup"><span data-stu-id="3c789-165">Getting the most from Azure-provided name resolution</span></span>
<span data-ttu-id="3c789-166">**Memorizzazione nella cache sul lato client:**</span><span class="sxs-lookup"><span data-stu-id="3c789-166">**Client-side Caching:**</span></span>

<span data-ttu-id="3c789-167">Non tutte le query DNS devono essere inviate attraverso la rete.</span><span class="sxs-lookup"><span data-stu-id="3c789-167">Not every DNS query needs to be sent across the network.</span></span>  <span data-ttu-id="3c789-168">La memorizzazione nella cache sul lato client consente di ridurre la latenza e migliorare la resilienza ai blip (brevi interruzioni) di rete, tramite la risoluzione di query DNS ricorrenti da una cache locale.</span><span class="sxs-lookup"><span data-stu-id="3c789-168">Client-side caching helps reduce latency and improve resilience to network blips by resolving recurring DNS queries from a local cache.</span></span>  <span data-ttu-id="3c789-169">I record DNS contengono una durata (TTL) che consente alla cache di memorizzare il record per il periodo di tempo più lungo possibile senza che questo influisca sullo stato di aggiornamento del record. Per questo motivo, la memorizzazione nella cache sul lato client è ideale per la maggior parte delle situazioni.</span><span class="sxs-lookup"><span data-stu-id="3c789-169">DNS records contain a Time-To-Live (TTL) which allows the cache to store the record for as long as possible without impacting record freshness, so client-side caching is suitable for most situations.</span></span>

<span data-ttu-id="3c789-170">Il client DNS di Windows predefinito contiene una cache DNS incorporata.</span><span class="sxs-lookup"><span data-stu-id="3c789-170">The default Windows DNS Client has a DNS cache built-in.</span></span>  <span data-ttu-id="3c789-171">Alcune distribuzioni di Linux non includono la memorizzazione nella cache per impostazione predefinita, è quindi consigliabile aggiungerne una a ogni VM Linux (dopo aver verificato che non sia già presente una cache locale).</span><span class="sxs-lookup"><span data-stu-id="3c789-171">Some Linux distros do not include caching by default, it is recommended that one be added to each Linux VM (after checking that there isn't a local cache already).</span></span>

<span data-ttu-id="3c789-172">Sono disponibili molti pacchetti di memorizzazione nella cache DNS diversi, ad esempio dnsmasq. Di seguito è riportata la procedura per installare dnsmasq nei distro più comuni:</span><span class="sxs-lookup"><span data-stu-id="3c789-172">There are a number of different DNS caching packages available, e.g. dnsmasq, here are the steps to install dnsmasq on the most common distros:</span></span>

* <span data-ttu-id="3c789-173">**Ubuntu (usa resolvconf)**:</span><span class="sxs-lookup"><span data-stu-id="3c789-173">**Ubuntu (uses resolvconf)**:</span></span>
  * <span data-ttu-id="3c789-174">installare il pacchetto dnsmasq ("sudo apt-get install dnsmasq").</span><span class="sxs-lookup"><span data-stu-id="3c789-174">just install the dnsmasq package (“sudo apt-get install dnsmasq”).</span></span>
* <span data-ttu-id="3c789-175">**SUSE (usa netconf)**:</span><span class="sxs-lookup"><span data-stu-id="3c789-175">**SUSE (uses netconf)**:</span></span>
  * <span data-ttu-id="3c789-176">installare il pacchetto dnsmasq ("sudo zypper install dnsmasq")</span><span class="sxs-lookup"><span data-stu-id="3c789-176">install the dnsmasq package (“sudo zypper install dnsmasq”)</span></span> 
  * <span data-ttu-id="3c789-177">abilitare il servizio dnsmasq ("systemctl enable dnsmasq.service")</span><span class="sxs-lookup"><span data-stu-id="3c789-177">enable the dnsmasq service (“systemctl enable dnsmasq.service”)</span></span> 
  * <span data-ttu-id="3c789-178">avviare il servizio dnsmasq ("systemctl start dnsmasq.service")</span><span class="sxs-lookup"><span data-stu-id="3c789-178">start the dnsmasq service (“systemctl start dnsmasq.service”)</span></span> 
  * <span data-ttu-id="3c789-179">modificare "/etc/sysconfig/network/config" e sostituire NETCONFIG_DNS_FORWARDER="" con "dnsmasq"</span><span class="sxs-lookup"><span data-stu-id="3c789-179">edit “/etc/sysconfig/network/config” and change NETCONFIG_DNS_FORWARDER="" to ”dnsmasq”</span></span>
  * <span data-ttu-id="3c789-180">aggiornare resolv.conf ("netconfig update") per impostare la cache come resolver DNS locale</span><span class="sxs-lookup"><span data-stu-id="3c789-180">update resolv.conf ("netconfig update") to set the cache as the local DNS resolver</span></span>
* <span data-ttu-id="3c789-181">**OpenLogic (usa NetworkManager)**:</span><span class="sxs-lookup"><span data-stu-id="3c789-181">**OpenLogic (uses NetworkManager)**:</span></span>
  * <span data-ttu-id="3c789-182">installare il pacchetto dnsmasq ("sudo yum install dnsmasq")</span><span class="sxs-lookup"><span data-stu-id="3c789-182">install the dnsmasq package (“sudo yum install dnsmasq”)</span></span>
  * <span data-ttu-id="3c789-183">abilitare il servizio dnsmasq ("systemctl enable dnsmasq.service")</span><span class="sxs-lookup"><span data-stu-id="3c789-183">enable the dnsmasq service (“systemctl enable dnsmasq.service”)</span></span>
  * <span data-ttu-id="3c789-184">avviare il servizio dnsmasq ("systemctl start dnsmasq.service")</span><span class="sxs-lookup"><span data-stu-id="3c789-184">start the dnsmasq service (“systemctl start dnsmasq.service”)</span></span>
  * <span data-ttu-id="3c789-185">aggiungere "prepend domain-name-servers 127.0.0.1;" in "/etc/dhclient-eth0.conf"</span><span class="sxs-lookup"><span data-stu-id="3c789-185">add “prepend domain-name-servers 127.0.0.1;” to “/etc/dhclient-eth0.conf”</span></span>
  * <span data-ttu-id="3c789-186">riavviare il servizio di rete ("service network restart") per impostare la cache come resolver DNS locale</span><span class="sxs-lookup"><span data-stu-id="3c789-186">restart the network service (“service network restart”) to set the cache as the local DNS resolver</span></span>

> [!NOTE]
> <span data-ttu-id="3c789-187">Il pacchetto 'dnsmasq' è solo una delle cache DNS disponibili per Linux.</span><span class="sxs-lookup"><span data-stu-id="3c789-187">The 'dnsmasq' package is only one of the many DNS caches available for Linux.</span></span>  <span data-ttu-id="3c789-188">Prima di usarla, verificare che sia adatta in base alle esigenze specifiche e assicurarsi che non siano installate altre cache.</span><span class="sxs-lookup"><span data-stu-id="3c789-188">Before using it, please check its suitability for your particular needs and that no other cache is installed.</span></span>
> 
> 

<span data-ttu-id="3c789-189">**Ripetizione di tentativi sul lato client:**</span><span class="sxs-lookup"><span data-stu-id="3c789-189">**Client-side Retries:**</span></span>

<span data-ttu-id="3c789-190">DNS è principalmente un protocollo UDP.</span><span class="sxs-lookup"><span data-stu-id="3c789-190">DNS is primarily a UDP protocol.</span></span>  <span data-ttu-id="3c789-191">Poiché il protocollo UDP non garantisce il recapito dei messaggi, la logica di ripetizione dei tentativi viene gestita nel protocollo DNS stesso.</span><span class="sxs-lookup"><span data-stu-id="3c789-191">As the UDP protocol doesn't guarantee message delivery, retry logic is handled in the DNS protocol itself.</span></span>  <span data-ttu-id="3c789-192">Ogni client DNS (sistema operativo) può includere una logica di ripetizione dei tentativi diversa, in base alle preferenze degli autori.</span><span class="sxs-lookup"><span data-stu-id="3c789-192">Each DNS client (operating system) can exhibit different retry logic depending on the creators preference:</span></span>

* <span data-ttu-id="3c789-193">I sistemi operativi Windows eseguono un nuovo tentativo dopo 1 secondo e ne eseguono un altro dopo 2, 4 e altri 4 secondi.</span><span class="sxs-lookup"><span data-stu-id="3c789-193">Windows operating systems retry after 1 second and then again after another 2, 4 and another 4 seconds.</span></span> 
* <span data-ttu-id="3c789-194">La configurazione di Linux predefinita esegue il tentativo dopo 5 secondi.</span><span class="sxs-lookup"><span data-stu-id="3c789-194">The default Linux setup retries after 5 seconds.</span></span>  <span data-ttu-id="3c789-195">È consigliabile modificare questa impostazione in modo da eseguire 5 tentativi a intervalli di 1 secondo.</span><span class="sxs-lookup"><span data-stu-id="3c789-195">It is recommended to change this to retry 5 times at 1 second intervals.</span></span>  

<span data-ttu-id="3c789-196">Per verificare le impostazioni correnti in una macchina virtuale Linux, aprire il file 'cat /etc/resolv.conf' e osservare la riga 'options', ad esempio:</span><span class="sxs-lookup"><span data-stu-id="3c789-196">To check the current settings on a Linux VM, 'cat /etc/resolv.conf' and look at the 'options' line, e.g.:</span></span>

    options timeout:1 attempts:5

<span data-ttu-id="3c789-197">Il file resolv.conf è solitamente generato automaticamente e non deve essere modificato.</span><span class="sxs-lookup"><span data-stu-id="3c789-197">The resolv.conf file is usually auto-generated and should not be edited.</span></span>  <span data-ttu-id="3c789-198">La procedura specifica per aggiungere la riga 'options' varia a seconda del distro:</span><span class="sxs-lookup"><span data-stu-id="3c789-198">The specific steps for adding the 'options' line vary by distro:</span></span>

* <span data-ttu-id="3c789-199">**Ubuntu** (usa resolvconf):</span><span class="sxs-lookup"><span data-stu-id="3c789-199">**Ubuntu** (uses resolvconf):</span></span>
  * <span data-ttu-id="3c789-200">aggiungere la riga per le opzioni in '/etc/resolveconf/resolv.conf.d/head'</span><span class="sxs-lookup"><span data-stu-id="3c789-200">add the options line to '/etc/resolveconf/resolv.conf.d/head'</span></span> 
  * <span data-ttu-id="3c789-201">eseguire 'resolvconf -u' per aggiornare</span><span class="sxs-lookup"><span data-stu-id="3c789-201">run 'resolvconf -u' to update</span></span>
* <span data-ttu-id="3c789-202">**SUSE** (usa netconf):</span><span class="sxs-lookup"><span data-stu-id="3c789-202">**SUSE** (uses netconf):</span></span>
  * <span data-ttu-id="3c789-203">aggiungere 'timeout:1 attempts:5' al parametro NETCONFIG_DNS_RESOLVER_OPTIONS="" in '/etc/sysconfig/network/config'</span><span class="sxs-lookup"><span data-stu-id="3c789-203">add 'timeout:1 attempts:5' to the NETCONFIG_DNS_RESOLVER_OPTIONS="" parameter in '/etc/sysconfig/network/config'</span></span> 
  * <span data-ttu-id="3c789-204">eseguire 'netconfig update' per aggiornare</span><span class="sxs-lookup"><span data-stu-id="3c789-204">run 'netconfig update' to update</span></span>
* <span data-ttu-id="3c789-205">**OpenLogic** (usa NetworkManager):</span><span class="sxs-lookup"><span data-stu-id="3c789-205">**OpenLogic** (uses NetworkManager):</span></span>
  * <span data-ttu-id="3c789-206">aggiungere 'echo "options timeout:1 attempts:5"' in '/etc/NetworkManager/dispatcher.d/11-dhclient'</span><span class="sxs-lookup"><span data-stu-id="3c789-206">add 'echo "options timeout:1 attempts:5"' to '/etc/NetworkManager/dispatcher.d/11-dhclient'</span></span> 
  * <span data-ttu-id="3c789-207">eseguire 'service network restart' per aggiornare</span><span class="sxs-lookup"><span data-stu-id="3c789-207">run 'service network restart' to update</span></span>

## <a name="name-resolution-using-your-own-dns-server"></a><span data-ttu-id="3c789-208">Risoluzione dei nomi usando il server DNS</span><span class="sxs-lookup"><span data-stu-id="3c789-208">Name resolution using your own DNS server</span></span>
<span data-ttu-id="3c789-209">In alcune situazioni le esigenze in termini di risoluzione dei nomi potrebbero andare oltre le funzionalità fornite da Azure, ad esempio quando si usano i domini di Active Directory o quando è necessaria la risoluzione DNS tra reti virtuali.</span><span class="sxs-lookup"><span data-stu-id="3c789-209">There are a number of situations where your name resolution needs may go beyond the features provided by Azure, for example when using Active Directory domains or when you require DNS resolution between virtual networks (vnets).</span></span>  <span data-ttu-id="3c789-210">Per questi scenari specifici, Azure offre la possibilità di usare i propri server DNS.</span><span class="sxs-lookup"><span data-stu-id="3c789-210">To cover these scenarios, Azure provides the ability for you to use your own DNS servers.</span></span>  

<span data-ttu-id="3c789-211">I server DNS all'interno di una rete virtuale possono inoltrare query DNS ai resolver ricorsivi di Azure per risolvere i nomi host all'interno di quella rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="3c789-211">DNS servers within a virtual network can forward DNS queries to Azure's recursive resolvers to resolve hostnames within that virtual network.</span></span>  <span data-ttu-id="3c789-212">Ad esempio, un controller di dominio in esecuzione in Azure può rispondere a query DNS per i relativi domini e inoltrare tutte le altre query ad Azure.</span><span class="sxs-lookup"><span data-stu-id="3c789-212">For example, a Domain Controller (DC) running in Azure can respond to DNS queries for its domains and forward all other queries to Azure.</span></span>  <span data-ttu-id="3c789-213">Questo consente alle macchine virtuali di visualizzare sia le risorse locali, tramite il controller di dominio, sia i nomi host forniti da Azure, tramite il server di inoltro.</span><span class="sxs-lookup"><span data-stu-id="3c789-213">This allows VMs to see both your on-premises resources (via the DC) and Azure-provided hostnames (via the forwarder).</span></span>  <span data-ttu-id="3c789-214">L'accesso ai resolver ricorsivi di Azure viene fornito tramite l'indirizzo IP virtuale 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="3c789-214">Access to Azure's recursive resolvers is provided via the virtual IP 168.63.129.16.</span></span>

<span data-ttu-id="3c789-215">L'inoltro DNS consente anche la risoluzione DNS tra reti virtuali e permette alle macchine virtuali locali di risolvere i nomi host forniti da Azure.</span><span class="sxs-lookup"><span data-stu-id="3c789-215">DNS forwarding also enables inter-vnet DNS resolution and allows your on-premises machines to resolve Azure-provided hostnames.</span></span>  <span data-ttu-id="3c789-216">Per risolvere il nome host di una macchina virtuale, la macchina virtuale del server DNS deve risiedere nella stessa rete virtuale ed essere configurata per inoltrare le query relative ai nomi host ad Azure.</span><span class="sxs-lookup"><span data-stu-id="3c789-216">In order to resolve a VM's hostname, the DNS server VM must reside in the same virtual network and be configured to forward hostname queries to Azure.</span></span>  <span data-ttu-id="3c789-217">Poiché il suffisso DNS è diverso in ogni rete virtuale, è possibile usare le regole di inoltro condizionale per inviare le query DNS alla rete virtuale corretta per la risoluzione.</span><span class="sxs-lookup"><span data-stu-id="3c789-217">As the DNS suffix is different in each vnet, you can use conditional forwarding rules to send DNS queries to the correct vnet for resolution.</span></span>  <span data-ttu-id="3c789-218">L'immagine seguente mostra due reti virtuali e una rete locale che gestiscono la risoluzione DNS tra reti virtuali con questo metodo.</span><span class="sxs-lookup"><span data-stu-id="3c789-218">The following image shows two vnets and an on-premises network doing inter-vnet DNS resolution using this method.</span></span>  <span data-ttu-id="3c789-219">Un esempio di server di inoltro DNS è disponibile nella [raccolta di modelli di avvio rapido di Azure](https://azure.microsoft.com/documentation/templates/301-dns-forwarder/) e su [GitHub](https://github.com/Azure/azure-quickstart-templates/tree/master/301-dns-forwarder).</span><span class="sxs-lookup"><span data-stu-id="3c789-219">An example DNS forwarder is available in the [Azure Quickstart Templates gallery](https://azure.microsoft.com/documentation/templates/301-dns-forwarder/) and [GitHub](https://github.com/Azure/azure-quickstart-templates/tree/master/301-dns-forwarder).</span></span>

![DNS tra reti virtuali](./media/virtual-networks-name-resolution-for-vms-and-role-instances/inter-vnet-dns.png)

<span data-ttu-id="3c789-221">Quando si usa la risoluzione dei nomi di Azure, un suffisso DNS interno (*.internal.cloudapp.net) viene fornito a ogni macchina virtuale tramite DHCP.</span><span class="sxs-lookup"><span data-stu-id="3c789-221">When using Azure-provided name resolution, an Internal DNS suffix (*.internal.cloudapp.net) is provided to each VM using DHCP.</span></span>  <span data-ttu-id="3c789-222">Ciò consente la risoluzione dei nomi host, perché i record relativi ai nomi host si trovano nell'area internal.cloudapp.net.</span><span class="sxs-lookup"><span data-stu-id="3c789-222">This enables hostname resolution as the hostname records are in the internal.cloudapp.net zone.</span></span>  <span data-ttu-id="3c789-223">Quando si usa la soluzione di risoluzione dei nomi personalizzata, il suffisso IDNS non viene fornito alle macchine virtuali perché interferisce con altre architetture DNS, ad esempio gli scenari con aggiunta al dominio.</span><span class="sxs-lookup"><span data-stu-id="3c789-223">When using your own name resolution solution, the IDNS suffix is not supplied to VMs because it interferes with other DNS architectures (like domain-joined scenarios).</span></span>  <span data-ttu-id="3c789-224">Viene invece fornito un segnaposto non funzionante (reddog.microsoft.com).</span><span class="sxs-lookup"><span data-stu-id="3c789-224">Instead we provide a non-functioning placeholder (reddog.microsoft.com).</span></span>  

<span data-ttu-id="3c789-225">Se necessario, è possibile determinare il suffisso DNS interno usando PowerShell o l'API:</span><span class="sxs-lookup"><span data-stu-id="3c789-225">If needed, the Internal DNS suffix can be determined using PowerShell or the API:</span></span>

* <span data-ttu-id="3c789-226">Per le reti virtuali nei modelli di distribuzione Azure Resource Manager, il suffisso è disponibile tramite la risorsa [scheda di interfaccia di rete](https://msdn.microsoft.com/library/azure/mt163668.aspx) o il cmdlet [Get-AzureRmNetworkInterface](https://msdn.microsoft.com/library/mt619434.aspx).</span><span class="sxs-lookup"><span data-stu-id="3c789-226">For virtual networks in Resource Manager deployment models, the suffix is available via the [network interface card](https://msdn.microsoft.com/library/azure/mt163668.aspx) resource or via the [Get-AzureRmNetworkInterface](https://msdn.microsoft.com/library/mt619434.aspx) cmdlet.</span></span>    
* <span data-ttu-id="3c789-227">Nei modelli di distribuzione classica il suffisso è disponibile tramite una chiamata all'[API GetDeployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) o il cmdlet [Get-AzureVM -Debug](https://msdn.microsoft.com/library/azure/dn495236.aspx).</span><span class="sxs-lookup"><span data-stu-id="3c789-227">In classic deployment models, the suffix is available via the [Get Deployment API](https://msdn.microsoft.com/library/azure/ee460804.aspx) call or via the [Get-AzureVM -Debug](https://msdn.microsoft.com/library/azure/dn495236.aspx) cmdlet.</span></span>

<span data-ttu-id="3c789-228">Se l'inoltro delle query ad Azure non soddisfa le esigenze correnti, sarà necessario fornire una soluzione DNS personalizzata.</span><span class="sxs-lookup"><span data-stu-id="3c789-228">If forwarding queries to Azure doesn't suit your needs, you will need to provide your own DNS solution.</span></span>  <span data-ttu-id="3c789-229">Questa soluzione DNS dovrà:</span><span class="sxs-lookup"><span data-stu-id="3c789-229">Your DNS solution will need to:</span></span>

* <span data-ttu-id="3c789-230">Fornire una soluzione di risoluzione dei nomi host appropriata, ad esempio tramite [DNS dinamico](virtual-networks-name-resolution-ddns.md).</span><span class="sxs-lookup"><span data-stu-id="3c789-230">Provide appropriate hostname resolution, e.g. via [DDNS](virtual-networks-name-resolution-ddns.md).</span></span>  <span data-ttu-id="3c789-231">Si noti che se si usa il DNS dinamico potrebbe essere necessario disabilitare lo scavenging del record DNS, perché i lease DHCP di Azure sono molto lunghi e potrebbero rimuovere i record DNS anticipatamente.</span><span class="sxs-lookup"><span data-stu-id="3c789-231">Note, if using DDNS you may need to disable DNS record scavenging as Azure's DHCP leases are very long and scavenging may remove DNS records prematurely.</span></span> 
* <span data-ttu-id="3c789-232">Fornire una soluzione di risoluzione ricorsiva appropriata per consentire la risoluzione dei nomi di dominio esterni.</span><span class="sxs-lookup"><span data-stu-id="3c789-232">Provide appropriate recursive resolution to allow resolution of external domain names.</span></span>
* <span data-ttu-id="3c789-233">Essere accessibile (tramite TCP e UDP sulla porta 53) dai client che gestisce e in grado di accedere a Internet.</span><span class="sxs-lookup"><span data-stu-id="3c789-233">Be accessible (TCP and UDP on port 53) from the clients it serves and be able to access the internet.</span></span>
* <span data-ttu-id="3c789-234">Essere protetta dagli accessi provenienti da Internet per attenuare i rischi rappresentati da agenti esterni.</span><span class="sxs-lookup"><span data-stu-id="3c789-234">Be secured against access from the internet, to mitigate threats posed by external agents.</span></span>

> [!NOTE]
> <span data-ttu-id="3c789-235">Per prestazioni ottimali, quando si usano macchine virtuali di Azure come server DNS, è necessario disabilitare IPv6 e assegnare un indirizzo [IP pubblico a livello di istanza](virtual-networks-instance-level-public-ip.md) a ogni macchina virtuale del server DNS.</span><span class="sxs-lookup"><span data-stu-id="3c789-235">For best performance, when using Azure VMs as DNS servers, IPv6 should be disabled and an [Instance-Level Public IP](virtual-networks-instance-level-public-ip.md) should be assigned to each DNS server VM.</span></span>  <span data-ttu-id="3c789-236">Se si sceglie di usare Windows Server come server DNS, [questo articolo](http://blogs.technet.com/b/networking/archive/2015/08/19/name-resolution-performance-of-a-recursive-windows-dns-server-2012-r2.aspx) offre un'analisi delle prestazioni e ottimizzazioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="3c789-236">If you choose to use Windows Server as your DNS server, [this article](http://blogs.technet.com/b/networking/archive/2015/08/19/name-resolution-performance-of-a-recursive-windows-dns-server-2012-r2.aspx) provides additional performance analysis and optimizations.</span></span>
> 
> 

### <a name="specifying-dns-servers"></a><span data-ttu-id="3c789-237">Specificare i server DNS</span><span class="sxs-lookup"><span data-stu-id="3c789-237">Specifying DNS servers</span></span>
<span data-ttu-id="3c789-238">Quando si usano i propri server DNS, Azure offre la possibilità di specificare più server DNS per ogni rete virtuale o per ogni interfaccia di rete (Resource Manager)/servizio cloud (classico).</span><span class="sxs-lookup"><span data-stu-id="3c789-238">When using your own DNS servers, Azure provides the ability to specify multiple DNS servers per virtual network or per network interface (Resource Manager) / cloud service (classic).</span></span>  <span data-ttu-id="3c789-239">I server DNS specificati per un'interfaccia di rete o un servizio cloud ottengono la precedenza su quelli specificati per la rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="3c789-239">DNS servers specified for a cloud service/network interface get precedence over those specified for the virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="3c789-240">Le proprietà di connessione di rete, ad esempio gli indirizzi IP del server DNS, non devono essere modificate direttamente all'interno delle VM di Windows in quanto possono essere cancellate durante il servizio di correzione quando la scheda di rete virtuale viene sostituita.</span><span class="sxs-lookup"><span data-stu-id="3c789-240">Network connection properties, such as DNS server IPs, should not be edited directly within Windows VMs as they may get erased during service heal when the virtual network adaptor gets replaced.</span></span> 
> 
> 

<span data-ttu-id="3c789-241">Quando si usa il modello di distribuzione Azure Resource Manager, i server DNS possono essere specificati nel portale, nelle API, nei modelli ([vnet](https://msdn.microsoft.com/library/azure/mt163661.aspx), [nic](https://msdn.microsoft.com/library/azure/mt163668.aspx)) o in PowerShell ([vnet](https://msdn.microsoft.com/library/mt603657.aspx), [nic](https://msdn.microsoft.com/library/mt619370.aspx)).</span><span class="sxs-lookup"><span data-stu-id="3c789-241">When using the Resource Manager deployment model, DNS servers can be specified in the Portal, API/Templates ([vnet](https://msdn.microsoft.com/library/azure/mt163661.aspx), [nic](https://msdn.microsoft.com/library/azure/mt163668.aspx)) or PowerShell ([vnet](https://msdn.microsoft.com/library/mt603657.aspx), [nic](https://msdn.microsoft.com/library/mt619370.aspx)).</span></span>

<span data-ttu-id="3c789-242">Quando si usa il modello di distribuzione classica, i server DNS possono essere specificati per la rete virtuale nel portale o [ nel file di *configurazione di rete*](https://msdn.microsoft.com/library/azure/jj157100).</span><span class="sxs-lookup"><span data-stu-id="3c789-242">When using the classic deployment model, DNS servers for the virtual network can be specified in the Portal or [the *Network Configuration* file](https://msdn.microsoft.com/library/azure/jj157100).</span></span>  <span data-ttu-id="3c789-243">Per i servizi cloud, i server DNS vengono specificati tramite [il file di *configurazione del servizio*](https://msdn.microsoft.com/library/azure/ee758710) o in PowerShell ([New-AzureVM](https://msdn.microsoft.com/library/azure/dn495254.aspx)).</span><span class="sxs-lookup"><span data-stu-id="3c789-243">For cloud services, the DNS servers are specified via [the *Service Configuration* file](https://msdn.microsoft.com/library/azure/ee758710) or in PowerShell ([New-AzureVM](https://msdn.microsoft.com/library/azure/dn495254.aspx)).</span></span>

> [!NOTE]
> <span data-ttu-id="3c789-244">Se si modificano le impostazioni DNS per una rete virtuale o una macchina virtuale che è già stata distribuita, è necessario riavviare ogni VM interessata affinché le modifiche vengano applicate.</span><span class="sxs-lookup"><span data-stu-id="3c789-244">If you change the DNS settings for a virtual network/virtual machine that is already deployed, you need to restart each affected VM for the changes to take effect.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="3c789-245">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="3c789-245">Next steps</span></span>
<span data-ttu-id="3c789-246">Modello di distribuzione di Resource Manager:</span><span class="sxs-lookup"><span data-stu-id="3c789-246">Resource Manager deployment model:</span></span>

* [<span data-ttu-id="3c789-247">Creare o aggiornare una rete virtuale</span><span class="sxs-lookup"><span data-stu-id="3c789-247">Create or update a virtual network</span></span>](https://msdn.microsoft.com/library/azure/mt163661.aspx)
* [<span data-ttu-id="3c789-248">Creare o aggiornare una scheda dell'interfaccia di rete</span><span class="sxs-lookup"><span data-stu-id="3c789-248">Create or update a network interface card</span></span>](https://msdn.microsoft.com/library/azure/mt163668.aspx)
* [<span data-ttu-id="3c789-249">New-AzureRmVirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="3c789-249">New-AzureRmVirtualNetwork</span></span>](https://msdn.microsoft.com/library/mt603657.aspx)
* [<span data-ttu-id="3c789-250">New-AzureRmNetworkInterface</span><span class="sxs-lookup"><span data-stu-id="3c789-250">New-AzureRmNetworkInterface</span></span>](https://msdn.microsoft.com/library/mt619370.aspx)

<span data-ttu-id="3c789-251">Modello di distribuzione classica:</span><span class="sxs-lookup"><span data-stu-id="3c789-251">Classic deployment model:</span></span>

* [<span data-ttu-id="3c789-252">Schema di configurazione dei servizi di Azure</span><span class="sxs-lookup"><span data-stu-id="3c789-252">Azure Service Configuration Schema</span></span>](https://msdn.microsoft.com/library/azure/ee758710)
* [<span data-ttu-id="3c789-253">Schema di configurazione di Rete virtuale</span><span class="sxs-lookup"><span data-stu-id="3c789-253">Virtual Network Configuration Schema</span></span>](https://msdn.microsoft.com/library/azure/jj157100)
* [<span data-ttu-id="3c789-254">Configurare una rete virtuale usando un file di configurazione di rete</span><span class="sxs-lookup"><span data-stu-id="3c789-254">Configure a Virtual Network by Using a Network Configuration File</span></span>](virtual-networks-using-network-configuration-file.md) 

