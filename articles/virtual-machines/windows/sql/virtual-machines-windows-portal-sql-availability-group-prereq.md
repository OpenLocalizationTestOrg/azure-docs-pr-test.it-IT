---
title: "Gruppi di disponibilità di SQL Server - Macchine virtuali di Azure - Prerequisiti | Microsoft Docs"
description: "Questa esercitazione illustra come configurare i prerequisiti per la creazione di un gruppo di disponibilità AlwaysOn di SQL Server nelle VM di Azure."
services: virtual-machines
documentationCenter: na
authors: MikeRayMSFT
manager: jhubbard
editor: monicar
tags: azure-service-management
ms.assetid: c492db4c-3faa-4645-849f-5a1a663be55a
ms.service: virtual-machines-sql
ms.devlang: na
ms.custom: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/09/2017
ms.author: mikeray
ms.openlocfilehash: 3d508877928e033f24dae62c1042745ea7250033
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/29/2017
---
# <a name="complete-the-prerequisites-for-creating-always-on-availability-groups-on-azure-virtual-machines"></a><span data-ttu-id="97f79-103">Completare i prerequisiti per la creazione di gruppi di disponibilità AlwaysOn in Macchine virtuali di Azure</span><span class="sxs-lookup"><span data-stu-id="97f79-103">Complete the prerequisites for creating Always On availability groups on Azure virtual machines</span></span>

<span data-ttu-id="97f79-104">Questa esercitazione illustra come completare i prerequisiti per la creazione di un [gruppo di disponibilità AlwaysOn di SQL Server in Macchine virtuali di Azure](virtual-machines-windows-portal-sql-availability-group-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="97f79-104">This tutorial shows how to complete the prerequisites for creating a [SQL Server Always On availability group on Azure virtual machines (VMs)](virtual-machines-windows-portal-sql-availability-group-tutorial.md).</span></span> <span data-ttu-id="97f79-105">Dopo il completamento dei prerequisiti, sono presenti un controller di dominio, due VM di SQL Server e un server di controllo in un unico gruppo di risorse.</span><span class="sxs-lookup"><span data-stu-id="97f79-105">When you've finished the prerequisites, you have a domain controller, two SQL Server VMs, and a witness server in a single resource group.</span></span>

<span data-ttu-id="97f79-106">**Tempo stimato**: il completamento dei prerequisiti potrebbe richiedere due ore circa.</span><span class="sxs-lookup"><span data-stu-id="97f79-106">**Time estimate**: It might take a couple of hours to complete the prerequisites.</span></span> <span data-ttu-id="97f79-107">Il tempo è dedicato principalmente alla creazione delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="97f79-107">Much of this time is spent creating virtual machines.</span></span>

<span data-ttu-id="97f79-108">Il diagramma seguente illustra le operazioni di compilazione nell'esercitazione.</span><span class="sxs-lookup"><span data-stu-id="97f79-108">The following diagram illustrates what you build in the tutorial.</span></span>

![Gruppo di disponibilità](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/00-EndstateSampleNoELB.png)

## <a name="review-availability-group-documentation"></a><span data-ttu-id="97f79-110">Esaminare la documentazione relativa ai gruppi di disponibilità</span><span class="sxs-lookup"><span data-stu-id="97f79-110">Review availability group documentation</span></span>

<span data-ttu-id="97f79-111">L'esercitazione presuppone una conoscenza di base dei gruppi di disponibilità AlwaysOn di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="97f79-111">This tutorial assumes that you have a basic understanding of SQL Server Always On availability groups.</span></span> <span data-ttu-id="97f79-112">Se non si ha familiarità con questa tecnologia, vedere [Panoramica di gruppi di disponibilità AlwaysOn (SQL Server)](http://msdn.microsoft.com/library/ff877884.aspx).</span><span class="sxs-lookup"><span data-stu-id="97f79-112">If you're not familiar with this technology, see [Overview of Always On Availability Groups (SQL Server)](http://msdn.microsoft.com/library/ff877884.aspx).</span></span>


## <a name="create-an-azure-account"></a><span data-ttu-id="97f79-113">Creare un account Azure</span><span class="sxs-lookup"><span data-stu-id="97f79-113">Create an Azure account</span></span>
<span data-ttu-id="97f79-114">È necessario un account Azure.</span><span class="sxs-lookup"><span data-stu-id="97f79-114">You need an Azure account.</span></span> <span data-ttu-id="97f79-115">È possibile [aprire un account Azure gratuito](/pricing/free-trial/?WT.mc_id=A261C142F) o [attivare i benefici della sottoscrizione di Visual Studio](/pricing/member-offers/msdn-benefits-details/?WT.mc_id=A261C142F).</span><span class="sxs-lookup"><span data-stu-id="97f79-115">You can [open a free Azure account](/pricing/free-trial/?WT.mc_id=A261C142F) or [activate Visual Studio subscriber benefits](/pricing/member-offers/msdn-benefits-details/?WT.mc_id=A261C142F).</span></span>

## <a name="create-a-resource-group"></a><span data-ttu-id="97f79-116">Creare un gruppo di risorse</span><span class="sxs-lookup"><span data-stu-id="97f79-116">Create a resource group</span></span>
1. <span data-ttu-id="97f79-117">Accedere al [portale di Azure](http://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="97f79-117">Sign in to the [Azure portal](http://portal.azure.com).</span></span>
2. <span data-ttu-id="97f79-118">Fare clic su **+** per creare un nuovo oggetto nel portale.</span><span class="sxs-lookup"><span data-stu-id="97f79-118">Click **+** to create a new object in the portal.</span></span>

   ![Nuovo oggetto](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-portalplus.png)

3. <span data-ttu-id="97f79-120">Digitare **gruppo di risorse** nella finestra di ricerca del **Marketplace**.</span><span class="sxs-lookup"><span data-stu-id="97f79-120">Type **resource group** in the **Marketplace** search window.</span></span>

   ![Gruppo di risorse](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-resourcegroupsymbol.png)
4. <span data-ttu-id="97f79-122">Fare clic su **Gruppo di risorse**.</span><span class="sxs-lookup"><span data-stu-id="97f79-122">Click **Resource group**.</span></span>
5. <span data-ttu-id="97f79-123">Fare clic su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="97f79-123">Click **Create**.</span></span>
6. <span data-ttu-id="97f79-124">Nel pannello **Gruppo di risorse** digitare un nome in **Nome gruppo di risorse**,</span><span class="sxs-lookup"><span data-stu-id="97f79-124">On the **Resource group** blade, under **Resource group name**, type a name for the resource group.</span></span> <span data-ttu-id="97f79-125">ad esempio digitare **sql-ha-rg**.</span><span class="sxs-lookup"><span data-stu-id="97f79-125">For example, type **sql-ha-rg**.</span></span>
7. <span data-ttu-id="97f79-126">Se si hanno più sottoscrizioni di Azure, verificare che la sottoscrizione sia la sottoscrizione di Azure in cui si vuole creare il gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="97f79-126">If you have multiple Azure subscriptions, verify that the subscription is the Azure subscription that you want to create the availability group in.</span></span>
8. <span data-ttu-id="97f79-127">Selezionare una località.</span><span class="sxs-lookup"><span data-stu-id="97f79-127">Select a location.</span></span> <span data-ttu-id="97f79-128">La località corrisponde all'area di Azure in cui si vuole creare il gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="97f79-128">The location is the Azure region where you want to create the availability group.</span></span> <span data-ttu-id="97f79-129">Per questa esercitazione tutte le risorse verranno compilate in un'unica località di Azure.</span><span class="sxs-lookup"><span data-stu-id="97f79-129">For this tutorial, we're going to build all resources in one Azure location.</span></span>
9. <span data-ttu-id="97f79-130">Verificare che l'opzione **Aggiungi al dashboard** sia selezionata.</span><span class="sxs-lookup"><span data-stu-id="97f79-130">Verify that **Pin to dashboard** is checked.</span></span> <span data-ttu-id="97f79-131">Questa impostazione facoltativa inserisce un collegamento per il gruppo di risorse nel dashboard del portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="97f79-131">This optional setting places a shortcut for the resource group on the Azure portal dashboard.</span></span>

   ![Gruppo di risorse](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-resourcegroup.png)

10. <span data-ttu-id="97f79-133">Fare clic su **Crea** per creare il gruppo di risorse.</span><span class="sxs-lookup"><span data-stu-id="97f79-133">Click **Create** to create the resource group.</span></span>

<span data-ttu-id="97f79-134">Azure crea il gruppo di risorse e aggiunge un collegamento a quest'ultimo nel portale.</span><span class="sxs-lookup"><span data-stu-id="97f79-134">Azure creates the resource group and pins a shortcut to the resource group in the portal.</span></span>

## <a name="create-the-network-and-subnets"></a><span data-ttu-id="97f79-135">Creare la rete e le subnet</span><span class="sxs-lookup"><span data-stu-id="97f79-135">Create the network and subnets</span></span>
<span data-ttu-id="97f79-136">Il passaggio successivo prevede la creazione di reti e di subnet nel gruppo di risorse di Azure.</span><span class="sxs-lookup"><span data-stu-id="97f79-136">The next step is to create the networks and subnets in the Azure resource group.</span></span>

<span data-ttu-id="97f79-137">La soluzione usa una rete virtuale con due subnet.</span><span class="sxs-lookup"><span data-stu-id="97f79-137">The solution uses one virtual network with two subnets.</span></span> <span data-ttu-id="97f79-138">Per altre informazioni sulle reti in Azure, vedere [Panoramica di Rete virtuale](../../../virtual-network/virtual-networks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="97f79-138">The [Virtual network overview](../../../virtual-network/virtual-networks-overview.md) provides more information about networks in Azure.</span></span>

<span data-ttu-id="97f79-139">Per creare la rete virtuale:</span><span class="sxs-lookup"><span data-stu-id="97f79-139">To create the virtual network:</span></span>

1. <span data-ttu-id="97f79-140">Nel portale di Azure fare clic su **+ Aggiungi** nel gruppo di risorse specifico.</span><span class="sxs-lookup"><span data-stu-id="97f79-140">In the Azure portal, in your resource group, click **+ Add**.</span></span> <span data-ttu-id="97f79-141">Azure apre il pannello **Tutto** .</span><span class="sxs-lookup"><span data-stu-id="97f79-141">Azure opens the **Everything** blade.</span></span>

   ![Nuovo elemento](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/02-newiteminrg.png)
2. <span data-ttu-id="97f79-143">Cercare **rete virtuale**.</span><span class="sxs-lookup"><span data-stu-id="97f79-143">Search for **virtual network**.</span></span>

     ![Cercare la rete virtuale](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/04-findvirtualnetwork.png)
3. <span data-ttu-id="97f79-145">Fare clic su **Rete virtuale**.</span><span class="sxs-lookup"><span data-stu-id="97f79-145">Click **Virtual network**.</span></span>
4. <span data-ttu-id="97f79-146">Nel pannello **Rete virtuale** fare clic sul modello di distribuzione **Resource Manager** e quindi su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="97f79-146">On the **Virtual network** blade, click the **Resource Manager** deployment model, and then click **Create**.</span></span>

    <span data-ttu-id="97f79-147">La tabella seguente descrive le impostazioni per la rete virtuale:</span><span class="sxs-lookup"><span data-stu-id="97f79-147">The following table shows the settings for the virtual network:</span></span>

   | <span data-ttu-id="97f79-148">**Campo**</span><span class="sxs-lookup"><span data-stu-id="97f79-148">**Field**</span></span> | <span data-ttu-id="97f79-149">Valore</span><span class="sxs-lookup"><span data-stu-id="97f79-149">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="97f79-150">**Nome**</span><span class="sxs-lookup"><span data-stu-id="97f79-150">**Name**</span></span> |<span data-ttu-id="97f79-151">autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="97f79-151">autoHAVNET</span></span> |
   | <span data-ttu-id="97f79-152">**Spazio degli indirizzi**</span><span class="sxs-lookup"><span data-stu-id="97f79-152">**Address space**</span></span> |<span data-ttu-id="97f79-153">10.33.0.0/24</span><span class="sxs-lookup"><span data-stu-id="97f79-153">10.33.0.0/24</span></span> |
   | <span data-ttu-id="97f79-154">**Nome della subnet**</span><span class="sxs-lookup"><span data-stu-id="97f79-154">**Subnet name**</span></span> |<span data-ttu-id="97f79-155">Admin</span><span class="sxs-lookup"><span data-stu-id="97f79-155">Admin</span></span> |
   | <span data-ttu-id="97f79-156">**Intervallo di indirizzi subnet**</span><span class="sxs-lookup"><span data-stu-id="97f79-156">**Subnet address range**</span></span> |<span data-ttu-id="97f79-157">10.33.0.0/29</span><span class="sxs-lookup"><span data-stu-id="97f79-157">10.33.0.0/29</span></span> |
   | <span data-ttu-id="97f79-158">**Sottoscrizione**</span><span class="sxs-lookup"><span data-stu-id="97f79-158">**Subscription**</span></span> |<span data-ttu-id="97f79-159">Specificare la sottoscrizione da usare.</span><span class="sxs-lookup"><span data-stu-id="97f79-159">Specify the subscription that you intend to use.</span></span> <span data-ttu-id="97f79-160">Se è disponibile una sola sottoscrizione, il valore di **Sottoscrizione** non è impostato.</span><span class="sxs-lookup"><span data-stu-id="97f79-160">**Subscription** is blank if you only have one subscription.</span></span> |
   | <span data-ttu-id="97f79-161">**Gruppo di risorse**</span><span class="sxs-lookup"><span data-stu-id="97f79-161">**Resource group**</span></span> |<span data-ttu-id="97f79-162">Scegliere **Utilizza esistente** e selezionare il nome del gruppo di risorse.</span><span class="sxs-lookup"><span data-stu-id="97f79-162">Choose **Use existing** and pick the name of the resource group.</span></span> |
   | <span data-ttu-id="97f79-163">**Posizione**</span><span class="sxs-lookup"><span data-stu-id="97f79-163">**Location**</span></span> |<span data-ttu-id="97f79-164">Specificare la località di Azure.</span><span class="sxs-lookup"><span data-stu-id="97f79-164">Specify the Azure location.</span></span> |

   <span data-ttu-id="97f79-165">Lo spazio indirizzi e l'intervallo di indirizzi subnet possono essere diversi da quelli della tabella.</span><span class="sxs-lookup"><span data-stu-id="97f79-165">Your address space and subnet address range might be different from the table.</span></span> <span data-ttu-id="97f79-166">A seconda della sottoscrizione, sul portale verrà suggerito uno spazio indirizzi disponibile e un intervallo di indirizzi subnet corrispondente.</span><span class="sxs-lookup"><span data-stu-id="97f79-166">Depending on your subscription, the portal suggests an available address space and corresponding subnet address range.</span></span> <span data-ttu-id="97f79-167">Se non è disponibile uno spazio indirizzi sufficiente, usare un'altra sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="97f79-167">If no sufficient address space is available, use a different subscription.</span></span>

   <span data-ttu-id="97f79-168">L'esempio usa il nome di subnet **Admin**. Questa subnet verrà usata per i controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="97f79-168">The example uses the subnet name **Admin**. This subnet is for the domain controllers.</span></span>

5. <span data-ttu-id="97f79-169">Fare clic su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="97f79-169">Click **Create**.</span></span>

   ![Configurare la rete virtuale](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/06-configurevirtualnetwork.png)

<span data-ttu-id="97f79-171">In questo modo, si torna al dashboard del portale e Azure invia una notifica dopo la creazione della rete.</span><span class="sxs-lookup"><span data-stu-id="97f79-171">Azure returns you to the portal dashboard and notifies you when the new network is created.</span></span>

### <a name="create-a-second-subnet"></a><span data-ttu-id="97f79-172">Creare una seconda subnet</span><span class="sxs-lookup"><span data-stu-id="97f79-172">Create a second subnet</span></span>
<span data-ttu-id="97f79-173">La nuova rete virtuale dispone di una subnet, denominata **Admin**. I controller di dominio usano questa subnet.</span><span class="sxs-lookup"><span data-stu-id="97f79-173">The new virtual network has one subnet, named **Admin**. The domain controllers use this subnet.</span></span> <span data-ttu-id="97f79-174">Le VM di SQL Server usano una seconda subnet denominata **SQL**.</span><span class="sxs-lookup"><span data-stu-id="97f79-174">The SQL Server VMs use a second subnet named **SQL**.</span></span> <span data-ttu-id="97f79-175">Per configurare questa subnet:</span><span class="sxs-lookup"><span data-stu-id="97f79-175">To configure this subnet:</span></span>

1. <span data-ttu-id="97f79-176">Nel dashboard fare clic sul gruppo di risorse creato, **SQL-HA-RG**.</span><span class="sxs-lookup"><span data-stu-id="97f79-176">On your dashboard, click the resource group that you created, **SQL-HA-RG**.</span></span> <span data-ttu-id="97f79-177">Trovare la rete nel gruppo di risorse in **Risorse**.</span><span class="sxs-lookup"><span data-stu-id="97f79-177">Locate the network in the resource group under **Resources**.</span></span>

    <span data-ttu-id="97f79-178">Se **SQL-HA-RG** non è visibile, individuarlo facendo clic su **Gruppi di risorse** e filtrando in base al nome del gruppo di risorse.</span><span class="sxs-lookup"><span data-stu-id="97f79-178">If **SQL-HA-RG** isn't visible, find it by clicking **Resource Groups** and filtering by the resource group name.</span></span>
2. <span data-ttu-id="97f79-179">Scegliere **autoHAVNET** dall'elenco di risorse.</span><span class="sxs-lookup"><span data-stu-id="97f79-179">Click **autoHAVNET** on the list of resources.</span></span> <span data-ttu-id="97f79-180">Azure apre il pannello di configurazione della rete.</span><span class="sxs-lookup"><span data-stu-id="97f79-180">Azure opens the network configuration blade.</span></span>
3. <span data-ttu-id="97f79-181">Nel pannello della rete virtuale **autoHAVNET**, in **Impostazioni** fare clic su **Subnet**.</span><span class="sxs-lookup"><span data-stu-id="97f79-181">On the **autoHAVNET** virtual network blade, under **Settings** , click **Subnets**.</span></span>

    <span data-ttu-id="97f79-182">Si noti la subnet già creata.</span><span class="sxs-lookup"><span data-stu-id="97f79-182">Note the subnet that you already created.</span></span>

   ![Configurare la rete virtuale](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/07-addsubnet.png)
5. <span data-ttu-id="97f79-184">Creare una seconda subnet.</span><span class="sxs-lookup"><span data-stu-id="97f79-184">Create a second subnet.</span></span> <span data-ttu-id="97f79-185">Fare clic su **+ Subnet**.</span><span class="sxs-lookup"><span data-stu-id="97f79-185">Click **+ Subnet**.</span></span>
6. <span data-ttu-id="97f79-186">Nel pannello **Aggiungi subnet** configurare la subnet digitando **sqlsubnet** in **Nome**.</span><span class="sxs-lookup"><span data-stu-id="97f79-186">On the **Add subnet** blade, configure the subnet by typing **sqlsubnet** under **Name**.</span></span> <span data-ttu-id="97f79-187">Azure specifica automaticamente un **Intervallo di indirizzi**valido.</span><span class="sxs-lookup"><span data-stu-id="97f79-187">Azure automatically specifies a valid **Address range**.</span></span> <span data-ttu-id="97f79-188">Verificare che questo intervallo di indirizzi includa almeno 10 indirizzi.</span><span class="sxs-lookup"><span data-stu-id="97f79-188">Verify that this address range has at least 10 addresses in it.</span></span> <span data-ttu-id="97f79-189">In un ambiente di produzione potrebbero essere necessari più indirizzi.</span><span class="sxs-lookup"><span data-stu-id="97f79-189">In a production environment, you might require more addresses.</span></span>
7. <span data-ttu-id="97f79-190">Fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="97f79-190">Click **OK**.</span></span>

    ![Configurare la rete virtuale](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/08-configuresubnet.png)

<span data-ttu-id="97f79-192">La tabella seguente riepiloga le impostazioni di configurazione della rete:</span><span class="sxs-lookup"><span data-stu-id="97f79-192">The following table summarizes the network configuration settings:</span></span>

| <span data-ttu-id="97f79-193">**Campo**</span><span class="sxs-lookup"><span data-stu-id="97f79-193">**Field**</span></span> | <span data-ttu-id="97f79-194">Valore</span><span class="sxs-lookup"><span data-stu-id="97f79-194">Value</span></span> |
| --- | --- |
| <span data-ttu-id="97f79-195">**Nome**</span><span class="sxs-lookup"><span data-stu-id="97f79-195">**Name**</span></span> |<span data-ttu-id="97f79-196">**autoHAVNET**</span><span class="sxs-lookup"><span data-stu-id="97f79-196">**autoHAVNET**</span></span> |
| <span data-ttu-id="97f79-197">**Spazio degli indirizzi**</span><span class="sxs-lookup"><span data-stu-id="97f79-197">**Address space**</span></span> |<span data-ttu-id="97f79-198">Questo valore dipende dagli spazi indirizzi disponibili nella sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="97f79-198">This value depends on the available address spaces in your subscription.</span></span> <span data-ttu-id="97f79-199">Un valore tipico è 10.0.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="97f79-199">A typical value is 10.0.0.0/16.</span></span> |
| <span data-ttu-id="97f79-200">**Nome della subnet**</span><span class="sxs-lookup"><span data-stu-id="97f79-200">**Subnet name**</span></span> |<span data-ttu-id="97f79-201">**admin**</span><span class="sxs-lookup"><span data-stu-id="97f79-201">**admin**</span></span> |
| <span data-ttu-id="97f79-202">**Intervallo di indirizzi subnet**</span><span class="sxs-lookup"><span data-stu-id="97f79-202">**Subnet address range**</span></span> |<span data-ttu-id="97f79-203">Questo valore dipende dagli intervalli di indirizzi disponibili nella sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="97f79-203">This value depends on the available address ranges in your subscription.</span></span> <span data-ttu-id="97f79-204">Un valore tipico è 10.0.0.0/24</span><span class="sxs-lookup"><span data-stu-id="97f79-204">A typical value is 10.0.0.0/24.</span></span> |
| <span data-ttu-id="97f79-205">**Nome della subnet**</span><span class="sxs-lookup"><span data-stu-id="97f79-205">**Subnet name**</span></span> |<span data-ttu-id="97f79-206">**sqlsubnet**</span><span class="sxs-lookup"><span data-stu-id="97f79-206">**sqlsubnet**</span></span> |
| <span data-ttu-id="97f79-207">**Intervallo di indirizzi subnet**</span><span class="sxs-lookup"><span data-stu-id="97f79-207">**Subnet address range**</span></span> |<span data-ttu-id="97f79-208">Questo valore dipende dagli intervalli di indirizzi disponibili nella sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="97f79-208">This value depends on the available address ranges in your subscription.</span></span> <span data-ttu-id="97f79-209">Un valore tipico è 10.0.1.0/24</span><span class="sxs-lookup"><span data-stu-id="97f79-209">A typical value is 10.0.1.0/24.</span></span> |
| <span data-ttu-id="97f79-210">**Sottoscrizione**</span><span class="sxs-lookup"><span data-stu-id="97f79-210">**Subscription**</span></span> |<span data-ttu-id="97f79-211">Specificare la sottoscrizione da usare.</span><span class="sxs-lookup"><span data-stu-id="97f79-211">Specify the subscription that you intend to use.</span></span> |
| <span data-ttu-id="97f79-212">**Gruppo di risorse**</span><span class="sxs-lookup"><span data-stu-id="97f79-212">**Resource Group**</span></span> |<span data-ttu-id="97f79-213">**SQL-HA-RG**</span><span class="sxs-lookup"><span data-stu-id="97f79-213">**SQL-HA-RG**</span></span> |
| <span data-ttu-id="97f79-214">**Posizione**</span><span class="sxs-lookup"><span data-stu-id="97f79-214">**Location**</span></span> |<span data-ttu-id="97f79-215">Specificare la stessa località scelta per il gruppo di risorse.</span><span class="sxs-lookup"><span data-stu-id="97f79-215">Specify the same location that you chose for the resource group.</span></span> |

## <a name="create-availability-sets"></a><span data-ttu-id="97f79-216">Creare set di disponibilità</span><span class="sxs-lookup"><span data-stu-id="97f79-216">Create availability sets</span></span>

<span data-ttu-id="97f79-217">Prima di creare le macchine virtuali, è necessario creare i set di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="97f79-217">Before you create virtual machines, you need to create availability sets.</span></span> <span data-ttu-id="97f79-218">I set di disponibilità riducono il tempo di inattività per gli eventi di manutenzione sia pianificati che non pianificati.</span><span class="sxs-lookup"><span data-stu-id="97f79-218">Availability sets reduce the downtime for planned or unplanned maintenance events.</span></span> <span data-ttu-id="97f79-219">Un set di disponibilità di Azure è un gruppo logico di risorse che Azure inserisce in domini di errore e domini di aggiornamento fisici.</span><span class="sxs-lookup"><span data-stu-id="97f79-219">An Azure availability set is a logical group of resources that Azure places on physical fault domains and update domains.</span></span> <span data-ttu-id="97f79-220">Un dominio di errore assicura che i membri del set di disponibilità dispongano di risorse di alimentazione e di rete separate.</span><span class="sxs-lookup"><span data-stu-id="97f79-220">A fault domain ensures that the members of the availability set have separate power and network resources.</span></span> <span data-ttu-id="97f79-221">Un dominio di aggiornamento assicura che i membri del set di disponibilità non vengano disattivati contemporaneamente per la manutenzione.</span><span class="sxs-lookup"><span data-stu-id="97f79-221">An update domain ensures that members of the availability set aren't brought down for maintenance at the same time.</span></span> <span data-ttu-id="97f79-222">Per altre informazioni, vedere [Gestire la disponibilità delle macchine virtuali](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="97f79-222">For more information, see [Manage the availability of virtual machines](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

<span data-ttu-id="97f79-223">Sono necessari due set di disponibilità,</span><span class="sxs-lookup"><span data-stu-id="97f79-223">You need two availability sets.</span></span> <span data-ttu-id="97f79-224">uno per i controller di dominio</span><span class="sxs-lookup"><span data-stu-id="97f79-224">One is for the domain controllers.</span></span> <span data-ttu-id="97f79-225">e il secondo per le VM di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="97f79-225">The second is for the SQL Server VMs.</span></span>

<span data-ttu-id="97f79-226">Per creare un set di disponibilità, passare al gruppo di risorse e fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="97f79-226">To create an availability set, go to the resource group and click **Add**.</span></span> <span data-ttu-id="97f79-227">Filtrare i risultati digitando **Set di disponibilità**.</span><span class="sxs-lookup"><span data-stu-id="97f79-227">Filter the results by typing **availability set**.</span></span> <span data-ttu-id="97f79-228">Fare clic su **Set di disponibilità** nei risultati e quindi su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="97f79-228">Click **Availability Set** in the results, and then click **Create**.</span></span>

<span data-ttu-id="97f79-229">Configurare due set di disponibilità in base ai parametri riportati nella tabella seguente:</span><span class="sxs-lookup"><span data-stu-id="97f79-229">Configure two availability sets according to the parameters in the following table:</span></span>

| <span data-ttu-id="97f79-230">**Campo**</span><span class="sxs-lookup"><span data-stu-id="97f79-230">**Field**</span></span> | <span data-ttu-id="97f79-231">Set di disponibilità del controller di dominio</span><span class="sxs-lookup"><span data-stu-id="97f79-231">Domain controller availability set</span></span> | <span data-ttu-id="97f79-232">Set di disponibilità di SQL Server</span><span class="sxs-lookup"><span data-stu-id="97f79-232">SQL Server availability set</span></span> |
| --- | --- | --- |
| <span data-ttu-id="97f79-233">**Nome**</span><span class="sxs-lookup"><span data-stu-id="97f79-233">**Name**</span></span> |<span data-ttu-id="97f79-234">adavailabilityset</span><span class="sxs-lookup"><span data-stu-id="97f79-234">adavailabilityset</span></span> |<span data-ttu-id="97f79-235">sqlavailabilityset</span><span class="sxs-lookup"><span data-stu-id="97f79-235">sqlavailabilityset</span></span> |
| <span data-ttu-id="97f79-236">**Gruppo di risorse**</span><span class="sxs-lookup"><span data-stu-id="97f79-236">**Resource group**</span></span> |<span data-ttu-id="97f79-237">Nome gruppo di risorse</span><span class="sxs-lookup"><span data-stu-id="97f79-237">SQL-HA-RG</span></span> |<span data-ttu-id="97f79-238">Nome gruppo di risorse</span><span class="sxs-lookup"><span data-stu-id="97f79-238">SQL-HA-RG</span></span> |
| <span data-ttu-id="97f79-239">**Domini di errore**</span><span class="sxs-lookup"><span data-stu-id="97f79-239">**Fault domains**</span></span> |<span data-ttu-id="97f79-240">3</span><span class="sxs-lookup"><span data-stu-id="97f79-240">3</span></span> |<span data-ttu-id="97f79-241">3</span><span class="sxs-lookup"><span data-stu-id="97f79-241">3</span></span> |
| <span data-ttu-id="97f79-242">**Domini di aggiornamento**</span><span class="sxs-lookup"><span data-stu-id="97f79-242">**Update domains**</span></span> |<span data-ttu-id="97f79-243">5</span><span class="sxs-lookup"><span data-stu-id="97f79-243">5</span></span> |<span data-ttu-id="97f79-244">3</span><span class="sxs-lookup"><span data-stu-id="97f79-244">3</span></span> |

<span data-ttu-id="97f79-245">Dopo avere creato i set di disponibilità, tornare al gruppo di risorse nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="97f79-245">After you create the availability sets, return to the resource group in the Azure portal.</span></span>

## <a name="create-domain-controllers"></a><span data-ttu-id="97f79-246">Creare controller di dominio</span><span class="sxs-lookup"><span data-stu-id="97f79-246">Create domain controllers</span></span>
<span data-ttu-id="97f79-247">Dopo la creazione della rete, delle subnet, dei set di disponibilità e di un servizio di bilanciamento del carico con connessione Internet, è possibile creare le macchine virtuali per i controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="97f79-247">After you've created the network, subnets, availability sets, and an Internet-facing load balancer, you're ready to create the virtual machines for the domain controllers.</span></span>

### <a name="create-virtual-machines-for-the-domain-controllers"></a><span data-ttu-id="97f79-248">Creare le macchine virtuali per i controller di dominio</span><span class="sxs-lookup"><span data-stu-id="97f79-248">Create virtual machines for the domain controllers</span></span>
<span data-ttu-id="97f79-249">Per creare e configurare i controller di dominio, tornare al gruppo di risorse **SQL-HA-RG** .</span><span class="sxs-lookup"><span data-stu-id="97f79-249">To create and configure the domain controllers, return to the **SQL-HA-RG** resource group.</span></span>

1. <span data-ttu-id="97f79-250">Fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="97f79-250">Click **Add**.</span></span> <span data-ttu-id="97f79-251">Viene aperto il pannello **Tutto** .</span><span class="sxs-lookup"><span data-stu-id="97f79-251">The **Everything** blade opens.</span></span>
2. <span data-ttu-id="97f79-252">Digitare **Windows Server 2016 Datacenter**.</span><span class="sxs-lookup"><span data-stu-id="97f79-252">Type **Windows Server 2016 Datacenter**.</span></span>
3. <span data-ttu-id="97f79-253">Fare clic su **Windows Server 2016 Datacenter**.</span><span class="sxs-lookup"><span data-stu-id="97f79-253">Click **Windows Server 2016 Datacenter**.</span></span> <span data-ttu-id="97f79-254">Nel pannello **Windows Server 2016 Datacenter** verificare che il modello di distribuzione sia **Resource Manager** e quindi fare clic su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="97f79-254">In the **Windows Server 2016 Datacenter** blade, verify that the deployment model is **Resource Manager**, and then click **Create**.</span></span> <span data-ttu-id="97f79-255">Azure apre il pannello **Crea macchina virtuale** .</span><span class="sxs-lookup"><span data-stu-id="97f79-255">Azure opens the **Create virtual machine** blade.</span></span>

<span data-ttu-id="97f79-256">Ripetere i passaggi precedenti per creare due macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="97f79-256">Repeat the preceding steps to create two virtual machines.</span></span> <span data-ttu-id="97f79-257">Assegnare un nome alle due macchine virtuali:</span><span class="sxs-lookup"><span data-stu-id="97f79-257">Name the two virtual machines:</span></span>

* <span data-ttu-id="97f79-258">ad-primary-dc</span><span class="sxs-lookup"><span data-stu-id="97f79-258">ad-primary-dc</span></span>
* <span data-ttu-id="97f79-259">ad-secondary-dc</span><span class="sxs-lookup"><span data-stu-id="97f79-259">ad-secondary-dc</span></span>

  > [!NOTE]
  > <span data-ttu-id="97f79-260">La macchina virtuale **ad-secondary-dc** per fornire disponibilità elevata per Active Directory Domain Services.</span><span class="sxs-lookup"><span data-stu-id="97f79-260">The **ad-secondary-dc** virtual machine is optional, to provide high availability for Active Directory Domain Services.</span></span>
  >
  >

<span data-ttu-id="97f79-261">La tabella seguente descrive le impostazioni per queste due macchine:</span><span class="sxs-lookup"><span data-stu-id="97f79-261">The following table shows the settings for these two machines:</span></span>

| <span data-ttu-id="97f79-262">**Campo**</span><span class="sxs-lookup"><span data-stu-id="97f79-262">**Field**</span></span> | <span data-ttu-id="97f79-263">Valore</span><span class="sxs-lookup"><span data-stu-id="97f79-263">Value</span></span> |
| --- | --- |
| <span data-ttu-id="97f79-264">**Nome**</span><span class="sxs-lookup"><span data-stu-id="97f79-264">**Name**</span></span> |<span data-ttu-id="97f79-265">Primo controller di dominio: *ad-primary-dc*.</span><span class="sxs-lookup"><span data-stu-id="97f79-265">First domain controller: *ad-primary-dc*.</span></span></br><span data-ttu-id="97f79-266">Secondo controller di dominio: *ad-secondary-dc*.</span><span class="sxs-lookup"><span data-stu-id="97f79-266">Second domain controller *ad-secondary-dc*.</span></span> |
| <span data-ttu-id="97f79-267">**Tipo di disco VM**</span><span class="sxs-lookup"><span data-stu-id="97f79-267">**VM disk type**</span></span> |<span data-ttu-id="97f79-268">SSD</span><span class="sxs-lookup"><span data-stu-id="97f79-268">SSD</span></span> |
| <span data-ttu-id="97f79-269">**Nome utente**</span><span class="sxs-lookup"><span data-stu-id="97f79-269">**User name**</span></span> |<span data-ttu-id="97f79-270">DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="97f79-270">DomainAdmin</span></span> |
| <span data-ttu-id="97f79-271">**Password**</span><span class="sxs-lookup"><span data-stu-id="97f79-271">**Password**</span></span> |<span data-ttu-id="97f79-272">Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="97f79-272">Contoso!0000</span></span> |
| <span data-ttu-id="97f79-273">**Sottoscrizione**</span><span class="sxs-lookup"><span data-stu-id="97f79-273">**Subscription**</span></span> |<span data-ttu-id="97f79-274">*Sottoscrizione in uso*</span><span class="sxs-lookup"><span data-stu-id="97f79-274">*Your subscription*</span></span> |
| <span data-ttu-id="97f79-275">**Gruppo di risorse**</span><span class="sxs-lookup"><span data-stu-id="97f79-275">**Resource group**</span></span> |<span data-ttu-id="97f79-276">Nome gruppo di risorse</span><span class="sxs-lookup"><span data-stu-id="97f79-276">SQL-HA-RG</span></span> |
| <span data-ttu-id="97f79-277">**Posizione**</span><span class="sxs-lookup"><span data-stu-id="97f79-277">**Location**</span></span> |<span data-ttu-id="97f79-278">*Località corrente*</span><span class="sxs-lookup"><span data-stu-id="97f79-278">*Your location*</span></span> |
| <span data-ttu-id="97f79-279">**Dimensione**</span><span class="sxs-lookup"><span data-stu-id="97f79-279">**Size**</span></span> |<span data-ttu-id="97f79-280">DS1_V2</span><span class="sxs-lookup"><span data-stu-id="97f79-280">DS1_V2</span></span> |
| <span data-ttu-id="97f79-281">**Archiviazione**</span><span class="sxs-lookup"><span data-stu-id="97f79-281">**Storage**</span></span> | <span data-ttu-id="97f79-282">**Usa dischi gestiti** - **Sì**</span><span class="sxs-lookup"><span data-stu-id="97f79-282">**Use managed disks** - **Yes**</span></span> |
| <span data-ttu-id="97f79-283">**Rete virtuale**</span><span class="sxs-lookup"><span data-stu-id="97f79-283">**Virtual network**</span></span> |<span data-ttu-id="97f79-284">autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="97f79-284">autoHAVNET</span></span> |
| <span data-ttu-id="97f79-285">**Subnet**</span><span class="sxs-lookup"><span data-stu-id="97f79-285">**Subnet**</span></span> |<span data-ttu-id="97f79-286">admin</span><span class="sxs-lookup"><span data-stu-id="97f79-286">admin</span></span> |
| <span data-ttu-id="97f79-287">**Indirizzo IP pubblico**</span><span class="sxs-lookup"><span data-stu-id="97f79-287">**Public IP address**</span></span> |<span data-ttu-id="97f79-288">*Lo stesso nome della VM*</span><span class="sxs-lookup"><span data-stu-id="97f79-288">*Same name as the VM*</span></span> |
| <span data-ttu-id="97f79-289">**Gruppo di sicurezza di rete**</span><span class="sxs-lookup"><span data-stu-id="97f79-289">**Network security group**</span></span> |<span data-ttu-id="97f79-290">*Lo stesso nome della VM*</span><span class="sxs-lookup"><span data-stu-id="97f79-290">*Same name as the VM*</span></span> |
| <span data-ttu-id="97f79-291">**Set di disponibilità**</span><span class="sxs-lookup"><span data-stu-id="97f79-291">**Availability set**</span></span> |<span data-ttu-id="97f79-292">adavailabilityset</span><span class="sxs-lookup"><span data-stu-id="97f79-292">adavailabilityset</span></span> </br><span data-ttu-id="97f79-293">**Domini di errore**:2</span><span class="sxs-lookup"><span data-stu-id="97f79-293">**Fault domains**:2</span></span></br><span data-ttu-id="97f79-294">**Domini di aggiornamento**:2</span><span class="sxs-lookup"><span data-stu-id="97f79-294">**Update domains**:2</span></span>|
| <span data-ttu-id="97f79-295">**Diagnostica**</span><span class="sxs-lookup"><span data-stu-id="97f79-295">**Diagnostics**</span></span> |<span data-ttu-id="97f79-296">Enabled</span><span class="sxs-lookup"><span data-stu-id="97f79-296">Enabled</span></span> |
| <span data-ttu-id="97f79-297">**Account di archiviazione di diagnostica**</span><span class="sxs-lookup"><span data-stu-id="97f79-297">**Diagnostics storage account**</span></span> |<span data-ttu-id="97f79-298">*Creato automaticamente*</span><span class="sxs-lookup"><span data-stu-id="97f79-298">*Automatically created*</span></span> |

   >[!IMPORTANT]
   ><span data-ttu-id="97f79-299">È possibile inserire una VM in un set di disponibilità solo in fase di creazione.</span><span class="sxs-lookup"><span data-stu-id="97f79-299">You can only place a VM in an availability set when you create it.</span></span> <span data-ttu-id="97f79-300">Non è possibile modificare il set di disponibilità dopo che la VM è stata creata.</span><span class="sxs-lookup"><span data-stu-id="97f79-300">You can't change the availability set after a VM is created.</span></span> <span data-ttu-id="97f79-301">Vedere [Gestire la disponibilità delle macchine virtuali](../manage-availability.md).</span><span class="sxs-lookup"><span data-stu-id="97f79-301">See [Manage the availability of virtual machines](../manage-availability.md).</span></span>

<span data-ttu-id="97f79-302">Azure crea le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="97f79-302">Azure creates the virtual machines.</span></span>

<span data-ttu-id="97f79-303">Dopo avere creato le macchine virtuali, configurare il controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="97f79-303">After the virtual machines are created, configure the domain controller.</span></span>

### <a name="configure-the-domain-controller"></a><span data-ttu-id="97f79-304">Configurare il controller di dominio</span><span class="sxs-lookup"><span data-stu-id="97f79-304">Configure the domain controller</span></span>
<span data-ttu-id="97f79-305">Nei passaggi seguenti configurare la macchina virtuale **ad-primary-dc** come controller di dominio per corp.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="97f79-305">In the following steps, configure the **ad-primary-dc** machine as a domain controller for corp.contoso.com.</span></span>

1. <span data-ttu-id="97f79-306">Nel portale aprire il gruppo di risorse **SQL-HA-RG** e selezionare la macchina virtuale **ad-primary-dc**.</span><span class="sxs-lookup"><span data-stu-id="97f79-306">In the portal, open the **SQL-HA-RG** resource group and select the **ad-primary-dc** machine.</span></span> <span data-ttu-id="97f79-307">Nel pannello **ad-primary-dc** fare clic su **Connetti** per aprire un file RDP per l'accesso desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="97f79-307">On the **ad-primary-dc** blade, click **Connect** to open an RDP file for remote desktop access.</span></span>

    ![Connettersi a una macchina virtuale](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/20-connectrdp.png)
2. <span data-ttu-id="97f79-309">Accedere con l'account amministratore (**\DomainAdmin**) e la password (**Contoso!0000**) configurati.</span><span class="sxs-lookup"><span data-stu-id="97f79-309">Sign in with your configured administrator account (**\DomainAdmin**) and password (**Contoso!0000**).</span></span>
3. <span data-ttu-id="97f79-310">Per impostazione predefinita, verrà visualizzato il dashboard **Server Manager** .</span><span class="sxs-lookup"><span data-stu-id="97f79-310">By default, the **Server Manager** dashboard should be displayed.</span></span>
4. <span data-ttu-id="97f79-311">Fare clic sul collegamento **Aggiungi ruoli e funzionalità** sul dashboard.</span><span class="sxs-lookup"><span data-stu-id="97f79-311">Click the **Add roles and features** link on the dashboard.</span></span>

    ![Server Manager - Aggiungere ruoli](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
5. <span data-ttu-id="97f79-313">Selezionare **Avanti** fino a visualizzare la sezione **Ruoli server**.</span><span class="sxs-lookup"><span data-stu-id="97f79-313">Select **Next** until you get to the **Server Roles** section.</span></span>
6. <span data-ttu-id="97f79-314">Selezionare i ruoli **Active Directory Domain Services** e **Server DNS**.</span><span class="sxs-lookup"><span data-stu-id="97f79-314">Select the **Active Directory Domain Services** and **DNS Server** roles.</span></span> <span data-ttu-id="97f79-315">Quando richiesto, aggiungere eventuali funzionalità aggiuntive necessarie per questi ruoli.</span><span class="sxs-lookup"><span data-stu-id="97f79-315">When you're prompted, add any additional features that are required by these roles.</span></span>

   > [!NOTE]
   > <span data-ttu-id="97f79-316">Windows visualizza un avviso per indicare che non è presente alcun indirizzo IP statico.</span><span class="sxs-lookup"><span data-stu-id="97f79-316">Windows warns you that there is no static IP address.</span></span> <span data-ttu-id="97f79-317">Se si sta eseguendo il test della configurazione, fare clic su **Continua**.</span><span class="sxs-lookup"><span data-stu-id="97f79-317">If you're testing the configuration, click **Continue**.</span></span> <span data-ttu-id="97f79-318">Per gli scenari di produzione, impostare l'indirizzo IP come statico nel portale di Azure o [usare PowerShell per impostare l'indirizzo IP statico della macchina virtuale del controller di dominio](../../../virtual-network/virtual-networks-reserved-private-ip.md).</span><span class="sxs-lookup"><span data-stu-id="97f79-318">For production scenarios, set the IP address to static in the Azure portal, or [use PowerShell to set the static IP address of the domain controller machine](../../../virtual-network/virtual-networks-reserved-private-ip.md).</span></span>
   >
   >

    ![Finestra di dialogo Aggiungi ruoli](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/23-addroles.png)
7. <span data-ttu-id="97f79-320">Fare clic su **Avanti** fino a raggiungere la sezione **Conferma**.</span><span class="sxs-lookup"><span data-stu-id="97f79-320">Click **Next** until you reach the **Confirmation** section.</span></span> <span data-ttu-id="97f79-321">Selezionare la casella di controllo **Riavvia automaticamente il server di destinazione se necessario**.</span><span class="sxs-lookup"><span data-stu-id="97f79-321">Select the **Restart the destination server automatically if required** check box.</span></span>
8. <span data-ttu-id="97f79-322">Fare clic su **Installa**.</span><span class="sxs-lookup"><span data-stu-id="97f79-322">Click **Install**.</span></span>
9. <span data-ttu-id="97f79-323">Dopo l'installazione delle funzionalità, tornare al dashboard **Server Manager** .</span><span class="sxs-lookup"><span data-stu-id="97f79-323">After the features finish installing, return to the **Server Manager** dashboard.</span></span>
10. <span data-ttu-id="97f79-324">Selezionare la nuova opzione **Servizi di dominio di Active Directory** nel riquadro di sinistra.</span><span class="sxs-lookup"><span data-stu-id="97f79-324">Select the new **AD DS** option on the left-hand pane.</span></span>
11. <span data-ttu-id="97f79-325">Fare clic sul collegamento **Altro** sulla barra di avviso gialla.</span><span class="sxs-lookup"><span data-stu-id="97f79-325">Click the **More** link on the yellow warning bar.</span></span>

    ![Finestra di dialogo Active Directory Domain Services nella macchina virtuale di Server DNS](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/24-addsmore.png)
12. <span data-ttu-id="97f79-327">Nella colonna **Azione** della finestra di dialogo **Dettagli attività tutti i server** fare clic su **Alza di livello il server a controller di dominio**.</span><span class="sxs-lookup"><span data-stu-id="97f79-327">In the **Action** column of the **All Server Task Details** dialog, click **Promote this server to a domain controller**.</span></span>
13. <span data-ttu-id="97f79-328">Nella **Configurazione guidata Servizi di dominio di Active Directory**, usare i seguenti valori:</span><span class="sxs-lookup"><span data-stu-id="97f79-328">In the **Active Directory Domain Services Configuration Wizard**, use the following values:</span></span>

    | <span data-ttu-id="97f79-329">**Page**</span><span class="sxs-lookup"><span data-stu-id="97f79-329">**Page**</span></span> | <span data-ttu-id="97f79-330">Impostazione</span><span class="sxs-lookup"><span data-stu-id="97f79-330">Setting</span></span> |
    | --- | --- |
    | <span data-ttu-id="97f79-331">**Configurazione distribuzione**</span><span class="sxs-lookup"><span data-stu-id="97f79-331">**Deployment Configuration**</span></span> |<span data-ttu-id="97f79-332">**Aggiungi una nuova foresta**</span><span class="sxs-lookup"><span data-stu-id="97f79-332">**Add a new forest**</span></span><br/> <span data-ttu-id="97f79-333">**Nome di dominio radice** = corp.contoso.com</span><span class="sxs-lookup"><span data-stu-id="97f79-333">**Root domain name** = corp.contoso.com</span></span> |
    | <span data-ttu-id="97f79-334">**Opzioni controller di dominio**</span><span class="sxs-lookup"><span data-stu-id="97f79-334">**Domain Controller Options**</span></span> |<span data-ttu-id="97f79-335">**Password DSRM** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="97f79-335">**DSRM Password** = Contoso!0000</span></span><br/><span data-ttu-id="97f79-336">**Conferma password** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="97f79-336">**Confirm Password** = Contoso!0000</span></span> |
14. <span data-ttu-id="97f79-337">Fare clic su **Avanti** per procedere nelle altre pagine della procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="97f79-337">Click **Next** to go through the other pages in the wizard.</span></span> <span data-ttu-id="97f79-338">Nella pagina **Controllo dei prerequisiti** verificare che venga visualizzato il seguente messaggio: **Tutti i controlli dei prerequisiti sono riusciti**.</span><span class="sxs-lookup"><span data-stu-id="97f79-338">On the **Prerequisites Check** page, verify that you see the following message: **All prerequisite checks passed successfully**.</span></span> <span data-ttu-id="97f79-339">È possibile leggere tutti i messaggi di avviso applicabili o continuare con l'installazione.</span><span class="sxs-lookup"><span data-stu-id="97f79-339">You can review any applicable warning messages, but it's possible to continue with the installation.</span></span>
15. <span data-ttu-id="97f79-340">Fare clic su **Installa**.</span><span class="sxs-lookup"><span data-stu-id="97f79-340">Click **Install**.</span></span> <span data-ttu-id="97f79-341">La macchina virtuale **ad-primary-dc** viene riavviata automaticamente.</span><span class="sxs-lookup"><span data-stu-id="97f79-341">The **ad-primary-dc** virtual machine automatically reboots.</span></span>

### <a name="note-the-ip-address-of-the-primary-domain-controller"></a><span data-ttu-id="97f79-342">Annotare l'indirizzo IP del controller di dominio primario</span><span class="sxs-lookup"><span data-stu-id="97f79-342">Note the IP address of the primary domain controller</span></span>

<span data-ttu-id="97f79-343">Usare il controller di dominio primario per DNS.</span><span class="sxs-lookup"><span data-stu-id="97f79-343">Use the primary domain controller for DNS.</span></span> <span data-ttu-id="97f79-344">Annotare l'indirizzo IP del controller di dominio primario.</span><span class="sxs-lookup"><span data-stu-id="97f79-344">Note the primary domain controller IP address.</span></span>

<span data-ttu-id="97f79-345">Un modo per ottenere l'indirizzo IP del controller di dominio primario è tramite il portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="97f79-345">One way to get the primary domain controller IP address is through the Azure portal.</span></span>

1. <span data-ttu-id="97f79-346">Nel portale di Azure aprire il gruppo di risorse.</span><span class="sxs-lookup"><span data-stu-id="97f79-346">On the Azure portal, open the resource group.</span></span>

2. <span data-ttu-id="97f79-347">Fare clic sul controller di dominio primario.</span><span class="sxs-lookup"><span data-stu-id="97f79-347">Click the primary domain controller.</span></span>

3. <span data-ttu-id="97f79-348">Nel pannello del controller di dominio primario fare clic su **Interfacce di rete**.</span><span class="sxs-lookup"><span data-stu-id="97f79-348">On the primary domain controller blade, click **Network interfaces**.</span></span>

![Interfacce di rete](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/25-primarydcip.png)

<span data-ttu-id="97f79-350">Annotare l'indirizzo IP privato per questo server.</span><span class="sxs-lookup"><span data-stu-id="97f79-350">Note the private IP address for this server.</span></span>

### <a name="configure-the-virtual-network-dns"></a><span data-ttu-id="97f79-351">Configurare il DNS della rete virtuale</span><span class="sxs-lookup"><span data-stu-id="97f79-351">Configure the virtual network DNS</span></span>
<span data-ttu-id="97f79-352">Dopo aver creato il primo controller di dominio e attivato il DNS sul primo server, configurare la rete virtuale per usare questo server come DNS.</span><span class="sxs-lookup"><span data-stu-id="97f79-352">After you create the first domain controller and enable DNS on the first server, configure the virtual network to use this server for DNS.</span></span>

1. <span data-ttu-id="97f79-353">Nel portale di Azure fare clic sulla rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="97f79-353">In the Azure portal, click on the virtual network.</span></span>

2. <span data-ttu-id="97f79-354">In **Impostazioni** fare clic su **Server DNS**.</span><span class="sxs-lookup"><span data-stu-id="97f79-354">Under **Settings**, click **DNS Server**.</span></span>

3. <span data-ttu-id="97f79-355">Fare clic su **Personalizzato** e digitare l'indirizzo IP privato del controller di dominio primario.</span><span class="sxs-lookup"><span data-stu-id="97f79-355">Click **Custom**, and type the private IP address of the primary domain controller.</span></span>

4. <span data-ttu-id="97f79-356">Fare clic su **Salva**.</span><span class="sxs-lookup"><span data-stu-id="97f79-356">Click **Save**.</span></span>

### <a name="configure-the-second-domain-controller"></a><span data-ttu-id="97f79-357">Configurare il secondo controller di dominio</span><span class="sxs-lookup"><span data-stu-id="97f79-357">Configure the second domain controller</span></span>
<span data-ttu-id="97f79-358">Dopo il riavvio del controller di dominio primario, è possibile configurare il secondo controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="97f79-358">After the primary domain controller reboots, you can configure the second domain controller.</span></span> <span data-ttu-id="97f79-359">Questo passaggio facoltativo serve a garantire una disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="97f79-359">This optional step is for high availability.</span></span> <span data-ttu-id="97f79-360">Seguire questi passaggi per configurare il secondo controller di dominio:</span><span class="sxs-lookup"><span data-stu-id="97f79-360">Follow these steps to configure the second domain controller:</span></span>

1. <span data-ttu-id="97f79-361">Nel portale aprire il gruppo di risorse **SQL-HA-RG** e selezionare la macchina virtuale **ad-secondary-dc**.</span><span class="sxs-lookup"><span data-stu-id="97f79-361">In the portal, open the **SQL-HA-RG** resource group and select the **ad-secondary-dc** machine.</span></span> <span data-ttu-id="97f79-362">Nel pannello **ad-secondary-dc** fare clic su **Connetti** per aprire un file RDP per l'accesso desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="97f79-362">On the **ad-secondary-dc** blade, click **Connect** to open an RDP file for remote desktop access.</span></span>
2. <span data-ttu-id="97f79-363">Accedere alla VM usando l'account dell'amministratore (**BUILTIN\DomainAdmin**) e la password (**Contoso!0000**) configurati.</span><span class="sxs-lookup"><span data-stu-id="97f79-363">Sign in to the VM by using your configured administrator account (**BUILTIN\DomainAdmin**) and password (**Contoso!0000**).</span></span>
3. <span data-ttu-id="97f79-364">Sostituire l'indirizzo del server DNS preferito con l'indirizzo del controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="97f79-364">Change the preferred DNS server address to the address of the domain controller.</span></span>
4. <span data-ttu-id="97f79-365">In **Centro connessioni di rete e condivisione** scegliere l'interfaccia di rete.</span><span class="sxs-lookup"><span data-stu-id="97f79-365">In **Network and Sharing Center**, click the network interface.</span></span>
   <span data-ttu-id="97f79-366">![Interfaccia di rete](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/26-networkinterface.png)</span><span class="sxs-lookup"><span data-stu-id="97f79-366">![Network interface](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/26-networkinterface.png)</span></span>

5. <span data-ttu-id="97f79-367">Fare clic su **Proprietà**.</span><span class="sxs-lookup"><span data-stu-id="97f79-367">Click **Properties**.</span></span>
6. <span data-ttu-id="97f79-368">Selezionare **Protocollo Internet versione 4 (TCP/IPv4)** e fare clic su **Proprietà**.</span><span class="sxs-lookup"><span data-stu-id="97f79-368">Select **Internet Protocol Version 4 (TCP/IPv4)** and click **Properties**.</span></span>
7. <span data-ttu-id="97f79-369">Selezionare **Utilizza i seguenti indirizzi server DNS** e specificare l'indirizzo del controller di dominio primario in **Server DNS preferito**.</span><span class="sxs-lookup"><span data-stu-id="97f79-369">Select **Use the following DNS server addresses** and specify the address of the primary domain controller in **Preferred DNS server**.</span></span>
8. <span data-ttu-id="97f79-370">Fare clic su **OK** e quindi su **Chiudi** per eseguire il commit delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="97f79-370">Click **OK**, and then **Close** to commit the changes.</span></span> <span data-ttu-id="97f79-371">A questo punto è possibile aggiungere la macchina virtuale a **corp.contoso.com**.</span><span class="sxs-lookup"><span data-stu-id="97f79-371">You are now able to join the VM to **corp.contoso.com**.</span></span>

   >[!IMPORTANT]
   ><span data-ttu-id="97f79-372">Se si perde la connessione al desktop remoto dopo avere modificato l'impostazione DNS, passare al portale di Azure e riavviare la macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="97f79-372">If you lose the connection to your remote desktop after changing the DNS setting, go to the Azure portal and restart the virtual machine.</span></span>

9. <span data-ttu-id="97f79-373">Dal desktop remoto al controller di dominio secondario aprire il **dashboard di Server Manager**.</span><span class="sxs-lookup"><span data-stu-id="97f79-373">From the remote desktop to the secondary domain controller, open **Server Manager Dashboard**.</span></span>
10. <span data-ttu-id="97f79-374">Fare clic sul collegamento **Aggiungi ruoli e funzionalità** sul dashboard.</span><span class="sxs-lookup"><span data-stu-id="97f79-374">Click the **Add roles and features** link on the dashboard.</span></span>

    ![Server Manager - Aggiungere ruoli](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
11. <span data-ttu-id="97f79-376">Selezionare **Avanti** fino a visualizzare la sezione **Ruoli server**.</span><span class="sxs-lookup"><span data-stu-id="97f79-376">Select **Next** until you get to the **Server Roles** section.</span></span>
12. <span data-ttu-id="97f79-377">Selezionare i ruoli **Active Directory Domain Services** e **Server DNS**.</span><span class="sxs-lookup"><span data-stu-id="97f79-377">Select the **Active Directory Domain Services** and **DNS Server** roles.</span></span> <span data-ttu-id="97f79-378">Quando richiesto, aggiungere eventuali funzionalità aggiuntive necessarie per questi ruoli.</span><span class="sxs-lookup"><span data-stu-id="97f79-378">When you're prompted, add any additional features that are required by these roles.</span></span>
13. <span data-ttu-id="97f79-379">Dopo l'installazione delle funzionalità, tornare al dashboard **Server Manager** .</span><span class="sxs-lookup"><span data-stu-id="97f79-379">After the features finish installing, return to the **Server Manager** dashboard.</span></span>
14. <span data-ttu-id="97f79-380">Selezionare la nuova opzione **Servizi di dominio di Active Directory** nel riquadro di sinistra.</span><span class="sxs-lookup"><span data-stu-id="97f79-380">Select the new **AD DS** option on the left-hand pane.</span></span>
15. <span data-ttu-id="97f79-381">Fare clic sul collegamento **Altro** sulla barra di avviso gialla.</span><span class="sxs-lookup"><span data-stu-id="97f79-381">Click the **More** link on the yellow warning bar.</span></span>
16. <span data-ttu-id="97f79-382">Nella colonna **Azione** della finestra di dialogo **Dettagli attività tutti i server** fare clic su **Alza di livello il server a controller di dominio**.</span><span class="sxs-lookup"><span data-stu-id="97f79-382">In the **Action** column of the **All Server Task Details** dialog, click **Promote this server to a domain controller**.</span></span>
17. <span data-ttu-id="97f79-383">In **Configurazione distribuzione** selezionare **Aggiungi un controller di dominio a un dominio esistente**.</span><span class="sxs-lookup"><span data-stu-id="97f79-383">Under **Deployment Configuration**, select **Add a domain controller to an existing domain**.</span></span>
   <span data-ttu-id="97f79-384">![Configurazione distribuzione](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/28-deploymentconfig.png)</span><span class="sxs-lookup"><span data-stu-id="97f79-384">![Deployment configuration](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/28-deploymentconfig.png)</span></span>
18. <span data-ttu-id="97f79-385">Fare clic su **Seleziona**.</span><span class="sxs-lookup"><span data-stu-id="97f79-385">Click **Select**.</span></span>
19. <span data-ttu-id="97f79-386">Connettersi usando l'account dell'amministratore (**CORP.CONTOSO.COM\domainadmin**) e la password (**Contoso!0000**).</span><span class="sxs-lookup"><span data-stu-id="97f79-386">Connect by using the administrator account (**CORP.CONTOSO.COM\domainadmin**) and password (**Contoso!0000**).</span></span>
20. <span data-ttu-id="97f79-387">In **Selezionare un dominio dalla foresta** fare clic sul dominio e quindi su **OK**.</span><span class="sxs-lookup"><span data-stu-id="97f79-387">In **Select a domain from the forest**, click your domain, and then click **OK**.</span></span>
21. <span data-ttu-id="97f79-388">In **Opzioni controller di dominio** usare i valori predefiniti e impostare una password DSRM.</span><span class="sxs-lookup"><span data-stu-id="97f79-388">In **Domain Controller Options**, use the default values and set a DSRM password.</span></span>

   >[!NOTE]
   ><span data-ttu-id="97f79-389">Nella pagina **Opzioni DNS** è possibile che venga visualizzato un avviso indicante che non è possibile creare una delega per questo server DNS.</span><span class="sxs-lookup"><span data-stu-id="97f79-389">The **DNS Options** page might warn you that a delegation for this DNS server can't be created.</span></span> <span data-ttu-id="97f79-390">È possibile ignorare questo avviso in ambienti non di produzione.</span><span class="sxs-lookup"><span data-stu-id="97f79-390">You can ignore this warning in non-production environments.</span></span>
22. <span data-ttu-id="97f79-391">Fare clic su **Avanti** fino a quando non viene visualizzato il controllo **Prerequisiti**.</span><span class="sxs-lookup"><span data-stu-id="97f79-391">Click **Next** until the dialog reaches the **Prerequisites** check.</span></span> <span data-ttu-id="97f79-392">Fare clic su **Installa**.</span><span class="sxs-lookup"><span data-stu-id="97f79-392">Then click **Install**.</span></span>

<span data-ttu-id="97f79-393">Quando il server completa le modifiche alla configurazione, riavviare il server.</span><span class="sxs-lookup"><span data-stu-id="97f79-393">After the server finishes the configuration changes, restart the server.</span></span>

### <a name="add-the-private-ip-address-to-the-second-domain-controller-to-the-vpn-dns-server"></a><span data-ttu-id="97f79-394">Aggiungere l'indirizzo IP privato del secondo controller di dominio al server DNS della VPN</span><span class="sxs-lookup"><span data-stu-id="97f79-394">Add the Private IP Address to the second domain controller to the VPN DNS Server</span></span>

<span data-ttu-id="97f79-395">Nel portale di Azure, nella rete virtuale modificare il server DNS in modo da includere l'indirizzo IP del controller di dominio secondario.</span><span class="sxs-lookup"><span data-stu-id="97f79-395">In the Azure portal, under virtual network, change the DNS Server to include the IP address of the secondary domain controller.</span></span> <span data-ttu-id="97f79-396">Ciò consente la ridondanza del servizio DNS.</span><span class="sxs-lookup"><span data-stu-id="97f79-396">This allows the DNS service redundancy.</span></span>

### <span data-ttu-id="97f79-397"><a name=DomainAccounts></a> Configurare gli account di dominio</span><span class="sxs-lookup"><span data-stu-id="97f79-397"><a name=DomainAccounts></a> Configure the domain accounts</span></span>

<span data-ttu-id="97f79-398">Nei passaggi successivi vengono configurati gli account Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="97f79-398">In the next steps, you configure the Active Directory accounts.</span></span> <span data-ttu-id="97f79-399">La tabella seguente illustra gli account:</span><span class="sxs-lookup"><span data-stu-id="97f79-399">The following table shows the accounts:</span></span>

| |<span data-ttu-id="97f79-400">Account di installazione</span><span class="sxs-lookup"><span data-stu-id="97f79-400">Installation account</span></span><br/> |<span data-ttu-id="97f79-401">sqlserver-0</span><span class="sxs-lookup"><span data-stu-id="97f79-401">sqlserver-0</span></span> <br/><span data-ttu-id="97f79-402">Account del servizio SQL Agent e SQL Server</span><span class="sxs-lookup"><span data-stu-id="97f79-402">SQL Server and SQL Agent Service account</span></span> |<span data-ttu-id="97f79-403">sqlserver-1</span><span class="sxs-lookup"><span data-stu-id="97f79-403">sqlserver-1</span></span><br/><span data-ttu-id="97f79-404">Account del servizio SQL Agent e SQL Server</span><span class="sxs-lookup"><span data-stu-id="97f79-404">SQL Server and SQL Agent Service account</span></span>
| --- | --- | --- | ---
|<span data-ttu-id="97f79-405">**Nome**</span><span class="sxs-lookup"><span data-stu-id="97f79-405">**First Name**</span></span> |<span data-ttu-id="97f79-406">Installa</span><span class="sxs-lookup"><span data-stu-id="97f79-406">Install</span></span> |<span data-ttu-id="97f79-407">SQLSvc1</span><span class="sxs-lookup"><span data-stu-id="97f79-407">SQLSvc1</span></span> | <span data-ttu-id="97f79-408">SQLSvc2</span><span class="sxs-lookup"><span data-stu-id="97f79-408">SQLSvc2</span></span>
|<span data-ttu-id="97f79-409">**Utente SamAccountName**</span><span class="sxs-lookup"><span data-stu-id="97f79-409">**User SamAccountName**</span></span> |<span data-ttu-id="97f79-410">Installa</span><span class="sxs-lookup"><span data-stu-id="97f79-410">Install</span></span> |<span data-ttu-id="97f79-411">SQLSvc1</span><span class="sxs-lookup"><span data-stu-id="97f79-411">SQLSvc1</span></span> | <span data-ttu-id="97f79-412">SQLSvc2</span><span class="sxs-lookup"><span data-stu-id="97f79-412">SQLSvc2</span></span>

<span data-ttu-id="97f79-413">Usare i passaggi seguenti per creare ogni account.</span><span class="sxs-lookup"><span data-stu-id="97f79-413">Use the following steps to create each account.</span></span>

1. <span data-ttu-id="97f79-414">Accedere alla macchina virtuale **ad-primary-dc**.</span><span class="sxs-lookup"><span data-stu-id="97f79-414">Sign in to the **ad-primary-dc** machine.</span></span>
2. <span data-ttu-id="97f79-415">In **Server Manager** selezionare **Strumenti** e quindi fare clic su **Centro di amministrazione di Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="97f79-415">In **Server Manager**, select **Tools**, and then click **Active Directory Administrative Center**.</span></span>   
3. <span data-ttu-id="97f79-416">Selezionare **corp (local)** nel riquadro di sinistra.</span><span class="sxs-lookup"><span data-stu-id="97f79-416">Select **corp (local)** from the left pane.</span></span>
4. <span data-ttu-id="97f79-417">Nel riquadro **Attività** a destra selezionare **Nuovo** e quindi fare clic su **Utente**.</span><span class="sxs-lookup"><span data-stu-id="97f79-417">On the right **Tasks** pane, select **New**, and then click **User**.</span></span>
   <span data-ttu-id="97f79-418">![Centro di amministrazione di Active Directory](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/29-addcnewuser.png)</span><span class="sxs-lookup"><span data-stu-id="97f79-418">![Active Directory Administrative Center](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/29-addcnewuser.png)</span></span>

   >[!TIP]
   ><span data-ttu-id="97f79-419">Impostare una password complessa per ogni account.</span><span class="sxs-lookup"><span data-stu-id="97f79-419">Set a complex password for each account.</span></span><br/> <span data-ttu-id="97f79-420">Per gli ambienti non di produzione impostare l'account utente senza scadenza.</span><span class="sxs-lookup"><span data-stu-id="97f79-420">For non-production environments, set the user account to never expire.</span></span>

5. <span data-ttu-id="97f79-421">Fare clic su **OK** per creare l'utente.</span><span class="sxs-lookup"><span data-stu-id="97f79-421">Click **OK** to create the user.</span></span>
6. <span data-ttu-id="97f79-422">Ripetere i passaggi precedenti per ognuno dei tre account.</span><span class="sxs-lookup"><span data-stu-id="97f79-422">Repeat the preceding steps for each of the three accounts.</span></span>

### <a name="grant-the-required-permissions-to-the-installation-account"></a><span data-ttu-id="97f79-423">Concedere le autorizzazioni necessarie all'account di installazione</span><span class="sxs-lookup"><span data-stu-id="97f79-423">Grant the required permissions to the installation account</span></span>
1. <span data-ttu-id="97f79-424">Nel **Centro di amministrazione di Active Directory** selezionare **corp (local)** nel riquadro di sinistra.</span><span class="sxs-lookup"><span data-stu-id="97f79-424">In the **Active Directory Administrative Center**, select **corp (local)** in the left pane.</span></span> <span data-ttu-id="97f79-425">Nel riquadro **Attività** a destra fare quindi clic su **Proprietà**.</span><span class="sxs-lookup"><span data-stu-id="97f79-425">Then in the right-hand **Tasks** pane, click **Properties**.</span></span>

    ![Proprietà utente CORP](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/31-addcproperties.png)
2. <span data-ttu-id="97f79-427">Selezionare **Estensioni**, quindi fare clic sul pulsante **Avanzate** nella scheda **Sicurezza**.</span><span class="sxs-lookup"><span data-stu-id="97f79-427">Select **Extensions**, and then click the **Advanced** button on the **Security** tab.</span></span>
3. <span data-ttu-id="97f79-428">Nella finestra di dialogo **Impostazioni avanzate di sicurezza per corp** fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="97f79-428">In the **Advanced Security Settings for corp** dialog, click **Add**.</span></span>
4. <span data-ttu-id="97f79-429">Fare clic su **Seleziona un'entità**, cercare **CORP\Install** e quindi fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="97f79-429">Click **Select a principal**, search for **CORP\Install**, and then click **OK**.</span></span>
5. <span data-ttu-id="97f79-430">Selezionare la casella di controllo **Leggi tutte le proprietà**.</span><span class="sxs-lookup"><span data-stu-id="97f79-430">Select the **Read all properties** check box.</span></span>

6. <span data-ttu-id="97f79-431">Selezionare la casella di controllo **Create Computer objects** (Crea oggetti computer).</span><span class="sxs-lookup"><span data-stu-id="97f79-431">Select the **Create Computer objects** check box.</span></span>

     ![Autorizzazioni utente Corp](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/33-addpermissions.png)
7. <span data-ttu-id="97f79-433">Fare clic su **OK** e quindi di nuovo clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="97f79-433">Click **OK**, and then click **OK** again.</span></span> <span data-ttu-id="97f79-434">Chiudere la finestra delle proprietà di **corp**.</span><span class="sxs-lookup"><span data-stu-id="97f79-434">Close the **corp** properties window.</span></span>

<span data-ttu-id="97f79-435">Dopo aver completato la configurazione di Active Directory e degli oggetti utente, creare due macchine virtuali di SQL Server e una macchina virtuale server di controllo.</span><span class="sxs-lookup"><span data-stu-id="97f79-435">Now that you've finished configuring Active Directory and the user objects, create two SQL Server VMs and a witness server VM.</span></span> <span data-ttu-id="97f79-436">Aggiungere quindi tutte e tre le macchine virtuali al dominio.</span><span class="sxs-lookup"><span data-stu-id="97f79-436">Then join all three to the domain.</span></span>

## <a name="create-sql-server-vms"></a><span data-ttu-id="97f79-437">Creare le macchine virtuali di SQL Server</span><span class="sxs-lookup"><span data-stu-id="97f79-437">Create SQL Server VMs</span></span>

<span data-ttu-id="97f79-438">Creare altre tre macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="97f79-438">Create three additional virtual machines.</span></span> <span data-ttu-id="97f79-439">La soluzione richiede due macchine virtuali con istanze di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="97f79-439">The solution requires two virtual machines with SQL Server instances.</span></span> <span data-ttu-id="97f79-440">Una terza macchina virtuale fungerà da controllo.</span><span class="sxs-lookup"><span data-stu-id="97f79-440">A third virtual machine will function as a witness.</span></span> <span data-ttu-id="97f79-441">Windows Server 2016 può usare un [cloud di controllo](http://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness); tuttavia, per uniformità con sistemi operativi precedenti, in questo documento si usa una macchina virtuale come controllo.</span><span class="sxs-lookup"><span data-stu-id="97f79-441">Windows Server 2016 can use a [cloud witness](http://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness), however for consistency with previous operating systems this document uses a virtual machine for a witness.</span></span>  

<span data-ttu-id="97f79-442">Prima di procedere, considerare le seguenti decisioni di progettazione.</span><span class="sxs-lookup"><span data-stu-id="97f79-442">Before you proceed consider the following deisign decisions.</span></span>

* <span data-ttu-id="97f79-443">**Archiviazione - Azure Managed Disks**</span><span class="sxs-lookup"><span data-stu-id="97f79-443">**Storage - Azure Managed Disks**</span></span>

   <span data-ttu-id="97f79-444">Per l'archiviazione delle macchine virtuali, usare Azure Managed Disks.</span><span class="sxs-lookup"><span data-stu-id="97f79-444">For the virtual machine storage, use Azure Managed Disks.</span></span> <span data-ttu-id="97f79-445">Microsoft consiglia Managed Disks per le macchine virtuali di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="97f79-445">Microsoft recommends Managed Disks for SQL Server virtual machines.</span></span> <span data-ttu-id="97f79-446">Managed Disks gestisce automaticamente le risorse di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="97f79-446">Managed Disks handles storage behind the scenes.</span></span> <span data-ttu-id="97f79-447">Inoltre, quando le macchine virtuali con Managed Disks sono nello stesso set di disponibilità, Azure distribuisce le risorse di archiviazione in modo da garantire la ridondanza appropriata.</span><span class="sxs-lookup"><span data-stu-id="97f79-447">In addition, when virtual machines with Managed Disks are in the same availability set, Azure distributes the storage resources to provide appropriate redundancy.</span></span> <span data-ttu-id="97f79-448">Per altre informazioni, vedere [Panoramica di Azure Managed Disks](../managed-disks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="97f79-448">For additional information, see [Azure Managed Disks Overview](../managed-disks-overview.md).</span></span> <span data-ttu-id="97f79-449">Per informazioni dettagliate sui dischi gestiti in un set di disponibilità, vedere [Usare Managed Disks per le macchine virtuali nel set di disponibilità](../manage-availability.md#use-managed-disks-for-vms-in-an-availability-set).</span><span class="sxs-lookup"><span data-stu-id="97f79-449">For specifics about managed disks in an availability set, see [Use Managed Disks for VMs in an availability set](../manage-availability.md#use-managed-disks-for-vms-in-an-availability-set).</span></span>

* <span data-ttu-id="97f79-450">**Rete - Indirizzi IP privati nell'ambiente di produzione**</span><span class="sxs-lookup"><span data-stu-id="97f79-450">**Network - Private IP addresses in production**</span></span>

   <span data-ttu-id="97f79-451">Per le macchine virtuali, in questa esercitazione si usano indirizzi IP pubblici.</span><span class="sxs-lookup"><span data-stu-id="97f79-451">For the virtual machines, this tutorial uses public IP addresses.</span></span> <span data-ttu-id="97f79-452">In questo modo la connessione remota può avvenire direttamente alla macchina virtuale tramite internet, semplificando la procedura di configurazione.</span><span class="sxs-lookup"><span data-stu-id="97f79-452">This enables remote connection directly to the virtual machine over the internet - it makes configuration steps easier.</span></span> <span data-ttu-id="97f79-453">Negli ambienti di produzione Microsoft consiglia di usare solo indirizzi IP privati al fine di ridurre la superficie di vulnerabilità della risorsa della VM dell'istanza di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="97f79-453">In production environments, Microsoft recommends only private IP addresses in order to reduce the vulnerability footprint of the SQL Server instance VM resource.</span></span>

### <a name="create-and-configure-the-sql-server-vms"></a><span data-ttu-id="97f79-454">Creare e configurare le VM di SQL Server</span><span class="sxs-lookup"><span data-stu-id="97f79-454">Create and configure the SQL Server VMs</span></span>
<span data-ttu-id="97f79-455">Creare successivamente tre VM, tra cui due VM di SQL Server e una VM per un nodo del cluster aggiuntivo.</span><span class="sxs-lookup"><span data-stu-id="97f79-455">Next, create three VMs--two SQL Server VMs and a VM for an additional cluster node.</span></span> <span data-ttu-id="97f79-456">Per creare ogni VM, tornare al gruppo di risorse **SQL-HA-RG**, fare clic su **Aggiungi**, cercare l'elemento della raccolta appropriato, fare clic su **Macchina virtuale**, quindi su **Da raccolta**.</span><span class="sxs-lookup"><span data-stu-id="97f79-456">To create each of the VMs, go back to the **SQL-HA-RG** resource group, click **Add**, search for the appropriate gallery item, click **Virtual Machine**, and then click **From Gallery**.</span></span> <span data-ttu-id="97f79-457">Usare le informazioni nella tabella seguente per facilitare la creazione di VM:</span><span class="sxs-lookup"><span data-stu-id="97f79-457">Use the information in the following table to help you create the VMs:</span></span>


| <span data-ttu-id="97f79-458">Page</span><span class="sxs-lookup"><span data-stu-id="97f79-458">Page</span></span> | <span data-ttu-id="97f79-459">VM1</span><span class="sxs-lookup"><span data-stu-id="97f79-459">VM1</span></span> | <span data-ttu-id="97f79-460">VM2</span><span class="sxs-lookup"><span data-stu-id="97f79-460">VM2</span></span> | <span data-ttu-id="97f79-461">VM3</span><span class="sxs-lookup"><span data-stu-id="97f79-461">VM3</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="97f79-462">Selezionare l'elemento della raccolta appropriato</span><span class="sxs-lookup"><span data-stu-id="97f79-462">Select the appropriate gallery item</span></span> |<span data-ttu-id="97f79-463">**Windows Server 2016 Datacenter**</span><span class="sxs-lookup"><span data-stu-id="97f79-463">**Windows Server 2016 Datacenter**</span></span> |<span data-ttu-id="97f79-464">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span><span class="sxs-lookup"><span data-stu-id="97f79-464">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span></span> |<span data-ttu-id="97f79-465">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span><span class="sxs-lookup"><span data-stu-id="97f79-465">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span></span> |
| <span data-ttu-id="97f79-466">**Elementi di base**</span><span class="sxs-lookup"><span data-stu-id="97f79-466">Virtual machine configuration **Basics**</span></span> |<span data-ttu-id="97f79-467">**Nome** = cluster-fsw</span><span class="sxs-lookup"><span data-stu-id="97f79-467">**Name** = cluster-fsw</span></span><br/><span data-ttu-id="97f79-468">**Nome utente** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="97f79-468">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="97f79-469">**Password** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="97f79-469">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="97f79-470">**Sottoscrizione** = sottoscrizione</span><span class="sxs-lookup"><span data-stu-id="97f79-470">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="97f79-471">**Gruppo di risorse** = SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="97f79-471">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="97f79-472">**Posizione** = posizione di Azure</span><span class="sxs-lookup"><span data-stu-id="97f79-472">**Location** = Your azure location</span></span> |<span data-ttu-id="97f79-473">**Nome** = sqlserver-0</span><span class="sxs-lookup"><span data-stu-id="97f79-473">**Name** = sqlserver-0</span></span><br/><span data-ttu-id="97f79-474">**Nome utente** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="97f79-474">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="97f79-475">**Password** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="97f79-475">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="97f79-476">**Sottoscrizione** = sottoscrizione</span><span class="sxs-lookup"><span data-stu-id="97f79-476">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="97f79-477">**Gruppo di risorse** = SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="97f79-477">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="97f79-478">**Posizione** = posizione di Azure</span><span class="sxs-lookup"><span data-stu-id="97f79-478">**Location** = Your azure location</span></span> |<span data-ttu-id="97f79-479">**Nome** = sqlserver-1</span><span class="sxs-lookup"><span data-stu-id="97f79-479">**Name** = sqlserver-1</span></span><br/><span data-ttu-id="97f79-480">**Nome utente** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="97f79-480">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="97f79-481">**Password** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="97f79-481">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="97f79-482">**Sottoscrizione** = sottoscrizione</span><span class="sxs-lookup"><span data-stu-id="97f79-482">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="97f79-483">**Gruppo di risorse** = SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="97f79-483">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="97f79-484">**Posizione** = posizione di Azure</span><span class="sxs-lookup"><span data-stu-id="97f79-484">**Location** = Your azure location</span></span> |
| <span data-ttu-id="97f79-485">Configurazione della macchina virtuale - **Dimensioni**</span><span class="sxs-lookup"><span data-stu-id="97f79-485">Virtual machine configuration **Size**</span></span> |<span data-ttu-id="97f79-486">**DIMENSIONI** = DS1\_V2 (1 memoria centrale, 3,5 GB)</span><span class="sxs-lookup"><span data-stu-id="97f79-486">**SIZE** = DS1\_V2 (1 core, 3.5 GB)</span></span> |<span data-ttu-id="97f79-487">**DIMENSIONI** = DS2\_V2 (2 memorie centrali, 7 GB)</span><span class="sxs-lookup"><span data-stu-id="97f79-487">**SIZE** = DS2\_V2 (2 cores, 7 GB)</span></span></br><span data-ttu-id="97f79-488">Le dimensioni devono supportare l'archiviazione su unità SSD (Supporto disco Premium</span><span class="sxs-lookup"><span data-stu-id="97f79-488">The size must support SSD storage (Premium disk support.</span></span> <span data-ttu-id="97f79-489">))</span><span class="sxs-lookup"><span data-stu-id="97f79-489">))</span></span> |<span data-ttu-id="97f79-490">**DIMENSIONI** = DS2\_V2 (2 memorie centrali, 7 GB)</span><span class="sxs-lookup"><span data-stu-id="97f79-490">**SIZE** = DS2\_V2 (2 cores, 7 GB)</span></span> |
| <span data-ttu-id="97f79-491">Configurazione della macchina virtuale - **Impostazioni**</span><span class="sxs-lookup"><span data-stu-id="97f79-491">Virtual machine configuration **Settings**</span></span> |<span data-ttu-id="97f79-492">**Archiviazione**: Usa dischi gestiti.</span><span class="sxs-lookup"><span data-stu-id="97f79-492">**Storage**: Use managed disks.</span></span><br/><span data-ttu-id="97f79-493">**Rete virtuale** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="97f79-493">**Virtual network** = autoHAVNET</span></span><br/><span data-ttu-id="97f79-494">**Subnet** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="97f79-494">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="97f79-495">**Indirizzo IP pubblico** generato automaticamente.</span><span class="sxs-lookup"><span data-stu-id="97f79-495">**Public IP address** automatically generated.</span></span><br/><span data-ttu-id="97f79-496">**Gruppo di sicurezza di rete** = nessuno</span><span class="sxs-lookup"><span data-stu-id="97f79-496">**Network security group** = None</span></span><br/><span data-ttu-id="97f79-497">**Monitoraggio e diagnostica** = abilitato</span><span class="sxs-lookup"><span data-stu-id="97f79-497">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="97f79-498">**Account di archiviazione di diagnostica**: usare un account di archiviazione generato automaticamente</span><span class="sxs-lookup"><span data-stu-id="97f79-498">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="97f79-499">**Set di disponibilità** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="97f79-499">**Availability set** = sqlAvailabilitySet</span></span><br/> |<span data-ttu-id="97f79-500">**Archiviazione**: Usa dischi gestiti.</span><span class="sxs-lookup"><span data-stu-id="97f79-500">**Storage**: Use managed disks.</span></span><br/><span data-ttu-id="97f79-501">**Rete virtuale** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="97f79-501">**Virtual network** = autoHAVNET</span></span><br/><span data-ttu-id="97f79-502">**Subnet** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="97f79-502">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="97f79-503">**Indirizzo IP pubblico** generato automaticamente.</span><span class="sxs-lookup"><span data-stu-id="97f79-503">**Public IP address** automatically generated.</span></span><br/><span data-ttu-id="97f79-504">**Gruppo di sicurezza di rete** = nessuno</span><span class="sxs-lookup"><span data-stu-id="97f79-504">**Network security group** = None</span></span><br/><span data-ttu-id="97f79-505">**Monitoraggio e diagnostica** = abilitato</span><span class="sxs-lookup"><span data-stu-id="97f79-505">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="97f79-506">**Account di archiviazione di diagnostica**: usare un account di archiviazione generato automaticamente</span><span class="sxs-lookup"><span data-stu-id="97f79-506">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="97f79-507">**Set di disponibilità** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="97f79-507">**Availability set** = sqlAvailabilitySet</span></span><br/> |<span data-ttu-id="97f79-508">**Archiviazione**: Usa dischi gestiti.</span><span class="sxs-lookup"><span data-stu-id="97f79-508">**Storage**: Use managed disks.</span></span><br/><span data-ttu-id="97f79-509">**Rete virtuale** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="97f79-509">**Virtual network** = autoHAVNET</span></span><br/><span data-ttu-id="97f79-510">**Subnet** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="97f79-510">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="97f79-511">**Indirizzo IP pubblico** generato automaticamente.</span><span class="sxs-lookup"><span data-stu-id="97f79-511">**Public IP address** automatically generated.</span></span><br/><span data-ttu-id="97f79-512">**Gruppo di sicurezza di rete** = nessuno</span><span class="sxs-lookup"><span data-stu-id="97f79-512">**Network security group** = None</span></span><br/><span data-ttu-id="97f79-513">**Monitoraggio e diagnostica** = abilitato</span><span class="sxs-lookup"><span data-stu-id="97f79-513">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="97f79-514">**Account di archiviazione di diagnostica**: usare un account di archiviazione generato automaticamente</span><span class="sxs-lookup"><span data-stu-id="97f79-514">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="97f79-515">**Set di disponibilità** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="97f79-515">**Availability set** = sqlAvailabilitySet</span></span><br/> |
| <span data-ttu-id="97f79-516">Configurazione della macchina virtuale - **Impostazioni SQL Server**</span><span class="sxs-lookup"><span data-stu-id="97f79-516">Virtual machine configuration **SQL Server settings**</span></span> |<span data-ttu-id="97f79-517">Non applicabile</span><span class="sxs-lookup"><span data-stu-id="97f79-517">Not applicable</span></span> |<span data-ttu-id="97f79-518">**Connettività SQL** = privata (nella rete virtuale)</span><span class="sxs-lookup"><span data-stu-id="97f79-518">**SQL connectivity** = Private (within Virtual Network)</span></span><br/><span data-ttu-id="97f79-519">**Porta** = 1433</span><span class="sxs-lookup"><span data-stu-id="97f79-519">**Port** = 1433</span></span><br/><span data-ttu-id="97f79-520">**Autenticazione SQL** = disabilitata</span><span class="sxs-lookup"><span data-stu-id="97f79-520">**SQL Authentication** = Disable</span></span><br/><span data-ttu-id="97f79-521">**Configurazione dell'archiviazione** = generale</span><span class="sxs-lookup"><span data-stu-id="97f79-521">**Storage configuration** = General</span></span><br/><span data-ttu-id="97f79-522">**Applicazione automatica delle patch** = domenica alle 2:00</span><span class="sxs-lookup"><span data-stu-id="97f79-522">**Automated patching** = Sunday at 2:00</span></span><br/><span data-ttu-id="97f79-523">**Backup automatizzato** = disabilitato</span><span class="sxs-lookup"><span data-stu-id="97f79-523">**Automated backup** = Disabled</span></span></br><span data-ttu-id="97f79-524">**Integrazione dell'insieme di credenziali delle chiavi di Azure** = Disabilitata</span><span class="sxs-lookup"><span data-stu-id="97f79-524">**Azure Key Vault integration** = Disabled</span></span> |<span data-ttu-id="97f79-525">**Connettività SQL** = privata (nella rete virtuale)</span><span class="sxs-lookup"><span data-stu-id="97f79-525">**SQL connectivity** = Private (within Virtual Network)</span></span><br/><span data-ttu-id="97f79-526">**Porta** = 1433</span><span class="sxs-lookup"><span data-stu-id="97f79-526">**Port** = 1433</span></span><br/><span data-ttu-id="97f79-527">**Autenticazione SQL** = disabilitata</span><span class="sxs-lookup"><span data-stu-id="97f79-527">**SQL Authentication** = Disable</span></span><br/><span data-ttu-id="97f79-528">**Configurazione dell'archiviazione** = generale</span><span class="sxs-lookup"><span data-stu-id="97f79-528">**Storage configuration** = General</span></span><br/><span data-ttu-id="97f79-529">**Applicazione automatica delle patch** = domenica alle 2:00</span><span class="sxs-lookup"><span data-stu-id="97f79-529">**Automated patching** = Sunday at 2:00</span></span><br/><span data-ttu-id="97f79-530">**Backup automatizzato** = disabilitato</span><span class="sxs-lookup"><span data-stu-id="97f79-530">**Automated backup** = Disabled</span></span></br><span data-ttu-id="97f79-531">**Integrazione dell'insieme di credenziali delle chiavi di Azure** = Disabilitata</span><span class="sxs-lookup"><span data-stu-id="97f79-531">**Azure Key Vault integration** = Disabled</span></span> |

<br/>

> [!NOTE]
> <span data-ttu-id="97f79-532">Le dimensioni delle macchine virtuali qui suggerite sono pensate per il test dei gruppi di disponibilità nelle VM di Azure.</span><span class="sxs-lookup"><span data-stu-id="97f79-532">The machine sizes suggested here are meant for testing availability groups in Azure VMs.</span></span> <span data-ttu-id="97f79-533">Per ottenere prestazioni ottimali su carichi di lavoro di produzione, vedere le dimensioni e la configurazione consigliate per la macchina virtuale di SQL Server in [Procedure consigliate per le prestazioni per SQL Server in Macchine virtuali di Azure](virtual-machines-windows-sql-performance.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="97f79-533">For the best performance on production workloads, see the recommendations for SQL Server machine sizes and configuration in [Performance best practices for SQL Server in Azure virtual machines](virtual-machines-windows-sql-performance.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>
>
>

<span data-ttu-id="97f79-534">Dopo aver effettuato il provisioning completo delle tre macchine virtuali, sarà necessario aggiungerle al dominio **corp.contoso.com** e concedere alle macchine i diritti amministrativi di CORP\Install.</span><span class="sxs-lookup"><span data-stu-id="97f79-534">After the three VMs are fully provisioned, you need to join them to the **corp.contoso.com** domain and grant CORP\Install administrative rights to the machines.</span></span>

### <span data-ttu-id="97f79-535"><a name="joinDomain"></a>Aggiungere i server al dominio</span><span class="sxs-lookup"><span data-stu-id="97f79-535"><a name="joinDomain"></a>Join the servers to the domain</span></span>

<span data-ttu-id="97f79-536">A questo punto è possibile aggiungere la macchina virtuale a **corp.contoso.com**. Eseguire le operazioni seguenti per le macchine virtuali di SQL Server e per il server di controllo della condivisione file:</span><span class="sxs-lookup"><span data-stu-id="97f79-536">You're now able to join the VMs to **corp.contoso.com**. Do the following for both the SQL Server VMs and the file share witness server:</span></span>

1. <span data-ttu-id="97f79-537">Connettersi in remoto alla macchina virtuale con **BUILTIN\DomainAdmin**.</span><span class="sxs-lookup"><span data-stu-id="97f79-537">Remotely connect to the virtual machine with **BUILTIN\DomainAdmin**.</span></span>
2. <span data-ttu-id="97f79-538">In **Server Manager** fare clic su **Server locale**.</span><span class="sxs-lookup"><span data-stu-id="97f79-538">In **Server Manager**, click **Local Server**.</span></span>
3. <span data-ttu-id="97f79-539">Fare clic sul collegamento **GRUPPO DI LAVORO**.</span><span class="sxs-lookup"><span data-stu-id="97f79-539">Click the **WORKGROUP** link.</span></span>
4. <span data-ttu-id="97f79-540">Nella sezione **Nome computer** fare clic su **Cambia**.</span><span class="sxs-lookup"><span data-stu-id="97f79-540">In the **Computer Name** section, click **Change**.</span></span>
5. <span data-ttu-id="97f79-541">Selezionare la casella di controllo **Dominio** e digitare **corp.contoso.com** nella casella di testo.</span><span class="sxs-lookup"><span data-stu-id="97f79-541">Select the **Domain** check box and type **corp.contoso.com** in the text box.</span></span> <span data-ttu-id="97f79-542">Fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="97f79-542">Click **OK**.</span></span>
6. <span data-ttu-id="97f79-543">Nella finestra di dialogo popup **Sicurezza di Windows** specificare le credenziali per l'account amministratore di dominio predefinito (**CORP\DomainAdmin**) e la password (**Contoso!0000**).</span><span class="sxs-lookup"><span data-stu-id="97f79-543">In the **Windows Security** popup dialog, specify the credentials for the default domain administrator account (**CORP\DomainAdmin**) and the password (**Contoso!0000**).</span></span>
7. <span data-ttu-id="97f79-544">uando viene visualizzato il messaggio di benvenuto nel dominio corp.contoso.com, fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="97f79-544">When you see the "Welcome to the corp.contoso.com domain" message, click **OK**.</span></span>
8. <span data-ttu-id="97f79-545">Fare clic su **Chiudi** e quindi su **Riavvia ora** nella finestra di dialogo popup.</span><span class="sxs-lookup"><span data-stu-id="97f79-545">Click **Close**, and then click **Restart Now** in the popup dialog.</span></span>

### <a name="add-the-corpinstall-user-as-an-administrator-on-each-cluster-vm"></a><span data-ttu-id="97f79-546">Aggiungere l'utente Corp\Install come amministratore in ogni VM del cluster</span><span class="sxs-lookup"><span data-stu-id="97f79-546">Add the Corp\Install user as an administrator on each cluster VM</span></span>

<span data-ttu-id="97f79-547">Dopo l'avvio di ogni macchina virtuale come membro del dominio, aggiungere **CORP\Install** come membro del gruppo di amministratori locale.</span><span class="sxs-lookup"><span data-stu-id="97f79-547">After each virtual machine restarts as a member of the domain, add **CORP\Install** as a member of the local administrators group.</span></span>

1. <span data-ttu-id="97f79-548">Attendere il riavvio della VM, quindi avviare di nuovo il file RDP dal controller di dominio primario per accedere a **sqlserver-0** usando l'account **CORP\DomainAdmin**.</span><span class="sxs-lookup"><span data-stu-id="97f79-548">Wait until the VM is restarted, then launch the RDP file again from the primary domain controller to sign in to **sqlserver-0** by using the **CORP\DomainAdmin** account.</span></span>
   >[!TIP]
   ><span data-ttu-id="97f79-549">Assicurarsi di accedere con l'account di amministratore di dominio.</span><span class="sxs-lookup"><span data-stu-id="97f79-549">Make sure that you sign in with the domain administrator account.</span></span> <span data-ttu-id="97f79-550">Nei passaggi precedenti è stato usato l'account amministratore BUILTIN.</span><span class="sxs-lookup"><span data-stu-id="97f79-550">In the previous steps, you were using the BUILT IN administrator account.</span></span> <span data-ttu-id="97f79-551">Ora che il server appartiene al dominio, usare l'account di dominio.</span><span class="sxs-lookup"><span data-stu-id="97f79-551">Now that the server is in the domain, use the domain account.</span></span> <span data-ttu-id="97f79-552">Nella sessione RDP specificare *DOMINIO*\\*NOME UTENTE*.</span><span class="sxs-lookup"><span data-stu-id="97f79-552">In your RDP session, specify *DOMAIN*\\*username*.</span></span>

2. <span data-ttu-id="97f79-553">In **Server Manager** selezionare **Strumenti**, quindi fare clic su **Gestione computer**.</span><span class="sxs-lookup"><span data-stu-id="97f79-553">In **Server Manager**, select **Tools**, and then click **Computer Management**.</span></span>
3. <span data-ttu-id="97f79-554">Nella finestra **Gestione computer** espandere **Utenti e gruppi locali**, quindi selezionare **Gruppi**.</span><span class="sxs-lookup"><span data-stu-id="97f79-554">In the **Computer Management** window, expand **Local Users and Groups**, and then select **Groups**.</span></span>
4. <span data-ttu-id="97f79-555">Fare doppio clic sul gruppo **Administrators** .</span><span class="sxs-lookup"><span data-stu-id="97f79-555">Double-click the **Administrators** group.</span></span>
5. <span data-ttu-id="97f79-556">Nella finestra di dialogo **Proprietà Administrators** fare clic su pulsante **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="97f79-556">In the **Administrators Properties** dialog, click the **Add** button.</span></span>
6. <span data-ttu-id="97f79-557">Immettere l'utente **CORP\Install** e quindi fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="97f79-557">Enter the user **CORP\Install**, and then click **OK**.</span></span>
7. <span data-ttu-id="97f79-558">Fare clic su **OK** per chiudere la finestra di dialogo **Proprietà Administrators**.</span><span class="sxs-lookup"><span data-stu-id="97f79-558">Click **OK** to close the **Administrator Properties** dialog.</span></span>
8. <span data-ttu-id="97f79-559">Ripetere i passaggi precedenti in **sqlserver-1** e **cluster-fsw**.</span><span class="sxs-lookup"><span data-stu-id="97f79-559">Repeat the previous steps on **sqlserver-1** and **cluster-fsw**.</span></span>

### <span data-ttu-id="97f79-560"><a name="setServiceAccount"></a>Impostare gli account del servizio SQL Server</span><span class="sxs-lookup"><span data-stu-id="97f79-560"><a name="setServiceAccount"></a>Set the SQL Server service accounts</span></span>

<span data-ttu-id="97f79-561">Impostare l'account del servizio SQL Server in ogni macchina virtuale di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="97f79-561">On each SQL Server VM, set the SQL Server service account.</span></span> <span data-ttu-id="97f79-562">Usare gli account creati in fase di [configurazione degli account di dominio](#DomainAccounts).</span><span class="sxs-lookup"><span data-stu-id="97f79-562">Use the accounts that you created when you [configured the domain accounts](#DomainAccounts).</span></span>

1. <span data-ttu-id="97f79-563">Aprire **Gestione configurazione SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="97f79-563">Open **SQL Server Configuration Manager**.</span></span>
2. <span data-ttu-id="97f79-564">Fare clic con il pulsante destro del mouse sul servizio SQL Server e scegliere **Proprietà**.</span><span class="sxs-lookup"><span data-stu-id="97f79-564">Right-click the SQL Server service, and then click **Properties**.</span></span>
3. <span data-ttu-id="97f79-565">Impostare l'account e la password.</span><span class="sxs-lookup"><span data-stu-id="97f79-565">Set the account and password.</span></span>
4. <span data-ttu-id="97f79-566">Ripetere questi passaggi per l'altra VM di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="97f79-566">Repeat these steps on the other SQL Server VM.</span></span>  

<span data-ttu-id="97f79-567">Per i gruppi di disponibilità di SQL Server, ogni VM di SQL Server deve essere eseguita come account di dominio.</span><span class="sxs-lookup"><span data-stu-id="97f79-567">For SQL Server availability groups, each SQL Server VM needs to run as a domain account.</span></span>

### <a name="create-a-sign-in-on-each-sql-server-vm-for-the-installation-account"></a><span data-ttu-id="97f79-568">Creare un accesso in ogni macchina virtuale di SQL Server per l'account di installazione</span><span class="sxs-lookup"><span data-stu-id="97f79-568">Create a sign-in on each SQL Server VM for the installation account</span></span>

<span data-ttu-id="97f79-569">Usare l'account di installazione (CORP\install) per configurare il gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="97f79-569">Use the installation account (CORP\install) to configure the availability group.</span></span> <span data-ttu-id="97f79-570">Questo account deve essere membro del ruolo del server predefinito **sysadmin** in ogni VM di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="97f79-570">This account needs to be a member of the **sysadmin** fixed server role on each SQL Server VM.</span></span> <span data-ttu-id="97f79-571">La procedura seguente crea un account di accesso per l'account di installazione:</span><span class="sxs-lookup"><span data-stu-id="97f79-571">The following steps create a sign-in for the installation account:</span></span>

1. <span data-ttu-id="97f79-572">Connettersi al server tramite Remote Desktop Protocol (RDP) usando l'account *\<MachineName\>\DomainAdmin*.</span><span class="sxs-lookup"><span data-stu-id="97f79-572">Connect to the server through the Remote Desktop Protocol (RDP) by using the *\<MachineName\>\DomainAdmin* account.</span></span>

1. <span data-ttu-id="97f79-573">Aprire SQL Server Management Studio e connettersi all'istanza locale di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="97f79-573">Open SQL Server Management Studio and connect to the local instance of SQL Server.</span></span>

1. <span data-ttu-id="97f79-574">In **Esplora oggetti** fare clic su **Sicurezza**.</span><span class="sxs-lookup"><span data-stu-id="97f79-574">In **Object Explorer**, click **Security**.</span></span>

1. <span data-ttu-id="97f79-575">Fare clic con il pulsante destro del mouse su **Account di accesso**.</span><span class="sxs-lookup"><span data-stu-id="97f79-575">Right-click **Logins**.</span></span> <span data-ttu-id="97f79-576">Fare clic su **Nuovo account di accesso**.</span><span class="sxs-lookup"><span data-stu-id="97f79-576">Click **New Login**.</span></span>

1. <span data-ttu-id="97f79-577">In **Account di accesso - Nuovo** fare clic su **Cerca**.</span><span class="sxs-lookup"><span data-stu-id="97f79-577">In **Login - New**, click **Search**.</span></span>

1. <span data-ttu-id="97f79-578">Fare clic su **Località**.</span><span class="sxs-lookup"><span data-stu-id="97f79-578">Click **Locations**.</span></span>

1. <span data-ttu-id="97f79-579">Immettere le credenziali di rete dell'amministratore di dominio.</span><span class="sxs-lookup"><span data-stu-id="97f79-579">Enter the domain administrator network credentials.</span></span>

1. <span data-ttu-id="97f79-580">Usare l'account di installazione.</span><span class="sxs-lookup"><span data-stu-id="97f79-580">Use the installation account.</span></span>

1. <span data-ttu-id="97f79-581">Impostare l'account di accesso come membro del ruolo del server predefinito **sysadmin**.</span><span class="sxs-lookup"><span data-stu-id="97f79-581">Set the sign-in to be a member of the **sysadmin** fixed server role.</span></span>

1. <span data-ttu-id="97f79-582">Fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="97f79-582">Click **OK**.</span></span>

<span data-ttu-id="97f79-583">Ripetere i passaggi precedenti nell'altra VM di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="97f79-583">Repeat the preceding steps on the other SQL Server VM.</span></span>

## <a name="add-failover-clustering-features-to-both-sql-server-vms"></a><span data-ttu-id="97f79-584">Aggiungere le funzionalità del cluster di failover a entrambe le VM di SQL Server</span><span class="sxs-lookup"><span data-stu-id="97f79-584">Add Failover Clustering features to both SQL Server VMs</span></span>

<span data-ttu-id="97f79-585">Per aggiungere le funzionalità del cluster di failover, seguire questa procedura in entrambe le VM di SQL Server:</span><span class="sxs-lookup"><span data-stu-id="97f79-585">To add Failover Clustering features, do the following on both SQL Server VMs:</span></span>

1. <span data-ttu-id="97f79-586">Connettersi alla macchina virtuale di SQL Server tramite Remote Desktop Protocol (RDP) usando l'account *CORP\install*.</span><span class="sxs-lookup"><span data-stu-id="97f79-586">Connect to the SQL Server virtual machine through the Remote Desktop Protocol (RDP) by using the *CORP\install* account.</span></span> <span data-ttu-id="97f79-587">Aprire **Server Manager > Dashboard**.</span><span class="sxs-lookup"><span data-stu-id="97f79-587">Open **Server Manager Dashboard**.</span></span>
2. <span data-ttu-id="97f79-588">Fare clic sul collegamento **Aggiungi ruoli e funzionalità** sul dashboard.</span><span class="sxs-lookup"><span data-stu-id="97f79-588">Click the **Add roles and features** link on the dashboard.</span></span>

    ![Server Manager - Aggiungere ruoli](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
3. <span data-ttu-id="97f79-590">Selezionare **Avanti** fino a visualizzare la sezione **Funzionalità server**.</span><span class="sxs-lookup"><span data-stu-id="97f79-590">Select **Next** until you get to the **Server Features** section.</span></span>
4. <span data-ttu-id="97f79-591">In **Funzionalità** selezionare **Clustering di failover**.</span><span class="sxs-lookup"><span data-stu-id="97f79-591">In **Features**, select **Failover Clustering**.</span></span>
5. <span data-ttu-id="97f79-592">Aggiungere le altre funzionalità necessarie.</span><span class="sxs-lookup"><span data-stu-id="97f79-592">Add any additional required features.</span></span>
6. <span data-ttu-id="97f79-593">Fare clic su **Installa** per aggiungere le funzionalità.</span><span class="sxs-lookup"><span data-stu-id="97f79-593">Click **Install** to add the features.</span></span>

<span data-ttu-id="97f79-594">Ripetere i passaggi nell'altra VM di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="97f79-594">Repeat the steps on the other SQL Server VM.</span></span>

## <a name="a-nameendpoint-firewall-configure-the-firewall-on-each-sql-server-vm"></a><span data-ttu-id="97f79-595"><a name="endpoint-firewall"> Configurare il firewall in ogni macchina virtuale di SQL Server</span><span class="sxs-lookup"><span data-stu-id="97f79-595"><a name="endpoint-firewall"> Configure the firewall on each SQL Server VM</span></span>

<span data-ttu-id="97f79-596">La soluzione richiede che le seguenti porte TCP siano aperte nel firewall:</span><span class="sxs-lookup"><span data-stu-id="97f79-596">The solution requires the following TCP ports to be open in the firewall:</span></span>

- <span data-ttu-id="97f79-597">**VM di SQL Server**:</span><span class="sxs-lookup"><span data-stu-id="97f79-597">**SQL Server VM**:</span></span><br/>
   <span data-ttu-id="97f79-598">Porta 1433 per un'istanza predefinita di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="97f79-598">Port 1433 for a default instance of SQL Server.</span></span>
- <span data-ttu-id="97f79-599">**Probe di Azure Load Balancer:**</span><span class="sxs-lookup"><span data-stu-id="97f79-599">**Azure load balancer probe:**</span></span><br/>
   <span data-ttu-id="97f79-600">Qualsiasi porta disponibile.</span><span class="sxs-lookup"><span data-stu-id="97f79-600">Any available port.</span></span> <span data-ttu-id="97f79-601">Negli esempi si usa spesso 59999.</span><span class="sxs-lookup"><span data-stu-id="97f79-601">Examples frequently use 59999.</span></span>
- <span data-ttu-id="97f79-602">**Endpoint del mirroring del database:**</span><span class="sxs-lookup"><span data-stu-id="97f79-602">**Database mirroring endpoint:**</span></span> <br/>
   <span data-ttu-id="97f79-603">Qualsiasi porta disponibile.</span><span class="sxs-lookup"><span data-stu-id="97f79-603">Any available port.</span></span> <span data-ttu-id="97f79-604">Negli esempi si usa spesso 5022.</span><span class="sxs-lookup"><span data-stu-id="97f79-604">Examples frequently use 5022.</span></span>

<span data-ttu-id="97f79-605">Le porte del firewall devono essere aperte in entrambe le VM di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="97f79-605">The firewall ports need to be open on both SQL Server VMs.</span></span>

<span data-ttu-id="97f79-606">Il metodo per aprire le porte dipende dalla soluzione firewall in uso.</span><span class="sxs-lookup"><span data-stu-id="97f79-606">The method of opening the ports depends on the firewall solution that you use.</span></span> <span data-ttu-id="97f79-607">La sezione successiva illustra come aprire le porte in Windows Firewall.</span><span class="sxs-lookup"><span data-stu-id="97f79-607">The next section explains how to open the ports in Windows Firewall.</span></span> <span data-ttu-id="97f79-608">Aprire le porte necessarie in ogni VM di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="97f79-608">Open the required ports on each of your SQL Server VMs.</span></span>

### <a name="open-a-tcp-port-in-the-firewall"></a><span data-ttu-id="97f79-609">Aprire una porta TCP nel firewall</span><span class="sxs-lookup"><span data-stu-id="97f79-609">Open a TCP port in the firewall</span></span>

1. <span data-ttu-id="97f79-610">Nella schermata **Start** avviare **Windows Firewall con sicurezza avanzata** nella prima istanza di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="97f79-610">On the first SQL Server **Start** screen, launch **Windows Firewall with Advanced Security**.</span></span>
2. <span data-ttu-id="97f79-611">Nel riquadro sinistro selezionare **Regole connessioni in entrata**.</span><span class="sxs-lookup"><span data-stu-id="97f79-611">On the left pane, select **Inbound Rules**.</span></span> <span data-ttu-id="97f79-612">Nel riquadro di destra fare clic su **Nuova regola**.</span><span class="sxs-lookup"><span data-stu-id="97f79-612">On the right pane, click **New Rule**.</span></span>
3. <span data-ttu-id="97f79-613">Per **Tipo di regola** scegliere **Porta**.</span><span class="sxs-lookup"><span data-stu-id="97f79-613">For **Rule Type**, choose **Port**.</span></span>
4. <span data-ttu-id="97f79-614">Per la porta specificare **TCP** e digitare i numeri di porta appropriati.</span><span class="sxs-lookup"><span data-stu-id="97f79-614">For the port, specify **TCP** and type the appropriate port numbers.</span></span> <span data-ttu-id="97f79-615">Vedere l'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="97f79-615">See the following example:</span></span>

   ![Firewall SQL](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/35-tcpports.png)

5. <span data-ttu-id="97f79-617">Fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="97f79-617">Click **Next**.</span></span>
6. <span data-ttu-id="97f79-618">Nella pagina **Azione** mantenere selezionata l'opzione **Consenti la connessione** e fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="97f79-618">On the **Action** page, keep **Allow the connection** selected, and then click **Next**.</span></span>
7. <span data-ttu-id="97f79-619">Nella pagina **Profilo** accettare le impostazioni predefinite e fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="97f79-619">On the **Profile** page, accept the default settings, and then click **Next**.</span></span>
8. <span data-ttu-id="97f79-620">Nella pagina **Nome** specificare un nome per la regola, ad esempio **Probe per Azure LB** nella casella di testo **Nome**, quindi fare clic su **Fine**.</span><span class="sxs-lookup"><span data-stu-id="97f79-620">On the **Name** page, specify a rule name (such as **Azure LB Probe**) in the **Name** text box, and then click **Finish**.</span></span>

<span data-ttu-id="97f79-621">Ripetere questi passaggi per la seconda VM di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="97f79-621">Repeat these steps on the second SQL Server VM.</span></span>

## <a name="next-steps"></a><span data-ttu-id="97f79-622">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="97f79-622">Next steps</span></span>

* [<span data-ttu-id="97f79-623">Creare un gruppo di disponibilità AlwaysOn in Macchine virtuali di Azure</span><span class="sxs-lookup"><span data-stu-id="97f79-623">Create a SQL Server Always On availability group on Azure virtual machines</span></span>](virtual-machines-windows-portal-sql-availability-group-tutorial.md)
