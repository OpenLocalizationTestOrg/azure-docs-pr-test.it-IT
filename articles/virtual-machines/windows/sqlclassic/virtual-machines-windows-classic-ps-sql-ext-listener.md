---
title: "Configurare un listener esterno per i gruppi di disponibilità AlwaysOn | Microsoft Docs"
description: "Questa esercitazione illustra in dettaglio la procedura per creare un listener del gruppo di disponibilità AlwaysOn in Azure accessibile dall'esterno con l'indirizzo IP virtuale pubblico del servizio cloud associato."
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: a2453032-94ab-4775-b976-c74d24716728
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/31/2017
ms.author: mikeray
ms.openlocfilehash: 8e506be42aea4fb3c48c29b771a78dcf694f4518
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="configure-an-external-listener-for-always-on-availability-groups-in-azure"></a><span data-ttu-id="8daca-103">Configurare un listener esterno per i gruppi di disponibilità AlwaysOn in Azure</span><span class="sxs-lookup"><span data-stu-id="8daca-103">Configure an external listener for Always On Availability Groups in Azure</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="8daca-104">Listener interno</span><span class="sxs-lookup"><span data-stu-id="8daca-104">Internal Listener</span></span>](../classic/ps-sql-int-listener.md)
> * [<span data-ttu-id="8daca-105">Listener esterno</span><span class="sxs-lookup"><span data-stu-id="8daca-105">External Listener</span></span>](../classic/ps-sql-ext-listener.md)
> 
> 

<span data-ttu-id="8daca-106">Questo argomento illustra come configurare un listener per un gruppo di disponibilità AlwaysOn accessibile esternamente su Internet.</span><span class="sxs-lookup"><span data-stu-id="8daca-106">This topic shows you how to configure a listener for an Always On Availability Group that is externally accessible on the internet.</span></span> <span data-ttu-id="8daca-107">Ciò è possibile tramite l'associazione dell'indirizzo **IP virtuale pubblico (indirizzo VIP)** del servizio cloud con il listener.</span><span class="sxs-lookup"><span data-stu-id="8daca-107">This is made possible by associating the cloud service's **public Virtual IP (VIP)** address with the listener.</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="8daca-108">Azure offre due diversi modelli di distribuzione per creare e usare le risorse: [Gestione risorse e la distribuzione classica](../../../azure-resource-manager/resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="8daca-108">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../azure-resource-manager/resource-manager-deployment-model.md).</span></span> <span data-ttu-id="8daca-109">Questo articolo illustra l'uso del modello di distribuzione classica.</span><span class="sxs-lookup"><span data-stu-id="8daca-109">This article covers using the Classic deployment model.</span></span> <span data-ttu-id="8daca-110">Microsoft consiglia di usare il modello di Gestione risorse per le distribuzioni più recenti.</span><span class="sxs-lookup"><span data-stu-id="8daca-110">Microsoft recommends that most new deployments use the Resource Manager model.</span></span>

<span data-ttu-id="8daca-111">Il gruppo di disponibilità può contenere repliche solo locali, solo di Azure oppure sia locali che di Azure per le configurazioni ibride.</span><span class="sxs-lookup"><span data-stu-id="8daca-111">Your Availability Group can contain replicas that are on-premises only, Azure only, or span both on-premises and Azure for hybrid configurations.</span></span> <span data-ttu-id="8daca-112">Le repliche di Azure possono trovarsi nella stessa area o in più aree grazie a più reti virtuali (VNet).</span><span class="sxs-lookup"><span data-stu-id="8daca-112">Azure replicas can reside within the same region or across multiple regions using multiple virtual networks (VNets).</span></span> <span data-ttu-id="8daca-113">I passaggi seguenti presuppongono che sia già stato [configurato un gruppo di disponibilità](../classic/portal-sql-alwayson-availability-groups.md) ma che non sia stato configurato un listener.</span><span class="sxs-lookup"><span data-stu-id="8daca-113">The steps below assume you have already [configured an availability group](../classic/portal-sql-alwayson-availability-groups.md) but have not configured a listener.</span></span>

## <a name="guidelines-and-limitations-for-external-listeners"></a><span data-ttu-id="8daca-114">Linee guida e limitazioni per listener esterni</span><span class="sxs-lookup"><span data-stu-id="8daca-114">Guidelines and limitations for external listeners</span></span>
<span data-ttu-id="8daca-115">Occorre notare le linee guida seguenti relative al listener del gruppo di disponibilità in Azure quando si esegue la distribuzione usando l'indirizzo IP virtuale pubblico del servizio cloud:</span><span class="sxs-lookup"><span data-stu-id="8daca-115">Note the following guidelines about the availability group listener in Azure when you are deploying using the cloud service pubic VIP address:</span></span>

* <span data-ttu-id="8daca-116">Il listener del gruppo di disponibilità è supportato su Windows Server 2008 R2, Windows Server 2012 e Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="8daca-116">The availability group listener is supported on Windows Server 2008 R2, Windows Server 2012, and Windows Server 2012 R2.</span></span>
* <span data-ttu-id="8daca-117">L'applicazione client deve trovarsi in un servizio cloud diverso rispetto a quello che contiene le VM del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="8daca-117">The client application must reside on a different cloud service than the one that contains your availability group VMs.</span></span> <span data-ttu-id="8daca-118">Azure non supporta Direct Server Return con client e server residenti nello stesso servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="8daca-118">Azure does not support direct server return with client and server in the same cloud service.</span></span>
* <span data-ttu-id="8daca-119">Per impostazione predefinita, la procedura descritta in questo articolo descrive come configurare un listener per usare l'indirizzo IP virtuale (VIP) del servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="8daca-119">By default, the steps in this article show how to configure one listener to use the cloud service Virtual IP (VIP) address.</span></span> <span data-ttu-id="8daca-120">Tuttavia, è possibile riservare e creare più indirizzi VIP per il servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="8daca-120">However, it is possible to reserve and create multiple VIP addresses for your cloud service.</span></span> <span data-ttu-id="8daca-121">In questo modo è possibile usare la procedura di questo articolo per creare più listener, ciascuno di essi associato a un indirizzo IP virtuale diverso.</span><span class="sxs-lookup"><span data-stu-id="8daca-121">This enables you to use the steps in this article to create multiple listeners that are each associated with a different VIP.</span></span> <span data-ttu-id="8daca-122">Per informazioni su come creare più indirizzi VIP, vedere [più indirizzi IP virtuali per il servizio cloud](../../../load-balancer/load-balancer-multivip.md).</span><span class="sxs-lookup"><span data-stu-id="8daca-122">For information on how to create multiple VIP addresses, see [Multiple VIPs per cloud service](../../../load-balancer/load-balancer-multivip.md).</span></span>
* <span data-ttu-id="8daca-123">Se si sta creando un listener per un ambiente ibrido, la rete locale deve disporre di connettività a Internet pubblico oltre che al VPN da sito a sito con la rete virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="8daca-123">If you are creating a listener for a hybrid environment, the on-premises network must have connectivity to the public Internet in addition to the site-to-site VPN with the Azure virtual network.</span></span> <span data-ttu-id="8daca-124">Quando nella subnet di Azure, il listener del gruppo di disponibilità è raggiungibile solo tramite indirizzo IP pubblico del rispettivo servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="8daca-124">When in the Azure subnet, the availability group listener is reachable only by the public IP address of the respective cloud service.</span></span>
* <span data-ttu-id="8daca-125">Non è supportata la creazione di un listener esterno nello stesso servizio cloud in cui è presente anche un listener interno utilizzando il servizio di bilanciamento del carico interno (ILB).</span><span class="sxs-lookup"><span data-stu-id="8daca-125">It is not supported to create an external listener in the same cloud service where you also have an internal listener using the Internal Load Balancer (ILB).</span></span>

## <a name="determine-the-accessibility-of-the-listener"></a><span data-ttu-id="8daca-126">Determinare l'accessibilità del listener</span><span class="sxs-lookup"><span data-stu-id="8daca-126">Determine the accessibility of the listener</span></span>
[!INCLUDE [ag-listener-accessibility](../../../../includes/virtual-machines-ag-listener-determine-accessibility.md)]

<span data-ttu-id="8daca-127">Questo articolo illustra la creazione di un listener che usa il **bilanciamento del carico esterno**.</span><span class="sxs-lookup"><span data-stu-id="8daca-127">This article focuses on creating a listener that uses **external load balancing**.</span></span> <span data-ttu-id="8daca-128">Se si vuole un listener privato per la rete virtuale, vedere la versione di questo articolo che illustra la procedura per la configurazione di un [listener con ILB](../classic/ps-sql-int-listener.md)</span><span class="sxs-lookup"><span data-stu-id="8daca-128">If you want a listener that is private to your virtual network, see the version of this article that provides steps for setting up an [listener with ILB](../classic/ps-sql-int-listener.md)</span></span>

## <a name="create-load-balanced-vm-endpoints-with-direct-server-return"></a><span data-ttu-id="8daca-129">Creare endpoint VM con bilanciamento del carico con Direct Server Return</span><span class="sxs-lookup"><span data-stu-id="8daca-129">Create load-balanced VM endpoints with direct server return</span></span>
<span data-ttu-id="8daca-130">Il servizio di bilanciamento del carico esterno usa l'indirizzo IP virtuale pubblico del servizio cloud che ospita le VM.</span><span class="sxs-lookup"><span data-stu-id="8daca-130">External load balancing uses the virtual the public Virtual IP address of the cloud service that hosts your VMs.</span></span> <span data-ttu-id="8daca-131">Non è quindi necessario creare o configurare il servizio di bilanciamento del carico in questo caso.</span><span class="sxs-lookup"><span data-stu-id="8daca-131">So you do not need to create or configure the load balancer in this case.</span></span>

<span data-ttu-id="8daca-132">È necessario creare un endpoint con carico bilanciato per ogni macchina virtuale che ospita una replica di Azure.</span><span class="sxs-lookup"><span data-stu-id="8daca-132">You must create a load-balanced endpoint for each VM hosting an Azure replica.</span></span> <span data-ttu-id="8daca-133">Se si dispongono di repliche in più aree, ogni replica per tale area deve essere nello stesso servizio cloud nella stessa rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="8daca-133">If you have replicas in multiple regions, each replica for that region must be in the same cloud service in the same VNet.</span></span> <span data-ttu-id="8daca-134">Le repliche di creazione del gruppo di disponibilità che si estendono su più aree di Azure richiedono la configurazione di più reti virtuali.</span><span class="sxs-lookup"><span data-stu-id="8daca-134">Creating Availability Group replicas that span multiple Azure regions requires configuring multiple VNets.</span></span> <span data-ttu-id="8daca-135">Per altre informazioni sulla configurazione della connettività tra reti virtuali, vedere [Configurare la connettività tra reti virtuali](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span><span class="sxs-lookup"><span data-stu-id="8daca-135">For more information on configuring cross VNet connectivity, see  [Configure VNet to VNet Connectivity](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span></span>

1. <span data-ttu-id="8daca-136">Nel portale di Azure, passare a ogni macchina virtuale che ospita una replica e visualizzare i dettagli.</span><span class="sxs-lookup"><span data-stu-id="8daca-136">In the Azure portal, navigate to each VM hosting a replica and view the details.</span></span>
2. <span data-ttu-id="8daca-137">Scegliere la scheda **Endpoint** per ognuna delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="8daca-137">Click the **Endpoints** tab for each of the VMs.</span></span>
3. <span data-ttu-id="8daca-138">Verificare che il **nome** e la **porta pubblica** specificati per l'endpoint del listener non siano già in uso.</span><span class="sxs-lookup"><span data-stu-id="8daca-138">Verify that the **Name** and **Public Port** of the listener endpoint you want to use is not already in use.</span></span> <span data-ttu-id="8daca-139">Nell'esempio seguente, il nome è "MyEndpoint" e la porta è "1433".</span><span class="sxs-lookup"><span data-stu-id="8daca-139">In the example below, the name is “MyEndpoint” and the port is “1433”.</span></span>
4. <span data-ttu-id="8daca-140">Nel client locale, scaricare e installare [l'ultimo modulo PowerShell](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="8daca-140">On your local client, download and install [the latest PowerShell module](https://azure.microsoft.com/downloads/).</span></span>
5. <span data-ttu-id="8daca-141">Avviare **Azure PowerShell**.</span><span class="sxs-lookup"><span data-stu-id="8daca-141">Launch **Azure PowerShell**.</span></span> <span data-ttu-id="8daca-142">Viene aperta una nuova sessione di PowerShell con i moduli amministrativi di Azure caricati.</span><span class="sxs-lookup"><span data-stu-id="8daca-142">A new PowerShell session is opened with the Azure administrative modules loaded.</span></span>
6. <span data-ttu-id="8daca-143">Eseguire **Get-AzurePublishSettingsFile**.</span><span class="sxs-lookup"><span data-stu-id="8daca-143">Run **Get-AzurePublishSettingsFile**.</span></span> <span data-ttu-id="8daca-144">Questo cmdlet conduce a un browser per scaricare un file di impostazioni di pubblicazione in una directory locale.</span><span class="sxs-lookup"><span data-stu-id="8daca-144">This cmdlet directs you to a browser to download a publish settings file to a local directory.</span></span> <span data-ttu-id="8daca-145">Se richiesto, immettere le credenziali di accesso per la sottoscrizione di Azure.</span><span class="sxs-lookup"><span data-stu-id="8daca-145">You may be prompted for your log-in credentials for your Azure subscription.</span></span>
7. <span data-ttu-id="8daca-146">Eseguire il comando **Import-AzurePublishSettingsFile** con il percorso del file di impostazioni di pubblicazione che si è scaricato:</span><span class="sxs-lookup"><span data-stu-id="8daca-146">Run the **Import-AzurePublishSettingsFile** command with the path of the publish settings file that you downloaded:</span></span>
   
        Import-AzurePublishSettingsFile -PublishSettingsFile <PublishSettingsFilePath>
   
    <span data-ttu-id="8daca-147">Una volta importato il file di impostazioni di pubblicazione, è possibile gestire la sottoscrizione di Azure nella sessione di PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8daca-147">Once the publish settings file is imported, you can manage your Azure subscription in the PowerShell session.</span></span>
    
1. <span data-ttu-id="8daca-148">Copiare lo script di PowerShell seguente in un editor di testi e impostare i valori variabili in base all'ambiente. Sono stati forniti valori predefiniti per alcuni parametri.</span><span class="sxs-lookup"><span data-stu-id="8daca-148">Copy the PowerShell script below into a text editor and set the variable values to suit your environment (defaults have been provided for some parameters).</span></span> <span data-ttu-id="8daca-149">Si noti che se il gruppo di disponibilità si estende tra diverse aree di Azure, è necessario eseguire lo script una volta in ogni data center per il servizio cloud e i nodi che risiedono nel data center.</span><span class="sxs-lookup"><span data-stu-id="8daca-149">Note that if your availability group spans Azure regions, you must run the script once in each datacenter for the cloud service and nodes that reside in that datacenter.</span></span>
   
        # Define variables
        $ServiceName = "<MyCloudService>" # the name of the cloud service that contains the availability group nodes
        $AGNodes = "<VM1>","<VM2>","<VM3>" # all availability group nodes containing replicas in the same cloud service, separated by commas
   
        # Configure a load balanced endpoint for each node in $AGNodes, with direct server return enabled
        ForEach ($node in $AGNodes)
        {
            Get-AzureVM -ServiceName $ServiceName -Name $node | Add-AzureEndpoint -Name "ListenerEndpoint" -Protocol "TCP" -PublicPort 1433 -LocalPort 1433 -LBSetName "ListenerEndpointLB" -ProbePort 59999 -ProbeProtocol "TCP" -DirectServerReturn $true | Update-AzureVM
        }

2. <span data-ttu-id="8daca-150">Dopo aver impostato le variabili, copiare lo script dall'editor di testo nella sessione di Azure PowerShell per eseguirlo.</span><span class="sxs-lookup"><span data-stu-id="8daca-150">Once you have set the variables, copy the script from the text editor into your Azure PowerShell session to run it.</span></span> <span data-ttu-id="8daca-151">Se nel prompt viene ancora visualizzato >>, digitare di nuovo ENTER per assicurarsi che l'esecuzione dello script sia stata avviata.</span><span class="sxs-lookup"><span data-stu-id="8daca-151">If the prompt still shows >>, type ENTER again to make sure the script starts running.</span></span>

## <a name="verify-that-kb2854082-is-installed-if-necessary"></a><span data-ttu-id="8daca-152">Se necessario, verificare che KB2854082 sia installato.</span><span class="sxs-lookup"><span data-stu-id="8daca-152">Verify that KB2854082 is installed if necessary</span></span>
[!INCLUDE [kb2854082](../../../../includes/virtual-machines-ag-listener-kb2854082.md)]

## <a name="open-the-firewall-ports-in-availability-group-nodes"></a><span data-ttu-id="8daca-153">Aprire le porte firewall nei nodi del gruppo di disponibilità in</span><span class="sxs-lookup"><span data-stu-id="8daca-153">Open the firewall ports in availability group nodes</span></span>
[!INCLUDE [firewall](../../../../includes/virtual-machines-ag-listener-open-firewall.md)]

## <a name="create-the-availability-group-listener"></a><span data-ttu-id="8daca-154">Creare il listener del gruppo di disponibilità</span><span class="sxs-lookup"><span data-stu-id="8daca-154">Create the availability group listener</span></span>

<span data-ttu-id="8daca-155">Creare il listener del gruppo di disponibilità in due passaggi.</span><span class="sxs-lookup"><span data-stu-id="8daca-155">Create the availability group listener in two steps.</span></span> <span data-ttu-id="8daca-156">Creare prima di tutto la risorsa cluster del punto di accesso client e configurare le dipendenze.</span><span class="sxs-lookup"><span data-stu-id="8daca-156">First, create the client access point cluster resource and configure  dependencies.</span></span> <span data-ttu-id="8daca-157">In secondo luogo configurare le risorse del cluster con PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8daca-157">Second, configure the cluster resources with PowerShell.</span></span>

### <a name="create-the-client-access-point-and-configure-the-cluster-dependencies"></a><span data-ttu-id="8daca-158">Creare il punto di accesso client e configurare le dipendenze del cluster</span><span class="sxs-lookup"><span data-stu-id="8daca-158">Create the client access point and configure the cluster dependencies</span></span>
[!INCLUDE [firewall](../../../../includes/virtual-machines-ag-listener-create-listener.md)]

### <a name="configure-the-cluster-resources-in-powershell"></a><span data-ttu-id="8daca-159">Configurare le risorse del cluster in PowerShell</span><span class="sxs-lookup"><span data-stu-id="8daca-159">Configure the cluster resources in PowerShell</span></span>
1. <span data-ttu-id="8daca-160">Per il servizio di bilanciamento del carico esterno, è necessario ottenere l'indirizzo IP virtuale pubblico del servizio cloud contenente le repliche.</span><span class="sxs-lookup"><span data-stu-id="8daca-160">For external load balancing, you must obtain the public virtual IP address of the cloud service that contains your replicas.</span></span> <span data-ttu-id="8daca-161">Accedere al portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="8daca-161">Log into the Azure portal.</span></span> <span data-ttu-id="8daca-162">Passare al servizio cloud che contiene la macchina virtuale del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="8daca-162">Navigate to the cloud service that contains your availability group VM.</span></span> <span data-ttu-id="8daca-163">Aprire la visualizzazione **Dashboard** .</span><span class="sxs-lookup"><span data-stu-id="8daca-163">Open the **Dashboard** view.</span></span>
2. <span data-ttu-id="8daca-164">Annotare l'indirizzo visualizzato sotto **Indirizzo IP virtuale pubblico (VIP)**.</span><span class="sxs-lookup"><span data-stu-id="8daca-164">Note the address shown under **Public Virtual IP (VIP) Address**.</span></span> <span data-ttu-id="8daca-165">Se la soluzione interessa più reti virtuali, ripetere questo passaggio per ogni servizio cloud che contiene una macchina virtuale che ospita una replica.</span><span class="sxs-lookup"><span data-stu-id="8daca-165">If your solution spans VNets, repeat this step for each cloud service that contains a VM that hosts a replica.</span></span>
3. <span data-ttu-id="8daca-166">Su una delle macchine virtuali copiare lo script di PowerShell seguente in un editor di testo e impostare le variabili sui valori annotati prima.</span><span class="sxs-lookup"><span data-stu-id="8daca-166">On one of the VMs, copy the PowerShell script below into a text editor and set the variables to the values you noted earlier.</span></span>
   
        # Define variables
        $ClusterNetworkName = "<ClusterNetworkName>" # the cluster network name (Use Get-ClusterNetwork on Windows Server 2012 of higher to find the name)
        $IPResourceName = "<IPResourceName>" # the IP Address resource name
        $CloudServiceIP = "<X.X.X.X>" # Public Virtual IP (VIP) address of your cloud service
   
        Import-Module FailoverClusters
   
        # If you are using Windows Server 2012 or higher, use the Get-Cluster Resource command. If you are using Windows Server 2008 R2, use the cluster res command. Both commands are commented out. Choose the one applicable to your environment and remove the # at the beginning of the line to convert the comment to an executable line of code.
   
        # Get-ClusterResource $IPResourceName | Set-ClusterParameter -Multiple @{"Address"="$CloudServiceIP";"ProbePort"="59999";"SubnetMask"="255.255.255.255";"Network"="$ClusterNetworkName";"OverrideAddressMatch"=1;"EnableDhcp"=0}
        # cluster res $IPResourceName /priv enabledhcp=0 overrideaddressmatch=1 address=$CloudServiceIP probeport=59999  subnetmask=255.255.255.255
4. <span data-ttu-id="8daca-167">Dopo aver impostato le variabili, aprire una finestra con privilegi elevati di Windows PowerShell, quindi copiare lo script dall'editor di testo e incollarlo nella sessione di Azure PowerShell per eseguirlo.</span><span class="sxs-lookup"><span data-stu-id="8daca-167">Once you have set the variables, open an elevated Windows PowerShell window, then copy the script from the text editor and paste into your Azure PowerShell session to run it.</span></span> <span data-ttu-id="8daca-168">Se nel prompt viene ancora visualizzato >>, digitare di nuovo ENTER per assicurarsi che l'esecuzione dello script sia stata avviata.</span><span class="sxs-lookup"><span data-stu-id="8daca-168">If the prompt still shows >>, type ENTER again to make sure the script starts running.</span></span>
5. <span data-ttu-id="8daca-169">Ripetere questo passaggio su ogni macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="8daca-169">Repeat this on each VM.</span></span> <span data-ttu-id="8daca-170">Questo script consente di configurare la risorsa Indirizzo IP con l'indirizzo IP del servizio cloud e di impostare altri parametri come la porta probe.</span><span class="sxs-lookup"><span data-stu-id="8daca-170">This script configures the IP Address resource with the IP address of the cloud service and sets other parameters like the probe port.</span></span> <span data-ttu-id="8daca-171">Quando la risorsa Indirizzo IP viene portata online, può quindi rispondere al polling sulla porta probe dall'endpoint con carico bilanciato, creato in precedenza in questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="8daca-171">When the IP Address resource is brought online, it can then respond to the polling on the probe port from the load-balanced endpoint created earlier in this tutorial.</span></span>

## <a name="bring-the-listener-online"></a><span data-ttu-id="8daca-172">Portare online il listener</span><span class="sxs-lookup"><span data-stu-id="8daca-172">Bring the listener online</span></span>
[!INCLUDE [Bring-Listener-Online](../../../../includes/virtual-machines-ag-listener-bring-online.md)]

## <a name="follow-up-items"></a><span data-ttu-id="8daca-173">Operazioni di completamento della procedura</span><span class="sxs-lookup"><span data-stu-id="8daca-173">Follow-up items</span></span>
[!INCLUDE [Follow-up](../../../../includes/virtual-machines-ag-listener-follow-up.md)]

## <a name="test-the-availability-group-listener-within-the-same-vnet"></a><span data-ttu-id="8daca-174">Testare il listener del gruppo di disponibilità (entro la stessa rete virtuale)</span><span class="sxs-lookup"><span data-stu-id="8daca-174">Test the availability group listener (within the same VNet)</span></span>
[!INCLUDE [Test-Listener-Within-VNET](../../../../includes/virtual-machines-ag-listener-test.md)]

## <a name="test-the-availability-group-listener-over-the-internet"></a><span data-ttu-id="8daca-175">Testare il listener del gruppo di disponibilità (su Internet)</span><span class="sxs-lookup"><span data-stu-id="8daca-175">Test the availability group listener (over the internet)</span></span>
<span data-ttu-id="8daca-176">Per accedere al listener dall'esterno della rete virtuale, è necessario usare il servizio di bilanciamento del carico esterno/pubblico (illustrato in questo argomento) invece del servizio di bilanciamento del carico interno, che è accessibile solo entro la stessa rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="8daca-176">In order to access the listener from outside the virtual network, you must be using external/public load balancing (described in this topic) rather than ILB, which is only accesible within the same VNet.</span></span> <span data-ttu-id="8daca-177">Nella stringa di connessione specificare il nome del servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="8daca-177">In the connection string, you specify the cloud service name.</span></span> <span data-ttu-id="8daca-178">Ad esempio, se è disponibile un servizio cloud con nome *mycloudservice*, l'istruzione sqlcmd sarà analoga alla seguente:</span><span class="sxs-lookup"><span data-stu-id="8daca-178">For example, if you had a cloud service with the name *mycloudservice*, the sqlcmd statement would be as follows:</span></span>

    sqlcmd -S "mycloudservice.cloudapp.net,<EndpointPort>" -d "<DatabaseName>" -U "<LoginId>" -P "<Password>"  -Q "select @@servername, db_name()" -l 15

<span data-ttu-id="8daca-179">A differenza dell'esempio precedente, è necessario usare l'autenticazione SQL, perché il chiamante non può usare l'autenticazione di Windows su Internet.</span><span class="sxs-lookup"><span data-stu-id="8daca-179">Unlike the previous example, SQL authentication must be used, because the caller cannot use windows authentication over the internet.</span></span> <span data-ttu-id="8daca-180">Per altre informazioni, vedere il blog relativo a un [gruppo di disponibilità AlwaysOn nelle VM di Azure: scenari di connettività client](http://blogs.msdn.com/b/sqlcat/archive/2014/02/03/alwayson-availability-group-in-windows-azure-vm-client-connectivity-scenarios.aspx).</span><span class="sxs-lookup"><span data-stu-id="8daca-180">For more information, see [Always On Availability Group in Azure VM: Client Connectivity Scenarios](http://blogs.msdn.com/b/sqlcat/archive/2014/02/03/alwayson-availability-group-in-windows-azure-vm-client-connectivity-scenarios.aspx).</span></span> <span data-ttu-id="8daca-181">Quando si usa l'autenticazione SQL, assicurarsi di creare lo stesso account di accesso in entrambe le repliche.</span><span class="sxs-lookup"><span data-stu-id="8daca-181">When using SQL authentication, make sure that you create the same login on both replicas.</span></span> <span data-ttu-id="8daca-182">Per altre informazioni sulla risoluzione dei problemi degli account di accesso con gruppi di disponibilità, vedere il post di blog relativo a [come mappare gli account di accesso o usare un utente di database SQL contenuto per connettersi ad altre repliche ed eseguire il mapping ai database di disponibilità](http://blogs.msdn.com/b/alwaysonpro/archive/2014/02/19/how-to-map-logins-or-use-contained-sql-database-user-to-connect-to-other-replicas-and-map-to-availability-databases.aspx).</span><span class="sxs-lookup"><span data-stu-id="8daca-182">For more information about troubleshooting logins with Availability Groups, see [How to map logins or use contained SQL database user to connect to other replicas and map to availability databases](http://blogs.msdn.com/b/alwaysonpro/archive/2014/02/19/how-to-map-logins-or-use-contained-sql-database-user-to-connect-to-other-replicas-and-map-to-availability-databases.aspx).</span></span>

<span data-ttu-id="8daca-183">Se le repliche AlwaysOn si trovano in subnet diverse, i client devono specificare **MultisubnetFailover=True** nella stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="8daca-183">If the Always On replicas are in different subnets, clients must specify **MultisubnetFailover=True** in the connection string.</span></span> <span data-ttu-id="8daca-184">Di conseguenza, vengono eseguiti tentativi di connessione paralleli alle repliche nelle diverse subnet.</span><span class="sxs-lookup"><span data-stu-id="8daca-184">This results in parallel connection attempts to replicas in the different subnets.</span></span> <span data-ttu-id="8daca-185">Si noti che questo scenario include la distribuzione di un gruppo di disponibilità AlwaysOn tra più aree.</span><span class="sxs-lookup"><span data-stu-id="8daca-185">Note that this scenario includes a cross-region Always On Availability Group deployment.</span></span>

## <a name="next-steps"></a><span data-ttu-id="8daca-186">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="8daca-186">Next steps</span></span>
[!INCLUDE [Listener-Next-Steps](../../../../includes/virtual-machines-ag-listener-next-steps.md)]

