## <a name="prepare-for-akv-integration"></a><span data-ttu-id="8c1c4-101">Preparare l'integrazione di AKV</span><span class="sxs-lookup"><span data-stu-id="8c1c4-101">Prepare for AKV Integration</span></span>
<span data-ttu-id="8c1c4-102">Per usare l'integrazione dell'insieme di credenziali delle chiavi di Azure per configurare la macchina virtuale di SQL Server, sono necessari diversi prerequisiti:</span><span class="sxs-lookup"><span data-stu-id="8c1c4-102">To use Azure Key Vault Integration to configure your SQL Server VM, there are several prerequisites:</span></span> 

1. [<span data-ttu-id="8c1c4-103">Installare Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="8c1c4-103">Install Azure Powershell</span></span>](#install-azure-powershell)
2. [<span data-ttu-id="8c1c4-104">Creare un'istanza di Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="8c1c4-104">Create an Azure Active Directory</span></span>](#create-an-azure-active-directory)
3. [<span data-ttu-id="8c1c4-105">Creare un insieme di credenziali delle chiavi</span><span class="sxs-lookup"><span data-stu-id="8c1c4-105">Create a key vault</span></span>](#create-a-key-vault)

<span data-ttu-id="8c1c4-106">Le sezioni seguenti descrivono tali prerequisiti e le informazioni da raccogliere per eseguire i cmdlet di PowerShell in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-106">The following sections describe these prerequisites and the information you need to collect to later run the PowerShell cmdlets.</span></span>

### <a name="install-azure-powershell"></a><span data-ttu-id="8c1c4-107">Installare Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="8c1c4-107">Install Azure PowerShell</span></span>
<span data-ttu-id="8c1c4-108">Assicurarsi che sia installata la versione più recente di Azure PowerShell SDK.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-108">Make sure you have installed the latest Azure PowerShell SDK.</span></span> <span data-ttu-id="8c1c4-109">Per altre informazioni, vedere [Come installare e configurare Azure PowerShell](/powershell/azureps-cmdlets-docs).</span><span class="sxs-lookup"><span data-stu-id="8c1c4-109">For more information, see [How to install and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span></span>

### <a name="create-an-azure-active-directory"></a><span data-ttu-id="8c1c4-110">Creare un'istanza di Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="8c1c4-110">Create an Azure Active Directory</span></span>
<span data-ttu-id="8c1c4-111">Innanzitutto, è necessario che un'istanza di [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) sia presente nella sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-111">First, you need to have an [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) in your subscription.</span></span> <span data-ttu-id="8c1c4-112">AAD offre numerosi vantaggi, ad esempio, consente di concedere l'autorizzazione all'insieme di credenziali delle chiavi per determinati utenti e applicazioni.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-112">Among many benefits, this allows you to grant permission to your key vault for certain users and applications.</span></span>

<span data-ttu-id="8c1c4-113">Successivamente, registrare un'applicazione con AAD.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-113">Next, register an application with AAD.</span></span> <span data-ttu-id="8c1c4-114">In questo modo, è disponibile per l'utente un account dell'entità servizio con accesso all'insieme di credenziali delle chiavi necessario per la macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-114">This will give you a Service Principal account that has access to your key vault which your VM will need.</span></span> <span data-ttu-id="8c1c4-115">Nell'articolo sull'insieme di credenziali delle chiavi di Azure è possibile trovare questi passaggi nella sezione [Registrare un'applicazione con Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register). In alternativa, è possibile vedere i passaggi con gli screenshot nella sezione **Get an identity for the application** (Ottenere un'identità per l'applicazione) di [questo post di blog](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span><span class="sxs-lookup"><span data-stu-id="8c1c4-115">In the Azure Key Vault article, you can find these steps in the [Register an application with Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) section, or you can see the steps with screen shots in the **Get an identity for the application section** of [this blog post](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span></span> <span data-ttu-id="8c1c4-116">Prima di completare questi passaggi, si noti che è necessario raccogliere le informazioni seguenti durante la registrazione, utili in seguito quando si abilita l'integrazione dell'insieme di credenziali delle chiavi di Azure nella macchina virtuale di SQL.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-116">Before completing these steps, note that you need to collect the following information during this registration that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

* <span data-ttu-id="8c1c4-117">Dopo aver aggiunto l'applicazione, trovare l'**ID CLIENT** nella scheda **CONFIGURA**.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-117">After the application is added, find the **CLIENT ID**  on the **CONFIGURE** tab.</span></span> 
    <span data-ttu-id="8c1c4-118">![ID client di Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span><span class="sxs-lookup"><span data-stu-id="8c1c4-118">![Azure Active Directory Client ID](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span></span>
  
    <span data-ttu-id="8c1c4-119">L'ID client viene assegnato successivamente al parametro **$spName** (nome entità servizio) nello script di PowerShell, per abilitare l'integrazione dell'insieme di credenziali delle chiavi di Azure.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-119">The client ID is assigned later to the **$spName** (Service Principal name) parameter in the PowerShell script to enable Azure Key Vault Integration.</span></span> 
* <span data-ttu-id="8c1c4-120">Inoltre, durante questa procedura quando si crea la chiave, copiare il segreto della chiave come illustrato nella schermata seguente.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-120">Also, during these steps when you create your key, copy the secret for your key as is shown in the following screenshot.</span></span> <span data-ttu-id="8c1c4-121">Tale segreto della chiave viene assegnato successivamente al parametro **$spSecret** (segreto entità servizio) nello script di PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-121">This key secret is assigned later to the **$spSecret** (Service Principal secret) parameter in the PowerShell script.</span></span>  
    <span data-ttu-id="8c1c4-122">![Segreto di Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span><span class="sxs-lookup"><span data-stu-id="8c1c4-122">![Azure Active Directory Secret](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span></span>
* <span data-ttu-id="8c1c4-123">È necessario autorizzare questo nuovo ID client per disporre delle autorizzazioni di accesso seguenti: **encrypt**, **decrypt**, **wrapKey**, **unwrapKey**, **sign** e **verify**.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-123">You must authorize this new client ID to have the following access permissions: **encrypt**, **decrypt**, **wrapKey**, **unwrapKey**, **sign**, and **verify**.</span></span> <span data-ttu-id="8c1c4-124">Questa operazione viene eseguita con il cmdlet [Set-AzureKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) .</span><span class="sxs-lookup"><span data-stu-id="8c1c4-124">This is done with the [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span></span> <span data-ttu-id="8c1c4-125">Per altre informazioni, vedere [Autorizzare l'applicazione a usare la chiave o il segreto](../articles/key-vault/key-vault-get-started.md#authorize).</span><span class="sxs-lookup"><span data-stu-id="8c1c4-125">For more information see [Authorize the application to use the key or secret](../articles/key-vault/key-vault-get-started.md#authorize).</span></span>

### <a name="create-a-key-vault"></a><span data-ttu-id="8c1c4-126">Creare un insieme di credenziali delle chiavi</span><span class="sxs-lookup"><span data-stu-id="8c1c4-126">Create a key vault</span></span>
<span data-ttu-id="8c1c4-127">Per usare l'insieme di credenziali delle chiavi di Azure per archiviare le chiavi da usare per la crittografia nella macchina virtuale, è necessario accedere a un insieme di credenziali delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-127">In order to use Azure Key Vault to store the keys you will use for encryption in your VM, you need access to a key vault.</span></span> <span data-ttu-id="8c1c4-128">Se l'insieme di credenziali delle chiavi non è ancora stato configurato, crearne uno seguendo i passaggi nell'argomento [Introduzione all'insieme di credenziali delle chiavi di Azure](../articles/key-vault/key-vault-get-started.md) .</span><span class="sxs-lookup"><span data-stu-id="8c1c4-128">If you have not already set up your key vault, create one by following the steps in the [Getting Started with Azure Key Vault](../articles/key-vault/key-vault-get-started.md) topic.</span></span> <span data-ttu-id="8c1c4-129">Prima di completare questi passaggi, si noti che è necessario raccogliere alcune informazioni durante l'impostazione, utili in seguito quando si abilita l'integrazione dell'insieme di credenziali delle chiavi di Azure nella macchina virtuale di SQL.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-129">Before completing these steps, note that there is some information you need to collect during this set up that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

<span data-ttu-id="8c1c4-130">Al passaggio Creare un insieme di credenziali delle chiavi, si noti la proprietà **vaultUri** restituita, ovvero l'URL dell'insieme di credenziali delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-130">When you get to the Create a key vault step, note the returned **vaultUri** property, which is the key vault URL.</span></span> <span data-ttu-id="8c1c4-131">Nell'esempio fornito in questo passaggio, riportato di seguito, il nome dell'insieme di credenziali delle chiavi è ContosoKeyVault, quindi l'URL dell'insieme di credenziali delle chiavi è https://contosokeyvault.vault.azure.net/.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-131">In the example provided in that step, shown below, the key vault name is ContosoKeyVault, therefore the key vault URL would be https://contosokeyvault.vault.azure.net/.</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVault' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia'

<span data-ttu-id="8c1c4-132">L'URL dell'insieme di credenziali delle chiavi viene assegnato successivamente al parametro **$akvURL** nello script di PowerShell, per abilitare l'integrazione dell'insieme di credenziali delle chiavi di Azure.</span><span class="sxs-lookup"><span data-stu-id="8c1c4-132">The key vault URL is assigned later to the **$akvURL** parameter in the PowerShell script to enable Azure Key Vault Integration.</span></span>

