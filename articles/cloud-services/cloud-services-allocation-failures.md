---
title: Risoluzione dei problemi relativi a errori di allocazione di servizi cloud | Documentazione Microsoft
description: Risoluzione dei problemi relativi ad errori di allocazione quando si distribuiscono servizi Cloud in Azure
services: azure-service-management, cloud-services
documentationcenter: 
author: simonxjx
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 529157eb-e4a1-4388-aa2b-09e8b923af74
ms.service: cloud-services
ms.workload: na
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 7/26/2017
ms.author: v-six
ms.openlocfilehash: 3379b6d9bea874abecae7e56d30cfb15e6b0c2fc
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/03/2017
---
# <a name="troubleshooting-allocation-failure-when-you-deploy-cloud-services-in-azure"></a><span data-ttu-id="84cb2-103">Risoluzione dei problemi relativi ad errori di allocazione quando si distribuiscono servizi Cloud in Azure</span><span class="sxs-lookup"><span data-stu-id="84cb2-103">Troubleshooting allocation failure when you deploy Cloud Services in Azure</span></span>
## <a name="summary"></a><span data-ttu-id="84cb2-104">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="84cb2-104">Summary</span></span>
<span data-ttu-id="84cb2-105">Quando si distribuiscono istanze a un servizio Cloud o si aggiungono nuove istanze del ruolo di lavoro o web, Microsoft Azure alloca le risorse di calcolo.</span><span class="sxs-lookup"><span data-stu-id="84cb2-105">When you deploy instances to a Cloud Service or add new web or worker role instances, Microsoft Azure allocates compute resources.</span></span> <span data-ttu-id="84cb2-106">In alcuni casi possono verificarsi errori quando si eseguono queste operazioni anche prima di raggiungere i limiti della sottoscrizione di Azure.</span><span class="sxs-lookup"><span data-stu-id="84cb2-106">You may occasionally receive errors when performing these operations even before you reach the Azure subscription limits.</span></span> <span data-ttu-id="84cb2-107">Questo articolo illustra le cause di alcuni dei più comuni errori di allocazione e suggerisce una possibile correzione.</span><span class="sxs-lookup"><span data-stu-id="84cb2-107">This article explains the causes of some of the common allocation failures and suggests possible remediation.</span></span> <span data-ttu-id="84cb2-108">Queste informazioni potrebbero risultare utili anche quando si pianifica la distribuzione dei servizi.</span><span class="sxs-lookup"><span data-stu-id="84cb2-108">The information may also be useful when you plan the deployment of your services.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

### <a name="background--how-allocation-works"></a><span data-ttu-id="84cb2-109">Informazioni preliminari: come funziona l'allocazione</span><span class="sxs-lookup"><span data-stu-id="84cb2-109">Background – How allocation works</span></span>
<span data-ttu-id="84cb2-110">I server nei data center di Azure sono partizionati in cluster.</span><span class="sxs-lookup"><span data-stu-id="84cb2-110">The servers in Azure datacenters are partitioned into clusters.</span></span> <span data-ttu-id="84cb2-111">Una nuova richiesta di allocazione del servizio cloud viene eseguita in più cluster.</span><span class="sxs-lookup"><span data-stu-id="84cb2-111">A new cloud service allocation request is attempted in multiple clusters.</span></span> <span data-ttu-id="84cb2-112">Quando la prima istanza è distribuita in un servizio cloud (in gestione temporanea o produzione), il servizio cloud viene bloccato su un cluster.</span><span class="sxs-lookup"><span data-stu-id="84cb2-112">When the first instance is deployed to a cloud service(in either staging or production), that cloud service gets pinned to a cluster.</span></span> <span data-ttu-id="84cb2-113">Tutte le altre distribuzioni per il servizio cloud verranno eseguite nello stesso cluster.</span><span class="sxs-lookup"><span data-stu-id="84cb2-113">Any further deployments for the cloud service will happen in the same cluster.</span></span> <span data-ttu-id="84cb2-114">In questo articolo si farà riferimento a questa operazione con il termine "bloccata su un cluster".</span><span class="sxs-lookup"><span data-stu-id="84cb2-114">In this article, we'll refer to this as "pinned to a cluster".</span></span> <span data-ttu-id="84cb2-115">Il diagramma 1 seguente illustra un'allocazione normale eseguita in più cluster. Il diagramma 2 illustra un'allocazione bloccata sul Cluster 2, perché è quello che ospita il servizio cloud CS_1.</span><span class="sxs-lookup"><span data-stu-id="84cb2-115">Diagram 1 below illustrates the case of a normal allocation which is attempted in multiple clusters; Diagram 2 illustrates the case of an allocation that's pinned to Cluster 2 because that's where the existing Cloud Service CS_1 is hosted.</span></span>

![Diagramma di allocazione](./media/cloud-services-allocation-failure/Allocation1.png)

### <a name="why-allocation-failure-happens"></a><span data-ttu-id="84cb2-117">Perché si verifica un errore di allocazione</span><span class="sxs-lookup"><span data-stu-id="84cb2-117">Why allocation failure happens</span></span>
<span data-ttu-id="84cb2-118">Quando una richiesta di allocazione è bloccata su un cluster, la probabilità di non riuscire a trovare risorse disponibili è più alta, perché il pool di risorse disponibili è limitato ad un cluster.</span><span class="sxs-lookup"><span data-stu-id="84cb2-118">When an allocation request is pinned to a cluster, there's a higher chance of failing to find free resources since the available resource pool is limited to a cluster.</span></span> <span data-ttu-id="84cb2-119">Inoltre, se la richiesta di allocazione è bloccata su un cluster, ma il tipo di risorsa richiesto non è supportato da quel cluster, la richiesta non riuscirà anche se nel cluster ci sono risorse disponibili.</span><span class="sxs-lookup"><span data-stu-id="84cb2-119">Furthermore, if your allocation request is pinned to a cluster but the type of resource you requested is not supported by that cluster, your request will fail even if the cluster has free resource.</span></span> <span data-ttu-id="84cb2-120">Il diagramma 3 seguente illustra un'allocazione bloccata non riuscita perché nel solo cluster candidato non ci sono risorse disponibili.</span><span class="sxs-lookup"><span data-stu-id="84cb2-120">Diagram 3 below illustrates the case where a pinned allocation fails because the only candidate cluster does not have free resources.</span></span> <span data-ttu-id="84cb2-121">Il diagramma 4 illustra un'allocazione bloccata non riuscita perché il solo cluster candidato non supporta le dimensioni della VM richieste, anche se nel cluster ci sono risorse disponibili.</span><span class="sxs-lookup"><span data-stu-id="84cb2-121">Diagram 4 illustrates the case where a pinned allocation fails because the only candidate cluster does not support the requested VM size, even though the cluster has free resources.</span></span>

![Errore di allocazione bloccata](./media/cloud-services-allocation-failure/Allocation2.png)

## <a name="troubleshooting-allocation-failure-for-cloud-services"></a><span data-ttu-id="84cb2-123">Risoluzione di problemi di allocazione non riuscita per i servizi cloud</span><span class="sxs-lookup"><span data-stu-id="84cb2-123">Troubleshooting allocation failure for cloud services</span></span>
### <a name="error-message"></a><span data-ttu-id="84cb2-124">Messaggio di errore</span><span class="sxs-lookup"><span data-stu-id="84cb2-124">Error Message</span></span>
<span data-ttu-id="84cb2-125">Se viene visualizzato il messaggio di errore seguente:</span><span class="sxs-lookup"><span data-stu-id="84cb2-125">You may see the following error message:</span></span>

    "Azure operation '{operation id}' failed with code Compute.ConstrainedAllocationFailed. Details: Allocation failed; unable to satisfy constraints in request. The requested new service deployment is bound to an Affinity Group, or it targets a Virtual Network, or there is an existing deployment under this hosted service. Any of these conditions constrains the new deployment to specific Azure resources. Please retry later or try reducing the VM size or number of role instances. Alternatively, if possible, remove the aforementioned constraints or try deploying to a different region."

### <a name="common-issues"></a><span data-ttu-id="84cb2-126">Problemi comuni</span><span class="sxs-lookup"><span data-stu-id="84cb2-126">Common Issues</span></span>
<span data-ttu-id="84cb2-127">Ecco gli scenari di allocazione comuni che causano una richiesta di allocazione bloccata a un solo cluster.</span><span class="sxs-lookup"><span data-stu-id="84cb2-127">Here are the common allocation scenarios that cause an allocation request to be pinned to a single cluster.</span></span>

* <span data-ttu-id="84cb2-128">La distribuzione in uno slot di gestione temporanea: se un servizio cloud dispone di una distribuzione in uno slot, l’intero servizio cloud è bloccato a un cluster specifico.</span><span class="sxs-lookup"><span data-stu-id="84cb2-128">Deploying to Staging Slot - If a cloud service has a deployment in either slot, then the entire cloud service is pinned to a specific cluster.</span></span>  <span data-ttu-id="84cb2-129">Ciò significa che se una distribuzione già esiste nello slot di produzione, una nuova distribuzione di gestione temporanea può essere allocata solo nello stesso cluster come slot di produzione.</span><span class="sxs-lookup"><span data-stu-id="84cb2-129">This means that if a deployment already exists in the production slot, then a new staging deployment can only be allocated in the same cluster as the production slot.</span></span> <span data-ttu-id="84cb2-130">Se la capacità del cluster è quasi stata raggiunta, la richiesta potrebbe avere esito negativo.</span><span class="sxs-lookup"><span data-stu-id="84cb2-130">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="84cb2-131">Scalabilità: l’aggiunta di nuove istanze a un servizio cloud esistente deve allocare nello stesso cluster.</span><span class="sxs-lookup"><span data-stu-id="84cb2-131">Scaling - Adding new instances to an existing cloud service must allocate in the same cluster.</span></span>  <span data-ttu-id="84cb2-132">Le piccole richieste di ridimensionamento in genere possono essere allocate, ma non è sempre possibile.</span><span class="sxs-lookup"><span data-stu-id="84cb2-132">Small scaling requests can usually be allocated, but not always.</span></span> <span data-ttu-id="84cb2-133">Se la capacità del cluster è quasi stata raggiunta, la richiesta potrebbe avere esito negativo.</span><span class="sxs-lookup"><span data-stu-id="84cb2-133">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="84cb2-134">Gruppo di affinità: una nuova distribuzione in un servizio cloud vuoto può essere allocata dall'infrastruttura in qualsiasi cluster in tale area, a meno che il servizio cloud sia bloccato a un gruppo di affinità.</span><span class="sxs-lookup"><span data-stu-id="84cb2-134">Affinity Group - A new deployment to an empty cloud service can be allocated by the fabric in any cluster in that region, unless the cloud service is pinned to an affinity group.</span></span> <span data-ttu-id="84cb2-135">Le distribuzioni allo stesso gruppo di affinità verranno eseguite nello stesso cluster.</span><span class="sxs-lookup"><span data-stu-id="84cb2-135">Deployments to the same affinity group will be attempted on the same cluster.</span></span> <span data-ttu-id="84cb2-136">Se la capacità del cluster è quasi stata raggiunta, la richiesta potrebbe avere esito negativo.</span><span class="sxs-lookup"><span data-stu-id="84cb2-136">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="84cb2-137">Gruppo di affinità tra reti: le reti virtuali meno recenti vengono legate a gruppi di affinità anziché ad aree e i servizi cloud in tali reti virtuali verrebbero bloccati al cluster del gruppo di affinità.</span><span class="sxs-lookup"><span data-stu-id="84cb2-137">Affinity Group vNet - Older Virtual Networks were tied to affinity groups instead of regions, and cloud services in these Virtual Networks would be pinned to the affinity group cluster.</span></span> <span data-ttu-id="84cb2-138">Le distribuzioni a questo tipo di rete virtuale verranno eseguite nel cluster bloccato.</span><span class="sxs-lookup"><span data-stu-id="84cb2-138">Deployments to this type of virtual network will be attempted on the pinned cluster.</span></span> <span data-ttu-id="84cb2-139">Se la capacità del cluster è quasi stata raggiunta, la richiesta potrebbe avere esito negativo.</span><span class="sxs-lookup"><span data-stu-id="84cb2-139">If the cluster is nearing capacity, the request may fail.</span></span>

## <a name="solutions"></a><span data-ttu-id="84cb2-140">Soluzioni</span><span class="sxs-lookup"><span data-stu-id="84cb2-140">Solutions</span></span>
1. <span data-ttu-id="84cb2-141">Ridistribuzione in un nuovo servizio cloud. Questa soluzione potrebbe essere la più efficace in quanto consente alla piattaforma di scegliere tra tutti i cluster in tale area.</span><span class="sxs-lookup"><span data-stu-id="84cb2-141">Redeploy to a new cloud service - This solution is likely to be most successful as it allows the platform to choose from all clusters in that region.</span></span>

   * <span data-ttu-id="84cb2-142">Distribuire il carico di lavoro in un nuovo servizio cloud</span><span class="sxs-lookup"><span data-stu-id="84cb2-142">Deploy the workload to a new cloud service</span></span>  
   * <span data-ttu-id="84cb2-143">Aggiornare il CNAME o un record per puntare il traffico al nuovo servizio cloud</span><span class="sxs-lookup"><span data-stu-id="84cb2-143">Update the CNAME or A record to point traffic to the new cloud service</span></span>
   * <span data-ttu-id="84cb2-144">Quando nel sito precedente non c’è nessun traffico, è possibile eliminare il precedente servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="84cb2-144">Once zero traffic is going to the old site, you can delete the old cloud service.</span></span> <span data-ttu-id="84cb2-145">Questa soluzione non deve causare tempi di inattività.</span><span class="sxs-lookup"><span data-stu-id="84cb2-145">This solution should incur zero downtime.</span></span>
2. <span data-ttu-id="84cb2-146">Eliminazione di slot di produzione e di gestione temporanea: questa soluzione conserverà il nome DNS esistente, ma determinerà tempi di inattività dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="84cb2-146">Delete both production and staging slots - This solution will preserve your existing DNS name, but will cause downtime to your application.</span></span>

   * <span data-ttu-id="84cb2-147">Eliminare slot di produzione e di gestione temporanea di un servizio cloud esistente in modo che il servizio cloud sia vuoto, quindi</span><span class="sxs-lookup"><span data-stu-id="84cb2-147">Delete the production and staging slots of an existing cloud service so that the cloud service is empty, and then</span></span>
   * <span data-ttu-id="84cb2-148">creare una nuova distribuzione nel servizio cloud esistente.</span><span class="sxs-lookup"><span data-stu-id="84cb2-148">Create a new deployment in the existing cloud service.</span></span> <span data-ttu-id="84cb2-149">Questo tenterà nuovamente di eseguire l'allocazione in tutti i cluster nell'area.</span><span class="sxs-lookup"><span data-stu-id="84cb2-149">This will re-attempt to allocation on all clusters in the region.</span></span> <span data-ttu-id="84cb2-150">Assicurarsi che il servizio cloud non sia associato a un gruppo di affinità.</span><span class="sxs-lookup"><span data-stu-id="84cb2-150">Ensure the cloud service is not tied to an affinity group.</span></span>
3. <span data-ttu-id="84cb2-151">IP riservato: questa soluzione consente di mantenere l'indirizzo IP esistente, ma determinerà tempi di inattività dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="84cb2-151">Reserved IP -  This solution will preserve your existing IP address, but will cause downtime to your application.</span></span>  

   * <span data-ttu-id="84cb2-152">Creare un ReservedIP per la distribuzione esistente utilizzando Powershell</span><span class="sxs-lookup"><span data-stu-id="84cb2-152">Create a ReservedIP for your existing deployment using Powershell</span></span>

     ```
     New-AzureReservedIP -ReservedIPName {new reserved IP name} -Location {location} -ServiceName {existing service name}
     ```
   * <span data-ttu-id="84cb2-153">Seguire #2 dall'alto, assicurandosi di specificare il nuovo ReservedIP nel CSCFG del servizio.</span><span class="sxs-lookup"><span data-stu-id="84cb2-153">Follow #2 from above, making sure to specify the new ReservedIP in the service's CSCFG.</span></span>
4. <span data-ttu-id="84cb2-154">Rimuovere il gruppo di affinità per le nuove distribuzioni: i gruppi di affinità non sono più consigliati.</span><span class="sxs-lookup"><span data-stu-id="84cb2-154">Remove affinity group for new deployments - Affinity Groups are no longer recommended.</span></span> <span data-ttu-id="84cb2-155">Attenersi alla procedura #1 indicata in precedenza per distribuire un nuovo servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="84cb2-155">Follow steps for #1 above to deploy a new cloud service.</span></span> <span data-ttu-id="84cb2-156">Assicurarsi che il servizio cloud non sia in un gruppo di affinità.</span><span class="sxs-lookup"><span data-stu-id="84cb2-156">Ensure cloud service is not in an affinity group.</span></span>
5. <span data-ttu-id="84cb2-157">Eseguire la conversione a una rete virtuale regionale: vedere [Come eseguire la migrazione da gruppi di affinità a una rete virtuale (VNet) regionale](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span><span class="sxs-lookup"><span data-stu-id="84cb2-157">Convert to a Regional Virtual Network - See [How to migrate from Affinity Groups to a Regional Virtual Network (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span></span>
