---
title: aaaSQL le metriche di query per l'API DocumentDB DB Cosmos Azure | Documenti Microsoft
description: "Informazioni sulla modalità debug e tooinstrument hello le prestazioni delle query SQL di Azure Cosmos DB richieste."
keywords: sintassi sql, query sql, linguaggio di query json, concetti relativi ai database e query sql, funzioni di aggregazione
services: cosmos-db
documentationcenter: 
author: arramac
manager: jhubbard
editor: monicar
ms.assetid: b2fa8e8f-7291-45a3-9bd1-7284ed9077f8
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/15/2017
ms.author: arramac
ms.openlocfilehash: 2fee3786b7d48d254162699471943e316764b003
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="tuning-query-performance-with-azure-cosmos-db"></a><span data-ttu-id="c0715-104">Ottimizzazione delle prestazioni delle query con Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="c0715-104">Tuning query performance with Azure Cosmos DB</span></span>
<span data-ttu-id="c0715-105">Azure Cosmos DB fornisce un'[API SQL per le query sui dati](documentdb-sql-query.md), senza che siano necessari schemi o indici secondari.</span><span class="sxs-lookup"><span data-stu-id="c0715-105">Azure Cosmos DB provides a [SQL API for querying data](documentdb-sql-query.md), without requiring schema or secondary indexes.</span></span> <span data-ttu-id="c0715-106">Questo articolo fornisce le seguenti informazioni per gli sviluppatori hello:</span><span class="sxs-lookup"><span data-stu-id="c0715-106">This article provides hello following information for developers:</span></span>

* <span data-ttu-id="c0715-107">Informazioni generali sull'esecuzione delle query SQL di Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="c0715-107">High-level details on how Azure Cosmos DB's SQL query execution works</span></span>
* <span data-ttu-id="c0715-108">Dettagli sulle intestazioni di richiesta e risposta delle query e le opzioni SDK client</span><span class="sxs-lookup"><span data-stu-id="c0715-108">Details on query request and response headers, and client SDK options</span></span>
* <span data-ttu-id="c0715-109">Suggerimenti e procedure consigliate per le prestazioni delle query</span><span class="sxs-lookup"><span data-stu-id="c0715-109">Tips and best practices for query performance</span></span>
* <span data-ttu-id="c0715-110">Esempi di come tooutilize SQL esecuzione statistiche toodebug le prestazioni delle query</span><span class="sxs-lookup"><span data-stu-id="c0715-110">Examples of how tooutilize SQL execution statistics toodebug query performance</span></span>

## <a name="about-sql-query-execution"></a><span data-ttu-id="c0715-111">Informazioni sull'esecuzione di query SQL</span><span class="sxs-lookup"><span data-stu-id="c0715-111">About SQL query execution</span></span>

<span data-ttu-id="c0715-112">In Azure Cosmos DB, vengono archiviati i dati in contenitori, che possono raggiungere dimensioni tooany [velocità effettiva di archiviazione dimensioni o richiesta](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="c0715-112">In Azure Cosmos DB, you store data in containers, which can grow tooany [storage size or request throughput](partition-data.md).</span></span> <span data-ttu-id="c0715-113">Azure DB Cosmos scala facilmente dati tra partizioni fisiche in crescita dei dati toohandle copre hello o aumento della velocità effettiva di provisioning.</span><span class="sxs-lookup"><span data-stu-id="c0715-113">Azure Cosmos DB seamlessly scales data across physical partitions under hello covers toohandle data growth or increase in provisioned throughput.</span></span> <span data-ttu-id="c0715-114">È possibile emettere contenitore tooany di query SQL utilizzando hello API REST o uno dei hello supportato [SDK di DocumentDB](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="c0715-114">You can issue SQL queries tooany container using hello REST API or one of hello supported [DocumentDB SDKs](documentdb-sdk-dotnet.md).</span></span>

<span data-ttu-id="c0715-115">Una breve panoramica del partizionamento: si definisce una chiave di partizione come "city", che determina il modo in cui vengono suddivisi i dati tra le partizioni fisiche.</span><span class="sxs-lookup"><span data-stu-id="c0715-115">A brief overview of partitioning: you define a partition key like "city", which determines how data is split across physical partitions.</span></span> <span data-ttu-id="c0715-116">Chiave singola partizione di dati appartenente tooa (ad esempio, "city" = = "Seattle") vengono archiviati all'interno di una partizione fisica, ma in genere una singola partizione fisica dispone di più chiavi di partizione.</span><span class="sxs-lookup"><span data-stu-id="c0715-116">Data belonging tooa single partition key (for example, "city" == "Seattle") is stored within a physical partition, but typically a single physical partition has multiple partition keys.</span></span> <span data-ttu-id="c0715-117">Quando una partizione raggiunge la dimensione di archiviazione, hello servizio facilmente suddivide partizione hello in due nuove partizioni e divide la chiave di partizione hello in modo uniforme tra queste partizioni.</span><span class="sxs-lookup"><span data-stu-id="c0715-117">When a partition reaches its storage size, hello service seamlessly splits hello partition into two new partitions, and divides hello partition key evenly across these partitions.</span></span> <span data-ttu-id="c0715-118">Poiché le partizioni sono temporanee, hello API utilizzano un'astrazione di una "chiave intervallo di partizione", che indica gli intervalli hello degli hash di chiave di partizione.</span><span class="sxs-lookup"><span data-stu-id="c0715-118">Since partitions are transient, hello APIs use an abstraction of a "partition key range", which denotes hello ranges of partition key hashes.</span></span> 

<span data-ttu-id="c0715-119">Quando si esegue un tooAzure query DB Cosmos, hello SDK consente di eseguire questi passaggi logici:</span><span class="sxs-lookup"><span data-stu-id="c0715-119">When you issue a query tooAzure Cosmos DB, hello SDK performs these logical steps:</span></span>

* <span data-ttu-id="c0715-120">Analizzare il piano di esecuzione di hello SQL query toodetermine hello query.</span><span class="sxs-lookup"><span data-stu-id="c0715-120">Parse hello SQL query toodetermine hello query execution plan.</span></span> 
* <span data-ttu-id="c0715-121">Se la query hello include un filtro con la chiave di partizione hello, ad esempio `SELECT * FROM c WHERE c.city = "Seattle"`, è indirizzato tooa singola partizione.</span><span class="sxs-lookup"><span data-stu-id="c0715-121">If hello query includes a filter against hello partition key, like `SELECT * FROM c WHERE c.city = "Seattle"`, it is routed tooa single partition.</span></span> <span data-ttu-id="c0715-122">Se query hello non dispone di un filtro sulla chiave di partizione, quindi viene eseguita in tutte le partizioni e risultati vengono uniti lato client.</span><span class="sxs-lookup"><span data-stu-id="c0715-122">If hello query does not have a filter on partition key, then it is executed in all partitions, and results are merged client side.</span></span>
* <span data-ttu-id="c0715-123">query Hello viene eseguito all'interno di ogni partizione in serie o parallela, in base alla configurazione di client.</span><span class="sxs-lookup"><span data-stu-id="c0715-123">hello query is executed within each partition in series or parallel, based on client configuration.</span></span> <span data-ttu-id="c0715-124">All'interno di ogni partizione, query hello potrebbe rendere uno o più round trip, a seconda della complessità della query hello, configurare dimensioni di pagina e il provisioning di velocità effettiva della raccolta hello.</span><span class="sxs-lookup"><span data-stu-id="c0715-124">Within each partition, hello query might make one or more round trips depending on hello query complexity, configured page size, and provisioned throughput of hello collection.</span></span> <span data-ttu-id="c0715-125">Ogni esecuzione restituisce il numero di hello di [unità richieste](request-units.md) utilizzati dall'esecuzione di query e, facoltativamente, le statistiche di esecuzione di query.</span><span class="sxs-lookup"><span data-stu-id="c0715-125">Each execution returns hello number of [request units](request-units.md) consumed by query execution, and optionally, query execution statistics.</span></span> 
* <span data-ttu-id="c0715-126">Hello SDK esegue un riepilogo dei risultati di query hello tra partizioni.</span><span class="sxs-lookup"><span data-stu-id="c0715-126">hello SDK performs a summarization of hello query results across partitions.</span></span> <span data-ttu-id="c0715-127">Ad esempio, se tra partizioni, query di hello implica una clausola ORDER BY, risultati dalle singole partizioni sono ordinati merge tooreturn risultati in base all'ordinamento a livello globale.</span><span class="sxs-lookup"><span data-stu-id="c0715-127">For example, if hello query involves an ORDER BY across partitions, then results from individual partitions are merge-sorted tooreturn results in globally sorted order.</span></span> <span data-ttu-id="c0715-128">Se la query hello è un'aggregazione come `COUNT`, i conteggi di hello da singole partizioni vengono sommati tooproduce hello conteggio complessivo.</span><span class="sxs-lookup"><span data-stu-id="c0715-128">If hello query is an aggregation like `COUNT`, hello counts from individual partitions are summed tooproduce hello overall count.</span></span>

<span data-ttu-id="c0715-129">SDK di Hello offrono diverse opzioni per l'esecuzione di query.</span><span class="sxs-lookup"><span data-stu-id="c0715-129">hello SDKs provide various options for query execution.</span></span> <span data-ttu-id="c0715-130">Ad esempio, in .NET queste opzioni sono disponibili in hello `FeedOptions` classe.</span><span class="sxs-lookup"><span data-stu-id="c0715-130">For example, in .NET these options are available in hello `FeedOptions` class.</span></span> <span data-ttu-id="c0715-131">Hello nella tabella seguente vengono descritte queste opzioni e l'impatto il tempo di esecuzione di query.</span><span class="sxs-lookup"><span data-stu-id="c0715-131">hello following table describes these options and how they impact query execution time.</span></span> 

| <span data-ttu-id="c0715-132">Opzione</span><span class="sxs-lookup"><span data-stu-id="c0715-132">Option</span></span> | <span data-ttu-id="c0715-133">Descrizione</span><span class="sxs-lookup"><span data-stu-id="c0715-133">Description</span></span> |
| ------ | ----------- |
| `EnableCrossPartitionQuery` | <span data-ttu-id="c0715-134">È necessario impostare tootrue per le query che richiede toobe eseguita per più di una partizione.</span><span class="sxs-lookup"><span data-stu-id="c0715-134">Must be set tootrue for any query that requires toobe executed across more than one partition.</span></span> <span data-ttu-id="c0715-135">Si tratta di un tooenable flag esplicita è compromessi tra prestazioni tenendo toomake durante la fase di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="c0715-135">This is an explicit flag tooenable you toomake conscious performance tradeoffs during development time.</span></span> |
| `EnableScanInQuery` | <span data-ttu-id="c0715-136">Deve essere impostato tootrue se è stata esplicitamente rifiutata l'indicizzazione, ma desidera comunque query hello toorun tramite un'analisi.</span><span class="sxs-lookup"><span data-stu-id="c0715-136">Must be set tootrue if you have opted out of indexing, but want toorun hello query via a scan anyway.</span></span> <span data-ttu-id="c0715-137">Applicabile solo se l'indicizzazione per hello richieste solo percorso di filtro è disabilitato.</span><span class="sxs-lookup"><span data-stu-id="c0715-137">Only applicable if indexing for hello requested filter path is disabled.</span></span> | 
| `MaxItemCount` | <span data-ttu-id="c0715-138">numero massimo di Hello di tooreturn elementi per ogni server toohello di andata e ritorno.</span><span class="sxs-lookup"><span data-stu-id="c0715-138">hello maximum number of items tooreturn per round trip toohello server.</span></span> <span data-ttu-id="c0715-139">Tramite l'impostazione troppo-1, è possibile consentire server hello gestire hello numero di elementi.</span><span class="sxs-lookup"><span data-stu-id="c0715-139">By setting too-1, you can let hello server manage hello number of items.</span></span> <span data-ttu-id="c0715-140">In alternativa, è possibile ridurre questo tooretrieve valore solo un piccolo numero di elementi per ogni round trip.</span><span class="sxs-lookup"><span data-stu-id="c0715-140">Or, you can lower this value tooretrieve only a small number of items per round trip.</span></span> 
| `MaxBufferedItemCount` | <span data-ttu-id="c0715-141">Questa è un'opzione sul lato client e utilizzata il consumo di memoria hello toolimit quando si esegue tra partizioni ORDER BY.</span><span class="sxs-lookup"><span data-stu-id="c0715-141">This is a client-side option, and used toolimit hello memory consumption when performing cross-partition ORDER BY.</span></span> <span data-ttu-id="c0715-142">Un valore più alto consente di ridurre la latenza di hello di ordinamento tra partizioni.</span><span class="sxs-lookup"><span data-stu-id="c0715-142">A higher value helps reduce hello latency of cross-partition sorting.</span></span> |
| `MaxDegreeOfParallelism` | <span data-ttu-id="c0715-143">Ottiene o imposta il numero di hello di operazioni simultanee eseguite sul lato client durante l'esecuzione di query parallele nel servizio di database Azure DocumentDB hello.</span><span class="sxs-lookup"><span data-stu-id="c0715-143">Gets or sets hello number of concurrent operations run client side during parallel query execution in hello Azure DocumentDB database service.</span></span> <span data-ttu-id="c0715-144">Un valore di proprietà positivo limita hello valore del numero di operazioni simultanee toohello set.</span><span class="sxs-lookup"><span data-stu-id="c0715-144">A positive property value limits hello number of concurrent operations toohello set value.</span></span> <span data-ttu-id="c0715-145">Se è impostato tooless a 0, il sistema di hello decide automaticamente il numero di hello di toorun operazioni simultanee.</span><span class="sxs-lookup"><span data-stu-id="c0715-145">If it is set tooless than 0, hello system automatically decides hello number of concurrent operations toorun.</span></span> |
| `PopulateQueryMetrics` | <span data-ttu-id="c0715-146">Consente la registrazione dettagliata delle statistiche sul tempo impiegato nelle varie fasi di esecuzione della query, come il tempo di compilazione, il tempo del ciclo di indice e il tempo di caricamento dei documenti.</span><span class="sxs-lookup"><span data-stu-id="c0715-146">Enables detailed logging of statistics of time spent in various phases of query execution like compilation time, index loop time, and document load time.</span></span> <span data-ttu-id="c0715-147">È possibile condividere l'output di statistiche sulle query con problemi di prestazioni delle query di supporto tecnico di Azure toodiagnose.</span><span class="sxs-lookup"><span data-stu-id="c0715-147">You can share output from query statistics with Azure Support toodiagnose query performance issues.</span></span> |
| `RequestContinuation` | <span data-ttu-id="c0715-148">È possibile riprendere l'esecuzione di query passando il token di continuazione opaco hello restituito da una query.</span><span class="sxs-lookup"><span data-stu-id="c0715-148">You can resume query execution by passing in hello opaque continuation token returned by any query.</span></span> <span data-ttu-id="c0715-149">token di continuazione Hello incapsula tutti gli stati necessari per l'esecuzione di query.</span><span class="sxs-lookup"><span data-stu-id="c0715-149">hello continuation token encapsulates all state required for query execution.</span></span> |
| `ResponseContinuationTokenLimitInKb` | <span data-ttu-id="c0715-150">È possibile limitare dimensioni massime di hello hello del token di continuazione restituito dal server hello.</span><span class="sxs-lookup"><span data-stu-id="c0715-150">You can limit hello maximum size of hello continuation token returned by hello server.</span></span> <span data-ttu-id="c0715-151">Potrebbe essere necessario tooset questo se l'applicazione disponga di limiti alle dimensioni dell'intestazione di risposta.</span><span class="sxs-lookup"><span data-stu-id="c0715-151">You might need tooset this if your application host has limits on response header size.</span></span> <span data-ttu-id="c0715-152">Impostando questa opzione può aumentare hello RUs usato per le query hello e durata globali.</span><span class="sxs-lookup"><span data-stu-id="c0715-152">Setting this may increase hello overall duration and RUs consumed for hello query.</span></span>  |

<span data-ttu-id="c0715-153">Prendiamo ad esempio, un esempio di query su richiesta in una raccolta con la chiave di partizione `/city` come partizione di hello chiave e viene eseguito il provisioning con 100.000 UR/sec velocità effettiva.</span><span class="sxs-lookup"><span data-stu-id="c0715-153">For example, let's take an example query on partition key requested on a collection with `/city` as hello partition key and provisioned with 100,000 RU/s of throughput.</span></span> <span data-ttu-id="c0715-154">Richiesta la query usando `CreateDocumentQuery<T>` in .NET hello seguente:</span><span class="sxs-lookup"><span data-stu-id="c0715-154">You request this query using `CreateDocumentQuery<T>` in .NET like hello following:</span></span>

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        PopulateQueryMetrics = true, 
        MaxItemCount = -1, 
        MaxDegreeOfParallelism = -1, 
        EnableCrossPartitionQuery = true 
    }).AsDocumentQuery();

FeedResponse<dynamic> result = await query.ExecuteNextAsync();
```

<span data-ttu-id="c0715-155">Hello frammento SDK illustrato sopra, corrisponde a toohello seguente richiesta di API REST:</span><span class="sxs-lookup"><span data-stu-id="c0715-155">hello SDK snippet shown above, corresponds toohello following REST API request:</span></span>

```
POST https://arramacquerymetrics-westus.documents.azure.com/dbs/db/colls/sample/docs HTTP/1.1
x-ms-continuation: 
x-ms-documentdb-isquery: True
x-ms-max-item-count: -1
x-ms-documentdb-query-enablecrosspartition: True
x-ms-documentdb-query-parallelizecrosspartitionquery: True
x-ms-documentdb-query-iscontinuationexpected: True
x-ms-documentdb-populatequerymetrics: True
x-ms-date: Tue, 27 Jun 2017 21:52:18 GMT
authorization: type%3dmaster%26ver%3d1.0%26sig%3drp1Hi83Y8aVV5V6LzZ6xhtQVXRAMz0WNMnUuvriUv%2b4%3d
x-ms-session-token: 7:8,6:2008,5:8,4:2008,3:8,2:2008,1:8,0:8,9:8,8:4008
Cache-Control: no-cache
x-ms-consistency-level: Session
User-Agent: documentdb-dotnet-sdk/1.14.1 Host/32-bit MicrosoftWindowsNT/6.2.9200.0
x-ms-version: 2017-02-22
Accept: application/json
Content-Type: application/query+json
Host: arramacquerymetrics-westus.documents.azure.com
Content-Length: 52
Expect: 100-continue

{"query":"SELECT * FROM c WHERE c.city = 'Seattle'"}
```

<span data-ttu-id="c0715-156">Ogni pagina di esecuzione della query corrisponde tooa API REST `POST` con hello `Accept: application/query+json` intestazione e query SQL hello nel corpo di hello.</span><span class="sxs-lookup"><span data-stu-id="c0715-156">Each query execution page corresponds tooa REST API `POST` with hello `Accept: application/query+json` header, and hello SQL query in hello body.</span></span> <span data-ttu-id="c0715-157">Ogni query rende uno o più server toohello trip con hello di arrotondamento `x-ms-continuation` token restituite tra l'esecuzione di tooresume hello client e server.</span><span class="sxs-lookup"><span data-stu-id="c0715-157">Each query makes one or more round trips toohello server with hello `x-ms-continuation` token echoed between hello client and server tooresume execution.</span></span> <span data-ttu-id="c0715-158">opzioni di configurazione Hello FeedOptions vengono passate toohello server sotto forma di hello di intestazioni di richiesta.</span><span class="sxs-lookup"><span data-stu-id="c0715-158">hello configuration options in FeedOptions are passed toohello server in hello form of request headers.</span></span> <span data-ttu-id="c0715-159">Ad esempio, `MaxItemCount` corrisponde troppo`x-ms-max-item-count`.</span><span class="sxs-lookup"><span data-stu-id="c0715-159">For example, `MaxItemCount` corresponds too`x-ms-max-item-count`.</span></span> 

<span data-ttu-id="c0715-160">richiesta Hello restituisce seguente hello (troncati per migliorare la leggibilità) risposta:</span><span class="sxs-lookup"><span data-stu-id="c0715-160">hello request returns hello following (truncated for readability) response:</span></span>

```
HTTP/1.1 200 Ok
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Server: Microsoft-HTTPAPI/2.0
Strict-Transport-Security: max-age=31536000
x-ms-last-state-change-utc: Tue, 27 Jun 2017 21:01:57.561 GMT
x-ms-resource-quota: documentSize=10240;documentsSize=10485760;documentsCount=-1;collectionSize=10485760;
x-ms-resource-usage: documentSize=1;documentsSize=884;documentsCount=2000;collectionSize=1408;
x-ms-item-count: 2000
x-ms-schemaversion: 1.3
x-ms-alt-content-path: dbs/db/colls/sample
x-ms-content-path: +9kEANVq0wA=
x-ms-xp-role: 1
x-ms-documentdb-query-metrics: totalExecutionTimeInMs=33.67;queryCompileTimeInMs=0.06;queryLogicalPlanBuildTimeInMs=0.02;queryPhysicalPlanBuildTimeInMs=0.10;queryOptimizationTimeInMs=0.00;VMExecutionTimeInMs=32.56;indexLookupTimeInMs=0.36;documentLoadTimeInMs=9.58;systemFunctionExecuteTimeInMs=0.00;userFunctionExecuteTimeInMs=0.00;retrievedDocumentCount=2000;retrievedDocumentSize=1125600;outputDocumentCount=2000;writeOutputTimeInMs=18.10;indexUtilizationRatio=1.00
x-ms-request-charge: 604.42
x-ms-serviceversion: version=1.14.34.4
x-ms-activity-id: 0df8b5f6-83b9-4493-abda-cce6d0f91486
x-ms-session-token: 2:2008
x-ms-gatewayversion: version=1.14.33.2
Date: Tue, 27 Jun 2017 21:59:49 GMT
```

<span data-ttu-id="c0715-161">intestazioni di risposta chiave Hello restituite dalla query hello includono hello informazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="c0715-161">hello key response headers returned from hello query include hello following:</span></span>

| <span data-ttu-id="c0715-162">Opzione</span><span class="sxs-lookup"><span data-stu-id="c0715-162">Option</span></span> | <span data-ttu-id="c0715-163">Descrizione</span><span class="sxs-lookup"><span data-stu-id="c0715-163">Description</span></span> |
| ------ | ----------- |
| `x-ms-item-count` | <span data-ttu-id="c0715-164">numero di Hello di elementi restituiti nella risposta hello.</span><span class="sxs-lookup"><span data-stu-id="c0715-164">hello number of items returned in hello response.</span></span> <span data-ttu-id="c0715-165">Questo dipende hello fornito `x-ms-max-item-count`, hello numero di elementi che è possibile adattare all'interno di hello dimensioni massime del payload della risposta, velocità effettiva di provisioning hello e il tempo di esecuzione di query.</span><span class="sxs-lookup"><span data-stu-id="c0715-165">This is dependent on hello supplied `x-ms-max-item-count`, hello number of items that can be fit within hello maximum response payload size, hello provisioned throughput, and query execution time.</span></span> |  
| `x-ms-continuation:` | <span data-ttu-id="c0715-166">Hello continuazione token tooresume l'esecuzione di query hello, se sono disponibili altri risultati.</span><span class="sxs-lookup"><span data-stu-id="c0715-166">hello continuation token tooresume execution of hello query, if additional results are available.</span></span> | 
| `x-ms-documentdb-query-metrics` | <span data-ttu-id="c0715-167">statistiche sulle query Hello per l'esecuzione di hello.</span><span class="sxs-lookup"><span data-stu-id="c0715-167">hello query statistics for hello execution.</span></span> <span data-ttu-id="c0715-168">Si tratta di una stringa delimitata contenente le statistiche di tempo impiegato in hello diverse fasi di esecuzione di query.</span><span class="sxs-lookup"><span data-stu-id="c0715-168">This is a delimited string containing statistics of time spent in hello various phases of query execution.</span></span> <span data-ttu-id="c0715-169">Restituito se `x-ms-documentdb-populatequerymetrics` è troppo`True`.</span><span class="sxs-lookup"><span data-stu-id="c0715-169">Returned if `x-ms-documentdb-populatequerymetrics` is set too`True`.</span></span> | 
| `x-ms-request-charge` | <span data-ttu-id="c0715-170">numero di Hello [unità richieste](request-units.md) utilizzati da query hello.</span><span class="sxs-lookup"><span data-stu-id="c0715-170">hello number of [request units](request-units.md) consumed by hello query.</span></span> | 

<span data-ttu-id="c0715-171">Per informazioni dettagliate sulle opzioni e le intestazioni di richiesta di hello API REST, vedere [una query di risorse utilizzando l'API REST di DocumentDB hello](https://docs.microsoft.com/rest/api/documentdb/querying-documentdb-resources-using-the-rest-api).</span><span class="sxs-lookup"><span data-stu-id="c0715-171">For details on hello REST API request headers and options, see [Querying resources using hello DocumentDB REST API](https://docs.microsoft.com/rest/api/documentdb/querying-documentdb-resources-using-the-rest-api).</span></span>

## <a name="best-practices-for-query-performance"></a><span data-ttu-id="c0715-172">Procedure consigliate per le prestazioni delle query</span><span class="sxs-lookup"><span data-stu-id="c0715-172">Best practices for query performance</span></span>
<span data-ttu-id="c0715-173">di seguito Hello sono fattori più comuni di hello che influiscono sulle prestazioni di query di database di Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="c0715-173">hello following are hello most common factors that impact Azure Cosmos DB query performance.</span></span> <span data-ttu-id="c0715-174">In questo articolo verrà esaminato in modo approfondito ognuno di questi argomenti.</span><span class="sxs-lookup"><span data-stu-id="c0715-174">We dig deeper into each of these topics in this article.</span></span>

| <span data-ttu-id="c0715-175">Fattore</span><span class="sxs-lookup"><span data-stu-id="c0715-175">Factor</span></span> | <span data-ttu-id="c0715-176">Suggerimento</span><span class="sxs-lookup"><span data-stu-id="c0715-176">Tip</span></span> | 
| ------ | -----| 
| <span data-ttu-id="c0715-177">Velocità effettiva con provisioning</span><span class="sxs-lookup"><span data-stu-id="c0715-177">Provisioned throughput</span></span> | <span data-ttu-id="c0715-178">Misurare RU per ogni query e assicurarsi di disporre di velocità effettiva di provisioning obbligatorio hello per le query.</span><span class="sxs-lookup"><span data-stu-id="c0715-178">Measure RU per query, and ensure that you have hello required provisioned throughput for your queries.</span></span> | 
| <span data-ttu-id="c0715-179">Partizionamento e chiavi di partizione</span><span class="sxs-lookup"><span data-stu-id="c0715-179">Partitioning and partition keys</span></span> | <span data-ttu-id="c0715-180">Ottimizza per le query con valore della chiave di partizione hello nella clausola di filtro hello per una latenza bassa.</span><span class="sxs-lookup"><span data-stu-id="c0715-180">Favor queries with hello partition key value in hello filter clause for low latency.</span></span> |
| <span data-ttu-id="c0715-181">Opzioni per SDK e query</span><span class="sxs-lookup"><span data-stu-id="c0715-181">SDK and query options</span></span> | <span data-ttu-id="c0715-182">Seguire le procedure consigliate dell'SDK come la connettività diretta e ottimizzare le opzioni di esecuzione delle query sul lato client.</span><span class="sxs-lookup"><span data-stu-id="c0715-182">Follow SDK best practices like direct connectivity, and tune client-side query execution options.</span></span> |
| <span data-ttu-id="c0715-183">Latenza di rete</span><span class="sxs-lookup"><span data-stu-id="c0715-183">Network latency</span></span> | <span data-ttu-id="c0715-184">Account per la rete overhead in misura e utilizzare multihosting tooread API da hello più vicino di area.</span><span class="sxs-lookup"><span data-stu-id="c0715-184">Account for network overhead in measurement, and use multi-homing APIs tooread from hello nearest region.</span></span> |
| <span data-ttu-id="c0715-185">Criterio di indicizzazione</span><span class="sxs-lookup"><span data-stu-id="c0715-185">Indexing Policy</span></span> | <span data-ttu-id="c0715-186">Assicurarsi di aver richiesto hello percorsi/criteri di indicizzazione per query hello.</span><span class="sxs-lookup"><span data-stu-id="c0715-186">Ensure that you have hello required indexing paths/policy for hello query.</span></span> |
| <span data-ttu-id="c0715-187">Metriche di esecuzione delle query</span><span class="sxs-lookup"><span data-stu-id="c0715-187">Query execution metrics</span></span> | <span data-ttu-id="c0715-188">Analizzare hello query esecuzione metriche tooidentify potenziale di riscrivere più volte le forme di dati e query.</span><span class="sxs-lookup"><span data-stu-id="c0715-188">Analyze hello query execution metrics tooidentify potential rewrites of query and data shapes.</span></span>  |

### <a name="provisioned-throughput"></a><span data-ttu-id="c0715-189">Velocità effettiva con provisioning</span><span class="sxs-lookup"><span data-stu-id="c0715-189">Provisioned throughput</span></span>
<span data-ttu-id="c0715-190">In Cosmos DB è possibile creare contenitori di dati, ognuno con una velocità effettiva riservata espressa in unità richiesta (UR) al secondo.</span><span class="sxs-lookup"><span data-stu-id="c0715-190">In Cosmos DB, you create containers of data, each with reserved throughput expressed in request units (RU) per-second.</span></span> <span data-ttu-id="c0715-191">Una lettura di un documento di 1 KB è 1 UR e ogni operazione (incluse le query) è normalizzato tooa numero fisso di destinatari in base a sua complessità.</span><span class="sxs-lookup"><span data-stu-id="c0715-191">A read of a 1-KB document is 1 RU, and every operation (including queries) is normalized tooa fixed number of RUs based on its complexity.</span></span> <span data-ttu-id="c0715-192">Se ad esempio è previsto un provisioning di 1000 UR/sec per il contenitore e si dispone di una query come `SELECT * FROM c WHERE c.city = 'Seattle'` che usa 5 UR, è possibile eseguire (1000 UR/sec) / (5 UR/query) = 200 query di questo tipo al secondo.</span><span class="sxs-lookup"><span data-stu-id="c0715-192">For example, if you have 1000 RU/s provisioned for your container, and you have a query like `SELECT * FROM c WHERE c.city = 'Seattle'` that consumes 5 RUs, then you can perform (1000 RU/s) / (5 RU/query) = 200 query/s such queries per second.</span></span> 

<span data-ttu-id="c0715-193">Se si invia più di 200 query/sec, hello avviato limitazione di velocità di richieste in ingresso di sopra di 200/s.</span><span class="sxs-lookup"><span data-stu-id="c0715-193">If you submit more than 200 queries/sec, hello service starts rate-limiting incoming requests above 200/s.</span></span> <span data-ttu-id="c0715-194">Hello SDK gestiscono automaticamente questo caso eseguendo un tentativi/backoff, pertanto è possibile riscontrare una latenza più elevata per le query.</span><span class="sxs-lookup"><span data-stu-id="c0715-194">hello SDKs automatically handle this case by performing a backoff/retry, therefore you might notice a higher latency for these queries.</span></span> <span data-ttu-id="c0715-195">Aumento hello il provisioning della velocità effettiva toohello necessario valore migliora la velocità effettiva e la latenza delle query.</span><span class="sxs-lookup"><span data-stu-id="c0715-195">Increasing hello provisioned throughput toohello required value improves your query latency and throughput.</span></span> 

<span data-ttu-id="c0715-196">toolearn più sulle unità di richiesta, vedere [unità richieste](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="c0715-196">toolearn more about request units, see [Request units](request-units.md).</span></span>

### <a name="partitioning-and-partition-keys"></a><span data-ttu-id="c0715-197">Partizionamento e chiavi di partizione</span><span class="sxs-lookup"><span data-stu-id="c0715-197">Partitioning and partition keys</span></span>
<span data-ttu-id="c0715-198">Con Azure Cosmos DB, in genere le query eseguire in ordine da più veloce o più efficiente tooslower/meno efficiente hello.</span><span class="sxs-lookup"><span data-stu-id="c0715-198">With Azure Cosmos DB, typically queries perform in hello following order from fastest/most efficient tooslower/less efficient.</span></span> 

* <span data-ttu-id="c0715-199">GET su una singola chiave di partizione e chiave di elemento</span><span class="sxs-lookup"><span data-stu-id="c0715-199">GET on a single partition key and item key</span></span>
* <span data-ttu-id="c0715-200">Query con una clausola di filtro su una singola chiave di partizione</span><span class="sxs-lookup"><span data-stu-id="c0715-200">Query with a filter clause on a single partition key</span></span>
* <span data-ttu-id="c0715-201">Query senza una clausola di filtro di uguaglianza o basato su intervallo su qualsiasi proprietà</span><span class="sxs-lookup"><span data-stu-id="c0715-201">Query without an equality or range filter clause on any property</span></span>
* <span data-ttu-id="c0715-202">Query senza filtri</span><span class="sxs-lookup"><span data-stu-id="c0715-202">Query without filters</span></span>

<span data-ttu-id="c0715-203">Esegue una query che tooconsult necessità tutte le partizioni è necessario una latenza maggiore e sarà possibile utilizzare RUs superiore.</span><span class="sxs-lookup"><span data-stu-id="c0715-203">Queries that need tooconsult all partitions need higher latency, and can consume higher RUs.</span></span> <span data-ttu-id="c0715-204">Poiché ogni partizione ha l'indicizzazione automatica in tutte le proprietà, query hello può essere fornita in modo efficiente tra l'indice di hello in questo caso.</span><span class="sxs-lookup"><span data-stu-id="c0715-204">Since each partition has automatic indexing against all properties, hello query can be served efficiently from hello index in this case.</span></span> <span data-ttu-id="c0715-205">È possibile apportare le query che interessano più veloce di partizioni utilizzando le opzioni di parallelismo hello.</span><span class="sxs-lookup"><span data-stu-id="c0715-205">You can make queries that span partitions faster by using hello parallelism options.</span></span>

<span data-ttu-id="c0715-206">toolearn informazioni sulle partizioni e le chiavi di partizione, vedere [partizionamento nel database di Azure Cosmos](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="c0715-206">toolearn more about partitioning and partition keys, see [Partitioning in Azure Cosmos DB](partition-data.md).</span></span>

### <a name="sdk-and-query-options"></a><span data-ttu-id="c0715-207">Opzioni per SDK e query</span><span class="sxs-lookup"><span data-stu-id="c0715-207">SDK and query options</span></span>
<span data-ttu-id="c0715-208">Vedere [suggerimenti sulle prestazioni](performance-tips.md) e [test delle prestazioni](performance-testing.md) per la modalità tooget hello migliori prestazioni lato client dal database di Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="c0715-208">See [Performance Tips](performance-tips.md) and [Performance testing](performance-testing.md) for how tooget hello best client-side performance from Azure Cosmos DB.</span></span> <span data-ttu-id="c0715-209">Incluso l'utilizzo di hello SDK più recente, impostazione delle configurazioni specifiche della piattaforma come numero predefinito di connessioni, frequenza di garbage collection e come utilizzare opzioni di connettività semplice come Direct/TCP.</span><span class="sxs-lookup"><span data-stu-id="c0715-209">This includes using hello latest SDKs, configuring platform-specific configurations like default number of connections, frequency of garbage collection, and using lightweight connectivity options like Direct/TCP.</span></span> 


#### <a name="max-item-count"></a><span data-ttu-id="c0715-210">Numero massimo di elementi</span><span class="sxs-lookup"><span data-stu-id="c0715-210">Max Item Count</span></span>
<span data-ttu-id="c0715-211">Per le query, hello valore `MaxItemCount` può avere un impatto significativo sul tempo di query end-to-end.</span><span class="sxs-lookup"><span data-stu-id="c0715-211">For queries, hello value of `MaxItemCount` can have a significant impact on end-to-end query time.</span></span> <span data-ttu-id="c0715-212">Ogni round trip toohello viene restituito non più di numero hello di elementi in `MaxItemCount` (valore predefinito è 100 elementi).</span><span class="sxs-lookup"><span data-stu-id="c0715-212">Each round trip toohello server will return no more than hello number of items in `MaxItemCount` (Default of 100 items).</span></span> <span data-ttu-id="c0715-213">Impostazione del valore maggiore di tooa (-1 è consigliato e massima) migliorerà la durata delle query complessiva, limitando il numero di hello di round trip tra server e client, in particolare per le query con il set di risultati di grandi dimensioni.</span><span class="sxs-lookup"><span data-stu-id="c0715-213">Setting this tooa higher value (-1 is maximum, and recommended) will improve your query duration overall by limiting hello number of round trips between server and client, especially for queries with large result sets.</span></span>

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        MaxItemCount = -1, 
    }).AsDocumentQuery();
```

#### <a name="max-degree-of-parallelism"></a><span data-ttu-id="c0715-214">Massimo grado di parallelismo</span><span class="sxs-lookup"><span data-stu-id="c0715-214">Max Degree of Parallelism</span></span>
<span data-ttu-id="c0715-215">Per le query, ottimizzare hello `MaxDegreeOfParallelism` le configurazioni hello tooidentify per l'applicazione, soprattutto se l'esecuzione di query tra partizioni (senza un filtro sul valore della chiave di partizione hello).</span><span class="sxs-lookup"><span data-stu-id="c0715-215">For queries, tune hello `MaxDegreeOfParallelism` tooidentify hello best configurations for your application, especially if you perform cross-partition queries (without a filter on hello partition-key value).</span></span> <span data-ttu-id="c0715-216">`MaxDegreeOfParallelism`Controlla hello numero massimo di attività in parallelo, ad esempio, hello massimo toobe partizioni visitato in parallelo.</span><span class="sxs-lookup"><span data-stu-id="c0715-216">`MaxDegreeOfParallelism`  controls hello maximum number of parallel tasks, i.e., hello maximum of partitions toobe visited in parallel.</span></span> 

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        MaxDegreeOfParallelism = -1, 
        EnableCrossPartitionQuery = true 
    }).AsDocumentQuery();
```

<span data-ttu-id="c0715-217">Presupponendo che</span><span class="sxs-lookup"><span data-stu-id="c0715-217">Let’s assume that</span></span>
* <span data-ttu-id="c0715-218">D = numero massimo predefinito di attività in parallelo (= numero totale di processori nel computer client hello)</span><span class="sxs-lookup"><span data-stu-id="c0715-218">D = Default Maximum number of parallel tasks (= total number of processor in hello client machine)</span></span>
* <span data-ttu-id="c0715-219">P = Numero massimo di attività in parallelo specificato dall'utente</span><span class="sxs-lookup"><span data-stu-id="c0715-219">P = User-specified maximum number of parallel tasks</span></span>
* <span data-ttu-id="c0715-220">N = numero di partizioni che deve toobe visitato per la risposta a una query</span><span class="sxs-lookup"><span data-stu-id="c0715-220">N = Number of partitions that needs  toobe visited for answering a query</span></span>

<span data-ttu-id="c0715-221">Di seguito sono le implicazioni di comportamento query parallele hello per diversi valori di P.</span><span class="sxs-lookup"><span data-stu-id="c0715-221">Following are implications of how hello parallel queries would behave for different values of P.</span></span>
* <span data-ttu-id="c0715-222">(P == 0) => Modalità seriale</span><span class="sxs-lookup"><span data-stu-id="c0715-222">(P == 0) => Serial Mode</span></span>
* <span data-ttu-id="c0715-223">(P == 1) => Massimo un'attività</span><span class="sxs-lookup"><span data-stu-id="c0715-223">(P == 1) => Maximum of one task</span></span>
* <span data-ttu-id="c0715-224">(P > 1) => Attività in parallelo minime (P, N)</span><span class="sxs-lookup"><span data-stu-id="c0715-224">(P > 1) => Min (P, N) parallel tasks</span></span> 
* <span data-ttu-id="c0715-225">(P < 1) => Attività in parallelo minime (N, D)</span><span class="sxs-lookup"><span data-stu-id="c0715-225">(P < 1) => Min (N, D) parallel tasks</span></span>

<span data-ttu-id="c0715-226">Per le note sulla versione degli SDK e altre informazioni sulle classi e i metodi implementati, vedere [SDK di DocumentDB](documentdb-sdk-dotnet.md)</span><span class="sxs-lookup"><span data-stu-id="c0715-226">For SDK release notes, and details on implemented classes and methods see [DocumentDB SDKs](documentdb-sdk-dotnet.md)</span></span>

### <a name="network-latency"></a><span data-ttu-id="c0715-227">Latenza di rete</span><span class="sxs-lookup"><span data-stu-id="c0715-227">Network latency</span></span>
<span data-ttu-id="c0715-228">Vedere [distribuzione globale di Azure Cosmos DB](tutorial-global-distribution-documentdb.md) tooset distribuzione globale di backup, e collegare l'area più vicina toohello.</span><span class="sxs-lookup"><span data-stu-id="c0715-228">See [Azure Cosmos DB global distribution](tutorial-global-distribution-documentdb.md) for how tooset up global distribution, and connect toohello closest region.</span></span> <span data-ttu-id="c0715-229">Latenza di rete ha un impatto significativo sulle prestazioni delle query quando è necessario toomake più round trip o recuperare un grande set di risultati di query hello.</span><span class="sxs-lookup"><span data-stu-id="c0715-229">Network latency has a significant impact on query performance when you need toomake multiple round-trips or retrieve a large result set from hello query.</span></span> 

<span data-ttu-id="c0715-230">Hello sezione sulle metriche di esecuzione di query viene illustrato come tooretrieve hello server tempo di esecuzione di query ( `totalExecutionTimeInMs`), in modo che è possibile distinguere tra tempo impiegato per l'esecuzione di query e il tempo impiegato per il trasferimento di rete.</span><span class="sxs-lookup"><span data-stu-id="c0715-230">hello section on query execution metrics explains how tooretrieve hello server execution time of queries ( `totalExecutionTimeInMs`), so that you can differentiate between time spent in query execution and time spent in network transit.</span></span>

### <a name="indexing-policy"></a><span data-ttu-id="c0715-231">Criterio di indicizzazione</span><span class="sxs-lookup"><span data-stu-id="c0715-231">Indexing policy</span></span>
<span data-ttu-id="c0715-232">Per informazioni su percorsi, tipi e modalità di indicizzazione e sul relativo impatto sull'esecuzione delle query, vedere [Configurazione dei criteri di indicizzazione](indexing-policies.md).</span><span class="sxs-lookup"><span data-stu-id="c0715-232">See [Configuring indexing policy](indexing-policies.md) for indexing paths, kinds, and modes, and how they impact query execution.</span></span> <span data-ttu-id="c0715-233">Per impostazione predefinita, hello criteri di indicizzazione utilizza Hash l'indicizzazione per le stringhe, che è efficace per le query di uguaglianza, ma non per le query di intervallo/ordine dalle query.</span><span class="sxs-lookup"><span data-stu-id="c0715-233">By default, hello indexing policy uses Hash indexing for strings, which is effective for equality queries, but not for range queries/order by queries.</span></span> <span data-ttu-id="c0715-234">Se è necessario le query di intervallo per le stringhe, è consigliabile specificare il tipo di indice di intervallo per tutte le stringhe di hello.</span><span class="sxs-lookup"><span data-stu-id="c0715-234">If you need range queries for strings, we recommend specifying hello Range index type for all strings.</span></span> 

## <a name="query-execution-metrics"></a><span data-ttu-id="c0715-235">Metriche di esecuzione delle query</span><span class="sxs-lookup"><span data-stu-id="c0715-235">Query execution metrics</span></span>
<span data-ttu-id="c0715-236">È possibile ottenere le metriche dettagliate sull'esecuzione di query passando hello facoltativo `x-ms-documentdb-populatequerymetrics` intestazione (`FeedOptions.PopulateQueryMetrics` in hello .NET SDK).</span><span class="sxs-lookup"><span data-stu-id="c0715-236">You can obtain detailed metrics on query execution by passing in hello optional `x-ms-documentdb-populatequerymetrics` header (`FeedOptions.PopulateQueryMetrics` in hello .NET SDK).</span></span> <span data-ttu-id="c0715-237">valore restituito in Hello `x-ms-documentdb-query-metrics` ha hello seguenti coppie chiave-valore per risoluzione dell'esecuzione di query avanzata.</span><span class="sxs-lookup"><span data-stu-id="c0715-237">hello value returned in `x-ms-documentdb-query-metrics` has hello following key-value pairs meant for advanced troubleshooting of query execution.</span></span> 

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        PopulateQueryMetrics = true, 
    }).AsDocumentQuery();

FeedResponse<dynamic> result = await query.ExecuteNextAsync();

// Returns metrics by partition key range Id
IReadOnlyDictionary<string, QueryMetrics> metrics = result.QueryMetrics;

```

| <span data-ttu-id="c0715-238">Metrica</span><span class="sxs-lookup"><span data-stu-id="c0715-238">Metric</span></span> | <span data-ttu-id="c0715-239">Unità</span><span class="sxs-lookup"><span data-stu-id="c0715-239">Unit</span></span> | <span data-ttu-id="c0715-240">Descrizione</span><span class="sxs-lookup"><span data-stu-id="c0715-240">Description</span></span> | 
| ------ | -----| ----------- |
| `totalExecutionTimeInMs` | <span data-ttu-id="c0715-241">millisecondi</span><span class="sxs-lookup"><span data-stu-id="c0715-241">milliseconds</span></span> | <span data-ttu-id="c0715-242">Tempo di esecuzione della query</span><span class="sxs-lookup"><span data-stu-id="c0715-242">Query execution time</span></span> | 
| `queryCompileTimeInMs` | <span data-ttu-id="c0715-243">millisecondi</span><span class="sxs-lookup"><span data-stu-id="c0715-243">milliseconds</span></span> | <span data-ttu-id="c0715-244">Tempo di compilazione della query</span><span class="sxs-lookup"><span data-stu-id="c0715-244">Query compile time</span></span>  | 
| `queryLogicalPlanBuildTimeInMs` | <span data-ttu-id="c0715-245">millisecondi</span><span class="sxs-lookup"><span data-stu-id="c0715-245">milliseconds</span></span> | <span data-ttu-id="c0715-246">Piano di query logica toobuild ora</span><span class="sxs-lookup"><span data-stu-id="c0715-246">Time toobuild logical query plan</span></span> | 
| `queryPhysicalPlanBuildTimeInMs` | <span data-ttu-id="c0715-247">millisecondi</span><span class="sxs-lookup"><span data-stu-id="c0715-247">milliseconds</span></span> | <span data-ttu-id="c0715-248">Piano di query fisiche toobuild ora</span><span class="sxs-lookup"><span data-stu-id="c0715-248">Time toobuild physical query plan</span></span> | 
| `queryOptimizationTimeInMs` | <span data-ttu-id="c0715-249">millisecondi</span><span class="sxs-lookup"><span data-stu-id="c0715-249">milliseconds</span></span> | <span data-ttu-id="c0715-250">Tempo impiegato per l'ottimizzazione della query</span><span class="sxs-lookup"><span data-stu-id="c0715-250">Time spent in optimizing query</span></span> | 
| `VMExecutionTimeInMs` | <span data-ttu-id="c0715-251">millisecondi</span><span class="sxs-lookup"><span data-stu-id="c0715-251">milliseconds</span></span> | <span data-ttu-id="c0715-252">Tempo impiegato per l'esecuzione della query</span><span class="sxs-lookup"><span data-stu-id="c0715-252">Time spent in query runtime</span></span> | 
| `indexLookupTimeInMs` | <span data-ttu-id="c0715-253">millisecondi</span><span class="sxs-lookup"><span data-stu-id="c0715-253">milliseconds</span></span> | <span data-ttu-id="c0715-254">Tempo impiegato nel livello di indice fisico</span><span class="sxs-lookup"><span data-stu-id="c0715-254">Time spent in physical index layer</span></span> | 
| `documentLoadTimeInMs` | <span data-ttu-id="c0715-255">millisecondi</span><span class="sxs-lookup"><span data-stu-id="c0715-255">milliseconds</span></span> | <span data-ttu-id="c0715-256">Tempo impiegato per il caricamento di documenti</span><span class="sxs-lookup"><span data-stu-id="c0715-256">Time spent in loading documents</span></span>  | 
| `systemFunctionExecuteTimeInMs` | <span data-ttu-id="c0715-257">millisecondi</span><span class="sxs-lookup"><span data-stu-id="c0715-257">milliseconds</span></span> | <span data-ttu-id="c0715-258">Tempo totale impiegato per l'esecuzione di funzioni di sistema (predefinite) in millisecondi</span><span class="sxs-lookup"><span data-stu-id="c0715-258">Total time spent executing system (built-in) functions in milliseconds</span></span>  | 
| `userFunctionExecuteTimeInMs` | <span data-ttu-id="c0715-259">millisecondi</span><span class="sxs-lookup"><span data-stu-id="c0715-259">milliseconds</span></span> | <span data-ttu-id="c0715-260">Tempo totale impiegato per l'esecuzione di funzioni definite dall'utente in millisecondi</span><span class="sxs-lookup"><span data-stu-id="c0715-260">Total time spent executing user-defined functions in milliseconds</span></span> | 
| `retrievedDocumentCount` | <span data-ttu-id="c0715-261">millisecondi</span><span class="sxs-lookup"><span data-stu-id="c0715-261">milliseconds</span></span> | <span data-ttu-id="c0715-262">Numero totale di documenti recuperati</span><span class="sxs-lookup"><span data-stu-id="c0715-262">Total number of retrieved documents</span></span>  | 
| `retrievedDocumentSize` | <span data-ttu-id="c0715-263">byte</span><span class="sxs-lookup"><span data-stu-id="c0715-263">bytes</span></span> | <span data-ttu-id="c0715-264">Dimensione totale dei documenti recuperati in byte</span><span class="sxs-lookup"><span data-stu-id="c0715-264">Total size of retrieved documents in bytes</span></span>  | 
| `outputDocumentCount` | <span data-ttu-id="c0715-265">count</span><span class="sxs-lookup"><span data-stu-id="c0715-265">count</span></span> | <span data-ttu-id="c0715-266">Numero di documenti di output</span><span class="sxs-lookup"><span data-stu-id="c0715-266">Number of output documents</span></span> | 
| `writeOutputTimeInMs` | <span data-ttu-id="c0715-267">millisecondi</span><span class="sxs-lookup"><span data-stu-id="c0715-267">milliseconds</span></span> | <span data-ttu-id="c0715-268">Tempo di esecuzione della query in millisecondi</span><span class="sxs-lookup"><span data-stu-id="c0715-268">Query execution time in milliseconds</span></span> | 
| `indexUtilizationRatio` | <span data-ttu-id="c0715-269">rapporto (<=1)</span><span class="sxs-lookup"><span data-stu-id="c0715-269">ratio (<=1)</span></span> | <span data-ttu-id="c0715-270">Percentuale del numero di documenti corrispondente al numero di toohello hello filtro dei documenti caricati</span><span class="sxs-lookup"><span data-stu-id="c0715-270">Ratio of number of documents matched by hello filter toohello number of documents loaded</span></span>  | 

<span data-ttu-id="c0715-271">Hello client SDK possono internamente rendere più query tooserve hello query operazioni all'interno di ogni partizione.</span><span class="sxs-lookup"><span data-stu-id="c0715-271">hello client SDKs may internally make multiple query operations tooserve hello query within each partition.</span></span> <span data-ttu-id="c0715-272">client Hello rende più di una chiamata per ogni singola partizione se superano i risultati totali hello `x-ms-max-item-count`, se query hello maggiore velocità effettiva di provisioning hello per partizione hello, o se hello payload query raggiunge dimensioni massime di hello per pagina se hello query raggiunge hello sistema allocata limite di timeout.</span><span class="sxs-lookup"><span data-stu-id="c0715-272">hello client makes more than one call per-partition if hello total results exceed `x-ms-max-item-count`, if hello query exceeds hello provisioned throughput for hello partition, or if hello query payload reaches hello maximum size per page, or if hello query reaches hello system allocated timeout limit.</span></span> <span data-ttu-id="c0715-273">Ogni esecuzione parziale della query restituisce un `x-ms-documentdb-query-metrics` per la pagina.</span><span class="sxs-lookup"><span data-stu-id="c0715-273">Each partial query execution returns a `x-ms-documentdb-query-metrics` for that page.</span></span> 

<span data-ttu-id="c0715-274">Ecco alcune query di esempio e in che modo toointerpret alcune metriche hello restituiti dall'esecuzione di query:</span><span class="sxs-lookup"><span data-stu-id="c0715-274">Here are some sample queries, and how toointerpret some of hello metrics returned from query execution:</span></span> 

| <span data-ttu-id="c0715-275">Query</span><span class="sxs-lookup"><span data-stu-id="c0715-275">Query</span></span> | <span data-ttu-id="c0715-276">Metrica di esempio</span><span class="sxs-lookup"><span data-stu-id="c0715-276">Sample Metric</span></span> | <span data-ttu-id="c0715-277">Descrizione</span><span class="sxs-lookup"><span data-stu-id="c0715-277">Description</span></span> | 
| ------ | -----| ----------- |
| `SELECT TOP 100 * FROM c` | `"RetrievedDocumentCount": 101` | <span data-ttu-id="c0715-278">Hello numero di documenti recuperati è 100 + la clausola TOP 1 toomatch hello.</span><span class="sxs-lookup"><span data-stu-id="c0715-278">hello number of documents retrieved is 100+1 toomatch hello TOP clause.</span></span> <span data-ttu-id="c0715-279">Il tempo della query viene impiegato per lo più in `WriteOutputTime` e `DocumentLoadTime` poiché si tratta di un'analisi.</span><span class="sxs-lookup"><span data-stu-id="c0715-279">Query time is mostly spent in `WriteOutputTime` and `DocumentLoadTime` since it is a scan.</span></span> | 
| `SELECT TOP 500 * FROM c` | `"RetrievedDocumentCount": 501` | <span data-ttu-id="c0715-280">RetrievedDocumentCount è superiore (500 + 1 toomatch hello clausola TOP).</span><span class="sxs-lookup"><span data-stu-id="c0715-280">RetrievedDocumentCount is now higher (500+1 toomatch hello TOP clause).</span></span> | 
| `SELECT * FROM c WHERE c.N = 55` | `"IndexLookupTime": "00:00:00.0009500"` | <span data-ttu-id="c0715-281">Vengono impiegati circa 0,9 ms in IndexLookupTime per la ricerca della chiave, perché viene eseguita una ricerca nell'indice `/N/?`.</span><span class="sxs-lookup"><span data-stu-id="c0715-281">About 0.9 ms is spent in IndexLookupTime for a key lookup, because it's an index lookup on `/N/?`.</span></span> | 
| `SELECT * FROM c WHERE c.N > 55` | `"IndexLookupTime": "00:00:00.0017700"` | <span data-ttu-id="c0715-282">Un tempo leggermente superiore (1,7 ms) viene impiegato per IndexLookupTime nel caso di un'analisi dell'intervallo, perché viene eseguita una ricerca nell'indice `/N/?`.</span><span class="sxs-lookup"><span data-stu-id="c0715-282">Slightly more time (1.7 ms) spent in IndexLookupTime over a range scan, because it's an index lookup on `/N/?`.</span></span> | 
| `SELECT TOP 500 c.N FROM c` | `"IndexLookupTime": "00:00:00.0017700"` | <span data-ttu-id="c0715-283">Il tempo trascorso in `DocumentLoadTime` è lo stesso delle query precedenti, ma con un valore `WriteOutputTime` inferiore perché viene eseguita la proiezione di una sola proprietà.</span><span class="sxs-lookup"><span data-stu-id="c0715-283">Same time spent on `DocumentLoadTime` as previous queries, but lower `WriteOutputTime` because we're projecting only one property.</span></span> | 
| `SELECT TOP 500 udf.toPercent(c.N) FROM c` | `"UserDefinedFunctionExecutionTime": "00:00:00.2136500"` | <span data-ttu-id="c0715-284">Viene impiegato per circa 213 ms `UserDefinedFunctionExecutionTime` esecuzione hello funzione definita dall'utente su ogni valore di `c.N`.</span><span class="sxs-lookup"><span data-stu-id="c0715-284">About 213 ms is spent in `UserDefinedFunctionExecutionTime` executing hello UDF on each value of `c.N`.</span></span> |
| `SELECT TOP 500 c.Name FROM c WHERE STARTSWITH(c.Name, 'Den')` | `"IndexLookupTime": "00:00:00.0006400", "SystemFunctionExecutionTime": "00:00:00.0074100"` | <span data-ttu-id="c0715-285">Vengono impiegati circa 0,6 ms in `IndexLookupTime` su `/Name/?`.</span><span class="sxs-lookup"><span data-stu-id="c0715-285">About 0.6 ms is spent in `IndexLookupTime` on `/Name/?`.</span></span> <span data-ttu-id="c0715-286">La maggior parte delle hello query il tempo di esecuzione (ms ~ 7) in `SystemFunctionExecutionTime`.</span><span class="sxs-lookup"><span data-stu-id="c0715-286">Most of hello query execution time (~7 ms) in `SystemFunctionExecutionTime`.</span></span> |
| `SELECT TOP 500 c.Name FROM c WHERE STARTSWITH(LOWER(c.Name), 'den')` | `"IndexLookupTime": "00:00:00", "RetrievedDocumentCount": 2491,  "OutputDocumentCount": 500` | <span data-ttu-id="c0715-287">La query viene eseguita come un'analisi perché usa `LOWER` e vengono restituiti 500 su 2491 documenti recuperati.</span><span class="sxs-lookup"><span data-stu-id="c0715-287">Query is performed as a scan because it uses `LOWER`, and 500 out of 2491 retrieved documents are returned.</span></span> |


## <a name="next-steps"></a><span data-ttu-id="c0715-288">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="c0715-288">Next steps</span></span>
* <span data-ttu-id="c0715-289">toolearn hello supportato gli operatori di query SQL sulle parole chiave, vedere [query SQL](documentdb-sql-query.md).</span><span class="sxs-lookup"><span data-stu-id="c0715-289">toolearn about hello supported SQL query operators and keywords, see [SQL query](documentdb-sql-query.md).</span></span> 
* <span data-ttu-id="c0715-290">toolearn sulle unità di richiesta, vedere [unità richieste](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="c0715-290">toolearn about request units, see [request units](request-units.md).</span></span>
* <span data-ttu-id="c0715-291">toolearn sui criteri di indicizzazione, vedere [criteri di indicizzazione](indexing-policies.md)</span><span class="sxs-lookup"><span data-stu-id="c0715-291">toolearn about indexing policy, see [indexing policy](indexing-policies.md)</span></span> 


