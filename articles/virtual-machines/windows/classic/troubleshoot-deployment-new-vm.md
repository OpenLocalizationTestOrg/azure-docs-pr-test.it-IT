---
title: Risolvere i problemi della distribuzione classica di una macchina virtuale Windows | Microsoft Docs
description: Risolvere i problemi della distribuzione classica quando si crea una nuova macchina virtuale Windows in Azure
services: virtual-machines-windows
documentationcenter: 
author: JiangChen79
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 9f01d237-ba39-4c32-b72d-18f5f505d43a
ms.service: virtual-machines-windows
ms.workload: na
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 12/16/2016
ms.author: cjiang
ms.openlocfilehash: 990914e3d9541e8574ce6ba0bf6c996cb394470a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshoot-classic-deployment-issues-with-creating-a-new-windows-virtual-machine-in-azure"></a><span data-ttu-id="8fed8-103">Risolvere i problemi della distribuzione classica con la creazione di una nuova macchina virtuale Windows in Azure</span><span class="sxs-lookup"><span data-stu-id="8fed8-103">Troubleshoot classic deployment issues with creating a new Windows virtual machine in Azure</span></span>
[!INCLUDE [virtual-machines-troubleshoot-deployment-new-vm-selectors](../../../../includes/virtual-machines-windows-troubleshoot-deployment-new-vm-selectors-include.md)]

[!INCLUDE [virtual-machines-troubleshoot-deployment-new-vm-opening](../../../../includes/virtual-machines-troubleshoot-deployment-new-vm-opening-include.md)]

> [!IMPORTANT] 
> <span data-ttu-id="8fed8-104">Azure offre due diversi modelli di distribuzione per creare e usare le risorse: [Gestione risorse e la distribuzione classica](../../../resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="8fed8-104">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../resource-manager-deployment-model.md).</span></span> <span data-ttu-id="8fed8-105">Questo articolo illustra l'uso del modello di distribuzione classica.</span><span class="sxs-lookup"><span data-stu-id="8fed8-105">This article covers using the Classic deployment model.</span></span> <span data-ttu-id="8fed8-106">Microsoft consiglia di usare il modello di Gestione risorse per le distribuzioni più recenti.</span><span class="sxs-lookup"><span data-stu-id="8fed8-106">Microsoft recommends that most new deployments use the Resource Manager model.</span></span> <span data-ttu-id="8fed8-107">Per la versione di Resource Manager di questo articolo, vedere [qui](../../virtual-machines-windows-troubleshoot-deployment-new-vm.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="8fed8-107">For the Resource Manager version of this article, see [here](../../virtual-machines-windows-troubleshoot-deployment-new-vm.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

[!INCLUDE [support-disclaimer](../../../../includes/support-disclaimer.md)]

## <a name="collect-audit-logs"></a><span data-ttu-id="8fed8-108">Raccogliere log di controllo</span><span class="sxs-lookup"><span data-stu-id="8fed8-108">Collect audit logs</span></span>
<span data-ttu-id="8fed8-109">Per avviare la risoluzione dei problemi, raccogliere i log di controllo per identificare l'errore associato al problema.</span><span class="sxs-lookup"><span data-stu-id="8fed8-109">To start troubleshooting, collect the audit logs to identify the error associated with the issue.</span></span>

<span data-ttu-id="8fed8-110">Nel portale di Azure fare clic su **Esplora** > **Macchine virtuali** > *macchina virtuale Windows* > **Impostazioni** > **Log di controllo**.</span><span class="sxs-lookup"><span data-stu-id="8fed8-110">In the Azure portal, click **Browse** > **Virtual machines** > *your Windows virtual machine* > **Settings** > **Audit logs**.</span></span>

[!INCLUDE [virtual-machines-troubleshoot-deployment-new-vm-issue1](../../../../includes/virtual-machines-troubleshoot-deployment-new-vm-issue1-include.md)]

[!INCLUDE [virtual-machines-windows-troubleshoot-deployment-new-vm-table](../../../../includes/virtual-machines-windows-troubleshoot-deployment-new-vm-table.md)]

<span data-ttu-id="8fed8-111">**S:** se il sistema operativo è Windows generalizzato e viene caricato e/o acquisito con l'impostazione generalizzata, non si verificheranno errori.</span><span class="sxs-lookup"><span data-stu-id="8fed8-111">**Y:** If the OS is Windows generalized, and it is uploaded and/or captured with the generalized setting, then there won’t be any errors.</span></span> <span data-ttu-id="8fed8-112">Analogamente, se il sistema operativo Windows è specializzato e viene caricato e/o acquisito con l'impostazione specializzata, non si verificheranno errori.</span><span class="sxs-lookup"><span data-stu-id="8fed8-112">Similarly, if the OS is Windows specialized, and it is uploaded and/or captured with the specialized setting, then there won’t be any errors.</span></span>

<span data-ttu-id="8fed8-113">**Errori di caricamento:**</span><span class="sxs-lookup"><span data-stu-id="8fed8-113">**Upload Errors:**</span></span>

<span data-ttu-id="8fed8-114">**N<sup>1</sup>:** se il sistema operativo è Windows generalizzato e viene caricato come specializzato, si verificherà un errore di timeout del provisioning con la VM bloccata nella schermata di Configurazione guidata.</span><span class="sxs-lookup"><span data-stu-id="8fed8-114">**N<sup>1</sup>:** If the OS is Windows generalized, and it is uploaded as specialized, you will get a provisioning timeout error with the VM stuck at the OOBE screen.</span></span>

<span data-ttu-id="8fed8-115">**N<sup>2</sup>:** se il sistema operativo è Windows specializzato e viene caricato come generalizzato, si verificherà un errore di provisioning con la VM bloccata nella schermata di Configurazione guidata perché la nuova VM è in esecuzione con nome computer, nome utente e password originali.</span><span class="sxs-lookup"><span data-stu-id="8fed8-115">**N<sup>2</sup>:** If the OS is Windows specialized, and it is uploaded as generalized, you will get a provisioning failure error with the VM stuck at the OOBE screen because the new VM is running with the original computer name, username and password.</span></span>

<span data-ttu-id="8fed8-116">**Risoluzione:**</span><span class="sxs-lookup"><span data-stu-id="8fed8-116">**Resolution:**</span></span>

<span data-ttu-id="8fed8-117">Per risolvere entrambi questi errori, caricare il disco rigido virtuale originale, disponibile in locale, con la stessa impostazione usata per il sistema operativo (generalizzato/specializzato).</span><span class="sxs-lookup"><span data-stu-id="8fed8-117">To resolve both these errors, upload the original VHD, available on-prem, with the same setting as that for the OS (generalized/specialized).</span></span> <span data-ttu-id="8fed8-118">Per caricare il disco come generalizzato, ricordarsi di eseguire prima sysprep.</span><span class="sxs-lookup"><span data-stu-id="8fed8-118">To upload as generalized, remember to run sysprep first.</span></span> <span data-ttu-id="8fed8-119">Per altre informazioni, vedere [Creare e caricare un disco rigido virtuale con Windows Server in Azure](createupload-vhd.md) .</span><span class="sxs-lookup"><span data-stu-id="8fed8-119">See [Create and upload a Windows Server VHD to Azure](createupload-vhd.md) for more information.</span></span>

<span data-ttu-id="8fed8-120">**Errori di acquisizione:**</span><span class="sxs-lookup"><span data-stu-id="8fed8-120">**Capture Errors:**</span></span>

<span data-ttu-id="8fed8-121">**N<sup>3</sup>:** se il sistema operativo è Windows generalizzato e viene acquisito come specializzato, si verificherà un errore di timeout del provisioning perché la VM originale non può essere usata essendo contrassegnata come generalizzata.</span><span class="sxs-lookup"><span data-stu-id="8fed8-121">**N<sup>3</sup>:** If the OS is Windows generalized, and it is captured as specialized, you will get a provisioning timeout error because the original VM is not usable as it is marked as generalized.</span></span>

<span data-ttu-id="8fed8-122">**N<sup>4</sup>:** se il sistema operativo è Windows specializzato e viene acquisito come generalizzato, si verificherà un errore di provisioning perché la nuova VM è in esecuzione con nome computer, nome utente e password originali.</span><span class="sxs-lookup"><span data-stu-id="8fed8-122">**N<sup>4</sup>:** If the OS is Windows specialized, and it is captured as generalized, you will get a provisioning failure error because the new VM is running with the original computer name, username and password.</span></span> <span data-ttu-id="8fed8-123">La VM originale, inoltre, non può essere usata perché è contrassegnata come specializzata.</span><span class="sxs-lookup"><span data-stu-id="8fed8-123">Also, the original VM is not usable because it is marked as specialized.</span></span>

<span data-ttu-id="8fed8-124">**Risoluzione:**</span><span class="sxs-lookup"><span data-stu-id="8fed8-124">**Resolution:**</span></span>

<span data-ttu-id="8fed8-125">Per risolvere entrambi questi errori, eliminare l'immagine corrente dal portale e [acquisirla di nuovo dai dischi rigidi virtuali correnti](capture-image.md) con la stessa impostazione usata per il sistema operativo (generalizzato/specializzato).</span><span class="sxs-lookup"><span data-stu-id="8fed8-125">To resolve both these errors, delete the current image from the portal, and [recapture it from the current VHDs](capture-image.md) with the same setting as that for the OS (generalized/specialized).</span></span>

## <a name="issue-custom-gallery-marketplace-image-allocation-failure"></a><span data-ttu-id="8fed8-126">Problema: Immagine personalizzata/della raccolta/del marketplace - errore di allocazione</span><span class="sxs-lookup"><span data-stu-id="8fed8-126">Issue: Custom/ gallery/ marketplace image; allocation failure</span></span>
<span data-ttu-id="8fed8-127">Questo errore si verifica nelle situazioni in cui la nuova richiesta di VM viene inviata a un cluster che non ha spazio disponibile sufficiente per soddisfare la richiesta o che non può supportare le dimensioni della VM richieste.</span><span class="sxs-lookup"><span data-stu-id="8fed8-127">This error arises in situations when the new VM request is sent to a cluster that either does not have available free space to accommodate the request, or cannot support the VM size being requested.</span></span> <span data-ttu-id="8fed8-128">Non è possibile combinare serie di VM diverse nello stesso servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="8fed8-128">It is not possible to mix different series of VMs in the same cloud service.</span></span> <span data-ttu-id="8fed8-129">Se si vuole quindi creare una nuova VM con dimensioni diverse rispetto a quelle che il servizio cloud può supportare, la richiesta di calcolo non riuscirà.</span><span class="sxs-lookup"><span data-stu-id="8fed8-129">So if you want to create a new VM of a different size than what your cloud service can support, the compute request will fail.</span></span>

<span data-ttu-id="8fed8-130">In base ai vincoli del servizio cloud usato per creare la nuova VM, si potrebbe verificare un errore causato da una delle due situazioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="8fed8-130">Depending on the constraints of the cloud service you use to create the new VM, you might encounter an error caused by one of two situations.</span></span>

<span data-ttu-id="8fed8-131">**Causa 1:** il servizio cloud è aggiunto a un cluster specifico oppure è collegato a un gruppo di affinità e perciò aggiunto a un cluster specifico in base alla progettazione.</span><span class="sxs-lookup"><span data-stu-id="8fed8-131">**Cause 1:** The cloud service is pinned to a specific cluster, or it is linked to an affinity group, and hence pinned to a specific cluster by design.</span></span> <span data-ttu-id="8fed8-132">Le nuove richieste di risorse di calcolo in quel gruppo di affinità vengono quindi provate nello stesso cluster in cui sono ospitate le risorse esistenti.</span><span class="sxs-lookup"><span data-stu-id="8fed8-132">So new compute resource requests in that affinity group are tried in the same cluster where the existing resources are hosted.</span></span> <span data-ttu-id="8fed8-133">Tuttavia, lo stesso cluster potrebbe non supportare le dimensioni della VM richieste o non ha spazio disponibile sufficiente, causando un errore di allocazione.</span><span class="sxs-lookup"><span data-stu-id="8fed8-133">However, the same cluster may either not support the requested VM size or have insufficient available space, resulting in an allocation error.</span></span> <span data-ttu-id="8fed8-134">Questo vale indipendentemente dal fatto che le nuove risorse vengano create tramite un servizio cloud nuovo o esistente.</span><span class="sxs-lookup"><span data-stu-id="8fed8-134">This is true whether the new resources are created through a new cloud service or through an existing cloud service.</span></span>

<span data-ttu-id="8fed8-135">**Risoluzione 1:**</span><span class="sxs-lookup"><span data-stu-id="8fed8-135">**Resolution 1:**</span></span>

* <span data-ttu-id="8fed8-136">Creare un nuovo servizio cloud e associarlo a un'area o una rete virtuale basata sull'area.</span><span class="sxs-lookup"><span data-stu-id="8fed8-136">Create a new cloud service and associate it with either a region or a region-based virtual network.</span></span>
* <span data-ttu-id="8fed8-137">Crea una nuova VM nel nuovo servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="8fed8-137">Create a new VM in the new cloud service.</span></span>
  <span data-ttu-id="8fed8-138">Se si verifica un errore durante il tentativo di creare un nuovo servizio cloud, riprovare in un secondo momento o cambiare l'area per il servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="8fed8-138">If you get an error when trying to create a new cloud service, either retry at a later time or change the region for the cloud service.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="8fed8-139">Se si sta provando a creare una nuova VM in un servizio cloud esistente, ma è stato necessario creare un nuovo servizio cloud per la nuova VM, è possibile scegliere di consolidare tutte le VM nello stesso servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="8fed8-139">If you were trying to create a new VM in an existing cloud service but couldn’t, and had to create a new cloud service for your new VM, you can choose to consolidate all your VMs in the same cloud service.</span></span> <span data-ttu-id="8fed8-140">A questo scopo, eliminare le VM nel servizio cloud esistente e acquisirle di nuovo dai relativi dischi nel nuovo servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="8fed8-140">To do so, delete the VMs in the existing cloud service, and recapture them from their disks in the new cloud service.</span></span> <span data-ttu-id="8fed8-141">È tuttavia importante ricordare che il nuovo servizio cloud avrà un nuovo nome e un nuovo indirizzo VIP, quindi sarà necessario aggiornarli per tutte le dipendenze che attualmente usano queste informazioni per il servizio cloud esistente.</span><span class="sxs-lookup"><span data-stu-id="8fed8-141">However, it is important to remember that the new cloud service will have a new name and VIP, so you will need to update these for all the dependencies that currently use this information for the existing cloud service.</span></span>
> 
> 

<span data-ttu-id="8fed8-142">**Causa 2:** il servizio cloud è associato a una rete virtuale collegata a un gruppo di affinità e perciò è aggiunto a un cluster specifico in base alla progettazione.</span><span class="sxs-lookup"><span data-stu-id="8fed8-142">**Cause 2:** The cloud service is associated with a virtual network that is linked to an affinity group, so it is pinned to a specific cluster by design.</span></span> <span data-ttu-id="8fed8-143">Tutte le nuove richieste di risorse di calcolo in quel gruppo di affinità vengono quindi provate nello stesso cluster in cui sono ospitate le risorse esistenti.</span><span class="sxs-lookup"><span data-stu-id="8fed8-143">All new compute resource requests in that affinity group are therefore tried in the same cluster where the existing resources are hosted.</span></span> <span data-ttu-id="8fed8-144">Tuttavia, lo stesso cluster potrebbe non supportare le dimensioni della VM richieste o non ha spazio disponibile sufficiente, causando un errore di allocazione.</span><span class="sxs-lookup"><span data-stu-id="8fed8-144">However, the same cluster may either not support the requested VM size or have insufficient available space, resulting in an allocation error.</span></span> <span data-ttu-id="8fed8-145">Questo vale indipendentemente dal fatto che le nuove risorse vengano create tramite un servizio cloud nuovo o esistente.</span><span class="sxs-lookup"><span data-stu-id="8fed8-145">This is true whether the new resources are created through a new cloud service or through an existing cloud service.</span></span>

<span data-ttu-id="8fed8-146">**Risoluzione 2:**</span><span class="sxs-lookup"><span data-stu-id="8fed8-146">**Resolution 2:**</span></span>

* <span data-ttu-id="8fed8-147">Crea una nuova rete virtuale a livello di area</span><span class="sxs-lookup"><span data-stu-id="8fed8-147">Create a new regional virtual network.</span></span>
* <span data-ttu-id="8fed8-148">Creare la nuova VM nella nuova rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="8fed8-148">Create the new VM in the new virtual network.</span></span>
* <span data-ttu-id="8fed8-149">[Connettere la rete virtuale esistente](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/) alla nuova rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="8fed8-149">[Connect your existing virtual network](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/) to the new virtual network.</span></span> <span data-ttu-id="8fed8-150">Altre informazioni sulle [reti virtuali a livello di area](https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/).</span><span class="sxs-lookup"><span data-stu-id="8fed8-150">See more about [regional virtual networks](https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/).</span></span> <span data-ttu-id="8fed8-151">In alternativa, è possibile [eseguire la migrazione della rete virtuale basata su gruppi di affinità alla rete virtuale a livello di area](https://azure.microsoft.com/blog/2014/11/26/migrating-existing-services-to-regional-scope/)e quindi creare la nuova VM.</span><span class="sxs-lookup"><span data-stu-id="8fed8-151">Alternatively, you can [migrate your affinity-group-based virtual network to a regional virtual network](https://azure.microsoft.com/blog/2014/11/26/migrating-existing-services-to-regional-scope/), and then create the new VM.</span></span>

## <a name="next-steps"></a><span data-ttu-id="8fed8-152">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="8fed8-152">Next steps</span></span>
<span data-ttu-id="8fed8-153">Se si incontrano problemi quando si avvia una VM Windows arrestata o si ridimensiona una VM Windows esistente in Azure, vedere l'articolo su come [risolvere i problemi della distribuzione classica con il riavvio o il ridimensionamento di una macchina virtuale Windows esistente in Azure](virtual-machines-windows-classic-restart-resize-error-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="8fed8-153">If you encounter issues when you start a stopped Windows VM or resize an existing Windows VM in Azure, see [Troubleshoot classic deployment issues with restarting or resizing an existing Windows Virtual Machine in Azure](virtual-machines-windows-classic-restart-resize-error-troubleshooting.md).</span></span>

