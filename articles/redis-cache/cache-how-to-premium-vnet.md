---
title: Configurare una rete virtuale per un'istanza di Cache Redis di Azure Premium | Microsoft Docs
description: In questo articolo viene illustrato come creare e gestire il supporto di una rete virtuale per le istanze di Cache Redis di Azure Premium.
services: redis-cache
documentationcenter: 
author: steved0x
manager: douge
editor: 
ms.assetid: 8b1e43a0-a70e-41e6-8994-0ac246d8bf7f
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 05/15/2017
ms.author: sdanie
ms.openlocfilehash: 59d46990e02c0719d2b4df01e216a97fd649c509
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/18/2017
---
# <a name="how-to-configure-virtual-network-support-for-a-premium-azure-redis-cache"></a><span data-ttu-id="32b37-103">Come configurare il supporto di una rete virtuale per un'istanza Premium di Cache Redis di Azure</span><span class="sxs-lookup"><span data-stu-id="32b37-103">How to configure Virtual Network Support for a Premium Azure Redis Cache</span></span>
<span data-ttu-id="32b37-104">Cache Redis di Azure include diverse soluzioni cache che offrono flessibilità di scelta riguardo alle dimensioni e alle funzionalità della cache, tra cui le funzionalità del livello Premium come clustering, persistenza e supporto per reti virtuali.</span><span class="sxs-lookup"><span data-stu-id="32b37-104">Azure Redis Cache has different cache offerings, which provide flexibility in the choice of cache size and features, including Premium tier features such as clustering, persistence, and virtual network support.</span></span> <span data-ttu-id="32b37-105">Una rete virtuale è una rete privata nel cloud.</span><span class="sxs-lookup"><span data-stu-id="32b37-105">A VNet is a private network in the cloud.</span></span> <span data-ttu-id="32b37-106">Quando un'istanza di Cache Redis di Azure viene configurata con una rete virtuale, non è indirizzabile pubblicamente ed è accessibile solo da macchine virtuali e applicazioni all'interno della rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="32b37-106">When an Azure Redis Cache instance is configured with a VNet, it is not publicly addressable and can only be accessed from virtual machines and applications within the VNet.</span></span> <span data-ttu-id="32b37-107">Questo articolo descrive come configurare il supporto di una rete virtuale per un'istanza Premium di Cache Redis di Azure.</span><span class="sxs-lookup"><span data-stu-id="32b37-107">This article describes how to configure virtual network support for a premium Azure Redis Cache instance.</span></span>

> [!NOTE]
> <span data-ttu-id="32b37-108">Cache Redis di Azure supporta le reti virtuali classiche e di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="32b37-108">Azure Redis Cache supports both classic and Resource Manager VNets.</span></span>
> 
> 

<span data-ttu-id="32b37-109">Per informazioni su altre funzionalità di cache premium, vedere [Introduzione al piano Premium di Cache Redis di Azure](cache-premium-tier-intro.md).</span><span class="sxs-lookup"><span data-stu-id="32b37-109">For information on other premium cache features, see [Introduction to the Azure Redis Cache Premium tier](cache-premium-tier-intro.md).</span></span>

## <a name="why-vnet"></a><span data-ttu-id="32b37-110">Perché usare una rete virtuale?</span><span class="sxs-lookup"><span data-stu-id="32b37-110">Why VNet?</span></span>
<span data-ttu-id="32b37-111">La distribuzione di [Rete virtuale di Azure](https://azure.microsoft.com/services/virtual-network/) offre sicurezza e isolamento migliorati per Cache Redis di Azure, nonché subnet, criteri di controllo di accesso e altre funzionalità per limitare ulteriormente l'accesso.</span><span class="sxs-lookup"><span data-stu-id="32b37-111">[Azure Virtual Network (VNet)](https://azure.microsoft.com/services/virtual-network/) deployment provides enhanced security and isolation for your Azure Redis Cache, as well as subnets, access control policies, and other features to further restrict access.</span></span>

## <a name="virtual-network-support"></a><span data-ttu-id="32b37-112">Supporto della rete virtuale</span><span class="sxs-lookup"><span data-stu-id="32b37-112">Virtual network support</span></span>
<span data-ttu-id="32b37-113">Il supporto della rete virtuale viene configurato nel pannello **Nuova cache Redis** durante la creazione della cache.</span><span class="sxs-lookup"><span data-stu-id="32b37-113">Virtual Network (VNet) support is configured on the **New Redis Cache** blade during cache creation.</span></span> 

[!INCLUDE [redis-cache-create](../../includes/redis-cache-premium-create.md)]

<span data-ttu-id="32b37-114">Dopo aver selezionato un piano tariffario Premium, è possibile configurare l'integrazione rete virtuale di Cache Redis selezionando una rete virtuale nella stessa sottoscrizione e nella stessa posizione della cache.</span><span class="sxs-lookup"><span data-stu-id="32b37-114">Once you have selected a premium pricing tier, you can configure Redis VNet integration by selecting a VNet that is in the same subscription and location as your cache.</span></span> <span data-ttu-id="32b37-115">Per usare una nuova rete virtuale, è necessario prima crearla seguendo i passaggi in [Creare una rete virtuale usando il portale di Azure](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) o in [Creare una rete virtuale (classica) usando il portale di Azure](../virtual-network/virtual-networks-create-vnet-classic-pportal.md), quindi tornare al pannello **Nuova cache Redis** per creare e configurare la cache Premium.</span><span class="sxs-lookup"><span data-stu-id="32b37-115">To use a new VNet, create it first by following the steps in [Create a virtual network using the Azure portal](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) or [Create a virtual network (classic) by using the Azure portal](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) and then return to the **New Redis Cache** blade to create and configure your premium cache.</span></span>

<span data-ttu-id="32b37-116">Per configurare la rete virtuale per la nuova cache, fare clic su **Rete virtuale** nel pannello **Nuova cache Redis** e selezionare la rete virtuale desiderata dall'elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="32b37-116">To configure the VNet for your new cache, click **Virtual Network** on the **New Redis Cache** blade, and select the desired VNet from the drop-down list.</span></span>

![Rete virtuale][redis-cache-vnet]

<span data-ttu-id="32b37-118">Nell'elenco a discesa **Subnet** selezionare la subnet desiderata e specificare l'**indirizzo IP statico**.</span><span class="sxs-lookup"><span data-stu-id="32b37-118">Select the desired subnet from the **Subnet** drop-down list, and specify the desired **Static IP address**.</span></span> <span data-ttu-id="32b37-119">Se si usa una rete virtuale classica, il campo **Indirizzo IP statico** è facoltativo e, se non è specificato, ne verrà scelto uno dalla subnet selezionata.</span><span class="sxs-lookup"><span data-stu-id="32b37-119">If you are using a classic VNet the **Static IP address** field is optional, and if none is specified, one is chosen from the selected subnet.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="32b37-120">Quando si distribuisce Cache Redis di Azure in una rete virtuale di Resource Manager, la cache deve trovarsi in una subnet dedicata che non contiene altre risorse, ad eccezione delle istanze di Cache Redis di Azure.</span><span class="sxs-lookup"><span data-stu-id="32b37-120">When deploying an Azure Redis Cache to a Resource Manager VNet, the cache must be in a dedicated subnet that contains no other resources except for Azure Redis Cache instances.</span></span> <span data-ttu-id="32b37-121">Se si tenta di distribuire un'istanza di Cache Redis di Azure in una rete virtuale di Resource Manager all'interno di una subnet contenente altre risorse, la distribuzione non riesce.</span><span class="sxs-lookup"><span data-stu-id="32b37-121">If an attempt is made to deploy an Azure Redis Cache to a Resource Manager VNet to a subnet that contains other resources, the deployment fails.</span></span>
> 
> 

![Rete virtuale][redis-cache-vnet-ip]

> [!IMPORTANT]
> <span data-ttu-id="32b37-123">Azure riserva alcuni indirizzi IP all'interno di ogni subnet e questi indirizzi non possono essere usati.</span><span class="sxs-lookup"><span data-stu-id="32b37-123">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="32b37-124">Il primo e l'ultimo indirizzo IP delle subnet sono riservati per motivi di conformità al protocollo, insieme ad altri tre indirizzi usati per i servizi di Azure.</span><span class="sxs-lookup"><span data-stu-id="32b37-124">The first and last IP addresses of the subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="32b37-125">Per altre informazioni, vedere [Esistono restrizioni sull'uso di indirizzi IP all'interno di tali subnet?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="32b37-125">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>
> 
> <span data-ttu-id="32b37-126">Oltre agli indirizzi IP usati dall'infrastruttura di rete virtuale di Azure, ogni istanza di Cache Redis nella subnet usa due indirizzi IP per partizione e un altro indirizzo IP per il bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="32b37-126">In addition to the IP addresses used by the Azure VNET infrastructure, each Redis instance in the subnet uses two IP addresses per shard and one additional IP address for the load balancer.</span></span> <span data-ttu-id="32b37-127">Si presuppone che una cache non cluster includa una sola partizione.</span><span class="sxs-lookup"><span data-stu-id="32b37-127">A non-clustered cache is considered to have one shard.</span></span>
> 
> 

<span data-ttu-id="32b37-128">Dopo aver creato la cache, è possibile visualizzare la configurazione della rete virtuale facendo clic su **Rete virtuale** dal **menu Risorse**.</span><span class="sxs-lookup"><span data-stu-id="32b37-128">After the cache is created, you can view the configuration for the VNet by clicking **Virtual Network** from the **Resource menu**.</span></span>

![Rete virtuale][redis-cache-vnet-info]

<span data-ttu-id="32b37-130">Per connettersi all'istanza di Cache Redis di Azure quando si usa una rete virtuale, specificare il nome host della cache nella stringa di connessione, come mostrato nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="32b37-130">To connect to your Azure Redis cache instance when using a VNet, specify the host name of your cache in the connection string as shown in the following example:</span></span>

    private static Lazy<ConnectionMultiplexer> lazyConnection = new Lazy<ConnectionMultiplexer>(() =>
    {
        return ConnectionMultiplexer.Connect("contoso5premium.redis.cache.windows.net,abortConnect=false,ssl=true,password=password");
    });

    public static ConnectionMultiplexer Connection
    {
        get
        {
            return lazyConnection.Value;
        }
    }

## <a name="azure-redis-cache-vnet-faq"></a><span data-ttu-id="32b37-131">Domande frequenti sulla rete virtuale di Cache Redis di Azure</span><span class="sxs-lookup"><span data-stu-id="32b37-131">Azure Redis Cache VNet FAQ</span></span>
<span data-ttu-id="32b37-132">Nell'elenco seguente sono fornite le risposte alle domande poste comunemente sulla rete virtuale di Cache Redis di Azure.</span><span class="sxs-lookup"><span data-stu-id="32b37-132">The following list contains answers to commonly asked questions about the Azure Redis Cache scaling.</span></span>

* [<span data-ttu-id="32b37-133">Quali sono alcuni problemi comuni di configurazione errata per Cache Redis di Azure e le reti virtuali?</span><span class="sxs-lookup"><span data-stu-id="32b37-133">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>](#what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets)
* [<span data-ttu-id="32b37-134">Come è possibile verificare che la cache funzioni in una rete virtuale?</span><span class="sxs-lookup"><span data-stu-id="32b37-134">How can I verify that my cache is working in a VNET?</span></span>](#how-can-i-verify-that-my-cache-is-working-in-a-vnet)
* [<span data-ttu-id="32b37-135">È possibile usare reti virtuali con una cache Standard o Basic?</span><span class="sxs-lookup"><span data-stu-id="32b37-135">Can I use VNets with a standard or basic cache?</span></span>](#can-i-use-vnets-with-a-standard-or-basic-cache)
* [<span data-ttu-id="32b37-136">Perché la creazione di una cache Redis ha esito negativo in alcune subnet e non in altre?</span><span class="sxs-lookup"><span data-stu-id="32b37-136">Why does creating a Redis cache fail in some subnets but not others?</span></span>](#why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others)
* [<span data-ttu-id="32b37-137">Quali sono i requisiti di spazio per gli indirizzi di subnet?</span><span class="sxs-lookup"><span data-stu-id="32b37-137">What are the subnet address space requirements?</span></span>](#what-are-the-subnet-address-space-requirements)
* [<span data-ttu-id="32b37-138">Tutte le funzionalità della cache funzionano quando si ospita una cache in una rete virtuale?</span><span class="sxs-lookup"><span data-stu-id="32b37-138">Do all cache features work when hosting a cache in a VNET?</span></span>](#do-all-cache-features-work-when-hosting-a-cache-in-a-vnet)

## <a name="what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets"></a><span data-ttu-id="32b37-139">Quali sono alcuni problemi comuni di configurazione errata per Cache Redis di Azure e le reti virtuali?</span><span class="sxs-lookup"><span data-stu-id="32b37-139">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>
<span data-ttu-id="32b37-140">Quando Cache Redis di Azure è ospitata in una rete virtuale, vengono usate le porte indicate nelle tabelle seguenti.</span><span class="sxs-lookup"><span data-stu-id="32b37-140">When Azure Redis Cache is hosted in a VNet, the ports in the following tables are used.</span></span> 

>[!IMPORTANT]
><span data-ttu-id="32b37-141">Se le porte nelle tabelle seguenti sono bloccate, la cache potrebbe non funzionare correttamente.</span><span class="sxs-lookup"><span data-stu-id="32b37-141">If the ports in the following tables are blocked, the cache may not function correctly.</span></span> <span data-ttu-id="32b37-142">Il blocco di una o più di queste porte è il problema di configurazione più comune nell'uso di Cache Redis di Azure in una rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="32b37-142">Having one or more of these ports blocked is the most common misconfiguration issue when using Azure Redis Cache in a VNet.</span></span>
> 
> 

- [<span data-ttu-id="32b37-143">Requisiti delle porte in uscita</span><span class="sxs-lookup"><span data-stu-id="32b37-143">Outbound port requirements</span></span>](#outbound-port-requirements)
- [<span data-ttu-id="32b37-144">Requisiti delle porte in ingresso</span><span class="sxs-lookup"><span data-stu-id="32b37-144">Inbound port requirements</span></span>](#inbound-port-requirements)

### <a name="outbound-port-requirements"></a><span data-ttu-id="32b37-145">Requisiti delle porte in uscita</span><span class="sxs-lookup"><span data-stu-id="32b37-145">Outbound port requirements</span></span>

<span data-ttu-id="32b37-146">Vi sono sette requisiti delle porte in uscita.</span><span class="sxs-lookup"><span data-stu-id="32b37-146">There are seven outbound port requirements.</span></span>

- <span data-ttu-id="32b37-147">Se lo si desidera, tutte le connessioni a Internet in uscita possono essere eseguite tramite un dispositivo di controllo locale del cliente.</span><span class="sxs-lookup"><span data-stu-id="32b37-147">If desired, all outbound connections to the internet can be made through a client's on-premises auditing device.</span></span>
- <span data-ttu-id="32b37-148">Tre delle porte instradano il traffico a endpoint di Azure che servono Archiviazione di Azure e Azure DNS.</span><span class="sxs-lookup"><span data-stu-id="32b37-148">Three of the ports route traffic to Azure endpoints servicing Azure Storage and Azure DNS.</span></span>
- <span data-ttu-id="32b37-149">Gli intervalli di porte rimanenti sono destinati alle comunicazioni interne subnet di Redis.</span><span class="sxs-lookup"><span data-stu-id="32b37-149">The remaining port ranges and for internal Redis subnet communications.</span></span> <span data-ttu-id="32b37-150">Per le comunicazioni subnet interne di Redis non è richiesta alcuna regola NSG subnet.</span><span class="sxs-lookup"><span data-stu-id="32b37-150">No subnet NSG rules are required for internal Redis subnet communications.</span></span>

| <span data-ttu-id="32b37-151">Porte</span><span class="sxs-lookup"><span data-stu-id="32b37-151">Port(s)</span></span> | <span data-ttu-id="32b37-152">Direzione</span><span class="sxs-lookup"><span data-stu-id="32b37-152">Direction</span></span> | <span data-ttu-id="32b37-153">Protocollo di trasporto</span><span class="sxs-lookup"><span data-stu-id="32b37-153">Transport Protocol</span></span> | <span data-ttu-id="32b37-154">Scopo</span><span class="sxs-lookup"><span data-stu-id="32b37-154">Purpose</span></span> | <span data-ttu-id="32b37-155">IP locale</span><span class="sxs-lookup"><span data-stu-id="32b37-155">Local IP</span></span> | <span data-ttu-id="32b37-156">IP remoto</span><span class="sxs-lookup"><span data-stu-id="32b37-156">Remote IP</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="32b37-157">80, 443</span><span class="sxs-lookup"><span data-stu-id="32b37-157">80, 443</span></span> |<span data-ttu-id="32b37-158">In uscita</span><span class="sxs-lookup"><span data-stu-id="32b37-158">Outbound</span></span> |<span data-ttu-id="32b37-159">TCP</span><span class="sxs-lookup"><span data-stu-id="32b37-159">TCP</span></span> |<span data-ttu-id="32b37-160">Dipendenze Redis in Archiviazione di Azure/PKI (Internet)</span><span class="sxs-lookup"><span data-stu-id="32b37-160">Redis dependencies on Azure Storage/PKI (Internet)</span></span> | <span data-ttu-id="32b37-161">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-161">(Redis subnet)</span></span> |* |
| <span data-ttu-id="32b37-162">53</span><span class="sxs-lookup"><span data-stu-id="32b37-162">53</span></span> |<span data-ttu-id="32b37-163">In uscita</span><span class="sxs-lookup"><span data-stu-id="32b37-163">Outbound</span></span> |<span data-ttu-id="32b37-164">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="32b37-164">TCP/UDP</span></span> |<span data-ttu-id="32b37-165">Dipendenze Redis nel DNS (Internet/rete virtuale)</span><span class="sxs-lookup"><span data-stu-id="32b37-165">Redis dependencies on DNS (Internet/VNet)</span></span> | <span data-ttu-id="32b37-166">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-166">(Redis subnet)</span></span> |* |
| <span data-ttu-id="32b37-167">8443</span><span class="sxs-lookup"><span data-stu-id="32b37-167">8443</span></span> |<span data-ttu-id="32b37-168">In uscita</span><span class="sxs-lookup"><span data-stu-id="32b37-168">Outbound</span></span> |<span data-ttu-id="32b37-169">TCP</span><span class="sxs-lookup"><span data-stu-id="32b37-169">TCP</span></span> |<span data-ttu-id="32b37-170">Comunicazioni interne per Redis</span><span class="sxs-lookup"><span data-stu-id="32b37-170">Internal communications for Redis</span></span> | <span data-ttu-id="32b37-171">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-171">(Redis subnet)</span></span> | <span data-ttu-id="32b37-172">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-172">(Redis subnet)</span></span> |
| <span data-ttu-id="32b37-173">10221-10231</span><span class="sxs-lookup"><span data-stu-id="32b37-173">10221-10231</span></span> |<span data-ttu-id="32b37-174">In uscita</span><span class="sxs-lookup"><span data-stu-id="32b37-174">Outbound</span></span> |<span data-ttu-id="32b37-175">TCP</span><span class="sxs-lookup"><span data-stu-id="32b37-175">TCP</span></span> |<span data-ttu-id="32b37-176">Comunicazioni interne per Redis</span><span class="sxs-lookup"><span data-stu-id="32b37-176">Internal communications for Redis</span></span> | <span data-ttu-id="32b37-177">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-177">(Redis subnet)</span></span> | <span data-ttu-id="32b37-178">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-178">(Redis subnet)</span></span> |
| <span data-ttu-id="32b37-179">20226</span><span class="sxs-lookup"><span data-stu-id="32b37-179">20226</span></span> |<span data-ttu-id="32b37-180">In uscita</span><span class="sxs-lookup"><span data-stu-id="32b37-180">Outbound</span></span> |<span data-ttu-id="32b37-181">TCP</span><span class="sxs-lookup"><span data-stu-id="32b37-181">TCP</span></span> |<span data-ttu-id="32b37-182">Comunicazioni interne per Redis</span><span class="sxs-lookup"><span data-stu-id="32b37-182">Internal communications for Redis</span></span> | <span data-ttu-id="32b37-183">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-183">(Redis subnet)</span></span> |<span data-ttu-id="32b37-184">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-184">(Redis subnet)</span></span> |
| <span data-ttu-id="32b37-185">13000-13999</span><span class="sxs-lookup"><span data-stu-id="32b37-185">13000-13999</span></span> |<span data-ttu-id="32b37-186">In uscita</span><span class="sxs-lookup"><span data-stu-id="32b37-186">Outbound</span></span> |<span data-ttu-id="32b37-187">TCP</span><span class="sxs-lookup"><span data-stu-id="32b37-187">TCP</span></span> |<span data-ttu-id="32b37-188">Comunicazioni interne per Redis</span><span class="sxs-lookup"><span data-stu-id="32b37-188">Internal communications for Redis</span></span> | <span data-ttu-id="32b37-189">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-189">(Redis subnet)</span></span> |<span data-ttu-id="32b37-190">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-190">(Redis subnet)</span></span> |
| <span data-ttu-id="32b37-191">15000-15999</span><span class="sxs-lookup"><span data-stu-id="32b37-191">15000-15999</span></span> |<span data-ttu-id="32b37-192">In uscita</span><span class="sxs-lookup"><span data-stu-id="32b37-192">Outbound</span></span> |<span data-ttu-id="32b37-193">TCP</span><span class="sxs-lookup"><span data-stu-id="32b37-193">TCP</span></span> |<span data-ttu-id="32b37-194">Comunicazioni interne per Redis</span><span class="sxs-lookup"><span data-stu-id="32b37-194">Internal communications for Redis</span></span> | <span data-ttu-id="32b37-195">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-195">(Redis subnet)</span></span> |<span data-ttu-id="32b37-196">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-196">(Redis subnet)</span></span> |


### <a name="inbound-port-requirements"></a><span data-ttu-id="32b37-197">Requisiti delle porte in ingresso</span><span class="sxs-lookup"><span data-stu-id="32b37-197">Inbound port requirements</span></span>

<span data-ttu-id="32b37-198">Vi sono otto requisiti delle porte in ingresso.</span><span class="sxs-lookup"><span data-stu-id="32b37-198">There are eight inbound port range requirements.</span></span> <span data-ttu-id="32b37-199">Le richieste in ingresso in questi intervalli provengono da altri servizi ospitati nella stessa VNET o sono interne alle comunicazioni subnet di Redis.</span><span class="sxs-lookup"><span data-stu-id="32b37-199">Inbound requests in these ranges are either inbound from other services hosted in the same VNET or internal to the Redis subnet communications.</span></span>

| <span data-ttu-id="32b37-200">Porte</span><span class="sxs-lookup"><span data-stu-id="32b37-200">Port(s)</span></span> | <span data-ttu-id="32b37-201">Direzione</span><span class="sxs-lookup"><span data-stu-id="32b37-201">Direction</span></span> | <span data-ttu-id="32b37-202">Protocollo di trasporto</span><span class="sxs-lookup"><span data-stu-id="32b37-202">Transport Protocol</span></span> | <span data-ttu-id="32b37-203">Scopo</span><span class="sxs-lookup"><span data-stu-id="32b37-203">Purpose</span></span> | <span data-ttu-id="32b37-204">IP locale</span><span class="sxs-lookup"><span data-stu-id="32b37-204">Local IP</span></span> | <span data-ttu-id="32b37-205">IP remoto</span><span class="sxs-lookup"><span data-stu-id="32b37-205">Remote IP</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="32b37-206">6379, 6380</span><span class="sxs-lookup"><span data-stu-id="32b37-206">6379, 6380</span></span> |<span data-ttu-id="32b37-207">In ingresso</span><span class="sxs-lookup"><span data-stu-id="32b37-207">Inbound</span></span> |<span data-ttu-id="32b37-208">TCP</span><span class="sxs-lookup"><span data-stu-id="32b37-208">TCP</span></span> |<span data-ttu-id="32b37-209">Comunicazione tra client e Redis, bilanciamento del carico di Azure</span><span class="sxs-lookup"><span data-stu-id="32b37-209">Client communication to Redis, Azure load balancing</span></span> | <span data-ttu-id="32b37-210">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-210">(Redis subnet)</span></span> |<span data-ttu-id="32b37-211">Rete virtuale, Bilanciamento carico di Azure</span><span class="sxs-lookup"><span data-stu-id="32b37-211">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="32b37-212">8443</span><span class="sxs-lookup"><span data-stu-id="32b37-212">8443</span></span> |<span data-ttu-id="32b37-213">In ingresso</span><span class="sxs-lookup"><span data-stu-id="32b37-213">Inbound</span></span> |<span data-ttu-id="32b37-214">TCP</span><span class="sxs-lookup"><span data-stu-id="32b37-214">TCP</span></span> |<span data-ttu-id="32b37-215">Comunicazioni interne per Redis</span><span class="sxs-lookup"><span data-stu-id="32b37-215">Internal communications for Redis</span></span> | <span data-ttu-id="32b37-216">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-216">(Redis subnet)</span></span> |<span data-ttu-id="32b37-217">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-217">(Redis subnet)</span></span> |
| <span data-ttu-id="32b37-218">8500</span><span class="sxs-lookup"><span data-stu-id="32b37-218">8500</span></span> |<span data-ttu-id="32b37-219">In ingresso</span><span class="sxs-lookup"><span data-stu-id="32b37-219">Inbound</span></span> |<span data-ttu-id="32b37-220">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="32b37-220">TCP/UDP</span></span> |<span data-ttu-id="32b37-221">Bilanciamento del carico di Azure</span><span class="sxs-lookup"><span data-stu-id="32b37-221">Azure load balancing</span></span> | <span data-ttu-id="32b37-222">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-222">(Redis subnet)</span></span> |<span data-ttu-id="32b37-223">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="32b37-223">Azure Load Balancer</span></span> |
| <span data-ttu-id="32b37-224">10221-10231</span><span class="sxs-lookup"><span data-stu-id="32b37-224">10221-10231</span></span> |<span data-ttu-id="32b37-225">In ingresso</span><span class="sxs-lookup"><span data-stu-id="32b37-225">Inbound</span></span> |<span data-ttu-id="32b37-226">TCP</span><span class="sxs-lookup"><span data-stu-id="32b37-226">TCP</span></span> |<span data-ttu-id="32b37-227">Comunicazioni interne per Redis</span><span class="sxs-lookup"><span data-stu-id="32b37-227">Internal communications for Redis</span></span> | <span data-ttu-id="32b37-228">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-228">(Redis subnet)</span></span> |<span data-ttu-id="32b37-229">(Subnet Redis), bilanciamento del carico di Azure</span><span class="sxs-lookup"><span data-stu-id="32b37-229">(Redis subnet), Azure Load Balancer</span></span> |
| <span data-ttu-id="32b37-230">13000-13999</span><span class="sxs-lookup"><span data-stu-id="32b37-230">13000-13999</span></span> |<span data-ttu-id="32b37-231">In ingresso</span><span class="sxs-lookup"><span data-stu-id="32b37-231">Inbound</span></span> |<span data-ttu-id="32b37-232">TCP</span><span class="sxs-lookup"><span data-stu-id="32b37-232">TCP</span></span> |<span data-ttu-id="32b37-233">Comunicazione tra client e cluster Redis, bilanciamento del carico di Azure</span><span class="sxs-lookup"><span data-stu-id="32b37-233">Client communication to Redis Clusters, Azure load balancing</span></span> | <span data-ttu-id="32b37-234">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-234">(Redis subnet)</span></span> |<span data-ttu-id="32b37-235">Rete virtuale, Bilanciamento carico di Azure</span><span class="sxs-lookup"><span data-stu-id="32b37-235">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="32b37-236">15000-15999</span><span class="sxs-lookup"><span data-stu-id="32b37-236">15000-15999</span></span> |<span data-ttu-id="32b37-237">In ingresso</span><span class="sxs-lookup"><span data-stu-id="32b37-237">Inbound</span></span> |<span data-ttu-id="32b37-238">TCP</span><span class="sxs-lookup"><span data-stu-id="32b37-238">TCP</span></span> |<span data-ttu-id="32b37-239">Comunicazione tra client e cluster Redis, bilanciamento del carico di Azure</span><span class="sxs-lookup"><span data-stu-id="32b37-239">Client communication to Redis Clusters, Azure load Balancing</span></span> | <span data-ttu-id="32b37-240">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-240">(Redis subnet)</span></span> |<span data-ttu-id="32b37-241">Rete virtuale, Bilanciamento carico di Azure</span><span class="sxs-lookup"><span data-stu-id="32b37-241">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="32b37-242">16001</span><span class="sxs-lookup"><span data-stu-id="32b37-242">16001</span></span> |<span data-ttu-id="32b37-243">In ingresso</span><span class="sxs-lookup"><span data-stu-id="32b37-243">Inbound</span></span> |<span data-ttu-id="32b37-244">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="32b37-244">TCP/UDP</span></span> |<span data-ttu-id="32b37-245">Bilanciamento del carico di Azure</span><span class="sxs-lookup"><span data-stu-id="32b37-245">Azure load balancing</span></span> | <span data-ttu-id="32b37-246">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-246">(Redis subnet)</span></span> |<span data-ttu-id="32b37-247">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="32b37-247">Azure Load Balancer</span></span> |
| <span data-ttu-id="32b37-248">20226</span><span class="sxs-lookup"><span data-stu-id="32b37-248">20226</span></span> |<span data-ttu-id="32b37-249">In ingresso</span><span class="sxs-lookup"><span data-stu-id="32b37-249">Inbound</span></span> |<span data-ttu-id="32b37-250">TCP</span><span class="sxs-lookup"><span data-stu-id="32b37-250">TCP</span></span> |<span data-ttu-id="32b37-251">Comunicazioni interne per Redis</span><span class="sxs-lookup"><span data-stu-id="32b37-251">Internal communications for Redis</span></span> | <span data-ttu-id="32b37-252">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-252">(Redis subnet)</span></span> |<span data-ttu-id="32b37-253">(Subnet Redis)</span><span class="sxs-lookup"><span data-stu-id="32b37-253">(Redis subnet)</span></span> |

### <a name="additional-vnet-network-connectivity-requirements"></a><span data-ttu-id="32b37-254">Ulteriori requisiti di connettività della rete VNET</span><span class="sxs-lookup"><span data-stu-id="32b37-254">Additional VNET network connectivity requirements</span></span>

<span data-ttu-id="32b37-255">Esistono requisiti di connettività di rete per Cache Redis di Azure che potrebbero non essere inizialmente soddisfatti in una rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="32b37-255">There are network connectivity requirements for Azure Redis Cache that may not be initially met in a virtual network.</span></span> <span data-ttu-id="32b37-256">Per il corretto funzionamento se usato all'interno di una rete virtuale, Cache Redis di Azure richiede tutti gli elementi seguenti.</span><span class="sxs-lookup"><span data-stu-id="32b37-256">Azure Redis Cache requires all the following items to function properly when used within a virtual network.</span></span>

* <span data-ttu-id="32b37-257">Connettività di rete in uscita per endpoint di archiviazione di Azure in tutto il mondo.</span><span class="sxs-lookup"><span data-stu-id="32b37-257">Outbound network connectivity to Azure Storage endpoints worldwide.</span></span> <span data-ttu-id="32b37-258">Sono inclusi gli endpoint che si trovano nella stessa area dell'istanza di Cache Redis di Azure, nonché gli endpoint di archiviazione che si trovano in **altre** aree di Azure.</span><span class="sxs-lookup"><span data-stu-id="32b37-258">This includes endpoints located in the same region as the Azure Redis Cache instance, as well as storage endpoints located in **other** Azure regions.</span></span> <span data-ttu-id="32b37-259">Gli endpoint di Archiviazione di Azure vengono risolti nei seguenti domini DNS: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net* e *file.core.windows.net*.</span><span class="sxs-lookup"><span data-stu-id="32b37-259">Azure Storage endpoints resolve under the following DNS domains: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net*, and *file.core.windows.net*.</span></span> 
* <span data-ttu-id="32b37-260">Connettività di rete in uscita verso *ocsp.msocsp.com*, *mscrl.microsoft.com* e *crl.microsoft.com*. Tale connettività è necessaria per il supporto della funzionalità SSL.</span><span class="sxs-lookup"><span data-stu-id="32b37-260">Outbound network connectivity to *ocsp.msocsp.com*, *mscrl.microsoft.com*, and *crl.microsoft.com*. This connectivity is needed to support SSL functionality.</span></span>
* <span data-ttu-id="32b37-261">La configurazione DNS per la rete virtuale deve essere in grado di risolvere tutti gli endpoint e i domini indicati nei punti precedenti.</span><span class="sxs-lookup"><span data-stu-id="32b37-261">The DNS configuration for the virtual network must be capable of resolving all of the endpoints and domains mentioned in the earlier points.</span></span> <span data-ttu-id="32b37-262">Questi requisiti DNS possono essere soddisfatti garantendo che un'infrastruttura DNS valida venga configurata e mantenuta per la rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="32b37-262">These DNS requirements can be met by ensuring a valid DNS infrastructure is configured and maintained for the virtual network.</span></span>
* <span data-ttu-id="32b37-263">Connettività di rete in uscita agli endpoint di Monitoraggio di Azure seguenti, che vengono risolti nei domini DNS seguenti: shoebox2-black.shoebox2.metrics.nsatc.net, north-prod2.prod2.metrics.nsatc.net, azglobal-black.azglobal.metrics.nsatc.net, shoebox2-red.shoebox2.metrics.nsatc.net, east-prod2.prod2.metrics.nsatc.net, azglobal-red.azglobal.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="32b37-263">Outbound network connectivity to the following Azure Monitoring endpoints, which resolve under the following DNS domains: shoebox2-black.shoebox2.metrics.nsatc.net, north-prod2.prod2.metrics.nsatc.net, azglobal-black.azglobal.metrics.nsatc.net, shoebox2-red.shoebox2.metrics.nsatc.net, east-prod2.prod2.metrics.nsatc.net, azglobal-red.azglobal.metrics.nsatc.net.</span></span>

### <a name="how-can-i-verify-that-my-cache-is-working-in-a-vnet"></a><span data-ttu-id="32b37-264">Come è possibile verificare che la cache funzioni in una rete virtuale?</span><span class="sxs-lookup"><span data-stu-id="32b37-264">How can I verify that my cache is working in a VNET?</span></span>

>[!IMPORTANT]
><span data-ttu-id="32b37-265">Quando ci si connette a un'istanza di Cache Redis di Azure ospitata in una rete virtuale, i client della cache devono trovarsi nella stessa rete virtuale, incluse eventuali applicazioni di test o strumenti di diagnostica ping.</span><span class="sxs-lookup"><span data-stu-id="32b37-265">When connecting to an Azure Redis Cache instance that is hosted in a VNET, your cache clients must be in the same VNET, including any test applications or diagnostic pinging tools.</span></span>
>
>

<span data-ttu-id="32b37-266">Dopo aver configurato i requisiti delle porte come descritto nella sezione precedente, è possibile verificare che la cache funzioni eseguendo la procedura seguente.</span><span class="sxs-lookup"><span data-stu-id="32b37-266">Once the port requirements are configured as described in the previous section, you can verify that your cache is working by performing the following steps.</span></span>

- <span data-ttu-id="32b37-267">[Riavviare](cache-administration.md#reboot) tutti i nodi della cache.</span><span class="sxs-lookup"><span data-stu-id="32b37-267">[Reboot](cache-administration.md#reboot) all of the cache nodes.</span></span> <span data-ttu-id="32b37-268">Se non è possibile raggiungere tutte le dipendenze della cache richieste (come descritto in [Requisiti delle porte in ingresso](cache-how-to-premium-vnet.md#inbound-port-requirements) e [Requisiti delle porte in uscita](cache-how-to-premium-vnet.md#outbound-port-requirements)), la cache non sarà in grado di riavviarsi.</span><span class="sxs-lookup"><span data-stu-id="32b37-268">If all of the required cache dependencies can't be reached (as documented in [Inbound port requirements](cache-how-to-premium-vnet.md#inbound-port-requirements) and [Outbound port requirements](cache-how-to-premium-vnet.md#outbound-port-requirements)), the cache won't be able to restart successfully.</span></span>
- <span data-ttu-id="32b37-269">Dopo il riavvio dei nodi della cache (come riportato dallo stato della cache nel portale di Azure), è possibile eseguire i test seguenti:</span><span class="sxs-lookup"><span data-stu-id="32b37-269">Once the cache nodes have restarted (as reported by the cache status in the Azure portal), you can perform the following tests:</span></span>
  - <span data-ttu-id="32b37-270">eseguire il ping dell'endpoint della cache (tramite la porta 6380) da un computer che si trova all'interno della stessa rete virtuale della cache tramite [tcping](https://www.elifulkerson.com/projects/tcping.php).</span><span class="sxs-lookup"><span data-stu-id="32b37-270">ping the cache endpoint (using port 6380) from a machine that is within the same VNET as the cache, using [tcping](https://www.elifulkerson.com/projects/tcping.php).</span></span> <span data-ttu-id="32b37-271">ad esempio:</span><span class="sxs-lookup"><span data-stu-id="32b37-271">For example:</span></span>
    
    `tcping.exe contosocache.redis.cache.windows.net 6380`
    
    <span data-ttu-id="32b37-272">Se lo strumento `tcping` indica che la porta è aperta, la cache è disponibile per la connessione dai client nella rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="32b37-272">If the `tcping` tool reports that the port is open, the cache is available for connection from clients in the VNET.</span></span>

  - <span data-ttu-id="32b37-273">Un altro modo per eseguire il test è quello di creare un client della cache di test (che potrebbe essere una semplice applicazione della console tramite StackExchange.Redis) che si connette alla cache, aggiunge e recupera alcuni elementi dalla cache.</span><span class="sxs-lookup"><span data-stu-id="32b37-273">Another way to test is to create a test cache client (which could be a simple console application using StackExchange.Redis) that connects to the cache and adds and retrieves some items from the cache.</span></span> <span data-ttu-id="32b37-274">Installare l'applicazione client di esempio in una macchina virtuale che si trova nella stessa rete virtuale della cache ed eseguirla per verificare la connettività alla cache.</span><span class="sxs-lookup"><span data-stu-id="32b37-274">Install the sample client application onto a VM that is in the same VNET as the cache and run it to verify connectivity to the cache.</span></span>


### <a name="can-i-use-vnets-with-a-standard-or-basic-cache"></a><span data-ttu-id="32b37-275">È possibile usare reti virtuali con una cache Standard o Basic?</span><span class="sxs-lookup"><span data-stu-id="32b37-275">Can I use VNets with a standard or basic cache?</span></span>
<span data-ttu-id="32b37-276">Le reti virtuali possono essere usate solo con cache Premium.</span><span class="sxs-lookup"><span data-stu-id="32b37-276">VNets can only be used with premium caches.</span></span>

### <a name="why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others"></a><span data-ttu-id="32b37-277">Perché la creazione di una cache Redis ha esito negativo in alcune subnet e non in altre?</span><span class="sxs-lookup"><span data-stu-id="32b37-277">Why does creating a Redis cache fail in some subnets but not others?</span></span>
<span data-ttu-id="32b37-278">Quando si distribuisce un'istanza di Cache Redis di Azure in una rete virtuale di Resource Manager, la cache deve trovarsi in una subnet dedicata che non contiene altri tipi di risorse.</span><span class="sxs-lookup"><span data-stu-id="32b37-278">If you are deploying an Azure Redis Cache to a Resource Manager VNet, the cache must be in a dedicated subnet that contains no other resource type.</span></span> <span data-ttu-id="32b37-279">Se si tenta di distribuire un'istanza di Cache Redis di Azure in una rete virtuale di Resource Manager all'interno di una subnet contenente altre risorse, la distribuzione non riesce.</span><span class="sxs-lookup"><span data-stu-id="32b37-279">If an attempt is made to deploy an Azure Redis Cache to a Resource Manager VNet subnet that contains other resources, the deployment fails.</span></span> <span data-ttu-id="32b37-280">Prima di poter creare una nuova cache Redis, è necessario eliminare le risorse esistenti all'interno della subnet.</span><span class="sxs-lookup"><span data-stu-id="32b37-280">You must delete the existing resources inside the subnet before you can create a new Redis cache.</span></span>

<span data-ttu-id="32b37-281">È possibile distribuire più tipi di risorse in una rete virtuale classica, purché siano disponibili indirizzi IP sufficienti.</span><span class="sxs-lookup"><span data-stu-id="32b37-281">You can deploy multiple types of resources to a classic VNet as long as you have enough IP addresses available.</span></span>

### <a name="what-are-the-subnet-address-space-requirements"></a><span data-ttu-id="32b37-282">Quali sono i requisiti di spazio per gli indirizzi di subnet?</span><span class="sxs-lookup"><span data-stu-id="32b37-282">What are the subnet address space requirements?</span></span>
<span data-ttu-id="32b37-283">Azure riserva alcuni indirizzi IP all'interno di ogni subnet e questi indirizzi non possono essere usati.</span><span class="sxs-lookup"><span data-stu-id="32b37-283">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="32b37-284">Il primo e l'ultimo indirizzo IP delle subnet sono riservati per motivi di conformità al protocollo, insieme ad altri tre indirizzi usati per i servizi di Azure.</span><span class="sxs-lookup"><span data-stu-id="32b37-284">The first and last IP addresses of the subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="32b37-285">Per altre informazioni, vedere [Esistono restrizioni sull'uso di indirizzi IP all'interno di tali subnet?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="32b37-285">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>

<span data-ttu-id="32b37-286">Oltre agli indirizzi IP usati dall'infrastruttura di rete virtuale di Azure, ogni istanza di Cache Redis nella subnet usa due indirizzi IP per partizione e un altro indirizzo IP per il bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="32b37-286">In addition to the IP addresses used by the Azure VNET infrastructure, each Redis instance in the subnet uses two IP addresses per shard and one additional IP address for the load balancer.</span></span> <span data-ttu-id="32b37-287">Si presuppone che una cache non cluster includa una sola partizione.</span><span class="sxs-lookup"><span data-stu-id="32b37-287">A non-clustered cache is considered to have one shard.</span></span>

### <a name="do-all-cache-features-work-when-hosting-a-cache-in-a-vnet"></a><span data-ttu-id="32b37-288">Tutte le funzionalità della cache funzionano quando si ospita una cache in una rete virtuale?</span><span class="sxs-lookup"><span data-stu-id="32b37-288">Do all cache features work when hosting a cache in a VNET?</span></span>
<span data-ttu-id="32b37-289">Quando la cache fa parte di una rete virtuale, solo i client nella rete virtuale possono accedere alla cache.</span><span class="sxs-lookup"><span data-stu-id="32b37-289">When your cache is part of a VNET, only clients in the VNET can access the cache.</span></span> <span data-ttu-id="32b37-290">Di conseguenza, le seguenti funzionalità di gestione della cache non funzionano in questo momento.</span><span class="sxs-lookup"><span data-stu-id="32b37-290">As a result, the following cache management features don't work at this time.</span></span>

* <span data-ttu-id="32b37-291">Console Redis: poiché la console Redis viene eseguita nel browser locale, che si trova esternamente alla rete virtuale, non può connettersi alla cache.</span><span class="sxs-lookup"><span data-stu-id="32b37-291">Redis Console - Because Redis Console runs in your local browser, which is outside the VNET, it can't connect to your cache.</span></span>

## <a name="use-expressroute-with-azure-redis-cache"></a><span data-ttu-id="32b37-292">Usare ExpressRoute con Cache Redis di Azure</span><span class="sxs-lookup"><span data-stu-id="32b37-292">Use ExpressRoute with Azure Redis Cache</span></span>
<span data-ttu-id="32b37-293">I clienti possono connettere un circuito [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) all'infrastruttura di rete virtuale per estendere la rete locale ad Azure.</span><span class="sxs-lookup"><span data-stu-id="32b37-293">Customers can connect an [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) circuit to their virtual network infrastructure, thus extending their on-premises network to Azure.</span></span> 

<span data-ttu-id="32b37-294">Per impostazione predefinita, un circuito ExpressRoute appena creato non esegue il tunneling forzato (annuncio della route predefinita, 0.0.0.0/0) in una rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="32b37-294">By default, a newly created ExpressRoute circuit does not perform forced tunneling (advertisement of a default route, 0.0.0.0/0) on a VNET.</span></span> <span data-ttu-id="32b37-295">Di conseguenza, la connettività Internet in uscita è consentita direttamente dalla rete virtuale e le applicazioni client sono in grado di connettersi agli altri endpoint di Azure tra cui la Cache Redis di Azure.</span><span class="sxs-lookup"><span data-stu-id="32b37-295">As a result, outbound Internet connectivity is allowed directly from the VNET and client applications are able to connect to other Azure endpoints including Azure Redis Cache.</span></span>

<span data-ttu-id="32b37-296">Tuttavia, una configurazione comune dei clienti è quella di usare il tunneling forzato (segnalare una route predefinita) verso la quale viene forzato il traffico Internet in uscita invece di far passare il flusso localmente.</span><span class="sxs-lookup"><span data-stu-id="32b37-296">However a common customer configuration is to use forced tunneling (advertise a default route) which forces outbound Internet traffic to instead flow on-premises.</span></span> <span data-ttu-id="32b37-297">Questo flusso di traffico interrompe la connettività con Cache Redis di Azure se il traffico in uscita viene quindi bloccato in locale in modo da impedire all'istanza di Cache Redis di Azure di comunicare con le proprie dipendenze.</span><span class="sxs-lookup"><span data-stu-id="32b37-297">This traffic flow breaks connectivity with Azure Redis Cache if the outbound traffic is then blocked on-premises such that the Azure Redis Cache instance is not able to communicate with its dependencies.</span></span>

<span data-ttu-id="32b37-298">La soluzione consiste nel definire una o più route definite dall'utente (UDR, User Defined Route) nella subnet contenente la Cache Redis di Azure.</span><span class="sxs-lookup"><span data-stu-id="32b37-298">The solution is to define one (or more) user-defined routes (UDRs) on the subnet that contains the Azure Redis Cache.</span></span> <span data-ttu-id="32b37-299">Una route UDR definisce le route specifiche della subnet che verranno accettate invece della route predefinita.</span><span class="sxs-lookup"><span data-stu-id="32b37-299">A UDR defines subnet-specific routes that will be honored instead of the default route.</span></span>

<span data-ttu-id="32b37-300">Se possibile, è consigliabile utilizzare la seguente configurazione:</span><span class="sxs-lookup"><span data-stu-id="32b37-300">If possible, it is recommended to use the following configuration:</span></span>

* <span data-ttu-id="32b37-301">La configurazione di ExpressRoute annuncia 0.0.0.0/0 e per impostazione predefinita esegue il tunneling forzato di tutto il traffico in uscita in un ambiente locale.</span><span class="sxs-lookup"><span data-stu-id="32b37-301">The ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
* <span data-ttu-id="32b37-302">La routine definita dall'utente applicata alla subnet contenente Cache Redis di Azure definisce 0.0.0.0/0 con una route di lavoro per il traffico TCP/IP verso la rete Internet pubblica, ad esempio impostando il tipo di hop successivo su "Internet".</span><span class="sxs-lookup"><span data-stu-id="32b37-302">The UDR applied to the subnet containing the Azure Redis Cache defines 0.0.0.0/0 with a working route for TCP/IP traffic to the public internet; for example by setting the next hop type to 'Internet'.</span></span>

<span data-ttu-id="32b37-303">L'effetto combinato di questi passaggi è che il livello di subnet UDR avrà la precedenza sul tunneling forzato di ExpressRoute, garantendo l'accesso a Internet in uscita da Cache Redis di Azure.</span><span class="sxs-lookup"><span data-stu-id="32b37-303">The combined effect of these steps is that the subnet level UDR takes precedence over the ExpressRoute forced tunneling, thus ensuring outbound Internet access from the Azure Redis Cache.</span></span>

<span data-ttu-id="32b37-304">Per motivi di prestazioni, la connessione a un'istanza di Cache Redis di Azure da un'applicazione locale tramite ExpressRoute non è uno scenario di utilizzo tipico. Per ottenere prestazioni ottimali, i client di Cache Redis di Azure devono trovarsi nella stessa area di Cache Redis di Azure.</span><span class="sxs-lookup"><span data-stu-id="32b37-304">Connecting to an Azure Redis Cache instance from an on-premises application using ExpressRoute is not a typical usage scenario due to performance reasons (for best performance Azure Redis Cache clients should be in the same region as the Azure Redis Cache).</span></span>

>[!IMPORTANT] 
><span data-ttu-id="32b37-305">Le route definite in un UDR **devono** essere sufficientemente specifiche per avere la precedenza su qualsiasi route annunciata dalla configurazione di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="32b37-305">The routes defined in a UDR **must** be specific enough to take precedence over any routes advertised by the ExpressRoute configuration.</span></span> <span data-ttu-id="32b37-306">Nell'esempio di seguito viene utilizzato l'intervallo di indirizzi ampio 0.0.0.0/0 e pertanto può essere accidentalmente sottoposto a override dagli annunci di route mediante più intervalli di indirizzi specifici.</span><span class="sxs-lookup"><span data-stu-id="32b37-306">The following example uses the broad 0.0.0.0/0 address range, and as such can potentially be accidentally overridden by route advertisements using more specific address ranges.</span></span>

>[!WARNING]  
><span data-ttu-id="32b37-307">Cache Redis di Azure non è supportato con le configurazioni di ExpressRoute che **annunciano erroneamente route dal percorso di peering pubblico al percorso di peering privato**.</span><span class="sxs-lookup"><span data-stu-id="32b37-307">Azure Redis Cache is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from the public peering path to the private peering path**.</span></span> <span data-ttu-id="32b37-308">Le configurazioni di ExpressRoute per cui è configurato il peering pubblico riceveranno gli annunci delle route da Microsoft per un elevato numero di intervalli di indirizzi IP di Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="32b37-308">ExpressRoute configurations that have public peering configured, receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="32b37-309">Se questi intervalli di indirizzi vengono annunciati in modo non corretto nel percorso di peering privato, il risultato finale è che tutti i pacchetti di rete in uscita dalla subnet dell'istanza di Cache Redis di Azure verranno erroneamente sottoposti a tunneling forzato verso l'infrastruttura di rete locale del cliente.</span><span class="sxs-lookup"><span data-stu-id="32b37-309">If these address ranges are incorrectly cross-advertised on the private peering path, the result is that all outbound network packets from the Azure Redis Cache instance's subnet are incorrectly force-tunneled to a customer's on-premises network infrastructure.</span></span> <span data-ttu-id="32b37-310">Questo flusso di rete interromperà Cache Redis di Azure.</span><span class="sxs-lookup"><span data-stu-id="32b37-310">This network flow breaks Azure Redis Cache.</span></span> <span data-ttu-id="32b37-311">La soluzione a questo problema consiste nell'interrompere l’annuncio di più route dal percorso di peering pubblico al percorso di peering privato.</span><span class="sxs-lookup"><span data-stu-id="32b37-311">The solution to this problem is to stop cross-advertising routes from the public peering path to the private peering path.</span></span>


<span data-ttu-id="32b37-312">Le informazioni generali sulle route definite dall'utente sono disponibili in questa [panoramica](../virtual-network/virtual-networks-udr-overview.md).</span><span class="sxs-lookup"><span data-stu-id="32b37-312">Background information on user-defined routes is available in this [overview](../virtual-network/virtual-networks-udr-overview.md).</span></span>

<span data-ttu-id="32b37-313">Per altre informazioni su ExpressRoute, vedere [Panoramica tecnica relativa a ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="32b37-313">For more information about ExpressRoute, see [ExpressRoute technical overview](../expressroute/expressroute-introduction.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="32b37-314">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="32b37-314">Next steps</span></span>
<span data-ttu-id="32b37-315">Informazioni su come usare altre funzionalità di cache premium.</span><span class="sxs-lookup"><span data-stu-id="32b37-315">Learn how to use more premium cache features.</span></span>

* [<span data-ttu-id="32b37-316">Introduzione al piano Premium di Cache Redis di Azure</span><span class="sxs-lookup"><span data-stu-id="32b37-316">Introduction to the Azure Redis Cache Premium tier</span></span>](cache-premium-tier-intro.md)

<!-- IMAGES -->

[redis-cache-vnet]: ./media/cache-how-to-premium-vnet/redis-cache-vnet.png

[redis-cache-vnet-ip]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-ip.png

[redis-cache-vnet-info]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-info.png

