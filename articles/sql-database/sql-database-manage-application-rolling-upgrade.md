---
title: Aggiornamenti in sequenza delle applicazioni - Database SQL di Azure | Documentazione Microsoft
description: Informazioni su come usare la replica geografica del database SQL di Azure per supportare gli aggiornamenti online dell'applicazione cloud.
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 58f42859-1e37-463c-a3d8-a3ca2e867148
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/16/2016
ms.author: sashan
ms.openlocfilehash: 4b59c8aa3dea3e8fba692ab66420295a09210d3b
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="managing-rolling-upgrades-of-cloud-applications-using-sql-database-active-geo-replication"></a><span data-ttu-id="201ae-103">Gestione degli aggiornamenti in sequenza delle applicazioni cloud con la replica geografica attiva del database SQL</span><span class="sxs-lookup"><span data-stu-id="201ae-103">Managing rolling upgrades of cloud applications using SQL Database active geo-replication</span></span>
> [!NOTE]
> <span data-ttu-id="201ae-104">La [replica geografica attiva](sql-database-geo-replication-overview.md) è ora disponibile per tutti i database in tutti i livelli.</span><span class="sxs-lookup"><span data-stu-id="201ae-104">[Active geo-replication](sql-database-geo-replication-overview.md) is now available for all databases in all tiers.</span></span>
> 

<span data-ttu-id="201ae-105">Informazioni su come usare la [replica geografica](sql-database-geo-replication-overview.md) nel database SQL per abilitare gli aggiornamenti in sequenza dell'applicazione cloud.</span><span class="sxs-lookup"><span data-stu-id="201ae-105">Learn how to use [geo-replication](sql-database-geo-replication-overview.md) in SQL Database to enable rolling upgrades of your cloud application.</span></span> <span data-ttu-id="201ae-106">L'aggiornamento dovrebbe far parte della pianificazione e della progettazione della continuità aziendale perché è un'operazione che comporta interruzioni.</span><span class="sxs-lookup"><span data-stu-id="201ae-106">Because upgrade is a disruptive operation, it should be part of your business continuity planning and design.</span></span> <span data-ttu-id="201ae-107">In questo articolo vengono esaminati due metodi diversi per orchestrare il processo di aggiornamento e vengono discussi vantaggi e compromessi relativi a ciascuna opzione.</span><span class="sxs-lookup"><span data-stu-id="201ae-107">In this article we look at two different methods of orchestrating the upgrade process, and discuss the benefits and trade-offs of each option.</span></span> <span data-ttu-id="201ae-108">Ai fini di questo articolo viene usata una semplice applicazione costituita da un sito Web collegato a un database singolo come livello dati.</span><span class="sxs-lookup"><span data-stu-id="201ae-108">For the purposes of this article we will use a simple application that consists of a web site connected to a single database as its data tier.</span></span> <span data-ttu-id="201ae-109">L'obiettivo consiste nell'aggiornare la versione 1 dell'applicazione alla versione 2 senza effetti significativi sull'esperienza dell'utente finale.</span><span class="sxs-lookup"><span data-stu-id="201ae-109">Our goal is to upgrade version 1 of the application to version 2 without any significant impact on the end-user experience.</span></span> 

<span data-ttu-id="201ae-110">Quando si valutano le opzioni di aggiornamento è necessario considerare i fattori seguenti:</span><span class="sxs-lookup"><span data-stu-id="201ae-110">When evaluating the upgrade options you should consider the following factors:</span></span>

* <span data-ttu-id="201ae-111">Impatto sulla disponibilità dell'applicazione durante gli aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="201ae-111">Impact on application availability during upgrades.</span></span> <span data-ttu-id="201ae-112">Durata della limitazione o della riduzione delle prestazioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="201ae-112">How long the application function may be limited or degraded.</span></span>
* <span data-ttu-id="201ae-113">Possibilità di eseguire il rollback in caso di errori durante l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="201ae-113">Ability to roll back in case of an upgrade failure.</span></span>
* <span data-ttu-id="201ae-114">Vulnerabilità dell'applicazione se si verifica un errore irreversibile non correlato durante l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="201ae-114">Vulnerability of the application if an unrelated catastrophic failure occurs during the upgrade.</span></span>
* <span data-ttu-id="201ae-115">Costo totale.</span><span class="sxs-lookup"><span data-stu-id="201ae-115">Total dollar cost.</span></span>  <span data-ttu-id="201ae-116">Sono inclusi i costi aggiuntivi di ridondanza e incrementali dei componenti temporanei usati dal processo di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="201ae-116">This includes additional redundancy and incremental costs of the temporary components  used by the upgrade process.</span></span> 

## <a name="upgrading-applications-that-rely-on-database-backups-for-disaster-recovery"></a><span data-ttu-id="201ae-117">Aggiornamento di applicazioni basate sui backup del database per il ripristino di emergenza</span><span class="sxs-lookup"><span data-stu-id="201ae-117">Upgrading applications that rely on database backups for disaster recovery</span></span>
<span data-ttu-id="201ae-118">Se l'applicazione si basa sui backup automatici del database e usa il ripristino geografico per il ripristino di emergenza, in genere viene distribuita in una singola area di Azure.</span><span class="sxs-lookup"><span data-stu-id="201ae-118">If your application relies on automatic database backups and uses geo-restore for disaster recovery, it is usually deployed to a single Azure region.</span></span> <span data-ttu-id="201ae-119">In questo caso il processo di aggiornamento prevede la creazione di una distribuzione di backup di tutti i componenti dell'applicazione coinvolti nell'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="201ae-119">In this case the upgrade process involves creating a backup deployment of all application components involved in the upgrade.</span></span> <span data-ttu-id="201ae-120">Per ridurre al minimo le interruzioni per l'utente finale, è possibile usare Gestione traffico di Azure (WATM) con il profilo di failover.</span><span class="sxs-lookup"><span data-stu-id="201ae-120">To minimize the end-user disruption you will leverage Azure Traffic Manager (WATM) with the failover profile.</span></span>  <span data-ttu-id="201ae-121">Il diagramma seguente illustra l'ambiente operativo prima del processo di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="201ae-121">The following diagram illustrates the operational environment prior to the upgrade process.</span></span> <span data-ttu-id="201ae-122">L'endpoint <i>contoso-1.azurewebsites.net</i> rappresenta uno slot di produzione dell'applicazione che deve essere aggiornata.</span><span class="sxs-lookup"><span data-stu-id="201ae-122">The endpoint <i>contoso-1.azurewebsites.net</i> represents a production slot of the application that needs to be upgraded.</span></span> <span data-ttu-id="201ae-123">Per poter eseguire il rollback dell'aggiornamento, è necessario creare uno slot di gestione temporanea con una copia completamente sincronizzata dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="201ae-123">To enable the ability to roll back the upgrade, you need create a stage slot with a fully synchronized copy of the application.</span></span> <span data-ttu-id="201ae-124">I passaggi seguenti sono necessari per preparare l'applicazione per l'aggiornamento:</span><span class="sxs-lookup"><span data-stu-id="201ae-124">The following steps are required to prepare the application for the upgrade:</span></span>

1. <span data-ttu-id="201ae-125">Creare uno slot di gestione temporanea per l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="201ae-125">Create a stage slot for the upgrade.</span></span> <span data-ttu-id="201ae-126">Per farlo, creare un database secondario (1) e distribuire un sito Web identico nella stessa area di Azure.</span><span class="sxs-lookup"><span data-stu-id="201ae-126">To do that create a secondary database (1) and deploy an identical web site in the same Azure region.</span></span> <span data-ttu-id="201ae-127">Monitorare il database secondario per verificare se il processo di seeding è stato completato.</span><span class="sxs-lookup"><span data-stu-id="201ae-127">Monitor the secondary to see if the seeding process is completed.</span></span>
2. <span data-ttu-id="201ae-128">Creare un profilo di failover in Gestione traffico di Azure con <i>contoso-1.azurewebsites.net</i> come endpoint online e <i>contoso-2.azurewebsites.net</i> come endpoint offline.</span><span class="sxs-lookup"><span data-stu-id="201ae-128">Create a failover profile in WATM with <i>contoso-1.azurewebsites.net</i> as online endpoint and <i>contoso-2.azurewebsites.net</i> as offline.</span></span> 

> [!NOTE]
> <span data-ttu-id="201ae-129">Le operazioni di preparazione non avranno effetti sull'applicazione nello slot di produzione, che funzionerà in modalità di accesso completo.</span><span class="sxs-lookup"><span data-stu-id="201ae-129">Note the preparation steps will not impact the application in the production slot and it can function in full access mode.</span></span>
>  

![Configurazione della replica geografica del database SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-1.png)

<span data-ttu-id="201ae-132">Dopo aver completato i passaggi di preparazione, l'applicazione è pronta per l'aggiornamento effettivo.</span><span class="sxs-lookup"><span data-stu-id="201ae-132">Once the preparation steps are completed the application is ready for the actual upgrade.</span></span> <span data-ttu-id="201ae-133">Il diagramma seguente illustra i passaggi richiesti per il processo di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="201ae-133">The following diagram illustrates the steps involved in the upgrade process.</span></span> 

1. <span data-ttu-id="201ae-134">Impostare il database primario nello slot di produzione in modalità di sola lettura (3).</span><span class="sxs-lookup"><span data-stu-id="201ae-134">Set the primary database in the production slot to read-only mode (3).</span></span> <span data-ttu-id="201ae-135">In questo modo si assicura che l'istanza di produzione dell'applicazione (V1) resti di sola lettura durante l'aggiornamento, impedendo così la divergenza dei dati tra le istanze di database V1 e V2.</span><span class="sxs-lookup"><span data-stu-id="201ae-135">This will guarantee that the production instance of the application (V1) will remain read-only during the upgrade thus preventing the data divergence between the V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="201ae-136">Scollegare il database secondario usando la modalità di terminazione pianificata (4).</span><span class="sxs-lookup"><span data-stu-id="201ae-136">Disconnect the secondary database using the planned termination mode (4).</span></span> <span data-ttu-id="201ae-137">Viene creata una copia indipendente completamente sincronizzata del database primario.</span><span class="sxs-lookup"><span data-stu-id="201ae-137">It will create a fully synchronized independent copy of the primary database.</span></span> <span data-ttu-id="201ae-138">Questo database verrà aggiornato.</span><span class="sxs-lookup"><span data-stu-id="201ae-138">This database will be upgraded.</span></span>
3. <span data-ttu-id="201ae-139">Attivare il database primario in modalità lettura/scrittura ed eseguire lo script di aggiornamento nello slot di gestione temporanea (5).</span><span class="sxs-lookup"><span data-stu-id="201ae-139">Turn the primary database to read-write mode and run the upgrade script in the stage slot  (5).</span></span>     

![Configurazione della replica geografica del database SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-2.png)

<span data-ttu-id="201ae-142">Se l'aggiornamento è stato completato correttamente, è possibile far passare gli utenti finali alla copia di gestione temporanea dell'applicazione,</span><span class="sxs-lookup"><span data-stu-id="201ae-142">If the upgrade completed successfully you are now ready to switch the end users to the staged copy the application.</span></span> <span data-ttu-id="201ae-143">che diventa lo slot di produzione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="201ae-143">It will now become the production slot of the application.</span></span>  <span data-ttu-id="201ae-144">È richiesto qualche altro passaggio, come illustrato nel diagramma seguente.</span><span class="sxs-lookup"><span data-stu-id="201ae-144">This involves a few more steps as illustrated on the following diagram.</span></span>

1. <span data-ttu-id="201ae-145">Passare l'endpoint online nel profilo di Gestione traffico di Azure su <i>contoso-2.azurewebsites.net</i>, che punta alla versione V2 del sito Web (6).</span><span class="sxs-lookup"><span data-stu-id="201ae-145">Switch the online endpoint in the WATM profile to <i>contoso-2.azurewebsites.net</i>, which points to the V2 version of the web site (6).</span></span> <span data-ttu-id="201ae-146">Questo diventa lo slot di produzione con l'applicazione V2 e il traffico dell'utente finale viene indirizzato a questo slot.</span><span class="sxs-lookup"><span data-stu-id="201ae-146">It now becomes the production slot with the V2 application and the end-user traffic is directed to it.</span></span>  
2. <span data-ttu-id="201ae-147">Se i componenti dell'applicazione V1 non sono più necessari, è possibile rimuoverli (7).</span><span class="sxs-lookup"><span data-stu-id="201ae-147">If you no longer need the V1 application components so you can safely remove them (7).</span></span>   

![Configurazione della replica geografica del database SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-3.png)

<span data-ttu-id="201ae-150">Se il processo di aggiornamento non riesce, ad esempio a causa di un errore nello script di aggiornamento, lo slot di gestione temporanea deve essere considerato compromesso.</span><span class="sxs-lookup"><span data-stu-id="201ae-150">If the upgrade process is unsuccessful, for example due to an error in the upgrade script, the stage slot should be considered compromised.</span></span> <span data-ttu-id="201ae-151">Per eseguire il rollback dell'applicazione allo stato di pre-aggiornamento, è sufficiente ripristinare l'applicazione nello slot di produzione per l'accesso completo.</span><span class="sxs-lookup"><span data-stu-id="201ae-151">To roll back the application to the pre-upgrade state you simply revert the application in the production slot to full access.</span></span> <span data-ttu-id="201ae-152">I passaggi richiesti sono mostrati nel diagramma seguente.</span><span class="sxs-lookup"><span data-stu-id="201ae-152">The steps involved are shown on the next diagram.</span></span>    

1. <span data-ttu-id="201ae-153">Impostare la copia del database in modalità lettura/scrittura (8).</span><span class="sxs-lookup"><span data-stu-id="201ae-153">Set the database copy to read-write mode (8).</span></span> <span data-ttu-id="201ae-154">La funzionalità completa di V1 viene ripristinata nello slot di produzione.</span><span class="sxs-lookup"><span data-stu-id="201ae-154">This will restore the full V1 functionally in the production slot.</span></span>
2. <span data-ttu-id="201ae-155">Eseguire l'analisi delle cause radice e rimuovere i componenti compromessi nello slot di gestione temporanea (9).</span><span class="sxs-lookup"><span data-stu-id="201ae-155">Perform the root cause analysis and remove the compromised components in the stage slot (9).</span></span> 

<span data-ttu-id="201ae-156">A questo punto l'applicazione è completamente funzionale e le operazioni di aggiornamento possono essere ripetute.</span><span class="sxs-lookup"><span data-stu-id="201ae-156">At this point the application is fully functional and the upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="201ae-157">Il rollback non richiede modifiche al profilo di Gestione traffico di Azure perché punta già a <i>contoso-1.azurewebsites.net</i> come endpoint attivo.</span><span class="sxs-lookup"><span data-stu-id="201ae-157">The rollback does not require changes in WATM profile as it already points to <i>contoso-1.azurewebsites.net</i> as the active endpoint.</span></span>
> 
> 

![Configurazione della replica geografica del database SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-4.png)

<span data-ttu-id="201ae-160">Il **vantaggio** principale di questa opzione è che è possibile aggiornare un'applicazione in un'unica area con una serie di semplici passaggi.</span><span class="sxs-lookup"><span data-stu-id="201ae-160">The key **advantage** of this option is that you can upgrade an application in a single region using a set of simple steps.</span></span> <span data-ttu-id="201ae-161">Il costo dell'aggiornamento è relativamente basso.</span><span class="sxs-lookup"><span data-stu-id="201ae-161">The dollar cost of the upgrade is relatively low.</span></span> <span data-ttu-id="201ae-162">Il **compromesso** principale è che, se si verifica un errore irreversibile durante l'aggiornamento, il ripristino allo stato di pre-aggiornamento comporta la ridistribuzione dell'applicazione in un'area diversa e il ripristino del database dal backup con il ripristino geografico.</span><span class="sxs-lookup"><span data-stu-id="201ae-162">The main **tradeoff** is that if a catastrophic failure occurs during the upgrade the recovery to the pre-upgrade state will involve re-deployment of the application in a different region and restoring the database from backup using geo-restore.</span></span> <span data-ttu-id="201ae-163">Questo processo causa tempi di inattività significativi.</span><span class="sxs-lookup"><span data-stu-id="201ae-163">This process will result in significant downtime.</span></span>   

## <a name="upgrading-applications-that-rely-on-database-geo-replication-for-disaster-recovery"></a><span data-ttu-id="201ae-164">Aggiornamento di applicazioni basate sulla replica geografica del database per il ripristino di emergenza</span><span class="sxs-lookup"><span data-stu-id="201ae-164">Upgrading applications that rely on database geo-replication for disaster recovery</span></span>
<span data-ttu-id="201ae-165">Se l'applicazione usa la replica geografica per la continuità aziendale, viene distribuita in almeno due aree diverse con una distribuzione attiva nell'area primaria e una distribuzione standby nell'area di backup.</span><span class="sxs-lookup"><span data-stu-id="201ae-165">If your application leverages geo-replication for business continuity, it is deployed  to at least two different regions with an active deployment in Primary region and a standby deployment in Backup region.</span></span> <span data-ttu-id="201ae-166">Oltre ai fattori menzionati in precedenza, il processo di aggiornamento deve garantire che:</span><span class="sxs-lookup"><span data-stu-id="201ae-166">In addition to the factors mentioned earlier, the upgrade process must guarantee that:</span></span>

* <span data-ttu-id="201ae-167">L'applicazione rimanga protetta da errori irreversibili in qualsiasi momento durante il processo di aggiornamento</span><span class="sxs-lookup"><span data-stu-id="201ae-167">The application remains protected from catastrophic failures at all times during the upgrade process</span></span>
* <span data-ttu-id="201ae-168">I componenti con ridondanza geografica dell'applicazione siano aggiornati in parallelo con i componenti attivi</span><span class="sxs-lookup"><span data-stu-id="201ae-168">The geo-redundant components of the application are upgraded in parallel with the active components</span></span>

<span data-ttu-id="201ae-169">Per raggiungere questi obiettivi è possibile usare Gestione traffico di Azure (WATM) con il profilo di failover con un endpoint attivo e tre endpoint di backup.</span><span class="sxs-lookup"><span data-stu-id="201ae-169">To achieve these goals you will leverage Azure Traffic Manager (WATM) using the failover profile with one active and three backup endpoints.</span></span>  <span data-ttu-id="201ae-170">Il diagramma seguente illustra l'ambiente operativo prima del processo di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="201ae-170">The following diagram illustrates the operational environment prior to the upgrade process.</span></span> <span data-ttu-id="201ae-171">I siti Web <i>contoso-1.azurewebsites.net</i> e <i>contoso-dr.azurewebsites.net</i> rappresentano uno slot di produzione dell'applicazione con ridondanza geografica completa.</span><span class="sxs-lookup"><span data-stu-id="201ae-171">The web sites <i>contoso-1.azurewebsites.net</i> and <i>contoso-dr.azurewebsites.net</i> represent a production slot of the application with full geographic redundancy.</span></span> <span data-ttu-id="201ae-172">Per poter eseguire il rollback dell'aggiornamento, è necessario creare uno slot di gestione temporanea con una copia completamente sincronizzata dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="201ae-172">To enable the ability to roll back the upgrade, you need create a stage slot with a fully synchronized copy of the application.</span></span> <span data-ttu-id="201ae-173">Anche lo slot di gestione temporanea deve avere la funzionalità di ridondanza geografica perché è necessario assicurare un recupero rapido dell'applicazione in caso di errori irreversibili durante il processo di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="201ae-173">Because you need to ensure that the application can quickly recover in case a catastrophic failure occurs during the upgrade process, the stage slot needs to be geo-redundant as well.</span></span> <span data-ttu-id="201ae-174">I passaggi seguenti sono necessari per preparare l'applicazione per l'aggiornamento:</span><span class="sxs-lookup"><span data-stu-id="201ae-174">The following steps are required to prepare the application for the upgrade:</span></span>

1. <span data-ttu-id="201ae-175">Creare uno slot di gestione temporanea per l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="201ae-175">Create a stage slot for the upgrade.</span></span> <span data-ttu-id="201ae-176">Per farlo, creare un database secondario (1) e distribuire una copia identica di un sito Web nella stessa area di Azure.</span><span class="sxs-lookup"><span data-stu-id="201ae-176">To do that create a secondary database (1) and deploy an identical copy of the web site in the same Azure region.</span></span> <span data-ttu-id="201ae-177">Monitorare il database secondario per verificare se il processo di seeding è stato completato.</span><span class="sxs-lookup"><span data-stu-id="201ae-177">Monitor the secondary to see if the seeding process is completed.</span></span>
2. <span data-ttu-id="201ae-178">Creare un database secondario con ridondanza geografica nello slot di gestione temporanea usando la replica geografica del database secondario nell'area di backup, chiamata "replica geografica concatenata".</span><span class="sxs-lookup"><span data-stu-id="201ae-178">Create a geo-redundant secondary database in the stage slot by geo-replicating the secondary database to the backup region (this is called "chained geo-replication").</span></span> <span data-ttu-id="201ae-179">Monitorare il database secondario di backup per verificare se il processo di seeding è stato completato (3).</span><span class="sxs-lookup"><span data-stu-id="201ae-179">Monitor the backup secondary to see if the seeding process is completed (3).</span></span>
3. <span data-ttu-id="201ae-180">Creare una copia standby del sito Web nell'area di backup e collegarla al database secondario con ridondanza geografica (4).</span><span class="sxs-lookup"><span data-stu-id="201ae-180">Create a standby copy of the web site in the backup region and link it to the geo-redundant secondary (4).</span></span>  
4. <span data-ttu-id="201ae-181">Aggiungere gli altri endpoint <i>contoso-2.azurewebsites.net</i> e <i>contoso-3.azurewebsites.net</i> al profilo di failover in Gestione traffico di Azure come endpoint offline (5).</span><span class="sxs-lookup"><span data-stu-id="201ae-181">Add the additional endpoints <i>contoso-2.azurewebsites.net</i> and <i>contoso-3.azurewebsites.net</i> to the failover profile in WATM as offline endpoints (5).</span></span> 

> [!NOTE]
> <span data-ttu-id="201ae-182">Le operazioni di preparazione non avranno effetti sull'applicazione nello slot di produzione, che funzionerà in modalità di accesso completo.</span><span class="sxs-lookup"><span data-stu-id="201ae-182">Note the preparation steps will not impact the application in the production slot and it can function in full access mode.</span></span>
> 
> 

![Configurazione della replica geografica del database SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-1.png)

<span data-ttu-id="201ae-185">Dopo aver completato i passaggi di preparazione, lo slot di gestione temporanea è pronto per l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="201ae-185">Once the preparation steps are completed, the stage slot is ready for the upgrade.</span></span> <span data-ttu-id="201ae-186">Il diagramma seguente illustra questi passaggi di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="201ae-186">The following diagram illustrates the upgrade steps.</span></span>

1. <span data-ttu-id="201ae-187">Impostare il database primario nello slot di produzione in modalità di sola lettura (6).</span><span class="sxs-lookup"><span data-stu-id="201ae-187">Set the primary database in the production slot to read-only mode (6).</span></span> <span data-ttu-id="201ae-188">In questo modo si assicura che l'istanza di produzione dell'applicazione (V1) resti di sola lettura durante l'aggiornamento, impedendo così la divergenza dei dati tra le istanze di database V1 e V2.</span><span class="sxs-lookup"><span data-stu-id="201ae-188">This will guarantee that the production instance of the application (V1) will remain read-only during the upgrade thus preventing the data divergence between the V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="201ae-189">Scollegare il database secondario nella stessa area usando la modalità di terminazione pianificata (7).</span><span class="sxs-lookup"><span data-stu-id="201ae-189">Disconnect the secondary database in the same region using the planned termination mode (7).</span></span> <span data-ttu-id="201ae-190">Viene creata una copia indipendente completamente sincronizzata del database primario, che diventerà automaticamente primaria dopo la terminazione.</span><span class="sxs-lookup"><span data-stu-id="201ae-190">It will create a fully synchronized independent copy of the primary database, which will automatically become a primary after the termination.</span></span> <span data-ttu-id="201ae-191">Questo database verrà aggiornato.</span><span class="sxs-lookup"><span data-stu-id="201ae-191">This database will be upgraded.</span></span>
3. <span data-ttu-id="201ae-192">Attivare il database primario nello slot di gestione temporanea in modalità lettura/scrittura ed eseguire lo script di aggiornamento (8).</span><span class="sxs-lookup"><span data-stu-id="201ae-192">Turn the primary database in the stage slot to read-write mode and run the upgrade script (8).</span></span>    

![Configurazione della replica geografica del database SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-2.png)

<span data-ttu-id="201ae-195">Se l'aggiornamento è stato completato correttamente, è possibile far passare gli utenti finali alla versione V2 dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="201ae-195">If the upgrade completed successfully you are now ready to switch the end users to the V2 version of the application.</span></span> <span data-ttu-id="201ae-196">Il diagramma seguente illustra i passaggi richiesti.</span><span class="sxs-lookup"><span data-stu-id="201ae-196">The following diagram illustrates the steps involved.</span></span>

1. <span data-ttu-id="201ae-197">Passare all'endpoint attivo nel profilo di Gestione traffico di Azure su <i>contoso-2.azurewebsites.net</i>, che ora punta alla versione V2 del sito Web (9).</span><span class="sxs-lookup"><span data-stu-id="201ae-197">Switch the active endpoint in the WATM profile to <i>contoso-2.azurewebsites.net</i>, which now points to the V2 version of the web site (9).</span></span> <span data-ttu-id="201ae-198">Questo diventa uno slot di produzione con l'applicazione V2 e il traffico dell'utente finale viene indirizzato a questo slot.</span><span class="sxs-lookup"><span data-stu-id="201ae-198">It now becomes a production slot with the V2 application and end-user traffic is directed to it.</span></span> 
2. <span data-ttu-id="201ae-199">Se l'applicazione V1 non è più necessaria, è possibile rimuoverla (10 e 11).</span><span class="sxs-lookup"><span data-stu-id="201ae-199">If you no longer need the V1 application so you can safely remove it (10 and 11).</span></span>  

![Configurazione della replica geografica del database SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-3.png)

<span data-ttu-id="201ae-202">Se il processo di aggiornamento non riesce, ad esempio a causa di un errore nello script di aggiornamento, lo slot di gestione temporanea deve essere considerato compromesso.</span><span class="sxs-lookup"><span data-stu-id="201ae-202">If the upgrade process is unsuccessful, for example due to an error in the upgrade script, the stage slot should be considered compromised.</span></span> <span data-ttu-id="201ae-203">Per eseguire il rollback dell'applicazione allo stato di pre-aggiornamento, è sufficiente ripristinare l'uso dell'applicazione nello slot di produzione con l'accesso completo.</span><span class="sxs-lookup"><span data-stu-id="201ae-203">To roll back the application to the pre-upgrade state you simply revert to using the application in the production slot with full access.</span></span> <span data-ttu-id="201ae-204">I passaggi richiesti sono mostrati nel diagramma seguente.</span><span class="sxs-lookup"><span data-stu-id="201ae-204">The steps involved are shown on the next diagram.</span></span>    

1. <span data-ttu-id="201ae-205">Impostare la copia del database primario nello slot di produzione in modalità lettura/scrittura (12).</span><span class="sxs-lookup"><span data-stu-id="201ae-205">Set the primary database copy in the production slot to read-write mode (12).</span></span> <span data-ttu-id="201ae-206">La funzionalità completa di V1 viene ripristinata nello slot di produzione.</span><span class="sxs-lookup"><span data-stu-id="201ae-206">This will restore the full V1 functionally in the production slot.</span></span>
2. <span data-ttu-id="201ae-207">Eseguire l'analisi delle cause radice e rimuovere i componenti compromessi nello slot di gestione temporanea (13 e 14).</span><span class="sxs-lookup"><span data-stu-id="201ae-207">Perform the root cause analysis and remove the compromised components in the stage slot (13 and 14).</span></span> 

<span data-ttu-id="201ae-208">A questo punto l'applicazione è completamente funzionale e le operazioni di aggiornamento possono essere ripetute.</span><span class="sxs-lookup"><span data-stu-id="201ae-208">At this point the application is fully functional and the upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="201ae-209">Il rollback non richiede modifiche al profilo di Gestione traffico di Azure perché punta già a <i>contoso-1.azurewebsites.net</i> come endpoint attivo.</span><span class="sxs-lookup"><span data-stu-id="201ae-209">The rollback does not require changes in WATM profile as it already points to  <i>contoso-1.azurewebsites.net</i> as the active endpoint.</span></span>
> 
> 

![Configurazione della replica geografica del database SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-4.png)

<span data-ttu-id="201ae-212">Il **vantaggio** principale di questa opzione è che è possibile aggiornare in parallelo sia l'applicazione che la copia con ridondanza geografica senza compromettere la continuità aziendale durante l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="201ae-212">The key **advantage** of this option is that you can upgrade both the application and its geo-redundant copy in parallel without compromising your business continuity during the upgrade.</span></span> <span data-ttu-id="201ae-213">Il **compromesso** principale è che viene richiesta una doppia ridondanza per ogni componente dell'applicazione, che comporta un aumento dei costi</span><span class="sxs-lookup"><span data-stu-id="201ae-213">The main **tradeoff** is that it requires double redundancy of each application component and therefore incurs higher dollar cost.</span></span> <span data-ttu-id="201ae-214">e un flusso di lavoro più complesso.</span><span class="sxs-lookup"><span data-stu-id="201ae-214">It also involves a more complicated workflow.</span></span> 

## <a name="summary"></a><span data-ttu-id="201ae-215">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="201ae-215">Summary</span></span>
<span data-ttu-id="201ae-216">I due metodi di aggiornamento descritti nell'articolo differiscono in termini di complessità e di costo, ma entrambi si concentrano sulla riduzione dei tempi quando l'utente finale è limitato alle operazioni di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="201ae-216">The two upgrade methods described in the article differ in complexity and the dollar cost but they both focus on minimizing the time when the end user is limited to read-only operations.</span></span> <span data-ttu-id="201ae-217">Questo periodo di tempo viene definito direttamente dalla durata dello script di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="201ae-217">That time is directly defined by the duration of the upgrade script.</span></span> <span data-ttu-id="201ae-218">Non dipende dalle dimensioni del database, dal livello di servizio scelto, dalla configurazione del sito Web e da altri fattori difficilmente controllabili.</span><span class="sxs-lookup"><span data-stu-id="201ae-218">It does not depend on the database size, the service tier you chose, the web site configuration and other factors that you cannot easily control.</span></span> <span data-ttu-id="201ae-219">Ciò è possibile perché tutti i passaggi di preparazione sono separati dalle operazioni di aggiornamento e possono essere eseguiti senza alcun impatto sull'applicazione di produzione.</span><span class="sxs-lookup"><span data-stu-id="201ae-219">This is because all the preparation steps are decoupled from the upgrade steps and can be done without impacting the production application.</span></span> <span data-ttu-id="201ae-220">L'efficienza dello script di aggiornamento è il fattore determinante per l'esperienza dell'utente finale durante gli aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="201ae-220">The efficiency of the upgrade script is the key factor that determines the end-user experience during upgrades.</span></span> <span data-ttu-id="201ae-221">Il modo ottimale per migliorarla, quindi, consiste nel concentrare gli sforzi sullo script di aggiornamento, per renderlo il più efficiente possibile.</span><span class="sxs-lookup"><span data-stu-id="201ae-221">So the best way you can improve it is by focusing your efforts on making the upgrade script as efficient as possible.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="201ae-222">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="201ae-222">Next steps</span></span>
* <span data-ttu-id="201ae-223">Per la panoramica e gli scenari della continuità aziendale, vedere [Continuità aziendale del database SQL di Azure](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="201ae-223">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md).</span></span>
* <span data-ttu-id="201ae-224">Per informazioni sui backup automatici del database SQL di Azure, vedere [Backup automatici del database SQL](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="201ae-224">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span></span>
* <span data-ttu-id="201ae-225">Per informazioni sull'uso dei backup automatici per il ripristino, vedere [Ripristinare un database SQL di Azure mediante i backup automatici del database](sql-database-recovery-using-backups.md).</span><span class="sxs-lookup"><span data-stu-id="201ae-225">To learn about using automated backups for recovery, see [restore a database from automated backups](sql-database-recovery-using-backups.md).</span></span>
* <span data-ttu-id="201ae-226">Per altre informazioni sulle opzioni di ripristino più veloci, vedere [Panoramica: Replica geografica attiva per il database SQL di Azure](sql-database-geo-replication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="201ae-226">To learn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md).</span></span>


