---
title: "Spostamento di dati tra database cloud con scalabilità orizzontale |Documentazione Microsoft"
description: Illustra come gestire partizioni e spostare dati tramite un servizio self-hosted usando API di database elastici.
services: sql-database
documentationcenter: 
manager: jhubbard
author: ddove
ms.assetid: 204fd902-0397-4185-985a-dea3ed7c7d9f
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/24/2016
ms.author: ddove
ms.openlocfilehash: b41b6d6be686168359a97eb7468351a105b748db
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="moving-data-between-scaled-out-cloud-databases"></a><span data-ttu-id="3cdeb-103">Spostamento di dati tra database cloud con scalabilità orizzontale</span><span class="sxs-lookup"><span data-stu-id="3cdeb-103">Moving data between scaled-out cloud databases</span></span>
<span data-ttu-id="3cdeb-104">Se lo sviluppatore di un'app SaaS (Software as a Service) registra un incremento importante della richiesta dell'app, dovrà far fronte alla domanda.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-104">If you are a Software as a Service developer, and suddenly your app undergoes tremendous demand, you need to accommodate the growth.</span></span> <span data-ttu-id="3cdeb-105">A tale scopo aggiungerà altri database (partizioni).</span><span class="sxs-lookup"><span data-stu-id="3cdeb-105">So you add more databases (shards).</span></span> <span data-ttu-id="3cdeb-106">Come ridistribuire i dati nei nuovi database senza comprometterne l'integrità?</span><span class="sxs-lookup"><span data-stu-id="3cdeb-106">How do you redistribute the data to the new databases without disrupting the data integrity?</span></span> <span data-ttu-id="3cdeb-107">Per spostare dati dai database vincolati ai nuovi database, usare lo **strumento di suddivisione-unione** .</span><span class="sxs-lookup"><span data-stu-id="3cdeb-107">Use the **split-merge tool** to move data from constrained databases to the new databases.</span></span>  

<span data-ttu-id="3cdeb-108">Lo strumento di suddivisione-unione viene eseguito come servizio Web di Azure.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-108">The split-merge tool runs as an Azure web service.</span></span> <span data-ttu-id="3cdeb-109">Un amministratore o uno sviluppatore usa lo strumento per spostare shardlet (dati di una partizione) tra diversi database (partizioni).</span><span class="sxs-lookup"><span data-stu-id="3cdeb-109">An administrator or developer uses the tool to move shardlets (data from a shard) between different databases (shards).</span></span> <span data-ttu-id="3cdeb-110">Lo strumento usa la gestione delle mappe partizioni per gestire il database di metadati del servizio e per garantire mapping coerenti.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-110">The tool uses shard map management to maintain the service metadata database, and ensure consistent mappings.</span></span>

![Panoramica][1]

## <a name="download"></a><span data-ttu-id="3cdeb-112">Download</span><span class="sxs-lookup"><span data-stu-id="3cdeb-112">Download</span></span>
[<span data-ttu-id="3cdeb-113">Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge</span><span class="sxs-lookup"><span data-stu-id="3cdeb-113">Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge</span></span>](http://www.nuget.org/packages/Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge/)

## <a name="documentation"></a><span data-ttu-id="3cdeb-114">Documentazione</span><span class="sxs-lookup"><span data-stu-id="3cdeb-114">Documentation</span></span>
1. [<span data-ttu-id="3cdeb-115">Esercitazione relativa allo strumento divisione-unione del database elastico</span><span class="sxs-lookup"><span data-stu-id="3cdeb-115">Elastic database Split-Merge tool tutorial</span></span>](sql-database-elastic-scale-configure-deploy-split-and-merge.md)
2. [<span data-ttu-id="3cdeb-116">Configurazione della sicurezza dei servizi di "split and merge"</span><span class="sxs-lookup"><span data-stu-id="3cdeb-116">Split-Merge security configuration</span></span>](sql-database-elastic-scale-split-merge-security-configuration.md)
3. [<span data-ttu-id="3cdeb-117">Considerazioni sulla sicurezza dello strumento di suddivisione-unione</span><span class="sxs-lookup"><span data-stu-id="3cdeb-117">Split-merge security considerations</span></span>](sql-database-elastic-scale-split-merge-security-configuration.md)
4. [<span data-ttu-id="3cdeb-118">Gestione mappe partizioni</span><span class="sxs-lookup"><span data-stu-id="3cdeb-118">Shard map management</span></span>](sql-database-elastic-scale-shard-map-management.md)
5. [<span data-ttu-id="3cdeb-119">Migrate existing databases to scale-out</span><span class="sxs-lookup"><span data-stu-id="3cdeb-119">Migrate existing databases to scale-out</span></span>](sql-database-elastic-convert-to-use-elastic-tools.md)
6. [<span data-ttu-id="3cdeb-120">Strumenti di database elastici</span><span class="sxs-lookup"><span data-stu-id="3cdeb-120">Elastic database tools</span></span>](sql-database-elastic-scale-introduction.md)
7. [<span data-ttu-id="3cdeb-121">Glossario sugli strumenti di database elastici</span><span class="sxs-lookup"><span data-stu-id="3cdeb-121">Elastic Database tools glossary</span></span>](sql-database-elastic-scale-glossary.md)

## <a name="why-use-the-split-merge-tool"></a><span data-ttu-id="3cdeb-122">Motivi per l'uso dello strumento di suddivisione-unione</span><span class="sxs-lookup"><span data-stu-id="3cdeb-122">Why use the split-merge tool?</span></span>
<span data-ttu-id="3cdeb-123">**Flessibilità**</span><span class="sxs-lookup"><span data-stu-id="3cdeb-123">**Flexibility**</span></span>

<span data-ttu-id="3cdeb-124">Le applicazioni devono essere sufficientemente flessibili per superare i limiti di un singolo database SQL di Azure.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-124">Applications need to stretch flexibly beyond the limits of a single Azure SQL DB database.</span></span> <span data-ttu-id="3cdeb-125">Lo strumento consente di spostare i dati nei nuovi database senza compromettere l'integrità.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-125">Use the tool to move data as needed to new databases while retaining integrity.</span></span>

<span data-ttu-id="3cdeb-126">**Dividere per crescere**</span><span class="sxs-lookup"><span data-stu-id="3cdeb-126">**Split to grow**</span></span> 

<span data-ttu-id="3cdeb-127">In certi casi è necessario incrementare la capacità complessiva per gestire una crescita esponenziale.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-127">You need to increase overall capacity to handle explosive growth.</span></span> <span data-ttu-id="3cdeb-128">Per fare ciò, creare capacità aggiuntiva con il partizionamento orizzontale e la distribuzione dei dati in un numero incrementale di database, fino a soddisfare le esigenze di capacità.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-128">To do so, create additional capacity by sharding the data and by distributing it across incrementally more databases until capacity needs are fulfilled.</span></span> <span data-ttu-id="3cdeb-129">Questo è un ottimo esempio della funzionalità di suddivisione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-129">This is a prime example of the ‘split’ feature.</span></span> 

<span data-ttu-id="3cdeb-130">**Unire per ridurre**</span><span class="sxs-lookup"><span data-stu-id="3cdeb-130">**Merge to shrink**</span></span>

<span data-ttu-id="3cdeb-131">In certi casi è necessario ridurre la capacità, per la natura stagionale dell'attività commerciale.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-131">Capacity needs shrink due to the seasonal nature of a business.</span></span> <span data-ttu-id="3cdeb-132">Lo strumento consente di passare a un numero inferiore di unità di scala quando l'attività rallenta.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-132">The tool lets you scale down to fewer scale units when business slows.</span></span> <span data-ttu-id="3cdeb-133">La funzionalità di unione del servizio di suddivisione-unione della scalabilità elastica permette di soddisfare questo requisito.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-133">The ‘merge’ feature in the Elastic Scale split-merge Service covers this requirement.</span></span> 

<span data-ttu-id="3cdeb-134">**Gestire gli hotspot mediante lo spostamento di shardlet**</span><span class="sxs-lookup"><span data-stu-id="3cdeb-134">**Manage hotspots by moving shardlets**</span></span>

<span data-ttu-id="3cdeb-135">A causa della presenza di più tenant per ogni database, l'allocazione di shardlet alle partizioni può provocare colli di bottiglia di capacità in alcune partizioni.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-135">With multiple tenants per database, the allocation of shardlets to shards can lead to capacity bottlenecks on some shards.</span></span> <span data-ttu-id="3cdeb-136">Sarà quindi necessario riallocare gli shardlet o spostare gli shardlet occupati in partizioni nuove o meno usate.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-136">This requires re-allocating shardlets or moving busy shardlets to new or less utilized shards.</span></span> 

## <a name="concepts--key-features"></a><span data-ttu-id="3cdeb-137">Concetti e funzionalità principali</span><span class="sxs-lookup"><span data-stu-id="3cdeb-137">Concepts & key features</span></span>
<span data-ttu-id="3cdeb-138">**Servizi ospitati dal cliente**</span><span class="sxs-lookup"><span data-stu-id="3cdeb-138">**Customer-hosted services**</span></span>

<span data-ttu-id="3cdeb-139">Il servizio di suddivisione-unione viene offerto come servizio ospitato dal cliente.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-139">The split-merge is delivered as a customer-hosted service.</span></span> <span data-ttu-id="3cdeb-140">È necessario distribuire e ospitare il servizio nella sottoscrizione di Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-140">You must deploy and host the service in your Microsoft Azure subscription.</span></span> <span data-ttu-id="3cdeb-141">Il pacchetto scaricato da NuGet include un modello di configurazione da completare con le informazioni specifiche per la distribuzione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-141">The package you download from NuGet contains a configuration template to complete with the information for your specific deployment.</span></span> <span data-ttu-id="3cdeb-142">Per informazioni dettagliate, vedere l' [esercitazione relativa alla suddivisione-unione](sql-database-elastic-scale-configure-deploy-split-and-merge.md) .</span><span class="sxs-lookup"><span data-stu-id="3cdeb-142">See the [split-merge tutorial](sql-database-elastic-scale-configure-deploy-split-and-merge.md) for details.</span></span> <span data-ttu-id="3cdeb-143">Poiché il servizio è in esecuzione nella sottoscrizione Azure, sarà possibile controllare e configurare la maggior parte degli aspetti relativi alla sicurezza del servizio.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-143">Since the service runs in your Azure subscription, you can control and configure most security aspects of the service.</span></span> <span data-ttu-id="3cdeb-144">Il modello predefinito include le opzioni necessarie per configurare SSL, l'autenticazione client basata su certificato, la crittografia per le credenziali archiviate, la protezione DoS e le restrizioni IP.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-144">The default template includes the options to configure SSL, certificate-based client authentication, encryption for stored credentials, DoS guarding and IP restrictions.</span></span> <span data-ttu-id="3cdeb-145">Altre informazioni sugli aspetti relativi alla sicurezza sono disponibili nel documento seguente relativo alla [configurazione di sicurezza della suddivisione-unione](sql-database-elastic-scale-split-merge-security-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="3cdeb-145">You can find more information on the security aspects in the following document [split-merge security configuration](sql-database-elastic-scale-split-merge-security-configuration.md).</span></span>

<span data-ttu-id="3cdeb-146">Il servizio distribuito predefinito viene eseguito con un ruolo di lavoro e un ruolo Web.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-146">The default deployed service runs with one worker and one web role.</span></span> <span data-ttu-id="3cdeb-147">Ogni ruolo usa la dimensione di VM A1 in Servizi cloud di Azure.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-147">Each uses the A1 VM size in Azure Cloud Services.</span></span> <span data-ttu-id="3cdeb-148">Benché non sia possibile modificare queste impostazioni durante la distribuzione del pacchetto, è possibile modificarle dopo una distribuzione corretta nel servizio cloud in esecuzione, tramite il portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-148">While you cannot modify these settings when deploying the package, you could change them after a successful deployment in the running cloud service, (through the Azure portal).</span></span> <span data-ttu-id="3cdeb-149">Si noti che per motivi tecnici il ruolo di lavoro deve essere configurato solo per un'istanza.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-149">Note that the worker role must not be configured for more than a single instance for technical reasons.</span></span> 

<span data-ttu-id="3cdeb-150">**Integrazione della mappa partizioni**</span><span class="sxs-lookup"><span data-stu-id="3cdeb-150">**Shard map integration**</span></span>

<span data-ttu-id="3cdeb-151">Il servizio di suddivisione-unione interagisce con la mappa partizioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-151">The split-merge service interacts with the shard map of the application.</span></span> <span data-ttu-id="3cdeb-152">Quando si usa il servizio di suddivisione-unione per suddividere o unire intervalli o per spostare shardlet tra le diverse partizioni, il servizio mantiene automaticamente aggiornata la mappa partizioni.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-152">When using the split-merge service to split or merge ranges or to move shardlets between shards, the service automatically keeps the shard map up to date.</span></span> <span data-ttu-id="3cdeb-153">Per ottenere questo risultato, il servizio si connette al database di gestione delle mappe partizioni dell'applicazione e gestisce gli intervalli e i mapping durante lo svolgimento delle richieste di suddivisione/unione/spostamento.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-153">To do so, the service connects to the shard map manager database of the application and maintains ranges and mappings as split/merge/move requests progress.</span></span> <span data-ttu-id="3cdeb-154">Ciò garantisce che la mappa partizioni presenti sempre una visualizzazione aggiornata durante l'esecuzione delle operazioni di suddivisione-unione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-154">This ensures that the shard map always presents an up-to-date view when split-merge operations are going on.</span></span> <span data-ttu-id="3cdeb-155">Le operazioni di suddivisione, unione e spostamento di shardlet vengono implementate tramite lo spostamento di un batch di shardlet dalla partizione di origine alla partizione di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-155">Split, merge and shardlet movement operations are implemented by moving a batch of shardlets from the source shard to the target shard.</span></span> <span data-ttu-id="3cdeb-156">Durante l'operazione di spostamento di shardlet, gli shardlet inclusi nel batch corrente vengono contrassegnati come offline nella mappa partizioni e non sono disponibili per connessioni di routing dipendenti dai dati tramite l'API **OpenConnectionForKey** .</span><span class="sxs-lookup"><span data-stu-id="3cdeb-156">During the shardlet movement operation the shardlets subject to the current batch are marked as offline in the shard map and are unavailable for data-dependent routing connections using the **OpenConnectionForKey** API.</span></span> 

<span data-ttu-id="3cdeb-157">**Connessioni a shardlet coerenti**</span><span class="sxs-lookup"><span data-stu-id="3cdeb-157">**Consistent shardlet connections**</span></span>

<span data-ttu-id="3cdeb-158">All'avvio dello spostamento di dati per un nuovo batch di shardlet, eventuali connessioni di routing dipendenti dai dati e fornite dalla mappa partizioni per la partizione in cui sono archiviati gli shardlet verranno terminate e le connessioni successive dalle API della mappa partizioni a questi shardlet verranno bloccate durante lo spostamento dei dati, in modo da evitare incoerenze.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-158">When data movement starts for a new batch of shardlets, any shard-map provided data-dependent routing connections to the shard storing the shardlet are killed and subsequent connections from the shard map APIs to the these shardlets are blocked while the data movement is in progress in order to avoid inconsistencies.</span></span> <span data-ttu-id="3cdeb-159">Verranno terminate anche le connessioni ad altri shardlet nella stessa partizione, ma queste connessioni avranno esito positivo immediato al tentativo successivo.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-159">Connections to other shardlets on the same shard will also get killed, but will succeed again immediately on retry.</span></span> <span data-ttu-id="3cdeb-160">Al termine dello spostamento del batch, gli shardlet verranno contrassegnati di nuovo come online per la partizione di destinazione e i dati di origine verranno rimossi dalla partizione di origine.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-160">Once the batch is moved, the shardlets are marked online again for the target shard and the source data is removed from the source shard.</span></span> <span data-ttu-id="3cdeb-161">Il servizio esegue questi passaggi per ogni batch, fino al completamento dello spostamento di tutti gli shardlet.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-161">The service goes through these steps for every batch until all shardlets have been moved.</span></span> <span data-ttu-id="3cdeb-162">Si verificheranno quindi alcune operazioni di interruzione delle connessioni durante il completamento dell'operazione di suddivisione/unione/spostamento.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-162">This will lead to several connection kill operations during the course of the complete split/merge/move operation.</span></span>  

<span data-ttu-id="3cdeb-163">**Gestione della disponibilità di shardlet**</span><span class="sxs-lookup"><span data-stu-id="3cdeb-163">**Managing shardlet availability**</span></span>

<span data-ttu-id="3cdeb-164">la limitazione dell'interruzione delle connessioni al batch attuale di shardlet, come illustrato in precedenza, limita anche l'ambito di non disponibilità a un unico batch di shardlet alla volta.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-164">Limiting the connection killing to the current batch of shardlets as discussed above restricts the scope of unavailability to one batch of shardlets at a time.</span></span> <span data-ttu-id="3cdeb-165">Questo approccio è preferibile a un approccio in cui la partizione completa rimane offline per tutti gli shardlet corrispondenti durante l'esecuzione di un'operazione di suddivisione o unione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-165">This is preferred over an approach where the complete shard would remain offline for all its shardlets during the course of a split or merge operation.</span></span> <span data-ttu-id="3cdeb-166">La dimensione di un batch, definita come il numero di shardlet distinti da muovere in un determinato momento, è un parametro di configurazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-166">The size of a batch, defined as the number of distinct shardlets to move at a time, is a configuration parameter.</span></span> <span data-ttu-id="3cdeb-167">Può essere definita per ogni operazione di suddivisione o unione, in base alle esigenze di disponibilità e prestazioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-167">It can be defined for each split and merge operation depending on the application’s availability and performance needs.</span></span> <span data-ttu-id="3cdeb-168">Si noti che l'intervallo bloccato nella mappa partizioni potrebbe avere dimensioni superiori rispetto a quelle del batch specificato.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-168">Note that the range that is being locked in the shard map may be larger than the batch size specified.</span></span> <span data-ttu-id="3cdeb-169">Ciò è dovuto al fatto che il servizio definisce una dimensione di intervallo in modo che il numero effettivo di valori di chiave di partizionamento orizzontale nei dati corrisponda in modo approssimativo alla dimensione del batch.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-169">This is because the service picks the range size such that the actual number of sharding key values in the data approximately matches the batch size.</span></span> <span data-ttu-id="3cdeb-170">È importante ricordare questo aspetto, in particolare per le chiavi di partizionamento orizzontale popolate in modo sparse.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-170">This is important to remember in particular for sparsely populated sharding keys.</span></span> 

<span data-ttu-id="3cdeb-171">**Archiviazione dei metadati**</span><span class="sxs-lookup"><span data-stu-id="3cdeb-171">**Metadata storage**</span></span>

<span data-ttu-id="3cdeb-172">Il servizio di suddivisione-unione usa un database per gestire il proprio stato e per creare log durante l'elaborazione delle richieste.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-172">The split-merge service uses a database to maintain its status and to keep logs during request processing.</span></span> <span data-ttu-id="3cdeb-173">L'utente crea questo database nella propria sottoscrizione e fornisce la stringa di connessione corrispondente nel file di configurazione per la distribuzione del servizio.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-173">The user creates this database in their subscription and provides the connection string for it in the configuration file for the service deployment.</span></span> <span data-ttu-id="3cdeb-174">Gli amministratori dell'organizzazione dell'utente possono anche connettersi a questo database per esaminare lo stato della richiesta e per analizzare le informazioni dettagliate su potenziali errori.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-174">Administrators from the user’s organization can also connect to this database to review request progress and to investigate detailed information regarding potential failures.</span></span>

<span data-ttu-id="3cdeb-175">**Rilevamento del partizionamento orizzontale**</span><span class="sxs-lookup"><span data-stu-id="3cdeb-175">**Sharding-awareness**</span></span>

<span data-ttu-id="3cdeb-176">Il servizio di suddivisione-unione riconosce le differenze tra (1) tabelle partizionate, (2) tabelle di riferimento e (3) tabelle normali.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-176">The split-merge service differentiates between (1) sharded tables, (2) reference tables, and (3) normal tables.</span></span> <span data-ttu-id="3cdeb-177">La semantica di un'operazione di suddivisione/unione/spostamento dipende dal tipo di tabella usata e viene definita nel seguente modo:</span><span class="sxs-lookup"><span data-stu-id="3cdeb-177">The semantics of a split/merge/move operation depend on the type of the table used and are defined as follows:</span></span> 

* <span data-ttu-id="3cdeb-178">**Tabelle partizionate**: le operazioni di suddivisione, unione e spostamento consentono di spostare gli shardlet dalla partizione di origine a quella di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-178">**Sharded tables**: Split, merge, and move operations move shardlets from source to target shard.</span></span> <span data-ttu-id="3cdeb-179">Dopo il completamento corretto della richiesta complessiva, questi shardlet non saranno più presenti nell'origine.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-179">After successful completion of the overall request, those shardlets are no longer present on the source.</span></span> <span data-ttu-id="3cdeb-180">Si noti che le tabelle di destinazione devono esistere nella partizione di destinazione e non devono includere dati nell'intervallo di destinazione prima dell'elaborazione dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-180">Note that the target tables need to exist on the target shard and must not contain data in the target range prior to processing of the operation.</span></span> 
* <span data-ttu-id="3cdeb-181">**Tabelle di riferimento**: per le tabelle di riferimento, le operazioni di suddivisione, unione e spostamento copiano i dati dalla partizione di origine a quella di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-181">**Reference tables**: For reference tables, the split, merge and move operations copy the data from the source to the target shard.</span></span> <span data-ttu-id="3cdeb-182">Si noti tuttavia che nella partizione di destinazione per una determinata tabella non vengono applicate modifiche se questa tabella nella partizione di destinazione include già alcune righe.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-182">Note, however, that no changes occur on the target shard for a given table if any row is already present in this table on the target.</span></span> <span data-ttu-id="3cdeb-183">Per permettere l'elaborazione dell'operazione di copia di tabelle di riferimento, è necessario che la tabella sia vuota.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-183">The table has to be empty for any reference table copy operation to get processed.</span></span>
* <span data-ttu-id="3cdeb-184">**Altre tabelle**: nell'origine o nella destinazione di un'operazione di suddivisione e unione possono essere presenti altre tabelle.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-184">**Other Tables**: Other tables can be present on either the source or the target of a split and merge operation.</span></span> <span data-ttu-id="3cdeb-185">Il servizio di suddivisione-unione ignora tali tabelle per eventuali operazioni di spostamento o copia dei dati.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-185">The split-merge service disregards these tables for any data movement or copy operations.</span></span> <span data-ttu-id="3cdeb-186">Si noti, tuttavia, che in caso di vincoli queste tabelle possono interferire con le operazioni.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-186">Note, however, that they can interfere with these operations in case of constraints.</span></span>

<span data-ttu-id="3cdeb-187">Le informazioni relative al confronto tra tabelle di riferimento e tabelle partizionate vengono fornite dalle API **SchemaInfo** nella mappa partizioni.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-187">The information on reference vs. sharded tables is provided by the **SchemaInfo** APIs on the shard map.</span></span> <span data-ttu-id="3cdeb-188">Il seguente esempio illustra l'uso di queste API in un determinato oggetto smm del gestore delle mappe partizioni:</span><span class="sxs-lookup"><span data-stu-id="3cdeb-188">The following example illustrates the use of these APIs on a given shard map manager object smm:</span></span> 

    // Create the schema annotations 
    SchemaInfo schemaInfo = new SchemaInfo(); 

    // Reference tables 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "region")); 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "nation")); 

    // Sharded tables 
    schemaInfo.Add(new ShardedTableInfo("dbo", "customer", "C_CUSTKEY")); 
    schemaInfo.Add(new ShardedTableInfo("dbo", "orders", "O_CUSTKEY")); 

    // Publish 
    smm.GetSchemaInfoCollection().Add(Configuration.ShardMapName, schemaInfo); 

<span data-ttu-id="3cdeb-189">Le tabelle "area" e "nazione" sono definite come tabelle di riferimento e vengono copiate con operazioni di suddivisione/unione/spostamento.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-189">The tables ‘region’ and ‘nation’ are defined as reference tables and will be copied with split/merge/move operations.</span></span> <span data-ttu-id="3cdeb-190">"cliente" e "ordini" a loro volta sono definite come tabelle partizionate.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-190">‘customer’ and ‘orders’ in turn are defined as sharded tables.</span></span> <span data-ttu-id="3cdeb-191">C_CUSTKEY e O_CUSTKEY fungono da chiave di partizionamento orizzontale.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-191">C_CUSTKEY and O_CUSTKEY serve as the sharding key.</span></span> 

<span data-ttu-id="3cdeb-192">**Integrità referenziale**</span><span class="sxs-lookup"><span data-stu-id="3cdeb-192">**Referential Integrity**</span></span>

<span data-ttu-id="3cdeb-193">Il servizio di suddivisione-unione analizza le dipendenze tra le tabelle e usa relazioni chiave esterna-chiave primaria per la gestione temporanea delle operazioni di spostamento delle tabelle di riferimento e degli shardlet.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-193">The split-merge service analyzes dependencies between tables and uses foreign key-primary key relationships to stage the operations for moving reference tables and shardlets.</span></span> <span data-ttu-id="3cdeb-194">Le tabelle di riferimento vengono in genere copiate per prime in ordine di dipendenza, quindi vengono copiati gli shardlet, in base al rispettivo ordine di dipendenza in ogni batch.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-194">In general, reference tables are copied first in dependency order, then shardlets are copied in order of their dependencies within each batch.</span></span> <span data-ttu-id="3cdeb-195">Ciò è necessario per permettere il rispetto dei vincoli di chiave esterna-chiave primaria nella partizione di destinazione all'arrivo di nuovi dati.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-195">This is necessary so that FK-PK constraints on the target shard are honored as the new data arrives.</span></span> 

<span data-ttu-id="3cdeb-196">**Coerenza della mappa partizioni e completamento finale**</span><span class="sxs-lookup"><span data-stu-id="3cdeb-196">**Shard Map Consistency and Eventual Completion**</span></span>

<span data-ttu-id="3cdeb-197">In caso di errori, il servizio di suddivisione-unione si riattiva dopo eventuali interruzioni e cerca di completare eventuali richieste in corso.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-197">In the presence of failures, the split-merge service resumes operations after any outage and aims to complete any in progress requests.</span></span> <span data-ttu-id="3cdeb-198">È tuttavia possibile che si verifichino situazioni irreversibili, ad esempio nel caso in cui la partizione di destinazione vada persa o sia danneggiata in modo irreparabile.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-198">However, there may be unrecoverable situations, e.g., when the target shard is lost or compromised beyond repair.</span></span> <span data-ttu-id="3cdeb-199">In queste circostanze è possibile che alcuni shardlet che dovevano essere spostati si trovino ancora nella partizione di origine.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-199">Under those circumstances, some shardlets that were supposed to be moved may continue to reside on the source shard.</span></span> <span data-ttu-id="3cdeb-200">Il servizio assicura che i mapping di shardlet vengano aggiornati solo dopo il completamento corretto della copia dei dati necessari nella destinazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-200">The service ensures that shardlet mappings are only updated after the necessary data has been successfully copied to the target.</span></span> <span data-ttu-id="3cdeb-201">Gli shardlet vengono eliminati dall'origine solo dopo la copia di tutti i rispettivi dati nella destinazione e dopo l'aggiornamento corretto dei mapping corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-201">Shardlets are only deleted on the source once all their data has been copied to the target and the corresponding mappings have been updated successfully.</span></span> <span data-ttu-id="3cdeb-202">L'operazione di eliminazione si verifica in background, mentre l'intervallo risulta già online nella partizione di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-202">The deletion operation happens in the background while the range is already online on the target shard.</span></span> <span data-ttu-id="3cdeb-203">Il servizio di suddivisione-unione assicura sempre la correttezza dei mapping archiviati nella mappa partizioni.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-203">The split-merge service always ensures correctness of the mappings stored in the shard map.</span></span>

## <a name="the-split-merge-user-interface"></a><span data-ttu-id="3cdeb-204">Interfaccia utente del servizio di suddivisione-unione</span><span class="sxs-lookup"><span data-stu-id="3cdeb-204">The split-merge user interface</span></span>
<span data-ttu-id="3cdeb-205">Il pacchetto del servizio di suddivisione-unione include un ruolo di lavoro e un ruolo Web.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-205">The split-merge service package includes a worker role and a web role.</span></span> <span data-ttu-id="3cdeb-206">Il ruolo Web viene usato per inviare richieste di suddivisione-unione in modo interattivo.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-206">The web role is used to submit split-merge requests in an interactive way.</span></span> <span data-ttu-id="3cdeb-207">I componenti principali dell'interfaccia utente sono i seguenti:</span><span class="sxs-lookup"><span data-stu-id="3cdeb-207">The main components of the user interface are as follows:</span></span>

* <span data-ttu-id="3cdeb-208">Tipo di operazione: il tipo di operazione è un pulsante di opzione che controlla il tipo di operazione eseguita dal servizio per questa richiesta.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-208">Operation Type: The operation type is a radio button that controls the kind of operation performed by the service for this request.</span></span> <span data-ttu-id="3cdeb-209">È possibile scegliere tra scenari di suddivisione, unione e spostamento.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-209">You can choose between the split, merge and move scenarios.</span></span> <span data-ttu-id="3cdeb-210">È anche possibile annullare un'operazione inviata in precedenza.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-210">You can also cancel a previously submitted operation.</span></span> <span data-ttu-id="3cdeb-211">È possibile usare richieste di suddivisione, unione e spostamento per le mappe partizioni di tipo intervallo.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-211">You can use split, merge and move requests for range shard maps.</span></span> <span data-ttu-id="3cdeb-212">Le mappe partizioni di tipo elenco supportano solo operazioni di spostamento.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-212">List shard maps only support move operations.</span></span>
* <span data-ttu-id="3cdeb-213">Mappa partizioni: la sezione successiva dei parametri della richiesta include informazioni sulla mappa partizioni e sul database che la ospita.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-213">Shard Map: The next section of request parameters cover information about the shard map and the database hosting your shard map.</span></span> <span data-ttu-id="3cdeb-214">È in particolare necessario specificare il nome del server di database SQL di Azure e del database che ospita la mappa partizioni, le credenziali per la connessione al database di mappe partizioni e infine il nome della mappa partizioni.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-214">In particular, you need to provide the name of the Azure SQL Database server and database hosting the shardmap, credentials to connect to the shard map database, and finally the name of the shard map.</span></span> <span data-ttu-id="3cdeb-215">L'operazione accetta attualmente solo un singolo set di credenziali.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-215">Currently, the operation only accepts a single set of credentials.</span></span> <span data-ttu-id="3cdeb-216">È necessario che le credenziali abbiano autorizzazioni sufficienti per apportare le modifiche alla mappa partizioni oltre che i dati utente nelle partizioni.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-216">These credentials need to have sufficient permissions to perform changes to the shard map as well as to the user data on the shards.</span></span>
* <span data-ttu-id="3cdeb-217">Intervallo di origine (suddivisione e unione): un'operazione di suddivisione e unione elabora un intervallo usando le relative chiavi superiore e inferiore.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-217">Source Range (split and merge): A split and merge operation processes a range using its low and high key.</span></span> <span data-ttu-id="3cdeb-218">Per specificare un'operazione con un valore di chiave superiore non associato, selezionare la casella di controllo "Chiave superiore massima" e lasciare vuoto il campo della chiave superiore.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-218">To specify an operation with an unbounded high key value, check the “High key is max” check box and leave the high key field empty.</span></span> <span data-ttu-id="3cdeb-219">Non è necessario che i valori dell'intervallo di chiavi specificati corrispondano esattamente a un mapping e ai relativi limiti nella mappa partizioni.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-219">The range key values that you specify do not need to precisely match a mapping and its boundaries in your shard map.</span></span> <span data-ttu-id="3cdeb-220">Se non si specifica alcun limite dell'intervallo, il servizio dedurrà automaticamente l'intervallo più vicino.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-220">If you do not specify any range boundaries at all the service will infer the closest range for you automatically.</span></span> <span data-ttu-id="3cdeb-221">Per recuperare i mapping attuali in una determinata mappa partizioni, è possibile usare lo script GetMappings.ps1 di PowerShell.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-221">You can use the GetMappings.ps1 PowerShell script to retrieve the current mappings in a given shard map.</span></span>
* <span data-ttu-id="3cdeb-222">Comportamento origine di suddivisione (suddivisione): per le operazioni di suddivisione, definire il punto in cui si vuole dividere l'intervallo di origine.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-222">Split Source Behavior (split): For split operations, define the point to split the source range.</span></span> <span data-ttu-id="3cdeb-223">Per ottenere questo risultato, si specifica la chiave di partizionamento orizzontale nel punto in cui si deve verificare la suddivisione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-223">You do this by providing the sharding key where you want the split to occur.</span></span> <span data-ttu-id="3cdeb-224">Usare il pulsante di opzione per indicare se si vuole spostare la parte inferiore dell'intervallo (escludendo la chiave di suddivisione) o la parte superiore (inclusa la chiave di suddivisione).</span><span class="sxs-lookup"><span data-stu-id="3cdeb-224">Use the radio button specify whether you want the lower part of the range (excluding the split key) to move, or whether you want the upper part to move (including the split key).</span></span>
* <span data-ttu-id="3cdeb-225">Shardlet di origine (spostamento): molte operazioni si differenziano dalle operazioni di suddivisione o unione, poiché non richiedono un intervallo per la descrizione dell'origine.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-225">Source Shardlet (move): Move operations are different from split or merge operations as they do not require a range to describe the source.</span></span> <span data-ttu-id="3cdeb-226">Un'origine per lo spostamento viene identificata semplicemente dal valore della chiave di partizionamento orizzontale che si prevede di spostare.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-226">A source for move is simply identified by the sharding key value that you plan to move.</span></span>
* <span data-ttu-id="3cdeb-227">Partizione di destinazione (suddivisione): dopo avere specificato le informazioni nell'origine dell'operazione di suddivisione, è necessario indicare la destinazione della copia dei dati specificando il nome del server del database SQL di Azure e del database per la destinazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-227">Target Shard (split): Once you have provided the information on the source of your split operation, you need to define where you want the data to be copied to by providing the Azure SQL Db server and database name for the target.</span></span>
* <span data-ttu-id="3cdeb-228">Intervallo di destinazione (unione): le operazioni di unione spostano gli shardlet in una partizione esistente.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-228">Target Range (merge): Merge operations move shardlets to an existing shard.</span></span> <span data-ttu-id="3cdeb-229">Per identificare la partizione esistente, è necessario specificare i limiti dell'intervallo esistente con cui si vuole ottenere l'unione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-229">You identify the existing shard by providing the range boundaries of the existing range that you want to merge with.</span></span>
* <span data-ttu-id="3cdeb-230">Dimensioni del batch: le dimensioni del batch controllano il numero di shardlet che saranno offline contemporaneamente durante lo spostamento dei dati.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-230">Batch Size: The batch size controls the number of shardlets that will go offline at a time during the data movement.</span></span> <span data-ttu-id="3cdeb-231">Si tratta di un valore Integer. È possibile usare valori ridotti se si preferisce evitare periodi di inattività prolungati per gli shardlet.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-231">This is an integer value where you can use smaller values when you are sensitive to long periods of downtime for shardlets.</span></span> <span data-ttu-id="3cdeb-232">I valori più elevati comporteranno un incremento del tempo per cui un determinato shardlet risulterà offline, ma potrebbero migliorare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-232">Larger values will increase the time that a given shardlet is offline but may improve performance.</span></span>
* <span data-ttu-id="3cdeb-233">ID operazione (annullamento): se è in corso un'operazione che non è più necessaria, sarà possibile annullarla specificando l'ID operazione corrispondente in questo campo.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-233">Operation Id (Cancel): If you have an ongoing operation that is no longer needed, you can cancel the operation by providing its operation ID in this field.</span></span> <span data-ttu-id="3cdeb-234">L'ID operazione può essere recuperato dalla tabella di stato dell'operazione (vedere la Sezione 8.1) o dall'output nel Web browser in cui è stata inviata la richiesta.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-234">You can retrieve the operation ID from the request status table (see Section 8.1) or from the output in the web browser where you submitted the request.</span></span>

## <a name="requirements-and-limitations"></a><span data-ttu-id="3cdeb-235">Requisiti e limitazioni</span><span class="sxs-lookup"><span data-stu-id="3cdeb-235">Requirements and Limitations</span></span>
<span data-ttu-id="3cdeb-236">L'implementazione corrente del servizio di suddivisione-unione deve rispettare i seguenti requisiti e limitazioni:</span><span class="sxs-lookup"><span data-stu-id="3cdeb-236">The current implementation of the split-merge service is subject to the following requirements and limitations:</span></span> 

* <span data-ttu-id="3cdeb-237">Le partizioni devono esistere ed essere registrate nella mappa partizioni perché sia possibile eseguire un'operazione di suddivisione-unione in tali partizioni.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-237">The shards need to exist and be registered in the shard map before a split-merge operation on these shards can be performed.</span></span> 
* <span data-ttu-id="3cdeb-238">Il servizio attualmente non crea in modo automatico tabelle o altri oggetti di database.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-238">The service does not create tables or any other database objects automatically as part of its operations.</span></span> <span data-ttu-id="3cdeb-239">È quindi necessario che lo schema per tutte le tabelle partizionate e le tabelle di riferimento esista nella partizione di destinazione prima dell'esecuzione di qualsiasi operazione di suddivisione/unione/spostamento.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-239">This means that the schema for all sharded tables and reference tables need to exist on the target shard prior to any split/merge/move operation.</span></span> <span data-ttu-id="3cdeb-240">È in particolare necessario che le tabelle partizionate siano vuote nell'intervallo in cui l'operazione di suddivisione/unione/spostamento deve aggiungere shardlet.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-240">Sharded tables in particular are required to be empty in the range where new shardlets are to be added by a split/merge/move operation.</span></span> <span data-ttu-id="3cdeb-241">In caso contrario, l'operazione non riuscirà a eseguire la verifica di coerenza nella partizione di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-241">Otherwise, the operation will fail the initial consistency check on the target shard.</span></span> <span data-ttu-id="3cdeb-242">Si noti anche che i dati di riferimento vengono copiati solo se la tabella di riferimento è vuota e che non sono previste garanzie a livello di coerenza rispetto ad altre operazioni di scrittura concorrenti nelle tabelle di riferimento.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-242">Also note that reference data is only copied if the reference table is empty and that there are no consistency guarantees with regard to other concurrent write operations on the reference tables.</span></span> <span data-ttu-id="3cdeb-243">Si consiglia questo: durante l'esecuzione di operazioni di suddivisione/unione, altre operazioni di scrittura non devono apportare modifiche alle tabelle di riferimento.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-243">We recommend this: when running split/merge operations, no other write operations make changes to the reference tables.</span></span>
* <span data-ttu-id="3cdeb-244">Per migliorare le prestazioni e l'affidabilità per shardlet di grandi dimensioni, il servizio si basa attualmente sull'identità di riga definita da un indice o una chiave univoca che include la chiave di partizionamento orizzontale.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-244">The service relies on row identity established by a unique index or key that includes the sharding key to improve performance and reliability for large shardlets.</span></span> <span data-ttu-id="3cdeb-245">Ciò permette al servizio di spostare i dati con un livello di granularità maggiore rispetto al solo valore di chiave di partizionamento orizzontale,</span><span class="sxs-lookup"><span data-stu-id="3cdeb-245">This allows the service to move data at an even finer granularity than just the sharding key value.</span></span> <span data-ttu-id="3cdeb-246">contribuendo quindi a ridurre la quantità massima di spazio di log e i blocchi necessari durante l'operazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-246">This helps to reduce the maximum amount of log space and locks that are required during the operation.</span></span> <span data-ttu-id="3cdeb-247">È consigliabile creare un indice univoco o una chiave primaria che include la chiave di partizionamento orizzontale in una determinata tabella se si vuole usare quella tabella con le richieste di suddivisione/unione/spostamento.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-247">Consider creating a unique index or a primary key including the sharding key on a given table if you want to use that table with split/merge/move requests.</span></span> <span data-ttu-id="3cdeb-248">Per motivi di prestazioni, è consigliabile che la chiave di partizionamento orizzontale costituisca la colonna iniziale nella chiave o nell'indice.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-248">For performance reasons, the sharding key should be the leading column in the key or the index.</span></span>
* <span data-ttu-id="3cdeb-249">Durante l'elaborazione delle richieste è possibile che alcuni dati di shardlet siano presenti sia nella partizione di origine che nella partizione di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-249">During the course of request processing, some shardlet data may be present both on the source and the target shard.</span></span> <span data-ttu-id="3cdeb-250">Ciò è attualmente necessario per la protezione in caso di errori durante lo spostamento di shardlet.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-250">This is necessary to protect against failures during the shardlet movement.</span></span> <span data-ttu-id="3cdeb-251">L'integrazione del servizio di suddivisione-unione con la mappa partizioni garantisce che le connessioni tramite le API di routing dipendenti dai dati che usano il metodo **OpenConnectionForKey** sulla mappa partizioni non rilevino stati intermedi incoerenti.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-251">The integration of split-merge with the shard map ensures that connections through the data dependent routing APIs using the **OpenConnectionForKey** method on the shard map do not see any inconsistent intermediate states.</span></span> <span data-ttu-id="3cdeb-252">Quando ci si connette alle partizioni di origine o di destinazione senza usare il metodo **OpenConnectionForKey** , è tuttavia possibile che stati intermedi incoerenti risultino visibili durante l'esecuzione di richieste di suddivisione/unione/spostamento.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-252">However, when connecting to the source or the target shards without using the **OpenConnectionForKey** method, inconsistent intermediate states might be visible when split/merge/move requests are going on.</span></span> <span data-ttu-id="3cdeb-253">È possibile che queste connessioni mostrino risultati parziali o duplicati, in base all'intervallo o alla partizione sottostante per la connessione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-253">These connections may show partial or duplicate results depending on the timing or the shard underlying the connection.</span></span> <span data-ttu-id="3cdeb-254">Questa limitazione include attualmente le connessioni effettuate dalle query su più partizioni di Scalabilità elastica.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-254">This limitation currently includes the connections made by Elastic Scale Multi-Shard-Queries.</span></span>
* <span data-ttu-id="3cdeb-255">Il database dei metadati per il servizio di suddivisione-unione non deve essere condiviso tra ruoli diversi.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-255">The metadata database for the split-merge service must not be shared between different roles.</span></span> <span data-ttu-id="3cdeb-256">Ad esempio, un ruolo del servizio di suddivisione-unione in esecuzione in gestione temporanea deve fare riferimento a un database dei metadati diverso rispetto al ruolo di produzione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-256">For example, a role of the split-merge service running in staging needs to point to a different metadata database than the production role.</span></span>

## <a name="billing"></a><span data-ttu-id="3cdeb-257">Fatturazione</span><span class="sxs-lookup"><span data-stu-id="3cdeb-257">Billing</span></span>
<span data-ttu-id="3cdeb-258">Il servizio di suddivisione-unione viene eseguito come servizio cloud nella sottoscrizione Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-258">The split-merge service runs as a cloud service in your Microsoft Azure subscription.</span></span> <span data-ttu-id="3cdeb-259">Pertanto all'istanza del servizio vengono applicate tariffe per i servizi cloud.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-259">Therefore charges for cloud services apply to your instance of the service.</span></span> <span data-ttu-id="3cdeb-260">Se non si eseguono spesso operazioni di suddivisione/unione/spostamento, è consigliabile eliminare il servizio cloud di suddivisione-unione,</span><span class="sxs-lookup"><span data-stu-id="3cdeb-260">Unless you frequently perform split/merge/move operations, we recommend you delete your split-merge cloud service.</span></span> <span data-ttu-id="3cdeb-261">in modo da ridurre i costi per le istanze dei servizi cloud in esecuzione o distribuite.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-261">That saves costs for running or deployed cloud service instances.</span></span> <span data-ttu-id="3cdeb-262">È possibile eseguire di nuovo la distribuzione e avviare la configurazione pronta per l'esecuzione quando occorre eseguire operazioni di suddivisione-unione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-262">You can re-deploy and start your readily runnable configuration whenever you need to perform split or merge operations.</span></span> 

## <a name="monitoring"></a><span data-ttu-id="3cdeb-263">Monitoraggio</span><span class="sxs-lookup"><span data-stu-id="3cdeb-263">Monitoring</span></span>
### <a name="status-tables"></a><span data-ttu-id="3cdeb-264">Tabelle di stato</span><span class="sxs-lookup"><span data-stu-id="3cdeb-264">Status tables</span></span>
<span data-ttu-id="3cdeb-265">Il servizio di suddivisione-unione fornisce la tabella **RequestStatus** nel database archivio di metadati per il monitoraggio delle richieste completate e in corso.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-265">The split-merge Service provides the **RequestStatus** table in the metadata store database for monitoring of completed and ongoing requests.</span></span> <span data-ttu-id="3cdeb-266">La tabella include una riga per ogni richiesta di suddivisione-unione inviata a questa istanza del servizio di suddivisione-unione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-266">The table lists a row for each split-merge request that has been submitted to this instance of the split-merge service.</span></span> <span data-ttu-id="3cdeb-267">Fornisce le seguenti informazioni per ogni richiesta:</span><span class="sxs-lookup"><span data-stu-id="3cdeb-267">It gives the following information for each request:</span></span>

* <span data-ttu-id="3cdeb-268">**Timestamp**: ora e data di inizio della richiesta.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-268">**Timestamp**: The time and date when the request was started.</span></span>
* <span data-ttu-id="3cdeb-269">**OperationId**: GUID che identifica in modo univoco la richiesta.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-269">**OperationId**: A GUID that uniquely identifies the request.</span></span> <span data-ttu-id="3cdeb-270">Questa richiesta può essere usata anche per annullare l'operazione durante l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-270">This request can also be used to cancel the operation while it is still ongoing.</span></span>
* <span data-ttu-id="3cdeb-271">**Status**: stato attuale della richiesta.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-271">**Status**: The current state of the request.</span></span> <span data-ttu-id="3cdeb-272">per le richieste in corso indica anche la fase attuale dell'esecuzione della richiesta.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-272">For ongoing requests, it also lists the current phase in which the request is.</span></span>
* <span data-ttu-id="3cdeb-273">**CancelRequest**: flag che indica se la richiesta è stata annullata.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-273">**CancelRequest**: A flag that indicates whether the request has been cancelled.</span></span>
* <span data-ttu-id="3cdeb-274">**Progress**: stima della percentuale di completamento dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-274">**Progress**: A percentage estimate of completion for the operation.</span></span> <span data-ttu-id="3cdeb-275">Un valore pari a 50 indica che la percentuale di completamento dell'operazione è pari a circa il 50%.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-275">A value of 50 indicates that the operation is approximately 50% complete.</span></span>
* <span data-ttu-id="3cdeb-276">**Details**: valore XML che fornisce un report di stato più dettagliato.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-276">**Details**: An XML value that provides a more detailed progress report.</span></span> <span data-ttu-id="3cdeb-277">Il report di stato viene aggiornato periodicamente durante la copia di set di righe dall'origine alla destinazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-277">The progress report is periodically updated as sets of rows are copied from source to target.</span></span> <span data-ttu-id="3cdeb-278">In caso di errori o eccezioni, questa colonna include anche informazioni più dettagliate sull'errore.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-278">In case of failures or exceptions, this column also includes more detailed information about the failure.</span></span>

### <a name="azure-diagnostics"></a><span data-ttu-id="3cdeb-279">Diagnostica Azure</span><span class="sxs-lookup"><span data-stu-id="3cdeb-279">Azure Diagnostics</span></span>
<span data-ttu-id="3cdeb-280">Il servizio di suddivisione-unione utilizza la diagnostica Azure basata su Azure SDK 2.5 per il monitoraggio e la diagnostica.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-280">The split-merge service uses Azure Diagnostics based on Azure SDK 2.5 for monitoring and diagnostics.</span></span> <span data-ttu-id="3cdeb-281">È possibile controllare la configurazione della diagnostica come indicato di seguito: [Abilitazione della diagnostica nei servizi cloud e nelle macchine virtuali di Azure](../cloud-services/cloud-services-dotnet-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="3cdeb-281">You control the diagnostics configuration as explained here: [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](../cloud-services/cloud-services-dotnet-diagnostics.md).</span></span> <span data-ttu-id="3cdeb-282">Il pacchetto di download include due configurazioni della diagnostica: una per il ruolo Web e una per il ruolo di lavoro.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-282">The download package includes two diagnostics configurations - one for the web role and one for the worker role.</span></span> <span data-ttu-id="3cdeb-283">Queste configurazioni della diagnostica per il servizio seguono le istruzioni fornite dai [Dati fondamentali dei servizi cloud di Microsoft Azure](https://code.msdn.microsoft.com/windowsazure/Cloud-Service-Fundamentals-4ca72649).</span><span class="sxs-lookup"><span data-stu-id="3cdeb-283">These diagnostics configurations for the service follow the guidance from [Cloud Service Fundamentals in Microsoft Azure](https://code.msdn.microsoft.com/windowsazure/Cloud-Service-Fundamentals-4ca72649).</span></span> <span data-ttu-id="3cdeb-284">Essi includono le definizioni per la registrazione di contatori delle prestazioni, log IIS, registri eventi di Windows e registri eventi dell'applicazione di suddivisione-unione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-284">It includes the definitions to log Performance Counters, IIS logs, Windows Event Logs, and split-merge application event logs.</span></span> 

## <a name="deploy-diagnostics"></a><span data-ttu-id="3cdeb-285">Distribuire la diagnostica</span><span class="sxs-lookup"><span data-stu-id="3cdeb-285">Deploy Diagnostics</span></span>
<span data-ttu-id="3cdeb-286">Per abilitare il monitoraggio e la diagnostica utilizzando la configurazione della diagnostica per i ruoli Web e di lavoro forniti dal pacchetto NuGet, eseguire i seguenti comandi utilizzando Azure PowerShell:</span><span class="sxs-lookup"><span data-stu-id="3cdeb-286">To enable monitoring and diagnostics using the diagnostic configuration for the web and worker roles provided by the NuGet package, run the following commands using Azure PowerShell:</span></span> 

    $storage_name = "<YourAzureStorageAccount>" 

    $key = "<YourAzureStorageAccountKey" 

    $storageContext = New-AzureStorageContext -StorageAccountName $storage_name -StorageAccountKey $key  


    $config_path = "<YourFilePath>\SplitMergeWebContent.diagnostics.xml" 

    $service_name = "<YourCloudServiceName>" 

    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWeb" 


    $config_path = "<YourFilePath>\SplitMergeWorkerContent.diagnostics.xml" 

    $service_name = "<YourCloudServiceName>" 

    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWorker" 

<span data-ttu-id="3cdeb-287">Altre informazioni su come configurare e distribuire le impostazioni di diagnostica sono disponibili qui: [Abilitazione della diagnostica nei servizi cloud e nelle macchine virtuali di Azure](../cloud-services/cloud-services-dotnet-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="3cdeb-287">You can find more information on how to configure and deploy diagnostics settings here: [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](../cloud-services/cloud-services-dotnet-diagnostics.md).</span></span> 

## <a name="retrieve-diagnostics"></a><span data-ttu-id="3cdeb-288">Recuperare la diagnostica</span><span class="sxs-lookup"><span data-stu-id="3cdeb-288">Retrieve diagnostics</span></span>
<span data-ttu-id="3cdeb-289">È possibile accedere con facilità alla diagnostica da Esplora server di Visual Studio, nella sezione dedicata ad Azure della struttura ad albero della finestra di esplorazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-289">You can easily access your diagnostics from the Visual Studio Server Explorer in the Azure part of the Server Explorer tree.</span></span> <span data-ttu-id="3cdeb-290">Aprire un'istanza di Visual Studio e nella barra dei menu fare clic su Visualizza, quindi su Esplora server.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-290">Open a Visual Studio instance, and in the menu bar click View, and Server Explorer.</span></span> <span data-ttu-id="3cdeb-291">Fare clic sull'icona di Azure per connettersi alla sottoscrizione Azure.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-291">Click the Azure icon to connect to your Azure subscription.</span></span> <span data-ttu-id="3cdeb-292">Passare ad Azure -> Archiviazione -> <your storage account> -> Tabelle -> WADLogsTable.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-292">Then navigate to Azure -> Storage -> <your storage account> -> Tables -> WADLogsTable.</span></span> <span data-ttu-id="3cdeb-293">Per altre informazioni, vedere [Esplorazione delle risorse di archiviazione con Esplora server](http://msdn.microsoft.com/library/azure/ff683677.aspx).</span><span class="sxs-lookup"><span data-stu-id="3cdeb-293">For more information, see [Browsing Storage Resources with Server Explorer](http://msdn.microsoft.com/library/azure/ff683677.aspx).</span></span> 

![WADLogsTable][2]

<span data-ttu-id="3cdeb-295">La tabella WADLogsTable evidenziata nella figura precedente include gli eventi dettagliati del log applicazione del servizio di suddivisione-unione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-295">The WADLogsTable highlighted in the figure above contains the detailed events from the split-merge service’s application log.</span></span> <span data-ttu-id="3cdeb-296">Si noti che la configurazione predefinita del pacchetto scaricato è destinata a una distribuzione in produzione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-296">Note that the default configuration of the downloaded package is geared towards a production deployment.</span></span> <span data-ttu-id="3cdeb-297">L'intervallo di estrazione dei log e dei contatori dalle istanze del servizio è quindi lungo (5 minuti).</span><span class="sxs-lookup"><span data-stu-id="3cdeb-297">Therefore the interval at which logs and counters are pulled from the service instances is large (5 minutes).</span></span> <span data-ttu-id="3cdeb-298">Per gli scenari di test e di sviluppo, ridurre l'intervallo, modificando le impostazioni di diagnostica del ruolo Web o del ruolo di lavoro in base alle esigenze specifiche.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-298">For test and development, lower the interval by adjusting the diagnostics settings of the web or the worker role to your needs.</span></span> <span data-ttu-id="3cdeb-299">Fare clic con il pulsante destro del mouse sul ruolo in Esplora server di Visual Studio (vedere sopra), quindi modificare il periodo di trasferimento nella finestra di dialogo relativa alle impostazioni di configurazione di diagnostica:</span><span class="sxs-lookup"><span data-stu-id="3cdeb-299">Right-click on the role in the Visual Studio Server Explorer (see above) and then adjust the Transfer Period in the dialog for the Diagnostics configuration settings:</span></span> 

![Configurazione][3]

## <a name="performance"></a><span data-ttu-id="3cdeb-301">Prestazioni</span><span class="sxs-lookup"><span data-stu-id="3cdeb-301">Performance</span></span>
<span data-ttu-id="3cdeb-302">In generale i livelli di servizio più elevati ed efficienti del database SQL di Azure offrono prestazioni migliori.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-302">In general, better performance is to be expected from the higher, more performant service tiers in Azure SQL Database.</span></span> <span data-ttu-id="3cdeb-303">Allocazioni di IO, CPU e memoria più elevate per i livelli di servizio superiori risulteranno utili per le operazioni di copia ed eliminazione in blocco usate internamente dal servizio di suddivisione-unione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-303">Higher IO, CPU and memory allocations for the higher service tiers benefit the bulk copy and delete operations that the split-merge service uses.</span></span> <span data-ttu-id="3cdeb-304">Per questo motivo, aumentare il livello di servizio solo per tali database per un periodo di tempo limitato e definito.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-304">For that reason, increase the service tier just for those databases for a defined, limited period of time.</span></span>

<span data-ttu-id="3cdeb-305">Il servizio esegue anche query di convalida come parte del normale funzionamento.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-305">The service also performs validation queries as part of its normal operations.</span></span> <span data-ttu-id="3cdeb-306">Le query di convalida verificano la presenza imprevista di dati nell'intervallo di destinazione e assicurano che eventuali operazioni di suddivisione/unione/spostamento vengano avviate con uno stato coerente.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-306">These validation queries check for unexpected presence of data in the target range and ensure that any split/merge/move operation starts from a consistent state.</span></span> <span data-ttu-id="3cdeb-307">Queste query verranno eseguite in intervalli di chiavi di partizionamento orizzontale definiti dall'ambito dell'operazione e dalla dimensione del batch specificata come parte della definizione della richiesta.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-307">These queries all work over sharding key ranges defined by the scope of the operation and the batch size provided as part of the request definition.</span></span> <span data-ttu-id="3cdeb-308">Le query vengono eseguite in modo ottimale quando è presente un indice che include la chiave di partizionamento orizzontale come colonna iniziale.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-308">These queries perform best when an index is present that has the sharding key as the leading column.</span></span> 

<span data-ttu-id="3cdeb-309">Una proprietà di univocità con la chiave di partizionamento orizzontale come colonna iniziale permetterà inoltre al servizio di usare un approccio ottimizzato, che limita l'utilizzo di risorse a livello di spazio di log e di memoria.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-309">In addition, a uniqueness property with the sharding key as the leading column will allow the service to use an optimized approach that limits resource consumption in terms of log space and memory.</span></span> <span data-ttu-id="3cdeb-310">Questa proprietà di univocità è obbligatoria per lo spostamento di quantità elevate di dati, in genere superiori a 1 GB.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-310">This uniqueness property is required to move large data sizes (typically above 1GB).</span></span> 

## <a name="how-to-upgrade"></a><span data-ttu-id="3cdeb-311">Come eseguire l'aggiornamento</span><span class="sxs-lookup"><span data-stu-id="3cdeb-311">How to upgrade</span></span>
1. <span data-ttu-id="3cdeb-312">Seguire i passaggi in [Distribuire un servizio di suddivisione-unione](sql-database-elastic-scale-configure-deploy-split-and-merge.md).</span><span class="sxs-lookup"><span data-stu-id="3cdeb-312">Follow the steps in [Deploy a split-merge service](sql-database-elastic-scale-configure-deploy-split-and-merge.md).</span></span>
2. <span data-ttu-id="3cdeb-313">Modificare il file di configurazione del servizio cloud per la distribuzione della suddivisione-unione, in modo da riflettere i nuovi parametri di configurazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-313">Change your cloud service configuration file for your split-merge deployment to reflect the new configuration parameters.</span></span> <span data-ttu-id="3cdeb-314">È richiesto un nuovo parametro con le informazioni relative al certificato usato per la crittografia.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-314">A new required parameter is the information about the certificate used for encryption.</span></span> <span data-ttu-id="3cdeb-315">Per semplificare questa operazione, è possibile confrontare il file del nuovo modello di configurazione dal download con la configurazione esistente.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-315">An easy way to do this is to compare the new configuration template file from the download against your existing configuration.</span></span> <span data-ttu-id="3cdeb-316">Assicurarsi di aggiungere le impostazioni per "DataEncryptionPrimaryCertificateThumbprint" e "DataEncryptionPrimary" per il ruolo Web e il ruolo di lavoro.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-316">Make sure you add the settings for “DataEncryptionPrimaryCertificateThumbprint” and “DataEncryptionPrimary” for both the web and the worker role.</span></span>
3. <span data-ttu-id="3cdeb-317">Prima di distribuire l'aggiornamento in Azure, assicurarsi che tutte le operazioni di suddivisione-unione in esecuzione siano state completate.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-317">Before deploying the update to Azure, ensure that all currently running split-merge operations have finished.</span></span> <span data-ttu-id="3cdeb-318">A tale scopo, è possibile eseguire una query nelle tabelle RequestStatus e PendingWorkflows nel database dei metadati di suddivisione-unione per le richieste in corso.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-318">You can easily do this by querying the RequestStatus and PendingWorkflows tables in the split-merge metadata database for ongoing requests.</span></span>
4. <span data-ttu-id="3cdeb-319">Aggiornare la distribuzione del servizio cloud esistente per il servizio di suddivisione-unione nella sottoscrizione di Azure con il nuovo pacchetto e con il file di configurazione del servizio aggiornato.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-319">Update your existing cloud service deployment for split-merge in your Azure subscription with the new package and your updated service configuration file.</span></span>

<span data-ttu-id="3cdeb-320">Non è necessario eseguire il provisioning di un nuovo database dei metadati per l’aggiornamento della suddivisione-unione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-320">You do not need to provision a new metadata database for split-merge to upgrade.</span></span> <span data-ttu-id="3cdeb-321">Il database dei metadati esistente verrà aggiornato automaticamente alla nuova versione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-321">The new version will automatically upgrade your existing metadata database to the new version.</span></span> 

## <a name="best-practices--troubleshooting"></a><span data-ttu-id="3cdeb-322">Procedure consigliate e risoluzione dei problemi</span><span class="sxs-lookup"><span data-stu-id="3cdeb-322">Best practices & troubleshooting</span></span>
* <span data-ttu-id="3cdeb-323">Definire un tenant di test e di provare a eseguire le operazioni di suddivisione/unione/spostamento più importanti con il tenant di test in diverse partizioni.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-323">Define a test tenant and exercise your most important split/merge/move operations with the test tenant across several shards.</span></span> <span data-ttu-id="3cdeb-324">Assicurare che tutti metadati siano definiti correttamente nella mappa partizioni e che le operazioni non violino i vincoli o le chiavi esterne.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-324">Ensure that all metadata is defined correctly in your shard map and that the operations do not violate constraints or foreign keys.</span></span>
* <span data-ttu-id="3cdeb-325">Assicurarsi che le dimensioni dei dati del tenant di test siano superiori alle dimensioni di dati massime del tenant più grande, in modo che non si verifichino problemi correlati alle dimensioni dei dati.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-325">Keep the test tenant data size above the maximum data size of your largest tenant to ensure you are not encountering data size related issues.</span></span> <span data-ttu-id="3cdeb-326">In questo modo sarà possibile definire un limite massimo per il tempo necessario per lo spostamento di un singolo tenant.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-326">This helps you assess an upper bound on the time it takes to move a single tenant around.</span></span> 
* <span data-ttu-id="3cdeb-327">Assicurarsi che lo schema consenta le eliminazioni.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-327">Make sure that your schema allows deletions.</span></span> <span data-ttu-id="3cdeb-328">Per il servizio di suddivisione-unione è necessario potere rimuovere dati dalla partizione di origine dopo una copia riuscita dei dati nella destinazione.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-328">The split-merge service requires the ability to remove data from the source shard once the data has been successfully copied to the target.</span></span> <span data-ttu-id="3cdeb-329">I **trigger di eliminazione** , ad esempio, possono impedire al servizio di eliminare i dati nell'origine e possono ostacolare la riuscita delle operazioni.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-329">For example, **delete triggers** can prevent the service from deleting the data on the source and may cause operations to fail.</span></span>
* <span data-ttu-id="3cdeb-330">La chiave di partizionamento orizzontale deve essere la colonna iniziale nella definizione della chiave primaria o dell'indice univoco.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-330">The sharding key should be the leading column in your primary key or unique index definition.</span></span> <span data-ttu-id="3cdeb-331">In questo modo si assicurano prestazioni ottimali per le query di convalida della suddivisione o unione e per le operazioni effettive di spostamento ed eliminazione dei dati, che vengono eseguite sempre negli intervalli delle chiavi di partizionamento orizzontale.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-331">That ensures the best performance for the split or merge validation queries, and for the actual data movement and deletion operations which always operate on sharding key ranges.</span></span>
* <span data-ttu-id="3cdeb-332">Collocare il servizio di suddivisione-unione nel centro dati e nell’area in cui si trovano i database.</span><span class="sxs-lookup"><span data-stu-id="3cdeb-332">Collocate your split-merge service in the region and data center where your databases reside.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Anchors-->
<!--Image references-->
[1]:./media/sql-database-elastic-scale-overview-split-and-merge/split-merge-overview.png
[2]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics.png
[3]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics-config.png

