---
title: 'Backup di Azure: preparare il backup di macchine virtuali | Microsoft Docs'
description: Assicurarsi che l'ambiente sia pronto per il backup di macchine virtuali in Azure.
services: backup
documentationcenter: 
author: markgalioto
manager: carmonm
editor: 
keywords: backup; eseguire il backup;
ms.assetid: e87e8db2-b4d9-40e1-a481-1aa560c03395
ms.service: backup
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 7/10/2017
ms.author: markgal;trinadhk;
ms.openlocfilehash: 8d701f4a459da2e08510e8001adca0847b08e924
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/29/2017
---
# <a name="prepare-your-environment-to-back-up-resource-manager-deployed-virtual-machines"></a><span data-ttu-id="53f74-104">Preparare l’ambiente per il backup di macchine virtuali distribuite con Resource Manager</span><span class="sxs-lookup"><span data-stu-id="53f74-104">Prepare your environment to back up Resource Manager-deployed virtual machines</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="53f74-105">Modello di Resource Manager</span><span class="sxs-lookup"><span data-stu-id="53f74-105">Resource Manager model</span></span>](backup-azure-arm-vms-prepare.md)
> * [<span data-ttu-id="53f74-106">Modello classico</span><span class="sxs-lookup"><span data-stu-id="53f74-106">Classic model</span></span>](backup-azure-vms-prepare.md)
>
>

<span data-ttu-id="53f74-107">Questo articolo illustra i passaggi per preparare un ambiente in cui eseguire il backup di una macchina virtuale (VM) distribuita con Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="53f74-107">This article provides the steps for preparing your environment to back up a Resource Manager-deployed virtual machine (VM).</span></span> <span data-ttu-id="53f74-108">I passaggi descritti nelle procedure usano il portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="53f74-108">The steps shown in the procedures use the Azure portal.</span></span>  

<span data-ttu-id="53f74-109">Il servizio Backup di Azure offre due tipi di insiemi di credenziali (insieme di credenziali di backup e insiemi di credenziali dei servizi di ripristino) per proteggere le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="53f74-109">The Azure Backup service has two types of vaults (back up vaults and recovery services vaults) for protecting your VMs.</span></span> <span data-ttu-id="53f74-110">L'insieme di credenziali di backup protegge le macchine virtuali distribuite usando il modello di distribuzione classico.</span><span class="sxs-lookup"><span data-stu-id="53f74-110">A backup vault protects VMs deployed using the Classic deployment model.</span></span> <span data-ttu-id="53f74-111">L'insieme di credenziali dei servizi di ripristino protegge **le macchine virtuali distribuite sia con il modello di distribuzione classica sia con il modello di distribuzione Resource Manager**.</span><span class="sxs-lookup"><span data-stu-id="53f74-111">A recovery services vault protects **both Classic-deployed or Resource Manager-deployed VMs**.</span></span> <span data-ttu-id="53f74-112">È necessario usare un insieme di credenziali dei servizi di ripristino per proteggere una macchina virtuale distribuita con Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="53f74-112">You must use a Recovery Services vault to protect a Resource Manager-deployed VM.</span></span>

> [!NOTE]
> <span data-ttu-id="53f74-113">Azure offre due modelli di distribuzione per creare e usare le risorse: [Resource Manager e distribuzione classica](../azure-resource-manager/resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="53f74-113">Azure has two deployment models for creating and working with resources: [Resource Manager and Classic](../azure-resource-manager/resource-manager-deployment-model.md).</span></span> <span data-ttu-id="53f74-114">Per informazioni dettagliate sull'utilizzo delle macchine virtuali con il modello di distribuzione classica, vedere [Preparare l'ambiente per il backup di macchine virtuali di Azure](backup-azure-vms-prepare.md) .</span><span class="sxs-lookup"><span data-stu-id="53f74-114">See [Prepare your environment to back up Azure virtual machines](backup-azure-vms-prepare.md) for details on working with Classic deployment model VMs.</span></span>
>
>

<span data-ttu-id="53f74-115">Prima di proteggere o eseguire il backup di una macchina virtuale (VM) di Resource Manager, verificare che siano disponibili i prerequisiti seguenti:</span><span class="sxs-lookup"><span data-stu-id="53f74-115">Before you can protect or back up a Resource Manager-deployed virtual machine (VM), make sure these prerequisites exist:</span></span>

* <span data-ttu-id="53f74-116">Creare un insieme di credenziali dei servizi di ripristino o identificarne uno esistente *nella stessa località della macchina virtuale*.</span><span class="sxs-lookup"><span data-stu-id="53f74-116">Create a recovery services vault (or identify an existing recovery services vault) *in the same location as your VM*.</span></span>
* <span data-ttu-id="53f74-117">Selezionare uno scenario, definire i criteri di backup e specificare gli elementi da proteggere.</span><span class="sxs-lookup"><span data-stu-id="53f74-117">Select a scenario, define the backup policy, and define items to protect.</span></span>
* <span data-ttu-id="53f74-118">Verificare l'installazione dell'agente di macchine virtuali nella macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="53f74-118">Check the installation of VM Agent on virtual machine.</span></span>
* <span data-ttu-id="53f74-119">Verificare la connettività della rete</span><span class="sxs-lookup"><span data-stu-id="53f74-119">Check network connectivity</span></span>
* <span data-ttu-id="53f74-120">Per le macchine virtuali Linux, se si vuole personalizzare l'ambiente di backup per backup coerenti con l'applicazione, seguire la [procedura per configurare gli script pre-snapshot e post-snapshot](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent)</span><span class="sxs-lookup"><span data-stu-id="53f74-120">For Linux VMs, in case you want to customize your backup environment for application consistent backups please follow the [steps to configure pre-snapshot and post-snapshot scripts](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent)</span></span>

<span data-ttu-id="53f74-121">Se nell'ambiente esistono già queste condizioni, passare all'articolo [Eseguire il backup di macchine virtuali di Azure](backup-azure-vms.md).</span><span class="sxs-lookup"><span data-stu-id="53f74-121">If you know these conditions already exist in your environment then proceed to the [Back up your VMs article](backup-azure-vms.md).</span></span> <span data-ttu-id="53f74-122">Se si vuole impostare o verificare qualsiasi prerequisito, questo articolo spiega la procedura di preparazione dei prerequisiti.</span><span class="sxs-lookup"><span data-stu-id="53f74-122">If you need to set up, or check, any of these prerequisites, this article leads you through the steps to prepare that prerequisite.</span></span>

##<a name="supported-operating-system-for-backup"></a><span data-ttu-id="53f74-123">Sistema operativo supportato per il backup</span><span class="sxs-lookup"><span data-stu-id="53f74-123">Supported operating system for backup</span></span>
 * <span data-ttu-id="53f74-124">**Linux**: Backup di Azure supporta [un elenco di distribuzioni approvate da Azure](../virtual-machines/linux/endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) , ad eccezione di CoreOS Linux.</span><span class="sxs-lookup"><span data-stu-id="53f74-124">**Linux**: Azure Backup supports [a list of distributions that are endorsed by Azure](../virtual-machines/linux/endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) except Core OS Linux.</span></span> <span data-ttu-id="53f74-125">_È possibile usare altre distribuzioni Bring Your Own Linux, a condizione che l'agente di macchine virtuali sia disponibile nella macchina virtuale e sia configurato il supporto per Python. Microsoft tuttavia non consiglia queste distribuzioni per il backup._</span><span class="sxs-lookup"><span data-stu-id="53f74-125">_Other Bring-Your-Own-Linux distributions also might work as long as the VM agent is available on the virtual machine and support for Python exists. However, we do not endorse those distributions for backup._</span></span>
 * <span data-ttu-id="53f74-126">**Windows Server**: le versioni precedenti a Windows Server 2008 R2 non sono supportate.</span><span class="sxs-lookup"><span data-stu-id="53f74-126">**Windows Server**:  Versions older than Windows Server 2008 R2 are not supported.</span></span>

## <a name="limitations-when-backing-up-and-restoring-a-vm"></a><span data-ttu-id="53f74-127">Limitazioni durante il backup e il ripristino di una VM</span><span class="sxs-lookup"><span data-stu-id="53f74-127">Limitations when backing up and restoring a VM</span></span>
<span data-ttu-id="53f74-128">Prima di preparare l'ambiente, è importante capire le limitazioni.</span><span class="sxs-lookup"><span data-stu-id="53f74-128">Before you prepare your environment, please understand the limitations.</span></span>

* <span data-ttu-id="53f74-129">Il backup di macchine virtuali con più di 16 dischi dati non è supportato.</span><span class="sxs-lookup"><span data-stu-id="53f74-129">Backing up virtual machines with more than 16 data disks is not supported.</span></span>
* <span data-ttu-id="53f74-130">Il backup delle macchine virtuali con dischi dati maggiori di 1023 GB non è supportato.</span><span class="sxs-lookup"><span data-stu-id="53f74-130">Backing up virtual machines with data disk sizes greater than 1023GB is not supported.</span></span>
* <span data-ttu-id="53f74-131">Il backup di macchine virtuali con un indirizzo IP riservato e nessun endpoint definito non è supportato.</span><span class="sxs-lookup"><span data-stu-id="53f74-131">Backing up virtual machines with a reserved IP address and no defined endpoint is not supported.</span></span>
* <span data-ttu-id="53f74-132">Il backup di macchine virtuali crittografate solo con BEK non è supportato.</span><span class="sxs-lookup"><span data-stu-id="53f74-132">Backup of VMs encrypted using just BEK is not supported.</span></span> <span data-ttu-id="53f74-133">Il backup delle macchine virtuali Linux crittografate con la crittografia LUKS non è supportato.</span><span class="sxs-lookup"><span data-stu-id="53f74-133">Backup of Linux VMs encrypted using LUKS encryption is not supported.</span></span>
* <span data-ttu-id="53f74-134">Il backup delle VM nelle configurazioni di file server scalabili orizzontalmente non è consigliato.</span><span class="sxs-lookup"><span data-stu-id="53f74-134">Backup of VMs on Scale out File Server configuration is not recommended.</span></span>
* <span data-ttu-id="53f74-135">I dati di backup non includono le unità di rete montate collegate alla macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="53f74-135">Backup data doesn't include network mounted drives attached to VM.</span></span>
* <span data-ttu-id="53f74-136">La sostituzione di una macchina virtuale esistente durante il ripristino non è supportata.</span><span class="sxs-lookup"><span data-stu-id="53f74-136">Replacing an existing virtual machine during restore is not supported.</span></span> <span data-ttu-id="53f74-137">Se si tenta di ripristinare una macchina virtuale che esiste, l'operazione di ripristino non viene eseguita.</span><span class="sxs-lookup"><span data-stu-id="53f74-137">If you attempt to restore the VM when the VM exists, the restore operation fails.</span></span>
* <span data-ttu-id="53f74-138">L'operazione di backup e ripristino tra aree geografiche diverse non è supportata.</span><span class="sxs-lookup"><span data-stu-id="53f74-138">Cross-region backup and restore are not supported.</span></span>
* <span data-ttu-id="53f74-139">È possibile eseguire il backup di macchine virtuali in tutte le aree pubbliche di Azure. Vedere l'[elenco di controllo](https://azure.microsoft.com/regions/#services) delle aree supportate.</span><span class="sxs-lookup"><span data-stu-id="53f74-139">You can back up virtual machines in all public regions of Azure (see the [checklist](https://azure.microsoft.com/regions/#services) of supported regions).</span></span> <span data-ttu-id="53f74-140">Se l'area che si sta cercando non è attualmente supportata, tale area non verrà visualizzata nell'elenco a discesa durante la creazione dell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="53f74-140">If the region that you are looking for is unsupported today, it will not appear in the dropdown list during vault creation.</span></span>
* <span data-ttu-id="53f74-141">Il ripristino di un controller di dominio di VM che fa parte di una configurazione con controller di dominio è supportato solo tramite PowerShell.</span><span class="sxs-lookup"><span data-stu-id="53f74-141">Restoring a domain controller (DC) VM that is part of a multi-DC configuration is supported only through PowerShell.</span></span> <span data-ttu-id="53f74-142">Altre informazioni sul [ripristino di un controller di dominio con più controller di dominio](backup-azure-restore-vms.md#restoring-domain-controller-vms).</span><span class="sxs-lookup"><span data-stu-id="53f74-142">Read more about [restoring a multi-DC domain controller](backup-azure-restore-vms.md#restoring-domain-controller-vms).</span></span>
* <span data-ttu-id="53f74-143">Il ripristino delle macchine virtuali che presentano le seguenti configurazioni di rete speciali è supportato solo tramite PowerShell.</span><span class="sxs-lookup"><span data-stu-id="53f74-143">Restoring virtual machines that have the following special network configurations is supported only through PowerShell.</span></span> <span data-ttu-id="53f74-144">Le macchine virtuali create usando il flusso di lavoro di ripristino nell'interfaccia utente non avranno queste configurazioni di rete dopo l'operazione di ripristino.</span><span class="sxs-lookup"><span data-stu-id="53f74-144">VMs created using the restore workflow in the UI will not have these network configurations after the restore operation is complete.</span></span> <span data-ttu-id="53f74-145">Per altre informazioni, vedere [Ripristino delle macchine virtuali con configurazioni di rete speciali](backup-azure-restore-vms.md#restoring-vms-with-special-network-configurations).</span><span class="sxs-lookup"><span data-stu-id="53f74-145">To learn more, see [Restoring VMs with special network configurations](backup-azure-restore-vms.md#restoring-vms-with-special-network-configurations).</span></span>
  * <span data-ttu-id="53f74-146">Macchine virtuali con configurazione del servizio di bilanciamento del carico (interno ed esterno)</span><span class="sxs-lookup"><span data-stu-id="53f74-146">Virtual machines under load balancer configuration (internal and external)</span></span>
  * <span data-ttu-id="53f74-147">Macchine virtuali con più indirizzi IP riservati</span><span class="sxs-lookup"><span data-stu-id="53f74-147">Virtual machines with multiple reserved IP addresses</span></span>
  * <span data-ttu-id="53f74-148">Macchine virtuali con più schede di rete</span><span class="sxs-lookup"><span data-stu-id="53f74-148">Virtual machines with multiple network adapters</span></span>

## <a name="create-a-recovery-services-vault-for-a-vm"></a><span data-ttu-id="53f74-149">Creare l'insieme di credenziali dei servizi di ripristino per una macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="53f74-149">Create a recovery services vault for a VM</span></span>
<span data-ttu-id="53f74-150">Un insieme di credenziali dei servizi di ripristino è un'entità che archivia i backup e i punti di ripristino che sono stati creati nel corso del tempo.</span><span class="sxs-lookup"><span data-stu-id="53f74-150">A recovery services vault is an entity that stores the backups and recovery points that have been created over time.</span></span> <span data-ttu-id="53f74-151">L'insieme di credenziali dei servizi di ripristino si di ripristino contiene anche i criteri di backup associati alle macchine virtuali protette.</span><span class="sxs-lookup"><span data-stu-id="53f74-151">The recovery services vault also contains the backup policies associated with the protected virtual machines.</span></span>

<span data-ttu-id="53f74-152">Per creare un insieme di credenziali dei servizi di ripristino:</span><span class="sxs-lookup"><span data-stu-id="53f74-152">To create a recovery services vault:</span></span>

1. <span data-ttu-id="53f74-153">Accedere al [portale di Azure](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="53f74-153">Sign in to the [Azure portal](https://portal.azure.com/).</span></span>
2. <span data-ttu-id="53f74-154">Scegliere **Sfoglia** dal menu Hub e digitare **Servizi di ripristino** nell'elenco di risorse.</span><span class="sxs-lookup"><span data-stu-id="53f74-154">On the Hub menu, click **Browse** and in the list of resources, type **Recovery Services**.</span></span> <span data-ttu-id="53f74-155">Non appena si inizia a digitare, l'elenco viene filtrato in base all'input.</span><span class="sxs-lookup"><span data-stu-id="53f74-155">As you begin typing, the list will filter based on your input.</span></span> <span data-ttu-id="53f74-156">Fare clic su **Insiemi di credenziali dei servizi di ripristino**.</span><span class="sxs-lookup"><span data-stu-id="53f74-156">Click **Recovery Services vault**.</span></span>

    ![Fare clic sul pulsante Sfoglia e digitare Servizi di ripristino.](./media/backup-azure-arm-vms-prepare/browse-to-rs-vaults-updated.png) <br/>

    <span data-ttu-id="53f74-159">Viene visualizzato l'elenco degli insiemi di credenziali dei servizi di ripristino.</span><span class="sxs-lookup"><span data-stu-id="53f74-159">The list of Recovery Services vaults is displayed.</span></span>
3. <span data-ttu-id="53f74-160">Scegliere **Aggiungi** dal menu **Insiemi di credenziali dei servizi di ripristino**.</span><span class="sxs-lookup"><span data-stu-id="53f74-160">On the **Recovery Services vaults** menu, click **Add**.</span></span>

    ![Creare un insieme di credenziali dei servizi di ripristino - Passaggio 2](./media/backup-azure-arm-vms-prepare/rs-vault-menu.png)

    <span data-ttu-id="53f74-162">Verrà visualizzato il pannello degli insiemi di credenziali dei servizi di ripristino, in cui viene richiesto di specificare **Nome**, **Sottoscrizione**, **Gruppo di risorse** e **Località**.</span><span class="sxs-lookup"><span data-stu-id="53f74-162">The Recovery Services vault blade opens, prompting you to provide a **Name**, **Subscription**, **Resource group**, and **Location**.</span></span>

    ![Creare un insieme di credenziali dei servizi di ripristino - Passaggio 5](./media/backup-azure-arm-vms-prepare/rs-vault-attributes.png)
4. <span data-ttu-id="53f74-164">Nel campo **Nome**digitare un nome descrittivo per identificare l'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="53f74-164">For **Name**, enter a friendly name to identify the vault.</span></span> <span data-ttu-id="53f74-165">Il nome deve essere univoco per la sottoscrizione di Azure.</span><span class="sxs-lookup"><span data-stu-id="53f74-165">The name needs to be unique for the Azure subscription.</span></span> <span data-ttu-id="53f74-166">Digitare un nome che contenga tra i 2 e i 50 caratteri.</span><span class="sxs-lookup"><span data-stu-id="53f74-166">Type a name that contains between 2 and 50 characters.</span></span> <span data-ttu-id="53f74-167">Deve iniziare con una lettera e può contenere solo lettere, numeri e trattini.</span><span class="sxs-lookup"><span data-stu-id="53f74-167">It must start with a letter, and can contain only letters, numbers, and hyphens.</span></span>
5. <span data-ttu-id="53f74-168">Fare clic su **Sottoscrizione** per visualizzare l'elenco di sottoscrizioni disponibili.</span><span class="sxs-lookup"><span data-stu-id="53f74-168">Click **Subscription** to see the available list of subscriptions.</span></span> <span data-ttu-id="53f74-169">Se non si è certi di quale sottoscrizione usare, usare la sottoscrizione predefinita (o suggerita).</span><span class="sxs-lookup"><span data-stu-id="53f74-169">If you are not sure which subscription to use, use the default (or suggested) subscription.</span></span> <span data-ttu-id="53f74-170">Sono presenti scelte multiple solo se l'account dell'organizzazione è associato a più sottoscrizioni di Azure.</span><span class="sxs-lookup"><span data-stu-id="53f74-170">There will be multiple choices only if your organizational account is associated with multiple Azure subscriptions.</span></span>
6. <span data-ttu-id="53f74-171">Fare clic su **Gruppo di risorse** per visualizzare l'elenco di gruppi di risorse disponibili oppure fare clic su **Nuovo** per crearne uno nuovo.</span><span class="sxs-lookup"><span data-stu-id="53f74-171">Click **Resource group** to see the available list of Resource groups, or click **New** to create a new Resource group.</span></span> <span data-ttu-id="53f74-172">Per informazioni complete sui gruppi di risorse, vedere [Panoramica di Azure Resource Manager](../azure-resource-manager/resource-group-overview.md)</span><span class="sxs-lookup"><span data-stu-id="53f74-172">For complete information on Resource groups, see [Azure Resource Manager overview](../azure-resource-manager/resource-group-overview.md)</span></span>
7. <span data-ttu-id="53f74-173">Fare clic su **Località** per selezionare l'area geografica per l'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="53f74-173">Click **Location** to select the geographic region for the vault.</span></span> <span data-ttu-id="53f74-174">L'insieme di credenziali **deve** trovarsi nella stessa area geografica delle macchine virtuali che si vuole proteggere.</span><span class="sxs-lookup"><span data-stu-id="53f74-174">The vault **must** be in the same region as the virtual machines that you want to protect.</span></span>

   > [!IMPORTANT]
   > <span data-ttu-id="53f74-175">Se si non è certi della località della macchina virtuale, chiudere la finestra di dialogo di creazione dell'insieme di credenziali e passare all'elenco di macchine virtuali nel portale.</span><span class="sxs-lookup"><span data-stu-id="53f74-175">If you are unsure of the location in which your VM exists, close out of the vault creation dialog, and go to the list of Virtual Machines in the portal.</span></span> <span data-ttu-id="53f74-176">Se si hanno macchine virtuali in più aree, sarà necessario creare un insieme di credenziali dei servizi di ripristino backup in ogni area.</span><span class="sxs-lookup"><span data-stu-id="53f74-176">If you have virtual machines in multiple regions, you will need to create a Recovery Services vault in each region.</span></span> <span data-ttu-id="53f74-177">Creare l'insieme di credenziali nella prima località prima di passare a quella successiva.</span><span class="sxs-lookup"><span data-stu-id="53f74-177">Create the vault in the first location before going to the next location.</span></span> <span data-ttu-id="53f74-178">Per archiviare i dati di backup, non è necessario specificare account di archiviazione perché l'insieme di credenziali dei servizi di ripristino e il servizio Backup di Azure gestiscono questa operazione in modo automatico.</span><span class="sxs-lookup"><span data-stu-id="53f74-178">There is no need to specify storage accounts to store the backup data--the Recovery Services vault and the Azure Backup service handle this automatically.</span></span>
   >
   >

8. <span data-ttu-id="53f74-179">Fare clic su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="53f74-179">Click **Create**.</span></span> <span data-ttu-id="53f74-180">La creazione dell'insieme di credenziali dei servizi di ripristino può richiedere alcuni minuti.</span><span class="sxs-lookup"><span data-stu-id="53f74-180">It can take a while for the Recovery Services vault to be created.</span></span> <span data-ttu-id="53f74-181">Monitorare le notifiche di stato nell'area superiore destra del portale.</span><span class="sxs-lookup"><span data-stu-id="53f74-181">Monitor the status notifications in the upper right-hand area in the portal.</span></span> <span data-ttu-id="53f74-182">L'insieme di credenziali, dopo essere stato creato, viene visualizzato negli insiemi di credenziali di Servizi di ripristino.</span><span class="sxs-lookup"><span data-stu-id="53f74-182">Once your vault is created, it appears in the list of Recovery Services vaults.</span></span> <span data-ttu-id="53f74-183">Se l'insieme di credenziali non viene visualizzato, fare clic su **Aggiorna** per</span><span class="sxs-lookup"><span data-stu-id="53f74-183">If you don't see your vault, click **Refresh** to</span></span>

    ![Elenco degli insiemi di credenziali per il backup](./media/backup-azure-arm-vms-prepare/rs-list-of-vaults.png)

    <span data-ttu-id="53f74-185">Ora che l'insieme di credenziali è stato creato, è possibile apprendere come impostare la replica di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="53f74-185">Now that you've created your vault, learn how to set the storage replication.</span></span>

## <a name="set-storage-replication"></a><span data-ttu-id="53f74-186">Impostare la replica di archiviazione</span><span class="sxs-lookup"><span data-stu-id="53f74-186">Set Storage Replication</span></span>
<span data-ttu-id="53f74-187">L'opzione della replica di archiviazione consente di scegliere tra l'archiviazione con ridondanza geografica e l'archiviazione con ridondanza locale.</span><span class="sxs-lookup"><span data-stu-id="53f74-187">The storage replication option allows you to choose between geo-redundant storage and locally redundant storage.</span></span> <span data-ttu-id="53f74-188">Per impostazione predefinita, l'insieme di credenziali prevede l'archiviazione con ridondanza geografica.</span><span class="sxs-lookup"><span data-stu-id="53f74-188">By default, your vault has geo-redundant storage.</span></span> <span data-ttu-id="53f74-189">Se si tratta del backup primario, lasciare l'opzione impostata sull'archiviazione con ridondanza geografica.</span><span class="sxs-lookup"><span data-stu-id="53f74-189">Leave the option set to geo-redundant storage if this is your primary backup.</span></span> <span data-ttu-id="53f74-190">Se si vuole un'opzione più economica ma non altrettanto permanente, scegliere l'archiviazione con ridondanza locale.</span><span class="sxs-lookup"><span data-stu-id="53f74-190">Choose locally redundant storage if you want a cheaper option that isn't quite as durable.</span></span>

<span data-ttu-id="53f74-191">Per modificare le impostazioni di replica di archiviazione:</span><span class="sxs-lookup"><span data-stu-id="53f74-191">To edit the storage replication setting:</span></span>

1. <span data-ttu-id="53f74-192">Nel pannello **Insiemi di credenziali dei servizi di ripristino** selezionare l'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="53f74-192">On the **Recovery Services vaults** blade, select your vault.</span></span>
    <span data-ttu-id="53f74-193">Quando si fa clic sull'insieme di credenziali, si aprono il pannello Impostazioni, *con il nome dell'insieme di credenziali nella parte superiore*, e il pannello dei dettagli dell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="53f74-193">When you click your vault, the Settings blade (*which has the name of the vault at the top*) and the vault details blade opens.</span></span>

    ![Selezionare l'insieme di credenziali di backup dall'elenco](./media/backup-azure-arm-vms-prepare/new-vault-settings-blade.png)

2. <span data-ttu-id="53f74-195">Nel pannello **Impostazioni**, usare il dispositivo di scorrimento verticale per raggiungere la sezione **Gestisci**.</span><span class="sxs-lookup"><span data-stu-id="53f74-195">On the **Settings** blade, use the vertical slider to scroll down to the **Manage** section.</span></span> <span data-ttu-id="53f74-196">Fare clic su **Infrastruttura di backup** per aprire il relativo pannello.</span><span class="sxs-lookup"><span data-stu-id="53f74-196">Click **Backup Infrastructure** to open its blade.</span></span> <span data-ttu-id="53f74-197">Nella sezione **Generale**, fare clic su **Configurazione backup** per aprire il relativo pannello.</span><span class="sxs-lookup"><span data-stu-id="53f74-197">In the **General** section click **Backup Configuration** to open its blade.</span></span> <span data-ttu-id="53f74-198">Nel pannello **Configurazione backup** scegliere l'opzione di replica di archiviazione per l'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="53f74-198">On the **Backup Configuration** blade, choose the storage replication option for your vault.</span></span> <span data-ttu-id="53f74-199">Per impostazione predefinita, l'insieme di credenziali prevede l'archiviazione con ridondanza geografica.</span><span class="sxs-lookup"><span data-stu-id="53f74-199">By default, your vault has geo-redundant storage.</span></span> <span data-ttu-id="53f74-200">Se si modifica il tipo di replica di archiviazione, fare clic su **Salva**.</span><span class="sxs-lookup"><span data-stu-id="53f74-200">If you change the Storage replication type, click **Save**.</span></span>

    ![Elenco degli insiemi di credenziali per il backup](./media/backup-azure-arm-vms-prepare/full-blade.png)

     <span data-ttu-id="53f74-202">Se si usa Azure come endpoint primario di archiviazione dei backup, continuare a usare l'archiviazione con ridondanza geografica.</span><span class="sxs-lookup"><span data-stu-id="53f74-202">If you are using Azure as a primary backup storage endpoint, continue using geo-redundant storage.</span></span> <span data-ttu-id="53f74-203">Se si usa Azure come endpoint non primario di archiviazione dei backup, è consigliabile scegliere l'opzione di archiviazione con ridondanza locale.</span><span class="sxs-lookup"><span data-stu-id="53f74-203">If you are using Azure as a non-primary backup storage endpoint, then choose locally redundant storage.</span></span> <span data-ttu-id="53f74-204">Per altre informazioni sulle opzioni di archiviazione con [ridondanza geografica](../storage/common/storage-redundancy.md#geo-redundant-storage) e con [ridondanza locale](../storage/common/storage-redundancy.md#locally-redundant-storage), vedere la panoramica [Replica di Archiviazione di Azure](../storage/common/storage-redundancy.md).</span><span class="sxs-lookup"><span data-stu-id="53f74-204">Read more about [geo-redundant](../storage/common/storage-redundancy.md#geo-redundant-storage) and [locally redundant](../storage/common/storage-redundancy.md#locally-redundant-storage) storage options in the [Azure Storage replication overview](../storage/common/storage-redundancy.md).</span></span>
    <span data-ttu-id="53f74-205">Dopo aver scelto l'opzione di archiviazione per l'insieme di credenziali, è possibile associare la macchina virtuale all'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="53f74-205">After choosing the storage option for your vault, you are ready to associate the VM with the vault.</span></span> <span data-ttu-id="53f74-206">Per iniziare l'associazione, è necessario trovare e registrare le macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="53f74-206">To begin the association, you should discover and register the Azure virtual machines.</span></span>

## <a name="select-a-backup-goal-set-policy-and-define-items-to-protect"></a><span data-ttu-id="53f74-207">Selezionare un obiettivo di backup, impostare i criteri e definire gli elementi da proteggere</span><span class="sxs-lookup"><span data-stu-id="53f74-207">Select a backup goal, set policy and define items to protect</span></span>
<span data-ttu-id="53f74-208">Prima di registrare una macchina virtuale in un insieme di credenziali, eseguire il processo di individuazione per verificare che vengano identificate le eventuali nuove macchine virtuali aggiunte alla sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="53f74-208">Before registering a VM with a vault, run the discovery process to ensure that any new virtual machines that have been added to the subscription are identified.</span></span> <span data-ttu-id="53f74-209">Il processo esegue una query su Azure per ottenere l'elenco delle macchine virtuali disponibili nella sottoscrizione, insieme ad altre informazioni come il nome del servizio cloud e l'area.</span><span class="sxs-lookup"><span data-stu-id="53f74-209">The process queries Azure for the list of virtual machines in the subscription, along with additional information like the cloud service name and the region.</span></span> <span data-ttu-id="53f74-210">Nel portale di Azure lo scenario fa riferimento a ciò che si inserirà nell'insieme di credenziali dei servizi di ripristino.</span><span class="sxs-lookup"><span data-stu-id="53f74-210">In the Azure portal, scenario refers to what you are going to put into the recovery services vault.</span></span> <span data-ttu-id="53f74-211">I criteri determinano la pianificazione relativa alla frequenza e al momento in cui acquisiti i punti di ripristino.</span><span class="sxs-lookup"><span data-stu-id="53f74-211">Policy is the schedule for how often and when recovery points are taken.</span></span> <span data-ttu-id="53f74-212">I criteri includono anche il periodo di mantenimento dati per i punti di ripristino.</span><span class="sxs-lookup"><span data-stu-id="53f74-212">Policy also includes the retention range for the recovery points.</span></span>

1. <span data-ttu-id="53f74-213">Se un insieme di credenziali dei servizi di ripristino è già aperto, procedere al passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="53f74-213">If you already have a Recovery Services vault open, proceed to step 2.</span></span> <span data-ttu-id="53f74-214">Se non è aperto alcun insieme di credenziali dei Servizi di ripristino, aprire il [portale di Azure](https://portal.azure.com/) e scegliere **Altri servizi** dal menu Hub.</span><span class="sxs-lookup"><span data-stu-id="53f74-214">If you do not have a Recovery Services vault open, then open the [Azure portal](https://portal.azure.com/) and on the Hub menu, click **More services**.</span></span>

   * <span data-ttu-id="53f74-215">Nell'elenco di risorse digitare **servizi di ripristino**.</span><span class="sxs-lookup"><span data-stu-id="53f74-215">In the list of resources, type **Recovery Services**.</span></span>
   * <span data-ttu-id="53f74-216">Non appena si inizia a digitare, l'elenco viene filtrato in base all'input.</span><span class="sxs-lookup"><span data-stu-id="53f74-216">As you begin typing, the list will filter based on your input.</span></span> <span data-ttu-id="53f74-217">Quando viene visualizzato, fare clic su **Insiemi di credenziali dei servizi di ripristino**.</span><span class="sxs-lookup"><span data-stu-id="53f74-217">When you see **Recovery Services vaults**, click it.</span></span>

     ![Creare un insieme di credenziali dei servizi di ripristino - Passaggio 1](./media/backup-azure-arm-vms-prepare/browse-to-rs-vaults-updated.png) <br/>

     <span data-ttu-id="53f74-219">Viene visualizzato l'elenco di insiemi di credenziali dei servizi di ripristino.</span><span class="sxs-lookup"><span data-stu-id="53f74-219">The list of Recovery Services vaults appears.</span></span> <span data-ttu-id="53f74-220">Se non esistono insiemi di credenziali nella sottoscrizione, questo elenco sarà vuoto.</span><span class="sxs-lookup"><span data-stu-id="53f74-220">If there are no vaults in your subscription, this list will be empty.</span></span>

    ![Visualizzazione dell'elenco degli insiemi di credenziali dei Servizi di ripristino](./media/backup-azure-arm-vms-prepare/rs-list-of-vaults.png)

   * <span data-ttu-id="53f74-222">Nell'elenco degli insiemi di credenziali dei Servizi di ripristino selezionare un insieme di credenziali per aprire il relativo dashboard.</span><span class="sxs-lookup"><span data-stu-id="53f74-222">From the list of Recovery Services vaults, select a vault to open its dashboard.</span></span>

     <span data-ttu-id="53f74-223">Si aprono il pannello Impostazioni e il dashboard dell'insieme di credenziali specificato.</span><span class="sxs-lookup"><span data-stu-id="53f74-223">The Settings blade and the vault dashboard for the chosen vault, opens.</span></span>

     ![Pannello dell'insieme di credenziali aperto](./media/backup-azure-arm-vms-prepare/new-vault-settings-blade.png)
2. <span data-ttu-id="53f74-225">Scegliere **Backup** dal menu del dashboard dell'insieme di credenziali per aprire il pannello Backup.</span><span class="sxs-lookup"><span data-stu-id="53f74-225">On the vault dashboard menu click **Backup** to open the Backup blade.</span></span>

    ![Pannello Backup aperto](./media/backup-azure-arm-vms-prepare/backup-button.png)

    <span data-ttu-id="53f74-227">Si aprono i pannelli Backup e Obiettivo del backup.</span><span class="sxs-lookup"><span data-stu-id="53f74-227">The Backup and Backup Goal blades open.</span></span>

    ![Pannello Scenario aperto](./media/backup-azure-arm-vms-prepare/select-backup-goal-1.png)

3. <span data-ttu-id="53f74-229">Nel pannello Obiettivo del backup impostare **Posizione di esecuzione del carico di lavoro** su Azure ed **Elementi di cui eseguire il backup** su Macchina virtuale e quindi fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="53f74-229">On the Backup Goal blade, set **Where is your workload running** to Azure and **What do you want to backup** to Virtual machine, then click **OK**.</span></span>

    <span data-ttu-id="53f74-230">L'estensione della macchina virtuale verrà così registrata nell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="53f74-230">This registers the VM extension with the vault.</span></span> <span data-ttu-id="53f74-231">Il pannello Obiettivo di backup si chiude e viene visualizzato il pannello **Criterio di backup**.</span><span class="sxs-lookup"><span data-stu-id="53f74-231">The Backup Goal blade closes and the **Backup policy** blade opens.</span></span>

    ![Pannello Scenario aperto](./media/backup-azure-arm-vms-prepare/select-backup-goal-2.png)
4. <span data-ttu-id="53f74-233">Nel pannello Criterio di backup selezionare il criterio di backup che si vuole applicare all'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="53f74-233">On the Backup policy blade, select the backup policy you want to apply to the vault.</span></span>

    ![Selezionare il criterio di backup](./media/backup-azure-arm-vms-prepare/setting-rs-backup-policy-new.png)

    <span data-ttu-id="53f74-235">I dettagli dei criteri predefiniti vengono elencati nel menu a discesa.</span><span class="sxs-lookup"><span data-stu-id="53f74-235">The details of the default policy are listed under the drop-down menu.</span></span> <span data-ttu-id="53f74-236">Per creare un nuovo criterio, selezionare **Crea nuovo** dal menu a discesa.</span><span class="sxs-lookup"><span data-stu-id="53f74-236">If you want to create a new policy, select **Create New** from the drop-down menu.</span></span> <span data-ttu-id="53f74-237">Per istruzioni sulla definizione di un criterio di backup, vedere [Definizione di un criterio di backup](backup-azure-vms-first-look-arm.md#defining-a-backup-policy).</span><span class="sxs-lookup"><span data-stu-id="53f74-237">For instructions on defining a backup policy, see [Defining a backup policy](backup-azure-vms-first-look-arm.md#defining-a-backup-policy).</span></span>
    <span data-ttu-id="53f74-238">Fare clic su **OK** per associare il criterio di backup all'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="53f74-238">Click **OK** to associate the backup policy with the vault.</span></span>

    <span data-ttu-id="53f74-239">Il pannello Criterio di backup si chiude e viene visualizzato il pannello **Seleziona macchine virtuali**.</span><span class="sxs-lookup"><span data-stu-id="53f74-239">The Backup policy blade closes and the **Select virtual machines** blade opens.</span></span>
5. <span data-ttu-id="53f74-240">Nel pannello **Seleziona macchine virtuali** scegliere le macchine virtuali da associare al criterio specificato e fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="53f74-240">In the **Select virtual machines** blade, choose the virtual machines to associate with the specified policy and click **OK**.</span></span>

    ![Selezionare il carico di lavoro](./media/backup-azure-arm-vms-prepare/select-vms-to-backup.png)

    <span data-ttu-id="53f74-242">Viene convalidata la macchina virtuale selezionata.</span><span class="sxs-lookup"><span data-stu-id="53f74-242">The selected virtual machine is validated.</span></span> <span data-ttu-id="53f74-243">Se le macchine virtuali previste non sono visibili, verificare che si trovino nella stessa posizione di Azure che include l'insieme di credenziali di Servizi di ripristino e che non siano già protette in un altro insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="53f74-243">If you do not see the virtual machines that you expected to see, check that they exist in the same Azure location as the Recovery Services vault and are not already protected in another vault.</span></span> <span data-ttu-id="53f74-244">La posizione dell'insieme dei credenziali dei Servizi di ripristino viene visualizzata nel dashboard dell'insieme.</span><span class="sxs-lookup"><span data-stu-id="53f74-244">The location of the Recovery Services vault is shown on the vault dashboard.</span></span>

6. <span data-ttu-id="53f74-245">Dopo aver definito tutte le impostazioni per l'insieme di credenziali, nel pannello Backup fare clic su **Abilita backup**.</span><span class="sxs-lookup"><span data-stu-id="53f74-245">Now that you have defined all settings for the vault, in the Backup blade click **Enable Backup**.</span></span> <span data-ttu-id="53f74-246">Il criterio verrà distribuito nell'insieme di credenziali e nelle VM.</span><span class="sxs-lookup"><span data-stu-id="53f74-246">This deploys the policy to the vault and the VMs.</span></span> <span data-ttu-id="53f74-247">Ciò non crea il punto di ripristino iniziale per la macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="53f74-247">This does not create the initial recovery point for the virtual machine.</span></span>

    ![Abilita backup](./media/backup-azure-arm-vms-prepare/vm-validated-click-enable.png)

<span data-ttu-id="53f74-249">Dopo avere abilitato correttamente il backup, il criterio di backup verrà eseguito come pianificato.</span><span class="sxs-lookup"><span data-stu-id="53f74-249">After successfully enabling the backup, your backup policy will execute on schedule.</span></span> <span data-ttu-id="53f74-250">Se si desidera generare un processo di backup su richiesta per eseguire subito il backup delle macchine virtuali, vedere [Attivazione del processo di backup](./backup-azure-arm-vms.md#triggering-the-backup-job).</span><span class="sxs-lookup"><span data-stu-id="53f74-250">If you would like to generate an on-demand backup job to back up the virtual machines now, see [Triggering the Backup job](./backup-azure-arm-vms.md#triggering-the-backup-job).</span></span>

<span data-ttu-id="53f74-251">In caso di problemi con la registrazione della macchina virtuale, vedere le informazioni seguenti sull'installazione dell'agente di macchine virtuali e sulla connettività di rete.</span><span class="sxs-lookup"><span data-stu-id="53f74-251">If you have problems registering the virtual machine, see the following information on installing the VM Agent and on Network connectivity.</span></span> <span data-ttu-id="53f74-252">Probabilmente le informazioni seguenti non sono necessarie se si stanno proteggendo macchine virtuali create in Azure.</span><span class="sxs-lookup"><span data-stu-id="53f74-252">You probably don't need the following information if you are protecting virtual machines created in Azure.</span></span> <span data-ttu-id="53f74-253">Tuttavia, se è stata eseguita la migrazione delle macchine virtuali in Azure, assicurarsi di avere installato correttamente l'agente di macchine virtuali e che la macchina virtuale sia in grado di comunicare con la rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="53f74-253">However if you migrated your virtual machines into Azure, then be sure you have properly installed the VM agent and that your virtual machine can communicate with the virtual network.</span></span>

## <a name="install-the-vm-agent-on-the-virtual-machine"></a><span data-ttu-id="53f74-254">Installare l'agente di macchine virtuali nella macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="53f74-254">Install the VM Agent on the virtual machine</span></span>
<span data-ttu-id="53f74-255">Per il funzionamento dell'estensione di backup, l'agente di macchine virtuali deve essere installato nella macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="53f74-255">The Azure VM Agent must be installed on the Azure virtual machine for the Backup extension to work.</span></span> <span data-ttu-id="53f74-256">Se la macchina virtuale è stata creata dalla raccolta di Azure, l'agente di macchine virtuali è già installato.</span><span class="sxs-lookup"><span data-stu-id="53f74-256">If your VM was created from the Azure gallery, then the VM Agent is already present on the virtual machine.</span></span> <span data-ttu-id="53f74-257">Queste informazioni riguardano le situazioni in cui *non* si usa una macchina virtuale creata dalla raccolta di Azure, ad esempio una macchina virtuale di cui è stata eseguita la migrazione da un data center locale.</span><span class="sxs-lookup"><span data-stu-id="53f74-257">This information is provided for the situations where you are *not* using a VM created from the Azure gallery - for example you migrated a VM from an on-premises datacenter.</span></span> <span data-ttu-id="53f74-258">In tal caso, è necessario installare l'agente di macchine virtuali per proteggerla.</span><span class="sxs-lookup"><span data-stu-id="53f74-258">In such a case, the VM Agent needs to be installed in order to protect the virtual machine.</span></span> <span data-ttu-id="53f74-259">Informazioni sull'[agente di macchine virtuali](../virtual-machines/windows/classic/agents-and-extensions.md#azure-vm-agents-for-windows-and-linux).</span><span class="sxs-lookup"><span data-stu-id="53f74-259">Learn about the [VM Agent](../virtual-machines/windows/classic/agents-and-extensions.md#azure-vm-agents-for-windows-and-linux).</span></span>

<span data-ttu-id="53f74-260">In caso di problemi con il backup della macchina virtuale di Azure, assicurarsi che l'agente di macchine virtuali di Azure sia installato correttamente nella macchina virtuale. Vedere in proposito la tabella seguente.</span><span class="sxs-lookup"><span data-stu-id="53f74-260">If you have problems backing up the Azure VM, check that the Azure VM Agent is correctly installed on the virtual machine (see the table below).</span></span> <span data-ttu-id="53f74-261">La tabella seguente fornisce informazioni aggiuntive sull'agente di macchine virtuali per macchine virtuali Windows e Linux.</span><span class="sxs-lookup"><span data-stu-id="53f74-261">The following table provides additional information about the VM Agent for Windows and Linux VMs.</span></span>

| <span data-ttu-id="53f74-262">**Operazione**</span><span class="sxs-lookup"><span data-stu-id="53f74-262">**Operation**</span></span> | <span data-ttu-id="53f74-263">**Windows**</span><span class="sxs-lookup"><span data-stu-id="53f74-263">**Windows**</span></span> | <span data-ttu-id="53f74-264">**Linux**</span><span class="sxs-lookup"><span data-stu-id="53f74-264">**Linux**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="53f74-265">Installazione dell'agente di macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="53f74-265">Installing the VM Agent</span></span> |<span data-ttu-id="53f74-266">Scaricare e installare il file [MSI per l'agente](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="53f74-266">Download and install the [agent MSI](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409).</span></span> <span data-ttu-id="53f74-267">Per completare l'installazione sono necessari privilegi di amministratore.</span><span class="sxs-lookup"><span data-stu-id="53f74-267">You will need Administrator privileges to complete the installation.</span></span> |<li> <span data-ttu-id="53f74-268">Installare l'[agente Linux](../virtual-machines/linux/agent-user-guide.md) più recente.</span><span class="sxs-lookup"><span data-stu-id="53f74-268">Install the latest [Linux agent](../virtual-machines/linux/agent-user-guide.md).</span></span> <span data-ttu-id="53f74-269">Per completare l'installazione sono necessari privilegi di amministratore.</span><span class="sxs-lookup"><span data-stu-id="53f74-269">You will need Administrator privileges to complete the installation.</span></span> <span data-ttu-id="53f74-270">È consigliabile installare l'agente dal repository di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="53f74-270">We recommend installing agent from your distribution repository.</span></span> <span data-ttu-id="53f74-271">**Non è consigliabile** installare l'agente di macchine virtuali Linux direttamente da GitHub.</span><span class="sxs-lookup"><span data-stu-id="53f74-271">We **do not recommend** installing Linux VM agent directly from github.</span></span>  |
| <span data-ttu-id="53f74-272">Aggiornamento dell'agente di VM</span><span class="sxs-lookup"><span data-stu-id="53f74-272">Updating the VM Agent</span></span> |<span data-ttu-id="53f74-273">L'aggiornamento dell'agente di VM è semplice quanto la reinstallazione dei [file binari dell'agente di VM](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="53f74-273">Updating the VM Agent is as simple as reinstalling the [VM Agent binaries](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409).</span></span> <br><span data-ttu-id="53f74-274">Assicurarsi che non siano in esecuzione operazioni di backup durante l'aggiornamento dell'agente di VM.</span><span class="sxs-lookup"><span data-stu-id="53f74-274">Ensure that no backup operation is running while the VM agent is being updated.</span></span> |<span data-ttu-id="53f74-275">Seguire le istruzioni sull'[aggiornamento dell'agente di macchine virtuali Linux ](../virtual-machines/linux/update-agent.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="53f74-275">Follow the instructions on [updating the Linux VM Agent](../virtual-machines/linux/update-agent.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span> <span data-ttu-id="53f74-276">È consigliabile aggiornare l'agente dal repository di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="53f74-276">We recommend updating agent from your distribution repository.</span></span> <span data-ttu-id="53f74-277">**Non è consigliabile** aggiornare l'agente di macchine virtuali Linux direttamente da GitHub.</span><span class="sxs-lookup"><span data-stu-id="53f74-277">We **do not recommend** updating Linux VM agent directly from github.</span></span><br><span data-ttu-id="53f74-278">Assicurarsi che non siano in esecuzione operazioni di backup durante l'aggiornamento dell'agente di VM.</span><span class="sxs-lookup"><span data-stu-id="53f74-278">Ensure that no backup operation is running while the VM Agent is being updated.</span></span> |
| <span data-ttu-id="53f74-279">Convalida dell'installazione dell'agente di macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="53f74-279">Validating the VM Agent installation</span></span> |<li><span data-ttu-id="53f74-280">Passare alla cartella *C:\WindowsAzure\Packages* nella VM di Azure,</span><span class="sxs-lookup"><span data-stu-id="53f74-280">Navigate to the *C:\WindowsAzure\Packages* folder in the Azure VM.</span></span> <li><span data-ttu-id="53f74-281">che dovrebbe includere il file WaAppAgent.exe.</span><span class="sxs-lookup"><span data-stu-id="53f74-281">You should find the WaAppAgent.exe file present.</span></span><li> <span data-ttu-id="53f74-282">Fare clic con il pulsante destro del mouse sul file, scegliere **Proprietà** e quindi selezionare la scheda **Dettagli**. Il campo Versione prodotto deve essere 2.6.1198.718 o superiore.</span><span class="sxs-lookup"><span data-stu-id="53f74-282">Right-click the file, go to **Properties**, and then select the **Details** tab. The Product Version field should be 2.6.1198.718 or higher.</span></span> |<span data-ttu-id="53f74-283">N/D</span><span class="sxs-lookup"><span data-stu-id="53f74-283">N/A</span></span> |

### <a name="backup-extension"></a><span data-ttu-id="53f74-284">Estensione di backup</span><span class="sxs-lookup"><span data-stu-id="53f74-284">Backup extension</span></span>
<span data-ttu-id="53f74-285">Dopo aver installato l'agente di macchine virtuali nella macchina virtuale, il servizio Backup di Azure installa l'estensione di backup nell'agente di macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="53f74-285">Once the VM Agent is installed on the virtual machine, the Azure Backup service installs the backup extension to the VM Agent.</span></span> <span data-ttu-id="53f74-286">Il servizio Backup di Azure si aggiorna automaticamente e applica patch all'estensione di backup.</span><span class="sxs-lookup"><span data-stu-id="53f74-286">The Azure Backup service seamlessly upgrades and patches the backup extension.</span></span>

<span data-ttu-id="53f74-287">L'estensione di backup viene installata dal servizio Backup indipendentemente dal fatto che la macchina virtuale sia in esecuzione o meno.</span><span class="sxs-lookup"><span data-stu-id="53f74-287">The backup extension is installed by the Backup service whether or not the VM is running.</span></span> <span data-ttu-id="53f74-288">Una macchina virtuale in esecuzione consente di ottenere un punto di ripristino coerente con l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="53f74-288">A running VM provides the greatest chance of getting an application-consistent recovery point.</span></span> <span data-ttu-id="53f74-289">Il servizio Backup di Azure continua tuttavia a eseguire il backup della macchina virtuale, anche se questa è spenta e non è stato possibile installare l'estensione.</span><span class="sxs-lookup"><span data-stu-id="53f74-289">However, the Azure Backup service continues to back up the VM even if it is turned off, and the extension could not be installed.</span></span> <span data-ttu-id="53f74-290">Questa situazione è detta macchina virtuale offline.</span><span class="sxs-lookup"><span data-stu-id="53f74-290">This is known as Offline VM.</span></span> <span data-ttu-id="53f74-291">In questo caso, il punto di ripristino sarà *coerente con l'arresto anomalo*.</span><span class="sxs-lookup"><span data-stu-id="53f74-291">In this case, the recovery point will be *crash consistent*.</span></span>

## <a name="network-connectivity"></a><span data-ttu-id="53f74-292">Connettività di rete</span><span class="sxs-lookup"><span data-stu-id="53f74-292">Network connectivity</span></span>
<span data-ttu-id="53f74-293">Per gestire gli snapshot di una macchina virtuale, l'estensione di backup richiede la connettività agli indirizzi IP pubblici di Azure.</span><span class="sxs-lookup"><span data-stu-id="53f74-293">In order to manage the VM snapshots, the backup extension needs connectivity to the Azure public IP addresses.</span></span> <span data-ttu-id="53f74-294">Senza la connettività Internet appropriata, si verificherà il timeout delle richieste HTTP della macchina virtuale e l'operazione di backup non verrà eseguita.</span><span class="sxs-lookup"><span data-stu-id="53f74-294">Without the right Internet connectivity, the virtual machine's HTTP requests time out and the backup operation fails.</span></span> <span data-ttu-id="53f74-295">Se la distribuzione ha restrizioni di accesso, ad esempio, un gruppo di sicurezza di rete (NSG), scegliere una delle opzioni seguenti per specificare un percorso chiaro per il traffico di backup:</span><span class="sxs-lookup"><span data-stu-id="53f74-295">If your deployment has access restrictions in place (through a network security group (NSG), for example), then choose one of these options for providing a clear path for backup traffic:</span></span>

* <span data-ttu-id="53f74-296">[Microsoft Azure Datacenter IP Ranges](http://www.microsoft.com/en-us/download/details.aspx?id=41653) (Intervalli di indirizzi IP dei data center di Azure): leggere l'articolo per istruzioni su come includere gli indirizzi IP nell'elenco degli elementi consentiti.</span><span class="sxs-lookup"><span data-stu-id="53f74-296">[Whitelist the Azure datacenter IP ranges](http://www.microsoft.com/en-us/download/details.aspx?id=41653) - see the article for instructions on how to whitelist the IP addresses.</span></span>
* <span data-ttu-id="53f74-297">Distribuire un server proxy HTTP per eseguire il routing del traffico</span><span class="sxs-lookup"><span data-stu-id="53f74-297">Deploy an HTTP proxy server for routing traffic.</span></span>

<span data-ttu-id="53f74-298">Quando si decide quale opzione usare, i compromessi sono compresi tra facilità di gestione, controllo granulare e costo.</span><span class="sxs-lookup"><span data-stu-id="53f74-298">When deciding which option to use, the trade-offs are between manageability, granular control, and cost.</span></span>

| <span data-ttu-id="53f74-299">Opzione</span><span class="sxs-lookup"><span data-stu-id="53f74-299">Option</span></span> | <span data-ttu-id="53f74-300">Vantaggi</span><span class="sxs-lookup"><span data-stu-id="53f74-300">Advantages</span></span> | <span data-ttu-id="53f74-301">Svantaggi:</span><span class="sxs-lookup"><span data-stu-id="53f74-301">Disadvantages</span></span> |
| --- | --- | --- |
| <span data-ttu-id="53f74-302">Aggiungere gli intervalli IP all'elenco elementi consentiti </span><span class="sxs-lookup"><span data-stu-id="53f74-302">Whitelist IP ranges</span></span> |<span data-ttu-id="53f74-303">Senza costi aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="53f74-303">No additional costs.</span></span><br><br><span data-ttu-id="53f74-304">Per aprire l'accesso in un gruppo di sicurezza di rete, usare il cmdlet <i>Set-AzureNetworkSecurityRule</i>.</span><span class="sxs-lookup"><span data-stu-id="53f74-304">For opening access in an NSG, use the <i>Set-AzureNetworkSecurityRule</i> cmdlet.</span></span> |<span data-ttu-id="53f74-305">Complessità di gestione perché gli intervalli IP interessati variano nel tempo.</span><span class="sxs-lookup"><span data-stu-id="53f74-305">Complex to manage as the impacted IP ranges change over time.</span></span><br><br><span data-ttu-id="53f74-306">Offre l'accesso a tutto l'ambiente di Azure, non solo al servizio di Archiviazione.</span><span class="sxs-lookup"><span data-stu-id="53f74-306">Provides access to the whole of Azure, and not just Storage.</span></span> |
| <span data-ttu-id="53f74-307">Proxy HTTP</span><span class="sxs-lookup"><span data-stu-id="53f74-307">HTTP proxy</span></span> |<span data-ttu-id="53f74-308">È consentito il controllo granulare nel proxy sugli URL di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="53f74-308">Granular control in the proxy over the storage URLs allowed.</span></span><br><span data-ttu-id="53f74-309">Singolo punto di accesso Internet alle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="53f74-309">Single point of Internet access to VMs.</span></span><br><span data-ttu-id="53f74-310">Non è soggetto alle modifiche degli indirizzi IP di Azure.</span><span class="sxs-lookup"><span data-stu-id="53f74-310">Not subject to Azure IP address changes.</span></span> |<span data-ttu-id="53f74-311">Costi aggiuntivi per l'esecuzione di una VM con il software proxy.</span><span class="sxs-lookup"><span data-stu-id="53f74-311">Additional costs for running a VM with the proxy software.</span></span> |

### <a name="whitelist-the-azure-datacenter-ip-ranges"></a><span data-ttu-id="53f74-312">Microsoft Azure Datacenter IP Ranges </span><span class="sxs-lookup"><span data-stu-id="53f74-312">Whitelist the Azure datacenter IP ranges</span></span>
<span data-ttu-id="53f74-313">Per aggiungere gli intervalli IP dei data center di Azure all'elenco degli elementi consentiti, vedere il [sito Web di Azure](http://www.microsoft.com/en-us/download/details.aspx?id=41653) per informazioni dettagliate sugli intervalli IP e per istruzioni.</span><span class="sxs-lookup"><span data-stu-id="53f74-313">To whitelist the Azure datacenter IP ranges, please see the [Azure website](http://www.microsoft.com/en-us/download/details.aspx?id=41653) for details on the IP ranges, and instructions.</span></span>

### <a name="using-an-http-proxy-for-vm-backups"></a><span data-ttu-id="53f74-314">Uso di un proxy HTTP per i backup delle VM</span><span class="sxs-lookup"><span data-stu-id="53f74-314">Using an HTTP proxy for VM backups</span></span>
<span data-ttu-id="53f74-315">Quando si esegue il backup di una macchina virtuale, l'estensione di backup nella VM invia i comandi di gestione degli snapshot ad Archiviazione di Azure usando un'API HTTPS.</span><span class="sxs-lookup"><span data-stu-id="53f74-315">When backing up a VM, the backup extension on the VM sends the snapshot management commands to Azure Storage using an HTTPS API.</span></span> <span data-ttu-id="53f74-316">Eseguire il routing del traffico di estensione del backup tramite il proxy HTTP perché è l'unico componente configurato per l'accesso a Internet pubblico.</span><span class="sxs-lookup"><span data-stu-id="53f74-316">Route the backup extension traffic through the HTTP proxy since it is the only component configured for access to the public Internet.</span></span>

> [!NOTE]
> <span data-ttu-id="53f74-317">Non esiste alcuna raccomandazione per il proxy da usare.</span><span class="sxs-lookup"><span data-stu-id="53f74-317">There is no recommendation for the proxy software that should be used.</span></span> <span data-ttu-id="53f74-318">Assicurarsi di scegliere un proxy compatibile con i passaggi di configurazione descritti di seguito.</span><span class="sxs-lookup"><span data-stu-id="53f74-318">Ensure that you pick a proxy that is compatible with the configuration steps below.</span></span>
>
>

<span data-ttu-id="53f74-319">L'immagine dell'esempio seguente visualizza i tre passaggi necessari per usare un proxy HTTP:</span><span class="sxs-lookup"><span data-stu-id="53f74-319">The example image below shows the three configuration steps necessary to use an HTTP proxy:</span></span>

* <span data-ttu-id="53f74-320">La VM dell'app esegue il routing del traffico HTTP diretto alla rete Internet pubblica attraverso la VM del proxy.</span><span class="sxs-lookup"><span data-stu-id="53f74-320">App VM routes all HTTP traffic bound for the public Internet through Proxy VM.</span></span>
* <span data-ttu-id="53f74-321">La VM del Proxy consente il traffico in entrata da macchine virtuali nella rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="53f74-321">Proxy VM allows incoming traffic from VMs in the virtual network.</span></span>
* <span data-ttu-id="53f74-322">Il gruppo di sicurezza di rete (NSG) denominato blocco NSF ha bisogno di una regola di sicurezza che consenta il traffico Internet in uscita dalla VM Proxy.</span><span class="sxs-lookup"><span data-stu-id="53f74-322">The Network Security Group (NSG) named NSF-lockdown needs a security rule allowing outbound Internet traffic from Proxy VM.</span></span>

![Diagramma della distribuzione gruppo di sicurezza di rete con proxy HTTP](./media/backup-azure-vms-prepare/nsg-with-http-proxy.png)

<span data-ttu-id="53f74-324">Per usare un proxy HTTP per la comunicazione con la rete Internet pubblica, attenersi alla procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="53f74-324">To use an HTTP proxy to communicating to the public Internet, follow these steps:</span></span>

#### <a name="step-1-configure-outgoing-network-connections"></a><span data-ttu-id="53f74-325">Passaggio 1.</span><span class="sxs-lookup"><span data-stu-id="53f74-325">Step 1.</span></span> <span data-ttu-id="53f74-326">Configurare le connessioni di rete in uscita</span><span class="sxs-lookup"><span data-stu-id="53f74-326">Configure outgoing network connections</span></span>
###### <a name="for-windows-machines"></a><span data-ttu-id="53f74-327">Per macchine Windows</span><span class="sxs-lookup"><span data-stu-id="53f74-327">For Windows machines</span></span>
<span data-ttu-id="53f74-328">Questa procedura consente di impostare la configurazione del server proxy per l'account del sistema locale.</span><span class="sxs-lookup"><span data-stu-id="53f74-328">This will setup proxy server configuration for Local System Account.</span></span>

1. <span data-ttu-id="53f74-329">Scaricare [PsExec](https://technet.microsoft.com/sysinternals/bb897553)</span><span class="sxs-lookup"><span data-stu-id="53f74-329">Download [PsExec](https://technet.microsoft.com/sysinternals/bb897553)</span></span>
2. <span data-ttu-id="53f74-330">Eseguire il comando seguente dal prompt dei comandi con privilegi elevati,</span><span class="sxs-lookup"><span data-stu-id="53f74-330">Run following command from elevated prompt,</span></span>

     ```
     psexec -i -s "c:\Program Files\Internet Explorer\iexplore.exe"
     ```
     <span data-ttu-id="53f74-331">Si apre la finestra di Explorer.</span><span class="sxs-lookup"><span data-stu-id="53f74-331">It will open internet explorer window.</span></span>
3. <span data-ttu-id="53f74-332">Scegliere Strumenti -> Opzioni Internet -> Connessioni -> Impostazioni LAN.</span><span class="sxs-lookup"><span data-stu-id="53f74-332">Go to Tools -> Internet Options -> Connections -> LAN settings.</span></span>
4. <span data-ttu-id="53f74-333">Verificare le impostazioni del proxy per l'account di sistema.</span><span class="sxs-lookup"><span data-stu-id="53f74-333">Verify proxy settings for System account.</span></span> <span data-ttu-id="53f74-334">Impostare l'IP del Proxy e la porta.</span><span class="sxs-lookup"><span data-stu-id="53f74-334">Set Proxy IP and port.</span></span>
5. <span data-ttu-id="53f74-335">Chiudere Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="53f74-335">Close Internet Explorer.</span></span>

<span data-ttu-id="53f74-336">Questo comando esegue una configurazione proxy a livello di computer e verrà usato per tutto il traffico HTTP/HTTPS in uscita.</span><span class="sxs-lookup"><span data-stu-id="53f74-336">This will set up a machine-wide proxy configuration, and will be used for any outgoing HTTP/HTTPS traffic.</span></span>

<span data-ttu-id="53f74-337">Se è stato installato un server proxy in un account utente corrente (non in un account di sistema locale), usare lo script seguente per applicare le impostazioni a SYSTEMACCOUNT:</span><span class="sxs-lookup"><span data-stu-id="53f74-337">If you have setup a proxy server on a current user account(not a Local System Account), use the following script to apply them to SYSTEMACCOUNT:</span></span>

```
   $obj = Get-ItemProperty -Path Registry::”HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections"
   Set-ItemProperty -Path Registry::”HKEY_USERS\S-1-5-18\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections" -Name DefaultConnectionSettings -Value $obj.DefaultConnectionSettings
   Set-ItemProperty -Path Registry::”HKEY_USERS\S-1-5-18\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections" -Name SavedLegacySettings -Value $obj.SavedLegacySettings
   $obj = Get-ItemProperty -Path Registry::”HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings"
   Set-ItemProperty -Path Registry::”HKEY_USERS\S-1-5-18\Software\Microsoft\Windows\CurrentVersion\Internet Settings" -Name ProxyEnable -Value $obj.ProxyEnable
   Set-ItemProperty -Path Registry::”HKEY_USERS\S-1-5-18\Software\Microsoft\Windows\CurrentVersion\Internet Settings" -Name Proxyserver -Value $obj.Proxyserver
```

> [!NOTE]
> <span data-ttu-id="53f74-338">Se si nota il messaggio "(407) Autenticazione proxy obbligatoria" nel log del server proxy, verificare che l'autenticazione sia impostata correttamente.</span><span class="sxs-lookup"><span data-stu-id="53f74-338">If you observe "(407) Proxy Authentication Required" in proxy server log, check your authentication is setup correctly.</span></span>
>
>

###### <a name="for-linux-machines"></a><span data-ttu-id="53f74-339">Per macchine Linux</span><span class="sxs-lookup"><span data-stu-id="53f74-339">For Linux machines</span></span>
<span data-ttu-id="53f74-340">Aggiungere la riga seguente al file ```/etc/environment``` :</span><span class="sxs-lookup"><span data-stu-id="53f74-340">Add the following line to the ```/etc/environment``` file:</span></span>

```
http_proxy=http://<proxy IP>:<proxy port>
```

<span data-ttu-id="53f74-341">Aggiungere le righe seguenti al file ```/etc/waagent.conf``` :</span><span class="sxs-lookup"><span data-stu-id="53f74-341">Add the following lines to the ```/etc/waagent.conf``` file:</span></span>

```
HttpProxy.Host=<proxy IP>
HttpProxy.Port=<proxy port>
```

#### <a name="step-2-allow-incoming-connections-on-the-proxy-server"></a><span data-ttu-id="53f74-342">Passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="53f74-342">Step 2.</span></span> <span data-ttu-id="53f74-343">Consentire le connessioni in entrata nel server proxy:</span><span class="sxs-lookup"><span data-stu-id="53f74-343">Allow incoming connections on the proxy server:</span></span>
1. <span data-ttu-id="53f74-344">Aprire Windows Firewall nel server proxy.</span><span class="sxs-lookup"><span data-stu-id="53f74-344">On the proxy server, open Windows Firewall.</span></span> <span data-ttu-id="53f74-345">Il modo più semplice per accedere al firewall consiste nel cercare Windows Firewall con Sicurezza avanzata.</span><span class="sxs-lookup"><span data-stu-id="53f74-345">The easiest way to access the firewall is to search for Windows Firewall with Advanced Security.</span></span>

    ![Aprire il firewall](./media/backup-azure-vms-prepare/firewall-01.png)
2. <span data-ttu-id="53f74-347">Nella finestra di dialogo Windows Firewall fare clic con il pulsante destro del mouse su **Regole in entrata** e scegliere **Nuova regola**.</span><span class="sxs-lookup"><span data-stu-id="53f74-347">In the Windows Firewall dialog, right-click **Inbound Rules** and click **New Rule...**.</span></span>

    ![Creare una nuova regola](./media/backup-azure-vms-prepare/firewall-02.png)
3. <span data-ttu-id="53f74-349">In **Creazione guidata nuova regola connessioni in entrata** scegliere l'opzione **Personalizzata** per **Tipo di regola** e fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="53f74-349">In the **New Inbound Rule Wizard**, choose the **Custom** option for the **Rule Type** and click **Next**.</span></span>
4. <span data-ttu-id="53f74-350">Nella schermata di selezione del **Programma** scegliere **Tutti i programmi** e fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="53f74-350">On the page to select the **Program**, choose **All Programs** and click **Next**.</span></span>
5. <span data-ttu-id="53f74-351">Nella pagina **Protocollo e porte** specificare le informazioni seguenti e fare clic su **Avanti**:</span><span class="sxs-lookup"><span data-stu-id="53f74-351">On the **Protocol and Ports** page, enter the following information and click **Next**:</span></span>

    ![Creare una nuova regola](./media/backup-azure-vms-prepare/firewall-03.png)

   * <span data-ttu-id="53f74-353">Nel campo *Tipo di protocollo* scegliere *TCP*.</span><span class="sxs-lookup"><span data-stu-id="53f74-353">for *Protocol type* choose *TCP*</span></span>
   * <span data-ttu-id="53f74-354">Nel campo *Porta locale* scegliere *Porte specifiche* e nel campo sottostante specificare la ```<Proxy Port>``` configurata.</span><span class="sxs-lookup"><span data-stu-id="53f74-354">for *Local port* choose *Specific Ports*, in the field below specify the ```<Proxy Port>``` that has been configured.</span></span>
   * <span data-ttu-id="53f74-355">Nel campo *Porta remota* selezionare *Tutte le porte*.</span><span class="sxs-lookup"><span data-stu-id="53f74-355">for *Remote port* select *All Ports*</span></span>

     <span data-ttu-id="53f74-356">Completare la procedura guidata facendo clic su Avanti fino al termine e assegnare un nome a questa regola.</span><span class="sxs-lookup"><span data-stu-id="53f74-356">For the rest of the wizard, click all the way to the end and give this rule a name.</span></span>

#### <a name="step-3-add-an-exception-rule-to-the-nsg"></a><span data-ttu-id="53f74-357">Passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="53f74-357">Step 3.</span></span> <span data-ttu-id="53f74-358">Aggiungere una regola di eccezione al gruppo di sicurezza di rete (NSG):</span><span class="sxs-lookup"><span data-stu-id="53f74-358">Add an exception rule to the NSG:</span></span>
<span data-ttu-id="53f74-359">In un prompt dei comandi di Azure PowerShell digitare il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="53f74-359">In an Azure PowerShell command prompt, enter the following command:</span></span>

<span data-ttu-id="53f74-360">Il comando aggiunge un'eccezione per il gruppo di sicurezza di rete (NSG).</span><span class="sxs-lookup"><span data-stu-id="53f74-360">The following command adds an exception to the NSG.</span></span> <span data-ttu-id="53f74-361">Questa eccezione consente il traffico TCP da qualsiasi porta da 10.0.0.5 a qualsiasi indirizzo Internet sulla porta 80 (HTTP) o 443 (HTTPS).</span><span class="sxs-lookup"><span data-stu-id="53f74-361">This exception allows TCP traffic from any port on 10.0.0.5 to any Internet address on port 80 (HTTP) or 443 (HTTPS).</span></span> <span data-ttu-id="53f74-362">Se è necessario usare una porta specifica nell'area Internet pubblica, assicurarsi di aggiungerla anche a ```-DestinationPortRange```.</span><span class="sxs-lookup"><span data-stu-id="53f74-362">If you require a specific port in the public Internet, be sure to add that port to the ```-DestinationPortRange``` as well.</span></span>

```
Get-AzureNetworkSecurityGroup -Name "NSG-lockdown" |
Set-AzureNetworkSecurityRule -Name "allow-proxy " -Action Allow -Protocol TCP -Type Outbound -Priority 200 -SourceAddressPrefix "10.0.0.5/32" -SourcePortRange "*" -DestinationAddressPrefix Internet -DestinationPortRange "80-443"
```


<span data-ttu-id="53f74-363">*Questi passaggi includono nomi e valori di esempio. Usare nomi e valori appropriati alla distribuzione specifica quando si aggiungono, tagliano e incollano i dettagli nel codice.*</span><span class="sxs-lookup"><span data-stu-id="53f74-363">*These steps use specific names and values for this example. Please use the names and values for your deployment when entering, or cutting and pasting details into your code.*</span></span>

<span data-ttu-id="53f74-364">Dopo aver stabilito la connettività di rete, è possibile eseguire il backup di una macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="53f74-364">Now that you know you have network connectivity, you are ready to back up your VM.</span></span> <span data-ttu-id="53f74-365">Vedere [Eseguire il backup di macchine virtuali distribuite con il modello di distribuzione Resource Manager](backup-azure-arm-vms.md).</span><span class="sxs-lookup"><span data-stu-id="53f74-365">See [Back up Resource Manager-deployed VMs](backup-azure-arm-vms.md).</span></span>

## <a name="questions"></a><span data-ttu-id="53f74-366">Domande?</span><span class="sxs-lookup"><span data-stu-id="53f74-366">Questions?</span></span>
<span data-ttu-id="53f74-367">In caso di domande o se si vuole che venga inclusa una funzionalità, è possibile [inviare commenti e suggerimenti](http://aka.ms/azurebackup_feedback).</span><span class="sxs-lookup"><span data-stu-id="53f74-367">If you have questions, or if there is any feature that you would like to see included, [send us feedback](http://aka.ms/azurebackup_feedback).</span></span>

## <a name="next-steps"></a><span data-ttu-id="53f74-368">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="53f74-368">Next steps</span></span>
<span data-ttu-id="53f74-369">Ora che è stato preparato l'ambiente per il backup della VM, il passaggio logico successivo consiste nel creare un backup.</span><span class="sxs-lookup"><span data-stu-id="53f74-369">Now that you have prepared your environment for backing up your VM, your next logical step is to create a backup.</span></span> <span data-ttu-id="53f74-370">L'articolo sulla pianificazione offre informazioni più dettagliate sul backup delle VM.</span><span class="sxs-lookup"><span data-stu-id="53f74-370">The planning article provides more detailed information about backing up VMs.</span></span>

* [<span data-ttu-id="53f74-371">Eseguire il backup di macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="53f74-371">Back up virtual machines</span></span>](backup-azure-vms.md)
* [<span data-ttu-id="53f74-372">Pianificare l'infrastruttura di backup delle VM</span><span class="sxs-lookup"><span data-stu-id="53f74-372">Plan your VM backup infrastructure</span></span>](backup-azure-vms-introduction.md)
* [<span data-ttu-id="53f74-373">Gestire backup di macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="53f74-373">Manage virtual machine backups</span></span>](backup-azure-manage-vms.md)
