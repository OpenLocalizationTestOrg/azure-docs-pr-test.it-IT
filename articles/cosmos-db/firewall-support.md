---
title: Supporto del firewall e controllo dell'accesso agli indirizzi IP per Azure Cosmos DB | Microsoft Docs
description: Informazioni su come usare criteri di controllo di accesso agli indirizzi IP per il supporto del firewall in account del database di Azure Cosmos DB.
keywords: controllo di accesso IP, supporto del firewall
services: cosmos-db
author: shahankur11
manager: jhubbard
editor: 
tags: azure-resource-manager
documentationcenter: 
ms.assetid: c1b9ede0-ed93-411a-ac9a-62c113a8e887
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/22/2017
ms.author: ankshah
ms.openlocfilehash: e08c0ba9c1fc0bab72ae8c1158aafaad4f66920e
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="azure-cosmos-db-firewall-support"></a><span data-ttu-id="5a4ba-104">Supporto del firewall di Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="5a4ba-104">Azure Cosmos DB firewall support</span></span>
<span data-ttu-id="5a4ba-105">Per proteggere i dati archiviati in un account del database di Azure Cosmos DB, Azure Cosmos DB ha reso disponibile il supporto per un [modello di autorizzazione](https://msdn.microsoft.com/library/azure/dn783368.aspx) basato su segreto che usa un codice di autenticazione messaggi basato su hash (HMAC, Hash-based Message Authentication Code).</span><span class="sxs-lookup"><span data-stu-id="5a4ba-105">To secure data stored in an Azure Cosmos DB database account, Azure Cosmos DB has provided support for a secret based [authorization model](https://msdn.microsoft.com/library/azure/dn783368.aspx) that utilizes a strong Hash-based message authentication code (HMAC).</span></span> <span data-ttu-id="5a4ba-106">Oltre al modello di autenticazione basato su segreto, Azure Cosmos DB supporta ora controlli dell'accesso agli indirizzi IP basati su criteri per il supporto del firewall in ingresso.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-106">Now, in addition to the secret based authorization model, Azure Cosmos DB supports policy driven IP-based access controls for inbound firewall support.</span></span> <span data-ttu-id="5a4ba-107">Questo modello è molto simile alle regole del firewall di un sistema di database tradizionale e offre un livello aggiuntivo di sicurezza per l'account del database di Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-107">This model is very similar to the firewall rules of a traditional database system and provides an additional level of security to the Azure Cosmos DB database account.</span></span> <span data-ttu-id="5a4ba-108">Con questo modello è ora possibile configurare un account del database di Azure Cosmos DB perché sia accessibile solo da un set di computer e/o servizi cloud approvato.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-108">With this model, you can now configure an Azure Cosmos DB database account to be accessible only from an approved set of machines and/or cloud services.</span></span> <span data-ttu-id="5a4ba-109">Per l'accesso alle risorse di Azure Cosmos DB da questi set di computer e servizi approvati, è comunque necessario che il chiamante presenti un token di autorizzazione valido.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-109">Access to Azure Cosmos DB resources from these approved sets of machines and services still require the caller to present a valid authorization token.</span></span>

## <a name="ip-access-control-overview"></a><span data-ttu-id="5a4ba-110">Panoramica del controllo di accesso IP</span><span class="sxs-lookup"><span data-stu-id="5a4ba-110">IP access control overview</span></span>
<span data-ttu-id="5a4ba-111">Per impostazione predefinita, un account del database di Azure Cosmos DB è accessibile dalla rete Internet pubblica purché la richiesta sia accompagnata da un token di autorizzazione valido.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-111">By default, an Azure Cosmos DB database account is accessible from public internet as long as the request is accompanied by a valid authorization token.</span></span> <span data-ttu-id="5a4ba-112">Per configurare il controllo di accesso IP basato su criteri, l'utente deve fornire il set di indirizzi IP o di intervalli di indirizzi IP in formato CIDR perché venga incluso come elenco di IP client consentiti per un account del database specificato.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-112">To configure IP policy-based access control, the user must provide the set of IP addresses or IP address ranges in CIDR form to be included as the allowed list of client IPs for a given database account.</span></span> <span data-ttu-id="5a4ba-113">Dopo aver applicato questa configurazione, tutte le richieste provenienti dai computer non inclusi in questo elenco di client IP consentiti verranno bloccati dal server.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-113">Once this configuration is applied, all requests originating from machines outside this allowed list will be blocked by the server.</span></span>  <span data-ttu-id="5a4ba-114">Il flusso di elaborazione della connessione per il controllo di accesso basato su IP viene descritto nel diagramma seguente.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-114">The connection processing flow for the IP-based access control is described in the following diagram.</span></span>

![Diagramma che mostra il processo di connessione per il controllo di accesso basato su IP](./media/firewall-support/firewall-support-flow.png)

## <a name="connections-from-cloud-services"></a><span data-ttu-id="5a4ba-116">Connessioni da servizi cloud</span><span class="sxs-lookup"><span data-stu-id="5a4ba-116">Connections from cloud services</span></span>
<span data-ttu-id="5a4ba-117">In Azure, i servizi cloud sono uno strumento molto comune per ospitare la logica del servizio di livello intermedio con Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-117">In Azure, cloud services are a very common way for hosting middle tier service logic using Azure Cosmos DB.</span></span> <span data-ttu-id="5a4ba-118">Per consentire l'accesso a un account del database di Azure Cosmos DB da un servizio cloud, l'indirizzo IP pubblico del servizio cloud deve essere aggiunto all'elenco di indirizzi IP consentiti associato all'account del database di Azure Cosmos DB [configurando il criterio di controllo dell'accesso agli indirizzi IP](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="5a4ba-118">To enable access to an Azure Cosmos DB database account from a cloud service, the public IP address of the cloud service must be added to the allowed list of IP addresses associated with your Azure Cosmos DB database account by [configuring the IP access control policy](#configure-ip-policy).</span></span>  <span data-ttu-id="5a4ba-119">In questo modo, tutte le istanze del ruolo dei servizi cloud hanno accesso all'account del database di Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-119">This ensures that all role instances of cloud services have access to your Azure Cosmos DB database account.</span></span> <span data-ttu-id="5a4ba-120">È possibile recuperare gli indirizzi IP per i servizi cloud nel portale di Azure, come mostrato nello screenshot seguente.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-120">You can retrieve IP addresses for your cloud services in the Azure portal, as shown in the following screenshot.</span></span>

![Screenshot che mostra l'indirizzo IP pubblico per un servizio cloud visualizzato nel portale di Azure](./media/firewall-support/public-ip-addresses.png)

<span data-ttu-id="5a4ba-122">Quando si aumenta il numero di istanze del servizio cloud aggiungendo altre istanze del ruolo, le nuove istanze hanno automaticamente accesso all'account del database di Azure Cosmos DB perché fanno parte dello stesso servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-122">When you scale out your cloud service by adding additional role instance(s), those new instances will automatically have access to the Azure Cosmos DB database account since they are part of the same cloud service.</span></span>

## <a name="connections-from-virtual-machines"></a><span data-ttu-id="5a4ba-123">Connessioni da macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="5a4ba-123">Connections from virtual machines</span></span>
<span data-ttu-id="5a4ba-124">Per ospitare servizi di livello intermedio con Azure Cosmos DB è possibile usare anche [macchine virtuali](https://azure.microsoft.com/services/virtual-machines/) o [set di scalabilità di macchine virtuali](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md).</span><span class="sxs-lookup"><span data-stu-id="5a4ba-124">[Virtual machines](https://azure.microsoft.com/services/virtual-machines/) or [virtual machine scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) can also be used to host middle tier services using Azure Cosmos DB.</span></span>  <span data-ttu-id="5a4ba-125">Per configurare l'account del database di Azure Cosmos DB in modo da consentire l'accesso da macchine virtuali, gli indirizzi IP pubblici della macchina virtuale e/o del set di scalabilità di macchine virtuali devono essere configurati come uno degli indirizzi IP consentiti per l'account del database di Azure Cosmos DB [configurando il criterio di controllo dell'accesso agli indirizzi IP](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="5a4ba-125">To configure the Azure Cosmos DB database account to allow access from virtual machines, public IP addresses of virtual machine and/or virtual machine scale set must be configured as one of the allowed IP addresses for your Azure Cosmos DB database account by [configuring the IP access control policy](#configure-ip-policy).</span></span> <span data-ttu-id="5a4ba-126">È possibile recuperare gli indirizzi IP per le macchine virtuali nel portale di Azure, come mostrato nello screenshot seguente.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-126">You can retrieve IP addresses for virtual machines in the Azure portal, as shown in the following screenshot.</span></span>

![Screenshot che mostra un indirizzo IP pubblico per una macchina virtuale visualizzata nel portale di Azure](./media/firewall-support/public-ip-addresses-dns.png)

<span data-ttu-id="5a4ba-128">Quando si aggiungono istanze di macchina virtuale al gruppo, a queste viene automaticamente fornito l'accesso all'account del database di Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-128">When you add additional virtual machine instances to the group, they are automatically provided access to your Azure Cosmos DB database account.</span></span>

## <a name="connections-from-the-internet"></a><span data-ttu-id="5a4ba-129">Connessioni da Internet</span><span class="sxs-lookup"><span data-stu-id="5a4ba-129">Connections from the internet</span></span>
<span data-ttu-id="5a4ba-130">Quando si accede a un account del database di Azure Cosmos DB da un computer in Internet, l'indirizzo IP o l'intervallo di indirizzi IP client del computer deve essere aggiunto all'elenco di indirizzi IP consentiti per l'account del database di Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-130">When you access an Azure Cosmos DB database account from a computer on the internet, the client IP address or IP address range of the machine must be added to the allowed list of IP address for the Azure Cosmos DB database account.</span></span> 

## <span data-ttu-id="5a4ba-131"><a id="configure-ip-policy"></a> Configurazione dei criteri di controllo di accesso IP</span><span class="sxs-lookup"><span data-stu-id="5a4ba-131"><a id="configure-ip-policy"></a> Configuring the IP access control policy</span></span>
<span data-ttu-id="5a4ba-132">I criteri di controllo di accesso agli indirizzi IP possono essere configurati nel portale di Azure o a livello di codice tramite l'[interfaccia della riga di comando di Azure](cli-samples.md), [Azure Powershell](powershell-samples.md) o l'[API REST](/rest/api/documentdb/) aggiornando la proprietà `ipRangeFilter`.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-132">The IP access control policy can be set in the Azure portal, or programmatically through [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), or the [REST API](/rest/api/documentdb/) by updating the `ipRangeFilter` property.</span></span> <span data-ttu-id="5a4ba-133">Gli intervalli di indirizzi IP o i singoli indirizzi IP devono essere delimitati da virgole e non devono contenere spazi.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-133">IP addresses/ranges must be comma separated and must not contain any spaces.</span></span> <span data-ttu-id="5a4ba-134">Esempio: "13.91.6.132,13.91.6.1/24".</span><span class="sxs-lookup"><span data-stu-id="5a4ba-134">Example: "13.91.6.132,13.91.6.1/24".</span></span> <span data-ttu-id="5a4ba-135">Quando si aggiornano gli account del database con questi metodi, è necessario assicurarsi di popolare tutte le proprietà per impedire il ripristino delle impostazioni predefinite.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-135">When updating your database account through these methods, be sure to populate all of the properties to prevent resetting to default settings.</span></span>

> [!NOTE]
> <span data-ttu-id="5a4ba-136">Abilitando criteri di controllo dell'accesso agli indirizzi IP per l'account del database di Azure Cosmos DB, qualsiasi accesso all'account del database di Azure Cosmos DB da computer non inclusi nell'elenco degli intervalli di indirizzi IP consentiti viene bloccato.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-136">By enabling an IP access control policy for your Azure Cosmos DB database account, all access to your Azure Cosmos DB database account from machines outside the configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="5a4ba-137">Grazie a questo modello, viene bloccata anche l'esplorazione dell'operazione del piano dati dal portale per garantire l'integrità del controllo di accesso.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-137">By virtue of this model, browsing the data plane operation from the portal will also be blocked to ensure the integrity of access control.</span></span>

<span data-ttu-id="5a4ba-138">Per semplificare lo sviluppo, il portale di Azure consente di identificare e aggiungere l'indirizzo IP del computer client all'elenco di indirizzi consentiti, in modo che le app in esecuzione nella macchina virtuale possano accedere all'account Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-138">To simplify development, the Azure portal helps you identify and add the IP of your client machine to the allowed list, so that apps running your machine can access the Azure Cosmos DB account.</span></span> <span data-ttu-id="5a4ba-139">Si noti che l'indirizzo IP del client viene rilevato in base a quanto visualizzato dal portale.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-139">Note that the client IP address here is detected as seen by the portal.</span></span> <span data-ttu-id="5a4ba-140">Potrebbe trattarsi dell'indirizzo IP del client della macchina virtuale oppure dell'indirizzo IP del gateway di rete.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-140">It may be the client IP address of your machine, but it could also be the IP address of your network gateway.</span></span> <span data-ttu-id="5a4ba-141">Non dimenticare di rimuoverlo prima di passare all'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-141">Do not forget to remove it before going to production.</span></span>

<span data-ttu-id="5a4ba-142">Per configurare i criteri di controllo dell'accesso agli indirizzi IP nel portale di Azure, passare al pannello dell'account Azure Cosmos DB, fare clic su **Firewall** nel menu di navigazione e infine su **SÌ**</span><span class="sxs-lookup"><span data-stu-id="5a4ba-142">To set the IP access control policy in the Azure portal, navigate to the Azure Cosmos DB account blade, click **Firewall** in the navigation menu, then click **ON**</span></span> 

![Screenshot che mostra come aprire il pannello Firewall nel portale di Azure](./media/firewall-support/azure-portal-firewall.png)

<span data-ttu-id="5a4ba-144">Nel nuovo riquadro specificare se il portale di Azure può accedere all'account, quindi aggiungere altri indirizzi e intervalli, in base alla necessità, e infine fare clic su **Salva**.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-144">In the new pane, specify whether the Azure portal can access the account, and add other addresses and ranges as appropriate, then click **Save**.</span></span>  

> [!NOTE]
> <span data-ttu-id="5a4ba-145">Quando si abilitano criteri di controllo di accesso IP, è necessario aggiungere l'indirizzo IP per il portale di Azure per mantenere l'accesso.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-145">When you enable an IP access control policy, you need to add the IP address for the Azure portal to maintain access.</span></span> <span data-ttu-id="5a4ba-146">Gli indirizzi IP del portale sono i seguenti:</span><span class="sxs-lookup"><span data-stu-id="5a4ba-146">The portal IP addresses are:</span></span>
> |<span data-ttu-id="5a4ba-147">Region</span><span class="sxs-lookup"><span data-stu-id="5a4ba-147">Region</span></span>|<span data-ttu-id="5a4ba-148">Indirizzo IP</span><span class="sxs-lookup"><span data-stu-id="5a4ba-148">IP address</span></span>|
> |------|----------|
> |<span data-ttu-id="5a4ba-149">Tutte le aree a eccezione di quelle specificate di seguito</span><span class="sxs-lookup"><span data-stu-id="5a4ba-149">All regions except those specified below</span></span>| <span data-ttu-id="5a4ba-150">104.42.195.92</span><span class="sxs-lookup"><span data-stu-id="5a4ba-150">104.42.195.92</span></span>|
> |<span data-ttu-id="5a4ba-151">Germania</span><span class="sxs-lookup"><span data-stu-id="5a4ba-151">Germany</span></span>|<span data-ttu-id="5a4ba-152">51.4.229.218</span><span class="sxs-lookup"><span data-stu-id="5a4ba-152">51.4.229.218</span></span>|
> |<span data-ttu-id="5a4ba-153">Cina</span><span class="sxs-lookup"><span data-stu-id="5a4ba-153">China</span></span>|<span data-ttu-id="5a4ba-154">139.217.8.252</span><span class="sxs-lookup"><span data-stu-id="5a4ba-154">139.217.8.252</span></span>|
> |<span data-ttu-id="5a4ba-155">Governo degli Stati Uniti - Arizona</span><span class="sxs-lookup"><span data-stu-id="5a4ba-155">US Gov Arizona</span></span>|<span data-ttu-id="5a4ba-156">52.244.48.71</span><span class="sxs-lookup"><span data-stu-id="5a4ba-156">52.244.48.71</span></span>|
>

![Screenshot che mostra come configurare le impostazioni del firewall nel portale di Azure](./media/firewall-support/azure-portal-firewall-configure.png)

## <a name="troubleshooting-the-ip-access-control-policy"></a><span data-ttu-id="5a4ba-158">Risoluzione dei problemi relativi ai criteri di controllo di accesso IP</span><span class="sxs-lookup"><span data-stu-id="5a4ba-158">Troubleshooting the IP access control policy</span></span>
### <a name="portal-operations"></a><span data-ttu-id="5a4ba-159">Operazioni nel portale</span><span class="sxs-lookup"><span data-stu-id="5a4ba-159">Portal operations</span></span>
<span data-ttu-id="5a4ba-160">Abilitando criteri di controllo dell'accesso agli indirizzi IP per l'account del database di Azure Cosmos DB, qualsiasi accesso all'account del database di Azure Cosmos DB da computer non inclusi nell'elenco degli intervalli di indirizzi IP consentiti viene bloccato.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-160">By enabling an IP access control policy for your Azure Cosmos DB database account, all access to your Azure Cosmos DB database account from machines outside the configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="5a4ba-161">Se si vogliono abilitare operazioni sul piano dati del portale, ad esempio l'esplorazione di raccolte e le query nei documenti, è quindi necessario consentire esplicitamente l'accesso al portale di Azure usando il pannello **Firewall** nel portale.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-161">Therefore if you want to enable portal data plane operations like browsing collections and query documents, you need to explicitly allow Azure portal access using the **Firewall** blade in the portal.</span></span> 

![Screenshot che mostra come abilitare l'accesso al portale di Azure](./media/firewall-support/azure-portal-access-firewall.png)

### <a name="sdk--rest-api"></a><span data-ttu-id="5a4ba-163">SDK e API REST</span><span class="sxs-lookup"><span data-stu-id="5a4ba-163">SDK & Rest API</span></span>
<span data-ttu-id="5a4ba-164">Per motivi di sicurezza, l'accesso tramite SDK o API REST da computer non inclusi nell'elenco degli indirizzi IP consentiti restituisce una risposta generica 404 Non trovato senza altri dettagli.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-164">For security reasons, access via SDK or REST API from machines not on the allowed list will return a generic 404 Not Found response with no additional details.</span></span> <span data-ttu-id="5a4ba-165">Controllare l'elenco degli indirizzi IP consentiti per l'account del database di Azure Cosmos DB per verificare che all'account sia applicata la configurazione dei criteri corretta.</span><span class="sxs-lookup"><span data-stu-id="5a4ba-165">Please verify the IP allowed list configured for your Azure Cosmos DB database account to ensure the correct policy configuration is applied to your Azure Cosmos DB database account.</span></span>

## <a name="next-steps"></a><span data-ttu-id="5a4ba-166">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="5a4ba-166">Next steps</span></span>
<span data-ttu-id="5a4ba-167">Per suggerimenti relativi alle prestazioni di rete, vedere [Suggerimenti sulle prestazioni per DocumentDB](performance-tips.md).</span><span class="sxs-lookup"><span data-stu-id="5a4ba-167">For information about network related performance tips, see [Performance tips](performance-tips.md).</span></span>

