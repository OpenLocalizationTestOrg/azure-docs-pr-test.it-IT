---
title: Replicare le macchine virtuali Hyper-V in Azure nel portale classico | Documentazione Microsoft
description: Questo articolo descrive come eseguire la replica di macchine virtuali Hyper-V in Azure quando le macchine non sono gestite in cloud VMM.
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: 
ms.assetid: 3f4c4483-e3dd-495a-bd02-c16e9e28c88d
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 02/21/2017
ms.author: raynew
ms.openlocfilehash: 438f32ee3605e2dd0c46de7993a359cc269262fe
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/29/2017
---
# <a name="replicate-between-on-premises-hyper-v-virtual-machines-and-azure-without-vmm-with-azure-site-recovery"></a><span data-ttu-id="30ed4-103">Replica tra macchine virtuali Hyper-V locali e Azure (senza VMM) con Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="30ed4-103">Replicate between on-premises Hyper-V virtual machines and Azure (without VMM) with Azure Site Recovery</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="30ed4-104">Portale di Azure</span><span class="sxs-lookup"><span data-stu-id="30ed4-104">Azure Portal</span></span>](site-recovery-hyper-v-site-to-azure.md)
> * [<span data-ttu-id="30ed4-105">PowerShell - Gestione risorse</span><span class="sxs-lookup"><span data-stu-id="30ed4-105">PowerShell - Resource Manager</span></span>](site-recovery-deploy-with-powershell-resource-manager.md)
> * [<span data-ttu-id="30ed4-106">Portale classico</span><span class="sxs-lookup"><span data-stu-id="30ed4-106">Classic Portal</span></span>](site-recovery-hyper-v-site-to-azure-classic.md)
>
>

<span data-ttu-id="30ed4-107">Questo articolo illustra come replicare macchine virtuali Hyper-V locali in Azure usando il servizio [Azure Site Recovery](site-recovery-overview.md) nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="30ed4-107">This article describes how to replicate on-premises Hyper-V virtual machines to Azure, using the [Azure Site Recovery](site-recovery-overview.md) service, in the Azure portal.</span></span> <span data-ttu-id="30ed4-108">In questo scenario, i server Hyper-V non sono gestiti in cloud VMM.</span><span class="sxs-lookup"><span data-stu-id="30ed4-108">In this scenario, Hyper-V servers are not managed in VMM clouds.</span></span>

<span data-ttu-id="30ed4-109">Dopo la lettura di questo articolo, è possibile inserire commenti nella parte inferiore oppure porre domande tecniche nel [forum sui servizi di ripristino di Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="30ed4-109">After reading this article, post any comments at the bottom, or ask technical questions on the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="site-recovery-in-the-azure-portal"></a><span data-ttu-id="30ed4-110">Site Recovery nel portale di Azure</span><span class="sxs-lookup"><span data-stu-id="30ed4-110">Site Recovery in the Azure portal</span></span>

<span data-ttu-id="30ed4-111">Azure offre due [modelli di distribuzione](../resource-manager-deployment-model.md) diversi per creare e usare le risorse: Azure Resource Manager e distribuzione classica.</span><span class="sxs-lookup"><span data-stu-id="30ed4-111">Azure has two different [deployment models](../resource-manager-deployment-model.md) for creating and working with resources – Azure Resource Manager and classic.</span></span> <span data-ttu-id="30ed4-112">Sono disponibili due portali: il portale di Azure classico e il portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="30ed4-112">Azure also has two portals – the Azure classic portal, and the Azure portal.</span></span>

<span data-ttu-id="30ed4-113">Questo articolo descrive come eseguire la distribuzione nel portale classico.</span><span class="sxs-lookup"><span data-stu-id="30ed4-113">This article describes how to deploy in the classic portal.</span></span> <span data-ttu-id="30ed4-114">Il portale classico può essere usato per gestire gli insiemi di credenziali esistenti.</span><span class="sxs-lookup"><span data-stu-id="30ed4-114">The classic portal can be used to maintain existing vaults.</span></span> <span data-ttu-id="30ed4-115">Non è possibile creare nuovi insieme di credenziali usando il portale classico.</span><span class="sxs-lookup"><span data-stu-id="30ed4-115">You can't create new vaults using the classic portal.</span></span>

## <a name="site-recovery-in-your-business"></a><span data-ttu-id="30ed4-116">Site Recovery in azienda</span><span class="sxs-lookup"><span data-stu-id="30ed4-116">Site Recovery in your business</span></span>

<span data-ttu-id="30ed4-117">Le organizzazioni necessitano di una strategia di continuità aziendale e ripristino di emergenza per determinare come app e dati possano rimanere in esecuzione e disponibili durante i periodi di inattività, pianificati o meno, e come ripristinare le normali condizioni di lavoro il prima possibile.</span><span class="sxs-lookup"><span data-stu-id="30ed4-117">Organizations need a BCDR strategy that determines how apps and data stay running and available during planned and unplanned downtime, and recover to normal working conditions as soon as possible.</span></span> <span data-ttu-id="30ed4-118">Ecco quali vantaggi offre Site Recovery:</span><span class="sxs-lookup"><span data-stu-id="30ed4-118">Here's what Site Recovery can do:</span></span>

* <span data-ttu-id="30ed4-119">Protezione esterna per le app aziendali in esecuzione su VM Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="30ed4-119">Offsite protection for business apps running on Hyper-V VMs.</span></span>
* <span data-ttu-id="30ed4-120">Un'unica posizione per l'impostazione, la gestione e il monitoraggio di replica, failover e ripristino.</span><span class="sxs-lookup"><span data-stu-id="30ed4-120">A single location to set up, manage, and monitor replication, failover, and recovery.</span></span>
* <span data-ttu-id="30ed4-121">Semplicità delle operazioni di failover in Azure e di failback (ripristino) da Azure ai server host Hyper-V nel sito locale.</span><span class="sxs-lookup"><span data-stu-id="30ed4-121">Simple failover to Azure, and failback (restore) from Azure to Hyper-V host servers in your on-premises site.</span></span>
* <span data-ttu-id="30ed4-122">Piani di ripristino con più VM per fare in modo che il failover dei carichi di lavoro delle applicazioni a più livelli venga eseguito contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="30ed4-122">Recovery plans that include multiple VMs, so that tiered application workloads fail over together.</span></span>

## <a name="azure-prerequisites"></a><span data-ttu-id="30ed4-123">Prerequisiti di Azure</span><span class="sxs-lookup"><span data-stu-id="30ed4-123">Azure prerequisites</span></span>
* <span data-ttu-id="30ed4-124">È necessario un account [Microsoft Azure](https://azure.microsoft.com/) .</span><span class="sxs-lookup"><span data-stu-id="30ed4-124">You need a [Microsoft Azure](https://azure.microsoft.com/) account.</span></span> <span data-ttu-id="30ed4-125">È possibile iniziare con una [versione di valutazione gratuita](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="30ed4-125">You can start with a [free trial](https://azure.microsoft.com/pricing/free-trial/).</span></span>
* <span data-ttu-id="30ed4-126">Per archiviare i dati replicati è necessario un account di archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="30ed4-126">You need an Azure storage account to store replicated data.</span></span> <span data-ttu-id="30ed4-127">Nell'account deve essere abilitata la replica geografica.</span><span class="sxs-lookup"><span data-stu-id="30ed4-127">The account needs geo-replication enabled.</span></span> <span data-ttu-id="30ed4-128">Dovrà trovarsi nella stessa area dell'insieme di credenziali di Azure Site Recovery ed essere associato alla stessa sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="30ed4-128">It should be in the same region as the Azure Site Recovery vault and be associated with the same subscription.</span></span> <span data-ttu-id="30ed4-129">[Altre informazioni sull'Archiviazione di Azure](../storage/common/storage-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="30ed4-129">[Learn more about Azure storage](../storage/common/storage-introduction.md).</span></span> <span data-ttu-id="30ed4-130">Si noti che lo spostamento degli account di archiviazione creati con il [nuovo portale di Azure](../storage/common/storage-create-storage-account.md) tra gruppi di risorse non è supportato.</span><span class="sxs-lookup"><span data-stu-id="30ed4-130">Note that we don't support moving storage accounts created using the [new Azure portal](../storage/common/storage-create-storage-account.md) across resource groups.</span></span>
* <span data-ttu-id="30ed4-131">È necessaria una rete virtuale di Azure in modo che le macchine virtuali di Azure siano connesse a una rete quando si esegue il failover dal sito primario.</span><span class="sxs-lookup"><span data-stu-id="30ed4-131">You'll need an Azure virtual network so that Azure virtual machines will be connected to a network when you fail over from your primary site.</span></span>

## <a name="hyper-v-prerequisites"></a><span data-ttu-id="30ed4-132">Prerequisiti di Hyper-V</span><span class="sxs-lookup"><span data-stu-id="30ed4-132">Hyper-V prerequisites</span></span>
* <span data-ttu-id="30ed4-133">Nel sito locale di origine sono necessari uno o più server che eseguono **Windows Server 2012 R2** e in cui sia installato il ruolo di Hyper-V o **Microsoft Hyper-V Server 2012 R2**.</span><span class="sxs-lookup"><span data-stu-id="30ed4-133">In the source on-premises site you'll need one or more servers running **Windows Server 2012 R2** with the Hyper-V role installed or **Microsoft Hyper-V Server 2012 R2**.</span></span> <span data-ttu-id="30ed4-134">Questo server deve:</span><span class="sxs-lookup"><span data-stu-id="30ed4-134">This server should:</span></span>
* <span data-ttu-id="30ed4-135">Contenere una o più macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="30ed4-135">Contain one or more virtual machines.</span></span>
* <span data-ttu-id="30ed4-136">Essere connesso a Internet, in modo diretto o tramite proxy.</span><span class="sxs-lookup"><span data-stu-id="30ed4-136">Be connected to the Internet, either directly or via a proxy.</span></span>
* <span data-ttu-id="30ed4-137">Eseguire le correzioni descritte nell'articolo [2961977](https://support.microsoft.com/en-us/kb/2961977 "KB2961977").</span><span class="sxs-lookup"><span data-stu-id="30ed4-137">Be running the fixes described in KB [2961977](https://support.microsoft.com/en-us/kb/2961977 "KB2961977").</span></span>

## <a name="virtual-machine-prerequisites"></a><span data-ttu-id="30ed4-138">Prerequisiti delle macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="30ed4-138">Virtual machine prerequisites</span></span>
<span data-ttu-id="30ed4-139">Le macchine virtuali da proteggere devono essere conformi ai [Requisiti delle macchine virtuali di Azure](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).</span><span class="sxs-lookup"><span data-stu-id="30ed4-139">Virtual machines you want to protect should conform with [Azure virtual machine requirements](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).</span></span>

## <a name="provider-and-agent-prerequisites"></a><span data-ttu-id="30ed4-140">Prerequisiti di provider e agente</span><span class="sxs-lookup"><span data-stu-id="30ed4-140">Provider and agent prerequisites</span></span>
<span data-ttu-id="30ed4-141">Durante la distribuzione di Azure Site Recovery verranno installati il provider di Azure Site Recovery e l'agente Servizi di ripristino di Azure in ogni server Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="30ed4-141">As part of Azure Site Recovery deployment you’ll install the Azure Site Recovery Provider and the Azure Recovery Services Agent on each Hyper-V server.</span></span> <span data-ttu-id="30ed4-142">Si noti che:</span><span class="sxs-lookup"><span data-stu-id="30ed4-142">Note that:</span></span>

* <span data-ttu-id="30ed4-143">È consigliabile eseguire sempre le versioni più recenti del provider e dell'agente,</span><span class="sxs-lookup"><span data-stu-id="30ed4-143">We recommend you always run the latest versions of the Provider and agent.</span></span> <span data-ttu-id="30ed4-144">disponibili nel portale di Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="30ed4-144">These are available in the Site Recovery portal.</span></span>
* <span data-ttu-id="30ed4-145">Tutti i server Hyper-V di un insieme devono essere della stessa versione del provider e dell'agente.</span><span class="sxs-lookup"><span data-stu-id="30ed4-145">All Hyper-V servers in a vault should have the same versions of the Provider and agent.</span></span>
* <span data-ttu-id="30ed4-146">Il provider in esecuzione nel server si connette a Site Recovery via Internet.</span><span class="sxs-lookup"><span data-stu-id="30ed4-146">The Provider running on the server connects to Site Recovery over the internet.</span></span> <span data-ttu-id="30ed4-147">È possibile eseguire questa operazione senza un proxy, con le impostazioni proxy attualmente configurate nel server Hyper-V oppure con le impostazioni proxy personalizzate configurate durante l'installazione del provider.</span><span class="sxs-lookup"><span data-stu-id="30ed4-147">You can do this without a proxy, with the proxy settings currently configured on the Hyper-V server, or with custom proxy settings that you configure during Provider installation.</span></span> <span data-ttu-id="30ed4-148">Assicurarsi che il server proxy da usare possa accedere a questi URL per la connessione ad Azure:</span><span class="sxs-lookup"><span data-stu-id="30ed4-148">You'll need to make sure that the proxy server you want to use can access these the URLs for connecting to Azure:</span></span>

  * <span data-ttu-id="30ed4-149">*.accesscontrol.windows.net</span><span class="sxs-lookup"><span data-stu-id="30ed4-149">*.accesscontrol.windows.net</span></span>
  * <span data-ttu-id="30ed4-150">*.backup.windowsazure.com</span><span class="sxs-lookup"><span data-stu-id="30ed4-150">*.backup.windowsazure.com</span></span>
  * <span data-ttu-id="30ed4-151">*.hypervrecoverymanager.windowsazure.com</span><span class="sxs-lookup"><span data-stu-id="30ed4-151">*.hypervrecoverymanager.windowsazure.com</span></span>
  * <span data-ttu-id="30ed4-152">*. store.core.windows.net</span><span class="sxs-lookup"><span data-stu-id="30ed4-152">*.store.core.windows.net</span></span>      
  * <span data-ttu-id="30ed4-153">*.blob.core.windows.net</span><span class="sxs-lookup"><span data-stu-id="30ed4-153">*.blob.core.windows.net</span></span>
  - <span data-ttu-id="30ed4-154">https://www.msftncsi.com/ncsi.txt</span><span class="sxs-lookup"><span data-stu-id="30ed4-154">https://www.msftncsi.com/ncsi.txt</span></span>
  - <span data-ttu-id="30ed4-155">time.windows.com</span><span class="sxs-lookup"><span data-stu-id="30ed4-155">time.windows.com</span></span>
  - <span data-ttu-id="30ed4-156">time.nist.gov</span><span class="sxs-lookup"><span data-stu-id="30ed4-156">time.nist.gov</span></span>
* <span data-ttu-id="30ed4-157">Consentire anche gli indirizzi IP descritti in [Azure Datacenter IP Ranges](https://www.microsoft.com/download/details.aspx?id=41653) e il protocollo HTTPS (443).</span><span class="sxs-lookup"><span data-stu-id="30ed4-157">In addition allow the IP addresses described in [Azure Datacenter IP Ranges](https://www.microsoft.com/download/details.aspx?id=41653) and HTTPS (443) protocol.</span></span> <span data-ttu-id="30ed4-158">È necessario consentire gli intervalli IP dell'area di Azure che si intende usare e quello degli Stati Uniti occidentali.</span><span class="sxs-lookup"><span data-stu-id="30ed4-158">You have to allow the IP ranges of the Azure region that you plan to use and that of West US.</span></span>

<span data-ttu-id="30ed4-159">Questa immagine illustra i diversi canali e le porte di comunicazione usati da Site Recovery per la replica e l'orchestrazione</span><span class="sxs-lookup"><span data-stu-id="30ed4-159">This graphic shows the different communication channels and ports used by Site Recovery for orchestration and replication</span></span>

![Topologia B2A](./media/site-recovery-hyper-v-site-to-azure-classic/b2a-topology.png)

## <a name="step-1-create-a-vault"></a><span data-ttu-id="30ed4-161">Passaggio 1: Creare un insieme di credenziali</span><span class="sxs-lookup"><span data-stu-id="30ed4-161">Step 1: Create a vault</span></span>
1. <span data-ttu-id="30ed4-162">Accedere al [portale di gestione](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="30ed4-162">Sign in to the [Management Portal](https://portal.azure.com).</span></span>
2. <span data-ttu-id="30ed4-163">Espandere **Servizi dati** > **Servizi di ripristino** e fare clic su **Insieme di credenziali di Site Recovery**.</span><span class="sxs-lookup"><span data-stu-id="30ed4-163">Expand **Data Services** > **Recovery Services** and click **Site Recovery Vault**.</span></span>
3. <span data-ttu-id="30ed4-164">Fare clic su **Creare nuovo** > **Creazione rapida**.</span><span class="sxs-lookup"><span data-stu-id="30ed4-164">Click **Create New** > **Quick Create**.</span></span>
4. <span data-ttu-id="30ed4-165">In **Nome**immettere un nome descrittivo per identificare l'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="30ed4-165">In **Name**, enter a friendly name to identify the vault.</span></span>
5. <span data-ttu-id="30ed4-166">In **Region**selezionare l'area geografica per l'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="30ed4-166">In **Region**, select the geographic region for the vault.</span></span> <span data-ttu-id="30ed4-167">Per verificare le aree geografiche supportate, vedere la sezione Disponibilità a livello geografico in [Prezzi di Azure Site Recovery](https://azure.microsoft.com/pricing/details/site-recovery/).</span><span class="sxs-lookup"><span data-stu-id="30ed4-167">To check supported regions see Geographic Availability in [Azure Site Recovery Pricing Details](https://azure.microsoft.com/pricing/details/site-recovery/).</span></span>
6. <span data-ttu-id="30ed4-168">Fare clic su **Create vault**.</span><span class="sxs-lookup"><span data-stu-id="30ed4-168">Click **Create vault**.</span></span>

    ![Nuovo insieme di credenziali](./media/site-recovery-hyper-v-site-to-azure-classic/vault.png)

<span data-ttu-id="30ed4-170">Controllare la barra di stato per verificare che l'insieme di credenziali sia stato creato correttamente.</span><span class="sxs-lookup"><span data-stu-id="30ed4-170">Check the status bar to confirm that the vault was successfully created.</span></span> <span data-ttu-id="30ed4-171">L'insieme di credenziali verrà elencato come **Attivo** nella pagina principale di Servizi di ripristino.</span><span class="sxs-lookup"><span data-stu-id="30ed4-171">The vault will be listed as **Active** on the main Recovery Services page.</span></span>

## <a name="step-2-create-a-hyper-v-site"></a><span data-ttu-id="30ed4-172">Passaggio 2: Creare un sito Hyper-V</span><span class="sxs-lookup"><span data-stu-id="30ed4-172">Step 2: Create a Hyper-V site</span></span>
1. <span data-ttu-id="30ed4-173">Nella pagina Servizi di ripristino fare clic sull'insieme di credenziali per aprire la pagina Avvio rapido.</span><span class="sxs-lookup"><span data-stu-id="30ed4-173">In the Recovery Services page, click the vault to open the Quick Start page.</span></span> <span data-ttu-id="30ed4-174">La pagina Avvio rapido può anche essere aperta in qualsiasi momento tramite l'icona.</span><span class="sxs-lookup"><span data-stu-id="30ed4-174">Quick Start can also be opened at any time using the icon.</span></span>

    ![Avvio rapido](./media/site-recovery-hyper-v-site-to-azure-classic/quick-start-icon.png)
2. <span data-ttu-id="30ed4-176">Dall'elenco a discesa selezionare **Tra un sito Hyper-V locale e Azure**.</span><span class="sxs-lookup"><span data-stu-id="30ed4-176">In the dropdown list, select **Between an on-premises Hyper-V site and Azure**.</span></span>

    ![Scenario del sito di Hyper-V](./media/site-recovery-hyper-v-site-to-azure-classic/select-scenario.png)
3. <span data-ttu-id="30ed4-178">In **Crea un sito Hyper-V** fare clic su **Crea sito Hyper-V**.</span><span class="sxs-lookup"><span data-stu-id="30ed4-178">In **Create a Hyper-V Site** click **Create Hyper-V site**.</span></span> <span data-ttu-id="30ed4-179">Specificare un nome per il sito e salvare.</span><span class="sxs-lookup"><span data-stu-id="30ed4-179">Specify a site name and save.</span></span>

    ![Sito di Hyper-V](./media/site-recovery-hyper-v-site-to-azure-classic/create-site.png)

## <a name="step-3-install-the-provider-and-agent"></a><span data-ttu-id="30ed4-181">Passaggio 3: Installare Provider e agente</span><span class="sxs-lookup"><span data-stu-id="30ed4-181">Step 3: Install the Provider and agent</span></span>
<span data-ttu-id="30ed4-182">Installare il provider e l'agente in ogni server Hyper-V che include macchine virtuali da proteggere.</span><span class="sxs-lookup"><span data-stu-id="30ed4-182">Install the Provider and agent on each Hyper-V server that has VMs you want to protect.</span></span>

<span data-ttu-id="30ed4-183">Se si desidera eseguire l’installazione in un cluster Hyper-V, eseguire i passaggi da 5 a 11 in ogni nodo del cluster di failover.</span><span class="sxs-lookup"><span data-stu-id="30ed4-183">If you're installing on a Hyper-V cluster, performs steps 5-11 on each node in the failover cluster.</span></span> <span data-ttu-id="30ed4-184">Dopo aver registrato tutti i nodi e aver abilitato la protezione, le macchine virtuali saranno protette anche se migrano tra i nodi del cluster.</span><span class="sxs-lookup"><span data-stu-id="30ed4-184">After all nodes are registered and protection is enabled, virtual machines will be protected even if they migrate across nodes in the cluster.</span></span>

1. <span data-ttu-id="30ed4-185">In **Prepara server Hyper-V** fare clic sul file **Scaricare una chiave di registrazione**.</span><span class="sxs-lookup"><span data-stu-id="30ed4-185">In **Prepare Hyper-V servers**, click **Download a registration key** file.</span></span>
2. <span data-ttu-id="30ed4-186">Nella pagina **Scarica chiave di registrazione** fare clic su **Scarica** accanto al nome del sito.</span><span class="sxs-lookup"><span data-stu-id="30ed4-186">On the **Download Registration Key** page, click **Download** next to the site.</span></span> <span data-ttu-id="30ed4-187">Scaricare il codice in un percorso sicuro a cui sia possibile accedere facilmente tramite il server Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="30ed4-187">Download the key to a safe location that can be easily accessed by the Hyper-V server.</span></span> <span data-ttu-id="30ed4-188">Il codice è valido per 5 giorni dal momento in cui viene generato.</span><span class="sxs-lookup"><span data-stu-id="30ed4-188">The key is valid for 5 days after it's generated.</span></span>

    ![Registration key](./media/site-recovery-hyper-v-site-to-azure-classic/download-key.png)
3. <span data-ttu-id="30ed4-190">Fare clic su **Scaricare il Provider** per ottenere la versione più recente.</span><span class="sxs-lookup"><span data-stu-id="30ed4-190">Click **Download the Provider** to obtain the latest version.</span></span>
4. <span data-ttu-id="30ed4-191">Eseguire il file su ciascun server Hyper-V da registrare nell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="30ed4-191">Run the file on each Hyper-V server you want to register in the vault.</span></span> <span data-ttu-id="30ed4-192">Il file installa due componenti:</span><span class="sxs-lookup"><span data-stu-id="30ed4-192">The file installs two components:</span></span>
   * <span data-ttu-id="30ed4-193">**Provider di Azure Site Recovery**: gestisce le comunicazioni e l’orchestrazione tra il server Hyper-V e il portale di Azure Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="30ed4-193">**Azure Site Recovery Provider**—Handles communication and orchestration between the Hyper-V server and the Azure Site Recovery portal.</span></span>
   * <span data-ttu-id="30ed4-194">**Agente di Servizi di ripristino di Azure**: gestisce il trasferimento dei dati tra le macchine virtuali in esecuzione sul server Hyper-V di origine e l'archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="30ed4-194">**Azure Recovery Services Agent**—Handles data transport between virtual machines running on the source Hyper-V server and Azure storage.</span></span>
5. <span data-ttu-id="30ed4-195">In **Microsoft Update** è possibile fornire il consenso esplicito agli aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="30ed4-195">In **Microsoft Update** you can opt in for updates.</span></span> <span data-ttu-id="30ed4-196">Se questa impostazione è abilitata, gli aggiornamenti del provider e dell'agente verranno installati in base ai criteri indicati in Microsoft Update.</span><span class="sxs-lookup"><span data-stu-id="30ed4-196">With this setting enabled, Provider and Agent updates will be installed according to your Microsoft Update policy.</span></span>

    ![Microsoft Updates](./media/site-recovery-hyper-v-site-to-azure-classic/provider1.png)
6. <span data-ttu-id="30ed4-198">In **Installazione** specificare la posizione di installazione di Provider e agente nel server Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="30ed4-198">In **Installation** specify where you want to install the Provider and Agent on the Hyper-V server.</span></span>

    ![Posizione di installazione](./media/site-recovery-hyper-v-site-to-azure-classic/provider2.png)
7. <span data-ttu-id="30ed4-200">Al termine dell'installazione, proseguire con la configurazione per registrare il server nell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="30ed4-200">After installation is complete continue setup to register the server in the vault.</span></span>
8. <span data-ttu-id="30ed4-201">Nella pagina **Impostazioni insieme di credenziali** fare clic su **Sfoglia** per selezionare il file di chiave.</span><span class="sxs-lookup"><span data-stu-id="30ed4-201">On the **Vault Settings** page, click **Browse** to select the key file.</span></span> <span data-ttu-id="30ed4-202">Specificare la sottoscrizione di Azure Site Recovery, il nome dell'insieme di credenziali e il sito Hyper-V a cui appartiene il server Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="30ed4-202">Specify the Azure Site Recovery subscription, the vault name, and the Hyper-V site to which the Hyper-V server belongs.</span></span>

    ![Server registration](./media/site-recovery-hyper-v-site-to-azure-classic/provider8.PNG)
9. <span data-ttu-id="30ed4-204">Nella pagina **Connessione Internet** specificare la modalità di connessione tra Provider e Azure Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="30ed4-204">On the **Internet Connection** page you specify how the Provider connects to Azure Site Recovery.</span></span> <span data-ttu-id="30ed4-205">Selezionare **Usa impostazioni proxy del sistema predefinite** per usare le impostazioni di connessione a Internet predefinite configurate nel server.</span><span class="sxs-lookup"><span data-stu-id="30ed4-205">Select **Use default system proxy settings** to use the default Internet connection settings configured on the server.</span></span> <span data-ttu-id="30ed4-206">Se non si specifica un valore, verranno utilizzate le impostazioni predefinite.</span><span class="sxs-lookup"><span data-stu-id="30ed4-206">If you don't specify a value the default settings will be used.</span></span>

   ![Internet Settings](./media/site-recovery-hyper-v-site-to-azure-classic/provider7.PNG)
10. <span data-ttu-id="30ed4-208">La procedura di registrazione ha inizio e il server viene registrato nell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="30ed4-208">Registration starts to register the server in the vault.</span></span>

    ![Server registration](./media/site-recovery-hyper-v-site-to-azure-classic/provider15.PNG)
11. <span data-ttu-id="30ed4-210">Al termine della registrazione, i metadati del server Hyper-V vengono recuperati da Azure Site Recovery e il server viene visualizzato nella scheda **Siti Hyper-V** della pagina **Server** all'interno dell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="30ed4-210">After registration finishes metadata from the Hyper-V server is retrieved by Azure Site Recovery and the server is displayed on the **Hyper-V Sites** tab on the **Servers** page in the vault.</span></span>

### <a name="install-the-provider-from-the-command-line"></a><span data-ttu-id="30ed4-211">Installare il provider dalla riga di comando</span><span class="sxs-lookup"><span data-stu-id="30ed4-211">Install the Provider from the command line</span></span>
<span data-ttu-id="30ed4-212">In alternativa è possibile installare il provider di Azure Site Recovery dalla riga di comando.</span><span class="sxs-lookup"><span data-stu-id="30ed4-212">As an alternative you can install the Azure Site Recovery Provider from the command line.</span></span> <span data-ttu-id="30ed4-213">Usare questo metodo per installare il provider in un computer che esegue Windows Server Core 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="30ed4-213">You should use this method if you want to install the Provider on a computer running Windows Server Core 2012 R2.</span></span> <span data-ttu-id="30ed4-214">Eseguire dalla riga di comando procedendo come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="30ed4-214">Run from the command line as follows:</span></span>

1. <span data-ttu-id="30ed4-215">Scaricare il file di installazione del provider e il codice di registrazione in una cartella,</span><span class="sxs-lookup"><span data-stu-id="30ed4-215">Download the Provider installation file and registration key to a folder.</span></span> <span data-ttu-id="30ed4-216">ad esempio C:\ASR.</span><span class="sxs-lookup"><span data-stu-id="30ed4-216">For example C:\ASR.</span></span>
2. <span data-ttu-id="30ed4-217">Eseguire il prompt dei comandi come amministratore e digitare:</span><span class="sxs-lookup"><span data-stu-id="30ed4-217">Run a command prompt as an Administrator and type:</span></span>

        C:\Windows\System32> CD C:\ASR
        C:\ASR> AzureSiteRecoveryProvider.exe /x:. /q
3. <span data-ttu-id="30ed4-218">Installare quindi il provider eseguendo:</span><span class="sxs-lookup"><span data-stu-id="30ed4-218">Then install the Provider by running:</span></span>

        C:\ASR> setupdr.exe /i
4. <span data-ttu-id="30ed4-219">Eseguire questo comando per completare la registrazione:</span><span class="sxs-lookup"><span data-stu-id="30ed4-219">Run the following to complete registration:</span></span>

        CD C:\Program Files\Microsoft Azure Site Recovery Provider
        C:\Program Files\Microsoft Azure Site Recovery Provider\> DRConfigurator.exe /r  /Friendlyname <friendly name of the server> /Credentials <path of the credentials file> /EncryptionEnabled <full file name to save the encryption certificate>         

<span data-ttu-id="30ed4-220">I parametri includono:</span><span class="sxs-lookup"><span data-stu-id="30ed4-220">Where parameters include:</span></span>

* <span data-ttu-id="30ed4-221">**/Credentials**: specificare il percorso della chiave di registrazione scaricata.</span><span class="sxs-lookup"><span data-stu-id="30ed4-221">**/Credentials**: Specify the location of the registration key you downloaded.</span></span>
* <span data-ttu-id="30ed4-222">**/FriendlyName**: specificare un nome per identificare il server host Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="30ed4-222">**/FriendlyName**: Specify a name to identify the Hyper-V host server.</span></span> <span data-ttu-id="30ed4-223">Questo nome verrà visualizzato nel portale.</span><span class="sxs-lookup"><span data-stu-id="30ed4-223">This name will appear in the portal</span></span>
* <span data-ttu-id="30ed4-224">**/EncryptionEnabled**: facoltativo.</span><span class="sxs-lookup"><span data-stu-id="30ed4-224">**/EncryptionEnabled**: Optional.</span></span> <span data-ttu-id="30ed4-225">Specificare se devono essere crittografate le macchine virtuali di replica in Azure (crittografia dei dati inattivi).</span><span class="sxs-lookup"><span data-stu-id="30ed4-225">Specify whether you want to encrypt replica virtual machines in Azure (at rest encryption).</span></span>
* <span data-ttu-id="30ed4-226">**/proxyAddress**; **/proxyport**; **/proxyUsername**; **/proxyPassword**: facoltativo.</span><span class="sxs-lookup"><span data-stu-id="30ed4-226">**/proxyAddress**; **/proxyport**; **/proxyUsername**; **/proxyPassword**: Optional.</span></span> <span data-ttu-id="30ed4-227">Se si vuole usare un proxy personalizzato o se il proxy esistente richiede l'autenticazione, specificare i parametri del proxy.</span><span class="sxs-lookup"><span data-stu-id="30ed4-227">Specify proxy parameters if you want to use a custom proxy, or your existing proxy requires authentication.</span></span>

## <a name="step-4-create-an-azure-storage-account"></a><span data-ttu-id="30ed4-228">Passaggio 4: Creare un account di archiviazione di Azure</span><span class="sxs-lookup"><span data-stu-id="30ed4-228">Step 4: Create an Azure storage account</span></span>
* <span data-ttu-id="30ed4-229">Nella pagina **Prepara risorse** selezionare **Crea account di archiviazione** per creare un account di archiviazione di Azure, se non ne è ancora stato creato uno.</span><span class="sxs-lookup"><span data-stu-id="30ed4-229">In **Prepare resources** select **Create Storage Account**  to create an Azure storage account if you don't have one.</span></span> <span data-ttu-id="30ed4-230">Nell'account deve essere abilitata la replica geografica.</span><span class="sxs-lookup"><span data-stu-id="30ed4-230">The account should have geo-replication enabled.</span></span> <span data-ttu-id="30ed4-231">Dovrà trovarsi nella stessa area dell'insieme di credenziali di Azure Site Recovery ed essere associato alla stessa sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="30ed4-231">It should be in the same region as the Azure Site Recovery vault, and be associated with the same subscription.</span></span>

    ![Crea account di archiviazione](./media/site-recovery-hyper-v-site-to-azure-classic/create-resources.png)

> [!NOTE]
> 1. <span data-ttu-id="30ed4-233">Non è supportato lo spostamento degli account di archiviazione creati con il [nuovo portale di Azure](../storage/common/storage-create-storage-account.md) tra gruppi di risorse.</span><span class="sxs-lookup"><span data-stu-id="30ed4-233">We do not support the move of Storage accounts created using the [new Azure portal](../storage/common/storage-create-storage-account.md) across resource groups.</span></span>
> 2. <span data-ttu-id="30ed4-234">[La migrazione degli account di archiviazione](../azure-resource-manager/resource-group-move-resources.md) all'interno dei gruppi di risorse con la stessa sottoscrizione o all'interno delle sottoscrizioni non è supportata per gli account di archiviazione usati per la distribuzione di Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="30ed4-234">[Migration of storage accounts](../azure-resource-manager/resource-group-move-resources.md) across resource groups within the same subscription or across subscriptions is not supported for storage accounts used for deploying Site Recovery.</span></span>
>

## <a name="step-5-create-and-configure-protection-groups"></a><span data-ttu-id="30ed4-235">Passaggio 5: Creare e configurare gruppi di protezione </span><span class="sxs-lookup"><span data-stu-id="30ed4-235">Step 5: Create and configure protection groups</span></span>
<span data-ttu-id="30ed4-236">I gruppi di protezione dati sono raggruppamenti logici di macchine virtuali che si desidera proteggere utilizzando le stesse impostazioni di protezione.</span><span class="sxs-lookup"><span data-stu-id="30ed4-236">Protection groups are logical groupings of virtual machines that you want to protect using the same protection settings.</span></span> <span data-ttu-id="30ed4-237">Se si applicano specifiche impostazioni di protezione a un gruppo, queste vengono automaticamente applicate a tutte le macchine virtuali aggiunte al gruppo.</span><span class="sxs-lookup"><span data-stu-id="30ed4-237">You apply protection settings to a protection group, and those settings are applied to all virtual machines that you add to the group.</span></span>

1. <span data-ttu-id="30ed4-238">In **Crea e configura gruppi di protezione** fare clic su **Crea gruppo di protezione dati**.</span><span class="sxs-lookup"><span data-stu-id="30ed4-238">In **Create and configure protection groups** click **Create a protection group**.</span></span> <span data-ttu-id="30ed4-239">Se non risultano soddisfatti tutti i requisiti, viene visualizzato un messaggio in cui è disponibile l'opzione **Visualizza dettagli** che consente di ottenere maggiori informazioni.</span><span class="sxs-lookup"><span data-stu-id="30ed4-239">If any prerequisites aren't in place a message is issued and you can click **View details** for more information.</span></span>
2. <span data-ttu-id="30ed4-240">Nella scheda **Gruppo di protezione dati** , aggiungere un gruppo di protezione.</span><span class="sxs-lookup"><span data-stu-id="30ed4-240">In the **Protection Groups** tab, add a protection group.</span></span> <span data-ttu-id="30ed4-241">Specificare un nome, il sito Hyper-V di origine, **Azure**di destinazione, il nome della sottoscrizione di Azure Site Recovery e l'account di archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="30ed4-241">Specify a name, the source Hyper-V site, the target **Azure**, your Azure Site Recovery subscription name, and the Azure storage account.</span></span>

    ![Gruppo protezione dati](./media/site-recovery-hyper-v-site-to-azure-classic/protection-group.png)
3. <span data-ttu-id="30ed4-243">In **Impostazioni di replica** impostare la **Frequenza di copia** per specificare la frequenza di sincronizzazione dei dati differenziali tra origine e destinazione.</span><span class="sxs-lookup"><span data-stu-id="30ed4-243">In **Replication settings** set the **Copy frequency** to specify how often the data delta should be synchronized between the source and target.</span></span> <span data-ttu-id="30ed4-244">È possibile impostare su 30 secondi, 5 minuti o 15 minuti.</span><span class="sxs-lookup"><span data-stu-id="30ed4-244">You can set to 30 seconds, 5 minutes, or 15 minutes.</span></span>
4. <span data-ttu-id="30ed4-245">In **Mantieni punti di ripristino** specificare il numero di ore della cronologia di ripristino da archiviare.</span><span class="sxs-lookup"><span data-stu-id="30ed4-245">In **Retain recovery points** specify how many hours of recovery history should be stored.</span></span>
5. <span data-ttu-id="30ed4-246">In **Frequenza di snapshot coerenti con l’applicazione** è possibile specificare se eseguire snapshot che utilizzano il  servizio Copia Shadow del volume (VSS) per garantire che le applicazioni siano coerenti durante la creazione dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="30ed4-246">In **Frequency of application-consistent snapshots** you can specify whether to take snapshots that use Volume Shadow Copy Service (VSS) to ensure that applications are in a consistent state when the snapshot is taken.</span></span> <span data-ttu-id="30ed4-247">Per impostazione predefinita questi snapshot non vengono eseguiti.</span><span class="sxs-lookup"><span data-stu-id="30ed4-247">By default these aren't taken.</span></span> <span data-ttu-id="30ed4-248">Se si imposta un valore, questo deve essere inferiore al numero di punti di ripristino aggiuntivi configurati.</span><span class="sxs-lookup"><span data-stu-id="30ed4-248">Make sure this value is set to less than the number of additional recovery points you configure.</span></span> <span data-ttu-id="30ed4-249">Questa opzione è supportata solo se nella macchina virtuale è in esecuzione un sistema operativo Windows.</span><span class="sxs-lookup"><span data-stu-id="30ed4-249">This is only supported if the virtual machine is running a Windows operating system.</span></span>
6. <span data-ttu-id="30ed4-250">In **Ora di inizio replica iniziale** specificare quando la replica iniziale delle macchine virtuali nel gruppo di protezione deve essere inviata in Azure.</span><span class="sxs-lookup"><span data-stu-id="30ed4-250">In **Initial replication start time** specify when initial replication of virtual machines in the protection group should be sent to Azure.</span></span>

    ![Gruppo protezione dati](./media/site-recovery-hyper-v-site-to-azure-classic/protection-group2.png)

## <a name="step-6-enable-virtual-machine-protection"></a><span data-ttu-id="30ed4-252">Passaggio 6: Abilitare la protezione delle macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="30ed4-252">Step 6: Enable virtual machine protection</span></span>
<span data-ttu-id="30ed4-253">Aggiungere macchine virtuali a un gruppo di protezione per abilitare la protezione.</span><span class="sxs-lookup"><span data-stu-id="30ed4-253">Add virtual machines to a protection group to enable protection for them.</span></span>

> [!NOTE]
> <span data-ttu-id="30ed4-254">La protezione di macchine virtuali che eseguono Linux con un indirizzo IP statico non è supportata.</span><span class="sxs-lookup"><span data-stu-id="30ed4-254">Protecting VMs running Linux with a static IP address isn't supported.</span></span>
>
>

1. <span data-ttu-id="30ed4-255">Nella scheda **Computer** del gruppo di protezione dati, fare clic su **Per proteggere le macchine virtuali, aggiungerle ai gruppi di protezione**.</span><span class="sxs-lookup"><span data-stu-id="30ed4-255">On the **Machines** tab for the protection group, click** Add virtual machines to protection groups to enable protection**.</span></span>
2. <span data-ttu-id="30ed4-256">Nella pagina **Abilita protezione macchine virtuali** selezionare le macchine virtuali da proteggere.</span><span class="sxs-lookup"><span data-stu-id="30ed4-256">On the **Enable Virtual Machine Protection** page select the virtual machines you want to protect.</span></span>

    ![Abilitare la protezione delle macchine virtuali](./media/site-recovery-hyper-v-site-to-azure-classic/add-vm.png)

    <span data-ttu-id="30ed4-258">Vengono avviati i processi di abilitazione della protezione,</span><span class="sxs-lookup"><span data-stu-id="30ed4-258">The Enable Protection jobs begins.</span></span> <span data-ttu-id="30ed4-259">Nella scheda **Processi** è possibile monitorare l'avanzamento. Dopo l'esecuzione del processo di finalizzazione della protezione la macchina virtuale è pronta per il failover.</span><span class="sxs-lookup"><span data-stu-id="30ed4-259">You can track progress on the **Jobs** tab. After the Finalize Protection job runs the virtual machine is ready for failover.</span></span>
3. <span data-ttu-id="30ed4-260">Dopo la configurazione della protezione è possibile:</span><span class="sxs-lookup"><span data-stu-id="30ed4-260">After protection is set up you can:</span></span>

   * <span data-ttu-id="30ed4-261">Visualizzare le macchine virtuali in **Elementi protetti** > **Gruppi protezione dati** > *nome_gruppoprotezione* > **Macchine virtuali** Nella scheda **Proprietà** è possibile eseguire il drill-down fino ai dettagli della macchina.</span><span class="sxs-lookup"><span data-stu-id="30ed4-261">View virtual machines in **Protected Items** > **Protection Groups** > *protectiongroup_name* > **Virtual Machines** You can drill down to machine details in the **Properties** tab..</span></span>
   * <span data-ttu-id="30ed4-262">Configurare le proprietà di failover per una macchina virtuale in **Elementi protetti** > **Gruppi protezione dati** > *nome_gruppodiprotezione* > **Macchine virtuali** *nome_macchina_virtuale* > **Configura**.</span><span class="sxs-lookup"><span data-stu-id="30ed4-262">Configure the failover properties for a virtual machines in **Protected Items** > **Protection Groups** > *protectiongroup_name* > **Virtual Machines** *virtual_machine_name* > **Configure**.</span></span> <span data-ttu-id="30ed4-263">È possibile configurare:</span><span class="sxs-lookup"><span data-stu-id="30ed4-263">You can configure:</span></span>

     * <span data-ttu-id="30ed4-264">**Nome**: il nome della macchina virtuale in Azure.</span><span class="sxs-lookup"><span data-stu-id="30ed4-264">**Name**: The name of the virtual machine in Azure.</span></span>
     * <span data-ttu-id="30ed4-265">**Dimensioni**: le dimensioni della macchina virtuale di destinazione che esegue il failover.</span><span class="sxs-lookup"><span data-stu-id="30ed4-265">**Size**: The target size of the virtual machine that fails over.</span></span>

       ![Configurare le proprietà della macchina virtuale](./media/site-recovery-hyper-v-site-to-azure-classic/vm-properties.png)
   * <span data-ttu-id="30ed4-267">Configurare altre impostazioni della macchina virtuale in *Elementi protetti** > **Gruppi di protezione** > *nome_gruppodiprotezione* > **Macchine virtuali***nome_macchina_virtuale* > **Configura**, tra cui:</span><span class="sxs-lookup"><span data-stu-id="30ed4-267">Configure additional virtual machine settings in *Protected Items** > **Protection Groups** > *protectiongroup_name* > **Virtual Machines** *virtual_machine_name* > **Configure**, including:</span></span>

     * <span data-ttu-id="30ed4-268">**Schede di rete**: il numero di schede di rete dipende dalle dimensioni specificate per la macchina virtuale di destinazione.</span><span class="sxs-lookup"><span data-stu-id="30ed4-268">**Network adapters**: The number of network adapters is dictated by the size you specify for the target virtual machine.</span></span> <span data-ttu-id="30ed4-269">Per il numero di schede di rete supportate dalle dimensioni della macchina virtuale, vedere le [specifiche sulle dimensioni delle macchine virtuali](../virtual-machines/linux/sizes.md) .</span><span class="sxs-lookup"><span data-stu-id="30ed4-269">Check [virtual machine size specs](../virtual-machines/linux/sizes.md) for the number of nics supported by the virtual machine size.</span></span>

       <span data-ttu-id="30ed4-270">Quando si modificano le dimensioni di una macchina virtuale e si salvano le impostazioni, il numero di schede di rete cambia alla successiva apertura della pagina **Configura** .</span><span class="sxs-lookup"><span data-stu-id="30ed4-270">When you modify the size for a virtual machine and save the settings, the number of network adapter will change when you open **Configure** page the next time.</span></span> <span data-ttu-id="30ed4-271">Il numero di schede di rete delle macchine virtuali di destinazione corrisponde minimo al numero di schede di rete nella macchina virtuale di origine e al numero massimo di schede di rete supportate dalla dimensione della macchina virtuale selezionata.</span><span class="sxs-lookup"><span data-stu-id="30ed4-271">The number of network adapters of target virtual machines is minimum of the number of network adapters on source virtual machine and maximum number of network adapters supported by the size of the virtual machine chosen.</span></span> <span data-ttu-id="30ed4-272">Questo concetto è illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="30ed4-272">It is explained below:</span></span>

       * <span data-ttu-id="30ed4-273">Se il numero di schede di rete nella macchina di origine è minore o uguale al numero di schede consentite per la macchina di destinazione, la destinazione avrà lo stesso numero di schede dell’origine.</span><span class="sxs-lookup"><span data-stu-id="30ed4-273">If the number of network adapters on the source machine is less than or equal to the number of adapters allowed for the target machine size, then the target will have the same number of adapters as the source.</span></span>
       * <span data-ttu-id="30ed4-274">Se il numero di schede per la macchina virtuale di origine supera il numero consentito per le dimensioni di destinazione, verrà utilizzata la dimensione di destinazione massima.</span><span class="sxs-lookup"><span data-stu-id="30ed4-274">If the number of adapters for the source virtual machine exceeds the number allowed for the target size then the target size maximum will be used.</span></span>
       * <span data-ttu-id="30ed4-275">Ad esempio, se una macchina di origine dispone di due schede di rete e le dimensioni della macchina di destinazione ne supportano quattro, la macchina di destinazione avrà due schede.</span><span class="sxs-lookup"><span data-stu-id="30ed4-275">For example if a source machine has two network adapters and the target machine size supports four, the target machine will have two adapters.</span></span> <span data-ttu-id="30ed4-276">Se la macchina di origine dispone di due schede ma le dimensioni di destinazione supportate ne consentono solo una, la macchina di destinazione avrà una sola scheda.</span><span class="sxs-lookup"><span data-stu-id="30ed4-276">If the source machine has two adapters but the supported target size only supports one then the target machine will have only one adapter.</span></span>

     * <span data-ttu-id="30ed4-277">**Rete di Azure**: specificare la rete in cui la macchina virtuale deve eseguire il failover.</span><span class="sxs-lookup"><span data-stu-id="30ed4-277">**Azure network**: Specify the network to which the virtual machine should fail over.</span></span> <span data-ttu-id="30ed4-278">Se la macchina virtuale ha più schede di rete, tutte le schede devono essere connesse alla stessa rete di Azure.</span><span class="sxs-lookup"><span data-stu-id="30ed4-278">If the virtual machine has multiple network adapters all adapters should connected to the same Azure network.</span></span>
     * <span data-ttu-id="30ed4-279">**Subnet** : per ogni scheda di rete nella macchina virtuale, selezionare la subnet nella rete di Azure a cui deve connettersi la macchina dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="30ed4-279">**Subnet** For each network adapter on the virtual machine, select the subnet in the Azure network to which the machine should connect after failover.</span></span>
     * <span data-ttu-id="30ed4-280">**Indirizzo IP di destinazione**: se la scheda di rete della macchina virtuale di origine è configurata per usare un indirizzo IP statico, è possibile specificare l'indirizzo IP per la macchina virtuale di destinazione per assicurarsi che la macchina abbia lo stesso indirizzo IP dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="30ed4-280">**Target IP address**: If the network adapter of source virtual machine is configured to use static a IP address then you can specify the IP address for the target virtual machine to ensure that the machine has the same IP address after failover.</span></span>  <span data-ttu-id="30ed4-281">Se non si specifica un indirizzo IP, al momento del failover verrà assegnato un qualsiasi indirizzo disponibile.</span><span class="sxs-lookup"><span data-stu-id="30ed4-281">If you don't specify an IP address then any available address will be assigned at the time of failover.</span></span> <span data-ttu-id="30ed4-282">Se si specifica un indirizzo che si sta usando, il failover avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="30ed4-282">If you specify an address that's in use then failover will fail.</span></span>

     > [!NOTE]
     > <span data-ttu-id="30ed4-283">La [migrazione di reti](../azure-resource-manager/resource-group-move-resources.md) all'interno dei gruppi di risorse con la stessa sottoscrizione o all'interno delle sottoscrizioni non è supportata per le reti usate per la distribuzione di Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="30ed4-283">[Migration of networks](../azure-resource-manager/resource-group-move-resources.md) across resource groups within the same subscription or across subscriptions is not supported for networks used for deploying Site Recovery.</span></span>
     >

     ![Configurare le proprietà della macchina virtuale](./media/site-recovery-hyper-v-site-to-azure-classic/multiple-nic.png)




## <a name="step-7-create-a-recovery-plan"></a><span data-ttu-id="30ed4-285">Passaggio 7: Creare un piano di ripristino</span><span class="sxs-lookup"><span data-stu-id="30ed4-285">Step 7: Create a recovery plan</span></span>
<span data-ttu-id="30ed4-286">Per testare la distribuzione è possibile eseguire un failover di test per una singola macchina virtuale o un piano di ripristino che contenga una o più macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="30ed4-286">In order to test the deployment you can run a test failover for a single virtual machine or a recovery plan that contains one or more virtual machines.</span></span> <span data-ttu-id="30ed4-287">[Altre informazioni](site-recovery-create-recovery-plans.md) sulla creazione di un piano di ripristino.</span><span class="sxs-lookup"><span data-stu-id="30ed4-287">[Learn more](site-recovery-create-recovery-plans.md) about creating a recovery plan.</span></span>

## <a name="step-8-test-the-deployment"></a><span data-ttu-id="30ed4-288">Passaggio 8: Testare la distribuzione</span><span class="sxs-lookup"><span data-stu-id="30ed4-288">Step 8: Test the deployment</span></span>
<span data-ttu-id="30ed4-289">È possibile eseguire un failover di test in Azure in due modi.</span><span class="sxs-lookup"><span data-stu-id="30ed4-289">There are two ways to run a test failover to Azure.</span></span>

* <span data-ttu-id="30ed4-290">**Failover di test senza una rete di Azure**: questo tipo di failover di test verifica che la macchina virtuale sia rilevata correttamente in Azure.</span><span class="sxs-lookup"><span data-stu-id="30ed4-290">**Test failover without an Azure network**—This type of test failover checks that the virtual machine comes up correctly in Azure.</span></span> <span data-ttu-id="30ed4-291">La macchina virtuale non sarà connessa ad alcuna rete di Azure dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="30ed4-291">The virtual machine won’t be connected to any Azure network after failover.</span></span>
* <span data-ttu-id="30ed4-292">**Failover di test con una rete di Azure**: questo tipo di failover verifica che l'intero ambiente di replica venga rilevato come previsto e che le macchine virtuali di cui viene eseguito il failover si connettano alla rete di Azure di destinazione specificata.</span><span class="sxs-lookup"><span data-stu-id="30ed4-292">**Test failover with an Azure network**—This type of failover checks that the entire replication environment comes up as expected and that failed over the virtual machines connects to the specified target Azure network.</span></span> <span data-ttu-id="30ed4-293">Si noti che nel failover di test la subnet della macchina virtuale di test viene rilevata in base alla subnet della macchina virtuale di replica.</span><span class="sxs-lookup"><span data-stu-id="30ed4-293">Note that for test failover the subnet of the test virtual machine will be figured out based on the subnet of the replica virtual machine.</span></span> <span data-ttu-id="30ed4-294">Questo comportamento è diverso dalla replica normale quando la subnet della macchina virtuale di replica si basa sulla subnet della macchina virtuale di origine.</span><span class="sxs-lookup"><span data-stu-id="30ed4-294">This is different to regular replication when the subnet of a replica virtual machine is based on the subnet of the source virtual machine.</span></span>

<span data-ttu-id="30ed4-295">Per eseguire un failover di test senza specificare una rete di Azure non è necessario preparare l'ambiente.</span><span class="sxs-lookup"><span data-stu-id="30ed4-295">If you want to run a test failover without specifying an Azure network you don’t need to prepare anything.</span></span>

<span data-ttu-id="30ed4-296">Per eseguire un failover di test con una rete di Azure di destinazione, è necessario creare una nuova rete di Azure isolata dalla rete di Azure di produzione, ovvero il comportamento predefinito quando si crea una nuova rete in Azure.</span><span class="sxs-lookup"><span data-stu-id="30ed4-296">To run a test failover with a target Azure network you’ll need to create a new Azure network that’s isolated from your Azure production network (default behavior when you create a new network in Azure).</span></span> <span data-ttu-id="30ed4-297">Per altre informazioni dettagliate, vedere [Eseguire un failover di test](site-recovery-failover.md) .</span><span class="sxs-lookup"><span data-stu-id="30ed4-297">Read [run a test failover](site-recovery-failover.md) for more details.</span></span>

<span data-ttu-id="30ed4-298">Per testare completamente la replica e la distribuzione di rete è necessario configurare l'infrastruttura in modo che la macchina virtuale replicata funzioni come previsto.</span><span class="sxs-lookup"><span data-stu-id="30ed4-298">To fully test your replication and network deployment you'll need to set up the infrastructure so that the replicated virtual machine to work as expected.</span></span> <span data-ttu-id="30ed4-299">Un modo di procedere consiste nel configurare una macchina virtuale come controller di dominio con DNS ed eseguirne la replica in Azure usando Site Recovery per crearla nella rete di test eseguendo un failover di test.</span><span class="sxs-lookup"><span data-stu-id="30ed4-299">One way of doing this to to set up a virtual machine as a domain controller with DNS and replicate it to Azure using Site Recovery to create it in the test network by running a test failover.</span></span>  <span data-ttu-id="30ed4-300">[Altre informazioni](site-recovery-active-directory.md#test-failover-considerations) e considerazioni sul failover di test per Active Directory.</span><span class="sxs-lookup"><span data-stu-id="30ed4-300">[Read more](site-recovery-active-directory.md#test-failover-considerations) about test failover considerations for Active Directory.</span></span>

<span data-ttu-id="30ed4-301">Eseguire il failover di test come descritto di seguito:</span><span class="sxs-lookup"><span data-stu-id="30ed4-301">Run the test failover as follows:</span></span>

> [!NOTE]
> <span data-ttu-id="30ed4-302">Per ottenere prestazioni ottimali quando si esegue un failover in Azure, assicurarsi di aver installato l'agente di Azure nel computer protetto.</span><span class="sxs-lookup"><span data-stu-id="30ed4-302">To get the best performance when you do a failover to Azure, ensure that you have installed the Azure Agent in the protected machine.</span></span> <span data-ttu-id="30ed4-303">Questo consente un avvio più veloce e facilita anche la diagnosi nel caso di problemi.</span><span class="sxs-lookup"><span data-stu-id="30ed4-303">This helps in booting faster and also helps in diagnosis in case of issues.</span></span> <span data-ttu-id="30ed4-304">L'agente Linux è disponibile [qui](https://github.com/Azure/WALinuxAgent), mentre l'agente Windows è disponibile [qui](http://go.microsoft.com/fwlink/?LinkID=394789)</span><span class="sxs-lookup"><span data-stu-id="30ed4-304">Linux agent can be found [here](https://github.com/Azure/WALinuxAgent) - and Windows agent can be found [here](http://go.microsoft.com/fwlink/?LinkID=394789)</span></span>
>
>

1. <span data-ttu-id="30ed4-305">Nella scheda **Piani di ripristino** selezionare il piano e fare clic su **Failover di test**.</span><span class="sxs-lookup"><span data-stu-id="30ed4-305">On the **Recovery Plans** tab, select the plan and click **Test Failover**.</span></span>
2. <span data-ttu-id="30ed4-306">Nella pagina **Conferma failover di test** selezionare **Nessuno** o una rete di Azure specifica.</span><span class="sxs-lookup"><span data-stu-id="30ed4-306">On the **Confirm Test Failover** page select **None** or a specific Azure network.</span></span>  <span data-ttu-id="30ed4-307">Tenere presente che se si seleziona **Nessuno** , il failover di test verifica che la macchina virtuale venga replicata correttamente in Azure ma non controlla la configurazione della rete di replica.</span><span class="sxs-lookup"><span data-stu-id="30ed4-307">Note that if you select **None** the test failover will check that the virtual machine replicated correctly to Azure but doesn't check your replication network configuration.</span></span>

    ![Failover di test](./media/site-recovery-hyper-v-site-to-azure-classic/test-nonetwork.png)
3. <span data-ttu-id="30ed4-309">Nella scheda **Processi** è possibile tenere traccia dello stato di avanzamento del failover.</span><span class="sxs-lookup"><span data-stu-id="30ed4-309">On the **Jobs** tab you can track failover progress.</span></span> <span data-ttu-id="30ed4-310">Dovrebbe anche essere possibile vedere la replica di test della macchina virtuale nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="30ed4-310">You should also be able to see the virtual machine test replica in the Azure portal.</span></span> <span data-ttu-id="30ed4-311">Se è stato impostato l'accesso alle macchine virtuali dalla rete locale, è possibile inizializzare una Connessione Desktop remoto alla macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="30ed4-311">If you’re set up to access virtual machines from your on-premises network you can initiate a Remote Desktop connection to the virtual machine.</span></span>
4. <span data-ttu-id="30ed4-312">Quando il processo di failover raggiunge la **fase conclusiva**, fare clic su **Completa test** per completare il failover di test.</span><span class="sxs-lookup"><span data-stu-id="30ed4-312">When the failover reaches the **Complete testing** phase , click **Complete Test** to finish up the test failover.</span></span> <span data-ttu-id="30ed4-313">È possibile eseguire il drill-down fino alla scheda **Processo** per tenere traccia dello stato e dell’avanzamento del failover ed eseguire eventuali azioni necessarie.</span><span class="sxs-lookup"><span data-stu-id="30ed4-313">You can drill down to the **Job** tab to track failover progress and status, and to perform any actions that are needed.</span></span>
5. <span data-ttu-id="30ed4-314">Al termine del processo di failover, nel portale di Azure sarà possibile visualizzare la replica del test eseguito sulla macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="30ed4-314">After  failover you'll be able to see the virtual machine test replica in the Azure portal.</span></span> <span data-ttu-id="30ed4-315">Se è stato impostato l'accesso alle macchine virtuali dalla rete locale, è possibile inizializzare una Connessione Desktop remoto alla macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="30ed4-315">If you’re set up to access virtual machines from your on-premises network you can initiate a Remote Desktop connection to the virtual machine.</span></span>

   1. <span data-ttu-id="30ed4-316">Verificare che le macchine virtuali vengano avviate correttamente.</span><span class="sxs-lookup"><span data-stu-id="30ed4-316">Verify that the virtual machines start successfully.</span></span>
   2. <span data-ttu-id="30ed4-317">Per eseguire la connessione alla macchina virtuale in Azure tramite Desktop remoto dopo il failover, abilitare Connessione Desktop remoto sulla macchina virtuale prima di eseguire il failover di test.</span><span class="sxs-lookup"><span data-stu-id="30ed4-317">If you want to connect to the virtual machine in Azure using Remote Desktop after the failover, enable Remote Desktop Connection on the virtual machine before you run the test failover.</span></span> <span data-ttu-id="30ed4-318">È necessario anche aggiungere un endpoint RDP nella macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="30ed4-318">You will also need to add an RDP endpoint on the virtual machine.</span></span> <span data-ttu-id="30ed4-319">A tale scopo, è possibile usare un [runbook di automazione di Azure](site-recovery-runbook-automation.md) .</span><span class="sxs-lookup"><span data-stu-id="30ed4-319">You can leverage an [Azure automation runbook](site-recovery-runbook-automation.md) to do that.</span></span>
   3. <span data-ttu-id="30ed4-320">Dopo il failover, se si utilizza un indirizzo IP pubblico per connettersi alla macchina virtuale in Azure tramite Desktop remoto, verificare che non siano definiti criteri di dominio che impediscono la connessione a una macchina virtuale utilizzando un indirizzo pubblico.</span><span class="sxs-lookup"><span data-stu-id="30ed4-320">After failover if you use a public IP address to connect to the virtual machine in Azure using Remote Desktop, ensure you don't have any domain policies that prevent you from connecting to a virtual machine using a public address.</span></span>
6. <span data-ttu-id="30ed4-321">Al completamento del test, procedere come segue:</span><span class="sxs-lookup"><span data-stu-id="30ed4-321">After the testing is complete do the following:</span></span>

   * <span data-ttu-id="30ed4-322">Fare clic su **Il failover di test è completo**.</span><span class="sxs-lookup"><span data-stu-id="30ed4-322">Click **The test failover is complete**.</span></span> <span data-ttu-id="30ed4-323">Pulire l'ambiente di test per spegnere automaticamente ed eliminare la macchine virtuali di test.</span><span class="sxs-lookup"><span data-stu-id="30ed4-323">Clean up the test environment to automatically power off and delete the test virtual machines.</span></span>
   * <span data-ttu-id="30ed4-324">Fare clic su **Note** per registrare e salvare eventuali commenti associati al failover di test.</span><span class="sxs-lookup"><span data-stu-id="30ed4-324">Click **Notes** to record and save any observations associated with the test failover.</span></span>
7. <span data-ttu-id="30ed4-325">Quando il processo di failover raggiunge la **fase conclusiva** , completare la verifica come segue:</span><span class="sxs-lookup"><span data-stu-id="30ed4-325">When the failover reaches the **Complete testing** phase finish the verification as follows:</span></span>
   1. <span data-ttu-id="30ed4-326">Visualizzare la macchina virtuale di replica nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="30ed4-326">View the replica virtual machine in the Azure portal.</span></span> <span data-ttu-id="30ed4-327">Verificare che la macchina virtuale venga avviata correttamente.</span><span class="sxs-lookup"><span data-stu-id="30ed4-327">Verify that the virtual machine starts successfully.</span></span>
   2. <span data-ttu-id="30ed4-328">Se è stato impostato l'accesso alle macchine virtuali dalla rete locale, è possibile inizializzare una Connessione Desktop remoto alla macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="30ed4-328">If you’re set up to access virtual machines from your on-premises network you can initiate a Remote Desktop connection to the virtual machine.</span></span>
   3. <span data-ttu-id="30ed4-329">Fare clic su **Completa il test** per portarlo a termine.</span><span class="sxs-lookup"><span data-stu-id="30ed4-329">Click **Complete the test** to finish it.</span></span>
   4. <span data-ttu-id="30ed4-330">Fare clic su **Note** per registrare e salvare eventuali commenti associati al failover di test.</span><span class="sxs-lookup"><span data-stu-id="30ed4-330">Click **Notes** to record and save any observations associated with the test failover.</span></span>
   5. <span data-ttu-id="30ed4-331">Fare clic su **Il failover di test è completo**.</span><span class="sxs-lookup"><span data-stu-id="30ed4-331">Click **The test failover is complete**.</span></span> <span data-ttu-id="30ed4-332">Pulire l'ambiente di test per spegnere automaticamente ed eliminare la macchina virtuale di test.</span><span class="sxs-lookup"><span data-stu-id="30ed4-332">Clean up the test environment to automatically power off and delete the test virtual machine.</span></span>

## <a name="next-steps"></a><span data-ttu-id="30ed4-333">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="30ed4-333">Next steps</span></span>
<span data-ttu-id="30ed4-334">Dopo aver configurato correttamente la distribuzione, leggere [altre informazioni](site-recovery-failover.md) sul failover.</span><span class="sxs-lookup"><span data-stu-id="30ed4-334">After your deployment is set up and running, [learn more](site-recovery-failover.md) about failover.</span></span>
