---
title: aaaGuidelines & indicazioni per le raccolte affidabile in Azure Service Fabric | Documenti Microsoft
description: Linee guida e consigli per l'uso di Reliable Collections in Service Fabric
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/3/2017
ms.author: mcoskun
ms.openlocfilehash: bcdbc9d013bc044e06c43761e7f515c7e4bf340c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="guidelines-and-recommendations-for-reliable-collections-in-azure-service-fabric"></a><span data-ttu-id="919cb-103">Linee guida e consigli per Reliable Collections in Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="919cb-103">Guidelines and recommendations for Reliable Collections in Azure Service Fabric</span></span>
<span data-ttu-id="919cb-104">Questa sezione fornisce le linee guida per l'uso di Reliable State Manager e Reliable Collections.</span><span class="sxs-lookup"><span data-stu-id="919cb-104">This section provides guidelines for using Reliable State Manager and Reliable Collections.</span></span> <span data-ttu-id="919cb-105">obiettivo di Hello è toohelp utenti evitano trappole comuni.</span><span class="sxs-lookup"><span data-stu-id="919cb-105">hello goal is toohelp users avoid common pitfalls.</span></span>

<span data-ttu-id="919cb-106">linee guida Hello sono organizzate come semplici raccomandazione preceduti termini hello *si*, *provare a*, *evitare* e *non*.</span><span class="sxs-lookup"><span data-stu-id="919cb-106">hello guidelines are organized as simple recommendations prefixed with hello terms *Do*, *Consider*, *Avoid* and *Do not*.</span></span>

* <span data-ttu-id="919cb-107">Non modificare un oggetto di tipo personalizzato restituito dalle operazioni di lettura, ad esempio `TryPeekAsync` o `TryGetValueAsync`.</span><span class="sxs-lookup"><span data-stu-id="919cb-107">Do not modify an object of custom type returned by read operations (for example, `TryPeekAsync` or `TryGetValueAsync`).</span></span> <span data-ttu-id="919cb-108">Raccolte affidabile, come raccolte concorrenti, restituiscono un oggetto di riferimento toohello e non una copia.</span><span class="sxs-lookup"><span data-stu-id="919cb-108">Reliable Collections, just like Concurrent Collections, return a reference toohello objects and not a copy.</span></span>
* <span data-ttu-id="919cb-109">Eseguire hello copia completa restituito l'oggetto di un tipo personalizzato prima di modificarla.</span><span class="sxs-lookup"><span data-stu-id="919cb-109">Do deep copy hello returned object of a custom type before modifying it.</span></span> <span data-ttu-id="919cb-110">Poiché le strutture e tipi incorporati sono pass-by-value, non è necessario toodo una copia completa su di essi.</span><span class="sxs-lookup"><span data-stu-id="919cb-110">Since structs and built-in types are pass-by-value, you do not need toodo a deep copy on them.</span></span>
* <span data-ttu-id="919cb-111">Non usare `TimeSpan.MaxValue` per i timeout.</span><span class="sxs-lookup"><span data-stu-id="919cb-111">Do not use `TimeSpan.MaxValue` for time-outs.</span></span> <span data-ttu-id="919cb-112">Valori di timeout deve essere utilizzato toodetect deadlock.</span><span class="sxs-lookup"><span data-stu-id="919cb-112">Time-outs should be used toodetect deadlocks.</span></span>
* <span data-ttu-id="919cb-113">Non usare una transazione dopo che ne è stato eseguito il commit, è stata interrotta o eliminata.</span><span class="sxs-lookup"><span data-stu-id="919cb-113">Do not use a transaction after it has been committed, aborted, or disposed.</span></span>
* <span data-ttu-id="919cb-114">Non utilizzare di fuori dell'ambito di transazione hello in che è stata creata un'enumerazione.</span><span class="sxs-lookup"><span data-stu-id="919cb-114">Do not use an enumeration outside of hello transaction scope it was created in.</span></span>
* <span data-ttu-id="919cb-115">Non creare una transazione all'interno dell'istruzione `using` di un'altra transazione. Questa operazione può causare deadlock.</span><span class="sxs-lookup"><span data-stu-id="919cb-115">Do not create a transaction within another transaction’s `using` statement because it can cause deadlocks.</span></span>
* <span data-ttu-id="919cb-116">Verificare che l'implementazione di `IComparable<TKey>` sia corretta.</span><span class="sxs-lookup"><span data-stu-id="919cb-116">Do ensure that your `IComparable<TKey>` implementation is correct.</span></span> <span data-ttu-id="919cb-117">sistema Hello assume una dipendenza dal `IComparable<TKey>` per unire i checkpoint e righe.</span><span class="sxs-lookup"><span data-stu-id="919cb-117">hello system takes dependency on `IComparable<TKey>` for merging checkpoints and rows.</span></span>
* <span data-ttu-id="919cb-118">Utilizzare il blocco di aggiornamento durante la lettura di un elemento con un tooupdate intenzione è tooprevent una determinata classe di deadlock.</span><span class="sxs-lookup"><span data-stu-id="919cb-118">Do use Update lock when reading an item with an intention tooupdate it tooprevent a certain class of deadlocks.</span></span>
* <span data-ttu-id="919cb-119">Si consiglia di conservare gli elementi (ad esempio, TKey + TValue per dizionario affidabile) inferiore a 80 Kbyte: hello più piccolo migliorato.</span><span class="sxs-lookup"><span data-stu-id="919cb-119">Consider keeping your items (for example, TKey + TValue for Reliable Dictionary) below 80 KBytes: smaller hello better.</span></span> <span data-ttu-id="919cb-120">In questo modo si riduce la quantità hello dei requisiti dei / o di utilizzo come disco e rete Heap oggetti grandi.</span><span class="sxs-lookup"><span data-stu-id="919cb-120">This reduces hello amount of Large Object Heap usage as well as disk and network IO requirements.</span></span> <span data-ttu-id="919cb-121">Spesso, si riduce la replica dei dati duplicati quando viene aggiornata solo una piccola parte del valore di hello.</span><span class="sxs-lookup"><span data-stu-id="919cb-121">Often, it reduces replicating duplicate data when only one small part of hello value is being updated.</span></span> <span data-ttu-id="919cb-122">Tooachieve modo comune nel dizionario affidabile, si tratta toobreak le righe in toomultiple righe.</span><span class="sxs-lookup"><span data-stu-id="919cb-122">Common way tooachieve this in Reliable Dictionary, is toobreak your rows in toomultiple rows.</span></span>
* <span data-ttu-id="919cb-123">È consigliabile usare backup e ripristino di emergenza toohave funzionalità.</span><span class="sxs-lookup"><span data-stu-id="919cb-123">Consider using backup and restore functionality toohave disaster recovery.</span></span>
* <span data-ttu-id="919cb-124">Evitare di utilizzare operazioni di entità singola e a più entità (ad esempio `GetCountAsync`, `CreateEnumerableAsync`) in hello stessa transazione a causa di toohello diversi livelli di isolamento.</span><span class="sxs-lookup"><span data-stu-id="919cb-124">Avoid mixing single entity operations and multi-entity operations (e.g `GetCountAsync`, `CreateEnumerableAsync`) in hello same transaction due toohello different isolation levels.</span></span>
* <span data-ttu-id="919cb-125">Gestire InvalidOperationException.</span><span class="sxs-lookup"><span data-stu-id="919cb-125">Do handle InvalidOperationException.</span></span> <span data-ttu-id="919cb-126">Le transazioni utente possono essere interrotta dal sistema hello per diversi motivi.</span><span class="sxs-lookup"><span data-stu-id="919cb-126">User transactions can be aborted by hello system for variety of reasons.</span></span> <span data-ttu-id="919cb-127">Ad esempio, quando cambia il proprio ruolo fuori primario hello affidabile di gestione dello stato quando una transazione con esecuzione prolungata è bloccato o il troncamento del log delle transazioni hello.</span><span class="sxs-lookup"><span data-stu-id="919cb-127">For example, when hello Reliable State Manager is changing its role out of Primary or when a long-running transaction is blocking truncation of hello transactional log.</span></span> <span data-ttu-id="919cb-128">In questi casi, l'utente può ricevere un evento InvalidOperationException, che indica che la transazione è già stata terminata.</span><span class="sxs-lookup"><span data-stu-id="919cb-128">In such cases, user may receive InvalidOperationException indicating that their transaction has already been terminated.</span></span> <span data-ttu-id="919cb-129">Supponendo che, terminazione hello di transazione hello non è stata richiesta dall'utente hello, toohandle modo migliore questa eccezione è transazione hello toodispose, verificare se è stato segnalato il token di annullamento hello (o è stato modificato il ruolo di hello della replica di hello), e in caso contrario creare una nuova transazione e riprovare.</span><span class="sxs-lookup"><span data-stu-id="919cb-129">Assuming, hello termination of hello transaction was not requested by hello user, best way toohandle this exception is toodispose hello transaction, check if hello cancellation token has been signaled (or hello role of hello replica has been changed), and if not create a new transaction and retry.</span></span>  

<span data-ttu-id="919cb-130">Ecco alcuni aspetti tookeep presente:</span><span class="sxs-lookup"><span data-stu-id="919cb-130">Here are some things tookeep in mind:</span></span>

* <span data-ttu-id="919cb-131">timeout predefinito Hello è 4 secondi per hello tutte le API insieme affidabile.</span><span class="sxs-lookup"><span data-stu-id="919cb-131">hello default time-out is four seconds for all hello Reliable Collection APIs.</span></span> <span data-ttu-id="919cb-132">La maggior parte degli utenti devono utilizzare timeout predefinito hello.</span><span class="sxs-lookup"><span data-stu-id="919cb-132">Most users should use hello default time-out.</span></span>
* <span data-ttu-id="919cb-133">è Hello token di annullamento predefinito `CancellationToken.None` in tutte le API raccolte affidabile.</span><span class="sxs-lookup"><span data-stu-id="919cb-133">hello default cancellation token is `CancellationToken.None` in all Reliable Collections APIs.</span></span>
* <span data-ttu-id="919cb-134">parametro di tipo chiave Hello (*TKey*) per un dizionario affidabile devono correttamente implementare `GetHashCode()` e `Equals()`.</span><span class="sxs-lookup"><span data-stu-id="919cb-134">hello key type parameter (*TKey*) for a Reliable Dictionary must correctly implement `GetHashCode()` and `Equals()`.</span></span> <span data-ttu-id="919cb-135">Le chiavi non devono essere modificabili.</span><span class="sxs-lookup"><span data-stu-id="919cb-135">Keys must be immutable.</span></span>
* <span data-ttu-id="919cb-136">tooachieve la disponibilità elevata per le raccolte affidabile hello, ogni servizio deve disporre di almeno una destinazione e repliche minimo pari a 3.</span><span class="sxs-lookup"><span data-stu-id="919cb-136">tooachieve high availability for hello Reliable Collections, each service should have at least a target and minimum replica set size of 3.</span></span>
* <span data-ttu-id="919cb-137">Le operazioni di lettura su hello secondaria possono leggere le versioni che non è stato eseguito il commit di quorum.</span><span class="sxs-lookup"><span data-stu-id="919cb-137">Read operations on hello secondary may read versions that are not quorum committed.</span></span>
  <span data-ttu-id="919cb-138">Ciò significa che una versione dei dati che viene letta da un singolo secondario potrebbe essere elaborata in modo non corretto.</span><span class="sxs-lookup"><span data-stu-id="919cb-138">This means that a version of data that is read from a single secondary might be false progressed.</span></span>
  <span data-ttu-id="919cb-139">Le letture della replica primaria sono sempre stabili: non sono mai elaborate in modo non corretto.</span><span class="sxs-lookup"><span data-stu-id="919cb-139">Reads from Primary are always stable: can never be false progressed.</span></span>

### <a name="next-steps"></a><span data-ttu-id="919cb-140">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="919cb-140">Next steps</span></span>
* [<span data-ttu-id="919cb-141">Lavorare con le raccolte Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="919cb-141">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="919cb-142">Transazioni e blocchi</span><span class="sxs-lookup"><span data-stu-id="919cb-142">Transactions and Locks</span></span>](service-fabric-reliable-services-reliable-collections-transactions-locks.md)
* [<span data-ttu-id="919cb-143">Elementi interni di Reliable Collections e Reliable State Manager</span><span class="sxs-lookup"><span data-stu-id="919cb-143">Reliable State Manager and Collection Internals</span></span>](service-fabric-reliable-services-reliable-collections-internals.md)
* <span data-ttu-id="919cb-144">Gestione dei dati</span><span class="sxs-lookup"><span data-stu-id="919cb-144">Managing Data</span></span>
  * [<span data-ttu-id="919cb-145">Backup e ripristino</span><span class="sxs-lookup"><span data-stu-id="919cb-145">Backup and Restore</span></span>](service-fabric-reliable-services-backup-restore.md)
  * [<span data-ttu-id="919cb-146">Notifications</span><span class="sxs-lookup"><span data-stu-id="919cb-146">Notifications</span></span>](service-fabric-reliable-services-notifications.md)
  * [<span data-ttu-id="919cb-147">Serializzazione e aggiornamento</span><span class="sxs-lookup"><span data-stu-id="919cb-147">Serialization and Upgrade</span></span>](service-fabric-application-upgrade-data-serialization.md)
  * [<span data-ttu-id="919cb-148">Reliable State Manager configuration (Configurazione di Reliable State Manager)</span><span class="sxs-lookup"><span data-stu-id="919cb-148">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* <span data-ttu-id="919cb-149">Altro</span><span class="sxs-lookup"><span data-stu-id="919cb-149">Others</span></span>
  * [<span data-ttu-id="919cb-150">Guida introduttiva a Reliable Services di Microsoft Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="919cb-150">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
  * [<span data-ttu-id="919cb-151">Guida di riferimento per gli sviluppatori per Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="919cb-151">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)
