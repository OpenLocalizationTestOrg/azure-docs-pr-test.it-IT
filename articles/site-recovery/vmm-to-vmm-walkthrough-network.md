---
title: Pianificare la rete per la replica Hyper-V in un sito VMM secondario con Azure Site Recovery | Microsoft Docs
description: Questo articolo descrive la pianificazione della rete durante la replica di una macchina virtuale Hyper-V in un sito System Center VMM secondario con Azure Site Recovery.
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 095f2d73-994e-4fc0-96f2-e03a7d72e492
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/27/2017
ms.author: raynew
ms.openlocfilehash: a1f3f6e6cba074647195e2b0cbcdc7b4f3dec475
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/03/2017
---
# <a name="step-3-plan-networking-for-hyper-v-vm-replication-to-a-secondary-vmm-site"></a><span data-ttu-id="7f677-103">Passaggio 3: Pianificare la rete per la replica della macchina virtuale Hyper-V in un sito secondario</span><span class="sxs-lookup"><span data-stu-id="7f677-103">Step 3: Plan networking for Hyper-V VM replication to a secondary VMM site</span></span>

<span data-ttu-id="7f677-104">Dopo aver analizzato i prerequisiti di distribuzione, leggere questo articolo per pianificare la rete quando si replicano in un sito secondario macchine virtuali Hyper-V gestite nei cloud di System Center Virtual Machine Manager (VMM) usando [Azure Site Recovery](site-recovery-overview.md) nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="7f677-104">After reviewing deployment prerequisites, read this article to plan networking when replicating Hyper-V virtual machines (VMs) managed in System Center Virtual Machine Manager (VMM) clouds, to a secondary site using [Azure Site Recovery](site-recovery-overview.md) in the Azure portal.</span></span> 

<span data-ttu-id="7f677-105">È possibile inviare commenti nella parte inferiore di questo articolo oppure nel [forum sui servizi di ripristino di Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="7f677-105">After reading this article, post any comments at the bottom, or on the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

## <a name="network-mapping-overview"></a><span data-ttu-id="7f677-106">Panoramica del mapping di rete</span><span class="sxs-lookup"><span data-stu-id="7f677-106">Network mapping overview</span></span>

<span data-ttu-id="7f677-107">Il mapping di rete viene usato durante la replica delle macchine virtuali Hyper-V (gestite in VMM) in un centro dati secondario.</span><span class="sxs-lookup"><span data-stu-id="7f677-107">Network mapping is used when replicating Hyper-V VMs (managed in VMM) to a secondary datacenter.</span></span> <span data-ttu-id="7f677-108">Il mapping di rete esegue il mapping tra reti VM in un server VMM di origine e reti VM in un server VMM di destinazione.</span><span class="sxs-lookup"><span data-stu-id="7f677-108">Network mapping maps between VM networks on a source VMM server, and VM networks on a target VMM server.</span></span> <span data-ttu-id="7f677-109">Il mapping esegue queste operazioni:</span><span class="sxs-lookup"><span data-stu-id="7f677-109">Mapping does the following:</span></span>

- <span data-ttu-id="7f677-110">**Connessione di rete**: esegue la connessione delle VM alle reti appropriate dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="7f677-110">**Network connection**—Connects VMs to appropriate networks after failover.</span></span> <span data-ttu-id="7f677-111">La macchina virtuale di replica verrà connessa alla rete di destinazione di cui viene eseguito il mapping alla rete di origine.</span><span class="sxs-lookup"><span data-stu-id="7f677-111">The replica VM will be connected to the target network that's mapped to the source network.</span></span>
- <span data-ttu-id="7f677-112">**Posizionamento ottimale**: posiziona in modo ottimale le VM di replica nei server host Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="7f677-112">**Optimal placement**—Optimally places the replica VMs on Hyper-V host servers.</span></span> <span data-ttu-id="7f677-113">Le macchine virtuali di replica vengono posizionate negli host che possono accedere alle reti di macchine virtuali mappate.</span><span class="sxs-lookup"><span data-stu-id="7f677-113">Replica VMs are placed on hosts that can access the mapped VM networks.</span></span>
- <span data-ttu-id="7f677-114">**Nessun mapping di rete**: se non si configura il mapping di rete, le macchine virtuali replicate non risulteranno connesse ad alcuna rete di macchina virtuale in seguito al failover.</span><span class="sxs-lookup"><span data-stu-id="7f677-114">**No network mapping**—If you don’t configure network mapping, replica VMs won’t be connected to any VM networks after failover.</span></span>


### <a name="example"></a><span data-ttu-id="7f677-115">Esempio</span><span class="sxs-lookup"><span data-stu-id="7f677-115">Example</span></span>

<span data-ttu-id="7f677-116">Di seguito è riportato un esempio per illustrare questo meccanismo.</span><span class="sxs-lookup"><span data-stu-id="7f677-116">Here’s an example to illustrate this mechanism.</span></span> <span data-ttu-id="7f677-117">Si prenda come esempio un’organizzazione con due sedi, New York e Chicago.</span><span class="sxs-lookup"><span data-stu-id="7f677-117">Let’s take an organization with two locations in New York and Chicago.</span></span>

<span data-ttu-id="7f677-118">**Posizione**</span><span class="sxs-lookup"><span data-stu-id="7f677-118">**Location**</span></span> | <span data-ttu-id="7f677-119">**Server VMM**</span><span class="sxs-lookup"><span data-stu-id="7f677-119">**VMM server**</span></span> | <span data-ttu-id="7f677-120">**Reti VM**</span><span class="sxs-lookup"><span data-stu-id="7f677-120">**VM networks**</span></span> | <span data-ttu-id="7f677-121">**Mappata a**</span><span class="sxs-lookup"><span data-stu-id="7f677-121">**Mapped to**</span></span>
---|---|---|---
<span data-ttu-id="7f677-122">New York</span><span class="sxs-lookup"><span data-stu-id="7f677-122">New York</span></span> | <span data-ttu-id="7f677-123">VMM-NewYork</span><span class="sxs-lookup"><span data-stu-id="7f677-123">VMM-NewYork</span></span>| <span data-ttu-id="7f677-124">VMNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="7f677-124">VMNetwork1-NewYork</span></span> | <span data-ttu-id="7f677-125">Mappata a VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-125">Mapped to VMNetwork1-Chicago</span></span>
 |  | <span data-ttu-id="7f677-126">VMNetwork2-NewYork</span><span class="sxs-lookup"><span data-stu-id="7f677-126">VMNetwork2-NewYork</span></span> | <span data-ttu-id="7f677-127">Non mappata</span><span class="sxs-lookup"><span data-stu-id="7f677-127">Not mapped</span></span>
<span data-ttu-id="7f677-128">Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-128">Chicago</span></span> | <span data-ttu-id="7f677-129">VMM-Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-129">VMM-Chicago</span></span>| <span data-ttu-id="7f677-130">VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-130">VMNetwork1-Chicago</span></span> | <span data-ttu-id="7f677-131">Mappata a VMNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="7f677-131">Mapped to VMNetwork1-NewYork</span></span>
 | | <span data-ttu-id="7f677-132">VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-132">VMNetwork1-Chicago</span></span> | <span data-ttu-id="7f677-133">Non mappata</span><span class="sxs-lookup"><span data-stu-id="7f677-133">Not mapped</span></span>

<span data-ttu-id="7f677-134">Esempio:</span><span class="sxs-lookup"><span data-stu-id="7f677-134">In this example:</span></span>

- <span data-ttu-id="7f677-135">Quando viene creata una macchina virtuale di replica per una macchina virtuale connessa a VMNetwork1-NewYork, essa verrà connessa a VMNetwork1-Chicago.</span><span class="sxs-lookup"><span data-stu-id="7f677-135">When a replica virtual machine is created for any virtual machine that is connected to VMNetwork1-NewYork, it will be connected to VMNetwork1-Chicago.</span></span>
- <span data-ttu-id="7f677-136">Quando una macchina virtuale di replica viene creata per VMNetwork2-NewYork o VMNetwork2-Chicago, non verrà connessa ad alcuna rete.</span><span class="sxs-lookup"><span data-stu-id="7f677-136">When a replica virtual machine is created for VMNetwork2-NewYork or VMNetwork2-Chicago, it will not be connected to any network.</span></span>

<span data-ttu-id="7f677-137">Di seguito viene indicato in che modo vengono configurati i cloud VMM e in che modo le reti logiche vengono associate ai cloud.</span><span class="sxs-lookup"><span data-stu-id="7f677-137">Here's how VMM clouds are set up in our example organization, and the logical networks associated with the clouds.</span></span>

#### <a name="cloud-protection-settings"></a><span data-ttu-id="7f677-138">Impostazioni di protezione del cloud</span><span class="sxs-lookup"><span data-stu-id="7f677-138">Cloud protection settings</span></span>

<span data-ttu-id="7f677-139">**Cloud protetto**</span><span class="sxs-lookup"><span data-stu-id="7f677-139">**Protected cloud**</span></span> | <span data-ttu-id="7f677-140">**Protezione del cloud**</span><span class="sxs-lookup"><span data-stu-id="7f677-140">**Protecting cloud**</span></span> | <span data-ttu-id="7f677-141">**Rete logica (New York)**</span><span class="sxs-lookup"><span data-stu-id="7f677-141">**Logical network (New York)**</span></span>  
---|---|---
<span data-ttu-id="7f677-142">GoldCloud1</span><span class="sxs-lookup"><span data-stu-id="7f677-142">GoldCloud1</span></span> | <span data-ttu-id="7f677-143">GoldCloud2</span><span class="sxs-lookup"><span data-stu-id="7f677-143">GoldCloud2</span></span> |
<span data-ttu-id="7f677-144">SilverCloud1</span><span class="sxs-lookup"><span data-stu-id="7f677-144">SilverCloud1</span></span>| <span data-ttu-id="7f677-145">SilverCloud2</span><span class="sxs-lookup"><span data-stu-id="7f677-145">SilverCloud2</span></span> |
<span data-ttu-id="7f677-146">GoldCloud2</span><span class="sxs-lookup"><span data-stu-id="7f677-146">GoldCloud2</span></span> | <p><span data-ttu-id="7f677-147">ND</span><span class="sxs-lookup"><span data-stu-id="7f677-147">NA</span></span></p><p></p> | <p><span data-ttu-id="7f677-148">LogicalNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="7f677-148">LogicalNetwork1-NewYork</span></span></p><p><span data-ttu-id="7f677-149">LogicalNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-149">LogicalNetwork1-Chicago</span></span></p>
<span data-ttu-id="7f677-150">SilverCloud2</span><span class="sxs-lookup"><span data-stu-id="7f677-150">SilverCloud2</span></span> | <p><span data-ttu-id="7f677-151">ND</span><span class="sxs-lookup"><span data-stu-id="7f677-151">NA</span></span></p><p></p> | <p><span data-ttu-id="7f677-152">LogicalNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="7f677-152">LogicalNetwork1-NewYork</span></span></p><p><span data-ttu-id="7f677-153">LogicalNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-153">LogicalNetwork1-Chicago</span></span></p>

#### <a name="logical-and-vm-network-settings"></a><span data-ttu-id="7f677-154">Impostazioni di rete VM e logica</span><span class="sxs-lookup"><span data-stu-id="7f677-154">Logical and VM network settings</span></span>

<span data-ttu-id="7f677-155">**Posizione**</span><span class="sxs-lookup"><span data-stu-id="7f677-155">**Location**</span></span> | <span data-ttu-id="7f677-156">**Rete logica**</span><span class="sxs-lookup"><span data-stu-id="7f677-156">**Logical network**</span></span> | <span data-ttu-id="7f677-157">**Rete VM associata**</span><span class="sxs-lookup"><span data-stu-id="7f677-157">**Associated VM network**</span></span>
---|---|---
<span data-ttu-id="7f677-158">New York</span><span class="sxs-lookup"><span data-stu-id="7f677-158">New York</span></span> | <span data-ttu-id="7f677-159">LogicalNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="7f677-159">LogicalNetwork1-NewYork</span></span> | <span data-ttu-id="7f677-160">VMNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="7f677-160">VMNetwork1-NewYork</span></span>
<span data-ttu-id="7f677-161">Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-161">Chicago</span></span> | <span data-ttu-id="7f677-162">LogicalNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-162">LogicalNetwork1-Chicago</span></span> | <span data-ttu-id="7f677-163">VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-163">VMNetwork1-Chicago</span></span>
 | <span data-ttu-id="7f677-164">LogicalNetwork2Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-164">LogicalNetwork2Chicago</span></span> | <span data-ttu-id="7f677-165">VMNetwork2-Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-165">VMNetwork2-Chicago</span></span>

#### <a name="target-network-settings"></a><span data-ttu-id="7f677-166">Impostazioni di rete di destinazione</span><span class="sxs-lookup"><span data-stu-id="7f677-166">Target network settings</span></span>

<span data-ttu-id="7f677-167">In base a queste impostazioni, quando si seleziona la rete VM di destinazione, nella tabella seguente sono mostrate le opzioni che saranno disponibili.</span><span class="sxs-lookup"><span data-stu-id="7f677-167">Based on these settings, when you select the target VM network, the following table shows the choices that will be available.</span></span>

<span data-ttu-id="7f677-168">**Selezionare**</span><span class="sxs-lookup"><span data-stu-id="7f677-168">**Select**</span></span> | <span data-ttu-id="7f677-169">**Cloud protetto**</span><span class="sxs-lookup"><span data-stu-id="7f677-169">**Protected cloud**</span></span> | <span data-ttu-id="7f677-170">**Protezione del cloud**</span><span class="sxs-lookup"><span data-stu-id="7f677-170">**Protecting cloud**</span></span> | <span data-ttu-id="7f677-171">**Rete di destinazione disponibili**</span><span class="sxs-lookup"><span data-stu-id="7f677-171">**Target network available**</span></span>
---|---|---|---
<span data-ttu-id="7f677-172">VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-172">VMNetwork1-Chicago</span></span> | <span data-ttu-id="7f677-173">SilverCloud1</span><span class="sxs-lookup"><span data-stu-id="7f677-173">SilverCloud1</span></span> | <span data-ttu-id="7f677-174">SilverCloud2</span><span class="sxs-lookup"><span data-stu-id="7f677-174">SilverCloud2</span></span> | <span data-ttu-id="7f677-175">Disponibile</span><span class="sxs-lookup"><span data-stu-id="7f677-175">Available</span></span>
 | <span data-ttu-id="7f677-176">GoldCloud1</span><span class="sxs-lookup"><span data-stu-id="7f677-176">GoldCloud1</span></span> | <span data-ttu-id="7f677-177">GoldCloud2</span><span class="sxs-lookup"><span data-stu-id="7f677-177">GoldCloud2</span></span> | <span data-ttu-id="7f677-178">Disponibile</span><span class="sxs-lookup"><span data-stu-id="7f677-178">Available</span></span>
<span data-ttu-id="7f677-179">VMNetwork2-Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-179">VMNetwork2-Chicago</span></span> | <span data-ttu-id="7f677-180">SilverCloud1</span><span class="sxs-lookup"><span data-stu-id="7f677-180">SilverCloud1</span></span> | <span data-ttu-id="7f677-181">SilverCloud2</span><span class="sxs-lookup"><span data-stu-id="7f677-181">SilverCloud2</span></span> | <span data-ttu-id="7f677-182">Non disponibile</span><span class="sxs-lookup"><span data-stu-id="7f677-182">Not available</span></span>
 | <span data-ttu-id="7f677-183">GoldCloud1</span><span class="sxs-lookup"><span data-stu-id="7f677-183">GoldCloud1</span></span> | <span data-ttu-id="7f677-184">GoldCloud2</span><span class="sxs-lookup"><span data-stu-id="7f677-184">GoldCloud2</span></span> | <span data-ttu-id="7f677-185">Disponibile</span><span class="sxs-lookup"><span data-stu-id="7f677-185">Available</span></span>


<span data-ttu-id="7f677-186">Se la rete di destinazione dispone di più subnet e una di esse ha lo stesso nome della subnet in cui si trova la macchina virtuale di origine, la macchina virtuale di replica sarà connessa a tale subnet di destinazione dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="7f677-186">If the target network has multiple subnets and one of those subnets has the same name as the subnet on which the source virtual machine is located, then the replica virtual machine will be connected to that target subnet after failover.</span></span> <span data-ttu-id="7f677-187">Se non è presente una subnet di destinazione con un nome corrispondente, la macchina virtuale sarà connessa alla prima subnet della rete.</span><span class="sxs-lookup"><span data-stu-id="7f677-187">If there’s no target subnet with a matching name, the virtual machine will be connected to the first subnet in the network.</span></span>


#### <a name="failback-behavior"></a><span data-ttu-id="7f677-188">Comportamento di failback</span><span class="sxs-lookup"><span data-stu-id="7f677-188">Failback behavior</span></span>

<span data-ttu-id="7f677-189">Per vedere cosa succede in caso di failback (replica inversa), si supponga che venga eseguito il mapping di VMNetwork1-NewYork a VMNetwork1-Chicago, con le impostazioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="7f677-189">To see what happens in the case of failback (reverse replication), let’s assume that VMNetwork1-NewYork is mapped to VMNetwork1-Chicago, with the following settings.</span></span>


<span data-ttu-id="7f677-190">**Macchina virtuale**</span><span class="sxs-lookup"><span data-stu-id="7f677-190">**Virtual machine**</span></span> | <span data-ttu-id="7f677-191">**Connessa alla rete VM**</span><span class="sxs-lookup"><span data-stu-id="7f677-191">**Connected to VM network**</span></span>
---|---
<span data-ttu-id="7f677-192">VM1</span><span class="sxs-lookup"><span data-stu-id="7f677-192">VM1</span></span> | <span data-ttu-id="7f677-193">VMNetwork1-Network</span><span class="sxs-lookup"><span data-stu-id="7f677-193">VMNetwork1-Network</span></span>
<span data-ttu-id="7f677-194">VM2 (replica di VM1)</span><span class="sxs-lookup"><span data-stu-id="7f677-194">VM2 (replica of VM1)</span></span> | <span data-ttu-id="7f677-195">VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-195">VMNetwork1-Chicago</span></span>

<span data-ttu-id="7f677-196">Con queste impostazioni esaminare cosa accade in un paio di scenari possibili.</span><span class="sxs-lookup"><span data-stu-id="7f677-196">With these settings, let's review what happens in a couple of possible scenarios.</span></span>

<span data-ttu-id="7f677-197">**Scenario**</span><span class="sxs-lookup"><span data-stu-id="7f677-197">**Scenario**</span></span> | <span data-ttu-id="7f677-198">**Risultato**</span><span class="sxs-lookup"><span data-stu-id="7f677-198">**Outcome**</span></span>
---|---
<span data-ttu-id="7f677-199">Nessuna modifica nelle proprietà della rete di VM-2 dopo il failover</span><span class="sxs-lookup"><span data-stu-id="7f677-199">No change in the network properties of VM-2 after failover.</span></span> | <span data-ttu-id="7f677-200">VM-1 rimane connessa alla rete di origine.</span><span class="sxs-lookup"><span data-stu-id="7f677-200">VM-1 remains connected to the source network.</span></span>
<span data-ttu-id="7f677-201">Le proprietà di rete di VM-2 cambiano dopo il failover e la macchina virtuale viene disconnessa </span><span class="sxs-lookup"><span data-stu-id="7f677-201">Network properties of VM-2 are changed after failover and is disconnected.</span></span> | <span data-ttu-id="7f677-202">VM-1 viene disconnessa</span><span class="sxs-lookup"><span data-stu-id="7f677-202">VM-1 is disconnected.</span></span>
<span data-ttu-id="7f677-203">Le proprietà di rete di VM-2 cambiano dopo il failover e la macchina virtuale viene connessa a VMNetwork2-Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-203">Network properties of VM-2 are changed after failover and is connected to VMNetwork2-Chicago.</span></span> | <span data-ttu-id="7f677-204">Se non viene eseguito il mapping di VMNetwork2-Chicago, VM-1 verrà disconnessa</span><span class="sxs-lookup"><span data-stu-id="7f677-204">If VMNetwork2-Chicago isn’t mapped, VM-1 will be disconnected.</span></span>
<span data-ttu-id="7f677-205">Il mapping di rete di VMNetwork1-Chicago viene modificato</span><span class="sxs-lookup"><span data-stu-id="7f677-205">Network mapping of VMNetwork1-Chicago is changed.</span></span> | <span data-ttu-id="7f677-206">VM-1 verrà connessa alla rete ora mappata a VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="7f677-206">VM-1 will be connected to the network now mapped to VMNetwork1-Chicago.</span></span>



## <a name="prepare-for-network-mapping"></a><span data-ttu-id="7f677-207">Preparare il mapping di rete</span><span class="sxs-lookup"><span data-stu-id="7f677-207">Prepare for network mapping</span></span>

1. <span data-ttu-id="7f677-208">Nei server VMM di origine e destinazione è necessario disporre di una rete logica associata ai cloud di origine e destinazione.</span><span class="sxs-lookup"><span data-stu-id="7f677-208">On the source and target VMM servers, you should have a logical network associated with the source and target clouds.</span></span> 
2. <span data-ttu-id="7f677-209">Nei server di origine e destinazione è necessario disporre di una rete della macchina virtuale collegata alla rete logica.</span><span class="sxs-lookup"><span data-stu-id="7f677-209">In the source and target servers, you should have a VM network linked to the logical network.</span></span>
3. <span data-ttu-id="7f677-210">Le macchine virtuali sugli host Hyper-V nella località di origine devono essere collegate alla rete della macchina virtuale di origine.</span><span class="sxs-lookup"><span data-stu-id="7f677-210">VMs on Hyper-V hosts in the source location should be linked to the source VM network.</span></span> <span data-ttu-id="7f677-211">Se si usa solo un singolo server VMM, è possibile configurare il mapping tra le reti delle macchine virtuali nello stesso server.</span><span class="sxs-lookup"><span data-stu-id="7f677-211">If you're only using a single VMM server, you can configure mapping between VM networks on the same server.</span></span>

<span data-ttu-id="7f677-212">Di seguito è riportato ciò che accede se si configura il mapping di rete durante la distribuzione di Site Recovery:</span><span class="sxs-lookup"><span data-stu-id="7f677-212">Here's what happens when you set up network mapping during Site Recovery deployment:</span></span>

- <span data-ttu-id="7f677-213">Quando si configura il mapping di rete e si seleziona una rete della macchina virtuale di destinazione, verranno visualizzati i cloud di origine VMM che usano la rete della macchina virtuale di origine insieme alle reti della macchina virtuale di destinazione disponibili nei cloud di destinazione.</span><span class="sxs-lookup"><span data-stu-id="7f677-213">When you set up network mapping and select a target VM network, the VMM source clouds that use the source VM network will be displayed, along with the available target VM networks on the target clouds.</span></span>
- - <span data-ttu-id="7f677-214">Se il mapping di rete è configurato correttamente e la replica è abilitata, una macchina virtuale di origine verrà connessa alla rete della macchina virtuale di origine e la relativa replica nella località di destinazione verrà connessa alla rete mappata della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="7f677-214">When mapping is configured correctly and replication is enabled, a source VM will be connected to its source VM network, and its replica at the target location will be connected to its mapped VM network.</span></span>
- <span data-ttu-id="7f677-215">Se la rete di destinazione dispone di più subnet e una di esse ha lo stesso nome della subnet in cui si trova la macchina virtuale di origine, la macchina virtuale di replica sarà connessa a tale subnet di destinazione dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="7f677-215">If the target network has multiple subnets, and one of those subnets has the same name as the subnet on which the source virtual machine is located, then the replica virtual machine will be connected to that target subnet after failover.</span></span> <span data-ttu-id="7f677-216">Se non è presente una subnet di destinazione con un nome corrispondente, la macchina virtuale sarà connessa alla prima subnet della rete.</span><span class="sxs-lookup"><span data-stu-id="7f677-216">If there’s no target subnet with a matching name, the VM will be connected to the first subnet in the network.</span></span>

## <a name="connect-to-vms-after-failover"></a><span data-ttu-id="7f677-217">Connettersi alle macchine virtuali dopo il failover</span><span class="sxs-lookup"><span data-stu-id="7f677-217">Connect to VMs after failover</span></span>

<span data-ttu-id="7f677-218">Quando si pianifica la strategia di replica e di failover, una delle domande principali che ci si deve porre riguarda la modalità di connessione alla replica dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="7f677-218">When planning your replication and failover strategy, one of the key questions is how to connect to the replica after failover.</span></span> <span data-ttu-id="7f677-219">Vi sono due possibilità:</span><span class="sxs-lookup"><span data-stu-id="7f677-219">There are a couple of choices:</span></span> 

- <span data-ttu-id="7f677-220">**Usare un indirizzo IP diverso**: è possibile scegliere di usare un indirizzo IP diverso per la macchina virtuale replicata.</span><span class="sxs-lookup"><span data-stu-id="7f677-220">**Use a different IP address**: You can select to use a different IP address for the replicated VM.</span></span> <span data-ttu-id="7f677-221">In questo scenario, la VM ottiene un nuovo indirizzo IP dopo il failover ed è necessario un aggiornamento del DNS.</span><span class="sxs-lookup"><span data-stu-id="7f677-221">In this scenario the VM gets a new IP address after failover, and a DNS update is required.</span></span>
- <span data-ttu-id="7f677-222">**Mantenere lo stesso indirizzo IP**: è possibile usare lo stesso indirizzo IP per la macchina virtuale di replica.</span><span class="sxs-lookup"><span data-stu-id="7f677-222">**Retain the same IP address**: You might want to use the same IP address for the replica VM.</span></span> <span data-ttu-id="7f677-223">Il mantenimento degli stessi indirizzi IP semplifica il ripristino riducendo i problemi di rete dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="7f677-223">Keeping the same IP addresses simplifies the recovery by reducing network related issues after failover.</span></span> 

## <a name="retain-ip-addresses"></a><span data-ttu-id="7f677-224">Mantenere gli indirizzi IP</span><span class="sxs-lookup"><span data-stu-id="7f677-224">Retain IP addresses</span></span>

<span data-ttu-id="7f677-225">Se si desidera mantenere gli indirizzi IP dal sito primario dopo il failover nel sito secondario, è possibile eseguire un failover completo della subnet e aggiornare le route per indicare la nuova località degli indirizzi IP, o in alternativa distribuire una subnet estesa tra i siti primari e di ripristino.</span><span class="sxs-lookup"><span data-stu-id="7f677-225">If you want to retain the IP addresses from the primary site after failover to the secondary site, you can do a full subnet failover, and update routes to indicate the new location of the IP addresses, or alternative deploy a stretched subnet between the primary and the recovery sites.</span></span>

### <a name="stretched-subnet"></a><span data-ttu-id="7f677-226">Subnet estesa</span><span class="sxs-lookup"><span data-stu-id="7f677-226">Stretched subnet</span></span>

<span data-ttu-id="7f677-227">In una subnet estesa, la subnet è disponibile contemporaneamente sia nel sito primario che in quello secondario.</span><span class="sxs-lookup"><span data-stu-id="7f677-227">In a stretched subnet, the subnet is available simultaneously in both the primary and secondary site.</span></span> <span data-ttu-id="7f677-228">Se si sposta un server e la relativa configurazione IP (livello 3) nel sito secondario, la rete instraderà automaticamente il traffico nella nuova località.</span><span class="sxs-lookup"><span data-stu-id="7f677-228">If you move a server and its IP (Layer 3) configuration to the secondary site, the network will route the traffic to the new location automatically.</span></span> 

<span data-ttu-id="7f677-229">Dalla prospettiva del livello 2 (data-link layer), è necessario disporre di apparecchiature di rete in grado di gestire una VLAN estesa.</span><span class="sxs-lookup"><span data-stu-id="7f677-229">From a Layer 2 (data link layer) perspective, you need networking equipment that can manage a stretched VLAN.</span></span> <span data-ttu-id="7f677-230">Inoltre, estendendo la VLAN, si estende il dominio di errore potenziale in entrambi i siti, creando in sostanza un singolo punto di errore.</span><span class="sxs-lookup"><span data-stu-id="7f677-230">In addition, by stretching the VLAN, the potential fault domain extends to both sites, essentially becoming a single point of failure.</span></span> <span data-ttu-id="7f677-231">Tuttavia, l'eventualità di una broadcast storm impossibile da isolare è alquanto improbabile.</span><span class="sxs-lookup"><span data-stu-id="7f677-231">While this is an unlikely, it could happen that a broadcast storm started and cannot be isolated.</span></span> 


### <a name="subnet-failover"></a><span data-ttu-id="7f677-232">Failover sulla subnet</span><span class="sxs-lookup"><span data-stu-id="7f677-232">Subnet failover</span></span>

<span data-ttu-id="7f677-233">È possibile eseguire un failover su subnet per ottenere i vantaggi della subnet estesa senza effettivamente estenderla.</span><span class="sxs-lookup"><span data-stu-id="7f677-233">You can run a subnet failover to obtain the benefits of the stretched subnet, without actually stretching it.</span></span> <span data-ttu-id="7f677-234">In questa soluzione una subnet sarà disponibile nel sito di origine o destinazione, ma non in entrambi contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="7f677-234">In this solution, a subnet will be available in the source or target site, but not at both simultaneously.</span></span> <span data-ttu-id="7f677-235">Per mantenere lo spazio degli indirizzi IP in caso di failover, è possibile programmare l'infrastruttura del router per lo spostamento delle subnet da un sito a un altro.</span><span class="sxs-lookup"><span data-stu-id="7f677-235">To maintain the IP address space in the event of a failover, you can programmatically arrange for the router infrastructure to move the subnets from one site to another.</span></span> <span data-ttu-id="7f677-236">Quando si verifica il failover, le subnet si spostano con le macchine virtuali associate.</span><span class="sxs-lookup"><span data-stu-id="7f677-236">After when failover occurs, subnets would move with the associated VMs.</span></span> <span data-ttu-id="7f677-237">Il principale svantaggio è che in caso di errore è necessario spostare l'intera subnet.</span><span class="sxs-lookup"><span data-stu-id="7f677-237">The main drawback is that in the event of a failure, you have to move the whole subnet.</span></span>

### <a name="example"></a><span data-ttu-id="7f677-238">Esempio</span><span class="sxs-lookup"><span data-stu-id="7f677-238">Example</span></span>

<span data-ttu-id="7f677-239">Di seguito è riportato un esempio di failover su subnet completo.</span><span class="sxs-lookup"><span data-stu-id="7f677-239">Here's an example of complete subnet failover.</span></span> <span data-ttu-id="7f677-240">Il sito primario dispone di applicazioni in esecuzione nella subnet 192.168.1.0/24.</span><span class="sxs-lookup"><span data-stu-id="7f677-240">The primary site has applications running in subnet 192.168.1.0/24.</span></span> <span data-ttu-id="7f677-241">In caso di failover, viene eseguito il failover di tutte le macchine virtuali in questa subnet nel sito secondario. Gli indirizzi IP vengono conservati.</span><span class="sxs-lookup"><span data-stu-id="7f677-241">At failover, all the VMs in this subnet are failed over to the secondary site, and retain their IP addresses.</span></span> <span data-ttu-id="7f677-242">Le route devono essere modificate in modo da rispecchiare il fatto che tutte le macchine virtuali appartenenti alla subnet 192.168.1.0/24 sono state spostate nel sito secondario.</span><span class="sxs-lookup"><span data-stu-id="7f677-242">Routes need to be modified to reflect the fact that all the VM virtual machines belonging to subnet 192.168.1.0/24 have now moved to the secondary site.</span></span>

<span data-ttu-id="7f677-243">Il grafico seguente mostra le subnet prima e dopo il failover:</span><span class="sxs-lookup"><span data-stu-id="7f677-243">The following graphics show the subnets before and after failover:</span></span>

- <span data-ttu-id="7f677-244">Prima del failover, la subnet 192.168.0.1/24 è attiva nel sito di origine e diventa attiva nel sito secondario dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="7f677-244">Before failover, subnet 192.168.0.1/24 is active on the source site, become active on the secondary site after failover.</span></span>
- <span data-ttu-id="7f677-245">Le route tra il sito primario e il sito di ripristino, il terzo sito e il sito primario e il terzo sito e il sito di ripristino dovranno essere modificate in modo appropriato.</span><span class="sxs-lookup"><span data-stu-id="7f677-245">The routes between primary site and recovery site, third site and primary site, and third site and recovery site will have to be appropriately modified.</span></span>

<span data-ttu-id="7f677-246">**Prima del failover**</span><span class="sxs-lookup"><span data-stu-id="7f677-246">**Before failover**</span></span>

![Prima del failover](./media/vmm-to-vmm-walkthrough-network/network-design2.png)

<span data-ttu-id="7f677-248">**Dopo il failover**</span><span class="sxs-lookup"><span data-stu-id="7f677-248">**After failover**</span></span>

![Dopo il failover](./media/vmm-to-vmm-walkthrough-network/network-design3.png)

<span data-ttu-id="7f677-250">Di seguito è illustrato ciò che accade dopo il failover:</span><span class="sxs-lookup"><span data-stu-id="7f677-250">After failover, here's what happens:</span></span>

- <span data-ttu-id="7f677-251">Site Recovery consente di allocare un indirizzo IP per ciascuna interfaccia di rete nella macchina virtuale dal pool di indirizzi IP statici nella rete pertinente per ciascuna istanza VMM.</span><span class="sxs-lookup"><span data-stu-id="7f677-251">Site Recovery allocates an IP address for each network interface on the VM, from the static IP address pool in the relevant network, for each VMM instance.</span></span>
- <span data-ttu-id="7f677-252">Se il pool di indirizzi IP nel sito secondario è uguale a quello del sito di origine, Site Recovery alloca lo stesso indirizzo IP (della macchina virtuale di origine) alla macchina virtuale di replica.</span><span class="sxs-lookup"><span data-stu-id="7f677-252">If the IP address pool in the secondary site is the same as that on the source site, Site Recovery allocates the same IP address (of the source VM) to the replica VM.</span></span> <span data-ttu-id="7f677-253">L'indirizzo IP è riservato in VMM, ma non è impostato come indirizzo IP di failover nell'host Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="7f677-253">The IP address is reserved in VMM, but it isn't set as the failover IP address on the Hyper-V host.</span></span> <span data-ttu-id="7f677-254">L'indirizzo IP di failover nell'host Hyper-V viene impostato subito prima del failover.</span><span class="sxs-lookup"><span data-stu-id="7f677-254">The failover IP address on a Hyper-v host is set just before the failover.</span></span>
- <span data-ttu-id="7f677-255">Se lo stesso indirizzo IP non è disponibile, Site Recovery dovrà allocare un altro indirizzo IP disponibile dal pool.</span><span class="sxs-lookup"><span data-stu-id="7f677-255">If the same IP address isn't available, Site Recovery allocates another available IP address from the pool.</span></span>
- <span data-ttu-id="7f677-256">Se le macchine virtuali usano DHCP, Site Recovery non gestisce gli indirizzi IP.</span><span class="sxs-lookup"><span data-stu-id="7f677-256">If VMs use DHCP, Site Recovery doesn't manage the IP addresses.</span></span> <span data-ttu-id="7f677-257">È necessario verificare che il server DHCP nel sito secondario possa allocare l'indirizzo dallo stesso intervallo come sito di origine.</span><span class="sxs-lookup"><span data-stu-id="7f677-257">You need to check that the DHCP server on the secondary site can allocate address from the same range as the source site.</span></span>

### <a name="validate-the-ip-address"></a><span data-ttu-id="7f677-258">Convalidare l'indirizzo IP</span><span class="sxs-lookup"><span data-stu-id="7f677-258">Validate the IP address</span></span>

<span data-ttu-id="7f677-259">Dopo aver abilitato la protezione per una macchina virtuale, è possibile usare i seguenti script di esempio per verificare l'indirizzo assegnato alla macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="7f677-259">After you enable protection for a VM, you can use following sample script to verify the address assigned to the VM.</span></span> <span data-ttu-id="7f677-260">Lo stesso indirizzo IP verrà impostato come indirizzo IP di failover e assegnato alla macchina vituale al momento del failover:</span><span class="sxs-lookup"><span data-stu-id="7f677-260">The same IP address will be set as the failover IP address, and assigned to the VM at the time of failover:</span></span>

    ```
    $vm = Get-SCVirtualMachine -Name <VM_NAME>
    $na = $vm[0].VirtualNetworkAdapters>
    $ip = Get-SCIPAddress -GrantToObjectID $na[0].id
    $ip.address 
    ```

## <a name="changing-ip-addresses"></a><span data-ttu-id="7f677-261">Modifica degli indirizzi IP</span><span class="sxs-lookup"><span data-stu-id="7f677-261">Changing IP addresses</span></span>

<span data-ttu-id="7f677-262">In questo scenario, vengono modificati gli indirizzi IP delle macchine virtuali di cui eseguire il failover.</span><span class="sxs-lookup"><span data-stu-id="7f677-262">In this scenario, the IP addresses of VMs that fail over are changed.</span></span> <span data-ttu-id="7f677-263">Lo svantaggio di questa soluzione è la manutenzione necessaria.</span><span class="sxs-lookup"><span data-stu-id="7f677-263">The drawback of this solution is the maintenance required.</span></span> <span data-ttu-id="7f677-264">In genere, DNS verrà aggiornato dopo l'avvio delle macchine virtuali di replica.</span><span class="sxs-lookup"><span data-stu-id="7f677-264">Typically, DNS will be updated after replica VMs start.</span></span> <span data-ttu-id="7f677-265">Le voci DNS potrebbero dover essere modificate nelle rete e le voci memorizzate nella cache aggiornate.</span><span class="sxs-lookup"><span data-stu-id="7f677-265">DNS entries might need to be changed or fluster in thenetwork, and cached entries updated.</span></span> <span data-ttu-id="7f677-266">Ciò può comportare tempi di inattività.</span><span class="sxs-lookup"><span data-stu-id="7f677-266">This can result in downtime.</span></span> <span data-ttu-id="7f677-267">Il tempo di inattività può essere contrastato come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="7f677-267">Downtime can be mitigated as follows:</span></span>

- <span data-ttu-id="7f677-268">Usare valori TTL bassi per le applicazioni Intranet.</span><span class="sxs-lookup"><span data-stu-id="7f677-268">Use low TTL values for intranet applications.</span></span>
- <span data-ttu-id="7f677-269">Usare lo script seguente in un piano di ripristino Site Recovery per aggiornare il server DNS in modo da garantire un aggiornamento tempestivo.</span><span class="sxs-lookup"><span data-stu-id="7f677-269">Use the following script in a Site Recovery recovery plan, to update the DNS server to ensure a timely update.</span></span> <span data-ttu-id="7f677-270">Se si usa la registrazione DNS dinamica non è necessario lo script.</span><span class="sxs-lookup"><span data-stu-id="7f677-270">You don't need the script if you use dynamic DNS registration.</span></span>

    ```
    param(
    string]$Zone,
    [string]$name,
    [string]$IP
    )
    $Record = Get-DnsServerResourceRecord -ZoneName $zone -Name $name
    $newrecord = $record.clone()
    $newrecord.RecordData[0].IPv4Address  =  $IP
    Set-DnsServerResourceRecord -zonename $zone -OldInputObject $record -NewInputObject $Newrecord
    ```
    
### <a name="example"></a><span data-ttu-id="7f677-271">Esempio</span><span class="sxs-lookup"><span data-stu-id="7f677-271">Example</span></span> 

<span data-ttu-id="7f677-272">Esaminiamo uno scenario in cui si prevede di usare diversi indirizzi IP nei siti primari e di recupero. In questo esempio sono disponibili diversi indirizzi IP nei siti primari e secondari, inoltre vi è un terzo sito da cui accedere alle applicazioni ospitate nel sito primario o di ripristino.</span><span class="sxs-lookup"><span data-stu-id="7f677-272">Let's look at a scenario in which you're planning to use different IP addresses across the primary and the recovery sites.In this example we have different IP addresses across primary and secondary sites, and there;s a third site from which applications hosted on the primary or recovery site can be accessed.</span></span>

- <span data-ttu-id="7f677-273">Prima del failover, le app sono ospitate sulla subnet 192.168.1.0/24 nel sito primario e sono configurate per essere spostate sulla subnet 172.16.1.0/24 nel sito secondario dopo un failover.</span><span class="sxs-lookup"><span data-stu-id="7f677-273">Before failover, apps are hosted subnet 192.168.1.0/24 on the primary site, and are configured to be in subnet 172.16.1.0/24 on the secondary site after a failover.</span></span>
- <span data-ttu-id="7f677-274">La configurazione dei percorsi di rete o delle connessioni VPN è avvenuta in modo corretto, pertanto tutti e tre i siti dispongono dell'accesso reciproco.</span><span class="sxs-lookup"><span data-stu-id="7f677-274">VPN connections/network routes have been configured appropriately so that all three sites can access each other.</span></span>
- <span data-ttu-id="7f677-275">Dopo il failover, le app verranno ripristinate nella subnet di ripristino.</span><span class="sxs-lookup"><span data-stu-id="7f677-275">After failover, apps will be restored in the recovery subnet.</span></span> <span data-ttu-id="7f677-276">In questo scenario non occorre eseguire il failover dell'intera subnet e non sono necessarie modifiche per riconfigurare le route della VPN o di rete.</span><span class="sxs-lookup"><span data-stu-id="7f677-276">In this scenario there's no need to fail over the entire subnet, and no changes are needed to reconfigure VPN or network routes.</span></span> <span data-ttu-id="7f677-277">Il failover e alcuni aggiornamenti DNS verificheranno che le applicazioni rimangano accessibili.</span><span class="sxs-lookup"><span data-stu-id="7f677-277">The failover, and some DNS updates, ensure that applications remain accessible.</span></span>
- <span data-ttu-id="7f677-278">Se il DNS è configurato per consentire aggiornamenti dinamici, le macchine virtuali si registreranno con il nuovo indirizzo IP una volta avviate dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="7f677-278">If DNS is configured to allow dynamic updates, then the VMs will register themselves using the new IP address, when they start after failover.</span></span>

<span data-ttu-id="7f677-279">**Prima del failover**</span><span class="sxs-lookup"><span data-stu-id="7f677-279">**Before failover**</span></span>

![Indirizzo IP diverso - Prima del failover](./media/vmm-to-vmm-walkthrough-network/network-design10.png)

<span data-ttu-id="7f677-281">**Dopo il failover**</span><span class="sxs-lookup"><span data-stu-id="7f677-281">**After failover**</span></span>

![Indirizzo IP diverso - Dopo il failover](./media/vmm-to-vmm-walkthrough-network/network-design11.png)



## <a name="next-steps"></a><span data-ttu-id="7f677-283">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="7f677-283">Next steps</span></span>

<span data-ttu-id="7f677-284">Andare al [Passaggio 4: Preparare VMM e Hyper-V](vmm-to-vmm-walkthrough-vmm-hyper-v.md).</span><span class="sxs-lookup"><span data-stu-id="7f677-284">Go to [Step 4: Prepare VMM and Hyper-V](vmm-to-vmm-walkthrough-vmm-hyper-v.md).</span></span>


