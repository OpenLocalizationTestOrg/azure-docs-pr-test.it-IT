---
title: gli eventi del ciclo di vita del servizio di Cloud aaaHandle | Documenti Microsoft
description: Informazioni su come hello del ciclo di vita di un ruolo del servizio Cloud possono essere utilizzati in .NET
services: cloud-services
documentationcenter: .net
author: Thraka
manager: timlt
editor: 
ms.assetid: 39b30acd-57b9-48b7-a7c4-40ea3430e451
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/18/2017
ms.author: adegeo
ms.openlocfilehash: cc0ccc5f055b965202b6e081a6ab72ad5d39b034
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="customize-hello-lifecycle-of-a-web-or-worker-role-in-net"></a><span data-ttu-id="2b72b-103">Personalizzare hello del ciclo di vita di un ruolo Web o di lavoro in .NET</span><span class="sxs-lookup"><span data-stu-id="2b72b-103">Customize hello Lifecycle of a Web or Worker role in .NET</span></span>
<span data-ttu-id="2b72b-104">Quando si crea un ruolo di lavoro, si estende hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) classe che fornisce metodi per l'utente toooverride che consentono di rispondere a eventi toolifecycle.</span><span class="sxs-lookup"><span data-stu-id="2b72b-104">When you create a worker role, you extend hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class which provides methods for you toooverride that let you respond toolifecycle events.</span></span> <span data-ttu-id="2b72b-105">Per i ruoli web questa classe è facoltativa, è necessario utilizzare toorespond toolifecycle eventi.</span><span class="sxs-lookup"><span data-stu-id="2b72b-105">For web roles this class is optional, so you must use it toorespond toolifecycle events.</span></span>

## <a name="extend-hello-roleentrypoint-class"></a><span data-ttu-id="2b72b-106">Estendere una classe RoleEntryPoint hello</span><span class="sxs-lookup"><span data-stu-id="2b72b-106">Extend hello RoleEntryPoint class</span></span>
<span data-ttu-id="2b72b-107">Hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) classe include metodi che vengono chiamati da Azure quando si **inizia**, **esegue**, o **Arresta** un ruolo web o di lavoro.</span><span class="sxs-lookup"><span data-stu-id="2b72b-107">hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class includes methods that are called by Azure when it **starts**, **runs**, or **stops** a web or worker role.</span></span> <span data-ttu-id="2b72b-108">Facoltativamente, è possibile ignorare questi metodi toomanage ruolo inizializzazione, sequenze di arresto di ruolo o thread di esecuzione hello del ruolo hello.</span><span class="sxs-lookup"><span data-stu-id="2b72b-108">You can optionally override these methods toomanage role initialization, role shutdown sequences, or hello execution thread of hello role.</span></span> 

<span data-ttu-id="2b72b-109">Quando si estende **RoleEntryPoint**, è necessario essere consapevoli di hello seguenti comportamenti dei metodi di hello:</span><span class="sxs-lookup"><span data-stu-id="2b72b-109">When extending **RoleEntryPoint**, you should be aware of hello following behaviors of hello methods:</span></span>

* <span data-ttu-id="2b72b-110">Hello [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) e [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) metodi restituiscono un valore booleano, pertanto è possibile tooreturn **false** da questi metodi.</span><span class="sxs-lookup"><span data-stu-id="2b72b-110">hello [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) and [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) methods return a boolean value, so it is possible tooreturn **false** from these methods.</span></span>
  
   <span data-ttu-id="2b72b-111">Se il codice restituisce **false**, processo del ruolo hello viene terminato bruscamente, senza eseguire qualsiasi sequenza di arresto è possibile sul posto.</span><span class="sxs-lookup"><span data-stu-id="2b72b-111">If your code returns **false**, hello role process is abruptly terminated, without running any shutdown sequence you may have in place.</span></span> <span data-ttu-id="2b72b-112">In generale, è consigliabile evitare la restituzione **false** da hello **OnStart** metodo.</span><span class="sxs-lookup"><span data-stu-id="2b72b-112">In general, you should avoid returning **false** from hello **OnStart** method.</span></span>
* <span data-ttu-id="2b72b-113">Qualsiasi eccezione non rilevata all'interno di un overload di un metodo **RoleEntryPoint** viene considerato come un'eccezione non gestita.</span><span class="sxs-lookup"><span data-stu-id="2b72b-113">Any uncaught exception within an overload of a **RoleEntryPoint** method is treated as an unhandled exception.</span></span>
  
   <span data-ttu-id="2b72b-114">Se si verifica un'eccezione all'interno di uno dei metodi del ciclo di vita di hello, Azure genererà hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) evento, e quindi viene terminato il processo di hello.</span><span class="sxs-lookup"><span data-stu-id="2b72b-114">If an exception occurs within one of hello lifecycle methods, Azure will raise hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event, and then hello process is terminated.</span></span> <span data-ttu-id="2b72b-115">Quando il ruolo viene portato offline, viene riavviato da Azure.</span><span class="sxs-lookup"><span data-stu-id="2b72b-115">After your role has been taken offline, it will be restarted by Azure.</span></span> <span data-ttu-id="2b72b-116">Quando un'eccezione non gestita si verifica, hello [arresto](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) evento non viene generato e hello **OnStop** non viene chiamato.</span><span class="sxs-lookup"><span data-stu-id="2b72b-116">When an unhandled exception occurs, hello [Stopping](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) event is not raised, and hello **OnStop** method is not called.</span></span>

<span data-ttu-id="2b72b-117">Se il ruolo non si avvia, oppure il riciclo tra hello durante l'inizializzazione, occupati e arresto di stati, il codice potrebbe generare un'eccezione non gestita all'interno di uno degli eventi del ciclo di vita hello che ogni ruolo di hello ora viene riavviato.</span><span class="sxs-lookup"><span data-stu-id="2b72b-117">If your role does not start, or is recycling between hello initializing, busy, and stopping states, your code may be throwing an unhandled exception within one of hello lifecycle events each time hello role restarts.</span></span> <span data-ttu-id="2b72b-118">In questo caso, utilizzare hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) toodetermine evento hello causa dell'eccezione hello e gestirlo in modo appropriato.</span><span class="sxs-lookup"><span data-stu-id="2b72b-118">In this case, use hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event toodetermine hello cause of hello exception and handle it appropriately.</span></span> <span data-ttu-id="2b72b-119">Il ruolo potrebbe restituire anche da hello [eseguire](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) (metodo), provocando toorestart ruolo hello.</span><span class="sxs-lookup"><span data-stu-id="2b72b-119">Your role may also be returning from hello [Run](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) method, which causes hello role toorestart.</span></span> <span data-ttu-id="2b72b-120">Per ulteriori informazioni sugli stati di distribuzione, vedere [tooRecycle comuni problemi che causa ruoli](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span><span class="sxs-lookup"><span data-stu-id="2b72b-120">For more information about deployment states, see [Common Issues Which Cause Roles tooRecycle](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span></span>

> [!NOTE]
> <span data-ttu-id="2b72b-121">Se si utilizza hello **strumenti di Azure per Microsoft Visual Studio** toodevelop l'applicazione, modelli di progetto di ruolo hello estendono automaticamente hello **RoleEntryPoint** classe, hello *WebRole.cs* e *WorkerRole.cs* file.</span><span class="sxs-lookup"><span data-stu-id="2b72b-121">If you are using hello **Azure Tools for Microsoft Visual Studio** toodevelop your application, hello role project templates automatically extend hello **RoleEntryPoint** class for you, in hello *WebRole.cs* and *WorkerRole.cs* files.</span></span>
> 
> 

## <a name="onstart-method"></a><span data-ttu-id="2b72b-122">Metodo OnStart</span><span class="sxs-lookup"><span data-stu-id="2b72b-122">OnStart method</span></span>
<span data-ttu-id="2b72b-123">Hello **OnStart** metodo viene chiamato quando l'istanza del ruolo viene portata online da Azure.</span><span class="sxs-lookup"><span data-stu-id="2b72b-123">hello **OnStart** method is called when your role instance is brought online by Azure.</span></span> <span data-ttu-id="2b72b-124">Durante l'esecuzione di codice OnStart hello, l'istanza del ruolo hello è contrassegnato come **occupato** sia tooit diretto dal servizio di bilanciamento del carico hello alcun traffico esterno.</span><span class="sxs-lookup"><span data-stu-id="2b72b-124">While hello OnStart code is executing, hello role instance is marked as **Busy** and no external traffic will be directed tooit by hello load balancer.</span></span> <span data-ttu-id="2b72b-125">È possibile eseguire l'override di questo operazioni di inizializzazione tooperform (metodo), ad esempio l'implementazione dei gestori eventi e l'avvio di [diagnostica Azure](cloud-services-how-to-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="2b72b-125">You can override this method tooperform initialization work, such as implementing event handlers and starting [Azure Diagnostics](cloud-services-how-to-monitor.md).</span></span>

<span data-ttu-id="2b72b-126">Se **OnStart** restituisce **true**, istanza hello è inizializzata correttamente e Azure chiama hello **Roleentrypoint** metodo.</span><span class="sxs-lookup"><span data-stu-id="2b72b-126">If **OnStart** returns **true**, hello instance is successfully initialized and Azure calls hello **RoleEntryPoint.Run** method.</span></span> <span data-ttu-id="2b72b-127">Se **OnStart** restituisce **false**, ruolo hello termina immediatamente, senza l'esecuzione di tutte le sequenze di arresto pianificato.</span><span class="sxs-lookup"><span data-stu-id="2b72b-127">If **OnStart** returns **false**, hello role terminates immediately, without executing any planned shutdown sequences.</span></span>

<span data-ttu-id="2b72b-128">Hello seguente come esempio di codice hello toooverride **OnStart** metodo.</span><span class="sxs-lookup"><span data-stu-id="2b72b-128">hello following code example shows how toooverride hello **OnStart** method.</span></span> <span data-ttu-id="2b72b-129">Questo metodo configura e avvia un monitor di diagnostica quando l'istanza del ruolo hello viene avviato e impostato il trasferimento di account di archiviazione di dati tooa di registrazione:</span><span class="sxs-lookup"><span data-stu-id="2b72b-129">This method configures and starts a diagnostic monitor when hello role instance starts and sets up a transfer of logging data tooa storage account:</span></span>

```csharp
public override bool OnStart()
{
    var config = DiagnosticMonitor.GetDefaultInitialConfiguration();

    config.DiagnosticInfrastructureLogs.ScheduledTransferLogLevelFilter = LogLevel.Error;
    config.DiagnosticInfrastructureLogs.ScheduledTransferPeriod = TimeSpan.FromMinutes(5);

    DiagnosticMonitor.Start("DiagnosticsConnectionString", config);

    return true;
}
```

## <a name="onstop-method"></a><span data-ttu-id="2b72b-130">Metodo OnStop</span><span class="sxs-lookup"><span data-stu-id="2b72b-130">OnStop method</span></span>
<span data-ttu-id="2b72b-131">Hello **OnStop** metodo viene chiamato quando un'istanza del ruolo viene portata offline da Azure e prima dell'uscita dal processo hello.</span><span class="sxs-lookup"><span data-stu-id="2b72b-131">hello **OnStop** method is called after a role instance has been taken offline by Azure and before hello process exits.</span></span> <span data-ttu-id="2b72b-132">È possibile eseguire l'override di questo codice toocall metodo necessario per toocleanly di istanza del ruolo arrestato.</span><span class="sxs-lookup"><span data-stu-id="2b72b-132">You can override this method toocall code required for your role instance toocleanly shut down.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="2b72b-133">Il codice in esecuzione in hello **OnStop** metodo ha un periodo di tempo limitato di toofinish quando viene chiamato per motivi diversi da un arresto avviato dall'utente.</span><span class="sxs-lookup"><span data-stu-id="2b72b-133">Code running in hello **OnStop** method has a limited time toofinish when it is called for reasons other than a user-initiated shutdown.</span></span> <span data-ttu-id="2b72b-134">Trascorso tale tempo, hello processo viene terminato, pertanto è necessario assicurarsi che il codice in hello **OnStop** metodo possa essere eseguito rapidamente o tollerata toocompletion non è in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="2b72b-134">After this time elapses, hello process is terminated, so you must make sure that code in hello **OnStop** method can run quickly or tolerates not running toocompletion.</span></span> <span data-ttu-id="2b72b-135">Hello **OnStop** metodo viene chiamato dopo hello **arresto** viene generato l'evento.</span><span class="sxs-lookup"><span data-stu-id="2b72b-135">hello **OnStop** method is called after hello **Stopping** event is raised.</span></span>
> 
> 

## <a name="run-method"></a><span data-ttu-id="2b72b-136">Metodo Run</span><span class="sxs-lookup"><span data-stu-id="2b72b-136">Run method</span></span>
<span data-ttu-id="2b72b-137">È possibile eseguire l'override di hello **eseguire** metodo tooimplement un thread di lunga durata per l'istanza del ruolo.</span><span class="sxs-lookup"><span data-stu-id="2b72b-137">You can override hello **Run** method tooimplement a long-running thread for your role instance.</span></span>

<span data-ttu-id="2b72b-138">Si esegue l'override di hello **eseguire** metodo non è obbligatorio; l'implementazione predefinita di hello avvia un thread in costante stato di sospensione.</span><span class="sxs-lookup"><span data-stu-id="2b72b-138">Overriding hello **Run** method is not required; hello default implementation starts a thread that sleeps forever.</span></span> <span data-ttu-id="2b72b-139">Se si esegue l'override di hello **eseguire** (metodo), il codice dovrebbe bloccarsi per un periodo illimitato.</span><span class="sxs-lookup"><span data-stu-id="2b72b-139">If you do override hello **Run** method, your code should block indefinitely.</span></span> <span data-ttu-id="2b72b-140">Se hello **eseguire** metodo viene restituito, hello ruolo automaticamente normalmente riciclato; in altre parole, Azure hello **arresto** eventi e chiamate hello **OnStop** metodo in modo che è possibile eseguire le sequenze di arresto prima hello ruolo venga portato offline.</span><span class="sxs-lookup"><span data-stu-id="2b72b-140">If hello **Run** method returns, hello role is automatically gracefully recycled; in other words, Azure raises hello **Stopping** event and calls hello **OnStop** method so that your shutdown sequences may be executed before hello role is taken offline.</span></span>

### <a name="implementing-hello-aspnet-lifecycle-methods-for-a-web-role"></a><span data-ttu-id="2b72b-141">Implementazione dei metodi del ciclo di vita ASP.NET hello per un ruolo web</span><span class="sxs-lookup"><span data-stu-id="2b72b-141">Implementing hello ASP.NET lifecycle methods for a web role</span></span>
<span data-ttu-id="2b72b-142">È possibile utilizzare metodi del ciclo di vita ASP.NET hello, inoltre toothose fornito da hello **RoleEntryPoint** classe toomanage sequenze di inizializzazione e di arresto per un ruolo web.</span><span class="sxs-lookup"><span data-stu-id="2b72b-142">You can use hello ASP.NET lifecycle methods, in addition toothose provided by hello **RoleEntryPoint** class, toomanage initialization and shutdown sequences for a web role.</span></span> <span data-ttu-id="2b72b-143">Potrebbe essere utile per motivi di compatibilità se si trasferisce un tooAzure di applicazioni ASP.NET esistenti.</span><span class="sxs-lookup"><span data-stu-id="2b72b-143">This may be useful for compatibility purposes if you are porting an existing ASP.NET application tooAzure.</span></span> <span data-ttu-id="2b72b-144">metodi del ciclo di vita ASP.NET Hello vengano chiamati dall'interno di hello **RoleEntryPoint** metodi.</span><span class="sxs-lookup"><span data-stu-id="2b72b-144">hello ASP.NET lifecycle methods are called from within hello **RoleEntryPoint** methods.</span></span> <span data-ttu-id="2b72b-145">Hello **applicazione\_avviare** metodo viene chiamato dopo hello **Roleentrypoint** al termine di metodo.</span><span class="sxs-lookup"><span data-stu-id="2b72b-145">hello **Application\_Start** method is called after hello **RoleEntryPoint.OnStart** method finishes.</span></span> <span data-ttu-id="2b72b-146">Hello **applicazione\_fine** metodo viene chiamato prima hello **Roleentrypoint** metodo viene chiamato.</span><span class="sxs-lookup"><span data-stu-id="2b72b-146">hello **Application\_End** method is called before hello **RoleEntryPoint.OnStop** method is called.</span></span>

## <a name="next-steps"></a><span data-ttu-id="2b72b-147">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="2b72b-147">Next steps</span></span>
<span data-ttu-id="2b72b-148">Informazioni su come troppo[creare un pacchetto del servizio cloud](cloud-services-model-and-package.md).</span><span class="sxs-lookup"><span data-stu-id="2b72b-148">Learn how too[create a cloud service package](cloud-services-model-and-package.md).</span></span>

