---
title: aaaHow tooconfigure toouse di applicazione un Proxy dell'applicazione la delega vincolata Kerberos | Documenti Microsoft
description: Come tooconfigure la delega vincolata Kerberos per un'applicazione Proxy dell'applicazione AD Azure.
services: active-directory
documentationcenter: 
author: ajamess
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/11/2017
ms.author: asteen
ms.openlocfilehash: 93dac264ff1d3b99dead1d9c759c37c59373cbd4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooconfigure-an-application-proxy-application-toouse-kerberos-constrained-delegation"></a><span data-ttu-id="050e7-103">Come tooconfigure un toouse applicazione Proxy dell'applicazione la delega vincolata Kerberos</span><span class="sxs-lookup"><span data-stu-id="050e7-103">How tooconfigure an Application Proxy application toouse Kerberos Constrained Delegation</span></span>

<span data-ttu-id="050e7-104">Hello metodi disponibili per la realizzazione di applicazioni possono variare leggermente da tooapplication applicazione e una delle opzioni di hello che il Proxy di applicazione di Azure offre subito hello, toopublished SSO è la delega vincolata Kerberos (KCD).</span><span class="sxs-lookup"><span data-stu-id="050e7-104">hello methods available for achieving SSO toopublished applications can somewhat vary from application tooapplication and one of hello options that Azure Application Proxy offers right out of hello box, is Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="050e7-105">Questo è in un host di connettore è configurato tooperform vincolata kerberos authentication toobackend applicazioni, per conto degli utenti.</span><span class="sxs-lookup"><span data-stu-id="050e7-105">This is where a connector host is configured tooperform constrained kerberos authentication toobackend applications, on behalf of users.</span></span>

<span data-ttu-id="050e7-106">procedura effettiva di Hello per abilitare la delega vincolata Kerberos è relativamente semplice e in genere non richiede più di una conoscenza generale di hello vari componenti e flusso di autenticazione che facilita la SSO.</span><span class="sxs-lookup"><span data-stu-id="050e7-106">hello actual procedure for enabling KCD is relatively straightforward and typically requires no more than a general understanding of hello various components and authentication flow that facilitates SSO.</span></span> <span data-ttu-id="050e7-107">Ricerca fonte di informazioni toohelp risolvere scenari in cui KCD SSO non funziona come previsto, può essere di tipo sparse.</span><span class="sxs-lookup"><span data-stu-id="050e7-107">Finding good sources of information toohelp troubleshoot scenarios where KCD SSO doesn’t function as expected, can be sparse.</span></span>

<span data-ttu-id="050e7-108">Di conseguenza, questo articolo si tooprovide un singolo punto di riferimento che consentono di risolvere i problemi e risoluzione automatica di alcuni dei problemi più comuni di hello che vedremo.</span><span class="sxs-lookup"><span data-stu-id="050e7-108">As such, this article attempts tooprovide a single point of reference that should help troubleshoot and self-remediate some of hello most common issues that we see.</span></span> <span data-ttu-id="050e7-109">Hello stesse ora offerta ulteriori linee guida per la diagnosi di hello più complessa e realtà dell'implementazione.</span><span class="sxs-lookup"><span data-stu-id="050e7-109">At hello same time offer additional guidance for diagnosing hello more complex and troubled of implementation.</span></span>

<span data-ttu-id="050e7-110">Si noti che questo articolo rende hello seguenti presupposti:</span><span class="sxs-lookup"><span data-stu-id="050e7-110">note that this article makes hello following assumptions:</span></span>

-   <span data-ttu-id="050e7-111">Proxy dell'applicazione Azure è stata distribuita come per il nostro [documentazione](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) e applicazioni di accesso generale toonon la delega vincolata Kerberos funziona come previsto.</span><span class="sxs-lookup"><span data-stu-id="050e7-111">Azure Application Proxy has been deployed as per our [documentation](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) and general access toonon KCD applications is working as expected.</span></span>

-   <span data-ttu-id="050e7-112">applicazione di destinazione pubblicato Hello è basato sull'implementazione di IIS e di Microsoft di kerberos.</span><span class="sxs-lookup"><span data-stu-id="050e7-112">hello published target application is based on IIS and Microsoft’s implementation of kerberos.</span></span>

-   <span data-ttu-id="050e7-113">gli host di server e dell'applicazione Hello risiedere in un singolo dominio di Active Directory.</span><span class="sxs-lookup"><span data-stu-id="050e7-113">hello server and application hosts reside in a single Active Directory domain.</span></span> <span data-ttu-id="050e7-114">Informazioni dettagliate sugli scenari tra domini e foreste sono disponibili nel nostro [white paper sulla delega vincolata Kerberos](http://aka.ms/KCDPaper).</span><span class="sxs-lookup"><span data-stu-id="050e7-114">Detailed information on cross domain and forest scenarios can be found in our [KCD whitepaper](http://aka.ms/KCDPaper).</span></span>

-   <span data-ttu-id="050e7-115">Hello soggetto applicazione viene pubblicata in un Azure tenant con la preautenticazione abilitata e gli utenti sono previsti l'autenticazione basata su tooAzure tooauthenticate mediante i moduli.</span><span class="sxs-lookup"><span data-stu-id="050e7-115">hello subject application is published in an Azure tenant with pre-authentication enabled, and users are expected tooauthenticate tooAzure via forms based authentication.</span></span> <span data-ttu-id="050e7-116">Scenari di autenticazione rich client non sono trattati in questo articolo, ma essere aggiunti a un certo punto in hello future.</span><span class="sxs-lookup"><span data-stu-id="050e7-116">Rich client authentication scenarios are not covered by this article, but be added at some point in hello future.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="050e7-117">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="050e7-117">Prerequisites</span></span>

<span data-ttu-id="050e7-118">Proxy dell'applicazione Azure può essere distribuito in pressoché qualsiasi tipo di infrastruttura o le architetture di ambiente e hello senza dubbio variano da tooorganization dell'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="050e7-118">Azure Application Proxy can be deployed into pretty much any type of infrastructure or environment and hello architectures no doubt vary from organization tooorganization.</span></span> <span data-ttu-id="050e7-119">Una delle cause più comuni di hello della delega vincolata Kerberos relative a problemi non sono in ambienti di hello autonomamente, ma piuttosto semplice configurazioni errate o supervisione generale.</span><span class="sxs-lookup"><span data-stu-id="050e7-119">One of hello most common causes of KCD related issues are not hello environments themselves, but rather simple mis-configurations, or general oversight.</span></span>

<span data-ttu-id="050e7-120">Per questo motivo, i suggerimenti sono sempre toostart, verificare di aver soddisfatto tutti hello prerequisiti disposti nel nostro main [tramite la delega vincolata Kerberos SSO con articolo Proxy dell'applicazione hello](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) prima di avviare la risoluzione dei problemi.</span><span class="sxs-lookup"><span data-stu-id="050e7-120">For this reason, our advice is always toostart by making sure you have met all hello pre-requisites laid out in our main [Using KCD SSO with hello Application Proxy article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) before starting troubleshooting.</span></span>

<span data-ttu-id="050e7-121">In particolare hello della sezione su come configurare la delega vincolata Kerberos nella versione 2012 R2, come si utilizza un approccio fondamentalmente diverso tooconfiguring la delega vincolata Kerberos, nelle versioni precedenti di Windows, ma anche in considerazione diverse altre considerazioni sulla modalità:</span><span class="sxs-lookup"><span data-stu-id="050e7-121">Particularly hello section on configuring KCD on 2012R2, as this employs a fundamentally different approach tooconfiguring KCD on previous versions of Windows, but also while being mindful of several other considerations:</span></span>

-   <span data-ttu-id="050e7-122">Non è raro che un tooopen server membro di dominio una finestra di dialogo canale protetto con un controller di dominio specifico.</span><span class="sxs-lookup"><span data-stu-id="050e7-122">It is not uncommon for a domain member server tooopen a secure channel dialog with a specific domain controller.</span></span> <span data-ttu-id="050e7-123">Spostare quindi tooanother finestra di dialogo in qualsiasi momento, quindi host connettore in genere non dovrebbe essere limitato toobeing toocommunicate in grado di con i controller di dominio specifici del sito locale.</span><span class="sxs-lookup"><span data-stu-id="050e7-123">Then move tooanother dialog at any given time, so connector hosts should generally not be restricted toobeing able toocommunicate with only specific local site DCs.</span></span>

-   <span data-ttu-id="050e7-124">Simile toohello sopra punto, gli scenari tra domini si basano su riferimenti che indirizzano un tooDCs host connettore che potrebbero essere presenti di fuori di perimetro della rete locale hello.</span><span class="sxs-lookup"><span data-stu-id="050e7-124">Similar toohello above point, cross domain scenarios rely on referrals that direct a connector host tooDCs that may reside outside of hello local network perimeter.</span></span> <span data-ttu-id="050e7-125">In questo scenario è ugualmente importante toomake che sono anche consentire il traffico a partire tooDCs che rappresentano altri rispettivi domini, altrimenti la delega non riuscire.</span><span class="sxs-lookup"><span data-stu-id="050e7-125">In this scenario it is equally important toomake sure you are also allowing traffic onwards tooDCs that represent other respective domains, or else delegation fail.</span></span>

-   <span data-ttu-id="050e7-126">Laddove possibile, è consigliabile evitare di posizionare dispositivi IPS/IDS attivi tra gli host del connettore e i controller di dominio, in quanto sono spesso altamente intrusivi e interferiscono con il traffico RPC di base</span><span class="sxs-lookup"><span data-stu-id="050e7-126">Where possible, you should avoid placing any active IPS/IDS devices between connector hosts and DCs, as these are sometimes over intrusive and interfere with core RPC traffic</span></span>

<span data-ttu-id="050e7-127">In quanto desideriamo tooresolve problemi rapidamente e in effetti, può richiedere tempo, pertanto laddove possibile provare e si hello più semplice di scenari di test di delega.</span><span class="sxs-lookup"><span data-stu-id="050e7-127">As much as we’d like tooresolve issues quickly and effectively, it can take time, so where possible you should try and test delegation in hello simplest of scenarios.</span></span> <span data-ttu-id="050e7-128">salve altre variabili che occorrerà, hello più potrebbe essere toocontend con.</span><span class="sxs-lookup"><span data-stu-id="050e7-128">hello more variables you introduce, hello more you may have toocontend with.</span></span> <span data-ttu-id="050e7-129">Ad esempio, limitando il testing tooa singolo connettore consente di risparmiare tempo prezioso e connettori aggiuntivi possono essere aggiunti dopo la risoluzione di problemi di hello.</span><span class="sxs-lookup"><span data-stu-id="050e7-129">For example, limiting your testing tooa single connector can save valuable time, and additional connectors can be added after hello issues has been resolved.</span></span>

<span data-ttu-id="050e7-130">Alcuni fattori ambientali possono inoltre contribuire tooan problema, quindi nuovamente se è possibile limitare i hello architettura tooa ridotta al minimo per il test.</span><span class="sxs-lookup"><span data-stu-id="050e7-130">Some environmental factors may also be contributing tooan issue, so again if possible try and minimize hello architecture tooa bare minimum for testing.</span></span> <span data-ttu-id="050e7-131">Ad esempio, i firewall interno configurato in modo errato gli ACL non sono comuni, pertanto, se possibile disporre di tutto il traffico da un connettore consentito direttamente attraverso i controller di dominio toohello e applicazione back-end.</span><span class="sxs-lookup"><span data-stu-id="050e7-131">For example, misconfigured internal firewall ACLs are not uncommon, so if possible have all traffic from a connector allowed straight through toohello DCs and backend application.</span></span> 

<span data-ttu-id="050e7-132">In realtà hello assoluto migliore sul posto tooposition i connettori è vicino destinazioni tootheir come può essere.</span><span class="sxs-lookup"><span data-stu-id="050e7-132">Actually hello absolute best place tooposition connectors is as close tootheir targets as can be.</span></span> <span data-ttu-id="050e7-133">La presenza di un firewall inline durante i test aggiunge inutili complessità e potrebbe prolungare le indagini.</span><span class="sxs-lookup"><span data-stu-id="050e7-133">Having a firewall sat inline whilst testing simply adds unnecessary complexity, and could just prolong your investigations.</span></span>

<span data-ttu-id="050e7-134">In sostanza, che cosa costituisce un problema di delega vincolata Kerberos?</span><span class="sxs-lookup"><span data-stu-id="050e7-134">So, what constitutes a KCD problem anyway?</span></span> <span data-ttu-id="050e7-135">Bene, non esiste più indicazioni classiche di SSO KCD esito negativo e hello segni prima di un problema in genere manifestano sotto hello browser.</span><span class="sxs-lookup"><span data-stu-id="050e7-135">Well, there several classic indications of KCD SSO failing and hello first signs of an issue usually manifest themselves in hello browser.</span></span>

   ![Errore di configurazione della delega vincolata Kerberos](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic1.png)

   ![Autorizzazione non riuscita a causa di autorizzazioni toomissing](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic2.png)

<span data-ttu-id="050e7-138">tutti che presentino hello stesso sintomo di esito negativo tooperform SSO e di conseguenza negazione hello applicazione toohello di accesso utente.</span><span class="sxs-lookup"><span data-stu-id="050e7-138">all which bear hello same symptom of failing tooperform SSO, and consequently denying hello user access toohello application.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="050e7-139">Risoluzione dei problemi</span><span class="sxs-lookup"><span data-stu-id="050e7-139">Troubleshooting</span></span>

<span data-ttu-id="050e7-140">La modalità quindi risolvere il problema dipende dal problema hello e sintomi osservati.</span><span class="sxs-lookup"><span data-stu-id="050e7-140">How you then troubleshoot depend on hello issue and observed symptoms.</span></span> <span data-ttu-id="050e7-141">Prima di passare qualsiasi ulteriore sarebbe suggeriamo hello seguenti collegamenti, in quanto contengono informazioni utili, che potrebbe non ancora provenire tra:</span><span class="sxs-lookup"><span data-stu-id="050e7-141">Before going any further we would suggest hello following links, as they contain useful information you may not yet have come across:</span></span>

-   [<span data-ttu-id="050e7-142">Risolvere i problemi e i messaggi di errore del proxy dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="050e7-142">Troubleshoot Application Proxy problems and error messages</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot)

-   [<span data-ttu-id="050e7-143">Errori di Kerberos</span><span class="sxs-lookup"><span data-stu-id="050e7-143">Kerberos errors and symptoms</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot#kerberos-errors)

-   [<span data-ttu-id="050e7-144">Utilizzo dell'accesso Single Sign-On quando le identità cloud e locali non sono identiche</span><span class="sxs-lookup"><span data-stu-id="050e7-144">Working with SSO when on-premises and cloud identities are not identical</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd#working-with-sso-when-on-premises-and-cloud-identities-are-not-identical)

<span data-ttu-id="050e7-145">Se si dispone di questa misura, quindi hello principale problema sicuramente esiste.</span><span class="sxs-lookup"><span data-stu-id="050e7-145">If you’ve got this far, then hello main issue definitely exists.</span></span> <span data-ttu-id="050e7-146">È necessario toodig più approfondita, quindi avviare separando flusso hello in tre fasi distinte che è possibile risolvere.</span><span class="sxs-lookup"><span data-stu-id="050e7-146">You need toodig deeper, so start by separating hello flow into three distinct stages that you can troubleshoot.</span></span>

<span data-ttu-id="050e7-147">**pre-L'autenticazione di client** -utente esterno di hello autenticazione tooAzure tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="050e7-147">**Client pre-authentication** - hello external user authenticating tooAzure via a browser.</span></span>

<span data-ttu-id="050e7-148">Essere in grado di toopre-autenticazione tooAzure è fondamentale per toofunction KCD SSO.</span><span class="sxs-lookup"><span data-stu-id="050e7-148">Being able toopre-authenticate tooAzure is imperative for KCD SSO toofunction.</span></span> <span data-ttu-id="050e7-149">Questa fase deve essere verificata e gestita in prima istanza, in presenza di errori.</span><span class="sxs-lookup"><span data-stu-id="050e7-149">This should be tested and addressed first, if there are any issues.</span></span> <span data-ttu-id="050e7-150">Si noti che fase di pre-autenticazione hello non ha alcuna relazione tooKCD o hello pubblicata l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="050e7-150">Note that hello pre-authentication stage has no relation tooKCD or hello published application.</span></span> <span data-ttu-id="050e7-151">Deve essere abbastanza semplice toocorrect eventuali discrepanze dall'integrità hello soggetto conto corrente esiste in Azure e non è disabilitato o bloccato.</span><span class="sxs-lookup"><span data-stu-id="050e7-151">It should be fairly easy toocorrect any discrepancies by sanity checking hello subject account exists in Azure, and that it is not disabled/blocked.</span></span> <span data-ttu-id="050e7-152">risposta di errore Hello nel browser hello è causa di hello toounderstand in genere sufficientemente descrittivo.</span><span class="sxs-lookup"><span data-stu-id="050e7-152">hello error response in hello browser is usually descriptive enough toounderstand hello cause.</span></span> <span data-ttu-id="050e7-153">Se non si è certi, è inoltre possibile verificare il nostro altri tooverify di documenti di risolvere il problema.</span><span class="sxs-lookup"><span data-stu-id="050e7-153">You can also check our other Troubleshoot docs tooverify if you aren’t sure.</span></span>

<span data-ttu-id="050e7-154">**Servizio di delega** -hello connettore del Proxy di Azure ottenere kerberos ticket di servizio da un KDC (centro distribuzione Kerberos), per conto degli utenti.</span><span class="sxs-lookup"><span data-stu-id="050e7-154">**Delegation service** - hello Azure Proxy connector obtaining a kerberos service ticket from a KDC (Kerberos Distribution Center), on behalf of users.</span></span>

<span data-ttu-id="050e7-155">le comunicazioni esterne Hello tra client hello e hello Azure front-end non dovrebbero avere alcun impatto sulla delega vincolata Kerberos, qualsiasi diverso da garantire che il funzionamento.</span><span class="sxs-lookup"><span data-stu-id="050e7-155">hello external communications between hello client and hello Azure front end should have no bearing on KCD whatsoever, other than ensuring that it works.</span></span> <span data-ttu-id="050e7-156">Si tratta pertanto hello servizio Proxy di Azure può essere fornita con un ID utente valido che tooobtain usato un ticket kerberos.</span><span class="sxs-lookup"><span data-stu-id="050e7-156">This is so hello Azure Proxy service can be provided with a valid user ID that be used tooobtain a kerberos ticket.</span></span> <span data-ttu-id="050e7-157">Senza questa delega vincolata Kerberos non sarebbe possibile e l'operazione avrebbe esito negativo.</span><span class="sxs-lookup"><span data-stu-id="050e7-157">Without this KCD is not possible and would fail.</span></span>

<span data-ttu-id="050e7-158">Come indicato in precedenza, i messaggi di errore di hello browser forniscono in genere alcuni indizi buona sul motivo per cui operazioni non sono stati superati.</span><span class="sxs-lookup"><span data-stu-id="050e7-158">As mentioned previously, hello browser error messages usually provide some good clues on why things are failing.</span></span> <span data-ttu-id="050e7-159">Verificare che toonote all'ID attività hello e timestamp in risposta hello come in questo modo gli eventi di tooactual toocorrelate hello comportamento nel registro eventi di hello Azure Proxy.</span><span class="sxs-lookup"><span data-stu-id="050e7-159">Make sure toonote down hello activity ID and timestamp in hello response as this allow you toocorrelate hello behavior tooactual events in hello Azure Proxy event log.</span></span>

   ![Errore di configurazione della delega vincolata Kerberos](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic3.png)

<span data-ttu-id="050e7-161">E le voci corrispondenti verrebbe visualizzato il registro eventi di hello visto come eventi 13019 o 12027 hello.</span><span class="sxs-lookup"><span data-stu-id="050e7-161">And hello corresponding entries seen hello event log would be seen as events 13019 or 12027.</span></span> <span data-ttu-id="050e7-162">È possibile trovare i registri eventi connettore in hello **registri applicazioni e servizi** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Connettore**&gt;**Admin**.</span><span class="sxs-lookup"><span data-stu-id="050e7-162">You can find hello connector event logs in **Applications and Services Logs** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Connector**&gt;**Admin**.</span></span>

   ![Evento 13019 del log eventi del proxy dell'applicazione](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic4.png)

   ![Evento 12027 del log eventi del proxy dell'applicazione](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic5.png)

-   <span data-ttu-id="050e7-165">Utilizzare un record nel sistema DNS interno per l'indirizzo dell'applicazione hello e non un record CName</span><span class="sxs-lookup"><span data-stu-id="050e7-165">Use an A record in your internal DNS for hello application’s address, and not a CName</span></span>

-   <span data-ttu-id="050e7-166">Riconfermare che ospitano connettore hello è stata concessa hello diritti toodelegate toohello designato SPN dell'account di destinazione e che **utilizza un qualsiasi protocollo di autenticazione** è selezionata.</span><span class="sxs-lookup"><span data-stu-id="050e7-166">Re-confirm that hello connector host has been granted hello rights toodelegate toohello designated target account’s SPN, and that **Use any authentication protocol** is selected.</span></span> <span data-ttu-id="050e7-167">Questo argomento è trattato nel nostro articolo principale sulla [configurazione di SSO](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span><span class="sxs-lookup"><span data-stu-id="050e7-167">This is covered in our main [SSO configuration article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span></span>

-   <span data-ttu-id="050e7-168">Verificare che sia presente una sola istanza di hello SPN esistenti in Active Directory eseguendo un **setspn - x** da un prompt dei comandi in qualsiasi host membro di dominio</span><span class="sxs-lookup"><span data-stu-id="050e7-168">Verify that there is only a single instance of hello SPN in existence in AD by issuing a **setspn -x** from a cmd prompt on any domain member host</span></span>

-   <span data-ttu-id="050e7-169">Controllare toosee se un criterio di dominio viene applicato hello toolimit [dimensione massima di token kerberos emesso](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), come il connettore di hello impedire di ottenere un token, se trovato toobe eccessivo</span><span class="sxs-lookup"><span data-stu-id="050e7-169">Check toosee if a domain policy is being enforced toolimit hello [max size of issued kerberos tokens](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), as this prevent hello connector from obtaining a token if found toobe excessive</span></span>

<span data-ttu-id="050e7-170">Una traccia di rete di acquisizione scambi hello tra host connettore hello e un dominio KDC sarebbe quindi hello migliore passaggio successivo recupero più basso livello dettagli sui problemi di hello.</span><span class="sxs-lookup"><span data-stu-id="050e7-170">A network trace capturing hello exchanges between hello connector host and a domain KDC would then be hello next best step in obtaining more low level detail on hello issues.</span></span> <span data-ttu-id="050e7-171">Queste informazioni sono disponibili nel [white paper di approfondimento sulla risoluzione dei problemi](https://aka.ms/proxytshootpaper).</span><span class="sxs-lookup"><span data-stu-id="050e7-171">You can find this in [deep dive Troubleshoot paper](https://aka.ms/proxytshootpaper).</span></span>

<span data-ttu-id="050e7-172">Se si verificano problemi per le richieste, verrà visualizzato un evento nei registri hello che informa che l'autenticazione non riuscita applicazione toohello restituzione 401.</span><span class="sxs-lookup"><span data-stu-id="050e7-172">If ticketing looks good, you should see an event in hello logs stating that authentication failed due toohello application returning a 401.</span></span> <span data-ttu-id="050e7-173">Ciò indica in genere tale applicazione di destinazione hello rifiuto il ticket, quindi procedere con hello dopo una fase successiva.</span><span class="sxs-lookup"><span data-stu-id="050e7-173">This typically indicates that hello target application rejecting your ticket, so proceed with hello following next stage.</span></span>

<span data-ttu-id="050e7-174">**Applicazione di destinazione** -consumer hello del ticket kerberos hello fornito dal connettore hello</span><span class="sxs-lookup"><span data-stu-id="050e7-174">**Target application** - hello consumer of hello kerberos ticket provided by hello connector</span></span>

<span data-ttu-id="050e7-175">Questo connettore hello fase viene previsto toohave inviato un kerberos ticket toohello back-end, come un'intestazione all'interno di richiesta di hello prima dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="050e7-175">At this stage hello connector is expected toohave sent a kerberos service ticket toohello backend, as a header within hello first application request.</span></span>

-   <span data-ttu-id="050e7-176">Utilizzo dell'applicazione hello URL interno definito nel portale di hello, verificare che un'applicazione hello sia accessibile direttamente dal browser hello in host connettore hello.</span><span class="sxs-lookup"><span data-stu-id="050e7-176">Using hello application’s internal URL defined in hello portal, validate that hello application is accessible directly from hello browser on hello connector host.</span></span> <span data-ttu-id="050e7-177">A questo punto sarà possibile eseguire l'accesso.</span><span class="sxs-lookup"><span data-stu-id="050e7-177">Then you can login successfully.</span></span> <span data-ttu-id="050e7-178">Dettagli su questa operazione sono disponibili nella pagina di risoluzione dei problemi di connettore hello.</span><span class="sxs-lookup"><span data-stu-id="050e7-178">Details on doing this can be found on hello connector Troubleshoot page.</span></span>

-   <span data-ttu-id="050e7-179">Ancora nell'host di connettore hello, verificare che l'autenticazione tra il browser hello hello e un'applicazione hello utilizza kerberos, effettuando una delle seguenti hello:</span><span class="sxs-lookup"><span data-stu-id="050e7-179">Still on hello connector host, confirm that hello authentication between hello browser and hello application is using kerberos, by doing one of hello following:</span></span>

1.  <span data-ttu-id="050e7-180">Eseguire gli strumenti di sviluppo (**F12**) in Internet Explorer o usare [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) dall'host connettore hello.</span><span class="sxs-lookup"><span data-stu-id="050e7-180">Run Dev tools(**F12**) in Internet Explorer, or use [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) from hello connector host.</span></span> <span data-ttu-id="050e7-181">Passare applicazione toohello utilizzando URL interno hello e controllare le intestazioni di autorizzazione WWW restituite in risposta hello da un'applicazione hello offerto hello, tooensure che una negoziazione o kerberos è presente.</span><span class="sxs-lookup"><span data-stu-id="050e7-181">Go toohello application using hello internal URL, and inspect hello offered WWW authorization headers returned in hello response from hello application, tooensure that either negotiate or kerberos is present.</span></span> <span data-ttu-id="050e7-182">Un blob successive kerberos restituito nella risposta hello da hello browser toohello applicazione iniziano in genere con **YII**, pertanto si tratta di una buona indicazione di kerberos in play.</span><span class="sxs-lookup"><span data-stu-id="050e7-182">A subsequent kerberos blob returned in hello response from hello browser toohello application typically start with **YII**, so this is a good indication of kerberos being in play.</span></span> <span data-ttu-id="050e7-183">NTLM su hello invece iniziano sempre con **TlRMTVNTUAAB**, che legge NTLMSSP quando decodificare da Base64.</span><span class="sxs-lookup"><span data-stu-id="050e7-183">NTLM on hello other hand always start with **TlRMTVNTUAAB**, which reads NTLMSSP when decoded from Base64.</span></span> <span data-ttu-id="050e7-184">Se viene visualizzato **TlRMTVNTUAAB** all'avvio di hello del blob hello, ciò significa che Kerberos è **non** disponibili.</span><span class="sxs-lookup"><span data-stu-id="050e7-184">If you see **TlRMTVNTUAAB** at hello start of hello blob, this means that Kerberos is **not** available.</span></span> <span data-ttu-id="050e7-185">In caso contrario, Kerberos dovrebbe essere disponibile.</span><span class="sxs-lookup"><span data-stu-id="050e7-185">If you don’t see this, Kerberos is likely available.</span></span>

  * <span data-ttu-id="050e7-186">Si noti che se si utilizza Fiddler, questo metodo, sarebbe necessario disattivare temporaneamente la protezione estesa sulla configurazione dell'applicazione hello in IIS.</span><span class="sxs-lookup"><span data-stu-id="050e7-186">Note, if using Fiddler, this method would require temporarily disabling extended protection on hello application’s config in IIS.</span></span>

     ![Finestra di controllo di rete del browser](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic6.png)

    <span data-ttu-id="050e7-188">*Figura:* poiché non inizia con TIRMTVNTUAAB, questo esempio indica che Kerberos è disponibile.</span><span class="sxs-lookup"><span data-stu-id="050e7-188">*Figure:* Since this does not start with TIRMTVNTUAAB, this is an example that Kerberos is available.</span></span> <span data-ttu-id="050e7-189">Si tratta di un esempio di un BLOB Kerberos che non inizia con YII.</span><span class="sxs-lookup"><span data-stu-id="050e7-189">This is an example of a Kerberos Blob that doesn’t start with YII.</span></span>

2.  <span data-ttu-id="050e7-190">Rimuovere temporaneamente NTLM dall'elenco di provider di hello in IIS del sito e accesso app direttamente da Internet Explorer nell'host di connettore.</span><span class="sxs-lookup"><span data-stu-id="050e7-190">Temporarily remove NTLM from hello providers list on IIS site and access app directly from IE on connector host.</span></span> <span data-ttu-id="050e7-191">Con NTLM non è più nell'elenco dei provider hello, si dovrebbe essere in grado di tooaccess un'applicazione hello utilizza solo Kerberos.</span><span class="sxs-lookup"><span data-stu-id="050e7-191">With NTLM no longer in hello providers list, you should be able tooaccess hello application using Kerberos only.</span></span> <span data-ttu-id="050e7-192">In caso di errore, che suggerisce che si è verificato un problema con la configurazione dell'applicazione hello e l'autenticazione Kerberos non funziona.</span><span class="sxs-lookup"><span data-stu-id="050e7-192">If this fails, then that suggests that there is a problem with hello application’s configuration and Kerberos authentication is not functioning.</span></span>

<span data-ttu-id="050e7-193">Se Kerberos non è disponibile, l'autenticazione dell'applicazione hello controllo negoziano le impostazioni di IIS toomake che è elencato in primo piano, con NTLM immediatamente di sotto.</span><span class="sxs-lookup"><span data-stu-id="050e7-193">If Kerberos is not available, then check hello application’s authentication settings in IIS toomake sure negotiate is listed topmost, with NTLM just beneath it.</span></span> <span data-ttu-id="050e7-194">(Not Negotiate:kerberos o Negotiate:PKU2U).</span><span class="sxs-lookup"><span data-stu-id="050e7-194">(Not Negotiate:kerberos or Negotiate:PKU2U).</span></span> <span data-ttu-id="050e7-195">Procedere solo se Kerberos funziona.</span><span class="sxs-lookup"><span data-stu-id="050e7-195">Only continue if Kerberos is functional.</span></span>

   ![Provider di autenticazione di Windows](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic7.png)
   
-   <span data-ttu-id="050e7-197">Con Kerberos e NTLM sul posto, consente di disattivare temporaneamente ora pre-autenticazione per un'applicazione hello nel portale di hello.</span><span class="sxs-lookup"><span data-stu-id="050e7-197">With Kerberos and NTLM in place, lets now temporarily disable pre-authentication for hello application in hello portal.</span></span> <span data-ttu-id="050e7-198">Verificare se è possibile accedere da hello internet utilizzando l'URL esterno hello.</span><span class="sxs-lookup"><span data-stu-id="050e7-198">See if you can access it from hello internet using hello external URL.</span></span> <span data-ttu-id="050e7-199">Si dovrebbe essere tooauthenticate richiesta e deve essere in grado di toodo in modo con hello stesso account hello utilizzato in un passaggio precedente.</span><span class="sxs-lookup"><span data-stu-id="050e7-199">You should be prompted tooauthenticate and should be able toodo so with hello same account used in hello previous step.</span></span> <span data-ttu-id="050e7-200">In caso contrario, questo indica un problema con un'applicazione back-end hello e non la delega vincolata Kerberos affatto.</span><span class="sxs-lookup"><span data-stu-id="050e7-200">If not, this indicates a problem with hello backend application and not KCD at all.</span></span>

-   <span data-ttu-id="050e7-201">Ora riabilitare pre-autenticazione nel portale di hello e l'autenticazione tramite Azure mediante il tentativo di applicazione toohello tooconnect tramite URL esterno di.</span><span class="sxs-lookup"><span data-stu-id="050e7-201">Now re-enable pre-authentication in hello portal and authenticate through Azure by attempting tooconnect toohello application via it’s external URL.</span></span> <span data-ttu-id="050e7-202">Se SSO non è riuscita, si dovrebbe vedere un messaggio di errore non consentito nel browser hello più eventi 13022 nel registro hello:</span><span class="sxs-lookup"><span data-stu-id="050e7-202">If SSO has failed, then you should see a forbidden error message in hello browser, plus event 13022 in hello log:</span></span>

    <span data-ttu-id="050e7-203">*Connettore Proxy dell'applicazione Microsoft AAD non può autenticare l'utente hello perché il server di back-end hello risponde tooKerberos i tentativi di autenticazione con un errore HTTP 401.*</span><span class="sxs-lookup"><span data-stu-id="050e7-203">*Microsoft AAD Application Proxy Connector cannot authenticate hello user because hello backend server responds tooKerberos authentication attempts with an HTTP 401 error.*</span></span>

    ![Errore HTTP 401 non consentito](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic8.png)

-   <span data-ttu-id="050e7-205">Controllare il pool di applicazioni configurato hello hello IIS applicazione tooensure è hello toouse configurato stesso account hello SPN è stato configurato in Active Directory, passando in IIS, come illustrato di seguito</span><span class="sxs-lookup"><span data-stu-id="050e7-205">Check hello IIS application tooensure hello configured application pool is configured toouse hello same account that hello SPN has been configured against in AD, by navigating in IIS as illustrated below</span></span>

    ![Finestra di configurazione dell'applicazione IIS](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic9.png)

    <span data-ttu-id="050e7-207">Quando si conosce l'identità di hello, emettere seguente hello da un prompt dei comandi toomake a cmd che questo account viene configurato in modo definito con hello SPN in questione.</span><span class="sxs-lookup"><span data-stu-id="050e7-207">Once you know hello identity, issue hello following from a cmd prompt toomake sure this account is definitely configured with hello SPN in question.</span></span> <span data-ttu-id="050e7-208">Ad esempio, **setspn – q http/spn.wacketywack.com**</span><span class="sxs-lookup"><span data-stu-id="050e7-208">For example,  **setspn – q http/spn.wacketywack.com**</span></span>

    ![Finestra di comando SetSPN](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic10.png)

-   <span data-ttu-id="050e7-210">Verificare che hello SPN definiti in base alle impostazioni dell'applicazione hello portale hello è hello dello stesso nome SPN che è configurato con account di Active Directory di destinazione hello in uso dal pool di applicazioni dell'applicazione hello</span><span class="sxs-lookup"><span data-stu-id="050e7-210">Check that hello SPN defined against hello application’s settings in hello portal is hello same SPN that is configured against hello target AD account in use by hello application’s app pool</span></span>

   ![Configurazione del nome SPN nel Portale di Azure](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic11.png)
   
-   <span data-ttu-id="050e7-212">Andare a IIS e seleziona hello **Editor di configurazione** l'opzione per un'applicazione hello e passare troppo**system.webServer/security/authentication/windowsAuthentication** toomake che tale **UseAppPoolCredentials** è impostato tootrue</span><span class="sxs-lookup"><span data-stu-id="050e7-212">Go into IIS and select hello **Configuration Editor** option for hello application, and navigate too**system.webServer/security/authentication/windowsAuthentication** toomake sure that **UseAppPoolCredentials** is set tootrue</span></span>

   ![Opzione delle credenziali dei pool di applicazioni della configurazione IIS](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic12.png)

<span data-ttu-id="050e7-214">Pur essendo utile per migliorare le prestazioni di hello di operazioni di Kerberos, lasciare abilitata la modalità Kernel causa anche il ticket hello per hello richiesta servizio toobe decrittografati tramite l'account del computer.</span><span class="sxs-lookup"><span data-stu-id="050e7-214">While being useful in improving hello performance of Kerberos operations, leaving Kernel mode enabled also causes hello ticket for hello requested service toobe decrypted using machine account.</span></span> <span data-ttu-id="050e7-215">Sistema locale hello, in modo che l'interruzione di tootrue set anche detta delega vincolata Kerberos quando un'applicazione hello è ospitata in più server in una farm.</span><span class="sxs-lookup"><span data-stu-id="050e7-215">This is also called hello Local system, so having this set tootrue break KCD when hello application is hosted across multiple servers in a farm.</span></span>

-   <span data-ttu-id="050e7-216">Come un'ulteriore verifica, è inoltre possibile hello toodisable **estesi** protezione troppo.</span><span class="sxs-lookup"><span data-stu-id="050e7-216">As an additional check, you may also want toodisable hello **Extended** protection too.</span></span> <span data-ttu-id="050e7-217">Sono stati rilevati gli scenari in cui si ha dimostrato toobreak la delega vincolata Kerberos abilitando configurazioni molto specifiche, in cui un'applicazione viene pubblicata come una sottocartella del sito Web predefinito hello.</span><span class="sxs-lookup"><span data-stu-id="050e7-217">There have been encountered scenarios where this has proved toobreak KCD when enabled in very specific configurations, where an application is published as a sub folder of hello Default Web site.</span></span> <span data-ttu-id="050e7-218">Questa stessa è configurato per l'autenticazione anonima solo, lasciando hello intero le finestre di dialogo visualizzate in grigio suggerendo sarebbero gli oggetti figlio non eredita le impostazioni di active.</span><span class="sxs-lookup"><span data-stu-id="050e7-218">This itself is configured for Anonymous authentication only, leaving hello entire dialogs greyed out suggesting child objects would not be inheriting any active settings.</span></span> <span data-ttu-id="050e7-219">Ma dove possibile, è sempre consigliabile con questa opzione, quindi test, ma non dimenticare toorestore questo tooenabled.</span><span class="sxs-lookup"><span data-stu-id="050e7-219">But where possible we would always recommend having this enabled, so by all means test, but don’t forget toorestore this tooenabled.</span></span>

<span data-ttu-id="050e7-220">Questi controlli aggiuntivi devono avere metterti in toostart traccia tramite l'applicazione pubblicata.</span><span class="sxs-lookup"><span data-stu-id="050e7-220">These additional checks should have put you on track toostart using your published application.</span></span> <span data-ttu-id="050e7-221">È possibile procedere con e selezione di connettori aggiuntivi che sono anche configurato toodelegate, ma se sono presenti ulteriori operazioni è sarebbe preferibile una lettura di questa procedura dettagliata tecnica approfondita [Guida completa di hello per risolvere i problemi di Azure AD applicazione Proxy](https://aka.ms/proxytshootpaper)</span><span class="sxs-lookup"><span data-stu-id="050e7-221">You can go ahead and spin up additional connectors that are also configured toodelegate, but if things are no further then we would suggest a read of our more in-depth technical walkthrough [hello complete guide for Troubleshoot Azure AD Application Proxy](https://aka.ms/proxytshootpaper)</span></span>

<span data-ttu-id="050e7-222">Se si è ancora impossibile tooprogress il problema, supporto potrebbe essere maggiore di tooassist lieta e continuare da qui.</span><span class="sxs-lookup"><span data-stu-id="050e7-222">If you’re still unable tooprogress your issue, support would be more than happy tooassist and continue from here.</span></span> <span data-ttu-id="050e7-223">Creare un ticket di supporto direttamente nel portale di hello e i tecnici raggiungerà tooyou.</span><span class="sxs-lookup"><span data-stu-id="050e7-223">Create a support ticket directly within hello portal and our engineers will reach out tooyou.</span></span>

## <a name="other-scenarios"></a><span data-ttu-id="050e7-224">Altri scenari</span><span class="sxs-lookup"><span data-stu-id="050e7-224">Other scenarios</span></span>

-   <span data-ttu-id="050e7-225">Proxy dell'applicazione di Azure richiede un ticket Kerberos prima di inviare l'applicazione tooan richiesta.</span><span class="sxs-lookup"><span data-stu-id="050e7-225">Azure Application Proxy requests a Kerberos ticket before sending its request tooan application.</span></span> <span data-ttu-id="050e7-226">Alcune applicazioni di terze parti 3rd, ad esempio Server Tableau non desidera che questo metodo di autenticazione e piuttosto prevede hello più tradizionali negoziazioni tootake luogo.</span><span class="sxs-lookup"><span data-stu-id="050e7-226">Some 3rd party applications such as Tableau Server do not like this method of authenticating, and rather expects hello more conventional negotiations tootake place,.</span></span> <span data-ttu-id="050e7-227">prima richiesta Hello è anonima, consentendo di hello applicazione toorespond con tipi di autenticazione hello che supporta tramite 401.</span><span class="sxs-lookup"><span data-stu-id="050e7-227">hello first request is anonymous, allowing hello application toorespond with hello authentication types that it supports through a 401.</span></span>

-   <span data-ttu-id="050e7-228">Autenticazione a doppio hop: generalmente usata negli scenari con applicazioni a livelli, con un back-end e un front-end che richiedono l'autenticazione, ad esempio SQL Reporting Services.</span><span class="sxs-lookup"><span data-stu-id="050e7-228">Double hop authentication - Commonly used in scenarios where an application is tiered, with a backend and front end, both requiring authentication, such as SQL Reporting Services.</span></span>

## <a name="next-steps"></a><span data-ttu-id="050e7-229">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="050e7-229">Next steps</span></span>
[<span data-ttu-id="050e7-230">Configurare la delega vincolata Kerberos (KCD) in un dominio gestito</span><span class="sxs-lookup"><span data-stu-id="050e7-230">Configure kerberos constrained delegation (KCD) on a managed domain</span></span>](https://docs.microsoft.com/azure/active-directory-domain-services/active-directory-ds-enable-kcd)
