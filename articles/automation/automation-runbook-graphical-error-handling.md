---
title: Gestione degli errori nei runbook grafici di Automazione di Azure | Documentazione Microsoft
description: Questo articolo descrive come implementare la logica di gestione degli errori nei runbook grafici di Automazione di Azure.
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: tysonn
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 12/26/2016
ms.author: magoedte
ms.openlocfilehash: 12313f7f245d32c33882f1036f7d4b48bfb3ddc5
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="error-handling-in-azure-automation-graphical-runbooks"></a><span data-ttu-id="0e4ec-103">Gestione degli errori nei runbook grafici di Automazione di Azure</span><span class="sxs-lookup"><span data-stu-id="0e4ec-103">Error handling in Azure Automation graphical runbooks</span></span>

<span data-ttu-id="0e4ec-104">Un elemento fondamentale della progettazione di un runbook è costituito dall'identificazione dei diversi problemi che potrebbero presentarsi in un runbook,</span><span class="sxs-lookup"><span data-stu-id="0e4ec-104">A key runbook design principal to consider is identifying different issues that a runbook might experience.</span></span> <span data-ttu-id="0e4ec-105">ad esempio problemi relativi a esito positivo o negativo, stati di errore previsti e condizioni di errori imprevisti.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-105">These issues can include success, expected error states, and unexpected error conditions.</span></span>

<span data-ttu-id="0e4ec-106">I runbook devono includere logica di gestione degli errori.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-106">Runbooks should include error handling.</span></span> <span data-ttu-id="0e4ec-107">Per convalidare l'output di un'attività o gestire un errore con runbook grafici, è possibile usare un'attività del codice di Windows PowerShell, definire la logica condizionale nel collegamento di output dell'attività o applicare un altro metodo.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-107">To validate the output of an activity or handle an error with graphical runbooks, you could use a Windows PowerShell code activity, define conditional logic on the output link of the activity, or apply another method.</span></span>          

<span data-ttu-id="0e4ec-108">Se è presente un errore non irreversibile che si verifica con un'attività del runbook, eventuali attività successive vengono elaborate indipendentemente dall'errore.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-108">Often, if there is a non-terminating error that occurs with a runbook activity, any activity that follows is processed regardless of the error.</span></span> <span data-ttu-id="0e4ec-109">È probabile che l'errore generi un'eccezione, ma è comunque consentita l'esecuzione dell'attività successiva.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-109">The error is likely to generate an exception, but the next activity is still allowed to run.</span></span> <span data-ttu-id="0e4ec-110">PowerShell è stato progettato in questo modo per la gestione degli errori.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-110">This is the way that PowerShell is designed to handle errors.</span></span>    

<span data-ttu-id="0e4ec-111">Durante l'esecuzione possono verificarsi errori PowerShell di tipo fatale o non fatale.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-111">The types of PowerShell errors that can occur during execution are terminating or non-terminating.</span></span> <span data-ttu-id="0e4ec-112">Ecco le differenze tra errori irreversibili e non irreversibili:</span><span class="sxs-lookup"><span data-stu-id="0e4ec-112">The differences between terminating and non-terminating errors are as follows:</span></span>

* <span data-ttu-id="0e4ec-113">**Errore irreversibile**: errore grave durante l'esecuzione, che arresta completamente il comando o l'esecuzione dello script.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-113">**Terminating error**: A serious error during execution that halts the command (or script execution) completely.</span></span> <span data-ttu-id="0e4ec-114">Gli esempi includono cmdlet inesistenti, errori di sintassi che impediscono l'esecuzione di un cmdlet o altri errori irreversibili.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-114">Examples include non-existent cmdlets, syntax errors that prevent a cmdlet from running, or other fatal errors.</span></span>

* <span data-ttu-id="0e4ec-115">**Errore non irreversibili**: errore non grave che consente di continuare comunque l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-115">**Non-terminating error**: A non-serious error that allows execution to continue despite the failure.</span></span> <span data-ttu-id="0e4ec-116">Gli esempi includono errori operativi come errori di file non trovati e problemi relativi alle autorizzazioni.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-116">Examples include operational errors such as file not found errors and permissions problems.</span></span>

<span data-ttu-id="0e4ec-117">I runbook grafici di Automazione di Azure sono stati migliorati con la capacità di includere la gestione degli errori.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-117">Azure Automation graphical runbooks have been improved with the capability to include error handling.</span></span> <span data-ttu-id="0e4ec-118">È ora possibile trasformare le eccezioni in errori non irreversibili e creare collegamenti di errori tra le attività.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-118">You can now turn exceptions into non-terminating errors and create error links between activities.</span></span> <span data-ttu-id="0e4ec-119">Questo processo consente a un autore di runbook di rilevare gli errori e gestire condizioni realizzate o impreviste.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-119">This process allows a runbook author to catch errors and manage realized or unexpected conditions.</span></span>  

## <a name="when-to-use-error-handling"></a><span data-ttu-id="0e4ec-120">Quando usare la gestione degli errori</span><span class="sxs-lookup"><span data-stu-id="0e4ec-120">When to use error handling</span></span>

<span data-ttu-id="0e4ec-121">Se si verifica un'attività critica che genera un'errore o un'eccezione, è importante evitare l'elaborazione dell'attività successiva del runbook e gestire l'errore in modo appropriato.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-121">Whenever there is a critical activity that throws an error or exception, it's important to prevent the next activity in your runbook from processing and to handle the error appropriately.</span></span> <span data-ttu-id="0e4ec-122">Questo è essenziale soprattutto quando i runbook supportano un processo correlato alle operazioni aziendali o di servizio.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-122">This is especially critical when your runbooks are supporting a business or service operations process.</span></span>

<span data-ttu-id="0e4ec-123">Per ogni attività che può generare un errore, l'autore del runbook può aggiungere un collegamento di errore che punta a qualsiasi altra attività.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-123">For each activity that can produce an error, the runbook author can add an error link pointing to any other activity.</span></span>  <span data-ttu-id="0e4ec-124">L'attività di destinazione può essere di qualsiasi tipo, incluse attività di codice, chiamata di un cmdlet, chiamata di un altro runbook e così via.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-124">The destination activity can be of any type, including code activities, invoking a cmdlet, invoking another runbook, and so on.</span></span>

<span data-ttu-id="0e4ec-125">L'attività di destinazione può avere anche collegamenti in uscita,</span><span class="sxs-lookup"><span data-stu-id="0e4ec-125">In addition, the destination activity can also have outgoing links.</span></span> <span data-ttu-id="0e4ec-126">che possono essere collegamenti normali o collegamenti di errore.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-126">These links can be regular links or error links.</span></span> <span data-ttu-id="0e4ec-127">Ciò significa che l'autore del runbook può implementare logica complessa per la gestione degli errori senza dovere usare alcuna attività di codice.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-127">This means the runbook author can implement complex error-handling logic without resorting to a code activity.</span></span> <span data-ttu-id="0e4ec-128">La procedura consigliata comporta la creazione di un runbook dedicato per la gestione degli errori con funzionalità comuni, ma questa operazione non è obbligatoria.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-128">The recommended practice is to create a dedicated error-handling runbook with common functionality, but it's not mandatory.</span></span> <span data-ttu-id="0e4ec-129">La logica di gestione degli errori in un'attività di codice di PowerShell non è l'unica opzione.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-129">Error-handling logic in a PowerShell code activity it isn't the only option.</span></span>  

<span data-ttu-id="0e4ec-130">Si consideri ad esempio un runbook che prova ad avviare una macchina virtuale e installarvi un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-130">For example, consider a runbook that tries to start a VM and install an application on it.</span></span> <span data-ttu-id="0e4ec-131">Se la macchina virtuale non viene avviata correttamente, vengono eseguite due azioni:</span><span class="sxs-lookup"><span data-stu-id="0e4ec-131">If the VM doesn't start correctly, it performs two actions:</span></span>

1. <span data-ttu-id="0e4ec-132">Invio di una notifica relativa al problema.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-132">It sends a notification about this problem.</span></span>
2. <span data-ttu-id="0e4ec-133">Avvio di un altro runbook che effettua automaticamente il provisioning di una nuova macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-133">It starts another runbook that automatically provisions a new VM instead.</span></span>

<span data-ttu-id="0e4ec-134">Una soluzione consiste nell'avere un collegamento di errore che fa riferimento a un'attività che gestisce il primo passaggio.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-134">One solution is to have an error link pointing to an activity that handles step one.</span></span> <span data-ttu-id="0e4ec-135">È ad esempio possibile connettere il cmdlet **Write-Warning** a un'attività per il passaggio due, ad esempio il cmdlet **Start-AzureRmAutomationRunbook**.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-135">For example, you could connect the **Write-Warning** cmdlet to an activity for step two, such as the **Start-AzureRmAutomationRunbook** cmdlet.</span></span>

<span data-ttu-id="0e4ec-136">Si potrebbe anche generalizzare questo comportamento per usarlo in diversi runbook, inserendo le due attività in un runbook di gestione degli errori separato e seguendo le indicazioni riportate in precedenza.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-136">You could also generalize this behavior for use in many runbooks by putting these two activities in a separate error handling runbook and following the guidance suggested earlier.</span></span> <span data-ttu-id="0e4ec-137">Prima di chiamare tale runbook di gestione degli errori, si potrebbe creare un messaggio personalizzato dai dati del runbook originale e quindi passarlo come parametro al runbook di gestione degli errori.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-137">Before calling this error-handling runbook, you could construct a custom message from the data in the original runbook, and then pass it as a parameter to the error-handling runbook.</span></span>

## <a name="how-to-use-error-handling"></a><span data-ttu-id="0e4ec-138">Come usare la gestione degli errori</span><span class="sxs-lookup"><span data-stu-id="0e4ec-138">How to use error handling</span></span>

<span data-ttu-id="0e4ec-139">Ogni attività ha un'impostazione di configurazione che trasforma le eccezioni in errori non irreversibili.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-139">Each activity has a configuration setting that turns exceptions into non-terminating errors.</span></span> <span data-ttu-id="0e4ec-140">Per impostazione predefinita, questa impostazione è disabilitata.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-140">By default, this setting is disabled.</span></span> <span data-ttu-id="0e4ec-141">È consigliabile abilitare questa impostazione su qualsiasi attività in cui si vogliono gestire gli errori.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-141">We recommend that you enable this setting on any activity where you want to handle errors.</span></span>  

<span data-ttu-id="0e4ec-142">Abilitando questa configurazione, gli errori sia irreversibili che non irreversibili nell'attività vengono trattati come errori non irreversibili e possono essere gestiti con un collegamento di errore.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-142">By enabling this configuration, you are assuring that both terminating and non-terminating errors in the activity are handled as non-terminating errors, and can be handled with an error link.</span></span>  

<span data-ttu-id="0e4ec-143">Dopo aver configurato tale impostazione, si creano le attività che gestiscono l'errore.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-143">After configuring this setting, you create an activity that handles the error.</span></span> <span data-ttu-id="0e4ec-144">Se un'attività genera un errore, vengono seguiti i collegamenti di errore in uscita e non i collegamenti regolari a prescindere dal fatto che l'attività abbia generato anche output regolare.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-144">If an activity produces any error, then the outgoing error links are followed, and the regular links are not, even if the activity produces regular output as well.</span></span><br><br> ![Esempio di collegamento di errore in un runbook di Automazione](media/automation-runbook-graphical-error-handling/error-link-example.png)

<span data-ttu-id="0e4ec-146">Nell'esempio seguente un runbook recupera una variabile che include il nome del computer di una macchina virtuale,</span><span class="sxs-lookup"><span data-stu-id="0e4ec-146">In the following example, a runbook retrieves a variable that contains the computer name of a virtual machine.</span></span> <span data-ttu-id="0e4ec-147">quindi prova ad avviare la macchina virtuale con l'attività successiva.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-147">It then attempts to start the virtual machine with the next activity.</span></span><br><br> ![Esempio di gestione degli errori in un runbook di Automazione](media/automation-runbook-graphical-error-handling/runbook-example-error-handling.png)<br><br>      

<span data-ttu-id="0e4ec-149">Le attività **Get-AutomationVariable** e **Start-AzureRmVm** sono configurate per convertire le eccezioni in errori.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-149">The **Get-AutomationVariable** activity and **Start-AzureRmVm** are configured to convert exceptions to errors.</span></span>  <span data-ttu-id="0e4ec-150">Se si verificano problemi nel recupero della variabile o nell'avvio della VM, vengono generati errori.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-150">If there are problems getting the variable or starting the VM, then errors are generated.</span></span><br><br> <span data-ttu-id="0e4ec-151">![Impostazioni delle attività di gestione degli errori in un runbook di Automazione](media/automation-runbook-graphical-error-handling/activity-blade-convertexception-option.png)</span><span class="sxs-lookup"><span data-stu-id="0e4ec-151">![Automation runbook error-handling activity settings](media/automation-runbook-graphical-error-handling/activity-blade-convertexception-option.png)</span></span>

<span data-ttu-id="0e4ec-152">I collegamenti di errore passano da queste attività a una singola attività di **gestione degli errori** (attività di codice).</span><span class="sxs-lookup"><span data-stu-id="0e4ec-152">Error links flow from these activities to a single **error management** activity (a code activity).</span></span> <span data-ttu-id="0e4ec-153">Questa attività viene configurata con una semplice espressione di PowerShell che usa la parola chiave *Throw* per arrestare l'elaborazione, insieme a *$Error.Exception.Message* per ottenere il messaggio che illustra l'eccezione corrente.</span><span class="sxs-lookup"><span data-stu-id="0e4ec-153">This activity is configured with a simple PowerShell expression that uses the *Throw* keyword to stop processing, along with *$Error.Exception.Message* to get the message that describes the current exception.</span></span><br><br> <span data-ttu-id="0e4ec-154">![Esempio di codice di gestione degli errori in un runbook di Automazione](media/automation-runbook-graphical-error-handling/runbook-example-error-handling-code.png)</span><span class="sxs-lookup"><span data-stu-id="0e4ec-154">![Automation runbook error-handling code example](media/automation-runbook-graphical-error-handling/runbook-example-error-handling-code.png)</span></span>


## <a name="next-steps"></a><span data-ttu-id="0e4ec-155">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="0e4ec-155">Next steps</span></span>

* <span data-ttu-id="0e4ec-156">Per altre informazioni sui collegamenti e sui tipi di collegamento di errore nei runbook grafici, vedere [Creazione grafica in Automazione di Azure](automation-graphical-authoring-intro.md#links-and-workflow).</span><span class="sxs-lookup"><span data-stu-id="0e4ec-156">To learn more about links and link types in graphical runbooks, see [Graphical authoring in Azure Automation](automation-graphical-authoring-intro.md#links-and-workflow).</span></span>

* <span data-ttu-id="0e4ec-157">Per altre informazioni sull'esecuzione dei runbook, su come monitorare i processi dei runbook e su altri dettagli tecnici, vedere [Verifica di un processo di runbook](automation-runbook-execution.md).</span><span class="sxs-lookup"><span data-stu-id="0e4ec-157">To learn more about runbook execution, how to monitor runbook jobs, and other technical details, see [Track a runbook job](automation-runbook-execution.md).</span></span>
