---
title: "Panoramica della configurazioni a disponibilità elevata con gateway VPN di Azure | Documentazione Microsoft"
description: "Questo articolo offre una panoramica delle opzioni di configurazione a disponibilità elevata con gateway VPN di Azure."
services: vpn-gateway
documentationcenter: na
author: yushwang
manager: rossort
editor: 
tags: 
ms.assetid: a8bfc955-de49-4172-95ac-5257e262d7ea
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/24/2016
ms.author: yushwang
ms.openlocfilehash: 3708a2f7c445a161f02416cf8427b1707e1db8f0
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="highly-available-cross-premises-and-vnet-to-vnet-connectivity"></a><span data-ttu-id="9cf38-103">Connettività cross-premise e da rete virtuale a rete virtuale a disponibilità elevata</span><span class="sxs-lookup"><span data-stu-id="9cf38-103">Highly Available Cross-Premises and VNet-to-VNet Connectivity</span></span>
<span data-ttu-id="9cf38-104">Questo articolo offre una panoramica delle opzioni di configurazione a disponibilità elevata per la connettività cross-premise e da rete virtuale a rete virtuale con gateway VPN di Azure.</span><span class="sxs-lookup"><span data-stu-id="9cf38-104">This article provides an overview of Highly Available configuration options for your cross-premises and VNet-to-VNet connectivity using Azure VPN gateways.</span></span>

## <span data-ttu-id="9cf38-105"><a name = "activestandby"></a>Informazioni sulla ridondanza dei gateway VPN di Azure</span><span class="sxs-lookup"><span data-stu-id="9cf38-105"><a name = "activestandby"></a>About Azure VPN gateway redundancy</span></span>
<span data-ttu-id="9cf38-106">Ogni gateway VPN di Azure è costituito da due istanze in una configurazione di tipo attivo-standby.</span><span class="sxs-lookup"><span data-stu-id="9cf38-106">Every Azure VPN gateway consists of two instances in an active-standby configuration.</span></span> <span data-ttu-id="9cf38-107">In caso di interruzione imprevista o di manutenzione pianificata nell'istanza attiva, l'istanza di standby assume automaticamente il controllo (failover) e riprende le connessioni VPN S2S o da rete virtuale a rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="9cf38-107">For any planned maintenance or unplanned disruption that happens to the active instance, the standby instance would take over (failover) automatically, and resume the S2S VPN or VNet-to-VNet connections.</span></span> <span data-ttu-id="9cf38-108">Il passaggio causerà una breve interruzione.</span><span class="sxs-lookup"><span data-stu-id="9cf38-108">The switch over will cause a brief interruption.</span></span> <span data-ttu-id="9cf38-109">In caso di manutenzione pianificata, la connettività dovrebbe essere ripristinata entro 10-15 secondi.</span><span class="sxs-lookup"><span data-stu-id="9cf38-109">For planned maintenance, the connectivity should be restored within 10 to 15 seconds.</span></span> <span data-ttu-id="9cf38-110">Per problemi imprevisti, il ripristino della connessione richiederà più tempo, approssimativamente da 1 minuto a 1 minuto e mezzo nel peggiore dei casi.</span><span class="sxs-lookup"><span data-stu-id="9cf38-110">For unplanned issues, the connection recovery will be longer, about 1 minute to 1 and a half minutes in the worst case.</span></span> <span data-ttu-id="9cf38-111">Per le connessioni client VPN P2S al gateway, le connessioni P2S verranno interrotte e gli utenti dovranno riconnettersi dai computer client.</span><span class="sxs-lookup"><span data-stu-id="9cf38-111">For P2S VPN client connections to the gateway, the P2S connections will be disconnected and the users will need to reconnect from the client machines.</span></span>

![Attivo-standby](./media/vpn-gateway-highlyavailable/active-standby.png)

## <a name="highly-available-cross-premises-connectivity"></a><span data-ttu-id="9cf38-113">Connettività cross-premise a disponibilità elevata</span><span class="sxs-lookup"><span data-stu-id="9cf38-113">Highly Available Cross-Premises Connectivity</span></span>
<span data-ttu-id="9cf38-114">Per offrire una maggiore disponibilità per le connessioni cross premise, sono disponibili alcune opzioni:</span><span class="sxs-lookup"><span data-stu-id="9cf38-114">To provide better availability for your cross premises connections, there are a couple of options available:</span></span>

* <span data-ttu-id="9cf38-115">Più dispositivi VPN locali</span><span class="sxs-lookup"><span data-stu-id="9cf38-115">Multiple on-premises VPN devices</span></span>
* <span data-ttu-id="9cf38-116">Gateway VPN di Azure di tipo attivo-attivo</span><span class="sxs-lookup"><span data-stu-id="9cf38-116">Active-active Azure VPN gateway</span></span>
* <span data-ttu-id="9cf38-117">Combinazione di entrambe le opzioni</span><span class="sxs-lookup"><span data-stu-id="9cf38-117">Combination of both</span></span>

### <span data-ttu-id="9cf38-118"><a name = "activeactiveonprem"></a>Più dispositivi VPN locali</span><span class="sxs-lookup"><span data-stu-id="9cf38-118"><a name = "activeactiveonprem"></a>Multiple on-premises VPN devices</span></span>
<span data-ttu-id="9cf38-119">È possibile usare più dispositivi VPN dalla rete locale per connettersi al gateway VPN di Azure, come illustrato nel diagramma seguente:</span><span class="sxs-lookup"><span data-stu-id="9cf38-119">You can use multiple VPN devices from your on-premises network to connect to your Azure VPN gateway, as shown in the following diagram:</span></span>

![Più dispositivi VPN locali](./media/vpn-gateway-highlyavailable/multiple-onprem-vpns.png)

<span data-ttu-id="9cf38-121">Questa configurazione offre più tunnel attivi dallo stesso gateway VPN di Azure ai dispositivi locali nella stessa località.</span><span class="sxs-lookup"><span data-stu-id="9cf38-121">This configuration provides multiple active tunnels from the same Azure VPN gateway to your on-premises devices in the same location.</span></span> <span data-ttu-id="9cf38-122">Esistono alcuni requisiti e vincoli:</span><span class="sxs-lookup"><span data-stu-id="9cf38-122">There are some requirements and constraints:</span></span>

1. <span data-ttu-id="9cf38-123">È necessario creare più connessioni VPN S2S dai dispositivi VPN ad Azure.</span><span class="sxs-lookup"><span data-stu-id="9cf38-123">You need to create multiple S2S VPN connections from your VPN devices to Azure.</span></span> <span data-ttu-id="9cf38-124">Quando si connettono più dispositivi VPN dalla stessa rete locale ad Azure, è necessario creare un gateway di rete locale per ogni dispositivo VPN e una connessione dal gateway VPN di Azure al gateway di rete locale.</span><span class="sxs-lookup"><span data-stu-id="9cf38-124">When you connect multiple VPN devices from the same on-premises network to Azure, you need to create one local network gateway for each VPN device, and one connection from your Azure VPN gateway to the local network gateway.</span></span>
2. <span data-ttu-id="9cf38-125">I gateway di rete locali corrispondenti ai dispositivi VPN devono avere indirizzi IP pubblici univoci nella proprietà "GatewayIpAddress".</span><span class="sxs-lookup"><span data-stu-id="9cf38-125">The local network gateways corresponding to your VPN devices must have unique public IP addresses in the "GatewayIpAddress" property.</span></span>
3. <span data-ttu-id="9cf38-126">Per questa configurazione è necessario BGP.</span><span class="sxs-lookup"><span data-stu-id="9cf38-126">BGP is required for this configuration.</span></span> <span data-ttu-id="9cf38-127">Per ogni gateway di rete locale che rappresenta un dispositivo VPN deve essere specificato un indirizzo IP univoco del peer BGP nella proprietà "BgpPeerIpAddress".</span><span class="sxs-lookup"><span data-stu-id="9cf38-127">Each local network gateway representing a VPN device must have a unique BGP peer IP address specified in the "BgpPeerIpAddress" property.</span></span>
4. <span data-ttu-id="9cf38-128">Il campo della proprietà AddressPrefix di ogni gateway di rete locale non deve sovrapporsi.</span><span class="sxs-lookup"><span data-stu-id="9cf38-128">The AddressPrefix property field in each local network gateway must not overlap.</span></span> <span data-ttu-id="9cf38-129">È consigliabile specificare "BgpPeerIpAddress" nel campo AddressPrefix in formato CIDR /32, ad esempio 10.200.200.254/32.</span><span class="sxs-lookup"><span data-stu-id="9cf38-129">You should specify the "BgpPeerIpAddress" in /32 CIDR format in the AddressPrefix field, for example, 10.200.200.254/32.</span></span>
5. <span data-ttu-id="9cf38-130">È consigliabile usare BGP per annunciare gli stessi prefissi dei prefissi di rete locale al gateway VPN di Azure. Il traffico verrà inoltrato attraverso questi tunnel simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="9cf38-130">You should use BGP to advertise the same prefixes of the same on-premises network prefixes to your Azure VPN gateway, and the traffic will be forwarded through these tunnels simultaneously.</span></span>
6. <span data-ttu-id="9cf38-131">Ogni connessione viene conteggiata rispetto al numero massimo di tunnel per il gateway VPN di Azure: 10 per SKU Basic e Standard e 30 per SKU HighPerformance.</span><span class="sxs-lookup"><span data-stu-id="9cf38-131">Each connection is counted against the maximum number of tunnels for your Azure VPN gateway, 10 for Basic and Standard SKUs, and 30 for HighPerformance SKU.</span></span> 

<span data-ttu-id="9cf38-132">In questa configurazione, il gateway VPN di Azure è comunque in modalità attivo-standby, quindi si verificano lo stesso comportamento di failover e la stessa breve interruzione descritti [sopra](#activestandby).</span><span class="sxs-lookup"><span data-stu-id="9cf38-132">In this configuration, the Azure VPN gateway is still in active-standby mode, so the same failover behavior and brief interruption will still happen as described [above](#activestandby).</span></span> <span data-ttu-id="9cf38-133">Questa configurazione protegge tuttavia da errori o interruzioni nella rete locale e nei dispositivi VPN.</span><span class="sxs-lookup"><span data-stu-id="9cf38-133">But this setup guards against failures or interruptions on your on-premises network and VPN devices.</span></span>

### <a name="active-active-azure-vpn-gateway"></a><span data-ttu-id="9cf38-134">Gateway VPN di Azure di tipo attivo-attivo</span><span class="sxs-lookup"><span data-stu-id="9cf38-134">Active-active Azure VPN gateway</span></span>
<span data-ttu-id="9cf38-135">È ora possibile creare un gateway VPN di Azure in una configurazione di tipo attivo-attivo, in cui entrambe le istanze delle VM del gateway stabiliscono tunnel VPN S2S con il dispositivo VPN locale, come illustrato nel diagramma seguente:</span><span class="sxs-lookup"><span data-stu-id="9cf38-135">You can now create an Azure VPN gateway in an active-active configuration, where both instances of the gateway VMs will establish S2S VPN tunnels to your on-premises VPN device, as shown the following diagram:</span></span>

![Attivo-attivo](./media/vpn-gateway-highlyavailable/active-active.png)

<span data-ttu-id="9cf38-137">In questa configurazione, ogni istanza del gateway di Azure avrà un indirizzo IP pubblico univoco e stabilirà un tunnel VPN S2S IPsec/IKE con il dispositivo VPN locale specificato nella connessione e nel gateway di rete locale.</span><span class="sxs-lookup"><span data-stu-id="9cf38-137">In this configuration, each Azure gateway instance will have a unique public IP address, and each will establish an IPsec/IKE S2S VPN tunnel to your on-premises VPN device specified in your local network gateway and connection.</span></span> <span data-ttu-id="9cf38-138">Si noti che entrambi i tunnel VPN sono di fatto parte della stessa connessione.</span><span class="sxs-lookup"><span data-stu-id="9cf38-138">Note that both VPN tunnels are actually part of the same connection.</span></span> <span data-ttu-id="9cf38-139">È comunque necessario configurare il dispositivo VPN locale in modo che accetti o stabilisca due tunnel VPN S2S con i due indirizzi IP pubblici del gateway VPN di Azure.</span><span class="sxs-lookup"><span data-stu-id="9cf38-139">You will still need to configure your on-premises VPN device to accept or establish two S2S VPN tunnels to those two Azure VPN gateway public IP addresses.</span></span>

<span data-ttu-id="9cf38-140">Dato che le istanze del gateway di Azure presentano una configurazione di tipo attivo-attivo, il traffico dalla rete virtuale di Azure alla rete locale verrà instradato attraverso i tunnel simultaneamente, anche se il dispositivo VPN potrebbe preferire un tunnel rispetto all'altro.</span><span class="sxs-lookup"><span data-stu-id="9cf38-140">Because the Azure gateway instances are in active-active configuration, the traffic from your Azure virtual network to your on-premises network will be routed through both tunnels simultaneously, even if your on-premises VPN device may favor one tunnel over the other.</span></span> <span data-ttu-id="9cf38-141">Si noti, tuttavia, che lo stesso flusso TCP o UDP attraverserà sempre lo stesso tunnel o percorso, a meno che in una delle istanze non si verifichi un evento di manutenzione.</span><span class="sxs-lookup"><span data-stu-id="9cf38-141">Note though the same TCP or UDP flow will always traverse the same tunnel or path, unless a maintenance event happens on one of the instances.</span></span>

<span data-ttu-id="9cf38-142">In caso di evento imprevisto o di manutenzione pianificata in un'istanza del gateway, il tunnel IPsec da tale istanza al dispositivo VPN locale verrà disconnesso.</span><span class="sxs-lookup"><span data-stu-id="9cf38-142">When a planned maintenance or unplanned event happens to one gateway instance, the IPsec tunnel from that instance to your on-premises VPN device will be disconnected.</span></span> <span data-ttu-id="9cf38-143">Le route corrispondenti nei dispositivi VPN verranno rimosse o revocate automaticamente in modo che il traffico venga trasferito sull'altro tunnel IPsec attivo.</span><span class="sxs-lookup"><span data-stu-id="9cf38-143">The corresponding routes on your VPN devices should be removed or withdrawn automatically so that the traffic will be switched over to the other active IPsec tunnel.</span></span> <span data-ttu-id="9cf38-144">Sul lato Azure, verrà eseguito automaticamente il passaggio dall'istanza interessata all'istanza attiva.</span><span class="sxs-lookup"><span data-stu-id="9cf38-144">On the Azure side, the switch over will happen automatically from the affected instance to the active instance.</span></span>

### <a name="dual-redundancy-active-active-vpn-gateways-for-both-azure-and-on-premises-networks"></a><span data-ttu-id="9cf38-145">Doppia ridondanza: gateway VPN di tipo attivo-attivo sia per Azure che per le reti locali</span><span class="sxs-lookup"><span data-stu-id="9cf38-145">Dual-redundancy: active-active VPN gateways for both Azure and on-premises networks</span></span>
<span data-ttu-id="9cf38-146">L'opzione più affidabile consiste nel combinare gateway di tipo attivo-attivo sia nella propria rete che in Azure, come illustrato nel diagramma di seguito.</span><span class="sxs-lookup"><span data-stu-id="9cf38-146">The most reliable option is to combine the active-active gateways on both your network and Azure, as shown in the diagram below.</span></span>

![Doppia ridondanza](./media/vpn-gateway-highlyavailable/dual-redundancy.png)

<span data-ttu-id="9cf38-148">In questo caso si crea e si configura il gateway VPN di Azure in una configurazione di tipo attivo-attivo e si creano due gateway di rete locali e due connessioni per i dispositivi VPN locali, come descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="9cf38-148">Here you create and setup the Azure VPN gateway in an active-active configuration, and create two local network gateways and two connections for your two on-premises VPN devices as described above.</span></span> <span data-ttu-id="9cf38-149">Si ottiene così una connettività a maglia completa di 4 tunnel IPSec tra la rete virtuale di Azure e la rete locale.</span><span class="sxs-lookup"><span data-stu-id="9cf38-149">The result is a full mesh connectivity of 4 IPsec tunnels between your Azure virtual network and your on-premises network.</span></span>

<span data-ttu-id="9cf38-150">Tutti i gateway e i tunnel sono attivi dal lato Azure e il traffico verrà quindi distribuito simultaneamente tra tutti e 4 i tunnel, anche se ogni flusso TCP o UDP seguirà anche in questo caso lo stesso tunnel o percorso dal lato Azure.</span><span class="sxs-lookup"><span data-stu-id="9cf38-150">All gateways and tunnels are active from the Azure side, so the traffic will be spread among all 4 tunnels simultaneously, although each TCP or UDP flow will again follow the same tunnel or path from the Azure side.</span></span> <span data-ttu-id="9cf38-151">Anche se distribuendo il traffico si può rilevare un lieve miglioramento della velocità effettiva sui tunnel IPsec, l'obiettivo principale di questa configurazione è la disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="9cf38-151">Even though by spreading the traffic, you may see slightly better throughput over the IPsec tunnels, the primary goal of this configuration is for high availability.</span></span> <span data-ttu-id="9cf38-152">A causa della natura statistica della distribuzione, è difficile misurare l'impatto di diverse condizioni di traffico delle applicazioni sulla velocità effettiva aggregata.</span><span class="sxs-lookup"><span data-stu-id="9cf38-152">And due to the statistical nature of the spreading, it is difficult to provide the measurement on how different application traffic conditions will affect the aggregate throughput.</span></span>

<span data-ttu-id="9cf38-153">Questa topologia richiederà due gateway di rete locali e due connessioni per supportare la coppia di dispositivi VPN locali e BGP per consentire le due connessioni alla stessa rete locale.</span><span class="sxs-lookup"><span data-stu-id="9cf38-153">This topology will require two local network gateways and two connections to support the pair of on-premises VPN devices, and BGP is required to allow the two connections to the same on-premises network.</span></span> <span data-ttu-id="9cf38-154">Questi requisiti sono gli stessi descritti [sopra](#activeactiveonprem).</span><span class="sxs-lookup"><span data-stu-id="9cf38-154">These requirements are the same as the [above](#activeactiveonprem).</span></span> 

## <a name="highly-available-vnet-to-vnet-connectivity-through-azure-vpn-gateways"></a><span data-ttu-id="9cf38-155">Connettività da rete virtuale a rete virtuale a disponibilità elevata tramite gateway VPN di Azure</span><span class="sxs-lookup"><span data-stu-id="9cf38-155">Highly Available VNet-to-VNet Connectivity through Azure VPN Gateways</span></span>
<span data-ttu-id="9cf38-156">La stessa configurazione di tipo attivo-attivo può essere applicata anche alle connessioni da rete virtuale a rete virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="9cf38-156">The same active-active configuration can also apply to Azure VNet-to-VNet connections.</span></span> <span data-ttu-id="9cf38-157">È possibile creare gateway VPN di tipo attivo-attivo per entrambe le reti virtuali e connetterle tra loro in modo da ottenere la stessa connettività a maglia completa di 4 tunnel tra le due reti virtuali, come illustrato nel diagramma di seguito:</span><span class="sxs-lookup"><span data-stu-id="9cf38-157">You can create active-active VPN gateways for both virtual networks, and connect them together to form the same full mesh connectivity of 4 tunnels between the two VNets, as shown in the diagram below:</span></span>

![Da rete virtuale a rete virtuale](./media/vpn-gateway-highlyavailable/vnet-to-vnet.png)

<span data-ttu-id="9cf38-159">Ciò assicura che tra le due reti virtuali sia sempre presente una coppia di tunnel per qualsiasi evento di manutenzione pianificata, garantendo una disponibilità ancora maggiore.</span><span class="sxs-lookup"><span data-stu-id="9cf38-159">This ensures there are always a pair of tunnels between the two virtual networks for any planned maintenance events, providing even better availability.</span></span> <span data-ttu-id="9cf38-160">Anche se la stessa topologia per la connettività cross-premise richiede due connessioni, per la topologia da rete virtuale a rete virtuale illustrata sopra sarà necessaria una sola connessione per ogni gateway.</span><span class="sxs-lookup"><span data-stu-id="9cf38-160">Even though the same topology for cross-premises connectivity requires two connections, the VNet-to-VNet topology shown above will need only one connection for each gateway.</span></span> <span data-ttu-id="9cf38-161">BGP è inoltre facoltativo, a meno che non sia necessario il routing di transito sulla connessione da rete virtuale a rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="9cf38-161">Additionally, BGP is optional unless transit routing over the VNet-to-VNet connection is required.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9cf38-162">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="9cf38-162">Next steps</span></span>
<span data-ttu-id="9cf38-163">Per informazioni sulla procedura per configurare connessioni cross-premise e da rete virtuale a rete virtuale di tipo attivo/attivo, vedere [Configurazione di gateway VPN di tipo attivo/attivo per connessioni cross-premise e da rete virtuale a rete virtuale](vpn-gateway-activeactive-rm-powershell.md) .</span><span class="sxs-lookup"><span data-stu-id="9cf38-163">See [Configuring Active-Active VPN Gateways for Cross-Premises and VNet-to-VNet Connections](vpn-gateway-activeactive-rm-powershell.md) for steps to configure active-active cross-premises and VNet-to-VNet connections.</span></span>

