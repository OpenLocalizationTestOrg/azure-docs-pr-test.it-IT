---
title: Backup e ripristino di emergenza per dischi IaaS di Azure | Microsoft Docs
description: "In questo articolo verrà illustrato come pianificare il backup e il ripristino di emergenza di macchine virtuali e dischi IaaS in Azure. Questo documento è relativo a dischi gestiti e non gestiti"
services: storage
cloud: Azure
documentationcenter: na
author: luywang
manager: kavithag
ms.assetid: 
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: luywang
ms.openlocfilehash: 03d38bc3383b5fd39eca5ca67c315b34b98f0c39
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/29/2017
---
# <a name="backup-and-disaster-recovery-for-azure-iaas-disks"></a><span data-ttu-id="f10c7-104">Backup e ripristino di emergenza per dischi IaaS di Azure</span><span class="sxs-lookup"><span data-stu-id="f10c7-104">Backup and disaster recovery for Azure IaaS disks</span></span>

<span data-ttu-id="f10c7-105">In questo articolo verrà illustrato come pianificare il backup e il ripristino di emergenza di macchine virtuali e dischi IaaS in Azure.</span><span class="sxs-lookup"><span data-stu-id="f10c7-105">In this article, we will explain how to plan for Backup and Disaster Recovery (DR) of IaaS virtual machines (VMs) and Disks in Azure.</span></span> <span data-ttu-id="f10c7-106">Questo documento è relativo a dischi gestiti e non gestiti.</span><span class="sxs-lookup"><span data-stu-id="f10c7-106">This document covers both Managed and Unmanaged Disks.</span></span>

<span data-ttu-id="f10c7-107">Verranno esaminate prima di tutto le funzionalità di tolleranza di errore predefinite della piattaforma di Azure, che consentono la protezione da errori locali.</span><span class="sxs-lookup"><span data-stu-id="f10c7-107">We’ll first talk about the built-in fault tolerance capabilities in the Azure platform which help guard against local failures.</span></span> <span data-ttu-id="f10c7-108">Questo documento esaminerà quindi in modo specifico gli scenari di emergenza non coperti completamente dalle funzionalità predefinite.</span><span class="sxs-lookup"><span data-stu-id="f10c7-108">We’ll then discuss the disaster scenarios not fully covered by the built-in capabilities, which is the main topic addressed by this document.</span></span> <span data-ttu-id="f10c7-109">Verranno forniti anche alcuni esempi di scenari di carico di lavoro per cui è possibile applicare diverse considerazioni relative a backup e ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="f10c7-109">We’ll also show several examples of workload scenarios where different Backup and DR considerations may apply.</span></span> <span data-ttu-id="f10c7-110">Verranno infine esaminate le soluzioni possibili per il ripristino di emergenza di dischi IaaS.</span><span class="sxs-lookup"><span data-stu-id="f10c7-110">We’ll then review possible solutions for DR of IaaS Disks.</span></span> 

## <a name="introduction"></a><span data-ttu-id="f10c7-111">Introduzione</span><span class="sxs-lookup"><span data-stu-id="f10c7-111">Introduction</span></span>

<span data-ttu-id="f10c7-112">La piattaforma Azure usa diversi metodi per la ridondanza e la tolleranza di errore, in modo da contribuire alla protezione dei clienti da eventuali errori hardware localizzati.</span><span class="sxs-lookup"><span data-stu-id="f10c7-112">The Azure platform uses various methods for redundancy and fault tolerance to help protect customers from localized hardware failures that can occur.</span></span> <span data-ttu-id="f10c7-113">Gli errori locali possono includere problemi relativi a un computer server di archiviazione di Azure che archivia parte dei dati per un disco virtuale o gli errori di un'unità SSD o HDD su tale server.</span><span class="sxs-lookup"><span data-stu-id="f10c7-113">Local failures may include problems with an Azure storage server machine that stores part of the data for a virtual disk or failures of an SSD or HDD on that server.</span></span> <span data-ttu-id="f10c7-114">Questi errori isolati relativi ai componenti hardware si possono verificare durante il funzionamento normale e la piattaforma è stata progettata per la resilienza rispetto a tali errori.</span><span class="sxs-lookup"><span data-stu-id="f10c7-114">Such isolated hardware component failures can happen during normal operations and the platform is designed to be resilient to these failures.</span></span> <span data-ttu-id="f10c7-115">Le emergenze gravi possono provocare errori o inaccessibilità per un numero elevato di server di archiviazione o per un intero data center.</span><span class="sxs-lookup"><span data-stu-id="f10c7-115">Major disasters can result in failures or inaccessibility of a large numbers of storage servers or a whole datacenter.</span></span> <span data-ttu-id="f10c7-116">Anche se le VM e i dischi sono normalmente protetti da errori localizzati, sono necessari passaggi aggiuntivi per proteggere il carico di lavoro da errori irreversibili a livello di area, ad esempio un'emergenza grave, che possono interessare le macchine virtuali e i dischi.</span><span class="sxs-lookup"><span data-stu-id="f10c7-116">While your VMs and disks are normally protected from localized failures, additional steps are necessary to protect your workload from region-wide catastrophic failures (such as a major disaster) that can affect your VM and disks.</span></span>

<span data-ttu-id="f10c7-117">Oltre a potenziali errori della piattaforma, è possibile che si verifichino problemi con l'applicazione o i dati dei clienti.</span><span class="sxs-lookup"><span data-stu-id="f10c7-117">In addition to the possibility of platform failures, problems with the customer application or data can occur.</span></span> <span data-ttu-id="f10c7-118">Ad esempio, è possibile che una nuova versione dell'applicazione apporti accidentalmente una modifica significativa ai dati.</span><span class="sxs-lookup"><span data-stu-id="f10c7-118">For example, a new version of your application may inadvertently make a breaking change to the data.</span></span> <span data-ttu-id="f10c7-119">In tale caso è consigliabile ripristinare una versione precedente dell'applicazione e dei dati, contenente l'ultimo stato valido noto.</span><span class="sxs-lookup"><span data-stu-id="f10c7-119">In that case, you may want to revert the application and the data to a prior version containing the last known good state.</span></span> <span data-ttu-id="f10c7-120">A questo scopo, sono necessari backup regolari.</span><span class="sxs-lookup"><span data-stu-id="f10c7-120">This requires maintaining regular backups.</span></span>

<span data-ttu-id="f10c7-121">Per assicurare il ripristino di emergenza a livello di area, è necessario eseguire il backup dei dischi delle VM IaaS in un'area diversa.</span><span class="sxs-lookup"><span data-stu-id="f10c7-121">For regional disaster recovery, you must backup your IaaS VM disks to a different region.</span></span> 

<span data-ttu-id="f10c7-122">Prima di esaminare le opzioni di backup e ripristino di emergenza, è utile esaminare i metodi disponibili per la gestione degli errori localizzati.</span><span class="sxs-lookup"><span data-stu-id="f10c7-122">Before we look at Backup and DR options, let’s recap a few methods available for handling localized failures.</span></span>

### <a name="azure-iaas-resiliency"></a><span data-ttu-id="f10c7-123">Resilienza IaaS di Azure</span><span class="sxs-lookup"><span data-stu-id="f10c7-123">Azure IaaS Resiliency</span></span>

<span data-ttu-id="f10c7-124">Per *resilienza* si intende la tolleranza degli errori normali che si verificano nei componenti hardware.</span><span class="sxs-lookup"><span data-stu-id="f10c7-124">*Resiliency* refers to the tolerance for normal failures that occur in hardware components.</span></span> <span data-ttu-id="f10c7-125">La resilienza è la capacità di recupero da errori che consente un funzionamento continuativo.</span><span class="sxs-lookup"><span data-stu-id="f10c7-125">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="f10c7-126">Non si tratta di evitare gli errori, ma di rispondere agli errori in modo da evitare inattività o perdita dei dati.</span><span class="sxs-lookup"><span data-stu-id="f10c7-126">It's not about avoiding failures, but responding to failures in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="f10c7-127">L'obiettivo della resilienza consiste nel ripristinare uno stato completamente funzionale dell'applicazione dopo un errore.</span><span class="sxs-lookup"><span data-stu-id="f10c7-127">The goal of resiliency is to return the application to a fully functioning state following a failure.</span></span> <span data-ttu-id="f10c7-128">Le macchine virtuali e i dischi di Azure sono stati progettati per essere resilienti agli errori hardware comuni.</span><span class="sxs-lookup"><span data-stu-id="f10c7-128">Azure Virtual Machines and Disks are designed to be resilient to common hardware faults.</span></span> <span data-ttu-id="f10c7-129">Verrà ora esaminato il modo in cui la piattaforma IaaS di Azure offre la resilienza.</span><span class="sxs-lookup"><span data-stu-id="f10c7-129">Let us look at how the Azure IaaS platform provides this resiliency.</span></span>

<span data-ttu-id="f10c7-130">Una macchina virtuale è costituita principalmente da due parti: (1) un server di calcolo e (2) i dischi persistenti.</span><span class="sxs-lookup"><span data-stu-id="f10c7-130">A virtual machine consists mainly of two parts: (1) A compute server, and (2) the persistent disks.</span></span> <span data-ttu-id="f10c7-131">Entrambi influiscono sulla tolleranza di errore di una macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="f10c7-131">Both affect the fault tolerance of a virtual machine.</span></span>

<span data-ttu-id="f10c7-132">Se nel server host di calcolo di Azure che ospita la VM si verifica un errore hardware (evento raro), Azure è progettato per il ripristino automatico della VM su un altro server.</span><span class="sxs-lookup"><span data-stu-id="f10c7-132">If the Azure compute host server that houses your VM experiences a hardware failure (which is rare), Azure is designed to automatically restore the VM on another server.</span></span> <span data-ttu-id="f10c7-133">In questo caso, si verificherà un riavvio e la VM risulterà attiva dopo una breve attesa.</span><span class="sxs-lookup"><span data-stu-id="f10c7-133">If this happens, you will experience a reboot, and the VM will be back up after some time.</span></span> <span data-ttu-id="f10c7-134">Azure rileva automaticamente questi errori hardware ed esegue i ripristini per assicurare che le VM dei clienti siano disponibili appena possibile.</span><span class="sxs-lookup"><span data-stu-id="f10c7-134">Azure automatically detects such hardware failures and executes recoveries to help ensure the customer VM will be available as soon as possible.</span></span>

<span data-ttu-id="f10c7-135">Per quanto riguarda i dischi IaaS, la durabilità dei dati è essenziale per la piattaforma di archiviazione persistente.</span><span class="sxs-lookup"><span data-stu-id="f10c7-135">Regarding IaaS disks, durability of data is critical for the persistent storage platform.</span></span> <span data-ttu-id="f10c7-136">I clienti di Azure hanno applicazioni aziendali importanti in esecuzione su IaaS e dipendono dalla persistenza dei dati.</span><span class="sxs-lookup"><span data-stu-id="f10c7-136">Azure customers have important business applications running on IaaS and they depend on the persistence of the data.</span></span> <span data-ttu-id="f10c7-137">La progettazione della protezione di Azure per questi dischi IaaS prevede tre copie ridondanti dei dati archiviati localmente, in modo da offrire una durabilità elevata rispetto agli errori locali.</span><span class="sxs-lookup"><span data-stu-id="f10c7-137">Azure designs protection for these IaaS disks with three redundant copies of data stored locally, providing high durability against local failures.</span></span> <span data-ttu-id="f10c7-138">In caso di errore di uno dei componenti hardware che contiene il disco, la VM non subisce alcun impatto, perché sono disponibili due copie aggiuntive per supportare le richieste del disco.</span><span class="sxs-lookup"><span data-stu-id="f10c7-138">If one of the hardware components that holds your disk fails, your VM is not impacted because there are two additional copies to support disk requests.</span></span> <span data-ttu-id="f10c7-139">Non si verificano problemi anche in caso di errore contemporaneo di due componenti hardware che supportano un disco (evento molto raro).</span><span class="sxs-lookup"><span data-stu-id="f10c7-139">It works fine even if two different hardware components supporting a disk fail at the same time (which would be very rare).</span></span> <span data-ttu-id="f10c7-140">Per assicurare che siano sempre mantenute tre repliche, il servizio Archiviazione di Azure crea automaticamente una nuova copia di dati in background nel caso in cui una delle tre copie non risulti più disponibile.</span><span class="sxs-lookup"><span data-stu-id="f10c7-140">To help ensure we always maintain three replicas, the Azure Storage service automatically spawns a new copy of data in the background if one of the three copies becomes unavailable.</span></span> <span data-ttu-id="f10c7-141">Non dovrebbe essere quindi necessario usare RAID con i dischi di Azure per ottenere la tolleranza di errore.</span><span class="sxs-lookup"><span data-stu-id="f10c7-141">Therefore, it should not be necessary to use RAID with Azure disks for fault tolerance.</span></span> <span data-ttu-id="f10c7-142">Una semplice configurazione di tipo RAID 0 dovrebbe essere sufficiente per lo striping dei dischi, se necessario, per creare volumi più elevati.</span><span class="sxs-lookup"><span data-stu-id="f10c7-142">A simple RAID 0 configuration should be sufficient for striping the disks if necessary to create larger volumes.</span></span>

<span data-ttu-id="f10c7-143">Grazie a questa architettura, **Azure ha offerto in modo costante una durabilità di livello aziendale per dischi IaaS, con una percentuale di [frequenza di errori annualizzata](https://en.wikipedia.org/wiki/Annualized_failure_rate) pari a ZERO, ovvero la migliore del settore.**</span><span class="sxs-lookup"><span data-stu-id="f10c7-143">Because of this architecture, **Azure has consistently delivered enterprise-grade durability for IaaS disks, with an industry-leading ZERO % [Annualized Failure Rate](https://en.wikipedia.org/wiki/Annualized_failure_rate).**</span></span>

<span data-ttu-id="f10c7-144">Gli errori hardware localizzati nell'host di calcolo o nella piattaforma di archiviazione possono a volte provocare la mancata disponibilità temporanea per la VM coperta dal [Contratto di servizio di Azure](https://azure.microsoft.com/support/legal/sla/virtual-machines/) per la disponibilità delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="f10c7-144">Localized hardware faults on the compute host or in the storage platform can sometimes result in temporary unavailability for the VM which is covered by the [Azure SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/) for VM Availability.</span></span> <span data-ttu-id="f10c7-145">Azure offre anche un Contratto di servizio leader di settore per singole istanze di VM che usano dischi di Archiviazione Premium.</span><span class="sxs-lookup"><span data-stu-id="f10c7-145">Azure also provides an industry-leading SLA for single VM instances that use Premium Storage disks.</span></span>

<span data-ttu-id="f10c7-146">Per proteggere i carichi di lavoro delle applicazione dall'inattività causata dalla mancata disponibilità temporanea di un disco o di una VM, i clienti possono sfruttare i vantaggi dei [set di disponibilità](../../virtual-machines/windows/manage-availability.md).</span><span class="sxs-lookup"><span data-stu-id="f10c7-146">To safeguard application workloads from downtime due to the temporary unavailability of a disk or VM, customers can leverage [Availability Sets](../../virtual-machines/windows/manage-availability.md).</span></span> <span data-ttu-id="f10c7-147">Due o più macchine virtuali in un set di disponibilità offrono la ridondanza per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f10c7-147">Two or more virtual machines in an availability set provides redundancy for the application.</span></span> <span data-ttu-id="f10c7-148">Azure crea quindi queste VM e questi dischi in domini di errore separati con diverso tipo di alimentazione, diverse risorse di rete e diversi componenti del server.</span><span class="sxs-lookup"><span data-stu-id="f10c7-148">Azure then creates these VMs and disks in separate fault domains with different power, network, and server components.</span></span> <span data-ttu-id="f10c7-149">Gli errori hardware localizzati non interessano in genere più VM contemporaneamente nello stesso set e ciò offre una disponibilità elevata per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f10c7-149">Thus, localized hardware failures typically do not affect multiple VMs in the set at the same time, providing high availability for your application.</span></span> <span data-ttu-id="f10c7-150">È consigliabile usare i set di disponibilità quando è necessaria la disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="f10c7-150">It is considered a good practice to use availability sets when high availability is required.</span></span> <span data-ttu-id="f10c7-151">Per altre informazioni, vedere gli aspetti del ripristino di emergenza illustrati più avanti.</span><span class="sxs-lookup"><span data-stu-id="f10c7-151">For more information, see the Disaster Recovery aspects detailed below.</span></span>

### <a name="backup-and-disaster-recovery"></a><span data-ttu-id="f10c7-152">Backup e ripristino di emergenza</span><span class="sxs-lookup"><span data-stu-id="f10c7-152">Backup and Disaster Recovery</span></span>

<span data-ttu-id="f10c7-153">Il ripristino di emergenza è la capacità di recupero da eventi imprevisti rari ma gravi, ad esempio errori non temporanei su larga scala, come un'interruzione del servizio che interessa un'intera area.</span><span class="sxs-lookup"><span data-stu-id="f10c7-153">Disaster recovery (DR) is the ability to recover from rare but major incidents: non-transient, wide-scale failures, such as service disruption that affects an entire region.</span></span> <span data-ttu-id="f10c7-154">Il ripristino di emergenza include il backup dei dati e l'archiviazione e può includere l'intervento manuale, ad esempio il ripristino di un database dal backup.</span><span class="sxs-lookup"><span data-stu-id="f10c7-154">Disaster recovery includes data backup and archiving, and may include manual intervention, such as restoring a database from backup.</span></span>

<span data-ttu-id="f10c7-155">È possibile che la protezione incorporata della piattaforma di Azure rispetto agli errori localizzati non protegga completamente le VM o i dischi in caso di emergenze gravi, che possono provocare interruzioni su larga scala,</span><span class="sxs-lookup"><span data-stu-id="f10c7-155">The Azure platform’s built-in protection against localized failures may not fully protect the VMs/disks in the case of major disasters which can cause large-scale outages.</span></span> <span data-ttu-id="f10c7-156">ad esempio eventi irreversibili come uragani, terremoti, incendi o errori su larga scala delle unità hardware che colpiscono un data center.</span><span class="sxs-lookup"><span data-stu-id="f10c7-156">This includes catastrophic events such as a data center being hit by a hurricane, earthquake, fire, or large scale hardware unit failures.</span></span> <span data-ttu-id="f10c7-157">È anche possibile che si verifichino errori a causa di problemi delle applicazioni o dei dati.</span><span class="sxs-lookup"><span data-stu-id="f10c7-157">In addition, you may encounter failures due to application or data issues.</span></span>

<span data-ttu-id="f10c7-158">Per contribuire alla protezione dei carichi di lavoro IaaS dalle interruzioni, è consigliabile pianificare la ridondanza e i backup, in modo da abilitare il ripristino.</span><span class="sxs-lookup"><span data-stu-id="f10c7-158">To help protect your IaaS workloads from outages, you should plan for redundancy and backups to enable recovery.</span></span> <span data-ttu-id="f10c7-159">Per il ripristino di emergenza è necessario pianificare la ridondanza e il backup in un'area geografica diversa rispetto al sito primario.</span><span class="sxs-lookup"><span data-stu-id="f10c7-159">For disaster recovery, you should plan redundancy and backup in a different geographic location away from the primary site.</span></span> <span data-ttu-id="f10c7-160">Ciò consente di assicurare che il backup non sia interessato dallo stesso evento che ha influito originariamente sulle VM o sui dischi.</span><span class="sxs-lookup"><span data-stu-id="f10c7-160">This helps ensure your backup is not affected by the same event that originally impacted the VM or disks.</span></span> <span data-ttu-id="f10c7-161">Per altre informazioni, vedere [Disaster Recovery for Applications built on Azure](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications) (Ripristino di emergenza per applicazioni basate su Azure).</span><span class="sxs-lookup"><span data-stu-id="f10c7-161">For more information, see [Disaster Recovery for Applications built on Azure](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span></span>

<span data-ttu-id="f10c7-162">Le considerazioni relative al ripristino di emergenza possono includere gli aspetti seguenti:</span><span class="sxs-lookup"><span data-stu-id="f10c7-162">Your DR considerations may include the following aspects:</span></span>

1. <span data-ttu-id="f10c7-163">La disponibilità elevata è la disponibilità dell'applicazione per un'esecuzione continua in uno stato integro, senza tempi di inattività significativi.</span><span class="sxs-lookup"><span data-stu-id="f10c7-163">High Availability (HA) is the ability of the application to continue running in a healthy state, without significant downtime.</span></span> <span data-ttu-id="f10c7-164">Per "stato integro" si intende che l'applicazione è reattiva e gli utenti possono connettersi all'applicazione e interagire con essa.</span><span class="sxs-lookup"><span data-stu-id="f10c7-164">By "healthy state," we mean the application is responsive, and users can connect to the application and interact with it.</span></span> <span data-ttu-id="f10c7-165">Potrebbe essere necessario che alcune applicazioni e alcuni database cruciali siano sempre disponibili, anche in caso di errori sulla piattaforma.</span><span class="sxs-lookup"><span data-stu-id="f10c7-165">Certain mission-critical applications and databases may be required to be available always, even when there are failures in the platform.</span></span> <span data-ttu-id="f10c7-166">Per questi carichi di lavoro, potrebbe essere necessario pianificare la ridondanza per l'applicazione e per i dati.</span><span class="sxs-lookup"><span data-stu-id="f10c7-166">For these workloads, you may need to plan redundancy for the application as well as the data.</span></span>

2. <span data-ttu-id="f10c7-167">Durabilità dei dati: in alcuni casi la considerazione principale consiste nell'assicurare che i dati vengano conservati in caso di emergenza.</span><span class="sxs-lookup"><span data-stu-id="f10c7-167">Data Durability: In some cases, the main consideration is ensuring the data is preserved in the case of a disaster.</span></span> <span data-ttu-id="f10c7-168">Potrebbe essere quindi necessario un backup dei dati in una posizione diversa.</span><span class="sxs-lookup"><span data-stu-id="f10c7-168">Therefore, you may need a backup of your data in a different site.</span></span> <span data-ttu-id="f10c7-169">Per questi carichi di lavoro potrebbe non essere necessaria una ridondanza completa per l'applicazione, ma potrebbero essere sufficienti backup regolari dei dischi.</span><span class="sxs-lookup"><span data-stu-id="f10c7-169">For such workloads, you may not need full redundancy for the application, but a regular backup of the disks.</span></span>

## <a name="backup-and-dr-scenarios"></a><span data-ttu-id="f10c7-170">Scenari di backup e ripristino di emergenza</span><span class="sxs-lookup"><span data-stu-id="f10c7-170">Backup and DR Scenarios</span></span>

<span data-ttu-id="f10c7-171">Verranno esaminati alcuni esempi tipici di scenari di carichi di lavoro delle applicazioni e verranno illustrate le considerazioni relative alla pianificazione del ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="f10c7-171">Let’s look at a few typical examples of application workload scenarios and the considerations for planning Disaster Recovery.</span></span>

### <a name="scenario-1-major-database-solutions"></a><span data-ttu-id="f10c7-172">Scenario 1: Principali soluzioni di database</span><span class="sxs-lookup"><span data-stu-id="f10c7-172">Scenario 1: Major Database Solutions</span></span>

<span data-ttu-id="f10c7-173">Si consideri un server di database di produzione, ad esempio SQL Server oppure Oracle, in grado di supportare la disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="f10c7-173">Consider a production database server like SQL Server or Oracle that can support High Availability.</span></span> <span data-ttu-id="f10c7-174">Le applicazioni di produzione cruciali e gli utenti dipendono da questo database.</span><span class="sxs-lookup"><span data-stu-id="f10c7-174">Critical production applications and users depend on this database.</span></span> <span data-ttu-id="f10c7-175">È possibile che il piano di ripristino di emergenza per questo sistema richieda il supporto dei requisiti seguenti:</span><span class="sxs-lookup"><span data-stu-id="f10c7-175">The Disaster Recovery plan for this system may need to support the following requirements:</span></span>

1. <span data-ttu-id="f10c7-176">I dati devono essere protetti e recuperabili.</span><span class="sxs-lookup"><span data-stu-id="f10c7-176">Data must be protected and recoverable.</span></span>
2.  <span data-ttu-id="f10c7-177">Il server deve essere disponibile per l'uso.</span><span class="sxs-lookup"><span data-stu-id="f10c7-177">Server must be available for use.</span></span>

<span data-ttu-id="f10c7-178">Potrebbe essere quindi necessario mantenere una replica del database in un'area diversa rispetto al backup.</span><span class="sxs-lookup"><span data-stu-id="f10c7-178">This may require maintaining a replica of the database in a different region as a backup.</span></span> <span data-ttu-id="f10c7-179">In base ai requisiti per la disponibilità del server e per il ripristino dei dati, è possibile usare una soluzione di tipo sito di replica attivo-attivo o attivo-passivo oppure una soluzione che prevede backup offline periodici dei dati.</span><span class="sxs-lookup"><span data-stu-id="f10c7-179">Depending on the requirements for server availability and data recovery, the solution could range from an Active-Active or Active-Passive replica site to periodic offline backups of the data.</span></span> <span data-ttu-id="f10c7-180">I database relazionali come SQL Server e Oracle offrono diverse opzioni per la replica.</span><span class="sxs-lookup"><span data-stu-id="f10c7-180">Relational databases such as SQL Server and Oracle provide various options for replication.</span></span> <span data-ttu-id="f10c7-181">Per SQL Server è possibile usare [SQL Server Always On Availability Groups](https://msdn.microsoft.com/library/hh510230.aspx) (Gruppi di disponibilità AlwaysOn di SQL Server) per ottenere la disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="f10c7-181">For SQL Server, [SQL Server Always On Availability Groups](https://msdn.microsoft.com/library/hh510230.aspx) can be used for high availability.</span></span>

<span data-ttu-id="f10c7-182">Anche i database NoSQL come MongoDB supportano le [repliche](https://docs.mongodb.com/manual/replication/) per la ridondanza.</span><span class="sxs-lookup"><span data-stu-id="f10c7-182">NoSQL databases like MongoDB also support [replicas](https://docs.mongodb.com/manual/replication/) for redundancy.</span></span> <span data-ttu-id="f10c7-183">È possibile usare le repliche per la disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="f10c7-183">The replicas for high availability can be used.</span></span>

### <a name="scenario-2-a-cluster-of-redundant-vms"></a><span data-ttu-id="f10c7-184">Scenario 2: Cluster di VM ridondanti</span><span class="sxs-lookup"><span data-stu-id="f10c7-184">Scenario 2: A cluster of redundant VMs</span></span>

<span data-ttu-id="f10c7-185">Si consideri un carico di lavoro gestito da un cluster di VM che forniscono ridondanza e bilanciamento del carico,</span><span class="sxs-lookup"><span data-stu-id="f10c7-185">Consider a workload handled by a cluster of VMs that provide redundancy and load balancing.</span></span> <span data-ttu-id="f10c7-186">ad esempio un cluster Cassandra distribuito in un'area.</span><span class="sxs-lookup"><span data-stu-id="f10c7-186">One example would be a Cassandra cluster deployed in a region.</span></span> <span data-ttu-id="f10c7-187">Questo tipo di architettura fornisce già un livello elevato di ridondanza entro tale area.</span><span class="sxs-lookup"><span data-stu-id="f10c7-187">This type of architecture already provides a high level of redundancy within that region.</span></span> <span data-ttu-id="f10c7-188">Per proteggere il carico di lavoro da un errore a livello di area, è tuttavia necessario prendere in considerazione la distribuzione del cluster su due aree o la creazione di backup periodici in un'altra area.</span><span class="sxs-lookup"><span data-stu-id="f10c7-188">However, to protect the workload from a regional level failure, you should consider spreading the cluster across two regions or making periodic backups to another region.</span></span>

### <a name="scenario-3-iaas-application-workload"></a><span data-ttu-id="f10c7-189">Scenario 3: Carico di lavoro delle applicazioni IaaS</span><span class="sxs-lookup"><span data-stu-id="f10c7-189">Scenario 3: IaaS Application Workload</span></span>

<span data-ttu-id="f10c7-190">Potrebbe trattarsi di un carico di lavoro tipico in esecuzione in una VM di Azure,</span><span class="sxs-lookup"><span data-stu-id="f10c7-190">This could be a typical production workload running on an Azure VM.</span></span> <span data-ttu-id="f10c7-191">ad esempio un server Web o un file server che include i contenuti e altre risorse di un sito.</span><span class="sxs-lookup"><span data-stu-id="f10c7-191">For example, it could be a web server or file server holding the content and other resources of a site.</span></span> <span data-ttu-id="f10c7-192">Potrebbe anche trattarsi di un'applicazione aziendale personalizzata in esecuzione in una VM che ha archiviato i rispettivi dati, le risorse e lo stato dell'applicazione nei dischi della VM.</span><span class="sxs-lookup"><span data-stu-id="f10c7-192">It could also be a custom-built business application running on a VM that stored its data, resources, and application state on the VM disks.</span></span> <span data-ttu-id="f10c7-193">In questo caso è importante assicurarsi di eseguire backup con regolarità.</span><span class="sxs-lookup"><span data-stu-id="f10c7-193">In this case, it is important to make sure you take backups on a regular basis.</span></span> <span data-ttu-id="f10c7-194">La frequenza dei backup deve essere basata sulla natura del carico di lavoro delle VM.</span><span class="sxs-lookup"><span data-stu-id="f10c7-194">Backup frequency should be based on the nature of the VM workload.</span></span> <span data-ttu-id="f10c7-195">Ad esempio, se l'applicazione viene eseguita ogni giorno e modifica i dati, è necessario eseguire il backup ogni ora.</span><span class="sxs-lookup"><span data-stu-id="f10c7-195">For example, if the application runs every day and modifies data, then the backup should be taken every hour.</span></span>

<span data-ttu-id="f10c7-196">Un altro esempio è costituito da un server di report che esegue il pull dei dati da altre origini e genera report aggregati.</span><span class="sxs-lookup"><span data-stu-id="f10c7-196">Another example is a reporting server that pull data from other sources and generates aggregated reports.</span></span> <span data-ttu-id="f10c7-197">La perdita di questa VM o di questi dischi comporterà la perdita dei report.</span><span class="sxs-lookup"><span data-stu-id="f10c7-197">Loss of this VM or disks will lead to the loss of the reports.</span></span> <span data-ttu-id="f10c7-198">Potrebbe essere tuttavia possibile eseguire di nuovo il processo di creazione di report e generare di nuovo l'output.</span><span class="sxs-lookup"><span data-stu-id="f10c7-198">However, it may be possible to rerun the reporting process and regenerate the output.</span></span> <span data-ttu-id="f10c7-199">In questo caso non si verifica effettivamente una perdita di dati, anche in caso di emergenza per il server di report. È quindi possibile un livello di tolleranza maggiore per la perdita di parte dei dati nel server di report.</span><span class="sxs-lookup"><span data-stu-id="f10c7-199">In that case, you don’t really have a loss of data even if the reporting server is hit with a disaster, so you could have a higher level of tolerance for losing part of the data on the reporting server.</span></span> <span data-ttu-id="f10c7-200">In tale caso, una minore frequenza dei backup può consentire di ridurre i costi.</span><span class="sxs-lookup"><span data-stu-id="f10c7-200">In that case, less frequent backups is an option to reduce the cost.</span></span>

### <a name="scenario-4-iaas-application-data-issues"></a><span data-ttu-id="f10c7-201">Scenario 4: Problemi relativi ai dati delle applicazioni IaaS</span><span class="sxs-lookup"><span data-stu-id="f10c7-201">Scenario 4: IaaS Application data issues</span></span>

<span data-ttu-id="f10c7-202">È presente un'applicazione che calcola, gestisce e fornisce dati commerciali cruciali, ad esempio le informazioni sui prezzi.</span><span class="sxs-lookup"><span data-stu-id="f10c7-202">You have an application that computes, maintains, and serves critical commercial data such as pricing information.</span></span> <span data-ttu-id="f10c7-203">Una nuova versione dell'applicazione presenta un bug del software che comporta un calcolo non corretto del prezzo e ha danneggiato i dati commerciali esistenti forniti dalla piattaforma.</span><span class="sxs-lookup"><span data-stu-id="f10c7-203">A new version of your application had a software bug which incorrectly computed the pricing and corrupted the existing commerce data served by the platform.</span></span> <span data-ttu-id="f10c7-204">La soluzione ottimale in questo caso consiste nel ripristinare prima di tutto una versione precedente dell'applicazione e dei dati.</span><span class="sxs-lookup"><span data-stu-id="f10c7-204">Here, the best course of action would be to revert to the earlier version of the application and the data first.</span></span> <span data-ttu-id="f10c7-205">Per abilitare questo approccio, eseguire backup periodici del sistema.</span><span class="sxs-lookup"><span data-stu-id="f10c7-205">To enable this, take periodic backups of your system.</span></span>

## <a name="disaster-recovery-solution-azure-backup-service"></a><span data-ttu-id="f10c7-206">Soluzione per il ripristino di emergenza: servizio Backup di Azure</span><span class="sxs-lookup"><span data-stu-id="f10c7-206">Disaster Recovery Solution: Azure Backup Service</span></span>

<span data-ttu-id="f10c7-207">Il [servizio Backup di Azure](https://azure.microsoft.com/services/backup/) può essere usato per il backup e il ripristino e funziona con [dischi gestiti](../../virtual-machines/windows/managed-disks-overview.md) e [non gestiti](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks).</span><span class="sxs-lookup"><span data-stu-id="f10c7-207">[Azure Backup Service](https://azure.microsoft.com/services/backup/) is can be used for Backup and DR, and it works with [Managed Disks](../../virtual-machines/windows/managed-disks-overview.md) as well as [Unmanaged Disks](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks).</span></span> <span data-ttu-id="f10c7-208">È possibile creare un processo di backup con backup basati su orari specifici e con criteri semplici per il ripristino delle VM e la conservazione dei backup.</span><span class="sxs-lookup"><span data-stu-id="f10c7-208">You can create a backup job with time-based backups, easy VM restoration and backup retention policies.</span></span> 

<span data-ttu-id="f10c7-209">Se si usano [dischi di Archiviazione Premium](storage-premium-storage.md), [dischi gestiti](../../virtual-machines/windows/managed-disks-overview.md) o altri tipi di dischi con l'opzione [Archiviazione con ridondanza locale](storage-redundancy.md#locally-redundant-storage), è particolarmente importante sfruttare i vantaggi dei backup periodici per il ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="f10c7-209">If you use [Premium Storage disks](storage-premium-storage.md), [Managed Disks](../../virtual-machines/windows/managed-disks-overview.md), or other disk types with the [locally redundant storage (LRS)](storage-redundancy.md#locally-redundant-storage) option, it is especially important to leverage periodic DR backups.</span></span> <span data-ttu-id="f10c7-210">Backup di Azure archivia i dati nell'insieme di credenziali dei Servizi di ripristino per la conservazione a lungo termine.</span><span class="sxs-lookup"><span data-stu-id="f10c7-210">Azure Backup stores the data in your Recovery Services vault for long term retention.</span></span> <span data-ttu-id="f10c7-211">Scegliere l'opzione [Archiviazione con ridondanza geografica](storage-redundancy.md#geo-redundant-storage) per l'insieme di credenziali dei Servizi di ripristino di backup.</span><span class="sxs-lookup"><span data-stu-id="f10c7-211">Choose the [Geo-redundant storage (GRS)](storage-redundancy.md#geo-redundant-storage) option for the Backup Recovery Services vault.</span></span> <span data-ttu-id="f10c7-212">In questo modo sarà possibile assicurare che i backup vengano replicati in un'area di Azure per la protezione da emergenze a livello di area.</span><span class="sxs-lookup"><span data-stu-id="f10c7-212">That will ensure backups are replicated to a different Azure region for safeguarding from regional disasters.</span></span>

<span data-ttu-id="f10c7-213">Per i [dischi non gestiti](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks) è possibile usare il tipo di archiviazione con ridondanza locale per dischi IaaS, ma occorre assicurarsi che Backup di Azure sia abilitato con l'opzione Archiviazione con ridondanza geografica per l'insieme di credenziali di Servizi di ripristino.</span><span class="sxs-lookup"><span data-stu-id="f10c7-213">For [Unmanaged Disks](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks), you can use the LRS storage type for IaaS disks, but ensure that Azure Backup is enabled with the GRS option for the Recovery Services Vault.</span></span>

<span data-ttu-id="f10c7-214">**Se si usa l'opzione [Archiviazione con ridondanza geografica](storage-redundancy.md#geo-redundant-storage)/[Archiviazione con ridondanza geografica e accesso in lettura](storage-redundancy.md#read-access-geo-redundant-storage) per i dischi non gestiti, saranno comunque necessari snapshot coerenti per il backup e il ripristino di emergenza.**</span><span class="sxs-lookup"><span data-stu-id="f10c7-214">**If you use the [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage) option for your Unmanaged Disks, you still need consistent snapshots for Backup and DR.**</span></span> <span data-ttu-id="f10c7-215">È necessario usare il [servizio Backup di Azure](https://azure.microsoft.com/services/backup/) o [snapshot coerenti](#alternative-solution-consistent-snapshots).</span><span class="sxs-lookup"><span data-stu-id="f10c7-215">You must use either [Azure Backup Service](https://azure.microsoft.com/services/backup/) or [consistent snapshots](#alternative-solution-consistent-snapshots).</span></span>

<span data-ttu-id="f10c7-216">Di seguito è riportato un riepilogo delle soluzioni per il ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="f10c7-216">The following is a summary of solutions for DR.</span></span>

| <span data-ttu-id="f10c7-217">Scenario</span><span class="sxs-lookup"><span data-stu-id="f10c7-217">Scenario</span></span> | <span data-ttu-id="f10c7-218">Replica automatica</span><span class="sxs-lookup"><span data-stu-id="f10c7-218">Automatic Replication</span></span> | <span data-ttu-id="f10c7-219">Soluzione di ripristino di emergenza</span><span class="sxs-lookup"><span data-stu-id="f10c7-219">DR Solution</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f10c7-220">*Dischi di Archiviazione Premium*</span><span class="sxs-lookup"><span data-stu-id="f10c7-220">*Premium Storage Disks*</span></span> | <span data-ttu-id="f10c7-221">Locale ([Archiviazione con ridondanza locale](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="f10c7-221">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="f10c7-222">Backup di Azure</span><span class="sxs-lookup"><span data-stu-id="f10c7-222">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="f10c7-223">*Managed Disks*</span><span class="sxs-lookup"><span data-stu-id="f10c7-223">*Managed Disks*</span></span> | <span data-ttu-id="f10c7-224">Locale ([Archiviazione con ridondanza locale](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="f10c7-224">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="f10c7-225">Backup di Azure</span><span class="sxs-lookup"><span data-stu-id="f10c7-225">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="f10c7-226">*Dischi non gestiti con archiviazione con ridondanza locale*</span><span class="sxs-lookup"><span data-stu-id="f10c7-226">*Unmanaged LRS Disks*</span></span> | <span data-ttu-id="f10c7-227">Locale ([Archiviazione con ridondanza locale](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="f10c7-227">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="f10c7-228">Backup di Azure</span><span class="sxs-lookup"><span data-stu-id="f10c7-228">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="f10c7-229">*Dischi non gestiti con archiviazione con ridondanza geografica*</span><span class="sxs-lookup"><span data-stu-id="f10c7-229">*Unmanaged GRS Disks*</span></span> | <span data-ttu-id="f10c7-230">Tra aree ([Archiviazione con ridondanza geografica](storage-redundancy.md#geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="f10c7-230">Cross region ([GRS](storage-redundancy.md#geo-redundant-storage))</span></span> | [<span data-ttu-id="f10c7-231">Backup di Azure</span><span class="sxs-lookup"><span data-stu-id="f10c7-231">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="f10c7-232">Snapshot coerenti</span><span class="sxs-lookup"><span data-stu-id="f10c7-232">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |
| <span data-ttu-id="f10c7-233">*Dischi non gestiti con archiviazione con ridondanza geografica e accesso in lettura*</span><span class="sxs-lookup"><span data-stu-id="f10c7-233">*Unmanaged RA-GRS Disks*</span></span> | <span data-ttu-id="f10c7-234">Tra aree ([Archiviazione con ridondanza geografica e accesso in lettura](storage-redundancy.md#read-access-geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="f10c7-234">Cross region ([RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage))</span></span> | [<span data-ttu-id="f10c7-235">Backup di Azure</span><span class="sxs-lookup"><span data-stu-id="f10c7-235">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="f10c7-236">Snapshot coerenti</span><span class="sxs-lookup"><span data-stu-id="f10c7-236">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |

<span data-ttu-id="f10c7-237">L'approccio migliore per ottenere la disponibilità elevata consiste nell'usare i dischi gestiti in un set di disponibilità insieme a Backup di Azure.</span><span class="sxs-lookup"><span data-stu-id="f10c7-237">High availability can best by met through the use of Managed Disks in an Availability Set along with Azure Backup.</span></span> <span data-ttu-id="f10c7-238">Se si usano i dischi non gestiti, è comunque possibile usare Backup di Azure per il ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="f10c7-238">If you are using Unmanaged Disks, you can still  use Azure Backup for DR.</span></span> <span data-ttu-id="f10c7-239">Se non si può usare Backup di Azure, la creazione di [snapshot coerenti](#alternative-solution-consistent-snapshots), come illustrato in una sezione successiva, è una soluzione alternativa per il backup e il ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="f10c7-239">If you are unable to use Azure Backup, then taking [consistent snapshots](#alternative-solution-consistent-snapshots) as described in a later section is an alternative solution for Backup and DR.</span></span>

<span data-ttu-id="f10c7-240">Le opzioni per la disponibilità elevata, il backup e il ripristino di emergenza a livello di applicazione o infrastruttura possono essere rappresentate come segue:</span><span class="sxs-lookup"><span data-stu-id="f10c7-240">Your choices for high availability, backup and DR at Application or Infrastructure levels can be represented as below:</span></span>

| <span data-ttu-id="f10c7-241">*Level*</span><span class="sxs-lookup"><span data-stu-id="f10c7-241">*Level*</span></span> | <span data-ttu-id="f10c7-242">Disponibilità elevata</span><span class="sxs-lookup"><span data-stu-id="f10c7-242">High Availability</span></span>   | <span data-ttu-id="f10c7-243">Backup/Ripristino di emergenza</span><span class="sxs-lookup"><span data-stu-id="f10c7-243">Backup / DR</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f10c7-244">*Applicazione*</span><span class="sxs-lookup"><span data-stu-id="f10c7-244">*Application*</span></span> | <span data-ttu-id="f10c7-245">SQL AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="f10c7-245">SQL Always On</span></span> | <span data-ttu-id="f10c7-246">Backup di Azure</span><span class="sxs-lookup"><span data-stu-id="f10c7-246">Azure Backup</span></span> |
| <span data-ttu-id="f10c7-247">*Infrastruttura*</span><span class="sxs-lookup"><span data-stu-id="f10c7-247">*Infrastructure*</span></span>  | <span data-ttu-id="f10c7-248">Set di disponibilità</span><span class="sxs-lookup"><span data-stu-id="f10c7-248">Availability Set</span></span>  | <span data-ttu-id="f10c7-249">Archiviazione con ridondanza geografica con snapshot coerenti</span><span class="sxs-lookup"><span data-stu-id="f10c7-249">GRS with consistent snapshots</span></span> |

### <a name="using-the-azure-backup-service"></a><span data-ttu-id="f10c7-250">Uso del servizio Backup di Azure</span><span class="sxs-lookup"><span data-stu-id="f10c7-250">Using the Azure Backup Service</span></span>

<span data-ttu-id="f10c7-251">[Backup di Azure](../../backup/backup-azure-vms-introduction.md) può eseguire il backup delle VM che eseguono Windows o Linux nell'insieme di credenziali di Servizi di ripristino di Azure.</span><span class="sxs-lookup"><span data-stu-id="f10c7-251">[Azure Backup](../../backup/backup-azure-vms-introduction.md) can backup your VMs running Windows or Linux to the Azure Recovery Services Vault.</span></span> <span data-ttu-id="f10c7-252">Le operazioni di backup e ripristino dei dati aziendali critici sono ulteriormente complicate dal fatto che il backup di tali dati deve essere eseguito mentre le applicazioni che generano i dati sono in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="f10c7-252">Backing up and restoring business-critical data is complicated by the fact that business-critical data must be backed up while the applications that produce the data are running.</span></span> <span data-ttu-id="f10c7-253">Per risolvere il problema, il servizio Backup di Azure fornisce funzionalità di backup coerenti con l'applicazione per i carichi di lavoro Microsoft avvalendosi del Servizio Copia Shadow del volume per garantire che la scrittura dei dati nell'archiviazione venga effettuata correttamente.</span><span class="sxs-lookup"><span data-stu-id="f10c7-253">To address this, Azure Backup provides application-consistent backups for Microsoft workloads by using the Volume Shadow Service (VSS) to ensure that data is written correctly to storage.</span></span> <span data-ttu-id="f10c7-254">Per le macchine virtuali Linux sono possibili solo backup coerenti con i file, perché Linux non offre una funzionalità equivalente al Servizio Copia Shadow del volume.</span><span class="sxs-lookup"><span data-stu-id="f10c7-254">For Linux VMs, only file-consistent backups are possible, since Linux does not have functionality equivalent to VSS.</span></span>

![](./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-1.png)   

<span data-ttu-id="f10c7-255">Quando Backup di Azure avvia un processo di backup all'orario pianificato, attiva l'estensione di backup installata nella VM, in modo che crei uno snapshot temporizzato.</span><span class="sxs-lookup"><span data-stu-id="f10c7-255">When Azure Backup initiates a backup job at the scheduled time, it triggers the backup extension installed in the VM to take a point-in-time snapshot.</span></span> <span data-ttu-id="f10c7-256">Uno snapshot viene acquisito in combinazione con il Servizio Copia Shadow del volume (VSS) per ottenere uno snapshot coerente dei dischi nella macchina virtuale senza che sia necessario spegnerla.</span><span class="sxs-lookup"><span data-stu-id="f10c7-256">A snapshot is taken in coordination with VSS to get a consistent snapshot of the disks in the virtual machine without having to shut it down.</span></span> <span data-ttu-id="f10c7-257">L'estensione di backup nella VM scarica tutte le operazioni di scrittura prima di creare uno snapshot coerente di tutti i dischi.</span><span class="sxs-lookup"><span data-stu-id="f10c7-257">The backup extension in the VM flushes all writes before taking the consistent snapshot of all the disks.</span></span> <span data-ttu-id="f10c7-258">Dopo l'acquisizione dello snapshot, Backup di Azure trasferisce i dati nell'insieme di credenziali di backup.</span><span class="sxs-lookup"><span data-stu-id="f10c7-258">After the snapshot is taken, the data is transferred by Azure Backup to the backup vault.</span></span> <span data-ttu-id="f10c7-259">Per aumentare l'efficienza del processo di backup, il servizio identifica e trasferisce solo i blocchi di dati che sono stati modificati dall'ultimo backup.</span><span class="sxs-lookup"><span data-stu-id="f10c7-259">To make the backup process more efficient, the service identifies and transfers only the blocks of data that have changed since the last backup.</span></span>


<span data-ttu-id="f10c7-260">Per il ripristino, è possibile visualizzare i backup disponibili tramite Backup di Azure e quindi avviare il ripristino.</span><span class="sxs-lookup"><span data-stu-id="f10c7-260">To restore, you can view the available backups through Azure Backup and then initiate a restore.</span></span> <span data-ttu-id="f10c7-261">È possibile creare e ripristinare backup di Azure tramite il [portale di Azure](https://portal.azure.com/), [con PowerShell](../../backup/backup-azure-vms-automation.md ) oppure tramite l'[interfaccia della riga di comando di Azure](https://docs.microsoft.com/azure/xplat-cli-install).</span><span class="sxs-lookup"><span data-stu-id="f10c7-261">You can create and restore Azure backups through the [Azure portal](https://portal.azure.com/), [using PowerShell](../../backup/backup-azure-vms-automation.md ), or using the [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install).</span></span> <span data-ttu-id="f10c7-262">Per altre informazioni, vedere Backup di Azure.</span><span class="sxs-lookup"><span data-stu-id="f10c7-262">For more information, see Azure Backup.</span></span>

### <a name="steps-to-enable-backup"></a><span data-ttu-id="f10c7-263">Procedura di abilitazione dei backup</span><span class="sxs-lookup"><span data-stu-id="f10c7-263">Steps to Enable Backup</span></span>

<span data-ttu-id="f10c7-264">La procedura seguente consente in genere di abilitare i backup delle VM tramite il [portale di Azure](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="f10c7-264">The following steps are typically used to enable backups of your VMs using the [Azure Portal](https://portal.azure.com/).</span></span> <span data-ttu-id="f10c7-265">La procedura presenterà alcune variazioni in base allo scenario esatto.</span><span class="sxs-lookup"><span data-stu-id="f10c7-265">There will be some variations depending on your exact scenario.</span></span> <span data-ttu-id="f10c7-266">Per informazioni dettagliate, vedere la documentazione di [Backup di Azure](../../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="f10c7-266">Refer to the [Azure Backup](../../backup/backup-azure-vms-introduction.md) documentation for full details.</span></span> <span data-ttu-id="f10c7-267">Backup di Azure [supporta anche le VM con Managed Disks](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span><span class="sxs-lookup"><span data-stu-id="f10c7-267">Azure Backup also [supports VMs with Managed Disks](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span></span>

1.  <span data-ttu-id="f10c7-268">Creare l'insieme di credenziali dei servizi di ripristino per una macchina virtuale seguendo questa procedura:</span><span class="sxs-lookup"><span data-stu-id="f10c7-268">Create a recovery services vault for a VM using the following steps:</span></span>

    <span data-ttu-id="f10c7-269">a.</span><span class="sxs-lookup"><span data-stu-id="f10c7-269">a.</span></span>  <span data-ttu-id="f10c7-270">Nel [portale di Azure](https://portal.azure.com/) esplorare tutte le risorse e individuare "Insiemi di credenziali dei servizi di ripristino".</span><span class="sxs-lookup"><span data-stu-id="f10c7-270">Using the [Azure portal](https://portal.azure.com/), browse all resources and find “Recovery Services vaults”.</span></span>

    <span data-ttu-id="f10c7-271">b.</span><span class="sxs-lookup"><span data-stu-id="f10c7-271">b.</span></span>  <span data-ttu-id="f10c7-272">Dal menu degli insiemi di credenziali dei servizi di ripristino scegliere Aggiungi e seguire la procedura per la creazione di un nuovo insieme di credenziali nella stessa area in cui si trova la VM.</span><span class="sxs-lookup"><span data-stu-id="f10c7-272">On the Recovery Services vaults menu, click Add and follow the steps to create a new vault in the same region as the VM.</span></span> <span data-ttu-id="f10c7-273">Se, ad esempio, la VM si trova nell'area Stati Uniti occidentali, scegliere Stati Uniti occidentali per l'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="f10c7-273">For example, if your VM is in West US region, pick West US for the vault.</span></span>

2.  <span data-ttu-id="f10c7-274">Verificare la replica delle risorse di archiviazione per l'insieme di credenziali appena creato.</span><span class="sxs-lookup"><span data-stu-id="f10c7-274">Verify the Storage replication for the newly created vault.</span></span> <span data-ttu-id="f10c7-275">A questo scopo, accedere all'insieme di credenziali dal pannello Insiemi di credenziali dei servizi di ripristino e passare a Impostazioni/Configurazione backup.</span><span class="sxs-lookup"><span data-stu-id="f10c7-275">To do this, access the vault from the Recovery Services vaults blade and go to the settings/Backup Configuration.</span></span> <span data-ttu-id="f10c7-276">Assicurarsi che l'opzione Archiviazione con ridondanza geografica sia selezionata per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="f10c7-276">Ensure the GRS option is selected by default.</span></span> <span data-ttu-id="f10c7-277">In questo modo si assicurerà che l'insieme di credenziali venga replicato automaticamente in un data center secondario.</span><span class="sxs-lookup"><span data-stu-id="f10c7-277">This will ensure that your vault is automatically replicated to a secondary data center.</span></span> <span data-ttu-id="f10c7-278">Ad esempio, l'insieme di credenziali nell'area Stati Uniti occidentali verrà replicato automaticamente nell'area Stati Uniti orientali.</span><span class="sxs-lookup"><span data-stu-id="f10c7-278">For example, your vault in West US will be automatically replicated to East US.</span></span>

3.  <span data-ttu-id="f10c7-279">Configurare i criteri di backup e selezionare la VM dalla stessa interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="f10c7-279">Configure the backup policy and select the VM from the same UI.</span></span>

4.  <span data-ttu-id="f10c7-280">Assicurarsi che l'agente di Backup sia installato nella VM.</span><span class="sxs-lookup"><span data-stu-id="f10c7-280">Make sure the Backup Agent is installed on the VM.</span></span> <span data-ttu-id="f10c7-281">Se la macchina virtuale è stata creata tramite un'immagine della raccolta di Azure, l'agente di Backup è già installato.</span><span class="sxs-lookup"><span data-stu-id="f10c7-281">If your VM is created using an Azure gallery image, then the Backup agent is already installed.</span></span> <span data-ttu-id="f10c7-282">In caso contrario, ovvero se si usa un'immagine personalizzata, seguire le istruzioni per [Installare l'agente di macchine virtuali nella macchina virtuale](../../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span><span class="sxs-lookup"><span data-stu-id="f10c7-282">Otherwise (that is, if you are using a custom image), use instructions to [Install the VM Agent on the virtual machine](../../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span></span>

5.  <span data-ttu-id="f10c7-283">Assicurarsi che la VM consenta la connettività di rete per permettere il funzionamento del servizio Backup.</span><span class="sxs-lookup"><span data-stu-id="f10c7-283">Make sure that the VM allows network connectivity for the backup service to function.</span></span> <span data-ttu-id="f10c7-284">Seguire queste istruzioni per la [Connettività di rete](../../backup/backup-azure-arm-vms-prepare.md#network-connectivity).</span><span class="sxs-lookup"><span data-stu-id="f10c7-284">Follow these instructions for [Network connectivity](../../backup/backup-azure-arm-vms-prepare.md#network-connectivity).</span></span>

6.  <span data-ttu-id="f10c7-285">Al termine della procedura precedente, il backup verrà eseguito a intervalli regolari, come specificato nei criteri di backup.</span><span class="sxs-lookup"><span data-stu-id="f10c7-285">Once the above steps are completed, the backup will run at regular intervals as specified in the backup policy.</span></span> <span data-ttu-id="f10c7-286">Se necessario, è possibile attivare manualmente il primo backup dal dashboard dell'insieme di credenziali nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="f10c7-286">If necessary, you can trigger the first backup manually from the vault dashboard on the Azure portal.</span></span>

<span data-ttu-id="f10c7-287">Per l'automazione di Backup di Azure tramite gli script, vedere [Cmdlet di PowerShell per il backup delle VM](../../backup/backup-azure-vms-automation.md).</span><span class="sxs-lookup"><span data-stu-id="f10c7-287">For automating Azure Backup using scripts, please refer to [PowerShell cmdlets for VM backup](../../backup/backup-azure-vms-automation.md).</span></span>

### <a name="steps-for-recovery"></a><span data-ttu-id="f10c7-288">Procedura per il ripristino</span><span class="sxs-lookup"><span data-stu-id="f10c7-288">Steps for Recovery</span></span>

<span data-ttu-id="f10c7-289">Se è necessario ripristinare o ricreare una VM, è possibile ripristinarla da qualsiasi punto di ripristino del backup nell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="f10c7-289">If you need to repair or rebuild a VM, you can restore the VM from any of the backup recovery points in the vault.</span></span> <span data-ttu-id="f10c7-290">Sono disponibili un paio di opzioni diverse per l'esecuzione del ripristino:</span><span class="sxs-lookup"><span data-stu-id="f10c7-290">There are a couple of different options for performing the recovery:</span></span>

1.  <span data-ttu-id="f10c7-291">È possibile creare una nuova VM come rappresentazione temporizzata della macchina virtuale sottoposta a backup.</span><span class="sxs-lookup"><span data-stu-id="f10c7-291">You can create a new VM as a point-in-time representation of your backed-up VM.</span></span>

2.  <span data-ttu-id="f10c7-292">È possibile ripristinare i dischi e quindi usare il modello per la macchina virtuale per personalizzare e ricreare la VM ripristinata.</span><span class="sxs-lookup"><span data-stu-id="f10c7-292">You can restore the disks and then use the template for the VM to customize and rebuild the restored VM.</span></span> 

<span data-ttu-id="f10c7-293">Seguire le istruzioni per [Usare il portale di Azure per ripristinare macchine virtuali](../../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster).</span><span class="sxs-lookup"><span data-stu-id="f10c7-293">See instructions to [Use Azure portal to restore virtual machines](../../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster).</span></span> <span data-ttu-id="f10c7-294">Il documento illustra anche la procedura specifica per il ripristino di VM sottoposte a backup nel centro dati associato usando l'insieme di credenziali di backup con ridondanza geografica in caso di emergenza nel data center primario.</span><span class="sxs-lookup"><span data-stu-id="f10c7-294">The document also explains the specific steps for restoring backed-up VMs to the paired data center using your geo-redundant backup vault in the case of a disaster at the primary data center.</span></span> <span data-ttu-id="f10c7-295">In questo caso, Backup di Azure usa il servizio di calcolo dell'area secondaria per creare la macchina virtuale ripristinata.</span><span class="sxs-lookup"><span data-stu-id="f10c7-295">In that case, Azure Backup uses the Compute service from the secondary region to create the restored virtual machine.</span></span>

<span data-ttu-id="f10c7-296">È anche possibile usare PowerShell per il [ripristino di una VM](../../backup/backup-azure-vms-automation.md#restore-an-azure-vm) o per la [creazione di una nuova VM dai dischi ripristinati](../../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span><span class="sxs-lookup"><span data-stu-id="f10c7-296">You can also use PowerShell for [restoring a VM](../../backup/backup-azure-vms-automation.md#restore-an-azure-vm) or for [creating a new VM from restored disks](../../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span></span>

## <a name="alternative-solution-consistent-snapshots"></a><span data-ttu-id="f10c7-297">Soluzione alternativa: snapshot coerenti</span><span class="sxs-lookup"><span data-stu-id="f10c7-297">Alternative Solution: Consistent Snapshots</span></span>

<span data-ttu-id="f10c7-298">Se non è possibile usare il servizio Backup di Azure, è possibile implementare un meccanismo di backup personalizzato tramite gli snapshot.</span><span class="sxs-lookup"><span data-stu-id="f10c7-298">If you are unable to use the Azure Backup Service, you can implement your own backup mechanism using snapshots.</span></span> <span data-ttu-id="f10c7-299">La creazione di snapshot coerenti per tutti i dischi usati da una VM e quindi la replica di tali snapshot in un'altra area è un processo complicato.</span><span class="sxs-lookup"><span data-stu-id="f10c7-299">It is complicated to create consistent snapshots for all disks used by a VM and then replicate those snapshots to another region.</span></span> <span data-ttu-id="f10c7-300">Azure considera quindi l'uso del servizio Backup come un'opzione migliore rispetto alla creazione di una soluzione personalizzata.</span><span class="sxs-lookup"><span data-stu-id="f10c7-300">For this reason, Azure considers leveraging the Backup Service a better option than building a custom solution.</span></span> <span data-ttu-id="f10c7-301">Se si usa l'archiviazione con ridondanza geografica e accesso in lettura o l'archiviazione con ridondanza geografica per i dischi, gli snapshot vengono replicati automaticamente in un data center secondario.</span><span class="sxs-lookup"><span data-stu-id="f10c7-301">If you use RA-GRS/GRS storage for disks, snapshots are automatically replicated to a secondary data center.</span></span> <span data-ttu-id="f10c7-302">Se si usa l'archiviazione con ridondanza locale per i dischi, sarà necessario eseguire manualmente la replica dei dati.</span><span class="sxs-lookup"><span data-stu-id="f10c7-302">If you use LRS storage for disks, you will need to replicate the data yourself.</span></span> <span data-ttu-id="f10c7-303">Per altre informazioni, vedere [Eseguire il backup dei dischi di VM non gestiti con snapshot incrementali](../../virtual-machines/windows/incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="f10c7-303">For more information, see [Back up Azure unmanaged VM disks with incremental snapshots](../../virtual-machines/windows/incremental-snapshots.md).</span></span>

<span data-ttu-id="f10c7-304">Uno snapshot è una rappresentazione di un oggetto in un punto specifico del tempo.</span><span class="sxs-lookup"><span data-stu-id="f10c7-304">A snapshot is a representation of an object at a specific point in time.</span></span> <span data-ttu-id="f10c7-305">Uno snapshot comporterà la fatturazione per le dimensioni incrementali dei dati in esso contenuti.</span><span class="sxs-lookup"><span data-stu-id="f10c7-305">A snapshot will incur billing for the incremental size of the data it holds.</span></span> <span data-ttu-id="f10c7-306">Per altre informazioni, vedere [Creare uno snapshot del BLOB](../blobs/storage-blob-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="f10c7-306">For more information, see [Create a blob snapshot](../blobs/storage-blob-snapshots.md).</span></span>

### <a name="creating-snapshots-while-the-vm-is-running"></a><span data-ttu-id="f10c7-307">Creazione di snapshot durante l'esecuzione della VM</span><span class="sxs-lookup"><span data-stu-id="f10c7-307">Creating snapshots while the VM is running</span></span>

<span data-ttu-id="f10c7-308">Anche se è possibile creare uno snapshot in qualsiasi momento, se la VM è in esecuzione viene ancora eseguito lo streaming di dati nei dischi ed è possibile che gli snapshot contengano operazioni parziali che erano in corso durante la creazione dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="f10c7-308">While you can take a snapshot at any time, if the VM is running, there is still data being streamed to the disks, and the snapshots may contain partial operations that were in flight.</span></span> <span data-ttu-id="f10c7-309">Se l'operazione interessa diversi dischi, è inoltre possibile che gli snapshot di dischi diversi siano stati creati in momenti diversi e che quindi non siano coordinati.</span><span class="sxs-lookup"><span data-stu-id="f10c7-309">Also, if there are several disks involved, the snapshots of different disks may have occurred at different times, which means these snapshots may not be coordinated.</span></span> <span data-ttu-id="f10c7-310">Ciò risulta particolarmente problematico per i volumi con striping, i cui file possono essere danneggiati in caso di modifiche durante il backup.</span><span class="sxs-lookup"><span data-stu-id="f10c7-310">This is especially problematic for striped volumes whose files can be corrupted if changes were being made during backup.</span></span>

<span data-ttu-id="f10c7-311">Per evitare questo problema, è necessario che il processo di backup implementi i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="f10c7-311">To avoid this situation, the backup process must implement the following steps:</span></span>

1.  <span data-ttu-id="f10c7-312">Blocco di tutti i dischi</span><span class="sxs-lookup"><span data-stu-id="f10c7-312">Freeze all the disks</span></span>

2.  <span data-ttu-id="f10c7-313">Scaricamento di tutte le operazioni di scrittura in sospeso</span><span class="sxs-lookup"><span data-stu-id="f10c7-313">Flush all the pending writes</span></span>

3.  <span data-ttu-id="f10c7-314">Infine [creazione di uno snapshot del BLOB](../blobs/storage-blob-snapshots.md) per tutti i dischi</span><span class="sxs-lookup"><span data-stu-id="f10c7-314">Then, [create a blob snapshot](../blobs/storage-blob-snapshots.md) for all the disks</span></span>

<span data-ttu-id="f10c7-315">Alcune applicazioni Windows, ad esempio SQL Server, forniscono un meccanismo di backup coordinato tramite il Servizio Copia Shadow del volume per creare backup coerenti con l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f10c7-315">Some Windows applications like SQL Server provide a coordinated backup mechanism via VSS to create application-consistent backups.</span></span> <span data-ttu-id="f10c7-316">In Linux è possibile usare uno strumento come fsfreeze per coordinare i dischi, in modo da fornire backup coerenti con i file, ma non snapshot coerenti con l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f10c7-316">On Linux, you can use a tool like fsfreeze for coordinating the disks, which will provide file-consistent backups, but not application-consistent snapshots.</span></span> <span data-ttu-id="f10c7-317">Questo processo è complicato ed è quindi consigliabile prendere in considerazione l'uso di [Backup di Azure](../../backup/backup-azure-vms-introduction.md) o di una soluzione di backup di terze parti che implementa già questa funzionalità.</span><span class="sxs-lookup"><span data-stu-id="f10c7-317">This process is complicated, so and you should consider using [Azure Backup](../../backup/backup-azure-vms-introduction.md) or a third-party backup solution which already implement this.</span></span>

<span data-ttu-id="f10c7-318">Il processo precedente consente di ottenere una raccolta di snapshot coordinati per tutti i dischi della VM, rappresentando una visualizzazione temporizzata specifica della VM.</span><span class="sxs-lookup"><span data-stu-id="f10c7-318">The above process will result in a collection of coordinated snapshots for all the VM disks, representing a specific point-in-time view of the VM.</span></span> <span data-ttu-id="f10c7-319">Questo è un punto di ripristino del backup per la VM.</span><span class="sxs-lookup"><span data-stu-id="f10c7-319">This is a backup restore point for the VM.</span></span> <span data-ttu-id="f10c7-320">È possibile ripetere il processo a intervalli pianificati per creare backup periodici.</span><span class="sxs-lookup"><span data-stu-id="f10c7-320">You can repeat the process at scheduled intervals to create periodic backups.</span></span> <span data-ttu-id="f10c7-321">Per la procedura per [copiare i backup in un'altra area](#copy-the-snapshots-to-another-region) per il ripristino di emergenza, vedere più avanti.</span><span class="sxs-lookup"><span data-stu-id="f10c7-321">See below for the steps to [copy the backups to another region](#copy-the-snapshots-to-another-region) for DR.</span></span>

### <a name="creating-snapshots-while-the-vm-is-offline"></a><span data-ttu-id="f10c7-322">Creazione di snapshot con VM offline</span><span class="sxs-lookup"><span data-stu-id="f10c7-322">Creating snapshots while the VM is offline</span></span>

<span data-ttu-id="f10c7-323">Un'altra opzione per la creazione di backup coerenti consiste nell'arresto della VM e nella creazione di snapshot dei BLOB di ogni disco.</span><span class="sxs-lookup"><span data-stu-id="f10c7-323">Another option to create consistent backups is shutting down the VM and taking blob snapshots of each disk.</span></span> <span data-ttu-id="f10c7-324">Questa procedura risulta più semplice rispetto alla coordinazione di snapshot di una VM in esecuzione ma richiede qualche minuto di inattività.</span><span class="sxs-lookup"><span data-stu-id="f10c7-324">This is easier than coordinating snapshots of a running VM, but it requires a few minutes of downtime.</span></span> <span data-ttu-id="f10c7-325">Per questo processo, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="f10c7-325">For this process, follow these steps:</span></span>

1. <span data-ttu-id="f10c7-326">Arrestare la VM.</span><span class="sxs-lookup"><span data-stu-id="f10c7-326">Shut down the VM.</span></span>

2. <span data-ttu-id="f10c7-327">Creare uno snapshot di ogni BLOB di disco rigido virtuale, operazione che richiede solo pochi secondi.</span><span class="sxs-lookup"><span data-stu-id="f10c7-327">Create a snapshot of each VHD blob, which only takes a few seconds.</span></span>

    <span data-ttu-id="f10c7-328">Per creare uno snapshot, è possibile usare [PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots), l'[API REST di Archiviazione di Azure](https://msdn.microsoft.com/library/azure/ee691971.aspx), l'[interfaccia della riga di comando di Azure](https://docs.microsoft.com/azure/xplat-cli-install) o una delle librerie client di Archiviazione di Azure come la [libreria client di archiviazione per .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span><span class="sxs-lookup"><span data-stu-id="f10c7-328">To create a snapshot, you can use [PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots), the [Azure Storage Rest API](https://msdn.microsoft.com/library/azure/ee691971.aspx), [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install), or one of the Azure Storage Client Libraries such as [the Storage client library for .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

3. <span data-ttu-id="f10c7-329">Avviare la VM, in modo da terminare il tempo di inattività.</span><span class="sxs-lookup"><span data-stu-id="f10c7-329">Start the VM, which ends the downtime.</span></span> <span data-ttu-id="f10c7-330">L'intero processo viene completato in genere in pochi minuti.</span><span class="sxs-lookup"><span data-stu-id="f10c7-330">Typically the entire process completes within a few minutes.</span></span>

<span data-ttu-id="f10c7-331">Questo processo restituisce una raccolta di snapshot coerenti per tutti i dischi, fornendo un punto di ripristino del backup per la VM.</span><span class="sxs-lookup"><span data-stu-id="f10c7-331">This process yields a collection of consistent snapshots for all the disks, providing a backup restore point for the VM.</span></span> <span data-ttu-id="f10c7-332">Per la procedura per copiare gli snapshot in un'altra area per il ripristino di emergenza, vedere più avanti.</span><span class="sxs-lookup"><span data-stu-id="f10c7-332">See below for the steps to copy the snapshots to another region for DR.</span></span>

### <a name="copy-the-snapshots-to-another-region"></a><span data-ttu-id="f10c7-333">Copiare gli snapshot in un'altra area</span><span class="sxs-lookup"><span data-stu-id="f10c7-333">Copy the snapshots to another region</span></span>

<span data-ttu-id="f10c7-334">La sola creazione degli snapshot potrebbe non essere sufficiente per il ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="f10c7-334">Creation of the snapshots alone may not be sufficient for DR.</span></span> <span data-ttu-id="f10c7-335">È anche necessario replicare i backup degli snapshot in un'altra area.</span><span class="sxs-lookup"><span data-stu-id="f10c7-335">You must also replicate the snapshot backups to another region.</span></span>

<span data-ttu-id="f10c7-336">Se si usa l'archiviazione con ridondanza geografica o l'archiviazione con ridondanza geografica e accesso in lettura per i dischi, gli snapshot vengono replicati automaticamente nell'area secondaria.</span><span class="sxs-lookup"><span data-stu-id="f10c7-336">If you are using GRS or RA-GRS for your disks, then the snapshots are replicated to the secondary region automatically.</span></span> <span data-ttu-id="f10c7-337">È possibile che si verifichi un ritardo di pochi minuti prima della replica. Se il data center primario risulta inattivo prima del completamento della replica degli snapshot, non sarà possibile accedere agli snapshot dal data center secondario.</span><span class="sxs-lookup"><span data-stu-id="f10c7-337">There can be a few minutes of lag before the replication, and if the primary data center goes down before the snapshots finish replicating, you will not be able to access the snapshots from the secondary data center.</span></span> <span data-ttu-id="f10c7-338">La probabilità che questo problema si verifichi è bassa.</span><span class="sxs-lookup"><span data-stu-id="f10c7-338">The likelihood of this is small.</span></span>

> [!Note] 
> <span data-ttu-id="f10c7-339">Il semplice posizionamento dei dischi in un account con archiviazione con ridondanza geografica o archiviazione con ridondanza geografica e accesso in lettura non è sufficiente per proteggere la VM da situazioni di emergenza.</span><span class="sxs-lookup"><span data-stu-id="f10c7-339">Only having the disks in a GRS or RA-GRS account does not protect the VM from disasters.</span></span> <span data-ttu-id="f10c7-340">È necessario creare anche snapshot coordinati o usare Backup di Azure.</span><span class="sxs-lookup"><span data-stu-id="f10c7-340">You must also create coordinated snapshots or use Azure Backup.</span></span> <span data-ttu-id="f10c7-341">Questa operazione è necessaria per il ripristino di uno stato coerente della VM.</span><span class="sxs-lookup"><span data-stu-id="f10c7-341">This is required to recover a VM to a consistent state.</span></span>

<span data-ttu-id="f10c7-342">Se si usa l'archiviazione con ridondanza locale, è necessario copiare gli snapshot in un account di archiviazione diverso immediatamente dopo la creazione dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="f10c7-342">If you are using LRS, you must copy the snapshots to a different storage account immediately after creating the snapshot.</span></span> <span data-ttu-id="f10c7-343">La destinazione della copia può essere un account di archiviazione con ridondanza locale in un'area diversa. La copia si troverà quindi in un'area remota.</span><span class="sxs-lookup"><span data-stu-id="f10c7-343">The copy target could be an LRS storage account in a different region, resulting in the copy being in a remote region.</span></span> <span data-ttu-id="f10c7-344">È anche possibile copiare lo snapshot in un account di archiviazione con ridondanza geografica e accesso in lettura nella stessa area.</span><span class="sxs-lookup"><span data-stu-id="f10c7-344">You can also copy the snapshot to an RA-GRS storage account in the same region.</span></span> <span data-ttu-id="f10c7-345">In questo caso lo snapshot verrà replicato in modo differito nell'area secondaria remota.</span><span class="sxs-lookup"><span data-stu-id="f10c7-345">In this case, the snapshot will be lazily replicated to the remote secondary region.</span></span> <span data-ttu-id="f10c7-346">Il backup viene protetto da emergenze nel sito primario dopo il completamento delle operazioni di copia e di replica.</span><span class="sxs-lookup"><span data-stu-id="f10c7-346">Your backup is protected from disasters at the primary site once the copying and replication is complete.</span></span>

<span data-ttu-id="f10c7-347">Per copiare in modo efficiente gli snapshot incrementali per il ripristino di emergenza, vedere le istruzioni disponibili in [Eseguire il backup dei dischi di VM non gestiti con snapshot incrementali](../../virtual-machines/windows/incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="f10c7-347">To copy your incremental snapshots for DR efficiently, review the instructions in [Back up Azure unmanaged VM disks with incremental snapshots](../../virtual-machines/windows/incremental-snapshots.md).</span></span>

![](./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-2.png)   

### <a name="recovery-from-snapshots"></a><span data-ttu-id="f10c7-348">Ripristino da snapshot</span><span class="sxs-lookup"><span data-stu-id="f10c7-348">Recovery from Snapshots</span></span>

<span data-ttu-id="f10c7-349">Per recuperare uno snapshot, copiarlo per creare un nuovo BLOB.</span><span class="sxs-lookup"><span data-stu-id="f10c7-349">To retrieve a snapshot, copy it to make a new blob.</span></span> <span data-ttu-id="f10c7-350">Se si copia lo snapshot dall'account primario, è possibile copiare lo snapshot nel BLOB di base dello snapshot, ripristinando il disco allo snapshot. Questa operazione è nota come innalzamento di livello dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="f10c7-350">If you are copying the snapshot from the primary account, you can copy the snapshot over to the base blob of the snapshot, thus reverting the disk to the snapshot; this is known as promoting the snapshot.</span></span> <span data-ttu-id="f10c7-351">Se si copia il backup dello snapshot da un account secondario (nel caso dell'archiviazione con ridondanza geografica e accesso in lettura), è necessario copiarlo in un account primario.</span><span class="sxs-lookup"><span data-stu-id="f10c7-351">If you are copying the snapshot backup from a secondary account (in the case of RA-GRS), it must be copied to a primary account.</span></span> <span data-ttu-id="f10c7-352">È possibile copiare uno snapshot [usando PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) oppure con l'utilità AzCopy.</span><span class="sxs-lookup"><span data-stu-id="f10c7-352">You can copy a snapshot [using PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) or using the AzCopy utility.</span></span> <span data-ttu-id="f10c7-353">Per altre informazioni, vedere [Trasferire dati con l'utilità da riga di comando AzCopy](storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="f10c7-353">For more information, see [Transfer data with the AzCopy Command-Line Utility](storage-use-azcopy.md).</span></span>

<span data-ttu-id="f10c7-354">Nel caso delle VM con più dischi, è necessario copiare tutti gli snapshot che fanno parte dello stesso punto di ripristino coordinato.</span><span class="sxs-lookup"><span data-stu-id="f10c7-354">In the case of VMs with multiple disks, you must copy all the snapshots that are part of the same coordinated restore point.</span></span> <span data-ttu-id="f10c7-355">Dopo la copia degli snapshot in BLOB di dischi rigidi virtuali scrivibili, è possibile usare i BLOB per ricreare la VM usando il modello per la macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="f10c7-355">Once you copy the snapshots to writable VHD blobs, you can use the blobs to recreate your VM using the template for the VM.</span></span>

## <a name="other-options"></a><span data-ttu-id="f10c7-356">Altre opzioni</span><span class="sxs-lookup"><span data-stu-id="f10c7-356">Other options</span></span>

### <a name="sql-server"></a><span data-ttu-id="f10c7-357">SQL Server</span><span class="sxs-lookup"><span data-stu-id="f10c7-357">SQL Server</span></span>

<span data-ttu-id="f10c7-358">SQL Server in esecuzione in una VM include funzionalità predefinite per il backup del database di SQL Server nell'archivio BLOB di Azure o in una condivisione file.</span><span class="sxs-lookup"><span data-stu-id="f10c7-358">SQL Server running in a VM has its own built-in capabilities to backup your SQL Server database to Azure Blob storage or a file share.</span></span> <span data-ttu-id="f10c7-359">Se l'account di archiviazione è di tipo archiviazione con ridondanza geografica o archiviazione con ridondanza geografica e accesso in lettura, è possibile accedere ai backup nel data center secondario dell'account di archiviazione in caso di emergenza, con le stesse restrizioni illustrate in precedenza.</span><span class="sxs-lookup"><span data-stu-id="f10c7-359">If the storage account is GRS or RA-GRS, you can access those backups in the storage account’s secondary data center in the event of a disaster, with the same restrictions as discussed previously.</span></span> <span data-ttu-id="f10c7-360">Per altre informazioni, vedere [Backup e ripristino per SQL Server in Macchine virtuali di Azure](../../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="f10c7-360">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](../../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span></span> <span data-ttu-id="f10c7-361">Oltre al backup e al ripristino, i [Gruppi di disponibilità AlwaysOn di SQL Server](../../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) possono mantenere repliche secondarie dei database per ridurre il tempo necessario per il ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="f10c7-361">In addition to backup and restore, [SQL Server Always On Availability Groups](../../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) can maintain secondary replicas of databases to greatly reduce the disaster recovery time.</span></span>

## <a name="other-considerations"></a><span data-ttu-id="f10c7-362">Altre considerazioni</span><span class="sxs-lookup"><span data-stu-id="f10c7-362">Other considerations</span></span>

<span data-ttu-id="f10c7-363">Questo articolo ha illustrato come eseguire il backup o creare snapshot delle VM e dei rispettivi dischi per supportare il ripristino di emergenza e infine come usarli per il ripristino.</span><span class="sxs-lookup"><span data-stu-id="f10c7-363">This article has discussed how to backup or take snapshots of your VMs and their disks to support disaster recovery, and how to use those to recover.</span></span> <span data-ttu-id="f10c7-364">Con il modello di Azure Resource Manager molti utenti usano i modelli per creare le VM e altri tipi di infrastruttura in Azure.</span><span class="sxs-lookup"><span data-stu-id="f10c7-364">With the Azure Resource Manager model, many people use templates to create their VMs and other infrastructure in Azure.</span></span> <span data-ttu-id="f10c7-365">È possibile usare un modello per creare una VM che ha sempre la stessa configurazione.</span><span class="sxs-lookup"><span data-stu-id="f10c7-365">You can use a template to create a VM that has the same configuration every time.</span></span> <span data-ttu-id="f10c7-366">Se si usano immagini personalizzate per la creazione delle VM, è necessario anche assicurarsi che le immagini siano protette tramite l'archiviazione in un account di archiviazione con ridondanza geografica e accesso in lettura.</span><span class="sxs-lookup"><span data-stu-id="f10c7-366">If you use custom images for creating your VMs, you must also make sure your images are protected by using an RA-GRS account to store them.</span></span>

<span data-ttu-id="f10c7-367">È quindi possibile che il processo di backup sia una combinazione di due elementi:</span><span class="sxs-lookup"><span data-stu-id="f10c7-367">Consequently, your backup process may be a combination of two things:</span></span>

1. <span data-ttu-id="f10c7-368">Backup dei dati (dischi)</span><span class="sxs-lookup"><span data-stu-id="f10c7-368">Backup the data (disks)</span></span>
2. <span data-ttu-id="f10c7-369">Backup della configurazione (modelli, immagini personalizzate)</span><span class="sxs-lookup"><span data-stu-id="f10c7-369">Backup the configuration (templates, custom images)</span></span>

<span data-ttu-id="f10c7-370">In base all'opzione di backup scelta, potrebbe essere necessario gestire il backup dei dati e della configurazione oppure consentire al servizio di backup di gestire automaticamente tali operazioni.</span><span class="sxs-lookup"><span data-stu-id="f10c7-370">Depending on the backup option you choose, you may have to handle the backup of both the data and the configuration, or the backup service may handle all of that for you.</span></span>

## <a name="appendix---understanding-the-impact-of-lrs-grs-and-ra-grs"></a><span data-ttu-id="f10c7-371">Appendice - Informazioni sull'impatto dell'archiviazione con ridondanza locale, dell'archiviazione con ridondanza geografica e dell'archiviazione con ridondanza geografica e accesso in lettura</span><span class="sxs-lookup"><span data-stu-id="f10c7-371">Appendix - Understanding the impact of LRS, GRS, and RA-GRS</span></span>

<span data-ttu-id="f10c7-372">Per gli account di archiviazione di Azure sono disponibili tre tipi di ridondanza dei dati da tenere in considerazione per il ripristino di emergenza, ovvero archiviazione con ridondanza locale, archiviazione con ridondanza geografica e archiviazione con ridondanza geografica e accesso in lettura.</span><span class="sxs-lookup"><span data-stu-id="f10c7-372">For storage accounts in Azure, there are three types of data redundancy that you should consider regarding disaster recovery – locally redundant (LRS), geo-redundant (GRS), or geo-redundant with read access (RA-GRS).</span></span> 

<span data-ttu-id="f10c7-373">L'archiviazione con ridondanza locale mantiene tre copie dei dati nello stesso data center.</span><span class="sxs-lookup"><span data-stu-id="f10c7-373">Locally Redundant Storage (LRS) retains three copies of the data in the same data center.</span></span> <span data-ttu-id="f10c7-374">Quando si scrivono i dati, tutte e tre le copie vengono aggiornate prima della restituzione dell'esito positivo al chiamante, quindi si è sicuri che siano identici.</span><span class="sxs-lookup"><span data-stu-id="f10c7-374">When writing the data, all three copies are updated before success is returned to the caller, so you know they are identical.</span></span> <span data-ttu-id="f10c7-375">Il disco è protetto da errori locali, perché è estremamente improbabile che tutte e tre le copie siano interessate contemporaneamente da un problema.</span><span class="sxs-lookup"><span data-stu-id="f10c7-375">Your disk is protected from local failures, since it is extremely unlikely that all three copies would be impacted at the same time.</span></span> <span data-ttu-id="f10c7-376">Nel caso dell'archiviazione con ridondanza locale non è disponibile la ridondanza geografica, quindi il disco non è protetto da errori irreversibili che possono interessare un intero data center o un'unità di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="f10c7-376">In the case of LRS, there is no geo-redundancy, so the disk is not protected from catastrophic failures that can impact an entire data center or storage unit.</span></span>

<span data-ttu-id="f10c7-377">Con l'archiviazione con ridondanza geografica e l'archiviazione con ridondanza geografica e accesso in lettura vengono mantenute tre copie dei dati nell'area primaria, selezionata dall'utente, e altre tre copie dei dati vengono mantenute in un'area secondaria corrispondente, impostata da Azure.</span><span class="sxs-lookup"><span data-stu-id="f10c7-377">With GRS and RA-GRS, three copies of your data are retained in the primary region (selected by you), and three more copies of your data are retained in a corresponding secondary region (set by Azure).</span></span> <span data-ttu-id="f10c7-378">Se, ad esempio, si archiviano dati negli Stati Uniti occidentali, i dati verranno replicati nell'area Stati Uniti orientali.</span><span class="sxs-lookup"><span data-stu-id="f10c7-378">For example, if you store data in West US, the data will be replicated to East US.</span></span> <span data-ttu-id="f10c7-379">Questa operazione viene eseguita in modo asincrono e si verifica un leggero ritardo tra gli aggiornamenti al sito primario e secondario.</span><span class="sxs-lookup"><span data-stu-id="f10c7-379">This is done asynchronously, and there is a small delay between updates to the primary and secondary.</span></span> <span data-ttu-id="f10c7-380">Le repliche dei dischi nel sito secondario sono coerenti in base ai singoli dischi (con ritardo), ma le repliche di più dischi attivi potrebbero non essere sincronizzate **tra loro**.</span><span class="sxs-lookup"><span data-stu-id="f10c7-380">Replicas of the disks on the secondary site are consistent on a per-disk basis (with the delay), but replicas of multiple active disks may not be in sync **with each other**.</span></span> <span data-ttu-id="f10c7-381">Per ottenere repliche coerenti tra più dischi, sono necessari snapshot coerenti.</span><span class="sxs-lookup"><span data-stu-id="f10c7-381">To have consistent replicas across multiple disks, consistent snapshots are needed.</span></span>

<span data-ttu-id="f10c7-382">La differenza principale tra l'archiviazione con ridondanza geografica e l'archiviazione con ridondanza geografica e accesso in lettura consiste nel fatto che l'archiviazione con ridondanza geografica e accesso in lettura consente di leggere la copia secondaria in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="f10c7-382">The main difference between GRS and RA-GRS is that with RA-GRS, you can read the secondary copy at any time.</span></span> <span data-ttu-id="f10c7-383">Se si verifica un problema che rende inaccessibili i dati nell'area primaria, il team di Azure si impegnerà per ripristinare l'accesso.</span><span class="sxs-lookup"><span data-stu-id="f10c7-383">If there is a problem that renders the data in the primary region inaccessible, the Azure team will make every effort to restore access.</span></span> <span data-ttu-id="f10c7-384">Quando l'area primaria è inattiva, se è abilitata l'archiviazione con ridondanza geografica e accesso in lettura, è possibile accedere ai dati nel data center secondario.</span><span class="sxs-lookup"><span data-stu-id="f10c7-384">While the primary is down, if you have RA-GRS enabled, you can access the data in the secondary data center.</span></span> <span data-ttu-id="f10c7-385">Se quindi si prevede la lettura dalla replica quando l'area primaria è inaccessibile, è consigliabile prendere in considerazione l'archiviazione con ridondanza geografica e accesso in lettura.</span><span class="sxs-lookup"><span data-stu-id="f10c7-385">Therefore, if you plan to read from the replica while the primary is inaccessible, then RA-GRS should be considered.</span></span>

<span data-ttu-id="f10c7-386">Se si verifica un'interruzione significativa, è possibile che il team di Azure attivi un failover geografico e modifichi le voci del DNS primario in modo che facciano riferimento alle risorse di archiviazione secondarie.</span><span class="sxs-lookup"><span data-stu-id="f10c7-386">If it turns out to be a significant outage, the Azure team may trigger a geo-failover and change the primary DNS entries to point to secondary storage.</span></span> <span data-ttu-id="f10c7-387">A questo punto, se è abilitata l'archiviazione con ridondanza geografica o l'archiviazione con ridondanza geografica e accesso in lettura, è possibile accedere ai dati nell'area che era precedentemente secondaria.</span><span class="sxs-lookup"><span data-stu-id="f10c7-387">At this point, if you have either GRS or RA-GRS enabled, you can access the data in the region that used to be the secondary.</span></span> <span data-ttu-id="f10c7-388">In altri termini, se l'account di archiviazione è di tipo archiviazione con ridondanza geografica e si verifica un problema, è possibile accedere alle risorse di archiviazione secondarie solo se è disponibile il failover geografico.</span><span class="sxs-lookup"><span data-stu-id="f10c7-388">In other words, if your storage account is GRS and there is a problem, you can access the secondary storage only if there is a geo-failover.</span></span>

<span data-ttu-id="f10c7-389">Per altre informazioni, vedere [Cosa fare se si verifica un'interruzione di Archiviazione di Azure](storage-disaster-recovery-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="f10c7-389">For more information, see [What to do if an Azure Storage outage occurs](storage-disaster-recovery-guidance.md).</span></span> 

<span data-ttu-id="f10c7-390">Si noti che Microsoft controlla il verificarsi di un failover.</span><span class="sxs-lookup"><span data-stu-id="f10c7-390">Note that Microsoft controls whether a failover occurs.</span></span> <span data-ttu-id="f10c7-391">Il failover non è controllato per i singoli account di archiviazione e non viene quindi determinato dai singoli clienti.</span><span class="sxs-lookup"><span data-stu-id="f10c7-391">Failover is not controlled per storage account, therefore it is not decided by individual customers.</span></span> <span data-ttu-id="f10c7-392">Per implementare il ripristino di emergenza per account di archiviazione o dischi di macchine virtuali specifici, è necessario usare le tecniche illustrate in precedenza in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="f10c7-392">To implement Disaster Recovery for specific storage accounts or virtual machine disks, you must use the techniques described previously in this article.</span></span>
