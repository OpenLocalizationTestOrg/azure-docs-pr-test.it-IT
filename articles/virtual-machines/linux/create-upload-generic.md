---
title: aaaCreate e caricamento di un VHD Linux in Azure
description: Informazioni su toocreate e caricare un Azure disco rigido virtuale (VHD) che contiene un sistema operativo Linux.
services: virtual-machines-linux
documentationcenter: 
author: szarkos
manager: timlt
editor: tysonn
tags: azure-resource-manager,azure-service-management
ms.assetid: d351396c-95a0-4092-b7bf-c6aae0bbd112
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 02/02/2017
ms.author: szark
ms.openlocfilehash: 208e15c035edb5520fc29ba8e4e71c42b041864d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="information-for-non-endorsed-distributions"></a><span data-ttu-id="47555-103">Informazioni per le distribuzioni non approvate</span><span class="sxs-lookup"><span data-stu-id="47555-103">Information for Non-Endorsed Distributions</span></span>
[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="47555-104">contratto di servizio di piattaforma Azure Hello applica toovirtual computer hello del sistema operativo Linux solo quando uno di hello [approvate per le distribuzioni](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) viene utilizzato.</span><span class="sxs-lookup"><span data-stu-id="47555-104">hello Azure platform SLA applies toovirtual machines running hello Linux OS only when one of hello [endorsed distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) is used.</span></span> <span data-ttu-id="47555-105">Tutte le distribuzioni di Linux che vengono fornite in hello Azure raccolta immagini sono approvate per le distribuzioni con la configurazione richiesta hello.</span><span class="sxs-lookup"><span data-stu-id="47555-105">All Linux distributions that are provided in hello Azure image gallery are endorsed distributions with hello required configuration.</span></span>

* [<span data-ttu-id="47555-106">Linux in Azure - Distribuzioni supportate</span><span class="sxs-lookup"><span data-stu-id="47555-106">Linux on Azure - Endorsed Distributions</span></span>](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
* [<span data-ttu-id="47555-107">Supporto delle immagini Linux in Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="47555-107">Support for Linux images in Microsoft Azure</span></span>](https://support.microsoft.com/kb/2941892)

<span data-ttu-id="47555-108">Tutte le distribuzioni in esecuzione in Azure saranno necessario un numero di prerequisiti toohave tooproperly una possibilità eseguire sulla piattaforma hello toomeet.</span><span class="sxs-lookup"><span data-stu-id="47555-108">All distributions running on Azure will need toomeet a number of prerequisites toohave a chance tooproperly run on hello platform.</span></span>  <span data-ttu-id="47555-109">In questo articolo non è completo come ogni distribuzione è diverso. ed è molto probabile che anche se vengono soddisfatti tutti hello i seguenti criteri che dovranno comunque toosignificantly modificare il tooensure sistema Linux che viene eseguito correttamente sulla piattaforma hello.</span><span class="sxs-lookup"><span data-stu-id="47555-109">This article is by no means comprehensive as every distribution is different; and it is quite possible that even if you meet all hello criteria below you will still need toosignificantly tweak your Linux system tooensure that it properly runs on hello platform.</span></span>

<span data-ttu-id="47555-110">Per questo motivo, è consigliabile iniziare, laddove possibile, con una delle [distribuzioni approvate di Linux su Azure](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) .</span><span class="sxs-lookup"><span data-stu-id="47555-110">It is for this reason that we recommend that you start with one of our [Linux on Azure Endorsed Distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) when possible.</span></span> <span data-ttu-id="47555-111">Hello articoli seguenti guiderà come tooprepare hello vari approvate per distribuzioni di Linux che sono supportate in Azure:</span><span class="sxs-lookup"><span data-stu-id="47555-111">hello following articles will guide you through how tooprepare hello various endorsed Linux distributions that are supported on Azure:</span></span>

* <span data-ttu-id="47555-112">**[Distribuzioni basate su CentOS](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="47555-112">**[CentOS-based Distributions](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="47555-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="47555-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="47555-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="47555-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="47555-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="47555-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="47555-116">**[SLES e openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="47555-116">**[SLES & openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="47555-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="47555-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>

<span data-ttu-id="47555-118">rest Hello di questo articolo verranno evidenziate le indicazioni generali per eseguire la distribuzione di Linux in Azure.</span><span class="sxs-lookup"><span data-stu-id="47555-118">hello rest of this article will focus on general guidance for running your Linux distribution on Azure.</span></span>

## <a name="general-linux-installation-notes"></a><span data-ttu-id="47555-119">Note generali sull'installazione di Linux</span><span class="sxs-lookup"><span data-stu-id="47555-119">General Linux Installation Notes</span></span>
* <span data-ttu-id="47555-120">formato VHDX Hello non è supportato solo in Azure, **disco rigido virtuale fisso**.</span><span class="sxs-lookup"><span data-stu-id="47555-120">hello VHDX format is not supported in Azure, only **fixed VHD**.</span></span>  <span data-ttu-id="47555-121">È possibile convertire il formato hello disco tooVHD con gestione Hyper-V o hello cmdlet convert-vhd.</span><span class="sxs-lookup"><span data-stu-id="47555-121">You can convert hello disk tooVHD format using Hyper-V Manager or hello convert-vhd cmdlet.</span></span> <span data-ttu-id="47555-122">Se si utilizza VirtualBox ciò significa che la selezione di **dimensioni fisse** come anziché predefinito toohello allocata in modo dinamico durante la creazione del disco hello.</span><span class="sxs-lookup"><span data-stu-id="47555-122">If you are using VirtualBox this means selecting **Fixed size** as opposed toohello default dynamically allocated when creating hello disk.</span></span>
* <span data-ttu-id="47555-123">Azure supporta solo macchine virtuali di generazione 1.</span><span class="sxs-lookup"><span data-stu-id="47555-123">Azure only supports generation 1 virtual machines.</span></span> <span data-ttu-id="47555-124">È possibile convertire una generazione 1 macchina virtuale dal formato del file disco rigido virtuale VHDX toohello e da tooa fissata a espansione dinamica dimensioni su disco.</span><span class="sxs-lookup"><span data-stu-id="47555-124">You can convert a generation 1 virtual machine from VHDX toohello VHD file format and from dynamically expanding tooa fixed sized disk.</span></span> <span data-ttu-id="47555-125">Tuttavia non è possibile modificare la generazione di una macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="47555-125">But you can't change a virtual machine's generation.</span></span> <span data-ttu-id="47555-126">Per ulteriori informazioni, vedere [Creare una macchina virtuale di prima o seconda generazione in Hyper-V](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span><span class="sxs-lookup"><span data-stu-id="47555-126">For more information, see [Should I create a generation 1 or 2 virtual machine in Hyper-V?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span></span>
* <span data-ttu-id="47555-127">dimensione massima di Hello consentite per hello che VHD è 1023 GB.</span><span class="sxs-lookup"><span data-stu-id="47555-127">hello maximum size allowed for hello VHD is 1,023 GB.</span></span>
* <span data-ttu-id="47555-128">Quando si installa il sistema di Linux hello è *consigliato* utilizzare partizioni standard anziché LVM (spesso predefinito hello per numerose installazioni).</span><span class="sxs-lookup"><span data-stu-id="47555-128">When installing hello Linux system it is *recommended* that you use standard partitions rather than LVM (often hello default for many installations).</span></span> <span data-ttu-id="47555-129">Questo modo si evita i conflitti di nome LVM con macchine virtuali clonate, in particolare se un disco del sistema operativo necessaria tooanother toobe collegato identici macchina virtuale per la risoluzione dei problemi.</span><span class="sxs-lookup"><span data-stu-id="47555-129">This will avoid LVM name conflicts with cloned VMs, particularly if an OS disk ever needs toobe attached tooanother identical VM for troubleshooting.</span></span> <span data-ttu-id="47555-130">È possibile usare [LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) o [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) su dischi di dati.</span><span class="sxs-lookup"><span data-stu-id="47555-130">[LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) or [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) may be used on data disks.</span></span>
* <span data-ttu-id="47555-131">Per l'installazione di file system UDF è necessario il supporto di kernel.</span><span class="sxs-lookup"><span data-stu-id="47555-131">Kernel support for mounting UDF file systems is required.</span></span> <span data-ttu-id="47555-132">Al primo avvio del hello Azure configurazione provisioning viene passato toohello VM Linux tramite supporti formattati funzione definita dall'utente che sono collegato toohello guest.</span><span class="sxs-lookup"><span data-stu-id="47555-132">At first boot on Azure hello provisioning configuration is passed toohello Linux VM via UDF-formatted media that is attached toohello guest.</span></span> <span data-ttu-id="47555-133">l'agente Linux di Azure Hello deve essere in grado di toomount hello UDF file system tooread la configurazione e provisioning hello macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="47555-133">hello Azure Linux agent must be able toomount hello UDF file system tooread its configuration and provision hello VM.</span></span>
* <span data-ttu-id="47555-134">Le versioni di kernel Linux inferiori a 2.6.37 non supportano NUMA su Hyper-V con macchine virtuali di dimensioni maggiori.</span><span class="sxs-lookup"><span data-stu-id="47555-134">Linux kernel versions below 2.6.37 do not support NUMA on Hyper-V with larger VM sizes.</span></span> <span data-ttu-id="47555-135">Questo problema principalmente impatti distribuzioni precedenti utilizzando hello monte kernel Red Hat 2.6.32 ed è stato corretto in RHEL 6.6 (kernel-2.6.32-504).</span><span class="sxs-lookup"><span data-stu-id="47555-135">This issue primarily impacts older distributions using hello upstream Red Hat 2.6.32 kernel, and was fixed in RHEL 6.6 (kernel-2.6.32-504).</span></span> <span data-ttu-id="47555-136">I sistemi che eseguono personalizzato kernel meno recente 2.6.37 o basato su RHEL kernel precedenti rispetto a 2.6.32-504 è necessario impostare il parametro di avvio di hello `numa=off` sul kernel hello in grub.conf della riga di comando.</span><span class="sxs-lookup"><span data-stu-id="47555-136">Systems running custom kernels older than 2.6.37, or RHEL-based kernels older than 2.6.32-504 must set hello boot parameter `numa=off` on hello kernel command-line in grub.conf.</span></span> <span data-ttu-id="47555-137">Per altre informazioni, vedere l'articolo Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span><span class="sxs-lookup"><span data-stu-id="47555-137">For more information see Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span></span>
* <span data-ttu-id="47555-138">Non si configura una partizione di scambio su disco del sistema operativo hello.</span><span class="sxs-lookup"><span data-stu-id="47555-138">Do not configure a swap partition on hello OS disk.</span></span> <span data-ttu-id="47555-139">agente Linux di Hello può essere configurato toocreate un file di swapping sul disco di risorse temporaneo hello.</span><span class="sxs-lookup"><span data-stu-id="47555-139">hello Linux agent can be configured toocreate a swap file on hello temporary resource disk.</span></span>  <span data-ttu-id="47555-140">Ulteriori informazioni su questo sono reperibile in passaggi hello riportati di seguito.</span><span class="sxs-lookup"><span data-stu-id="47555-140">More information about this can be found in hello steps below.</span></span>
* <span data-ttu-id="47555-141">Tutti i dischi rigidi virtuali hello devono avere dimensioni che sono multipli di 1 MB.</span><span class="sxs-lookup"><span data-stu-id="47555-141">All of hello VHDs must have sizes that are multiples of 1 MB.</span></span>

### <a name="installing-kernel-modules-without-hyper-v"></a><span data-ttu-id="47555-142">Installazione dei moduli kernel senza Hyper-V</span><span class="sxs-lookup"><span data-stu-id="47555-142">Installing kernel modules without Hyper-V</span></span>
<span data-ttu-id="47555-143">Azure viene eseguito nell'hypervisor Hyper-V hello, in modo Linux è necessario che alcuni moduli kernel siano installati in ordine toorun in Azure.</span><span class="sxs-lookup"><span data-stu-id="47555-143">Azure runs on hello Hyper-V hypervisor, so Linux requires that certain kernel modules are installed in order toorun in Azure.</span></span> <span data-ttu-id="47555-144">Se si dispone di una macchina virtuale che è stata creata all'esterno di Hyper-V, i programmi di installazione di hello Linux non può includere i driver di hello per Hyper-V in hello ramdisk iniziale (initrd o initramfs) a meno che non viene rilevato che è in esecuzione un un ambiente Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="47555-144">If you have a VM that was created outside of Hyper-V, hello Linux installers may not include hello drivers for Hyper-V in hello initial ramdisk (initrd or initramfs) unless it detects that it is running an a Hyper-V environment.</span></span> <span data-ttu-id="47555-145">Quando si utilizza un tooprepare di sistema (ad esempio Virtualbox, KVM, e così via) di virtualizzazione diverso come immagine Linux, potrebbe essere necessario toorebuild hello initrd tooensure che almeno hello `hv_vmbus` e `hv_storvsc` sono disponibili su ramdisk iniziale hello moduli del kernel.</span><span class="sxs-lookup"><span data-stu-id="47555-145">When using a different virtualization system (i.e. Virtualbox, KVM, etc.) tooprepare your Linux image, you may need toorebuild hello initrd tooensure that at least hello `hv_vmbus` and `hv_storvsc` kernel modules are available on hello initial ramdisk.</span></span>  <span data-ttu-id="47555-146">Questo è un problema noto almeno sui sistemi basati su distribuzione Red Hat upstream hello.</span><span class="sxs-lookup"><span data-stu-id="47555-146">This is a known issue at least on systems based on hello upstream Red Hat distribution.</span></span>

<span data-ttu-id="47555-147">il meccanismo di Hello per la ricompilazione hello initrd initramfs l'immagine o può variare a seconda della distribuzione di hello.</span><span class="sxs-lookup"><span data-stu-id="47555-147">hello mechanism for rebuilding hello initrd or initramfs image may vary depending on hello distribution.</span></span> <span data-ttu-id="47555-148">Consultare la documentazione della distribuzione o il supporto per la procedura appropriata hello.</span><span class="sxs-lookup"><span data-stu-id="47555-148">Please consult your distribution's documentation or support for hello proper procedure.</span></span>  <span data-ttu-id="47555-149">Ecco un esempio per come toorebuild hello initrd utilizzando hello `mkinitrd` utilità:</span><span class="sxs-lookup"><span data-stu-id="47555-149">Here is one example for how toorebuild hello initrd using hello `mkinitrd` utility:</span></span>

<span data-ttu-id="47555-150">Per eseguire il backup immagine initrd esistente hello:</span><span class="sxs-lookup"><span data-stu-id="47555-150">First, back up hello existing initrd image:</span></span>

    # cd /boot
    # sudo cp initrd-`uname -r`.img  initrd-`uname -r`.img.bak

<span data-ttu-id="47555-151">Successivamente, ricompilare initrd hello con hello `hv_vmbus` e `hv_storvsc` moduli kernel:</span><span class="sxs-lookup"><span data-stu-id="47555-151">Next, rebuild hello initrd with hello `hv_vmbus` and `hv_storvsc` kernel modules:</span></span>

    # sudo mkinitrd --preload=hv_storvsc --preload=hv_vmbus -v -f initrd-`uname -r`.img `uname -r`


### <a name="resizing-vhds"></a><span data-ttu-id="47555-152">Ridimensionamento dei dischi rigidi virtuali</span><span class="sxs-lookup"><span data-stu-id="47555-152">Resizing VHDs</span></span>
<span data-ttu-id="47555-153">Immagini del disco rigido virtuale in Azure devono avere un too1MB dimensioni virtuali allineata.</span><span class="sxs-lookup"><span data-stu-id="47555-153">VHD images on Azure must have a virtual size aligned too1MB.</span></span>  <span data-ttu-id="47555-154">Solitamente, i VHD creati usando Hyper-V sono già allineati correttamente.</span><span class="sxs-lookup"><span data-stu-id="47555-154">Typically, VHDs created using Hyper-V should already be aligned correctly.</span></span>  <span data-ttu-id="47555-155">Se hello disco rigido virtuale non è allineato correttamente, quindi è possibile che venga visualizzato un errore messaggio simili toohello seguenti quando si tenta di toocreate un *immagine* dal disco rigido virtuale:</span><span class="sxs-lookup"><span data-stu-id="47555-155">If hello VHD is not aligned correctly then you may receive an error message similar toohello following when you attempt toocreate an *image* from your VHD:</span></span>

    "hello VHD http://<mystorageaccount>.blob.core.windows.net/vhds/MyLinuxVM.vhd has an unsupported virtual size of 21475270656 bytes. hello size must be a whole number (in MBs).”

<span data-ttu-id="47555-156">tooremedy questo è possibile ridimensionare hello VM utilizzando la console di gestione di Hyper-V di hello o hello [Resize-VHD](http://technet.microsoft.com/library/hh848535.aspx) cmdlet di Powershell.</span><span class="sxs-lookup"><span data-stu-id="47555-156">tooremedy this you can resize hello VM using either hello Hyper-V Manager console or hello [Resize-VHD](http://technet.microsoft.com/library/hh848535.aspx) Powershell cmdlet.</span></span>  <span data-ttu-id="47555-157">Se non si esegue in un ambiente Windows è consigliabile toouse qemu img tooconvert (se necessario) e ridimensionare hello disco rigido virtuale.</span><span class="sxs-lookup"><span data-stu-id="47555-157">If you are not running in a Windows environment then it is recommended toouse qemu-img tooconvert (if needed) and resize hello VHD.</span></span>

> [!NOTE]
> <span data-ttu-id="47555-158">Esiste un bug noto nelle versioni qemu-img > = 2.2.1 risultante in un disco rigido virtuale non formattato correttamente.</span><span class="sxs-lookup"><span data-stu-id="47555-158">There is a known bug in qemu-img versions >=2.2.1 that results in an improperly formatted VHD.</span></span> <span data-ttu-id="47555-159">problema di Hello è stato risolto in QEMU 2.6.</span><span class="sxs-lookup"><span data-stu-id="47555-159">hello issue has been fixed in QEMU 2.6.</span></span> <span data-ttu-id="47555-160">È consigliabile toouse qemu-img 2.2.0 o inferiore o aggiornamento too2.6 o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="47555-160">It is recommended toouse either qemu-img 2.2.0 or lower, or update too2.6 or higher.</span></span> <span data-ttu-id="47555-161">Riferimento: https://bugs.launchpad.net/qemu/+bug/1490611.</span><span class="sxs-lookup"><span data-stu-id="47555-161">Reference: https://bugs.launchpad.net/qemu/+bug/1490611.</span></span>
> 
> 

1. <span data-ttu-id="47555-162">Ridimensionamento hello VHD direttamente tramite strumenti come `qemu-img` o `vbox-manage` può comportare un disco rigido virtuale di avvio.</span><span class="sxs-lookup"><span data-stu-id="47555-162">Resizing hello VHD directly using tools such as `qemu-img` or `vbox-manage` may result in an unbootable VHD.</span></span>  <span data-ttu-id="47555-163">È consigliabile toofirst convert hello immagine del disco rigido virtuale tooa disco non ELABORATO.</span><span class="sxs-lookup"><span data-stu-id="47555-163">So it is recommended toofirst convert hello VHD tooa RAW disk image.</span></span>  <span data-ttu-id="47555-164">Se l'immagine di macchina virtuale hello è già stato creato come immagine del disco non ELABORATO (impostazione predefinita hello per alcuni hypervisor, ad esempio KVM) è possibile saltare questo passaggio:</span><span class="sxs-lookup"><span data-stu-id="47555-164">If hello VM image was already created as RAW disk image (hello default for some Hypervisors such as KVM) then you may skip this step:</span></span>
   
       # qemu-img convert -f vpc -O raw MyLinuxVM.vhd MyLinuxVM.raw

2. <span data-ttu-id="47555-165">Calcolare hello richiesto pari a tooensure di immagine disco hello che hello dimensioni virtuali too1MB allineati.</span><span class="sxs-lookup"><span data-stu-id="47555-165">Calculate hello required size of hello disk image tooensure that hello virtual size is aligned too1MB.</span></span>  <span data-ttu-id="47555-166">con questo consentono di Hello seguente script della shell bash.</span><span class="sxs-lookup"><span data-stu-id="47555-166">hello following bash shell script can assist with this.</span></span>  <span data-ttu-id="47555-167">utilizza script Hello "`qemu-img info`" toodetermine hello virtuale dimensioni dell'immagine disco hello e quindi Calcola hello dimensioni toohello avanti 1 MB:</span><span class="sxs-lookup"><span data-stu-id="47555-167">hello script uses "`qemu-img info`" toodetermine hello virtual size of hello disk image and then calculates hello size toohello next 1MB:</span></span>
   
       rawdisk="MyLinuxVM.raw"
       vhddisk="MyLinuxVM.vhd"
   
       MB=$((1024*1024))
       size=$(qemu-img info -f raw --output json "$rawdisk" | \
              gawk 'match($0, /"virtual-size": ([0-9]+),/, val) {print val[1]}')
   
       rounded_size=$((($size/$MB + 1)*$MB))
       echo "Rounded Size = $rounded_size"

3. <span data-ttu-id="47555-168">Ridimensionamento del disco non elaborato di hello utilizzando $rounded_size come set di hello sopra script:</span><span class="sxs-lookup"><span data-stu-id="47555-168">Resize hello raw disk using $rounded_size as set in hello above script:</span></span>
   
       # qemu-img resize MyLinuxVM.raw $rounded_size

4. <span data-ttu-id="47555-169">A questo punto, convertire hello disco RAW indietro tooa disco rigido virtuale a dimensione fissa:</span><span class="sxs-lookup"><span data-stu-id="47555-169">Now, convert hello RAW disk back tooa fixed-size VHD:</span></span>
   
       # qemu-img convert -f raw -o subformat=fixed -O vpc MyLinuxVM.raw MyLinuxVM.vhd

   <span data-ttu-id="47555-170">Oppure, con versione qemu **2.6 +** includono hello `force_size` opzione:</span><span class="sxs-lookup"><span data-stu-id="47555-170">Or, with qemu version **2.6+** include hello `force_size` option:</span></span>

       # qemu-img convert -f raw -o subformat=fixed,force_size -O vpc MyLinuxVM.raw MyLinuxVM.vhd

## <a name="linux-kernel-requirements"></a><span data-ttu-id="47555-171">Requisiti del kernel Linux</span><span class="sxs-lookup"><span data-stu-id="47555-171">Linux Kernel Requirements</span></span>
<span data-ttu-id="47555-172">Hello driver Linux Integration Services (LIS) per Hyper-V e Azure vengono forniti toohello direttamente a monte kernel di Linux.</span><span class="sxs-lookup"><span data-stu-id="47555-172">hello Linux Integration Services (LIS) drivers for Hyper-V and Azure are contributed directly toohello upstream Linux kernel.</span></span> <span data-ttu-id="47555-173">Per molte distribuzioni che includono una versione recente del kernel Linux (cioè 3.x) questi driver sono già disponibili; in alternativa, fornire versioni backport dei driver con i relativi kernel.</span><span class="sxs-lookup"><span data-stu-id="47555-173">Many distributions that include a recent Linux kernel version (i.e. 3.x) will have these drivers available already, or otherwise provide backported versions of these drivers with their kernels.</span></span>  <span data-ttu-id="47555-174">Questi driver vengono continuamente aggiornati nel kernel di upstream hello con nuove correzioni e funzionalità, quando possibile è consigliabile toorun un [approvate distribuzione](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) che includerà le correzioni e gli aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="47555-174">These drivers are constantly being updated in hello upstream kernel with new fixes and features, so when possible it is recommended toorun an [endorsed distribution](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) that will include these fixes and updates.</span></span>

<span data-ttu-id="47555-175">Se si utilizza una variante di Red Hat Enterprise Linux versioni **6.0-6.3**, sarà necessario tooinstall hello LIS driver per Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="47555-175">If you are running a variant of Red Hat Enterprise Linux versions **6.0-6.3**, then you will need tooinstall hello latest LIS drivers for Hyper-V.</span></span> <span data-ttu-id="47555-176">sono disponibili driver Hello [in questa posizione](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="47555-176">hello drivers can be found [at this location](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span></span> <span data-ttu-id="47555-177">A partire da RHEL **6.4 +** (e derivati) driver LIS hello sono già inclusi in kernel hello e pertanto non sono pacchetti di installazione aggiuntive sono necessarie toorun tali sistemi in Azure.</span><span class="sxs-lookup"><span data-stu-id="47555-177">As of RHEL **6.4+** (and derivatives) hello LIS drivers are already included with hello kernel and so no additional installation packages are needed toorun those systems on Azure.</span></span>

<span data-ttu-id="47555-178">Se un kernel personalizzato è necessario, è consigliabile toouse una versione più recente di kernel (ad esempio **3.8 +**).</span><span class="sxs-lookup"><span data-stu-id="47555-178">If a custom kernel is required, it is recommended toouse a more recent kernel version (i.e. **3.8+**).</span></span> <span data-ttu-id="47555-179">Per tali distribuzioni o i fornitori che gestiscono le proprie kernel, alcune attività sarà obbligatorio tooregularly backport hello LIS driver dal kernel di hello kernel upstream tooyour personalizzato.</span><span class="sxs-lookup"><span data-stu-id="47555-179">For those distributions or vendors who maintain their own kernel, some effort will be required tooregularly backport hello LIS drivers from hello upstream kernel tooyour custom kernel.</span></span>  <span data-ttu-id="47555-180">Anche se già in esecuzione una versione del kernel relativamente più recenti, è consigliabile tookeep tenere traccia di qualsiasi a monte correzioni in backport e i driver LIS hello quelli in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="47555-180">Even if you are already running a relatively recent kernel version, it is highly recommended tookeep track of any upstream fixes in hello LIS drivers and backport those as needed.</span></span> <span data-ttu-id="47555-181">percorso di Hello dei file di origine di hello LIS driver è disponibile in hello [gestori](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) file nell'albero di origine kernel Linux hello:</span><span class="sxs-lookup"><span data-stu-id="47555-181">hello location of hello LIS driver source files is available in hello [MAINTAINERS](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) file in hello Linux kernel source tree:</span></span>

    F:    arch/x86/include/asm/mshyperv.h
    F:    arch/x86/include/uapi/asm/hyperv.h
    F:    arch/x86/kernel/cpu/mshyperv.c
    F:    drivers/hid/hid-hyperv.c
    F:    drivers/hv/
    F:    drivers/input/serio/hyperv-keyboard.c
    F:    drivers/net/hyperv/
    F:    drivers/scsi/storvsc_drv.c
    F:    drivers/video/fbdev/hyperv_fb.c
    F:    include/linux/hyperv.h
    F:    tools/hv/

<span data-ttu-id="47555-182">Nel caso minimo, assenza hello di hello seguenti patch è noto toocause problemi in Azure e così queste deve essere incluso nel kernel di hello.</span><span class="sxs-lookup"><span data-stu-id="47555-182">At a very minimum, hello absence of hello following patches have been known toocause problems on Azure and so these must be included in hello kernel.</span></span> <span data-ttu-id="47555-183">L'elenco non è esaustivo o completo per tutte le distribuzioni:</span><span class="sxs-lookup"><span data-stu-id="47555-183">This list is by no means exhaustive or complete for all distributions:</span></span>

* [<span data-ttu-id="47555-184">ata_piix: rinviare i driver di dischi toohello Hyper-V per impostazione predefinita</span><span class="sxs-lookup"><span data-stu-id="47555-184">ata_piix: defer disks toohello Hyper-V drivers by default</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/ata/ata_piix.c?id=cd006086fa5d91414d8ff9ff2b78fbb593878e3c)
* [<span data-ttu-id="47555-185">storvsc: Account per i pacchetti in transito nel percorso di ripristino hello</span><span class="sxs-lookup"><span data-stu-id="47555-185">storvsc: Account for in-transit packets in hello RESET path</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/scsi/storvsc_drv.c?id=5c1b10ab7f93d24f29b5630286e323d1c5802d5c)
* [<span data-ttu-id="47555-186">storvsc: avoid usage of WRITE_SAME</span><span class="sxs-lookup"><span data-stu-id="47555-186">storvsc: avoid usage of WRITE_SAME</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=3e8f4f4065901c8dfc51407e1984495e1748c090)
* [<span data-ttu-id="47555-187">storvsc: Disable WRITE SAME for RAID and virtual host adapter drivers</span><span class="sxs-lookup"><span data-stu-id="47555-187">storvsc: Disable WRITE SAME for RAID and virtual host adapter drivers</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=54b2b50c20a61b51199bedb6e5d2f8ec2568fb43)
* [<span data-ttu-id="47555-188">storvsc: NULL pointer dereference fix</span><span class="sxs-lookup"><span data-stu-id="47555-188">storvsc: NULL pointer dereference fix</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=b12bb60d6c350b348a4e1460cd68f97ccae9822e)
* [<span data-ttu-id="47555-189">storvsc: ring buffer failures may result in I/O freeze</span><span class="sxs-lookup"><span data-stu-id="47555-189">storvsc: ring buffer failures may result in I/O freeze</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=e86fb5e8ab95f10ec5f2e9430119d5d35020c951)
* [<span data-ttu-id="47555-190">scsi_sysfs: protect against double execution of __scsi_remove_device</span><span class="sxs-lookup"><span data-stu-id="47555-190">scsi_sysfs: protect against double execution of __scsi_remove_device</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/scsi_sysfs.c?id=be821fd8e62765de43cc4f0e2db363d0e30a7e9b)

## <a name="hello-azure-linux-agent"></a><span data-ttu-id="47555-191">Hello agente Linux di Azure</span><span class="sxs-lookup"><span data-stu-id="47555-191">hello Azure Linux Agent</span></span>
<span data-ttu-id="47555-192">Hello [agente Linux di Azure](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) è necessario tooproperly effettuare il provisioning di una macchina virtuale di Linux in Azure.</span><span class="sxs-lookup"><span data-stu-id="47555-192">hello [Azure Linux Agent](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) is required tooproperly provision a Linux virtual machine in Azure.</span></span> <span data-ttu-id="47555-193">È possibile ottenere la versione più recente di hello, file problemi o inviare richieste pull in hello [repository GitHub agente Linux](https://github.com/Azure/WALinuxAgent).</span><span class="sxs-lookup"><span data-stu-id="47555-193">You can get hello latest version, file issues or submit pull requests at hello [Linux Agent GitHub repo](https://github.com/Azure/WALinuxAgent).</span></span>

* <span data-ttu-id="47555-194">agente Linux di Hello viene rilasciato con licenza di Apache 2.0 hello.</span><span class="sxs-lookup"><span data-stu-id="47555-194">hello Linux agent is released under hello Apache 2.0 license.</span></span> <span data-ttu-id="47555-195">Molte distribuzioni già forniscono RPM o deb pacchetti per hello agente e pertanto in alcuni casi si possono essere installato e aggiornato con un minimo sforzo.</span><span class="sxs-lookup"><span data-stu-id="47555-195">Many distributions already provide RPM or deb packages for hello agent, and so in some cases this can be installed and updated with little effort.</span></span>
* <span data-ttu-id="47555-196">Hello agente Linux di Azure richiede Python versione 2.6 +.</span><span class="sxs-lookup"><span data-stu-id="47555-196">hello Azure Linux Agent requires Python v2.6+.</span></span>
* <span data-ttu-id="47555-197">l'agente Hello richiede anche il modulo di python pyasn1 hello.</span><span class="sxs-lookup"><span data-stu-id="47555-197">hello agent also requires hello python-pyasn1 module.</span></span> <span data-ttu-id="47555-198">che nella maggior parte delle distribuzioni viene fornito come pacchetto separato installabile.</span><span class="sxs-lookup"><span data-stu-id="47555-198">Most distributions provide this as a separate package that can be installed.</span></span>
* <span data-ttu-id="47555-199">In alcuni casi potrebbe non essere compatibile con NetworkManager hello agente Linux di Azure.</span><span class="sxs-lookup"><span data-stu-id="47555-199">In some cases hello Azure Linux Agent may not be compatible with NetworkManager.</span></span> <span data-ttu-id="47555-200">Molti dei pacchetti RPM o Deb hello forniti da distribuzioni configurare NetworkManager come pacchetto waagent toohello conflitto e pertanto verrà disinstallato NetworkManager quando si installa pacchetto dell'agente Linux di hello.</span><span class="sxs-lookup"><span data-stu-id="47555-200">Many of hello RPM/Deb packages provided by distributions configure NetworkManager as a conflict toohello waagent package, and thus will uninstall NetworkManager when you install hello Linux agent package.</span></span>

## <a name="general-linux-system-requirements"></a><span data-ttu-id="47555-201">Requisiti generali di sistema relativi a Linux</span><span class="sxs-lookup"><span data-stu-id="47555-201">General Linux System Requirements</span></span>

* <span data-ttu-id="47555-202">Modifica linea di avvio di kernel hello in GRUB o GRUB2 hello tooinclude seguenti parametri.</span><span class="sxs-lookup"><span data-stu-id="47555-202">Modify hello kernel boot line in GRUB or GRUB2 tooinclude hello following parameters.</span></span> <span data-ttu-id="47555-203">In questo modo anche tutti i messaggi della console vengono inviati toohello prima porta seriale, che consentono di Azure supporto con il debug dei problemi:</span><span class="sxs-lookup"><span data-stu-id="47555-203">This will also ensure all console messages are sent toohello first serial port, which can assist Azure support with debugging issues:</span></span>
  
        console=ttyS0,115200n8 earlyprintk=ttyS0,115200 rootdelay=300
  
    <span data-ttu-id="47555-204">In questo modo anche tutti i messaggi della console vengono inviati toohello prima porta seriale, che consentono di Azure supporto con il debug dei problemi.</span><span class="sxs-lookup"><span data-stu-id="47555-204">This will also ensure all console messages are sent toohello first serial port, which can assist Azure support with debugging issues.</span></span>
  
    <span data-ttu-id="47555-205">Inoltre toohello precedente, è consigliabile troppo*rimuovere* hello seguenti parametri se esistono:</span><span class="sxs-lookup"><span data-stu-id="47555-205">In addition toohello above, it is recommended too*remove* hello following parameters if they exist:</span></span>
  
        rhgb quiet crashkernel=auto
  
    <span data-ttu-id="47555-206">Avvio con interfaccia grafica e non interattiva non sono utili in un ambiente cloud in cui si desidera tutti toobe di registri hello inviati toohello della porta seriale.</span><span class="sxs-lookup"><span data-stu-id="47555-206">Graphical and quiet boot are not useful in a cloud environment where we want all hello logs toobe sent toohello serial port.</span></span> <span data-ttu-id="47555-207">Hello `crashkernel` opzione può essere configurato se si desidera sinistra, ma si noti che questo parametro consente di ridurre hello quantità di memoria disponibile in hello VM da 128 MB o più, che può essere problematico sulle dimensioni delle macchine Virtuali più piccoli hello.</span><span class="sxs-lookup"><span data-stu-id="47555-207">hello `crashkernel` option may be left configured if desired, but note that this parameter will reduce hello amount of available memory in hello VM by 128MB or more, which may be problematic on hello smaller VM sizes.</span></span>

* <span data-ttu-id="47555-208">L'installazione di hello agente Linux di Azure</span><span class="sxs-lookup"><span data-stu-id="47555-208">Installing hello Azure Linux Agent</span></span>
  
    <span data-ttu-id="47555-209">Hello agente Linux di Azure è necessaria per il provisioning di un'immagine Linux in Azure.</span><span class="sxs-lookup"><span data-stu-id="47555-209">hello Azure Linux Agent is required for provisioning a Linux image on Azure.</span></span>  <span data-ttu-id="47555-210">Molte distribuzioni forniscono agente hello come un pacchetto RPM o Deb (pacchetto hello viene in genere chiamato 'WALinuxAgent' o 'walinuxagent').</span><span class="sxs-lookup"><span data-stu-id="47555-210">Many distributions provide hello agent as an RPM or Deb package (hello package is typically called 'WALinuxAgent' or 'walinuxagent').</span></span>  <span data-ttu-id="47555-211">Hello agente può anche essere installato manualmente seguendo procedure hello hello [Guida agente Linux](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="47555-211">hello agent can also be installed manually by following hello steps in hello [Linux Agent Guide](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span>

* <span data-ttu-id="47555-212">Verificare che server SSH hello sia installato e configurato toostart in fase di avvio.</span><span class="sxs-lookup"><span data-stu-id="47555-212">Ensure that hello SSH server is installed and configured toostart at boot time.</span></span>  <span data-ttu-id="47555-213">Si tratta in genere predefinito hello.</span><span class="sxs-lookup"><span data-stu-id="47555-213">This is usually hello default.</span></span>

* <span data-ttu-id="47555-214">Non creare lo spazio di swapping sul disco del sistema operativo hello</span><span class="sxs-lookup"><span data-stu-id="47555-214">Do not create swap space on hello OS disk</span></span>
  
    <span data-ttu-id="47555-215">Hello agente Linux di Azure può configurare automaticamente lo spazio di swapping utilizzando il disco di risorsa locale hello è collegato toohello VM dopo il provisioning in Azure.</span><span class="sxs-lookup"><span data-stu-id="47555-215">hello Azure Linux Agent can automatically configure swap space using hello local resource disk that is attached toohello VM after provisioning on Azure.</span></span> <span data-ttu-id="47555-216">Si noti il disco di risorsa locale hello è un *temporaneo* del disco e può essere svuotata quando hello VM è deprovisioning.</span><span class="sxs-lookup"><span data-stu-id="47555-216">Note that hello local resource disk is a *temporary* disk, and might be emptied when hello VM is deprovisioned.</span></span> <span data-ttu-id="47555-217">Dopo l'installazione di hello agente Linux di Azure (vedere il passaggio precedente), modificare hello seguenti parametri in /etc/waagent.conf in modo appropriato:</span><span class="sxs-lookup"><span data-stu-id="47555-217">After installing hello Azure Linux Agent (see previous step), modify hello following parameters in /etc/waagent.conf appropriately:</span></span>
  
        ResourceDisk.Format=y
        ResourceDisk.Filesystem=ext4
        ResourceDisk.MountPoint=/mnt/resource
        ResourceDisk.EnableSwap=y
        ResourceDisk.SwapSizeMB=2048    ## NOTE: set this toowhatever you need it toobe.

* <span data-ttu-id="47555-218">Come passaggio finale, eseguire hello macchina virtuale di hello toodeprovision i comandi seguenti:</span><span class="sxs-lookup"><span data-stu-id="47555-218">As a final step, run hello following commands toodeprovision hello virtual machine:</span></span>
  
        # sudo waagent -force -deprovision
        # export HISTSIZE=0
        # logout
  
  > [!NOTE]
  > <span data-ttu-id="47555-219">In Virtualbox venga visualizzato il seguente errore dopo l'esecuzione di hello ' waagent-force - deprovisioning ': `[Errno 5] Input/output error`.</span><span class="sxs-lookup"><span data-stu-id="47555-219">On Virtualbox you may see hello following error after running 'waagent -force -deprovision': `[Errno 5] Input/output error`.</span></span> <span data-ttu-id="47555-220">Questo messaggio di errore non è critico e può essere ignorato.</span><span class="sxs-lookup"><span data-stu-id="47555-220">This error message is not critical and can be ignored.</span></span>
  > 
  > 

* <span data-ttu-id="47555-221">Sarà quindi anche necessario tooshut verso il basso macchina virtuale hello e caricare hello tooAzure di disco rigido virtuale.</span><span class="sxs-lookup"><span data-stu-id="47555-221">You will then need tooshut down hello virtual machine and upload hello VHD tooAzure.</span></span>

