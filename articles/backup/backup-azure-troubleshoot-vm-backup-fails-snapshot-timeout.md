---
title: 'Risolvere un problema di Backup di Azure: stato dell''agente guest non disponibile | Microsoft Docs'
description: "Sintomi, cause e soluzioni per i problemi di Backup di Azure correlati all'errore: Non è stato possibile comunicare con l'agente di macchine virtuali"
services: backup
documentationcenter: 
author: genlin
manager: cshepard
editor: 
keywords: "Backup di Azure; agente di macchine virtuali; connettività di rete;"
ms.assetid: 4b02ffa4-c48e-45f6-8363-73d536be4639
ms.service: backup
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/17/2017
ms.author: genli;markgal;
ms.openlocfilehash: 6ed651bb8caafd18cec93e68ac70e27f92133e5c
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/18/2017
---
# <a name="troubleshoot-azure-backup-failure-issues-with-agent-andor-extension"></a><span data-ttu-id="a987c-104">Risolvere i problemi di Backup di Azure relativi all'agente e/o all'estensione</span><span class="sxs-lookup"><span data-stu-id="a987c-104">Troubleshoot Azure Backup failure: Issues with agent and/or extension</span></span>

<span data-ttu-id="a987c-105">Questo articolo presenta una procedura di risoluzione dei problemi per correggere gli errori di Backup correlati a problemi di comunicazione con l'agente e l'estensione delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="a987c-105">This article provides troubleshooting steps to help you resolve Backup failures related to problems in communication with VM agent and extension.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

## <a name="vm-agent-unable-to-communicate-with-azure-backup"></a><span data-ttu-id="a987c-106">L'agente di macchine virtuali non riesce a comunicare con Backup di Azure</span><span class="sxs-lookup"><span data-stu-id="a987c-106">VM Agent unable to communicate with Azure Backup</span></span>
<span data-ttu-id="a987c-107">Dopo la registrazione e la pianificazione di una VM per il servizio Backup di Azure, tale servizio avvia il processo comunicando con l'agente di macchine virtuali per creare uno snapshot temporizzato.</span><span class="sxs-lookup"><span data-stu-id="a987c-107">After you register and schedule a VM for the Azure Backup service, Backup initiates the job by communicating with the VM agent to take a point-in-time snapshot.</span></span> <span data-ttu-id="a987c-108">Una delle condizioni seguenti può impedire l'attivazione dello snapshot, che a sua volta può provocare l'errore di Backup.</span><span class="sxs-lookup"><span data-stu-id="a987c-108">Any of the following conditions might prevent the snapshot from being triggered, which in turn can lead to Backup failure.</span></span> <span data-ttu-id="a987c-109">Seguire questa procedura per la risoluzione dei problemi nell'ordine specificato e provare a eseguire di nuovo l'operazione.</span><span class="sxs-lookup"><span data-stu-id="a987c-109">Follow below troubleshooting steps in the given order and retry your operation.</span></span>
##### <a name="cause-1-the-vm-has-no-internet-accessthe-vm-has-no-internet-access"></a><span data-ttu-id="a987c-110">Causa 1: [la VM non ha accesso a Internet](#the-vm-has-no-internet-access)</span><span class="sxs-lookup"><span data-stu-id="a987c-110">Cause 1: [The VM has no Internet access](#the-vm-has-no-internet-access)</span></span>
##### <a name="cause-2-the-agent-is-installed-in-the-vm-but-is-unresponsive-for-windows-vmsthe-agent-installed-in-the-vm-but-unresponsive-for-windows-vms"></a><span data-ttu-id="a987c-111">Causa 2: [l'agente è installato nella VM ma non risponde (per VM Windows)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span><span class="sxs-lookup"><span data-stu-id="a987c-111">Cause 2: [The agent is installed in the VM but is unresponsive (for Windows VMs)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span></span>
##### <a name="cause-3-the-agent-installed-in-the-vm-is-out-of-date-for-linux-vmsthe-agent-installed-in-the-vm-is-out-of-date-for-linux-vms"></a><span data-ttu-id="a987c-112">Causa 3: [l'agente installato nella VM Linux non è aggiornato (per VM Linux)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span><span class="sxs-lookup"><span data-stu-id="a987c-112">Cause 3: [The agent installed in the VM is out of date (for Linux VMs)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span></span>
##### <a name="cause-4-the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-takenthe-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken"></a><span data-ttu-id="a987c-113">Causa 4: [non è possibile recuperare lo stato degli snapshot o acquisire uno snapshot](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span><span class="sxs-lookup"><span data-stu-id="a987c-113">Cause 4: [The snapshot status cannot be retrieved or a snapshot cannot be taken](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span></span>
##### <a name="cause-5-the-backup-extension-fails-to-update-or-loadthe-backup-extension-fails-to-update-or-load"></a><span data-ttu-id="a987c-114">Causa 5: [non è possibile aggiornare o caricare l'estensione di backup](#the-backup-extension-fails-to-update-or-load)</span><span class="sxs-lookup"><span data-stu-id="a987c-114">Cause 5: [The backup extension fails to update or load](#the-backup-extension-fails-to-update-or-load)</span></span>

## <a name="snapshot-operation-failed-due-to-no-network-connectivity-on-the-virtual-machine"></a><span data-ttu-id="a987c-115">Operazione di creazione snapshot non riuscita a causa dell'assenza della connettività di rete nella macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="a987c-115">Snapshot operation failed due to no network connectivity on the virtual machine</span></span>
<span data-ttu-id="a987c-116">Dopo la registrazione e la pianificazione di una macchina virtuale per il servizio Backup di Azure, tale servizio avvia il processo comunicando con l'estensione di backup della macchina virtuale per la creazione di uno snapshot temporizzato.</span><span class="sxs-lookup"><span data-stu-id="a987c-116">After you register and schedule a VM for the Azure Backup service, Backup initiates the job by communicating with the VM backup extension to take a point-in-time snapshot.</span></span> <span data-ttu-id="a987c-117">Una delle condizioni seguenti può impedire l'attivazione dello snapshot, che a sua volta può provocare l'errore di Backup.</span><span class="sxs-lookup"><span data-stu-id="a987c-117">Any of the following conditions might prevent the snapshot from being triggered, which in turn can lead to Backup failure.</span></span> <span data-ttu-id="a987c-118">Seguire questa procedura per la risoluzione dei problemi nell'ordine specificato e provare a eseguire di nuovo l'operazione.</span><span class="sxs-lookup"><span data-stu-id="a987c-118">Follow below troubleshooting steps in the given order and retry your operation.</span></span>
##### <a name="cause-1-the-vm-has-no-internet-accessthe-vm-has-no-internet-access"></a><span data-ttu-id="a987c-119">Causa 1: [la VM non ha accesso a Internet](#the-vm-has-no-internet-access)</span><span class="sxs-lookup"><span data-stu-id="a987c-119">Cause 1: [The VM has no Internet access](#the-vm-has-no-internet-access)</span></span>
##### <a name="cause-2-the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-takenthe-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken"></a><span data-ttu-id="a987c-120">Causa 2: [non è possibile recuperare lo stato degli snapshot o acquisire uno snapshot](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span><span class="sxs-lookup"><span data-stu-id="a987c-120">Cause 2: [The snapshot status cannot be retrieved or a snapshot cannot be taken](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span></span>
##### <a name="cause-3-the-backup-extension-fails-to-update-or-loadthe-backup-extension-fails-to-update-or-load"></a><span data-ttu-id="a987c-121">Causa 3: [non è possibile aggiornare o caricare l'estensione di backup](#the-backup-extension-fails-to-update-or-load)</span><span class="sxs-lookup"><span data-stu-id="a987c-121">Cause 3: [The backup extension fails to update or load](#the-backup-extension-fails-to-update-or-load)</span></span>

## <a name="vmsnapshot-extension-operation-failed"></a><span data-ttu-id="a987c-122">Operazione dell'estensione VMSnapshot non riuscita</span><span class="sxs-lookup"><span data-stu-id="a987c-122">VMSnapshot extension operation failed</span></span>

<span data-ttu-id="a987c-123">Dopo la registrazione e la pianificazione di una macchina virtuale per il servizio Backup di Azure, tale servizio avvia il processo comunicando con l'estensione di backup della macchina virtuale per la creazione di uno snapshot temporizzato.</span><span class="sxs-lookup"><span data-stu-id="a987c-123">After you register and schedule a VM for the Azure Backup service, Backup initiates the job by communicating with the VM backup extension to take a point-in-time snapshot.</span></span> <span data-ttu-id="a987c-124">Una delle condizioni seguenti può impedire l'attivazione dello snapshot, che a sua volta può provocare l'errore di Backup.</span><span class="sxs-lookup"><span data-stu-id="a987c-124">Any of the following conditions might prevent the snapshot from being triggered, which in turn can lead to Backup failure.</span></span> <span data-ttu-id="a987c-125">Seguire questa procedura per la risoluzione dei problemi nell'ordine specificato e provare a eseguire di nuovo l'operazione.</span><span class="sxs-lookup"><span data-stu-id="a987c-125">Follow below troubleshooting steps in the given order and retry your operation.</span></span>
##### <a name="cause-1-the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-takenthe-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken"></a><span data-ttu-id="a987c-126">Causa 1: [non è possibile recuperare lo stato degli snapshot o acquisire uno snapshot](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span><span class="sxs-lookup"><span data-stu-id="a987c-126">Cause 1: [The snapshot status cannot be retrieved or a snapshot cannot be taken](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span></span>
##### <a name="cause-2-the-backup-extension-fails-to-update-or-loadthe-backup-extension-fails-to-update-or-load"></a><span data-ttu-id="a987c-127">Causa 2: [non è possibile aggiornare o caricare l'estensione di backup](#the-backup-extension-fails-to-update-or-load)</span><span class="sxs-lookup"><span data-stu-id="a987c-127">Cause 2: [The backup extension fails to update or load](#the-backup-extension-fails-to-update-or-load)</span></span>
##### <a name="cause-3-the-vm-has-no-internet-accessthe-vm-has-no-internet-access"></a><span data-ttu-id="a987c-128">Causa 3: [la VM non ha accesso a Internet](#the-vm-has-no-internet-access)</span><span class="sxs-lookup"><span data-stu-id="a987c-128">Cause 3: [The VM has no Internet access](#the-vm-has-no-internet-access)</span></span>
##### <a name="cause-4-the-agent-is-installed-in-the-vm-but-is-unresponsive-for-windows-vmsthe-agent-installed-in-the-vm-but-unresponsive-for-windows-vms"></a><span data-ttu-id="a987c-129">Causa 4: [l'agente è installato nella VM ma non risponde (per VM Windows)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span><span class="sxs-lookup"><span data-stu-id="a987c-129">Cause 4: [The agent is installed in the VM but is unresponsive (for Windows VMs)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span></span>
##### <a name="cause-5-the-agent-installed-in-the-vm-is-out-of-date-for-linux-vmsthe-agent-installed-in-the-vm-is-out-of-date-for-linux-vms"></a><span data-ttu-id="a987c-130">Causa 5: [l'agente installato nella VM Linux non è aggiornato (per VM Linux)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span><span class="sxs-lookup"><span data-stu-id="a987c-130">Cause 5: [The agent installed in the VM is out of date (for Linux VMs)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span></span>

## <a name="unable-to-perform-the-operation-as-the-vm-agent-is-not-responsive"></a><span data-ttu-id="a987c-131">Impossibile eseguire l'operazione perché l'agente di macchine virtuali non risponde</span><span class="sxs-lookup"><span data-stu-id="a987c-131">Unable to perform the operation as the VM Agent is not responsive</span></span>

<span data-ttu-id="a987c-132">Dopo la registrazione e la pianificazione di una macchina virtuale per il servizio Backup di Azure, tale servizio avvia il processo comunicando con l'estensione di backup della macchina virtuale per la creazione di uno snapshot temporizzato.</span><span class="sxs-lookup"><span data-stu-id="a987c-132">After you register and schedule a VM for the Azure Backup service, Backup initiates the job by communicating with the VM backup extension to take a point-in-time snapshot.</span></span> <span data-ttu-id="a987c-133">Una delle condizioni seguenti può impedire l'attivazione dello snapshot, che a sua volta può provocare l'errore di Backup.</span><span class="sxs-lookup"><span data-stu-id="a987c-133">Any of the following conditions might prevent the snapshot from being triggered, which in turn can lead to Backup failure.</span></span> <span data-ttu-id="a987c-134">Seguire questa procedura per la risoluzione dei problemi nell'ordine specificato e provare a eseguire di nuovo l'operazione.</span><span class="sxs-lookup"><span data-stu-id="a987c-134">Follow below troubleshooting steps in the given order and retry your operation.</span></span>
##### <a name="cause-1-the-agent-is-installed-in-the-vm-but-is-unresponsive-for-windows-vmsthe-agent-installed-in-the-vm-but-unresponsive-for-windows-vms"></a><span data-ttu-id="a987c-135">Causa 1: [l'agente è installato nella VM ma non risponde (per VM Windows)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span><span class="sxs-lookup"><span data-stu-id="a987c-135">Cause 1: [The agent is installed in the VM but is unresponsive (for Windows VMs)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span></span>
##### <a name="cause-2-the-agent-installed-in-the-vm-is-out-of-date-for-linux-vmsthe-agent-installed-in-the-vm-is-out-of-date-for-linux-vms"></a><span data-ttu-id="a987c-136">Causa 2: [l'agente installato nella VM Linux non è aggiornato (per VM Linux)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span><span class="sxs-lookup"><span data-stu-id="a987c-136">Cause 2: [The agent installed in the VM is out of date (for Linux VMs)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span></span>
##### <a name="cause-3-the-vm-has-no-internet-accessthe-vm-has-no-internet-access"></a><span data-ttu-id="a987c-137">Causa 3: [la VM non ha accesso a Internet](#the-vm-has-no-internet-access)</span><span class="sxs-lookup"><span data-stu-id="a987c-137">Cause 3: [The VM has no Internet access](#the-vm-has-no-internet-access)</span></span>

## <a name="backup-failed-with-an-internal-error---please-retry-the-operation-in-a-few-minutes"></a><span data-ttu-id="a987c-138">Il backup non è riuscito e si è verificato un errore interno. Attendere qualche minuto prima di ripetere l'operazione.</span><span class="sxs-lookup"><span data-stu-id="a987c-138">Backup failed with an internal error - Please retry the operation in a few minutes</span></span>

<span data-ttu-id="a987c-139">Dopo la registrazione e la pianificazione di una macchina virtuale per il servizio Backup di Azure, tale servizio avvia il processo comunicando con l'estensione di backup della macchina virtuale per la creazione di uno snapshot temporizzato.</span><span class="sxs-lookup"><span data-stu-id="a987c-139">After you register and schedule a VM for the Azure Backup service, Backup initiates the job by communicating with the VM backup extension to take a point-in-time snapshot.</span></span> <span data-ttu-id="a987c-140">Una delle condizioni seguenti può impedire l'attivazione dello snapshot, che a sua volta può provocare l'errore di Backup.</span><span class="sxs-lookup"><span data-stu-id="a987c-140">Any of the following conditions might prevent the snapshot from being triggered, which in turn can lead to Backup failure.</span></span> <span data-ttu-id="a987c-141">Seguire questa procedura per la risoluzione dei problemi nell'ordine specificato e provare a eseguire di nuovo l'operazione.</span><span class="sxs-lookup"><span data-stu-id="a987c-141">Follow below troubleshooting steps in the given order and retry your operation.</span></span>
##### <a name="cause-1-the-vm-has-no-internet-accessthe-vm-has-no-internet-access"></a><span data-ttu-id="a987c-142">Causa 1: [la VM non ha accesso a Internet](#the-vm-has-no-internet-access)</span><span class="sxs-lookup"><span data-stu-id="a987c-142">Cause 1: [The VM has no Internet access](#the-vm-has-no-internet-access)</span></span>
##### <a name="cause-2-the-agent-installed-in-the-vm-but-unresponsive-for-windows-vmsthe-agent-installed-in-the-vm-but-unresponsive-for-windows-vms"></a><span data-ttu-id="a987c-143">Causa 2: [l'agente è installato nella VM ma non risponde (per VM Windows)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span><span class="sxs-lookup"><span data-stu-id="a987c-143">Cause 2: [The agent installed in the VM but unresponsive (for Windows VMs)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span></span>
##### <a name="cause-3-the-agent-installed-in-the-vm-is-out-of-date-for-linux-vmsthe-agent-installed-in-the-vm-is-out-of-date-for-linux-vms"></a><span data-ttu-id="a987c-144">Causa 3: [l'agente installato nella VM Linux non è aggiornato (per VM Linux)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span><span class="sxs-lookup"><span data-stu-id="a987c-144">Cause 3: [The agent installed in the VM is out of date (for Linux VMs)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span></span>
##### <a name="cause-4-the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-takenthe-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken"></a><span data-ttu-id="a987c-145">Causa 4: [non è possibile recuperare lo stato degli snapshot o acquisire uno snapshot](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span><span class="sxs-lookup"><span data-stu-id="a987c-145">Cause 4: [The snapshot status cannot be retrieved or a snapshot cannot be taken](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span></span>
##### <a name="cause-5-the-backup-extension-fails-to-update-or-loadthe-backup-extension-fails-to-update-or-load"></a><span data-ttu-id="a987c-146">Causa 5: [non è possibile aggiornare o caricare l'estensione di backup](#the-backup-extension-fails-to-update-or-load)</span><span class="sxs-lookup"><span data-stu-id="a987c-146">Cause 5: [The backup extension fails to update or load](#the-backup-extension-fails-to-update-or-load)</span></span>


## <a name="causes-and-solutions"></a><span data-ttu-id="a987c-147">Cause e soluzioni</span><span class="sxs-lookup"><span data-stu-id="a987c-147">Causes and Solutions</span></span>

### <a name="the-vm-has-no-internet-access"></a><span data-ttu-id="a987c-148">La VM non ha accesso a Internet</span><span class="sxs-lookup"><span data-stu-id="a987c-148">The VM has no Internet access</span></span>
<span data-ttu-id="a987c-149">In base al requisito di distribuzione, la macchina virtuale non ha accesso a Internet o sono presenti restrizioni che impediscono l'accesso all'infrastruttura di Azure.</span><span class="sxs-lookup"><span data-stu-id="a987c-149">Per the deployment requirement, the VM has no Internet access, or it has restrictions in place that prevent access to the Azure infrastructure.</span></span>

<span data-ttu-id="a987c-150">Per funzionare correttamente, l'estensione di backup richiede la connettività agli indirizzi IP pubblici di Azure.</span><span class="sxs-lookup"><span data-stu-id="a987c-150">To function correctly, the backup extension requires connectivity to the Azure public IP addresses.</span></span> <span data-ttu-id="a987c-151">L'estensione invia comandi a un endpoint di Archiviazione di Azure (URL HTTP) per gestire gli snapshot della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="a987c-151">The extension sends commands to an Azure Storage endpoint (HTTP URL) to manage the snapshots of the VM.</span></span> <span data-ttu-id="a987c-152">Se l'estensione non ha accesso a Internet pubblico, il servizio Backup ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="a987c-152">If the extension has no access to the public Internet, Backup eventually fails.</span></span>

####  <a name="solution"></a><span data-ttu-id="a987c-153">Soluzione</span><span class="sxs-lookup"><span data-stu-id="a987c-153">Solution</span></span>
<span data-ttu-id="a987c-154">Per risolvere il problema, provare ad applicare uno dei metodi seguenti.</span><span class="sxs-lookup"><span data-stu-id="a987c-154">To resolve the issue, try one of the methods listed here.</span></span>
##### <a name="allow-access-to-the-azure-datacenter-ip-ranges"></a><span data-ttu-id="a987c-155">Consentire l'accesso agli intervalli di indirizzi IP del data center di Azure</span><span class="sxs-lookup"><span data-stu-id="a987c-155">Allow access to the Azure datacenter IP ranges</span></span>

1. <span data-ttu-id="a987c-156">Ottenere l'[elenco di indirizzi IP del data center di Azure](https://www.microsoft.com/download/details.aspx?id=41653) a cui consentire l'accesso.</span><span class="sxs-lookup"><span data-stu-id="a987c-156">Obtain the [list of Azure datacenter IPs](https://www.microsoft.com/download/details.aspx?id=41653) to allow access to.</span></span>
2. <span data-ttu-id="a987c-157">Sbloccare gli indirizzi IP eseguendo il cmdlet **New-NetRoute** nella macchina virtuale di Azure in una finestra di PowerShell con privilegi elevati.</span><span class="sxs-lookup"><span data-stu-id="a987c-157">Unblock the IPs by running the **New-NetRoute** cmdlet in the Azure VM in an elevated PowerShell window.</span></span> <span data-ttu-id="a987c-158">Eseguire il cmdlet come amministratore.</span><span class="sxs-lookup"><span data-stu-id="a987c-158">Run the cmdlet as an administrator.</span></span>
3. <span data-ttu-id="a987c-159">Per consentire l'accesso agli indirizzi IP, aggiungere regole al gruppo di sicurezza di rete, se disponibile.</span><span class="sxs-lookup"><span data-stu-id="a987c-159">To allow access to the IPs, add rules to the network security group, if you have one.</span></span>

##### <a name="create-a-path-for-http-traffic-to-flow"></a><span data-ttu-id="a987c-160">Creare un percorso per il flusso del traffico HTTP</span><span class="sxs-lookup"><span data-stu-id="a987c-160">Create a path for HTTP traffic to flow</span></span>

1. <span data-ttu-id="a987c-161">Se sono state applicate restrizioni di rete, ad esempio un gruppo di sicurezza di rete, distribuire un server proxy HTTP per indirizzare il traffico.</span><span class="sxs-lookup"><span data-stu-id="a987c-161">If you have network restrictions in place (for example, a network security group), deploy an HTTP proxy server to route the traffic.</span></span>
2. <span data-ttu-id="a987c-162">Per consentire l'accesso a Internet dal server proxy HTTP, aggiungere regole al gruppo di sicurezza di rete, se disponibile.</span><span class="sxs-lookup"><span data-stu-id="a987c-162">To allow access to the Internet from the HTTP proxy server, add rules to the network security group, if you have one.</span></span>

<span data-ttu-id="a987c-163">Per informazioni su come configurare un proxy HTTP per i backup delle macchine virtuali, vedere [Preparare l'ambiente per il backup di macchine virtuali di Azure](backup-azure-vms-prepare.md#using-an-http-proxy-for-vm-backups).</span><span class="sxs-lookup"><span data-stu-id="a987c-163">To learn how to set up an HTTP proxy for VM backups, see [Prepare your environment to back up Azure virtual machines](backup-azure-vms-prepare.md#using-an-http-proxy-for-vm-backups).</span></span>

<span data-ttu-id="a987c-164">Se si usa Managed Disks, può essere necessario aprire una porta aggiuntiva (8443) nei firewall.</span><span class="sxs-lookup"><span data-stu-id="a987c-164">In case you are using Managed Disks, you may need an additional port (8443) opening up on the firewalls.</span></span>

### <a name="the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms"></a><span data-ttu-id="a987c-165">L'agente è installato nella VM ma non risponde (per VM Windows)</span><span class="sxs-lookup"><span data-stu-id="a987c-165">The agent installed in the VM but unresponsive (for Windows VMs)</span></span>

#### <a name="solution"></a><span data-ttu-id="a987c-166">Soluzione</span><span class="sxs-lookup"><span data-stu-id="a987c-166">Solution</span></span>
<span data-ttu-id="a987c-167">L'agente di macchine virtuali può essere danneggiato o il servizio può essere stato arrestato.</span><span class="sxs-lookup"><span data-stu-id="a987c-167">The VM Agent might have been corrupted or the service might have been stopped.</span></span> <span data-ttu-id="a987c-168">La reinstallazione dell'agente di macchine virtuali consente di ottenere la versione più recente e di riavviare la comunicazione.</span><span class="sxs-lookup"><span data-stu-id="a987c-168">Re-installing the VM agent would help get the latest version and restart the communication.</span></span>

1. <span data-ttu-id="a987c-169">Verificare che il servizio agente guest di Windows sia in esecuzione nei servizi (services.msc) della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="a987c-169">Verify whether Windows Guest Agent service running in services (services.msc) of the Virtual Machine.</span></span> <span data-ttu-id="a987c-170">Provare a riavviare il servizio agente guest di Windows e avviare il backup.</span><span class="sxs-lookup"><span data-stu-id="a987c-170">Try restart the Windows Guest Agent service and initiate the Backup</span></span><br>
2. <span data-ttu-id="a987c-171">Se non è visibile tra i servizi, verificare in Programmi e funzionalità che il servizio agente guest di Windows sia installato.</span><span class="sxs-lookup"><span data-stu-id="a987c-171">if it is not visible in services, verify in Programs and Features whether Windows Guest agent service is installed.</span></span>
4. <span data-ttu-id="a987c-172">Se è possibile visualizzare il servizio agente guest di Windows in Programmi e funzionalità di Windows, disinstallarlo.</span><span class="sxs-lookup"><span data-stu-id="a987c-172">If you are able to view in programs and features uninstall the Windows Guest Agent.</span></span>
5. <span data-ttu-id="a987c-173">Scaricare e installare l'[ultima versione del file MSI dell'agente](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="a987c-173">Download and install the [latest version of agent MSI](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409).</span></span> <span data-ttu-id="a987c-174">Per completare l'installazione sono necessari privilegi di amministratore.</span><span class="sxs-lookup"><span data-stu-id="a987c-174">You need Administrator privileges to complete the installation.</span></span>
6. <span data-ttu-id="a987c-175">Il servizio agente guest di Windows dovrebbe quindi essere visualizzato tra i servizi</span><span class="sxs-lookup"><span data-stu-id="a987c-175">Then you should be able to view Windows Guest Agent services in services</span></span>
7. <span data-ttu-id="a987c-176">Provare a eseguire un backup su richiesta o adhoc facendo clic su "Esegui Backup" nel portale.</span><span class="sxs-lookup"><span data-stu-id="a987c-176">Try running an on-demand/adhoc backup by clicking "Backup Now" in the portal.</span></span>

<span data-ttu-id="a987c-177">Verificare anche che **[.NET 4.5 sia installato nel sistema](https://docs.microsoft.com/en-us/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed)** nella macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="a987c-177">Also verify your Virtual Machine has **[.NET 4.5 installed in the system](https://docs.microsoft.com/en-us/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed)**.</span></span> <span data-ttu-id="a987c-178">È necessario che l'agente di macchine virtuali comunichi con il servizio</span><span class="sxs-lookup"><span data-stu-id="a987c-178">It is required for the VM agent to communicate with the service</span></span>

### <a name="the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms"></a><span data-ttu-id="a987c-179">L'agente installato nella VM Linux non è aggiornato (per VM Linux)</span><span class="sxs-lookup"><span data-stu-id="a987c-179">The agent installed in the VM is out of date (for Linux VMs)</span></span>

#### <a name="solution"></a><span data-ttu-id="a987c-180">Soluzione</span><span class="sxs-lookup"><span data-stu-id="a987c-180">Solution</span></span>
<span data-ttu-id="a987c-181">La maggior parte degli errori relativi ad agenti o estensioni nelle macchine virtuali Linux è dovuta a problemi correlati ad agenti di macchine virtuali non aggiornati.</span><span class="sxs-lookup"><span data-stu-id="a987c-181">Most agent-related or extension-related failures for Linux VMs are caused by issues that affect an outdated VM agent.</span></span> <span data-ttu-id="a987c-182">Per risolvere il problema, seguire queste indicazioni generali:</span><span class="sxs-lookup"><span data-stu-id="a987c-182">To troubleshoot this issue, follow these general guidelines:</span></span>

1. <span data-ttu-id="a987c-183">Seguire le istruzioni per l'[aggiornamento dell'agente di macchine virtuali Linux](../virtual-machines/linux/update-agent.md).</span><span class="sxs-lookup"><span data-stu-id="a987c-183">Follow the instructions for [updating the Linux VM agent](../virtual-machines/linux/update-agent.md).</span></span>

 >[!NOTE]
 ><span data-ttu-id="a987c-184">È *fortemente consigliato* aggiornare l'agente solo tramite un repository di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="a987c-184">We *strongly recommend* that you update the agent only through a distribution repository.</span></span> <span data-ttu-id="a987c-185">Non è consigliabile scaricare il codice dell'agente direttamente da GitHub e aggiornarlo.</span><span class="sxs-lookup"><span data-stu-id="a987c-185">We do not recommend downloading the agent code directly from GitHub and updating it.</span></span> <span data-ttu-id="a987c-186">Se l'agente più recente non è disponibile per la distribuzione, contattare il supporto per la distribuzione per istruzioni su come installarlo.</span><span class="sxs-lookup"><span data-stu-id="a987c-186">If the latest agent is unavailable for your distribution, contact distribution support for instructions on how to install it.</span></span> <span data-ttu-id="a987c-187">Per cercare l'agente più recente, passare alla pagina dell'[agente Linux di Microsoft Azure](https://github.com/Azure/WALinuxAgent/releases) nel repository GitHub.</span><span class="sxs-lookup"><span data-stu-id="a987c-187">To check for the most recent agent, go to the [Windows Azure Linux agent](https://github.com/Azure/WALinuxAgent/releases) page in the GitHub repository.</span></span>

2. <span data-ttu-id="a987c-188">Assicurarsi che l'agente di Azure sia in esecuzione nella macchina virtuale eseguendo il comando seguente: `ps -e`</span><span class="sxs-lookup"><span data-stu-id="a987c-188">Make sure that the Azure agent is running on the VM by running the following command: `ps -e`</span></span>

 <span data-ttu-id="a987c-189">Se il processo non è in esecuzione, riavviarlo usando i comandi seguenti:</span><span class="sxs-lookup"><span data-stu-id="a987c-189">If the process is not running, restart it by using the following commands:</span></span>

 * <span data-ttu-id="a987c-190">Per Ubuntu: `service walinuxagent start`</span><span class="sxs-lookup"><span data-stu-id="a987c-190">For Ubuntu: `service walinuxagent start`</span></span>
 * <span data-ttu-id="a987c-191">Per altre distribuzioni: `service waagent start`</span><span class="sxs-lookup"><span data-stu-id="a987c-191">For other distributions: `service waagent start`</span></span>

3. <span data-ttu-id="a987c-192">[Configurare l'agente per il riavvio automatico](https://github.com/Azure/WALinuxAgent/wiki/Known-Issues#mitigate_agent_crash).</span><span class="sxs-lookup"><span data-stu-id="a987c-192">[Configure the auto restart agent](https://github.com/Azure/WALinuxAgent/wiki/Known-Issues#mitigate_agent_crash).</span></span>
4. <span data-ttu-id="a987c-193">Eseguire un nuovo backup di prova.</span><span class="sxs-lookup"><span data-stu-id="a987c-193">Run a new test backup.</span></span> <span data-ttu-id="a987c-194">Se l'errore persiste, raccogliere i log seguenti dalla macchina virtuale del cliente:</span><span class="sxs-lookup"><span data-stu-id="a987c-194">If the failure persists, please collect the following logs from the customer’s VM:</span></span>

   * <span data-ttu-id="a987c-195">/var/lib/waagent/*.xml</span><span class="sxs-lookup"><span data-stu-id="a987c-195">/var/lib/waagent/*.xml</span></span>
   * <span data-ttu-id="a987c-196">/var/log/waagent.log</span><span class="sxs-lookup"><span data-stu-id="a987c-196">/var/log/waagent.log</span></span>
   * <span data-ttu-id="a987c-197">/var/log/azure/*</span><span class="sxs-lookup"><span data-stu-id="a987c-197">/var/log/azure/*</span></span>

<span data-ttu-id="a987c-198">Se è necessaria una registrazione dettagliata per waagent, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="a987c-198">If we require verbose logging for waagent, follow these steps:</span></span>

1. <span data-ttu-id="a987c-199">Nel file /etc/waagent.conf individuare la riga seguente: **Enable verbose logging (y|n)**</span><span class="sxs-lookup"><span data-stu-id="a987c-199">In the /etc/waagent.conf file, locate the following line: **Enable verbose logging (y|n)**</span></span>
2. <span data-ttu-id="a987c-200">Modificare il valore di **Logs.Verbose** da *n* a *y*.</span><span class="sxs-lookup"><span data-stu-id="a987c-200">Change the **Logs.Verbose** value from *n* to *y*.</span></span>
3. <span data-ttu-id="a987c-201">Salvare la modifica e riavviare waagent seguendo la procedura precedente in questa sezione.</span><span class="sxs-lookup"><span data-stu-id="a987c-201">Save the change, and then restart waagent by following the previous steps in this section.</span></span>

### <a name="the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken"></a><span data-ttu-id="a987c-202">Non è possibile recuperare lo stato degli snapshot o acquisire uno snapshot</span><span class="sxs-lookup"><span data-stu-id="a987c-202">The snapshot status cannot be retrieved or a snapshot cannot be taken</span></span>
<span data-ttu-id="a987c-203">Il backup delle macchine virtuali si basa sull'esecuzione del comando di snapshot sull'account di archiviazione sottostante.</span><span class="sxs-lookup"><span data-stu-id="a987c-203">The VM backup relies on issuing a snapshot command to the underlying storage account.</span></span> <span data-ttu-id="a987c-204">Il backup può avere esito negativo perché non ha accesso all'account di archiviazione o perché l'esecuzione dell'attività dello snapshot è stata posticipata.</span><span class="sxs-lookup"><span data-stu-id="a987c-204">Backup can fail either because it has no access to the storage account or because the execution of the snapshot task is delayed.</span></span>

#### <a name="solution"></a><span data-ttu-id="a987c-205">Soluzione</span><span class="sxs-lookup"><span data-stu-id="a987c-205">Solution</span></span>
<span data-ttu-id="a987c-206">Le condizioni seguenti possono causare errori dell'attività di snapshot:</span><span class="sxs-lookup"><span data-stu-id="a987c-206">The following conditions can cause snapshot task failure:</span></span>

| <span data-ttu-id="a987c-207">Causa</span><span class="sxs-lookup"><span data-stu-id="a987c-207">Cause</span></span> | <span data-ttu-id="a987c-208">Soluzione</span><span class="sxs-lookup"><span data-stu-id="a987c-208">Solution</span></span> |
| --- | --- |
| <span data-ttu-id="a987c-209">Per la macchina virtuale è stato configurato il backup di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a987c-209">The VM has SQL Server backup configured.</span></span> | <span data-ttu-id="a987c-210">Per impostazione predefinita, il servizio Backup delle macchine virtuali esegue backup VSS completi nelle macchine virtuali Windows.</span><span class="sxs-lookup"><span data-stu-id="a987c-210">By default, the VM backup runs a VSS full backup on Windows VMs.</span></span> <span data-ttu-id="a987c-211">Nelle macchine virtuali che eseguono server basati su SQL Server e in cui è configurato il backup di SQL Server possono verificarsi ritardi nell'esecuzione di snapshot.</span><span class="sxs-lookup"><span data-stu-id="a987c-211">On VMs that are running SQL Server-based servers and on which SQL Server backup is configured, snapshot execution delays may occur.</span></span><br><br><span data-ttu-id="a987c-212">Se si verificano errori di backup a causa di problemi di snapshot, configurare la chiave seguente del Registro di sistema:</span><span class="sxs-lookup"><span data-stu-id="a987c-212">If you are experiencing a Backup failure because of a snapshot issue, set the following registry key:</span></span><br><br><span data-ttu-id="a987c-213">**[HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\BCDRAGENT] "USEVSSCOPYBACKUP"="TRUE"**</span><span class="sxs-lookup"><span data-stu-id="a987c-213">**[HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\BCDRAGENT] "USEVSSCOPYBACKUP"="TRUE"**</span></span> |
| <span data-ttu-id="a987c-214">Lo stato della macchina virtuale viene segnalato in modo non corretto perché la macchina virtuale viene arrestata in RDP.</span><span class="sxs-lookup"><span data-stu-id="a987c-214">The VM status is reported incorrectly because the VM is shut down in RDP.</span></span> | <span data-ttu-id="a987c-215">Se si arresta la macchina virtuale in Remote Desktop Protocol (RDP), controllare il portale per determinare se lo stato della macchina virtuale è corretto.</span><span class="sxs-lookup"><span data-stu-id="a987c-215">If you shut down the VM in Remote Desktop Protocol (RDP), check the portal to determine whether the VM status is correct.</span></span> <span data-ttu-id="a987c-216">In caso contrario, arrestare la macchina virtuale nel portale tramite l'opzione **Spegni** nel dashboard della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="a987c-216">If it’s not correct, shut down the VM in the portal by using the **Shutdown** option on the VM dashboard.</span></span> |
| <span data-ttu-id="a987c-217">Diverse macchine virtuali dello stesso servizio cloud sono configurate per eseguire il backup nello stesso momento.</span><span class="sxs-lookup"><span data-stu-id="a987c-217">Many VMs from the same cloud service are configured to back up at the same time.</span></span> | <span data-ttu-id="a987c-218">È consigliabile distribuire le pianificazione dei backup per le macchine virtuali dello stesso servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="a987c-218">It’s a best practice to spread out the backup schedules for VMs from the same cloud service.</span></span> |
| <span data-ttu-id="a987c-219">L'esecuzione della macchina virtuale fa un uso elevato della CPU o della memoria.</span><span class="sxs-lookup"><span data-stu-id="a987c-219">The VM is running at high CPU or memory usage.</span></span> | <span data-ttu-id="a987c-220">Se l'esecuzione della macchina virtuale fa un uso elevato della CPU (oltre il 90%) o della memoria, l'attività di snapshot viene accodata e ritardata e infine si verifica il timeout. In una situazione di questo tipo, provare a eseguire un backup su richiesta.</span><span class="sxs-lookup"><span data-stu-id="a987c-220">If the VM is running at high CPU usage (more than 90 percent) or high memory usage, the snapshot task is queued and delayed, and it eventually times out. In this situation, try an on-demand backup.</span></span> |
| <span data-ttu-id="a987c-221">La macchina virtuale non riesce a ottenere l'indirizzo dell'host/infrastruttura dal DHCP.</span><span class="sxs-lookup"><span data-stu-id="a987c-221">The VM cannot get the host/fabric address from DHCP.</span></span> | <span data-ttu-id="a987c-222">DHCP deve essere abilitato nel computer guest per consentire il funzionamento del backup delle VM IaaS.</span><span class="sxs-lookup"><span data-stu-id="a987c-222">DHCP must be enabled inside the guest for the IaaS VM backup to work.</span></span>  <span data-ttu-id="a987c-223">Se la macchina virtuale non riesce a ottenere l'indirizzo dell'host/infrastruttura dal DHCP, risposta 245, non è possibile scaricare o eseguire le estensioni.</span><span class="sxs-lookup"><span data-stu-id="a987c-223">If the VM cannot get the host/fabric address from DHCP response 245, it cannot download or run any extensions.</span></span> <span data-ttu-id="a987c-224">Se è necessario un indirizzo IP privato statico, è necessario configurarlo tramite la piattaforma.</span><span class="sxs-lookup"><span data-stu-id="a987c-224">If you need a static private IP, you should configure it through the platform.</span></span> <span data-ttu-id="a987c-225">L'opzione DHCP all'interno della VM deve essere abilitata.</span><span class="sxs-lookup"><span data-stu-id="a987c-225">The DHCP option inside the VM should be left enabled.</span></span> <span data-ttu-id="a987c-226">Per altre informazioni, vedere [Impostazione di un indirizzo IP privato interno statico](../virtual-network/virtual-networks-reserved-private-ip.md).</span><span class="sxs-lookup"><span data-stu-id="a987c-226">For more information, see [Setting a Static Internal Private IP](../virtual-network/virtual-networks-reserved-private-ip.md).</span></span> |

### <a name="the-backup-extension-fails-to-update-or-load"></a><span data-ttu-id="a987c-227">Non è possibile aggiornare o caricare l'estensione di backup</span><span class="sxs-lookup"><span data-stu-id="a987c-227">The backup extension fails to update or load</span></span>
<span data-ttu-id="a987c-228">Se non è possibile caricare le estensioni, Backup ha esito negativo perché non è possibile acquisire uno snapshot.</span><span class="sxs-lookup"><span data-stu-id="a987c-228">If extensions cannot be loaded, Backup fails because a snapshot cannot be taken.</span></span>

#### <a name="solution"></a><span data-ttu-id="a987c-229">Soluzione</span><span class="sxs-lookup"><span data-stu-id="a987c-229">Solution</span></span>

<span data-ttu-id="a987c-230">**Per guest Windows:** verificare che il servizio iaasvmprovider sia abilitato e abbia un tipo di avvio *automatico*.</span><span class="sxs-lookup"><span data-stu-id="a987c-230">**For Windows guests:** Verify that the iaasvmprovider service is enabled and has a startup type of *automatic*.</span></span> <span data-ttu-id="a987c-231">Se il servizio non è configurato in questo modo, abilitarlo per determinare se il backup successivo avrà esito positivo.</span><span class="sxs-lookup"><span data-stu-id="a987c-231">If the service is not configured in this way, enable it to determine whether the next backup succeeds.</span></span>

<span data-ttu-id="a987c-232">**Per guest Linux:** verificare l'ultima versione di VMSnapshot per Linux (l'estensione usata da Backup), che è 1.0.91.0.</span><span class="sxs-lookup"><span data-stu-id="a987c-232">**For Linux guests:** Verify the latest version of VMSnapshot for Linux (the extension used by Backup) is 1.0.91.0.</span></span><br>


<span data-ttu-id="a987c-233">Se l'aggiornamento o il caricamento dell'estensione di backup ancora non riesce, è possibile forzare il ricaricamento dell'estensione VMSnapshot disinstallandola.</span><span class="sxs-lookup"><span data-stu-id="a987c-233">If the backup extension still fails to update or load, you can force the VMSnapshot extension to be reloaded by uninstalling the extension.</span></span> <span data-ttu-id="a987c-234">L'estensione viene ricaricata al successivo tentativo di backup.</span><span class="sxs-lookup"><span data-stu-id="a987c-234">The next backup attempt will reload the extension.</span></span>

<span data-ttu-id="a987c-235">Per disinstallare l'estensione, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="a987c-235">To uninstall the extension, do the following:</span></span>

1. <span data-ttu-id="a987c-236">Accedere al [portale di Azure](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="a987c-236">Go to the [Azure portal](https://portal.azure.com/).</span></span>
2. <span data-ttu-id="a987c-237">Trovare la macchina virtuale che presenta problemi di backup.</span><span class="sxs-lookup"><span data-stu-id="a987c-237">Locate the VM that has backup problems.</span></span>
3. <span data-ttu-id="a987c-238">Fare clic su **Impostazioni**.</span><span class="sxs-lookup"><span data-stu-id="a987c-238">Click **Settings**.</span></span>
4. <span data-ttu-id="a987c-239">Fare clic su **Estensioni**.</span><span class="sxs-lookup"><span data-stu-id="a987c-239">Click **Extensions**.</span></span>
5. <span data-ttu-id="a987c-240">Fare clic su **Estensione Vmsnapshot**.</span><span class="sxs-lookup"><span data-stu-id="a987c-240">Click **Vmsnapshot Extension**.</span></span>
6. <span data-ttu-id="a987c-241">Fare clic su **Disinstalla**.</span><span class="sxs-lookup"><span data-stu-id="a987c-241">Click **Uninstall**.</span></span>

<span data-ttu-id="a987c-242">Questa procedura reinstalla l'estensione durante il backup successivo.</span><span class="sxs-lookup"><span data-stu-id="a987c-242">This procedure causes the extension to be reinstalled during the next backup.</span></span>

