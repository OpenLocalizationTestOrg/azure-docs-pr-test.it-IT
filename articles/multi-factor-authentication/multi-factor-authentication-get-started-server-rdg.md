---
title: Gateway Desktop remoto e server Azure MFA con RADIUS | Documentazione Microsoft
description: "Questa è la pagina di Azure Multi-factor authentication che sarà utile per la distribuzione di Gateway Desktop remoto (RD) e Server Azure Multi-Factor Authentication tramite RADIUS."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: f2354ac4-a3a7-48e5-a86d-84a9e5682b42
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/27/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: 3b4181701c5df03a3df7e0446b313eac201ad99e
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="remote-desktop-gateway-and-azure-multi-factor-authentication-server-using-radius"></a><span data-ttu-id="917dd-103">Gateway Desktop remoto e server Azure Multi-Factor Authentication utilizzando RADIUS</span><span class="sxs-lookup"><span data-stu-id="917dd-103">Remote Desktop Gateway and Azure Multi-Factor Authentication Server using RADIUS</span></span>
<span data-ttu-id="917dd-104">Gateway Desktop remoto usa il server dei criteri di rete locale per autenticare gli utenti.</span><span class="sxs-lookup"><span data-stu-id="917dd-104">Often, Remote Desktop (RD) Gateway uses the local Network Policy Services (NPS) to authenticate users.</span></span> <span data-ttu-id="917dd-105">Questo articolo descrive come inoltrare richieste RADIUS da Gateway Desktop remoto (tramite il server dei criteri di rete locale) al server Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="917dd-105">This article describes how to route RADIUS requests out from the Remote Desktop Gateway (through the local NPS) to the Multi-Factor Authentication Server.</span></span> <span data-ttu-id="917dd-106">La combinazione di Azure MFA e Gateway Desktop remoto consente agli utenti di accedere agli ambienti di lavoro da qualsiasi luogo eseguendo l'autenticazione avanzata.</span><span class="sxs-lookup"><span data-stu-id="917dd-106">The combination of Azure MFA and RD Gateway means that your users can access their work environments from anywhere while performing strong authentication.</span></span> 

<span data-ttu-id="917dd-107">Dato che l'autenticazione di Windows per Servizi terminal non è supportata per Server 2012 R2, usare RADIUS e Gateway Desktop remoto per l'integrazione con il server MFA.</span><span class="sxs-lookup"><span data-stu-id="917dd-107">Since Windows Authentication for terminal services is not supported for Server 2012 R2, use RD Gateway and RADIUS to integrate with MFA Server.</span></span> 

<span data-ttu-id="917dd-108">Installare il server Multi-Factor Authentication in un server separato, che trasmetterà tramite proxy la richiesta RADIUS al server dei criteri di rete nel server Gateway Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="917dd-108">Install the Azure Multi-Factor Authentication Server on a separate server, which proxies the RADIUS request back to the NPS on the Remote Desktop Gateway Server.</span></span> <span data-ttu-id="917dd-109">Dopo aver convalidato il nome utente e la password, il server dei criteri di rete restituisce una risposta al server Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="917dd-109">After NPS validates the username and password, it returns a response to the Multi-Factor Authentication Server.</span></span> <span data-ttu-id="917dd-110">Il server MFA esegue quindi il secondo fattore dell'autenticazione e restituisce un risultato al gateway.</span><span class="sxs-lookup"><span data-stu-id="917dd-110">Then, the MFA Server performs the second factor of authentication and returns a result to the gateway.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="917dd-111">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="917dd-111">Prerequisites</span></span>

- <span data-ttu-id="917dd-112">Un server MFA di Azure aggiunto a un dominio.</span><span class="sxs-lookup"><span data-stu-id="917dd-112">A domain-joined Azure MFA Server.</span></span> <span data-ttu-id="917dd-113">Se il server non è già installato, seguire i passaggi in [Introduzione al server Azure Multi-Factor Authentication](multi-factor-authentication-get-started-server.md).</span><span class="sxs-lookup"><span data-stu-id="917dd-113">If you don't have one installed already, follow the steps in [Getting started with the Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span></span>
- <span data-ttu-id="917dd-114">Un'istanza di Gateway Desktop remoto che esegue l'autenticazione con il server dei criteri di rete.</span><span class="sxs-lookup"><span data-stu-id="917dd-114">A Remote Desktop Gateway that authenticates with Network Policy Services.</span></span>

## <a name="configure-the-remote-desktop-gateway"></a><span data-ttu-id="917dd-115">Configurare Gateway Desktop remoto</span><span class="sxs-lookup"><span data-stu-id="917dd-115">Configure the Remote Desktop Gateway</span></span>
<span data-ttu-id="917dd-116">Configurare Gateway Desktop remoto per l'invio dell'autenticazione RADIUS a un server Azure Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="917dd-116">Configure the RD Gateway to send RADIUS authentication to an Azure Multi-Factor Authentication Server.</span></span> 

1. <span data-ttu-id="917dd-117">In Gestione Gateway Desktop remoto fare clic con il pulsante destro del mouse sul nome server e scegliere **Proprietà**.</span><span class="sxs-lookup"><span data-stu-id="917dd-117">In RD Gateway Manager, right-click the server name and select **Properties**.</span></span>
2. <span data-ttu-id="917dd-118">Passare alla scheda **Archivio criteri di autorizzazione connessioni Desktop remoto** e selezionare **Server dei criteri di rete centrale**.</span><span class="sxs-lookup"><span data-stu-id="917dd-118">Go to the **RD CAP Store** tab and select **Central server running NPS**.</span></span> 
3. <span data-ttu-id="917dd-119">Aggiungere uno o più server Azure Multi-Factor Authentication come server RADIUS immettendo il nome o l'indirizzo IP di ogni server.</span><span class="sxs-lookup"><span data-stu-id="917dd-119">Add one or more Azure Multi-Factor Authentication Servers as RADIUS servers by entering the name or IP address of each server.</span></span> 
4. <span data-ttu-id="917dd-120">Creare un segreto condiviso per ogni server.</span><span class="sxs-lookup"><span data-stu-id="917dd-120">Create a shared secret for each server.</span></span>

## <a name="configure-nps"></a><span data-ttu-id="917dd-121">Configurazione dei criteri di rete</span><span class="sxs-lookup"><span data-stu-id="917dd-121">Configure NPS</span></span>
<span data-ttu-id="917dd-122">Il Gateway Desktop remoto utilizza criteri di rete per inviare richieste RADIUS a Azure Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="917dd-122">The RD Gateway uses NPS to send the RADIUS request to Azure Multi-Factor Authentication.</span></span> <span data-ttu-id="917dd-123">Per configurare il server dei criteri di rete, modificare prima le impostazioni di timeout per evitare il timeout di Gateway Desktop remoto prima che venga completata la verifica in due passaggi.</span><span class="sxs-lookup"><span data-stu-id="917dd-123">To configure NPS, first you change the timeout settings to prevent the RD Gateway from timing out before the two-step verification has completed.</span></span> <span data-ttu-id="917dd-124">Aggiornare quindi il server dei criteri di rete per la ricezione delle autenticazioni RADIUS dal server MFA.</span><span class="sxs-lookup"><span data-stu-id="917dd-124">Then, you update NPS to receive RADIUS authentications from your MFA Server.</span></span> <span data-ttu-id="917dd-125">Usare la procedura seguente per configurare il server dei criteri di rete:</span><span class="sxs-lookup"><span data-stu-id="917dd-125">Use the following procedure to configure NPS:</span></span>

### <a name="modify-the-timeout-policy"></a><span data-ttu-id="917dd-126">Modificare i criteri di timeout</span><span class="sxs-lookup"><span data-stu-id="917dd-126">Modify the timeout policy</span></span>

1. <span data-ttu-id="917dd-127">In Server dei criteri di rete espandere il menu **Client e server RADIUS** nella colonna a sinistra e selezionare **Gruppi di server RADIUS remoti**.</span><span class="sxs-lookup"><span data-stu-id="917dd-127">In NPS, open the **RADIUS Clients and Server** menu in the left column and select **Remote RADIUS Server Groups**.</span></span> 
2. <span data-ttu-id="917dd-128">Selezionare il gruppo **SERVER GATEWAY DI SERVIZI TERMINAL**.</span><span class="sxs-lookup"><span data-stu-id="917dd-128">Select the **TS GATEWAY SERVER GROUP**.</span></span> 
3. <span data-ttu-id="917dd-129">Passare alla scheda **Bilanciamento del carico**.</span><span class="sxs-lookup"><span data-stu-id="917dd-129">Go to the **Load Balancing** tab.</span></span> 
4. <span data-ttu-id="917dd-130">Impostare sia **Numero di secondi senza risposta prima che la richiesta venga annullata** che **Numero di secondi tra le richieste quando il server viene identificato come non disponibile** su un valore compreso tra 30 e 60 secondi.</span><span class="sxs-lookup"><span data-stu-id="917dd-130">Change both the **Number of seconds without response before request is considered dropped** and the **Number of seconds between requests when server is identified as unavailable** to between 30 and 60 seconds.</span></span> <span data-ttu-id="917dd-131">Se il timeout del server persiste durante l'autenticazione, è possibile tornare a questa schermata e aumentare il numero di secondi.</span><span class="sxs-lookup"><span data-stu-id="917dd-131">(If you find that the server still times out during authentication, you can come back here and increase the number of seconds.)</span></span>
5. <span data-ttu-id="917dd-132">Passare alla scheda **Autenticazione/Account** e verificare che le porte RADIUS specificate corrispondano alle porte di attesa del server Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="917dd-132">Go to the **Authentication/Account** tab and check that the RADIUS ports specified match the ports that the Multi-Factor Authentication Server is listening on.</span></span>

### <a name="prepare-nps-to-receive-authentications-from-the-mfa-server"></a><span data-ttu-id="917dd-133">Preparare il server dei criteri di rete per la ricezione delle autenticazioni dal server MFA</span><span class="sxs-lookup"><span data-stu-id="917dd-133">Prepare NPS to receive authentications from the MFA Server</span></span>

1. <span data-ttu-id="917dd-134">Fare clic con il pulsante destro del mouse su **Client RADIUS** in Client e server RADIUS nella colonna a sinistra e scegliere **Nuovo**.</span><span class="sxs-lookup"><span data-stu-id="917dd-134">Right-click **RADIUS Clients** under RADIUS Clients and Servers in the left column and select **New**.</span></span>
2. <span data-ttu-id="917dd-135">Aggiungere il Server Azure Multi-Factor Authentication come client RADIUS.</span><span class="sxs-lookup"><span data-stu-id="917dd-135">Add the Azure Multi-Factor Authentication Server as a RADIUS client.</span></span> <span data-ttu-id="917dd-136">Scegliere un nome descrittivo e specificare un segreto condiviso.</span><span class="sxs-lookup"><span data-stu-id="917dd-136">Choose a Friendly name and specify a shared secret.</span></span>
3. <span data-ttu-id="917dd-137">Aprire il menu **Criteri** nella colonna a sinistra e selezionare **Criteri di richiesta di connessione**.</span><span class="sxs-lookup"><span data-stu-id="917dd-137">Open the **Policies** menu in the left column and select **Connection Request Policies**.</span></span> <span data-ttu-id="917dd-138">Verrà visualizzato un criterio denominato TS GATEWAY AUTHORIZATION POLICY, creato durante la configurazione di Gateway Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="917dd-138">You should see a policy called TS GATEWAY AUTHORIZATION POLICY that was created when RD Gateway was configured.</span></span> <span data-ttu-id="917dd-139">Questo criterio inoltra le richieste RADIUS al Server Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="917dd-139">This policy forwards RADIUS requests to the Multi-Factor Authentication Server.</span></span>
4. <span data-ttu-id="917dd-140">Fare clic con il pulsante destro del mouse su **TS GATEWAY AUTHORIZATION POLICY** e scegliere **Duplica criterio**.</span><span class="sxs-lookup"><span data-stu-id="917dd-140">Right-click **TS GATEWAY AUTHORIZATION POLICY** and select **Duplicate Policy**.</span></span> 
5. <span data-ttu-id="917dd-141">Aprire il nuovo criterio e selezionare la scheda **Condizioni**.</span><span class="sxs-lookup"><span data-stu-id="917dd-141">Open the new policy and go to the **Conditions** tab.</span></span>
6. <span data-ttu-id="917dd-142">Aggiungere una condizione che associ il nome descrittivo del client al nome descrittivo impostato nel passaggio 2 per il client RADIUS del server Azure Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="917dd-142">Add a condition that matches the Client Friendly Name with the Friendly name set in step 2 for the Azure Multi-Factor Authentication Server RADIUS client.</span></span> 
7. <span data-ttu-id="917dd-143">Passare alla scheda **Impostazioni** e selezionare **Autenticazione**.</span><span class="sxs-lookup"><span data-stu-id="917dd-143">Go to the **Settings** tab and select **Authentication**.</span></span>
8. <span data-ttu-id="917dd-144">Modificare il provider di autenticazione in **Autentica le richieste su questo server**.</span><span class="sxs-lookup"><span data-stu-id="917dd-144">Change the Authentication Provider to **Authenticate requests on this server**.</span></span> <span data-ttu-id="917dd-145">Questo criterio fa sì che quando il server dei criteri di rete riceve una richiesta RADIUS dal server MFA, l'autenticazione viene eseguita localmente, invece di inviare una richiesta RADIUS al server Azure Multi-Factor Authentication creando una condizione di ciclo.</span><span class="sxs-lookup"><span data-stu-id="917dd-145">This policy ensures that when NPS receives a RADIUS request from the Azure MFA Server, the authentication occurs locally instead of sending a RADIUS request back to the Azure Multi-Factor Authentication Server, which would result in a loop condition.</span></span> 
9. <span data-ttu-id="917dd-146">Per evitare una condizione di ciclo, assicurarsi che il nuovo criterio PRECEDA il criterio originale nel riquadro **Criteri di richiesta di connessione**.</span><span class="sxs-lookup"><span data-stu-id="917dd-146">To prevent a loop condition, make sure that the new policy is ordered ABOVE the original policy in the **Connection Request Policies** pane.</span></span>

## <a name="configure-azure-multi-factor-authentication"></a><span data-ttu-id="917dd-147">Configurazione di Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="917dd-147">Configure Azure Multi-Factor Authentication</span></span>

<span data-ttu-id="917dd-148">Il Server Azure Multi-Factor Authentication è configurato come proxy RADIUS tra Gateway Desktop remoto e criteri di rete.</span><span class="sxs-lookup"><span data-stu-id="917dd-148">The Azure Multi-Factor Authentication Server is configured as a RADIUS proxy between RD Gateway and NPS.</span></span>  <span data-ttu-id="917dd-149">È necessario installarlo in un server di dominio che è separato dal server Gateway Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="917dd-149">It should be installed on a domain-joined server that is separate from the RD Gateway server.</span></span> <span data-ttu-id="917dd-150">Utilizzare la procedura seguente per configurare il Server Azure Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="917dd-150">Use the following procedure to configure the Azure Multi-Factor Authentication Server.</span></span>

1. <span data-ttu-id="917dd-151">Aprire il server Azure Multi-Factor Authentication e fare clic sull'icona Autenticazione RADIUS.</span><span class="sxs-lookup"><span data-stu-id="917dd-151">Open the Azure Multi-Factor Authentication Server and select the RADIUS Authentication icon.</span></span> 
2. <span data-ttu-id="917dd-152">Selezionare la casella di controllo **Abilita autenticazione RADIUS**.</span><span class="sxs-lookup"><span data-stu-id="917dd-152">Check the **Enable RADIUS authentication** checkbox.</span></span>
3. <span data-ttu-id="917dd-153">Nella scheda Client assicurarsi che le porte corrispondano a quelle configurate in Server dei criteri di rete, quindi fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="917dd-153">On the Clients tab, ensure the ports match what is configured in NPS then select **Add**.</span></span>
4. <span data-ttu-id="917dd-154">Aggiungere l'indirizzo IP del server Gateway Desktop remoto, il nome dell'applicazione (facoltativo) e un segreto condiviso.</span><span class="sxs-lookup"><span data-stu-id="917dd-154">Add the RD Gateway server IP address, application name (optional), and a shared secret.</span></span> <span data-ttu-id="917dd-155">Il segreto condiviso deve essere lo stesso per Gateway Desktop remoto e il server Azure Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="917dd-155">The shared secret needs to be the same on both the Azure Multi-Factor Authentication Server and RD Gateway.</span></span>
3. <span data-ttu-id="917dd-156">Passare alla scheda **Destinazione** e selezionare il pulsante di opzione **Server RADIUS**.</span><span class="sxs-lookup"><span data-stu-id="917dd-156">Go to the **Target** tab and select the **RADIUS server(s)** radio button.</span></span>
4. <span data-ttu-id="917dd-157">Selezionare **Aggiungi** e immettere l'indirizzo IP, il segreto condiviso e le porte del server dei criteri di rete.</span><span class="sxs-lookup"><span data-stu-id="917dd-157">Select **Add** and enter the IP address, shared secret, and ports of the NPS server.</span></span> <span data-ttu-id="917dd-158">Se non si usa un server dei criteri di rete centrale, il client RADIUS e la destinazione RADIUS saranno uguali.</span><span class="sxs-lookup"><span data-stu-id="917dd-158">Unless using a central NPS, the RADIUS client and RADIUS target are the same.</span></span> <span data-ttu-id="917dd-159">Il segreto condiviso deve corrispondere a quello impostato nella sezione client RADIUS del server dei criteri di rete.</span><span class="sxs-lookup"><span data-stu-id="917dd-159">The shared secret must match the one setup in the RADIUS client section of the NPS server.</span></span>

![Autenticazione RADIUS](./media/multi-factor-authentication-get-started-server-rdg/radius.png)

## <a name="next-steps"></a><span data-ttu-id="917dd-161">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="917dd-161">Next steps</span></span>

- <span data-ttu-id="917dd-162">Integrare Azure MFA e [app Web IIS](multi-factor-authentication-get-started-server-iis.md)</span><span class="sxs-lookup"><span data-stu-id="917dd-162">Integrate Azure MFA and [IIS web apps](multi-factor-authentication-get-started-server-iis.md)</span></span>

- <span data-ttu-id="917dd-163">Vedere le [Domande frequenti su Azure Multi-Factor Authentication](multi-factor-authentication-faq.md)</span><span class="sxs-lookup"><span data-stu-id="917dd-163">Get answers in the [Azure Multi-Factor Authentication FAQ](multi-factor-authentication-faq.md)</span></span>
