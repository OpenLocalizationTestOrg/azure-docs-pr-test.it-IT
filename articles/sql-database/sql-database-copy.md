---
title: Copiare un database SQL di Azure | Documentazione Microsoft
description: Creare una copia di un database SQL di Azure
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5aaf6bcd-3839-49b5-8c77-cbdf786e359b
ms.service: sql-database
ms.custom: load & move data
ms.devlang: NA
ms.date: 06/15/2017
ms.author: carlrab
ms.workload: data-management
ms.topic: article
ms.tgt_pltfrm: NA
ms.openlocfilehash: 8c1e3c80b9f24089dc99463d6ea8ae5d0ea7b19d
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="copy-an-azure-sql-database"></a><span data-ttu-id="2df45-103">Copiare un database SQL di Azure</span><span class="sxs-lookup"><span data-stu-id="2df45-103">Copy an Azure SQL database</span></span>

<span data-ttu-id="2df45-104">Il Database SQL di Azure fornisce diversi metodi per la creazione di una copia coerente a livello transazionale di un database SQL di Azure esistente nello stesso server o un altro server.</span><span class="sxs-lookup"><span data-stu-id="2df45-104">Azure SQL Database provides several methods for creating a transactionally consistent copy of an existing Azure SQL database on either the same server or a different server.</span></span> <span data-ttu-id="2df45-105">È possibile copiare un database SQL tramite il portale di Azure, PowerShell o T-SQL.</span><span class="sxs-lookup"><span data-stu-id="2df45-105">You can copy a SQL database by using the Azure portal, PowerShell, or T-SQL.</span></span> 

## <a name="overview"></a><span data-ttu-id="2df45-106">Panoramica</span><span class="sxs-lookup"><span data-stu-id="2df45-106">Overview</span></span>

<span data-ttu-id="2df45-107">Una copia del database è uno snapshot del database di origine al momento della richiesta di copia.</span><span class="sxs-lookup"><span data-stu-id="2df45-107">A database copy is a snapshot of the source database as of the time of the copy request.</span></span> <span data-ttu-id="2df45-108">È possibile selezionare lo stesso server o un server diverso, il relativo livello di servizio e livello di prestazioni o un livello di prestazioni diverso all'interno dello stesso livello di servizio (edizione).</span><span class="sxs-lookup"><span data-stu-id="2df45-108">You can select the same server or a different server, its service tier and performance level, or a different performance level within the same service tier (edition).</span></span> <span data-ttu-id="2df45-109">Al termine del processo di copia, questa diventa un database indipendente e completamente funzionante.</span><span class="sxs-lookup"><span data-stu-id="2df45-109">After the copy is complete, it becomes a fully functional, independent database.</span></span> <span data-ttu-id="2df45-110">A questo punto, è possibile aggiornare o effettuare il downgrade della copia a qualsiasi edizione.</span><span class="sxs-lookup"><span data-stu-id="2df45-110">At this point, you can upgrade or downgrade it to any edition.</span></span> <span data-ttu-id="2df45-111">Gli account di accesso, gli utenti e le autorizzazioni possono essere gestiti in modo indipendente.</span><span class="sxs-lookup"><span data-stu-id="2df45-111">The logins, users, and permissions can be managed independently.</span></span>  

## <a name="logins-in-the-database-copy"></a><span data-ttu-id="2df45-112">Account di accesso nella copia del database</span><span class="sxs-lookup"><span data-stu-id="2df45-112">Logins in the database copy</span></span>

<span data-ttu-id="2df45-113">Quando si copia un database nello stesso server logico, è possibile usare gli stessi account di accesso per entrambi i database.</span><span class="sxs-lookup"><span data-stu-id="2df45-113">When you copy a database to the same logical server, the same logins can be used on both databases.</span></span> <span data-ttu-id="2df45-114">L'entità di sicurezza usata per copiare il database diventa il proprietario del database nel nuovo database.</span><span class="sxs-lookup"><span data-stu-id="2df45-114">The security principal you use to copy the database becomes the database owner on the new database.</span></span> <span data-ttu-id="2df45-115">Tutti gli utenti del database, le relative autorizzazioni e i relativi identificatori di sicurezza (SID) vengono copiati nella copia del database.</span><span class="sxs-lookup"><span data-stu-id="2df45-115">All database users, their permissions, and their security identifiers (SIDs) are copied to the database copy.</span></span>  

<span data-ttu-id="2df45-116">Quando la copia del database viene eseguita su un server logico diverso, l'entità di sicurezza sul nuovo server diventa il proprietario del database nel nuovo database.</span><span class="sxs-lookup"><span data-stu-id="2df45-116">When you copy a database to a different logical server, the security principal on the new server becomes the database owner on the new database.</span></span> <span data-ttu-id="2df45-117">L'uso di [utenti di database indipendente](sql-database-manage-logins.md) per l'accesso ai dati garantisce che per i database primari e secondari ci siano sempre le stesse credenziali utente, in modo che dopo il completamento della copia sia possibile accedervi immediatamente con le stesse credenziali.</span><span class="sxs-lookup"><span data-stu-id="2df45-117">If you use [contained database users](sql-database-manage-logins.md) for data access, ensure that both the primary and secondary databases always have the same user credentials, so that after the copy is complete you can immediately access it with the same credentials.</span></span> 

<span data-ttu-id="2df45-118">Se si usa [Azure Active Directory](../active-directory/active-directory-whatis.md), è possibile eliminare completamente l'esigenza di gestione delle credenziali nella copia.</span><span class="sxs-lookup"><span data-stu-id="2df45-118">If you use [Azure Active Directory](../active-directory/active-directory-whatis.md), you can completely eliminate the need for managing credentials in the copy.</span></span> <span data-ttu-id="2df45-119">Tuttavia, quando si copia il database in un nuovo server, è possibile che l'accesso basato sulle credenziali non funzioni perché le credenziali di accesso non esistono nel nuovo server.</span><span class="sxs-lookup"><span data-stu-id="2df45-119">However, when you copy the database to a new server, the login-based access might not work, because the logins do not exist on the new server.</span></span> <span data-ttu-id="2df45-120">Per informazioni sulla gestione degli accessi con credenziali durante la copia di un database in un server logico differente, vedere [Configurare e gestire la sicurezza dei database SQL di Azure per il ripristino geografico o il failover](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="2df45-120">To learn about managing logins when you copy a database to a different logical server, see [How to manage Azure SQL database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span> 

<span data-ttu-id="2df45-121">Dopo il completamento della copia e prima che venga modificato il mapping di altri utenti, solo l'account di accesso che ha avviato la copia, il proprietario del database, può accedere al nuovo database.</span><span class="sxs-lookup"><span data-stu-id="2df45-121">After the copying succeeds and before other users are remapped, only the login that initiated the copying, the database owner, can log in to the new database.</span></span> <span data-ttu-id="2df45-122">Per risolvere gli account di accesso al termine dell'operazione di copia, vedere [Risolvere gli account di accesso](#resolve-logins).</span><span class="sxs-lookup"><span data-stu-id="2df45-122">To resolve logins after the copying operation is complete, see [Resolve logins](#resolve-logins).</span></span>

## <a name="copy-a-database-by-using-the-azure-portal"></a><span data-ttu-id="2df45-123">Copiare un database tramite il portale di Azure</span><span class="sxs-lookup"><span data-stu-id="2df45-123">Copy a database by using the Azure portal</span></span>

<span data-ttu-id="2df45-124">Per copiare un database tramite il portale di Azure, aprire la pagina per il database e quindi fare clic su **Copia**.</span><span class="sxs-lookup"><span data-stu-id="2df45-124">To copy a database by using the Azure portal, open the page for your database, and then click **Copy**.</span></span> 

   ![Copia del database](./media/sql-database-copy/database-copy.png)

## <a name="copy-a-database-by-using-powershell"></a><span data-ttu-id="2df45-126">Copiare un database tramite PowerShell</span><span class="sxs-lookup"><span data-stu-id="2df45-126">Copy a database by using PowerShell</span></span>

<span data-ttu-id="2df45-127">Per copiare un database tramite PowerShell usare il cmdlet [New-AzureRmSqlDatabaseCopy](/powershell/module/azurerm.sql/new-azurermsqldatabasecopy).</span><span class="sxs-lookup"><span data-stu-id="2df45-127">To copy a database by using PowerShell, use the [New-AzureRmSqlDatabaseCopy](/powershell/module/azurerm.sql/new-azurermsqldatabasecopy) cmdlet.</span></span> 

```PowerShell
New-AzureRmSqlDatabaseCopy -ResourceGroupName "myResourceGroup" `
    -ServerName $sourceserver `
    -DatabaseName "MySampleDatabase" `
    -CopyResourceGroupName "myResourceGroup" `
    -CopyServerName $targetserver `
    -CopyDatabaseName "CopyOfMySampleDatabase"
```

<span data-ttu-id="2df45-128">Per uno script di esempio completo, vedere [Copiare un database in un nuovo server](scripts/sql-database-copy-database-to-new-server-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="2df45-128">For a complete sample script, see [Copy a database to a new server](scripts/sql-database-copy-database-to-new-server-powershell.md).</span></span>

## <a name="copy-a-database-by-using-transact-sql"></a><span data-ttu-id="2df45-129">Copiare un database tramite Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="2df45-129">Copy a database by using Transact-SQL</span></span>

<span data-ttu-id="2df45-130">Accedere al database master con l'account di accesso dell'entità di livello server o l'account di accesso con cui è stato creato il database che si desidera copiare.</span><span class="sxs-lookup"><span data-stu-id="2df45-130">Log in to the master database with the server-level principal login or the login that created the database you want to copy.</span></span> <span data-ttu-id="2df45-131">Affinché il processo di copia del database abbia esito positivo, gli account di accesso che non corrispondono all'entità di livello server devono essere membri del ruolo dbmanager.</span><span class="sxs-lookup"><span data-stu-id="2df45-131">For database copying to succeed, logins that are not the server-level principal must be members of the dbmanager role.</span></span> <span data-ttu-id="2df45-132">Per ulteriori informazioni sugli account di accesso e la connessione al server, vedere [Gestire gli accessi](sql-database-manage-logins.md).</span><span class="sxs-lookup"><span data-stu-id="2df45-132">For more information about logins and connecting to the server, see [Manage logins](sql-database-manage-logins.md).</span></span>

<span data-ttu-id="2df45-133">Iniziare a copiare il database di origine con l'istruzione [CREATE DATABASE](https://msdn.microsoft.com/library/ms176061.aspx) .</span><span class="sxs-lookup"><span data-stu-id="2df45-133">Start copying the source database with the [CREATE DATABASE](https://msdn.microsoft.com/library/ms176061.aspx) statement.</span></span> <span data-ttu-id="2df45-134">L'esecuzione di questa istruzione avvia il processo di copia del database.</span><span class="sxs-lookup"><span data-stu-id="2df45-134">Executing this statement initiates the database copying process.</span></span> <span data-ttu-id="2df45-135">Poiché la copia di un database è un processo asincrono, l'istruzione CREATE DATABASE viene restituita prima del completamento della copia del database.</span><span class="sxs-lookup"><span data-stu-id="2df45-135">Because copying a database is an asynchronous process, the CREATE DATABASE statement returns before the database copying is complete.</span></span>

### <a name="copy-a-sql-database-to-the-same-server"></a><span data-ttu-id="2df45-136">Copiare un database SQL nello stesso server</span><span class="sxs-lookup"><span data-stu-id="2df45-136">Copy a SQL database to the same server</span></span>
<span data-ttu-id="2df45-137">Accedere al database master con l'account di accesso dell'entità di livello server o l'account di accesso con cui è stato creato il database che si desidera copiare.</span><span class="sxs-lookup"><span data-stu-id="2df45-137">Log in to the master database with the server-level principal login or the login that created the database you want to copy.</span></span> <span data-ttu-id="2df45-138">Affinché il processo di copia del database abbia esito positivo, gli account di accesso che non corrispondono all'entità di livello server devono essere membri del ruolo dbmanager.</span><span class="sxs-lookup"><span data-stu-id="2df45-138">For database copying to succeed, logins that are not the server-level principal must be members of the dbmanager role.</span></span>

<span data-ttu-id="2df45-139">Questo comando copia Database1 in un nuovo database denominato Database2 sullo stesso server.</span><span class="sxs-lookup"><span data-stu-id="2df45-139">This command copies Database1 to a new database named Database2 on the same server.</span></span> <span data-ttu-id="2df45-140">A seconda delle dimensioni del database, l'operazione di copia potrebbe richiedere alcuni minuti.</span><span class="sxs-lookup"><span data-stu-id="2df45-140">Depending on the size of your database, the copying operation might take some time to complete.</span></span>

    -- Execute on the master database.
    -- Start copying.
    CREATE DATABASE Database1_copy AS COPY OF Database1;

### <a name="copy-a-sql-database-to-a-different-server"></a><span data-ttu-id="2df45-141">Copiare un database SQL in un server diverso</span><span class="sxs-lookup"><span data-stu-id="2df45-141">Copy a SQL database to a different server</span></span>

<span data-ttu-id="2df45-142">Accedere al database master del server di destinazione, il server del database SQL in cui verrà creato il nuovo database.</span><span class="sxs-lookup"><span data-stu-id="2df45-142">Log in to the master database of the destination server, the SQL database server where the new database is to be created.</span></span> <span data-ttu-id="2df45-143">Usare un account di accesso con lo stesso nome e la stessa password del proprietario del database di origine nel server del database SQL di origine.</span><span class="sxs-lookup"><span data-stu-id="2df45-143">Use a login that has the same name and password as the database owner of the source database on the source SQL database server.</span></span> <span data-ttu-id="2df45-144">L'account di accesso nel server di destinazione deve anche essere un membro del ruolo dbmanager o corrispondere all'account di accesso dell'entità di livello server.</span><span class="sxs-lookup"><span data-stu-id="2df45-144">The login on the destination server must also be a member of the dbmanager role or be the server-level principal login.</span></span>

<span data-ttu-id="2df45-145">Questo comando copia Database1 sul server1 in un nuovo database denominato Database2 sul server2.</span><span class="sxs-lookup"><span data-stu-id="2df45-145">This command copies Database1 on server1 to a new database named Database2 on server2.</span></span> <span data-ttu-id="2df45-146">A seconda delle dimensioni del database, l'operazione di copia potrebbe richiedere alcuni minuti.</span><span class="sxs-lookup"><span data-stu-id="2df45-146">Depending on the size of your database, the copying operation might take some time to complete.</span></span>

    -- Execute on the master database of the target server (server2)
    -- Start copying from Server1 to Server2
    CREATE DATABASE Database1_copy AS COPY OF server1.Database1;


### <a name="monitor-the-progress-of-the-copying-operation"></a><span data-ttu-id="2df45-147">Monitorare lo stato dell'operazione di copia</span><span class="sxs-lookup"><span data-stu-id="2df45-147">Monitor the progress of the copying operation</span></span>

<span data-ttu-id="2df45-148">Monitorare il processo di copia eseguendo una query sulle visualizzazioni sys.databases e sys.dm_database_copies.</span><span class="sxs-lookup"><span data-stu-id="2df45-148">Monitor the copying process by querying the sys.databases and sys.dm_database_copies views.</span></span> <span data-ttu-id="2df45-149">Durante il processo di copia, la colonna **state_desc** della visualizzazione sys.databases per il nuovo database viene impostata su **COPYING**.</span><span class="sxs-lookup"><span data-stu-id="2df45-149">While the copying is in progress, the **state_desc** column of the sys.databases view for the new database is set to **COPYING**.</span></span>

* <span data-ttu-id="2df45-150">Se il processo di copia non viene completato, la colonna **state_desc** della visualizzazione sys.databases per il nuovo database viene impostata su **SUSPECT**.</span><span class="sxs-lookup"><span data-stu-id="2df45-150">If the copying fails, the **state_desc** column of the sys.databases view for the new database is set to **SUSPECT**.</span></span> <span data-ttu-id="2df45-151">Eseguire l'istruzione DROP sul nuovo database e riprovare in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="2df45-151">Execute the DROP statement on the new database, and try again later.</span></span>
* <span data-ttu-id="2df45-152">Se il processo di copia viene completato, la colonna **state_desc** della visualizzazione sys.databases per il nuovo database viene impostata su **ONLINE**.</span><span class="sxs-lookup"><span data-stu-id="2df45-152">If the copying succeeds, the **state_desc** column of the sys.databases view for the new database is set to **ONLINE**.</span></span> <span data-ttu-id="2df45-153">La copia è stata completata e il nuovo database è un database standard, che può essere modificato indipendentemente dal database di origine.</span><span class="sxs-lookup"><span data-stu-id="2df45-153">The copying is complete, and the new database is a regular database that can be changed independent of the source database.</span></span>

> [!NOTE]
> <span data-ttu-id="2df45-154">Se si decide di annullare il processo di copia mentre è in corso, eseguire l'istruzione [DROP DATABASE](https://msdn.microsoft.com/library/ms178613.aspx) nel nuovo database.</span><span class="sxs-lookup"><span data-stu-id="2df45-154">If you decide to cancel the copying while it is in progress, execute the [DROP DATABASE](https://msdn.microsoft.com/library/ms178613.aspx) statement on the new database.</span></span> <span data-ttu-id="2df45-155">In alternativa, anche l'esecuzione dell'istruzione DROP DATABASE sul database di origine annulla il processo di copia.</span><span class="sxs-lookup"><span data-stu-id="2df45-155">Alternatively, executing the DROP DATABASE statement on the source database also cancels the copying process.</span></span>
> 

## <a name="resolve-logins"></a><span data-ttu-id="2df45-156">Risolvere gli account di accesso</span><span class="sxs-lookup"><span data-stu-id="2df45-156">Resolve logins</span></span>

<span data-ttu-id="2df45-157">Dopo che il nuovo database è online nel server di destinazione, usare l'istruzione [ALTER USER](https://msdn.microsoft.com/library/ms176060.aspx) per modificare il mapping degli utenti del nuovo database agli account di accesso nel server di destinazione.</span><span class="sxs-lookup"><span data-stu-id="2df45-157">After the new database is online on the destination server, use the [ALTER USER](https://msdn.microsoft.com/library/ms176060.aspx) statement to remap the users from the new database to logins on the destination server.</span></span> <span data-ttu-id="2df45-158">Per risolvere gli utenti isolati, vedere [Risolvere i problemi relativi agli utenti isolati (SQL Server)](https://msdn.microsoft.com/library/ms175475.aspx).</span><span class="sxs-lookup"><span data-stu-id="2df45-158">To resolve orphaned users, see [Troubleshoot Orphaned Users](https://msdn.microsoft.com/library/ms175475.aspx).</span></span> <span data-ttu-id="2df45-159">Vedere anche [Come gestire la sicurezza dopo il ripristino di emergenza](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="2df45-159">See also [How to manage Azure SQL database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>

<span data-ttu-id="2df45-160">Tutti gli utenti nel nuovo database mantengono le autorizzazioni di cui disponevano nel database di origine.</span><span class="sxs-lookup"><span data-stu-id="2df45-160">All users in the new database retain the permissions that they had in the source database.</span></span> <span data-ttu-id="2df45-161">L'utente che ha avviato la copia del database diventa il proprietario del nuovo database e gli viene assegnato un nuovo ID di sicurezza (SID).</span><span class="sxs-lookup"><span data-stu-id="2df45-161">The user who initiated the database copy becomes the database owner of the new database and is assigned a new security identifier (SID).</span></span> <span data-ttu-id="2df45-162">Dopo il completamento della copia e prima che venga modificato il mapping di altri utenti, solo l'account di accesso che ha avviato la copia, il proprietario del database, può accedere al nuovo database.</span><span class="sxs-lookup"><span data-stu-id="2df45-162">After the copying succeeds and before other users are remapped, only the login that initiated the copying, the database owner, can log in to the new database.</span></span>

<span data-ttu-id="2df45-163">Per informazioni sulla gestione di utenti e account di accesso durante la copia di un database in un server logico diverso, vedere [Configurare e gestire la sicurezza dei database SQL di Azure per il ripristino geografico o il failover](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="2df45-163">To learn about managing users and logins when you copy a database to a different logical server, see [How to manage Azure SQL database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="2df45-164">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="2df45-164">Next steps</span></span>

* <span data-ttu-id="2df45-165">Per informazioni sugli account di accesso, vedere [Controllo e concessione dell'accesso al database](sql-database-manage-logins.md) e [Configurare e gestire la sicurezza dei database SQL di Azure per il ripristino geografico o il failover](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="2df45-165">For information about logins, see [Manage logins](sql-database-manage-logins.md) and [How to manage Azure SQL database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="2df45-166">Per esportare un database, vedere [Esportare un database SQL di Azure in un file BACPAC](sql-database-export.md).</span><span class="sxs-lookup"><span data-stu-id="2df45-166">To export a database, see [Export the database to a BACPAC](sql-database-export.md).</span></span>
