---
title: "Più indirizzi VIP per Azure Load Balancer | Microsoft Docs"
description: "Panoramica di più indirizzi VIP in Azure Load Balancer"
services: load-balancer
documentationcenter: na
author: chkuhtz
manager: narayan
editor: 
ms.assetid: 748e50cd-3087-4c2e-a9e1-ac0ecce4f869
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/11/2016
ms.author: chkuhtz
ms.openlocfilehash: d9e88b859020be2a96a57a01e5624052ed134b64
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="multiple-vips-for-azure-load-balancer"></a><span data-ttu-id="3ec3d-103">Più indirizzi VIP per Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="3ec3d-103">Multiple VIPs for Azure Load Balancer</span></span>

<span data-ttu-id="3ec3d-104">Azure Load Balancer consente di eseguire il bilanciamento del carico dei servizi su più porte, più indirizzi IP o entrambi.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-104">Azure Load Balancer allows you to load balance services on multiple ports, multiple IP addresses, or both.</span></span> <span data-ttu-id="3ec3d-105">È possibile usare le definizioni di servizio di bilanciamento del carico interno e pubblico per eseguire il bilanciamento del carico dei flussi in un set di macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-105">You can use public and internal load balancer definitions to load balance flows across a set of VMs.</span></span>

<span data-ttu-id="3ec3d-106">Questo articolo descrive i principi fondamentali di questa funzionalità, i concetti importanti e i vincoli.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-106">This article describes the fundamentals of this ability, important concepts, and constraints.</span></span> <span data-ttu-id="3ec3d-107">Se si intende esporre i servizi in un solo indirizzo IP, sono disponibili istruzioni semplificate per le configurazioni di servizi di bilanciamento del carico [pubblici](load-balancer-get-started-internet-portal.md) o [interni](load-balancer-get-started-ilb-arm-portal.md).</span><span class="sxs-lookup"><span data-stu-id="3ec3d-107">If you only intend to expose services on one IP address, you can find simplified instructions for [public](load-balancer-get-started-internet-portal.md) or [internal](load-balancer-get-started-ilb-arm-portal.md) load balancer configurations.</span></span> <span data-ttu-id="3ec3d-108">L'aggiunta di più indirizzi VIP è un'operazione incrementale rispetto a una configurazione con un solo indirizzo VIP.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-108">Adding Multiple VIPs is incremental to a single VIP configuration.</span></span> <span data-ttu-id="3ec3d-109">Usando i concetti illustrati in questo articolo è possibile espandere una configurazione semplificata in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-109">Using the concepts in this article, you can expand a simplified configuration at any time.</span></span>

<span data-ttu-id="3ec3d-110">Quando si definisce un'istanza di Azure Load Balancer, vengono connessi un front-end e un back-end con regole.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-110">When you define an Azure Load Balancer, a frontend and a backend configuration are connected with rules.</span></span> <span data-ttu-id="3ec3d-111">Il probe di integrità a cui fa riferimento la regola viene usato per determinare il modo in cui i nuovi flussi vengono inviati a un nodo nel pool back-end.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-111">The health probe referenced by the rule is used to determine how new flows are sent to a node in the backend pool.</span></span> <span data-ttu-id="3ec3d-112">Il front-end è definito da un indirizzo IP virtuale (VIP) che è una tupla di 3 elementi costituita da un indirizzo IP (pubblico o interno), un protocollo di trasporto (UDP o TCP) e un numero di porta.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-112">The frontend is defined by a Virtual IP (VIP), which is a 3-tuple comprised of an IP address (public or internal), a transport protocol (UDP or TCP), and a port number.</span></span> <span data-ttu-id="3ec3d-113">Un DIP è un indirizzo IP su una scheda di interfaccia di rete virtuale di Azure collegata a una macchina virtuale nel pool back-end.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-113">A DIP is an IP address on an Azure virtual NIC attached to a VM in the backend pool.</span></span>

<span data-ttu-id="3ec3d-114">La tabella seguente contiene alcune configurazioni front-end di esempio:</span><span class="sxs-lookup"><span data-stu-id="3ec3d-114">The following table contains some example frontend configurations:</span></span>

| <span data-ttu-id="3ec3d-115">Indirizzo VIP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-115">VIP</span></span> | <span data-ttu-id="3ec3d-116">Indirizzo IP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-116">IP address</span></span> | <span data-ttu-id="3ec3d-117">protocol</span><span class="sxs-lookup"><span data-stu-id="3ec3d-117">protocol</span></span> | <span data-ttu-id="3ec3d-118">port</span><span class="sxs-lookup"><span data-stu-id="3ec3d-118">port</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="3ec3d-119">1</span><span class="sxs-lookup"><span data-stu-id="3ec3d-119">1</span></span> |<span data-ttu-id="3ec3d-120">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="3ec3d-120">65.52.0.1</span></span> |<span data-ttu-id="3ec3d-121">TCP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-121">TCP</span></span> |<span data-ttu-id="3ec3d-122">80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-122">80</span></span> |
| <span data-ttu-id="3ec3d-123">2</span><span class="sxs-lookup"><span data-stu-id="3ec3d-123">2</span></span> |<span data-ttu-id="3ec3d-124">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="3ec3d-124">65.52.0.1</span></span> |<span data-ttu-id="3ec3d-125">TCP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-125">TCP</span></span> |<span data-ttu-id="3ec3d-126">*8080*</span><span class="sxs-lookup"><span data-stu-id="3ec3d-126">*8080*</span></span> |
| <span data-ttu-id="3ec3d-127">3</span><span class="sxs-lookup"><span data-stu-id="3ec3d-127">3</span></span> |<span data-ttu-id="3ec3d-128">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="3ec3d-128">65.52.0.1</span></span> |<span data-ttu-id="3ec3d-129">*UDP*</span><span class="sxs-lookup"><span data-stu-id="3ec3d-129">*UDP*</span></span> |<span data-ttu-id="3ec3d-130">80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-130">80</span></span> |
| <span data-ttu-id="3ec3d-131">4</span><span class="sxs-lookup"><span data-stu-id="3ec3d-131">4</span></span> |<span data-ttu-id="3ec3d-132">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="3ec3d-132">*65.52.0.2*</span></span> |<span data-ttu-id="3ec3d-133">TCP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-133">TCP</span></span> |<span data-ttu-id="3ec3d-134">80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-134">80</span></span> |

<span data-ttu-id="3ec3d-135">La tabella descrive quattro front-end diversi.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-135">The table shows four different frontends.</span></span> <span data-ttu-id="3ec3d-136">I front-end 1, 2 e 3 rappresentano un unico indirizzo VIP con più regole.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-136">Frontends #1, #2 and #3 are a single VIP with multiple rules.</span></span> <span data-ttu-id="3ec3d-137">Viene usato lo stesso indirizzo IP, ma la porta o il protocollo sono diversi per ogni front-end.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-137">The same IP address is used but the port or protocol is different for each frontend.</span></span> <span data-ttu-id="3ec3d-138">I front-end 1 e 4 sono un esempio di più indirizzi VIP, in cui lo stesso protocollo e la stessa porta front-end vengono riutilizzati in più indirizzi VIP.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-138">Frontends #1 and #4 are an example of Multiple VIPs, where the same frontend protocol and port are reused across multiple VIPs.</span></span>

<span data-ttu-id="3ec3d-139">Azure Load Balancer offre flessibilità nella definizione di regole del servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-139">Azure Load Balancer provides flexibility in defining the load balancing rules.</span></span> <span data-ttu-id="3ec3d-140">Una regola dichiara il modo in cui viene eseguito il mapping di un indirizzo e una porta nel front-end all'indirizzo e alla porta di destinazione nel back-end.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-140">A rule declares how an address and port on the frontend is mapped to the destination address and port on the backend.</span></span> <span data-ttu-id="3ec3d-141">L'eventuale riutilizzo delle porte back-end tra regole dipende dal tipo di regola.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-141">Whether or not backend ports are reused across rules depends on the type of the rule.</span></span> <span data-ttu-id="3ec3d-142">Ogni tipo di regola presenta requisiti specifici che possono influire sulla configurazione degli host e la progettazione dei probe.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-142">Each type of rule has specific requirements that can affect host configuration and probe design.</span></span> <span data-ttu-id="3ec3d-143">Esistono due tipi di regole:</span><span class="sxs-lookup"><span data-stu-id="3ec3d-143">There are two types of rules:</span></span>

1. <span data-ttu-id="3ec3d-144">La regola predefinita senza riutilizzo delle porte back-end</span><span class="sxs-lookup"><span data-stu-id="3ec3d-144">The default rule with no backend port reuse</span></span>
2. <span data-ttu-id="3ec3d-145">La regola con indirizzo IP mobile che prevede il riutilizzo delle porte back-end</span><span class="sxs-lookup"><span data-stu-id="3ec3d-145">The Floating IP rule where backend ports are reused</span></span>

<span data-ttu-id="3ec3d-146">Azure Load Balancer consente di combinare i due tipi di regole nella stessa configurazione del servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-146">Azure Load Balancer allows you to mix both rule types on the same load balancer configuration.</span></span> <span data-ttu-id="3ec3d-147">Il servizio di bilanciamento del carico può usare le regole contemporaneamente per una determinata macchina virtuale o una qualsiasi combinazione, purché siano rispettati i vincoli della regola.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-147">The load balancer can use them simultaneously for a given VM, or any combination, as long as you abide by the constraints of the rule.</span></span> <span data-ttu-id="3ec3d-148">Il tipo di regola scelto dipende dai requisiti dell'applicazione e dalla complessità correlata al supporto della configurazione.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-148">Which rule type you choose depends on the requirements of your application and the complexity of supporting that configuration.</span></span> <span data-ttu-id="3ec3d-149">È necessario valutare quali tipi di regole siano più adatti allo scenario.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-149">You should evaluate which rule types are best for your scenario.</span></span>

<span data-ttu-id="3ec3d-150">Questi scenari verranno approfonditi iniziando con il comportamento predefinito.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-150">We explore these scenarios further by starting with the default behavior.</span></span>

## <a name="rule-type-1-no-backend-port-reuse"></a><span data-ttu-id="3ec3d-151">Regola di tipo 1: nessun riutilizzo delle porte back-end</span><span class="sxs-lookup"><span data-stu-id="3ec3d-151">Rule type #1: No backend port reuse</span></span>

![Illustrazione di più indirizzi VIP](./media/load-balancer-multivip-overview/load-balancer-multivip.png)

<span data-ttu-id="3ec3d-153">In questo scenario, gli indirizzi VIP front-end sono configurati nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="3ec3d-153">In this scenario, the frontend VIPs are configured as follows:</span></span>

| <span data-ttu-id="3ec3d-154">Indirizzo VIP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-154">VIP</span></span> | <span data-ttu-id="3ec3d-155">Indirizzo IP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-155">IP address</span></span> | <span data-ttu-id="3ec3d-156">protocol</span><span class="sxs-lookup"><span data-stu-id="3ec3d-156">protocol</span></span> | <span data-ttu-id="3ec3d-157">port</span><span class="sxs-lookup"><span data-stu-id="3ec3d-157">port</span></span> |
| --- | --- | --- | --- |
| ![Indirizzo VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="3ec3d-159">1</span><span class="sxs-lookup"><span data-stu-id="3ec3d-159">1</span></span> |<span data-ttu-id="3ec3d-160">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="3ec3d-160">65.52.0.1</span></span> |<span data-ttu-id="3ec3d-161">TCP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-161">TCP</span></span> |<span data-ttu-id="3ec3d-162">80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-162">80</span></span> |
| ![Indirizzo VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="3ec3d-164">2</span><span class="sxs-lookup"><span data-stu-id="3ec3d-164">2</span></span> |<span data-ttu-id="3ec3d-165">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="3ec3d-165">*65.52.0.2*</span></span> |<span data-ttu-id="3ec3d-166">TCP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-166">TCP</span></span> |<span data-ttu-id="3ec3d-167">80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-167">80</span></span> |

<span data-ttu-id="3ec3d-168">Il DIP è la destinazione del flusso in ingresso.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-168">The DIP is the destination of the inbound flow.</span></span> <span data-ttu-id="3ec3d-169">Nel pool di back-end, ogni macchina virtuale espone il servizio desiderato su una porta univoca in un DIP.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-169">In the backend pool, each VM exposes the desired service on a unique port on a DIP.</span></span> <span data-ttu-id="3ec3d-170">Questo servizio è associato al front-end tramite una definizione di regole.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-170">This service is associated with the frontend through a rule definition.</span></span>

<span data-ttu-id="3ec3d-171">Si definiscono due regole:</span><span class="sxs-lookup"><span data-stu-id="3ec3d-171">We define two rules:</span></span>

| <span data-ttu-id="3ec3d-172">Regola</span><span class="sxs-lookup"><span data-stu-id="3ec3d-172">Rule</span></span> | <span data-ttu-id="3ec3d-173">Mapping frontend</span><span class="sxs-lookup"><span data-stu-id="3ec3d-173">Map frontend</span></span> | <span data-ttu-id="3ec3d-174">Al pool back-end</span><span class="sxs-lookup"><span data-stu-id="3ec3d-174">To backend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="3ec3d-175">1</span><span class="sxs-lookup"><span data-stu-id="3ec3d-175">1</span></span> |![Indirizzo VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="3ec3d-177">VIP1:80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-177">VIP1:80</span></span> |![back-end](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="3ec3d-179">DIP1:80,</span><span class="sxs-lookup"><span data-stu-id="3ec3d-179">DIP1:80,</span></span> ![back-end](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="3ec3d-181">DIP2:80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-181">DIP2:80</span></span> |
| <span data-ttu-id="3ec3d-182">2</span><span class="sxs-lookup"><span data-stu-id="3ec3d-182">2</span></span> |![Indirizzo VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="3ec3d-184">VIP2:80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-184">VIP2:80</span></span> |![back-end](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="3ec3d-186">DIP1:81,</span><span class="sxs-lookup"><span data-stu-id="3ec3d-186">DIP1:81,</span></span> ![back-end](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="3ec3d-188">DIP2:81</span><span class="sxs-lookup"><span data-stu-id="3ec3d-188">DIP2:81</span></span> |

<span data-ttu-id="3ec3d-189">Il mapping completo in Azure Load Balancer sarà ora il seguente:</span><span class="sxs-lookup"><span data-stu-id="3ec3d-189">The complete mapping in Azure Load Balancer is now as follows:</span></span>

| <span data-ttu-id="3ec3d-190">Regola</span><span class="sxs-lookup"><span data-stu-id="3ec3d-190">Rule</span></span> | <span data-ttu-id="3ec3d-191">Indirizzo IP VIP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-191">VIP IP address</span></span> | <span data-ttu-id="3ec3d-192">protocol</span><span class="sxs-lookup"><span data-stu-id="3ec3d-192">protocol</span></span> | <span data-ttu-id="3ec3d-193">port</span><span class="sxs-lookup"><span data-stu-id="3ec3d-193">port</span></span> | <span data-ttu-id="3ec3d-194">Destination</span><span class="sxs-lookup"><span data-stu-id="3ec3d-194">Destination</span></span> | <span data-ttu-id="3ec3d-195">port</span><span class="sxs-lookup"><span data-stu-id="3ec3d-195">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![Regola](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="3ec3d-197">1</span><span class="sxs-lookup"><span data-stu-id="3ec3d-197">1</span></span> |<span data-ttu-id="3ec3d-198">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="3ec3d-198">65.52.0.1</span></span> |<span data-ttu-id="3ec3d-199">TCP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-199">TCP</span></span> |<span data-ttu-id="3ec3d-200">80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-200">80</span></span> |<span data-ttu-id="3ec3d-201">Indirizzo IP DIP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-201">DIP IP Address</span></span> |<span data-ttu-id="3ec3d-202">80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-202">80</span></span> |
| ![Regola](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="3ec3d-204">2</span><span class="sxs-lookup"><span data-stu-id="3ec3d-204">2</span></span> |<span data-ttu-id="3ec3d-205">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="3ec3d-205">65.52.0.2</span></span> |<span data-ttu-id="3ec3d-206">TCP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-206">TCP</span></span> |<span data-ttu-id="3ec3d-207">80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-207">80</span></span> |<span data-ttu-id="3ec3d-208">Indirizzo IP DIP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-208">DIP IP Address</span></span> |<span data-ttu-id="3ec3d-209">81</span><span class="sxs-lookup"><span data-stu-id="3ec3d-209">81</span></span> |

<span data-ttu-id="3ec3d-210">Ogni regola deve produrre un flusso con una combinazione univoca di indirizzo IP di destinazione e porta di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-210">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="3ec3d-211">Modificando la porta di destinazione del flusso, più regole possono inviare flussi allo stesso DIP in porte diverse.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-211">By varying the destination port of the flow, multiple rules can deliver flows to the same DIP on different ports.</span></span>

<span data-ttu-id="3ec3d-212">I probe di integrità vengono sempre indirizzati al DIP di una macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-212">Health probes are always directed to the DIP of a VM.</span></span> <span data-ttu-id="3ec3d-213">È necessario assicurarsi che il probe rifletta lo stato della VM.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-213">You must ensure you that your probe reflects the health of the VM.</span></span>

## <a name="rule-type-2-backend-port-reuse-by-using-floating-ip"></a><span data-ttu-id="3ec3d-214">Regola di tipo 2: riutilizzo delle porte back-end tramite indirizzo IP mobile</span><span class="sxs-lookup"><span data-stu-id="3ec3d-214">Rule type #2: backend port reuse by using Floating IP</span></span>

<span data-ttu-id="3ec3d-215">Azure Load Balancer consente di riutilizzare la porta front-end in più indirizzi VIP indipendentemente dal tipo di regola usato.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-215">Azure Load Balancer provides the flexibility to reuse the frontend port across multiple VIPs regardless of the rule type used.</span></span> <span data-ttu-id="3ec3d-216">Alcuni scenari di applicazione preferiscono o richiedono l'uso della stessa porta da parte di più istanze dell'applicazione in una singola macchina virtuale nel pool back-end.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-216">Additionally, some application scenarios prefer or require the same port to be used by multiple application instances on a single VM in the backend pool.</span></span> <span data-ttu-id="3ec3d-217">Esempi comuni di riutilizzo delle porte includono il clustering per la disponibilità elevata, le appliance virtuali di rete e l'esposizione di più endpoint TLS senza rieseguire la crittografia di rete.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-217">Common examples of port reuse include clustering for high availability, network virtual appliances, and exposing multiple TLS endpoints without re-encryption.</span></span>

<span data-ttu-id="3ec3d-218">Per riutilizzare la porta di back-end tra più regole, è necessario abilitare l'indirizzo IP mobile nella definizione della regola.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-218">If you want to reuse the backend port across multiple rules, you must enable Floating IP in the rule definition.</span></span>

<span data-ttu-id="3ec3d-219">L'indirizzo IP mobile è una parte di ciò che è noto come Direct Server Return (DSR).</span><span class="sxs-lookup"><span data-stu-id="3ec3d-219">Floating IP is a portion of what is known as Direct Server Return (DSR).</span></span> <span data-ttu-id="3ec3d-220">Il DSR è costituito da due parti: una topologia di flussi e uno schema di mappatura degli indirizzi IP.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-220">DSR consists of two parts: a flow topology and an IP address mapping scheme.</span></span> <span data-ttu-id="3ec3d-221">A livello di piattaforma, Azure Load Balancer viene sempre eseguito in una topologia di flussi DSR indipendentemente dal fatto che l'indirizzo IP mobile sia abilitato o meno.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-221">At a platform level, Azure Load Balancer always operates in a DSR flow topology regardless of whether Floating IP is enabled or not.</span></span> <span data-ttu-id="3ec3d-222">Ciò significa che la parte in uscita di un flusso viene sempre correttamente riscritta in un flusso direttamente nell'origine.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-222">This means that the outbound part of a flow is always correctly rewritten to flow directly back to the origin.</span></span>

<span data-ttu-id="3ec3d-223">Con il tipo di regola predefinito, Azure espone uno schema di mappatura degli indirizzi IP tradizionale per il servizio di bilanciamento del carico per semplificarne l'uso.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-223">With the default rule type, Azure exposes a traditional load balancing IP address mapping scheme for ease of use.</span></span> <span data-ttu-id="3ec3d-224">L'abilitazione dell'indirizzo IP mobile modifica lo schema di mappatura degli indirizzi IP per consentire una maggiore flessibilità, come illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-224">Enabling Floating IP changes the IP address mapping scheme to allow for additional flexibility as explained below.</span></span>

<span data-ttu-id="3ec3d-225">Il diagramma seguente illustra questa configurazione:</span><span class="sxs-lookup"><span data-stu-id="3ec3d-225">The following diagram illustrates this configuration:</span></span>

![Illustrazione di più indirizzi VIP](./media/load-balancer-multivip-overview/load-balancer-multivip-dsr.png)

<span data-ttu-id="3ec3d-227">Per questo scenario, ogni macchina virtuale nel pool back-end ha tre interfacce di rete:</span><span class="sxs-lookup"><span data-stu-id="3ec3d-227">For this scenario, every VM in the backend pool has three network interfaces:</span></span>

* <span data-ttu-id="3ec3d-228">DIP: scheda di interfaccia di rete virtuale associata alla macchina virtuale (configurazione IP della risorsa interfaccia di rete di Azure)</span><span class="sxs-lookup"><span data-stu-id="3ec3d-228">DIP: a Virtual NIC associated with the VM (IP configuration of Azure's NIC resource)</span></span>
* <span data-ttu-id="3ec3d-229">VIP1: un'interfaccia di loopback all'interno del sistema operativo guest configurato con l'indirizzo IP di VIP1</span><span class="sxs-lookup"><span data-stu-id="3ec3d-229">VIP1: a loopback interface within guest OS that is configured with IP address of VIP1</span></span>
* <span data-ttu-id="3ec3d-230">VIP2: un'interfaccia di loopback all'interno del sistema operativo guest configurato con l'indirizzo IP di VIP2</span><span class="sxs-lookup"><span data-stu-id="3ec3d-230">VIP2: a loopback interface within guest OS that is configured with IP address of VIP2</span></span>

> [!IMPORTANT]
> <span data-ttu-id="3ec3d-231">La configurazione delle interfacce logiche viene eseguita all'interno del sistema operativo guest.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-231">The configuration of the logical interfaces is performed within the guest OS.</span></span> <span data-ttu-id="3ec3d-232">Questa configurazione non viene eseguita o gestita da Azure.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-232">This configuration is not performed or managed by Azure.</span></span> <span data-ttu-id="3ec3d-233">Senza questa configurazione, le regole non funzionano.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-233">Without this configuration, the rules will not function.</span></span> <span data-ttu-id="3ec3d-234">Le definizioni dei probe di integrità usano il DIP della macchina virtuale anziché l'indirizzo VIP logico.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-234">Health probe definitions use the DIP of the VM rather than the logical VIP.</span></span> <span data-ttu-id="3ec3d-235">Il servizio deve quindi mettere a disposizione le risposte probe su una porta DIP che rifletta lo stato del servizio offerto nell'indirizzo VIP logico.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-235">Therefore, your service must provide probe responses on a DIP port that reflect the status of the service offered on the logical VIP.</span></span>

<span data-ttu-id="3ec3d-236">Si supponga la stessa configurazione front-end dello scenario precedente:</span><span class="sxs-lookup"><span data-stu-id="3ec3d-236">Let's assume the same frontend configuration as in the previous scenario:</span></span>

| <span data-ttu-id="3ec3d-237">Indirizzo VIP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-237">VIP</span></span> | <span data-ttu-id="3ec3d-238">Indirizzo IP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-238">IP address</span></span> | <span data-ttu-id="3ec3d-239">protocol</span><span class="sxs-lookup"><span data-stu-id="3ec3d-239">protocol</span></span> | <span data-ttu-id="3ec3d-240">port</span><span class="sxs-lookup"><span data-stu-id="3ec3d-240">port</span></span> |
| --- | --- | --- | --- |
| ![Indirizzo VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="3ec3d-242">1</span><span class="sxs-lookup"><span data-stu-id="3ec3d-242">1</span></span> |<span data-ttu-id="3ec3d-243">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="3ec3d-243">65.52.0.1</span></span> |<span data-ttu-id="3ec3d-244">TCP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-244">TCP</span></span> |<span data-ttu-id="3ec3d-245">80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-245">80</span></span> |
| ![Indirizzo VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="3ec3d-247">2</span><span class="sxs-lookup"><span data-stu-id="3ec3d-247">2</span></span> |<span data-ttu-id="3ec3d-248">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="3ec3d-248">*65.52.0.2*</span></span> |<span data-ttu-id="3ec3d-249">TCP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-249">TCP</span></span> |<span data-ttu-id="3ec3d-250">80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-250">80</span></span> |

<span data-ttu-id="3ec3d-251">Si definiscono due regole:</span><span class="sxs-lookup"><span data-stu-id="3ec3d-251">We define two rules:</span></span>

| <span data-ttu-id="3ec3d-252">Regola</span><span class="sxs-lookup"><span data-stu-id="3ec3d-252">Rule</span></span> | <span data-ttu-id="3ec3d-253">Mapping frontend</span><span class="sxs-lookup"><span data-stu-id="3ec3d-253">Map frontend</span></span> | <span data-ttu-id="3ec3d-254">Al pool back-end</span><span class="sxs-lookup"><span data-stu-id="3ec3d-254">To backend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="3ec3d-255">1</span><span class="sxs-lookup"><span data-stu-id="3ec3d-255">1</span></span> |![Regola](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="3ec3d-257">VIP1:80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-257">VIP1:80</span></span> |![back-end](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="3ec3d-259">VIP1:80 (in VM1 e VM2)</span><span class="sxs-lookup"><span data-stu-id="3ec3d-259">VIP1:80 (in VM1 and VM2)</span></span> |
| <span data-ttu-id="3ec3d-260">2</span><span class="sxs-lookup"><span data-stu-id="3ec3d-260">2</span></span> |![Regola](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="3ec3d-262">VIP2:80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-262">VIP2:80</span></span> |![back-end](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="3ec3d-264">VIP2:80 (in VM1 e VM2)</span><span class="sxs-lookup"><span data-stu-id="3ec3d-264">VIP2:80 (in VM1 and VM2)</span></span> |

<span data-ttu-id="3ec3d-265">La tabella seguente illustra il mapping completo nel servizio di bilanciamento del carico:</span><span class="sxs-lookup"><span data-stu-id="3ec3d-265">The following table shows the complete mapping in the load balancer:</span></span>

| <span data-ttu-id="3ec3d-266">Regola</span><span class="sxs-lookup"><span data-stu-id="3ec3d-266">Rule</span></span> | <span data-ttu-id="3ec3d-267">Indirizzo IP VIP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-267">VIP IP address</span></span> | <span data-ttu-id="3ec3d-268">protocol</span><span class="sxs-lookup"><span data-stu-id="3ec3d-268">protocol</span></span> | <span data-ttu-id="3ec3d-269">port</span><span class="sxs-lookup"><span data-stu-id="3ec3d-269">port</span></span> | <span data-ttu-id="3ec3d-270">Destination</span><span class="sxs-lookup"><span data-stu-id="3ec3d-270">Destination</span></span> | <span data-ttu-id="3ec3d-271">port</span><span class="sxs-lookup"><span data-stu-id="3ec3d-271">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![Indirizzo VIP](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="3ec3d-273">1</span><span class="sxs-lookup"><span data-stu-id="3ec3d-273">1</span></span> |<span data-ttu-id="3ec3d-274">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="3ec3d-274">65.52.0.1</span></span> |<span data-ttu-id="3ec3d-275">TCP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-275">TCP</span></span> |<span data-ttu-id="3ec3d-276">80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-276">80</span></span> |<span data-ttu-id="3ec3d-277">come indirizzo VIP (65.52.0.1)</span><span class="sxs-lookup"><span data-stu-id="3ec3d-277">same as VIP (65.52.0.1)</span></span> |<span data-ttu-id="3ec3d-278">come indirizzo VIP (80)</span><span class="sxs-lookup"><span data-stu-id="3ec3d-278">same as VIP (80)</span></span> |
| ![Indirizzo VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="3ec3d-280">2</span><span class="sxs-lookup"><span data-stu-id="3ec3d-280">2</span></span> |<span data-ttu-id="3ec3d-281">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="3ec3d-281">65.52.0.2</span></span> |<span data-ttu-id="3ec3d-282">TCP</span><span class="sxs-lookup"><span data-stu-id="3ec3d-282">TCP</span></span> |<span data-ttu-id="3ec3d-283">80</span><span class="sxs-lookup"><span data-stu-id="3ec3d-283">80</span></span> |<span data-ttu-id="3ec3d-284">come indirizzo VIP (65.52.0.2)</span><span class="sxs-lookup"><span data-stu-id="3ec3d-284">same as VIP (65.52.0.2)</span></span> |<span data-ttu-id="3ec3d-285">come indirizzo VIP (80)</span><span class="sxs-lookup"><span data-stu-id="3ec3d-285">same as VIP (80)</span></span> |

<span data-ttu-id="3ec3d-286">La destinazione del flusso in ingresso è l'indirizzo VIP nell'interfaccia di loopback della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-286">The destination of the inbound flow is the VIP address on the loopback interface in the VM.</span></span> <span data-ttu-id="3ec3d-287">Ogni regola deve produrre un flusso con una combinazione univoca di indirizzo IP di destinazione e porta di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-287">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="3ec3d-288">Modificando l'indirizzo IP di destinazione del flusso, è possibile riusare la porta nella stessa macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-288">By varying the destination IP address of the flow, port reuse is possible on the same VM.</span></span> <span data-ttu-id="3ec3d-289">Il servizio viene esposto al servizio di bilanciamento del carico associandolo all'indirizzo IP e alla porta VIP dell'interfaccia di loopback corrispondente.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-289">Your service is exposed to the load balancer by binding it to the VIP’s IP address and port of the respective loopback interface.</span></span>

<span data-ttu-id="3ec3d-290">Si noti che in questo esempio non viene modificata la porta di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-290">Notice that this example does not change the destination port.</span></span> <span data-ttu-id="3ec3d-291">Anche se questo è uno scenario con indirizzo IP mobile, Azure Load Balancer supporta anche la definizione di una regola per la riscrittura della porta di destinazione back-end e per differenziarla dalla porta di destinazione front-end.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-291">Even though this is a Floating IP scenario, Azure Load Balancer also supports defining a rule to rewrite the backend destination port and to make it different from the frontend destination port.</span></span>

<span data-ttu-id="3ec3d-292">Il tipo di regola con indirizzo IP mobile è alla base di diversi modelli di configurazione del servizio di bilanciamento di carico.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-292">The Floating IP rule type is the foundation of several load balancer configuration patterns.</span></span> <span data-ttu-id="3ec3d-293">Un esempio attualmente disponibile è la configurazione [SQL AlwaysOn con più listener](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) .</span><span class="sxs-lookup"><span data-stu-id="3ec3d-293">One example that is currently available is the [SQL AlwaysOn with Multiple Listeners](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) configuration.</span></span> <span data-ttu-id="3ec3d-294">Altri scenari di questo tipo verranno documentati nel tempo.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-294">Over time, we will document more of these scenarios.</span></span>

## <a name="limitations"></a><span data-ttu-id="3ec3d-295">Limitazioni</span><span class="sxs-lookup"><span data-stu-id="3ec3d-295">Limitations</span></span>

* <span data-ttu-id="3ec3d-296">Più configurazioni di indirizzi VIP sono supportate solo con le macchine virtuali IaaS.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-296">Multiple VIP configurations are only supported with IaaS VMs.</span></span>
* <span data-ttu-id="3ec3d-297">Con la regola dell'indirizzo IP mobile, l'applicazione deve usare il DIP per i flussi in uscita.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-297">With the Floating IP rule, your application must use the DIP for outbound flows.</span></span> <span data-ttu-id="3ec3d-298">Se l'applicazione si associa all'indirizzo VIP configurato nell'interfaccia di loopback del sistema operativo guest, SNAT non potrà riscrivere il flusso in uscita e il flusso avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-298">If your application binds to the VIP address configured on the loopback interface in the guest OS, then SNAT is not available to rewrite the outbound flow and the flow fails.</span></span>
* <span data-ttu-id="3ec3d-299">Gli indirizzi IP pubblici hanno un effetto sulla fatturazione.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-299">Public IP addresses have an effect on billing.</span></span> <span data-ttu-id="3ec3d-300">Per altre informazioni, vedere [Prezzi per gli indirizzi IP](https://azure.microsoft.com/pricing/details/ip-addresses/)</span><span class="sxs-lookup"><span data-stu-id="3ec3d-300">For more information, see [IP Address pricing](https://azure.microsoft.com/pricing/details/ip-addresses/)</span></span>
* <span data-ttu-id="3ec3d-301">Si applicano i limiti delle sottoscrizioni.</span><span class="sxs-lookup"><span data-stu-id="3ec3d-301">Subscription limits apply.</span></span> <span data-ttu-id="3ec3d-302">Per altre informazioni, vedere i [limiti del servizio](../azure-subscription-service-limits.md#networking-limits) .</span><span class="sxs-lookup"><span data-stu-id="3ec3d-302">For more information, see [Service limits](../azure-subscription-service-limits.md#networking-limits) for details.</span></span>
