---
title: rinnovo aaaCertificate per gli utenti di Office 365 e Azure AD | Documenti Microsoft
description: Questo articolo illustra gli utenti di 365 tooOffice come tooresolve problemi con messaggi di posta elettronica informarli riguardo rinnovare un certificato.
services: active-directory
documentationcenter: 
author: billmath
manager: femila
editor: curtand
ms.assetid: 543b7dc1-ccc9-407f-85a1-a9944c0ba1be
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: b9b309e06949dc5488cd628650be413f366ed347
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="renew-federation-certificates-for-office-365-and-azure-active-directory"></a><span data-ttu-id="60e2d-103">Rinnovare i certificati di federazione per Office 365 e Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="60e2d-103">Renew federation certificates for Office 365 and Azure Active Directory</span></span>
## <a name="overview"></a><span data-ttu-id="60e2d-104">Panoramica</span><span class="sxs-lookup"><span data-stu-id="60e2d-104">Overview</span></span>
<span data-ttu-id="60e2d-105">Per la federazione tra Azure Active Directory (Azure AD) e Active Directory Federation Services (ADFS) ha esito positivo, i certificati di hello utilizzati da ADFS toosign sicurezza token tooAzure Active Directory devono corrispondere a quello configurato in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="60e2d-105">For successful federation between Azure Active Directory (Azure AD) and Active Directory Federation Services (AD FS), hello certificates used by AD FS toosign security tokens tooAzure AD should match what is configured in Azure AD.</span></span> <span data-ttu-id="60e2d-106">Mancata corrispondenza può causare toobroken trust.</span><span class="sxs-lookup"><span data-stu-id="60e2d-106">Any mismatch can lead toobroken trust.</span></span> <span data-ttu-id="60e2d-107">Azure AD assicura che queste informazioni rimangano sincronizzate durante la distribuzione di AD FS e Proxy applicazione Web (per l'accesso Extranet).</span><span class="sxs-lookup"><span data-stu-id="60e2d-107">Azure AD ensures that this information is kept in sync when you deploy AD FS and Web Application Proxy (for extranet access).</span></span>

<span data-ttu-id="60e2d-108">In questo articolo fornisce informazioni aggiuntive toomanage il token di firma dei certificati e mantenerli sincronizzati con Azure AD, hello seguenti casi:</span><span class="sxs-lookup"><span data-stu-id="60e2d-108">This article provides you additional information toomanage your token signing certificates and keep them in sync with Azure AD, in hello following cases:</span></span>

* <span data-ttu-id="60e2d-109">Non si sta distribuendo hello Proxy applicazione Web e pertanto i metadati della federazione hello non sono disponibili in hello extranet.</span><span class="sxs-lookup"><span data-stu-id="60e2d-109">You are not deploying hello Web Application Proxy, and therefore hello federation metadata is not available in hello extranet.</span></span>
* <span data-ttu-id="60e2d-110">Non si utilizza configurazione predefinita di hello di ADFS per i certificati di firma di token.</span><span class="sxs-lookup"><span data-stu-id="60e2d-110">You are not using hello default configuration of AD FS for token signing certificates.</span></span>
* <span data-ttu-id="60e2d-111">Si usa un provider di identità di terze parti.</span><span class="sxs-lookup"><span data-stu-id="60e2d-111">You are using a third-party identity provider.</span></span>

## <a name="default-configuration-of-ad-fs-for-token-signing-certificates"></a><span data-ttu-id="60e2d-112">Configurazione predefinita di AD FS per i certificati per la firma di token</span><span class="sxs-lookup"><span data-stu-id="60e2d-112">Default configuration of AD FS for token signing certificates</span></span>
<span data-ttu-id="60e2d-113">la firma di token Hello e certificati di decrittografia token vengono in genere certificati autofirmati e sono ideali per un anno.</span><span class="sxs-lookup"><span data-stu-id="60e2d-113">hello token signing and token decrypting certificates are usually self-signed certificates, and are good for one year.</span></span> <span data-ttu-id="60e2d-114">Per impostazione predefinita, AD FS include un processo di rinnovo automatico denominato **AutoCertificateRollover**.</span><span class="sxs-lookup"><span data-stu-id="60e2d-114">By default, AD FS includes an auto-renewal process called **AutoCertificateRollover**.</span></span> <span data-ttu-id="60e2d-115">Se si usa AD FS 2.0 o versione successiva, Office 365 e Azure AD aggiornano automaticamente il certificato prima della scadenza.</span><span class="sxs-lookup"><span data-stu-id="60e2d-115">If you are using AD FS 2.0 or later, Office 365 and Azure AD automatically update your certificate before it expires.</span></span>

### <a name="renewal-notification-from-hello-office-365-portal-or-an-email"></a><span data-ttu-id="60e2d-116">Notifica di rinnovo dal portale di Office 365 hello o un messaggio di posta elettronica</span><span class="sxs-lookup"><span data-stu-id="60e2d-116">Renewal notification from hello Office 365 portal or an email</span></span>
> [!NOTE]
> <span data-ttu-id="60e2d-117">Se si ha ricevuto un messaggio di posta elettronica o una notifica tramite il portale in cui viene richiesto toorenew il certificato per Office, vedere [gestione modifiche tootoken i certificati di firma](#managecerts) toocheck se tootake è necessaria alcuna azione.</span><span class="sxs-lookup"><span data-stu-id="60e2d-117">If you received an email or a portal notification asking you toorenew your certificate for Office, see [Managing changes tootoken signing certificates](#managecerts) toocheck if you need tootake any action.</span></span> <span data-ttu-id="60e2d-118">Microsoft è a conoscenza di un problema di possibili che può portare toonotifications per il rinnovo del certificato viene inviato, anche quando è necessaria alcuna azione.</span><span class="sxs-lookup"><span data-stu-id="60e2d-118">Microsoft is aware of a possible issue that can lead toonotifications for certificate renewal being sent, even when no action is required.</span></span>
>
>

<span data-ttu-id="60e2d-119">Azure AD tenta toomonitor hello i metadati della federazione e token di aggiornamento hello i certificati di firma, come indicato da questi metadati.</span><span class="sxs-lookup"><span data-stu-id="60e2d-119">Azure AD attempts toomonitor hello federation metadata, and update hello token signing certificates as indicated by this metadata.</span></span> <span data-ttu-id="60e2d-120">30 giorni prima della scadenza hello di certificati, la firma dei token hello Azure AD verifica se i nuovi certificati sono disponibili tramite il polling dei metadati di federazione hello.</span><span class="sxs-lookup"><span data-stu-id="60e2d-120">30 days before hello expiration of hello token signing certificates, Azure AD checks if new certificates are available by polling hello federation metadata.</span></span>

* <span data-ttu-id="60e2d-121">Se correttamente possa eseguire il polling dei metadati di federazione hello e recuperare nuovi certificati hello, alcuna notifica tramite posta elettronica o un avviso nel portale di Office 365 hello non è emesso toohello utente.</span><span class="sxs-lookup"><span data-stu-id="60e2d-121">If it can successfully poll hello federation metadata and retrieve hello new certificates, no email notification or warning in hello Office 365 portal is issued toohello user.</span></span>
* <span data-ttu-id="60e2d-122">Se non è possibile recuperare i certificati di firma di token a nuovo hello, sia perché i metadati della federazione hello non sono raggiungibili o non è abilitato il rollover automatico dei certificati, Azure AD rilascia un avviso nel portale di Office 365 hello e notifiche di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="60e2d-122">If it cannot retrieve hello new token signing certificates, either because hello federation metadata is not reachable or automatic certificate rollover is not enabled, Azure AD issues an email notification and a warning in hello Office 365 portal.</span></span>

![Notifica del portale di Office 365](./media/active-directory-aadconnect-o365-certs/notification.png)

> [!IMPORTANT]
> <span data-ttu-id="60e2d-124">Se si utilizza ADFS, continuità aziendale tooensure, verificare che i server dispongano di hello dopo gli aggiornamenti in modo che non si verificano errori di autenticazione per i problemi noti.</span><span class="sxs-lookup"><span data-stu-id="60e2d-124">If you are using AD FS, tooensure business continuity, please verify that your servers have hello following updates so that authentication failures for known issues do not occur.</span></span> <span data-ttu-id="60e2d-125">Si riducono in tal modo i problemi noti relativi al server proxy di AD FS per questo periodo di rinnovo e per quelli futuri:</span><span class="sxs-lookup"><span data-stu-id="60e2d-125">This mitigates known AD FS proxy server issues for this renewal and future renewal periods:</span></span>
>
> <span data-ttu-id="60e2d-126">Server 2012 R2 - [Aggiornamento cumulativo per Windows Server: maggio 2014](http://support.microsoft.com/kb/2955164)</span><span class="sxs-lookup"><span data-stu-id="60e2d-126">Server 2012 R2 - [Windows Server May 2014 rollup](http://support.microsoft.com/kb/2955164)</span></span>
>
> <span data-ttu-id="60e2d-127">Server 2008 R2 and 2012 - [L'autenticazione tramite proxy ha esito negativo in Windows Server 2012 o Windows Server 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span><span class="sxs-lookup"><span data-stu-id="60e2d-127">Server 2008 R2 and 2012 - [Authentication through proxy fails in Windows Server 2012 or Windows 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span></span>
>
>

## <span data-ttu-id="60e2d-128">Controllare se i certificati di hello toobe aggiornato<a name="managecerts"></a></span><span class="sxs-lookup"><span data-stu-id="60e2d-128">Check if hello certificates need toobe updated <a name="managecerts"></a></span></span>
### <a name="step-1-check-hello-autocertificaterollover-state"></a><span data-ttu-id="60e2d-129">Passaggio 1: Controllare lo stato AutoCertificateRollover hello</span><span class="sxs-lookup"><span data-stu-id="60e2d-129">Step 1: Check hello AutoCertificateRollover state</span></span>
<span data-ttu-id="60e2d-130">Nel server AD FS aprire Powershell.</span><span class="sxs-lookup"><span data-stu-id="60e2d-130">On your AD FS server, open PowerShell.</span></span> <span data-ttu-id="60e2d-131">Verificare che il valore di AutoCertificateRollover hello è impostato tooTrue.</span><span class="sxs-lookup"><span data-stu-id="60e2d-131">Check that hello AutoCertificateRollover value is set tooTrue.</span></span>

    Get-Adfsproperties

![AutoCertificateRollover](./media/active-directory-aadconnect-o365-certs/autocertrollover.png)

>[!NOTE] 
><span data-ttu-id="60e2d-133">Se si usa AD FS 2.0, eseguire prima Add-Pssnapin Microsoft.Adfs.Powershell.</span><span class="sxs-lookup"><span data-stu-id="60e2d-133">If you are using AD FS 2.0, first run Add-Pssnapin Microsoft.Adfs.Powershell.</span></span>

### <a name="step-2-confirm-that-ad-fs-and-azure-ad-are-in-sync"></a><span data-ttu-id="60e2d-134">Passaggio 2: Verificare che AD FS e Azure AD siano sincronizzati</span><span class="sxs-lookup"><span data-stu-id="60e2d-134">Step 2: Confirm that AD FS and Azure AD are in sync</span></span>
<span data-ttu-id="60e2d-135">Nel server AD FS, aprire il prompt di Azure AD PowerShell hello e connettersi tooAzure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="60e2d-135">On your AD FS server, open hello Azure AD PowerShell prompt, and connect tooAzure AD.</span></span>

> [!NOTE]
> <span data-ttu-id="60e2d-136">È possibile scaricare Azure AD PowerShell [qui](https://technet.microsoft.com/library/jj151815.aspx).</span><span class="sxs-lookup"><span data-stu-id="60e2d-136">You can download Azure AD PowerShell [here](https://technet.microsoft.com/library/jj151815.aspx).</span></span>
>
>

    Connect-MsolService

<span data-ttu-id="60e2d-137">Verificare i certificati di hello configurate in ADFS e le proprietà di attendibilità di Azure AD per hello dominio specificavano.</span><span class="sxs-lookup"><span data-stu-id="60e2d-137">Check hello certificates configured in AD FS and Azure AD trust properties for hello specified domain.</span></span>

    Get-MsolFederationProperty -DomainName <domain.name> | FL Source, TokenSigningCertificate

![Get-MsolFederationProperty](./media/active-directory-aadconnect-o365-certs/certsync.png)

<span data-ttu-id="60e2d-139">Se le identificazioni personali hello in entrambi gli output di hello corrispondenza, i certificati siano sincronizzati con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="60e2d-139">If hello thumbprints in both hello outputs match, your certificates are in sync with Azure AD.</span></span>

### <a name="step-3-check-if-your-certificate-is-about-tooexpire"></a><span data-ttu-id="60e2d-140">Passaggio 3: Verificare se il certificato è su tooexpire</span><span class="sxs-lookup"><span data-stu-id="60e2d-140">Step 3: Check if your certificate is about tooexpire</span></span>
<span data-ttu-id="60e2d-141">Nell'output di Get-MsolFederationProperty o Get-AdfsCertificate hello verificare data hello in "Non dopo."</span><span class="sxs-lookup"><span data-stu-id="60e2d-141">In hello output of either Get-MsolFederationProperty or Get-AdfsCertificate, check for hello date under "Not After."</span></span> <span data-ttu-id="60e2d-142">Se data hello è inferiore a 30 giorni, è necessario eseguire l'operazione.</span><span class="sxs-lookup"><span data-stu-id="60e2d-142">If hello date is less than 30 days away, you should take action.</span></span>

| <span data-ttu-id="60e2d-143">AutoCertificateRollover</span><span class="sxs-lookup"><span data-stu-id="60e2d-143">AutoCertificateRollover</span></span> | <span data-ttu-id="60e2d-144">Certificati sincronizzati con Azure AD</span><span class="sxs-lookup"><span data-stu-id="60e2d-144">Certificates in sync with Azure AD</span></span> | <span data-ttu-id="60e2d-145">I metadati della federazione sono accessibili pubblicamente</span><span class="sxs-lookup"><span data-stu-id="60e2d-145">Federation metadata is publicly accessible</span></span> | <span data-ttu-id="60e2d-146">Validità</span><span class="sxs-lookup"><span data-stu-id="60e2d-146">Validity</span></span> | <span data-ttu-id="60e2d-147">Azione</span><span class="sxs-lookup"><span data-stu-id="60e2d-147">Action</span></span> |
|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="60e2d-148">Sì</span><span class="sxs-lookup"><span data-stu-id="60e2d-148">Yes</span></span> |<span data-ttu-id="60e2d-149">Sì</span><span class="sxs-lookup"><span data-stu-id="60e2d-149">Yes</span></span> |<span data-ttu-id="60e2d-150">Sì</span><span class="sxs-lookup"><span data-stu-id="60e2d-150">Yes</span></span> |- |<span data-ttu-id="60e2d-151">Non è richiesta alcuna azione.</span><span class="sxs-lookup"><span data-stu-id="60e2d-151">No action needed.</span></span> <span data-ttu-id="60e2d-152">Vedere [Rinnovare automaticamente il certificato per la firma di token](#autorenew).</span><span class="sxs-lookup"><span data-stu-id="60e2d-152">See [Renew token signing certificate automatically](#autorenew).</span></span> |
| <span data-ttu-id="60e2d-153">Sì</span><span class="sxs-lookup"><span data-stu-id="60e2d-153">Yes</span></span> |<span data-ttu-id="60e2d-154">No</span><span class="sxs-lookup"><span data-stu-id="60e2d-154">No</span></span> |- |<span data-ttu-id="60e2d-155">Meno di 15 giorni</span><span class="sxs-lookup"><span data-stu-id="60e2d-155">Less than 15 days</span></span> |<span data-ttu-id="60e2d-156">Rinnovare immediatamente.</span><span class="sxs-lookup"><span data-stu-id="60e2d-156">Renew immediately.</span></span> <span data-ttu-id="60e2d-157">Vedere [Rinnovare manualmente il certificato per la firma di token](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="60e2d-157">See [Renew token signing certificate manually](#manualrenew).</span></span> |
| <span data-ttu-id="60e2d-158">No</span><span class="sxs-lookup"><span data-stu-id="60e2d-158">No</span></span> |- |- |<span data-ttu-id="60e2d-159">Meno di 30 giorni</span><span class="sxs-lookup"><span data-stu-id="60e2d-159">Less than 30 days</span></span> |<span data-ttu-id="60e2d-160">Rinnovare immediatamente.</span><span class="sxs-lookup"><span data-stu-id="60e2d-160">Renew immediately.</span></span> <span data-ttu-id="60e2d-161">Vedere [Rinnovare manualmente il certificato per la firma di token](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="60e2d-161">See [Renew token signing certificate manually](#manualrenew).</span></span> |

<span data-ttu-id="60e2d-162">\[-] Non è rilevante</span><span class="sxs-lookup"><span data-stu-id="60e2d-162">\[-]  Does not matter</span></span>

## <span data-ttu-id="60e2d-163">Rinnovare il token hello automaticamente il certificato di firma (scelta consigliata)<a name="autorenew"></a></span><span class="sxs-lookup"><span data-stu-id="60e2d-163">Renew hello token signing certificate automatically (recommended) <a name="autorenew"></a></span></span>
<span data-ttu-id="60e2d-164">Non è necessario tooperform operazioni manuali se entrambe operazioni hello seguenti sono vere:</span><span class="sxs-lookup"><span data-stu-id="60e2d-164">You don't need tooperform any manual steps if both of hello following are true:</span></span>

* <span data-ttu-id="60e2d-165">È stato distribuito il Proxy applicazione Web, che consente di accedere ai metadati di federazione toohello da hello extranet.</span><span class="sxs-lookup"><span data-stu-id="60e2d-165">You have deployed Web Application Proxy, which can enable access toohello federation metadata from hello extranet.</span></span>
* <span data-ttu-id="60e2d-166">Si sta utilizzando una configurazione predefinita di hello ADFS (AutoCertificateRollover è abilitato).</span><span class="sxs-lookup"><span data-stu-id="60e2d-166">You are using hello AD FS default configuration (AutoCertificateRollover is enabled).</span></span>

<span data-ttu-id="60e2d-167">Controllare hello seguente tooconfirm che hello certificato può essere aggiornato automaticamente.</span><span class="sxs-lookup"><span data-stu-id="60e2d-167">Check hello following tooconfirm that hello certificate can be automatically updated.</span></span>

<span data-ttu-id="60e2d-168">**1. hello proprietà ADFS AutoCertificateRollover deve essere impostato tooTrue.**</span><span class="sxs-lookup"><span data-stu-id="60e2d-168">**1. hello AD FS property AutoCertificateRollover must be set tooTrue.**</span></span> <span data-ttu-id="60e2d-169">Indica che ADFS genererà automaticamente nuova firma di token e i certificati di decrittografia dei token, prima di quelli scadenza hello precedente.</span><span class="sxs-lookup"><span data-stu-id="60e2d-169">This indicates that AD FS will automatically generate new token signing and token decryption certificates, before hello old ones expire.</span></span>

<span data-ttu-id="60e2d-170">**2. i metadati della federazione hello AD FS sono accessibili pubblicamente.**</span><span class="sxs-lookup"><span data-stu-id="60e2d-170">**2. hello AD FS federation metadata is publicly accessible.**</span></span> <span data-ttu-id="60e2d-171">Verificare che i metadati di federazione siano accessibili pubblicamente passando toohello URL seguente da un computer hello internet pubblico (all'esterno delle rete aziendale hello):</span><span class="sxs-lookup"><span data-stu-id="60e2d-171">Check that your federation metadata is publicly accessible by navigating toohello following URL from a computer on hello public internet (off of hello corporate network):</span></span>

<span data-ttu-id="60e2d-172">https://(your_FS_name)/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="60e2d-172">https://(your_FS_name)/federationmetadata/2007-06/federationmetadata.xml</span></span>

<span data-ttu-id="60e2d-173">dove `(your_FS_name) `viene sostituito con nome host del servizio federativo hello l'organizzazione utilizza, ad esempio fs.contoso.com.  Se si è in grado di tooverify di queste impostazioni correttamente, non è toodo qualsiasi altro elemento.</span><span class="sxs-lookup"><span data-stu-id="60e2d-173">where `(your_FS_name) `is replaced with hello federation service host name your organization uses, such as fs.contoso.com.  If you are able tooverify both of these settings successfully, you do not have toodo anything else.</span></span>  

<span data-ttu-id="60e2d-174">Esempio: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="60e2d-174">Example: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span></span>

## <span data-ttu-id="60e2d-175">Rinnovare il token hello manualmente il certificato di firma<a name="manualrenew"></a></span><span class="sxs-lookup"><span data-stu-id="60e2d-175">Renew hello token signing certificate manually <a name="manualrenew"></a></span></span>
<span data-ttu-id="60e2d-176">È possibile scegliere toorenew certificati di firma del token hello manualmente.</span><span class="sxs-lookup"><span data-stu-id="60e2d-176">You may choose toorenew hello token signing certificates manually.</span></span> <span data-ttu-id="60e2d-177">Ad esempio, hello negli scenari seguenti potrebbero funzionare meglio per il rinnovo manuale:</span><span class="sxs-lookup"><span data-stu-id="60e2d-177">For example, hello following scenarios might work better for manual renewal:</span></span>

* <span data-ttu-id="60e2d-178">I certificati per la firma di token non sono certificati autofirmati.</span><span class="sxs-lookup"><span data-stu-id="60e2d-178">Token signing certificates are not self-signed certificates.</span></span> <span data-ttu-id="60e2d-179">Hello più comune motivo è che l'organizzazione gestisce i certificati di ADFS registrati da un'autorità di certificazione dell'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="60e2d-179">hello most common reason for this is that your organization manages AD FS certificates enrolled from an organizational certificate authority.</span></span>
* <span data-ttu-id="60e2d-180">Sicurezza di rete non hello toobe metadati di federazione disponibili pubblicamente.</span><span class="sxs-lookup"><span data-stu-id="60e2d-180">Network security does not allow hello federation metadata toobe publicly available.</span></span>

<span data-ttu-id="60e2d-181">In questi scenari, ogni volta che si aggiorna il token hello firma dei certificati, è necessario aggiornare anche il dominio di Office 365 tramite comando PowerShell hello, Update-MsolFederatedDomain.</span><span class="sxs-lookup"><span data-stu-id="60e2d-181">In these scenarios, every time you update hello token signing certificates, you must also update your Office 365 domain by using hello PowerShell command, Update-MsolFederatedDomain.</span></span>

### <a name="step-1-ensure-that-ad-fs-has-new-token-signing-certificates"></a><span data-ttu-id="60e2d-182">Passaggio 1: Verificare che in ADFS siamo disponibili nuovi certificati per la firma di token</span><span class="sxs-lookup"><span data-stu-id="60e2d-182">Step 1: Ensure that AD FS has new token signing certificates</span></span>
<span data-ttu-id="60e2d-183">**Configurazione non predefinita**</span><span class="sxs-lookup"><span data-stu-id="60e2d-183">**Non-default configuration**</span></span>

<span data-ttu-id="60e2d-184">Se si utilizza una configurazione non predefinita di ADFS (in cui **AutoCertificateRollover** è troppo**False**), probabilmente si utilizza i certificati personalizzati (autofirmati).</span><span class="sxs-lookup"><span data-stu-id="60e2d-184">If you are using a non-default configuration of AD FS (where **AutoCertificateRollover** is set too**False**), you are probably using custom certificates (not self-signed).</span></span> <span data-ttu-id="60e2d-185">Per ulteriori informazioni sull'utilizzo dei certificati toorenew hello AD FS la firma di token, vedere [linee guida per i clienti che non usano ADFS i certificati autofirmati](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span><span class="sxs-lookup"><span data-stu-id="60e2d-185">For more information about how toorenew hello AD FS token signing certificates, see [Guidance for customers not using AD FS self-signed certificates](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span></span>

<span data-ttu-id="60e2d-186">**I metadati della federazione non sono disponibili pubblicamente**</span><span class="sxs-lookup"><span data-stu-id="60e2d-186">**Federation metadata is not publicly available**</span></span>

<span data-ttu-id="60e2d-187">Hello d'altro canto, se **AutoCertificateRollover** è troppo**True**, ma i metadati di federazione non sono accessibili pubblicamente, assicurarsi innanzitutto che i nuovi certificati di firma di token sono stati generati da Active Directory ADFS.</span><span class="sxs-lookup"><span data-stu-id="60e2d-187">On hello other hand, if **AutoCertificateRollover** is set too**True**, but your federation metadata is not publicly accessible, first make sure that new token signing certificates have been generated by AD FS.</span></span> <span data-ttu-id="60e2d-188">Verificare di che avere nuovo token di firma dei certificati da hello richiede alla procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="60e2d-188">Confirm you have new token signing certificates by taking hello following steps:</span></span>

1. <span data-ttu-id="60e2d-189">Verificare che si è connessi nel server di toohello primaria AD FS.</span><span class="sxs-lookup"><span data-stu-id="60e2d-189">Verify that you are logged on toohello primary AD FS server.</span></span>
2. <span data-ttu-id="60e2d-190">Verificare i certificati di firma correnti hello in AD FS aprendo una finestra di comando di PowerShell ed eseguendo hello comando seguente:</span><span class="sxs-lookup"><span data-stu-id="60e2d-190">Check hello current signing certificates in AD FS by opening a PowerShell command window, and running hello following command:</span></span>

    <span data-ttu-id="60e2d-191">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span><span class="sxs-lookup"><span data-stu-id="60e2d-191">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

   > [!NOTE]
   > <span data-ttu-id="60e2d-192">Se si usa AD FS 2.0, è consigliabile eseguire prima Add-Pssnapin Microsoft.Adfs.Powershell.</span><span class="sxs-lookup"><span data-stu-id="60e2d-192">If you are using AD FS 2.0, you should run Add-Pssnapin Microsoft.Adfs.Powershell first.</span></span>
   >
   >
3. <span data-ttu-id="60e2d-193">Esaminare l'output del comando hello in tutti i certificati elencati.</span><span class="sxs-lookup"><span data-stu-id="60e2d-193">Look at hello command output at any certificates listed.</span></span> <span data-ttu-id="60e2d-194">Se ADFS è stato generato un nuovo certificato, verrà visualizzato nell'output di hello due certificati: uno per i quali hello **IsPrimary** valore **True** hello e **NotAfter** Data all'interno di 5 giorni e quella per cui **IsPrimary** è **False** e **NotAfter** riguarda un anno in hello future.</span><span class="sxs-lookup"><span data-stu-id="60e2d-194">If AD FS has generated a new certificate, you should see two certificates in hello output: one for which hello **IsPrimary** value is **True** and hello **NotAfter** date is within 5 days, and one for which **IsPrimary** is **False** and **NotAfter** is about a year in hello future.</span></span>
4. <span data-ttu-id="60e2d-195">Se solo un certificato e hello **NotAfter** data è entro 5 giorni, è necessario toogenerate un nuovo certificato.</span><span class="sxs-lookup"><span data-stu-id="60e2d-195">If you only see one certificate, and hello **NotAfter** date is within 5 days, you need toogenerate a new certificate.</span></span>
5. <span data-ttu-id="60e2d-196">toogenerate un nuovo certificato, eseguire hello comando al prompt dei comandi di PowerShell seguente: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span><span class="sxs-lookup"><span data-stu-id="60e2d-196">toogenerate a new certificate, execute hello following command at a PowerShell command prompt: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span></span>
6. <span data-ttu-id="60e2d-197">Verificare l'aggiornamento hello eseguendo hello comando seguente nuovamente: c: PS\>Get-ADFSCertificate – CertificateType-la firma di token</span><span class="sxs-lookup"><span data-stu-id="60e2d-197">Verify hello update by running hello following command again: PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

<span data-ttu-id="60e2d-198">Dovrebbero essere elencati due certificati, uno dei quali ha un **NotAfter** data di circa un anno nel futuro hello e quali hello **IsPrimary** valore **False**.</span><span class="sxs-lookup"><span data-stu-id="60e2d-198">Two certificates should be listed now, one of which has a **NotAfter** date of approximately one year in hello future, and for which hello **IsPrimary** value is **False**.</span></span>

### <a name="step-2-update-hello-new-token-signing-certificates-for-hello-office-365-trust"></a><span data-ttu-id="60e2d-199">Passaggio 2: Aggiornare nuovo token hello firma dei certificati per l'attendibilità hello Office 365</span><span class="sxs-lookup"><span data-stu-id="60e2d-199">Step 2: Update hello new token signing certificates for hello Office 365 trust</span></span>
<span data-ttu-id="60e2d-200">Aggiornamento di Office 365 con hello nuovi token firma i certificati toobe utilizzato per l'attendibilità di hello, come indicato di seguito.</span><span class="sxs-lookup"><span data-stu-id="60e2d-200">Update Office 365 with hello new token signing certificates toobe used for hello trust, as follows.</span></span>

1. <span data-ttu-id="60e2d-201">Aprire hello modulo dei Microsoft Azure Active Directory per Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="60e2d-201">Open hello Microsoft Azure Active Directory Module for Windows PowerShell.</span></span>
2. <span data-ttu-id="60e2d-202">Eseguire $cred=Get-Credential.</span><span class="sxs-lookup"><span data-stu-id="60e2d-202">Run $cred=Get-Credential.</span></span> <span data-ttu-id="60e2d-203">Quando questo cmdlet richiede le credenziali, digitare le credenziali dell'account amministratore servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="60e2d-203">When this cmdlet prompts you for credentials, type your cloud service administrator account credentials.</span></span>
3. <span data-ttu-id="60e2d-204">Eseguire Connect-MsolService –Credential $cred. Questo cmdlet si connette il servizio di cloud toohello.</span><span class="sxs-lookup"><span data-stu-id="60e2d-204">Run Connect-MsolService –Credential $cred. This cmdlet connects you toohello cloud service.</span></span> <span data-ttu-id="60e2d-205">Creazione di un contesto che consente la connessione del servizio cloud toohello è necessario prima di eseguire uno dei cmdlet di hello aggiuntivi installati dallo strumento hello.</span><span class="sxs-lookup"><span data-stu-id="60e2d-205">Creating a context that connects you toohello cloud service is required before running any of hello additional cmdlets installed by hello tool.</span></span>
4. <span data-ttu-id="60e2d-206">Se si eseguono questi comandi in un computer che non è un server federativo primario hello ADFS, eseguire Set-MSOLAdfscontext-Computer <AD FS primary server>, dove <AD FS primary server> è nome FQDN interno hello del server di hello primario AD FS.</span><span class="sxs-lookup"><span data-stu-id="60e2d-206">If you are running these commands on a computer that is not hello AD FS primary federation server, run Set-MSOLAdfscontext -Computer <AD FS primary server>, where <AD FS primary server> is hello internal FQDN name of hello primary AD FS server.</span></span> <span data-ttu-id="60e2d-207">Questo cmdlet crea un contesto che consente di connettersi tooAD ADFS.</span><span class="sxs-lookup"><span data-stu-id="60e2d-207">This cmdlet creates a context that connects you tooAD FS.</span></span>
5. <span data-ttu-id="60e2d-208">Eseguire Update-MSOLFederatedDomain –DomainName <domain>.</span><span class="sxs-lookup"><span data-stu-id="60e2d-208">Run Update-MSOLFederatedDomain –DomainName <domain>.</span></span> <span data-ttu-id="60e2d-209">Questo cmdlet Aggiorna le impostazioni di hello da ADFS nel servizio cloud hello e configura hello relazione di trust tra due hello.</span><span class="sxs-lookup"><span data-stu-id="60e2d-209">This cmdlet updates hello settings from AD FS into hello cloud service, and configures hello trust relationship between hello two.</span></span>

> [!NOTE]
> <span data-ttu-id="60e2d-210">Se è necessario toosupport più domini di primo livello, ad esempio contoso.com e fabrikam.com, è necessario utilizzare hello **SupportMultipleDomain** con qualsiasi cmdlet.</span><span class="sxs-lookup"><span data-stu-id="60e2d-210">If you need toosupport multiple top-level domains, such as contoso.com and fabrikam.com, you must use hello **SupportMultipleDomain** switch with any cmdlets.</span></span> <span data-ttu-id="60e2d-211">Per altre informazioni, vedere [Supporto di più domini per la federazione con Azure AD](active-directory-aadconnect-multiple-domains.md).</span><span class="sxs-lookup"><span data-stu-id="60e2d-211">For more information, see [Support for Multiple Top Level Domains](active-directory-aadconnect-multiple-domains.md).</span></span>
>
>

## <span data-ttu-id="60e2d-212">Ripristinare il trust di Azure AD con AD Connect <a name="connectrenew"></a></span><span class="sxs-lookup"><span data-stu-id="60e2d-212">Repair Azure AD trust by using Azure AD Connect <a name="connectrenew"></a></span></span>
<span data-ttu-id="60e2d-213">Se è configurata la farm di ADFS e trust di Azure AD mediante Azure AD Connect, è possibile utilizzare Azure AD Connect toodetect se è necessario tootake alcuna azione per il token di firma dei certificati.</span><span class="sxs-lookup"><span data-stu-id="60e2d-213">If you configured your AD FS farm and Azure AD trust by using Azure AD Connect, you can use Azure AD Connect toodetect if you need tootake any action for your token signing certificates.</span></span> <span data-ttu-id="60e2d-214">Se sono necessari i certificati di hello toorenew, è possibile utilizzare così toodo di Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="60e2d-214">If you need toorenew hello certificates, you can use Azure AD Connect toodo so.</span></span>

<span data-ttu-id="60e2d-215">Per ulteriori informazioni, vedere [ripristino trust hello](active-directory-aadconnect-federation-management.md).</span><span class="sxs-lookup"><span data-stu-id="60e2d-215">For more information, see [Repairing hello trust](active-directory-aadconnect-federation-management.md).</span></span>
