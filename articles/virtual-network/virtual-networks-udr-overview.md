---
title: le route definite aaaUser e l'inoltro IP in Azure | Documenti Microsoft
description: Informazioni su come le route definite dall'utente tooconfigure (UDR) e l'inoltro IP tooforward traffico toonetwork Appliance virtuali in Azure.
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: c39076c4-11b7-4b46-a904-817503c4b486
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/15/2016
ms.author: jdial
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f1f1d46166d5a7c776f472b7ade1354d943ece10
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="user-defined-routes-and-ip-forwarding"></a><span data-ttu-id="15caf-103">Route definite dall'utente e inoltro IP</span><span class="sxs-lookup"><span data-stu-id="15caf-103">User-defined routes and IP forwarding</span></span>

<span data-ttu-id="15caf-104">Quando si aggiunta macchine virtuali (VM) tooa rete virtuale (VNet) in Azure, si noterà che le macchine virtuali hello siano in grado di toocommunicate tra loro attraverso la rete hello, automaticamente.</span><span class="sxs-lookup"><span data-stu-id="15caf-104">When you add virtual machines (VMs) tooa virtual network (VNet) in Azure, you will notice that hello VMs are able toocommunicate with each other over hello network, automatically.</span></span> <span data-ttu-id="15caf-105">Non è necessario un gateway, toospecify anche se hello macchine virtuali presenti in subnet diverse.</span><span class="sxs-lookup"><span data-stu-id="15caf-105">You do not need toospecify a gateway, even though hello VMs are in different subnets.</span></span> <span data-ttu-id="15caf-106">Hello lo stesso vale per la comunicazione da hello macchine virtuali toohello rete Internet pubblica e rete locale di tooyour anche quando una connessione ibrida da Azure tooyour proprietario Data Center è presente.</span><span class="sxs-lookup"><span data-stu-id="15caf-106">hello same is true for communication from hello VMs toohello public Internet, and even tooyour on-premises network when a hybrid connection from Azure tooyour own datacenter is present.</span></span>

<span data-ttu-id="15caf-107">Questo flusso di comunicazione è possibile poiché Azure Usa una serie di sistema route toodefine come flussi di traffico IP.</span><span class="sxs-lookup"><span data-stu-id="15caf-107">This flow of communication is possible because Azure uses a series of system routes toodefine how IP traffic flows.</span></span> <span data-ttu-id="15caf-108">Route di sistema di controllare il flusso di hello di comunicazione in hello seguenti scenari:</span><span class="sxs-lookup"><span data-stu-id="15caf-108">System routes control hello flow of communication in hello following scenarios:</span></span>

* <span data-ttu-id="15caf-109">Dall'interno hello stessa subnet.</span><span class="sxs-lookup"><span data-stu-id="15caf-109">From within hello same subnet.</span></span>
* <span data-ttu-id="15caf-110">Da un tooanother subnet all'interno di una rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="15caf-110">From a subnet tooanother within a VNet.</span></span>
* <span data-ttu-id="15caf-111">Da macchine virtuali toohello Internet.</span><span class="sxs-lookup"><span data-stu-id="15caf-111">From VMs toohello Internet.</span></span>
* <span data-ttu-id="15caf-112">Da una rete virtuale tooanother rete virtuale tramite un gateway VPN.</span><span class="sxs-lookup"><span data-stu-id="15caf-112">From a VNet tooanother VNet through a VPN gateway.</span></span>
* <span data-ttu-id="15caf-113">Da una rete virtuale tooanother rete virtuale tramite il Peering di reti virtuali (concatenamento di servizio).</span><span class="sxs-lookup"><span data-stu-id="15caf-113">From a VNet tooanother VNet through VNet Peering (Service Chaining).</span></span>
* <span data-ttu-id="15caf-114">Da una rete virtuale tooyour rete locale tramite un gateway VPN.</span><span class="sxs-lookup"><span data-stu-id="15caf-114">From a VNet tooyour on-premises network through a VPN gateway.</span></span>

<span data-ttu-id="15caf-115">Hello riportato di seguito è illustrata un'installazione semplice con una rete virtuale, due subnet e alcune macchine virtuali, insieme a hello route di sistema che consentono di tooflow traffico IP.</span><span class="sxs-lookup"><span data-stu-id="15caf-115">hello figure below shows a simple setup with a VNet, two subnets, and a few VMs, along with hello system routes that allow IP traffic tooflow.</span></span>

![Route di sistema in Azure](./media/virtual-networks-udr-overview/Figure1.png)

<span data-ttu-id="15caf-117">Sebbene l'utilizzo di hello delle route di sistema facilita traffico automaticamente per la distribuzione, vi sono casi in cui si desidera toocontrol hello routing dei pacchetti tramite un dispositivo virtuale.</span><span class="sxs-lookup"><span data-stu-id="15caf-117">Although hello use of system routes facilitates traffic automatically for your deployment, there are cases in which you want toocontrol hello routing of packets through a virtual appliance.</span></span> <span data-ttu-id="15caf-118">È possibile pertanto mediante la creazione di route definite dall'utente che specificare dell'hop successivo per i pacchetti di propagazione appliance virtuale tooyour toogo subnet specifica tooa invece hello, e attivazione di indirizzi IP per l'inoltro hello macchina virtuale in esecuzione come appliance virtuale hello.</span><span class="sxs-lookup"><span data-stu-id="15caf-118">You can do so by creating user defined routes that specify hello next hop for packets flowing tooa specific subnet toogo tooyour virtual appliance instead, and enabling IP forwarding for hello VM running as hello virtual appliance.</span></span>

<span data-ttu-id="15caf-119">Hello figura seguente mostra un esempio di route definite dall'utente e inoltro tooforce pacchetti IP inviati tooone subnet da un altro toogo tramite un dispositivo virtuale su una subnet terzo.</span><span class="sxs-lookup"><span data-stu-id="15caf-119">hello figure below shows an example of user defined routes and IP forwarding tooforce packets sent tooone subnet from another toogo through a virtual appliance on a third subnet.</span></span>

![Route di sistema in Azure](./media/virtual-networks-udr-overview/Figure2.png)

> [!IMPORTANT]
> <span data-ttu-id="15caf-121">Le route definite dall'utente vengono applicati tootraffic lasciando una subnet provenienti da qualunque risorsa (ad esempio le interfacce di rete collegati tooVMs) in subnet hello.</span><span class="sxs-lookup"><span data-stu-id="15caf-121">User-defined routes are applied tootraffic leaving a subnet from any resource (such as network interfaces attached tooVMs) in hello subnet.</span></span> <span data-ttu-id="15caf-122">Non è possibile creare route toospecify come il traffico passa una subnet da hello Internet, per l'istanza.</span><span class="sxs-lookup"><span data-stu-id="15caf-122">You cannot create routes toospecify how traffic enters a subnet from hello Internet, for instance.</span></span> <span data-ttu-id="15caf-123">dispositivo di Hello che si desidera inoltrare il traffico toocannot trovarsi in hello stessa subnet in cui ha origine il traffico di hello.</span><span class="sxs-lookup"><span data-stu-id="15caf-123">hello appliance you are forwarding traffic toocannot be in hello same subnet where hello traffic originates.</span></span> <span data-ttu-id="15caf-124">Creare sempre una subnet separata per i dispositivi.</span><span class="sxs-lookup"><span data-stu-id="15caf-124">Always create a separate subnet for your appliances.</span></span> 
> 
> 

## <a name="route-resource"></a><span data-ttu-id="15caf-125">Risorsa di route</span><span class="sxs-lookup"><span data-stu-id="15caf-125">Route resource</span></span>
<span data-ttu-id="15caf-126">I pacchetti vengono instradati in una rete TCP/IP in base a una tabella di route definita in ogni nodo nella rete fisica hello.</span><span class="sxs-lookup"><span data-stu-id="15caf-126">Packets are routed over a TCP/IP network based on a route table defined at each node on hello physical network.</span></span> <span data-ttu-id="15caf-127">Una tabella di routing è che un insieme di route singoli utilizzato toodecide in pacchetti tooforward basato su destinazione hello indirizzo IP.</span><span class="sxs-lookup"><span data-stu-id="15caf-127">A route table is a collection of individual routes used toodecide where tooforward packets based on hello destination IP address.</span></span> <span data-ttu-id="15caf-128">Una route è costituita dai seguenti hello:</span><span class="sxs-lookup"><span data-stu-id="15caf-128">A route consists of hello following:</span></span>

| <span data-ttu-id="15caf-129">Proprietà</span><span class="sxs-lookup"><span data-stu-id="15caf-129">Property</span></span> | <span data-ttu-id="15caf-130">Descrizione</span><span class="sxs-lookup"><span data-stu-id="15caf-130">Description</span></span> | <span data-ttu-id="15caf-131">Vincoli</span><span class="sxs-lookup"><span data-stu-id="15caf-131">Constraints</span></span> | <span data-ttu-id="15caf-132">Considerazioni</span><span class="sxs-lookup"><span data-stu-id="15caf-132">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="15caf-133">Prefisso indirizzo</span><span class="sxs-lookup"><span data-stu-id="15caf-133">Address Prefix</span></span> |<span data-ttu-id="15caf-134">si applica la route hello Hello destinazione CIDR toowhich, ad esempio 10.1.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="15caf-134">hello destination CIDR toowhich hello route applies, such as 10.1.0.0/16.</span></span> |<span data-ttu-id="15caf-135">Deve essere un intervallo CIDR valido che rappresenta gli indirizzi di hello rete Internet pubblica, rete virtuale di Azure o Data Center locale.</span><span class="sxs-lookup"><span data-stu-id="15caf-135">Must be a valid CIDR range representing addresses on hello public Internet, Azure virtual network, or on-premises datacenter.</span></span> |<span data-ttu-id="15caf-136">Verificare che hello **prefisso dell'indirizzo** non contiene alcun indirizzo hello hello **indirizzo hop successivo**, in caso contrario i pacchetti verranno immesso in un ciclo dal hop successivo di hello origine toohello senza mai raggiungere destinazione Hello.</span><span class="sxs-lookup"><span data-stu-id="15caf-136">Make sure hello **Address prefix** does not contain hello address for hello **Next hop address**, otherwise your packets will enter in a loop going from hello source toohello next hop without ever reaching hello destination.</span></span> |
| <span data-ttu-id="15caf-137">Tipo hop successivo</span><span class="sxs-lookup"><span data-stu-id="15caf-137">Next hop type</span></span> |<span data-ttu-id="15caf-138">tipo di Hello del pacchetto di hello hop di Azure deve essere inviato.</span><span class="sxs-lookup"><span data-stu-id="15caf-138">hello type of Azure hop hello packet should be sent to.</span></span> |<span data-ttu-id="15caf-139">Deve essere uno dei seguenti valori hello:</span><span class="sxs-lookup"><span data-stu-id="15caf-139">Must be one of hello following values:</span></span> <br/> <span data-ttu-id="15caf-140">**Rete virtuale**.</span><span class="sxs-lookup"><span data-stu-id="15caf-140">**Virtual Network**.</span></span> <span data-ttu-id="15caf-141">Rappresenta una rete virtuale locale hello.</span><span class="sxs-lookup"><span data-stu-id="15caf-141">Represents hello local virtual network.</span></span> <span data-ttu-id="15caf-142">Ad esempio, se si dispone di due subnet, 10.1.0.0/16 e 10.2.0.0/16 nella stessa rete virtuale di hello, route hello per ogni subnet nella tabella di route hello avrà un valore hop successivo di *rete virtuale*.</span><span class="sxs-lookup"><span data-stu-id="15caf-142">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in hello same virtual network, hello route for each subnet in hello route table will have a next hop value of *Virtual Network*.</span></span> <br/> <span data-ttu-id="15caf-143">**Gateway di rete virtuale**.</span><span class="sxs-lookup"><span data-stu-id="15caf-143">**Virtual Network Gateway**.</span></span> <span data-ttu-id="15caf-144">Rappresenta un Gateway VPN S2S Azure.</span><span class="sxs-lookup"><span data-stu-id="15caf-144">Represents an Azure S2S VPN Gateway.</span></span> <br/> <span data-ttu-id="15caf-145">**Internet**.</span><span class="sxs-lookup"><span data-stu-id="15caf-145">**Internet**.</span></span> <span data-ttu-id="15caf-146">Rappresenta il gateway Internet hello predefinito fornito dall'infrastruttura di Azure hello.</span><span class="sxs-lookup"><span data-stu-id="15caf-146">Represents hello default Internet gateway provided by hello Azure Infrastructure.</span></span> <br/> <span data-ttu-id="15caf-147">**Dispositivo virtuale**.</span><span class="sxs-lookup"><span data-stu-id="15caf-147">**Virtual Appliance**.</span></span> <span data-ttu-id="15caf-148">Rappresenta un accessorio virtuale di cui è stato aggiunto tooyour rete virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="15caf-148">Represents a virtual appliance you added tooyour Azure virtual network.</span></span> <br/> <span data-ttu-id="15caf-149">**Nessuno**.</span><span class="sxs-lookup"><span data-stu-id="15caf-149">**None**.</span></span> <span data-ttu-id="15caf-150">Rappresenta un black hole.</span><span class="sxs-lookup"><span data-stu-id="15caf-150">Represents a black hole.</span></span> <span data-ttu-id="15caf-151">I pacchetti inoltrati buco nero tooa non verranno inoltrati affatto.</span><span class="sxs-lookup"><span data-stu-id="15caf-151">Packets forwarded tooa black hole will not be forwarded at all.</span></span> |<span data-ttu-id="15caf-152">È consigliabile utilizzare **Appliance virtuale** toodirect tooa macchina virtuale o il bilanciamento del carico di Azure indirizzo IP interno del traffico.</span><span class="sxs-lookup"><span data-stu-id="15caf-152">Consider using **Virtual Appliance** toodirect traffic tooa VM or Azure Load Balancer internal IP address.</span></span>  <span data-ttu-id="15caf-153">Questo tipo consente di specificare di hello di un indirizzo IP come descritto di seguito.</span><span class="sxs-lookup"><span data-stu-id="15caf-153">This type allows hello specification of an IP address as described below.</span></span> <span data-ttu-id="15caf-154">È consigliabile utilizzare un **Nessuno** digitare pacchetti toostop dalla propagazione tooa dato di destinazione.</span><span class="sxs-lookup"><span data-stu-id="15caf-154">Consider using a **None** type toostop packets from flowing tooa given destination.</span></span> |
| <span data-ttu-id="15caf-155">Indirizzo hop successivo</span><span class="sxs-lookup"><span data-stu-id="15caf-155">Next hop address</span></span> |<span data-ttu-id="15caf-156">indirizzo dell'hop successivo Hello contiene l'indirizzo IP hello devono inoltrare i pacchetti.</span><span class="sxs-lookup"><span data-stu-id="15caf-156">hello next hop address contains hello IP address packets should be forwarded to.</span></span> <span data-ttu-id="15caf-157">I valori hop successivi sono consentiti solo in route in cui è di tipo dell'hop successivo hello *Appliance virtuale*.</span><span class="sxs-lookup"><span data-stu-id="15caf-157">Next hop values are only allowed in routes where hello next hop type is *Virtual Appliance*.</span></span> |<span data-ttu-id="15caf-158">Deve essere un indirizzo IP raggiungibile all'interno di hello rete virtuale in cui viene applicata hello Route definita dall'utente, senza passare attraverso un **Virtual Network Gateway**.</span><span class="sxs-lookup"><span data-stu-id="15caf-158">Must be an IP address that is reachable within hello Virtual Network where hello User Defined Route is applied, without going through a **Virtual Network Gateway**.</span></span> <span data-ttu-id="15caf-159">indirizzo IP Hello è toobe hello in caso di applicazione di rete virtuale stessa, o in una rete virtuale peered.</span><span class="sxs-lookup"><span data-stu-id="15caf-159">hello IP address has toobe on hello same Virtual Network where it is applied, or on a peered Virtual Network.</span></span> |<span data-ttu-id="15caf-160">Se l'indirizzo IP hello rappresenta una macchina virtuale, assicurarsi di abilitare [inoltro IP](#IP-forwarding) in Azure per hello macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="15caf-160">If hello IP address represents a VM, make sure you enable [IP forwarding](#IP-forwarding) in Azure for hello VM.</span></span> <span data-ttu-id="15caf-161">Se hello rappresenta hello interno indirizzo IP di bilanciamento del carico di Azure, assicurarsi di disporre della regola per ogni porta di bilanciamento del carico corrispondente si desidera bilanciare tooload.</span><span class="sxs-lookup"><span data-stu-id="15caf-161">If hello IP address represents hello internal IP address of Azure Load Balancer, make sure you have a matching load balancing rule for each port you wish tooload balance.</span></span>|

<span data-ttu-id="15caf-162">In Azure PowerShell alcuni dei valori di "NextHopType" hello hanno nomi diversi:</span><span class="sxs-lookup"><span data-stu-id="15caf-162">In Azure PowerShell some of hello "NextHopType" values have different names:</span></span>

* <span data-ttu-id="15caf-163">Rete virtuale è VnetLocal</span><span class="sxs-lookup"><span data-stu-id="15caf-163">Virtual Network is VnetLocal</span></span>
* <span data-ttu-id="15caf-164">Gateway di rete virtuale è VirtualNetworkGateway</span><span class="sxs-lookup"><span data-stu-id="15caf-164">Virtual Network Gateway is VirtualNetworkGateway</span></span>
* <span data-ttu-id="15caf-165">Appliance virtuale è VirtualAppliance</span><span class="sxs-lookup"><span data-stu-id="15caf-165">Virtual Appliance is VirtualAppliance</span></span>
* <span data-ttu-id="15caf-166">Internet è Internet</span><span class="sxs-lookup"><span data-stu-id="15caf-166">Internet is Internet</span></span>
* <span data-ttu-id="15caf-167">Nessuno è None</span><span class="sxs-lookup"><span data-stu-id="15caf-167">None is None</span></span>

### <a name="system-routes"></a><span data-ttu-id="15caf-168">Route di sistema</span><span class="sxs-lookup"><span data-stu-id="15caf-168">System routes</span></span>
<span data-ttu-id="15caf-169">Ogni subnet creata in una rete virtuale viene associata automaticamente a una tabella di routing contenente hello segue le regole di sistema route:</span><span class="sxs-lookup"><span data-stu-id="15caf-169">Every subnet created in a virtual network is automatically associated with a route table that contains hello following system route rules:</span></span>

* <span data-ttu-id="15caf-170">**Regola di rete virtuale locale**: questa regola viene creata automaticamente per ogni subnet in una rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="15caf-170">**Local Vnet Rule**: This rule is automatically created for every subnet in a virtual network.</span></span> <span data-ttu-id="15caf-171">Specifica che è presente un collegamento diretto tra le macchine virtuali hello nella rete virtuale hello e non vi è alcun intermedia hop successivo.</span><span class="sxs-lookup"><span data-stu-id="15caf-171">It specifies that there is a direct link between hello VMs in hello VNet and there is no intermediate next hop.</span></span>
* <span data-ttu-id="15caf-172">**Regola locale**: questa regola si applica a intervallo di indirizzi locali toohello tooall il traffico destinato e Usa il gateway VPN come destinazione dell'hop successivo hello.</span><span class="sxs-lookup"><span data-stu-id="15caf-172">**On-premises Rule**: This rule applies tooall traffic destined toohello on-premises address range and uses VPN gateway as hello next hop destination.</span></span>
* <span data-ttu-id="15caf-173">**Regola Internet**: questa regola gestisce tutto il traffico destinato toohello Internet pubblico (indirizzo prefisso 0.0.0.0/0) e gateway internet di infrastruttura utilizza hello come hello hop successivo per tutto il traffico destinato toohello Internet.</span><span class="sxs-lookup"><span data-stu-id="15caf-173">**Internet Rule**: This rule handles all traffic destined toohello public Internet (address prefix 0.0.0.0/0) and uses hello infrastructure internet gateway as hello next hop for all traffic destined toohello Internet.</span></span>

### <a name="user-defined-routes"></a><span data-ttu-id="15caf-174">Route definite dall'utente</span><span class="sxs-lookup"><span data-stu-id="15caf-174">User-defined routes</span></span>
<span data-ttu-id="15caf-175">Per la maggior parte degli ambienti è necessario solo delle route sistema hello già definite da Azure.</span><span class="sxs-lookup"><span data-stu-id="15caf-175">For most environments you will only need hello system routes already defined by Azure.</span></span> <span data-ttu-id="15caf-176">Tuttavia, è possibile necessario toocreate una tabella di routing e aggiungere una o più route in casi specifici, ad esempio:</span><span class="sxs-lookup"><span data-stu-id="15caf-176">However, you may need toocreate a route table and add one or more routes in specific cases, such as:</span></span>

* <span data-ttu-id="15caf-177">Il tunneling forzato toohello Internet tramite la rete locale.</span><span class="sxs-lookup"><span data-stu-id="15caf-177">Force tunneling toohello Internet via your on-premises network.</span></span>
* <span data-ttu-id="15caf-178">Utilizzo di dispositivi virtuali nell'ambiente Azure.</span><span class="sxs-lookup"><span data-stu-id="15caf-178">Use of virtual appliances in your Azure environment.</span></span>

<span data-ttu-id="15caf-179">Negli scenari di hello precedenti, verrà dispone di una tabella di route toocreate e aggiungere tooit route definite dall'utente.</span><span class="sxs-lookup"><span data-stu-id="15caf-179">In hello scenarios above, you will have toocreate a route table and add user defined routes tooit.</span></span> <span data-ttu-id="15caf-180">È possibile avere più tabelle di route e hello stessa tabella di route può essere associati tooone o altre subnet.</span><span class="sxs-lookup"><span data-stu-id="15caf-180">You can have multiple route tables, and hello same route table can be associated tooone or more subnets.</span></span> <span data-ttu-id="15caf-181">E ogni subnet può essere solo tabella singola route tooa associato.</span><span class="sxs-lookup"><span data-stu-id="15caf-181">And each subnet can only be associated tooa single route table.</span></span> <span data-ttu-id="15caf-182">Tutte le macchine virtuali e servizi cloud in una subnet usare hello route tabella associata toothat subnet.</span><span class="sxs-lookup"><span data-stu-id="15caf-182">All VMs and cloud services in a subnet use hello route table associated toothat subnet.</span></span>

<span data-ttu-id="15caf-183">Subnet si basano sulle route di sistema fino a una tabella di routing associata toohello subnet.</span><span class="sxs-lookup"><span data-stu-id="15caf-183">Subnets rely on system routes until a route table is associated toohello subnet.</span></span> <span data-ttu-id="15caf-184">Una volta che esiste un’associazione,il routing viene eseguito in base alla corrispondenza più lunga del prefisso (LPM) tra le route definite dall'utente e le route predefinite.</span><span class="sxs-lookup"><span data-stu-id="15caf-184">Once an association exists, routing is done based on Longest Prefix Match (LPM) among both user defined routes and system routes.</span></span> <span data-ttu-id="15caf-185">Se è presente più di una route con hello LPM stesso corrisponde una route è selezionata in base origine hello seguente ordine:</span><span class="sxs-lookup"><span data-stu-id="15caf-185">If there is more than one route with hello same LPM match then a route is selected based on its origin in hello following order:</span></span>

1. <span data-ttu-id="15caf-186">Route definita utente</span><span class="sxs-lookup"><span data-stu-id="15caf-186">User defined route</span></span>
2. <span data-ttu-id="15caf-187">Route BGP (quando viene utilizzato ExpressRoute)</span><span class="sxs-lookup"><span data-stu-id="15caf-187">BGP route (when ExpressRoute is used)</span></span>
3. <span data-ttu-id="15caf-188">La route di sistema</span><span class="sxs-lookup"><span data-stu-id="15caf-188">System route</span></span>

<span data-ttu-id="15caf-189">toolearn toocreate utente definizione route, vedere [come tooCreate instrada e attivare l'inoltro IP in Azure](virtual-network-create-udr-arm-template.md).</span><span class="sxs-lookup"><span data-stu-id="15caf-189">toolearn how toocreate user defined routes, see [How tooCreate Routes and Enable IP Forwarding in Azure](virtual-network-create-udr-arm-template.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="15caf-190">Route definite dall'utente vengono applicati tooAzure solo le macchine virtuali e i servizi cloud.</span><span class="sxs-lookup"><span data-stu-id="15caf-190">User defined routes are only applied tooAzure VMs and cloud services.</span></span> <span data-ttu-id="15caf-191">Ad esempio, se si desidera tooadd appliance virtuale firewall tra la rete locale e Azure, sarà necessario toocreate una route definita dall'utente per le tabelle di Azure di route per l'inoltro di tutto il traffico verso toohello locale indirizzo spazio toohello virtuale dispositivo.</span><span class="sxs-lookup"><span data-stu-id="15caf-191">For instance, if you want tooadd a firewall virtual appliance between your on-premises network and Azure, you will have toocreate a user defined route for your Azure route tables that forwards all traffic going toohello on-premises address space toohello virtual appliance.</span></span> <span data-ttu-id="15caf-192">È inoltre possibile aggiungere che un utente definito route (UDR) toohello GatewaySubnet tooforward tutto il traffico da sedi tooAzure tramite appliance virtuale hello.</span><span class="sxs-lookup"><span data-stu-id="15caf-192">You can also add a user defined route (UDR) toohello GatewaySubnet tooforward all traffic from on-premises tooAzure through hello virtual appliance.</span></span> <span data-ttu-id="15caf-193">Si tratta di un'aggiunta recente.</span><span class="sxs-lookup"><span data-stu-id="15caf-193">This is a recent addition.</span></span>
> 
> 

### <a name="bgp-routes"></a><span data-ttu-id="15caf-194">Route BGP</span><span class="sxs-lookup"><span data-stu-id="15caf-194">BGP routes</span></span>
<span data-ttu-id="15caf-195">Se si dispone di una connessione ExpressRoute tra la rete locale e Azure, è possibile abilitare le route toopropagate BGP dal tooAzure di rete locale.</span><span class="sxs-lookup"><span data-stu-id="15caf-195">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP toopropagate routes from your on-premises network tooAzure.</span></span> <span data-ttu-id="15caf-196">Vengono utilizzate queste route BGP in hello esattamente come le route di sistema e utente definito route in ogni subnet di Azure.</span><span class="sxs-lookup"><span data-stu-id="15caf-196">These BGP routes are used in hello same way as system routes and user defined routes in each Azure subnet.</span></span> <span data-ttu-id="15caf-197">Per altre informazioni, vedere [Panoramica tecnica relativa a ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="15caf-197">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="15caf-198">È possibile configurare la forza di toouse ambiente Azure tunneling forzato attraverso la rete locale tramite la creazione di una route definita dall'utente per 0.0.0.0/0 subnet che usa il gateway VPN hello come hop successivo hello.</span><span class="sxs-lookup"><span data-stu-id="15caf-198">You can configure your Azure environment toouse force tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses hello VPN gateway as hello next hop.</span></span> <span data-ttu-id="15caf-199">Tuttavia, funziona solo se si utilizza un gateway VPN, non ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="15caf-199">However, this only works if you are using a VPN gateway, not ExpressRoute.</span></span> <span data-ttu-id="15caf-200">Per ExpressRoute, il tunneling forzato viene configurato tramite BGP.</span><span class="sxs-lookup"><span data-stu-id="15caf-200">For ExpressRoute, forced tunneling is configured through BGP.</span></span>
> 
> 

## <a name="ip-forwarding"></a><span data-ttu-id="15caf-201">Inoltro IP</span><span class="sxs-lookup"><span data-stu-id="15caf-201">IP forwarding</span></span>
<span data-ttu-id="15caf-202">Come descritto in precedenza, uno dei hello motivi principali toocreate una route definita dall'utente è dell'appliance virtuale tooforward traffico tooa.</span><span class="sxs-lookup"><span data-stu-id="15caf-202">As described above, one of hello main reasons toocreate a user defined route is tooforward traffic tooa virtual appliance.</span></span> <span data-ttu-id="15caf-203">Un dispositivo virtuale è semplicemente una macchina virtuale che esegue un'applicazione che consente il traffico di rete toohandle in qualche modo, ad esempio un firewall o un dispositivo NAT.</span><span class="sxs-lookup"><span data-stu-id="15caf-203">A virtual appliance is nothing more than a VM that runs an application used toohandle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="15caf-204">Questo dispositivo virtuale che VM deve essere in grado di tooreceive il traffico in ingresso che viene risolto non tooitself.</span><span class="sxs-lookup"><span data-stu-id="15caf-204">This virtual appliance VM must be able tooreceive incoming traffic that is not addressed tooitself.</span></span> <span data-ttu-id="15caf-205">tooallow un traffico tooreceive VM inoltrate tooother destinazioni, è necessario abilitare l'inoltro IP per hello macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="15caf-205">tooallow a VM tooreceive traffic addressed tooother destinations, you must enable IP Forwarding for hello VM.</span></span> <span data-ttu-id="15caf-206">Si tratta di un'impostazione, non è un'impostazione hello del sistema operativo guest di Azure.</span><span class="sxs-lookup"><span data-stu-id="15caf-206">This is an Azure setting, not a setting in hello guest operating system.</span></span>

## <a name="next-steps"></a><span data-ttu-id="15caf-207">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="15caf-207">Next steps</span></span>
* <span data-ttu-id="15caf-208">Informazioni su come troppo[creare route nel modello di distribuzione di gestione risorse di hello](virtual-network-create-udr-arm-template.md) e associarli toosubnets.</span><span class="sxs-lookup"><span data-stu-id="15caf-208">Learn how too[create routes in hello Resource Manager deployment model](virtual-network-create-udr-arm-template.md) and associate them toosubnets.</span></span> 
* <span data-ttu-id="15caf-209">Informazioni su come troppo[creare route nel modello di distribuzione classica hello](virtual-network-create-udr-classic-ps.md) e associarli toosubnets.</span><span class="sxs-lookup"><span data-stu-id="15caf-209">Learn how too[create routes in hello classic deployment model](virtual-network-create-udr-classic-ps.md) and associate them toosubnets.</span></span>

