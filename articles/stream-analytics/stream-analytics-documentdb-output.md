---
title: output aaaJSON per flusso Analitica | Documenti Microsoft
description: "Informazioni su come l'analisi di flusso può usare Azure Cosmos DB per l'output JSON, consentendo l'esecuzione di query di archiviazione dei dati e a bassa latenza su dati JSON non strutturati."
keywords: Output JSON
documentationcenter: 
services: stream-analytics,documentdb
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: 5d2a61a6-0dbf-4f1b-80af-60a80eb25dd1
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: samacha
ms.openlocfilehash: fa717818c839ecd7a60fcee33d22011990fd5878
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="target-azure-cosmos-db-for-json-output-from-stream-analytics"></a><span data-ttu-id="b0e23-104">Usare Azure Cosmos DB per l'output JSON dell'analisi di flusso</span><span class="sxs-lookup"><span data-stu-id="b0e23-104">Target Azure Cosmos DB for JSON output from Stream Analytics</span></span>
<span data-ttu-id="b0e23-105">L'analisi di flusso può usare [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) per l'output JSON, consentendo l'esecuzione di query di archiviazione dei dati e a bassa latenza su dati JSON non strutturati.</span><span class="sxs-lookup"><span data-stu-id="b0e23-105">Stream Analytics can target [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) for JSON output, enabling data archiving and low-latency queries on unstructured JSON data.</span></span> <span data-ttu-id="b0e23-106">Questo documento descrive alcune procedure consigliate per l'implementazione di questa configurazione.</span><span class="sxs-lookup"><span data-stu-id="b0e23-106">This document covers some best practices for implementing this configuration.</span></span>

<span data-ttu-id="b0e23-107">Per chi ha familiarità con DB Cosmos, dare un'occhiata [il percorso di apprendimento del database di Azure Cosmos](https://azure.microsoft.com/documentation/learning-paths/documentdb/) tooget avviato.</span><span class="sxs-lookup"><span data-stu-id="b0e23-107">For those who are unfamiliar with Cosmos DB, take a look at [Azure Cosmos DB’s learning path](https://azure.microsoft.com/documentation/learning-paths/documentdb/) tooget started.</span></span> 

<span data-ttu-id="b0e23-108">Nota: l'API di MongoDB basata su raccolte di Cosmos DB non è attualmente supportata.</span><span class="sxs-lookup"><span data-stu-id="b0e23-108">Note: Mongo DB API based Cosmos DB collections is currently not supported.</span></span> 

## <a name="basics-of-cosmos-db-as-an-output-target"></a><span data-ttu-id="b0e23-109">Nozioni di base di Cosmos DB come destinazione di output</span><span class="sxs-lookup"><span data-stu-id="b0e23-109">Basics of Cosmos DB as an output target</span></span>
<span data-ttu-id="b0e23-110">Hello Azure Cosmos DB output nel flusso Analitica consente la scrittura del flusso di elaborazione dei risultati come output JSON in raccolte del DB Cosmos.</span><span class="sxs-lookup"><span data-stu-id="b0e23-110">hello Azure Cosmos DB output in Stream Analytics enables writing your stream processing results as JSON output into your Cosmos DB collection(s).</span></span> <span data-ttu-id="b0e23-111">Flusso Analitica non creare raccolte nel database, invece richiedere toocreate li sin dall'inizio.</span><span class="sxs-lookup"><span data-stu-id="b0e23-111">Stream Analytics does not create collections in your database, instead requiring you toocreate them upfront.</span></span> <span data-ttu-id="b0e23-112">Si tratta in modo che i costi di fatturazione hello di raccolte Cosmos DB tooyou trasparente, in modo che è possibile ottimizzare le prestazioni di hello, coerenza e la capacità delle raccolte direttamente utilizzando hello [API DB Cosmos](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span><span class="sxs-lookup"><span data-stu-id="b0e23-112">This is so that hello billing costs of Cosmos DB collections are transparent tooyou, and so that you can tune hello performance, consistency and capacity of your collections directly using hello [Cosmos DB APIs](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span></span> <span data-ttu-id="b0e23-113">È consigliabile utilizzare un Database di DB Cosmos per il flusso di processo toologically separate le raccolte per un processo di streaming.</span><span class="sxs-lookup"><span data-stu-id="b0e23-113">We recommend using one Cosmos DB Database per streaming job toologically separate your collections for a streaming job.</span></span>

<span data-ttu-id="b0e23-114">Alcune delle opzioni di raccolta Cosmos DB hello è illustrate di seguito.</span><span class="sxs-lookup"><span data-stu-id="b0e23-114">Some of hello Cosmos DB collection options are detailed below.</span></span>

## <a name="tune-consistency-availability-and-latency"></a><span data-ttu-id="b0e23-115">Ottimizzare coerenza, disponibilità e latenza</span><span class="sxs-lookup"><span data-stu-id="b0e23-115">Tune consistency, availability, and latency</span></span>
<span data-ttu-id="b0e23-116">toomatch dei requisiti dell'applicazione, DB Cosmos consente database hello di ottimizzazione toofine e raccolte e verificare compromessi tra la coerenza, disponibilità e latenza.</span><span class="sxs-lookup"><span data-stu-id="b0e23-116">toomatch your application requirements, Cosmos DB allows you toofine tune hello database and collections and make trade-offs between consistency, availability and latency.</span></span> <span data-ttu-id="b0e23-117">A seconda dei livelli di coerenza di lettura richiesti dello scenario rispetto alla latenza di lettura e scrittura, è possibile scegliere un livello di coerenza per l'account del database.</span><span class="sxs-lookup"><span data-stu-id="b0e23-117">Depending on what levels of read consistency your scenario needs against read and write latency, you can choose a consistency level on your database account.</span></span> <span data-ttu-id="b0e23-118">Per impostazione predefinita, DB Cosmos consente inoltre l'indicizzazione sincrono in ogni raccolta di tooyour operazioni CRUD.</span><span class="sxs-lookup"><span data-stu-id="b0e23-118">Also by default, Cosmos DB enables synchronous indexing on each CRUD operation tooyour collection.</span></span> <span data-ttu-id="b0e23-119">Si tratta di hello toocontrol di un'altra opzione utile prestazioni nel database Cosmos di lettura/scrittura.</span><span class="sxs-lookup"><span data-stu-id="b0e23-119">This is another useful option toocontrol hello write/read performance in Cosmos DB.</span></span> <span data-ttu-id="b0e23-120">Per ulteriori informazioni su questo argomento, esaminare hello [modificare i livelli di coerenza del database e query](../documentdb/documentdb-consistency-levels.md) articolo.</span><span class="sxs-lookup"><span data-stu-id="b0e23-120">For further information on this topic, review hello [change your database and query consistency levels](../documentdb/documentdb-consistency-levels.md) article.</span></span>

## <a name="upserts-from-stream-analytics"></a><span data-ttu-id="b0e23-121">Upsert di Analisi di flusso</span><span class="sxs-lookup"><span data-stu-id="b0e23-121">Upserts from Stream Analytics</span></span>
<span data-ttu-id="b0e23-122">Integrazione Analitica flusso con DB Cosmos consente tooinsert o aggiorna i record del DB Cosmos raccolta in base a una determinata colonna di ID documento.</span><span class="sxs-lookup"><span data-stu-id="b0e23-122">Stream Analytics integration with Cosmos DB allows you tooinsert or update records in your Cosmos DB collection based on a given Document ID column.</span></span> <span data-ttu-id="b0e23-123">Si tratta di cui viene fatto riferimento tooas un *Upsert*.</span><span class="sxs-lookup"><span data-stu-id="b0e23-123">This is also referred tooas an *Upsert*.</span></span>

<span data-ttu-id="b0e23-124">Flusso Analitica utilizza un approccio ottimistico Upsert, in cui gli aggiornamenti sono eseguiti solo quando l'inserimento ha esito negativo a causa di conflitti di ID documento tooa.</span><span class="sxs-lookup"><span data-stu-id="b0e23-124">Stream Analytics utilizes an optimistic Upsert approach, where updates are only done when insert fails due tooa Document ID conflict.</span></span> <span data-ttu-id="b0e23-125">Questo aggiornamento viene eseguito da Analitica flusso come PATCH, pertanto consente documento toohello aggiornamenti parziali, ad esempio l'aggiunta di nuove proprietà o la sostituzione di che una proprietà esistente viene eseguita in modo incrementale.</span><span class="sxs-lookup"><span data-stu-id="b0e23-125">This update is performed by Stream Analytics as a PATCH, so it enables partial updates toohello document, i.e. addition of new properties or replacing an existing property is performed incrementally.</span></span> <span data-ttu-id="b0e23-126">Si noti che le modifiche ai valori hello delle proprietà di matrice nel documento JSON provocare intera matrice hello recupero sovrascritto, vale a dire matrice hello non viene unito.</span><span class="sxs-lookup"><span data-stu-id="b0e23-126">Note that changes in hello values of array properties in your JSON document result in hello entire array getting overwritten, i.e. hello array is not merged.</span></span>

## <a name="data-partitioning-in-cosmos-db"></a><span data-ttu-id="b0e23-127">Partizionamento dei dati in Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="b0e23-127">Data partitioning in Cosmos DB</span></span>
<span data-ttu-id="b0e23-128">COSMOS DB [partizionata raccolte](../cosmos-db/partition-data.md) sono hello consigliato approccio per il partizionamento dei dati.</span><span class="sxs-lookup"><span data-stu-id="b0e23-128">Cosmos DB [partitioned collections](../cosmos-db/partition-data.md) are hello recommended approach for partitioning your data.</span></span> 

<span data-ttu-id="b0e23-129">Per le raccolte di DB Cosmos singole, flusso Analitica ancora consente toopartition i dati basati sui modelli di query hello sia alle esigenze di prestazioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b0e23-129">For single Cosmos DB collections, Stream Analytics still allows you toopartition your data based on both hello query patterns and performance needs of your application.</span></span> <span data-ttu-id="b0e23-130">Ogni raccolta può contenere un massimo di too10GB dei dati (massimo) e attualmente di che non è tooscale alcun modo (o overflow) una raccolta.</span><span class="sxs-lookup"><span data-stu-id="b0e23-130">Each collection may contain up too10GB of data (maximum) and currently there is no way tooscale up (or overflow) a collection.</span></span> <span data-ttu-id="b0e23-131">Per la scalabilità orizzontale, Analitica di flusso consente toowrite toomultiple raccolte con un prefisso (vedere i dettagli di utilizzo riportati di seguito).</span><span class="sxs-lookup"><span data-stu-id="b0e23-131">For scaling out, Stream Analytics allows you toowrite toomultiple collections with a given prefix (see usage details below).</span></span> <span data-ttu-id="b0e23-132">Flusso Analitica utilizza hello coerenza [Resolver partizione Hash](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategia in base all'utente di hello fornito PartitionKey colonna toopartition relativi record di output.</span><span class="sxs-lookup"><span data-stu-id="b0e23-132">Stream Analytics uses hello consistent [Hash Partition Resolver](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategy based on hello user provided PartitionKey column toopartition its output records.</span></span> <span data-ttu-id="b0e23-133">Hello numero di raccolte con hello all'ora di inizio del processo di streaming hello di prefisso viene utilizzato come numero di partizioni di output di hello, il processo di hello toowhich scrive tooin parallelo (raccolte DB Cosmos = le partizioni di Output).</span><span class="sxs-lookup"><span data-stu-id="b0e23-133">hello number of collections with hello given prefix at hello streaming job’s start time is used as hello output partition count, toowhich hello job writes tooin parallel (Cosmos DB Collections = Output Partitions).</span></span> <span data-ttu-id="b0e23-134">Per una singola raccolta con indicizzazione differita che esegue solo inserimenti, è prevedibile una velocità effettiva di scrittura di 0,4 MB/s.</span><span class="sxs-lookup"><span data-stu-id="b0e23-134">For a single collection with lazy indexing doing only inserts, about 0.4 MB/s write throughput can be expected.</span></span> <span data-ttu-id="b0e23-135">Utilizzo di più raccolte, è possibile consentire si tooachieve una velocità effettiva e maggiore capacità.</span><span class="sxs-lookup"><span data-stu-id="b0e23-135">Using multiple collections can allow you tooachieve higher throughput and increased capacity.</span></span>

<span data-ttu-id="b0e23-136">Se si intende il numero di partizioni tooincrease hello in hello future, si potrebbe essere necessario toostop il processo, repartition hello dati dalle raccolte esistenti in nuove raccolte e quindi riavviare hello Analitica flusso processo.</span><span class="sxs-lookup"><span data-stu-id="b0e23-136">If you intend tooincrease hello partition count in hello future, you may need toostop your job, repartition hello data from your existing collections into new collections and then restart hello Stream Analytics job.</span></span> <span data-ttu-id="b0e23-137">Altre informazioni sull'uso di PartitionResolver e sul ripartizionamento, con codice di esempio, saranno incluse in un post di approfondimento.</span><span class="sxs-lookup"><span data-stu-id="b0e23-137">More details on using PartitionResolver and re-partitioning along with sample code, will be included in a follow-up post.</span></span> <span data-ttu-id="b0e23-138">articolo Hello [partizionamento e la scalabilità in DB Cosmos](../documentdb/documentdb-partition-data.md) forniscono inoltre informazioni dettagliate su questo.</span><span class="sxs-lookup"><span data-stu-id="b0e23-138">hello article [Partitioning and scaling in Cosmos DB](../documentdb/documentdb-partition-data.md) also provides details on this.</span></span>

## <a name="cosmos-db-settings-for-json-output"></a><span data-ttu-id="b0e23-139">Impostazioni di Cosmos DB per l'output JSON</span><span class="sxs-lookup"><span data-stu-id="b0e23-139">Cosmos DB settings for JSON output</span></span>
<span data-ttu-id="b0e23-140">La creazione di Cosmos DB come output nell'analisi di flusso genera una richiesta di informazioni, come illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="b0e23-140">Creating Cosmos DB as an output in Stream Analytics generates a prompt for information as seen below.</span></span> <span data-ttu-id="b0e23-141">In questa sezione viene fornita una spiegazione della definizione di proprietà hello.</span><span class="sxs-lookup"><span data-stu-id="b0e23-141">This section provides an explanation of hello properties definition.</span></span>

<span data-ttu-id="b0e23-142">Raccolta partizionata</span><span class="sxs-lookup"><span data-stu-id="b0e23-142">Partitioned Collection</span></span> | <span data-ttu-id="b0e23-143">Più raccolte a partizione singola</span><span class="sxs-lookup"><span data-stu-id="b0e23-143">Multiple “Single Partition” collections</span></span>
---|---
![documentdb analisi di flusso schermata di output](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-1.png) |  ![documentdb analisi di flusso schermata di output](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-2.png)


  
> [!NOTE]
> <span data-ttu-id="b0e23-146">Hello **più raccolte di "Sola partizione"** scenario richiede una chiave di partizione e una configurazione supportata.</span><span class="sxs-lookup"><span data-stu-id="b0e23-146">hello **Multiple “Single Partition” collections** scenario requires a partition key and is a supported configuration.</span></span> 

* <span data-ttu-id="b0e23-147">**Alias di output** – toorefer un alias per questo output nella query ASA</span><span class="sxs-lookup"><span data-stu-id="b0e23-147">**Output Alias** – An alias toorefer this output in your ASA query</span></span>  
* <span data-ttu-id="b0e23-148">**Nome account** : hello nome o l'URI di hello account Cosmos DB dell'endpoint.</span><span class="sxs-lookup"><span data-stu-id="b0e23-148">**Account Name** – hello name or endpoint URI of hello Cosmos DB account.</span></span>  
* <span data-ttu-id="b0e23-149">**Chiave account** : chiave di accesso condiviso hello per hello Cosmos DB account.</span><span class="sxs-lookup"><span data-stu-id="b0e23-149">**Account Key** – hello shared access key for hello Cosmos DB account.</span></span>  
* <span data-ttu-id="b0e23-150">**Database** : nome del database DB Cosmos hello.</span><span class="sxs-lookup"><span data-stu-id="b0e23-150">**Database** – hello Cosmos DB database name.</span></span>  
* <span data-ttu-id="b0e23-151">**Modello di nome raccolta** : hello raccolta o il nome relativo modello per hello raccolte toobe utilizzato.</span><span class="sxs-lookup"><span data-stu-id="b0e23-151">**Collection Name Pattern** – hello collection name or their pattern for hello collections toobe used.</span></span> <span data-ttu-id="b0e23-152">formato di nome raccolta Hello può essere costruito utilizzando token {partition} facoltativo hello, in cui le partizioni iniziano da 0.</span><span class="sxs-lookup"><span data-stu-id="b0e23-152">hello collection name format can be constructed using hello optional {partition} token, where partitions start from 0.</span></span> <span data-ttu-id="b0e23-153">Di seguito sono riportati input di esempio validi:</span><span class="sxs-lookup"><span data-stu-id="b0e23-153">Following are sample valid inputs:</span></span>  
  <span data-ttu-id="b0e23-154">1\) MyCollection: deve essere presente una raccolta denominata "MyCollection".</span><span class="sxs-lookup"><span data-stu-id="b0e23-154">1\) MyCollection – One collection named “MyCollection” must exist.</span></span>  
  <span data-ttu-id="b0e23-155">2\) MyCollection{partizione}: devono essere presenti le raccolte "MyCollection0", "MyCollection1", "MyCollection2" e così via.</span><span class="sxs-lookup"><span data-stu-id="b0e23-155">2\) MyCollection{partition} – Such collections must exist– "MyCollection0”, “MyCollection1”, “MyCollection2” and so on.</span></span>  
* <span data-ttu-id="b0e23-156">**Chiave di partizione**: valore facoltativo.</span><span class="sxs-lookup"><span data-stu-id="b0e23-156">**Partition Key** – Optional.</span></span> <span data-ttu-id="b0e23-157">È necessario solo se si usa un token {partition} nel modello del nome di raccolta.</span><span class="sxs-lookup"><span data-stu-id="b0e23-157">This is only needed if you are using a {parition} token in your collection name pattern.</span></span> <span data-ttu-id="b0e23-158">nome di Hello del campo hello in output chiave hello toospecify di eventi utilizzati per il partizionamento dell'output tra raccolte.</span><span class="sxs-lookup"><span data-stu-id="b0e23-158">hello name of hello field in output events used toospecify hello key for partitioning output across collections.</span></span> <span data-ttu-id="b0e23-159">Per l'output di una singola raccolta si può usare qualsiasi colonna di output arbitraria, ad esempio PartitionId.</span><span class="sxs-lookup"><span data-stu-id="b0e23-159">For single collection output, any arbitrary output column can be used e.g. PartitionId.</span></span>  
* <span data-ttu-id="b0e23-160">**ID documento** : valore facoltativo.</span><span class="sxs-lookup"><span data-stu-id="b0e23-160">**Document ID** – Optional.</span></span> <span data-ttu-id="b0e23-161">nome di Hello di hello campo negli eventi di output utilizzato chiave primaria hello toospecify su quali insert o update sono basate le operazioni.</span><span class="sxs-lookup"><span data-stu-id="b0e23-161">hello name of hello field in output events used toospecify hello primary key on which insert or update operations are based.</span></span>  
