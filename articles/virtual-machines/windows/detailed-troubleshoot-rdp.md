---
title: desktop remoto di aaaDetailed risoluzione dei problemi in Azure | Documenti Microsoft
description: "Rivedere la procedura dettagliata sulla risoluzione dei problemi per gli errori di desktop remoti in cui non è possibile tooa macchine virtuali di Windows in Azure"
services: virtual-machines-windows
documentationcenter: 
author: genlin
manager: timlt
editor: 
tags: top-support-issue,azure-service-management,azure-resource-manager
keywords: "non è possibile connettersi a desktop tooremote, risolvere i problemi relativi a desktop remoto, non è possibile connettere desktop remoto, errori di desktop remoti, remote desktop Risoluzione dei problemi, problemi relativi al desktop remoti"
ms.assetid: 9da36f3d-30dd-44af-824b-8ce5ef07e5e0
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: support-article
ms.date: 07/25/2017
ms.author: genli
ms.openlocfilehash: fcb0d06aa66b748f3ebbbbe3431471d3cbe7c60d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="detailed-troubleshooting-steps-for-remote-desktop-connection-issues-toowindows-vms-in-azure"></a><span data-ttu-id="f4ed6-104">La procedura dettagliata sulla risoluzione dei problemi di connessione desktop remoto genera tooWindows macchine virtuali in Azure</span><span class="sxs-lookup"><span data-stu-id="f4ed6-104">Detailed troubleshooting steps for remote desktop connection issues tooWindows VMs in Azure</span></span>
<span data-ttu-id="f4ed6-105">In questo articolo vengono fornite procedure dettagliate sulla risoluzione dei problemi di toodiagnose e correggere gli errori di Desktop remoto complessi per le macchine virtuali basate su Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-105">This article provides detailed troubleshooting steps toodiagnose and fix complex Remote Desktop errors for Windows-based Azure virtual machines.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="f4ed6-106">tooeliminate hello errori più comuni di Desktop remoto, assicurarsi che tooread [base articolo sulla risoluzione dei problemi di hello per Desktop remoto](troubleshoot-rdp-connection.md) prima di procedere.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-106">tooeliminate hello more common Remote Desktop errors, make sure tooread [hello basic troubleshooting article for Remote Desktop](troubleshoot-rdp-connection.md) before proceeding.</span></span>

<span data-ttu-id="f4ed6-107">Potrebbero verificarsi un Desktop remoto, il messaggio di errore che non sono simili a uno qualsiasi dei messaggi di errore specifici hello analizzato in [hello base Desktop remoto, risoluzione dei problemi guida](troubleshoot-rdp-connection.md).</span><span class="sxs-lookup"><span data-stu-id="f4ed6-107">You may encounter a Remote Desktop error message that does not resemble any of hello specific error messages covered in [hello basic Remote Desktop troubleshooting guide](troubleshoot-rdp-connection.md).</span></span> <span data-ttu-id="f4ed6-108">Seguire questi passaggi toodetermine perché il client di Desktop remoto (RDP) hello è Impossibile tooconnect toohello RDP servizio hello macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-108">Follow these steps toodetermine why hello Remote Desktop (RDP) client is unable tooconnect toohello RDP service on hello Azure VM.</span></span>

[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="f4ed6-109">Se è necessario ulteriore assistenza in qualsiasi punto in questo articolo, è possibile contattare hello Azure esperti in [hello MSDN di Azure e forum di Overflow dello Stack di hello](https://azure.microsoft.com/support/forums/).</span><span class="sxs-lookup"><span data-stu-id="f4ed6-109">If you need more help at any point in this article, you can contact hello Azure experts on [hello MSDN Azure and hello Stack Overflow forums](https://azure.microsoft.com/support/forums/).</span></span> <span data-ttu-id="f4ed6-110">In alternativa, è anche possibile archiviare un evento imprevisto di supporto tecnico di Azure.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-110">Alternatively, you can also file an Azure support incident.</span></span> <span data-ttu-id="f4ed6-111">Passare toohello [sito del supporto tecnico di Azure](https://azure.microsoft.com/support/options/) e fare clic su **supporto**.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-111">Go toohello [Azure Support site](https://azure.microsoft.com/support/options/) and click **Get Support**.</span></span> <span data-ttu-id="f4ed6-112">Per informazioni sull'utilizzo di supporto tecnico di Azure, leggere hello [domande frequenti sul supporto di Microsoft Azure](https://azure.microsoft.com/support/faq/).</span><span class="sxs-lookup"><span data-stu-id="f4ed6-112">For information about using Azure Support, read hello [Microsoft Azure Support FAQ](https://azure.microsoft.com/support/faq/).</span></span>

## <a name="components-of-a-remote-desktop-connection"></a><span data-ttu-id="f4ed6-113">Componenti di una connessione Desktop remoto</span><span class="sxs-lookup"><span data-stu-id="f4ed6-113">Components of a Remote Desktop connection</span></span>
<span data-ttu-id="f4ed6-114">Hello seguenti componenti coinvolti in una connessione RDP:</span><span class="sxs-lookup"><span data-stu-id="f4ed6-114">hello following components are involved in an RDP connection:</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_0.png)

<span data-ttu-id="f4ed6-115">Prima di procedere, può essere utile toomentally verificare cosa è cambiato rispetto hello ultima ha esito positivo Desktop remoto connessione toohello macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-115">Before proceeding, it might help toomentally review what has changed since hello last successful Remote Desktop connection toohello VM.</span></span> <span data-ttu-id="f4ed6-116">ad esempio:</span><span class="sxs-lookup"><span data-stu-id="f4ed6-116">For example:</span></span>

* <span data-ttu-id="f4ed6-117">indirizzo IP pubblico del hello hello macchina virtuale o un servizio cloud contenente hello VM Hello (detto anche l'indirizzo IP virtuale hello [VIP](https://en.wikipedia.org/wiki/Virtual_IP_address)) è stato modificato.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-117">hello public IP address of hello VM or hello cloud service containing hello VM (also called hello virtual IP address [VIP](https://en.wikipedia.org/wiki/Virtual_IP_address)) has changed.</span></span> <span data-ttu-id="f4ed6-118">Errore RDP Hello potrebbe essere che la cache del client DNS presenta ancora hello *indirizzo IP precedente* registrato per il nome DNS hello.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-118">hello RDP failure could be because your DNS client cache still has hello *old IP address* registered for hello DNS name.</span></span> <span data-ttu-id="f4ed6-119">Svuotare la cache del client DNS e provare a riconnettersi hello macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-119">Flush your DNS client cache and try connecting hello VM again.</span></span> <span data-ttu-id="f4ed6-120">O provare a connettersi direttamente con hello nuovo VIP.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-120">Or try connecting directly with hello new VIP.</span></span>
* <span data-ttu-id="f4ed6-121">Si siano utilizzando le connessioni Desktop remoto toomanage un'applicazione di terze parti invece di utilizzare connessione hello generati da hello portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-121">You are using a third-party application toomanage your Remote Desktop connections instead of using hello connection generated by hello Azure portal.</span></span> <span data-ttu-id="f4ed6-122">Verificare che la configurazione dell'applicazione hello include hello corretto la porta TCP per hello traffico Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-122">Verify that hello application configuration includes hello correct TCP port for hello Remote Desktop traffic.</span></span> <span data-ttu-id="f4ed6-123">È possibile controllare questa porta per una macchina virtuale classica in hello [portale di Azure](https://portal.azure.com), fare clic su impostazioni della macchina virtuale di hello > endpoint.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-123">You can check this port for a classic virtual machine in hello [Azure portal](https://portal.azure.com), by clicking hello VM's Settings > Endpoints.</span></span>

## <a name="preliminary-steps"></a><span data-ttu-id="f4ed6-124">Operazioni preliminari</span><span class="sxs-lookup"><span data-stu-id="f4ed6-124">Preliminary steps</span></span>
<span data-ttu-id="f4ed6-125">Prima di procedere toohello risoluzione dei problemi dettagliata,</span><span class="sxs-lookup"><span data-stu-id="f4ed6-125">Before proceeding toohello detailed troubleshooting,</span></span>

* <span data-ttu-id="f4ed6-126">Controllare lo stato di hello della macchina virtuale hello in hello portale di Azure per eventuali problemi.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-126">Check hello status of hello virtual machine in hello Azure portal for any obvious issues.</span></span>
* <span data-ttu-id="f4ed6-127">Seguire hello [passaggi correzione rapida per gli errori comuni di RDP in hello risoluzione dei problemi per](troubleshoot-rdp-connection.md#quick-troubleshooting-steps).</span><span class="sxs-lookup"><span data-stu-id="f4ed6-127">Follow hello [quick fix steps for common RDP errors in hello basic troubleshooting guide](troubleshoot-rdp-connection.md#quick-troubleshooting-steps).</span></span>

<span data-ttu-id="f4ed6-128">Provare a riconnettersi toohello macchina virtuale tramite Desktop remoto dopo questi passaggi.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-128">Try reconnecting toohello VM via Remote Desktop after these steps.</span></span>

## <a name="detailed-troubleshooting-steps"></a><span data-ttu-id="f4ed6-129">Procedura di risoluzione dei problemi dettagliata</span><span class="sxs-lookup"><span data-stu-id="f4ed6-129">Detailed troubleshooting steps</span></span>
<span data-ttu-id="f4ed6-130">client Desktop remoto Hello potrebbe non essere il servizio tooreach in grado di hello Desktop remoto nella macchina virtuale di Azure hello tooissues scadenza in hello seguenti origini:</span><span class="sxs-lookup"><span data-stu-id="f4ed6-130">hello Remote Desktop client may not be able tooreach hello Remote Desktop service on hello Azure VM due tooissues at hello following sources:</span></span>

* [<span data-ttu-id="f4ed6-131">Computer client Desktop remoto</span><span class="sxs-lookup"><span data-stu-id="f4ed6-131">Remote Desktop client computer</span></span>](#source-1-remote-desktop-client-computer)
* [<span data-ttu-id="f4ed6-132">Dispositivo periferico dell’Intranet dell’organizzazione</span><span class="sxs-lookup"><span data-stu-id="f4ed6-132">Organization intranet edge device</span></span>](#source-2-organization-intranet-edge-device)
* [<span data-ttu-id="f4ed6-133">Endpoint del servizio cloud ed elenco di controllo di accesso (ACL)</span><span class="sxs-lookup"><span data-stu-id="f4ed6-133">Cloud service endpoint and access control list (ACL)</span></span>](#source-3-cloud-service-endpoint-and-acl)
* [<span data-ttu-id="f4ed6-134">Gruppi di sicurezza di rete</span><span class="sxs-lookup"><span data-stu-id="f4ed6-134">Network security groups</span></span>](#source-4-network-security-groups)
* [<span data-ttu-id="f4ed6-135">Macchina virtuale di Azure basata su Windows</span><span class="sxs-lookup"><span data-stu-id="f4ed6-135">Windows-based Azure VM</span></span>](#source-5-windows-based-azure-vm)

## <a name="source-1-remote-desktop-client-computer"></a><span data-ttu-id="f4ed6-136">Origine 1: computer client Desktop remoto</span><span class="sxs-lookup"><span data-stu-id="f4ed6-136">Source 1: Remote Desktop client computer</span></span>
<span data-ttu-id="f4ed6-137">Verificare che il computer è possibile rendere Desktop remoto connessioni tooanother locale, i computer basati su Windows.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-137">Verify that your computer can make Remote Desktop connections tooanother on-premises, Windows-based computer.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_1.png)

<span data-ttu-id="f4ed6-138">Se non è possibile, cercare hello seguendo le impostazioni nel computer in uso:</span><span class="sxs-lookup"><span data-stu-id="f4ed6-138">If you cannot, check for hello following settings on your computer:</span></span>

* <span data-ttu-id="f4ed6-139">Un'impostazione firewall locale che blocca il traffico di Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-139">A local firewall setting that is blocking Remote Desktop traffic.</span></span>
* <span data-ttu-id="f4ed6-140">Software proxy client installato localmente che impedisce le connessioni Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-140">Locally installed client proxy software that is preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="f4ed6-141">Software di monitoraggio della rete installato localmente che impedisce le connessioni Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-141">Locally installed network monitoring software that is preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="f4ed6-142">Altri tipi di software di sicurezza che effettuano il monitoraggio del traffico o consentono/non consentono tipi di traffico che impediscano le connessioni Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-142">Other types of security software that either monitor traffic or allow/disallow specific types of traffic that is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="f4ed6-143">In questi casi, disattivare il software hello temporaneamente e provare tooconnect tooan locale computer tramite Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-143">In all these cases, temporarily disable hello software and try tooconnect tooan on-premises computer via Remote Desktop.</span></span> <span data-ttu-id="f4ed6-144">Se è possibile scoprire la causa effettiva hello in questo modo, con connessioni di rete amministratore toocorrect hello software impostazioni tooallow Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-144">If you can find out hello actual cause this way, work with your network administrator toocorrect hello software settings tooallow Remote Desktop connections.</span></span>

## <a name="source-2-organization-intranet-edge-device"></a><span data-ttu-id="f4ed6-145">Origine 2: dispositivo periferico dell’Intranet dell’organizzazione</span><span class="sxs-lookup"><span data-stu-id="f4ed6-145">Source 2: Organization intranet edge device</span></span>
<span data-ttu-id="f4ed6-146">Verificare che un computer connesso direttamente toohello che Internet può rendere tooyour connessioni Desktop remoto macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-146">Verify that a computer directly connected toohello Internet can make Remote Desktop connections tooyour Azure virtual machine.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_2.png)

<span data-ttu-id="f4ed6-147">Se non si dispone di un computer che è direttamente connesso toohello Internet, creare e testare con una nuova macchina virtuale di Azure in un servizio cloud o di gruppo di risorse.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-147">If you do not have a computer that is directly connected toohello Internet, create and test with a new Azure virtual machine in a resource group or cloud service.</span></span> <span data-ttu-id="f4ed6-148">Per ulteriori informazioni, vedere [Creare una macchina virtuale con Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="f4ed6-148">For more information, see [Create a virtual machine running Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span></span> <span data-ttu-id="f4ed6-149">È possibile eliminare macchine virtuali hello e gruppo di risorse hello o servizio cloud hello, dopo hello test.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-149">You can delete hello virtual machine and hello resource group or hello cloud service, after hello test.</span></span>

<span data-ttu-id="f4ed6-150">Se è possibile creare una connessione Desktop remoto con un computer collegato direttamente toohello Internet, controllare il dispositivo perimetrale intranet di organizzazione per:</span><span class="sxs-lookup"><span data-stu-id="f4ed6-150">If you can create a Remote Desktop connection with a computer directly attached toohello Internet, check your organization intranet edge device for:</span></span>

* <span data-ttu-id="f4ed6-151">Un firewall interno blocco toohello connessioni HTTPS Internet.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-151">An internal firewall blocking HTTPS connections toohello Internet.</span></span>
* <span data-ttu-id="f4ed6-152">Server proxy che impedisce le connessioni Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-152">A proxy server preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="f4ed6-153">Software di rilevamento delle intrusioni o software per il monitoraggio della rete in esecuzione sui dispositivi nella rete perimetrale che impedisce le connessioni Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-153">Intrusion detection or network monitoring software running on devices in your edge network that is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="f4ed6-154">Funziona con le impostazioni di rete amministratore toocorrect hello dell'organizzazione intranet edge dispositivo tooallow Desktop remoto basato su HTTPS connessioni toohello Internet.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-154">Work with your network administrator toocorrect hello settings of your organization intranet edge device tooallow HTTPS-based Remote Desktop connections toohello Internet.</span></span>

## <a name="source-3-cloud-service-endpoint-and-acl"></a><span data-ttu-id="f4ed6-155">Origine 3: endpoint del servizio cloud e ACL</span><span class="sxs-lookup"><span data-stu-id="f4ed6-155">Source 3: Cloud service endpoint and ACL</span></span>
<span data-ttu-id="f4ed6-156">Per macchine virtuali create con modello di distribuzione classica hello, verificare che un'altra macchina virtuale di Azure che sia in hello stesso servizio cloud o rete virtuale è possibile apportare tooyour connessioni Desktop remoto macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-156">For VMs created using hello Classic deployment model, verify that another Azure VM that is in hello same cloud service or virtual network can make Remote Desktop connections tooyour Azure VM.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_3.png)

> [!NOTE]
> <span data-ttu-id="f4ed6-157">Per le macchine virtuali create in Gestione risorse, ignorare troppo[origine 4: gruppi di sicurezza di rete](#source-4-network-security-groups).</span><span class="sxs-lookup"><span data-stu-id="f4ed6-157">For virtual machines created in Resource Manager, skip too[Source 4: Network Security Groups](#source-4-network-security-groups).</span></span>

<span data-ttu-id="f4ed6-158">Se è un'altra macchina virtuale non hello nello stesso servizio cloud o rete virtuale, crearne uno.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-158">If you do not have another virtual machine in hello same cloud service or virtual network, create one.</span></span> <span data-ttu-id="f4ed6-159">Seguire i passaggi di hello in [creare una macchina virtuale Windows in esecuzione in Azure](../virtual-machines-windows-hero-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="f4ed6-159">Follow hello steps in [Create a virtual machine running Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span></span> <span data-ttu-id="f4ed6-160">Eliminare la macchina virtuale di test hello dopo aver completato il test di hello.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-160">Delete hello test virtual machine after hello test is completed.</span></span>

<span data-ttu-id="f4ed6-161">Se è possibile connettersi tramite Desktop remoto tooa macchina virtuale di hello stesso cloud servizio o della rete virtuale, verificare la presenza di queste impostazioni:</span><span class="sxs-lookup"><span data-stu-id="f4ed6-161">If you can connect via Remote Desktop tooa virtual machine in hello same cloud service or virtual network, check for these settings:</span></span>

* <span data-ttu-id="f4ed6-162">configurazione dell'endpoint per il traffico di Desktop remoto nella destinazione hello VM Hello: hello privata la porta TCP dell'endpoint hello deve corrispondere la porta TCP hello su quale hello servizio Desktop remoto della macchina virtuale è in ascolto (valore predefinito è 3389).</span><span class="sxs-lookup"><span data-stu-id="f4ed6-162">hello endpoint configuration for Remote Desktop traffic on hello target VM: hello private TCP port of hello endpoint must match hello TCP port on which hello VM's Remote Desktop service is listening (default is 3389).</span></span>
* <span data-ttu-id="f4ed6-163">Hello ACL per l'endpoint di traffico hello Desktop remoto nella destinazione hello VM: gli ACL consentono di toospecify consentito o negato il traffico in ingresso da Internet in base al relativo indirizzo IP di origine hello.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-163">hello ACL for hello Remote Desktop traffic endpoint on hello target VM: ACLs allow you toospecify allowed or denied incoming traffic from hello Internet based on its source IP address.</span></span> <span data-ttu-id="f4ed6-164">ACL configurato in modo errato può impedire l'endpoint di toohello traffico Desktop remoto in ingresso.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-164">Misconfigured ACLs can prevent incoming Remote Desktop traffic toohello endpoint.</span></span> <span data-ttu-id="f4ed6-165">Controllare il tooensure ACL che è consentito il traffico in ingresso dagli indirizzi IP pubblici di proxy o un altro server edge.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-165">Check your ACLs tooensure that incoming traffic from your public IP addresses of your proxy or other edge server is allowed.</span></span> <span data-ttu-id="f4ed6-166">Per altre informazioni, vedere [Che cos'è un elenco di controllo di accesso di rete (ACL)?](../../virtual-network/virtual-networks-acl.md)</span><span class="sxs-lookup"><span data-stu-id="f4ed6-166">For more information, see [What is a Network Access Control List (ACL)?](../../virtual-network/virtual-networks-acl.md)</span></span>

<span data-ttu-id="f4ed6-167">Se endpoint hello è hello di origine del problema in hello toocheck rimuovere endpoint corrente hello e crearne uno nuovo, la scelta di una porta casuale nell'intervallo hello 49152 e 65535 per numero di porta esterna hello.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-167">toocheck if hello endpoint is hello source of hello problem, remove hello current endpoint and create a new one, choosing a random port in hello range 49152–65535 for hello external port number.</span></span> <span data-ttu-id="f4ed6-168">Per ulteriori informazioni, vedere [come tooset endpoint della macchina virtuale tooa](classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="f4ed6-168">For more information, see [How tooset up endpoints tooa virtual machine](classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span></span>

## <a name="source-4-network-security-groups"></a><span data-ttu-id="f4ed6-169">Origine 4: gruppi di sicurezza di rete</span><span class="sxs-lookup"><span data-stu-id="f4ed6-169">Source 4: Network Security Groups</span></span>
<span data-ttu-id="f4ed6-170">I gruppi di sicurezza di rete consentono un controllo più granulare del traffico in entrata e in uscita consentito.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-170">Network Security Groups allow more granular control of allowed inbound and outbound traffic.</span></span> <span data-ttu-id="f4ed6-171">È possibile creare regole che si estendono alle subnet e ai servizi cloud in una rete virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-171">You can create rules spanning subnets and cloud services in an Azure virtual network.</span></span>

<span data-ttu-id="f4ed6-172">Utilizzare [flusso IP verificare](../../network-watcher/network-watcher-check-ip-flow-verify-portal.md) tooconfirm se una regola in un gruppo di sicurezza di rete sta bloccando il traffico tooor da una macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-172">Use [IP flow verify](../../network-watcher/network-watcher-check-ip-flow-verify-portal.md) tooconfirm if a rule in a Network Security Group is blocking traffic tooor from a virtual machine.</span></span> <span data-ttu-id="f4ed6-173">È anche possibile esaminare il gruppo di sicurezza efficace tooensure in ingresso "Consenti" gruppo di regole regole esiste e viene assegnata la priorità per la porta RDP (impostazione predefinita 3389).</span><span class="sxs-lookup"><span data-stu-id="f4ed6-173">You can also review effective security group rules tooensure inbound "Allow" NSG rule exists and is prioritized for RDP port(default 3389).</span></span> <span data-ttu-id="f4ed6-174">Per ulteriori informazioni, vedere [tootroubleshoot utilizzando regole di sicurezza efficace VM traffico](../../virtual-network/virtual-network-nsg-troubleshoot-portal.md#using-effective-security-rules-to-troubleshoot-vm-traffic-flow).</span><span class="sxs-lookup"><span data-stu-id="f4ed6-174">For more information, see [Using Effective Security Rules tootroubleshoot VM traffic flow](../../virtual-network/virtual-network-nsg-troubleshoot-portal.md#using-effective-security-rules-to-troubleshoot-vm-traffic-flow).</span></span>

## <a name="source-5-windows-based-azure-vm"></a><span data-ttu-id="f4ed6-175">Origine 5: Macchina virtuale di Azure basata su Windows</span><span class="sxs-lookup"><span data-stu-id="f4ed6-175">Source 5: Windows-based Azure VM</span></span>
![](./media/detailed-troubleshoot-rdp/tshootrdp_5.png)

<span data-ttu-id="f4ed6-176">Seguire le istruzioni hello [questo articolo](reset-rdp.md).</span><span class="sxs-lookup"><span data-stu-id="f4ed6-176">Follow hello instructions in [this article](reset-rdp.md).</span></span> <span data-ttu-id="f4ed6-177">In questo articolo consente di reimpostare il servizio di Desktop remoto sulla macchina virtuale hello hello:</span><span class="sxs-lookup"><span data-stu-id="f4ed6-177">This article resets hello Remote Desktop service on hello virtual machine:</span></span>

* <span data-ttu-id="f4ed6-178">Abilitare la regola predefinita di hello "Desktop remoto" Windows Firewall (porta TCP 3389).</span><span class="sxs-lookup"><span data-stu-id="f4ed6-178">Enable hello "Remote Desktop" Windows Firewall default rule (TCP port 3389).</span></span>
* <span data-ttu-id="f4ed6-179">Abilitare le connessioni Desktop remoto impostando hello HKLM\System\CurrentControlSet\Control\Terminal Server\fDenyTSConnections del Registro di sistema valore too0.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-179">Enable Remote Desktop connections by setting hello HKLM\System\CurrentControlSet\Control\Terminal Server\fDenyTSConnections registry value too0.</span></span>

<span data-ttu-id="f4ed6-180">Riprovare hello connessione dal computer.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-180">Try hello connection from your computer again.</span></span> <span data-ttu-id="f4ed6-181">Se si è ancora impossibile tooconnect tramite Desktop remoto, verificare la presenza hello possibili problemi seguenti:</span><span class="sxs-lookup"><span data-stu-id="f4ed6-181">If you are still not able tooconnect via Remote Desktop, check for hello following possible problems:</span></span>

* <span data-ttu-id="f4ed6-182">Hello servizio Desktop remoto non è in esecuzione sulla destinazione hello macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-182">hello Remote Desktop service is not running on hello target VM.</span></span>
* <span data-ttu-id="f4ed6-183">Hello servizio Desktop remoto non è in ascolto sulla porta TCP 3389.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-183">hello Remote Desktop service is not listening on TCP port 3389.</span></span>
* <span data-ttu-id="f4ed6-184">Windows Firewall o un altro firewall locale dispone di una regola in uscita che impedisce il traffico di Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-184">Windows Firewall or another local firewall has an outbound rule that is preventing Remote Desktop traffic.</span></span>
* <span data-ttu-id="f4ed6-185">Rilevamento delle intrusioni o software in esecuzione nella macchina virtuale di Azure hello di monitoraggio della rete impedisce le connessioni Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-185">Intrusion detection or network monitoring software running on hello Azure virtual machine is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="f4ed6-186">Per le macchine virtuali create utilizzando il modello di distribuzione classica hello, è possibile utilizzare un toohello di sessione di PowerShell di Azure remoto macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-186">For VMs created using hello classic deployment model, you can use a remote Azure PowerShell session toohello Azure virtual machine.</span></span> <span data-ttu-id="f4ed6-187">In primo luogo, è necessario tooinstall un certificato di servizio cloud di hosting della macchina virtuale hello.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-187">First, you need tooinstall a certificate for hello virtual machine's hosting cloud service.</span></span> <span data-ttu-id="f4ed6-188">Andare troppo[tooAzure configurare Secure PowerShell l'accesso remoto le macchine virtuali](http://gallery.technet.microsoft.com/scriptcenter/Configures-Secure-Remote-b137f2fe) e scaricare hello **InstallWinRMCertAzureVM.ps1** computer locale tooyour file di script.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-188">Go too[Configure Secure Remote PowerShell Access tooAzure Virtual Machines](http://gallery.technet.microsoft.com/scriptcenter/Configures-Secure-Remote-b137f2fe) and download hello **InstallWinRMCertAzureVM.ps1** script file tooyour local computer.</span></span>

<span data-ttu-id="f4ed6-189">Successivamente, installare Azure PowerShell, se non è stato già installato.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-189">Next, install Azure PowerShell if you haven't already.</span></span> <span data-ttu-id="f4ed6-190">Vedere [come tooinstall e configurare Azure PowerShell](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="f4ed6-190">See [How tooinstall and configure Azure PowerShell](/powershell/azure/overview).</span></span>

<span data-ttu-id="f4ed6-191">Successivamente, aprire un prompt dei comandi di Azure PowerShell e modificare hello toohello percorso della cartella corrente di hello **InstallWinRMCertAzureVM.ps1** file di script.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-191">Next, open an Azure PowerShell command prompt and change hello current folder toohello location of hello **InstallWinRMCertAzureVM.ps1** script file.</span></span> <span data-ttu-id="f4ed6-192">toorun uno script di PowerShell di Azure, è necessario impostare i criteri di esecuzione corretta di hello.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-192">toorun an Azure PowerShell script, you must set hello correct execution policy.</span></span> <span data-ttu-id="f4ed6-193">Eseguire hello **Get-ExecutionPolicy** comando toodetermine il livello corrente di criteri.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-193">Run hello **Get-ExecutionPolicy** command toodetermine your current policy level.</span></span> <span data-ttu-id="f4ed6-194">Per informazioni sull'impostazione livello appropriato di hello, vedere [Set-ExecutionPolicy](https://technet.microsoft.com/library/hh849812.aspx).</span><span class="sxs-lookup"><span data-stu-id="f4ed6-194">For information about setting hello appropriate level, see [Set-ExecutionPolicy](https://technet.microsoft.com/library/hh849812.aspx).</span></span>

<span data-ttu-id="f4ed6-195">Successivamente, compilare il nome della sottoscrizione di Azure, nome del servizio cloud hello e il nome della macchina virtuale (con rimozione hello < e > caratteri) e quindi eseguire i comandi.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-195">Next, fill in your Azure subscription name, hello cloud service name, and your virtual machine name (removing hello < and > characters), and then run these commands.</span></span>

```powershell
$subscr="<Name of your Azure subscription>"
$serviceName="<Name of hello cloud service that contains hello target virtual machine>"
$vmName="<Name of hello target virtual machine>"
.\InstallWinRMCertAzureVM.ps1 -SubscriptionName $subscr -ServiceName $serviceName -Name $vmName
```

<span data-ttu-id="f4ed6-196">È possibile ottenere il nome di sottoscrizione corretta hello da hello *SubscriptionName* proprietà di visualizzazione hello di hello **Get-AzureSubscription** comando.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-196">You can get hello correct subscription name from hello *SubscriptionName* property of hello display of hello **Get-AzureSubscription** command.</span></span> <span data-ttu-id="f4ed6-197">È possibile ottenere un nome del servizio cloud hello per la macchina virtuale hello da hello *ServiceName* colonna nell'area di visualizzazione di hello hello **Get-AzureVM** comando.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-197">You can get hello cloud service name for hello virtual machine from hello *ServiceName* column in hello display of hello **Get-AzureVM** command.</span></span>

<span data-ttu-id="f4ed6-198">Controllare se si dispone di hello nuovo certificato.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-198">Check if you have hello new certificate.</span></span> <span data-ttu-id="f4ed6-199">Aprire uno snap-in certificati per l'utente corrente hello e cercare nella hello **autorità di certificazione radice attendibili** cartella.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-199">Open a Certificates snap-in for hello current user and look in hello **Trusted Root Certification Authorities\Certificates** folder.</span></span> <span data-ttu-id="f4ed6-200">Verrà visualizzato un certificato con il nome DNS hello del servizio cloud in hello toocolumn rilasciato (esempio: cloudservice4testing.cloudapp.net).</span><span class="sxs-lookup"><span data-stu-id="f4ed6-200">You should see a certificate with hello DNS name of your cloud service in hello Issued toocolumn (example: cloudservice4testing.cloudapp.net).</span></span>

<span data-ttu-id="f4ed6-201">Successivamente, avviare una sessione remota di Azure PowerShell utilizzando questi comandi.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-201">Next, initiate a remote Azure PowerShell session by using these commands.</span></span>

```powershell
$uri = Get-AzureWinRMUri -ServiceName $serviceName -Name $vmName
$creds = Get-Credential
Enter-PSSession -ConnectionUri $uri -Credential $creds
```

<span data-ttu-id="f4ed6-202">Dopo aver immesso le credenziali di amministratore valido, verrà visualizzato un codice simile toohello dopo il prompt di PowerShell di Azure:</span><span class="sxs-lookup"><span data-stu-id="f4ed6-202">After entering valid administrator credentials, you should see something similar toohello following Azure PowerShell prompt:</span></span>

```powershell
[cloudservice4testing.cloudapp.net]: PS C:\Users\User1\Documents>
```

<span data-ttu-id="f4ed6-203">Hello prima parte di questo messaggio è il nome del servizio cloud che contiene la destinazione hello macchina virtuale, che può essere diverso da "cloudservice4testing.cloudapp.net".</span><span class="sxs-lookup"><span data-stu-id="f4ed6-203">hello first part of this prompt is your cloud service name that contains hello target VM, which could be different from "cloudservice4testing.cloudapp.net".</span></span> <span data-ttu-id="f4ed6-204">È possibile emettere comandi Azure PowerShell per il cloud problemi di hello tooinvestigate servizio indicati e correggere la configurazione hello.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-204">You can now issue Azure PowerShell commands for this cloud service tooinvestigate hello problems mentioned and correct hello configuration.</span></span>

### <a name="toomanually-correct-hello-remote-desktop-services-listening-tcp-port"></a><span data-ttu-id="f4ed6-205">hello corretto toomanually porta TCP in ascolto di Servizi Desktop remoto</span><span class="sxs-lookup"><span data-stu-id="f4ed6-205">toomanually correct hello Remote Desktop Services listening TCP port</span></span>
<span data-ttu-id="f4ed6-206">Al prompt di sessione PowerShell di Azure remoto hello, eseguire questo comando.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-206">At hello remote Azure PowerShell session prompt, run this command.</span></span>

```powershell
Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber"
```

<span data-ttu-id="f4ed6-207">proprietà PortNumber Hello Mostra il numero di porta corrente hello.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-207">hello PortNumber property shows hello current port number.</span></span> <span data-ttu-id="f4ed6-208">Se necessario, modificare hello Desktop remoto porta numero tooits indietro valore predefinito (3389) tramite questo comando.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-208">If needed, change hello Remote Desktop port number back tooits default value (3389) by using this command.</span></span>

```powershell
Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber" -Value 3389
```

<span data-ttu-id="f4ed6-209">Verificare che porta hello sia stato modificato too3389 tramite questo comando.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-209">Verify that hello port has been changed too3389 by using this command.</span></span>

```powershell
Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber"
```

<span data-ttu-id="f4ed6-210">Uscire dalla sessione remota di PowerShell di Azure hello tramite questo comando.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-210">Exit hello remote Azure PowerShell session by using this command.</span></span>

```powershell
Exit-PSSession
```

<span data-ttu-id="f4ed6-211">Verificare che hello endpoint Desktop remoto per la macchina virtuale di Azure hello utilizzata anche la porta TCP 3398 come la porta interna.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-211">Verify that hello Remote Desktop endpoint for hello Azure VM is also using TCP port 3398 as its internal port.</span></span> <span data-ttu-id="f4ed6-212">Riavviare hello Azure VM e riprovare hello connessione Desktop remoto.</span><span class="sxs-lookup"><span data-stu-id="f4ed6-212">Restart hello Azure VM and try hello Remote Desktop connection again.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="f4ed6-213">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="f4ed6-213">Additional resources</span></span>
[<span data-ttu-id="f4ed6-214">Come tooreset una password o hello Desktop remoto il servizio per le macchine virtuali Windows</span><span class="sxs-lookup"><span data-stu-id="f4ed6-214">How tooreset a password or hello Remote Desktop service for Windows virtual machines</span></span>](reset-rdp.md)

[<span data-ttu-id="f4ed6-215">Come tooinstall e configurare Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="f4ed6-215">How tooinstall and configure Azure PowerShell</span></span>](/powershell/azure/overview)

[<span data-ttu-id="f4ed6-216">Risoluzione dei problemi di Secure Shell (SSH) connessioni tooa basati su Linux macchina virtuale di Azure</span><span class="sxs-lookup"><span data-stu-id="f4ed6-216">Troubleshoot Secure Shell (SSH) connections tooa Linux-based Azure virtual machine</span></span>](../linux/troubleshoot-ssh-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

[<span data-ttu-id="f4ed6-217">Risoluzione dei problemi di accesso tooan applicazione in esecuzione in una macchina virtuale di Azure</span><span class="sxs-lookup"><span data-stu-id="f4ed6-217">Troubleshoot access tooan application running on an Azure virtual machine</span></span>](../linux/troubleshoot-app-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

