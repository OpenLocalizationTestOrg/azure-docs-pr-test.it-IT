---
title: servizi di rete per Hyper-V replica tooa VMM sito secondario con Azure Site Recovery aaaPlan | Documenti Microsoft
description: Questo articolo illustra la pianificazione di rete durante la replica delle macchine virtuali Hyper-V tooa System Center VMM sito secondario con Azure Site Recovery.
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 095f2d73-994e-4fc0-96f2-e03a7d72e492
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/27/2017
ms.author: raynew
ms.openlocfilehash: 5934db4a661a2c697a1a799c3848852250ddb451
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="step-3-plan-networking-for-hyper-v-vm-replication-tooa-secondary-vmm-site"></a><span data-ttu-id="50fd1-103">Passaggio 3: Pianificare la rete per macchina virtuale Hyper-V replica tooa VMM del sito secondario</span><span class="sxs-lookup"><span data-stu-id="50fd1-103">Step 3: Plan networking for Hyper-V VM replication tooa secondary VMM site</span></span>

<span data-ttu-id="50fd1-104">Dopo aver esaminato i prerequisiti per la distribuzione, leggere questo articolo di tooplan rete quando la replica delle macchine virtuali di Hyper-V (VM) gestite nei cloud di System Center Virtual Machine Manager (VMM), utilizzo del sito secondario tooa [diAzureSiteRecovery](site-recovery-overview.md) in hello portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="50fd1-104">After reviewing deployment prerequisites, read this article tooplan networking when replicating Hyper-V virtual machines (VMs) managed in System Center Virtual Machine Manager (VMM) clouds, tooa secondary site using [Azure Site Recovery](site-recovery-overview.md) in hello Azure portal.</span></span> 

<span data-ttu-id="50fd1-105">Dopo aver letto questo articolo, inviare eventuali commenti nella parte inferiore di hello o in hello [forum sui servizi di ripristino di Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="50fd1-105">After reading this article, post any comments at hello bottom, or on hello [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

## <a name="network-mapping-overview"></a><span data-ttu-id="50fd1-106">Panoramica del mapping di rete</span><span class="sxs-lookup"><span data-stu-id="50fd1-106">Network mapping overview</span></span>

<span data-ttu-id="50fd1-107">Mapping di rete viene utilizzato la replica Data Center secondario tooa di macchine virtuali Hyper-V (gestito in VMM).</span><span class="sxs-lookup"><span data-stu-id="50fd1-107">Network mapping is used when replicating Hyper-V VMs (managed in VMM) tooa secondary datacenter.</span></span> <span data-ttu-id="50fd1-108">Il mapping di rete esegue il mapping tra reti VM in un server VMM di origine e reti VM in un server VMM di destinazione.</span><span class="sxs-lookup"><span data-stu-id="50fd1-108">Network mapping maps between VM networks on a source VMM server, and VM networks on a target VMM server.</span></span> <span data-ttu-id="50fd1-109">Mapping hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="50fd1-109">Mapping does hello following:</span></span>

- <span data-ttu-id="50fd1-110">**Connessione di rete**, ovvero le reti di macchine virtuali si connette tooappropriate dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="50fd1-110">**Network connection**—Connects VMs tooappropriate networks after failover.</span></span> <span data-ttu-id="50fd1-111">replica di Hello VM verrà connesso toohello rete di destinazione di rete di origine mappata toohello.</span><span class="sxs-lookup"><span data-stu-id="50fd1-111">hello replica VM will be connected toohello target network that's mapped toohello source network.</span></span>
- <span data-ttu-id="50fd1-112">**Durante il posizionamento**, in modo ottimale decimali hello macchine virtuali di replica nel server host Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="50fd1-112">**Optimal placement**—Optimally places hello replica VMs on Hyper-V host servers.</span></span> <span data-ttu-id="50fd1-113">Macchine virtuali di replica vengono posizionate in host che possono hello accesso alle reti VM mappate.</span><span class="sxs-lookup"><span data-stu-id="50fd1-113">Replica VMs are placed on hosts that can access hello mapped VM networks.</span></span>
- <span data-ttu-id="50fd1-114">**Nessun mapping di rete**, se non si configura il mapping di rete, le macchine virtuali di replica non sarà le reti VM tooany connesse dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="50fd1-114">**No network mapping**—If you don’t configure network mapping, replica VMs won’t be connected tooany VM networks after failover.</span></span>


### <a name="example"></a><span data-ttu-id="50fd1-115">Esempio</span><span class="sxs-lookup"><span data-stu-id="50fd1-115">Example</span></span>

<span data-ttu-id="50fd1-116">Ecco un esempio tooillustrate questo meccanismo.</span><span class="sxs-lookup"><span data-stu-id="50fd1-116">Here’s an example tooillustrate this mechanism.</span></span> <span data-ttu-id="50fd1-117">Si prenda come esempio un’organizzazione con due sedi, New York e Chicago.</span><span class="sxs-lookup"><span data-stu-id="50fd1-117">Let’s take an organization with two locations in New York and Chicago.</span></span>

<span data-ttu-id="50fd1-118">**Posizione**</span><span class="sxs-lookup"><span data-stu-id="50fd1-118">**Location**</span></span> | <span data-ttu-id="50fd1-119">**Server VMM**</span><span class="sxs-lookup"><span data-stu-id="50fd1-119">**VMM server**</span></span> | <span data-ttu-id="50fd1-120">**Reti VM**</span><span class="sxs-lookup"><span data-stu-id="50fd1-120">**VM networks**</span></span> | <span data-ttu-id="50fd1-121">**Mappata a**</span><span class="sxs-lookup"><span data-stu-id="50fd1-121">**Mapped to**</span></span>
---|---|---|---
<span data-ttu-id="50fd1-122">New York</span><span class="sxs-lookup"><span data-stu-id="50fd1-122">New York</span></span> | <span data-ttu-id="50fd1-123">VMM-NewYork</span><span class="sxs-lookup"><span data-stu-id="50fd1-123">VMM-NewYork</span></span>| <span data-ttu-id="50fd1-124">VMNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="50fd1-124">VMNetwork1-NewYork</span></span> | <span data-ttu-id="50fd1-125">Mappato tooVMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="50fd1-125">Mapped tooVMNetwork1-Chicago</span></span>
 |  | <span data-ttu-id="50fd1-126">VMNetwork2-NewYork</span><span class="sxs-lookup"><span data-stu-id="50fd1-126">VMNetwork2-NewYork</span></span> | <span data-ttu-id="50fd1-127">Non mappata</span><span class="sxs-lookup"><span data-stu-id="50fd1-127">Not mapped</span></span>
<span data-ttu-id="50fd1-128">Chicago</span><span class="sxs-lookup"><span data-stu-id="50fd1-128">Chicago</span></span> | <span data-ttu-id="50fd1-129">VMM-Chicago</span><span class="sxs-lookup"><span data-stu-id="50fd1-129">VMM-Chicago</span></span>| <span data-ttu-id="50fd1-130">VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="50fd1-130">VMNetwork1-Chicago</span></span> | <span data-ttu-id="50fd1-131">TooVMNetwork1-NewYork mappato</span><span class="sxs-lookup"><span data-stu-id="50fd1-131">Mapped tooVMNetwork1-NewYork</span></span>
 | | <span data-ttu-id="50fd1-132">VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="50fd1-132">VMNetwork1-Chicago</span></span> | <span data-ttu-id="50fd1-133">Non mappata</span><span class="sxs-lookup"><span data-stu-id="50fd1-133">Not mapped</span></span>

<span data-ttu-id="50fd1-134">Esempio:</span><span class="sxs-lookup"><span data-stu-id="50fd1-134">In this example:</span></span>

- <span data-ttu-id="50fd1-135">Creazione di una macchina virtuale di replica per ogni macchina virtuale che è connesso tooVMNetwork1-NewYork, verrà connesso tooVMNetwork1-Chicago.</span><span class="sxs-lookup"><span data-stu-id="50fd1-135">When a replica virtual machine is created for any virtual machine that is connected tooVMNetwork1-NewYork, it will be connected tooVMNetwork1-Chicago.</span></span>
- <span data-ttu-id="50fd1-136">Quando una macchina virtuale di replica viene creata per VMNetwork2-NewYork o VMNetwork2-Chicago, non sarà connessa tooany rete.</span><span class="sxs-lookup"><span data-stu-id="50fd1-136">When a replica virtual machine is created for VMNetwork2-NewYork or VMNetwork2-Chicago, it will not be connected tooany network.</span></span>

<span data-ttu-id="50fd1-137">Ecco come vengono impostati cloud VMM, organizzazione di esempio e le reti logiche di hello associate hello cloud.</span><span class="sxs-lookup"><span data-stu-id="50fd1-137">Here's how VMM clouds are set up in our example organization, and hello logical networks associated with hello clouds.</span></span>

#### <a name="cloud-protection-settings"></a><span data-ttu-id="50fd1-138">Impostazioni di protezione del cloud</span><span class="sxs-lookup"><span data-stu-id="50fd1-138">Cloud protection settings</span></span>

<span data-ttu-id="50fd1-139">**Cloud protetto**</span><span class="sxs-lookup"><span data-stu-id="50fd1-139">**Protected cloud**</span></span> | <span data-ttu-id="50fd1-140">**Protezione del cloud**</span><span class="sxs-lookup"><span data-stu-id="50fd1-140">**Protecting cloud**</span></span> | <span data-ttu-id="50fd1-141">**Rete logica (New York)**</span><span class="sxs-lookup"><span data-stu-id="50fd1-141">**Logical network (New York)**</span></span>  
---|---|---
<span data-ttu-id="50fd1-142">GoldCloud1</span><span class="sxs-lookup"><span data-stu-id="50fd1-142">GoldCloud1</span></span> | <span data-ttu-id="50fd1-143">GoldCloud2</span><span class="sxs-lookup"><span data-stu-id="50fd1-143">GoldCloud2</span></span> |
<span data-ttu-id="50fd1-144">SilverCloud1</span><span class="sxs-lookup"><span data-stu-id="50fd1-144">SilverCloud1</span></span>| <span data-ttu-id="50fd1-145">SilverCloud2</span><span class="sxs-lookup"><span data-stu-id="50fd1-145">SilverCloud2</span></span> |
<span data-ttu-id="50fd1-146">GoldCloud2</span><span class="sxs-lookup"><span data-stu-id="50fd1-146">GoldCloud2</span></span> | <p><span data-ttu-id="50fd1-147">ND</span><span class="sxs-lookup"><span data-stu-id="50fd1-147">NA</span></span></p><p></p> | <p><span data-ttu-id="50fd1-148">LogicalNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="50fd1-148">LogicalNetwork1-NewYork</span></span></p><p><span data-ttu-id="50fd1-149">LogicalNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="50fd1-149">LogicalNetwork1-Chicago</span></span></p>
<span data-ttu-id="50fd1-150">SilverCloud2</span><span class="sxs-lookup"><span data-stu-id="50fd1-150">SilverCloud2</span></span> | <p><span data-ttu-id="50fd1-151">ND</span><span class="sxs-lookup"><span data-stu-id="50fd1-151">NA</span></span></p><p></p> | <p><span data-ttu-id="50fd1-152">LogicalNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="50fd1-152">LogicalNetwork1-NewYork</span></span></p><p><span data-ttu-id="50fd1-153">LogicalNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="50fd1-153">LogicalNetwork1-Chicago</span></span></p>

#### <a name="logical-and-vm-network-settings"></a><span data-ttu-id="50fd1-154">Impostazioni di rete VM e logica</span><span class="sxs-lookup"><span data-stu-id="50fd1-154">Logical and VM network settings</span></span>

<span data-ttu-id="50fd1-155">**Posizione**</span><span class="sxs-lookup"><span data-stu-id="50fd1-155">**Location**</span></span> | <span data-ttu-id="50fd1-156">**Rete logica**</span><span class="sxs-lookup"><span data-stu-id="50fd1-156">**Logical network**</span></span> | <span data-ttu-id="50fd1-157">**Rete VM associata**</span><span class="sxs-lookup"><span data-stu-id="50fd1-157">**Associated VM network**</span></span>
---|---|---
<span data-ttu-id="50fd1-158">New York</span><span class="sxs-lookup"><span data-stu-id="50fd1-158">New York</span></span> | <span data-ttu-id="50fd1-159">LogicalNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="50fd1-159">LogicalNetwork1-NewYork</span></span> | <span data-ttu-id="50fd1-160">VMNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="50fd1-160">VMNetwork1-NewYork</span></span>
<span data-ttu-id="50fd1-161">Chicago</span><span class="sxs-lookup"><span data-stu-id="50fd1-161">Chicago</span></span> | <span data-ttu-id="50fd1-162">LogicalNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="50fd1-162">LogicalNetwork1-Chicago</span></span> | <span data-ttu-id="50fd1-163">VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="50fd1-163">VMNetwork1-Chicago</span></span>
 | <span data-ttu-id="50fd1-164">LogicalNetwork2Chicago</span><span class="sxs-lookup"><span data-stu-id="50fd1-164">LogicalNetwork2Chicago</span></span> | <span data-ttu-id="50fd1-165">VMNetwork2-Chicago</span><span class="sxs-lookup"><span data-stu-id="50fd1-165">VMNetwork2-Chicago</span></span>

#### <a name="target-network-settings"></a><span data-ttu-id="50fd1-166">Impostazioni di rete di destinazione</span><span class="sxs-lookup"><span data-stu-id="50fd1-166">Target network settings</span></span>

<span data-ttu-id="50fd1-167">In base a queste impostazioni, quando si seleziona una rete VM di destinazione hello, hello nella tabella seguente mostra le scelte di hello che saranno disponibili.</span><span class="sxs-lookup"><span data-stu-id="50fd1-167">Based on these settings, when you select hello target VM network, hello following table shows hello choices that will be available.</span></span>

<span data-ttu-id="50fd1-168">**Select**</span><span class="sxs-lookup"><span data-stu-id="50fd1-168">**Select**</span></span> | <span data-ttu-id="50fd1-169">**Cloud protetto**</span><span class="sxs-lookup"><span data-stu-id="50fd1-169">**Protected cloud**</span></span> | <span data-ttu-id="50fd1-170">**Protezione del cloud**</span><span class="sxs-lookup"><span data-stu-id="50fd1-170">**Protecting cloud**</span></span> | <span data-ttu-id="50fd1-171">**Rete di destinazione disponibili**</span><span class="sxs-lookup"><span data-stu-id="50fd1-171">**Target network available**</span></span>
---|---|---|---
<span data-ttu-id="50fd1-172">VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="50fd1-172">VMNetwork1-Chicago</span></span> | <span data-ttu-id="50fd1-173">SilverCloud1</span><span class="sxs-lookup"><span data-stu-id="50fd1-173">SilverCloud1</span></span> | <span data-ttu-id="50fd1-174">SilverCloud2</span><span class="sxs-lookup"><span data-stu-id="50fd1-174">SilverCloud2</span></span> | <span data-ttu-id="50fd1-175">Disponibile</span><span class="sxs-lookup"><span data-stu-id="50fd1-175">Available</span></span>
 | <span data-ttu-id="50fd1-176">GoldCloud1</span><span class="sxs-lookup"><span data-stu-id="50fd1-176">GoldCloud1</span></span> | <span data-ttu-id="50fd1-177">GoldCloud2</span><span class="sxs-lookup"><span data-stu-id="50fd1-177">GoldCloud2</span></span> | <span data-ttu-id="50fd1-178">Disponibile</span><span class="sxs-lookup"><span data-stu-id="50fd1-178">Available</span></span>
<span data-ttu-id="50fd1-179">VMNetwork2-Chicago</span><span class="sxs-lookup"><span data-stu-id="50fd1-179">VMNetwork2-Chicago</span></span> | <span data-ttu-id="50fd1-180">SilverCloud1</span><span class="sxs-lookup"><span data-stu-id="50fd1-180">SilverCloud1</span></span> | <span data-ttu-id="50fd1-181">SilverCloud2</span><span class="sxs-lookup"><span data-stu-id="50fd1-181">SilverCloud2</span></span> | <span data-ttu-id="50fd1-182">Non disponibile</span><span class="sxs-lookup"><span data-stu-id="50fd1-182">Not available</span></span>
 | <span data-ttu-id="50fd1-183">GoldCloud1</span><span class="sxs-lookup"><span data-stu-id="50fd1-183">GoldCloud1</span></span> | <span data-ttu-id="50fd1-184">GoldCloud2</span><span class="sxs-lookup"><span data-stu-id="50fd1-184">GoldCloud2</span></span> | <span data-ttu-id="50fd1-185">Disponibile</span><span class="sxs-lookup"><span data-stu-id="50fd1-185">Available</span></span>


<span data-ttu-id="50fd1-186">Se la rete di destinazione hello dispone di più subnet e una di queste subnet ha hello stesso nome come hello subnet in cui hello macchina virtuale di origine si trova quindi hello macchina virtuale di replica sarà connessa toothat subnet di destinazione dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="50fd1-186">If hello target network has multiple subnets and one of those subnets has hello same name as hello subnet on which hello source virtual machine is located, then hello replica virtual machine will be connected toothat target subnet after failover.</span></span> <span data-ttu-id="50fd1-187">Se non è presente alcuna subnet di destinazione con un nome corrispondente, macchina virtuale hello sarà toohello connessi prima subnet nella rete hello.</span><span class="sxs-lookup"><span data-stu-id="50fd1-187">If there’s no target subnet with a matching name, hello virtual machine will be connected toohello first subnet in hello network.</span></span>


#### <a name="failback-behavior"></a><span data-ttu-id="50fd1-188">Comportamento di failback</span><span class="sxs-lookup"><span data-stu-id="50fd1-188">Failback behavior</span></span>

<span data-ttu-id="50fd1-189">toosee cosa accade nel caso di hello di failback (replica inversa), si supponga che VMNetwork1-NewYork è mappato tooVMNetwork1-Chicago, con le impostazioni seguenti hello.</span><span class="sxs-lookup"><span data-stu-id="50fd1-189">toosee what happens in hello case of failback (reverse replication), let’s assume that VMNetwork1-NewYork is mapped tooVMNetwork1-Chicago, with hello following settings.</span></span>


<span data-ttu-id="50fd1-190">**Macchina virtuale**</span><span class="sxs-lookup"><span data-stu-id="50fd1-190">**Virtual machine**</span></span> | <span data-ttu-id="50fd1-191">**Rete tooVM connesso**</span><span class="sxs-lookup"><span data-stu-id="50fd1-191">**Connected tooVM network**</span></span>
---|---
<span data-ttu-id="50fd1-192">VM1</span><span class="sxs-lookup"><span data-stu-id="50fd1-192">VM1</span></span> | <span data-ttu-id="50fd1-193">VMNetwork1-Network</span><span class="sxs-lookup"><span data-stu-id="50fd1-193">VMNetwork1-Network</span></span>
<span data-ttu-id="50fd1-194">VM2 (replica di VM1)</span><span class="sxs-lookup"><span data-stu-id="50fd1-194">VM2 (replica of VM1)</span></span> | <span data-ttu-id="50fd1-195">VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="50fd1-195">VMNetwork1-Chicago</span></span>

<span data-ttu-id="50fd1-196">Con queste impostazioni esaminare cosa accade in un paio di scenari possibili.</span><span class="sxs-lookup"><span data-stu-id="50fd1-196">With these settings, let's review what happens in a couple of possible scenarios.</span></span>

<span data-ttu-id="50fd1-197">**Scenario**</span><span class="sxs-lookup"><span data-stu-id="50fd1-197">**Scenario**</span></span> | <span data-ttu-id="50fd1-198">**Risultato**</span><span class="sxs-lookup"><span data-stu-id="50fd1-198">**Outcome**</span></span>
---|---
<span data-ttu-id="50fd1-199">Nessuna modifica apportata alle proprietà di rete hello di VM-2 dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="50fd1-199">No change in hello network properties of VM-2 after failover.</span></span> | <span data-ttu-id="50fd1-200">VM-1 rimane connessa toohello rete di origine.</span><span class="sxs-lookup"><span data-stu-id="50fd1-200">VM-1 remains connected toohello source network.</span></span>
<span data-ttu-id="50fd1-201">Le proprietà di rete di VM-2 cambiano dopo il failover e la macchina virtuale viene disconnessa </span><span class="sxs-lookup"><span data-stu-id="50fd1-201">Network properties of VM-2 are changed after failover and is disconnected.</span></span> | <span data-ttu-id="50fd1-202">VM-1 viene disconnessa</span><span class="sxs-lookup"><span data-stu-id="50fd1-202">VM-1 is disconnected.</span></span>
<span data-ttu-id="50fd1-203">Le proprietà di rete di VM-2 vengono modificate dopo il failover e viene connesso tooVMNetwork2-Chicago.</span><span class="sxs-lookup"><span data-stu-id="50fd1-203">Network properties of VM-2 are changed after failover and is connected tooVMNetwork2-Chicago.</span></span> | <span data-ttu-id="50fd1-204">Se non viene eseguito il mapping di VMNetwork2-Chicago, VM-1 verrà disconnessa</span><span class="sxs-lookup"><span data-stu-id="50fd1-204">If VMNetwork2-Chicago isn’t mapped, VM-1 will be disconnected.</span></span>
<span data-ttu-id="50fd1-205">Il mapping di rete di VMNetwork1-Chicago viene modificato</span><span class="sxs-lookup"><span data-stu-id="50fd1-205">Network mapping of VMNetwork1-Chicago is changed.</span></span> | <span data-ttu-id="50fd1-206">VM-1 verrà connessa toohello rete ora mappato tooVMNetwork1-Chicago.</span><span class="sxs-lookup"><span data-stu-id="50fd1-206">VM-1 will be connected toohello network now mapped tooVMNetwork1-Chicago.</span></span>



## <a name="prepare-for-network-mapping"></a><span data-ttu-id="50fd1-207">Preparare il mapping di rete</span><span class="sxs-lookup"><span data-stu-id="50fd1-207">Prepare for network mapping</span></span>

1. <span data-ttu-id="50fd1-208">Su hello origine e destinazione server VMM, è necessario disporre di una rete logica associata al cloud di origine e destinazione hello.</span><span class="sxs-lookup"><span data-stu-id="50fd1-208">On hello source and target VMM servers, you should have a logical network associated with hello source and target clouds.</span></span> 
2. <span data-ttu-id="50fd1-209">Nel server di origine e destinazione hello, è necessario disporre di una rete logica di rete collegati toohello macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="50fd1-209">In hello source and target servers, you should have a VM network linked toohello logical network.</span></span>
3. <span data-ttu-id="50fd1-210">Macchine virtuali in host Hyper-V nel percorso di origine hello devono essere collegato toohello rete VM di origine.</span><span class="sxs-lookup"><span data-stu-id="50fd1-210">VMs on Hyper-V hosts in hello source location should be linked toohello source VM network.</span></span> <span data-ttu-id="50fd1-211">Se si utilizza solo un singolo server VMM, è possibile configurare il mapping tra le reti VM hello stesso server.</span><span class="sxs-lookup"><span data-stu-id="50fd1-211">If you're only using a single VMM server, you can configure mapping between VM networks on hello same server.</span></span>

<span data-ttu-id="50fd1-212">Di seguito è riportato ciò che accede se si configura il mapping di rete durante la distribuzione di Site Recovery:</span><span class="sxs-lookup"><span data-stu-id="50fd1-212">Here's what happens when you set up network mapping during Site Recovery deployment:</span></span>

- <span data-ttu-id="50fd1-213">Quando si imposta il mapping di rete e selezionare una rete VM di destinazione, verrà visualizzato cloud di origine VMM hello che utilizzano una rete VM di origine hello, insieme a reti VM di destinazione disponibili hello nel cloud di destinazione hello.</span><span class="sxs-lookup"><span data-stu-id="50fd1-213">When you set up network mapping and select a target VM network, hello VMM source clouds that use hello source VM network will be displayed, along with hello available target VM networks on hello target clouds.</span></span>
- - <span data-ttu-id="50fd1-214">Quando il mapping è configurato correttamente e la replica è abilitata, una macchina virtuale di origine sarà connessa tooits rete VM di origine e la replica nel percorso di destinazione hello verrà connessa tooits eseguito il mapping di rete VM.</span><span class="sxs-lookup"><span data-stu-id="50fd1-214">When mapping is configured correctly and replication is enabled, a source VM will be connected tooits source VM network, and its replica at hello target location will be connected tooits mapped VM network.</span></span>
- <span data-ttu-id="50fd1-215">Se la rete di destinazione hello ha più subnet e una di queste subnet hello stesso nome come hello subnet in cui hello macchina virtuale di origine si trova quindi hello macchina virtuale di replica sarà connessa toothat subnet di destinazione dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="50fd1-215">If hello target network has multiple subnets, and one of those subnets has hello same name as hello subnet on which hello source virtual machine is located, then hello replica virtual machine will be connected toothat target subnet after failover.</span></span> <span data-ttu-id="50fd1-216">Se è presente alcuna subnet di destinazione con un nome corrispondente, hello macchina virtuale sarà connessa toohello prima subnet nella rete hello.</span><span class="sxs-lookup"><span data-stu-id="50fd1-216">If there’s no target subnet with a matching name, hello VM will be connected toohello first subnet in hello network.</span></span>

## <a name="connect-toovms-after-failover"></a><span data-ttu-id="50fd1-217">Connettere tooVMs dopo il failover</span><span class="sxs-lookup"><span data-stu-id="50fd1-217">Connect tooVMs after failover</span></span>

<span data-ttu-id="50fd1-218">Quando si pianifica la replica e la strategia di failover, una delle domande chiave hello è come tooconnect toohello replica dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="50fd1-218">When planning your replication and failover strategy, one of hello key questions is how tooconnect toohello replica after failover.</span></span> <span data-ttu-id="50fd1-219">Vi sono due possibilità:</span><span class="sxs-lookup"><span data-stu-id="50fd1-219">There are a couple of choices:</span></span> 

- <span data-ttu-id="50fd1-220">**Utilizzare un indirizzo IP diverso**: È possibile selezionare toouse un indirizzo IP diverso per hello replicati macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="50fd1-220">**Use a different IP address**: You can select toouse a different IP address for hello replicated VM.</span></span> <span data-ttu-id="50fd1-221">In questo hello scenario VM Ottiene un nuovo indirizzo IP dopo il failover ed è richiesto un aggiornamento DNS.</span><span class="sxs-lookup"><span data-stu-id="50fd1-221">In this scenario hello VM gets a new IP address after failover, and a DNS update is required.</span></span>
- <span data-ttu-id="50fd1-222">**Mantenere hello stesso indirizzo IP**: potrebbe essere necessario toouse hello stesso indirizzo IP per la replica hello macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="50fd1-222">**Retain hello same IP address**: You might want toouse hello same IP address for hello replica VM.</span></span> <span data-ttu-id="50fd1-223">Conservazione hello stessi indirizzi IP semplifica il ripristino di hello riducendo i problemi di rete dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="50fd1-223">Keeping hello same IP addresses simplifies hello recovery by reducing network related issues after failover.</span></span> 

## <a name="retain-ip-addresses"></a><span data-ttu-id="50fd1-224">Mantenere gli indirizzi IP</span><span class="sxs-lookup"><span data-stu-id="50fd1-224">Retain IP addresses</span></span>

<span data-ttu-id="50fd1-225">Se si desidera che gli indirizzi IP di hello tooretain dal sito primario di hello dopo il sito secondario toohello di failover, è possibile eseguire un failover completo subnet e aggiornare le route tooindicate hello nuovo percorso di indirizzi IP hello o alternativa distribuire una subnet tra hello estesa primario e hello siti di ripristino.</span><span class="sxs-lookup"><span data-stu-id="50fd1-225">If you want tooretain hello IP addresses from hello primary site after failover toohello secondary site, you can do a full subnet failover, and update routes tooindicate hello new location of hello IP addresses, or alternative deploy a stretched subnet between hello primary and hello recovery sites.</span></span>

### <a name="stretched-subnet"></a><span data-ttu-id="50fd1-226">Subnet estesa</span><span class="sxs-lookup"><span data-stu-id="50fd1-226">Stretched subnet</span></span>

<span data-ttu-id="50fd1-227">In una subnet, con estensione subnet hello è disponibile contemporaneamente in entrambi sito primario e secondario di hello.</span><span class="sxs-lookup"><span data-stu-id="50fd1-227">In a stretched subnet, hello subnet is available simultaneously in both hello primary and secondary site.</span></span> <span data-ttu-id="50fd1-228">Se si sposta un server e il relativo sito secondario di configuration toohello IP (livello 3), rete hello indirizzerà nuovo percorso di hello traffico toohello automaticamente.</span><span class="sxs-lookup"><span data-stu-id="50fd1-228">If you move a server and its IP (Layer 3) configuration toohello secondary site, hello network will route hello traffic toohello new location automatically.</span></span> 

<span data-ttu-id="50fd1-229">Dalla prospettiva del livello 2 (data-link layer), è necessario disporre di apparecchiature di rete in grado di gestire una VLAN estesa.</span><span class="sxs-lookup"><span data-stu-id="50fd1-229">From a Layer 2 (data link layer) perspective, you need networking equipment that can manage a stretched VLAN.</span></span> <span data-ttu-id="50fd1-230">Inoltre, dall'estensione hello VLAN, il dominio di errore potenziali hello estende siti tooboth, diventando essenzialmente un singolo punto di errore.</span><span class="sxs-lookup"><span data-stu-id="50fd1-230">In addition, by stretching hello VLAN, hello potential fault domain extends tooboth sites, essentially becoming a single point of failure.</span></span> <span data-ttu-id="50fd1-231">Tuttavia, l'eventualità di una broadcast storm impossibile da isolare è alquanto improbabile.</span><span class="sxs-lookup"><span data-stu-id="50fd1-231">While this is an unlikely, it could happen that a broadcast storm started and cannot be isolated.</span></span> 


### <a name="subnet-failover"></a><span data-ttu-id="50fd1-232">Failover sulla subnet</span><span class="sxs-lookup"><span data-stu-id="50fd1-232">Subnet failover</span></span>

<span data-ttu-id="50fd1-233">È possibile eseguire un hello tooobtain di failover su subnet vantaggi della subnet hello estesa, senza effettivamente l'estensione.</span><span class="sxs-lookup"><span data-stu-id="50fd1-233">You can run a subnet failover tooobtain hello benefits of hello stretched subnet, without actually stretching it.</span></span> <span data-ttu-id="50fd1-234">In questa soluzione, una subnet sarà disponibile nel sito di origine o destinazione hello, ma non entrambi contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="50fd1-234">In this solution, a subnet will be available in hello source or target site, but not at both simultaneously.</span></span> <span data-ttu-id="50fd1-235">toomaintain hello spazio degli indirizzi IP nell'evento hello di un failover, è possibile disporre a livello di programmazione per le subnet hello router infrastruttura toomove hello da un sito tooanother.</span><span class="sxs-lookup"><span data-stu-id="50fd1-235">toomaintain hello IP address space in hello event of a failover, you can programmatically arrange for hello router infrastructure toomove hello subnets from one site tooanother.</span></span> <span data-ttu-id="50fd1-236">Dopo il quando si verifica il failover, le subnet sposterebbe con hello associato macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="50fd1-236">After when failover occurs, subnets would move with hello associated VMs.</span></span> <span data-ttu-id="50fd1-237">svantaggio Hello è che in caso di hello di un errore, si dispone di toomove hello intera subnet.</span><span class="sxs-lookup"><span data-stu-id="50fd1-237">hello main drawback is that in hello event of a failure, you have toomove hello whole subnet.</span></span>

### <a name="example"></a><span data-ttu-id="50fd1-238">Esempio</span><span class="sxs-lookup"><span data-stu-id="50fd1-238">Example</span></span>

<span data-ttu-id="50fd1-239">Di seguito è riportato un esempio di failover su subnet completo.</span><span class="sxs-lookup"><span data-stu-id="50fd1-239">Here's an example of complete subnet failover.</span></span> <span data-ttu-id="50fd1-240">sito primario di Hello dispone di applicazioni in esecuzione in 192.168.1.0/24 subnet.</span><span class="sxs-lookup"><span data-stu-id="50fd1-240">hello primary site has applications running in subnet 192.168.1.0/24.</span></span> <span data-ttu-id="50fd1-241">In caso di failover, hello tutte le macchine virtuali in questa subnet viene eseguito il failover del sito secondario toohello e conservare gli indirizzi IP.</span><span class="sxs-lookup"><span data-stu-id="50fd1-241">At failover, all hello VMs in this subnet are failed over toohello secondary site, and retain their IP addresses.</span></span> <span data-ttu-id="50fd1-242">Route necessità toobe modificato dei fatti hello tooreflect tutte hello VM le macchine virtuali appartenenti toosubnet 192.168.1.0/24 che sono spostati toohello di sito secondario.</span><span class="sxs-lookup"><span data-stu-id="50fd1-242">Routes need toobe modified tooreflect hello fact that all hello VM virtual machines belonging toosubnet 192.168.1.0/24 have now moved toohello secondary site.</span></span>

<span data-ttu-id="50fd1-243">Hello seguenti grafici mostrano subnet hello prima e dopo il failover:</span><span class="sxs-lookup"><span data-stu-id="50fd1-243">hello following graphics show hello subnets before and after failover:</span></span>

- <span data-ttu-id="50fd1-244">Prima del failover, 192.168.0.1/24 subnet è attivo nel sito di origine hello, diventano attive nel sito secondario hello dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="50fd1-244">Before failover, subnet 192.168.0.1/24 is active on hello source site, become active on hello secondary site after failover.</span></span>
- <span data-ttu-id="50fd1-245">Hello instrada tra sito primario e sito di ripristino, terzo sito e del sito primario e sito terzo e il sito di ripristino avrà toobe modificate in modo appropriato.</span><span class="sxs-lookup"><span data-stu-id="50fd1-245">hello routes between primary site and recovery site, third site and primary site, and third site and recovery site will have toobe appropriately modified.</span></span>

<span data-ttu-id="50fd1-246">**Prima del failover**</span><span class="sxs-lookup"><span data-stu-id="50fd1-246">**Before failover**</span></span>

![Prima del failover](./media/vmm-to-vmm-walkthrough-network/network-design2.png)

<span data-ttu-id="50fd1-248">**Dopo il failover**</span><span class="sxs-lookup"><span data-stu-id="50fd1-248">**After failover**</span></span>

![Dopo il failover](./media/vmm-to-vmm-walkthrough-network/network-design3.png)

<span data-ttu-id="50fd1-250">Di seguito è illustrato ciò che accade dopo il failover:</span><span class="sxs-lookup"><span data-stu-id="50fd1-250">After failover, here's what happens:</span></span>

- <span data-ttu-id="50fd1-251">Il ripristino del sito alloca un indirizzo IP per ogni interfaccia di rete nella macchina virtuale, hello da hello pool indirizzi IP statici nella rete pertinente hello, per ogni istanza VMM.</span><span class="sxs-lookup"><span data-stu-id="50fd1-251">Site Recovery allocates an IP address for each network interface on hello VM, from hello static IP address pool in hello relevant network, for each VMM instance.</span></span>
- <span data-ttu-id="50fd1-252">Se il pool di indirizzi IP hello nel sito secondario hello è uguale a quello nel sito di origine hello, il ripristino del sito alloca hello hello stessa replica toohello di indirizzo (della macchina virtuale di origine hello) IP VM.</span><span class="sxs-lookup"><span data-stu-id="50fd1-252">If hello IP address pool in hello secondary site is hello same as that on hello source site, Site Recovery allocates hello same IP address (of hello source VM) toohello replica VM.</span></span> <span data-ttu-id="50fd1-253">indirizzo IP di Hello è riservato in VMM, ma non è impostato come indirizzo IP di failover hello in host Hyper-V hello.</span><span class="sxs-lookup"><span data-stu-id="50fd1-253">hello IP address is reserved in VMM, but it isn't set as hello failover IP address on hello Hyper-V host.</span></span> <span data-ttu-id="50fd1-254">indirizzo IP di failover Hello in un host Hyper-v è stata impostata solo prima del failover hello.</span><span class="sxs-lookup"><span data-stu-id="50fd1-254">hello failover IP address on a Hyper-v host is set just before hello failover.</span></span>
- <span data-ttu-id="50fd1-255">Se hello stesso indirizzo IP non è disponibile, il ripristino del sito alloca un altro indirizzo IP disponibile dal pool hello.</span><span class="sxs-lookup"><span data-stu-id="50fd1-255">If hello same IP address isn't available, Site Recovery allocates another available IP address from hello pool.</span></span>
- <span data-ttu-id="50fd1-256">Se le macchine virtuali utilizzano DHCP, il ripristino del sito non gestisce gli indirizzi IP hello.</span><span class="sxs-lookup"><span data-stu-id="50fd1-256">If VMs use DHCP, Site Recovery doesn't manage hello IP addresses.</span></span> <span data-ttu-id="50fd1-257">È necessario toocheck che hello DHCP server nel sito secondario hello possibile allocare l'indirizzo da hello stesso intervallo come sito di origine hello.</span><span class="sxs-lookup"><span data-stu-id="50fd1-257">You need toocheck that hello DHCP server on hello secondary site can allocate address from hello same range as hello source site.</span></span>

### <a name="validate-hello-ip-address"></a><span data-ttu-id="50fd1-258">Convalidare l'indirizzo IP hello</span><span class="sxs-lookup"><span data-stu-id="50fd1-258">Validate hello IP address</span></span>

<span data-ttu-id="50fd1-259">Dopo aver abilitato la protezione per una macchina virtuale, è possibile utilizzare seguente script di esempio tooverify hello indirizzo assegnato toohello macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="50fd1-259">After you enable protection for a VM, you can use following sample script tooverify hello address assigned toohello VM.</span></span> <span data-ttu-id="50fd1-260">Hello stesso indirizzo IP verrà impostato come indirizzo IP di failover hello e assegnato toohello VM al momento di hello di failover:</span><span class="sxs-lookup"><span data-stu-id="50fd1-260">hello same IP address will be set as hello failover IP address, and assigned toohello VM at hello time of failover:</span></span>

    ```
    $vm = Get-SCVirtualMachine -Name <VM_NAME>
    $na = $vm[0].VirtualNetworkAdapters>
    $ip = Get-SCIPAddress -GrantToObjectID $na[0].id
    $ip.address 
    ```

## <a name="changing-ip-addresses"></a><span data-ttu-id="50fd1-261">Modifica degli indirizzi IP</span><span class="sxs-lookup"><span data-stu-id="50fd1-261">Changing IP addresses</span></span>

<span data-ttu-id="50fd1-262">In questo scenario, vengono modificati gli indirizzi IP hello di macchine virtuali di cui eseguire il failover.</span><span class="sxs-lookup"><span data-stu-id="50fd1-262">In this scenario, hello IP addresses of VMs that fail over are changed.</span></span> <span data-ttu-id="50fd1-263">svantaggio Hello di questa soluzione è manutenzione hello richiesta.</span><span class="sxs-lookup"><span data-stu-id="50fd1-263">hello drawback of this solution is hello maintenance required.</span></span> <span data-ttu-id="50fd1-264">In genere, DNS verrà aggiornato dopo l'avvio delle macchine virtuali di replica.</span><span class="sxs-lookup"><span data-stu-id="50fd1-264">Typically, DNS will be updated after replica VMs start.</span></span> <span data-ttu-id="50fd1-265">Le voci DNS potrebbe essere necessario toobe modificato o fluster in rete e le voci memorizzate nella cache aggiornate.</span><span class="sxs-lookup"><span data-stu-id="50fd1-265">DNS entries might need toobe changed or fluster in thenetwork, and cached entries updated.</span></span> <span data-ttu-id="50fd1-266">Ciò può comportare tempi di inattività.</span><span class="sxs-lookup"><span data-stu-id="50fd1-266">This can result in downtime.</span></span> <span data-ttu-id="50fd1-267">Il tempo di inattività può essere contrastato come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="50fd1-267">Downtime can be mitigated as follows:</span></span>

- <span data-ttu-id="50fd1-268">Usare valori TTL bassi per le applicazioni Intranet.</span><span class="sxs-lookup"><span data-stu-id="50fd1-268">Use low TTL values for intranet applications.</span></span>
- <span data-ttu-id="50fd1-269">Utilizzare lo script seguente in un piano di ripristino di Site Recovery, tooupdate hello DNS server tooensure un aggiornamento tempestivo hello.</span><span class="sxs-lookup"><span data-stu-id="50fd1-269">Use hello following script in a Site Recovery recovery plan, tooupdate hello DNS server tooensure a timely update.</span></span> <span data-ttu-id="50fd1-270">Se si utilizza la registrazione dinamica DNS non è necessario script hello.</span><span class="sxs-lookup"><span data-stu-id="50fd1-270">You don't need hello script if you use dynamic DNS registration.</span></span>

    ```
    param(
    string]$Zone,
    [string]$name,
    [string]$IP
    )
    $Record = Get-DnsServerResourceRecord -ZoneName $zone -Name $name
    $newrecord = $record.clone()
    $newrecord.RecordData[0].IPv4Address  =  $IP
    Set-DnsServerResourceRecord -zonename $zone -OldInputObject $record -NewInputObject $Newrecord
    ```
    
### <a name="example"></a><span data-ttu-id="50fd1-271">Esempio</span><span class="sxs-lookup"><span data-stu-id="50fd1-271">Example</span></span> 

<span data-ttu-id="50fd1-272">Esaminiamo uno scenario in cui si sta pianificando toouse diversi indirizzi IP tra hello primario e siti di ripristino di hello. In questo esempio sono disponibili diversi indirizzi IP in siti primari e secondari e; s un terzo da cui le applicazioni ospitate nel sito primario o di ripristino di hello possibile accedere al sito.</span><span class="sxs-lookup"><span data-stu-id="50fd1-272">Let's look at a scenario in which you're planning toouse different IP addresses across hello primary and hello recovery sites.In this example we have different IP addresses across primary and secondary sites, and there;s a third site from which applications hosted on hello primary or recovery site can be accessed.</span></span>

- <span data-ttu-id="50fd1-273">Prima del failover, le app sono 192.168.1.0/24 subnet ospitata nel sito primario di hello e sono toobe configurate in subnet 172.16.1.0/24 nel sito secondario hello dopo un failover.</span><span class="sxs-lookup"><span data-stu-id="50fd1-273">Before failover, apps are hosted subnet 192.168.1.0/24 on hello primary site, and are configured toobe in subnet 172.16.1.0/24 on hello secondary site after a failover.</span></span>
- <span data-ttu-id="50fd1-274">La configurazione dei percorsi di rete o delle connessioni VPN è avvenuta in modo corretto, pertanto tutti e tre i siti dispongono dell'accesso reciproco.</span><span class="sxs-lookup"><span data-stu-id="50fd1-274">VPN connections/network routes have been configured appropriately so that all three sites can access each other.</span></span>
- <span data-ttu-id="50fd1-275">Dopo il failover, verranno ripristinate nella subnet ripristino hello app.</span><span class="sxs-lookup"><span data-stu-id="50fd1-275">After failover, apps will be restored in hello recovery subnet.</span></span> <span data-ttu-id="50fd1-276">In questo scenario non c'è alcuna necessità toofail sull'intera subnet hello e modifiche non sono necessari tooreconfigure VPN o rete route.</span><span class="sxs-lookup"><span data-stu-id="50fd1-276">In this scenario there's no need toofail over hello entire subnet, and no changes are needed tooreconfigure VPN or network routes.</span></span> <span data-ttu-id="50fd1-277">failover Hello e alcuni aggiornamenti DNS, verificare che le applicazioni rimangano accessibili.</span><span class="sxs-lookup"><span data-stu-id="50fd1-277">hello failover, and some DNS updates, ensure that applications remain accessible.</span></span>
- <span data-ttu-id="50fd1-278">Se gli aggiornamenti dinamici tooallow configurato il DNS, quindi le macchine virtuali hello effettueranno la registrazione mediante hello nuovo indirizzo IP, quando vengono avviati dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="50fd1-278">If DNS is configured tooallow dynamic updates, then hello VMs will register themselves using hello new IP address, when they start after failover.</span></span>

<span data-ttu-id="50fd1-279">**Prima del failover**</span><span class="sxs-lookup"><span data-stu-id="50fd1-279">**Before failover**</span></span>

![Indirizzo IP diverso - Prima del failover](./media/vmm-to-vmm-walkthrough-network/network-design10.png)

<span data-ttu-id="50fd1-281">**Dopo il failover**</span><span class="sxs-lookup"><span data-stu-id="50fd1-281">**After failover**</span></span>

![Indirizzo IP diverso - Dopo il failover](./media/vmm-to-vmm-walkthrough-network/network-design11.png)



## <a name="next-steps"></a><span data-ttu-id="50fd1-283">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="50fd1-283">Next steps</span></span>

<span data-ttu-id="50fd1-284">Andare troppo[passaggio 4: preparare VMM e Hyper-V](vmm-to-vmm-walkthrough-vmm-hyper-v.md).</span><span class="sxs-lookup"><span data-stu-id="50fd1-284">Go too[Step 4: Prepare VMM and Hyper-V](vmm-to-vmm-walkthrough-vmm-hyper-v.md).</span></span>


