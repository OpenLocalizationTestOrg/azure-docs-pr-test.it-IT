---
title: "report sull'integrità di Service Fabric personalizzato aaaAdd | Documenti Microsoft"
description: "Viene descritto come toosend personalizzato integrità segnala tooAzure entità di integrità dell'infrastruttura di servizio. Offre consigli per la progettazione e l'implementazione di report efficaci relativi all'integrità."
services: service-fabric
documentationcenter: .net
author: oanapl
manager: timlt
editor: 
ms.assetid: 0a00a7d2-510e-47d0-8aa8-24c851ea847f
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/19/2017
ms.author: oanapl
ms.openlocfilehash: 12c9f664e2a457b4e1e8f340873ca60ebcefb097
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="add-custom-service-fabric-health-reports"></a><span data-ttu-id="e8208-104">Aggiungere report sull'integrità di Service Fabric personalizzati</span><span class="sxs-lookup"><span data-stu-id="e8208-104">Add custom Service Fabric health reports</span></span>
<span data-ttu-id="e8208-105">Azure Service Fabric introduce un [modello di integrità](service-fabric-health-introduction.md) progettato tooflag integro cluster e le condizioni di applicazione per entità specifiche.</span><span class="sxs-lookup"><span data-stu-id="e8208-105">Azure Service Fabric introduces a [health model](service-fabric-health-introduction.md) designed tooflag unhealthy cluster and application conditions on specific entities.</span></span> <span data-ttu-id="e8208-106">utilizza il modello di integrità Hello **reporters integrità** (componenti di sistema e watchdog).</span><span class="sxs-lookup"><span data-stu-id="e8208-106">hello health model uses **health reporters** (system components and watchdogs).</span></span> <span data-ttu-id="e8208-107">obiettivo di Hello è ripristino e diagnostica rapida e semplice.</span><span class="sxs-lookup"><span data-stu-id="e8208-107">hello goal is easy and fast diagnosis and repair.</span></span> <span data-ttu-id="e8208-108">Gli autori del servizio necessario toothink anticipo sull'integrità.</span><span class="sxs-lookup"><span data-stu-id="e8208-108">Service writers need toothink upfront about health.</span></span> <span data-ttu-id="e8208-109">Qualsiasi condizione che può influire sull'integrità deve essere segnalati, soprattutto se ciò consente di chiudere toohello radice dei problemi di flag.</span><span class="sxs-lookup"><span data-stu-id="e8208-109">Any condition that can impact health should be reported on, especially if it can help flag problems close toohello root.</span></span> <span data-ttu-id="e8208-110">informazioni sull'integrità Hello risparmiare tempo e impegno sull'analisi e di debug.</span><span class="sxs-lookup"><span data-stu-id="e8208-110">hello health information can save time and effort on debugging and investigation.</span></span> <span data-ttu-id="e8208-111">Hello utilità è particolarmente evidente quando il servizio di hello è attivo e in esecuzione su larga scala nel cloud hello (privata o Azure).</span><span class="sxs-lookup"><span data-stu-id="e8208-111">hello usefulness is especially clear once hello service is up and running at scale in hello cloud (private or Azure).</span></span>

<span data-ttu-id="e8208-112">monitoraggio di Hello Service Fabric reporters identificato le condizioni di interesse.</span><span class="sxs-lookup"><span data-stu-id="e8208-112">hello Service Fabric reporters monitor identified conditions of interest.</span></span> <span data-ttu-id="e8208-113">Generano report su tali condizioni in base alla visualizzazione locale.</span><span class="sxs-lookup"><span data-stu-id="e8208-113">They report on those conditions based on their local view.</span></span> <span data-ttu-id="e8208-114">Hello [archivio integrità](service-fabric-health-introduction.md#health-store) aggrega i dati di integrità inviati da toodetermine reporters tutte le entità sono integra globale.</span><span class="sxs-lookup"><span data-stu-id="e8208-114">hello [health store](service-fabric-health-introduction.md#health-store) aggregates health data sent by all reporters toodetermine whether entities are globally healthy.</span></span> <span data-ttu-id="e8208-115">modello di Hello è previsto toobe RTF, flessibili e semplici toouse.</span><span class="sxs-lookup"><span data-stu-id="e8208-115">hello model is intended toobe rich, flexible, and easy toouse.</span></span> <span data-ttu-id="e8208-116">qualità Hello di report sull'integrità hello determina la precisione di visualizzazione dell'integrità del cluster hello hello hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-116">hello quality of hello health reports determines hello accuracy of hello health view of hello cluster.</span></span> <span data-ttu-id="e8208-117">I falsi positivi che visualizzano erroneamente problemi di non integrità possono influire negativamente sugli aggiornamenti o su altri servizi che usano i dati di integrità,</span><span class="sxs-lookup"><span data-stu-id="e8208-117">False positives that wrongly show unhealthy issues can negatively impact upgrades or other services that use health data.</span></span> <span data-ttu-id="e8208-118">come ad esempio i servizi di ripristino e i meccanismi di avviso.</span><span class="sxs-lookup"><span data-stu-id="e8208-118">Examples of such services are repair services and alerting mechanisms.</span></span> <span data-ttu-id="e8208-119">Pertanto, valutare diversi aspetti sono tooprovide necessari report che consentono di acquisire le condizioni di interesse in hello migliore dei modi possibili.</span><span class="sxs-lookup"><span data-stu-id="e8208-119">Therefore, some thought is needed tooprovide reports that capture conditions of interest in hello best possible way.</span></span>

<span data-ttu-id="e8208-120">toodesign e implementare report, watchdog e sistema componenti di integrità devono:</span><span class="sxs-lookup"><span data-stu-id="e8208-120">toodesign and implement health reporting, watchdogs and system components must:</span></span>

* <span data-ttu-id="e8208-121">Definire la condizione di hello che sono interessati, modo hello che viene monitorato e hello impatto sulle funzionalità di cluster o l'applicazione hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-121">Define hello condition they are interested in, hello way it is monitored, and hello impact on hello cluster or application functionality.</span></span> <span data-ttu-id="e8208-122">In base a queste informazioni, stabilire hello report proprietà e l'integrità stato di integrità.</span><span class="sxs-lookup"><span data-stu-id="e8208-122">Based on this information, decide on hello health report property and health state.</span></span>
* <span data-ttu-id="e8208-123">Determinare hello [entità](service-fabric-health-introduction.md#health-entities-and-hierarchy) che si riferisce hello report.</span><span class="sxs-lookup"><span data-stu-id="e8208-123">Determine hello [entity](service-fabric-health-introduction.md#health-entities-and-hierarchy) that hello report applies to.</span></span>
* <span data-ttu-id="e8208-124">Determinare reporting hello in cui viene eseguita dall'interno hello watchdog servizio o da un interno o esterno.</span><span class="sxs-lookup"><span data-stu-id="e8208-124">Determine where hello reporting is done, from within hello service or from an internal or external watchdog.</span></span>
* <span data-ttu-id="e8208-125">Definire il reporter hello tooidentify di origine utilizzata.</span><span class="sxs-lookup"><span data-stu-id="e8208-125">Define a source used tooidentify hello reporter.</span></span>
* <span data-ttu-id="e8208-126">Scegliere una strategia di creazione di report (periodicamente o in caso di transizioni).</span><span class="sxs-lookup"><span data-stu-id="e8208-126">Choose a reporting strategy, either periodically or on transitions.</span></span> <span data-ttu-id="e8208-127">Hello consigliato consiste periodicamente, ed è necessario semplificare il codice è meno soggetto tooerrors.</span><span class="sxs-lookup"><span data-stu-id="e8208-127">hello recommended way is periodically, as it requires simpler code and is less prone tooerrors.</span></span>
* <span data-ttu-id="e8208-128">Determinare il tempo report hello per le condizioni non integro devono rimanere nell'archivio integrità hello e la modalità deve essere cancellato.</span><span class="sxs-lookup"><span data-stu-id="e8208-128">Determine how long hello report for unhealthy conditions should stay in hello health store and how it should be cleared.</span></span> <span data-ttu-id="e8208-129">Utilizza queste informazioni, decidere di comportamento in fase di hello report toolive e Rimuovi alla scadenza.</span><span class="sxs-lookup"><span data-stu-id="e8208-129">Using this information, decide hello report's time toolive and remove-on-expiration behavior.</span></span>

<span data-ttu-id="e8208-130">Come indicato, i report possono essere creati da:</span><span class="sxs-lookup"><span data-stu-id="e8208-130">As mentioned, reporting can be done from:</span></span>

* <span data-ttu-id="e8208-131">Hello monitorati replica del servizio Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="e8208-131">hello monitored Service Fabric service replica.</span></span>
* <span data-ttu-id="e8208-132">Watchdog interni distribuiti come servizio di Service Fabric, ad esempio un servizio senza stato di Service Fabric che monitora le condizioni e genera i report.</span><span class="sxs-lookup"><span data-stu-id="e8208-132">Internal watchdogs deployed as a Service Fabric service (for example, a Service Fabric stateless service that monitors conditions and issues reports).</span></span> <span data-ttu-id="e8208-133">watchdog Hello può essere distribuito un tutti i nodi o può essere creata toohello monitorato servizio.</span><span class="sxs-lookup"><span data-stu-id="e8208-133">hello watchdogs can be deployed an all nodes or can be affinitized toohello monitored service.</span></span>
* <span data-ttu-id="e8208-134">Watchdog interno, ma eseguire nei nodi di Service Fabric hello *non* implementati come servizi di Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="e8208-134">Internal watchdogs that run on hello Service Fabric nodes but are *not* implemented as Service Fabric services.</span></span>
* <span data-ttu-id="e8208-135">Esterno watchdogs risorsa hello probe da *esterno* cluster di Service Fabric hello (ad esempio, servizio di monitoraggio come Gomez).</span><span class="sxs-lookup"><span data-stu-id="e8208-135">External watchdogs that probe hello resource from *outside* hello Service Fabric cluster (for example, monitoring service like Gomez).</span></span>

> [!NOTE]
> <span data-ttu-id="e8208-136">Viene fornita, hello cluster hello viene popolato con i rapporti di stati inviati dai componenti di sistema hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-136">Out of hello box, hello cluster is populated with health reports sent by hello system components.</span></span> <span data-ttu-id="e8208-137">Per altre informazioni, vedere [Uso dei report sull'integrità del sistema per la risoluzione dei problemi](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span><span class="sxs-lookup"><span data-stu-id="e8208-137">Read more at [Using system health reports for troubleshooting](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span></span> <span data-ttu-id="e8208-138">Hello report utente devono essere inviati [entità integrità](service-fabric-health-introduction.md#health-entities-and-hierarchy) che sono già stati creati dal sistema hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-138">hello user reports must be sent on [health entities](service-fabric-health-introduction.md#health-entities-and-hierarchy) that have already been created by hello system.</span></span>
> 
> 

<span data-ttu-id="e8208-139">Una volta hello Progettazione report di integrità è deselezionata, i rapporti di stato è possibile inviare facilmente.</span><span class="sxs-lookup"><span data-stu-id="e8208-139">Once hello health reporting design is clear, health reports can be sent easily.</span></span> <span data-ttu-id="e8208-140">È possibile utilizzare [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) tooreport integrità se non è cluster hello [sicura](service-fabric-cluster-security.md) o se il client di infrastruttura hello dispone di privilegi di amministratore.</span><span class="sxs-lookup"><span data-stu-id="e8208-140">You can use [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) tooreport health if hello cluster is not [secure](service-fabric-cluster-security.md) or if hello fabric client has admin privileges.</span></span> <span data-ttu-id="e8208-141">Creazione di report possono essere eseguite tramite hello API da utilizzando [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), PowerShell o tramite REST.</span><span class="sxs-lookup"><span data-stu-id="e8208-141">Reporting can be done through hello API by using [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), through PowerShell, or through REST.</span></span> <span data-ttu-id="e8208-142">Sono disponibili controlli di configurazione che riuniscono i report in batch per migliorare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="e8208-142">Configuration knobs batch reports for improved performance.</span></span>

> [!NOTE]
> <span data-ttu-id="e8208-143">Segnalare l'integrità è sincrono e rappresenta solo hello attività di convalida sul lato client hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-143">Report health is synchronous, and it represents only hello validation work on hello client side.</span></span> <span data-ttu-id="e8208-144">Hello fatto che hello report è accettata dal client di integrità hello o hello `Partition` o `CodePackageActivationContext` oggetti non significa che viene applicato nell'archivio di hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-144">hello fact that hello report is accepted by hello health client or hello `Partition` or `CodePackageActivationContext` objects doesn't mean that it is applied in hello store.</span></span> <span data-ttu-id="e8208-145">Viene inviato in modo asincrono e possibilmente in batch con altri report.</span><span class="sxs-lookup"><span data-stu-id="e8208-145">It is sent asynchronously and possibly batched with other reports.</span></span> <span data-ttu-id="e8208-146">elaborazione nel server di hello Hello ancora potrebbe non riuscire: numero di sequenza hello potrebbe essere non aggiornato, entità hello su quale hello report deve essere applicato è stato eliminato, e così via.</span><span class="sxs-lookup"><span data-stu-id="e8208-146">hello processing on hello server may still fail: hello sequence number could be stale, hello entity on which hello report must be applied has been deleted, etc.</span></span>
> 
> 

## <a name="health-client"></a><span data-ttu-id="e8208-147">Client di integrità</span><span class="sxs-lookup"><span data-stu-id="e8208-147">Health client</span></span>
<span data-ttu-id="e8208-148">Hello rapporti di stato vengono inviati tramite un client di integrità, che si trova all'interno del client fabric hello toohello dell'archivio integrità.</span><span class="sxs-lookup"><span data-stu-id="e8208-148">hello health reports are sent toohello health store through a health client, which lives inside hello fabric client.</span></span> <span data-ttu-id="e8208-149">Hello integrità client può essere configurato con hello seguenti impostazioni:</span><span class="sxs-lookup"><span data-stu-id="e8208-149">hello health client can be configured with hello following settings:</span></span>

* <span data-ttu-id="e8208-150">**HealthReportSendInterval**: ritardo hello tra report di hello tempo hello è aggiunto toohello client e hello ora dell'invio dell'archivio integrità toohello.</span><span class="sxs-lookup"><span data-stu-id="e8208-150">**HealthReportSendInterval**: hello delay between hello time hello report is added toohello client and hello time it is sent toohello health store.</span></span> <span data-ttu-id="e8208-151">Report toobatch utilizzati in un singolo messaggio, anziché inviare un messaggio per ogni report.</span><span class="sxs-lookup"><span data-stu-id="e8208-151">Used toobatch reports into a single message, rather than sending one message for each report.</span></span> <span data-ttu-id="e8208-152">Hello batch migliora le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="e8208-152">hello batching improves performance.</span></span> <span data-ttu-id="e8208-153">Impostazione predefinita: 30 secondi.</span><span class="sxs-lookup"><span data-stu-id="e8208-153">Default: 30 seconds.</span></span>
* <span data-ttu-id="e8208-154">**HealthReportRetrySendInterval**: intervallo hello in cui hello client integrità reinvia accumulato integrità segnala toohello dell'archivio integrità.</span><span class="sxs-lookup"><span data-stu-id="e8208-154">**HealthReportRetrySendInterval**: hello interval at which hello health client resends accumulated health reports toohello health store.</span></span> <span data-ttu-id="e8208-155">Impostazione predefinita: 30 secondi.</span><span class="sxs-lookup"><span data-stu-id="e8208-155">Default: 30 seconds.</span></span>
* <span data-ttu-id="e8208-156">**HealthOperationTimeout**: il periodo di timeout hello per un messaggio di rapporto inviato toohello dell'archivio integrità.</span><span class="sxs-lookup"><span data-stu-id="e8208-156">**HealthOperationTimeout**: hello timeout period for a report message sent toohello health store.</span></span> <span data-ttu-id="e8208-157">Se un messaggio scade, hello integrità client eseguirà dei tentativi, fino a quando l'archivio integrità hello conferma che il report hello è stato elaborato.</span><span class="sxs-lookup"><span data-stu-id="e8208-157">If a message times out, hello health client retries it until hello health store confirms that hello report has been processed.</span></span> <span data-ttu-id="e8208-158">Valore predefinito: due minuti.</span><span class="sxs-lookup"><span data-stu-id="e8208-158">Default: two minutes.</span></span>

> [!NOTE]
> <span data-ttu-id="e8208-159">Quando vengono eseguite in batch report hello del client fabric hello deve essere mantenuto attivo per almeno hello tooensure HealthReportSendInterval che vengono inviati.</span><span class="sxs-lookup"><span data-stu-id="e8208-159">When hello reports are batched, hello fabric client must be kept alive for at least hello HealthReportSendInterval tooensure that they are sent.</span></span> <span data-ttu-id="e8208-160">Se il messaggio hello viene perso o dell'archivio integrità hello non è possibile applicare a causa di errori tootransient, del client fabric hello deve essere mantenuto attivi toogive più tooretry una possibilità.</span><span class="sxs-lookup"><span data-stu-id="e8208-160">If hello message is lost or hello health store cannot apply them due tootransient errors, hello fabric client must be kept alive longer toogive it a chance tooretry.</span></span>
> 
> 

<span data-ttu-id="e8208-161">memorizzazione nel buffer Hello client hello accetta l'univocità hello dei report hello in considerazione.</span><span class="sxs-lookup"><span data-stu-id="e8208-161">hello buffering on hello client takes hello uniqueness of hello reports into consideration.</span></span> <span data-ttu-id="e8208-162">Ad esempio, se un particolare reporter non valido il reporting 100 rapporti al secondo su hello stessa proprietà di hello stessa entità, i report vengono sostituiti con l'ultima versione di hello hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-162">For example, if a particular bad reporter is reporting 100 reports per second on hello same property of hello same entity, hello reports are replaced with hello last version.</span></span> <span data-ttu-id="e8208-163">Al massimo una tale relazione esiste nella coda di hello client.</span><span class="sxs-lookup"><span data-stu-id="e8208-163">At most one such report exists in hello client queue.</span></span> <span data-ttu-id="e8208-164">Se l'invio in batch è configurata, il numero di hello dei report inviati archivio integrità toohello è solo una per l'intervallo di trasmissione.</span><span class="sxs-lookup"><span data-stu-id="e8208-164">If batching is configured, hello number of reports sent toohello health store is just one per send interval.</span></span> <span data-ttu-id="e8208-165">Questo report è hello ultimo aggiunto, che riflette lo stato più recente di hello dell'entità hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-165">This report is hello last added report, which reflects hello most current state of hello entity.</span></span>
<span data-ttu-id="e8208-166">Specificare i parametri di configurazione quando `FabricClient` viene creato passando [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) con hello valori desiderati per le voci di salute.</span><span class="sxs-lookup"><span data-stu-id="e8208-166">Specify configuration parameters when `FabricClient` is created by passing [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) with hello desired values for health-related entries.</span></span>

<span data-ttu-id="e8208-167">Hello esempio seguente viene creato un client di infrastruttura e specifica che devono essere inviati i report di hello quando vengono aggiunte.</span><span class="sxs-lookup"><span data-stu-id="e8208-167">hello following example creates a fabric client and specifies that hello reports should be sent when they are added.</span></span> <span data-ttu-id="e8208-168">In caso di timeout ed errori che supportano nuovi tentativi, questi vengono eseguiti ogni 40 secondi.</span><span class="sxs-lookup"><span data-stu-id="e8208-168">On timeouts and errors that can be retried, retries happen every 40 seconds.</span></span>

```csharp
var clientSettings = new FabricClientSettings()
{
    HealthOperationTimeout = TimeSpan.FromSeconds(120),
    HealthReportSendInterval = TimeSpan.FromSeconds(0),
    HealthReportRetrySendInterval = TimeSpan.FromSeconds(40),
};
var fabricClient = new FabricClient(clientSettings);
```

<span data-ttu-id="e8208-169">Si consiglia di mantenere le impostazioni di client, impostare dell'infrastruttura predefinito hello `HealthReportSendInterval` too30 secondi.</span><span class="sxs-lookup"><span data-stu-id="e8208-169">We recommend keeping hello default fabric client settings, which set `HealthReportSendInterval` too30 seconds.</span></span> <span data-ttu-id="e8208-170">Questa impostazione garantisce prestazioni ottimali toobatching scadenza.</span><span class="sxs-lookup"><span data-stu-id="e8208-170">This setting ensures optimal performance due toobatching.</span></span> <span data-ttu-id="e8208-171">Per i report critici che devono essere inviati il prima possibile, usare `HealthReportSendOptions` con il flag Immediate `true` nell'API [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth).</span><span class="sxs-lookup"><span data-stu-id="e8208-171">For critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true` in [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API.</span></span> <span data-ttu-id="e8208-172">Report immediato ignorare hello intervallo di invio in batch.</span><span class="sxs-lookup"><span data-stu-id="e8208-172">Immediate reports bypass hello batching interval.</span></span> <span data-ttu-id="e8208-173">Questo flag viene utilizzato con cautela; Vogliamo tootake vantaggio del client di integrità hello batch ogni volta che è possibile.</span><span class="sxs-lookup"><span data-stu-id="e8208-173">Use this flag with care; we want tootake advantage of hello health client batching whenever possible.</span></span> <span data-ttu-id="e8208-174">Invio immediato è utile anche quando la chiusura del client fabric hello (ad esempio, il processo di hello ha rilevato stato non valido e deve tooshut effetti collaterali tooprevent verso il basso).</span><span class="sxs-lookup"><span data-stu-id="e8208-174">Immediate send is also useful when hello fabric client is closing (for example, hello process has determined invalid state and needs tooshut down tooprevent side effects).</span></span> <span data-ttu-id="e8208-175">Assicura una trasmissione sforzo di hello accumulato report.</span><span class="sxs-lookup"><span data-stu-id="e8208-175">It ensures a best-effort send of hello accumulated reports.</span></span> <span data-ttu-id="e8208-176">Quando un report viene aggiunto con il flag di controllo immediato, il client di integrità hello invia in batch tutti i report di hello accumulato dall'ultimo invio.</span><span class="sxs-lookup"><span data-stu-id="e8208-176">When one report is added with Immediate flag, hello health client batches all hello accumulated reports since last send.</span></span>

<span data-ttu-id="e8208-177">Quando viene creato un cluster di tooa connessione tramite PowerShell, è possibile specificare parametri stessi.</span><span class="sxs-lookup"><span data-stu-id="e8208-177">Same parameters can be specified when a connection tooa cluster is created through PowerShell.</span></span> <span data-ttu-id="e8208-178">Hello di esempio seguente avvia un cluster locale tooa di connessione:</span><span class="sxs-lookup"><span data-stu-id="e8208-178">hello following example starts a connection tooa local cluster:</span></span>

```powershell
PS C:\> Connect-ServiceFabricCluster -HealthOperationTimeoutInSec 120 -HealthReportSendIntervalInSec 0 -HealthReportRetrySendIntervalInSec 40
True

ConnectionEndpoint   :
FabricClientSettings : {
                       ClientFriendlyName                   : PowerShell-1944858a-4c6d-465f-89c7-9021c12ac0bb
                       PartitionLocationCacheLimit          : 100000
                       PartitionLocationCacheBucketCount    : 1024
                       ServiceChangePollInterval            : 00:02:00
                       ConnectionInitializationTimeout      : 00:00:02
                       KeepAliveInterval                    : 00:00:20
                       HealthOperationTimeout               : 00:02:00
                       HealthReportSendInterval             : 00:00:00
                       HealthReportRetrySendInterval        : 00:00:40
                       NotificationGatewayConnectionTimeout : 00:00:00
                       NotificationCacheUpdateTimeout       : 00:00:00
                       }
GatewayInformation   : {
                       NodeAddress                          : localhost:19000
                       NodeId                               : 1880ec88a3187766a6da323399721f53
                       NodeInstanceId                       : 130729063464981219
                       NodeName                             : Node.1
                       }
```

<span data-ttu-id="e8208-179">Allo stesso modo tooAPI, i report possono essere inviati tramite `-Immediate` passare toobe inviato immediatamente, indipendentemente dal hello `HealthReportSendInterval` valore.</span><span class="sxs-lookup"><span data-stu-id="e8208-179">Similarly tooAPI, reports can be sent using `-Immediate` switch toobe sent immediately, regardless of hello `HealthReportSendInterval` value.</span></span>

<span data-ttu-id="e8208-180">Per REST, hello report vengono inviati i gateway di Service Fabric toohello, che dispone di un client di infrastruttura interni.</span><span class="sxs-lookup"><span data-stu-id="e8208-180">For REST, hello reports are sent toohello Service Fabric gateway, which has an internal fabric client.</span></span> <span data-ttu-id="e8208-181">Per impostazione predefinita, il client è configurato toosend report in batch ogni 30 secondi.</span><span class="sxs-lookup"><span data-stu-id="e8208-181">By default, this client is configured toosend reports batched every 30 seconds.</span></span> <span data-ttu-id="e8208-182">È possibile modificare l'intervallo di batch di hello con impostazione di configurazione di cluster hello `HttpGatewayHealthReportSendInterval` su `HttpGateway`.</span><span class="sxs-lookup"><span data-stu-id="e8208-182">You can change hello batch interval with hello cluster configuration setting `HttpGatewayHealthReportSendInterval` on `HttpGateway`.</span></span> <span data-ttu-id="e8208-183">Come accennato, un'opzione migliore è toosend hello report con `Immediate` true.</span><span class="sxs-lookup"><span data-stu-id="e8208-183">As mentioned, a better option is toosend hello reports with `Immediate` true.</span></span> 

> [!NOTE]
> <span data-ttu-id="e8208-184">tooensure che servizi non autorizzati non supporta la segnalazione dello stato con entità hello nel cluster hello, configurare le richieste di hello server tooaccept solo da client protetto.</span><span class="sxs-lookup"><span data-stu-id="e8208-184">tooensure that unauthorized services can't report health against hello entities in hello cluster, configure hello server tooaccept requests only from secured clients.</span></span> <span data-ttu-id="e8208-185">Hello `FabricClient` utilizzato per il report deve essere sicurezza abilitata toobe toocommunicate in grado di cluster hello (ad esempio, con l'autenticazione Kerberos o certificati).</span><span class="sxs-lookup"><span data-stu-id="e8208-185">hello `FabricClient` used for reporting must have security enabled toobe able toocommunicate with hello cluster (for example, with Kerberos or certificate authentication).</span></span> <span data-ttu-id="e8208-186">Per altre informazioni, vedere la pagina relativa alla [sicurezza del cluster](service-fabric-cluster-security.md).</span><span class="sxs-lookup"><span data-stu-id="e8208-186">Read more about [cluster security](service-fabric-cluster-security.md).</span></span>
> 
> 

## <a name="report-from-within-low-privilege-services"></a><span data-ttu-id="e8208-187">Report dai servizi con privilegi limitati</span><span class="sxs-lookup"><span data-stu-id="e8208-187">Report from within low privilege services</span></span>
<span data-ttu-id="e8208-188">Se i servizi di Service Fabric non sono in cluster toohello accesso di amministratore, è possibile segnalare l'integrità su entità di contesto corrente di hello tramite `Partition` o `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="e8208-188">If Service Fabric services do not have admin access toohello cluster, you can report health on entities from hello current context through `Partition` or `CodePackageActivationContext`.</span></span>

* <span data-ttu-id="e8208-189">Per i servizi senza stati, utilizzare [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) tooreport nell'istanza del servizio corrente hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-189">For stateless services, use [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) tooreport on hello current service instance.</span></span>
* <span data-ttu-id="e8208-190">Per i servizi con stati, utilizzare [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) tooreport nella replica corrente.</span><span class="sxs-lookup"><span data-stu-id="e8208-190">For stateful services, use [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) tooreport on current replica.</span></span>
* <span data-ttu-id="e8208-191">Utilizzare [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) tooreport nell'entità di partizione corrente hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-191">Use [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) tooreport on hello current partition entity.</span></span>
* <span data-ttu-id="e8208-192">Utilizzare [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) tooreport sull'applicazione corrente.</span><span class="sxs-lookup"><span data-stu-id="e8208-192">Use [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) tooreport on current application.</span></span>
* <span data-ttu-id="e8208-193">Utilizzare [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) tooreport sull'applicazione corrente di hello distribuita nel nodo corrente hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-193">Use [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) tooreport on hello current application deployed on hello current node.</span></span>
* <span data-ttu-id="e8208-194">Utilizzare [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) tooreport in un pacchetto del servizio per un'applicazione hello distribuito nel nodo corrente hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-194">Use [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) tooreport on a service package for hello application deployed on hello current node.</span></span>

> [!NOTE]
> <span data-ttu-id="e8208-195">Internamente, hello `Partition` hello e `CodePackageActivationContext` contengono un client di integrità configurato con le impostazioni predefinite.</span><span class="sxs-lookup"><span data-stu-id="e8208-195">Internally, hello `Partition` and hello `CodePackageActivationContext` hold a health client configured with default settings.</span></span> <span data-ttu-id="e8208-196">Come illustrato per hello [client integrità](service-fabric-report-health.md#health-client), i report vengono eseguiti in batch e inviati un timer.</span><span class="sxs-lookup"><span data-stu-id="e8208-196">As explained for hello [health client](service-fabric-report-health.md#health-client), reports are batched and sent on a timer.</span></span> <span data-ttu-id="e8208-197">gli oggetti di Hello devono essere mantenuti attivi toohave un report di hello toosend possibilità.</span><span class="sxs-lookup"><span data-stu-id="e8208-197">hello objects should be kept alive toohave a chance toosend hello report.</span></span>
> 
> 

<span data-ttu-id="e8208-198">È possibile specificare `HealthReportSendOptions` quando si inviano i report tramite le API di integrità `Partition` e `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="e8208-198">You can specify `HealthReportSendOptions` when sending reports through `Partition` and `CodePackageActivationContext` health APIs.</span></span> <span data-ttu-id="e8208-199">Per i report critici che devono essere inviati il prima possibile, usare `HealthReportSendOptions` con il flag Immediate `true`.</span><span class="sxs-lookup"><span data-stu-id="e8208-199">If you have critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true`.</span></span> <span data-ttu-id="e8208-200">Report immediato ignorare hello intervallo del client interno integrità hello di invio in batch.</span><span class="sxs-lookup"><span data-stu-id="e8208-200">Immediate reports bypass hello batching interval of hello internal health client.</span></span> <span data-ttu-id="e8208-201">Come accennato in precedenza, è possibile utilizzare questo flag con cautela; Vogliamo tootake vantaggio del client di integrità hello batch ogni volta che è possibile.</span><span class="sxs-lookup"><span data-stu-id="e8208-201">As mentioned before, use this flag with care; we want tootake advantage of hello health client batching whenever possible.</span></span>

## <a name="design-health-reporting"></a><span data-ttu-id="e8208-202">Creare report sull'integrità</span><span class="sxs-lookup"><span data-stu-id="e8208-202">Design health reporting</span></span>
<span data-ttu-id="e8208-203">Hello primo passaggio nella generazione di report di alta qualità è identificazione condizioni hello che possono influire sull'integrità hello del servizio hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-203">hello first step in generating high-quality reports is identifying hello conditions that can impact hello health of hello service.</span></span> <span data-ttu-id="e8208-204">Qualsiasi condizione che contribuisce di problemi di flag in cluster o il servizio di hello quando inizia-- o, ancora meglio, prima che si verifichi un problema, possono salvare miliardi di dollari.</span><span class="sxs-lookup"><span data-stu-id="e8208-204">Any condition that can help flag problems in hello service or cluster when it starts--or even better, before a problem happens--can potentially save billions of dollars.</span></span> <span data-ttu-id="e8208-205">vantaggi di Hello includono i tempi di inattività, un minor numero di ore notturne impiegato per l'analisi e la riparazione di problemi e soddisfazione del cliente.</span><span class="sxs-lookup"><span data-stu-id="e8208-205">hello benefits include less down time, fewer night hours spent investigating and repairing issues, and higher customer satisfaction.</span></span>

<span data-ttu-id="e8208-206">Dopo avere identificate le condizioni di hello, i writer watchdog necessario toofigure out hello toomonitor di modo migliore per bilanciamento tra overhead e utilità.</span><span class="sxs-lookup"><span data-stu-id="e8208-206">Once hello conditions are identified, watchdog writers need toofigure out hello best way toomonitor them for balance between overhead and usefulness.</span></span> <span data-ttu-id="e8208-207">Si consideri, ad esempio, un servizio che esegue calcoli complessi usando alcuni file temporanei in una condivisione.</span><span class="sxs-lookup"><span data-stu-id="e8208-207">For example, consider a service that does complex calculations that use some temporary files on a share.</span></span> <span data-ttu-id="e8208-208">Viene quindi monitorare hello condivisione tooensure che sia disponibile spazio sufficiente.</span><span class="sxs-lookup"><span data-stu-id="e8208-208">A watchdog could monitor hello share tooensure that enough space is available.</span></span> <span data-ttu-id="e8208-209">Può restare in attesa di notifiche relative a modifiche di file o directory.</span><span class="sxs-lookup"><span data-stu-id="e8208-209">It could listen for notifications of file or directory changes.</span></span> <span data-ttu-id="e8208-210">È possibile restituire un avviso se viene raggiunta una soglia iniziale e segnala un errore se la condivisione hello è piena.</span><span class="sxs-lookup"><span data-stu-id="e8208-210">It could report a warning if an upfront threshold is reached, and report an error if hello share is full.</span></span> <span data-ttu-id="e8208-211">Un avviso, è possibile avviare un sistema di correzione pulizia dei vecchi file nella condivisione di hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-211">On a warning, a repair system could start cleaning up older files on hello share.</span></span> <span data-ttu-id="e8208-212">In caso di errore, un sistema di riparazione potrebbe spostare nodo tooanother replica del servizio hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-212">On an error, a repair system could move hello service replica tooanother node.</span></span> <span data-ttu-id="e8208-213">Si noti come stati condizione hello vengono descritti in termini di integrità: hello lo stato di hello condizione che può essere considerato Integro (ok) o non integro (avviso o errore).</span><span class="sxs-lookup"><span data-stu-id="e8208-213">Note how hello condition states are described in terms of health: hello state of hello condition that can be considered healthy (ok) or unhealthy (warning or error).</span></span>

<span data-ttu-id="e8208-214">Dopo aver impostati i dettagli relativi al monitoraggio hello, un writer di watchdog deve toofigure out come tooimplement hello watchdog.</span><span class="sxs-lookup"><span data-stu-id="e8208-214">Once hello monitoring details are set, a watchdog writer needs toofigure out how tooimplement hello watchdog.</span></span> <span data-ttu-id="e8208-215">Se le condizioni di hello possono essere determinate dall'interno del servizio di hello, watchdog hello possono far parte del servizio hello monitorato.</span><span class="sxs-lookup"><span data-stu-id="e8208-215">If hello conditions can be determined from within hello service, hello watchdog can be part of hello monitored service itself.</span></span> <span data-ttu-id="e8208-216">Ad esempio, codice del servizio hello può controllare l'utilizzo della condivisione hello e quindi report ogni volta che tenta di toowrite un file.</span><span class="sxs-lookup"><span data-stu-id="e8208-216">For example, hello service code can check hello share usage, and then report every time it tries toowrite a file.</span></span> <span data-ttu-id="e8208-217">Hello vantaggio di questo approccio è che reporting è semplice.</span><span class="sxs-lookup"><span data-stu-id="e8208-217">hello advantage of this approach is that reporting is simple.</span></span> <span data-ttu-id="e8208-218">Prestare attenzione bug watchdog tooprevent impedendo che influiscano sulle funzionalità del servizio hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-218">Care must be taken tooprevent watchdog bugs from impacting hello service functionality.</span></span>

<span data-ttu-id="e8208-219">I rapporti in servizio hello monitorato non è sempre possibile.</span><span class="sxs-lookup"><span data-stu-id="e8208-219">Reporting from within hello monitored service is not always an option.</span></span> <span data-ttu-id="e8208-220">Un controllo all'interno del servizio hello potrebbe non essere toodetect in grado di condizioni di hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-220">A watchdog within hello service may not be able toodetect hello conditions.</span></span> <span data-ttu-id="e8208-221">Potrebbe non disporre di hello logica o dati toomake hello determinazione.</span><span class="sxs-lookup"><span data-stu-id="e8208-221">It may not have hello logic or data toomake hello determination.</span></span> <span data-ttu-id="e8208-222">il monitoraggio delle condizioni di hello sovraccarico Hello è elevato.</span><span class="sxs-lookup"><span data-stu-id="e8208-222">hello overhead of monitoring hello conditions may be high.</span></span> <span data-ttu-id="e8208-223">le condizioni di Hello anche potrebbero non essere servizio tooa specifico, ma invece influiscono sulle interazioni tra i servizi.</span><span class="sxs-lookup"><span data-stu-id="e8208-223">hello conditions also may not be specific tooa service, but instead affect interactions between services.</span></span> <span data-ttu-id="e8208-224">Un'altra opzione è toohave watchdog cluster hello come processo separato.</span><span class="sxs-lookup"><span data-stu-id="e8208-224">Another option is toohave watchdogs in hello cluster as separate processes.</span></span> <span data-ttu-id="e8208-225">watchdog Hello monitorare le condizioni di hello e report, senza influire su servizi principali di hello in alcun modo.</span><span class="sxs-lookup"><span data-stu-id="e8208-225">hello watchdogs monitor hello conditions and report, without affecting hello main services in any way.</span></span> <span data-ttu-id="e8208-226">Ad esempio, potrebbe essere implementato questi watchdog come servizi senza stati in hello stessa applicazione, distribuita in tutti i nodi o hello stessi nodi come servizio hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-226">For example, these watchdogs could be implemented as stateless services in hello same application, deployed on all nodes or on hello same nodes as hello service.</span></span>

<span data-ttu-id="e8208-227">In alcuni casi, un controllo in esecuzione in cluster hello non è un'opzione.</span><span class="sxs-lookup"><span data-stu-id="e8208-227">Sometimes, a watchdog running in hello cluster is not an option either.</span></span> <span data-ttu-id="e8208-228">Se hello monitorato è disponibilità hello o funzionalità del servizio hello come visualizzato agli utenti, è migliore watchdog di hello toohave in hello nello stesso punto come client utente hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-228">If hello monitored condition is hello availability or functionality of hello service as users see it, it's best toohave hello watchdogs in hello same place as hello user clients.</span></span> <span data-ttu-id="e8208-229">Non esiste, testano le operazioni di hello in hello stesso consente agli utenti chiamarle.</span><span class="sxs-lookup"><span data-stu-id="e8208-229">There, they can test hello operations in hello same way users call them.</span></span> <span data-ttu-id="e8208-230">Ad esempio, è possibile disporre di un controllo che si trova all'esterno del cluster hello e invia le richieste di servizio toohello controlla la latenza di hello e la correttezza dei risultati di hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-230">For example, you can have a watchdog that lives outside hello cluster, issues requests toohello service, and checks hello latency and correctness of hello result.</span></span> <span data-ttu-id="e8208-231">Ad esempio, per un servizio calcolatrice, verificare se l'operazione 2+2 restituisce 4 in tempi ragionevoli.</span><span class="sxs-lookup"><span data-stu-id="e8208-231">(For a calculator service, for example, does 2+2 return 4 in a reasonable amount of time?)</span></span>

<span data-ttu-id="e8208-232">Una volta i dettagli di watchdog hello sono stati completati, è necessario decidere su un ID di origine che lo identifichi.</span><span class="sxs-lookup"><span data-stu-id="e8208-232">Once hello watchdog details have been finalized, you should decide on a source ID that uniquely identifies it.</span></span> <span data-ttu-id="e8208-233">Se più watchdog di hello stesso tipo sono persone che vivono in hello cluster, si deve segnalare diverse entità o, se si riferiscono hello stessa entità, l'ID di origine diversa di utilizzare o proprietà.</span><span class="sxs-lookup"><span data-stu-id="e8208-233">If multiple watchdogs of hello same type are living in hello cluster, they must report on different entities, or, if they report on hello same entity, use different source ID or property.</span></span> <span data-ttu-id="e8208-234">In questo modo, i report possono coesistere.</span><span class="sxs-lookup"><span data-stu-id="e8208-234">This way, their reports can coexist.</span></span> <span data-ttu-id="e8208-235">proprietà Hello del rapporto di stato hello deve acquisire condizione hello monitorato.</span><span class="sxs-lookup"><span data-stu-id="e8208-235">hello property of hello health report should capture hello monitored condition.</span></span> <span data-ttu-id="e8208-236">(Ad esempio hello precedente, potrebbe essere proprietà hello **ShareSize**.) Se più report applica toohello stessa condizione, hello proprietà deve contenere alcune informazioni dinamiche che consente di toocoexist di report.</span><span class="sxs-lookup"><span data-stu-id="e8208-236">(For hello example above, hello property could be **ShareSize**.) If multiple reports apply toohello same condition, hello property should contain some dynamic information that allows reports toocoexist.</span></span> <span data-ttu-id="e8208-237">Ad esempio, più condivisioni necessario toobe monitorati, può essere il nome di proprietà hello **ShareSize sharename**.</span><span class="sxs-lookup"><span data-stu-id="e8208-237">For example, if multiple shares need toobe monitored, hello property name can be **ShareSize-sharename**.</span></span>

> [!NOTE]
> <span data-ttu-id="e8208-238">Eseguire *non* utilizzare informazioni di stato tookeep archivio integrità hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-238">Do *not* use hello health store tookeep status information.</span></span> <span data-ttu-id="e8208-239">Solo le informazioni correlate di integrità devono essere segnalate come integrità, come la valutazione dell'integrità informazioni hello impatto di un'entità.</span><span class="sxs-lookup"><span data-stu-id="e8208-239">Only health-related information should be reported as health, as this information impacts hello health evaluation of an entity.</span></span> <span data-ttu-id="e8208-240">archivio integrità Hello non è stata progettata come archivio di uso generale.</span><span class="sxs-lookup"><span data-stu-id="e8208-240">hello health store was not designed as a general-purpose store.</span></span> <span data-ttu-id="e8208-241">Usa tooaggregate logica di valutazione salute tutti i dati in stato di integrità hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-241">It uses health evaluation logic tooaggregate all data into hello health state.</span></span> <span data-ttu-id="e8208-242">L'invio di informazioni correlate toohealth (ad esempio segnalazione dello stato con uno stato di integrità di OK) non influisce sulla hello aggregato dello stato di integrità, ma può influire negativamente sulle prestazioni di hello dell'archivio integrità hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-242">Sending information unrelated toohealth (like reporting status with a health state of OK) doesn't impact hello aggregated health state, but it can negatively affect hello performance of hello health store.</span></span>
> 
> 

<span data-ttu-id="e8208-243">il punto di decisione Avanti Hello è tooreport quali entità.</span><span class="sxs-lookup"><span data-stu-id="e8208-243">hello next decision point is which entity tooreport on.</span></span> <span data-ttu-id="e8208-244">La maggior parte del tempo di hello, condizione hello chiaramente idetifies hello entità.</span><span class="sxs-lookup"><span data-stu-id="e8208-244">Most of hello time, hello condition clearly idetifies hello entity.</span></span> <span data-ttu-id="e8208-245">Scegliere l'entità hello con granularità possibili migliore.</span><span class="sxs-lookup"><span data-stu-id="e8208-245">Choose hello entity with best possible granularity.</span></span> <span data-ttu-id="e8208-246">Se una condizione influisce su tutte le repliche in una partizione, report sulla partizione di hello, non sul servizio hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-246">If a condition impacts all replicas in a partition, report on hello partition, not on hello service.</span></span> <span data-ttu-id="e8208-247">Esistono tuttavia casi particolari che richiedono maggiore attenzione.</span><span class="sxs-lookup"><span data-stu-id="e8208-247">There are corner cases where more thought is needed, though.</span></span> <span data-ttu-id="e8208-248">Se la condizione hello influisce su un'entità, ad esempio una replica, ma hello desiderio è toohave hello condizione contrassegnati per più di durata hello del ciclo di vita di replica, quindi deve essere segnalato nella partizione hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-248">If hello condition impacts an entity, such as a replica, but hello desire is toohave hello condition flagged for more than hello duration of replica life, then it should be reported on hello partition.</span></span> <span data-ttu-id="e8208-249">In caso contrario, quando viene eliminato replica hello, archivio integrità hello Pulisce tutti i relativi report.</span><span class="sxs-lookup"><span data-stu-id="e8208-249">Otherwise, when hello replica is deleted, hello health store cleans up all its reports.</span></span> <span data-ttu-id="e8208-250">Durata hello delle entità hello e report hello necessario valutare i writer di watchdog.</span><span class="sxs-lookup"><span data-stu-id="e8208-250">Watchdog writers must think about hello lifetimes of hello entity and hello report.</span></span> <span data-ttu-id="e8208-251">È necessario specificare chiaramente quando rimuovere un report da un archivio, ad esempio quando un errore segnalato per un'entità non si verifica più.</span><span class="sxs-lookup"><span data-stu-id="e8208-251">It must be clear when a report should be cleaned up from a store (for example, when an error reported on an entity no longer applies).</span></span>

<span data-ttu-id="e8208-252">Esaminiamo un esempio che riunisce punti hello descritto.</span><span class="sxs-lookup"><span data-stu-id="e8208-252">Let's look at an example that puts together hello points I described.</span></span> <span data-ttu-id="e8208-253">Si consideri un'applicazione di Service Fabric composta da un servizio master con stato persistente e servizi secondari senza stato distribuiti in tutti i nodi, ovvero un tipo di servizio secondario per ogni tipo di attività.</span><span class="sxs-lookup"><span data-stu-id="e8208-253">Consider a Service Fabric application composed of a master stateful persistent service and secondary stateless services deployed on all nodes (one secondary service type for each type of task).</span></span> <span data-ttu-id="e8208-254">master Hello dispone di una coda di elaborazione che contiene i comandi toobe eseguita dal database secondari.</span><span class="sxs-lookup"><span data-stu-id="e8208-254">hello master has a processing queue that contains commands toobe executed by secondaries.</span></span> <span data-ttu-id="e8208-255">repliche secondarie Hello eseguire le richieste in ingresso hello e l'invio acknowledgement indietro segnali.</span><span class="sxs-lookup"><span data-stu-id="e8208-255">hello secondaries execute hello incoming requests and send back acknowledgement signals.</span></span> <span data-ttu-id="e8208-256">Una condizione che può essere necessario monitorare è lunghezza hello della coda di elaborazione principale hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-256">One condition that could be monitored is hello length of hello master processing queue.</span></span> <span data-ttu-id="e8208-257">Se lunghezza coda master hello raggiunge una soglia, viene segnalato un avviso.</span><span class="sxs-lookup"><span data-stu-id="e8208-257">If hello master queue length reaches a threshold, a warning is reported.</span></span> <span data-ttu-id="e8208-258">avviso di Hello indica che le repliche secondarie hello non è possibile gestire il carico di hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-258">hello warning indicates that hello secondaries can't handle hello load.</span></span> <span data-ttu-id="e8208-259">Se la coda hello raggiunge la lunghezza massima di hello e i comandi vengono eliminati, viene restituito un errore, come hello servizio non è possibile ripristinare.</span><span class="sxs-lookup"><span data-stu-id="e8208-259">If hello queue reaches hello maximum length and commands are dropped, an error is reported, as hello service can't recover.</span></span> <span data-ttu-id="e8208-260">Hello i report possono essere proprietà hello **QueueStatus**.</span><span class="sxs-lookup"><span data-stu-id="e8208-260">hello reports can be on hello property **QueueStatus**.</span></span> <span data-ttu-id="e8208-261">watchdog Hello si trova all'interno del servizio hello e vengono inviata periodicamente nella replica primaria master hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-261">hello watchdog lives inside hello service, and it's sent periodically on hello master primary replica.</span></span> <span data-ttu-id="e8208-262">tempo di Hello toolive è due minuti, e vengono inviato periodicamente ogni 30 secondi.</span><span class="sxs-lookup"><span data-stu-id="e8208-262">hello time toolive is two minutes, and it's sent periodically every 30 seconds.</span></span> <span data-ttu-id="e8208-263">Se si arresta hello primario, i report di hello viene pulito automaticamente dall'archivio.</span><span class="sxs-lookup"><span data-stu-id="e8208-263">If hello primary goes down, hello report is cleaned up automatically from store.</span></span> <span data-ttu-id="e8208-264">Se la replica del servizio hello è attivo, ma si verifica il deadlock o altri problemi, hello scadenza nell'archivio integrità hello di report.</span><span class="sxs-lookup"><span data-stu-id="e8208-264">If hello service replica is up, but it is deadlocked or having other issues, hello report expires in hello health store.</span></span> <span data-ttu-id="e8208-265">In questo caso, l'entità hello viene valutata in errore.</span><span class="sxs-lookup"><span data-stu-id="e8208-265">In this case, hello entity is evaluated at error.</span></span>

<span data-ttu-id="e8208-266">Un'altra condizione che può essere monitorata è il tempo di esecuzione delle attività.</span><span class="sxs-lookup"><span data-stu-id="e8208-266">Another condition that can be monitored is task execution time.</span></span> <span data-ttu-id="e8208-267">Hello master distribuisce le attività secondarie toohello in base al tipo di attività hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-267">hello master distributes tasks toohello secondaries based on hello task type.</span></span> <span data-ttu-id="e8208-268">A seconda della progettazione di hello, master hello Impossibile eseguire il polling di database secondari hello per lo stato dell'attività.</span><span class="sxs-lookup"><span data-stu-id="e8208-268">Depending on hello design, hello master could poll hello secondaries for task status.</span></span> <span data-ttu-id="e8208-269">Anche potrebbe attendere repliche secondarie toosend indietro riconoscimento segnala quando vengono eseguite.</span><span class="sxs-lookup"><span data-stu-id="e8208-269">It could also wait for secondaries toosend back acknowledgement signals when they are done.</span></span> <span data-ttu-id="e8208-270">Nel secondo caso hello, prestare attenzione toodetect situazioni in cui vengono persi datati secondari o i messaggi.</span><span class="sxs-lookup"><span data-stu-id="e8208-270">In hello second case, care must be taken toodetect situations where secondaries die or messages are lost.</span></span> <span data-ttu-id="e8208-271">Un'opzione è per hello master toosend un toohello richiesta ping stessa secondaria, che consente di inviare nuovamente il relativo stato.</span><span class="sxs-lookup"><span data-stu-id="e8208-271">One option is for hello master toosend a ping request toohello same secondary, which sends back its status.</span></span> <span data-ttu-id="e8208-272">Se viene ricevuto nessuno stato, master hello considera un errore e ripianifica l'attività hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-272">If no status is received, hello master considers it a failure and reschedules hello task.</span></span> <span data-ttu-id="e8208-273">Questo comportamento presuppone che l'attività hello idempotente.</span><span class="sxs-lookup"><span data-stu-id="e8208-273">This behavior assumes that hello tasks are idempotent.</span></span>

<span data-ttu-id="e8208-274">condizione Hello monitorato può essere convertiti come un avviso se l'attività hello è stata eseguita in un certo periodo di tempo (**t1**, ad esempio 10 minuti).</span><span class="sxs-lookup"><span data-stu-id="e8208-274">hello monitored condition can be translated as a warning if hello task is not done in a certain time (**t1**, for example 10 minutes).</span></span> <span data-ttu-id="e8208-275">Se l'attività hello non è stato completato nel tempo (**t2**, ad esempio 20 minuti), condizione hello monitorato può essere convertiti come errore.</span><span class="sxs-lookup"><span data-stu-id="e8208-275">If hello task is not completed in time (**t2**, for example 20 minutes), hello monitored condition can be translated as Error.</span></span> <span data-ttu-id="e8208-276">Questo tipo di report può essere creato in diversi modi:</span><span class="sxs-lookup"><span data-stu-id="e8208-276">This reporting can be done in multiple ways:</span></span>

* <span data-ttu-id="e8208-277">replica primaria master Hello report periodicamente su se stesso.</span><span class="sxs-lookup"><span data-stu-id="e8208-277">hello master primary replica reports on itself periodically.</span></span> <span data-ttu-id="e8208-278">È possibile avere una proprietà per tutte le attività in sospeso nella coda di hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-278">You can have one property for all pending tasks in hello queue.</span></span> <span data-ttu-id="e8208-279">Se almeno una delle attività richiede più tempo, hello segnalare lo stato di proprietà hello **PendingTasks** è un avviso o errore, come appropriato.</span><span class="sxs-lookup"><span data-stu-id="e8208-279">If at least one task takes longer, hello report status on hello property **PendingTasks** is a warning or error, as appropriate.</span></span> <span data-ttu-id="e8208-280">Se non sono presenti attività in sospeso o tutte le attività ha avviato l'esecuzione, lo stato di report hello è OK.</span><span class="sxs-lookup"><span data-stu-id="e8208-280">If there are no pending tasks or all tasks started execution, hello report status is OK.</span></span> <span data-ttu-id="e8208-281">attività Hello sono persistenti.</span><span class="sxs-lookup"><span data-stu-id="e8208-281">hello tasks are persistent.</span></span> <span data-ttu-id="e8208-282">Se hello primario diventa inattiva, primario hello appena promosso può continuare tooreport correttamente.</span><span class="sxs-lookup"><span data-stu-id="e8208-282">If hello primary goes down, hello newly promoted primary can continue tooreport properly.</span></span>
* <span data-ttu-id="e8208-283">Un altro processo watchdog (in cloud hello o esterne) Controlla attività hello (da esterno, basato sul risultato dell'attività hello desiderato) toosee se vengono completati.</span><span class="sxs-lookup"><span data-stu-id="e8208-283">Another watchdog process (in hello cloud or external) checks hello tasks (from outside, based on hello desired task result) toosee if they are completed.</span></span> <span data-ttu-id="e8208-284">Se non si rispettano le soglie di hello, nel servizio master hello viene inviato un report.</span><span class="sxs-lookup"><span data-stu-id="e8208-284">If they do not respect hello thresholds, a report is sent on hello master service.</span></span> <span data-ttu-id="e8208-285">Un report viene inviato anche a ogni attività che include come identificatore di attività, hello **PendingTask + taskId**.</span><span class="sxs-lookup"><span data-stu-id="e8208-285">A report is also sent on each task that includes hello task identifier, like **PendingTask+taskId**.</span></span> <span data-ttu-id="e8208-286">I report dovranno essere inviati solo sugli stati non integri.</span><span class="sxs-lookup"><span data-stu-id="e8208-286">Reports should be sent only on unhealthy states.</span></span> <span data-ttu-id="e8208-287">Impostare ora toolive tooa alcuni minuti e contrassegnare hello report toobe rimosso dopo la scadenza tooensure pulizia.</span><span class="sxs-lookup"><span data-stu-id="e8208-287">Set time toolive tooa few minutes, and mark hello reports toobe removed when they expire tooensure cleanup.</span></span>
* <span data-ttu-id="e8208-288">Hello secondario che esegue un'attività segnala quando sono necessari più di toorun previsto.</span><span class="sxs-lookup"><span data-stu-id="e8208-288">hello secondary that is executing a task reports when it takes longer than expected toorun it.</span></span> <span data-ttu-id="e8208-289">Report sull'istanza del servizio hello sulla proprietà hello **PendingTasks**.</span><span class="sxs-lookup"><span data-stu-id="e8208-289">It reports on hello service instance on hello property **PendingTasks**.</span></span> <span data-ttu-id="e8208-290">report Hello individua l'istanza del servizio hello che presenta problemi, ma non acquisisce i situazione hello in interruzione e istanza hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-290">hello report pinpoints hello service instance that has issues, but it doesn't capture hello situation where hello instance dies.</span></span> <span data-ttu-id="e8208-291">i report di Hello vengono puliti quindi.</span><span class="sxs-lookup"><span data-stu-id="e8208-291">hello reports are cleaned up then.</span></span> <span data-ttu-id="e8208-292">Report sulle servizio secondario hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-292">It could report on hello secondary service.</span></span> <span data-ttu-id="e8208-293">Se hello secondario viene completata l'attività hello, istanza secondaria hello Cancella report hello dall'archivio hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-293">If hello secondary completes hello task, hello secondary instance clears hello report from hello store.</span></span> <span data-ttu-id="e8208-294">report di Hello non acquisisce situazione hello in cui il messaggio di riconoscimento hello viene perso e attività hello non è stato completato dal punto di vista di hello master.</span><span class="sxs-lookup"><span data-stu-id="e8208-294">hello report doesn't capture hello situation where hello acknowledgement message is lost and hello task is not finished from hello master's point of view.</span></span>

<span data-ttu-id="e8208-295">Tuttavia hello reporting avviene hello casi sopra descritti, i report di hello vengono acquisiti in integrità dell'applicazione quando viene valutata l'integrità.</span><span class="sxs-lookup"><span data-stu-id="e8208-295">However hello reporting is done in hello cases described above, hello reports are captured in application health when health is evaluated.</span></span>

## <a name="report-periodically-vs-on-transition"></a><span data-ttu-id="e8208-296">Report periodici e report in caso di transizione a confronto</span><span class="sxs-lookup"><span data-stu-id="e8208-296">Report periodically vs. on transition</span></span>
<span data-ttu-id="e8208-297">Tramite integrità hello modello di report, watchdog puoi inviare report periodicamente o sulle transizioni.</span><span class="sxs-lookup"><span data-stu-id="e8208-297">By using hello health reporting model, watchdogs can send reports periodically or on transitions.</span></span> <span data-ttu-id="e8208-298">Hello consigliato per watchdog reporting è periodicamente, poiché il codice hello tooerrors molto più semplice e meno soggetto.</span><span class="sxs-lookup"><span data-stu-id="e8208-298">hello recommended way for watchdog reporting is periodically, because hello code is much simpler and less prone tooerrors.</span></span> <span data-ttu-id="e8208-299">watchdog Hello deve cercare toobe semplice come tooavoid possibili bug che attivano i report non corretti.</span><span class="sxs-lookup"><span data-stu-id="e8208-299">hello watchdogs must strive toobe as simple as possible tooavoid bugs that trigger incorrect reports.</span></span> <span data-ttu-id="e8208-300">Eventuali report che segnalano erroneamente la *mancata integrità* influiscono sulla valutazione dell'integrità e sugli scenari basati sull'integrità, inclusi gli aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="e8208-300">Incorrect *unhealthy* reports impact health evaluations and scenarios based on health, including upgrades.</span></span> <span data-ttu-id="e8208-301">Corretto *integro* problemi in cluster hello, che non si desidera nascondere i report.</span><span class="sxs-lookup"><span data-stu-id="e8208-301">Incorrect *healthy* reports hide issues in hello cluster, which is not desired.</span></span>

<span data-ttu-id="e8208-302">Per la segnalazione periodica, watchdog hello può essere implementata con un timer.</span><span class="sxs-lookup"><span data-stu-id="e8208-302">For periodic reporting, hello watchdog can be implemented with a timer.</span></span> <span data-ttu-id="e8208-303">Un callback del timer, watchdog hello consentono di controllare lo stato di hello e inviare un report in base allo stato corrente di hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-303">On a timer callback, hello watchdog can check hello state and send a report based on hello current state.</span></span> <span data-ttu-id="e8208-304">Non vi è alcun toosee necessità quale report è stato inviato in precedenza o effettuare qualsiasi ottimizzazioni in termini di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="e8208-304">There is no need toosee which report was sent previously or make any optimizations in terms of messaging.</span></span> <span data-ttu-id="e8208-305">Hello integrità client dispone di logica toohelp con prestazioni di invio in batch.</span><span class="sxs-lookup"><span data-stu-id="e8208-305">hello health client has batching logic toohelp with performance.</span></span> <span data-ttu-id="e8208-306">Mentre il client di integrità hello viene mantenuto attivo, riprovare a eseguire internamente fino a quando il report hello viene riconosciuto dall'archivio integrità hello o watchdog hello genera un report più recente con hello stessa entità, proprietà e origine.</span><span class="sxs-lookup"><span data-stu-id="e8208-306">While hello health client is kept alive, it retries internally until hello report is acknowledged by hello health store or hello watchdog generates a newer report with hello same entity, property, and source.</span></span>

<span data-ttu-id="e8208-307">La creazione di report in caso di transizioni richiede una gestione attenta dello stato.</span><span class="sxs-lookup"><span data-stu-id="e8208-307">Reporting on transitions requires careful handling of state.</span></span> <span data-ttu-id="e8208-308">watchdog Hello controlla alcune condizioni e segnala solo al variare delle condizioni di hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-308">hello watchdog monitors some conditions and reports only when hello conditions change.</span></span> <span data-ttu-id="e8208-309">Hello capovolta di questo approccio è che sono necessari un minor numero di report.</span><span class="sxs-lookup"><span data-stu-id="e8208-309">hello upside of this approach is that fewer reports are needed.</span></span> <span data-ttu-id="e8208-310">svantaggio Hello è che la logica di watchdog hello hello è complessa.</span><span class="sxs-lookup"><span data-stu-id="e8208-310">hello downside is that hello logic of hello watchdog is complex.</span></span> <span data-ttu-id="e8208-311">watchdog Hello mantenga le condizioni di hello o report di hello, in modo che possano essere ispezionato toodetermine cambiamenti di stato.</span><span class="sxs-lookup"><span data-stu-id="e8208-311">hello watchdog must maintain hello conditions or hello reports, so that they can be inspected toodetermine state changes.</span></span> <span data-ttu-id="e8208-312">In caso di failover, prestare attenzione con report aggiunto, ma non ancora inviati toohello dell'archivio integrità.</span><span class="sxs-lookup"><span data-stu-id="e8208-312">On failover, care must be taken with reports added, but not yet sent toohello health store.</span></span> <span data-ttu-id="e8208-313">numero di sequenza Hello deve essere crescente.</span><span class="sxs-lookup"><span data-stu-id="e8208-313">hello sequence number must be ever-increasing.</span></span> <span data-ttu-id="e8208-314">In caso contrario, i report di hello vengono rifiutati come non aggiornata.</span><span class="sxs-lookup"><span data-stu-id="e8208-314">If not, hello reports are rejected as stale.</span></span> <span data-ttu-id="e8208-315">In casi rari hello in cui si verifica la perdita di dati, la sincronizzazione potrebbe essere necessario tra stato hello del reporter hello e lo stato di hello dell'archivio integrità hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-315">In hello rare cases where data loss is incurred, synchronization may be needed between hello state of hello reporter and hello state of hello health store.</span></span>

<span data-ttu-id="e8208-316">La creazione di report relativi alle transizioni risulta utile per i servizi che inviano report relativi a se stessi, tramite `Partition` o `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="e8208-316">Reporting on transitions makes sense for services reporting on themselves, through `Partition` or `CodePackageActivationContext`.</span></span> <span data-ttu-id="e8208-317">Hello quando l'oggetto locale (replica o un servizio distribuito pacchetto / applicazione distribuita) viene rimosso, vengono rimossi anche tutti i relativi report.</span><span class="sxs-lookup"><span data-stu-id="e8208-317">When hello local object (replica or deployed service package / deployed application) is removed, all its reports are also removed.</span></span> <span data-ttu-id="e8208-318">La pulizia automatica vengono ridotti i hello necessità di sincronizzazione tra reporter e archivio integrità.</span><span class="sxs-lookup"><span data-stu-id="e8208-318">This automatic cleanup relaxes hello need for synchronization between reporter and health store.</span></span> <span data-ttu-id="e8208-319">Se il report di hello è per la partizione padre o l'applicazione padre, prestare attenzione per i report non aggiornato failover tooavoid nell'archivio integrità hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-319">If hello report is for parent partition or parent application, care must be taken on failover tooavoid stale reports in hello health store.</span></span> <span data-ttu-id="e8208-320">La logica, è necessario aggiungere stato corretto di toomaintain hello e report crittografato hello dall'archivio quando non è più necessario.</span><span class="sxs-lookup"><span data-stu-id="e8208-320">Logic must be added toomaintain hello correct state and clear hello report from store when not needed anymore.</span></span>

## <a name="implement-health-reporting"></a><span data-ttu-id="e8208-321">Implementare report sull'integrità</span><span class="sxs-lookup"><span data-stu-id="e8208-321">Implement health reporting</span></span>
<span data-ttu-id="e8208-322">Una volta hello dettagli entità e i report sono chiare, l'invio di rapporti di stato può essere eseguita tramite API di hello, PowerShell o REST.</span><span class="sxs-lookup"><span data-stu-id="e8208-322">Once hello entity and report details are clear, sending health reports can be done through hello API, PowerShell, or REST.</span></span>

### <a name="api"></a><span data-ttu-id="e8208-323">API</span><span class="sxs-lookup"><span data-stu-id="e8208-323">API</span></span>
<span data-ttu-id="e8208-324">tooreport tramite hello API, è necessario un tipo di entità toohello specifico report di integrità desiderati tooreport su toocreate.</span><span class="sxs-lookup"><span data-stu-id="e8208-324">tooreport through hello API, you need toocreate a health report specific toohello entity type they want tooreport on.</span></span> <span data-ttu-id="e8208-325">Fornire hello report tooa integrità client.</span><span class="sxs-lookup"><span data-stu-id="e8208-325">Give hello report tooa health client.</span></span> <span data-ttu-id="e8208-326">In alternativa, creare informazioni di stato e passarlo toocorrect metodi per il reporting in `Partition` o `CodePackageActivationContext` tooreport sulle entità corrente.</span><span class="sxs-lookup"><span data-stu-id="e8208-326">Alternatively, create a health information and pass it toocorrect reporting methods on `Partition` or `CodePackageActivationContext` tooreport on current entities.</span></span>

<span data-ttu-id="e8208-327">Hello riportato di seguito periodica reporting da un controllo all'interno di cluster hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-327">hello following example shows periodic reporting from a watchdog within hello cluster.</span></span> <span data-ttu-id="e8208-328">watchdog Hello controlla se è possibile accedere da una risorsa esterna all'interno di un nodo.</span><span class="sxs-lookup"><span data-stu-id="e8208-328">hello watchdog checks whether an external resource can be accessed from within a node.</span></span> <span data-ttu-id="e8208-329">risorsa Hello è richiesta da un manifesto del servizio all'interno di un'applicazione hello.</span><span class="sxs-lookup"><span data-stu-id="e8208-329">hello resource is needed by a service manifest within hello application.</span></span> <span data-ttu-id="e8208-330">Se la risorsa hello è disponibile, hello altri servizi all'interno di un'applicazione hello possono comunque funzionare correttamente.</span><span class="sxs-lookup"><span data-stu-id="e8208-330">If hello resource is unavailable, hello other services within hello application can still function properly.</span></span> <span data-ttu-id="e8208-331">Di conseguenza, i report di hello viene inviato nell'entità di pacchetto del servizio distribuito hello ogni 30 secondi.</span><span class="sxs-lookup"><span data-stu-id="e8208-331">Therefore, hello report is sent on hello deployed service package entity every 30 seconds.</span></span>

```csharp
private static Uri ApplicationName = new Uri("fabric:/WordCount");
private static string ServiceManifestName = "WordCount.Service";
private static string NodeName = FabricRuntime.GetNodeContext().NodeName;
private static Timer ReportTimer = new Timer(new TimerCallback(SendReport), null, 30 * 1000, 30 * 1000);
private static FabricClient Client = new FabricClient(new FabricClientSettings() { HealthReportSendInterval = TimeSpan.FromSeconds(0) });

public static void SendReport(object obj)
{
    // Test whether hello resource can be accessed from hello node
    HealthState healthState = this.TestConnectivityToExternalResource();

    // Send report on deployed service package, as hello connectivity is needed by hello specific service manifest
    // and can be different on different nodes
    var deployedServicePackageHealthReport = new DeployedServicePackageHealthReport(
        ApplicationName,
        ServiceManifestName,
        NodeName,
        new HealthInformation("ExternalSourceWatcher", "Connectivity", healthState));

    // TODO: handle exception. Code omitted for snippet brevity.
    // Possible exceptions: FabricException with error codes
    // FabricHealthStaleReport (non-retryable, hello report is already queued on hello health client),
    // FabricHealthMaxReportsReached (retryable; user should retry with exponential delay until hello report is accepted).
    Client.HealthManager.ReportHealth(deployedServicePackageHealthReport);
}
```

### <a name="powershell"></a><span data-ttu-id="e8208-332">PowerShell</span><span class="sxs-lookup"><span data-stu-id="e8208-332">PowerShell</span></span>
<span data-ttu-id="e8208-333">Inviare report sull'integrità con **Send-ServiceFabric*TipoEntità*HealthReport**.</span><span class="sxs-lookup"><span data-stu-id="e8208-333">Send health reports with **Send-ServiceFabric*EntityType*HealthReport**.</span></span>

<span data-ttu-id="e8208-334">Hello riportato di seguito periodica reporting sui valori della CPU in un nodo.</span><span class="sxs-lookup"><span data-stu-id="e8208-334">hello following example shows periodic reporting on CPU values on a node.</span></span> <span data-ttu-id="e8208-335">report Hello devono essere inviati ogni 30 secondi, e hanno un tempo toolive di due minuti.</span><span class="sxs-lookup"><span data-stu-id="e8208-335">hello reports should be sent every 30 seconds, and they have a time toolive of two minutes.</span></span> <span data-ttu-id="e8208-336">Se scadono, reporter hello presenta problemi, in modo nodo hello viene valutata in errore.</span><span class="sxs-lookup"><span data-stu-id="e8208-336">If they expire, hello reporter has issues, so hello node is evaluated at error.</span></span> <span data-ttu-id="e8208-337">Quando hello della CPU è superiore alla soglia specificata, report hello ha uno stato di integrità di avviso.</span><span class="sxs-lookup"><span data-stu-id="e8208-337">When hello CPU is above a threshold, hello report has a health state of warning.</span></span> <span data-ttu-id="e8208-338">Quando hello della CPU rimane superiore alla soglia specificata per più di tempo hello configurato, verrà segnalato come errore.</span><span class="sxs-lookup"><span data-stu-id="e8208-338">When hello CPU remains above a threshold for more than hello configured time, it's reported as an error.</span></span> <span data-ttu-id="e8208-339">In caso contrario, reporter hello invia uno stato di integrità di OK.</span><span class="sxs-lookup"><span data-stu-id="e8208-339">Otherwise, hello reporter sends a health state of OK.</span></span>

```powershell
PS C:\> Send-ServiceFabricNodeHealthReport -NodeName Node.1 -HealthState Warning -SourceId PowershellWatcher -HealthProperty CPU -Description "CPU is above 80% threshold" -TimeToLiveSec 120

PS C:\> Get-ServiceFabricNodeHealth -NodeName Node.1
NodeName              : Node.1
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='CPU', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.FM
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 5
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Fabric node is up.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : CPU
                        HealthState           : Warning
                        SequenceNumber        : 130741236814913394
                        SentAt                : 4/21/2015 9:01:21 PM
                        ReceivedAt            : 4/21/2015 9:01:21 PM
                        TTL                   : 00:02:00
                        Description           : CPU is above 80% threshold
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:01:21 PM
```

<span data-ttu-id="e8208-340">Hello esempio seguente segnala un avviso temporaneo in una replica.</span><span class="sxs-lookup"><span data-stu-id="e8208-340">hello following example reports a transient warning on a replica.</span></span> <span data-ttu-id="e8208-341">Ottiene innanzitutto hello ID di partizione e quindi hello ID replica del servizio di hello che è interessato.</span><span class="sxs-lookup"><span data-stu-id="e8208-341">It first gets hello partition ID and then hello replica ID for hello service it is interested in.</span></span> <span data-ttu-id="e8208-342">Invia quindi un report da **PowershellWatcher** sulla proprietà hello **ResourceDependency**.</span><span class="sxs-lookup"><span data-stu-id="e8208-342">It then sends a report from **PowershellWatcher** on hello property **ResourceDependency**.</span></span> <span data-ttu-id="e8208-343">report Hello è di particolare interesse per due minuti e viene rimosso dall'archivio hello automaticamente.</span><span class="sxs-lookup"><span data-stu-id="e8208-343">hello report is of interest for only two minutes, and it is removed from hello store automatically.</span></span>

```powershell
PS C:\> $partitionId = (Get-ServiceFabricPartition -ServiceName fabric:/WordCount/WordCount.Service).PartitionId

PS C:\> $replicaId = (Get-ServiceFabricReplica -PartitionId $partitionId | where {$_.ReplicaRole -eq "Primary"}).ReplicaId

PS C:\> Send-ServiceFabricReplicaHealthReport -PartitionId $partitionId -ReplicaId $replicaId -HealthState Warning -SourceId PowershellWatcher -HealthProperty ResourceDependency -Description "hello external resource that hello primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes." -TimeToLiveSec 120 -RemoveWhenExpired

PS C:\> Get-ServiceFabricReplicaHealth  -PartitionId $partitionId -ReplicaOrInstanceId $replicaId


PartitionId           : 8f82daff-eb68-4fd9-b631-7a37629e08c0
ReplicaId             : 130740415594605869
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='ResourceDependency', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.RA
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 130740768777734943
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Replica has been created.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : ResourceDependency
                        HealthState           : Warning
                        SequenceNumber        : 130741243777723555
                        SentAt                : 4/21/2015 9:12:57 PM
                        ReceivedAt            : 4/21/2015 9:12:57 PM
                        TTL                   : 00:02:00
                        Description           : hello external resource that hello primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes.
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:12:32 PM
```

### <a name="rest"></a><span data-ttu-id="e8208-344">REST</span><span class="sxs-lookup"><span data-stu-id="e8208-344">REST</span></span>
<span data-ttu-id="e8208-345">Inviare i rapporti di stato tramite REST con le richieste POST che passare entità toohello desiderato e nella descrizione del report integrità hello hello corpo.</span><span class="sxs-lookup"><span data-stu-id="e8208-345">Send health reports using REST with POST requests that go toohello desired entity and have in hello body hello health report description.</span></span> <span data-ttu-id="e8208-346">Ad esempio, vedere come toosend REST [report sull'integrità del cluster](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) o [rapporti di stato del servizio](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span><span class="sxs-lookup"><span data-stu-id="e8208-346">For example, see how toosend REST [cluster health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) or [service health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span></span> <span data-ttu-id="e8208-347">Sono supportate tutte le entità.</span><span class="sxs-lookup"><span data-stu-id="e8208-347">All entities are supported.</span></span>

## <a name="next-steps"></a><span data-ttu-id="e8208-348">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="e8208-348">Next steps</span></span>
<span data-ttu-id="e8208-349">In base ai dati di integrità hello, gli autori del servizio e gli amministratori di cluster/applicazione possono essere considerato di informazioni di hello tooconsume modi.</span><span class="sxs-lookup"><span data-stu-id="e8208-349">Based on hello health data, service writers and cluster/application administrators can think of ways tooconsume hello information.</span></span> <span data-ttu-id="e8208-350">Ad esempio possibile impostare avvisi basati sui problemi gravi toocatch lo stato di integrità prima che essi provocare interruzioni.</span><span class="sxs-lookup"><span data-stu-id="e8208-350">For example, they can set up alerts based on health status toocatch severe issues before they provoke outages.</span></span> <span data-ttu-id="e8208-351">Gli amministratori possono anche impostare i problemi di riparazione sistemi toofix automaticamente.</span><span class="sxs-lookup"><span data-stu-id="e8208-351">Administrators can also set up repair systems toofix issues automatically.</span></span>

[<span data-ttu-id="e8208-352">Introduzione tooService integrità infrastruttura monitoraggio</span><span class="sxs-lookup"><span data-stu-id="e8208-352">Introduction tooService Fabric health Monitoring</span></span>](service-fabric-health-introduction.md)

[<span data-ttu-id="e8208-353">Come visualizzare i report sull'integrità di Service Fabric</span><span class="sxs-lookup"><span data-stu-id="e8208-353">View Service Fabric health reports</span></span>](service-fabric-view-entities-aggregated-health.md)

[<span data-ttu-id="e8208-354">Come tooreport e controllo del servizio integrità</span><span class="sxs-lookup"><span data-stu-id="e8208-354">How tooreport and check service health</span></span>](service-fabric-diagnostics-how-to-report-and-check-service-health.md)

[<span data-ttu-id="e8208-355">Uso dei report sull'integrità del sistema per la risoluzione dei problemi</span><span class="sxs-lookup"><span data-stu-id="e8208-355">Use system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

[<span data-ttu-id="e8208-356">Monitorare e diagnosticare servizi in locale</span><span class="sxs-lookup"><span data-stu-id="e8208-356">Monitor and diagnose services locally</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

[<span data-ttu-id="e8208-357">Aggiornamento di un'applicazione di infrastruttura di servizi</span><span class="sxs-lookup"><span data-stu-id="e8208-357">Service Fabric application upgrade</span></span>](service-fabric-application-upgrade.md)

