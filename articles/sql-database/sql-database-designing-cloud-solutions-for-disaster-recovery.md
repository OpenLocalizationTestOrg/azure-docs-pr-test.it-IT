---
title: "Progettare un servizio a disponibilità elevata con database SQL di Azure | Documentazione Microsoft"
description: "Informazioni sulla progettazione di applicazioni per servizi a disponibilità elevata con database SQL di Azure."
keywords: "ripristino di emergenza cloud, soluzioni di ripristino di emergenza, backup dei dati delle app, replica geografica, pianificazione della continuità aziendale"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: e8a346ac-dd08-41e7-9685-46cebca04582
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 04/21/2017
ms.author: sashan
ms.openlocfilehash: 40fe0ae04eb94322356ed19773512e3bc383639c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="designing-highly-available-services-using-azure-sql-database"></a><span data-ttu-id="f135c-104">Progettazione di servizi a disponibilità elevata con database SQL di Azure</span><span class="sxs-lookup"><span data-stu-id="f135c-104">Designing highly available services using Azure SQL Database</span></span>

<span data-ttu-id="f135c-105">Durante la compilazione e distribuzione di servizi a disponibilità elevata in un database SQL Azure, usare [gruppi di failover e la replica geografica attiva](sql-database-geo-replication-overview.md) per ottenere la resilienza agli errori di area e alle interruzioni irreversibili e consentire un rapido ripristino sui database secondari.</span><span class="sxs-lookup"><span data-stu-id="f135c-105">When building and deploying highly available services on Azure SQL Database, you use [failover groups and active geo-replication](sql-database-geo-replication-overview.md) to provide resilience to regional failures and catastrophic outages and enable fast recovery to the secondary databases.</span></span> <span data-ttu-id="f135c-106">Questo articolo illustra i modelli di applicazione comuni e tratta i vantaggi e i compromessi di ogni opzione in base ai requisiti di distribuzione dell'applicazione, il contratto di servizio di destinazione, la latenza del traffico e i costi.</span><span class="sxs-lookup"><span data-stu-id="f135c-106">This article focuses on common application patterns and discusses the benefits and trade-offs of each option depending on the application deployment requirements, the service level agreement you are targeting, traffic latency, and costs.</span></span> <span data-ttu-id="f135c-107">Per informazioni sulla replica geografica attiva con i pool elastici, vedere [Strategie di ripristino di emergenza per applicazioni che usano il pool elastico del database SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="f135c-107">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

## <a name="design-pattern-1-active-passive-deployment-for-cloud-disaster-recovery-with-a-co-located-database"></a><span data-ttu-id="f135c-108">Modello di progettazione 1: distribuzione attiva/passiva per il ripristino di emergenza cloud mediante un database con percorso condiviso</span><span class="sxs-lookup"><span data-stu-id="f135c-108">Design pattern 1: Active-passive deployment for cloud disaster recovery with a co-located database</span></span>
<span data-ttu-id="f135c-109">Questa opzione è particolarmente indicata per le applicazioni con le caratteristiche seguenti:</span><span class="sxs-lookup"><span data-stu-id="f135c-109">This option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="f135c-110">Istanza attiva in una singola area di Azure</span><span class="sxs-lookup"><span data-stu-id="f135c-110">Active instance in a single Azure region</span></span>
* <span data-ttu-id="f135c-111">Dipendenza assoluta nell'accesso ai dati in lettura/scrittura</span><span class="sxs-lookup"><span data-stu-id="f135c-111">Strong dependency on read-write (RW) access to data</span></span>
* <span data-ttu-id="f135c-112">La connettività in più aree tra l'applicazione Web e il database non è accettabile a causa della latenza e del costo del traffico</span><span class="sxs-lookup"><span data-stu-id="f135c-112">Cross-region connectivity between the web application and the database is not acceptable due to latency and traffic cost</span></span>    

<span data-ttu-id="f135c-113">In questo caso la topologia di distribuzione dell'applicazione viene ottimizzata per la gestione di situazioni di emergenza nelle aree interessate quando tutti i componenti dell'applicazione sono coinvolti e se ne rende necessario il failover come unità.</span><span class="sxs-lookup"><span data-stu-id="f135c-113">In this case, the application deployment topology is optimized for handling regional disasters when all application components are impacted and need to failover as a unit.</span></span> <span data-ttu-id="f135c-114">Per la ridondanza geografica, la logica dell'applicazione e il database vengono replicati in un'altra area, ma non vengono utilzizati per il carico di lavoro dell'applicazione in condizioni normali.</span><span class="sxs-lookup"><span data-stu-id="f135c-114">For geographic redundancy, the application logic and the database are replicated to another region but they are not used for the application workload under the normal conditions.</span></span> <span data-ttu-id="f135c-115">L'applicazione nell'area secondaria dovrebbe essere configurata per l'uso di un stringa di connessione SQL al database secondario.</span><span class="sxs-lookup"><span data-stu-id="f135c-115">The application in the secondary region should be configured to use a SQL connection string to the secondary database.</span></span> <span data-ttu-id="f135c-116">Gestione traffico è configurato per l'uso del [metodo di routing di failover](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span><span class="sxs-lookup"><span data-stu-id="f135c-116">Traffic manager is set up to use [failover routing method](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span></span>  

> [!NOTE]
> <span data-ttu-id="f135c-117">[Gestione traffico di Azure](../traffic-manager/traffic-manager-overview.md) viene usato in questo articolo solo a scopi illustrativi.</span><span class="sxs-lookup"><span data-stu-id="f135c-117">[Azure traffic manager](../traffic-manager/traffic-manager-overview.md) is used throughout this article for illustration purposes only.</span></span> <span data-ttu-id="f135c-118">È possibile usare qualsiasi soluzione di bilanciamento del carico che supporta il metodo di routing di failover.</span><span class="sxs-lookup"><span data-stu-id="f135c-118">You can use any load-balancing solution that supports failover routing method.</span></span>    
>

<span data-ttu-id="f135c-119">Il diagramma seguente mostra questa configurazione prima di un'interruzione.</span><span class="sxs-lookup"><span data-stu-id="f135c-119">The following diagram shows this configuration before an outage.</span></span>

![Configurazione della replica geografica del database SQL.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-1.png)

<span data-ttu-id="f135c-122">Dopo un'interruzione del servizio nell'area primaria, il servizio di database SQL rileva che il database primario non è accessibile e attiva un failover nel database secondario in base ai parametri dei criteri di failover automatico.</span><span class="sxs-lookup"><span data-stu-id="f135c-122">After an outage in the primary region, the SQL Database service detects that the primary database is not accessible and trigger a failover to the secondary database based on the parameters of the automatic failover policy.</span></span> <span data-ttu-id="f135c-123">A seconda del contratto di servizio dell'applicazione, è possibile decidere di configurare un periodo di tolleranza tra il rilevamento dell'interruzione e il failover stesso.</span><span class="sxs-lookup"><span data-stu-id="f135c-123">Depending on your application SLA, you can decide to configure a grace period between the detection of the outage and the failover itself.</span></span> <span data-ttu-id="f135c-124">La configurazione di un periodo di tolleranza riduce il rischio di perdita di dati nei casi in cui l'interruzione del servizio è irreversibile e non è possibile ripristinare rapidamente la disponibilità nell'area.</span><span class="sxs-lookup"><span data-stu-id="f135c-124">Configuring a grace period reduces the risk of data loss to the cases where the outage is catastrophic and availability in the region cannot be quickly restored.</span></span> <span data-ttu-id="f135c-125">Se il failover dell'endpoint viene avviato da Gestione traffico prima che il gruppo di failover attivi il failover del database, l'applicazione Web non è in grado di riconnettersi al database.</span><span class="sxs-lookup"><span data-stu-id="f135c-125">If the endpoint failover is initiated by the traffic manager before the failover group triggers the failover of the database, the web application is not able to reconnect to the database.</span></span> <span data-ttu-id="f135c-126">Il tentativo dell'applicazione di ristabilire la connessione ha esito positivo automaticamente non appena verrà completato il failover del database.</span><span class="sxs-lookup"><span data-stu-id="f135c-126">The application’s attempt to reconnect automatically succeeds as soon as the database failover completes.</span></span> 

> [!NOTE]
> <span data-ttu-id="f135c-127">Per ottenere il failover completamente coordinato di applicazione e database, si deve definire il proprio metodo di monitoraggio e usare il failover manuale degli endpoint dell'applicazione Web e dei database.</span><span class="sxs-lookup"><span data-stu-id="f135c-127">To achieve fully coordinated failover of the application and the databases, you should devise your own monitoring method and use manual failover of the web application endpoints and the databases.</span></span>
>

<span data-ttu-id="f135c-128">Al termine dell'esecuzione del failover degli endpoint dell'applicazione e del database, l'applicazione riavvierà l'elaborazione delle richieste utente nell'area B e rimarrà condivisa con il database perché il database primario è ora nell'area B. Questo scenario è illustrato nel diagramma seguente.</span><span class="sxs-lookup"><span data-stu-id="f135c-128">After the failover of both the application’s endpoints and the database completes, the application will re-start processing the user requests in the region B and will remain co-located with the database because the primary database is now in region B. This scenario is illustrated in the following diagram.</span></span> <span data-ttu-id="f135c-129">In tutti i diagrammi le linee continue indicano le connessioni attive, le linee con punti indicano le connessioni sospese e i segnali di stop indicano i trigger di azioni.</span><span class="sxs-lookup"><span data-stu-id="f135c-129">In all diagrams, solid lines indicate active connections, dotted lines indicate suspended connections, and stop signs indicate action triggers.</span></span>

![Replica geografica: failover al database secondario.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-2.png)

<span data-ttu-id="f135c-132">Se si verifica un'interruzione nell'area secondaria, il collegamento di replica tra il database primario e quello secondario è sospeso, ma il failover non viene attivato perché il database primario non è interessato.</span><span class="sxs-lookup"><span data-stu-id="f135c-132">If an outage happens in the secondary region, the replication link between the primary and the secondary database is suspended but the failover is not triggered because the primary database is not impacted.</span></span> <span data-ttu-id="f135c-133">In questo caso la disponibilità dell'applicazione non viene modificata, ma l'applicazione risulta esposta a un rischio maggiore se entrambe le aree hanno esito negativo una dopo l'altra.</span><span class="sxs-lookup"><span data-stu-id="f135c-133">The application's availability is not changed in this case, but the application operates exposed and therefore at higher risk in case both regions fail in succession.</span></span>

> [!NOTE]
> <span data-ttu-id="f135c-134">Per il ripristino di emergenza è consigliabile la configurazione con la distribuzione di applicazioni limitata a due aree.</span><span class="sxs-lookup"><span data-stu-id="f135c-134">For disaster recovery we recommend the configuration with application deployment limited to two regions.</span></span> <span data-ttu-id="f135c-135">Infatti la maggior parte delle geografie di Azure ha solo due aree.</span><span class="sxs-lookup"><span data-stu-id="f135c-135">This is because most of the Azure geographies have only two regions.</span></span> <span data-ttu-id="f135c-136">Questa configurazione non proteggerà l'applicazione da un errore simultaneo irreparabile di entrambe le aree.</span><span class="sxs-lookup"><span data-stu-id="f135c-136">This configuration will not protect your application from a simultaneous catastrophic failure of both regions.</span></span>  <span data-ttu-id="f135c-137">Nell'improbabile eventualità di un errore di questo genere, è possibile recuperare i database in una terza area con un'[operazione di ripristino geografico](sql-database-disaster-recovery.md#recover-using-geo-restore).</span><span class="sxs-lookup"><span data-stu-id="f135c-137">In an unlikely event of such a failure, you can recover your databases in a third region using [geo-restore operation](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span>
>

<span data-ttu-id="f135c-138">Dopo che è stata ridotta l'entità dell'interruzione, il database secondario viene automaticamente risincronizzato con quello primario.</span><span class="sxs-lookup"><span data-stu-id="f135c-138">Once the outage is mitigated, the secondary database will automatically re-synchronize with the primary.</span></span> <span data-ttu-id="f135c-139">Durante la sincronizzazione, le prestazioni di quello primario potrebbero essere leggermente rallentate a seconda della quantità di dati da sincronizzare.</span><span class="sxs-lookup"><span data-stu-id="f135c-139">During synchronization, performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span> <span data-ttu-id="f135c-140">Il diagramma seguente illustra un'interruzione nell'area secondaria.</span><span class="sxs-lookup"><span data-stu-id="f135c-140">The following diagram illustrates an outage in the secondary region.</span></span>

![Database secondario sincronizzato con il database primario.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-3.png)

<span data-ttu-id="f135c-143">I **vantaggi** chiave di questo modello di progettazione sono:</span><span class="sxs-lookup"><span data-stu-id="f135c-143">The key **advantages** of this design pattern are:</span></span>

* <span data-ttu-id="f135c-144">La stessa applicazione Web viene distribuita in entrambe le aree senza alcuna configurazione specifica dell'area e nessuna logica aggiuntiva per rispondere al failover.</span><span class="sxs-lookup"><span data-stu-id="f135c-144">The same web application is deployed to both regions without any region-specific configuration and no additional logic to react to the failover.</span></span> 
* <span data-ttu-id="f135c-145">Le prestazioni dell'applicazione non vengono rallentate dal failover, perché l'applicazione Web e il database condividono sempre lo stesso percorso.</span><span class="sxs-lookup"><span data-stu-id="f135c-145">The application's performance is not impacted by failover as the web application and the database are always co-located.</span></span>

<span data-ttu-id="f135c-146">Il **compromesso** principale è che l'istanza dell'applicazione ridondante nell'area secondaria viene usata solo per il ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="f135c-146">The main **tradeoff** is that the redundant application instance in the secondary region is only used for disaster recovery.</span></span>

## <a name="design-pattern-2-active-active-deployment-for-application-load-balancing"></a><span data-ttu-id="f135c-147">Modello di progettazione 2: Distribuzione attiva/attiva per il bilanciamento del carico dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="f135c-147">Design pattern 2: Active-active deployment for application load balancing</span></span>
<span data-ttu-id="f135c-148">Questa opzione di ripristino di emergenza cloud è particolarmente indicata per le applicazioni con le caratteristiche seguenti:</span><span class="sxs-lookup"><span data-stu-id="f135c-148">This cloud disaster recovery option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="f135c-149">Rapporto elevato tra letture e scritture del database</span><span class="sxs-lookup"><span data-stu-id="f135c-149">High ratio of database reads to writes</span></span>
* <span data-ttu-id="f135c-150">La latenza di lettura del database è più critica per l'esperienza utente finale rispetto alla latenza di scrittura</span><span class="sxs-lookup"><span data-stu-id="f135c-150">Database read latency is more critical for the end-user experience than the write latency</span></span> 
* <span data-ttu-id="f135c-151">Logica di sola lettura che può essere separata dalla logica di lettura/scrittura usando una stringa di connessione diversa</span><span class="sxs-lookup"><span data-stu-id="f135c-151">Read-only logic can be separated from read-write logic by using a different connection string</span></span>
* <span data-ttu-id="f135c-152">Logica di sola lettura che non dipende dai dati che vengono completamente sincronizzati con gli ultimi aggiornamenti</span><span class="sxs-lookup"><span data-stu-id="f135c-152">Read-only logic does not depend on data being fully synchronized with the latest updates</span></span>  

<span data-ttu-id="f135c-153">Se l'applicazione presenta queste caratteristiche, il bilanciamento del carico delle connessioni degli utenti finali in più istanze dell'applicazione in aree diverse può migliorare notevolmente l'esperienza complessiva dell'utente finale.</span><span class="sxs-lookup"><span data-stu-id="f135c-153">If your applications have these characteristics, load balancing the end-user connections across multiple application instances in different regions can substantially improve the overall end-user experience.</span></span> <span data-ttu-id="f135c-154">Due delle aree devono essere selezionate come coppia di ripristino di emergenza e il gruppo di failover deve includere i database in queste aree.</span><span class="sxs-lookup"><span data-stu-id="f135c-154">Two of the regions should be selected as the DR pair and the failover group should include the databases in these regions.</span></span> <span data-ttu-id="f135c-155">Per implementare il bilanciamento del carico, ogni area deve disporre di un'istanza attiva dell'applicazione con la logica di lettura/scrittura connessa all'endpoint del listener di lettura/scrittura del gruppo di failover.</span><span class="sxs-lookup"><span data-stu-id="f135c-155">To implement load-balancing, each region should have an active instance of the application with the read-write (RW) logic connected to the read-write listener endpoint of the failover group.</span></span> <span data-ttu-id="f135c-156">Ciò garantisce che il failover venga avviato automaticamente se il database primario è stato interessato da un'interruzione del servizio.</span><span class="sxs-lookup"><span data-stu-id="f135c-156">It will guarantee that the failover will be automatically initiated if the primary database is impacted by an outage.</span></span> <span data-ttu-id="f135c-157">La logica di sola lettura (RO) nell'applicazione Web deve connettersi direttamente al database in tale area.</span><span class="sxs-lookup"><span data-stu-id="f135c-157">The read-only logic (RO) in the web application should connect directly to the database in that region.</span></span> <span data-ttu-id="f135c-158">Gestione traffico dovrebbe essere configurato per l'uso del [routing delle prestazioni](../traffic-manager/traffic-manager-configure-performance-routing-method.md) con il [monitoraggio dell'endpoint](../traffic-manager/traffic-manager-monitoring.md) abilitato per ogni istanza dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f135c-158">Traffic manager should be set up to use [performance routing](../traffic-manager/traffic-manager-configure-performance-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for each application instance.</span></span>

<span data-ttu-id="f135c-159">È consigliabile distribuire un'applicazione di monitoraggio simile a quella del modello n. 1,</span><span class="sxs-lookup"><span data-stu-id="f135c-159">As in pattern #1, you should consider deploying a similar monitoring application.</span></span> <span data-ttu-id="f135c-160">che però, a differenza di quanto accade nel modello n. 1, non sarà responsabile dell'attivazione del failover dell'endpoint.</span><span class="sxs-lookup"><span data-stu-id="f135c-160">But unlike pattern #1, the monitoring application will not be responsible for triggering the end-point failover.</span></span>

> [!NOTE]
> <span data-ttu-id="f135c-161">Anche se questo modello usa più di un database secondario, solo il database secondario nell'area B viene usato per il failover e deve far parte del gruppo di failover.</span><span class="sxs-lookup"><span data-stu-id="f135c-161">While this pattern uses more than one secondary database, only the secondary in Region B  would be used for failover and should be part of the failover group.</span></span>
>

<span data-ttu-id="f135c-162">Gestione traffico dovrebbe essere configurato per il routing delle prestazioni per poter indirizzare le connessioni utente all'istanza dell'applicazione più vicina alla posizione geografica dell'utente.</span><span class="sxs-lookup"><span data-stu-id="f135c-162">Traffic manager should be configured for performance routing to direct the user connections to the application instance closest to the user's geographic location.</span></span> <span data-ttu-id="f135c-163">Il diagramma seguente illustra questa configurazione prima di un'interruzione.</span><span class="sxs-lookup"><span data-stu-id="f135c-163">The following diagram illustrates this configuration before an outage.</span></span>

![Nessuna interruzione: routing delle prestazioni all'applicazione più vicina.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-1.png)

<span data-ttu-id="f135c-166">Se viene rilevata un'interruzione del database nell'area A, il gruppo di failover avvierà automaticamente il failover del database primario nell'area A per il database secondario nell'area B. Aggiornerà automaticamente anche l'endpoint del listener di lettura-scrittura per l'area B in modo che le connessioni di lettura/scrittura nell'applicazione Web non vengano interessate.</span><span class="sxs-lookup"><span data-stu-id="f135c-166">If a database outage is detected in the region A, the failover group will automatically initiate failover of the primary database in region A to the secondary in region B. It will also automatically update the read-write listener endpoint to region B so read-write connections in the web application will not be impacted.</span></span> <span data-ttu-id="f135c-167">Gestione traffico esclude l'endpoint offline dalla tabella di routing, ma continua a reindirizzare il traffico dell'utente finale alle rimanenti istanze online.</span><span class="sxs-lookup"><span data-stu-id="f135c-167">The traffic manager will exclude the offline end-point from the routing table but will continue routing the end-user traffic to the remaining online instances.</span></span> <span data-ttu-id="f135c-168">Le stringhe di connessione SQL di sola lettura non vengono interessate perché puntano sempre al database nella stessa area.</span><span class="sxs-lookup"><span data-stu-id="f135c-168">The read-only SQL connection strings will not be impacted as they always point to the database in the same region.</span></span> 

<span data-ttu-id="f135c-169">Il diagramma seguente illustra la nuova configurazione dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="f135c-169">The following diagram illustrates the new configuration after the failover.</span></span>

![Configurazione dopo il failover.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-2.png)

<span data-ttu-id="f135c-172">In caso di interruzione in una delle aree secondarie, Gestione traffico rimuove automaticamente l'endpoint offline in tale area dalla tabella di routing.</span><span class="sxs-lookup"><span data-stu-id="f135c-172">In case of an outage in one of the secondary regions, the traffic manager will automatically remove the offline end-point in that region from the routing table.</span></span> <span data-ttu-id="f135c-173">Il canale di replica nel database secondario in tale area viene sospeso.</span><span class="sxs-lookup"><span data-stu-id="f135c-173">The replication channel to the secondary database in that region will be suspended.</span></span> <span data-ttu-id="f135c-174">Poiché le aree rimanenti ricevono il traffico dell'utente aggiuntivo in questo scenario, le prestazioni dell'applicazione potrebbero risultare rallentate durante l'interruzione.</span><span class="sxs-lookup"><span data-stu-id="f135c-174">Because the remaining regions get additional user traffic in this scenario, the application's performance will be impacted during the outage.</span></span> <span data-ttu-id="f135c-175">Dopo che l'entità dell'interruzione è stata ridotta, il database secondario nell'area interessata viene immediatamente sincronizzato con quello primario.</span><span class="sxs-lookup"><span data-stu-id="f135c-175">Once the outage is mitigated, the secondary database in the impacted region will be immediately synchronized with the primary.</span></span> <span data-ttu-id="f135c-176">Durante la sincronizzazione, le prestazioni del database primario potrebbero essere leggermente rallentate a seconda della quantità di dati da sincronizzare.</span><span class="sxs-lookup"><span data-stu-id="f135c-176">During the synchronization performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span> <span data-ttu-id="f135c-177">Il diagramma seguente illustra un'interruzione nell'area B.</span><span class="sxs-lookup"><span data-stu-id="f135c-177">The following diagram illustrates an outage in region B.</span></span>

![Interruzione nell'area secondaria.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-3.png)

<span data-ttu-id="f135c-180">Il **vantaggio** chiave di questo modello di progettazione è la scalabilità del carico di lavoro dell'applicazione in più database secondari per raggiungere le prestazioni utente ottimali.</span><span class="sxs-lookup"><span data-stu-id="f135c-180">The key **advantage** of this design pattern is that you can scale the application workload across multiple secondaries to achieve the optimal end-user performance.</span></span> <span data-ttu-id="f135c-181">I **compromessi** di questa opzione sono:</span><span class="sxs-lookup"><span data-stu-id="f135c-181">The **tradeoffs** of this option are:</span></span>

* <span data-ttu-id="f135c-182">Le connessioni in lettura/scrittura tra le istanze dell'applicazione e il database hanno latenza e costi variabili</span><span class="sxs-lookup"><span data-stu-id="f135c-182">Read-write connections between the application instances and database have varying latency and cost</span></span>
* <span data-ttu-id="f135c-183">Le prestazioni dell'applicazione vengono rallentate durante l'interruzione</span><span class="sxs-lookup"><span data-stu-id="f135c-183">Application performance is impacted during the outage</span></span>

> [!NOTE]
> <span data-ttu-id="f135c-184">Un approccio simile può essere adottato per l'offload di carichi di lavoro specializzati, ad esempio processi di creazione di report, strumenti di business intelligence o backup.</span><span class="sxs-lookup"><span data-stu-id="f135c-184">A similar approach can be used to offload specialized workloads such as reporting jobs, business intelligence tools, or backups.</span></span> <span data-ttu-id="f135c-185">Poiché questi carichi di lavoro usano in genere una considerevole quantità di risorse del database, è consigliabile riservare loro uno dei database secondari con un livello di prestazioni corrispondente al carico di lavoro anticipato.</span><span class="sxs-lookup"><span data-stu-id="f135c-185">Typically, these workloads consume significant database resources therefore it is recommended that you designate one of the secondary databases for them with the performance level matched to the anticipated workload.</span></span>
>

## <a name="design-pattern-3-active-passive-deployment-for-data-preservation"></a><span data-ttu-id="f135c-186">Modello di progettazione 3: Distribuzione attiva/passiva per la conservazione dei dati</span><span class="sxs-lookup"><span data-stu-id="f135c-186">Design pattern 3: Active-passive deployment for data preservation</span></span>
<span data-ttu-id="f135c-187">Questa opzione è particolarmente indicata per le applicazioni con le caratteristiche seguenti:</span><span class="sxs-lookup"><span data-stu-id="f135c-187">This option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="f135c-188">Qualsiasi perdita di dati rappresenta un rischio aziendale elevato.</span><span class="sxs-lookup"><span data-stu-id="f135c-188">Any data loss is high business risk.</span></span> <span data-ttu-id="f135c-189">Il failover del database può essere usato solo come ultima soluzione se l'interruzione è irreversibile.</span><span class="sxs-lookup"><span data-stu-id="f135c-189">The database failover can only be used as a last resort if the outage is catastrophic.</span></span>
* <span data-ttu-id="f135c-190">L'applicazione supporta le modalità di sola lettura e lettura/scrittura delle operazioni e può funzionare in "modalità di sola lettura" per un periodo di tempo.</span><span class="sxs-lookup"><span data-stu-id="f135c-190">The application supports read-only and read-write modes of operations and can operate in "read-only mode" for a period of time.</span></span>

<span data-ttu-id="f135c-191">In questo modello l'applicazione passa alla modalità di sola lettura quando le connessioni di lettura-scrittura iniziano a dare errori di timeout.</span><span class="sxs-lookup"><span data-stu-id="f135c-191">In this pattern, the application switches to read-only mode when the read-write connections start getting time-out errors.</span></span> <span data-ttu-id="f135c-192">L'applicazione Web viene distribuita in entrambe le aree e include una connessione all'endpoint del listener di lettura/scrittura e una diversa connessione all'endpoint del listener di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="f135c-192">The Web Application is deployed to both regions and include a connection to the read-write listener endpoint and different connection to the read-only listener endpoint.</span></span> <span data-ttu-id="f135c-193">Gestione traffico dovrebbe essere configurato per l'uso del [routing del failover](../traffic-manager/traffic-manager-configure-failover-routing-method.md) con il [monitoraggio dell'endpoint](../traffic-manager/traffic-manager-monitoring.md) abilitato per l'endpoint dell'applicazione in ogni area.</span><span class="sxs-lookup"><span data-stu-id="f135c-193">The Traffic manager should be set up to use [failover routing](../traffic-manager/traffic-manager-configure-failover-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for the application endpoint in each region.</span></span>

<span data-ttu-id="f135c-194">Il diagramma seguente illustra questa configurazione prima di un'interruzione.</span><span class="sxs-lookup"><span data-stu-id="f135c-194">The following diagram illustrates this configuration before an outage.</span></span>

![Distribuzione attiva-passiva prima del failover.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-1.png)

<span data-ttu-id="f135c-197">Quando Gestione traffico rileva un errore di connettività nell'area A, automaticamente passa il traffico degli utenti all'istanza dell'applicazione nell'area B. Con questo modello, è importante impostare il periodo di tolleranza con perdita dei dati su un valore sufficientemente elevato, ad esempio 24 ore.</span><span class="sxs-lookup"><span data-stu-id="f135c-197">When the traffic manager detects a connectivity failure to region A, it automatically switches user traffic to the application instance in region B. With this pattern, it is important that you set the grace period with data loss to a sufficiently high value, e.g. 24 hours.</span></span> <span data-ttu-id="f135c-198">Ciò garantisce che la perdita di dati venga impedita se l'interruzione del servizio viene risolta entro tale periodo di tempo.</span><span class="sxs-lookup"><span data-stu-id="f135c-198">It will ensure that data loss is prevented if the outage is mitigated within that time.</span></span> <span data-ttu-id="f135c-199">Quando l'applicazione Web nell'area B viene attivata, le operazioni di lettura-scrittura iniziano ad avere esito negativo.</span><span class="sxs-lookup"><span data-stu-id="f135c-199">When the Web application in the region B is activated the read-write operations will start failing.</span></span> <span data-ttu-id="f135c-200">A questo punto, si passa alla modalità di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="f135c-200">At that point, it should switch to the read-only mode.</span></span> <span data-ttu-id="f135c-201">In questa modalità le richieste vengono indirizzate automaticamente al database secondario.</span><span class="sxs-lookup"><span data-stu-id="f135c-201">In this mode the requests will be automatically routed to the secondary database.</span></span> <span data-ttu-id="f135c-202">In caso di errore irreversibile non è possibile risolvere l'interruzione del servizio entro il periodo di tolleranza e il gruppo di failover attiva il failover.</span><span class="sxs-lookup"><span data-stu-id="f135c-202">In the case of a catastrophic failure the outage will not be mitigated within the grace period and the failover group will trigger the failover.</span></span> <span data-ttu-id="f135c-203">Dopo di che il listener di lettura-scrittura diventa disponibile e le chiamate smettono di avere esito negativo.</span><span class="sxs-lookup"><span data-stu-id="f135c-203">After that the read-write listener will become available and the calls to it will stop failing.</span></span> <span data-ttu-id="f135c-204">Tale condizione è illustrata dal diagramma seguente.</span><span class="sxs-lookup"><span data-stu-id="f135c-204">This is illustrated by the following diagram.</span></span>

![Interruzione: applicazione in modalità di sola lettura.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-2.png)

<span data-ttu-id="f135c-207">Se l'interruzione nell'area primaria viene risolta entro il periodo di tolleranza, Gestione traffico rileva il ripristino della connettività nell'area primaria e ripassa il traffico utente all'istanza dell'applicazione nell'area A. Tale istanza dell'applicazione riprende e opera in modalità di sola lettura usando il database primario nell'area A.</span><span class="sxs-lookup"><span data-stu-id="f135c-207">If the outage in the primary region is mitigated within the grace period, traffic manager detects the restoration of connectivity in the primary region and switches user traffic back to the application instance in region A. That application instance resumes and operates in read-write mode using the primary database in region A.</span></span>

<span data-ttu-id="f135c-208">In caso di interruzione nell'area B, Gestione traffico rileva l'errore dell'endpoint dell'applicazione nell'area B e il gruppo di failover passa il listener di sola lettura all'area A. Questa interruzione non influisce sull'esperienza dell'utente finale, ma il database primario verrà esposto durante l'interruzione del servizio.</span><span class="sxs-lookup"><span data-stu-id="f135c-208">In case of an outage in the region B, the traffic manager detects the failure of the application end-point in region B and the failover group switches the read-only listener to region A. This outage does not impact the end-user experience but the primary database will be exposed during the outage.</span></span> <span data-ttu-id="f135c-209">Tale condizione è illustrata dal diagramma seguente.</span><span class="sxs-lookup"><span data-stu-id="f135c-209">This is illustrated by the following diagram.</span></span>

![Interruzione: database secondario.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-3.png)

<span data-ttu-id="f135c-212">Dopo che l'interruzione del servizio è stata risolta, il database secondario viene immediatamente sincronizzato con quello primario e il listener di sola lettura viene passato nuovamente al database secondario nell'area B. Durante la sincronizzazione, le prestazioni del database primario potrebbero essere leggermente influenzate a seconda della quantità di dati che deve essere sincronizzata.</span><span class="sxs-lookup"><span data-stu-id="f135c-212">Once the outage is mitigated, the secondary database is immediately synchronized with the primary and the read-only listener is switched back to the secondary database in region B. During synchronization performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span>

<span data-ttu-id="f135c-213">Questo modello di progettazione presenta diversi **vantaggi**:</span><span class="sxs-lookup"><span data-stu-id="f135c-213">This design pattern has several **advantages**:</span></span>

* <span data-ttu-id="f135c-214">Impedisce la perdita dei dati durante le interruzioni temporanee.</span><span class="sxs-lookup"><span data-stu-id="f135c-214">It avoids data loss during the temporary outages.</span></span>
* <span data-ttu-id="f135c-215">Il tempo di inattività dipende solo dalla velocità con cui Gestione traffico rileva l'errore di connettività, che è configurabile.</span><span class="sxs-lookup"><span data-stu-id="f135c-215">Downtime depends only on how quickly traffic manager detects the connectivity failure, which is configurable.</span></span>

<span data-ttu-id="f135c-216">Il **compromesso** è:</span><span class="sxs-lookup"><span data-stu-id="f135c-216">The **tradeoff** is:</span></span>

* <span data-ttu-id="f135c-217">L'applicazione deve poter funzionare in modalità di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="f135c-217">Application must be able to operate in read-only mode.</span></span>

> [!NOTE]
> <span data-ttu-id="f135c-218">In caso in interruzione permanente del servizio nell'area, attivare manualmente il failover del database e accettare la perdita dei dati.</span><span class="sxs-lookup"><span data-stu-id="f135c-218">In case of a permanent service outage in the region, you manually activate database failover and accept the data loss.</span></span> <span data-ttu-id="f135c-219">L'applicazione sarà funzionale nell'area secondaria con l'accesso in lettura/scrittura al database.</span><span class="sxs-lookup"><span data-stu-id="f135c-219">The application will be functional in the secondary region with read-write access to the database.</span></span>
>

## <a name="business-continuity-planning-choose-an-application-design-for-cloud-disaster-recovery"></a><span data-ttu-id="f135c-220">Pianificazione della continuità aziendale: Scegliere una progettazione di applicazioni per il ripristino di emergenza cloud</span><span class="sxs-lookup"><span data-stu-id="f135c-220">Business continuity planning: Choose an application design for cloud disaster recovery</span></span>
<span data-ttu-id="f135c-221">La strategia di ripristino di emergenza cloud specifica può combinare o estendere questi modelli di progettazione per soddisfare al meglio le esigenze dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f135c-221">Your specific cloud disaster recovery strategy can combine or extend these design patterns to best meet the needs of your application.</span></span>  <span data-ttu-id="f135c-222">Come accennato in precedenza, la strategia scelta si basa sul contratto di servizio che si vuole offrire ai clienti e sulla topologia di distribuzione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f135c-222">As mentioned earlier, the strategy you choose is based on the SLA you want to offer to your customers and the application deployment topology.</span></span> <span data-ttu-id="f135c-223">Per facilitare la decisione, la tabella seguente confronta le scelte in base alla perdita dei dati stimata o all'obiettivo del punto di ripristino (RPO) e al tempo di recupero stimato (ERT).</span><span class="sxs-lookup"><span data-stu-id="f135c-223">To help guide your decision, the following table compares the choices based on the estimated data loss or recovery point objective (RPO) and estimated recovery time (ERT).</span></span>

| <span data-ttu-id="f135c-224">Modello</span><span class="sxs-lookup"><span data-stu-id="f135c-224">Pattern</span></span> | <span data-ttu-id="f135c-225">RPO</span><span class="sxs-lookup"><span data-stu-id="f135c-225">RPO</span></span> | <span data-ttu-id="f135c-226">ERT</span><span class="sxs-lookup"><span data-stu-id="f135c-226">ERT</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="f135c-227">Distribuzione attiva/passiva per il ripristino di emergenza con accesso al database con percorso condiviso</span><span class="sxs-lookup"><span data-stu-id="f135c-227">Active-passive deployment for disaster recovery with co-located database access</span></span> |<span data-ttu-id="f135c-228">Accesso in lettura/scrittura < 5 sec</span><span class="sxs-lookup"><span data-stu-id="f135c-228">Read-write access < 5 sec</span></span> |<span data-ttu-id="f135c-229">Ora di rilevamento dell'errore + DNS TTL</span><span class="sxs-lookup"><span data-stu-id="f135c-229">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="f135c-230">Distribuzione attiva/attiva per il bilanciamento del carico dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="f135c-230">Active-active deployment for application load balancing</span></span> |<span data-ttu-id="f135c-231">Accesso in lettura/scrittura < 5 sec</span><span class="sxs-lookup"><span data-stu-id="f135c-231">Read-write access < 5 sec</span></span> |<span data-ttu-id="f135c-232">Ora di rilevamento dell'errore + DNS TTL</span><span class="sxs-lookup"><span data-stu-id="f135c-232">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="f135c-233">Distribuzione attiva/passiva per la conservazione dei dati</span><span class="sxs-lookup"><span data-stu-id="f135c-233">Active-passive deployment for data preservation</span></span> |<span data-ttu-id="f135c-234">Accesso in sola lettura < 5 sec</span><span class="sxs-lookup"><span data-stu-id="f135c-234">Read-only access < 5 sec</span></span> | <span data-ttu-id="f135c-235">Accesso in sola lettura = 0</span><span class="sxs-lookup"><span data-stu-id="f135c-235">Read-only access = 0</span></span> |
||<span data-ttu-id="f135c-236">Accesso in lettura/scrittura = zero</span><span class="sxs-lookup"><span data-stu-id="f135c-236">Read-write access = zero</span></span> | <span data-ttu-id="f135c-237">Accesso in lettura-scrittura = ora di rilevamento dell'errore + periodo di tolleranza con perdita di dati</span><span class="sxs-lookup"><span data-stu-id="f135c-237">Read-write access = Failure detection time + grace period with data loss</span></span> |
|||

## <a name="next-steps"></a><span data-ttu-id="f135c-238">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="f135c-238">Next steps</span></span>
* <span data-ttu-id="f135c-239">Per informazioni sui backup automatici del database SQL di Azure, vedere [Panoramica: Backup automatici del database SQL](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="f135c-239">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="f135c-240">Per la panoramica e gli scenari della continuità aziendale, vedere [Continuità aziendale del database SQL di Azure](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="f135c-240">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="f135c-241">Per altre informazioni sull'uso dei backup automatici per il ripristino, vedere l'articolo relativo al [ripristino di un database dai backup avviati dal servizio](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="f135c-241">To learn about using automated backups for recovery, see [restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span></span>
* <span data-ttu-id="f135c-242">Per altre informazioni sulle opzioni di ripristino più veloci, vedere [Panoramica: Replica geografica attiva per il database SQL di Azure](sql-database-geo-replication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="f135c-242">To learn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md)</span></span>  
* <span data-ttu-id="f135c-243">Per altre informazioni sull'uso di backup automatici per l'archiviazione, vedere [Copia del database](sql-database-copy.md)</span><span class="sxs-lookup"><span data-stu-id="f135c-243">To learn about using automated backups for archiving, see [database copy](sql-database-copy.md)</span></span>
* <span data-ttu-id="f135c-244">Per informazioni sulla replica geografica attiva con i pool elastici, vedere [Strategie di ripristino di emergenza per applicazioni che usano il pool elastico del database SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="f135c-244">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
