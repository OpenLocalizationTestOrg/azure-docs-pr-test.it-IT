---
title: Come aggiornare un servizio cloud | Documentazione Microsoft
description: "Informazioni su come aggiornare i servizi cloud in Azure. Informazioni su come viene eseguito un aggiornamento in un servizio cloud per assicurare la disponibilità."
services: cloud-services
documentationcenter: 
author: Thraka
manager: timlt
editor: 
ms.assetid: c6a8b5e6-5c99-454c-9911-5c7ae8d1af63
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/19/2017
ms.author: adegeo
ms.openlocfilehash: 2ba9676ed2afce7f18446642527971f5001b5ca7
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-update-a-cloud-service"></a><span data-ttu-id="6a512-104">Come aggiornare un servizio cloud</span><span class="sxs-lookup"><span data-stu-id="6a512-104">How to update a cloud service</span></span>

<span data-ttu-id="6a512-105">L'aggiornamento di un servizio cloud, inclusi i ruoli e il sistema operativo guest, è un processo in tre passaggi.</span><span class="sxs-lookup"><span data-stu-id="6a512-105">Updating a cloud service, including both its roles and guest OS, is a three step process.</span></span> <span data-ttu-id="6a512-106">Prima devono essere caricati i file binari e di configurazione per la nuova versione del nuovo servizio cloud o del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="6a512-106">First, the binaries and configuration files for the new cloud service or OS version must be uploaded.</span></span> <span data-ttu-id="6a512-107">Quindi Azure riserva le risorse di calcolo e di rete per il servizio cloud in base ai requisiti della nuova versione del servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="6a512-107">Next, Azure reserves compute and network resources for the cloud service based on the requirements of the new cloud service version.</span></span> <span data-ttu-id="6a512-108">Infine Azure esegue un aggiornamento in sequenza per aggiornare in modo incrementale il tenant alla nuova versione o al nuovo sistema operativo guest, mantenendo nello stesso tempo la disponibilità.</span><span class="sxs-lookup"><span data-stu-id="6a512-108">Finally, Azure performs a rolling upgrade to incrementally update the tenant to the new version or guest OS, while preserving your availability.</span></span> <span data-ttu-id="6a512-109">Questo articolo illustra i dettagli dell'ultimo passaggio, l'aggiornamento in sequenza.</span><span class="sxs-lookup"><span data-stu-id="6a512-109">This article discusses the details of this last step – the rolling upgrade.</span></span>

## <a name="update-an-azure-service"></a><span data-ttu-id="6a512-110">Aggiornare un servizio di Azure</span><span class="sxs-lookup"><span data-stu-id="6a512-110">Update an Azure Service</span></span>
<span data-ttu-id="6a512-111">Azure organizza le istanze del ruolo in raggruppamenti logici chiamati domini di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="6a512-111">Azure organizes your role instances into logical groupings called upgrade domains (UD).</span></span> <span data-ttu-id="6a512-112">I domini di aggiornamento sono set logici di istanze del ruolo aggiornate come gruppo.</span><span class="sxs-lookup"><span data-stu-id="6a512-112">Upgrade domains (UD) are logical sets of role instances that are updated as a group.</span></span>  <span data-ttu-id="6a512-113">Azure aggiorna un servizio cloud un dominio di aggiornamento alla volta, per consentire alle istanze negli altri domini di aggiornamento di continuare a gestire il traffico.</span><span class="sxs-lookup"><span data-stu-id="6a512-113">Azure updates a cloud service one UD at a time, which allows instances in other UDs to continue serving traffic.</span></span>

<span data-ttu-id="6a512-114">Il numero predefinito di domini di aggiornamento è 5.</span><span class="sxs-lookup"><span data-stu-id="6a512-114">The default number of upgrade domains is 5.</span></span> <span data-ttu-id="6a512-115">È possibile specificare un numero diverso di domini di aggiornamento includendo l'attributo upgradeDomainCount nel file di definizione del servizio (.csdef).</span><span class="sxs-lookup"><span data-stu-id="6a512-115">You can specify a different number of upgrade domains by including the upgradeDomainCount attribute in the service’s definition file (.csdef).</span></span> <span data-ttu-id="6a512-116">Per altre informazioni sull'attributo upgradeDomainCount, vedere [WebRole Schema](https://msdn.microsoft.com/library/azure/gg557553.aspx) (Schema WebRole) o [WorkerRole Schema](https://msdn.microsoft.com/library/azure/gg557552.aspx) (Schema WorkerRole).</span><span class="sxs-lookup"><span data-stu-id="6a512-116">For more information about the upgradeDomainCount attribute, see [WebRole Schema](https://msdn.microsoft.com/library/azure/gg557553.aspx) or [WorkerRole Schema](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span></span>

<span data-ttu-id="6a512-117">Quando si esegue un aggiornamento sul posto di uno o più ruoli nel servizio, Azure aggiorna i set di istanze del ruolo in base al dominio di aggiornamento a cui appartengono.</span><span class="sxs-lookup"><span data-stu-id="6a512-117">When you perform an in-place update of one or more roles in your service, Azure updates sets of role instances according to the upgrade domain to which they belong.</span></span> <span data-ttu-id="6a512-118">Azure aggiorna tutte le istanze in un determinato dominio di aggiornamento (arrestandole, aggiornandole, riportandole online), quindi passa al dominio successivo.</span><span class="sxs-lookup"><span data-stu-id="6a512-118">Azure updates all of the instances in a given upgrade domain – stopping them, updating them, bringing them back on-line – then moves onto the next domain.</span></span> <span data-ttu-id="6a512-119">Arrestando solo le istanze in esecuzione nel dominio di aggiornamento corrente, Azure fa in modo che un aggiornamento venga eseguito con il minor impatto possibile sul servizio in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="6a512-119">By stopping only the instances running in the current upgrade domain, Azure makes sure that an update occurs with the least possible impact to the running service.</span></span> <span data-ttu-id="6a512-120">Per altre informazioni, vedere [Come avviene un aggiornamento](#howanupgradeproceeds) .</span><span class="sxs-lookup"><span data-stu-id="6a512-120">For more information, see [How the update proceeds](#howanupgradeproceeds) later in this article.</span></span>

> [!NOTE]
> <span data-ttu-id="6a512-121">Anche se i termini inglesi **update** e **upgrade** hanno un significato leggermente diverso nel contesto di Azure, sono stati entrambi tradotti con il termine italiano "aggiornamento" in relazione ai processi e alle descrizioni delle funzionalità di questo documento.</span><span class="sxs-lookup"><span data-stu-id="6a512-121">While the terms **update** and **upgrade** have slightly different meaning in the context Azure, they can be used interchangeably for the processes and descriptions of the features in this document.</span></span>
>
>

<span data-ttu-id="6a512-122">Il servizio deve definire almeno due istanze di un ruolo per aggiornarlo sul posto senza tempi di inattività.</span><span class="sxs-lookup"><span data-stu-id="6a512-122">Your service must define at least two instances of a role for that role to be updated in-place without downtime.</span></span> <span data-ttu-id="6a512-123">Se il servizio è costituito da una sola istanza di un ruolo, il servizio non sarà disponibile fino al termine dell'aggiornamento sul posto.</span><span class="sxs-lookup"><span data-stu-id="6a512-123">If the service consists of only one instance of one role, your service will be unavailable until the in-place update has finished.</span></span>

<span data-ttu-id="6a512-124">Questo argomento contiene le informazioni seguenti sugli aggiornamenti di Azure:</span><span class="sxs-lookup"><span data-stu-id="6a512-124">This topic covers the following information about Azure updates:</span></span>

* [<span data-ttu-id="6a512-125">Modifiche consentite al servizio durante un aggiornamento</span><span class="sxs-lookup"><span data-stu-id="6a512-125">Allowed service changes during an update</span></span>](#AllowedChanges)
* [<span data-ttu-id="6a512-126">Come avviene un aggiornamento</span><span class="sxs-lookup"><span data-stu-id="6a512-126">How an upgrade proceeds</span></span>](#howanupgradeproceeds)
* [<span data-ttu-id="6a512-127">Ripristino dello stato precedente di un aggiornamento</span><span class="sxs-lookup"><span data-stu-id="6a512-127">Rollback of an update</span></span>](#RollbackofanUpdate)
* [<span data-ttu-id="6a512-128">Avvio di più operazioni di mutazione durante una distribuzione</span><span class="sxs-lookup"><span data-stu-id="6a512-128">Initiating multiple mutating operations on an ongoing deployment</span></span>](#multiplemutatingoperations)
* [<span data-ttu-id="6a512-129">Distribuzione di ruoli nei domini di aggiornamento</span><span class="sxs-lookup"><span data-stu-id="6a512-129">Distribution of roles across upgrade domains</span></span>](#distributiondfroles)

<a name="AllowedChanges"></a>

## <a name="allowed-service-changes-during-an-update"></a><span data-ttu-id="6a512-130">Modifiche consentite al servizio durante un aggiornamento</span><span class="sxs-lookup"><span data-stu-id="6a512-130">Allowed service changes during an update</span></span>
<span data-ttu-id="6a512-131">La tabella seguente mostra le modifiche consentite a un servizio durante un aggiornamento:</span><span class="sxs-lookup"><span data-stu-id="6a512-131">The following table shows the allowed changes to a service during an update:</span></span>

| <span data-ttu-id="6a512-132">Modifiche consentite a hosting, servizi e ruoli</span><span class="sxs-lookup"><span data-stu-id="6a512-132">Changes permitted to hosting, services, and roles</span></span> | <span data-ttu-id="6a512-133">Aggiornamento sul posto</span><span class="sxs-lookup"><span data-stu-id="6a512-133">In-place update</span></span> | <span data-ttu-id="6a512-134">Gestione temporanea (scambio indirizzi VIP)</span><span class="sxs-lookup"><span data-stu-id="6a512-134">Staged (VIP swap)</span></span> | <span data-ttu-id="6a512-135">Eliminazione e ridistribuzione</span><span class="sxs-lookup"><span data-stu-id="6a512-135">Delete and re-deploy</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="6a512-136">Versione del sistema operativo</span><span class="sxs-lookup"><span data-stu-id="6a512-136">Operating system version</span></span> |<span data-ttu-id="6a512-137">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-137">Yes</span></span> |<span data-ttu-id="6a512-138">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-138">Yes</span></span> |<span data-ttu-id="6a512-139">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-139">Yes</span></span> |
| <span data-ttu-id="6a512-140">Livello di attendibilità .NET</span><span class="sxs-lookup"><span data-stu-id="6a512-140">.NET trust level</span></span> |<span data-ttu-id="6a512-141">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-141">Yes</span></span> |<span data-ttu-id="6a512-142">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-142">Yes</span></span> |<span data-ttu-id="6a512-143">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-143">Yes</span></span> |
| <span data-ttu-id="6a512-144">Dimensioni macchina virtuale<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="6a512-144">Virtual machine size<sup>1</sup></span></span> |<span data-ttu-id="6a512-145">Sì<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="6a512-145">Yes<sup>2</sup></span></span> |<span data-ttu-id="6a512-146">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-146">Yes</span></span> |<span data-ttu-id="6a512-147">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-147">Yes</span></span> |
| <span data-ttu-id="6a512-148">Impostazioni di archiviazione locali</span><span class="sxs-lookup"><span data-stu-id="6a512-148">Local storage settings</span></span> |<span data-ttu-id="6a512-149">Solo aumento<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="6a512-149">Increase only<sup>2</sup></span></span> |<span data-ttu-id="6a512-150">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-150">Yes</span></span> |<span data-ttu-id="6a512-151">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-151">Yes</span></span> |
| <span data-ttu-id="6a512-152">Aggiungere o rimuovere ruoli in un servizio</span><span class="sxs-lookup"><span data-stu-id="6a512-152">Add or remove roles in a service</span></span> |<span data-ttu-id="6a512-153">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-153">Yes</span></span> |<span data-ttu-id="6a512-154">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-154">Yes</span></span> |<span data-ttu-id="6a512-155">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-155">Yes</span></span> |
| <span data-ttu-id="6a512-156">Numero di istanze di un particolare ruolo</span><span class="sxs-lookup"><span data-stu-id="6a512-156">Number of instances of a particular role</span></span> |<span data-ttu-id="6a512-157">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-157">Yes</span></span> |<span data-ttu-id="6a512-158">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-158">Yes</span></span> |<span data-ttu-id="6a512-159">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-159">Yes</span></span> |
| <span data-ttu-id="6a512-160">Numero o tipo di endpoint per un servizio</span><span class="sxs-lookup"><span data-stu-id="6a512-160">Number or type of endpoints for a service</span></span> |<span data-ttu-id="6a512-161">Sì<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="6a512-161">Yes<sup>2</sup></span></span> |<span data-ttu-id="6a512-162">No</span><span class="sxs-lookup"><span data-stu-id="6a512-162">No</span></span> |<span data-ttu-id="6a512-163">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-163">Yes</span></span> |
| <span data-ttu-id="6a512-164">Nomi e i valori delle impostazioni di configurazione</span><span class="sxs-lookup"><span data-stu-id="6a512-164">Names and values of configuration settings</span></span> |<span data-ttu-id="6a512-165">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-165">Yes</span></span> |<span data-ttu-id="6a512-166">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-166">Yes</span></span> |<span data-ttu-id="6a512-167">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-167">Yes</span></span> |
| <span data-ttu-id="6a512-168">Valori (ma non nomi) delle impostazioni di configurazione</span><span class="sxs-lookup"><span data-stu-id="6a512-168">Values (but not names) of configuration settings</span></span> |<span data-ttu-id="6a512-169">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-169">Yes</span></span> |<span data-ttu-id="6a512-170">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-170">Yes</span></span> |<span data-ttu-id="6a512-171">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-171">Yes</span></span> |
| <span data-ttu-id="6a512-172">Aggiungere nuovi certificati</span><span class="sxs-lookup"><span data-stu-id="6a512-172">Add new certificates</span></span> |<span data-ttu-id="6a512-173">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-173">Yes</span></span> |<span data-ttu-id="6a512-174">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-174">Yes</span></span> |<span data-ttu-id="6a512-175">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-175">Yes</span></span> |
| <span data-ttu-id="6a512-176">Modificare i certificati esistenti</span><span class="sxs-lookup"><span data-stu-id="6a512-176">Change existing certificates</span></span> |<span data-ttu-id="6a512-177">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-177">Yes</span></span> |<span data-ttu-id="6a512-178">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-178">Yes</span></span> |<span data-ttu-id="6a512-179">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-179">Yes</span></span> |
| <span data-ttu-id="6a512-180">Distribuire nuovo codice</span><span class="sxs-lookup"><span data-stu-id="6a512-180">Deploy new code</span></span> |<span data-ttu-id="6a512-181">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-181">Yes</span></span> |<span data-ttu-id="6a512-182">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-182">Yes</span></span> |<span data-ttu-id="6a512-183">Sì</span><span class="sxs-lookup"><span data-stu-id="6a512-183">Yes</span></span> |

<span data-ttu-id="6a512-184"><sup>1</sup> Modifica delle dimensioni limitata al sottoinsieme di dimensioni disponibili per il servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="6a512-184"><sup>1</sup> Size change limited to the subset of sizes available for the cloud service.</span></span>

<span data-ttu-id="6a512-185"><sup>2</sup> Richiede Azure SDK 1.5 o versioni successive.</span><span class="sxs-lookup"><span data-stu-id="6a512-185"><sup>2</sup> Requires Azure SDK 1.5 or later versions.</span></span>

> [!WARNING]
> <span data-ttu-id="6a512-186">La modifica della dimensione di una macchina virtuale eliminerà i dati locali.</span><span class="sxs-lookup"><span data-stu-id="6a512-186">Changing the virtual machine size will destroy local data.</span></span>
>
>

<span data-ttu-id="6a512-187">Gli elementi seguenti non sono supportati durante un aggiornamento:</span><span class="sxs-lookup"><span data-stu-id="6a512-187">The following items are not supported during an update:</span></span>

* <span data-ttu-id="6a512-188">Modifica del nome di un ruolo.</span><span class="sxs-lookup"><span data-stu-id="6a512-188">Changing the name of a role.</span></span> <span data-ttu-id="6a512-189">Rimuovere e quindi aggiungere il ruolo con il nuovo nome.</span><span class="sxs-lookup"><span data-stu-id="6a512-189">Remove and then add the role with the new name.</span></span>
* <span data-ttu-id="6a512-190">Modifica del conteggio dei domini di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="6a512-190">Changing of the Upgrade Domain count.</span></span>
* <span data-ttu-id="6a512-191">Riduzione della dimensione delle risorse locali.</span><span class="sxs-lookup"><span data-stu-id="6a512-191">Decreasing the size of the local resources.</span></span>

<span data-ttu-id="6a512-192">Se intende eseguire altri aggiornamenti alla definizione del servizio, ad esempio la riduzione della dimensione di una risorsa locale, è necessario eseguire invece un aggiornamento dello scambio di indirizzi VIP.</span><span class="sxs-lookup"><span data-stu-id="6a512-192">If you are making other updates to your service's definition, such as decreasing the size of local resource, you must perform a VIP swap update instead.</span></span> <span data-ttu-id="6a512-193">Per altre informazioni, vedere [Scambiare la distribuzione](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span><span class="sxs-lookup"><span data-stu-id="6a512-193">For more information, see [Swap Deployment](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span></span>

<a name="howanupgradeproceeds"></a>

## <a name="how-an-upgrade-proceeds"></a><span data-ttu-id="6a512-194">Come avviene un aggiornamento</span><span class="sxs-lookup"><span data-stu-id="6a512-194">How an upgrade proceeds</span></span>
<span data-ttu-id="6a512-195">È possibile decidere se aggiornare tutti i ruoli del servizio oppure uno solo.</span><span class="sxs-lookup"><span data-stu-id="6a512-195">You can decide whether you want to update all of the roles in your service or a single role in the service.</span></span> <span data-ttu-id="6a512-196">In entrambi i casi, tutte le istanze di ogni ruolo che verrà aggiornato e appartiene al primo dominio di aggiornamento verranno arrestate, aggiornate e riportate online.</span><span class="sxs-lookup"><span data-stu-id="6a512-196">In either case, all instances of each role that is being upgraded and belong to the first upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="6a512-197">Quando sono di nuovo online, vengono arrestate, aggiornate e riportate online le istanze nel secondo dominio di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="6a512-197">Once they are back online, the instances in the second upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="6a512-198">Un servizio cloud non può avere più di un aggiornamento attivo per volta.</span><span class="sxs-lookup"><span data-stu-id="6a512-198">A cloud service can have at most one upgrade active at a time.</span></span> <span data-ttu-id="6a512-199">L'aggiornamento viene sempre eseguito usando la versione più recente del servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="6a512-199">The upgrade is always performed against the latest version of the cloud service.</span></span>

<span data-ttu-id="6a512-200">Il diagramma seguente illustra come avviene l'aggiornamento se si aggiornano tutti i ruoli nel servizio:</span><span class="sxs-lookup"><span data-stu-id="6a512-200">The following diagram illustrates how the upgrade proceeds if you are upgrading all of the roles in the service:</span></span>

<span data-ttu-id="6a512-201">![Servizio di aggiornamento](media/cloud-services-update-azure-service/IC345879.png "Servizio di aggiornamento")</span><span class="sxs-lookup"><span data-stu-id="6a512-201">![Upgrade service](media/cloud-services-update-azure-service/IC345879.png "Upgrade service")</span></span>

<span data-ttu-id="6a512-202">Il diagramma successivo illustra come avviene l'aggiornamento se si aggiorna un solo ruolo:</span><span class="sxs-lookup"><span data-stu-id="6a512-202">This next diagram illustrates how the update proceeds if you are upgrading only a single role:</span></span>

<span data-ttu-id="6a512-203">![Aggiornamento ruolo](media/cloud-services-update-azure-service/IC345880.png "Aggiornamento ruolo")</span><span class="sxs-lookup"><span data-stu-id="6a512-203">![Upgrade role](media/cloud-services-update-azure-service/IC345880.png "Upgrade role")</span></span>  

<span data-ttu-id="6a512-204">Durante un aggiornamento automatico, il controller di infrastruttura di Azure valuta periodicamente l'integrità del servizio cloud per determinare quando è sicuro passare al dominio di aggiornamento successivo.</span><span class="sxs-lookup"><span data-stu-id="6a512-204">During an automatic update, the Azure Fabric Controller periodically evaluates the health of the cloud service to determine when it’s safe to walk the next UD.</span></span> <span data-ttu-id="6a512-205">Questa valutazione dell'integrità viene eseguita per ogni singolo ruolo e considera solo le istanze nella versione più recente (ad esempio, le istanze dei domini di aggiornamento già analizzati).</span><span class="sxs-lookup"><span data-stu-id="6a512-205">This health evaluation is performed on a per-role basis and considers only instances in the latest version (i.e. instances from UDs that have already been walked).</span></span> <span data-ttu-id="6a512-206">Verifica che un numero minimo di istanze del ruolo, per ogni ruolo, abbia raggiunto uno stato finale soddisfacente.</span><span class="sxs-lookup"><span data-stu-id="6a512-206">It verifies that a minimum number of role instances, for each role, have achieved a satisfactory terminal state.</span></span>

### <a name="role-instance-start-timeout"></a><span data-ttu-id="6a512-207">Timeout dell'avvio dell’istanza del ruolo</span><span class="sxs-lookup"><span data-stu-id="6a512-207">Role Instance Start Timeout</span></span>
<span data-ttu-id="6a512-208">Il controller di infrastruttura attende 30 minuti affinché ogni istanza del ruolo raggiunga uno stato avviato.</span><span class="sxs-lookup"><span data-stu-id="6a512-208">The Fabric Controller will wait 30 minutes for each role instance to reach a Started state.</span></span> <span data-ttu-id="6a512-209">Se la durata del timeout scade, il controller di infrastruttura prosegue all'istanza del ruolo successivo.</span><span class="sxs-lookup"><span data-stu-id="6a512-209">If the timeout duration elapses, the Fabric Controller will continue walking to the next role instance.</span></span>

### <a name="impact-to-drive-data-during-cloud-service-upgrades"></a><span data-ttu-id="6a512-210">Impatto sui dati delle unità durante gli aggiornamenti dei servizi cloud</span><span class="sxs-lookup"><span data-stu-id="6a512-210">Impact to drive data during Cloud Service upgrades</span></span>

<span data-ttu-id="6a512-211">Quando si aggiorna un servizio da una sola istanza a più istanze, il servizio sarà inattivo durante l'esecuzione dell'aggiornamento a causa della modalità di aggiornamento dei servizi in Azure.</span><span class="sxs-lookup"><span data-stu-id="6a512-211">When upgrading a service from a single instance to multiple instances your service will be brought down while the upgrade is performed due to the way Azure upgrades services.</span></span> <span data-ttu-id="6a512-212">Il contratto di servizio che garantisce la disponibilità del servizio si applica solo ai servizi distribuiti con più di una istanza.</span><span class="sxs-lookup"><span data-stu-id="6a512-212">The service level agreement guaranteeing service availability only applies to services that are deployed with more than one instance.</span></span> <span data-ttu-id="6a512-213">L'elenco seguente descrive come ogni scenario di aggiornamento di un servizio di Azure influisce sui dati di ogni unità:</span><span class="sxs-lookup"><span data-stu-id="6a512-213">The following list describes how the data on each drive is affected by each Azure service upgrade scenario:</span></span>

|<span data-ttu-id="6a512-214">Scenario</span><span class="sxs-lookup"><span data-stu-id="6a512-214">Scenario</span></span>|<span data-ttu-id="6a512-215">Unità C</span><span class="sxs-lookup"><span data-stu-id="6a512-215">C Drive</span></span>|<span data-ttu-id="6a512-216">Unità D</span><span class="sxs-lookup"><span data-stu-id="6a512-216">D Drive</span></span>|<span data-ttu-id="6a512-217">Unità E</span><span class="sxs-lookup"><span data-stu-id="6a512-217">E Drive</span></span>|
|--------|-------|-------|-------|
|<span data-ttu-id="6a512-218">Riavvio VM</span><span class="sxs-lookup"><span data-stu-id="6a512-218">VM reboot</span></span>|<span data-ttu-id="6a512-219">Mantenuta</span><span class="sxs-lookup"><span data-stu-id="6a512-219">Preserved</span></span>|<span data-ttu-id="6a512-220">Mantenuta</span><span class="sxs-lookup"><span data-stu-id="6a512-220">Preserved</span></span>|<span data-ttu-id="6a512-221">Mantenuta</span><span class="sxs-lookup"><span data-stu-id="6a512-221">Preserved</span></span>|
|<span data-ttu-id="6a512-222">Riavvio del portale</span><span class="sxs-lookup"><span data-stu-id="6a512-222">Portal reboot</span></span>|<span data-ttu-id="6a512-223">Mantenuta</span><span class="sxs-lookup"><span data-stu-id="6a512-223">Preserved</span></span>|<span data-ttu-id="6a512-224">Mantenuta</span><span class="sxs-lookup"><span data-stu-id="6a512-224">Preserved</span></span>|<span data-ttu-id="6a512-225">Eliminata</span><span class="sxs-lookup"><span data-stu-id="6a512-225">Destroyed</span></span>|
|<span data-ttu-id="6a512-226">Ricreazione dell'immagine del portale</span><span class="sxs-lookup"><span data-stu-id="6a512-226">Portal reimage</span></span>|<span data-ttu-id="6a512-227">Mantenuta</span><span class="sxs-lookup"><span data-stu-id="6a512-227">Preserved</span></span>|<span data-ttu-id="6a512-228">Eliminata</span><span class="sxs-lookup"><span data-stu-id="6a512-228">Destroyed</span></span>|<span data-ttu-id="6a512-229">Eliminata</span><span class="sxs-lookup"><span data-stu-id="6a512-229">Destroyed</span></span>|
|<span data-ttu-id="6a512-230">Aggiornamento sul posto</span><span class="sxs-lookup"><span data-stu-id="6a512-230">In-Place Upgrade</span></span>|<span data-ttu-id="6a512-231">Mantenuta</span><span class="sxs-lookup"><span data-stu-id="6a512-231">Preserved</span></span>|<span data-ttu-id="6a512-232">Mantenuta</span><span class="sxs-lookup"><span data-stu-id="6a512-232">Preserved</span></span>|<span data-ttu-id="6a512-233">Eliminata</span><span class="sxs-lookup"><span data-stu-id="6a512-233">Destroyed</span></span>|
|<span data-ttu-id="6a512-234">Migrazione di un nodo</span><span class="sxs-lookup"><span data-stu-id="6a512-234">Node migration</span></span>|<span data-ttu-id="6a512-235">Eliminata</span><span class="sxs-lookup"><span data-stu-id="6a512-235">Destroyed</span></span>|<span data-ttu-id="6a512-236">Eliminata</span><span class="sxs-lookup"><span data-stu-id="6a512-236">Destroyed</span></span>|<span data-ttu-id="6a512-237">Eliminata</span><span class="sxs-lookup"><span data-stu-id="6a512-237">Destroyed</span></span>|

<span data-ttu-id="6a512-238">Si noti che nell'elenco precedente l'unità E: rappresenta l'unità radice del ruolo e non dovrebbe essere hardcoded.</span><span class="sxs-lookup"><span data-stu-id="6a512-238">Note that, in the above list, the E: drive represents the role’s root drive, and should not be hard-coded.</span></span> <span data-ttu-id="6a512-239">Per rappresentare l'unità, usare invece la variabile di ambiente **%RoleRoot%**.</span><span class="sxs-lookup"><span data-stu-id="6a512-239">Instead, use the **%RoleRoot%** environment variable to represent the drive.</span></span>

<span data-ttu-id="6a512-240">Per ridurre al minimo il tempo di inattività durante l'aggiornamento di un servizio a istanza singola, distribuire un nuovo servizio a più istanze nel server di staging ed eseguire uno scambio di indirizzi VIP.</span><span class="sxs-lookup"><span data-stu-id="6a512-240">To minimize the downtime when upgrading a single-instance service, deploy a new multi-instance service to the staging server and perform a VIP swap.</span></span>

<a name="RollbackofanUpdate"></a>

## <a name="rollback-of-an-update"></a><span data-ttu-id="6a512-241">Ripristino dello stato precedente di un aggiornamento</span><span class="sxs-lookup"><span data-stu-id="6a512-241">Rollback of an update</span></span>
<span data-ttu-id="6a512-242">Azure offre flessibilità nella gestione dei servizi durante un aggiornamento perché consente di avviare altre operazioni su un servizio, dopo che la richiesta di aggiornamento iniziale è stata accettata dal controller di infrastruttura di Azure.</span><span class="sxs-lookup"><span data-stu-id="6a512-242">Azure provides flexibility in managing services during an update by letting you initiate additional operations on a service, after the initial update request is accepted by the Azure Fabric Controller.</span></span> <span data-ttu-id="6a512-243">Un ripristino dello stato precedente può essere eseguito solo quando una modifica della configurazione o un aggiornamento è nello stato **in corso** durante la distribuzione.</span><span class="sxs-lookup"><span data-stu-id="6a512-243">A rollback can only be performed when an update (configuration change) or upgrade is in the **in progress** state on the deployment.</span></span> <span data-ttu-id="6a512-244">Un aggiornamento viene considerato in corso finché almeno un'istanza del servizio non è ancora stata aggiornata alla nuova versione.</span><span class="sxs-lookup"><span data-stu-id="6a512-244">An update or upgrade is considered to be in-progress as long as there is at least one instance of the service which has not yet been updated to the new version.</span></span> <span data-ttu-id="6a512-245">Per verificare se un ripristino dello stato precedente è consentito, controllare che il valore del flag RollbackAllowed, restituito dalle operazioni [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) e [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx), sia impostato su true.</span><span class="sxs-lookup"><span data-stu-id="6a512-245">To test whether a rollback is allowed, check the value of the RollbackAllowed flag, returned by [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations, is set to true.</span></span>

> [!NOTE]
> <span data-ttu-id="6a512-246">Chiamare ripristino dello stato precedente è utile solo per un aggiornamento **sul posto** perché gli aggiornamenti con scambio di indirizzo VIP comportano la sostituzione di un'intera istanza in esecuzione del servizio con un'altra.</span><span class="sxs-lookup"><span data-stu-id="6a512-246">It only makes sense to call Rollback on an **in-place** update or upgrade because VIP swap upgrades involve replacing one entire running instance of your service with another.</span></span>
>
>

<span data-ttu-id="6a512-247">Il ripristino dello stato precedente di un aggiornamento in corso ha gli effetti seguenti sulla distribuzione:</span><span class="sxs-lookup"><span data-stu-id="6a512-247">Rollback of an in-progress update has the following effects on the deployment:</span></span>

* <span data-ttu-id="6a512-248">Le istanze del ruolo che non erano ancora state aggiornate alla nuova versione non vengono aggiornate, perché tali istanze stanno già eseguendo la versione di destinazione del servizio.</span><span class="sxs-lookup"><span data-stu-id="6a512-248">Any role instances which had not yet been updated or upgraded to the new version are not updated or upgraded, because those instances are already running the target version of the service.</span></span>
* <span data-ttu-id="6a512-249">Per le istanze del ruolo che erano già state aggiornate alla nuova versione del file del pacchetto del servizio (\*.cspkg), del file di configurazione del servizio (\*.cscfg) o di entrambi i file viene ripristinata la versione pre-aggiornamento di questi file.</span><span class="sxs-lookup"><span data-stu-id="6a512-249">Any role instances which had already been updated or upgraded to the new version of the service package (\*.cspkg) file or the service configuration (\*.cscfg) file (or both files) are reverted to the pre-upgrade version of these files.</span></span>

<span data-ttu-id="6a512-250">Questa funzionalità viene fornita dalle funzioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="6a512-250">This functionally is provided by the following features:</span></span>

* <span data-ttu-id="6a512-251">Operazione [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx), che può essere chiamata per un aggiornamento della configurazione (attivato chiamando [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx)) o per un aggiornamento (attivato chiamando [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx)) purché sia presente almeno un'istanza nel servizio non ancora aggiornata alla nuova versione.</span><span class="sxs-lookup"><span data-stu-id="6a512-251">The [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation, which can be called on a configuration update (triggered by calling [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx)) or an upgrade (triggered by calling [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx)) as long as there is at least one instance in the service which has not yet been updated to the new version.</span></span>
* <span data-ttu-id="6a512-252">Elemento Locked ed elemento RollbackAllowed, restituiti come parte del corpo della risposta delle operazioni [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) e [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx):</span><span class="sxs-lookup"><span data-stu-id="6a512-252">The Locked element and the RollbackAllowed element, which are returned as part of the response body of the [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations:</span></span>

  1. <span data-ttu-id="6a512-253">L'elemento Locked consente di rilevare quando un'operazione di mutazione può essere richiamata in una determinata distribuzione.</span><span class="sxs-lookup"><span data-stu-id="6a512-253">The Locked element allows you to detect when a mutating operation can be invoked on a given deployment.</span></span>
  2. <span data-ttu-id="6a512-254">L'elemento RollbackAllowed consente di rilevare quando l'operazione [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) può essere chiamata in una determinata distribuzione.</span><span class="sxs-lookup"><span data-stu-id="6a512-254">The RollbackAllowed element allows you to detect when the [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation can be called on a given deployment.</span></span>

  <span data-ttu-id="6a512-255">Per eseguire un ripristino dello stato precedente, non è necessario controllare entrambi gli elementi Locked e RollbackAllowed.</span><span class="sxs-lookup"><span data-stu-id="6a512-255">In order to perform a rollback, you do not have to check both the Locked and the RollbackAllowed elements.</span></span> <span data-ttu-id="6a512-256">È sufficiente verificare che RollbackAllowed sia impostato su true.</span><span class="sxs-lookup"><span data-stu-id="6a512-256">It suffices to confirm that RollbackAllowed is set to true.</span></span> <span data-ttu-id="6a512-257">Questi elementi vengono restituiti solo se questi metodi vengono richiamati usando l'intestazione della richiesta impostata su "x-ms-version: 2011-10-01" o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="6a512-257">These elements are only returned if these methods are invoked by using the request header set to “x-ms-version: 2011-10-01” or a later version.</span></span> <span data-ttu-id="6a512-258">Per altre informazioni sul controllo delle versioni delle intestazioni, vedere [Controllo delle versioni di gestione del servizio](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span><span class="sxs-lookup"><span data-stu-id="6a512-258">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<span data-ttu-id="6a512-259">In alcune situazioni un ripristino dello stato precedente di un aggiornamento non è supportato, come nei casi seguenti:</span><span class="sxs-lookup"><span data-stu-id="6a512-259">There are some situations where a rollback of an update or upgrade is not supported, these are as follows:</span></span>

* <span data-ttu-id="6a512-260">Riduzione nelle risorse locali: se l'aggiornamento aumenta le risorse locali per un ruolo, la piattaforma Azure non consente il ripristino dello stato precedente.</span><span class="sxs-lookup"><span data-stu-id="6a512-260">Reduction in local resources - If the update increases the local resources for a role the Azure platform does not allow rolling back.</span></span>
* <span data-ttu-id="6a512-261">Limitazioni della quota: se l'aggiornamento ha comportato un'operazione di riduzione, è possibile che la quota di calcolo non sia più sufficiente per completare l'operazione di ripristino dello stato precedente.</span><span class="sxs-lookup"><span data-stu-id="6a512-261">Quota limitations - If the update was a scale down operation you may no longer have sufficient compute quota to complete the rollback operation.</span></span> <span data-ttu-id="6a512-262">A ogni sottoscrizione di Azure è associata una quota che specifica il numero massimo di memorie centrali che possono essere utilizzate da tutti i servizi ospitati appartenenti a tale sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="6a512-262">Each Azure subscription has a quota associated with it that specifies the maximum number of cores which can be consumed by all hosted services that belong to that subscription.</span></span> <span data-ttu-id="6a512-263">Se l'esecuzione di un ripristino dello stato precedente di un determinato aggiornamento farà superare la quota prevista per la sottoscrizione, il ripristino dello stato precedente non verrà abilitato.</span><span class="sxs-lookup"><span data-stu-id="6a512-263">If performing a rollback of a given update would put your subscription over quota then that a rollback will not be enabled.</span></span>
* <span data-ttu-id="6a512-264">Race condition: se l'aggiornamento iniziale è stato completato, un ripristino dello stato precedente non è possibile.</span><span class="sxs-lookup"><span data-stu-id="6a512-264">Race condition - If the initial update has completed, a rollback is not possible.</span></span>

<span data-ttu-id="6a512-265">Il ripristino dello stato precedente di un aggiornamento può essere utile, ad esempio, se si usa l'operazione [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) in modalità manuale per controllare la frequenza con cui un aggiornamento sul posto principale del servizio ospitato di Azure viene distribuito.</span><span class="sxs-lookup"><span data-stu-id="6a512-265">An example of when the rollback of an update might be useful is if you are using the [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) operation in manual mode to control the rate at which a major in-place upgrade to your Azure hosted service is rolled out.</span></span>

<span data-ttu-id="6a512-266">Durante la distribuzione dell'aggiornamento chiamare [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) in modalità manuale e iniziare ad analizzare i domini di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="6a512-266">During the rollout of the upgrade you call [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) in manual mode and begin to walk upgrade domains.</span></span> <span data-ttu-id="6a512-267">Se a un certo punto, durante il monitoraggio dell'aggiornamento, si nota che alcune istanze del ruolo nei primi domini di aggiornamento esaminati non rispondono più, chiamare l'operazione [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) nella distribuzione, che lascerà invariate le istanze non ancora aggiornate e ripristinerà il Service Pack e la configurazione precedenti delle istanze aggiornate.</span><span class="sxs-lookup"><span data-stu-id="6a512-267">If at some point, as you monitor the upgrade, you note some role instances in the first upgrade domains that you examine have become unresponsive, you can call the [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation on the deployment, which will leave untouched the instances which had not yet been upgraded and rollback instances which had been upgraded to the previous service package and configuration.</span></span>

<a name="multiplemutatingoperations"></a>

## <a name="initiating-multiple-mutating-operations-on-an-ongoing-deployment"></a><span data-ttu-id="6a512-268">Avvio di più operazioni di mutazione durante una distribuzione</span><span class="sxs-lookup"><span data-stu-id="6a512-268">Initiating multiple mutating operations on an ongoing deployment</span></span>
<span data-ttu-id="6a512-269">In alcuni casi potrebbe essere necessario avviare più operazioni di mutazione simultanee in una distribuzione in corso.</span><span class="sxs-lookup"><span data-stu-id="6a512-269">In some cases you may want to initiate multiple simultaneous mutating operations on an ongoing deployment.</span></span> <span data-ttu-id="6a512-270">Ad esempio, eseguendo l'aggiornamento di un servizio, mentre l'aggiornamento viene distribuito nel servizio, potrebbe essere necessario apportare alcune modifiche, come il ripristino dello stato precedente dell'aggiornamento, l'applicazione di un aggiornamento diverso o anche l'eliminazione della distribuzione.</span><span class="sxs-lookup"><span data-stu-id="6a512-270">For example, you may perform a service update and, while that update is being rolled out across your service, you want to make some change, e.g. to roll the update back, apply a different update, or even delete the deployment.</span></span> <span data-ttu-id="6a512-271">Questa necessità, ad esempio, potrebbe presentarsi se l'aggiornamento di un servizio contiene un codice con errori che fa arrestare più volte in modo anomalo un'istanza del ruolo aggiornata.</span><span class="sxs-lookup"><span data-stu-id="6a512-271">A case in which this might be necessary is if a service upgrade contains buggy code which causes an upgraded role instance to repeatedly crash.</span></span> <span data-ttu-id="6a512-272">In questo caso, il controller di infrastruttura di Azure non potrà far proseguire l'applicazione di tale aggiornamento perché il numero di istanze integre nel dominio aggiornato non è sufficiente.</span><span class="sxs-lookup"><span data-stu-id="6a512-272">In this case, the Azure Fabric Controller will not be able to make progress in applying that upgrade because an insufficient number of instances in the upgraded domain are healthy.</span></span> <span data-ttu-id="6a512-273">Questa condizione viene chiamata *distribuzione bloccata*.</span><span class="sxs-lookup"><span data-stu-id="6a512-273">This state is referred to as a *stuck deployment*.</span></span> <span data-ttu-id="6a512-274">Per sbloccare la distribuzione, ripristinare lo stato precedente dell'aggiornamento o applicare un nuovo aggiornamento sopra quello non riuscito.</span><span class="sxs-lookup"><span data-stu-id="6a512-274">You can unstick the deployment by rolling back the update or applying a fresh update over top of the failing one.</span></span>

<span data-ttu-id="6a512-275">Dopo che il controller di infrastruttura di Azure ha ricevuto la richiesta iniziale di aggiornare il servizio, è possibile avviare le operazioni di mutazione successive,</span><span class="sxs-lookup"><span data-stu-id="6a512-275">Once the initial request to update or upgrade the service has been received by the Azure Fabric Controller, you can start subsequent mutating operations.</span></span> <span data-ttu-id="6a512-276">vale a dire che non è necessario attendere il completamento dell'operazione iniziale prima di poter avviare un'altra operazione di mutazione.</span><span class="sxs-lookup"><span data-stu-id="6a512-276">That is, you do not have to wait for the initial operation to complete before you can start another mutating operation.</span></span>

<span data-ttu-id="6a512-277">L'avvio di una seconda operazione di aggiornamento mentre il primo aggiornamento è in corso sarà simile all'operazione di ripristino dello stato precedente.</span><span class="sxs-lookup"><span data-stu-id="6a512-277">Initiating a second update operation while the first update is ongoing will perform similar to the rollback operation.</span></span> <span data-ttu-id="6a512-278">Se il secondo aggiornamento è in modalità automatica, il primo dominio di aggiornamento verrà aggiornato immediatamente e le istanze di più domini di aggiornamento potrebbero passare offline nello stesso momento.</span><span class="sxs-lookup"><span data-stu-id="6a512-278">If the second update is in automatic mode, the first upgrade domain will be upgraded immediately, possibly leading to instances from multiple upgrade domains being offline at the same point in time.</span></span>

<span data-ttu-id="6a512-279">Le operazioni di mutazione sono le seguenti: [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx), [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx), [Update Deployment Status](https://msdn.microsoft.com/library/azure/ee460808.aspx), [Delete Deployment](https://msdn.microsoft.com/library/azure/ee460815.aspx) e [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span><span class="sxs-lookup"><span data-stu-id="6a512-279">The mutating operations are as follows: [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx), [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx), [Update Deployment Status](https://msdn.microsoft.com/library/azure/ee460808.aspx), [Delete Deployment](https://msdn.microsoft.com/library/azure/ee460815.aspx), and [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span></span>

<span data-ttu-id="6a512-280">Due operazioni, [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) e [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx), restituiscono il flag Locked che può essere esaminato per determinare se un'operazione di mutazione può essere richiamata in una determinata distribuzione.</span><span class="sxs-lookup"><span data-stu-id="6a512-280">Two operations, [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx), return the Locked flag which can be examined to determine whether a mutating operation can be invoked on a given deployment.</span></span>

<span data-ttu-id="6a512-281">Per chiamare la versione di questi metodi che restituisce il flag Locked, è necessario impostare l'intestazione della richiesta su "x-ms-version: 2011-10-01" o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="6a512-281">In order to call the version of these methods which returns the Locked flag, you must set request header to “x-ms-version: 2011-10-01” or a later.</span></span> <span data-ttu-id="6a512-282">Per altre informazioni sul controllo delle versioni delle intestazioni, vedere [Controllo delle versioni di gestione del servizio](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span><span class="sxs-lookup"><span data-stu-id="6a512-282">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<a name="distributiondfroles"></a>

## <a name="distribution-of-roles-across-upgrade-domains"></a><span data-ttu-id="6a512-283">Distribuzione di ruoli nei domini di aggiornamento</span><span class="sxs-lookup"><span data-stu-id="6a512-283">Distribution of roles across upgrade domains</span></span>
<span data-ttu-id="6a512-284">Azure distribuisce in tutti i domini di aggiornamento lo stesso numero di istanze di un ruolo, che è possibile configurare come parte del file di definizione del servizio (.csdef).</span><span class="sxs-lookup"><span data-stu-id="6a512-284">Azure distributes instances of a role evenly across a set number of upgrade domains, which can be configured as part of the service definition (.csdef) file.</span></span> <span data-ttu-id="6a512-285">Il numero massimo di domini di aggiornamento è 20 e quello predefinito è 5.</span><span class="sxs-lookup"><span data-stu-id="6a512-285">The max number of upgrade domains is 20 and the default is 5.</span></span> <span data-ttu-id="6a512-286">Per altre informazioni su come modificare il file csdef, vedere [Schema di definizione del servizio di Azure (file .csdef)](cloud-services-model-and-package.md#csdef).</span><span class="sxs-lookup"><span data-stu-id="6a512-286">For more information about how to modify the service definition file, see [Azure Service Definition Schema (.csdef File)](cloud-services-model-and-package.md#csdef).</span></span>

<span data-ttu-id="6a512-287">Se, ad esempio, il ruolo ha dieci istanze, per impostazione predefinita, ogni dominio di aggiornamento contiene due istanze.</span><span class="sxs-lookup"><span data-stu-id="6a512-287">For example, if your role has ten instances, by default each upgrade domain contains two instances.</span></span> <span data-ttu-id="6a512-288">Se il ruolo ha 14 istanze, quattro domini di aggiornamento contengono tre istanze e un quinto dominio ne contiene due.</span><span class="sxs-lookup"><span data-stu-id="6a512-288">If your role has 14 instances, then four of the upgrade domains contain three instances, and a fifth domain contains two.</span></span>

<span data-ttu-id="6a512-289">I domini di aggiornamento vengono identificati con un indice in base zero: il primo dominio di aggiornamento ha ID 0, il secondo dominio di aggiornamento ha ID 1 e così via.</span><span class="sxs-lookup"><span data-stu-id="6a512-289">Upgrade domains are identified with a zero-based index: the first upgrade domain has an ID of 0, and the second upgrade domain has an ID of 1, and so on.</span></span>

<span data-ttu-id="6a512-290">Il diagramma seguente illustra come vengono distribuiti due ruoli contenuti in un servizio quando il servizio definisce due domini di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="6a512-290">The following diagram illustrates how a service than contains two roles are distributed when the service defines two upgrade domains.</span></span> <span data-ttu-id="6a512-291">Il servizio esegue otto istanze del ruolo Web e nove istanze del ruolo di lavoro.</span><span class="sxs-lookup"><span data-stu-id="6a512-291">The service is running eight instances of the web role and nine instances of the worker role.</span></span>

<span data-ttu-id="6a512-292">![Distribuzione di domini di aggiornamento](media/cloud-services-update-azure-service/IC345533.png "Distribuzione di domini di aggiornamento")</span><span class="sxs-lookup"><span data-stu-id="6a512-292">![Distribution of Upgrade Domains](media/cloud-services-update-azure-service/IC345533.png "Distribution of Upgrade Domains")</span></span>

> [!NOTE]
> <span data-ttu-id="6a512-293">Si noti che Azure controlla come le istanze vengono allocate nei domini di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="6a512-293">Note that Azure controls how instances are allocated across upgrade domains.</span></span> <span data-ttu-id="6a512-294">Non è possibile specificare quali istanze vengono allocate in ogni dominio.</span><span class="sxs-lookup"><span data-stu-id="6a512-294">It's not possible to specify which instances are allocated to which domain.</span></span>
>
>

## <a name="next-steps"></a><span data-ttu-id="6a512-295">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="6a512-295">Next steps</span></span>
[<span data-ttu-id="6a512-296">Come gestire i servizi cloud</span><span class="sxs-lookup"><span data-stu-id="6a512-296">How to Manage Cloud Services</span></span>](cloud-services-how-to-manage.md)  
[<span data-ttu-id="6a512-297">Come monitorare i servizi cloud</span><span class="sxs-lookup"><span data-stu-id="6a512-297">How to Monitor Cloud Services</span></span>](cloud-services-how-to-monitor.md)  
[<span data-ttu-id="6a512-298">Come configurare i servizi cloud</span><span class="sxs-lookup"><span data-stu-id="6a512-298">How to Configure Cloud Services</span></span>](cloud-services-how-to-configure.md)  
