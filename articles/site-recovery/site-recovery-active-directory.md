---
title: aaaProtect Active Directory e DNS con Azure Site Recovery | Documenti Microsoft
description: Questo articolo viene descritto come tooimplement una soluzione di ripristino di emergenza per Active Directory mediante Azure Site Recovery.
services: site-recovery
documentationcenter: 
author: prateek9us
manager: gauravd
editor: 
ms.assetid: af1d9b26-1956-46ef-bd05-c545980b72dc
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 7/20/2017
ms.author: pratshar
ms.openlocfilehash: 49903e54f6d6e1839b0571b7a852c6d7517f0aa1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="protect-active-directory-and-dns-with-azure-site-recovery"></a><span data-ttu-id="b0ac4-103">Proteggere Active Directory e DNS con Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="b0ac4-103">Protect Active Directory and DNS with Azure Site Recovery</span></span>
<span data-ttu-id="b0ac4-104">Applicazioni aziendali, ad esempio SharePoint, Dynamics AX e SAP dipendono da Active Directory e un toofunction infrastruttura DNS, in modo corretto.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-104">Enterprise applications such as SharePoint, Dynamics AX, and SAP depend on Active Directory and a DNS infrastructure toofunction correctly.</span></span> <span data-ttu-id="b0ac4-105">Quando si crea una soluzione di ripristino di emergenza per le applicazioni, è importante tooremember che è necessario tooprotect e il ripristino di Active Directory e DNS prima di hello altri componenti dell'applicazione, tooensure che aspetti funzionano correttamente quando si verifica un'emergenza.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-105">When you create a disaster recovery solution for applications, it's important tooremember that you need tooprotect and recover Active Directory and DNS before hello other application components, tooensure that things function correctly when disaster occurs.</span></span>

<span data-ttu-id="b0ac4-106">Site Recovery è un servizio di Azure che fornisce il ripristino di emergenza orchestrando la replica, il failover e il ripristino delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-106">Site Recovery is an Azure service that provides disaster recovery by orchestrating replication, failover, and recovery of virtual machines.</span></span> <span data-ttu-id="b0ac4-107">Il ripristino del sito supporta numerosi scenari di replica tooconsistently proteggere e facilmente il failover le macchine virtuali e applicazioni tooprivate, public o hoster cloud.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-107">Site Recovery supports a number of replication scenarios tooconsistently protect, and seamlessly failover virtual machines and applications tooprivate, public, or hoster clouds.</span></span>

<span data-ttu-id="b0ac4-108">Con Site Recovery è possibile creare un piano di ripristino di emergenza interamente automatizzato per Active Directory.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-108">Using Site Recovery, you can create a complete automated disaster recovery plan for Active Directory.</span></span> <span data-ttu-id="b0ac4-109">In caso di interruzione, è possibile avviare un failover in pochi secondi da qualsiasi luogo e fare in modo che Active Directory sia operativo in pochi minuti.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-109">When disruptions occur, you can initiate a failover within seconds from anywhere and get Active Directory up and running in a few minutes.</span></span> <span data-ttu-id="b0ac4-110">Se distribuiti Active Directory per più applicazioni, ad esempio SharePoint e SAP nel sito primario e si desidera toofail sulla sito completo hello, è possibile eseguire un failover di Active Directory prima di utilizzare il ripristino del sito e quindi eseguire il failover hello altre applicazioni utilizzo di piani di ripristino specifico dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-110">If you've deployed Active Directory for multiple applications such as SharePoint and SAP in your primary site, and you want toofail over hello complete site, you can fail over Active Directory first using Site Recovery, and then fail over hello other applications using application-specific recovery plans.</span></span>

<span data-ttu-id="b0ac4-111">Questo articolo spiega come hello toocreate una soluzione di ripristino di emergenza per Active Directory, come tooperform pianificato, non pianificato e i test failover usando un piano di ripristino di un solo clic, prerequisiti e le configurazioni supportate.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-111">This article explains how toocreate a disaster recovery solution for Active Directory, how tooperform planned, unplanned, and test failovers using a one-click recovery plan, hello supported configurations, and prerequisites.</span></span>  <span data-ttu-id="b0ac4-112">È necessario conoscere Active Directory e Azure Site Recovery prima di iniziare.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-112">You should be familiar with Active Directory and Azure Site Recovery before you start.</span></span>

## <a name="replicating-domain-controller"></a><span data-ttu-id="b0ac4-113">Replica del controller di dominio</span><span class="sxs-lookup"><span data-stu-id="b0ac4-113">Replicating Domain Controller</span></span>

<span data-ttu-id="b0ac4-114">È necessario toosetup [la replica di Site Recovery](#enable-protection-using-site-recovery) su almeno una macchina virtuale che ospita il Controller di dominio e DNS.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-114">You need toosetup [Site Recovery replication](#enable-protection-using-site-recovery) on at least one virtual machine hosting Domain Controller and DNS.</span></span> <span data-ttu-id="b0ac4-115">Se dispone di [più controller di dominio](#environment-with-multiple-domain-controllers) nell'ambiente in uso, inoltre tooreplicating hello macchina virtuale controller di dominio con il ripristino del sito, è necessario tooset backup un [controllerdidominioaggiuntivo](#protect-active-directory-with-active-directory-replication) nel sito di destinazione hello (Azure o un Data Center secondario locale).</span><span class="sxs-lookup"><span data-stu-id="b0ac4-115">If you have [multiple domain controllers](#environment-with-multiple-domain-controllers) in your environment, in addition tooreplicating hello domain controller virtual machine with Site Recovery you would also have tooset up an [additional domain controller](#protect-active-directory-with-active-directory-replication) on hello target site (Azure or a secondary on-premises datacenter).</span></span> 

### <a name="single-domain-controller-environment"></a><span data-ttu-id="b0ac4-116">Ambiente con singolo controller di dominio</span><span class="sxs-lookup"><span data-stu-id="b0ac4-116">Single domain controller environment</span></span>
<span data-ttu-id="b0ac4-117">Se si dispone di alcune applicazioni e solo un singolo controller di dominio e si desidera toofail sull'intero sito hello insieme, quindi si consiglia di utilizzare controller di dominio di Site Recovery tooreplicate hello toohello di sito secondario (se sta failover tooAzure o tooa del sito secondario).</span><span class="sxs-lookup"><span data-stu-id="b0ac4-117">If you have a few applications and only a single domain controller, and you want toofail over hello entire site together, then we recommend using Site Recovery tooreplicate hello domain controller toohello secondary site (whether you're failing over tooAzure or tooa secondary site).</span></span> <span data-ttu-id="b0ac4-118">Hello stesso replicati utilizzabile per macchina virtuale DNS o controller di dominio [failover di test](#test-failover-considerations) anche.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-118">hello same replicated domain controller/DNS virtual machine can be used for [test failover](#test-failover-considerations) as well.</span></span>

### <a name="environment-with-multiple-domain-controllers"></a><span data-ttu-id="b0ac4-119">Ambiente con più controller di dominio</span><span class="sxs-lookup"><span data-stu-id="b0ac4-119">Environment with multiple domain controllers</span></span>
<span data-ttu-id="b0ac4-120">Se si dispone di molte applicazioni e in più di un controller di dominio nell'ambiente di hello, o se si intende toofail in alcune applicazioni alla volta, è consigliabile che anche controller di dominio hello tooreplicating virtuale del computer con il ripristino del sito è anche impostare un [controller di dominio aggiuntivo](#protect-active-directory-with-active-directory-replication) nel sito di destinazione hello (Azure o un Data Center secondario locale).</span><span class="sxs-lookup"><span data-stu-id="b0ac4-120">If you have many applications and there's more than one domain controller in hello environment, or if you plan toofail over a few applications at a time, we recommend that in addition tooreplicating hello domain controller virtual machine with Site Recovery you also set up an [additional domain controller](#protect-active-directory-with-active-directory-replication) on hello target site (Azure or a secondary on-premises datacenter).</span></span> <span data-ttu-id="b0ac4-121">Per [failover di test](#test-failover-considerations), utilizzare il controller di dominio replicato da un ripristino del sito e per il failover, il controller di dominio aggiuntivo hello nel sito di destinazione hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-121">For [test failover](#test-failover-considerations), you use domain controller replicated by Site Recovery and for failover, hello additional domain controller on hello target site.</span></span> 


<span data-ttu-id="b0ac4-122">Hello nelle sezioni seguenti viene illustrato come protezione tooenable per un controller di dominio in Site Recovery e come tooset un controller di dominio in Azure.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-122">hello following sections explain how tooenable protection for a domain controller in Site Recovery, and how tooset up a domain controller in Azure.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="b0ac4-123">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="b0ac4-123">Prerequisites</span></span>
* <span data-ttu-id="b0ac4-124">Una distribuzione locale del server DNS e di Active Directory.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-124">An on-premises deployment of Active Directory and DNS server.</span></span>
* <span data-ttu-id="b0ac4-125">Un insieme di credenziali dei servizi Azure Site Recovery in una sottoscrizione di Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-125">An Azure Site Recovery Services vault in a Microsoft Azure subscription.</span></span>
* <span data-ttu-id="b0ac4-126">Se si esegue la replica tooAzure, eseguire lo strumento di valutazione della macchina virtuale Azure hello in macchine virtuali tooensure ma sono compatibili con macchine virtuali di Azure e servizi di Azure Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-126">If you're replicating tooAzure, run hello Azure Virtual Machine Readiness Assessment tool on VMs tooensure they're compatible with Azure VMs and Azure Site Recovery Services.</span></span>

## <a name="enable-protection-using-site-recovery"></a><span data-ttu-id="b0ac4-127">Abilitare la protezione usando Site Recovery</span><span class="sxs-lookup"><span data-stu-id="b0ac4-127">Enable protection using Site Recovery</span></span>
### <a name="protect-hello-virtual-machine"></a><span data-ttu-id="b0ac4-128">Proteggere una macchina virtuale hello</span><span class="sxs-lookup"><span data-stu-id="b0ac4-128">Protect hello virtual machine</span></span>
<span data-ttu-id="b0ac4-129">Abilitare la protezione della macchina virtuale DNS o controller di dominio hello in Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-129">Enable protection of hello domain controller/DNS virtual machine in Site Recovery.</span></span> <span data-ttu-id="b0ac4-130">Configurare le impostazioni di ripristino del sito in base al tipo di macchina virtuale hello (Hyper-V o VMware).</span><span class="sxs-lookup"><span data-stu-id="b0ac4-130">Configure Site Recovery settings based on hello virtual machine type (Hyper-V or VMware).</span></span> <span data-ttu-id="b0ac4-131">controller di dominio Hello replicate tramite il ripristino del sito viene utilizzato per [failover di test](#test-failover-considerations).</span><span class="sxs-lookup"><span data-stu-id="b0ac4-131">hello domain controller replicated using Site Recovery is used for [test failover](#test-failover-considerations).</span></span> <span data-ttu-id="b0ac4-132">Assicurarsi che vengano soddisfatti i seguenti requisiti hello:</span><span class="sxs-lookup"><span data-stu-id="b0ac4-132">Make sure it meets hello following requirements:</span></span>

1. <span data-ttu-id="b0ac4-133">controller di dominio Hello è un server di catalogo globale</span><span class="sxs-lookup"><span data-stu-id="b0ac4-133">hello domain controller is a global catalog server</span></span>
2. <span data-ttu-id="b0ac4-134">controller di dominio Hello deve essere proprietario del ruolo FSMO hello per i ruoli che saranno necessari durante un failover di test (in caso contrario, questi ruoli dovrà toobe [requisito](http://aka.ms/ad_seize_fsmo) dopo il failover hello)</span><span class="sxs-lookup"><span data-stu-id="b0ac4-134">hello domain controller should be hello FSMO role owner for roles that will be needed during a test failover (else these roles will need toobe [seized](http://aka.ms/ad_seize_fsmo) after hello failover)</span></span>

### <a name="configure-virtual-machine-network-settings"></a><span data-ttu-id="b0ac4-135">Configurare le impostazioni di rete della macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="b0ac4-135">Configure virtual machine network settings</span></span>
<span data-ttu-id="b0ac4-136">Per la macchina virtuale controller/DNS del dominio hello, configurare le impostazioni di rete in Site Recovery in modo che macchina virtuale hello toohello associata la rete dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-136">For hello domain controller/DNS virtual machine, configure network settings in Site Recovery so that hello virtual machine will be attached toohello right network after failover.</span></span> 

![Impostazioni di rete della VM](./media/site-recovery-active-directory/DNS-Target-IP.png)

## <a name="protect-active-directory-with-active-directory-replication"></a><span data-ttu-id="b0ac4-138">Proteggere Active Directory con la replica di Active Directory</span><span class="sxs-lookup"><span data-stu-id="b0ac4-138">Protect Active Directory with Active Directory replication</span></span>
### <a name="site-to-site-protection"></a><span data-ttu-id="b0ac4-139">Protezione da sito a sito</span><span class="sxs-lookup"><span data-stu-id="b0ac4-139">Site-to-site protection</span></span>
<span data-ttu-id="b0ac4-140">Creare un controller di dominio nel sito secondario hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-140">Create a domain controller on hello secondary site.</span></span> <span data-ttu-id="b0ac4-141">Quando si innalza di livello ruolo controller di dominio di hello server tooa, specificare il nome di hello di hello nello stesso dominio in uso nel sito primario di hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-141">When you promote hello server tooa domain controller role, specify hello name of hello same domain that is being used on hello primary site.</span></span> <span data-ttu-id="b0ac4-142">È possibile utilizzare hello **Active Directory, siti e servizi** snap-dell'oggetto impostazioni tooconfigure nel collegamento di sito hello toowhich hello siti vengono aggiunti.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-142">You can use hello **Active Directory Sites and Services** snap-in tooconfigure settings on hello site link object toowhich hello sites are added.</span></span> <span data-ttu-id="b0ac4-143">Configurando le impostazioni in un collegamento di sito, è possibile controllare quando viene eseguita la replica tra due o più siti e con quale frequenza.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-143">By configuring settings on a site link, you can control when replication occurs between two or more sites, and how often.</span></span> <span data-ttu-id="b0ac4-144">Per altre informazioni, vedere [Pianificazione della replica tra siti](https://technet.microsoft.com/library/cc731862.aspx) .</span><span class="sxs-lookup"><span data-stu-id="b0ac4-144">For more information, see [Scheduling Replication Between Sites](https://technet.microsoft.com/library/cc731862.aspx).</span></span>

### <a name="site-to-azure-protection"></a><span data-ttu-id="b0ac4-145">Protezione da sito ad Azure</span><span class="sxs-lookup"><span data-stu-id="b0ac4-145">Site-to-Azure protection</span></span>
<span data-ttu-id="b0ac4-146">Seguire le istruzioni di hello troppo[creare un controller di dominio in una rete virtuale di Azure](../active-directory/active-directory-install-replica-active-directory-domain-controller.md).</span><span class="sxs-lookup"><span data-stu-id="b0ac4-146">Follow hello instructions too[create a domain controller in an Azure virtual network](../active-directory/active-directory-install-replica-active-directory-domain-controller.md).</span></span> <span data-ttu-id="b0ac4-147">Quando si innalza di livello ruolo controller di dominio di hello server tooa, specificare hello stesso nome di dominio utilizzato nel sito primario di hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-147">When you promote hello server tooa domain controller role, specify hello same domain name that's used on hello primary site.</span></span>

<span data-ttu-id="b0ac4-148">Quindi [riconfigurare hello DNS server per la rete virtuale hello](../active-directory/active-directory-install-replica-active-directory-domain-controller.md#reconfigure-dns-server-for-the-virtual-network), server DNS di hello toouse in Azure.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-148">Then [reconfigure hello DNS server for hello virtual network](../active-directory/active-directory-install-replica-active-directory-domain-controller.md#reconfigure-dns-server-for-the-virtual-network), toouse hello DNS server in Azure.</span></span>

![Azure Network](./media/site-recovery-active-directory/azure-network.png)

<span data-ttu-id="b0ac4-150">**DNS nella rete di produzione di Azure**</span><span class="sxs-lookup"><span data-stu-id="b0ac4-150">**DNS in Azure Production Network**</span></span>

## <a name="test-failover-considerations"></a><span data-ttu-id="b0ac4-151">considerazioni sul failover di test</span><span class="sxs-lookup"><span data-stu-id="b0ac4-151">Test failover considerations</span></span>
<span data-ttu-id="b0ac4-152">Il failover di test si verifica in una rete isolata dalla rete di produzione, in modo che non si verifichi alcun impatto sui carichi di lavoro di produzione.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-152">Test failover occurs in a network that's isolated from production network so that there's no impact on production workloads.</span></span>

<span data-ttu-id="b0ac4-153">La maggior parte delle applicazioni richiedono inoltre presenza hello di un controller di dominio e un toofunction server DNS.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-153">Most applications also require hello presence of a domain controller and a DNS server toofunction.</span></span> <span data-ttu-id="b0ac4-154">Pertanto, prima di un'applicazione hello è stata eseguita il failover, un controller di dominio deve toobe creato in toobe rete hello isolato utilizzato per il failover di test.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-154">Therefore, before hello application is failed over, a domain controller needs toobe created in hello isolated network toobe used for test failover.</span></span> <span data-ttu-id="b0ac4-155">Hello toodo modo più semplice si tratta di una macchina virtuale DNS o controller di dominio con il ripristino del sito tooreplicate.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-155">hello easiest way toodo this is tooreplicate a domain controller/DNS virtual machine with Site Recovery.</span></span> <span data-ttu-id="b0ac4-156">Quindi eseguire un failover di test della macchina virtuale controller di dominio hello prima di eseguire un failover di test hello del piano di ripristino per un'applicazione hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-156">Then run a test failover of hello domain controller virtual machine before running a test failover of hello recovery plan for hello application.</span></span> <span data-ttu-id="b0ac4-157">Di seguito viene indicato come procedere:</span><span class="sxs-lookup"><span data-stu-id="b0ac4-157">Here's how you do that:</span></span>

1. <span data-ttu-id="b0ac4-158">[Replicare](site-recovery-replicate-vmware-to-azure.md) hello macchina virtuale DNS o controller di dominio tramite il ripristino del sito.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-158">[Replicate](site-recovery-replicate-vmware-to-azure.md) hello domain controller/DNS virtual machine using Site Recovery.</span></span>
1. <span data-ttu-id="b0ac4-159">Creare una rete isolata.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-159">Create an isolated network.</span></span> <span data-ttu-id="b0ac4-160">Qualsiasi rete virtuale creata in Azure per impostazione predefinita è isolata dalle altre reti.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-160">Any virtual network created in Azure by default is isolated from other networks.</span></span> <span data-ttu-id="b0ac4-161">È consigliabile che l'intervallo di indirizzi IP hello per la rete è corrisponde a quello della rete di produzione.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-161">We recommend that hello IP address range for this network is same as that of your production network.</span></span> <span data-ttu-id="b0ac4-162">Non abilitare la connettività da sito a sito in questa rete.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-162">Don't enable site-to-site connectivity on this network.</span></span>
1. <span data-ttu-id="b0ac4-163">Specificare un indirizzo IP DNS nella rete hello creato, come indirizzo IP hello che si prevede di tooget di macchina virtuale DNS hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-163">Provide a DNS IP address in hello network created, as hello IP address that you expect hello DNS virtual machine tooget.</span></span> <span data-ttu-id="b0ac4-164">Se si esegue la replica tooAzure, quindi fornire l'indirizzo IP hello per macchina virtuale che viene utilizzato in caso di failover in hello **indirizzo IP di destinazione** impostazione in **di calcolo e rete** impostazioni.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-164">If you're replicating tooAzure, then provide hello IP address for hello VM that is used on failover in **Target IP** setting in **Compute and Network** settings.</span></span> 

    <span data-ttu-id="b0ac4-165">![IP di destinazione](./media/site-recovery-active-directory/DNS-Target-IP.png)**IP di destinazione**</span><span class="sxs-lookup"><span data-stu-id="b0ac4-165">![Target IP](./media/site-recovery-active-directory/DNS-Target-IP.png) **Target IP**</span></span>

    ![Rete di test di Azure](./media/site-recovery-active-directory/azure-test-network.png)

    <span data-ttu-id="b0ac4-167">**DNS nella rete di test di Azure**</span><span class="sxs-lookup"><span data-stu-id="b0ac4-167">**DNS in Azure Test Network**</span></span>

> [!TIP]
> <span data-ttu-id="b0ac4-168">Il ripristino del sito tenta toocreate macchine virtuali di test in una subnet con stesso nome e con hello stesso IP a quella fornita **di calcolo e rete** impostazioni della macchina virtuale hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-168">Site Recovery attempts toocreate test virtual machines in a subnet of same name and using hello same IP as that provided in **Compute and Network** settings of hello virtual machine.</span></span> <span data-ttu-id="b0ac4-169">Se non è disponibile nella rete virtuale di Azure fornito per il failover di test, hello subnet stesso nome macchina virtuale di test viene creato nella prima subnet hello in ordine alfabetico.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-169">If subnet of same name is not available in hello Azure virtual network provided for test failover, then test virtual machine is created in hello first subnet alphabetically.</span></span> <span data-ttu-id="b0ac4-170">Se hello IP di destinazione fa parte di hello scelto subnet, il ripristino del sito tenta di macchina virtuale toocreate hello test failover utilizzando l'indirizzo IP di destinazione hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-170">If hello target IP is part of hello chosen subnet, then Site Recovery tries toocreate hello test failover virtual machine using hello target IP.</span></span> <span data-ttu-id="b0ac4-171">Se l'indirizzo IP di destinazione hello non fa parte di hello scelto subnet, macchina virtuale di test failover viene creata utilizzando qualsiasi IP disponibile in hello scelto subnet.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-171">If hello target IP is not part of hello chosen subnet, then test failover virtual machine gets created using any available IP in hello chosen subnet.</span></span> 
>
>


1. <span data-ttu-id="b0ac4-172">Se si esegue la replica da sito locale tooanother e si usa DHCP, seguire le istruzioni di hello troppo[configurare DNS e DHCP per il failover di test](site-recovery-test-failover-vmm-to-vmm.md#prepare-dhcp)</span><span class="sxs-lookup"><span data-stu-id="b0ac4-172">If you're replicating tooanother on-premises site and you're using DHCP, follow hello instructions too[setup DNS and DHCP for test failover](site-recovery-test-failover-vmm-to-vmm.md#prepare-dhcp)</span></span>
1. <span data-ttu-id="b0ac4-173">Eseguire un failover di test della macchina virtuale controller dominio hello eseguito in una rete isolata hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-173">Do a test failover of hello domain controller virtual machine run in hello isolated network.</span></span> <span data-ttu-id="b0ac4-174">Utilizzare più recente disponibile **coerenti con l'applicazione** punto di ripristino di hello macchina virtuale di controller di dominio toodo failover di test di hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-174">Use latest available **application consistent** recovery point of hello domain controller virtual machine toodo hello test failover.</span></span> 
1. <span data-ttu-id="b0ac4-175">Eseguire un failover di test per il piano di ripristino hello contenente macchine virtuali di un'applicazione hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-175">Run a test failover for hello recovery plan that contains virtual machines of hello application.</span></span> 
1. <span data-ttu-id="b0ac4-176">Al termine il test, **il failover di test di pulizia** nella macchina virtuale controller di dominio hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-176">After testing is complete, **Cleanup test failover** on hello domain controller virtual machine.</span></span> <span data-ttu-id="b0ac4-177">Questo passaggio consente di eliminare i controller di dominio hello che è stato creato per il failover di test.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-177">This step deletes hello domain controller that was created for test failover.</span></span>


### <a name="removing-reference-tooother-domain-controllers"></a><span data-ttu-id="b0ac4-178">Rimozione dei controller di dominio di riferimento tooother</span><span class="sxs-lookup"><span data-stu-id="b0ac4-178">Removing reference tooother domain controllers</span></span>
<span data-ttu-id="b0ac4-179">Quando si esegue un failover di test, non connettere tutti i controller di dominio hello in rete di test hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-179">When you are doing a test failover, you don't bring all hello domain controllers in hello test network.</span></span> <span data-ttu-id="b0ac4-180">riferimento di hello tooremove altri controller di dominio presenti nell'ambiente di produzione, potrebbe essere troppo[requisire i ruoli FSMO Active Directory](http://aka.ms/ad_seize_fsmo) e [pulizia dei metadati](https://technet.microsoft.com/library/cc816907.aspx) per dominio mancante controller.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-180">tooremove hello reference of other domain controllers that exist in your production environment, you might need too[seize FSMO Active Directory roles](http://aka.ms/ad_seize_fsmo) and do [metadata cleanup](https://technet.microsoft.com/library/cc816907.aspx) for missing domain controllers.</span></span> 



> [!IMPORTANT]
> <span data-ttu-id="b0ac4-181">Alcune delle configurazioni di hello descritte nella seguente sezione hello non sono le configurazioni del controller dominio hello standard o predefinito.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-181">Some of hello configurations described in hello following section are not hello standard/default domain controller configurations.</span></span> <span data-ttu-id="b0ac4-182">Se non si desidera toomake che questi controller di dominio di produzione tooa modifiche, è possibile creare un toobe dedicato di controller di dominio utilizzato per il ripristino del sito di failover di test e rendere toothat queste modifiche.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-182">If you don't want toomake these changes tooa production domain controller, then you can create a domain controller dedicated toobe used for Site Recovery test failover and make these changes toothat.</span></span>  
>
>

### <a name="issues-because-of-virtualization-safeguards"></a><span data-ttu-id="b0ac4-183">Problemi dovuti alle misure di sicurezza della virtualizzazione</span><span class="sxs-lookup"><span data-stu-id="b0ac4-183">Issues because of virtualization safeguards</span></span> 

<span data-ttu-id="b0ac4-184">A partire da Windows Server 2012, [sono state integrate misure di sicurezza aggiuntive in Active Directory Domain Services](https://technet.microsoft.com/windows-server-docs/identity/ad-ds/introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100).</span><span class="sxs-lookup"><span data-stu-id="b0ac4-184">Beginning with Windows Server 2012, [additional safeguards have been built into Active Directory Domain Services](https://technet.microsoft.com/windows-server-docs/identity/ad-ds/introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100).</span></span> <span data-ttu-id="b0ac4-185">Queste misure di sicurezza aiutano a proteggere i controller di dominio virtualizzati rollback degli USN, purché piattaforma hypervisor sottostante hello supporta VM-GenerationID.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-185">These safeguards help protect virtualized domain controllers against USN Rollbacks, as long as hello underlying hypervisor platform supports VM-GenerationID.</span></span> <span data-ttu-id="b0ac4-186">Azure supporta VM-GenerationID, ciò significa che i controller di dominio che eseguono Windows Server 2012 o macchine virtuali di Azure in un secondo momento misure di sicurezza aggiuntive di hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-186">Azure supports VM-GenerationID, which means that domain controllers that run Windows Server 2012 or later on Azure virtual machines have hello additional safeguards.</span></span> 


<span data-ttu-id="b0ac4-187">Quando hello VM-GenerationID viene reimpostato, viene inoltre reimpostato hello invocationID del database di hello AD DS, hello pool di RID viene ignorato e SYSVOL è contrassegnato come non autorevole.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-187">When hello VM-GenerationID is reset, hello invocationID of hello AD DS database is also reset, hello RID pool is discarded, and SYSVOL is marked as non-authoritative.</span></span> <span data-ttu-id="b0ac4-188">Per ulteriori informazioni, vedere [tooActive introduzione virtualizzazione di servizi di Directory dominio](https://technet.microsoft.com/windows-server-docs/identity/ad-ds/introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100) e [virtualizzazione sicura di DFSR](https://blogs.technet.microsoft.com/filecab/2013/04/05/safely-virtualizing-dfsr/)</span><span class="sxs-lookup"><span data-stu-id="b0ac4-188">For more information, see [Introduction tooActive Directory Domain Services Virtualization](https://technet.microsoft.com/windows-server-docs/identity/ad-ds/introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100) and [Safely Virtualizing DFSR](https://blogs.technet.microsoft.com/filecab/2013/04/05/safely-virtualizing-dfsr/)</span></span>

<span data-ttu-id="b0ac4-189">Failover tooAzure può causare la reimpostazione dell'ID di generazione VM e che interviene misure di sicurezza aggiuntive di hello all'avvio di macchina virtuale controller di dominio hello in Azure.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-189">Failing over tooAzure may cause resetting of VM-GenerationID and that kicks in hello additional safeguards when hello domain controller virtual machine starts in Azure.</span></span> <span data-ttu-id="b0ac4-190">Questo può comportare un **un ritardo significativo** nella macchina virtuale del controller in grado di toologin toohello dominio utente.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-190">This may result in a **significant delay** in user being able toologin toohello domain controller virtual machine.</span></span> <span data-ttu-id="b0ac4-191">Poiché questo controller di dominio viene usato solo in un failover di test, non sono necessari misure di sicurezza della virtualizzazione.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-191">Since this domain controller would be used only in a test failover, virtualization safeguards are not necessary.</span></span> <span data-ttu-id="b0ac4-192">tooensure che non cambia l'ID di generazione VM per la macchina virtuale controller di dominio hello, è possibile modificare il valore di hello di too4 DWORD seguente nel controller di dominio locale hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-192">tooensure that VM-GenerationID for hello domain controller virtual machine doesn't change, then you can change hello value of following DWORD too4 in hello on-premises domain controller.</span></span>

        
        HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\gencounter\Start
 

#### <a name="symptoms-of-virtualization-safeguards"></a><span data-ttu-id="b0ac4-193">Sintomi delle misure di sicurezza della virtualizzazione</span><span class="sxs-lookup"><span data-stu-id="b0ac4-193">Symptoms of virtualization safeguards</span></span>
 
<span data-ttu-id="b0ac4-194">Se le misure di sicurezza della virtualizzazione sono intervenute dopo un failover di test, è possibile che si verifichi uno o più dei seguenti sintomi:</span><span class="sxs-lookup"><span data-stu-id="b0ac4-194">If virtualization safeguards have kicked in after a test failover, you may see one or more of following symptoms:</span></span>  

<span data-ttu-id="b0ac4-195">Modifica dell'ID di generazione</span><span class="sxs-lookup"><span data-stu-id="b0ac4-195">Generation ID change</span></span>

![Modifica dell'ID di generazione](./media/site-recovery-active-directory/Event2170.png)

<span data-ttu-id="b0ac4-197">Modifica dell'ID di chiamata</span><span class="sxs-lookup"><span data-stu-id="b0ac4-197">Invocation ID change</span></span>

![Modifica dell'ID di chiamata](./media/site-recovery-active-directory/Event1109.png)

<span data-ttu-id="b0ac4-199">Condivisioni SYSVOL e Netlogon non disponibili</span><span class="sxs-lookup"><span data-stu-id="b0ac4-199">Sysvol and Netlogon shares are not available</span></span>

![Condivisione SYSVOL](./media/site-recovery-active-directory/sysvolshare.png)

![NTFRS Sysvol](./media/site-recovery-active-directory/Event13565.png)

<span data-ttu-id="b0ac4-202">Vengono eliminati tutti i database DFSR</span><span class="sxs-lookup"><span data-stu-id="b0ac4-202">Any DFSR databases are deleted</span></span>

![Eliminazione del database DFSR](./media/site-recovery-active-directory/Event2208.png)


> [!IMPORTANT]
> <span data-ttu-id="b0ac4-204">Alcune delle configurazioni di hello descritte nella seguente sezione hello non sono le configurazioni del controller dominio hello standard o predefinito.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-204">Some of hello configurations described in hello following section are not hello standard/default domain controller configurations.</span></span> <span data-ttu-id="b0ac4-205">Se non si desidera toomake che questi controller di dominio di produzione tooa modifiche, è possibile creare un toobe dedicato di controller di dominio utilizzato per il ripristino del sito di failover di test e rendere toothat queste modifiche.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-205">If you don't want toomake these changes tooa production domain controller, then you can create a domain controller dedicated toobe used for Site Recovery test failover and make these changes toothat.</span></span>  
>
>


### <a name="troubleshooting-domain-controller-issues-during-test-failover"></a><span data-ttu-id="b0ac4-206">Risolvere i problemi del controller di dominio durante il failover di test</span><span class="sxs-lookup"><span data-stu-id="b0ac4-206">Troubleshooting domain controller issues during test failover</span></span>


<span data-ttu-id="b0ac4-207">In un prompt dei comandi, eseguire hello successivo comando toocheck se NETLOGON e SYSVOL condivise:</span><span class="sxs-lookup"><span data-stu-id="b0ac4-207">On a command prompt, run hello following command toocheck whether SYSVOL and NETLOGON folders are shared:</span></span>

    NET SHARE

<span data-ttu-id="b0ac4-208">Nel prompt dei comandi di hello, eseguire hello comando funzionante tooensure che hello controller di dominio seguente.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-208">On hello command prompt, run hello following command tooensure that hello domain controller is functioning properly.</span></span>

    dcdiag /v > dcdiag.txt

<span data-ttu-id="b0ac4-209">Nel log di output di hello, cercare tooconfirm testo seguente che hello controller di dominio funziona correttamente.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-209">In hello output log, look for following text tooconfirm that hello domain controller is functioning well.</span></span> 

* <span data-ttu-id="b0ac4-210">"passed test Connectivity"</span><span class="sxs-lookup"><span data-stu-id="b0ac4-210">"passed test Connectivity"</span></span>
* <span data-ttu-id="b0ac4-211">"passed test Advertising"</span><span class="sxs-lookup"><span data-stu-id="b0ac4-211">"passed test Advertising"</span></span>
* <span data-ttu-id="b0ac4-212">"passed test MachineAccount"</span><span class="sxs-lookup"><span data-stu-id="b0ac4-212">"passed test MachineAccount"</span></span>

<span data-ttu-id="b0ac4-213">Se hello precedente condizioni vengono soddisfatte, è probabile che il controller di dominio hello funziona correttamente.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-213">If hello preceding conditions are satisfied, it is likely that hello domain controller is functioning well.</span></span> <span data-ttu-id="b0ac4-214">In caso contrario, attenersi alla procedura seguente.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-214">If not, try following steps.</span></span>


* <span data-ttu-id="b0ac4-215">Eseguire un ripristino autorevole hello del controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-215">Do an authoritative restore of hello domain controller.</span></span>
    * <span data-ttu-id="b0ac4-216">Sebbene sia [non è consigliabile replica FRS toouse](https://blogs.technet.microsoft.com/filecab/2014/06/25/the-end-is-nigh-for-frs/), ma se si sta ancora utilizzando hello procedure fornite [qui](https://support.microsoft.com/kb/290762) toodo un ripristino autorevole.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-216">Although it is [not recommended toouse FRS replication](https://blogs.technet.microsoft.com/filecab/2014/06/25/the-end-is-nigh-for-frs/), but if you are still using it then follow hello steps provided [here](https://support.microsoft.com/kb/290762) toodo an authoritative restore.</span></span> <span data-ttu-id="b0ac4-217">È possibile leggere ulteriori informazioni su Burflags parlato nel collegamento precedente hello [qui](https://blogs.technet.microsoft.com/janelewis/2006/09/18/d2-and-d4-what-is-it-for/).</span><span class="sxs-lookup"><span data-stu-id="b0ac4-217">You can read more about Burflags talked about in hello previous link [here](https://blogs.technet.microsoft.com/janelewis/2006/09/18/d2-and-d4-what-is-it-for/).</span></span>
    * <span data-ttu-id="b0ac4-218">Se si utilizza la replica DFS, quindi seguire i passaggi di hello disponibili [qui](https://support.microsoft.com/kb/2218556) toodo un ripristino autorevole.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-218">If you are using DFSR replication, then follow hello steps available [here](https://support.microsoft.com/kb/2218556) toodo an authoritative restore.</span></span> <span data-ttu-id="b0ac4-219">A tale scopo è anche possibile usare le funzioni di Powershell disponibili in questo [collegamento](https://blogs.technet.microsoft.com/thbouche/2013/08/28/dfsr-sysvol-authoritative-non-authoritative-restore-powershell-functions/).</span><span class="sxs-lookup"><span data-stu-id="b0ac4-219">You can also use Powershell functions available on this [link](https://blogs.technet.microsoft.com/thbouche/2013/08/28/dfsr-sysvol-authoritative-non-authoritative-restore-powershell-functions/) for this purpose.</span></span> 
    
* <span data-ttu-id="b0ac4-220">Ignorare il requisito di sincronizzazione iniziale mediante l'impostazione seguente too0 chiave del Registro di sistema nel controller di dominio locale hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-220">Bypass initial synchronization requirement by setting following registry key too0 in hello on-premises domain controller.</span></span> <span data-ttu-id="b0ac4-221">Se questo valore DWORD non esiste, può essere creato nel nodo "Parameters".</span><span class="sxs-lookup"><span data-stu-id="b0ac4-221">If this DWORD doesn't exist, then you can create it under node 'Parameters'.</span></span> <span data-ttu-id="b0ac4-222">Per altre informazioni, vedere [qui](https://support.microsoft.com/kb/2001093).</span><span class="sxs-lookup"><span data-stu-id="b0ac4-222">You can read more about it [here](https://support.microsoft.com/kb/2001093)</span></span>

        HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters\Repl Perform Initial Synchronizations

* <span data-ttu-id="b0ac4-223">Disabilitare il requisito di hello che un server di catalogo globale è disponibile toovalidate dell'accesso utente tramite l'impostazione seguente too1 chiave del Registro di sistema nel controller di dominio locale hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-223">Disable hello requirement that a global catalog server is available toovalidate user logon by setting following registry key too1 in hello on-premises domain controller.</span></span> <span data-ttu-id="b0ac4-224">Se questo valore DWORD non esiste, può essere creato nel nodo "Lsa".</span><span class="sxs-lookup"><span data-stu-id="b0ac4-224">If this DWORD doesn't exist, then you can create it under node 'Lsa'.</span></span> <span data-ttu-id="b0ac4-225">Per altre informazioni, vedere [qui](http://support.microsoft.com/kb/241789).</span><span class="sxs-lookup"><span data-stu-id="b0ac4-225">You can read more about it [here](http://support.microsoft.com/kb/241789)</span></span>

        HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\IgnoreGCFailures



### <a name="dns-and-domain-controller-on-different-machines"></a><span data-ttu-id="b0ac4-226">DNS e controller di dominio su computer diversi</span><span class="sxs-lookup"><span data-stu-id="b0ac4-226">DNS and domain controller on different machines</span></span>
<span data-ttu-id="b0ac4-227">Se DNS non è in hello stessa macchina virtuale come controller di dominio hello, è necessario toocreate una VM DNS per il failover di test hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-227">If DNS isn't on hello same virtual machine as hello domain controller, you need toocreate a DNS VM for hello test failover.</span></span> <span data-ttu-id="b0ac4-228">Se si trova nella stessa macchina virtuale di hello, è possibile ignorare questa sezione.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-228">If they're on hello same VM, you can skip this section.</span></span>

<span data-ttu-id="b0ac4-229">È possibile utilizzare un server DNS nuovo e creare tutte le zone hello necessario.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-229">You can use a fresh DNS server and create all hello required zones.</span></span> <span data-ttu-id="b0ac4-230">Ad esempio, se il dominio di Active Directory è contoso.com, è possibile creare una zona DNS con il nome di hello contoso.com. le voci di Hello corrispondente tooActive Directory devono essere aggiornate nel DNS, come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="b0ac4-230">For example, if your Active Directory domain is contoso.com, you can create a DNS zone with hello name contoso.com. hello entries corresponding tooActive Directory must be updated in DNS, as follows:</span></span>

1. <span data-ttu-id="b0ac4-231">Verificare che queste impostazioni sono presenti prima di altre macchine virtuali nel piano di ripristino hello viene visualizzato:</span><span class="sxs-lookup"><span data-stu-id="b0ac4-231">Ensure these settings are in place before any other virtual machine in hello recovery plan comes up:</span></span>
   
   * <span data-ttu-id="b0ac4-232">zona Hello deve essere denominata dopo il nome radice della foresta hello.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-232">hello zone must be named after hello forest root name.</span></span>
   * <span data-ttu-id="b0ac4-233">zona di Hello deve essere file di backup.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-233">hello zone must be file-backed.</span></span>
   * <span data-ttu-id="b0ac4-234">Hello area deve essere abilitata per gli aggiornamenti di protezione e non sicure.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-234">hello zone must be enabled for secure and non-secure updates.</span></span>
   * <span data-ttu-id="b0ac4-235">resolver Hello della macchina virtuale controller di dominio hello deve puntare toohello di indirizzo IP della macchina virtuale di hello DNS.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-235">hello resolver of hello domain controller virtual machine should point toohello IP address of hello DNS virtual machine.</span></span>
2. <span data-ttu-id="b0ac4-236">Eseguire hello comando seguente nella macchina virtuale controller di dominio:</span><span class="sxs-lookup"><span data-stu-id="b0ac4-236">Run hello following command on domain controller virtual machine:</span></span>
   
    `nltest /dsregdns`
3. <span data-ttu-id="b0ac4-237">Aggiungere una zona nel server DNS hello, consentire aggiornamenti non protetti e aggiungere una voce per tale tooDNS:</span><span class="sxs-lookup"><span data-stu-id="b0ac4-237">Add a zone on hello DNS server, allow non-secure updates, and add an entry for it tooDNS:</span></span>
   
        dnscmd /zoneadd contoso.com  /Primary
        dnscmd /recordadd contoso.com  contoso.com. SOA %computername%.contoso.com. hostmaster. 1 15 10 1 1
        dnscmd /recordadd contoso.com %computername%  A <IP_OF_DNS_VM>
        dnscmd /config contoso.com /allowupdate 1

## <a name="next-steps"></a><span data-ttu-id="b0ac4-238">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="b0ac4-238">Next steps</span></span>
<span data-ttu-id="b0ac4-239">Lettura [i carichi di lavoro è possibile proteggere?](site-recovery-workload.md) toolearn ulteriori informazioni sulla protezione di carichi di lavoro aziendali con Azure Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="b0ac4-239">Read [What workloads can I protect?](site-recovery-workload.md) toolearn more about protecting enterprise workloads with Azure Site Recovery.</span></span>

