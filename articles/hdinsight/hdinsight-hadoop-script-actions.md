---
title: Sviluppo di azioni script con HDInsight - Azure | Documentazione Microsoft
description: "Informazioni su come personalizzare i cluster Hadoop con Azione script. L'azione script può essere usata per installare software aggiuntivi in esecuzione in un cluster Hadoop o per modificare la configurazione delle applicazioni installate in un cluster."
services: hdinsight
documentationcenter: 
tags: azure-portal
author: mumian
manager: jhubbard
editor: cgronlun
ms.assetid: 836d68a8-8b21-4d69-8b61-281a7fe67f21
ms.service: hdinsight
ms.workload: big-data
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/25/2017
ms.author: jgao
ROBOTS: NOINDEX
ms.openlocfilehash: 0e182e6b43fd2d17524c1da36cf4c204bb1b865a
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/03/2017
---
# <a name="develop-script-action-scripts-for-hdinsight-windows-based-clusters"></a><span data-ttu-id="66813-104">Sviluppare script di Azione script per HDInsight nei cluster basati su Windows</span><span class="sxs-lookup"><span data-stu-id="66813-104">Develop Script Action scripts for HDInsight Windows-based clusters</span></span>
<span data-ttu-id="66813-105">Informazioni su come scrivere script di Azione script per HDInsight</span><span class="sxs-lookup"><span data-stu-id="66813-105">Learn how to write Script Action scripts for HDInsight.</span></span> <span data-ttu-id="66813-106">Per informazioni sull'uso di script di Azione script, vedere [Personalizzare cluster HDInsight mediante Azione script](hdinsight-hadoop-customize-cluster.md).</span><span class="sxs-lookup"><span data-stu-id="66813-106">For information on using Script Action scripts, see [Customize HDInsight clusters using Script Action](hdinsight-hadoop-customize-cluster.md).</span></span> <span data-ttu-id="66813-107">Per lo stesso articolo dedicato ai cluster HDInsight basati su Linux, vedere [Sviluppare script di Azione script per HDInsight](hdinsight-hadoop-script-actions-linux.md).</span><span class="sxs-lookup"><span data-stu-id="66813-107">For the same article written for Linux-based HDInsight clusters, see [Develop Script Action scripts for HDInsight](hdinsight-hadoop-script-actions-linux.md).</span></span>



> [!IMPORTANT]
> <span data-ttu-id="66813-108">I passaggi descritti in questo documento funzionano solo con i cluster HDInsight basati su Windows.</span><span class="sxs-lookup"><span data-stu-id="66813-108">The steps in this document only work for Windows-based HDInsight clusters.</span></span> <span data-ttu-id="66813-109">HDInsight è disponibile in Windows solo per le versioni precedenti a HDInsight 3.4.</span><span class="sxs-lookup"><span data-stu-id="66813-109">HDInsight is only available on Windows for versions lower than HDInsight 3.4.</span></span> <span data-ttu-id="66813-110">Linux è l'unico sistema operativo usato in HDInsight versione 3.4 o successiva.</span><span class="sxs-lookup"><span data-stu-id="66813-110">Linux is the only operating system used on HDInsight version 3.4 or greater.</span></span> <span data-ttu-id="66813-111">Per altre informazioni, vedere la sezione relativa al [ritiro di HDInsight in Windows](hdinsight-component-versioning.md#hdinsight-windows-retirement).</span><span class="sxs-lookup"><span data-stu-id="66813-111">For more information, see [HDInsight retirement on Windows](hdinsight-component-versioning.md#hdinsight-windows-retirement).</span></span> <span data-ttu-id="66813-112">Per informazioni sull'uso di azioni script con cluster basati su Linux, vedere [Sviluppo di azioni script con HDInsight (Linux)](hdinsight-hadoop-script-actions-linux.md).</span><span class="sxs-lookup"><span data-stu-id="66813-112">For information on using script actions with Linux-based clusters, see [Script action development with HDInsight (Linux)](hdinsight-hadoop-script-actions-linux.md).</span></span>
>
>



<span data-ttu-id="66813-113">L'azione script può essere usata per installare software aggiuntivi in esecuzione in un cluster Hadoop o per modificare la configurazione delle applicazioni installate in un cluster.</span><span class="sxs-lookup"><span data-stu-id="66813-113">Script Action can be used to install additional software running on a Hadoop cluster or to change the configuration of applications installed on a cluster.</span></span> <span data-ttu-id="66813-114">Le azioni script sono script eseguiti sui nodi del cluster quando si distribuiscono cluster HDInsight. Tali script vengono eseguiti dopo che i nodi del cluster hanno completato la configurazione di HDInsight.</span><span class="sxs-lookup"><span data-stu-id="66813-114">Script actions are scripts that run on the cluster nodes when HDInsight clusters are deployed, and they are executed once nodes in the cluster complete HDInsight configuration.</span></span> <span data-ttu-id="66813-115">Un'azione script viene eseguita con i privilegi dell'account amministratore di sistema e fornisce diritti di accesso completo ai nodi del cluster.</span><span class="sxs-lookup"><span data-stu-id="66813-115">A script action is executed under system admin account privileges and provides full access rights to the cluster nodes.</span></span> <span data-ttu-id="66813-116">È possibile fornire a ciascun cluster un elenco di azioni script da eseguire nell'ordine in cui sono state specificate.</span><span class="sxs-lookup"><span data-stu-id="66813-116">Each cluster can be provided with a list of script actions to be executed in the order in which they are specified.</span></span>

> [!NOTE]
> <span data-ttu-id="66813-117">Se viene visualizzato il messaggio di errore seguente:</span><span class="sxs-lookup"><span data-stu-id="66813-117">If you experience the following error message:</span></span>
>
> <span data-ttu-id="66813-118">System.Management.Automation.CommandNotFoundException; ExceptionMessage: Termine 'Save-HDIFile' non riconosciuto come nome di cmdlet, funzione, programma eseguibile o file script.</span><span class="sxs-lookup"><span data-stu-id="66813-118">System.Management.Automation.CommandNotFoundException; ExceptionMessage : The term 'Save-HDIFile' is not recognized as the name of a cmdlet, function, script file, or operable program.</span></span> <span data-ttu-id="66813-119">Controllare l'ortografia del nome o verificare che il percorso sia incluso e corretto, quindi riprovare.</span><span class="sxs-lookup"><span data-stu-id="66813-119">Check the spelling of the name, or if a path was included, verify that the path is correct and try again.</span></span>
> <span data-ttu-id="66813-120">È perché non sono stati inclusi i metodi di supporto.</span><span class="sxs-lookup"><span data-stu-id="66813-120">It is because you didn't include the helper methods.</span></span>  <span data-ttu-id="66813-121">Vedere [Metodi helper per gli script personalizzati](hdinsight-hadoop-script-actions.md#helper-methods-for-custom-scripts).</span><span class="sxs-lookup"><span data-stu-id="66813-121">See [Helper methods for custom scripts](hdinsight-hadoop-script-actions.md#helper-methods-for-custom-scripts).</span></span>
>
>

## <a name="sample-scripts"></a><span data-ttu-id="66813-122">Script di esempio</span><span class="sxs-lookup"><span data-stu-id="66813-122">Sample scripts</span></span>
<span data-ttu-id="66813-123">Per la creazione di cluster HDInsight nel sistema operativo Windows, l'azione Script è uno script di Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="66813-123">For creating HDInsight clusters on Windows operating system, the Script Action is Azure PowerShell script.</span></span> <span data-ttu-id="66813-124">Lo script seguente è un esempio di configurazione dei file di configurazione sito:</span><span class="sxs-lookup"><span data-stu-id="66813-124">The following script is a sample for configuring the site configuration files:</span></span>

[!INCLUDE [upgrade-powershell](../../includes/hdinsight-use-latest-powershell.md)]

    param (
        [parameter(Mandatory)][string] $ConfigFileName,
        [parameter(Mandatory)][string] $Name,
        [parameter(Mandatory)][string] $Value,
        [parameter()][string] $Description
    )

    if (!$Description) {
        $Description = ""
    }

    $hdiConfigFiles = @{
        "hive-site.xml" = "$env:HIVE_HOME\conf\hive-site.xml";
        "core-site.xml" = "$env:HADOOP_HOME\etc\hadoop\core-site.xml";
        "hdfs-site.xml" = "$env:HADOOP_HOME\etc\hadoop\hdfs-site.xml";
        "mapred-site.xml" = "$env:HADOOP_HOME\etc\hadoop\mapred-site.xml";
        "yarn-site.xml" = "$env:HADOOP_HOME\etc\hadoop\yarn-site.xml"
    }

    if (!($hdiConfigFiles[$ConfigFileName])) {
        Write-HDILog "Unable to configure $ConfigFileName because it is not part of the HDI configuration files."
        return
    }

    [xml]$configFile = Get-Content $hdiConfigFiles[$ConfigFileName]

    $existingproperty = $configFile.configuration.property | where {$_.Name -eq $Name}

    if ($existingproperty) {
        $existingproperty.Value = $Value
        $existingproperty.Description = $Description
    } else {
        $newproperty = @($configFile.configuration.property)[0].Clone()
        $newproperty.Name = $Name
        $newproperty.Value = $Value
        $newproperty.Description = $Description
        $configFile.configuration.AppendChild($newproperty)
    }

    $configFile.Save($hdiConfigFiles[$ConfigFileName])

    Write-HDILog "$configFileName has been configured."

<span data-ttu-id="66813-125">Lo script accetta quattro parametri, il nome del file di configurazione, la proprietà da modificare, il valore da impostare e una descrizione.</span><span class="sxs-lookup"><span data-stu-id="66813-125">The script takes four parameters, the configuration file name, the property you want to modify, the value you want to set, and a description.</span></span> <span data-ttu-id="66813-126">ad esempio:</span><span class="sxs-lookup"><span data-stu-id="66813-126">For example:</span></span>

    hive-site.xml hive.metastore.client.socket.timeout 90

<span data-ttu-id="66813-127">Questi parametri impostano il valore hive.metastore.client.socket.timeout su 90 nel file hive-site.xml.</span><span class="sxs-lookup"><span data-stu-id="66813-127">These parameters sets the hive.metastore.client.socket.timeout value to 90 in the hive-site.xml file.</span></span>  <span data-ttu-id="66813-128">Il valore predefinito è 60 secondi.</span><span class="sxs-lookup"><span data-stu-id="66813-128">The default value is 60 seconds.</span></span>

<span data-ttu-id="66813-129">Lo script di esempio è disponibile anche all'indirizzo [https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1](https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1).</span><span class="sxs-lookup"><span data-stu-id="66813-129">This sample script can also be found at [https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1](https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1).</span></span>

<span data-ttu-id="66813-130">HDInsight fornisce diversi script di esempio per installare componenti aggiuntivi nei cluster HDInsight:</span><span class="sxs-lookup"><span data-stu-id="66813-130">HDInsight provides several scripts to install additional components on HDInsight clusters:</span></span>

| <span data-ttu-id="66813-131">Nome</span><span class="sxs-lookup"><span data-stu-id="66813-131">Name</span></span> | <span data-ttu-id="66813-132">Script</span><span class="sxs-lookup"><span data-stu-id="66813-132">Script</span></span> |
| --- | --- |
| <span data-ttu-id="66813-133">**Installare Spark**</span><span class="sxs-lookup"><span data-stu-id="66813-133">**Install Spark**</span></span> |<span data-ttu-id="66813-134">https://hdiconfigactions.blob.core.windows.net/sparkconfigactionv03/spark-installer-v03.ps1.</span><span class="sxs-lookup"><span data-stu-id="66813-134">https://hdiconfigactions.blob.core.windows.net/sparkconfigactionv03/spark-installer-v03.ps1.</span></span> <span data-ttu-id="66813-135">Vedere [Installare e usare Spark in cluster Hadoop di HDInsight][hdinsight-install-spark].</span><span class="sxs-lookup"><span data-stu-id="66813-135">See [Install and use Spark on HDInsight clusters][hdinsight-install-spark].</span></span> |
| <span data-ttu-id="66813-136">**Installare R**</span><span class="sxs-lookup"><span data-stu-id="66813-136">**Install R**</span></span> |<span data-ttu-id="66813-137">https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1.</span><span class="sxs-lookup"><span data-stu-id="66813-137">https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1.</span></span> <span data-ttu-id="66813-138">Vedere [Installare e usare R nei cluster HDInsight][hdinsight-r-scripts].</span><span class="sxs-lookup"><span data-stu-id="66813-138">See [Install and use R on HDInsight clusters][hdinsight-r-scripts].</span></span> |
| <span data-ttu-id="66813-139">**Installare Solr**</span><span class="sxs-lookup"><span data-stu-id="66813-139">**Install Solr**</span></span> |<span data-ttu-id="66813-140">https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1.</span><span class="sxs-lookup"><span data-stu-id="66813-140">https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1.</span></span> <span data-ttu-id="66813-141">Vedere [Installare e usare Solr nei cluster Hadoop di HDInsight](hdinsight-hadoop-solr-install.md).</span><span class="sxs-lookup"><span data-stu-id="66813-141">See [Install and use Solr on HDInsight clusters](hdinsight-hadoop-solr-install.md).</span></span> |
| <span data-ttu-id="66813-142">- **Installare Giraph**</span><span class="sxs-lookup"><span data-stu-id="66813-142">- **Install Giraph**</span></span> |<span data-ttu-id="66813-143">https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1.</span><span class="sxs-lookup"><span data-stu-id="66813-143">https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1.</span></span> <span data-ttu-id="66813-144">Vedere [Installare Giraph nei cluster HDInsight Hadoop](hdinsight-hadoop-giraph-install.md).</span><span class="sxs-lookup"><span data-stu-id="66813-144">See [Install and use Giraph on HDInsight clusters](hdinsight-hadoop-giraph-install.md).</span></span> |

<span data-ttu-id="66813-145">È possibile distribuire l'azione script dal portale di Azure, da Azure PowerShell o tramite HDInsight .NET SDK.</span><span class="sxs-lookup"><span data-stu-id="66813-145">Script Action can be deployed from the Azure portal, Azure PowerShell or by using the HDInsight .NET SDK.</span></span>  <span data-ttu-id="66813-146">Per altre informazioni, vedere [Personalizzare cluster HDInsight mediante l'azione script][hdinsight-cluster-customize].</span><span class="sxs-lookup"><span data-stu-id="66813-146">For more information, see [Customize HDInsight clusters using Script Action][hdinsight-cluster-customize].</span></span>

> [!NOTE]
> <span data-ttu-id="66813-147">Gli script di esempio funzionano solo con il cluster HDInsight versione 3.1 o successiva.</span><span class="sxs-lookup"><span data-stu-id="66813-147">The sample scripts work only with HDInsight cluster version 3.1 or above.</span></span> <span data-ttu-id="66813-148">Per altre informazioni sulle versioni dei cluster HDInsight, vedere [Versioni cluster HDInsight](hdinsight-component-versioning.md).</span><span class="sxs-lookup"><span data-stu-id="66813-148">For more information on HDInsight cluster versions, see [HDInsight cluster versions](hdinsight-component-versioning.md).</span></span>
>
>

## <a name="helper-methods-for-custom-scripts"></a><span data-ttu-id="66813-149">Metodi helper per gli script personalizzati</span><span class="sxs-lookup"><span data-stu-id="66813-149">Helper methods for custom scripts</span></span>
<span data-ttu-id="66813-150">I metodi di supporto di Azione script sono utilità che è possibile usare durante la scrittura di script personalizzati.</span><span class="sxs-lookup"><span data-stu-id="66813-150">Script Action helper methods are utilities that you can use while writing custom scripts.</span></span> <span data-ttu-id="66813-151">Questi metodi vengono definiti all'indirizzo [https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1](https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1)e possono essere inclusi negli script mediante l'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="66813-151">These methods are defined in [https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1](https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1), and can be included in your scripts using the following sample:</span></span>

    # Download config action module from a well-known directory.
    $CONFIGACTIONURI = "https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1";
    $CONFIGACTIONMODULE = "C:\apps\dist\HDInsightUtilities.psm1";
    $webclient = New-Object System.Net.WebClient;
    $webclient.DownloadFile($CONFIGACTIONURI, $CONFIGACTIONMODULE);

    # (TIP) Import config action helper method module to make writing config action easy.
    if (Test-Path ($CONFIGACTIONMODULE))
    {
        Import-Module $CONFIGACTIONMODULE;
    }
    else
    {
        Write-Output "Failed to load HDInsightUtilities module, exiting ...";
        exit;
    }

<span data-ttu-id="66813-152">Di seguito sono indicati i metodi di supporto forniti da questo script:</span><span class="sxs-lookup"><span data-stu-id="66813-152">Here are the helper methods that are provided by this script:</span></span>

| <span data-ttu-id="66813-153">Metodo helper</span><span class="sxs-lookup"><span data-stu-id="66813-153">Helper method</span></span> | <span data-ttu-id="66813-154">Descrizione</span><span class="sxs-lookup"><span data-stu-id="66813-154">Description</span></span> |
| --- | --- |
| <span data-ttu-id="66813-155">**Save-HDIFile**</span><span class="sxs-lookup"><span data-stu-id="66813-155">**Save-HDIFile**</span></span> |<span data-ttu-id="66813-156">Scaricare un file dall'URI (Uniform Resource Identifier) specificato a un percorso nel disco locale associato al nodo della VM di Azure assegnato al cluster</span><span class="sxs-lookup"><span data-stu-id="66813-156">Download a file from the specified Uniform Resource Identifier (URI) to a location on the local disk that is associated with the Azure VM node assigned to the cluster.</span></span> |
| <span data-ttu-id="66813-157">**Expand-HDIZippedFile**</span><span class="sxs-lookup"><span data-stu-id="66813-157">**Expand-HDIZippedFile**</span></span> |<span data-ttu-id="66813-158">Decomprimere un file compresso.</span><span class="sxs-lookup"><span data-stu-id="66813-158">Unzip a zipped file.</span></span> |
| <span data-ttu-id="66813-159">**Invoke-HDICmdScript**</span><span class="sxs-lookup"><span data-stu-id="66813-159">**Invoke-HDICmdScript**</span></span> |<span data-ttu-id="66813-160">Eseguire uno script da cmd.exe.</span><span class="sxs-lookup"><span data-stu-id="66813-160">Run a script from cmd.exe.</span></span> |
| <span data-ttu-id="66813-161">**Write-HDILog**</span><span class="sxs-lookup"><span data-stu-id="66813-161">**Write-HDILog**</span></span> |<span data-ttu-id="66813-162">Scrivere l'output dallo script personalizzato usato per un'azione script.</span><span class="sxs-lookup"><span data-stu-id="66813-162">Write output from the custom script used for a script action.</span></span> |
| <span data-ttu-id="66813-163">**Get-Services**</span><span class="sxs-lookup"><span data-stu-id="66813-163">**Get-Services**</span></span> |<span data-ttu-id="66813-164">Recuperare un elenco di servizi in esecuzione nel computer in cui viene eseguito lo script.</span><span class="sxs-lookup"><span data-stu-id="66813-164">Get a list of services running on the machine where the script executes.</span></span> |
| <span data-ttu-id="66813-165">**Get-Service**</span><span class="sxs-lookup"><span data-stu-id="66813-165">**Get-Service**</span></span> |<span data-ttu-id="66813-166">Con il nome del servizio specificato come input, ottenere informazioni dettagliate per uno specifico servizio (nome del servizio, ID processo, stato, ecc.) nel computer in cui viene eseguito lo script.</span><span class="sxs-lookup"><span data-stu-id="66813-166">With the specific service name as input, get detailed information for a specific service (service name, process ID, state, etc.) on the machine where the script executes.</span></span> |
| <span data-ttu-id="66813-167">**Get-HDIServices**</span><span class="sxs-lookup"><span data-stu-id="66813-167">**Get-HDIServices**</span></span> |<span data-ttu-id="66813-168">Recuperare un elenco di servizi di HDInsight in esecuzione nel computer in cui viene eseguito lo script.</span><span class="sxs-lookup"><span data-stu-id="66813-168">Get a list of HDInsight services running on the computer where the script executes.</span></span> |
| <span data-ttu-id="66813-169">**Get-HDIService**</span><span class="sxs-lookup"><span data-stu-id="66813-169">**Get-HDIService**</span></span> |<span data-ttu-id="66813-170">Con il nome del servizio di HDInsight specificato come input, ottenere informazioni dettagliate per uno specifico servizio (nome del servizio, ID processo, stato, ecc.) nel computer in cui viene eseguito lo script.</span><span class="sxs-lookup"><span data-stu-id="66813-170">With the specific HDInsight service name as input, get detailed information for a specific service (service name, process ID, state, etc.) on the machine where the script executes.</span></span> |
| <span data-ttu-id="66813-171">**Get-ServicesRunning**</span><span class="sxs-lookup"><span data-stu-id="66813-171">**Get-ServicesRunning**</span></span> |<span data-ttu-id="66813-172">Recuperare un elenco di servizi in esecuzione nel computer in cui viene eseguito lo script.</span><span class="sxs-lookup"><span data-stu-id="66813-172">Get a list of services that are running on the computer where the script executes.</span></span> |
| <span data-ttu-id="66813-173">**Get-ServiceRunning**</span><span class="sxs-lookup"><span data-stu-id="66813-173">**Get-ServiceRunning**</span></span> |<span data-ttu-id="66813-174">Controllare se un servizio specifico (individuato tramite nome) è in esecuzione nel computer in cui viene eseguito lo script.</span><span class="sxs-lookup"><span data-stu-id="66813-174">Check if a specific service (by name) is running on the computer where the script executes.</span></span> |
| <span data-ttu-id="66813-175">**Get-HDIServicesRunning**</span><span class="sxs-lookup"><span data-stu-id="66813-175">**Get-HDIServicesRunning**</span></span> |<span data-ttu-id="66813-176">Recuperare un elenco di servizi di HDInsight in esecuzione nel computer in cui viene eseguito lo script.</span><span class="sxs-lookup"><span data-stu-id="66813-176">Get a list of HDInsight services running on the computer where the script executes.</span></span> |
| <span data-ttu-id="66813-177">**Get-HDIServiceRunning**</span><span class="sxs-lookup"><span data-stu-id="66813-177">**Get-HDIServiceRunning**</span></span> |<span data-ttu-id="66813-178">Controllare se un servizio specifico di HDInsight (individuato tramite nome) è in esecuzione nel computer in cui viene eseguito lo script.</span><span class="sxs-lookup"><span data-stu-id="66813-178">Check if a specific HDInsight service (by name) is running on the computer where the script executes.</span></span> |
| <span data-ttu-id="66813-179">**Get-HDIHadoopVersion**</span><span class="sxs-lookup"><span data-stu-id="66813-179">**Get-HDIHadoopVersion**</span></span> |<span data-ttu-id="66813-180">Recuperare la versione di Hadoop installata nel computer in cui viene eseguito lo script.</span><span class="sxs-lookup"><span data-stu-id="66813-180">Get the version of Hadoop installed on the computer where the script executes.</span></span> |
| <span data-ttu-id="66813-181">**Test-IsHDIHeadNode**</span><span class="sxs-lookup"><span data-stu-id="66813-181">**Test-IsHDIHeadNode**</span></span> |<span data-ttu-id="66813-182">Verificare se il computer in cui viene eseguito lo script è un nodo head.</span><span class="sxs-lookup"><span data-stu-id="66813-182">Check if the computer where the script executes is a head node.</span></span> |
| <span data-ttu-id="66813-183">**Test-IsActiveHDIHeadNode**</span><span class="sxs-lookup"><span data-stu-id="66813-183">**Test-IsActiveHDIHeadNode**</span></span> |<span data-ttu-id="66813-184">Verificare se il computer in cui viene eseguito lo script è un nodo head attivo.</span><span class="sxs-lookup"><span data-stu-id="66813-184">Check if the computer where the script executes is an active head node.</span></span> |
| <span data-ttu-id="66813-185">**Test-IsHDIDataNode**</span><span class="sxs-lookup"><span data-stu-id="66813-185">**Test-IsHDIDataNode**</span></span> |<span data-ttu-id="66813-186">Verificare se il computer in cui viene eseguito lo script è un nodo di dati.</span><span class="sxs-lookup"><span data-stu-id="66813-186">Check if the computer where the script executes is a data node.</span></span> |
| <span data-ttu-id="66813-187">**Edit-HDIConfigFile**</span><span class="sxs-lookup"><span data-stu-id="66813-187">**Edit-HDIConfigFile**</span></span> |<span data-ttu-id="66813-188">Modificare i file di configurazione hive-site.xml, core-site.xml, hdfs-site.xml, mapred-site.xml o yarn-site.xml.</span><span class="sxs-lookup"><span data-stu-id="66813-188">Edit the config files hive-site.xml, core-site.xml, hdfs-site.xml, mapred-site.xml, or yarn-site.xml.</span></span> |

## <a name="best-practices-for-script-development"></a><span data-ttu-id="66813-189">Procedure consigliate per lo sviluppo di script</span><span class="sxs-lookup"><span data-stu-id="66813-189">Best practices for script development</span></span>
<span data-ttu-id="66813-190">Quando si sviluppa uno script personalizzato per un cluster HDInsight, è opportuno seguire le procedure consigliate indicate di seguito:</span><span class="sxs-lookup"><span data-stu-id="66813-190">When you develop a custom script for an HDInsight cluster, there are several best practices to keep in mind:</span></span>

* <span data-ttu-id="66813-191">Controllare la versione di Hadoop</span><span class="sxs-lookup"><span data-stu-id="66813-191">Check for the Hadoop version</span></span>

    <span data-ttu-id="66813-192">Solo HDInsight versione 3.1 (Hadoop 2.4) e versioni successive supportano l'uso di Azione script per installare i componenti personalizzati in un cluster.</span><span class="sxs-lookup"><span data-stu-id="66813-192">Only HDInsight version 3.1 (Hadoop 2.4) and above support using Script Action to install custom components on a cluster.</span></span> <span data-ttu-id="66813-193">Nello script personalizzato è necessario usare il metodo helper **Get-HDIHadoopVersion** per controllare la versione di Hadoop prima di procedere con le altre attività nello script.</span><span class="sxs-lookup"><span data-stu-id="66813-193">In your custom script, you must use the **Get-HDIHadoopVersion** helper method to check the Hadoop version before proceeding with performing other tasks in the script.</span></span>
* <span data-ttu-id="66813-194">Fornire collegamenti stabili alle risorse di script</span><span class="sxs-lookup"><span data-stu-id="66813-194">Provide stable links to script resources</span></span>

    <span data-ttu-id="66813-195">Gli utenti devono assicurarsi che tutti gli script e gli altri elementi usati per la personalizzazione di un cluster rimangano disponibili per l'intero ciclo di vita del cluster stesso e che durante tale periodo le versioni di questi file non cambino.</span><span class="sxs-lookup"><span data-stu-id="66813-195">Users should make sure that all the scripts and other artifacts used in the customization of a cluster remain available throughout the lifetime of the cluster and that the versions of these files do not change for the duration.</span></span> <span data-ttu-id="66813-196">Queste risorse sono richieste in caso di ricreazione dell'immagine dei nodi nel cluster.</span><span class="sxs-lookup"><span data-stu-id="66813-196">These resources are required if the reimaging of nodes in the cluster is required.</span></span> <span data-ttu-id="66813-197">Si consiglia di scaricare e archiviare tutti gli elementi in un account di archiviazione controllato dall'utente.</span><span class="sxs-lookup"><span data-stu-id="66813-197">The best practice is to download and archive everything in a Storage account that the user controls.</span></span> <span data-ttu-id="66813-198">L'account di archiviazione può essere quello predefinito o uno degli account aggiuntivi specificati durante la distribuzione di un cluster personalizzato.</span><span class="sxs-lookup"><span data-stu-id="66813-198">This can be the default Storage account or any of the additional Storage accounts specified at the time of deployment for a customized cluster.</span></span>
    <span data-ttu-id="66813-199">Negli esempi di cluster personalizzati Spark e R forniti nella documentazione, ad esempio, è stata eseguita una copia locale delle risorse in questo account di archiviazione: https://hdiconfigactions.blob.core.windows.net/.</span><span class="sxs-lookup"><span data-stu-id="66813-199">In the Spark and R customized cluster samples provided in the documentation, for example, we have made a local copy of the resources in this Storage account: https://hdiconfigactions.blob.core.windows.net/.</span></span>
* <span data-ttu-id="66813-200">Assicurarsi che lo script di personalizzazione del cluster sia idempotente</span><span class="sxs-lookup"><span data-stu-id="66813-200">Ensure that the cluster customization script is idempotent</span></span>

    <span data-ttu-id="66813-201">È necessario tenere presente che, durante il ciclo di vita di un cluster HDInsight, verrà ricreata l'immagine dei nodi di quest'ultimo.</span><span class="sxs-lookup"><span data-stu-id="66813-201">You must expect that the nodes of an HDInsight cluster is reimaged during the cluster lifetime.</span></span> <span data-ttu-id="66813-202">Lo script di personalizzazione del cluster viene eseguito ad ogni nuova creazione dell'immagine del cluster.</span><span class="sxs-lookup"><span data-stu-id="66813-202">The cluster customization script is run whenever a cluster is reimaged.</span></span> <span data-ttu-id="66813-203">Questo script deve essere progettato in modo da essere idempotente. In altri termini, quando viene ricreata l'immagine, lo script deve assicurare che il cluster venga riportato allo stesso stato personalizzato in cui si trovava dopo la prima esecuzione dello script, al momento della creazione originaria del cluster.</span><span class="sxs-lookup"><span data-stu-id="66813-203">This script must be designed to be idempotent in the sense that upon reimaging, the script should ensure that the cluster is returned to the same customized state that it was in just after the script ran for the first time when the cluster was initially created.</span></span> <span data-ttu-id="66813-204">Se, ad esempio, al momento della prima esecuzione uno script personalizzato ha installato un'applicazione in D:\AppLocation, a ogni esecuzione successiva, quando viene ricreata l'immagine, lo script deve verificare la presenza dell'applicazione nel percorso D:\AppLocation prima di procedere con altri passaggi.</span><span class="sxs-lookup"><span data-stu-id="66813-204">For example, if a custom script installed an application at D:\AppLocation on its first run, then on each subsequent run, upon reimaging, the script should check whether the application exists at the D:\AppLocation location before proceeding with other steps in the script.</span></span>
* <span data-ttu-id="66813-205">Installare i componenti personalizzati nella posizione ottimale</span><span class="sxs-lookup"><span data-stu-id="66813-205">Install custom components in the optimal location</span></span>

    <span data-ttu-id="66813-206">Quando vengono ricreate le immagini dei nodi del cluster, l'unità delle risorse C:\ e l'unità di sistema D:\ potrebbero essere riformattate, causando una perdita dei dati e delle applicazioni installate nei driver.</span><span class="sxs-lookup"><span data-stu-id="66813-206">When cluster nodes are reimaged, the C:\ resource drive and D:\ system drive can be reformatted, resulting in the loss of data and applications that had been installed on those drives.</span></span> <span data-ttu-id="66813-207">Questo problema può verificarsi anche se un nodo della macchina virtuale (VM) di Azure che fa parte del cluster si arresta e viene sostituito da un nuovo nodo.</span><span class="sxs-lookup"><span data-stu-id="66813-207">This could also happen if an Azure virtual machine (VM) node that is part of the cluster goes down and is replaced by a new node.</span></span> <span data-ttu-id="66813-208">È possibile installare componenti nell'unità D:\ o nel percorso C:\apps del cluster.</span><span class="sxs-lookup"><span data-stu-id="66813-208">You can install components on the D:\ drive or in the C:\apps location on the cluster.</span></span> <span data-ttu-id="66813-209">Tutti gli altri percorsi nell'unità C:\ sono riservati.</span><span class="sxs-lookup"><span data-stu-id="66813-209">All other locations on the C:\ drive are reserved.</span></span> <span data-ttu-id="66813-210">Specificare il percorso in cui installare le applicazioni o le librerie nello script di personalizzazione del cluster.</span><span class="sxs-lookup"><span data-stu-id="66813-210">Specify the location where applications or libraries are to be installed in the cluster customization script.</span></span>
* <span data-ttu-id="66813-211">Verificare la disponibilità elevata dell'architettura del cluster</span><span class="sxs-lookup"><span data-stu-id="66813-211">Ensure high availability of the cluster architecture</span></span>

    <span data-ttu-id="66813-212">HDInsight ha un'architettura attivo/passivo per la disponibilità elevata, in cui un nodo head è in modalità attiva (dove sono in esecuzione i servizi HDInsight) e l'altro è in modalità standby (dove non sono in esecuzione i servizi HDInsight).</span><span class="sxs-lookup"><span data-stu-id="66813-212">HDInsight has an active-passive architecture for high availability, in which one head node is in active mode (where the HDInsight services are running) and the other head node is in standby mode (in which HDInsight services are not running).</span></span> <span data-ttu-id="66813-213">I nodi passano dalla modalità attiva a quella passiva e viceversa quando i servizi HDInsight vengono interrotti.</span><span class="sxs-lookup"><span data-stu-id="66813-213">The nodes switch active and passive modes if HDInsight services are interrupted.</span></span> <span data-ttu-id="66813-214">Se un'azione script viene usata per installare i servizi in entrambi i nodi head per la disponibilità elevata, tenere presente che il meccanismo di failover di HDInsight non sarà in grado di eseguire automaticamente il failover di questi servizi installati dall'utente.</span><span class="sxs-lookup"><span data-stu-id="66813-214">If a script action is used to install services on both head nodes for high availability, note that the HDInsight failover mechanism is not able to automatically fail over these user-installed services.</span></span> <span data-ttu-id="66813-215">Quindi, se è richiesta la disponibilità elevata per i servizi installati dall'utente nei nodi head di HDInsight, questi servizi devono avere un proprio meccanismo di failover se sono in modalità attivo/passivo oppure essere in modalità attivo/attivo.</span><span class="sxs-lookup"><span data-stu-id="66813-215">So user-installed services on HDInsight head nodes that are expected to be highly available must either have their own failover mechanism if in active-passive mode or be in active-active mode.</span></span>

    <span data-ttu-id="66813-216">Il comando dell'azione Script di HDInsight viene eseguito su entrambi i nodi head quando il ruolo di questi nodi viene specificato nel parametro *ClusterRoleCollection* descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="66813-216">An HDInsight Script Action command runs on both head nodes when the head-node role is specified as a value in the *ClusterRoleCollection* parameter.</span></span> <span data-ttu-id="66813-217">Pertanto, quando si progetta uno script personalizzato, assicurarsi che lo script tenga conto di questa impostazione.</span><span class="sxs-lookup"><span data-stu-id="66813-217">So when you design a custom script, make sure that your script is aware of this setup.</span></span> <span data-ttu-id="66813-218">Per evitare problemi, è preferibile non installare e avviare gli stessi servizi in entrambi i nodi head, dove è possibile che entrino in competizione l'uno con l'altro.</span><span class="sxs-lookup"><span data-stu-id="66813-218">You should not run into problems where the same services are installed and started on both of the head nodes and they end up competing with each other.</span></span> <span data-ttu-id="66813-219">Tenere anche presente che, quando viene ricreata l'immagine, sono possibili perdite di dati: è quindi necessario che il software installato mediante l'azione script sia resiliente a eventi di questo tipo.</span><span class="sxs-lookup"><span data-stu-id="66813-219">Also, be aware that data is lost during reimaging, so software installed via Script Action has to be resilient to such events.</span></span> <span data-ttu-id="66813-220">Le applicazioni devono essere progettate per usare dati a disponibilità elevata distribuiti in molti nodi.</span><span class="sxs-lookup"><span data-stu-id="66813-220">Applications should be designed to work with highly available data that is distributed across many nodes.</span></span> <span data-ttu-id="66813-221">Si noti che è possibile ricreare allo stesso tempo l'immagine di 1/5 dei nodi di un cluster.</span><span class="sxs-lookup"><span data-stu-id="66813-221">Note that as many as 1/5 of the nodes in a cluster can be reimaged at the same time.</span></span>
* <span data-ttu-id="66813-222">Configurare i componenti personalizzati per l'uso dell'archivio BLOB di Azure</span><span class="sxs-lookup"><span data-stu-id="66813-222">Configure the custom components to use Azure Blob storage</span></span>

    <span data-ttu-id="66813-223">I componenti personalizzati installati nei nodi del cluster possono avere una configurazione predefinita per l'uso dell'archiviazione in un file system distribuito Hadoop (HDFS).</span><span class="sxs-lookup"><span data-stu-id="66813-223">The custom components that you install on the cluster nodes might have a default configuration to use Hadoop Distributed File System (HDFS) storage.</span></span> <span data-ttu-id="66813-224">Modificare la configurazione in modo che venga usato l'archivio BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="66813-224">You should change the configuration to use Azure Blob storage instead.</span></span> <span data-ttu-id="66813-225">Quando si ricrea l'immagine di un cluster, il file system HDFS viene formattato e tutti i dati archiviati vengono eliminati.</span><span class="sxs-lookup"><span data-stu-id="66813-225">On a cluster reimage, the HDFS file system gets formatted and you would lose any data that is stored there.</span></span> <span data-ttu-id="66813-226">Se invece si usa l'archivio BLOB di Azure, i dati vengono mantenuti.</span><span class="sxs-lookup"><span data-stu-id="66813-226">Using Azure Blob storage instead ensures that your data is retained.</span></span>

## <a name="common-usage-patterns"></a><span data-ttu-id="66813-227">Modelli di utilizzo comuni</span><span class="sxs-lookup"><span data-stu-id="66813-227">Common usage patterns</span></span>
<span data-ttu-id="66813-228">Questa sezione fornisce indicazioni sull'implementazione di alcuni dei modelli di utilizzo comuni che si potrebbero riscontrare durante la scrittura dello script personalizzato.</span><span class="sxs-lookup"><span data-stu-id="66813-228">This section provides guidance on implementing some of the common usage patterns that you might run into while writing your own custom script.</span></span>

### <a name="configure-environment-variables"></a><span data-ttu-id="66813-229">Configurare le variabili di ambiente</span><span class="sxs-lookup"><span data-stu-id="66813-229">Configure environment variables</span></span>
<span data-ttu-id="66813-230">Spesso nello sviluppo delle azioni script risulta necessario impostare alcune variabili di ambiente.</span><span class="sxs-lookup"><span data-stu-id="66813-230">Often in script action development, you feel the need to set environment variables.</span></span> <span data-ttu-id="66813-231">Ad esempio, uno scenario molto comune è quello in cui si scarica un file binario da un sito esterno, lo si installa nel cluster e si aggiunge il percorso di installazione alla variabile di ambiente 'PATH'.</span><span class="sxs-lookup"><span data-stu-id="66813-231">For instance, a most likely scenario is when you download a binary from an external site, install it on the cluster, and add the location of where it is installed to your ‘PATH’ environment variable.</span></span> <span data-ttu-id="66813-232">Il seguente frammento di codice mostra come impostare le variabili di ambiente nello script personalizzato.</span><span class="sxs-lookup"><span data-stu-id="66813-232">The following snippet shows you how to set environment variables in the custom script.</span></span>

    Write-HDILog "Starting environment variable setting at: $(Get-Date)";
    [Environment]::SetEnvironmentVariable('MDS_RUNNER_CUSTOM_CLUSTER', 'true', 'Machine');

<span data-ttu-id="66813-233">Questa istruzione imposta la variabile di ambiente **MDS_RUNNER_CUSTOM_CLUSTER** sul valore 'true', oltre a impostare l'ambito di questa variabile a livello di computer.</span><span class="sxs-lookup"><span data-stu-id="66813-233">This statement sets the environment variable **MDS_RUNNER_CUSTOM_CLUSTER** to the value 'true' and also sets the scope of this variable to be machine-wide.</span></span> <span data-ttu-id="66813-234">In alcuni casi è importante che le variabili di ambiente siano impostate nell'ambito appropriato: computer o utente.</span><span class="sxs-lookup"><span data-stu-id="66813-234">At times it is important that environment variables are set at the appropriate scope – machine or user.</span></span> <span data-ttu-id="66813-235">Vedere [qui][1] per altre informazioni sull'impostazione delle variabili di ambiente.</span><span class="sxs-lookup"><span data-stu-id="66813-235">Refer [here][1] for more information on setting environment variables.</span></span>

### <a name="access-to-locations-where-the-custom-scripts-are-stored"></a><span data-ttu-id="66813-236">Accedere alle posizioni in cui sono archiviati gli script personalizzati</span><span class="sxs-lookup"><span data-stu-id="66813-236">Access to locations where the custom scripts are stored</span></span>
<span data-ttu-id="66813-237">Gli script usati per personalizzare un cluster devono essere nell'account di archiviazione predefinito per il cluster o in un contenitore di sola lettura pubblico in qualsiasi altro account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="66813-237">Scripts used to customize a cluster needs to either be in the default storage account for the cluster or in a public read-only container on any other storage account.</span></span> <span data-ttu-id="66813-238">Se lo script accede a risorse ubicate altrove, queste devono essere in una posizione accessibile pubblicamente (almeno di sola lettura pubblica).</span><span class="sxs-lookup"><span data-stu-id="66813-238">If your script accesses resources located elsewhere these need to be in a publicly accessible (at least public read-only).</span></span> <span data-ttu-id="66813-239">Ad esempio, si potrebbe accedere a un file e salvarlo con il comando SaveFile-HDI.</span><span class="sxs-lookup"><span data-stu-id="66813-239">For instance you might want to access a file and save it using the SaveFile-HDI command.</span></span>

    Save-HDIFile -SrcUri 'https://somestorageaccount.blob.core.windows.net/somecontainer/some-file.jar' -DestFile 'C:\apps\dist\hadoop-2.4.0.2.1.9.0-2196\share\hadoop\mapreduce\some-file.jar'

<span data-ttu-id="66813-240">In questo esempio, è necessario assicurarsi che il contenitore 'somecontainer' nell'account di archiviazione 'somestorageaccount' sia accessibile pubblicamente.</span><span class="sxs-lookup"><span data-stu-id="66813-240">In this example, you must ensure that the container 'somecontainer' in storage account 'somestorageaccount' is publicly accessible.</span></span> <span data-ttu-id="66813-241">In caso contrario, lo script genera un'eccezione "Non trovato" ed ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="66813-241">Otherwise, the script throws a ‘Not Found’ exception and fail.</span></span>

### <a name="pass-parameters-to-the-add-azurermhdinsightscriptaction-cmdlet"></a><span data-ttu-id="66813-242">Passare i parametri al cmdlet Add-AzureRmHDInsightScriptAction</span><span class="sxs-lookup"><span data-stu-id="66813-242">Pass parameters to the Add-AzureRmHDInsightScriptAction cmdlet</span></span>
<span data-ttu-id="66813-243">Per passare più parametri al cmdlet Add-AzureRmHDInsightScriptAction, è necessario formattare il valore di stringa per contenere tutti i parametri per lo script.</span><span class="sxs-lookup"><span data-stu-id="66813-243">To pass multiple parameters to the Add-AzureRmHDInsightScriptAction cmdlet, you need to format the string value to contain all parameters for the script.</span></span> <span data-ttu-id="66813-244">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="66813-244">For example:</span></span>

    "-CertifcateUri wasb:///abc.pfx -CertificatePassword 123456 -InstallFolderName MyFolder"

<span data-ttu-id="66813-245">oppure</span><span class="sxs-lookup"><span data-stu-id="66813-245">or</span></span>

    $parameters = '-Parameters "{0};{1};{2}"' -f $CertificateName,$certUriWithSasToken,$CertificatePassword


### <a name="throw-exception-for-failed-cluster-deployment"></a><span data-ttu-id="66813-246">Generare un'eccezione per la distribuzione cluster non riuscita</span><span class="sxs-lookup"><span data-stu-id="66813-246">Throw exception for failed cluster deployment</span></span>
<span data-ttu-id="66813-247">Per ricevere notifiche precise relative al fatto che la personalizzazione del cluster non è andata come previsto, è importante generare un'eccezione e abbandonare la creazione del cluster.</span><span class="sxs-lookup"><span data-stu-id="66813-247">If you want to get accurately notified of the fact that cluster customization did not succeed as expected, it is important to throw an exception and fail the cluster creation.</span></span> <span data-ttu-id="66813-248">Ad esempio, potrebbe essere necessario elaborare un file, se esistente, e gestire lo scenario di errore in cui il file non esiste.</span><span class="sxs-lookup"><span data-stu-id="66813-248">For instance, you might want to process a file if it exists and handle the error case where the file does not exist.</span></span> <span data-ttu-id="66813-249">Ciò garantirà che lo script venga chiuso normalmente e lo stato del cluster noto sia corretto.</span><span class="sxs-lookup"><span data-stu-id="66813-249">This would ensure that the script exits gracefully and the state of the cluster is correctly known.</span></span> <span data-ttu-id="66813-250">Il seguente frammento di codice offre un esempio di come procedere:</span><span class="sxs-lookup"><span data-stu-id="66813-250">The following snippet gives an example of how to achieve this:</span></span>

    If(Test-Path($SomePath)) {
        #Process file in some way
    } else {
        # File does not exist; handle error case
        # Print error message
    exit
    }

<span data-ttu-id="66813-251">In questo frammento, se il file non esiste, si ottiene uno stato in cui lo script viene chiuso effettivamente in modo normale dopo la stampa del messaggio di errore e il cluster raggiunge lo stato in esecuzione, presupponendo che il processo di personalizzazione del cluster sia stato completato "correttamente".</span><span class="sxs-lookup"><span data-stu-id="66813-251">In this snippet, if the file did not exist, it would lead to a state where the script actually exits gracefully after printing the error message, and the cluster reaches running state assuming it "successfully" completed cluster customization process.</span></span> <span data-ttu-id="66813-252">Per ricevere notifiche precise relative al fatto che la personalizzazione del cluster non è andata come previsto a causa di un file mancante, è preferibile generare un'eccezione e abbandonare il passaggio di personalizzazione del cluster.</span><span class="sxs-lookup"><span data-stu-id="66813-252">If you want to be accurately notified of the fact that cluster customization essentially did not succeed as expected because of a missing file, it is more appropriate to throw an exception and fail the cluster customization step.</span></span> <span data-ttu-id="66813-253">A tale scopo è invece necessario usare il seguente frammento di codice di esempio.</span><span class="sxs-lookup"><span data-stu-id="66813-253">To achieve this you must use the following sample code snippet instead.</span></span>

    If(Test-Path($SomePath)) {
        #Process file in some way
    } else {
        # File does not exist; handle error case
        # Print error message
    throw
    }


## <a name="checklist-for-deploying-a-script-action"></a><span data-ttu-id="66813-254">Elenco di controllo per la distribuzione di un'azione script</span><span class="sxs-lookup"><span data-stu-id="66813-254">Checklist for deploying a script action</span></span>
<span data-ttu-id="66813-255">Di seguito sono indicati i passaggi effettuati durante la preparazione della distribuzione degli script:</span><span class="sxs-lookup"><span data-stu-id="66813-255">Here are the steps we took when preparing to deploy these scripts:</span></span>

1. <span data-ttu-id="66813-256">Inserire i file che contengono gli script personalizzati in un percorso accessibile per i nodi del cluster durante la distribuzione.</span><span class="sxs-lookup"><span data-stu-id="66813-256">Put the files that contain the custom scripts in a place that is accessible by the cluster nodes during deployment.</span></span> <span data-ttu-id="66813-257">L'account di archiviazione può essere uno qualsiasi degli account predefiniti o aggiuntivi specificati durante la distribuzione del cluster oppure qualsiasi altro contenitore di archiviazione accessibile pubblicamente.</span><span class="sxs-lookup"><span data-stu-id="66813-257">This can be any of the default or additional Storage accounts specified at the time of cluster deployment, or any other publicly accessible storage container.</span></span>
2. <span data-ttu-id="66813-258">Aggiungere controlli negli script per garantire che questi vengano eseguiti in modo idempotente, così che sia possibile eseguire più volte lo script nello stesso nodo.</span><span class="sxs-lookup"><span data-stu-id="66813-258">Add checks into scripts to make sure that they execute idempotently, so that the script can be executed multiple times on the same node.</span></span>
3. <span data-ttu-id="66813-259">Usare il cmdlet di Azure PowerShell **Write-Output** per stampare in STDOUT e in STDERR.</span><span class="sxs-lookup"><span data-stu-id="66813-259">Use the **Write-Output** Azure PowerShell cmdlet to print to STDOUT as well as STDERR.</span></span> <span data-ttu-id="66813-260">Non usare **Write-Host**.</span><span class="sxs-lookup"><span data-stu-id="66813-260">Do not use **Write-Host**.</span></span>
4. <span data-ttu-id="66813-261">Usare una cartella di file temporanea, ad esempio $env:TEMP, per conservare il file scaricato usato dagli script e quindi eliminarla dopo aver eseguito gli script stessi.</span><span class="sxs-lookup"><span data-stu-id="66813-261">Use a temporary file folder, such as $env:TEMP, to keep the downloaded file used by the scripts and then clean them up after scripts have executed.</span></span>
5. <span data-ttu-id="66813-262">Installare il software personalizzato solo in D:\ o C:\apps.</span><span class="sxs-lookup"><span data-stu-id="66813-262">Install custom software only at D:\ or C:\apps.</span></span> <span data-ttu-id="66813-263">Non usare altri percorsi dell'unità C: perché sono riservati.</span><span class="sxs-lookup"><span data-stu-id="66813-263">Other locations on the C: drive should not be used as they are reserved.</span></span> <span data-ttu-id="66813-264">Si noti che l'installazione dei file nell'unità C: all'esterno della cartella C:\apps può comportare errori di installazione durante la nuova creazione dell'immagine del nodo.</span><span class="sxs-lookup"><span data-stu-id="66813-264">Note that installing files on the C: drive outside of the C:\apps folder may result in setup failures during reimages of the node.</span></span>
6. <span data-ttu-id="66813-265">In caso di modifica delle impostazioni o dei file di configurazione del servizio Hadoop a livello di sistema operativo, è possibile riavviare i servizi HDInsight in modo che possano rilevare qualsiasi impostazione a livello di sistema operativo, ad esempio le variabili di ambiente impostate negli script.</span><span class="sxs-lookup"><span data-stu-id="66813-265">In the event that OS-level settings or Hadoop service configuration files were changed, you may want to restart HDInsight services so that they can pick up any OS-level settings, such as the environment variables set in the scripts.</span></span>

## <a name="debug-custom-scripts"></a><span data-ttu-id="66813-266">Eseguire il debug degli script personalizzati</span><span class="sxs-lookup"><span data-stu-id="66813-266">Debug custom scripts</span></span>
<span data-ttu-id="66813-267">I log di errore dello script vengono archiviati insieme ad altri output nell'account di archiviazione predefinito specificato per il cluster al momento della creazione.</span><span class="sxs-lookup"><span data-stu-id="66813-267">The script error logs are stored, along with other output, in the default Storage account that you specified for the cluster at its creation.</span></span> <span data-ttu-id="66813-268">I log vengono archiviati in una tabella con il nome *u<\frammento-nome-cluster><\timestamp>setuplog*.</span><span class="sxs-lookup"><span data-stu-id="66813-268">The logs are stored in a table with the name *u<\cluster-name-fragment><\time-stamp>setuplog*.</span></span> <span data-ttu-id="66813-269">Si tratta di log aggregati contenenti record provenienti da tutti i nodi (nodi head e nodi di lavoro), in cui lo script viene eseguito nel cluster.</span><span class="sxs-lookup"><span data-stu-id="66813-269">These are aggregated logs that have records from all of the nodes (head node and worker nodes) on which the script runs in the cluster.</span></span>
<span data-ttu-id="66813-270">È possibile verificare facilmente i log tramite HDInsight Tools per Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="66813-270">An easy way to check the logs is to use HDInsight Tools for Visual Studio.</span></span> <span data-ttu-id="66813-271">Per installare gli strumenti, vedere [Introduzione all'uso di HDInsight Hadoop Tools per Visual Studio](hdinsight-hadoop-visual-studio-tools-get-started.md#install-data-lake-tools-for-visual-studio)</span><span class="sxs-lookup"><span data-stu-id="66813-271">For installing the tools, see [Get started using Visual Studio Hadoop tools for HDInsight](hdinsight-hadoop-visual-studio-tools-get-started.md#install-data-lake-tools-for-visual-studio)</span></span>

<span data-ttu-id="66813-272">**Per verificare il log tramite Visual Studio**</span><span class="sxs-lookup"><span data-stu-id="66813-272">**To check the log using Visual Studio**</span></span>

1. <span data-ttu-id="66813-273">Aprire Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="66813-273">Open Visual Studio.</span></span>
2. <span data-ttu-id="66813-274">Fare clic su **Visualizza** e quindi su **Esplora server**.</span><span class="sxs-lookup"><span data-stu-id="66813-274">Click **View**, and then click **Server Explorer**.</span></span>
3. <span data-ttu-id="66813-275">Fare doppio clic su "Azure", fare clic su Connetti a **sottoscrizioni di Microsoft Azure**e quindi immettere le credenziali.</span><span class="sxs-lookup"><span data-stu-id="66813-275">Right-click "Azure", click Connect to **Microsoft Azure Subscriptions**, and then enter your credentials.</span></span>
4. <span data-ttu-id="66813-276">Espandere **Archiviazione**, l'account di archiviazione di Azure usato come file system predefinito e **Tabelle**, quindi fare doppio clic sul nome della tabella.</span><span class="sxs-lookup"><span data-stu-id="66813-276">Expand **Storage**, expand the Azure storage account used as the default file system, expand **Tables**, and then double-click the table name.</span></span>

<span data-ttu-id="66813-277">È anche possibile accedere in remoto ai nodi cluster per visualizzare sia STDOUT che STDERR per gli script personalizzati.</span><span class="sxs-lookup"><span data-stu-id="66813-277">You can also remote into the cluster nodes to see both STDOUT and STDERR for custom scripts.</span></span> <span data-ttu-id="66813-278">I log in ciascun nodo sono specifici solo per tale nodo e sono accessibili da **C:\HDInsightLogs\DeploymentAgent.log**.</span><span class="sxs-lookup"><span data-stu-id="66813-278">The logs on each node are specific only to that node and are logged into **C:\HDInsightLogs\DeploymentAgent.log**.</span></span> <span data-ttu-id="66813-279">Questi file di log registrano tutti gli output dello script personalizzato.</span><span class="sxs-lookup"><span data-stu-id="66813-279">These log files record all outputs from the custom script.</span></span> <span data-ttu-id="66813-280">Un frammento di log di esempio per un'azione script Spark è simile a quanto riportato di seguito:</span><span class="sxs-lookup"><span data-stu-id="66813-280">An example log snippet for a Spark script action looks like this:</span></span>

    Microsoft.Hadoop.Deployment.Engine.CustomPowershellScriptCommand; Details : BEGIN: Invoking powershell script https://configactions.blob.core.windows.net/sparkconfigactions/spark-installer.ps1.;
    Version : 2.1.0.0;
    ActivityId : 739e61f5-aa22-4254-aafc-9faf56fc2692;
    AzureVMName : HEADNODE0;
    IsException : False;
    ExceptionType : ;
    ExceptionMessage : ;
    InnerExceptionType : ;
    InnerExceptionMessage : ;
    Exception : ;
    ...

    Starting Spark installation at: 09/04/2014 21:46:02 Done with Spark installation at: 09/04/2014 21:46:38;

    Version : 2.1.0.0;
    ActivityId : 739e61f5-aa22-4254-aafc-9faf56fc2692;
    AzureVMName : HEADNODE0;
    IsException : False;
    ExceptionType : ;
    ExceptionMessage : ;
    InnerExceptionType : ;
    InnerExceptionMessage : ;
    Exception : ;
    ...

    Microsoft.Hadoop.Deployment.Engine.CustomPowershellScriptCommand;
    Details : END: Invoking powershell script https://configactions.blob.core.windows.net/sparkconfigactions/spark-installer.ps1.;
    Version : 2.1.0.0;
    ActivityId : 739e61f5-aa22-4254-aafc-9faf56fc2692;
    AzureVMName : HEADNODE0;
    IsException : False;
    ExceptionType : ;
    ExceptionMessage : ;
    InnerExceptionType : ;
    InnerExceptionMessage : ;
    Exception : ;


<span data-ttu-id="66813-281">In questo log è evidente che è stata eseguita l'azione script Spark nella VM denominata HEADNODE0 e che durante l'esecuzione non sono state generate eccezioni.</span><span class="sxs-lookup"><span data-stu-id="66813-281">In this log, it is clear that the Spark script action has been executed on the VM named HEADNODE0 and that no exceptions were thrown during the execution.</span></span>

<span data-ttu-id="66813-282">Nel caso in cui si verifichi un errore di esecuzione, anche l'output che descrive l'errore sarà contenuto in questo file di log.</span><span class="sxs-lookup"><span data-stu-id="66813-282">In the event that an execution failure occurs, the output describing it is also contained in this log file.</span></span> <span data-ttu-id="66813-283">Le informazioni fornite in questi log saranno utili per il debug di eventuali problemi di script.</span><span class="sxs-lookup"><span data-stu-id="66813-283">The information provided in these logs should be helpful in debugging script problems that may arise.</span></span>

## <a name="see-also"></a><span data-ttu-id="66813-284">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="66813-284">See also</span></span>
* <span data-ttu-id="66813-285">[Personalizzare cluster HDInsight mediante l'azione script][hdinsight-cluster-customize]</span><span class="sxs-lookup"><span data-stu-id="66813-285">[Customize HDInsight clusters using Script Action][hdinsight-cluster-customize]</span></span>
* <span data-ttu-id="66813-286">[Installare e usare Spark nei cluster HDInsight][hdinsight-install-spark]</span><span class="sxs-lookup"><span data-stu-id="66813-286">[Install and use Spark on HDInsight clusters][hdinsight-install-spark]</span></span>
* <span data-ttu-id="66813-287">[Installare e usare R nei cluster HDInsight][hdinsight-r-scripts]</span><span class="sxs-lookup"><span data-stu-id="66813-287">[Install and use R on HDInsight clusters][hdinsight-r-scripts]</span></span>
* <span data-ttu-id="66813-288">[Installare e usare Solr nei cluster HDInsight](hdinsight-hadoop-solr-install.md).</span><span class="sxs-lookup"><span data-stu-id="66813-288">[Install and use Solr on HDInsight clusters](hdinsight-hadoop-solr-install.md).</span></span>
* <span data-ttu-id="66813-289">[Installare e usare Giraph nei cluster HDInsight](hdinsight-hadoop-giraph-install.md).</span><span class="sxs-lookup"><span data-stu-id="66813-289">[Install and use Giraph on HDInsight clusters](hdinsight-hadoop-giraph-install.md).</span></span>

[hdinsight-provision]: hdinsight-provision-clusters.md
[hdinsight-cluster-customize]: hdinsight-hadoop-customize-cluster.md
[hdinsight-install-spark]: hdinsight-hadoop-spark-install.md
[hdinsight-r-scripts]: hdinsight-hadoop-r-scripts.md
[powershell-install-configure]: install-configure-powershell.md

<!--Reference links in article-->
[1]: https://msdn.microsoft.com/library/96xafkes(v=vs.110).aspx
