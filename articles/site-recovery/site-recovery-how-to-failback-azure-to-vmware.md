---
title: Come eseguire il failback da Azure in VMware | Microsoft Docs
description: "Dopo il failover delle macchine virtuali in Azure, è possibile avviare il failback per riportarle in locale. Informazioni sui passaggi per il failback."
services: site-recovery
documentationcenter: 
author: ruturaj
manager: gauravd
editor: 
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 06/05/2017
ms.author: ruturajd
ms.openlocfilehash: 622604dc3ce69085feff6705168d58ad9938c429
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="fail-back-from-azure-to-an-on-premises-site"></a><span data-ttu-id="ba975-104">Eseguire il failback da Azure a un sito locale</span><span class="sxs-lookup"><span data-stu-id="ba975-104">Fail back from Azure to an on-premises site</span></span>

<span data-ttu-id="ba975-105">Questo articolo descrive come eseguire il failback da Macchine virtuali di Azure al sito locale.</span><span class="sxs-lookup"><span data-stu-id="ba975-105">This article describes how to fail back virtual machines from Azure Virtual Machines to the on-premises site.</span></span> <span data-ttu-id="ba975-106">Seguire le istruzioni riportate in questo articolo per eseguire il failback delle macchine virtuali VMware o dei server fisici Windows/Linux dopo aver eseguito il failover dal sito locale in Azure usando l'esercitazione [Eseguire la replica di macchine virtuali VMware e server fisici in Azure con Azure Site Recovery](site-recovery-vmware-to-azure-classic.md).</span><span class="sxs-lookup"><span data-stu-id="ba975-106">Follow the instructions in this article to fail back your VMware virtual machines or Windows/Linux physical servers after they've failed over from the on-premises site to Azure by using the [Replicate VMware virtual machines and physical servers to Azure with Azure Site Recovery](site-recovery-vmware-to-azure-classic.md) tutorial.</span></span>

> [!WARNING]
> <span data-ttu-id="ba975-107">Se è stata [completata la migrazione](site-recovery-migrate-to-azure.md#what-do-we-mean-by-migration), la macchina virtuale è stata spostata in un altro gruppo di risorse o la macchina virtuale di Azure è stata eliminata, non è possibile eseguire il failback.</span><span class="sxs-lookup"><span data-stu-id="ba975-107">If you have [completed migration](site-recovery-migrate-to-azure.md#what-do-we-mean-by-migration), moved the virtual machine to another resource group, or deleted the Azure virtual machine, you cannot failback after that.</span></span>

> [!NOTE]
> <span data-ttu-id="ba975-108">Se è stato eseguito il failover delle macchine virtuali VMware, non è possibile eseguire il failback a un host Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="ba975-108">If you have failed over VMware virtual machines then you cannot failback to a Hyper-v host.</span></span>

## <a name="overview-of-failback"></a><span data-ttu-id="ba975-109">Panoramica del failback</span><span class="sxs-lookup"><span data-stu-id="ba975-109">Overview of failback</span></span>
<span data-ttu-id="ba975-110">Ecco come funziona il failback.</span><span class="sxs-lookup"><span data-stu-id="ba975-110">Here is how failback works.</span></span> <span data-ttu-id="ba975-111">Dopo aver eseguito il failover in Azure, eseguire il failback nel sito locale procedendo come segue:</span><span class="sxs-lookup"><span data-stu-id="ba975-111">After you have failed over to Azure, you fail back to your on-premises site in a few stages:</span></span>

1. <span data-ttu-id="ba975-112">[Riproteggere](site-recovery-how-to-reprotect.md) le macchine virtuali in Azure in modo che inizino a replicare le macchine virtuali VMware nel sito locale.</span><span class="sxs-lookup"><span data-stu-id="ba975-112">[Reprotect](site-recovery-how-to-reprotect.md) the virtual machines on Azure so that they start to replicate to VMware virtual machines in your on-premises site.</span></span> <span data-ttu-id="ba975-113">Come parte di questo processo, è necessario:</span><span class="sxs-lookup"><span data-stu-id="ba975-113">As part of this process, you also need to:</span></span>
    1. <span data-ttu-id="ba975-114">Configurare una destinazione master locale: la destinazione master Windows per le macchine virtuali Windows e la [destinazione master Linux](site-recovery-how-to-install-linux-master-target.md) per le macchine virtuali Linux.</span><span class="sxs-lookup"><span data-stu-id="ba975-114">Set up an on-premises master target: Windows master target for Windows virtual machines and [Linux master target](site-recovery-how-to-install-linux-master-target.md) for Linux virtual machines.</span></span>
    2. <span data-ttu-id="ba975-115">Configurare un [server di elaborazione](site-recovery-vmware-setup-azure-ps-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="ba975-115">Set up a [process server](site-recovery-vmware-setup-azure-ps-resource-manager.md).</span></span>
    3. <span data-ttu-id="ba975-116">Avviare la [riprotezione](site-recovery-how-to-reprotect.md).</span><span class="sxs-lookup"><span data-stu-id="ba975-116">Initiate [reprotect](site-recovery-how-to-reprotect.md).</span></span> <span data-ttu-id="ba975-117">Verrà spenta la macchina virtuale locale e i dati della macchina virtuale Azure verranno sincronizzati con i dischi locali.</span><span class="sxs-lookup"><span data-stu-id="ba975-117">This will turn off the on-premises virtual machine and synchronize the Azure virtual machine's data with the on-premises disks.</span></span>
5. <span data-ttu-id="ba975-118">Dopo la replica delle macchine virtuali in Azure nel sito locale, avviare un failover da Azure al sito locale.</span><span class="sxs-lookup"><span data-stu-id="ba975-118">After your virtual machines on Azure are replicating to your on-premises site, you initiate a fail over from Azure to the on-premises site.</span></span>

<span data-ttu-id="ba975-119">Dopo aver eseguito il failback dei dati, abilitare la riprotezione delle macchine virtuali locali in cui è stato eseguito il failback, in modo che inizino la replica in Azure.</span><span class="sxs-lookup"><span data-stu-id="ba975-119">After your data has failed back, you reprotect the on-premises virtual machines that you failed back to, so that they start to replicate to Azure.</span></span>

<span data-ttu-id="ba975-120">Per una rapida panoramica, guardare il video seguente che illustra come eseguire il failover da Azure a un sito locale.</span><span class="sxs-lookup"><span data-stu-id="ba975-120">For a quick overview, watch the following video about how to fail over from Azure to an on-premises site.</span></span>
> [!VIDEO https://channel9.msdn.com/Series/Azure-Site-Recovery/VMware-to-Azure-with-ASR-Video5-Failback-from-Azure-to-On-premises/player]

### <a name="fail-back-to-the-original-or-alternate-location"></a><span data-ttu-id="ba975-121">Eseguire il failback nella posizione originaria o in una posizione alternativa</span><span class="sxs-lookup"><span data-stu-id="ba975-121">Fail back to the original or alternate location</span></span>

<span data-ttu-id="ba975-122">Se è stato eseguito il failover di una macchina virtuale VMware è possibile eseguire il failback nella stessa macchina virtuale di origine locale, se è ancora presente.</span><span class="sxs-lookup"><span data-stu-id="ba975-122">If you failed over a VMware virtual machine, you can fail back to the same source on-premises virtual machine if it still exists.</span></span> <span data-ttu-id="ba975-123">In questo scenario viene eseguita la replica delle sole modifiche.</span><span class="sxs-lookup"><span data-stu-id="ba975-123">In this scenario, only the changes are replicated back.</span></span> <span data-ttu-id="ba975-124">Questo scenario è noto come ripristino nel percorso originale.</span><span class="sxs-lookup"><span data-stu-id="ba975-124">This scenario is known as original location recovery.</span></span> <span data-ttu-id="ba975-125">Se la macchina virtuale locale non esiste, lo scenario è un ripristino del percorso alternativo.</span><span class="sxs-lookup"><span data-stu-id="ba975-125">If the on-premises virtual machine does not exist, the scenario is an alternate location recovery.</span></span>

> [!NOTE]
> <span data-ttu-id="ba975-126">È possibile eseguire il failback solo al server vCenter e al server di configurazione originali.</span><span class="sxs-lookup"><span data-stu-id="ba975-126">You can only failback to the original vCenter and configuration server.</span></span> <span data-ttu-id="ba975-127">Non è possibile distribuire un server di configurazione ed eseguire il failback usandolo.</span><span class="sxs-lookup"><span data-stu-id="ba975-127">You cannot deploy a new configuration server and failback using it.</span></span> <span data-ttu-id="ba975-128">Non è inoltre possibile aggiungere un nuovo vCenter al server di configurazione esistente ed eseguire il failback nel nuovo vCenter.</span><span class="sxs-lookup"><span data-stu-id="ba975-128">Also, you cannot add a new vCenter to the exiting configuration server and failback into the new vCenter.</span></span>

#### <a name="original-location-recovery"></a><span data-ttu-id="ba975-129">Ripristino del percorso originale</span><span class="sxs-lookup"><span data-stu-id="ba975-129">Original location recovery</span></span>

<span data-ttu-id="ba975-130">Se si esegue il failback nella macchina virtuale originaria è necessario rispettare le condizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="ba975-130">If you fail back to the original virtual machine, the following conditions are required:</span></span>
* <span data-ttu-id="ba975-131">Se la macchina virtuale è gestita da un server vCenter, l'host ESX della destinazione master deve avere accesso all'archivio dati della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="ba975-131">If the virtual machine is managed by a vCenter server, then the master target's ESX host should have access to the virtual machine's datastore.</span></span>
* <span data-ttu-id="ba975-132">Se la macchina virtuale si trova in un host ESX, ma non è gestita da vCenter, il relativo disco rigido deve trovarsi in un archivio dati accessibile da parte dell'host della destinazione master.</span><span class="sxs-lookup"><span data-stu-id="ba975-132">If the virtual machine is on an ESX host but isn’t managed by vCenter, then the hard disk of the virtual machine must be in a datastore that the master target's host can access.</span></span>
* <span data-ttu-id="ba975-133">Se la macchina virtuale si trova in un host ESX e non usa vCenter, è necessario completare l'individuazione dell'host ESX della destinazione master prima di abilitare la riprotezione.</span><span class="sxs-lookup"><span data-stu-id="ba975-133">If your virtual machine is on an ESX host and doesn't use vCenter, then you should complete discovery of the ESX host of the master target before you reprotect.</span></span> <span data-ttu-id="ba975-134">Questa opzione è valida anche per il failback di server fisici.</span><span class="sxs-lookup"><span data-stu-id="ba975-134">This applies if you're failing back physical servers, too.</span></span>
* <span data-ttu-id="ba975-135">È possibile eseguire il failback in una rete virtuale (vSAN) o in un disco basato su Raw Device Mapping (RDM), se i dischi esistono già e sono connessi alla macchina virtuale locale.</span><span class="sxs-lookup"><span data-stu-id="ba975-135">You can fail back to a virtual storage area network (vSAN) or a disk that based on raw device mapping (RDM) if the disks already exist and are connected to the on-premises virtual machine.</span></span>

#### <a name="alternate-location-recovery"></a><span data-ttu-id="ba975-136">Ripristino del percorso alternativo</span><span class="sxs-lookup"><span data-stu-id="ba975-136">Alternate location recovery</span></span>
<span data-ttu-id="ba975-137">Se la macchina virtuale locale non esiste prima della riprotezione della macchina virtuale, lo scenario è denominato ripristino del percorso alternativo.</span><span class="sxs-lookup"><span data-stu-id="ba975-137">If the on-premises virtual machine does not exist before reprotecting the virtual machine, the scenario is called an alternate location recovery.</span></span> <span data-ttu-id="ba975-138">Il flusso di lavoro della riprotezione crea nuovamente la macchina virtuale locale.</span><span class="sxs-lookup"><span data-stu-id="ba975-138">The reprotect workflow creates the on-premises virtual machine again.</span></span> <span data-ttu-id="ba975-139">Verrà anche eseguito un download completo dei dati.</span><span class="sxs-lookup"><span data-stu-id="ba975-139">This will also cause a full data download.</span></span>

* <span data-ttu-id="ba975-140">Quando si esegue il failback in una posizione alternativa, la macchina virtuale verrà ripristinata nello stesso host ESX in cui è stato distribuito il server di destinazione master.</span><span class="sxs-lookup"><span data-stu-id="ba975-140">When you fail back to an alternate location, the virtual machine will be recovered to the same ESX host on which the master target server is deployed.</span></span> <span data-ttu-id="ba975-141">L'archivio dati usato per creare il disco sarà lo stesso archivio selezionato durante la riprotezione della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="ba975-141">The datastore that's used to create the disk will be the same datastore that was selected when reprotecting the virtual machine.</span></span>
* <span data-ttu-id="ba975-142">È possibile eseguire il failback solo in un archivio dati VMFS.</span><span class="sxs-lookup"><span data-stu-id="ba975-142">You can fail back only to a virtual machine file system (VMFS) datastore.</span></span> <span data-ttu-id="ba975-143">Con vSAN o RDM, la riprotezione e il failback avranno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="ba975-143">If you have a vSAN or RDM, reprotect and failback will not work.</span></span>
* <span data-ttu-id="ba975-144">La riprotezione comporta un trasferimento di dati iniziale di grandi dimensioni, a cui fanno seguito le modifiche.</span><span class="sxs-lookup"><span data-stu-id="ba975-144">Reprotect involves one large initial data transfer that's followed by the changes.</span></span> <span data-ttu-id="ba975-145">Questo processo avviene perché la macchina virtuale non esiste in locale.</span><span class="sxs-lookup"><span data-stu-id="ba975-145">This process exists because the virtual machine does not exist on premises.</span></span> <span data-ttu-id="ba975-146">È necessario eseguire di nuovo la replica dei dati completi.</span><span class="sxs-lookup"><span data-stu-id="ba975-146">The complete data needs to be replicated back.</span></span> <span data-ttu-id="ba975-147">La riprotezione impiegherà quindi più tempo rispetto al ripristino nel percorso originale.</span><span class="sxs-lookup"><span data-stu-id="ba975-147">This reprotect will also take more time than an original location recovery.</span></span>
* <span data-ttu-id="ba975-148">Non è possibile eseguire il failback in una rete vSAN o in dischi basati su RDM.</span><span class="sxs-lookup"><span data-stu-id="ba975-148">You cannot fail back to vSAN- or RDM-based disks.</span></span> <span data-ttu-id="ba975-149">In un archivio dati VMFS è possibile creare solo nuovi dischi VMDK.</span><span class="sxs-lookup"><span data-stu-id="ba975-149">Only new virtual machine disks (VMDKs) can be created on a VMFS datastore.</span></span>

<span data-ttu-id="ba975-150">In seguito al failover in Azure, è possibile eseguire il failback di una macchina fisica solo come macchina virtuale VMware, un'operazione chiamata anche P2A2V.</span><span class="sxs-lookup"><span data-stu-id="ba975-150">A physical machine, when failed over to Azure, can be failed back only as a VMware virtual machine (also referred to as P2A2V).</span></span> <span data-ttu-id="ba975-151">Questo flusso di lavoro è considerato come ripristino in un percorso alternativo.</span><span class="sxs-lookup"><span data-stu-id="ba975-151">This flow falls under the alternate location recovery.</span></span>

* <span data-ttu-id="ba975-152">Non è possibile eseguire il failback di un server fisico Windows Server 2008 R2 SP1 protetto e sottoposto a failover in Azure.</span><span class="sxs-lookup"><span data-stu-id="ba975-152">A Windows Server 2008 R2 SP1 physical server, if protected and failed over to Azure, cannot be failed back.</span></span>
* <span data-ttu-id="ba975-153">È necessario individuare almeno un server di destinazione master e gli host ESX/ESXi necessari per il failback.</span><span class="sxs-lookup"><span data-stu-id="ba975-153">Ensure that you discover at least one master target server and the necessary ESX/ESXi hosts to which you need to fail back.</span></span>

## <a name="have-you-completed-reprotection"></a><span data-ttu-id="ba975-154">Verificare se la riprotezione è stata completata.</span><span class="sxs-lookup"><span data-stu-id="ba975-154">Have you completed reprotection?</span></span>
<span data-ttu-id="ba975-155">Prima di proseguire, completare i passaggi di riprotezione in modo che le macchine virtuali siano nello stato replicato e sia possibile avviare un failover nel sito locale.</span><span class="sxs-lookup"><span data-stu-id="ba975-155">Before you proceed, complete the reprotect steps so that the virtual machines are in a replicated state, and you can initiate a failover back to an on-premises site.</span></span> <span data-ttu-id="ba975-156">Per altre informazioni, vedere [Come eseguire la riprotezione da Azure al sito locale](site-recovery-how-to-reprotect.md).</span><span class="sxs-lookup"><span data-stu-id="ba975-156">For more information, see [How to reprotect from Azure to on-premises](site-recovery-how-to-reprotect.md).</span></span>

## <a name="prerequisites"></a><span data-ttu-id="ba975-157">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="ba975-157">Prerequisites</span></span>

* <span data-ttu-id="ba975-158">Quando si esegue un failback, è necessario un server di configurazione locale.</span><span class="sxs-lookup"><span data-stu-id="ba975-158">A configuration server is required on premises when you do a failback.</span></span> <span data-ttu-id="ba975-159">Durante il failback, la macchina virtuale deve esistere nel database del server di configurazione; in caso contrario il failback non ha esisto negativo.</span><span class="sxs-lookup"><span data-stu-id="ba975-159">During failback, the virtual machine must exist in the configuration server database, or failback won't succeed.</span></span> <span data-ttu-id="ba975-160">Assicurarsi quindi di pianificare backup regolari del server.</span><span class="sxs-lookup"><span data-stu-id="ba975-160">Thus, ensure that you take regularly scheduled backups of your server.</span></span> <span data-ttu-id="ba975-161">In caso di emergenza, è necessario ripristinare il server con lo stesso indirizzo IP in modo che il failback funzioni.</span><span class="sxs-lookup"><span data-stu-id="ba975-161">If there was a disaster, you will need to restore the server with the same IP address for failback to work.</span></span>
* <span data-ttu-id="ba975-162">Il server di destinazione master non deve avere snapshot prima di attivare il failback.</span><span class="sxs-lookup"><span data-stu-id="ba975-162">The master target server should not have any snapshots before triggering failback.</span></span>

## <a name="steps-to-fail-back"></a><span data-ttu-id="ba975-163">Passaggi per eseguire il failback</span><span class="sxs-lookup"><span data-stu-id="ba975-163">Steps to fail back</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ba975-164">Prima di avviare il failback, assicurarsi di aver completato la riprotezione delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="ba975-164">Before you initiate failback, ensure that you have completed reprotection of the virtual machines.</span></span> <span data-ttu-id="ba975-165">Le macchine virtuali devono essere in stato protetto e l'integrità deve essere **OK**.</span><span class="sxs-lookup"><span data-stu-id="ba975-165">The virtual machines should be in a protected state, and their health should be **OK**.</span></span> <span data-ttu-id="ba975-166">Per riproteggere le macchine virtuali, leggere [come eseguire la riprotezione](site-recovery-how-to-reprotect.md).</span><span class="sxs-lookup"><span data-stu-id="ba975-166">To reprotect the virtual machines, read [how to reprotect](site-recovery-how-to-reprotect.md).</span></span>

1. <span data-ttu-id="ba975-167">Nella pagina degli elementi replicati selezionare la macchina virtuale e con il pulsante destro del mouse selezionare **Failover non pianificato**.</span><span class="sxs-lookup"><span data-stu-id="ba975-167">In the replicated items page, select the virtual machine, and right-click it to select **Unplanned Failover**.</span></span>
2. <span data-ttu-id="ba975-168">In **Conferma failover** verificare la direzione del failover (da Azure) e selezionare il punto di recupero (più recente o quello coerente con l'app più recente) da usare per il failover.</span><span class="sxs-lookup"><span data-stu-id="ba975-168">In **Confirm Failover**, verify the failover direction (from Azure), and then select the recovery point (latest, or the latest app consistent) that you want to use for the failover.</span></span> <span data-ttu-id="ba975-169">Il punto coerente con l'app deve essere antecedente all'ultimo punto di temporizzazione e causerà la perdita di alcuni dati.</span><span class="sxs-lookup"><span data-stu-id="ba975-169">The app consistent point is behind the latest point in time and causes some data loss.</span></span>
3. <span data-ttu-id="ba975-170">Durante il failover, Site Recovery arresta le macchine virtuali in Azure.</span><span class="sxs-lookup"><span data-stu-id="ba975-170">During failover, Site Recovery shuts down the virtual machines on Azure.</span></span> <span data-ttu-id="ba975-171">Assicurarsi che il failback sia stato completato come previsto e quindi verificare che le macchine virtuali di Azure siano state arrestate.</span><span class="sxs-lookup"><span data-stu-id="ba975-171">After you check that failback has completed as expected, you can check that the virtual machines on Azure have been shut down.</span></span>

### <a name="to-what-recovery-point-can-i-fail-back-the-virtual-machines"></a><span data-ttu-id="ba975-172">Punto di recupero in cui è possibile eseguire il failback delle macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="ba975-172">To what recovery point can I fail back the virtual machines?</span></span>

<span data-ttu-id="ba975-173">Durante il failback sono disponibili due opzioni per il failback di macchine virtuali/piano di ripristino.</span><span class="sxs-lookup"><span data-stu-id="ba975-173">During failback, you have two options to fail back the virtual machine/recovery plan.</span></span>

<span data-ttu-id="ba975-174">Se si seleziona l'ultimo periodo di tempo elaborato, verrà eseguito il failover di tutte le macchine virtuali nell'ultimo periodo di tempo disponibile.</span><span class="sxs-lookup"><span data-stu-id="ba975-174">If you select the latest processed point in time, all virtual machines will be failed over to their latest available point in time.</span></span> <span data-ttu-id="ba975-175">Se è presente un gruppo di replica nel piano di ripristino, verrà eseguito il failover di ogni macchina virtuale del gruppo di replica nell'ultimo periodo di tempo indipendente.</span><span class="sxs-lookup"><span data-stu-id="ba975-175">In case there is a replication group within the recovery plan, then each virtual machine of the replication group will fail over to its independent latest point in time.</span></span>

<span data-ttu-id="ba975-176">Non è possibile eseguire il failback di una macchina virtuale finché non ha almeno un punto di recupero.</span><span class="sxs-lookup"><span data-stu-id="ba975-176">You cannot fail back a virtual machine until it has at least one recovery point.</span></span> <span data-ttu-id="ba975-177">Non è possibile eseguire il failback di un piano di ripristino finché tutte le macchine virtuali non hanno almeno un punto di recupero.</span><span class="sxs-lookup"><span data-stu-id="ba975-177">You cannot fail back a recovery plan until all its virtual machines have at least one recovery point.</span></span>

> [!NOTE]
> <span data-ttu-id="ba975-178">Il punto di recupero più recente è un punto di recupero coerente con l'arresto anomalo.</span><span class="sxs-lookup"><span data-stu-id="ba975-178">A latest recovery point is a crash-consistent recovery point.</span></span>

<span data-ttu-id="ba975-179">Se si seleziona il punto di recupero coerente con l'applicazione, un singolo failback della macchina virtuale ripristinerà l'ultimo punto di recupero coerente con l'applicazione più recente disponibile.</span><span class="sxs-lookup"><span data-stu-id="ba975-179">If you select the application consistent recovery point, a single virtual machine failback will recover to its latest available application-consistent recovery point.</span></span> <span data-ttu-id="ba975-180">In caso di piano di ripristino con un gruppo di replica, ogni gruppo di replica ripristinerà il punto di recupero disponibile comune.</span><span class="sxs-lookup"><span data-stu-id="ba975-180">In the case of a recovery plan with a replication group, each replication group will recover to its common available recovery point.</span></span>
<span data-ttu-id="ba975-181">Si noti che i punti di recupero coerenti con l'applicazione possono essere indietro nel tempo e potrebbero verificarsi perdite di dati.</span><span class="sxs-lookup"><span data-stu-id="ba975-181">Note that application-consistent recovery points can be behind in time, and there might be loss in data.</span></span>

### <a name="what-happens-to-vmware-tools-post-failback"></a><span data-ttu-id="ba975-182">Che cosa succede agli strumenti VMware dopo il failback?</span><span class="sxs-lookup"><span data-stu-id="ba975-182">What happens to VMware tools post failback?</span></span>

<span data-ttu-id="ba975-183">Durante il failover in Azure, gli strumenti VMware non possono essere eseguiti nella macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="ba975-183">During failover to Azure, the VMware tools cannot be running on the Azure virtual machine.</span></span> <span data-ttu-id="ba975-184">Nel caso di una macchina virtuale Windows, Azure Site Recovery disabilita gli strumenti VMware durante il failover.</span><span class="sxs-lookup"><span data-stu-id="ba975-184">In case of a Windows virtual machine, ASR disables the VMware tools during failover.</span></span> <span data-ttu-id="ba975-185">Nel caso di una macchina virtuale Linux, Azure Site Recovery disinstalla gli strumenti VMware durante il failover.</span><span class="sxs-lookup"><span data-stu-id="ba975-185">In case of Linux virtual machine, ASR uninstalls the VMware tools during failover.</span></span>

<span data-ttu-id="ba975-186">Durante il failback della macchina virtuale Windows, gli strumenti VMware vengono riabilitati al failback.</span><span class="sxs-lookup"><span data-stu-id="ba975-186">During failback of the Windows virtual machine, the VMware tools are re-enabled upon failback.</span></span> <span data-ttu-id="ba975-187">Analogamente, per una macchina virtuale Linux, gli strumenti VMware vengono reinstallati nella macchina durante il failback.</span><span class="sxs-lookup"><span data-stu-id="ba975-187">Similarly, for a linux virtual machine, the VMware tools are reinstalled on the machine during failback.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ba975-188">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="ba975-188">Next steps</span></span>

<span data-ttu-id="ba975-189">Al termine del failback, è necessario eseguire il commit della macchina virtuale per garantire che vengano eliminate le macchine virtuali ripristinate in Azure.</span><span class="sxs-lookup"><span data-stu-id="ba975-189">After failback finishes, you need to commit the virtual machine to ensure that recovered virtual machines in Azure are deleted.</span></span>

### <a name="commit"></a><span data-ttu-id="ba975-190">Commit</span><span class="sxs-lookup"><span data-stu-id="ba975-190">Commit</span></span>
<span data-ttu-id="ba975-191">Il commit è necessario per rimuovere la macchina virtuale di cui è stato eseguito il failover da Azure.</span><span class="sxs-lookup"><span data-stu-id="ba975-191">Commit is required to remove the failed over virtual machine from Azure.</span></span>
<span data-ttu-id="ba975-192">Fare clic con il pulsante destro del mouse sull'elemento protetto e quindi su **Commit**.</span><span class="sxs-lookup"><span data-stu-id="ba975-192">Right-click the protected item, and then click **Commit**.</span></span> <span data-ttu-id="ba975-193">Un processo rimuoverà le macchine virtuali di cui è stato eseguito il failover in Azure.</span><span class="sxs-lookup"><span data-stu-id="ba975-193">A job will remove the failed over virtual machines in Azure.</span></span>

### <a name="reprotect-from-on-premises-to-azure"></a><span data-ttu-id="ba975-194">Abilitare la riprotezione dall'ambiente locale ad Azure</span><span class="sxs-lookup"><span data-stu-id="ba975-194">Reprotect from on-premises to Azure</span></span>

<span data-ttu-id="ba975-195">Al termine del commit la macchina virtuale si trova nuovamente nel sito locale, ma non è protetta.</span><span class="sxs-lookup"><span data-stu-id="ba975-195">After commit finishes, your virtual machine is back on the on-premises site, but it won’t be protected.</span></span> <span data-ttu-id="ba975-196">Per avviare nuovamente la replica in Azure, eseguire queste operazioni:</span><span class="sxs-lookup"><span data-stu-id="ba975-196">To start to replicate to Azure again, do the following:</span></span>

1. <span data-ttu-id="ba975-197">In **Insieme di credenziali** > **Impostazioni** > **Elementi replicati** selezionare le macchine virtuali di cui è stato eseguito il failback e quindi fare clic su **Riproteggi**.</span><span class="sxs-lookup"><span data-stu-id="ba975-197">In **Vault** > **Setting** > **Replicated items**, select the virtual machines that have failed back, and then click **Re-Protect**.</span></span>
2. <span data-ttu-id="ba975-198">Specificare il valore del server di elaborazione da usare per inviare i dati ad Azure.</span><span class="sxs-lookup"><span data-stu-id="ba975-198">Give the value of the process server that needs to be used to send data back to Azure.</span></span>
3. <span data-ttu-id="ba975-199">Fare clic su **OK** per avviare il processo di riprotezione.</span><span class="sxs-lookup"><span data-stu-id="ba975-199">Click **OK** to begin the reprotect job.</span></span>

> [!NOTE]
> <span data-ttu-id="ba975-200">Dopo l'avvio di una macchina virtuale in locale, registrare di nuovo l'agente nel server di configurazione può richiedere tempo, fino a 15 minuti.</span><span class="sxs-lookup"><span data-stu-id="ba975-200">After an on-premises virtual machine boots up, it takes some time for the agent to register back to the configuration server (up to 15 minutes).</span></span> <span data-ttu-id="ba975-201">Durante questo intervallo di tempo la riprotezione non riuscirà e sarà visualizzato un messaggio di errore con l'avviso che l'agente non è installato.</span><span class="sxs-lookup"><span data-stu-id="ba975-201">During this time, reprotect fails and returns an error message stating that the agent is not installed.</span></span> <span data-ttu-id="ba975-202">Attendere alcuni minuti e ripetere l'operazione di riprotezione.</span><span class="sxs-lookup"><span data-stu-id="ba975-202">Wait for a few minutes, and then try reprotect again.</span></span>

<span data-ttu-id="ba975-203">Al termine del processo di riprotezione, la macchina virtuale viene replicata in Azure e sarà possibile eseguire il failover.</span><span class="sxs-lookup"><span data-stu-id="ba975-203">After the reprotect job finishes, the virtual machine is replicating back to Azure, and you can do a failover.</span></span>

## <a name="common-issues"></a><span data-ttu-id="ba975-204">Problemi comuni</span><span class="sxs-lookup"><span data-stu-id="ba975-204">Common issues</span></span>
<span data-ttu-id="ba975-205">Assicurarsi che vCenter sia in uno stato connesso prima di eseguire un failback.</span><span class="sxs-lookup"><span data-stu-id="ba975-205">Make sure that the vCenter is in a connected state before you do a failback.</span></span> <span data-ttu-id="ba975-206">In caso contrario, la disconnessione dei dischi e il ricollegamento alla macchina virtuale avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="ba975-206">Otherwise, disconnecting disks and attaching them back to the virtual machine will fail.</span></span>
