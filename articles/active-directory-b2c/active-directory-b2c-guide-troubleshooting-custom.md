---
title: 'Azure Active Directory B2C: Risoluzione dei problemi dei criteri personalizzati| Microsoft Docs'
description: Informazioni sugli approcci per la risoluzione degli errori quando si lavora con i criteri personalizzati in Azure Active Directory.
services: active-directory-b2c
documentationcenter: 
author: rojasja
manager: krassk
editor: rojasja
ms.assetid: 
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/07/2017
ms.author: joroja
ms.openlocfilehash: 023390ba36a74217503ff8b3076ad17978fe3fb8
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshoot-azure-ad-b2c-custom-policies-and-identity-experience-framework"></a><span data-ttu-id="03cf1-103">Risoluzione dei problemi del framework di esperienza di gestione delle identità e criteri personalizzati di Azure AD B2C</span><span class="sxs-lookup"><span data-stu-id="03cf1-103">Troubleshoot Azure AD B2C custom policies and Identity Experience Framework</span></span>

<span data-ttu-id="03cf1-104">Se si usano i criteri personalizzati di Azure Active Directory B2C (Azure AD B2C), si potrebbero verificare problemi di impostazione del framework di esperienza di gestione delle identità nel relativo formato XML del linguaggio dei criteri.</span><span class="sxs-lookup"><span data-stu-id="03cf1-104">If you use Azure Active Directory B2C (Azure AD B2C) custom policies, you might experience challenges setting up the Identity Experience Framework in its policy language XML format.</span></span>  <span data-ttu-id="03cf1-105">Imparare a scrivere criteri personalizzati è come apprendere un nuovo linguaggio.</span><span class="sxs-lookup"><span data-stu-id="03cf1-105">Learning to write custom policies can be like learning a new language.</span></span> <span data-ttu-id="03cf1-106">Questo articolo descrive gli strumenti e suggerimenti che consentono di individuare e risolvere rapidamente i problemi.</span><span class="sxs-lookup"><span data-stu-id="03cf1-106">In this article, we describe tools and tips that can help you quickly discover and resolve issues.</span></span> 

> [!NOTE]
> <span data-ttu-id="03cf1-107">Questo articolo è incentrato sulla risoluzione dei problemi della configurazione dei criteri personalizzati di Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="03cf1-107">This article focuses on troubleshooting your Azure AD B2C custom policy configuration.</span></span> <span data-ttu-id="03cf1-108">Non tratta l'applicazione relying party o la relativa libreria di identità.</span><span class="sxs-lookup"><span data-stu-id="03cf1-108">It doesn't address the relying party application or its identity library.</span></span>

## <a name="xml-editing"></a><span data-ttu-id="03cf1-109">Modifica dell'XML</span><span class="sxs-lookup"><span data-stu-id="03cf1-109">XML editing</span></span>

<span data-ttu-id="03cf1-110">L'errore più comune nell'impostazione dei criteri è la formattazione XML non corretta.</span><span class="sxs-lookup"><span data-stu-id="03cf1-110">The most common error in setting up custom policies is improperly formatted XML.</span></span> <span data-ttu-id="03cf1-111">Un buon editor XML è essenziale.</span><span class="sxs-lookup"><span data-stu-id="03cf1-111">A good XML editor is nearly essential.</span></span> <span data-ttu-id="03cf1-112">Un editor XML valido visualizza il codice XML in modo nativo, applica un colore specifico ai contenuti, precompila i termini comuni, mantiene indicizzati gli elementi XML e riesce a eseguire la convalida con lo schema.</span><span class="sxs-lookup"><span data-stu-id="03cf1-112">A good XML editor displays XML natively, color-codes content, prefills common terms, keeps XML elements indexed, and can validate with schema.</span></span> <span data-ttu-id="03cf1-113">Seguono due editor XML tra i più validi:</span><span class="sxs-lookup"><span data-stu-id="03cf1-113">Here are two of our favorite XML editors:</span></span>

* [<span data-ttu-id="03cf1-114">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="03cf1-114">Visual Studio Code</span></span>](https://code.visualstudio.com/)
* [<span data-ttu-id="03cf1-115">Notepad++</span><span class="sxs-lookup"><span data-stu-id="03cf1-115">Notepad++</span></span>](https://notepad-plus-plus.org/)

<span data-ttu-id="03cf1-116">La convalida dello schema XML identifica gli errori prima del caricamento del file XML.</span><span class="sxs-lookup"><span data-stu-id="03cf1-116">XML schema validation identifies errors before you upload your XML file.</span></span> <span data-ttu-id="03cf1-117">Nella cartella radice dello starter pack ottenere la definizione dello schema XML TrustFrameworkPolicy_0.3.0.0.xsd.</span><span class="sxs-lookup"><span data-stu-id="03cf1-117">In the root folder of the starter pack, get the XML schema definition TrustFrameworkPolicy_0.3.0.0.xsd.</span></span> <span data-ttu-id="03cf1-118">Per ulteriori informazioni, nella documentazione dell'editor XML cercare *strumenti XML* e *convalida XML*.</span><span class="sxs-lookup"><span data-stu-id="03cf1-118">For more information, in the documentation of your XML editor, look for *XML tools* and *XML validation*.</span></span>

<span data-ttu-id="03cf1-119">Una revisione delle regole XML può risultare utile.</span><span class="sxs-lookup"><span data-stu-id="03cf1-119">You might find a review of XML rules helpful.</span></span> <span data-ttu-id="03cf1-120">Azure AD B2C rifiuta qualsiasi errore di formattazione XML che rileva.</span><span class="sxs-lookup"><span data-stu-id="03cf1-120">Azure AD B2C rejects any XML formatting errors that it detects.</span></span> <span data-ttu-id="03cf1-121">Un codice XML non correttamente formattato può restituire a volte messaggi di errore fuorvianti.</span><span class="sxs-lookup"><span data-stu-id="03cf1-121">Occasionally, incorrectly formatted XML might cause error messages that are misleading.</span></span>

## <a name="upload-policies-and-policy-validation"></a><span data-ttu-id="03cf1-122">Convalida dei criteri e del caricamento dei criteri</span><span class="sxs-lookup"><span data-stu-id="03cf1-122">Upload policies and policy validation</span></span>

 <span data-ttu-id="03cf1-123">La convalida del caricamento del file XML è automatica.</span><span class="sxs-lookup"><span data-stu-id="03cf1-123">XML file upload validation is automatic.</span></span> <span data-ttu-id="03cf1-124">La maggior parte degli errori causano errori del caricamento.</span><span class="sxs-lookup"><span data-stu-id="03cf1-124">Most errors cause the upload to fail.</span></span> <span data-ttu-id="03cf1-125">La convalida include il file dei criteri che si sta caricando.</span><span class="sxs-lookup"><span data-stu-id="03cf1-125">Validation includes the policy file that you are uploading.</span></span> <span data-ttu-id="03cf1-126">Include anche la catena di file a cui si riferisce il file di caricamento (il file dei criteri relying party, il file delle estensioni e il file di base).</span><span class="sxs-lookup"><span data-stu-id="03cf1-126">It also includes the chain of files the upload file refers to (the relying party policy file, the extensions file, and the base file).</span></span> 
 
 <span data-ttu-id="03cf1-127">Gli errori di convalida più comuni sono i seguenti.</span><span class="sxs-lookup"><span data-stu-id="03cf1-127">Common validation errors include the following.</span></span>

<span data-ttu-id="03cf1-128">Frammento con errore: `... makes a reference to ClaimType with id "displaName" but neither the policy nor any of its base policies contain such an element`</span><span class="sxs-lookup"><span data-stu-id="03cf1-128">Error snippet: `... makes a reference to ClaimType with id "displaName" but neither the policy nor any of its base policies contain such an element`</span></span>
* <span data-ttu-id="03cf1-129">Il valore ClaimType potrebbe non essere scritto correttamente oppure non esiste nello schema.</span><span class="sxs-lookup"><span data-stu-id="03cf1-129">The ClaimType value might be misspelled, or does not exist in the schema.</span></span>
* <span data-ttu-id="03cf1-130">I valori ClaimType devono essere definiti in almeno uno dei file nei criteri.</span><span class="sxs-lookup"><span data-stu-id="03cf1-130">ClaimType values must be defined in at least one of the files in the policy.</span></span> 
    <span data-ttu-id="03cf1-131">Ad esempio: ` <ClaimType Id="socialIdpUserId">`</span><span class="sxs-lookup"><span data-stu-id="03cf1-131">For example: ` <ClaimType Id="socialIdpUserId">`</span></span>
* <span data-ttu-id="03cf1-132">Se ClaimType è definito nel file delle estensioni, ma è usato anche in un valore TechnicalProfile nel file di base, il caricamento del file di base restituirà un errore.</span><span class="sxs-lookup"><span data-stu-id="03cf1-132">If ClaimType is defined in the extensions file, but it's also used in a TechnicalProfile value in the base file, uploading the base file results in an error.</span></span>

<span data-ttu-id="03cf1-133">Frammento con errore: `...makes a reference to a ClaimsTransformation with id...`</span><span class="sxs-lookup"><span data-stu-id="03cf1-133">Error snippet: `...makes a reference to a ClaimsTransformation with id...`</span></span>
* <span data-ttu-id="03cf1-134">Le cause dell'errore potrebbero essere le stesse dell'errore ClaimType.</span><span class="sxs-lookup"><span data-stu-id="03cf1-134">The causes for the error might be the same as for the ClaimType error.</span></span>

<span data-ttu-id="03cf1-135">Frammento con errore: `Reason: User is currently logged as a user of 'yourtenant.onmicrosoft.com' tenant. In order to manage 'yourtenant.onmicrosoft.com', please login as a user of 'yourtenant.onmicrosoft.com' tenant`</span><span class="sxs-lookup"><span data-stu-id="03cf1-135">Error snippet: `Reason: User is currently logged as a user of 'yourtenant.onmicrosoft.com' tenant. In order to manage 'yourtenant.onmicrosoft.com', please login as a user of 'yourtenant.onmicrosoft.com' tenant`</span></span>
* <span data-ttu-id="03cf1-136">Verificare che il valore TenantId negli elementi **\<TrustFrameworkPolicy\>**  e  **\<BasePolicy\>** corrisponda al tenant di Azure Active Directory B2C di destinazione.</span><span class="sxs-lookup"><span data-stu-id="03cf1-136">Check that the TenantId value in the **\<TrustFrameworkPolicy\>** and **\<BasePolicy\>** elements match your target Azure AD B2C tenant.</span></span>  

## <a name="troubleshoot-the-runtime"></a><span data-ttu-id="03cf1-137">Risoluzione dei problemi di runtime</span><span class="sxs-lookup"><span data-stu-id="03cf1-137">Troubleshoot the runtime</span></span>

* <span data-ttu-id="03cf1-138">Usare `Run Now` e `https://jwt.io` per testare i criteri indipendentemente dall'applicazione Web o per dispositivi mobili.</span><span class="sxs-lookup"><span data-stu-id="03cf1-138">Use `Run Now` and `https://jwt.io` to test your policies independently of your web or mobile application.</span></span> <span data-ttu-id="03cf1-139">Questo sito Web funziona come un'applicazione relying party.</span><span class="sxs-lookup"><span data-stu-id="03cf1-139">This website acts like a relying party application.</span></span> <span data-ttu-id="03cf1-140">Viene visualizzato il contenuto del token JSON Web (JWT) che viene generato per i criteri di Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="03cf1-140">It displays the contents of the JSON Web Token (JWT) that is generated by your Azure AD B2C policy.</span></span> <span data-ttu-id="03cf1-141">Per creare un'applicazione di test nel framework di esperienza di gestione delle identità usare i seguenti valori:</span><span class="sxs-lookup"><span data-stu-id="03cf1-141">To create a test application in Identity Experience Framework, use the following values:</span></span>
    * <span data-ttu-id="03cf1-142">Nome: TestApp</span><span class="sxs-lookup"><span data-stu-id="03cf1-142">Name: TestApp</span></span>
    * <span data-ttu-id="03cf1-143">App Web/API Web: no</span><span class="sxs-lookup"><span data-stu-id="03cf1-143">Web App/Web API: No</span></span>
    * <span data-ttu-id="03cf1-144">Client nativo: no</span><span class="sxs-lookup"><span data-stu-id="03cf1-144">Native client: No</span></span>

* <span data-ttu-id="03cf1-145">Per tracciare lo scambio di messaggi tra il browser client e Azure AD B2C usare [Fiddler](http://www.telerik.com/fiddler).</span><span class="sxs-lookup"><span data-stu-id="03cf1-145">To trace the exchange of messages between your client browser and Azure AD B2C, use [Fiddler](http://www.telerik.com/fiddler).</span></span> <span data-ttu-id="03cf1-146">Consente di ottenere un'indicazione del punto in cui il percorso utente genera errori nei passaggi di orchestrazione.</span><span class="sxs-lookup"><span data-stu-id="03cf1-146">It can help you get an indication of where your user journey is failing in your orchestration steps.</span></span>

* <span data-ttu-id="03cf1-147">In **Modalità sviluppo** usare **Application Insights** per tracciare l'attività del percorso utente nel framework di esperienza di gestione delle identità.</span><span class="sxs-lookup"><span data-stu-id="03cf1-147">In **Development mode**, use **Application Insights** to trace the activity of your Identity Experience Framework user journey.</span></span> <span data-ttu-id="03cf1-148">In **Modalità sviluppo** è possibile osservare lo scambio di attestazioni tra il framework di esperienza di gestione delle identità e i diversi provider di attestazioni definiti dai profili tecnici, ad esempio provider di identità, servizi basati su API, la directory dell'utente di Azure AD B2C e altri servizi come Multi-Factor Authentication di Azure.</span><span class="sxs-lookup"><span data-stu-id="03cf1-148">In **Development mode**, you can observe the exchange of claims between the Identity Experience Framework and the various claims providers that are defined by technical profiles, such as identity providers, API-based services, the Azure AD B2C user directory, and other services, like Azure Multi-Factor-Authentication.</span></span>  

## <a name="recommended-practices"></a><span data-ttu-id="03cf1-149">Procedure consigliate</span><span class="sxs-lookup"><span data-stu-id="03cf1-149">Recommended practices</span></span>

<span data-ttu-id="03cf1-150">**Mantenere più versioni degli scenari. Raggrupparli in un progetto con l'applicazione.**</span><span class="sxs-lookup"><span data-stu-id="03cf1-150">**Keep multiple versions of your scenarios. Group them in a project with your application.**</span></span> <span data-ttu-id="03cf1-151">I file base, delle estensioni e relying party dipendono direttamente tra loro.</span><span class="sxs-lookup"><span data-stu-id="03cf1-151">The base, extensions, and relying party files are directly dependent on each other.</span></span> <span data-ttu-id="03cf1-152">Salvarli come gruppo.</span><span class="sxs-lookup"><span data-stu-id="03cf1-152">Save them as a group.</span></span> <span data-ttu-id="03cf1-153">Quando vengono aggiunte nuove funzionalità ai criteri, mantenere versioni di lavoro separate.</span><span class="sxs-lookup"><span data-stu-id="03cf1-153">As new features are added to your policies, keep separate working versions.</span></span> <span data-ttu-id="03cf1-154">Inserire le versioni di lavoro nel file system con il codice dell'applicazione con cui interagiscono.</span><span class="sxs-lookup"><span data-stu-id="03cf1-154">Stage working versions in your own file system with the application code they interact with.</span></span>  <span data-ttu-id="03cf1-155">Le applicazioni potrebbero richiamare diversi criteri relying party in un tenant.</span><span class="sxs-lookup"><span data-stu-id="03cf1-155">Your applications might invoke many different relying party policies in a tenant.</span></span> <span data-ttu-id="03cf1-156">Potrebbero diventare dipendenti dalle attestazioni previste dai criteri di Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="03cf1-156">They might become dependent on the claims that they expect from your Azure AD B2C policies.</span></span>

<span data-ttu-id="03cf1-157">**Sviluppare e testare i profili tecnici con percorsi utente noti.**</span><span class="sxs-lookup"><span data-stu-id="03cf1-157">**Develop and test technical profiles with known user journeys.**</span></span> <span data-ttu-id="03cf1-158">Usare i criteri starter pack testati per configurare i profili tecnici.</span><span class="sxs-lookup"><span data-stu-id="03cf1-158">Use tested starter pack policies to set up your technical profiles.</span></span> <span data-ttu-id="03cf1-159">Testarli separatamente prima di includerli nel proprio percorso utente.</span><span class="sxs-lookup"><span data-stu-id="03cf1-159">Test them separately before you incorporate them into your own user journeys.</span></span>

<span data-ttu-id="03cf1-160">**Sviluppare e testare i percorsi utente con profili tecnici testati.**</span><span class="sxs-lookup"><span data-stu-id="03cf1-160">**Develop and test user journeys with tested technical profiles.**</span></span> <span data-ttu-id="03cf1-161">Modificare i passaggi di orchestrazione di un percorso utente in modo incrementale.</span><span class="sxs-lookup"><span data-stu-id="03cf1-161">Change the orchestration steps of a user journey incrementally.</span></span> <span data-ttu-id="03cf1-162">Compilare progressivamente gli scenari previsti.</span><span class="sxs-lookup"><span data-stu-id="03cf1-162">Progressively build your intended scenarios.</span></span>

## <a name="next-steps"></a><span data-ttu-id="03cf1-163">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="03cf1-163">Next steps</span></span>

* <span data-ttu-id="03cf1-164">In GitHub, scaricare il file zip [active-directory-b2c-custom-policy-starterpack] (https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack/archive/master.zip).</span><span class="sxs-lookup"><span data-stu-id="03cf1-164">In GitHub, download the [active-directory-b2c-custom-policy-starterpack] (https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack/archive/master.zip) .zip file.</span></span>
