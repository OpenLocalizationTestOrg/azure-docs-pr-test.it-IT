---
title: Uso di ElasticSearch come archivio di traccia delle applicazioni di Service Fabric | Documentazione Microsoft
description: Descrive in che modo le applicazioni di Service Fabric possono usare ElasticSearch e Kibana per archiviare, indicizzare ed eseguire ricerche nelle tracce (log) delle applicazioni.
services: service-fabric
documentationcenter: .net
author: karolz-ms
manager: adegeo
editor: 
ms.assetid: e59b0c39-e468-4d9e-b453-d5f2a8ad20d8
ms.service: service-fabric
ms.devlang: dotNet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/07/2017
ms.author: karolz@microsoft.com
redirect_url: /azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow
ms.openlocfilehash: 2d2ceceea131b41ad1a1735aaa2a859d035ab098
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="use-elasticsearch-as-a-service-fabric-application-trace-store"></a><span data-ttu-id="6c3fb-103">Usare ElasticSearch come archivio di traccia delle applicazioni di Service Fabric</span><span class="sxs-lookup"><span data-stu-id="6c3fb-103">Use Elasticsearch as a Service Fabric application trace store</span></span>
## <a name="introduction"></a><span data-ttu-id="6c3fb-104">Introduzione</span><span class="sxs-lookup"><span data-stu-id="6c3fb-104">Introduction</span></span>
<span data-ttu-id="6c3fb-105">Questo articolo descrive le modalità in cui le applicazioni di [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) possono usare **ElasticSearch** e **Kibana** per l'archiviazione delle tracce, l'indicizzazione e la ricerca.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-105">This article describes how [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) applications can use **Elasticsearch** and **Kibana** for application trace storage, indexing, and search.</span></span> <span data-ttu-id="6c3fb-106">[ElasticSearch](https://www.elastic.co/guide/index.html) è un motore di ricerca e analisi open source, distribuito e scalabile in tempo reale, nonché particolarmente adatto per questa attività,</span><span class="sxs-lookup"><span data-stu-id="6c3fb-106">[Elasticsearch](https://www.elastic.co/guide/index.html) is an open-source, distributed, and scalable real-time search and analytics engine that is well-suited for this task.</span></span> <span data-ttu-id="6c3fb-107">che può essere installato in macchine virtuali Windows o Linux con Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-107">It can be installed on Windows and Linux virtual machines running in Microsoft Azure.</span></span> <span data-ttu-id="6c3fb-108">Elasticsearch può elaborare in modo efficiente tracce *strutturate* create con tecnologie come **Event Tracing for Windows (ETW)**.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-108">Elasticsearch can efficiently process *structured* traces produced using technologies such as **Event Tracing for Windows (ETW)**.</span></span>

<span data-ttu-id="6c3fb-109">ETW viene usato dal runtime di Service Fabric per ottenere informazioni di diagnostica (tracce)</span><span class="sxs-lookup"><span data-stu-id="6c3fb-109">ETW is used by Service Fabric runtime to source diagnostic information (traces).</span></span> <span data-ttu-id="6c3fb-110">ed è anche il metodo consigliato alle applicazioni di Service Fabric per ottenere le rispettive informazioni di diagnostica.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-110">It is the recommended method for Service Fabric applications to source their diagnostic information, too.</span></span> <span data-ttu-id="6c3fb-111">L'uso dello stesso meccanismo consente la correlazione tra le tracce fornite dal runtime e dall'applicazione e facilita la risoluzione dei problemi.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-111">Using the same mechanism allows for correlation between runtime-supplied and application-supplied traces and makes troubleshooting easier.</span></span> <span data-ttu-id="6c3fb-112">I modelli di progetto di Service Fabric in Visual Studio include un'API di registrazione, basata sulla classe .NET **EventSource**, che genera tracce ETW per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-112">Service Fabric project templates in Visual Studio include a logging API (based on the .NET **EventSource** class) that emits ETW traces by default.</span></span> <span data-ttu-id="6c3fb-113">Per una panoramica generale sulla definizione delle tracce delle applicazioni di Service Fabric con ETW, vedere [Monitorare e diagnosticare servizi in una configurazione di sviluppo con computer locale](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span><span class="sxs-lookup"><span data-stu-id="6c3fb-113">For a general overview of Service Fabric application tracing using ETW, see [Monitoring and diagnosing services in a local machine development setup](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span></span>

<span data-ttu-id="6c3fb-114">Per poter essere visualizzate in ElasticSearch, le tracce devono essere acquisite nei nodi del cluster di Service Fabric in tempo reale, mentre è in esecuzione l'applicazione, e inviate all'endpoint ElasticSearch.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-114">For the traces to show up in Elasticsearch, they need to be captured at the Service Fabric cluster nodes in real time (while the application is running) and sent to an Elasticsearch endpoint.</span></span> <span data-ttu-id="6c3fb-115">Per l'acquisizione di tracce sono disponibili due opzioni principali:</span><span class="sxs-lookup"><span data-stu-id="6c3fb-115">There are two major options for trace capturing:</span></span>

* <span data-ttu-id="6c3fb-116">**Acquisizione di tracce in-process**</span><span class="sxs-lookup"><span data-stu-id="6c3fb-116">**In-process trace capturing**</span></span>  
  <span data-ttu-id="6c3fb-117">L'applicazione, o più esattamente il processo del servizio, è responsabile dell'invio dei dati di diagnostica all'archivio di traccia (ElasticSearch).</span><span class="sxs-lookup"><span data-stu-id="6c3fb-117">The application, or more precisely, service process, is responsible for sending out the diagnostic data to the trace store (Elasticsearch).</span></span>
* <span data-ttu-id="6c3fb-118">**Acquisizione di tracce out-of-process**</span><span class="sxs-lookup"><span data-stu-id="6c3fb-118">**Out-of-process trace capturing**</span></span>  
  <span data-ttu-id="6c3fb-119">Un agente separato acquisisce le tracce dal processo (o dai processi) di servizio e le invia all'archivio di traccia.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-119">A separate agent is capturing traces from the service process or processes and sending them to the trace store.</span></span>

<span data-ttu-id="6c3fb-120">Di seguito si descrive come configurare ElasticSearch in Azure, si illustrano i vantaggi e gli svantaggi di entrambe le opzioni di acquisizione e si spiega come configurare un servizio di Service Fabric per inviare dati a ElasticSearch.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-120">Below, we describe how to set up Elasticsearch on Azure, discuss the pros and cons for both capture options, and explain how to configure a Service Fabric service to send data to Elasticsearch.</span></span>

## <a name="set-up-elasticsearch-on-azure"></a><span data-ttu-id="6c3fb-121">Configurare ElasticSearch in Azure</span><span class="sxs-lookup"><span data-stu-id="6c3fb-121">Set up Elasticsearch on Azure</span></span>
<span data-ttu-id="6c3fb-122">L'uso dei [**modelli di Azure Resource Manager**](../azure-resource-manager/resource-group-overview.md) costituisce il modo più semplice per configurare il servizio ElasticSearch in Azure.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-122">The most straightforward way to set up the Elasticsearch service on Azure is through [**Azure Resource Manager templates**](../azure-resource-manager/resource-group-overview.md).</span></span> <span data-ttu-id="6c3fb-123">Un [modello di avvio rapido di Azure Resource Manager per ElasticSearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) è disponibile nel repository dei modelli di avvio rapido di Azure.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-123">A comprehensive [Quickstart Azure Resource Manager template for Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) is available from Azure Quickstart templates repository.</span></span> <span data-ttu-id="6c3fb-124">Questo modello usa account di archiviazione separati per le unità di scala (gruppi di nodi)</span><span class="sxs-lookup"><span data-stu-id="6c3fb-124">This template uses separate storage accounts for scale units (groups of nodes).</span></span> <span data-ttu-id="6c3fb-125">e può effettuare il provisioning di nodi client e server distinti con configurazioni diverse e un numero variabile di dischi dati collegati.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-125">It can also provision separate client and server nodes with different configurations and various numbers of data disks attached.</span></span>

<span data-ttu-id="6c3fb-126">In questo caso viene usato un altro modello, denominato **ES-MultiNode** dal [repository degli strumenti di diagnostica di Azure](https://github.com/Azure/azure-diagnostics-tools).</span><span class="sxs-lookup"><span data-stu-id="6c3fb-126">Here, we use another template, called **ES-MultiNode** from the [Azure diagnostic tools repository](https://github.com/Azure/azure-diagnostics-tools).</span></span> <span data-ttu-id="6c3fb-127">Questo modello è più semplice da usare e crea un cluster Elasticsearch protetto dall'autenticazione di base HTTP.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-127">This template is easier to use, and it creates an Elasticsearch cluster protected by HTTP basic authentication.</span></span> <span data-ttu-id="6c3fb-128">Prima di procedere, scaricare nel computer locale il repository disponibile in GitHub (clonando il repository o scaricando un file con estensione zip).</span><span class="sxs-lookup"><span data-stu-id="6c3fb-128">Before you proceed, download the repository from GitHub to your machine (by either cloning the repository or downloading a zip file).</span></span> <span data-ttu-id="6c3fb-129">Il modello ES-MultiNode si trova nella cartella con lo stesso nome.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-129">The ES-MultiNode template is located in the folder with the same name.</span></span>

### <a name="prepare-a-machine-to-run-elasticsearch-installation-scripts"></a><span data-ttu-id="6c3fb-130">Preparare un computer per l'esecuzione degli script di installazione di ElasticSearch</span><span class="sxs-lookup"><span data-stu-id="6c3fb-130">Prepare a machine to run Elasticsearch installation scripts</span></span>
<span data-ttu-id="6c3fb-131">Il modo più semplice per usare il modello ES-MultiNode è quello di eseguire uno script di Azure PowerShell fornito denominato `CreateElasticSearchCluster`.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-131">The easiest way to use the ES-MultiNode template is through a provided Azure PowerShell script called `CreateElasticSearchCluster`.</span></span> <span data-ttu-id="6c3fb-132">Per usare lo script, è necessario installare i moduli di PowerShell e uno strumento denominato **openssl**.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-132">To use this script, you need to install PowerShell modules and a tool called **openssl**.</span></span> <span data-ttu-id="6c3fb-133">indispensabile per la creazione di una chiave SSH che può essere usata per amministrare il cluster ElasticSearch in modalità remota.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-133">The latter is needed for creating an SSH key that can be used to administer your Elasticsearch cluster remotely.</span></span>

<span data-ttu-id="6c3fb-134">`CreateElasticSearchCluster` è progettato per semplificare l'uso del modello ES-MultiNode da un computer Windows.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-134">`CreateElasticSearchCluster` script is designed for ease of use with the ES-MultiNode template from a Windows machine.</span></span> <span data-ttu-id="6c3fb-135">È possibile usare il modello in un computer non Windows, ma questo scenario non rientra nell'ambito di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-135">It is possible to use the template on a non-Windows machine, but that scenario is beyond the scope of this article.</span></span>

1. <span data-ttu-id="6c3fb-136">Se non sono già stati installati, installare i [**moduli di Azure PowerShell**](http://aka.ms/webpi-azps).</span><span class="sxs-lookup"><span data-stu-id="6c3fb-136">If you haven't installed them already, install [**Azure PowerShell modules**](http://aka.ms/webpi-azps).</span></span> <span data-ttu-id="6c3fb-137">Quando richiesto, fare clic su **Esegui** e su **Installa**.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-137">When prompted, click **Run**, then **Install**.</span></span> <span data-ttu-id="6c3fb-138">È richiesto Azure PowerShell 1.3 o versioni successive.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-138">Azure PowerShell 1.3 or newer is required.</span></span>
2. <span data-ttu-id="6c3fb-139">Lo strumento **openssl** è incluso nella distribuzione di [**Git per Windows**](http://www.git-scm.com/downloads).</span><span class="sxs-lookup"><span data-stu-id="6c3fb-139">The **openssl** tool is included in the distribution of [**Git for Windows**](http://www.git-scm.com/downloads).</span></span> <span data-ttu-id="6c3fb-140">Se non è già stato fatto, installare [Git per Windows](http://www.git-scm.com/downloads) .</span><span class="sxs-lookup"><span data-stu-id="6c3fb-140">If you have not done so already, install [Git for Windows](http://www.git-scm.com/downloads) now.</span></span> <span data-ttu-id="6c3fb-141">accettando le opzioni di installazione predefinite.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-141">(The default installation options are OK.)</span></span>
3. <span data-ttu-id="6c3fb-142">Supponendo che Git sia già installato, ma non incluso nel percorso di sistema, aprire una finestra di Microsoft Azure PowerShell ed eseguire i comandi seguenti:</span><span class="sxs-lookup"><span data-stu-id="6c3fb-142">Assuming that Git has been installed but not included in the system path, open a Microsoft Azure PowerShell window and run the following commands:</span></span>
   
    ```powershell
    $ENV:PATH += ";<Git installation folder>\usr\bin"
    $ENV:OPENSSL_CONF = "<Git installation folder>\usr\ssl\openssl.cnf"
    ```
   
    <span data-ttu-id="6c3fb-143">Sostituire `<Git installation folder>` con il percorso Git nel computer locale. Il percorso predefinito è **"C:\Programmi\Git"**.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-143">Replace the `<Git installation folder>` with the Git location on your machine; the default is **"C:\Program Files\Git"**.</span></span> <span data-ttu-id="6c3fb-144">Si noti il carattere punto e virgola all'inizio del primo percorso.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-144">Note the semicolon character at the beginning of the first path.</span></span>
4. <span data-ttu-id="6c3fb-145">Assicurarsi di essere connessi ad Azure (tramite il cmdlet [`Add-AzureRmAccount`](https://msdn.microsoft.com/library/mt619267.aspx) ) e di avere selezionato la sottoscrizione da usare per creare il cluster Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-145">Ensure that you are logged on to Azure (via [`Add-AzureRmAccount`](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) and that you have selected the subscription that should be used to create your Elastic Search cluster.</span></span> <span data-ttu-id="6c3fb-146">Per verificare che sia selezionata la sottoscrizione corretta, è possibile usare i cmdlet `Get-AzureRmContext` e `Get-AzureRmSubscription`.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-146">You can verify that correct subscription is selected using `Get-AzureRmContext` and `Get-AzureRmSubscription` cmdlets.</span></span>
5. <span data-ttu-id="6c3fb-147">Se non è già stato fatto, passare dalla directory corrente alla cartella ES-MultiNode.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-147">If you haven't done so already, change the current directory to the ES-MultiNode folder.</span></span>

### <a name="run-the-createelasticsearchcluster-script"></a><span data-ttu-id="6c3fb-148">Eseguire lo script CreateElasticSearchCluster</span><span class="sxs-lookup"><span data-stu-id="6c3fb-148">Run the CreateElasticSearchCluster script</span></span>
<span data-ttu-id="6c3fb-149">Prima di eseguire lo script, aprire il file `azuredeploy-parameters.json` e verificare o specificare i valori per i parametri dello script.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-149">Before you run the script, open the `azuredeploy-parameters.json` file and verify or provide values for the script parameters.</span></span> <span data-ttu-id="6c3fb-150">Vengono forniti i parametri seguenti:</span><span class="sxs-lookup"><span data-stu-id="6c3fb-150">The following parameters are provided:</span></span>

| <span data-ttu-id="6c3fb-151">Nome parametro</span><span class="sxs-lookup"><span data-stu-id="6c3fb-151">Parameter Name</span></span> | <span data-ttu-id="6c3fb-152">Description</span><span class="sxs-lookup"><span data-stu-id="6c3fb-152">Description</span></span> |
| --- | --- |
| <span data-ttu-id="6c3fb-153">dnsNameForLoadBalancerIP</span><span class="sxs-lookup"><span data-stu-id="6c3fb-153">dnsNameForLoadBalancerIP</span></span> |<span data-ttu-id="6c3fb-154">Nome usato per creare il nome DNS visibile pubblicamente per il cluster Elasticsearch aggiungendo il dominio dell'area di Azure al nome fornito.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-154">The name that is used to create the publicly visible DNS name for the Elastic Search cluster (by appending the Azure region domain to the provided name).</span></span> <span data-ttu-id="6c3fb-155">Ad esempio, se il valore del parametro è "myBigCluster" e l'area di Azure scelta è Stati Uniti occidentali, il nome DNS risultante per il cluster sarà myBigCluster.westus.cloudapp.azure.com.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-155">For example, if this parameter value is "myBigCluster" and the chosen Azure region is West US, the resulting DNS name for the cluster is myBigCluster.westus.cloudapp.azure.com.</span></span> <br /><br /><span data-ttu-id="6c3fb-156">Questo nome viene usato anche come radice per i nomi di molti elementi associati al cluster Elasticsearch, ad esempio i nomi dei nodi dati.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-156">This name also serves as a root name for many artifacts associated with the Elastic Search cluster, such as data node names.</span></span> |
| <span data-ttu-id="6c3fb-157">adminUsername</span><span class="sxs-lookup"><span data-stu-id="6c3fb-157">adminUsername</span></span> |<span data-ttu-id="6c3fb-158">Nome dell'account amministratore per la gestione del cluster Elasticsearch; le chiavi SSH corrispondenti vengono generate automaticamente.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-158">The name of the administrator account for managing the Elastic Search cluster (corresponding SSH keys are generated automatically).</span></span> |
| <span data-ttu-id="6c3fb-159">dataNodeCount</span><span class="sxs-lookup"><span data-stu-id="6c3fb-159">dataNodeCount</span></span> |<span data-ttu-id="6c3fb-160">Numero di nodi nel cluster ElasticSearch.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-160">The number of nodes in the Elastic Search cluster.</span></span> <span data-ttu-id="6c3fb-161">La versione corrente dello script non fa distinzione tra nodi dati e di query, tutti i nodi eseguiranno entrambi i ruoli.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-161">The current version of the script does not distinguish between data and query nodes; all nodes play both roles.</span></span> <span data-ttu-id="6c3fb-162">Il valore predefinito è 3 nodi.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-162">Defaults to 3 nodes.</span></span> |
| <span data-ttu-id="6c3fb-163">dataDiskSize</span><span class="sxs-lookup"><span data-stu-id="6c3fb-163">dataDiskSize</span></span> |<span data-ttu-id="6c3fb-164">Dimensioni dei dischi dati (in GB) allocati per ogni nodo dati.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-164">The size of data disks (in GB) that is allocated for each data node.</span></span> <span data-ttu-id="6c3fb-165">Ogni nodo riceve 4 dischi dati dedicati esclusivamente al servizio Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-165">Each node receives 4 data disks, exclusively dedicated to Elastic Search service.</span></span> |
| <span data-ttu-id="6c3fb-166">region</span><span class="sxs-lookup"><span data-stu-id="6c3fb-166">region</span></span> |<span data-ttu-id="6c3fb-167">Nome dell'area di Azure in cui dovrà trovarsi il cluster ElasticSearch.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-167">The name of Azure region where the Elastic Search cluster should be located.</span></span> |
| <span data-ttu-id="6c3fb-168">esUserName</span><span class="sxs-lookup"><span data-stu-id="6c3fb-168">esUserName</span></span> |<span data-ttu-id="6c3fb-169">Nome utente configurato per l'accesso al cluster Elasticsearch (soggetto all'autenticazione HTTP di base).</span><span class="sxs-lookup"><span data-stu-id="6c3fb-169">The user name of the user that is configured to have access to ES cluster (subject to HTTP basic authentication).</span></span> <span data-ttu-id="6c3fb-170">La password non fa parte del file dei parametri e deve essere specificata quando viene richiamato lo script `CreateElasticSearchCluster` .</span><span class="sxs-lookup"><span data-stu-id="6c3fb-170">The password is not part of parameters file and must be provided when `CreateElasticSearchCluster` script is invoked.</span></span> |
| <span data-ttu-id="6c3fb-171">vmSizeDataNodes</span><span class="sxs-lookup"><span data-stu-id="6c3fb-171">vmSizeDataNodes</span></span> |<span data-ttu-id="6c3fb-172">Dimensioni della macchina virtuale di Azure per i nodi del cluster ElasticSearch.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-172">The Azure virtual machine size for Elastic Search cluster nodes.</span></span> <span data-ttu-id="6c3fb-173">Il valore predefinito è Standard_D2.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-173">Defaults to Standard_D2.</span></span> |

<span data-ttu-id="6c3fb-174">A questo punto è possibile eseguire lo script.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-174">Now you are ready to run the script.</span></span> <span data-ttu-id="6c3fb-175">Eseguire il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="6c3fb-175">Issue the following command:</span></span>

```powershell
CreateElasticSearchCluster -ResourceGroupName <es-group-name> -Region <azure-region> -EsPassword <es-password>
```

<span data-ttu-id="6c3fb-176">dove</span><span class="sxs-lookup"><span data-stu-id="6c3fb-176">where</span></span> 

| <span data-ttu-id="6c3fb-177">Nome del parametro di script</span><span class="sxs-lookup"><span data-stu-id="6c3fb-177">Script Parameter Name</span></span> | <span data-ttu-id="6c3fb-178">Description</span><span class="sxs-lookup"><span data-stu-id="6c3fb-178">Description</span></span> |
| --- | --- |
| `<es-group-name>` |<span data-ttu-id="6c3fb-179">Nome del gruppo di risorse di Azure che conterrà tutte le risorse cluster Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-179">The name of the Azure resource group that will contain all Elastic Search cluster resources.</span></span> |
| `<azure-region>` |<span data-ttu-id="6c3fb-180">Nome dell'area di Azure in cui si deve creare il cluster Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-180">The name of the Azure region where the Elastic Search cluster should be created.</span></span> |
| `<es-password>` |<span data-ttu-id="6c3fb-181">Password per l'utente di Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-181">The password for the Elastic Search user.</span></span> |

> [!NOTE]
> <span data-ttu-id="6c3fb-182">Se il cmdlet Test-AzureResourceGroup restituisce un messaggio NullReferenceException, significa che non è ancora stato eseguito l'accesso ad Azure (`Add-AzureRmAccount`).</span><span class="sxs-lookup"><span data-stu-id="6c3fb-182">If you get a NullReferenceException from the Test-AzureResourceGroup cmdlet, you have forgotten to log on to Azure (`Add-AzureRmAccount`).</span></span>
> 
> 

<span data-ttu-id="6c3fb-183">Se viene restituito un errore dell'esecuzione dello script e si stabilisce che l'errore è stato causato da un valore di parametro del modello errato, correggere il file dei parametri ed eseguire di nuovo lo script con il nome di un gruppo di risorse diverso.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-183">If you get an error from running the script and you determine that the error was caused by a wrong template parameter value, correct the parameter file and run the script again with a different resource group name.</span></span> <span data-ttu-id="6c3fb-184">È anche possibile riusare lo stesso nome di gruppo di risorse e fare in modo che lo script elimini quello precedente aggiungendo il parametro `-RemoveExistingResourceGroup` alla chiamata dello script.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-184">You can also reuse the same resource group name and have the script clean up the old one by adding the `-RemoveExistingResourceGroup` parameter to the script invocation.</span></span>

### <a name="result-of-running-the-createelasticsearchcluster-script"></a><span data-ttu-id="6c3fb-185">Risultato dell'esecuzione dello script CreateElasticSearchCluster</span><span class="sxs-lookup"><span data-stu-id="6c3fb-185">Result of running the CreateElasticSearchCluster script</span></span>
<span data-ttu-id="6c3fb-186">Dopo aver eseguito lo script `CreateElasticSearchCluster` verranno creati gli elementi principali seguenti.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-186">After you run the `CreateElasticSearchCluster` script, the following main artifacts will be created.</span></span> <span data-ttu-id="6c3fb-187">In questo esempio si suppone che sia stato usato "myBigCluster" come valore del parametro `dnsNameForLoadBalancerIP` e che l'area in cui è stato creato il cluster sia Stati Uniti occidentali.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-187">For this example we assume that you have used "myBigCluster" as the value of the `dnsNameForLoadBalancerIP` parameter and that the region where you created the cluster is West US.</span></span>

| <span data-ttu-id="6c3fb-188">Elemento</span><span class="sxs-lookup"><span data-stu-id="6c3fb-188">Artifact</span></span> | <span data-ttu-id="6c3fb-189">Nome, percorso e note</span><span class="sxs-lookup"><span data-stu-id="6c3fb-189">Name, location, and remarks</span></span> |
| --- | --- |
| <span data-ttu-id="6c3fb-190">Chiave SSH per l'amministrazione remota</span><span class="sxs-lookup"><span data-stu-id="6c3fb-190">SSH key for remote administration</span></span> |<span data-ttu-id="6c3fb-191">File myBigCluster.key, nella directory da cui è stato eseguito CreateElasticSearchCluster.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-191">myBigCluster.key file (in the directory from which the CreateElasticSearchCluster was run).</span></span> <br /><br /><span data-ttu-id="6c3fb-192">Questo file di chiave può essere usato per connettersi al nodo amministratore e, tramite questo nodo, ai nodi dati del cluster.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-192">This key file can be used to connect to the admin node and (through the admin node) to data nodes in the cluster.</span></span> |
| <span data-ttu-id="6c3fb-193">Nodo amministratore</span><span class="sxs-lookup"><span data-stu-id="6c3fb-193">Admin node</span></span> |<span data-ttu-id="6c3fb-194">myBigCluster admin.westus.cloudapp.azure.com </span><span class="sxs-lookup"><span data-stu-id="6c3fb-194">myBigCluster-admin.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="6c3fb-195">VM dedicata per l'amministrazione remota del cluster Elasticsearch, l'unica che consenta connessioni SSH esterne.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-195">A dedicated VM for remote Elasticsearch cluster administration--the only one that allows external SSH connections.</span></span> <span data-ttu-id="6c3fb-196">Viene eseguita nella stessa rete virtuale di tutti i nodi del cluster Elasticsearch, ma non esegue servizi Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-196">It runs on the same virtual network as all the Elasticsearch cluster nodes, but it does not run any Elasticsearch services.</span></span> |
| <span data-ttu-id="6c3fb-197">Nodi dati</span><span class="sxs-lookup"><span data-stu-id="6c3fb-197">Data nodes</span></span> |<span data-ttu-id="6c3fb-198">myBigCluster1 …</span><span class="sxs-lookup"><span data-stu-id="6c3fb-198">myBigCluster1 …</span></span> <span data-ttu-id="6c3fb-199">myBigCluster*N*</span><span class="sxs-lookup"><span data-stu-id="6c3fb-199">myBigCluster*N*</span></span> <br /><br /><span data-ttu-id="6c3fb-200">Nodi di dati che eseguono servizi Elasticsearch e Kibana.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-200">Data nodes that are running Elasticsearch and Kibana services.</span></span> <span data-ttu-id="6c3fb-201">È possibile connettersi tramite SSH a ogni nodo, ma solo tramite il nodo amministratore.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-201">You can connect via SSH to each node, but only via the admin node.</span></span> |
| <span data-ttu-id="6c3fb-202">Cluster Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="6c3fb-202">Elasticsearch cluster</span></span> |<span data-ttu-id="6c3fb-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span><span class="sxs-lookup"><span data-stu-id="6c3fb-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span></span> <br /><br /><span data-ttu-id="6c3fb-204">Endpoint primario per il cluster Elasticsearch (si noti il suffisso /es).</span><span class="sxs-lookup"><span data-stu-id="6c3fb-204">The primary endpoint for the Elasticsearch cluster (note the /es suffix).</span></span> <span data-ttu-id="6c3fb-205">È protetto mediante l'autenticazione HTTP di base. Le credenziali sono i parametri esUserName/esPassword del modello ES-MultiNode precedentemente specificati.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-205">It is protected by basic HTTP authentication (the credentials were the specified esUserName/esPassword parameters of the ES-MultiNode template).</span></span> <span data-ttu-id="6c3fb-206">Il cluster ha anche installato il plug-in head (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) per l'amministrazione del cluster di base.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-206">The cluster has also the head plug-in installed (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) for basic cluster administration.</span></span> |
| <span data-ttu-id="6c3fb-207">Servizio Kibana</span><span class="sxs-lookup"><span data-stu-id="6c3fb-207">Kibana service</span></span> |<span data-ttu-id="6c3fb-208">http://myBigCluster.westus.cloudapp.azure.com</span><span class="sxs-lookup"><span data-stu-id="6c3fb-208">http://myBigCluster.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="6c3fb-209">Il servizio Kibana è configurato per visualizzare i dati del cluster Elasticsearch creato.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-209">The Kibana service is set up to show data from the created Elasticsearch cluster.</span></span> <span data-ttu-id="6c3fb-210">È protetto con le stesse credenziali di autenticazione del cluster stesso.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-210">It is protected by the same authentication credentials as the cluster itself.</span></span> |

## <a name="in-process-versus-out-of-process-trace-capturing"></a><span data-ttu-id="6c3fb-211">Acquisizione di tracce in-process e out-of-process</span><span class="sxs-lookup"><span data-stu-id="6c3fb-211">In-process versus out-of-process trace capturing</span></span>
<span data-ttu-id="6c3fb-212">Nell'introduzione sono state citate le due principali modalità di raccolta dei dati di diagnostica: in-process e out-of-process.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-212">In the introduction, we mentioned two fundamental ways of collecting diagnostic data: in-process and out-of-process.</span></span> <span data-ttu-id="6c3fb-213">Ognuna presenta vantaggi e svantaggi.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-213">Each has strengths and weaknesses.</span></span>

<span data-ttu-id="6c3fb-214">I vantaggi dell' **acquisizione di tracce in-process** includono:</span><span class="sxs-lookup"><span data-stu-id="6c3fb-214">Advantages of the **in-process trace capturing** include:</span></span>

1. <span data-ttu-id="6c3fb-215">*Facilità di configurazione e distribuzione*</span><span class="sxs-lookup"><span data-stu-id="6c3fb-215">*Easy configuration and deployment*</span></span>
   
   * <span data-ttu-id="6c3fb-216">La configurazione della modalità di raccolta dei dati di diagnostica è solo una parte del processo di configurazione dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="6c3fb-216">The configuration of diagnostic data collection is just part of the application configuration.</span></span> <span data-ttu-id="6c3fb-217">ed è facile mantenerla sempre "sincronizzata" con il resto dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-217">It is easy to always keep it "in sync" with the rest of the application.</span></span>
   * <span data-ttu-id="6c3fb-218">È facile ottenere la configurazione per ogni applicazione o servizio.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-218">Per-application or per-service configuration is easily achievable.</span></span>
   * <span data-ttu-id="6c3fb-219">L'acquisizione di tracce out-of-process richiede in genere una distribuzione separata e la configurazione dell'agente di diagnostica, che costituisce un'attività amministrativa aggiuntiva e, quindi, una potenziale fonte di errori.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-219">Out-of-process trace capturing usually requires a separate deployment and configuration of the diagnostic agent, which is an extra administrative task and a potential source of errors.</span></span> <span data-ttu-id="6c3fb-220">Nella maggior parte dei casi, la tecnologia specifica dell'agente consente una sola istanza dell'agente per ogni macchina virtuale (nodo).</span><span class="sxs-lookup"><span data-stu-id="6c3fb-220">The particular agent technology often allows only one instance of the agent per virtual machine (node).</span></span> <span data-ttu-id="6c3fb-221">In questo modo, la configurazione relativa alla raccolta dei dati di diagnostica viene condivisa tra tutte le applicazioni e i servizi in esecuzione sul nodo.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-221">This means that configuration for the collection of the diagnostic configuration is shared among all applications and services running on that node.</span></span>
2. <span data-ttu-id="6c3fb-222">*Flessibilità*</span><span class="sxs-lookup"><span data-stu-id="6c3fb-222">*Flexibility*</span></span>
   
   * <span data-ttu-id="6c3fb-223">L'applicazione può inviare i dati ogni volta che è necessario, purché sia disponibile una libreria client che supporta il sistema di archiviazione dati di destinazione.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-223">The application can send the data wherever it needs to go, as long as there is a client library that supports the targeted data storage system.</span></span> <span data-ttu-id="6c3fb-224">Nuovi sink possono essere aggiunti secondo le esigenze.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-224">New sinks can be added as desired.</span></span>
   * <span data-ttu-id="6c3fb-225">È possibile implementare complesse regole di acquisizione, filtro e aggregazione dati.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-225">Complex capture, filtering, and data-aggregation rules can be implemented.</span></span>
   * <span data-ttu-id="6c3fb-226">L'acquisizione di tracce out-of-process è spesso limitata dai sink di dati supportati dall'agente.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-226">An out-of-process trace capturing is often limited by the data sinks that the agent supports.</span></span> <span data-ttu-id="6c3fb-227">Alcuni agenti sono estendibili.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-227">Some agents are extensible.</span></span>
3. <span data-ttu-id="6c3fb-228">*Accesso al contesto e ai dati di applicazione interni*</span><span class="sxs-lookup"><span data-stu-id="6c3fb-228">*Access to internal application data and context*</span></span>
   
   * <span data-ttu-id="6c3fb-229">Il sottosistema di diagnostica in esecuzione nel processo dell'applicazione o del servizio può facilmente aumentare le tracce con informazioni contestuali.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-229">The diagnostic subsystem running inside the application/service process can easily augment the traces with contextual information.</span></span>
   * <span data-ttu-id="6c3fb-230">Nell'approccio out-of-process i dati devono essere inviati a un agente tramite un meccanismo di comunicazione interprocesso, ad esempio Event Tracing for Windows (ETW).</span><span class="sxs-lookup"><span data-stu-id="6c3fb-230">In the out-of-process approach, the data must be sent to an agent via some inter-process communication mechanism, such as Event Tracing for Windows.</span></span> <span data-ttu-id="6c3fb-231">Questo meccanismo può imporre limitazioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-231">This mechanism could impose additional limitations.</span></span>

<span data-ttu-id="6c3fb-232">I vantaggi dell' **acquisizione di tracce out-of-process** includono:</span><span class="sxs-lookup"><span data-stu-id="6c3fb-232">Advantages of the **out-of-process trace capturing** include:</span></span>

1. <span data-ttu-id="6c3fb-233">*Possibilità di monitorare l'applicazione e raccogliere dump di arresto anomalo del sistema*</span><span class="sxs-lookup"><span data-stu-id="6c3fb-233">*The ability to monitor the application and collect crash dumps*</span></span>
   
   * <span data-ttu-id="6c3fb-234">L'acquisizione di tracce in-process può non riuscire se l'applicazione si avvia o si arresta in modo anomalo.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-234">In-process trace capturing may be unsuccessful if the application fails to start or crashes.</span></span> <span data-ttu-id="6c3fb-235">Un agente indipendente ha maggiori possibilità di acquisire informazioni cruciali sulla risoluzione dei problemi.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-235">An independent agent has a much better chance of capturing crucial troubleshooting information.</span></span><br /><br />
2. <span data-ttu-id="6c3fb-236">*Maturità, affidabilità e prestazioni comprovate*</span><span class="sxs-lookup"><span data-stu-id="6c3fb-236">*Maturity, robustness, and proven performance*</span></span>
   
   * <span data-ttu-id="6c3fb-237">Un agente sviluppato da un fornitore di piattaforme, ad esempio l'agente Diagnostica di Microsoft Azure, viene sottoposto a test rigorosi e avanzate misure di protezione.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-237">An agent developed by a platform vendor (such as a Microsoft Azure Diagnostics agent) has been subject to rigorous testing and battle-hardening.</span></span>
   * <span data-ttu-id="6c3fb-238">Con l'acquisizione di tracce in-process, è necessario prestare attenzione per assicurarsi che l'attività di invio dei dati di diagnostica da parte di un processo dell'applicazione non interferisca con le attività principali dell'applicazione e non introduca problemi di temporizzazione o prestazioni.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-238">With in-process trace capturing, care must be taken to ensure that the activity of sending diagnostic data from an application process does not interfere with the application's main tasks or introduce timing or performance problems.</span></span> <span data-ttu-id="6c3fb-239">Un agente indipendente in esecuzione è meno soggetto a questi problemi ed è progettato appositamente per limitare l'impatto sul sistema.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-239">An independently running agent is less prone to these issues and is specifically designed to limit its impact on the system.</span></span>

<span data-ttu-id="6c3fb-240">È possibile combinare e trarre vantaggio da entrambi gli approcci.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-240">It is possible to combine and benefit from both approaches.</span></span> <span data-ttu-id="6c3fb-241">In realtà, potrebbe essere la soluzione migliore per molte applicazioni.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-241">Indeed, it might be the best solution for many applications.</span></span>

<span data-ttu-id="6c3fb-242">In questo caso viene usata la **libreria Microsoft.Diagnostic.Listeners** e l'acquisizione di tracce in-process per l'invio di dati da un'applicazione di Service Fabric a un cluster Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-242">Here, we use the **Microsoft.Diagnostic.Listeners library** and the in-process trace capturing to send data from a Service Fabric application to an Elasticsearch cluster.</span></span>

## <a name="use-the-listeners-library-to-send-diagnostic-data-to-elasticsearch"></a><span data-ttu-id="6c3fb-243">Usare la libreria Listeners per inviare dati di diagnostica a ElasticSearch</span><span class="sxs-lookup"><span data-stu-id="6c3fb-243">Use the Listeners library to send diagnostic data to Elasticsearch</span></span>
<span data-ttu-id="6c3fb-244">La libreria Microsoft.Diagnostic.Listeners fa parte dell'applicazione di Service Fabric di esempio PartyCluster.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-244">The Microsoft.Diagnostic.Listeners library is part of PartyCluster sample Service Fabric application.</span></span> <span data-ttu-id="6c3fb-245">Per usarla:</span><span class="sxs-lookup"><span data-stu-id="6c3fb-245">To use it:</span></span>

1. <span data-ttu-id="6c3fb-246">Scaricare l' [esempio di Party Cluster](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) da GitHub.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-246">Download [the PartyCluster sample](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) from GitHub.</span></span>
2. <span data-ttu-id="6c3fb-247">Copiare i progetti Microsoft.Diagnostics.Listeners e Microsoft.Diagnostics.Listeners.Fabric (le cartelle intere) dalla directory di esempio PartyCluster alla cartella della soluzione relativa all'applicazione che dovrà inviare i dati a ElasticSearch.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-247">Copy the Microsoft.Diagnostics.Listeners and Microsoft.Diagnostics.Listeners.Fabric projects (whole folders) from the PartyCluster sample directory to the solution folder of the application that is supposed to send the data to Elasticsearch.</span></span>
3. <span data-ttu-id="6c3fb-248">Aprire la soluzione di destinazione, fare clic con il pulsante destro del mouse sul nodo della soluzione in Esplora soluzioni e scegliere **Aggiungi progetto esistente**.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-248">Open the target solution, right-click the solution node in the Solution Explorer, and choose **Add Existing Project**.</span></span> <span data-ttu-id="6c3fb-249">Aggiungere il progetto Microsoft.Diagnostics.Listeners alla soluzione.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-249">Add the Microsoft.Diagnostics.Listeners project to the solution.</span></span> <span data-ttu-id="6c3fb-250">Ripetere lo stesso passaggio per il progetto Microsoft.Diagnostics.Listeners.Fabric.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-250">Repeat the same for the Microsoft.Diagnostics.Listeners.Fabric project.</span></span>
4. <span data-ttu-id="6c3fb-251">Aggiungere un riferimento dai progetti di servizio ai due progetti aggiunti:</span><span class="sxs-lookup"><span data-stu-id="6c3fb-251">Add a project reference from your service project(s) to the two added projects.</span></span> <span data-ttu-id="6c3fb-252">ogni servizio che dovrà inviare dati a ElasticSearch deve fare riferimento a Microsoft.Diagnostics.EventListeners e Microsoft.Diagnostics.EventListeners.Fabric.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-252">(Each service that is supposed to send data to Elasticsearch should reference Microsoft.Diagnostics.EventListeners and Microsoft.Diagnostics.EventListeners.Fabric).</span></span>
   
    ![Riferimenti di progetto alle librerie Microsoft.Diagnostics.EventListeners e Microsoft.Diagnostics.EventListeners.Fabric][1]

### <a name="service-fabric-general-availability-release-and-microsoftdiagnosticstracing-nuget-package"></a><span data-ttu-id="6c3fb-254">Versione di disponibilità generale di Service Fabric e pacchetto NuGet Microsoft.Diagnostics.Tracing</span><span class="sxs-lookup"><span data-stu-id="6c3fb-254">Service Fabric General Availability release and Microsoft.Diagnostics.Tracing Nuget package</span></span>
<span data-ttu-id="6c3fb-255">Il framework di destinazione delle applicazioni compilate con la versione di disponibilità generale di Service Fabric (2.0.135, rilasciata il 31 marzo 2016) è **.NET Framework 4.5.2**.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-255">Applications built with Service Fabric General Availability release (2.0.135, released March 31, 2016) target **.NET Framework 4.5.2**.</span></span> <span data-ttu-id="6c3fb-256">Questa è la versione più recente di .NET Framework supportata da Azure al momento del rilascio della versione di disponibilità generale.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-256">This version is the highest version of the .NET Framework supported by Azure at the time of the GA release.</span></span> <span data-ttu-id="6c3fb-257">Questa versione del framework, purtroppo, non include alcune API EventListener richieste dalla libreria Microsoft.Diagnostics.Listeners.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-257">Unfortunately, this version of the framework lacks certain EventListener APIs that the Microsoft.Diagnostics.Listeners library needs.</span></span> <span data-ttu-id="6c3fb-258">Poiché EventSource, il componente di base per la registrazione delle API in applicazioni di Service Fabric, ed EventListener sono strettamente collegati, ogni progetto che usa la libreria Microsoft.Diagnostics.Listeners deve usare anche un'implementazione alternativa di EventSource,</span><span class="sxs-lookup"><span data-stu-id="6c3fb-258">Because EventSource (the component that forms the basis of logging APIs in Fabric applications) and EventListener are tightly coupled, every project that uses the Microsoft.Diagnostics.Listeners library must use an alternative implementation of EventSource.</span></span> <span data-ttu-id="6c3fb-259">inclusa nel **pacchetto NuGet Microsoft.Diagnostics.Tracing** creato da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-259">This implementation is provided by the **Microsoft.Diagnostics.Tracing Nuget package**, authored by Microsoft.</span></span> <span data-ttu-id="6c3fb-260">Questo pacchetto è totalmente compatibile con la versione di EventSource inclusa nel framework e quindi non dovrebbero essere necessarie modifiche al codice oltre a quelle riguardanti lo spazio dei nomi a cui viene fatto riferimento.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-260">The package is fully backward-compatible with EventSource included in the framework, so no code changes should be necessary other than referenced namespace changes.</span></span>

<span data-ttu-id="6c3fb-261">Per iniziare a usare l'implementazione Microsoft.Diagnostics.Tracing della classe EventSource, seguire questi passaggi per ogni progetto di servizio che deve inviare dati a ElasticSearch:</span><span class="sxs-lookup"><span data-stu-id="6c3fb-261">To start using the Microsoft.Diagnostics.Tracing implementation of the EventSource class, follow these steps for each service project that needs to send data to Elasticsearch:</span></span>

1. <span data-ttu-id="6c3fb-262">Fare clic con il pulsante destro del mouse sul progetto di servizio e scegliere **Gestisci pacchetti NuGet**.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-262">Right-click on the service project and choose **Manage Nuget Packages**.</span></span>
2. <span data-ttu-id="6c3fb-263">Passare all'origine del pacchetto nuget.org, se non è già selezionato, e cercare "**Microsoft.Diagnostics.Tracing**".</span><span class="sxs-lookup"><span data-stu-id="6c3fb-263">Switch to the nuget.org package source (if it is not already selected) and search for "**Microsoft.Diagnostics.Tracing**".</span></span>
3. <span data-ttu-id="6c3fb-264">Installare il pacchetto `Microsoft.Diagnostics.Tracing.EventSource` e le relative dipendenze.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-264">Install the `Microsoft.Diagnostics.Tracing.EventSource` package (and its dependencies).</span></span>
4. <span data-ttu-id="6c3fb-265">Aprire il file **ServiceEventSource.cs** o **ActorEventSource.cs** nel progetto di servizio e sostituire la direttiva `using System.Diagnostics.Tracing` all'inizio del file con la direttiva `using Microsoft.Diagnostics.Tracing`.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-265">Open the **ServiceEventSource.cs** or **ActorEventSource.cs** file in your service project and replace the `using System.Diagnostics.Tracing` directive on top of the file with the `using Microsoft.Diagnostics.Tracing` directive.</span></span>

<span data-ttu-id="6c3fb-266">Questi passaggi non saranno più necessari quando **.NET Framework 4.6** sarà supportato da Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-266">These steps will not be necessary once the **.NET Framework 4.6** is supported by Microsoft Azure.</span></span>

### <a name="elasticsearch-listener-instantiation-and-configuration"></a><span data-ttu-id="6c3fb-267">Creazione dell'istanza e configurazione del listener ElasticSearch</span><span class="sxs-lookup"><span data-stu-id="6c3fb-267">Elasticsearch listener instantiation and configuration</span></span>
<span data-ttu-id="6c3fb-268">Il passaggio finale per l'invio dei dati di diagnostica a Elasticsearch consiste nel creare un'istanza di `ElasticSearchListener` e configurarla con i dati di connessione a Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-268">The final step for sending diagnostic data to Elasticsearch is to create an instance of `ElasticSearchListener` and configure it with Elasticsearch connection data.</span></span> <span data-ttu-id="6c3fb-269">Il listener acquisisce automaticamente tutti gli eventi generati tramite le classi EventSource definite nel progetto di servizio.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-269">The listener automatically captures all events raised via EventSource classes defined in the service project.</span></span> <span data-ttu-id="6c3fb-270">Deve essere attivo nel corso della durata del servizio, quindi la posizione migliore in cui crearlo è il codice di inizializzazione del servizio.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-270">It needs to be alive during the lifetime of the service, so the best place to create it is in the service initialization code.</span></span> <span data-ttu-id="6c3fb-271">Ecco come può apparire il codice di inizializzazione per un servizio senza stato dopo le modifiche necessarie. Le aggiunte sono evidenziate nei commenti a partire da `****`:</span><span class="sxs-lookup"><span data-stu-id="6c3fb-271">Here is how the initialization code for a stateless service could look after the necessary changes (additions pointed out in comments starting with `****`):</span></span>

```csharp
using System;
using System.Diagnostics;
using System.Fabric;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.ServiceFabric.Services.Runtime;

// **** Add the following directives
using Microsoft.Diagnostics.EventListeners;
using Microsoft.Diagnostics.EventListeners.Fabric;

namespace Stateless1
{
    internal static class Program
    {
        /// <summary>
        /// This is the entry point of the service host process.
        /// </summary>        
        private static void Main()
        {
            try
            {
                // **** Instantiate ElasticSearchListener
                var configProvider = new FabricConfigurationProvider("ElasticSearchEventListener");
                ElasticSearchListener esListener = null;
                if (configProvider.HasConfiguration)
                {
                    esListener = new ElasticSearchListener(configProvider, new FabricHealthReporter("ElasticSearchEventListener"));
                }

                // The ServiceManifest.XML file defines one or more service type names.
                // Registering a service maps a service type name to a .NET type.
                // When Service Fabric creates an instance of this service type,
                // an instance of the class is created in this host process.

                ServiceRuntime.RegisterServiceAsync("Stateless1Type", 
                    context => new Stateless1(context)).GetAwaiter().GetResult();

                ServiceEventSource.Current.ServiceTypeRegistered(Process.GetCurrentProcess().Id, typeof(Stateless1).Name);

                // Prevents this host process from terminating so services keep running.
                Thread.Sleep(Timeout.Infinite);

                // **** Ensure that the ElasticSearchListner instance is not garbage-collected prematurely
                GC.KeepAlive(esListener);
            }
            catch (Exception e)
            {
                ServiceEventSource.Current.ServiceHostInitializationFailed(e);
                throw;
            }
        }
    }
}
```

<span data-ttu-id="6c3fb-272">I dati di connessione di Elasticsearch devono essere inseriti in una sezione separata nel file cscfg (**PackageRoot\Config\Settings.xml**).</span><span class="sxs-lookup"><span data-stu-id="6c3fb-272">Elasticsearch connection data should be put in a separate section in the service configuration file (**PackageRoot\Config\Settings.xml**).</span></span> <span data-ttu-id="6c3fb-273">Il nome della sezione deve corrispondere al valore passato al costruttore `FabricConfigurationProvider` , ad esempio:</span><span class="sxs-lookup"><span data-stu-id="6c3fb-273">The name of the section must correspond to the value passed to the `FabricConfigurationProvider` constructor, for example:</span></span>

```xml
<Section Name="ElasticSearchEventListener">
  <Parameter Name="serviceUri" Value="http://myBigCluster.westus.cloudapp.azure.com/es/" />
  <Parameter Name="userName" Value="(ES user name)" />
  <Parameter Name="password" Value="(ES user password)" />
  <Parameter Name="indexNamePrefix" Value="myapp" />
</Section>
```
<span data-ttu-id="6c3fb-274">I valori dei parametri `serviceUri`, `userName` e `password` corrispondono rispettivamente all'indirizzo dell'endpoint cluster Elasticsearch, al nome utente e alla password Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-274">The values of `serviceUri`, `userName` and `password` parameters correspond to the Elasticsearch cluster endpoint address, Elasticsearch user name, and password, respectively.</span></span> <span data-ttu-id="6c3fb-275">`indexNamePrefix` è il prefisso per gli indici di Elasticsearch; la libreria Microsoft.Diagnostics.Listeners crea quotidianamente un nuovo indice per i propri dati.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-275">`indexNamePrefix` is the prefix for Elasticsearch indexes; the Microsoft.Diagnostics.Listeners library creates a new index for its data daily.</span></span>

### <a name="verification"></a><span data-ttu-id="6c3fb-276">Verifica</span><span class="sxs-lookup"><span data-stu-id="6c3fb-276">Verification</span></span>
<span data-ttu-id="6c3fb-277">L'operazione è terminata.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-277">That's it!</span></span> <span data-ttu-id="6c3fb-278">A questo punto, ogni volta che il servizio viene eseguito, inizia a inviare tracce al servizio Elasticsearch specificato nella configurazione.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-278">Now, whenever the service is run, it starts sending traces to the Elasticsearch service specified in the configuration.</span></span> <span data-ttu-id="6c3fb-279">È possibile verificare questo aprendo la UI Kibana associata all'istanza di Elasticsearch di destinazione.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-279">You can verify this by opening the Kibana UI associated with the target Elasticsearch instance.</span></span> <span data-ttu-id="6c3fb-280">In questo esempio l'indirizzo della pagina è http://myBigCluster.westus.cloudapp.azure.com/.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-280">In our example, the page address is http://myBigCluster.westus.cloudapp.azure.com/.</span></span> <span data-ttu-id="6c3fb-281">Verificare che gli indici con il prefisso del nome scelto per l' `ElasticSearchListener` istanza siano stati effettivamente creati e popolati con i dati.</span><span class="sxs-lookup"><span data-stu-id="6c3fb-281">Check that indexes with the name prefix chosen for the `ElasticSearchListener` instance have indeed been created and populated with data.</span></span>

![Eventi di Kibana che mostrano l'applicazione PartyCluster][2]

## <a name="next-steps"></a><span data-ttu-id="6c3fb-283">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="6c3fb-283">Next steps</span></span>
* [<span data-ttu-id="6c3fb-284">Altre informazioni sulla diagnostica e il monitoraggio di un servizio di infrastruttura di servizi</span><span class="sxs-lookup"><span data-stu-id="6c3fb-284">Learn more about diagnosing and monitoring a Service Fabric service</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

<!--Image references-->
[1]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/listener-lib-references.png
[2]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/kibana.png
