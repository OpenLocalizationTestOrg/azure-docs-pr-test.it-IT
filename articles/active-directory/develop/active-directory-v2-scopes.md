---
title: Ambiti, autorizzazioni e consenso in Azure Active Directory v2.0 | Documentazione Microsoft
description: Descrizione dell'autorizzazione nell'endpoint v2.0 di Azure AD, inclusi gli ambiti, le autorizzazioni e il consenso.
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 8f98cbf0-a71d-4e34-babf-e644ad9ff423
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/07/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 04869a7627ecb3e6a0d11733fae7da2ecb04ed51
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="scopes-permissions-and-consent-in-the-azure-active-directory-v20-endpoint"></a><span data-ttu-id="f9328-103">Ambiti, autorizzazioni e consenso nell'endpoint di Azure Active Directory v2.0</span><span class="sxs-lookup"><span data-stu-id="f9328-103">Scopes, permissions, and consent in the Azure Active Directory v2.0 endpoint</span></span>
<span data-ttu-id="f9328-104">Le app che si integrano con Azure Active Directory (Azure AD) seguono un modello di autorizzazione che consente agli utenti di controllare la modalità di accesso ai dati da parte di un'app.</span><span class="sxs-lookup"><span data-stu-id="f9328-104">Apps that integrate with Azure Active Directory (Azure AD) follow an authorization model that gives users control over how an app can access their data.</span></span> <span data-ttu-id="f9328-105">L'implementazione v2.0 di questo modello di autorizzazione è stata aggiornata, modificando la modalità di interazione di un'app con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f9328-105">The v2.0 implementation of the authorization model has been updated, and it changes how an app must interact with Azure AD.</span></span> <span data-ttu-id="f9328-106">Questo articolo illustra i concetti di base di questo modello di autorizzazione, inclusi gli ambiti, le autorizzazioni e il consenso.</span><span class="sxs-lookup"><span data-stu-id="f9328-106">This article covers the basic concepts of this authorization model, including scopes, permissions, and consent.</span></span>

> [!NOTE]
> <span data-ttu-id="f9328-107">Non tutti gli scenari e le funzionalità di Azure Active Directory sono supportati dall'endpoint v2.0.</span><span class="sxs-lookup"><span data-stu-id="f9328-107">The v2.0 endpoint does not support all Azure Active Directory scenarios and features.</span></span> <span data-ttu-id="f9328-108">Per determinare se è necessario usare l'endpoint 2.0, vedere l'articolo relativo alle [limitazioni della versione 2.0](active-directory-v2-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="f9328-108">To determine whether you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>
>
>

## <a name="scopes-and-permissions"></a><span data-ttu-id="f9328-109">Ambiti e autorizzazioni</span><span class="sxs-lookup"><span data-stu-id="f9328-109">Scopes and permissions</span></span>
<span data-ttu-id="f9328-110">Azure AD implementa il protocollo di autorizzazione [OAuth 2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="f9328-110">Azure AD implements the [OAuth 2.0](active-directory-v2-protocols.md) authorization protocol.</span></span> <span data-ttu-id="f9328-111">OAuth 2.0 è un metodo tramite cui un'applicazione di terze parti può accedere alle risorse ospitate sul Web per conto dell'utente.</span><span class="sxs-lookup"><span data-stu-id="f9328-111">OAuth 2.0 is a method through which a third-party app can access web-hosted resources on behalf of a user.</span></span> <span data-ttu-id="f9328-112">Qualsiasi risorsa ospitata sul Web che si integra con Azure AD dispoen di un identificatore di risorsa o di un *URI ID dell'applicazione*.</span><span class="sxs-lookup"><span data-stu-id="f9328-112">Any web-hosted resource that integrates with Azure AD has a resource identifier, or *Application ID URI*.</span></span> <span data-ttu-id="f9328-113">Ad esempio, alcune delle risorse ospitate sul Web di Microsoft includono:</span><span class="sxs-lookup"><span data-stu-id="f9328-113">For example, some of Microsoft's web-hosted resources include:</span></span>

* <span data-ttu-id="f9328-114">L'API di posta unificata di Office 365: `https://outlook.office.com`</span><span class="sxs-lookup"><span data-stu-id="f9328-114">The Office 365 Unified Mail API: `https://outlook.office.com`</span></span>
* <span data-ttu-id="f9328-115">L'API Graph di Azure AD: `https://graph.windows.net`</span><span class="sxs-lookup"><span data-stu-id="f9328-115">The Azure AD Graph API: `https://graph.windows.net`</span></span>
* <span data-ttu-id="f9328-116">Microsoft Graph: `https://graph.microsoft.com`</span><span class="sxs-lookup"><span data-stu-id="f9328-116">Microsoft Graph: `https://graph.microsoft.com`</span></span>

<span data-ttu-id="f9328-117">Anche le risorse di terze parti integrate con Azure AD devono disporre di tale identificatore.</span><span class="sxs-lookup"><span data-stu-id="f9328-117">The same is true for any third-party resources that have integrated with Azure AD.</span></span> <span data-ttu-id="f9328-118">Tali risorse possono anche definire un set di autorizzazioni che può essere usato per suddividere le funzionalità di tale risorsa in blocchi più piccoli.</span><span class="sxs-lookup"><span data-stu-id="f9328-118">Any of these resources also can define a set of permissions that can be used to divide the functionality of that resource into smaller chunks.</span></span> <span data-ttu-id="f9328-119">Ad esempio, [Microsoft Graph](https://graph.microsoft.io) ha definito le autorizzazioni per eseguire le attività seguenti, tra le altre:</span><span class="sxs-lookup"><span data-stu-id="f9328-119">As an example, [Microsoft Graph](https://graph.microsoft.io) has defined permissions to do the following tasks, among others:</span></span>

* <span data-ttu-id="f9328-120">Lettura del calendario dell'utente</span><span class="sxs-lookup"><span data-stu-id="f9328-120">Read a user's calendar</span></span>
* <span data-ttu-id="f9328-121">Scrittura nel calendario dell'utente</span><span class="sxs-lookup"><span data-stu-id="f9328-121">Write to a user's calendar</span></span>
* <span data-ttu-id="f9328-122">Invio di messaggi di posta elettronica come utente</span><span class="sxs-lookup"><span data-stu-id="f9328-122">Send mail as a user</span></span>

<span data-ttu-id="f9328-123">Con la definizione di questi tipi di autorizzazioni, la risorsa può avere un controllo accurato dei dati e dell'esposizione degli stessi.</span><span class="sxs-lookup"><span data-stu-id="f9328-123">By defining these types of permissions, the resource has fine-grained control over its data and how the data is exposed.</span></span> <span data-ttu-id="f9328-124">Un'app di terze parti può richiedere tali autorizzazioni da un utente del'app.</span><span class="sxs-lookup"><span data-stu-id="f9328-124">A third-party app can request these permissions from an app user.</span></span> <span data-ttu-id="f9328-125">L'utente dell'app deve approvare le autorizzazioni prima che l'applicazione possa agire a suo nome.</span><span class="sxs-lookup"><span data-stu-id="f9328-125">The app user must approve the permissions before the app can act on the user's behalf.</span></span> <span data-ttu-id="f9328-126">Suddividendo le funzionalità della risorsa in set di autorizzazioni più piccoli, è possibile creare le app di terze parti affinché richiedano solo le autorizzazioni specifiche necessarie per il relativo funzionamento.</span><span class="sxs-lookup"><span data-stu-id="f9328-126">By chunking the resource's functionality into smaller permission sets, third-party apps can be built to request only the specific permissions that they need to perform their function.</span></span> <span data-ttu-id="f9328-127">Gli utenti dell'app possono sapere esattamente come un'app userà i propri dati e possono essere più sicuri che l'app non agisca per fini dannosi.</span><span class="sxs-lookup"><span data-stu-id="f9328-127">App users can know exactly how an app will use their data, and they can be more confident that the app is not behaving with malicious intent.</span></span>

<span data-ttu-id="f9328-128">In Azure AD e OAuth queste autorizzazioni vengono definite *ambiti* o</span><span class="sxs-lookup"><span data-stu-id="f9328-128">In Azure AD and OAuth, these types of permissions are called *scopes*.</span></span> <span data-ttu-id="f9328-129">*oAuth2Permissions*.</span><span class="sxs-lookup"><span data-stu-id="f9328-129">They also sometimes are referred to as *oAuth2Permissions*.</span></span> <span data-ttu-id="f9328-130">Un ambito è rappresentato in Azure AD come valore stringa.</span><span class="sxs-lookup"><span data-stu-id="f9328-130">A scope is represented in Azure AD as a string value.</span></span> <span data-ttu-id="f9328-131">Nell'esempio relativo a Microsoft Graph il valore di ambito per ogni autorizzazione è:</span><span class="sxs-lookup"><span data-stu-id="f9328-131">Continuing with the Microsoft Graph example, the scope value for each permission is:</span></span>

* <span data-ttu-id="f9328-132">Lettura del calendario dell'utente tramite `Calendar.Read`</span><span class="sxs-lookup"><span data-stu-id="f9328-132">Read a user's calendar by using `Calendar.Read`</span></span>
* <span data-ttu-id="f9328-133">Scrittura del calendario dell'utente tramite `Mail.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="f9328-133">Write to a user's calendar by using `Mail.ReadWrite`</span></span>
* <span data-ttu-id="f9328-134">Invio di messaggi di posta elettronica come utente tramite `Mail.Send`</span><span class="sxs-lookup"><span data-stu-id="f9328-134">Send mail as a user using by `Mail.Send`</span></span>

<span data-ttu-id="f9328-135">Un'app può richiedere tali autorizzazioni specificando gli ambiti nelle richieste all'endpoint 2.0.</span><span class="sxs-lookup"><span data-stu-id="f9328-135">An app can request these permissions by specifying the scopes in requests to the v2.0 endpoint.</span></span>

## <a name="openid-connect-scopes"></a><span data-ttu-id="f9328-136">Ambiti di OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="f9328-136">OpenID Connect scopes</span></span>
<span data-ttu-id="f9328-137">L'implementazione della versione 2.0 di OpenID Connect presenta alcuni ambiti ben definiti che non si applicano a una risorsa specifica: `openid`, `email`, `profile` e `offline_access`.</span><span class="sxs-lookup"><span data-stu-id="f9328-137">The v2.0 implementation of OpenID Connect has a few well-defined scopes that do not apply to a specific resource: `openid`, `email`, `profile`, and `offline_access`.</span></span>

### <a name="openid"></a><span data-ttu-id="f9328-138">openid</span><span class="sxs-lookup"><span data-stu-id="f9328-138">openid</span></span>
<span data-ttu-id="f9328-139">Se un'app esegue l'accesso usando [OpenID Connect](active-directory-v2-protocols.md), deve richiedere l'ambito `openid`.</span><span class="sxs-lookup"><span data-stu-id="f9328-139">If an app performs sign-in by using [OpenID Connect](active-directory-v2-protocols.md), it must request the `openid` scope.</span></span> <span data-ttu-id="f9328-140">L'ambito `openid` viene visualizzato nella pagina di consenso dell'account aziendale come autorizzazione di accesso e nella pagina di consenso dell'account personale Microsoft come autorizzazione per la visualizzazione del profilo e la connessione ad app e servizi tramite l'account Microsoft.</span><span class="sxs-lookup"><span data-stu-id="f9328-140">The `openid` scope shows on the work account consent page as the "Sign you in" permission, and on the personal Microsoft account consent page as the "View your profile and connect to apps and services using your Microsoft account" permission.</span></span> <span data-ttu-id="f9328-141">Questa autorizzazione consente a un'app di ricevere un identificatore univoco per l'utente sotto forma di attestazione `sub`</span><span class="sxs-lookup"><span data-stu-id="f9328-141">With this permission, an app can receive a unique identifier for the user in the form of the `sub` claim.</span></span> <span data-ttu-id="f9328-142">e concede all'app l'accesso all'endpoint delle informazioni utente.</span><span class="sxs-lookup"><span data-stu-id="f9328-142">It also gives the app access to the UserInfo endpoint.</span></span> <span data-ttu-id="f9328-143">L'ambito `openid` può essere usato nell'endpoint del token 2.0 per acquisire token ID, che possono essere usati per proteggere le chiamate HTTP tra diversi componenti di un'app.</span><span class="sxs-lookup"><span data-stu-id="f9328-143">The `openid` scope can be used at the v2.0 token endpoint to acquire ID tokens, which can be used to secure HTTP calls between different components of an app.</span></span>

### <a name="email"></a><span data-ttu-id="f9328-144">email</span><span class="sxs-lookup"><span data-stu-id="f9328-144">email</span></span>
<span data-ttu-id="f9328-145">L'ambito `email` può essere usato con l'ambito `openid` e con tutti gli altri.</span><span class="sxs-lookup"><span data-stu-id="f9328-145">The `email` scope can be used with the `openid` scope and any others.</span></span> <span data-ttu-id="f9328-146">Consente all'applicazione di accedere all'indirizzo di posta elettronica primario dell'utente sotto forma di attestazione `email`.</span><span class="sxs-lookup"><span data-stu-id="f9328-146">It gives the app access to the user's primary email address in the form of the `email` claim.</span></span> <span data-ttu-id="f9328-147">L'attestazione `email` è inclusa nei token solo quando un indirizzo di posta elettronica è associato all'account utente, condizione che non è sempre vera.</span><span class="sxs-lookup"><span data-stu-id="f9328-147">The `email` claim is included in a token only if an email address is associated with the user account, which is not always the case.</span></span> <span data-ttu-id="f9328-148">Se si usa l'ambito `email`, l'applicazione deve essere pronta per gestire il caso in cui l'attestazione `email` non esiste nel token.</span><span class="sxs-lookup"><span data-stu-id="f9328-148">If it uses the `email` scope, your app should be prepared to handle a case in which the `email` claim does not exist in the token.</span></span>

### <a name="profile"></a><span data-ttu-id="f9328-149">Profilo</span><span class="sxs-lookup"><span data-stu-id="f9328-149">profile</span></span>
<span data-ttu-id="f9328-150">L'ambito `profile` può essere usato con l'ambito `openid` e con tutti gli altri.</span><span class="sxs-lookup"><span data-stu-id="f9328-150">The `profile` scope can be used with the `openid` scope and any others.</span></span> <span data-ttu-id="f9328-151">Consente all'applicazione di accedere a numerose informazioni sull'utente,</span><span class="sxs-lookup"><span data-stu-id="f9328-151">It gives the app access to a substantial amount of information about the user.</span></span> <span data-ttu-id="f9328-152">tra cui il nome e il cognome dell'utente, il nome utente preferito, l'ID dell'oggetto e così via.</span><span class="sxs-lookup"><span data-stu-id="f9328-152">The information it can access includes, but is not limited to, the user's given name, surname, preferred username, and object ID.</span></span> <span data-ttu-id="f9328-153">Per un elenco completo delle attestazioni profilo disponibili nel parametro token ID per un determinato utente, vedere il [riferimento al token della versione 2.0](active-directory-v2-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="f9328-153">For a complete list of the profile claims available in the id_tokens parameter for a specific user, see the [v2.0 tokens reference](active-directory-v2-tokens.md).</span></span>

### <a name="offlineaccess"></a><span data-ttu-id="f9328-154">offline_access</span><span class="sxs-lookup"><span data-stu-id="f9328-154">offline_access</span></span>
<span data-ttu-id="f9328-155">L'ambito [`offline_access`](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) consente all'app di accedere alle risorse per conto dell'utente per un periodo di tempo prolungato.</span><span class="sxs-lookup"><span data-stu-id="f9328-155">The [`offline_access` scope](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) gives your app access to resources on behalf of the user for an extended time.</span></span> <span data-ttu-id="f9328-156">Nella pagina di consenso dell'account aziendale l'ambito viene visualizzato come autorizzazione per l'accesso ai dati in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="f9328-156">On the work account consent page, this scope appears as the "Access your data anytime" permission.</span></span> <span data-ttu-id="f9328-157">Nella pagina di consenso dell'account personale Microsoft viene visualizzato come autorizzazione per l'accesso alle informazioni in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="f9328-157">On the personal Microsoft account consent page, it appears as the "Access your info anytime" permission.</span></span> <span data-ttu-id="f9328-158">Quando un utente approva l'ambito `offline_access`, l'app è in grado di ricevere token di aggiornamento dall'endpoint del token 2.0.</span><span class="sxs-lookup"><span data-stu-id="f9328-158">When a user approves the `offline_access` scope, your app can receive refresh tokens from the v2.0 token endpoint.</span></span> <span data-ttu-id="f9328-159">I token di aggiornamento sono di lunga durata.</span><span class="sxs-lookup"><span data-stu-id="f9328-159">Refresh tokens are long-lived.</span></span> <span data-ttu-id="f9328-160">L'applicazione può ottenere nuovi token di accesso quando i vecchi scadono.</span><span class="sxs-lookup"><span data-stu-id="f9328-160">Your app can get new access tokens as older ones expire.</span></span>

<span data-ttu-id="f9328-161">Se l'app non richiede l'ambito `offline_access`, non riceverà i token di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="f9328-161">If your app does not request the `offline_access` scope, it won't receive refresh tokens.</span></span> <span data-ttu-id="f9328-162">Pertanto, se si riscatta un codice di autorizzazione nel [flusso del codice di autorizzazione di OAuth 2.0](active-directory-v2-protocols.md), si riceve solo un token di accesso dall'endpoint `/token`.</span><span class="sxs-lookup"><span data-stu-id="f9328-162">This means that when you redeem an authorization code in the [OAuth 2.0 authorization code flow](active-directory-v2-protocols.md), you'll receive only an access token from the `/token` endpoint.</span></span> <span data-ttu-id="f9328-163">Il token di accesso è valido per un breve periodo.</span><span class="sxs-lookup"><span data-stu-id="f9328-163">The access token is valid for a short time.</span></span> <span data-ttu-id="f9328-164">Il token di accesso ha in genere una durata di un'ora.</span><span class="sxs-lookup"><span data-stu-id="f9328-164">The access token usually expires in one hour.</span></span> <span data-ttu-id="f9328-165">A questo punto, l'app reindirizza l'utente all'endpoint `/authorize` per recuperare un nuovo codice di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="f9328-165">At that point, your app needs to redirect the user back to the `/authorize` endpoint to get a new authorization code.</span></span> <span data-ttu-id="f9328-166">Durante il reindirizzamento, a seconda del tipo di app, l'utente potrebbe dover immettere nuovamente le proprie credenziali o fornire il consenso per le autorizzazioni.</span><span class="sxs-lookup"><span data-stu-id="f9328-166">During this redirect, depending on the type of app, the user might need to enter their credentials again or consent again to permissions.</span></span>

<span data-ttu-id="f9328-167">Per altre informazioni su come ottenere e usare i token di aggiornamento, vedere il [riferimento al protocollo della versione 2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="f9328-167">For more information about how to get and use refresh tokens, see the [v2.0 protocol reference](active-directory-v2-protocols.md).</span></span>

## <a name="requesting-individual-user-consent"></a><span data-ttu-id="f9328-168">Richiesta di consenso per un singolo utente</span><span class="sxs-lookup"><span data-stu-id="f9328-168">Requesting individual user consent</span></span>
<span data-ttu-id="f9328-169">In una richiesta di autorizzazione [OpenID Connect o OAuth 2.0](active-directory-v2-protocols.md) un'app può richiedere le autorizzazioni necessarie usando il parametro di query `scope`.</span><span class="sxs-lookup"><span data-stu-id="f9328-169">In an [OpenID Connect or OAuth 2.0](active-directory-v2-protocols.md) authorization request, an app can request the permissions it needs by using the `scope` query parameter.</span></span> <span data-ttu-id="f9328-170">Ad esempio, quando un utente accede a un'app, questa può inviare una richiesta simile alla seguente (con interruzioni di riga aggiunte per leggibilità):</span><span class="sxs-lookup"><span data-stu-id="f9328-170">For example, when a user signs in to an app, the app sends a request like the following example (with line breaks added for legibility):</span></span>

```
GET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=query
&scope=
https%3A%2F%2Fgraph.microsoft.com%2Fcalendar.read%20
https%3A%2F%2Fgraph.microsoft.com%2Fmail.send
&state=12345
```

<span data-ttu-id="f9328-171">Il parametro `scope` è un elenco di ambiti separati da spazi richiesti dall'app.</span><span class="sxs-lookup"><span data-stu-id="f9328-171">The `scope` parameter is a space-separated list of scopes that the app is requesting.</span></span> <span data-ttu-id="f9328-172">Ogni ambito è indicato dall'aggiunta del valore dell'ambito all'identificatore della risorsa (URI ID dell'app).</span><span class="sxs-lookup"><span data-stu-id="f9328-172">Each scope is indicated by appending the scope value to the resource's identifier (the Application ID URI).</span></span> <span data-ttu-id="f9328-173">Nella richiesta di esempio precedente, l'app richiede l'autorizzazione per la lettura del calendario dell'utente e l'invio di messaggi di posta elettronica come utente.</span><span class="sxs-lookup"><span data-stu-id="f9328-173">In the request example, the app needs permission to read the user's calendar and send mail as the user.</span></span>

<span data-ttu-id="f9328-174">Dopo che l'utente immette le proprie credenziali, l'endpoint 2.0 verifica la disponibilità di un record corrispondente di *consenso dell'utente*.</span><span class="sxs-lookup"><span data-stu-id="f9328-174">After the user enters their credentials, the v2.0 endpoint checks for a matching record of *user consent*.</span></span> <span data-ttu-id="f9328-175">Se l'utente non ha fornito in precedenza il consenso per nessuna delle autorizzazioni necessarie, l'endpoint 2.0 chiede all'utente di fornire il consenso per le autorizzazioni obbligatorie.</span><span class="sxs-lookup"><span data-stu-id="f9328-175">If the user has not consented to any of the requested permissions in the past, the v2.0 endpoint asks the user to grant the requested permissions.</span></span>

![Consenso dell'account aziendale](../../media/active-directory-v2-flows/work_account_consent.png)

<span data-ttu-id="f9328-177">Quando l'utente approva l'autorizzazione, il consenso viene registrato in modo che non debba essere fornito nuovamente agli accessi successivi da parte degli account.</span><span class="sxs-lookup"><span data-stu-id="f9328-177">When the user approves the permission, the consent is recorded so that the user doesn't have to consent again on subsequent account sign-ins.</span></span>

## <a name="requesting-consent-for-an-entire-tenant"></a><span data-ttu-id="f9328-178">Richiesta di consenso per un intero tenant</span><span class="sxs-lookup"><span data-stu-id="f9328-178">Requesting consent for an entire tenant</span></span>
<span data-ttu-id="f9328-179">Quando un'organizzazione acquista una licenza o una sottoscrizione a un'applicazione, desidera fornire accesso completo ai dipendenti.</span><span class="sxs-lookup"><span data-stu-id="f9328-179">Often, when an organization purchases a license or subscription for an application, the organization wants to fully provision the application for its employees.</span></span> <span data-ttu-id="f9328-180">Come parte di questo processo, un amministratore può concedere il consenso all'applicazione ad agire per conto di qualsiasi dipendente.</span><span class="sxs-lookup"><span data-stu-id="f9328-180">As part of this process, an administrator can grant consent for the application to act on behalf of any employee.</span></span> <span data-ttu-id="f9328-181">Se l'amministratore concede il consenso per l'intero tenant, i dipendenti dell'organizzazione non visualizzeranno la pagina di consenso per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f9328-181">If the admin grants consent for the entire tenant, the organization's employees won't see a consent page for the application.</span></span>

<span data-ttu-id="f9328-182">Per richiedere il consenso per tutti gli utenti in un tenant, è possibile usare l'applicazione dell'endpoint di consenso dell'amministratore.</span><span class="sxs-lookup"><span data-stu-id="f9328-182">To request consent for all users in a tenant, your app can use the admin consent endpoint.</span></span>

## <a name="admin-restricted-scopes"></a><span data-ttu-id="f9328-183">Ambiti riservati all'amministratore</span><span class="sxs-lookup"><span data-stu-id="f9328-183">Admin-restricted scopes</span></span>
<span data-ttu-id="f9328-184">Alcune autorizzazioni con privilegi elevati nell'ecosistema Microsoft possono essere impostati come *riservati all'amministratore*.</span><span class="sxs-lookup"><span data-stu-id="f9328-184">Some high-privilege permissions in the Microsoft ecosystem can be set to *admin-restricted*.</span></span> <span data-ttu-id="f9328-185">Gli esempi di questi tipi di ambiti includono le autorizzazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="f9328-185">Examples of these kinds of scopes include the following permissions:</span></span>

* <span data-ttu-id="f9328-186">Lettura di dati in una directory aziendale tramite `Directory.Read`</span><span class="sxs-lookup"><span data-stu-id="f9328-186">Read an organization's directory data by using `Directory.Read`</span></span>
* <span data-ttu-id="f9328-187">Scrittura di dati in una directory aziendale tramite `Directory.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="f9328-187">Write data to an organization's directory by using `Directory.ReadWrite`</span></span>
* <span data-ttu-id="f9328-188">Lettura dei gruppi di sicurezza nella directory aziendale tramite `Groups.Read.All`</span><span class="sxs-lookup"><span data-stu-id="f9328-188">Read security groups in an organization's directory by using `Groups.Read.All`</span></span>

<span data-ttu-id="f9328-189">Sebbene un utente consumer possa concedere a un'applicazione l'accesso a questi tipi di dati, gli utenti aziendali non possono concedere accesso allo stesso set di dati riservati dell'azienda.</span><span class="sxs-lookup"><span data-stu-id="f9328-189">Although a consumer user might grant an application access to this kind of data, organizational users are restricted from granting access to the same set of sensitive company data.</span></span> <span data-ttu-id="f9328-190">Se l'applicazione richiede l'accesso a una di queste autorizzazioni da un utente aziendale, l'utente riceve un messaggio di errore che indica che non è autorizzato a fornire il consenso alle autorizzazioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f9328-190">If your application requests access to one of these permissions from an organizational user, the user receives an error message that says they are not authorized to consent to your app's permissions.</span></span>

<span data-ttu-id="f9328-191">Se l'applicazione richiede accesso ad ambiti riservati all'amministratore delle organizzazioni, è necessario richiederle direttamente all'amministratore dell'azienda anche tramite l'endpoint di consenso dell'amministratore, come descritto di seguito.</span><span class="sxs-lookup"><span data-stu-id="f9328-191">If your app requires access to admin-restricted scopes for organizations, you should request them directly from a company administrator, also by using the admin consent endpoint, described next.</span></span>

<span data-ttu-id="f9328-192">Quando un amministratore concede le autorizzazioni tramite l'endpoint di consenso dell'amministratore, il consenso viene concesso a tutti gli utenti del tenant.</span><span class="sxs-lookup"><span data-stu-id="f9328-192">When an administrator grants these permissions via the admin consent endpoint, consent is granted for all users in the tenant.</span></span>

## <a name="using-the-admin-consent-endpoint"></a><span data-ttu-id="f9328-193">Uso dell'endpoint di consenso dell'amministratore</span><span class="sxs-lookup"><span data-stu-id="f9328-193">Using the admin consent endpoint</span></span>
<span data-ttu-id="f9328-194">Seguendo questa procedura, l'applicazione può ottenere le autorizzazioni per tutti gli utenti di un tenant, inclusi gli ambiti riservati all'amministratore.</span><span class="sxs-lookup"><span data-stu-id="f9328-194">If you follow these steps, your app can gather permissions for all users in a tenant, including admin-restricted scopes.</span></span> <span data-ttu-id="f9328-195">Per un esempio di codice che implementa la procedura, vedere l'[esempio sugli ambiti riservati all'amministratore](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span><span class="sxs-lookup"><span data-stu-id="f9328-195">To see a code sample that implements the steps, see the [admin-restricted scopes sample](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span></span>

### <a name="request-the-permissions-in-the-app-registration-portal"></a><span data-ttu-id="f9328-196">Richiedere le autorizzazioni nel portale di registrazione dell'app</span><span class="sxs-lookup"><span data-stu-id="f9328-196">Request the permissions in the app registration portal</span></span>
1. <span data-ttu-id="f9328-197">Passare all'applicazione nel [portale di registrazione delle applicazioni](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) o [creare un'app](active-directory-v2-app-registration.md), se non se ne possiede già una.</span><span class="sxs-lookup"><span data-stu-id="f9328-197">Go to your application in the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), or [create an app](active-directory-v2-app-registration.md) if you haven't already.</span></span>
2. <span data-ttu-id="f9328-198">Individuare la sezione **Autorizzazioni di Microsoft Graph**  e aggiungere le autorizzazioni richieste dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f9328-198">Locate the **Microsoft Graph Permissions** section, and then add the permissions that your app requires.</span></span>
3. <span data-ttu-id="f9328-199">**Salvare** la registrazione dell'app.</span><span class="sxs-lookup"><span data-stu-id="f9328-199">Make sure you **Save** the app registration.</span></span>

### <a name="recommended-sign-the-user-in-to-your-app"></a><span data-ttu-id="f9328-200">Consigliato: connettere l'utente dall'applicazione</span><span class="sxs-lookup"><span data-stu-id="f9328-200">Recommended: Sign the user in to your app</span></span>
<span data-ttu-id="f9328-201">In genere, durante la compilazione di un'applicazione che usa l'endpoint di consenso dell'amministratore, l'app necessita di una pagina o vista che consenta all'amministratore di approvare le autorizzazioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f9328-201">Typically, when you build an application that uses the admin consent endpoint, the app needs a page or view in which the admin can approve the app's permissions.</span></span> <span data-ttu-id="f9328-202">Questa pagina può essere parte del flusso di iscrizione all'app, delle impostazioni dell'applicazione o di un flusso di "connessione" dedicato.</span><span class="sxs-lookup"><span data-stu-id="f9328-202">This page can be part of the app's sign-up flow, part of the app's settings, or it can be a dedicated "connect" flow.</span></span> <span data-ttu-id="f9328-203">In molti casi, è utile per l'applicazione visualizzare la pagina di "connessione" solo dopo che un utente ha eseguito l'accesso con un account di lavoro o dell'istituto di istruzione Microsoft.</span><span class="sxs-lookup"><span data-stu-id="f9328-203">In many cases, it makes sense for the app to show this "connect" view only after a user has signed in with a work or school Microsoft account.</span></span>

<span data-ttu-id="f9328-204">L'accesso dell'utente nell'app consente di identificarne l'organizzazione di appartenenza dell'amministratore prima di richiedere l'approvazione delle autorizzazioni necessarie.</span><span class="sxs-lookup"><span data-stu-id="f9328-204">When you sign the user in to your app, you can identify the organization to which the admin belongs before asking them to approve the necessary permissions.</span></span> <span data-ttu-id="f9328-205">Sebbene non sia strettamente necessario, questo consente di creare un'esperienza più intuitiva per gli utenti dell'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="f9328-205">Although not strictly necessary, it can help you create a more intuitive experience for your organizational users.</span></span> <span data-ttu-id="f9328-206">Per l'accesso utente, seguire le [esercitazioni sui protocolli 2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="f9328-206">To sign the user in, follow our [v2.0 protocol tutorials](active-directory-v2-protocols.md).</span></span>

### <a name="request-the-permissions-from-a-directory-admin"></a><span data-ttu-id="f9328-207">Richiedere le autorizzazioni da un amministratore di directory</span><span class="sxs-lookup"><span data-stu-id="f9328-207">Request the permissions from a directory admin</span></span>
<span data-ttu-id="f9328-208">Quando si è pronti per richiedere le autorizzazioni dall'amministratore dell'azienda, è possibile reindirizzare l'utente sull'*endpoint di consenso dell'amministratore* v2.0.</span><span class="sxs-lookup"><span data-stu-id="f9328-208">When you're ready to request permissions from your organization's admin, you can redirect the user to the v2.0 *admin consent endpoint*.</span></span>

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/adminconsent?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&state=12345
&redirect_uri=http://localhost/myapp/permissions
```

```
// Pro tip: Try pasting the below request in a browser!
```

```
https://login.microsoftonline.com/common/adminconsent?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&state=12345&redirect_uri=http://localhost/myapp/permissions
```

| <span data-ttu-id="f9328-209">Parametro</span><span class="sxs-lookup"><span data-stu-id="f9328-209">Parameter</span></span> | <span data-ttu-id="f9328-210">Condizione</span><span class="sxs-lookup"><span data-stu-id="f9328-210">Condition</span></span> | <span data-ttu-id="f9328-211">Descrizione</span><span class="sxs-lookup"><span data-stu-id="f9328-211">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f9328-212">tenant</span><span class="sxs-lookup"><span data-stu-id="f9328-212">tenant</span></span> |<span data-ttu-id="f9328-213">Obbligatorio</span><span class="sxs-lookup"><span data-stu-id="f9328-213">Required</span></span> |<span data-ttu-id="f9328-214">Il tenant della directory da cui si desidera richiedere autorizzazioni.</span><span class="sxs-lookup"><span data-stu-id="f9328-214">The directory tenant that you want to request permission from.</span></span> <span data-ttu-id="f9328-215">Può essere fornito nel formato di nome descrittivo o GUID.</span><span class="sxs-lookup"><span data-stu-id="f9328-215">Can be provided in GUID or friendly name format.</span></span> |
| <span data-ttu-id="f9328-216">client_id</span><span class="sxs-lookup"><span data-stu-id="f9328-216">client_id</span></span> |<span data-ttu-id="f9328-217">Obbligatorio</span><span class="sxs-lookup"><span data-stu-id="f9328-217">Required</span></span> |<span data-ttu-id="f9328-218">ID applicazione che il [portale di registrazione delle applicazioni](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) ha assegnato all'app.</span><span class="sxs-lookup"><span data-stu-id="f9328-218">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span></span> |
| <span data-ttu-id="f9328-219">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="f9328-219">redirect_uri</span></span> |<span data-ttu-id="f9328-220">Obbligatorio</span><span class="sxs-lookup"><span data-stu-id="f9328-220">Required</span></span> |<span data-ttu-id="f9328-221">URI di reindirizzamento in cui si desidera che venga inviata la risposta per la gestione da parte dell'app.</span><span class="sxs-lookup"><span data-stu-id="f9328-221">The redirect URI where you want the response to be sent for your app to handle.</span></span> <span data-ttu-id="f9328-222">Deve corrispondere esattamente a uno degli URI di reindirizzamento registrati nel portale di registrazione delle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="f9328-222">It must exactly match one of the redirect URIs that you registered in the app registration portal.</span></span> |
| <span data-ttu-id="f9328-223">state</span><span class="sxs-lookup"><span data-stu-id="f9328-223">state</span></span> |<span data-ttu-id="f9328-224">Consigliato</span><span class="sxs-lookup"><span data-stu-id="f9328-224">Recommended</span></span> |<span data-ttu-id="f9328-225">Valore incluso nella richiesta che verrà restituito anche nella risposta del token.</span><span class="sxs-lookup"><span data-stu-id="f9328-225">A value included in the request that will also be returned in the token response.</span></span> <span data-ttu-id="f9328-226">Può trattarsi di una stringa di qualsiasi contenuto.</span><span class="sxs-lookup"><span data-stu-id="f9328-226">It can be a string of any content you want.</span></span> <span data-ttu-id="f9328-227">Usare questo stato per codificare le informazioni sullo stato dell'utente nell'app prima dell'esecuzione della richiesta di autenticazione, ad esempio la pagina o la vista in cui si trovava.</span><span class="sxs-lookup"><span data-stu-id="f9328-227">Use the state to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |

<span data-ttu-id="f9328-228">A questo punto, Azure AD richiede che solo un amministratore tenant possa accedere per completare la richiesta.</span><span class="sxs-lookup"><span data-stu-id="f9328-228">At this point, Azure AD requires a tenant administrator to sign in to complete the request.</span></span> <span data-ttu-id="f9328-229">L'amministratore deve approvare tutte le autorizzazioni richieste per l'app nel portale di registrazione delle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="f9328-229">The administrator is asked to approve all the permissions that you have requested for your app in the app registration portal.</span></span>

#### <a name="successful-response"></a><span data-ttu-id="f9328-230">Risposta con esito positivo</span><span class="sxs-lookup"><span data-stu-id="f9328-230">Successful response</span></span>
<span data-ttu-id="f9328-231">Se l'amministratore approva le autorizzazioni per l'app, la risposta con esito positivo si presenta come segue:</span><span class="sxs-lookup"><span data-stu-id="f9328-231">If the admin approves the permissions for your app, the successful response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?tenant=a8990e1f-ff32-408a-9f8e-78d3b9139b95&state=state=12345&admin_consent=True
```

| <span data-ttu-id="f9328-232">Parametro</span><span class="sxs-lookup"><span data-stu-id="f9328-232">Parameter</span></span> | <span data-ttu-id="f9328-233">Descrizione</span><span class="sxs-lookup"><span data-stu-id="f9328-233">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f9328-234">tenant</span><span class="sxs-lookup"><span data-stu-id="f9328-234">tenant</span></span> |<span data-ttu-id="f9328-235">Tenant della directory che ha concesso all'applicazione le autorizzazioni richieste, in formato GUID.</span><span class="sxs-lookup"><span data-stu-id="f9328-235">The directory tenant that granted your application the permissions it requested, in GUID format.</span></span> |
| <span data-ttu-id="f9328-236">state</span><span class="sxs-lookup"><span data-stu-id="f9328-236">state</span></span> |<span data-ttu-id="f9328-237">Valore incluso nella richiesta che verrà restituito anche nella risposta del token.</span><span class="sxs-lookup"><span data-stu-id="f9328-237">A value included in the request that also will be returned in the token response.</span></span> <span data-ttu-id="f9328-238">Può trattarsi di una stringa di qualsiasi contenuto.</span><span class="sxs-lookup"><span data-stu-id="f9328-238">It can be a string of any content you want.</span></span> <span data-ttu-id="f9328-239">Lo stato viene usato per codificare le informazioni sullo stato dell'utente nell'app prima dell'esecuzione della richiesta di autenticazione, ad esempio la pagina o la vista in cui si trovava.</span><span class="sxs-lookup"><span data-stu-id="f9328-239">The state is used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |
| <span data-ttu-id="f9328-240">admin_consent</span><span class="sxs-lookup"><span data-stu-id="f9328-240">admin_consent</span></span> |<span data-ttu-id="f9328-241">Verrà impostato su **true**.</span><span class="sxs-lookup"><span data-stu-id="f9328-241">Will be set to **true**.</span></span> |

#### <a name="error-response"></a><span data-ttu-id="f9328-242">Risposta di errore</span><span class="sxs-lookup"><span data-stu-id="f9328-242">Error response</span></span>
<span data-ttu-id="f9328-243">Se l'amministratore non approva le autorizzazioni per l'app, la risposta di errore si presenta come segue:</span><span class="sxs-lookup"><span data-stu-id="f9328-243">If the admin does not approve the permissions for your app, the failed response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?error=permission_denied&error_description=The+admin+canceled+the+request
```

| <span data-ttu-id="f9328-244">Parametro</span><span class="sxs-lookup"><span data-stu-id="f9328-244">Parameter</span></span> | <span data-ttu-id="f9328-245">Descrizione</span><span class="sxs-lookup"><span data-stu-id="f9328-245">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f9328-246">error</span><span class="sxs-lookup"><span data-stu-id="f9328-246">error</span></span> |<span data-ttu-id="f9328-247">Stringa di codice di errore che può essere usata per classificare i tipi di errori che si verificano e correggerli.</span><span class="sxs-lookup"><span data-stu-id="f9328-247">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span></span> |
| <span data-ttu-id="f9328-248">error_description</span><span class="sxs-lookup"><span data-stu-id="f9328-248">error_description</span></span> |<span data-ttu-id="f9328-249">Messaggio di errore specifico che consente a uno sviluppatore di identificare la causa principale di un errore.</span><span class="sxs-lookup"><span data-stu-id="f9328-249">A specific error message that can help a developer identify the root cause of an error.</span></span> |

<span data-ttu-id="f9328-250">Dopo aver ricevuto una risposta con esito positivo dall'endpoint di consenso dell'amministratore, l'applicazione ha ottenuto le autorizzazioni richieste.</span><span class="sxs-lookup"><span data-stu-id="f9328-250">After you've received a successful response from the admin consent endpoint, your app has gained the permissions it requested.</span></span> <span data-ttu-id="f9328-251">Successivamente, è possibile richiedere un token per la risorsa desiderata.</span><span class="sxs-lookup"><span data-stu-id="f9328-251">Next, you can request a token for the resource you want.</span></span>

## <a name="using-permissions"></a><span data-ttu-id="f9328-252">Uso delle autorizzazioni</span><span class="sxs-lookup"><span data-stu-id="f9328-252">Using permissions</span></span>
<span data-ttu-id="f9328-253">Dopo che l'utente fornisce il consenso alle autorizzazioni relative all'app, quest'ultima può acquisire token di accesso che rappresentano l'autorizzazione dell'app ad accedere a una risorsa.</span><span class="sxs-lookup"><span data-stu-id="f9328-253">After the user consents to permissions for your app, your app can acquire access tokens that represent your app's permission to access a resource in some capacity.</span></span> <span data-ttu-id="f9328-254">Un token di accesso può essere usato per una sola risorsa, ma al suo interno saranno codificate tutte le autorizzazioni della risorsa specifica per cui l'app ha ottenuto il consenso.</span><span class="sxs-lookup"><span data-stu-id="f9328-254">An access token can be used only for a single resource, but encoded inside the access token is every permission that your app has been granted for that resource.</span></span> <span data-ttu-id="f9328-255">Per ottenere un token di accesso, l'app può eseguire una richiesta all'endpoint del token 2.0 come quella seguente:</span><span class="sxs-lookup"><span data-stu-id="f9328-255">To acquire an access token, your app can make a request to the v2.0 token endpoint, like this:</span></span>

```
POST common/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/json

{
    "grant_type": "authorization_code",
    "client_id": "6731de76-14a6-49ae-97bc-6eba6914391e",
    "scope": "https://outlook.office.com/mail.read https://outlook.office.com/mail.send",
    "code": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq..."
    "redirect_uri": "https://localhost/myapp",
    "client_secret": "zc53fwe80980293klaj9823"  // NOTE: Only required for web apps
}
```

<span data-ttu-id="f9328-256">È possibile usare il token di accesso risultante nelle richieste HTTP per la risorsa.</span><span class="sxs-lookup"><span data-stu-id="f9328-256">You can use the resulting access token in HTTP requests to the resource.</span></span> <span data-ttu-id="f9328-257">Esso indica alla risorsa, in modo affidabile, che l'applicazione dispone delle autorizzazioni appropriate per eseguire un'attività specifica.</span><span class="sxs-lookup"><span data-stu-id="f9328-257">It reliably indicates to the resource that your app has the proper permission to perform a specific task.</span></span>  

<span data-ttu-id="f9328-258">Per altre informazioni sul protocollo OAuth 2.0 e su come ottenere i token di accesso, vedere il [riferimento al protocollo dell'endpoint v2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="f9328-258">For more information about the OAuth 2.0 protocol and how to get access tokens, see the [v2.0 endpoint protocol reference](active-directory-v2-protocols.md).</span></span>
