---
title: Crittografia in Azure Data Lake Store | Microsoft Docs
description: Informazioni sul funzionamento della crittografia e della rotazione delle chiavi in Azure Data Lake Store
services: data-lake-store
documentationcenter: 
author: yagupta
manager: 
editor: 
ms.assetid: 
ms.service: data-lake-store
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 4/14/2017
ms.author: yagupta
ms.openlocfilehash: 20444d368c568ee716ff242e33323b91ffd198eb
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="encryption-of-data-in-azure-data-lake-store"></a><span data-ttu-id="aea28-103">Crittografia dei dati in Azure Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="aea28-103">Encryption of data in Azure Data Lake Store</span></span>

<span data-ttu-id="aea28-104">La crittografia in Azure Data Lake Store consente di proteggere i dati, implementare criteri di sicurezza aziendali e soddisfare i requisiti di conformità normativi.</span><span class="sxs-lookup"><span data-stu-id="aea28-104">Encryption in Azure Data Lake Store helps you protect your data, implement enterprise security policies, and meet regulatory compliance requirements.</span></span> <span data-ttu-id="aea28-105">Questo articolo offre una panoramica della progettazione e illustra alcuni aspetti tecnici dell'implementazione.</span><span class="sxs-lookup"><span data-stu-id="aea28-105">This article provides an overview of the design, and discusses some of the technical aspects of implementation.</span></span>

<span data-ttu-id="aea28-106">Data Lake Store supporta la crittografia dei dati sia inattivi che in transito.</span><span class="sxs-lookup"><span data-stu-id="aea28-106">Data Lake Store supports encryption of data both at rest and in transit.</span></span> <span data-ttu-id="aea28-107">Per i dati inattivi, Data Lake Store supporta la crittografia trasparente "attivata per impostazione predefinita".</span><span class="sxs-lookup"><span data-stu-id="aea28-107">For data at rest, Data Lake Store supports "on by default," transparent encryption.</span></span> <span data-ttu-id="aea28-108">Di seguito è riportata una spiegazione più dettagliata:</span><span class="sxs-lookup"><span data-stu-id="aea28-108">Here is what these terms mean in a bit more detail:</span></span>

* <span data-ttu-id="aea28-109">**Attivata per impostazione predefinita**: quando si crea un nuovo account Data Lake Store, l'impostazione predefinita consente la crittografia.</span><span class="sxs-lookup"><span data-stu-id="aea28-109">**On by default**: When you create a new Data Lake Store account, the default setting enables encryption.</span></span> <span data-ttu-id="aea28-110">I dati archiviati in Data Lake Store quindi vengono sempre crittografati prima essere archiviati in supporti persistenti.</span><span class="sxs-lookup"><span data-stu-id="aea28-110">Thereafter, data that is stored in Data Lake Store is always encrypted prior to storing on persistent media.</span></span> <span data-ttu-id="aea28-111">Questo comportamento è valido per tutti i dati e non può essere modificato dopo che un account è stato creato.</span><span class="sxs-lookup"><span data-stu-id="aea28-111">This is the behavior for all data, and it cannot be changed after an account is created.</span></span>
* <span data-ttu-id="aea28-112">**Trasparente**: Data Lake Store crittografa automaticamente i dati prima di renderli persistenti e li decrittografa prima di recuperarli.</span><span class="sxs-lookup"><span data-stu-id="aea28-112">**Transparent**: Data Lake Store automatically encrypts data prior to persisting, and decrypts data prior to retrieval.</span></span> <span data-ttu-id="aea28-113">La crittografia viene configurata e gestita a livello di Data Lake Store da un amministratore.</span><span class="sxs-lookup"><span data-stu-id="aea28-113">The encryption is configured and managed at the Data Lake Store level by an administrator.</span></span> <span data-ttu-id="aea28-114">Non vengono apportate modifiche alle API di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="aea28-114">No changes are made to the data access APIs.</span></span> <span data-ttu-id="aea28-115">Non sono quindi necessarie modifiche nelle applicazioni e nei servizi che interagiscono con Data Lake Store a causa della crittografia.</span><span class="sxs-lookup"><span data-stu-id="aea28-115">Thus, no changes are required in applications and services that interact with Data Lake Store because of encryption.</span></span>

<span data-ttu-id="aea28-116">Anche i dati in transito (noti anche come dati in movimento) vengono sempre crittografati in Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="aea28-116">Data in transit (also known as data in motion) is also always encrypted in Data Lake Store.</span></span> <span data-ttu-id="aea28-117">I dati, oltre a essere crittografati prima dell'archiviazione in supporti persistenti, vengono sempre protetti anche mentre sono in transito usando HTTPS.</span><span class="sxs-lookup"><span data-stu-id="aea28-117">In addition to encrypting data prior to storing to persistent media, the data is also always secured in transit by using HTTPS.</span></span> <span data-ttu-id="aea28-118">HTTPS è l'unico protocollo supportato per le interfacce REST di Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="aea28-118">HTTPS is the only protocol that is supported for the Data Lake Store REST interfaces.</span></span> <span data-ttu-id="aea28-119">Il diagramma seguente illustra come vengono crittografati i dati in Data Lake Store:</span><span class="sxs-lookup"><span data-stu-id="aea28-119">The following diagram shows how data becomes encrypted in Data Lake Store:</span></span>

![Diagramma della crittografia dei dati in Data Lake Store](./media/data-lake-store-encryption/fig1.png)


## <a name="set-up-encryption-with-data-lake-store"></a><span data-ttu-id="aea28-121">Configurare la crittografia con Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="aea28-121">Set up encryption with Data Lake Store</span></span>

<span data-ttu-id="aea28-122">La crittografia per Data Lake Store viene configurata durante la creazione di un account ed è sempre abilitata per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="aea28-122">Encryption for Data Lake Store is set up during account creation, and it is always enabled by default.</span></span> <span data-ttu-id="aea28-123">È possibile gestire le chiavi manualmente o consentire a Data Lake Store di gestirle automaticamente (impostazione predefinita).</span><span class="sxs-lookup"><span data-stu-id="aea28-123">You can either manage the keys yourself, or allow Data Lake Store to manage them for you (this is the default).</span></span>

<span data-ttu-id="aea28-124">Per altre informazioni, vedere la [Introduzione](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).</span><span class="sxs-lookup"><span data-stu-id="aea28-124">For more information, see [Getting started](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).</span></span>

## <a name="how-encryption-works-in-data-lake-store"></a><span data-ttu-id="aea28-125">Come funziona la crittografia in Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="aea28-125">How encryption works in Data Lake Store</span></span>

<span data-ttu-id="aea28-126">Le informazioni seguenti illustrano come gestire le chiavi di crittografia master e i tre diversi tipi di chiavi che è possibile usare nella chiave di crittografia dei dati per Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="aea28-126">The following information covers how to manage master encryption keys, and it explains the three different types of keys you can use in data encryption for Data Lake Store.</span></span>

### <a name="master-encryption-keys"></a><span data-ttu-id="aea28-127">Chiavi di crittografia master</span><span class="sxs-lookup"><span data-stu-id="aea28-127">Master encryption keys</span></span>

<span data-ttu-id="aea28-128">Data Lake Store offre due modalità per la gestione delle chiavi di crittografia master.</span><span class="sxs-lookup"><span data-stu-id="aea28-128">Data Lake Store provides two modes for management of master encryption keys (MEKs).</span></span> <span data-ttu-id="aea28-129">Per il momento si supponga che la chiave di crittografia sia la chiave principale.</span><span class="sxs-lookup"><span data-stu-id="aea28-129">For now, assume that the master encryption key is the top-level key.</span></span> <span data-ttu-id="aea28-130">L'accesso alla chiave di crittografia master è necessario per decrittografare i dati archiviati in Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="aea28-130">Access to the master encryption key is required to decrypt any data stored in Data Lake Store.</span></span>

<span data-ttu-id="aea28-131">Le due modalità per la gestione della chiavi di crittografia master sono le seguenti:</span><span class="sxs-lookup"><span data-stu-id="aea28-131">The two modes for managing the master encryption key are as follows:</span></span>

*   <span data-ttu-id="aea28-132">Chiavi gestite dal servizio</span><span class="sxs-lookup"><span data-stu-id="aea28-132">Service managed keys</span></span>
*   <span data-ttu-id="aea28-133">Chiavi gestite dal cliente</span><span class="sxs-lookup"><span data-stu-id="aea28-133">Customer managed keys</span></span>

<span data-ttu-id="aea28-134">In entrambe le modalità la chiave di crittografia master viene protetta archiviandola in Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="aea28-134">In both modes, the master encryption key is secured by storing it in Azure Key Vault.</span></span> <span data-ttu-id="aea28-135">Key Vault è un servizio di Azure completamente gestito a sicurezza elevata che può essere usato per proteggere le chiavi crittografiche.</span><span class="sxs-lookup"><span data-stu-id="aea28-135">Key Vault is a fully managed, highly secure service on Azure that can be used to safeguard cryptographic keys.</span></span> <span data-ttu-id="aea28-136">Per altre informazioni, vedere [Key Vault](https://azure.microsoft.com/services/key-vault).</span><span class="sxs-lookup"><span data-stu-id="aea28-136">For more information, see [Key Vault](https://azure.microsoft.com/services/key-vault).</span></span>

<span data-ttu-id="aea28-137">Ecco un breve confronto delle funzionalità offerte dalle due modalità di gestione delle chiavi di crittografia master.</span><span class="sxs-lookup"><span data-stu-id="aea28-137">Here is a brief comparison of capabilities provided by the two modes of managing the MEKs.</span></span>

|  | <span data-ttu-id="aea28-138">Chiavi gestite dal servizio</span><span class="sxs-lookup"><span data-stu-id="aea28-138">Service managed keys</span></span> | <span data-ttu-id="aea28-139">Chiavi gestite dal cliente</span><span class="sxs-lookup"><span data-stu-id="aea28-139">Customer managed keys</span></span> |
| --- | --- | --- |
|<span data-ttu-id="aea28-140">Come vengono archiviati i dati?</span><span class="sxs-lookup"><span data-stu-id="aea28-140">How is data stored?</span></span>|<span data-ttu-id="aea28-141">Vengono sempre crittografati prima dell'archiviazione.</span><span class="sxs-lookup"><span data-stu-id="aea28-141">Always encrypted prior to being stored.</span></span>|<span data-ttu-id="aea28-142">Vengono sempre crittografati prima dell'archiviazione.</span><span class="sxs-lookup"><span data-stu-id="aea28-142">Always encrypted prior to being stored.</span></span>|
|<span data-ttu-id="aea28-143">Dove viene archiviata la chiave di crittografia master?</span><span class="sxs-lookup"><span data-stu-id="aea28-143">Where is the Master Encryption Key stored?</span></span>|<span data-ttu-id="aea28-144">Insieme di credenziali di chiave</span><span class="sxs-lookup"><span data-stu-id="aea28-144">Key Vault</span></span>|<span data-ttu-id="aea28-145">Insieme di credenziali di chiave</span><span class="sxs-lookup"><span data-stu-id="aea28-145">Key Vault</span></span>|
|<span data-ttu-id="aea28-146">Vengono archiviate chiavi di crittografia in chiaro al di fuori di Key Vault?</span><span class="sxs-lookup"><span data-stu-id="aea28-146">Are any encryption keys stored in the clear outside of Key Vault?</span></span> |<span data-ttu-id="aea28-147">No</span><span class="sxs-lookup"><span data-stu-id="aea28-147">No</span></span>|<span data-ttu-id="aea28-148">No</span><span class="sxs-lookup"><span data-stu-id="aea28-148">No</span></span>|
|<span data-ttu-id="aea28-149">La chiave di crittografia master può essere recuperata da Key Vault?</span><span class="sxs-lookup"><span data-stu-id="aea28-149">Can the MEK be retrieved by Key Vault?</span></span>|<span data-ttu-id="aea28-150">No.</span><span class="sxs-lookup"><span data-stu-id="aea28-150">No.</span></span> <span data-ttu-id="aea28-151">La chiave di crittografia master, dopo essere stata archiviata in Key Vault, può solo essere usata per la crittografia e la decrittografia.</span><span class="sxs-lookup"><span data-stu-id="aea28-151">After the MEK is stored in Key Vault, it can only be used for encryption and decryption.</span></span>|<span data-ttu-id="aea28-152">No.</span><span class="sxs-lookup"><span data-stu-id="aea28-152">No.</span></span> <span data-ttu-id="aea28-153">La chiave di crittografia master, dopo essere stata archiviata in Key Vault, può solo essere usata per la crittografia e la decrittografia.</span><span class="sxs-lookup"><span data-stu-id="aea28-153">After the MEK is stored in Key Vault, it can only be used for encryption and decryption.</span></span>|
|<span data-ttu-id="aea28-154">Chi è il proprietario dell'istanza di Key Vault e della chiave di crittografia master?</span><span class="sxs-lookup"><span data-stu-id="aea28-154">Who owns the Key Vault instance and the MEK?</span></span>|<span data-ttu-id="aea28-155">Il servizio Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="aea28-155">The Data Lake Store service</span></span>|<span data-ttu-id="aea28-156">L'utente è il proprietario dell'istanza di Key Vault, che appartiene alla sottoscrizione di Azure.</span><span class="sxs-lookup"><span data-stu-id="aea28-156">You own the Key Vault instance, which belongs in your own Azure subscription.</span></span> <span data-ttu-id="aea28-157">La chiave di crittografia master in Key Vault può essere gestita dal software o dall'hardware.</span><span class="sxs-lookup"><span data-stu-id="aea28-157">The MEK in Key Vault can be managed by software or hardware.</span></span>|
|<span data-ttu-id="aea28-158">È possibile revocare l'accesso alla chiave di crittografia master per il servizio Data Lake Store?</span><span class="sxs-lookup"><span data-stu-id="aea28-158">Can you revoke access to the MEK for the Data Lake Store service?</span></span>|<span data-ttu-id="aea28-159">No</span><span class="sxs-lookup"><span data-stu-id="aea28-159">No</span></span>|<span data-ttu-id="aea28-160">Sì.</span><span class="sxs-lookup"><span data-stu-id="aea28-160">Yes.</span></span> <span data-ttu-id="aea28-161">È possibile gestire gli elenchi di controllo di accesso in Key Vault e rimuovere le voci di controllo di accesso nell'identità del servizio per il servizio Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="aea28-161">You can manage access control lists in Key Vault, and remove access control entries to the service identity for the Data Lake Store service.</span></span>|
|<span data-ttu-id="aea28-162">È possibile eliminare definitivamente la chiave di crittografia master?</span><span class="sxs-lookup"><span data-stu-id="aea28-162">Can you permanently delete the MEK?</span></span>|<span data-ttu-id="aea28-163">No</span><span class="sxs-lookup"><span data-stu-id="aea28-163">No</span></span>|<span data-ttu-id="aea28-164">Sì.</span><span class="sxs-lookup"><span data-stu-id="aea28-164">Yes.</span></span> <span data-ttu-id="aea28-165">Se si elimina la chiave di crittografia master da Key Vault, i dati nell'account Data Lake Store non possono essere in alcun modo decrittografati, neppure dal servizio Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="aea28-165">If you delete the MEK from Key Vault, the data in the Data Lake Store account cannot be decrypted by anyone, including the Data Lake Store service.</span></span> <br><br> <span data-ttu-id="aea28-166">Se è stato eseguito un backup esplicito della chiave di crittografia master prima di eliminarla da Key Vault, la chiave può essere ripristinata e i dati recuperati.</span><span class="sxs-lookup"><span data-stu-id="aea28-166">If you have explicitly backed up the MEK prior to deleting it from Key Vault, the MEK can be restored, and the data can then be recovered.</span></span> <span data-ttu-id="aea28-167">Se tuttavia non è stato eseguito un backup della chiave di crittografia master prima di eliminarla da Key Vault, i dati nell'account Data Lake Store non potranno più essere decrittografati.</span><span class="sxs-lookup"><span data-stu-id="aea28-167">However, if you have not backed up the MEK prior to deleting it from Key Vault, the data in the Data Lake Store account can never be decrypted thereafter.</span></span>|


<span data-ttu-id="aea28-168">Fatta eccezione per questa differenza, ovvero chi gestisce la chiave di crittografia master e l'istanza di Key Vault in cui si trova, la progettazione è la medesima per entrambe le modalità.</span><span class="sxs-lookup"><span data-stu-id="aea28-168">Aside from this difference of who manages the MEK and the Key Vault instance in which it resides, the rest of the design is the same for both modes.</span></span>

<span data-ttu-id="aea28-169">È importante tenere presente quanto segue quando si sceglie la modalità per le chiavi di crittografia master:</span><span class="sxs-lookup"><span data-stu-id="aea28-169">It's important to remember the following when you choose the mode for the master encryption keys:</span></span>

*   <span data-ttu-id="aea28-170">È possibile scegliere se usare chiavi gestite dal cliente o dal servizio quando si effettua il provisioning di un account Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="aea28-170">You can choose whether to use customer managed keys or service managed keys when you provision a Data Lake Store account.</span></span>
*   <span data-ttu-id="aea28-171">Dopo il provisioning di un account Data Lake Store, non è possibile modificare la modalità.</span><span class="sxs-lookup"><span data-stu-id="aea28-171">After a Data Lake Store account is provisioned, the mode cannot be changed.</span></span>

### <a name="encryption-and-decryption-of-data"></a><span data-ttu-id="aea28-172">Crittografia e decrittografia dei dati</span><span class="sxs-lookup"><span data-stu-id="aea28-172">Encryption and decryption of data</span></span>

<span data-ttu-id="aea28-173">Nella progettazione della crittografia dei dati vengono usati tre tipi di chiavi.</span><span class="sxs-lookup"><span data-stu-id="aea28-173">There are three types of keys that are used in the design of data encryption.</span></span> <span data-ttu-id="aea28-174">La tabella seguente contiene un riepilogo:</span><span class="sxs-lookup"><span data-stu-id="aea28-174">The following table provides a summary:</span></span>

| <span data-ttu-id="aea28-175">Chiave</span><span class="sxs-lookup"><span data-stu-id="aea28-175">Key</span></span>                   | <span data-ttu-id="aea28-176">Abbreviazione</span><span class="sxs-lookup"><span data-stu-id="aea28-176">Abbreviation</span></span> | <span data-ttu-id="aea28-177">Elemento associato</span><span class="sxs-lookup"><span data-stu-id="aea28-177">Associated with</span></span> | <span data-ttu-id="aea28-178">Posizione di archiviazione</span><span class="sxs-lookup"><span data-stu-id="aea28-178">Storage location</span></span>                             | <span data-ttu-id="aea28-179">Tipo</span><span class="sxs-lookup"><span data-stu-id="aea28-179">Type</span></span>       | <span data-ttu-id="aea28-180">Note</span><span class="sxs-lookup"><span data-stu-id="aea28-180">Notes</span></span>                                                                                                   |
|-----------------------|--------------|-----------------|----------------------------------------------|------------|---------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="aea28-181">Chiave di crittografia master</span><span class="sxs-lookup"><span data-stu-id="aea28-181">Master Encryption Key</span></span> | <span data-ttu-id="aea28-182">MEK</span><span class="sxs-lookup"><span data-stu-id="aea28-182">MEK</span></span>          | <span data-ttu-id="aea28-183">Un account Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="aea28-183">A Data Lake Store account</span></span> | <span data-ttu-id="aea28-184">Insieme di credenziali di chiave</span><span class="sxs-lookup"><span data-stu-id="aea28-184">Key Vault</span></span>                              | <span data-ttu-id="aea28-185">Asimmetrica</span><span class="sxs-lookup"><span data-stu-id="aea28-185">Asymmetric</span></span> | <span data-ttu-id="aea28-186">Può essere gestita da Data Lake Store o dall'utente.</span><span class="sxs-lookup"><span data-stu-id="aea28-186">It can be managed by Data Lake Store or you.</span></span>                                                              |
| <span data-ttu-id="aea28-187">Chiave di crittografia dei dati</span><span class="sxs-lookup"><span data-stu-id="aea28-187">Data Encryption Key</span></span>   | <span data-ttu-id="aea28-188">DEK</span><span class="sxs-lookup"><span data-stu-id="aea28-188">DEK</span></span>          | <span data-ttu-id="aea28-189">Un account Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="aea28-189">A Data Lake Store account</span></span> | <span data-ttu-id="aea28-190">Risorsa di archiviazione persistente, gestita dal servizio Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="aea28-190">Persistent storage, managed by Data Lake Store service</span></span> | <span data-ttu-id="aea28-191">Simmetrica</span><span class="sxs-lookup"><span data-stu-id="aea28-191">Symmetric</span></span>  | <span data-ttu-id="aea28-192">La chiave di crittografia dei dati viene crittografata dalla chiave di crittografia master.</span><span class="sxs-lookup"><span data-stu-id="aea28-192">The DEK is encrypted by the MEK.</span></span> <span data-ttu-id="aea28-193">È la chiave di crittografia dei dati crittografata a essere archiviata nei supporti persistenti.</span><span class="sxs-lookup"><span data-stu-id="aea28-193">The encrypted DEK is what is stored on persistent media.</span></span> |
| <span data-ttu-id="aea28-194">Chiave di crittografia a blocchi</span><span class="sxs-lookup"><span data-stu-id="aea28-194">Block Encryption Key</span></span>  | <span data-ttu-id="aea28-195">BEK</span><span class="sxs-lookup"><span data-stu-id="aea28-195">BEK</span></span>          | <span data-ttu-id="aea28-196">Un blocco di dati</span><span class="sxs-lookup"><span data-stu-id="aea28-196">A block of data</span></span> | <span data-ttu-id="aea28-197">Nessuno</span><span class="sxs-lookup"><span data-stu-id="aea28-197">None</span></span>                                         | <span data-ttu-id="aea28-198">Simmetrica</span><span class="sxs-lookup"><span data-stu-id="aea28-198">Symmetric</span></span>  | <span data-ttu-id="aea28-199">La chiave di crittografia a blocchi deriva dalla chiave di crittografia dei dati e dal blocco di dati.</span><span class="sxs-lookup"><span data-stu-id="aea28-199">The BEK is derived from the DEK and the data block.</span></span>                                                      |

<span data-ttu-id="aea28-200">Il diagramma seguente illustra questi concetti:</span><span class="sxs-lookup"><span data-stu-id="aea28-200">The following diagram illustrates these concepts:</span></span>

![Chiavi nella crittografia dei dati](./media/data-lake-store-encryption/fig2.png)

#### <a name="pseudo-algorithm-when-a-file-is-to-be-decrypted"></a><span data-ttu-id="aea28-202">Pseudoalgoritmo quando un file deve essere decrittografato:</span><span class="sxs-lookup"><span data-stu-id="aea28-202">Pseudo algorithm when a file is to be decrypted:</span></span>
1.  <span data-ttu-id="aea28-203">Controllare se la chiave di crittografia dei dati per l'account Data Lake Store è memorizzata nella cache e può essere usata.</span><span class="sxs-lookup"><span data-stu-id="aea28-203">Check if the DEK for the Data Lake Store account is cached and ready for use.</span></span>
    - <span data-ttu-id="aea28-204">In caso contrario, leggere la chiave di crittografia dei dati crittografata dalla risorsa di archiviazione persistente e inviarla a Key Vault per la decrittografia.</span><span class="sxs-lookup"><span data-stu-id="aea28-204">If not, then read the encrypted DEK from persistent storage, and send it to Key Vault to be decrypted.</span></span> <span data-ttu-id="aea28-205">Memorizzare nella cache la chiave di crittografia dei dati decrittografata.</span><span class="sxs-lookup"><span data-stu-id="aea28-205">Cache the decrypted DEK in memory.</span></span> <span data-ttu-id="aea28-206">Ora è possibile usarla.</span><span class="sxs-lookup"><span data-stu-id="aea28-206">It is now ready to use.</span></span>
2.  <span data-ttu-id="aea28-207">Per ogni blocco di dati nel file:</span><span class="sxs-lookup"><span data-stu-id="aea28-207">For every block of data in the file:</span></span>
    - <span data-ttu-id="aea28-208">Leggere il blocco di dati crittografato da una risorsa di archiviazione persistente.</span><span class="sxs-lookup"><span data-stu-id="aea28-208">Read the encrypted block of data from persistent storage.</span></span>
    - <span data-ttu-id="aea28-209">Generare la chiave di crittografia a blocchi dalla chiave di crittografia dei dati e dal blocco di dati crittografato.</span><span class="sxs-lookup"><span data-stu-id="aea28-209">Generate the BEK from the DEK and the encrypted block of data.</span></span>
    - <span data-ttu-id="aea28-210">Usare la chiave di crittografia a blocchi per decrittografare i dati.</span><span class="sxs-lookup"><span data-stu-id="aea28-210">Use the BEK to decrypt data.</span></span>


#### <a name="pseudo-algorithm-when-a-block-of-data-is-to-be-encrypted"></a><span data-ttu-id="aea28-211">Pseudoalgoritmo quando un file deve essere crittografato:</span><span class="sxs-lookup"><span data-stu-id="aea28-211">Pseudo algorithm when a block of data is to be encrypted:</span></span>
1.  <span data-ttu-id="aea28-212">Controllare se la chiave di crittografia dei dati per l'account Data Lake Store è memorizzata nella cache e può essere usata.</span><span class="sxs-lookup"><span data-stu-id="aea28-212">Check if the DEK for the Data Lake Store account is cached and ready for use.</span></span>
    - <span data-ttu-id="aea28-213">In caso contrario, leggere la chiave di crittografia dei dati crittografata dalla risorsa di archiviazione persistente e inviarla a Key Vault per la decrittografia.</span><span class="sxs-lookup"><span data-stu-id="aea28-213">If not, then read the encrypted DEK from persistent storage, and send it to Key Vault to be decrypted.</span></span> <span data-ttu-id="aea28-214">Memorizzare nella cache la chiave di crittografia dei dati decrittografata.</span><span class="sxs-lookup"><span data-stu-id="aea28-214">Cache the decrypted DEK in memory.</span></span> <span data-ttu-id="aea28-215">Ora è possibile usarla.</span><span class="sxs-lookup"><span data-stu-id="aea28-215">It is now ready to use.</span></span>
2.  <span data-ttu-id="aea28-216">Generare una chiave di crittografia a blocchi univoca per il blocco di dati dalla chiave di crittografia dei dati.</span><span class="sxs-lookup"><span data-stu-id="aea28-216">Generate a unique BEK for the block of data from the DEK.</span></span>
3.  <span data-ttu-id="aea28-217">Crittografare il blocco di dati con la chiave di crittografia a blocchi usando la crittografia AES-256.</span><span class="sxs-lookup"><span data-stu-id="aea28-217">Encrypt the data block with the BEK, by using AES-256 encryption.</span></span>
4.  <span data-ttu-id="aea28-218">Archiviare il blocco di dati crittografato in una risorsa di archiviazione persistente.</span><span class="sxs-lookup"><span data-stu-id="aea28-218">Store the encrypted data block of data on persistent storage.</span></span>

> [!NOTE] 
> <span data-ttu-id="aea28-219">Per motivi di prestazioni, la chiave di crittografia dei dati in chiaro viene memorizzata nella cache per breve tempo e poi immediatamente cancellata.</span><span class="sxs-lookup"><span data-stu-id="aea28-219">For performance reasons, the DEK in the clear is cached in memory for a short time, and is immediately erased afterward.</span></span> <span data-ttu-id="aea28-220">Nei supporti persistenti viene sempre archiviata dopo essere stata crittografata dalla chiave di crittografia master.</span><span class="sxs-lookup"><span data-stu-id="aea28-220">On persistent media, it is always stored encrypted by the MEK.</span></span>

## <a name="key-rotation"></a><span data-ttu-id="aea28-221">Rotazione delle chiavi</span><span class="sxs-lookup"><span data-stu-id="aea28-221">Key rotation</span></span>

<span data-ttu-id="aea28-222">Quando si usano le chiavi gestite dal cliente, è possibile ruotare la chiave di crittografia master.</span><span class="sxs-lookup"><span data-stu-id="aea28-222">When you are using customer-managed keys, you can rotate the MEK.</span></span> <span data-ttu-id="aea28-223">Per informazioni su come configurare un account Data Lake Store con chiavi gestite dal cliente, vedere [Introduzione](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).</span><span class="sxs-lookup"><span data-stu-id="aea28-223">To learn how to set up a Data Lake Store account with customer-managed keys, see [Getting started](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).</span></span>

### <a name="prerequisites"></a><span data-ttu-id="aea28-224">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="aea28-224">Prerequisites</span></span>

<span data-ttu-id="aea28-225">Quando si è configurato l'account Data Lake Store, si è scelto di usare le proprie chiavi.</span><span class="sxs-lookup"><span data-stu-id="aea28-225">When you set up the Data Lake Store account, you have chosen to use your own keys.</span></span> <span data-ttu-id="aea28-226">Questa opzione non può essere modificata dopo la creazione dell'account.</span><span class="sxs-lookup"><span data-stu-id="aea28-226">This option cannot be changed after the account has been created.</span></span> <span data-ttu-id="aea28-227">I passaggi seguenti presuppongono che si usino chiavi gestite dal cliente, ovvero che si siano scelte le chiavi da Key Vault.</span><span class="sxs-lookup"><span data-stu-id="aea28-227">The following steps assume that you are using customer-managed keys (that is, you have chosen your own keys from Key Vault).</span></span>

<span data-ttu-id="aea28-228">Tenere presente che, se si usano le opzioni predefinite per la crittografia, i dati vengono sempre crittografati usando le chiavi gestite da Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="aea28-228">Note that if you use the default options for encryption, your data is always encrypted by using keys managed by Data Lake Store.</span></span> <span data-ttu-id="aea28-229">Con questa opzione l'utente non può ruotare le chiavi perché sono gestite da Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="aea28-229">In this option, you don't have the ability to rotate keys, as they are managed by Data Lake Store.</span></span>

### <a name="how-to-rotate-the-mek-in-data-lake-store"></a><span data-ttu-id="aea28-230">Come ruotare la chiave di crittografia master in Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="aea28-230">How to rotate the MEK in Data Lake Store</span></span>

1. <span data-ttu-id="aea28-231">Accedere al [portale di Azure](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="aea28-231">Sign in to the [Azure portal](https://portal.azure.com/).</span></span>
2. <span data-ttu-id="aea28-232">Passare all'istanza di Key Vault in cui sono archiviate le chiavi associate all'account Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="aea28-232">Browse to the Key Vault instance that stores your keys associated with your Data Lake Store account.</span></span> <span data-ttu-id="aea28-233">Selezionare **Chiavi**.</span><span class="sxs-lookup"><span data-stu-id="aea28-233">Select **Keys**.</span></span>

    ![Screenshot di Key Vault](./media/data-lake-store-encryption/keyvault.png)

3.  <span data-ttu-id="aea28-235">Selezionare la chiave associata all'account Data Lake Store e creare una nuova versione di questa chiave.</span><span class="sxs-lookup"><span data-stu-id="aea28-235">Select the key associated with your Data Lake Store account, and create a new version of this key.</span></span> <span data-ttu-id="aea28-236">Si noti che Data Lake Store attualmente supporta solo la rotazione a una nuova versione di una chiave.</span><span class="sxs-lookup"><span data-stu-id="aea28-236">Note that Data Lake Store currently only supports key rotation to a new version of a key.</span></span> <span data-ttu-id="aea28-237">Non supporta la rotazione a una chiave diversa.</span><span class="sxs-lookup"><span data-stu-id="aea28-237">It doesn't support rotating to a different key.</span></span>

   ![Screenshot della finestra Chiavi con Nuova versione in evidenza](./media/data-lake-store-encryption/keynewversion.png)

4.  <span data-ttu-id="aea28-239">Passare all'account di archiviazione di Data Lake Store e selezionare **Crittografia**.</span><span class="sxs-lookup"><span data-stu-id="aea28-239">Browse to the Data Lake Store storage account, and select **Encryption**.</span></span>

    ![Screenshot della finestra dell'account di archiviazione di Data Lake Store con Crittografia in evidenza](./media/data-lake-store-encryption/select-encryption.png)

5.  <span data-ttu-id="aea28-241">Un messaggio notifica che è disponibile una nuova versione della chiave.</span><span class="sxs-lookup"><span data-stu-id="aea28-241">A message notifies you that a new key version of the key is available.</span></span> <span data-ttu-id="aea28-242">Fare clic su **Ruota chiave** per aggiornare la chiave alla nuova versione.</span><span class="sxs-lookup"><span data-stu-id="aea28-242">Click **Rotate Key** to update the key to the new version.</span></span>

    ![Screenshot della finestra Data Lake Store con il messaggio e Ruota chiave in evidenza](./media/data-lake-store-encryption/rotatekey.png)

<span data-ttu-id="aea28-244">Questa operazione richiederà meno di due minuti e non sono previsti tempi di inattività a causa della rotazione della chiave.</span><span class="sxs-lookup"><span data-stu-id="aea28-244">This operation should take less than two minutes, and there is no expected downtime due to key rotation.</span></span> <span data-ttu-id="aea28-245">Al termine dell'operazione, sarà in uso la nuova versione della chiave.</span><span class="sxs-lookup"><span data-stu-id="aea28-245">After the operation is complete, the new version of the key is in use.</span></span>
