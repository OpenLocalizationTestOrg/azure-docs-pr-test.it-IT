---
title: "Testabilità: comunicazione tra servizi | Documentazione Microsoft"
description: Le comunicazioni da servizio a servizio sono un punto di integrazione critico di un'applicazione Infrastruttura di servizi. Questo articolo illustra alcune considerazioni di progettazione e tecniche di test.
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: 017557df-fb59-4e4a-a65d-2732f29255b8
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: 4a8f941c1e8e641384a9ee3a1149dabaaf9983cc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="service-fabric-testability-scenarios-service-communication"></a><span data-ttu-id="1e3cb-104">Scenari di Testabilità di Service Fabric: comunicazione tra servizi</span><span class="sxs-lookup"><span data-stu-id="1e3cb-104">Service Fabric testability scenarios: Service communication</span></span>
<span data-ttu-id="1e3cb-105">Gli stili dell'architettura orientata ai microservizi e ai servizi vengono visualizzati naturalmente in Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-105">Microservices and service-oriented architectural styles surface naturally in Azure Service Fabric.</span></span> <span data-ttu-id="1e3cb-106">In questi tipi di architetture distribuite, microservizio componenti applicazioni sono in genere composti da più servizi necessari tootalk tooeach altri.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-106">In these types of distributed architectures, componentized microservice applications are typically composed of multiple services that need tootalk tooeach other.</span></span> <span data-ttu-id="1e3cb-107">In casi più semplici anche hello, è in genere almeno un servizio web senza stato e un servizio di archiviazione di dati con stato che richiedono toocommunicate.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-107">In even hello simplest cases, you generally have at least a stateless web service and a stateful data storage service that need toocommunicate.</span></span>

<span data-ttu-id="1e3cb-108">Comunicazione da servizio a servizio è un punto di integrazione critici di un'applicazione, perché ogni servizio espone un servizi tooother API remoto.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-108">Service-to-service communication is a critical integration point of an application, because each service exposes a remote API tooother services.</span></span> <span data-ttu-id="1e3cb-109">L'uso di un set di limiti di API che coinvolgono l'I/O richiede in genere particolare attenzione e diverse operazioni di test e di convalida.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-109">Working with a set of API boundaries that involves I/O generally requires some care, with a good amount of testing and validation.</span></span>

<span data-ttu-id="1e3cb-110">Esistono numerosi toomake considerazioni quando questi limiti di servizio sono collegati in un sistema distribuito:</span><span class="sxs-lookup"><span data-stu-id="1e3cb-110">There are numerous considerations toomake when these service boundaries are wired together in a distributed system:</span></span>

* <span data-ttu-id="1e3cb-111">*Protocollo di trasporto*.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-111">*Transport protocol*.</span></span> <span data-ttu-id="1e3cb-112">Si userà HTTP per una maggiore interoperabilità o un protocollo binario personalizzato per la velocità effettiva massima?</span><span class="sxs-lookup"><span data-stu-id="1e3cb-112">Will you use HTTP for increased interoperability, or a custom binary protocol for maximum throughput?</span></span>
* <span data-ttu-id="1e3cb-113">*Gestione degli errori*.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-113">*Error handling*.</span></span> <span data-ttu-id="1e3cb-114">Come vengono gestiti gli errori permanenti e temporanei?</span><span class="sxs-lookup"><span data-stu-id="1e3cb-114">How will permanent and transient errors be handled?</span></span> <span data-ttu-id="1e3cb-115">Cosa succede quando un servizio sposta nodo diverso tooa?</span><span class="sxs-lookup"><span data-stu-id="1e3cb-115">What will happen when a service moves tooa different node?</span></span>
* <span data-ttu-id="1e3cb-116">*Timeout e latenza*.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-116">*Timeouts and latency*.</span></span> <span data-ttu-id="1e3cb-117">Nelle applicazioni multilivello, la modalità di ogni livello di servizio Gestione latenza attraverso l'utente di stack e toohello hello?</span><span class="sxs-lookup"><span data-stu-id="1e3cb-117">In multitiered applications, how will each service layer handle latency through hello stack and toohello user?</span></span>

<span data-ttu-id="1e3cb-118">Se si utilizza uno dei componenti di comunicazione servizio integrato hello forniti dall'infrastruttura di servizio o si compila la propria, il test di interazioni hello tra i servizi è critico tooensuring resilienza nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-118">Whether you use one of hello built-in service communication components provided by Service Fabric or you build your own, testing hello interactions between your services is critical tooensuring resiliency in your application.</span></span>

## <a name="prepare-for-services-toomove"></a><span data-ttu-id="1e3cb-119">Preparare servizi toomove</span><span class="sxs-lookup"><span data-stu-id="1e3cb-119">Prepare for services toomove</span></span>
<span data-ttu-id="1e3cb-120">Le istanze del servizio possono spostarsi nel tempo.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-120">Service instances may move around over time.</span></span> <span data-ttu-id="1e3cb-121">Ciò vale soprattutto se vengono configurate con la metrica di caricamento per il bilanciamento delle risorse ottimizzato personalizzato.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-121">This is especially true when they are configured with load metrics for custom-tailored optimal resource balancing.</span></span> <span data-ttu-id="1e3cb-122">Service Fabric Sposta toomaximize di istanze del servizio alla disponibilità anche durante gli aggiornamenti, i failover, scalabilità orizzontale e altre situazioni che si verificano nel corso della durata di un sistema distribuito hello.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-122">Service Fabric moves your service instances toomaximize their availability even during upgrades, failovers, scale-out, and other situations that occur over hello lifetime of a distributed system.</span></span>

<span data-ttu-id="1e3cb-123">Come spostare i servizi cluster hello, i client e altri servizi devono essere preparata toohandle due scenari quando dibattito tooa servizio:</span><span class="sxs-lookup"><span data-stu-id="1e3cb-123">As services move around in hello cluster, your clients and other services should be prepared toohandle two scenarios when they talk tooa service:</span></span>

* <span data-ttu-id="1e3cb-124">replica del servizio Hello istanza o una partizione è stata spostata dall'ultima volta che è parlato tooit hello.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-124">hello service instance or partition replica has moved since hello last time you talked tooit.</span></span> <span data-ttu-id="1e3cb-125">Questa è una parte di un ciclo di vita del servizio normale e deve essere toohappen previsto nel corso della durata hello dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-125">This is a normal part of a service lifecycle, and it should be expected toohappen during hello lifetime of your application.</span></span>
* <span data-ttu-id="1e3cb-126">replica partizione o l'istanza del servizio Hello è in corso di hello dello spostamento.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-126">hello service instance or partition replica is in hello process of moving.</span></span> <span data-ttu-id="1e3cb-127">Anche se si verifica il failover di un servizio da un nodo tooanother molto rapidamente nell'infrastruttura del servizio, si potrebbe verificarsi un ritardo nella disponibilità se il componente di comunicazione hello del servizio è toostart lento.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-127">Although failover of a service from one node tooanother occurs very quickly in Service Fabric, there may be a delay in availability if hello communication component of your service is slow toostart.</span></span>

<span data-ttu-id="1e3cb-128">La gestione normale di questi scenari è importante per garantire che il sistema funzioni senza problemi.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-128">Handling these scenarios gracefully is important for a smooth-running system.</span></span> <span data-ttu-id="1e3cb-129">toodo in tal caso, tenere presente che:</span><span class="sxs-lookup"><span data-stu-id="1e3cb-129">toodo so, keep in mind that:</span></span>

* <span data-ttu-id="1e3cb-130">Ogni servizio che può essere connesso toohas un *indirizzo* che è in ascolto (ad esempio, HTTP o WebSocket).</span><span class="sxs-lookup"><span data-stu-id="1e3cb-130">Every service that can be connected toohas an *address* that it listens on (for example, HTTP or WebSockets).</span></span> <span data-ttu-id="1e3cb-131">Quando un'istanza o una partizione del servizio si sposta, il relativo endpoint dell'indirizzo cambia.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-131">When a service instance or partition moves, its address endpoint changes.</span></span> <span data-ttu-id="1e3cb-132">(Sposta tooa nodo diverso con un indirizzo IP diverso). Se si utilizzano i componenti di comunicazione predefiniti hello, gestiscono nuovamente risoluzione indirizzi del servizio per l'utente.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-132">(It moves tooa different node with a different IP address.) If you're using hello built-in communication components, they will handle re-resolving service addresses for you.</span></span>
* <span data-ttu-id="1e3cb-133">Potrebbe esserci un aumento della latenza di servizio come servizio hello istanza viene avviato il listener del temporaneo nuovamente.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-133">There may be a temporary increase in service latency as hello service instance starts up its listener again.</span></span> <span data-ttu-id="1e3cb-134">Dipende dal servizio hello apre rapidamente come listener hello dopo lo spostamento di istanza del servizio hello.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-134">This depends on how quickly hello service opens hello listener after hello service instance is moved.</span></span>
* <span data-ttu-id="1e3cb-135">Tutte le connessioni esistenti necessario toobe chiuso e riaperto dopo l'apertura di servizio hello in un nuovo nodo.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-135">Any existing connections need toobe closed and reopened after hello service opens on a new node.</span></span> <span data-ttu-id="1e3cb-136">Riavvio o arresto normale nodo consente di tempo per arrestare normalmente esistente toobe di connessioni.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-136">A graceful node shutdown or restart allows time for existing connections toobe shut down gracefully.</span></span>

### <a name="test-it-move-service-instances"></a><span data-ttu-id="1e3cb-137">Test: spostare istanze del servizio</span><span class="sxs-lookup"><span data-stu-id="1e3cb-137">Test it: Move service instances</span></span>
<span data-ttu-id="1e3cb-138">Tramite strumenti testabilità dell'infrastruttura servizio, è possibile creare un tootest uno scenario di test queste situazioni in modi diversi:</span><span class="sxs-lookup"><span data-stu-id="1e3cb-138">By using Service Fabric's testability tools, you can author a test scenario tootest these situations in different ways:</span></span>

1. <span data-ttu-id="1e3cb-139">Spostare la replica primaria di un servizio con stato.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-139">Move a stateful service's primary replica.</span></span>
   
    <span data-ttu-id="1e3cb-140">Hello replica primaria di una partizione di servizio con stato può essere spostato per diversi motivi.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-140">hello primary replica of a stateful service partition can be moved for any number of reasons.</span></span> <span data-ttu-id="1e3cb-141">Utilizzare questa replica primaria di hello tootarget di toosee una partizione specifica come il toohello react servizi vengono spostati in modo molto controllato.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-141">Use this tootarget hello primary replica of a specific partition toosee how your services react toohello move in a very controlled manner.</span></span>
   
    ```powershell
   
    PS > Move-ServiceFabricPrimaryReplica -PartitionId 6faa4ffa-521a-44e9-8351-dfca0f7e0466 -ServiceName fabric:/MyApplication/MyService
   
    ```
2. <span data-ttu-id="1e3cb-142">Arrestare un nodo.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-142">Stop a node.</span></span>
   
    <span data-ttu-id="1e3cb-143">Quando un nodo viene arrestato, Service Fabric passa tutti hello service istanze o le partizioni presenti tooone tale nodo di hello altri nodi disponibili nel cluster hello.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-143">When a node is stopped, Service Fabric moves all of hello service instances or partitions that were on that node tooone of hello other available nodes in hello cluster.</span></span> <span data-ttu-id="1e3cb-144">Utilizzare questa situazione in cui un nodo viene perduto dal cluster e tutte le istanze del servizio hello e delle repliche su tale nodo hanno toomove tootest.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-144">Use this tootest a situation where a node is lost from your cluster and all of hello service instances and replicas on that node have toomove.</span></span>
   
    <span data-ttu-id="1e3cb-145">È possibile arrestare un nodo utilizzando hello PowerShell **Stop ServiceFabricNode** cmdlet:</span><span class="sxs-lookup"><span data-stu-id="1e3cb-145">You can stop a node by using hello PowerShell **Stop-ServiceFabricNode** cmdlet:</span></span>
   
    ```powershell
   
    PS > Restart-ServiceFabricNode -NodeName Node_1
   
    ```

## <a name="maintain-service-availability"></a><span data-ttu-id="1e3cb-146">Mantenere la disponibilità del servizio</span><span class="sxs-lookup"><span data-stu-id="1e3cb-146">Maintain service availability</span></span>
<span data-ttu-id="1e3cb-147">Come piattaforma, Service Fabric è progettato tooprovide elevata disponibilità dei servizi.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-147">As a platform, Service Fabric is designed tooprovide high availability of your services.</span></span> <span data-ttu-id="1e3cb-148">In casi estremi, tuttavia, i problemi dell'infrastruttura sottostante possono comunque causare indisponibilità.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-148">But in extreme cases, underlying infrastructure problems can still cause unavailability.</span></span> <span data-ttu-id="1e3cb-149">È importante tootest per questi scenari, troppo.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-149">It is important tootest for these scenarios, too.</span></span>

<span data-ttu-id="1e3cb-150">Stato servizi utilizzano uno stato di sistema basato su quorum tooreplicate per la disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-150">Stateful services use a quorum-based system tooreplicate state for high availability.</span></span> <span data-ttu-id="1e3cb-151">Ciò significa che un quorum di repliche necessita di operazioni di scrittura toobe tooperform disponibile.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-151">This means that a quorum of replicas needs toobe available tooperform write operations.</span></span> <span data-ttu-id="1e3cb-152">In rari casi, ad esempio nel caso di errore hardware diffuso, potrebbe non essere disponibile un quorum di repliche.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-152">In rare cases, such as a widespread hardware failure, a quorum of replicas may not be available.</span></span> <span data-ttu-id="1e3cb-153">In questi casi, non sarà in grado di tooperform operazioni di scrittura, ma sarà comunque in grado di tooperform le operazioni di lettura.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-153">In these cases, you will not be able tooperform write operations, but you will still be able tooperform read operations.</span></span>

### <a name="test-it-write-operation-unavailability"></a><span data-ttu-id="1e3cb-154">Test: mancata disponibilità delle operazioni di scrittura</span><span class="sxs-lookup"><span data-stu-id="1e3cb-154">Test it: Write operation unavailability</span></span>
<span data-ttu-id="1e3cb-155">Tramite gli strumenti di testabilità hello nell'infrastruttura del servizio, è possibile inserire un errore che causa la perdita di quorum di un test.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-155">By using hello testability tools in Service Fabric, you can inject a fault that induces quorum loss as a test.</span></span> <span data-ttu-id="1e3cb-156">Sebbene tale scenario è poco frequente, è importante che i client e servizi che dipendono da un servizio con stato siano preparati toohandle situazioni in cui non sarà possibile prendere tooit le richieste di scrittura.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-156">Although such a scenario is rare, it is important that clients and services that depend on a stateful service are prepared toohandle situations where they cannot make write requests tooit.</span></span> <span data-ttu-id="1e3cb-157">È inoltre importante hello con stato servizio consapevole di questa possibilità che sia possano normalmente comunica toocallers.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-157">It is also important that hello stateful service itself is aware of this possibility and can gracefully communicate it toocallers.</span></span>

<span data-ttu-id="1e3cb-158">Si può provocare perdita del quorum utilizzando hello PowerShell **Invoke ServiceFabricPartitionQuorumLoss** cmdlet:</span><span class="sxs-lookup"><span data-stu-id="1e3cb-158">You can induce quorum loss by using hello PowerShell **Invoke-ServiceFabricPartitionQuorumLoss** cmdlet:</span></span>

```powershell

PS > Invoke-ServiceFabricPartitionQuorumLoss -ServiceName fabric:/Myapplication/MyService -QuorumLossMode QuorumReplicas -QuorumLossDurationInSeconds 20

```

<span data-ttu-id="1e3cb-159">In questo esempio viene impostato in modo `QuorumLossMode` troppo`QuorumReplicas` tooindicate da perdita del quorum tooinduce senza chiudere tutte le repliche.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-159">In this example, we set `QuorumLossMode` too`QuorumReplicas` tooindicate that we want tooinduce quorum loss without taking down all replicas.</span></span> <span data-ttu-id="1e3cb-160">In questo modo è comunque possibile eseguire le operazioni di lettura.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-160">This way, read operations are still possible.</span></span> <span data-ttu-id="1e3cb-161">tootest uno scenario in cui un'intera partizione non è disponibile, è possibile impostare questa opzione troppo`AllReplicas`.</span><span class="sxs-lookup"><span data-stu-id="1e3cb-161">tootest a scenario where an entire partition is unavailable, you can set this switch too`AllReplicas`.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1e3cb-162">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="1e3cb-162">Next steps</span></span>
[<span data-ttu-id="1e3cb-163">Azioni di Testabilità</span><span class="sxs-lookup"><span data-stu-id="1e3cb-163">Learn more about testability actions</span></span>](service-fabric-testability-actions.md)

[<span data-ttu-id="1e3cb-164">Scenari di Testabilità</span><span class="sxs-lookup"><span data-stu-id="1e3cb-164">Learn more about testability scenarios</span></span>](service-fabric-testability-scenarios.md)

