---
title: Specifica per l'inserimento live di un flusso MP4 frammentato con Servizi multimediali di Azure | Microsoft Docs
description: "Questa specifica descrive il protocollo e il formato per l'inserimento di streaming live basato sul formato MP4 frammentato per Servizi multimediali di Azure. È possibile usare Servizi multimediali di Azure per lo streaming di eventi live e la trasmissione di contenuti in tempo reale usando Azure come piattaforma cloud. Questo documento contiene anche le procedure consigliate per creare meccanismi di inserimento live solidi e altamente ridondanti."
services: media-services
documentationcenter: 
author: cenkdin
manager: cfowler
editor: 
ms.assetid: 43fac263-a5ea-44af-8dd5-cc88e423b4de
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/29/2017
ms.author: cenkd;juliako
ms.openlocfilehash: 6250b73504bec765b8299060a29e84e771791cc9
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/29/2017
---
# <a name="azure-media-services-fragmented-mp4-live-ingest-specification"></a><span data-ttu-id="d4273-105">Specifica per l'inserimento live di un flusso MP4 frammentato con Servizi multimediali di Azure</span><span class="sxs-lookup"><span data-stu-id="d4273-105">Azure Media Services fragmented MP4 live ingest specification</span></span>
<span data-ttu-id="d4273-106">Questa specifica descrive il protocollo e il formato per l'inserimento di streaming live basato sul formato MP4 frammentato per Servizi multimediali di Azure.</span><span class="sxs-lookup"><span data-stu-id="d4273-106">This specification describes the protocol and format for fragmented MP4-based live streaming ingestion for Azure Media Services.</span></span> <span data-ttu-id="d4273-107">Servizi multimediali fornisce un servizio di streaming live che può essere usato dai clienti per lo streaming di eventi live e la trasmissione di contenuti in tempo reale usando Azure come piattaforma cloud.</span><span class="sxs-lookup"><span data-stu-id="d4273-107">Media Services provides a live streaming service that customers can use to stream live events and broadcast content in real time by using Azure as the cloud platform.</span></span> <span data-ttu-id="d4273-108">Questo documento contiene anche le procedure consigliate per creare meccanismi di inserimento live solidi e altamente ridondanti.</span><span class="sxs-lookup"><span data-stu-id="d4273-108">This document also discusses best practices for building highly redundant and robust live ingest mechanisms.</span></span>

## <a name="1-conformance-notation"></a><span data-ttu-id="d4273-109">1. Nota di conformità</span><span class="sxs-lookup"><span data-stu-id="d4273-109">1. Conformance notation</span></span>
<span data-ttu-id="d4273-110">Le parole chiave "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY" e "OPTIONAL" usate in questo documento devono essere interpretate come descritto nella specifica RFC 2119.</span><span class="sxs-lookup"><span data-stu-id="d4273-110">The key words "MUST," "MUST NOT," "REQUIRED," "SHALL," "SHALL NOT," "SHOULD," "SHOULD NOT," "RECOMMENDED," "MAY," and "OPTIONAL" in this document are to be interpreted as they are described in RFC 2119.</span></span>

## <a name="2-service-diagram"></a><span data-ttu-id="d4273-111">2. Diagramma del servizio</span><span class="sxs-lookup"><span data-stu-id="d4273-111">2. Service diagram</span></span>
<span data-ttu-id="d4273-112">Il diagramma seguente mostra l'architettura di alto livello del servizio di streaming live in Servizi multimediali:</span><span class="sxs-lookup"><span data-stu-id="d4273-112">The following diagram shows the high-level architecture of the live streaming service in Media Services:</span></span>

1. <span data-ttu-id="d4273-113">Un codificatore live invia feed live a canali che sono stati creati e di cui è stato effettuato il provisioning tramite Azure Media Services SDK.</span><span class="sxs-lookup"><span data-stu-id="d4273-113">A live encoder pushes live feeds to channels that are created and provisioned via the Azure Media Services SDK.</span></span>
2. <span data-ttu-id="d4273-114">In Servizi multimediali la gestione di tutte le funzionalità di live streaming, tra cui inserimento, formattazione, DVR sul cloud, sicurezza, scalabilità e ridondanza, è affidata a canali, programmi ed endpoint di streaming.</span><span class="sxs-lookup"><span data-stu-id="d4273-114">Channels, programs, and streaming endpoints in Media Services handle all the live streaming functionalities, including ingest, formatting, cloud DVR, security, scalability, and redundancy.</span></span>
3. <span data-ttu-id="d4273-115">Facoltativamente, i clienti possono scegliere di distribuire un livello di rete CDN di Azure tra l'endpoint di streaming e gli endpoint client.</span><span class="sxs-lookup"><span data-stu-id="d4273-115">Optionally, customers can choose to deploy an Azure Content Delivery Network layer between the streaming endpoint and the client endpoints.</span></span>
4. <span data-ttu-id="d4273-116">Gli endpoint client trasmettono dall'endpoint di streaming tramite protocolli di flusso adattivo HTTP.</span><span class="sxs-lookup"><span data-stu-id="d4273-116">Client endpoints stream from the streaming endpoint by using HTTP Adaptive Streaming protocols.</span></span> <span data-ttu-id="d4273-117">Alcuni esempi includono Microsoft Smooth Streaming, flusso adattivo dinamico su HTTP (DASH o MPEG-DASH) e Apple HTTP Live Streaming (HLS).</span><span class="sxs-lookup"><span data-stu-id="d4273-117">Examples include Microsoft Smooth Streaming, Dynamic Adaptive Streaming over HTTP (DASH, or MPEG-DASH), and Apple HTTP Live Streaming (HLS).</span></span>

![Flusso di inserimento][image1]

## <a name="3-bitstream-format--iso-14496-12-fragmented-mp4"></a><span data-ttu-id="d4273-119">3. Formato del flusso di bit: MP4 frammentato ISO 14496-12</span><span class="sxs-lookup"><span data-stu-id="d4273-119">3. Bitstream format – ISO 14496-12 fragmented MP4</span></span>
<span data-ttu-id="d4273-120">Il formato di trasmissione per l'inserimento di streaming live descritto in questo documento si basa sullo standard [ISO 14496-12].</span><span class="sxs-lookup"><span data-stu-id="d4273-120">The wire format for live streaming ingest discussed in this document is based on [ISO-14496-12].</span></span> <span data-ttu-id="d4273-121">Per una spiegazione dettagliata del formato MP4 frammentato e delle estensioni disponibili per i file video on demand e l'inserimento di streaming live, vedere [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="d4273-121">For a detailed explanation of fragmented MP4 format and extensions both for video-on-demand files and live streaming ingestion, see [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span></span>

### <a name="live-ingest-format-definitions"></a><span data-ttu-id="d4273-122">Definizioni del formato di inserimento live</span><span class="sxs-lookup"><span data-stu-id="d4273-122">Live ingest format definitions</span></span>
<span data-ttu-id="d4273-123">L'elenco seguente descrive le definizioni di formato speciali applicabili all'inserimento live in Servizi multimediali di Azure:</span><span class="sxs-lookup"><span data-stu-id="d4273-123">The following list describes special format definitions that apply to live ingest into Azure Media Services:</span></span>

1. <span data-ttu-id="d4273-124">Le caselle **ftyp**, **Live Server Manifest Box** e **moov** devono (MUST) essere inviate con ogni richiesta (HTTP POST).</span><span class="sxs-lookup"><span data-stu-id="d4273-124">The **ftyp**, **Live Server Manifest Box**, and **moov** boxes MUST be sent with each request (HTTP POST).</span></span> <span data-ttu-id="d4273-125">Le caselle devono (MUST) essere inviate all'inizio del flusso e ogni volta che il codificatore deve riconnettersi per riprendere l'inserimento del flusso.</span><span class="sxs-lookup"><span data-stu-id="d4273-125">These boxes MUST be sent at the beginning of the stream and any time the encoder must reconnect to resume stream ingest.</span></span> <span data-ttu-id="d4273-126">Per altre informazioni, vedere la sezione 6 di [1].</span><span class="sxs-lookup"><span data-stu-id="d4273-126">For more information, see Section 6 in [1].</span></span>
2. <span data-ttu-id="d4273-127">La sezione 3.3.2 di [1] definisce una casella facoltativa chiamata **StreamManifestBox** per l'inserimento live.</span><span class="sxs-lookup"><span data-stu-id="d4273-127">Section 3.3.2 in [1] defines an optional box called **StreamManifestBox** for live ingest.</span></span> <span data-ttu-id="d4273-128">A causa della logica di routing del bilanciamento del carico di Azure, l'uso di questa casella è deprecato.</span><span class="sxs-lookup"><span data-stu-id="d4273-128">Due to the routing logic of the Azure load balancer, using this box is deprecated.</span></span> <span data-ttu-id="d4273-129">La casella non deve (SHOULD NOT) essere presente durante l'inserimento in Servizi multimediali.</span><span class="sxs-lookup"><span data-stu-id="d4273-129">The box SHOULD NOT be present when ingesting into Media Services.</span></span> <span data-ttu-id="d4273-130">Se la casella è presente, Servizi multimediali la ignora automaticamente.</span><span class="sxs-lookup"><span data-stu-id="d4273-130">If this box is present, Media Services silently ignores it.</span></span>
3. <span data-ttu-id="d4273-131">La casella **TrackFragmentExtendedHeaderBox** definita nella sezione 3.2.3.2 di [1] deve (MUST) essere presente per ogni frammento.</span><span class="sxs-lookup"><span data-stu-id="d4273-131">The **TrackFragmentExtendedHeaderBox** box defined in 3.2.3.2 in [1] MUST be present for each fragment.</span></span>
4. <span data-ttu-id="d4273-132">La versione 2 della casella **TrackFragmentExtendedHeaderBox** dovrebbe (SHOULD) essere usata per generare segmenti multimediali con URL identici in più data center.</span><span class="sxs-lookup"><span data-stu-id="d4273-132">Version 2 of the **TrackFragmentExtendedHeaderBox** box SHOULD be used to generate media segments that have identical URLs in multiple datacenters.</span></span> <span data-ttu-id="d4273-133">Il campo di indice del frammento è obbligatorio (REQUIRED) per il failover tra data center di formati di streaming basati su indice, come Apple HTTP Live Streaming (HLS) e MPEG-DASH basato su indice.</span><span class="sxs-lookup"><span data-stu-id="d4273-133">The fragment index field is REQUIRED for cross-datacenter failover of index-based streaming formats such as Apple HLS and index-based MPEG-DASH.</span></span> <span data-ttu-id="d4273-134">Per abilitare il failover tra data center, l'indice del frammento deve (MUST) essere sincronizzato tra più codificatori e aumentare di un'unità per ogni frammento multimediale successivo, anche in caso di riavvii o errori del codificatore.</span><span class="sxs-lookup"><span data-stu-id="d4273-134">To enable cross-datacenter failover, the fragment index MUST be synced across multiple encoders and be increased by 1 for each successive media fragment, even across encoder restarts or failures.</span></span>
5. <span data-ttu-id="d4273-135">La sezione 3.3.6 di [1] definisce una casella chiamata **MovieFragmentRandomAccessBox** (**mfra**), che può (MAY) essere inviata al termine dell'inserimento live per indicare al canale la fine del flusso.</span><span class="sxs-lookup"><span data-stu-id="d4273-135">Section 3.3.6 in [1] defines a box called **MovieFragmentRandomAccessBox** (**mfra**) that MAY be sent at the end of live ingestion to indicate end-of-stream (EOS) to the channel.</span></span> <span data-ttu-id="d4273-136">A causa della logica di inserimento di Servizi multimediali, la fine del flusso è deprecata e la casella **mfra** per l'inserimento live non deve (SHOULD NOT) essere inviata.</span><span class="sxs-lookup"><span data-stu-id="d4273-136">Due to the ingest logic of Media Services, using EOS is deprecated, and the **mfra** box for live ingestion SHOULD NOT be sent.</span></span> <span data-ttu-id="d4273-137">Se viene inviata, Servizi multimediali la ignora automaticamente.</span><span class="sxs-lookup"><span data-stu-id="d4273-137">If sent, Media Services silently ignores it.</span></span> <span data-ttu-id="d4273-138">Per reimpostare lo stato del punto di inserimento, è consigliabile usare la [reimpostazione del canale](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span><span class="sxs-lookup"><span data-stu-id="d4273-138">To reset the state of the ingest point, we recommend that you use [Channel Reset](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span></span> <span data-ttu-id="d4273-139">È anche consigliabile usare l'[interruzione del programma](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) per terminare una presentazione e un flusso.</span><span class="sxs-lookup"><span data-stu-id="d4273-139">We also recommend that you use [Program Stop](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) to end a presentation and stream.</span></span>
6. <span data-ttu-id="d4273-140">La durata del frammento MP4 dovrebbe (SHOULD) essere costante, in modo da ridurre le dimensioni dei manifesti client.</span><span class="sxs-lookup"><span data-stu-id="d4273-140">The MP4 fragment duration SHOULD be constant, to reduce the size of the client manifests.</span></span> <span data-ttu-id="d4273-141">Una durata costante dei frammenti MP4 migliora anche l'approccio euristico di download del client tramite l'uso di tag ripetuti.</span><span class="sxs-lookup"><span data-stu-id="d4273-141">A constant MP4 fragment duration also improves client download heuristics through the use of repeat tags.</span></span> <span data-ttu-id="d4273-142">La durata può (MAY) variare per compensare frequenze di fotogrammi costituite da valori non interi.</span><span class="sxs-lookup"><span data-stu-id="d4273-142">The duration MAY fluctuate to compensate for non-integer frame rates.</span></span>
7. <span data-ttu-id="d4273-143">La durata del frammento MP4 dovrebbe (SHOULD) essere compresa tra 2 e 6 secondi circa.</span><span class="sxs-lookup"><span data-stu-id="d4273-143">The MP4 fragment duration SHOULD be between approximately 2 and 6 seconds.</span></span>
8. <span data-ttu-id="d4273-144">I timestamp e gli indici (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` e `fragment_index`) del frammento MP4 dovrebbero (SHOULD) arrivare in ordine crescente.</span><span class="sxs-lookup"><span data-stu-id="d4273-144">MP4 fragment timestamps and indexes (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` and `fragment_index`) SHOULD arrive in increasing order.</span></span> <span data-ttu-id="d4273-145">Benché Servizi multimediali sia resiliente alla duplicazione di frammenti, ha una capacità limitata di riordinare i frammenti in base alla sequenza temporale dei contenuti multimediali.</span><span class="sxs-lookup"><span data-stu-id="d4273-145">Although Media Services is resilient to duplicate fragments, it has limited ability to reorder fragments according to the media timeline.</span></span>

## <a name="4-protocol-format--http"></a><span data-ttu-id="d4273-146">4. Formato del protocollo: HTTP</span><span class="sxs-lookup"><span data-stu-id="d4273-146">4. Protocol format – HTTP</span></span>
<span data-ttu-id="d4273-147">L'inserimento live basato sul formato ISO MP4 frammentato per Servizi multimediali usa una richiesta HTTP POST standard a esecuzione prolungata per trasmettere al servizio dati multimediali codificati in formato MP4 frammentato.</span><span class="sxs-lookup"><span data-stu-id="d4273-147">ISO fragmented MP4-based live ingest for Media Services uses a standard long-running HTTP POST request to transmit encoded media data that is packaged in fragmented MP4 format to the service.</span></span> <span data-ttu-id="d4273-148">Ogni richiesta HTTP POST invia un flusso di bit MP4 frammentato completo ("flusso"), iniziando con le caselle di intestazione (caselle **ftyp**, **Live Server Manifest Box** e **moov**) e continuando con una sequenza di frammenti (caselle **moof** e **mdat**).</span><span class="sxs-lookup"><span data-stu-id="d4273-148">Each HTTP POST sends a complete fragmented MP4 bitstream ("stream"), starting from the beginning with header boxes (**ftyp**, **Live Server Manifest Box**, and **moov** boxes), and continuing with a sequence of fragments (**moof** and **mdat** boxes).</span></span> <span data-ttu-id="d4273-149">Per la sintassi dell'URL per la richiesta HTTP POST, vedere la sezione 9.2 di [1].</span><span class="sxs-lookup"><span data-stu-id="d4273-149">For URL syntax for the HTTP POST request, see section 9.2 in [1].</span></span> <span data-ttu-id="d4273-150">Un esempio di URL POST è:</span><span class="sxs-lookup"><span data-stu-id="d4273-150">An example of the POST URL is:</span></span> 

    http://customer.channel.mediaservices.windows.net/ingest.isml/streams(720p)

### <a name="requirements"></a><span data-ttu-id="d4273-151">Requisiti</span><span class="sxs-lookup"><span data-stu-id="d4273-151">Requirements</span></span>
<span data-ttu-id="d4273-152">Di seguito sono elencati i requisiti dettagliati:</span><span class="sxs-lookup"><span data-stu-id="d4273-152">Here are the detailed requirements:</span></span>

1. <span data-ttu-id="d4273-153">Il codificatore dovrebbe (SHOULD) avviare la trasmissione inviando una richiesta HTTP POST con un "corpo" vuoto (lunghezza del contenuto pari a zero) mediante lo stesso URL di inserimento.</span><span class="sxs-lookup"><span data-stu-id="d4273-153">The encoder SHOULD start the broadcast by sending an HTTP POST request with an empty “body” (zero content length) by using the same ingestion URL.</span></span> <span data-ttu-id="d4273-154">In questo modo, il codificatore dovrebbe essere in grado di rilevare rapidamente se l'endpoint di inserimento live è valido e se sono necessarie l'autenticazione o altre condizioni.</span><span class="sxs-lookup"><span data-stu-id="d4273-154">This can help the encoder quickly detect whether the live ingestion endpoint is valid, and if there are any authentication or other conditions required.</span></span> <span data-ttu-id="d4273-155">Per il protocollo HTTP, il server non è in grado di restituire una risposta HTTP finché non viene ricevuta l'intera richiesta, incluso il corpo della richiesta POST.</span><span class="sxs-lookup"><span data-stu-id="d4273-155">Per HTTP protocol, the server can't send back an HTTP response until the entire request, including the POST body, is received.</span></span> <span data-ttu-id="d4273-156">A causa dell'esecuzione prolungata di un evento live, senza questo passaggio il codificatore potrebbe non essere in grado di rilevare alcun errore finché non viene completato l'invio di tutti i dati.</span><span class="sxs-lookup"><span data-stu-id="d4273-156">Given the long-running nature of a live event, without this step, the encoder might not be able to detect any error until it finishes sending all the data.</span></span>
2. <span data-ttu-id="d4273-157">Il codificatore deve (MUST) gestire eventuali errori o problemi di autenticazione a causa di quanto riportato in [1].</span><span class="sxs-lookup"><span data-stu-id="d4273-157">The encoder MUST handle any errors or authentication challenges because of (1).</span></span> <span data-ttu-id="d4273-158">Se in (1) è stata restituita una risposta 200, continua.</span><span class="sxs-lookup"><span data-stu-id="d4273-158">If (1) succeeds with a 200 response, continue.</span></span>
3. <span data-ttu-id="d4273-159">Il codificatore deve (MUST) avviare una nuova richiesta HTTP POST con il flusso MP4 frammentato.</span><span class="sxs-lookup"><span data-stu-id="d4273-159">The encoder MUST start a new HTTP POST request with the fragmented MP4 stream.</span></span> <span data-ttu-id="d4273-160">Il payload deve (MUST) iniziare con le caselle di intestazione, seguite dai frammenti.</span><span class="sxs-lookup"><span data-stu-id="d4273-160">The payload MUST start with the header boxes, followed by fragments.</span></span> <span data-ttu-id="d4273-161">Tenere presente che con ogni richiesta devono (MUST) essere inviate le caselle **ftyp**, **Live Server Manifest Box** e **moov** (in questo ordine), anche nel caso in cui il codificatore debba riconnettersi perché la richiesta precedente è stata terminata prima della fine del flusso.</span><span class="sxs-lookup"><span data-stu-id="d4273-161">Note that the **ftyp**, **Live Server Manifest Box**, and **moov** boxes (in this order) MUST be sent with each request, even if the encoder must reconnect because the previous request was terminated prior to the end of the stream.</span></span> 
4. <span data-ttu-id="d4273-162">Il codificatore deve (MUST) usare la codifica di trasferimento in blocchi per il caricamento, perché non è possibile prevedere la lunghezza dell'intero contenuto dell'evento live.</span><span class="sxs-lookup"><span data-stu-id="d4273-162">The encoder MUST use chunked transfer encoding for uploading, because it’s impossible to predict the entire content length of the live event.</span></span>
5. <span data-ttu-id="d4273-163">Al termine dell'evento, dopo aver inviato l'ultimo frammento, il codificatore deve (MUST) terminare normalmente la sequenza di messaggi della codifica di trasferimento in blocchi. La maggior parte degli stack client HTTP gestisce questo aspetto in modo automatico.</span><span class="sxs-lookup"><span data-stu-id="d4273-163">When the event is over, after sending the last fragment, the encoder MUST gracefully end the chunked transfer encoding message sequence (most HTTP client stacks handle it automatically).</span></span> <span data-ttu-id="d4273-164">Il codificatore deve (MUST) attendere che il servizio restituisca il codice di risposta finale e quindi terminare la connessione.</span><span class="sxs-lookup"><span data-stu-id="d4273-164">The encoder MUST wait for the service to return the final response code, and then terminate the connection.</span></span> 
6. <span data-ttu-id="d4273-165">Il codificatore non deve (MUST NOT) usare il nome`Events()` come descritto nella sezione 9.2 di [1] per l'inserimento live in Servizi multimediali.</span><span class="sxs-lookup"><span data-stu-id="d4273-165">The encoder MUST NOT use the `Events()` noun as described in 9.2 in [1] for live ingestion into Media Services.</span></span>
7. <span data-ttu-id="d4273-166">Se la richiesta HTTP POST viene terminata o causa un timeout con errore TCP prima della fine del flusso, il codificatore deve (MUST) inviare un'altra richiesta POST usando una nuova connessione, seguendo i requisiti precedenti.</span><span class="sxs-lookup"><span data-stu-id="d4273-166">If the HTTP POST request terminates or times out with a TCP error prior to the end of the stream, the encoder MUST issue a new POST request by using a new connection, and follow the preceding requirements.</span></span> <span data-ttu-id="d4273-167">Inoltre, il codificatore deve (MUST) inviare di nuovo i due frammenti MP4 precedenti per ogni traccia nel flusso e riprendere senza introdurre discontinuità nella sequenza temporale dei contenuti multimediali.</span><span class="sxs-lookup"><span data-stu-id="d4273-167">Additionally, the encoder MUST resend the previous two MP4 fragments for each track in the stream, and resume without introducing a discontinuity in the media timeline.</span></span> <span data-ttu-id="d4273-168">L'invio degli ultimi due frammenti MP4 per ogni traccia impedisce eventuali perdite di dati.</span><span class="sxs-lookup"><span data-stu-id="d4273-168">Resending the last two MP4 fragments for each track ensures that there is no data loss.</span></span> <span data-ttu-id="d4273-169">In altre parole, se un flusso contiene una traccia audio e una tracia video e la richiesta POST corrente non riesce, il codificatore deve riconnettersi e inviare gli ultimi due frammenti per la traccia audio, già correttamente inviati in precedenza, e gli ultimi due frammenti per la traccia video, anch'essi già inviati correttamente, in modo da garantire che non si siano verificate perdite di dati.</span><span class="sxs-lookup"><span data-stu-id="d4273-169">In other words, if a stream contains both an audio and a video track, and the current POST request fails, the encoder must reconnect and resend the last two fragments for the audio track, which were previously successfully sent, and the last two fragments for the video track, which were previously successfully sent, to ensure that there is no data loss.</span></span> <span data-ttu-id="d4273-170">Il codificatore deve (MUST) mantenere un buffer "anticipato" di frammenti di contenuti, che invia di nuovo quando si riconnette.</span><span class="sxs-lookup"><span data-stu-id="d4273-170">The encoder MUST maintain a “forward” buffer of media fragments, which it resends when it reconnects.</span></span>

## <a name="5-timescale"></a><span data-ttu-id="d4273-171">5. Scala cronologica</span><span class="sxs-lookup"><span data-stu-id="d4273-171">5. Timescale</span></span>
<span data-ttu-id="d4273-172">[[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx) descrive l'utilizzo della scala cronologica per **SmoothStreamingMedia** (sezione 2.2.2.1), **StreamElement** (sezione 2.2.2.3), **StreamFragmentElement** (sezione 2.2.2.6) e **LiveSMIL** (sezione 2.2.7.3.1).</span><span class="sxs-lookup"><span data-stu-id="d4273-172">[[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx) describes the usage of timescale for **SmoothStreamingMedia** (Section 2.2.2.1), **StreamElement** (Section 2.2.2.3), **StreamFragmentElement** (Section 2.2.2.6), and **LiveSMIL** (Section 2.2.7.3.1).</span></span> <span data-ttu-id="d4273-173">Se non è presente un valore di scala cronologica, viene usato il valore predefinito 10.000.000 (10 MHz).</span><span class="sxs-lookup"><span data-stu-id="d4273-173">If the timescale value is not present, the default value used is 10,000,000 (10 MHz).</span></span> <span data-ttu-id="d4273-174">Benché le specifiche del formato Smooth Streaming non impediscano l'utilizzo di altri valori di scala cronologica, la maggior parte delle implementazioni dei codificatori usa questo valore predefinito (10 MHz) per generare dati di inserimento Smooth Streaming.</span><span class="sxs-lookup"><span data-stu-id="d4273-174">Although the Smooth Streaming format specification doesn’t block usage of other timescale values, most encoder implementations use this default value (10 MHz) to generate Smooth Streaming ingest data.</span></span> <span data-ttu-id="d4273-175">A causa della funzionalità di [creazione dinamica dei pacchetti di Servizi multimediali di Azure](media-services-dynamic-packaging-overview.md) , è consigliabile usare un valore di scala cronologica pari a 90 kHz per i flussi video e a 44,1 o 48,1 kHz per i flussi audio.</span><span class="sxs-lookup"><span data-stu-id="d4273-175">Due to the [Azure Media Dynamic Packaging](media-services-dynamic-packaging-overview.md) feature, we recommend that you use a 90-KHz timescale for video streams and 44.1 KHz or 48.1 KHz for audio streams.</span></span> <span data-ttu-id="d4273-176">Se vengono usati valori di scala cronologica differenti per flussi diversi, è necessario (MUST) inviare il valore di scala cronologica del livello di flusso.</span><span class="sxs-lookup"><span data-stu-id="d4273-176">If different timescale values are used for different streams, the stream-level timescale MUST be sent.</span></span> <span data-ttu-id="d4273-177">Per altre informazioni, vedere [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="d4273-177">For more information, see [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span></span>     

## <a name="6-definition-of-stream"></a><span data-ttu-id="d4273-178">6. Definizione di "flusso"</span><span class="sxs-lookup"><span data-stu-id="d4273-178">6. Definition of “stream”</span></span>
<span data-ttu-id="d4273-179">Il flusso è l'unità operativa di base nel processo di inserimento live per la composizione di presentazioni live, la gestione del failover di streaming e gli scenari di ridondanza.</span><span class="sxs-lookup"><span data-stu-id="d4273-179">Stream is the basic unit of operation in live ingestion for composing live presentations, handling streaming failover, and redundancy scenarios.</span></span> <span data-ttu-id="d4273-180">Il flusso è definito come un flusso di bit MP4 frammentato univoco che può contenere una singola traccia o più tracce.</span><span class="sxs-lookup"><span data-stu-id="d4273-180">Stream is defined as one unique, fragmented MP4 bitstream that might contain a single track or multiple tracks.</span></span> <span data-ttu-id="d4273-181">Una presentazione live completa può contenere uno o più flussi, a seconda della configurazione dei codificatori live.</span><span class="sxs-lookup"><span data-stu-id="d4273-181">A full live presentation might contain one or more streams, depending on the configuration of the live encoders.</span></span> <span data-ttu-id="d4273-182">Gli esempi seguenti mostrano varie modalità d'uso dei flussi per comporre una presentazione live completa.</span><span class="sxs-lookup"><span data-stu-id="d4273-182">The following examples illustrate various options of using streams to compose a full live presentation.</span></span>

<span data-ttu-id="d4273-183">**Esempio:**</span><span class="sxs-lookup"><span data-stu-id="d4273-183">**Example:**</span></span> 

<span data-ttu-id="d4273-184">Un cliente vuole creare una presentazione in streaming live che includa le velocità in bit audio/video seguenti:</span><span class="sxs-lookup"><span data-stu-id="d4273-184">A customer wants to create a live streaming presentation that includes the following audio/video bitrates:</span></span>

<span data-ttu-id="d4273-185">Video: 3000 kbps, 1500 kbps, 750 kbps</span><span class="sxs-lookup"><span data-stu-id="d4273-185">Video – 3000 kbps, 1500 kbps, 750 kbps</span></span>

<span data-ttu-id="d4273-186">Audio: 128 kbps</span><span class="sxs-lookup"><span data-stu-id="d4273-186">Audio – 128 kbps</span></span>

### <a name="option-1-all-tracks-in-one-stream"></a><span data-ttu-id="d4273-187">Opzione 1: tutte le tracce in un flusso</span><span class="sxs-lookup"><span data-stu-id="d4273-187">Option 1: All tracks in one stream</span></span>
<span data-ttu-id="d4273-188">In questo caso, un unico codificatore genera tutte le tracce audio/video e le aggrega in un flusso di bit MP4 frammentato.</span><span class="sxs-lookup"><span data-stu-id="d4273-188">In this option, a single encoder generates all audio/video tracks, and then bundles them into one fragmented MP4 bitstream.</span></span> <span data-ttu-id="d4273-189">Il flusso di bit MP4 frammentato viene quindi inviato tramite una singola connessione HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="d4273-189">The fragmented MP4 bitstream is then sent via a single HTTP POST connection.</span></span> <span data-ttu-id="d4273-190">In questo esempio è presente un solo flusso per la presentazione live.</span><span class="sxs-lookup"><span data-stu-id="d4273-190">In this example, there is only one stream for this live presentation.</span></span>

![Flussi - Una traccia][image2]

### <a name="option-2-each-track-in-a-separate-stream"></a><span data-ttu-id="d4273-192">Opzione 2: ogni traccia in un flusso separato</span><span class="sxs-lookup"><span data-stu-id="d4273-192">Option 2: Each track in a separate stream</span></span>
<span data-ttu-id="d4273-193">In questo caso, il codificatore inserisce una traccia in ogni flusso di bit MP4 frammentato e quindi registra tutti i flussi tramite più connessioni HTTP separate.</span><span class="sxs-lookup"><span data-stu-id="d4273-193">In this option, the encoder puts one track into each fragment MP4 bitstream, and then posts all of the streams over separate HTTP connections.</span></span> <span data-ttu-id="d4273-194">Questa operazione può essere eseguita con uno o più codificatori.</span><span class="sxs-lookup"><span data-stu-id="d4273-194">This can be done with one encoder or with multiple encoders.</span></span> <span data-ttu-id="d4273-195">Dal punto di vista dell'inserimento live, questa presentazione live è composta da quattro flussi.</span><span class="sxs-lookup"><span data-stu-id="d4273-195">The live ingestion sees this live presentation as composed of four streams.</span></span>

![Flussi - Tracce separate][image3]

### <a name="option-3-bundle-audio-track-with-the-lowest-bitrate-video-track-into-one-stream"></a><span data-ttu-id="d4273-197">Opzione 3: creare un bundle con una traccia audio e la traccia video a velocità in bit più bassa in un flusso</span><span class="sxs-lookup"><span data-stu-id="d4273-197">Option 3: Bundle audio track with the lowest bitrate video track into one stream</span></span>
<span data-ttu-id="d4273-198">In questo caso, il cliente sceglie di aggregare la traccia audio alla traccia video con la velocità in bit minore in un flusso di bit MP4 frammentato, lasciando le altre due tracce video come flussi separati.</span><span class="sxs-lookup"><span data-stu-id="d4273-198">In this option, the customer chooses to bundle the audio track with the lowest-bitrate video track in one fragment MP4 bitstream, and leave the other two video tracks as separate streams.</span></span> 

![Flussi - Tracce audio e video][image4]

### <a name="summary"></a><span data-ttu-id="d4273-200">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="d4273-200">Summary</span></span>
<span data-ttu-id="d4273-201">Questo non è un elenco completo di tutte le possibili opzioni di inserimento applicabili all'esempio.</span><span class="sxs-lookup"><span data-stu-id="d4273-201">This is not an exhaustive list of all possible ingestion options for this example.</span></span> <span data-ttu-id="d4273-202">In realtà, qualsiasi forma di raggruppamento di tracce in flussi è supportata dal processo di inserimento live.</span><span class="sxs-lookup"><span data-stu-id="d4273-202">As a matter of fact, any grouping of tracks into streams is supported by live ingestion.</span></span> <span data-ttu-id="d4273-203">Clienti e fornitori di codificatori possono scegliere le proprie implementazioni in base alla complessità di progettazione, alla capacità del codificatore e a considerazioni sui livelli di ridondanza e failover.</span><span class="sxs-lookup"><span data-stu-id="d4273-203">Customers and encoder vendors can choose their own implementations based on engineering complexity, encoder capacity, and redundancy and failover considerations.</span></span> <span data-ttu-id="d4273-204">Tuttavia, nella maggior parte dei casi è presente solo una traccia audio per l'intera presentazione live.</span><span class="sxs-lookup"><span data-stu-id="d4273-204">However, in most cases, there is only one audio track for the entire live presentation.</span></span> <span data-ttu-id="d4273-205">Di conseguenza, è importante garantire l'integrità del flusso di inserimento che contiene la traccia audio. Questa considerazione determina spesso la scelta di inserire la traccia audio in un flusso indipendente (come nell'opzione 2) o di aggregarla alla traccia video con velocità in bit minore (come nell'opzione 3).</span><span class="sxs-lookup"><span data-stu-id="d4273-205">So, it’s important to ensure the healthiness of the ingest stream that contains the audio track. This consideration often results in putting the audio track in its own stream (as in Option 2) or bundling it with the lowest-bitrate video track (as in Option 3).</span></span> <span data-ttu-id="d4273-206">Inoltre, per ottenere ridondanza e tolleranza di errore migliori, l'invio della stessa traccia audio in due flussi diversi (opzione 2 con tracce audio ridondanti) o l'aggregazione della traccia audio con almeno due delle tracce video con velocità in bit minore (opzione 3 con audio aggregato in almeno due flussi video) rappresenta la scelta consigliata per l'inserimento live in Servizi multimediali.</span><span class="sxs-lookup"><span data-stu-id="d4273-206">Also, for better redundancy and fault tolerance, sending the same audio track in two different streams (Option 2 with redundant audio tracks) or bundling the audio track with at least two of the lowest-bitrate video tracks (Option 3 with audio bundled in at least two video streams) is highly recommended for live ingest into Media Services.</span></span>

## <a name="7-service-failover"></a><span data-ttu-id="d4273-207">7. Failover del servizio</span><span class="sxs-lookup"><span data-stu-id="d4273-207">7. Service failover</span></span>
<span data-ttu-id="d4273-208">Data la particolare natura del live streaming, un buon livello di supporto per il failover è essenziale per garantire la disponibilità del servizio.</span><span class="sxs-lookup"><span data-stu-id="d4273-208">Given the nature of live streaming, good failover support is critical for ensuring the availability of the service.</span></span> <span data-ttu-id="d4273-209">Servizi multimediali è progettato per gestire errori di diversi tipi, tra cui errori di rete, errori del server e problemi di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="d4273-209">Media Services is designed to handle various types of failures, including network errors, server errors, and storage issues.</span></span> <span data-ttu-id="d4273-210">Se usato insieme a una logica di failover adeguata dal lato del codificatore live, i clienti possono ottenere dal cloud un servizio di streaming live estremamente affidabile.</span><span class="sxs-lookup"><span data-stu-id="d4273-210">When used in conjunction with proper failover logic from the live encoder side, customers can achieve a highly reliable live streaming service from the cloud.</span></span>

<span data-ttu-id="d4273-211">Questa sezione descrive gli scenari di failover del servizio.</span><span class="sxs-lookup"><span data-stu-id="d4273-211">In this section, we discuss service failover scenarios.</span></span> <span data-ttu-id="d4273-212">In questo caso, l'errore si verifica in un punto qualsiasi all'interno del servizio e si manifesta come errore di rete.</span><span class="sxs-lookup"><span data-stu-id="d4273-212">In this case, the failure happens somewhere within the service, and it manifests itself as a network error.</span></span> <span data-ttu-id="d4273-213">Di seguito sono riportati alcuni consigli per implementare il codificatore in modo che sia in grado di gestire il failover del servizio:</span><span class="sxs-lookup"><span data-stu-id="d4273-213">Here are some recommendations for the encoder implementation for handling service failover:</span></span>

1. <span data-ttu-id="d4273-214">Usare un timeout di 10 secondi per stabilire la connessione TCP.</span><span class="sxs-lookup"><span data-stu-id="d4273-214">Use a 10-second timeout for establishing the TCP connection.</span></span> <span data-ttu-id="d4273-215">Se un tentativo di stabilire la connessione richiede più di 10 secondi, interrompere l'operazione e riprovare.</span><span class="sxs-lookup"><span data-stu-id="d4273-215">If an attempt to establish the connection takes longer than 10 seconds, abort the operation and try again.</span></span> 
2. <span data-ttu-id="d4273-216">Usare un timeout breve per inviare i blocchi del messaggio di richiesta HTTP.</span><span class="sxs-lookup"><span data-stu-id="d4273-216">Use a short timeout for sending the HTTP request message chunks.</span></span> <span data-ttu-id="d4273-217">Se la durata del frammento MP4 di destinazione è N secondi, usare un timeout di invio compreso tra N e 2N secondi. Se, ad esempio, la durata del frammento MP4 è 6 secondi, usare un timeout compreso tra 6 e 12 secondi.</span><span class="sxs-lookup"><span data-stu-id="d4273-217">If the target MP4 fragment duration is N seconds, use a send timeout between N and 2 N seconds; for example, if the MP4 fragment duration is 6 seconds, use a timeout of 6 to 12 seconds.</span></span> <span data-ttu-id="d4273-218">Se si verifica un timeout, reimpostare la connessione, aprire una nuova connessione e riprendere l'inserimento del flusso con la nuova connessione.</span><span class="sxs-lookup"><span data-stu-id="d4273-218">If a timeout occurs, reset the connection, open a new connection, and resume stream ingest on the new connection.</span></span> 
3. <span data-ttu-id="d4273-219">Gestire un buffer in sequenza contenente, per ogni traccia, gli ultimi due frammenti completamente inviati al servizio.</span><span class="sxs-lookup"><span data-stu-id="d4273-219">Maintain a rolling buffer that has the last two fragments for each track that were successfully and completely sent to the service.</span></span>  <span data-ttu-id="d4273-220">Se la richiesta HTTP POST per un flusso viene terminata o scade prima della fine del flusso, aprire una nuova connessione e iniziare un'altra richiesta HTTP POST, quindi inviare nuovamente le intestazioni del flusso e gli ultimi due frammenti per ogni traccia e riprendere il flusso senza introdurre una discontinuità nella sequenza temporale dei contenuti.</span><span class="sxs-lookup"><span data-stu-id="d4273-220">If the HTTP POST request for a stream is terminated or times out prior to the end of the stream, open a new connection and begin another HTTP POST request, resend the stream headers, resend the last two fragments for each track, and resume the stream without introducing a discontinuity in the media timeline.</span></span> <span data-ttu-id="d4273-221">In questo modo, si riduce il rischio di perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="d4273-221">This reduces the chance of data loss.</span></span>
4. <span data-ttu-id="d4273-222">È bene che il codificatore NON limiti il numero di tentativi di riconnessione o di ripresa del flusso dopo un errore TCP.</span><span class="sxs-lookup"><span data-stu-id="d4273-222">We recommend that the encoder does NOT limit the number of retries to establish a connection or resume streaming after a TCP error occurs.</span></span>
5. <span data-ttu-id="d4273-223">Dopo un errore TCP:</span><span class="sxs-lookup"><span data-stu-id="d4273-223">After a TCP error:</span></span>
  
    <span data-ttu-id="d4273-224">a.</span><span class="sxs-lookup"><span data-stu-id="d4273-224">a.</span></span> <span data-ttu-id="d4273-225">È necessario (MUST) chiudere la connessione corrente e creare una nuova connessione per una nuova richiesta HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="d4273-225">The current connection MUST be closed, and a new connection MUST be created for a new HTTP POST request.</span></span>

    <span data-ttu-id="d4273-226">b.</span><span class="sxs-lookup"><span data-stu-id="d4273-226">b.</span></span> <span data-ttu-id="d4273-227">Il nuovo URL per HTTP POST deve (MUST) corrispondere all'URL relativo al POST iniziale.</span><span class="sxs-lookup"><span data-stu-id="d4273-227">The new HTTP POST URL MUST be the same as the initial POST URL.</span></span>
  
    <span data-ttu-id="d4273-228">c.</span><span class="sxs-lookup"><span data-stu-id="d4273-228">c.</span></span> <span data-ttu-id="d4273-229">La nuove richiesta HTTP POST deve (MUST) includere intestazioni di flusso (caselle **ftyp**, **Live Server Manifest Box** e **moov**) identiche alle intestazioni di flusso della richiesta POST iniziale.</span><span class="sxs-lookup"><span data-stu-id="d4273-229">The new HTTP POST MUST include stream headers (**ftyp**, **Live Server Manifest Box**, and **moov** boxes) that are identical to the stream headers in the initial POST.</span></span>
  
    <span data-ttu-id="d4273-230">d.</span><span class="sxs-lookup"><span data-stu-id="d4273-230">d.</span></span> <span data-ttu-id="d4273-231">Gli ultimi due frammenti inviati per ogni traccia devono essere inviati di nuovo e lo streaming deve riprendere senza introdurre discontinuità nella sequenza temporale dei contenuti multimediali.</span><span class="sxs-lookup"><span data-stu-id="d4273-231">The last two fragments sent for each track must be resent, and streaming must resume without introducing a discontinuity in the media timeline.</span></span> <span data-ttu-id="d4273-232">I timestamp del frammento MP4 devono aumentare costantemente, anche con richieste HTTP POST diverse.</span><span class="sxs-lookup"><span data-stu-id="d4273-232">The MP4 fragment timestamps must increase continuously, even across HTTP POST requests.</span></span>
6. <span data-ttu-id="d4273-233">Se i dati non vengono inviati a una velocità adeguata alla durata del frammento MP4, il codificatore dovrebbe (SHOULD) terminare la richiesta HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="d4273-233">The encoder SHOULD terminate the HTTP POST request if data is not being sent at a rate commensurate with the MP4 fragment duration.</span></span>  <span data-ttu-id="d4273-234">Una richiesta HTTP POST che non invia dati può impedire a Servizi multimediali di disconnettersi rapidamente dal codificatore in caso di aggiornamento del servizio.</span><span class="sxs-lookup"><span data-stu-id="d4273-234">An HTTP POST request that does not send data can prevent Media Services from quickly disconnecting from the encoder in the event of a service update.</span></span> <span data-ttu-id="d4273-235">Per questo motivo, la richiesta HTTP POST per tracce di tipo sparse (segnale dell'annuncio) dovrebbe (SHOULD) avere breve durata e terminare non appena viene inviato il frammento di tipo sparse.</span><span class="sxs-lookup"><span data-stu-id="d4273-235">For this reason, the HTTP POST for sparse (ad signal) tracks SHOULD be short-lived, terminating as soon as the sparse fragment is sent.</span></span>

## <a name="8-encoder-failover"></a><span data-ttu-id="d4273-236">8. Failover del codificatore</span><span class="sxs-lookup"><span data-stu-id="d4273-236">8. Encoder failover</span></span>
<span data-ttu-id="d4273-237">Il failover del codificatore è il secondo tipo di scenario di failover che deve essere affrontato per la distribuzione di un live streaming end-to-end.</span><span class="sxs-lookup"><span data-stu-id="d4273-237">Encoder failover is the second type of failover scenario that needs to be addressed for end-to-end live streaming delivery.</span></span> <span data-ttu-id="d4273-238">In questo scenario la condizione di errore avviene sul lato del codificatore.</span><span class="sxs-lookup"><span data-stu-id="d4273-238">In this scenario, the error condition occurs on the encoder side.</span></span> 

![Failover del codificatore][image5]

<span data-ttu-id="d4273-240">Di seguito è descritto il comportamento previsto in corrispondenza dell'endpoint di inserimento live quando si verifica il failover del codificatore:</span><span class="sxs-lookup"><span data-stu-id="d4273-240">The following expectations apply from the live ingestion endpoint when encoder failover happens:</span></span>

1. <span data-ttu-id="d4273-241">Deve (MUST) essere creata una nuova istanza del codificatore per poter proseguire lo streaming, come mostrato nel diagramma (flusso per video a 3000 K con linea tratteggiata).</span><span class="sxs-lookup"><span data-stu-id="d4273-241">A new encoder instance SHOULD be created to continue streaming, as illustrated in the diagram (Stream for 3000k video, with dashed line).</span></span>
2. <span data-ttu-id="d4273-242">Il nuovo codificatore deve (MUST) usare per le richieste HTTP POST lo stesso URL dell'istanza non riuscita.</span><span class="sxs-lookup"><span data-stu-id="d4273-242">The new encoder MUST use the same URL for HTTP POST requests as the failed instance.</span></span>
3. <span data-ttu-id="d4273-243">La richiesta POST del nuovo codificatore deve (MUST) includere le stesse caselle di intestazione del flusso MP4 frammentato presenti nell'istanza non riuscita.</span><span class="sxs-lookup"><span data-stu-id="d4273-243">The new encoder’s POST request MUST include the same fragmented MP4 header boxes as the failed instance.</span></span>
4. <span data-ttu-id="d4273-244">Il nuovo codificatore deve (MUST) essere sincronizzato correttamente con tutti gli altri codificatori in esecuzione per la stessa presentazione live, in modo da generare campioni audio/video sincronizzati con i limiti di frammento allineati.</span><span class="sxs-lookup"><span data-stu-id="d4273-244">The new encoder MUST be properly synced with all other running encoders for the same live presentation to generate synced audio/video samples with aligned fragment boundaries.</span></span>
5. <span data-ttu-id="d4273-245">Il nuovo flusso deve (MUST) essere semanticamente equivalente al flusso precedente e intercambiabile a livello di intestazione e di frammento.</span><span class="sxs-lookup"><span data-stu-id="d4273-245">The new stream MUST be semantically equivalent with the previous stream, and interchangeable at the header and fragment levels.</span></span>
6. <span data-ttu-id="d4273-246">Il nuovo codificatore deve (MUST) tentare di ridurre al minimo la perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="d4273-246">The new encoder SHOULD try to minimize data loss.</span></span> <span data-ttu-id="d4273-247">I valori `fragment_absolute_time` e `fragment_index` dei frammenti multimediali dovrebbero (SHOULD) aumentare dall'ultimo punto in cui si è interrotto il codificatore.</span><span class="sxs-lookup"><span data-stu-id="d4273-247">The `fragment_absolute_time` and `fragment_index` of media fragments SHOULD increase from the point where the encoder last stopped.</span></span> <span data-ttu-id="d4273-248">I valori `fragment_absolute_time` e `fragment_index` dovrebbero (SHOULD) aumentare in modo costante ma, se necessario, è possibile introdurre una discontinuità.</span><span class="sxs-lookup"><span data-stu-id="d4273-248">The `fragment_absolute_time` and `fragment_index` SHOULD increase in a continuous manner, but it is permissible to introduce a discontinuity, if necessary.</span></span> <span data-ttu-id="d4273-249">Poiché Servizi multimediali ignora i frammenti già ricevuti ed elaborati, è preferibile sbagliare inviando di nuovo frammenti già ricevuti piuttosto che introdurre discontinuità nella sequenza temporale dei contenuti.</span><span class="sxs-lookup"><span data-stu-id="d4273-249">Media Services ignores fragments that it has already received and processed, so it's better to err on the side of resending fragments than to introduce discontinuities in the media timeline.</span></span> 

## <a name="9-encoder-redundancy"></a><span data-ttu-id="d4273-250">9. Ridondanza del codificatore</span><span class="sxs-lookup"><span data-stu-id="d4273-250">9. Encoder redundancy</span></span>
<span data-ttu-id="d4273-251">In caso di eventi live critici che richiedono livelli superiori di disponibilità e qualità dell'esperienza, è consigliabile usare codificatori ridondanti di tipo attivo-attivo per ottenere un failover efficiente senza perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="d4273-251">For certain critical live events that demand even higher availability and quality of experience, we recommended that you use active-active redundant encoders to achieve seamless failover with no data loss.</span></span>

![Ridondanza del codificatore][image6]

<span data-ttu-id="d4273-253">Come mostrato in questo diagramma, due gruppi di codificatori inviano contemporaneamente due copie di ogni flusso al servizio live.</span><span class="sxs-lookup"><span data-stu-id="d4273-253">As illustrated in this diagram, two groups of encoders push two copies of each stream simultaneously into the live service.</span></span> <span data-ttu-id="d4273-254">Questa configurazione è supportata perché Servizi multimediali è in grado di escludere i frammenti duplicati in base all'ID flusso e al timestamp del frammento.</span><span class="sxs-lookup"><span data-stu-id="d4273-254">This setup is supported because Media Services can filter out duplicate fragments based on stream ID and fragment timestamp.</span></span> <span data-ttu-id="d4273-255">L'archivio e il flusso live risultanti saranno costituiti da un'unica copia di tutti i flussi, ovvero dalla migliore aggregazione possibile a partire dalle due origini.</span><span class="sxs-lookup"><span data-stu-id="d4273-255">The resulting live stream and archive is a single copy of all the streams that is the best possible aggregation from the two sources.</span></span> <span data-ttu-id="d4273-256">In un ipotetico caso estremo, ad esempio, purché per ogni flusso sia presente un codificatore in esecuzione (non necessariamente lo stesso) in ogni momento, il flusso live risultante dal servizio sarà continuo, senza perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="d4273-256">For example, in a hypothetical extreme case, as long as there is one encoder (it doesn’t have to be the same one) running at any given point in time for each stream, the resulting live stream from the service is continuous without data loss.</span></span> 

<span data-ttu-id="d4273-257">I requisiti per questo scenario sono molto simili a quelli descritti per il failover del codificatore, ad eccezione del fatto che il secondo set di codificatori viene eseguito contemporaneamente ai codificatori primari.</span><span class="sxs-lookup"><span data-stu-id="d4273-257">The requirements for this scenario are almost the same as the requirements in the "Encoder failover" case, with the exception that the second set of encoders are running at the same time as the primary encoders.</span></span>

## <a name="10-service-redundancy"></a><span data-ttu-id="d4273-258">10. Ridondanza del servizio</span><span class="sxs-lookup"><span data-stu-id="d4273-258">10. Service redundancy</span></span>
<span data-ttu-id="d4273-259">Per una distribuzione globale altamente ridondante, è necessario eseguire un backup tra più aree per poter gestire situazioni di emergenza nelle aree interessate.</span><span class="sxs-lookup"><span data-stu-id="d4273-259">For highly redundant global distribution, sometimes you must have cross-region backup to handle regional disasters.</span></span> <span data-ttu-id="d4273-260">Estendendo la topologia descritta in "Ridondanza del codificatore", i clienti possono scegliere di distribuire un servizio ridondante in un'area diversa associata al secondo set di codificatori.</span><span class="sxs-lookup"><span data-stu-id="d4273-260">Expanding on the “Encoder redundancy” topology, customers can choose to have a redundant service deployment in a different region that's connected with the second set of encoders.</span></span> <span data-ttu-id="d4273-261">I clienti possono anche usare un provider di rete CDN per distribuire uno strumento di gestione del traffico globale per le due distribuzioni del servizio, in modo da indirizzare correttamente il traffico client.</span><span class="sxs-lookup"><span data-stu-id="d4273-261">Customers also can work with a Content Delivery Network provider to deploy a Global Traffic Manager in front of the two service deployments to seamlessly route client traffic.</span></span> <span data-ttu-id="d4273-262">I requisiti per i codificatori sono gli stessi di quelli per il caso di ridondanza del codificatore.</span><span class="sxs-lookup"><span data-stu-id="d4273-262">The requirements for the encoders are the same as the “Encoder redundancy” case.</span></span> <span data-ttu-id="d4273-263">L'unica eccezione è che il secondo set di codificatori deve puntare a un endpoint di inserimento live diverso.</span><span class="sxs-lookup"><span data-stu-id="d4273-263">The only exception is that the second set of encoders needs to be pointed to a different live ingest endpoint.</span></span> <span data-ttu-id="d4273-264">Il diagramma seguente mostra questa configurazione:</span><span class="sxs-lookup"><span data-stu-id="d4273-264">The following diagram shows this setup:</span></span>

![Ridondanza del servizio][image7]

## <a name="11-special-types-of-ingestion-formats"></a><span data-ttu-id="d4273-266">11. Tipi speciali di formati di inserimento</span><span class="sxs-lookup"><span data-stu-id="d4273-266">11. Special types of ingestion formats</span></span>
<span data-ttu-id="d4273-267">Questa sezione descrive alcuni tipi speciali di formati di inserimento live, progettati per gestire scenari specifici.</span><span class="sxs-lookup"><span data-stu-id="d4273-267">This section discusses special types of live ingestion formats that are designed to handle specific scenarios.</span></span>

### <a name="sparse-track"></a><span data-ttu-id="d4273-268">Traccia di tipo sparse</span><span class="sxs-lookup"><span data-stu-id="d4273-268">Sparse track</span></span>
<span data-ttu-id="d4273-269">Quando si trasmette una presentazione in streaming live con un'esperienza cliente avanzata, spesso è necessario trasmettere eventi sincronizzati o segnali in banda con i principali dati multimediali.</span><span class="sxs-lookup"><span data-stu-id="d4273-269">When delivering a live streaming presentation with a rich client experience, often it's necessary to transmit time-synced events or signals in-band with the main media data.</span></span> <span data-ttu-id="d4273-270">Un esempio di questo scenario è l'inserimento dinamico di annunci live.</span><span class="sxs-lookup"><span data-stu-id="d4273-270">An example of this is dynamic live ad insertion.</span></span> <span data-ttu-id="d4273-271">La segnalazione per questo tipo di eventi è diversa dal normale streaming di flussi audio/video a causa della particolare natura di tipo sparse.</span><span class="sxs-lookup"><span data-stu-id="d4273-271">This type of event signaling is different from regular audio/video streaming because of its sparse nature.</span></span> <span data-ttu-id="d4273-272">In altre parole, i dati di segnalazione non hanno in genere un andamento costante e può essere molto difficile determinare l'intervallo.</span><span class="sxs-lookup"><span data-stu-id="d4273-272">In other words, the signaling data usually does not happen continuously, and the interval can be hard to predict.</span></span> <span data-ttu-id="d4273-273">Il concetto di traccia di tipo sparse è stato sviluppato per consentire l'inserimento e la trasmissione di dati di segnalazione in banda.</span><span class="sxs-lookup"><span data-stu-id="d4273-273">The concept of sparse track was designed to ingest and broadcast in-band signaling data.</span></span>

<span data-ttu-id="d4273-274">I passaggi seguenti costituiscono un'implementazione consigliata per l'inserimento di una traccia di tipo sparse:</span><span class="sxs-lookup"><span data-stu-id="d4273-274">The following steps are a recommended implementation for ingesting sparse track:</span></span>

1. <span data-ttu-id="d4273-275">Creare un flusso di bit MP4 frammentato separato contenente solo le tracce di tipo sparse, senza tracce audio/video.</span><span class="sxs-lookup"><span data-stu-id="d4273-275">Create a separate fragmented MP4 bitstream that contains only sparse tracks, without audio/video tracks.</span></span>
2. <span data-ttu-id="d4273-276">In **Live Server Manifest Box**, come definito nella sezione 6 di [1], usare il parametro *parentTrackName* per specificare il nome della traccia padre. Per altre informazioni, vedere la sezione 4.2.1.2.1.2 di [1].</span><span class="sxs-lookup"><span data-stu-id="d4273-276">In the **Live Server Manifest Box** as defined in Section 6 in [1], use the *parentTrackName* parameter to specify the name of the parent track. For more information, see section 4.2.1.2.1.2 in [1].</span></span>
3. <span data-ttu-id="d4273-277">In **Live Server Manifest Box** **manifestOutput** deve (MUST) essere impostato su **true**.</span><span class="sxs-lookup"><span data-stu-id="d4273-277">In the **Live Server Manifest Box**, **manifestOutput** MUST be set to **true**.</span></span>
4. <span data-ttu-id="d4273-278">A causa della natura sparse dell'evento di segnalazione, è consigliabile quanto segue:</span><span class="sxs-lookup"><span data-stu-id="d4273-278">Given the sparse nature of the signaling event, we recommended the following:</span></span>
   
    <span data-ttu-id="d4273-279">a.</span><span class="sxs-lookup"><span data-stu-id="d4273-279">a.</span></span> <span data-ttu-id="d4273-280">All'inizio dell'evento live, il codificatore invia le caselle di intestazione iniziali al servizio, in modo che questo possa registrare la traccia di tipo sparse nel manifesto client.</span><span class="sxs-lookup"><span data-stu-id="d4273-280">At the beginning of the live event, the encoder sends the initial header boxes to the service, which allows the service to register the sparse track in the client manifest.</span></span>
   
    <span data-ttu-id="d4273-281">b.</span><span class="sxs-lookup"><span data-stu-id="d4273-281">b.</span></span> <span data-ttu-id="d4273-282">Il codificatore dovrebbe (SHOULD) terminare la richiesta HTTP POST quando i dati non sono ancora stati inviati.</span><span class="sxs-lookup"><span data-stu-id="d4273-282">The encoder SHOULD terminate the HTTP POST request when data is not being sent.</span></span> <span data-ttu-id="d4273-283">Una richiesta HTTP POST a esecuzione prolungata che non invia dati può impedire a Servizi multimediali di disconnettersi rapidamente dal codificatore in caso di aggiornamento del servizio o riavvio del server.</span><span class="sxs-lookup"><span data-stu-id="d4273-283">A long-running HTTP POST that does not send data can prevent Media Services from quickly disconnecting from the encoder in the event of a service update or server reboot.</span></span> <span data-ttu-id="d4273-284">In questi casi, il server dei contenuti multimediali è temporaneamente bloccato in un'operazione di ricezione nel socket.</span><span class="sxs-lookup"><span data-stu-id="d4273-284">In these cases, the media server is temporarily blocked in a receive operation on the socket.</span></span>
   
    <span data-ttu-id="d4273-285">c.</span><span class="sxs-lookup"><span data-stu-id="d4273-285">c.</span></span> <span data-ttu-id="d4273-286">Durante il periodo in cui i dati di segnalazione non sono disponibili, il codificatore dovrebbe (SHOULD) chiudere la richiesta HTTP POST</span><span class="sxs-lookup"><span data-stu-id="d4273-286">During the time when signaling data is not available, the encoder SHOULD close the HTTP POST request.</span></span> <span data-ttu-id="d4273-287">e inviare i dati mentre la richiesta POST è ancora attiva.</span><span class="sxs-lookup"><span data-stu-id="d4273-287">While the POST request is active, the encoder SHOULD send data.</span></span>

    <span data-ttu-id="d4273-288">d.</span><span class="sxs-lookup"><span data-stu-id="d4273-288">d.</span></span> <span data-ttu-id="d4273-289">Per l'invio di frammenti di tipo sparse, il codificatore può impostare esplicitamente l'intestazione Content-Length, se disponibile.</span><span class="sxs-lookup"><span data-stu-id="d4273-289">When sending sparse fragments, the encoder can set an explicit content-length header, if it’s available.</span></span>

    <span data-ttu-id="d4273-290">e.</span><span class="sxs-lookup"><span data-stu-id="d4273-290">e.</span></span> <span data-ttu-id="d4273-291">Per l'invio di frammenti di tipo sparse con una nuova connessione, il codificatore dovrebbe (SHOULD) inviare prima le caselle di intestazione e quindi i nuovi frammenti.</span><span class="sxs-lookup"><span data-stu-id="d4273-291">When sending sparse fragments with a new connection, the encoder SHOULD start sending from the header boxes, followed by the new fragments.</span></span> <span data-ttu-id="d4273-292">Questo consente di gestire casi in cui il failover avviene tra una connessione e l'altra e la nuova connessione di tipo sparse viene stabilita con un nuovo server che non ha mai visto prima la traccia di tipo sparse.</span><span class="sxs-lookup"><span data-stu-id="d4273-292">This is for cases in which failover happens in-between, and the new sparse connection is being established to a new server that has not seen the sparse track before.</span></span>

    <span data-ttu-id="d4273-293">f.</span><span class="sxs-lookup"><span data-stu-id="d4273-293">f.</span></span> <span data-ttu-id="d4273-294">Il frammento della traccia di tipo sparse è disponibile al client nel momento in cui il frammento della traccia padre corrispondente, con valore di timestamp uguale o maggiore, viene reso disponibile al client.</span><span class="sxs-lookup"><span data-stu-id="d4273-294">The sparse track fragment becomes available to the client when the corresponding parent track fragment that has an equal or larger timestamp value is made available to the client.</span></span> <span data-ttu-id="d4273-295">Ad esempio, se il frammento di tipo sparse ha un timestamp t = 1000, dopo che il client rileva il timestamp del frammento video (presupponendo che il nome della traccia padre sia "video") maggiore o uguale a 1000, può scaricare il frammento di tipo sparse t = 1000.</span><span class="sxs-lookup"><span data-stu-id="d4273-295">For example, if the sparse fragment has a timestamp of t=1000, it is expected that after the client sees "video" (assuming the parent track name is "video") fragment timestamp 1000 or beyond, it can download the sparse fragment t=1000.</span></span> <span data-ttu-id="d4273-296">Tenere presente che il segnale effettivo può essere usato anche per una posizione diversa nella sequenza temporale della presentazione rispetto a quella designata.</span><span class="sxs-lookup"><span data-stu-id="d4273-296">Note that the actual signal could be used for a different position in the presentation timeline for its designated purpose.</span></span> <span data-ttu-id="d4273-297">In questo esempio è possibile che il frammento di tipo sparse con t = 1000 includa un payload XML che consente di inserire un annuncio in una posizione di pochi secondi successiva.</span><span class="sxs-lookup"><span data-stu-id="d4273-297">In this example, it’s possible that the sparse fragment of t=1000 has an XML payload, which is for inserting an ad in a position that’s a few seconds later.</span></span>

    <span data-ttu-id="d4273-298">g.</span><span class="sxs-lookup"><span data-stu-id="d4273-298">g.</span></span> <span data-ttu-id="d4273-299">Il payload dei frammenti della traccia di tipo sparse può avere formati diversi, ad esempio, XML, testo o binario, a seconda dello scenario.</span><span class="sxs-lookup"><span data-stu-id="d4273-299">The payload of sparse track fragments can be in different formats (such as XML, text, or binary), depending on the scenario.</span></span>

### <a name="redundant-audio-track"></a><span data-ttu-id="d4273-300">Traccia audio ridondante</span><span class="sxs-lookup"><span data-stu-id="d4273-300">Redundant audio track</span></span>
<span data-ttu-id="d4273-301">In un tipico scenario di streaming adattivo HTTP, ad esempio Smooth Streaming o DASH, spesso l'intera presentazione contiene una sola traccia audio.</span><span class="sxs-lookup"><span data-stu-id="d4273-301">In a typical HTTP adaptive streaming scenario (for example, Smooth Streaming or DASH), often, there's only one audio track in the entire presentation.</span></span> <span data-ttu-id="d4273-302">Diversamente dalle tracce video, in cui il client può scegliere tra più livelli di qualità in condizioni di errore, la traccia audio può costituire un singolo punto di errore se il processo di inserimento del flusso contenente la traccia audio viene interrotto.</span><span class="sxs-lookup"><span data-stu-id="d4273-302">Unlike video tracks, which have multiple quality levels for the client to choose from in error conditions, the audio track can be a single point of failure if the ingestion of the stream that contains the audio track is broken.</span></span> 

<span data-ttu-id="d4273-303">Per risolvere questo problema, Servizi multimediali supporta l'inserimento live di tracce audio ridondanti.</span><span class="sxs-lookup"><span data-stu-id="d4273-303">To solve this problem, Media Services supports live ingestion of redundant audio tracks.</span></span> <span data-ttu-id="d4273-304">L'idea è quella di poter inviare più volte la stessa traccia audio in flussi diversi.</span><span class="sxs-lookup"><span data-stu-id="d4273-304">The idea is that the same audio track can be sent multiple times in different streams.</span></span> <span data-ttu-id="d4273-305">Benché il servizio registri la traccia audio una sola volta nel manifesto client, può usare tracce audio ridondanti come backup, in modo da recuperare i frammenti audio in caso di problemi nella traccia audio principale.</span><span class="sxs-lookup"><span data-stu-id="d4273-305">Although the service only registers the audio track once in the client manifest, it can use redundant audio tracks as backups for retrieving audio fragments if the primary audio track has issues.</span></span> <span data-ttu-id="d4273-306">Per poter inserire tracce audio ridondanti, il codificatore deve:</span><span class="sxs-lookup"><span data-stu-id="d4273-306">To ingest redundant audio tracks, the encoder needs to:</span></span>

1. <span data-ttu-id="d4273-307">Creare la stessa traccia audio in più flussi di bit MP4 frammentati.</span><span class="sxs-lookup"><span data-stu-id="d4273-307">Create the same audio track in multiple fragment MP4 bitstreams.</span></span> <span data-ttu-id="d4273-308">Le tracce audio ridondanti devono (MUST) essere semanticamente equivalenti ai timestamp degli stessi frammenti e intercambiabili a livello di intestazione e di frammento.</span><span class="sxs-lookup"><span data-stu-id="d4273-308">The redundant audio tracks MUST be semantically equivalent, with the same fragment timestamps, and be interchangeable at the header and fragment levels.</span></span>
2. <span data-ttu-id="d4273-309">Assicurarsi che la voce "audio" in Live Server Manifest (sezione 6 di [1]) sia uguale per tutte le tracce audio ridondanti.</span><span class="sxs-lookup"><span data-stu-id="d4273-309">Ensure that the “audio” entry in the Live Server Manifest (Section 6 in [1]) is the same for all redundant audio tracks.</span></span>

<span data-ttu-id="d4273-310">Di seguito è riportata l'implementazione consigliata per le tracce audio ridondanti:</span><span class="sxs-lookup"><span data-stu-id="d4273-310">The following implementation is recommended for redundant audio tracks:</span></span>

1. <span data-ttu-id="d4273-311">Inviare ogni singola traccia audio in un flusso separato.</span><span class="sxs-lookup"><span data-stu-id="d4273-311">Send each unique audio track in a stream by itself.</span></span> <span data-ttu-id="d4273-312">Inviare inoltre un flusso ridondante per ognuno di questi flussi di traccia audio, in cui il secondo flusso differisca dal primo solo per l'identificatore nell'URL HTTP POST: {protocollo}://{indirizzo server}/{percorso punto di pubblicazione}/Streams({identificatore}).</span><span class="sxs-lookup"><span data-stu-id="d4273-312">Also, send a redundant stream for each of these audio track streams, where the second stream differs from the first only by the identifier in the HTTP POST URL: {protocol}://{server address}/{publishing point path}/Streams({identifier}).</span></span>
2. <span data-ttu-id="d4273-313">Usare flussi distinti per inviare le due velocità in bit video più basse.</span><span class="sxs-lookup"><span data-stu-id="d4273-313">Use separate streams to send the two lowest video bitrates.</span></span> <span data-ttu-id="d4273-314">Ciascuno di questi flussi dovrebbe (SHOULD) inoltre contenere una copia di ogni singola traccia audio. Se, ad esempio, sono supportate più lingue, i flussi dovrebbero (SHOULD) contenere tracce audio per ogni lingua.</span><span class="sxs-lookup"><span data-stu-id="d4273-314">Each of these streams SHOULD also contain a copy of each unique audio track. For example, when multiple languages are supported, these streams SHOULD contain audio tracks for each language.</span></span>
3. <span data-ttu-id="d4273-315">Usare istanze del server (codificatore) distinte per codificare e inviare i flussi ridondanti citati in (1) e (2).</span><span class="sxs-lookup"><span data-stu-id="d4273-315">Use separate server (encoder) instances to encode and send the redundant streams mentioned in (1) and (2).</span></span> 

## <a name="media-services-learning-paths"></a><span data-ttu-id="d4273-316">Percorsi di apprendimento di Servizi multimediali</span><span class="sxs-lookup"><span data-stu-id="d4273-316">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="d4273-317">Fornire commenti e suggerimenti</span><span class="sxs-lookup"><span data-stu-id="d4273-317">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

[image1]: ./media/media-services-fmp4-live-ingest-overview/media-services-image1.png
[image2]: ./media/media-services-fmp4-live-ingest-overview/media-services-image2.png
[image3]: ./media/media-services-fmp4-live-ingest-overview/media-services-image3.png
[image4]: ./media/media-services-fmp4-live-ingest-overview/media-services-image4.png
[image5]: ./media/media-services-fmp4-live-ingest-overview/media-services-image5.png
[image6]: ./media/media-services-fmp4-live-ingest-overview/media-services-image6.png
[image7]: ./media/media-services-fmp4-live-ingest-overview/media-services-image7.png
