---
title: Eseguire la replica di un'applicazione di SharePoint multilivello con Azure Site Recovery | Microsoft Docs
description: "Questo articolo descrive come eseguire la replica di un'applicazione di SharePoint multilivello usando le funzionalità di Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: sujayt
manager: rochakm
editor: 
ms.assetid: 
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/10/2017
ms.author: sutalasi
ms.openlocfilehash: 9c0570b9da661a8ffb0041e5c24905480f55f6e2
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="replicate-a-multi-tier-sharepoint-application-for-disaster-recovery-using-azure-site-recovery"></a><span data-ttu-id="418a5-103">Eseguire la replica di un'applicazione di SharePoint multilivello per il ripristino di emergenza con Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="418a5-103">Replicate a multi-tier SharePoint application for disaster recovery using Azure Site Recovery</span></span>

<span data-ttu-id="418a5-104">Questo articolo descrive dettagliatamente come proteggere un'applicazione di SharePoint usando [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="418a5-104">This article describes in detail how to protect a SharePoint application using  [Azure Site Recovery](site-recovery-overview.md).</span></span>


## <a name="overview"></a><span data-ttu-id="418a5-105">Panoramica</span><span class="sxs-lookup"><span data-stu-id="418a5-105">Overview</span></span>

<span data-ttu-id="418a5-106">Microsoft SharePoint è una potente applicazione che può aiutare un gruppo o un reparto a organizzare e condividere informazioni collaborando.</span><span class="sxs-lookup"><span data-stu-id="418a5-106">Microsoft SharePoint is a powerful application that can help a group or department organize, collaborate, and share information.</span></span> <span data-ttu-id="418a5-107">SharePoint offre portali Intranet, gestione di documenti e file, collaborazione, social network, reti Extranet, siti Web, ricerca di livello aziendale e business intelligence.</span><span class="sxs-lookup"><span data-stu-id="418a5-107">SharePoint can provide intranet portals, document and file management, collaboration, social networks, extranets, websites, enterprise search, and business intelligence.</span></span> <span data-ttu-id="418a5-108">Include inoltre funzionalità di integrazione dei sistemi, integrazione dei processi e automazione dei flussi di lavoro.</span><span class="sxs-lookup"><span data-stu-id="418a5-108">It also has system integration, process integration, and workflow automation capabilities.</span></span> <span data-ttu-id="418a5-109">In genere, le organizzazioni considerano SharePoint un'applicazione di livello 1 sensibile al tempo di inattività e alla perdita dei dati.</span><span class="sxs-lookup"><span data-stu-id="418a5-109">Typically, organizations consider it as a Tier-1 application sensitive to downtime and data loss.</span></span>

<span data-ttu-id="418a5-110">Oggi Microsoft SharePoint non include funzionalità di ripristino di emergenza predefinite.</span><span class="sxs-lookup"><span data-stu-id="418a5-110">Today, Microsoft SharePoint  does not provide any out-of-the-box disaster recovery capabilities.</span></span> <span data-ttu-id="418a5-111">Indipendentemente dal tipo e dall'entità di un evento di emergenza, il ripristino comporta l'uso di un data center di standby in cui ripristinare la farm.</span><span class="sxs-lookup"><span data-stu-id="418a5-111">Regardless of the type and scale of a disaster, recovery involves the use of a standby data center that you can recover the farm to.</span></span> <span data-ttu-id="418a5-112">I data center di standby sono necessari per gli scenari in cui sistemi ridondanti locali e backup non sono in grado di eseguire il ripristino da interruzioni nel data center primario.</span><span class="sxs-lookup"><span data-stu-id="418a5-112">Standby data centers are required for scenarios where local redundant systems and backups cannot recover from the outage at the primary data center.</span></span>

<span data-ttu-id="418a5-113">Una buona soluzione di ripristino di emergenza deve consentire la modellazione di piani di ripristino basati su architetture di applicazioni complesse, come SharePoint.</span><span class="sxs-lookup"><span data-stu-id="418a5-113">A good disaster recovery solution should allow modeling of recovery plans around the  complex application architectures such as SharePoint.</span></span> <span data-ttu-id="418a5-114">Deve anche permettere di aggiungere passaggi personalizzati per gestire i mapping delle applicazioni tra diversi livelli e quindi fornire il failover con un solo clic e un RTO inferiore nel caso di un evento di emergenza.</span><span class="sxs-lookup"><span data-stu-id="418a5-114">It should also have the ability to add customized steps to handle application mappings between various tiers and hence providing a single-click failover with a lower RTO in the event of a disaster.</span></span>

<span data-ttu-id="418a5-115">Questo articolo descrive dettagliatamente come proteggere un'applicazione di SharePoint usando [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="418a5-115">This article describes in detail how to protect a SharePoint application using [Azure Site Recovery](site-recovery-overview.md).</span></span> <span data-ttu-id="418a5-116">Questo articolo descrive le procedure consigliate per la replica di un'applicazione di SharePoint in Azure, l'esecuzione di un'esercitazione sul ripristino di emergenza e il failover dell'applicazione in Azure.</span><span class="sxs-lookup"><span data-stu-id="418a5-116">This article will cover best practices for replicating a three tier SharePoint application to Azure, how you can do a disaster recovery drill, and how you can failover the application to Azure.</span></span>

<span data-ttu-id="418a5-117">È possibile guardare il video di seguito sul ripristino di un'applicazione multilivello in Azure.</span><span class="sxs-lookup"><span data-stu-id="418a5-117">You can watch the below video about recovering a multi tier application to Azure.</span></span>

> [!VIDEO https://channel9.msdn.com/Series/Azure-Site-Recovery/Disaster-Recovery-of-load-balanced-multi-tier-applications-using-Azure-Site-Recovery/player]


## <a name="prerequisites"></a><span data-ttu-id="418a5-118">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="418a5-118">Prerequisites</span></span>

<span data-ttu-id="418a5-119">Prima di iniziare, è necessario comprendere i concetti illustrati di seguito:</span><span class="sxs-lookup"><span data-stu-id="418a5-119">Before you start, make sure you understand the following:</span></span>

1. [<span data-ttu-id="418a5-120">Replica di una macchina virtuale in Azure</span><span class="sxs-lookup"><span data-stu-id="418a5-120">Replicating a virtual machine to Azure</span></span>](site-recovery-vmware-to-azure.md)
2. <span data-ttu-id="418a5-121">Come [progettare una rete di ripristino](site-recovery-network-design.md)</span><span class="sxs-lookup"><span data-stu-id="418a5-121">How to [design a recovery network](site-recovery-network-design.md)</span></span>
3. [<span data-ttu-id="418a5-122">Esecuzione di un failover di test in Azure</span><span class="sxs-lookup"><span data-stu-id="418a5-122">Doing a test failover to Azure</span></span>](site-recovery-test-failover-to-azure.md)
4. [<span data-ttu-id="418a5-123">Esecuzione di un failover in Azure</span><span class="sxs-lookup"><span data-stu-id="418a5-123">Doing a failover to Azure</span></span>](site-recovery-failover.md)
5. <span data-ttu-id="418a5-124">Come [replicare un controller di dominio](site-recovery-active-directory.md)</span><span class="sxs-lookup"><span data-stu-id="418a5-124">How to [replicate a domain controller](site-recovery-active-directory.md)</span></span>
6. <span data-ttu-id="418a5-125">Come [replicare SQL Server](site-recovery-sql.md)</span><span class="sxs-lookup"><span data-stu-id="418a5-125">How to [replicate SQL Server](site-recovery-sql.md)</span></span>

## <a name="sharepoint-architecture"></a><span data-ttu-id="418a5-126">Architettura di SharePoint</span><span class="sxs-lookup"><span data-stu-id="418a5-126">SharePoint architecture</span></span>

<span data-ttu-id="418a5-127">SharePoint può essere distribuito in uno o più server usando topologie a livelli e ruoli del server per implementare una progettazione di farm in grado di soddisfare finalità e obiettivi specifici.</span><span class="sxs-lookup"><span data-stu-id="418a5-127">SharePoint can be deployed on one or more servers using tiered topologies and server roles to implement a farm design that meets specific goals and objectives.</span></span> <span data-ttu-id="418a5-128">Una tipica server farm di SharePoint con esigenze e dimensioni elevate che supporta molti utenti simultanei ed elementi di contenuto usa il raggruppamento dei servizi come parte della strategia di scalabilità.</span><span class="sxs-lookup"><span data-stu-id="418a5-128">A typical large, high-demand SharePoint server farm that supports a high number of concurrent users and a large number of content items use service grouping as part of their scalability strategy.</span></span> <span data-ttu-id="418a5-129">Questo approccio comporta l'esecuzione di servizi su server dedicati, il raggruppamento dei servizi e quindi la scalabilità orizzontale dei server come gruppi.</span><span class="sxs-lookup"><span data-stu-id="418a5-129">This approach involves running services on dedicated servers, grouping these services together, and then scaling out the servers as a group.</span></span> <span data-ttu-id="418a5-130">La topologia seguente mostra il raggruppamento di servizi e server per una server farm di SharePoint a tre livelli.</span><span class="sxs-lookup"><span data-stu-id="418a5-130">The following topology illustrates the service and server grouping for a three tier SharePoint server farm.</span></span> <span data-ttu-id="418a5-131">Per indicazioni dettagliate sulle diverse topologie di SharePoint, fare riferimento alla documentazione e alle architetture delle linee di prodotti di SharePoint.</span><span class="sxs-lookup"><span data-stu-id="418a5-131">Please refer to SharePoint documentation and product line architectures for detailed guidance on different SharePoint topologies.</span></span> <span data-ttu-id="418a5-132">Altre informazioni sulla distribuzione di SharePoint 2013 sono disponibili in [questo documento](https://technet.microsoft.com/en-us/library/cc303422.aspx).</span><span class="sxs-lookup"><span data-stu-id="418a5-132">You can find more details about SharePoint 2013 deployment in [this document](https://technet.microsoft.com/en-us/library/cc303422.aspx).</span></span>



![Modello di distribuzione 1](./media/site-recovery-sharepoint/sharepointarch.png)


## <a name="site-recovery-support"></a><span data-ttu-id="418a5-134">Supporto di Site Recovery</span><span class="sxs-lookup"><span data-stu-id="418a5-134">Site Recovery support</span></span>

<span data-ttu-id="418a5-135">Ai fini di questo articolo sono state usate macchine virtuali VMware con Windows Server 2012 R2 Enterprise.</span><span class="sxs-lookup"><span data-stu-id="418a5-135">For creating this article, VMware virtual machines with Windows Server 2012 R2 Enterprise were used.</span></span> <span data-ttu-id="418a5-136">Sono stati usati SharePoint 2013 Enterprise Edition e SQL Server 2014 Enterprise Edition.</span><span class="sxs-lookup"><span data-stu-id="418a5-136">SharePoint 2013 Enterprise edition and SQL server 2014 Enterprise edition were used.</span></span> <span data-ttu-id="418a5-137">Poiché la replica di Site Recovery è indipendente dall'applicazione, i consigli inclusi in questo articolo saranno validi anche per gli scenari seguenti.</span><span class="sxs-lookup"><span data-stu-id="418a5-137">As Site Recovery replication is application agnostic, the recommendations provided here are expected to hold on for following scenarios as well.</span></span>

### <a name="source-and-target"></a><span data-ttu-id="418a5-138">Origine e destinazione</span><span class="sxs-lookup"><span data-stu-id="418a5-138">Source and target</span></span>

<span data-ttu-id="418a5-139">**Scenario**</span><span class="sxs-lookup"><span data-stu-id="418a5-139">**Scenario**</span></span> | <span data-ttu-id="418a5-140">**In un sito secondario**</span><span class="sxs-lookup"><span data-stu-id="418a5-140">**To a secondary site**</span></span> | <span data-ttu-id="418a5-141">**In Azure**</span><span class="sxs-lookup"><span data-stu-id="418a5-141">**To Azure**</span></span>
--- | --- | ---
<span data-ttu-id="418a5-142">**Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="418a5-142">**Hyper-V**</span></span> | <span data-ttu-id="418a5-143">Sì</span><span class="sxs-lookup"><span data-stu-id="418a5-143">Yes</span></span> | <span data-ttu-id="418a5-144">Sì</span><span class="sxs-lookup"><span data-stu-id="418a5-144">Yes</span></span>
<span data-ttu-id="418a5-145">**VMware**</span><span class="sxs-lookup"><span data-stu-id="418a5-145">**VMware**</span></span> | <span data-ttu-id="418a5-146">Sì</span><span class="sxs-lookup"><span data-stu-id="418a5-146">Yes</span></span> | <span data-ttu-id="418a5-147">Sì</span><span class="sxs-lookup"><span data-stu-id="418a5-147">Yes</span></span>
<span data-ttu-id="418a5-148">**Server fisico**</span><span class="sxs-lookup"><span data-stu-id="418a5-148">**Physical server**</span></span> | <span data-ttu-id="418a5-149">Sì</span><span class="sxs-lookup"><span data-stu-id="418a5-149">Yes</span></span> | <span data-ttu-id="418a5-150">Sì</span><span class="sxs-lookup"><span data-stu-id="418a5-150">Yes</span></span>

### <a name="sharepoint-versions"></a><span data-ttu-id="418a5-151">Versioni di SharePoint</span><span class="sxs-lookup"><span data-stu-id="418a5-151">SharePoint Versions</span></span>
<span data-ttu-id="418a5-152">Sono supportate le versioni di SharePoint Server seguenti.</span><span class="sxs-lookup"><span data-stu-id="418a5-152">The following SharePoint server versions are supported.</span></span>

* <span data-ttu-id="418a5-153">SharePoint Server 2013 Standard</span><span class="sxs-lookup"><span data-stu-id="418a5-153">SharePoint server 2013 Standard</span></span>
* <span data-ttu-id="418a5-154">SharePoint Server 2013 Enterprise</span><span class="sxs-lookup"><span data-stu-id="418a5-154">SharePoint server 2013 Enterprise</span></span>
* <span data-ttu-id="418a5-155">SharePoint Server 2016 Standard</span><span class="sxs-lookup"><span data-stu-id="418a5-155">SharePoint server 2016 Standard</span></span>
* <span data-ttu-id="418a5-156">SharePoint Server 2016 Enterprise</span><span class="sxs-lookup"><span data-stu-id="418a5-156">SharePoint server 2016 Enterprise</span></span>

### <a name="things-to-keep-in-mind"></a><span data-ttu-id="418a5-157">Aspetti da considerare</span><span class="sxs-lookup"><span data-stu-id="418a5-157">Things to keep in mind</span></span>

<span data-ttu-id="418a5-158">Se si usa un cluster basato su dischi condivisi come qualsiasi livello nell'applicazione, non sarà possibile usare Site Recovery per eseguire la replica delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="418a5-158">If you are using a shared disk-based cluster as any tier in your application then you will not be able to use Site Recovery replication to replicate those virtual machines.</span></span> <span data-ttu-id="418a5-159">È possibile usare la replica nativa fornita dall'applicazione e quindi un [piano di ripristino](site-recovery-create-recovery-plans.md) per eseguire il failover di tutti i livelli.</span><span class="sxs-lookup"><span data-stu-id="418a5-159">You can use native replication provided by the application and then use a [recovery plan](site-recovery-create-recovery-plans.md) to failover all tiers.</span></span>

## <a name="replicating-virtual-machines"></a><span data-ttu-id="418a5-160">Replica di macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="418a5-160">Replicating virtual machines</span></span>

<span data-ttu-id="418a5-161">Seguire [queste linee guida](site-recovery-vmware-to-azure.md) per avviare la replica delle macchine virtuali in Azure.</span><span class="sxs-lookup"><span data-stu-id="418a5-161">Follow [this guidance](site-recovery-vmware-to-azure.md) to start replicating the virtual machine to Azure.</span></span>

* <span data-ttu-id="418a5-162">Al termine della replica, in ogni macchina virtuale di ogni livello assicurarsi di selezionare lo stesso set di disponibilità in "Elementi replicati > Impostazioni > Proprietà > Calcolo e rete".</span><span class="sxs-lookup"><span data-stu-id="418a5-162">Once the replication is complete, make sure you go to each virtual machine of each tier and select same availability set in 'Replicated item > Settings > Properties > Compute and Network'.</span></span> <span data-ttu-id="418a5-163">Ad esempio, se il livello Web include tre VM, assicurarsi che le tre VM siano tutte configurate per fare parte dello stesso set di disponibilità in Azure.</span><span class="sxs-lookup"><span data-stu-id="418a5-163">For example, if your web tier has 3 VMs, ensure all the 3 VMs are configured to be part of same availability set in Azure.</span></span>

    ![Impostazione del set di disponibilità](./media/site-recovery-sharepoint/select-av-set.png)

* <span data-ttu-id="418a5-165">Per le linee guida sulla protezione di Active Directory e DNS, fare riferimento al documento [Proteggere Active Directory e DNS con Azure Site Recovery](site-recovery-active-directory.md).</span><span class="sxs-lookup"><span data-stu-id="418a5-165">For guidance on protecting Active Directory and DNS, refer to [Protect Active Directory and DNS](site-recovery-active-directory.md) document.</span></span>

* <span data-ttu-id="418a5-166">Per le linee guida sulla protezione del livello database in esecuzione in SQL Server, fare riferimento al documento [Proteggere SQL Server](site-recovery-active-directory.md).</span><span class="sxs-lookup"><span data-stu-id="418a5-166">For guidance on protecting database tier running on SQL server, refer to [Protect SQL Server](site-recovery-active-directory.md) document.</span></span>

## <a name="networking-configuration"></a><span data-ttu-id="418a5-167">Configurazione delle impostazioni di rete</span><span class="sxs-lookup"><span data-stu-id="418a5-167">Networking configuration</span></span>

### <a name="network-properties"></a><span data-ttu-id="418a5-168">Proprietà di rete</span><span class="sxs-lookup"><span data-stu-id="418a5-168">Network properties</span></span>

* <span data-ttu-id="418a5-169">Per le VM di livello app e Web, configurare le impostazioni di rete nel portale di Azure in modo che le VM siano collegate alla rete di ripristino di emergenza corretta dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="418a5-169">For the App and Web tier VMs, configure network settings in Azure portal so that the VMs get attached to the right DR network after failover.</span></span>

    ![Selezione della rete](./media/site-recovery-sharepoint/select-network.png)


* <span data-ttu-id="418a5-171">Se si usa un indirizzo IP statico, specificare l'indirizzo IP che dovrà essere usato dalla macchina virtuale nel campo **IP di destinazione**</span><span class="sxs-lookup"><span data-stu-id="418a5-171">If you are using a static IP, then specify the IP that you want the virtual machine to take in the **Target IP** field</span></span>

    ![Impostazione dell'IP statico](./media/site-recovery-sharepoint/set-static-ip.png)

### <a name="dns-and-traffic-routing"></a><span data-ttu-id="418a5-173">DNS e routing del traffico</span><span class="sxs-lookup"><span data-stu-id="418a5-173">DNS and Traffic Routing</span></span>

<span data-ttu-id="418a5-174">Per i siti con connessione Internet, [creare un profilo di Gestione traffico di tipo "Priorità"](../traffic-manager/traffic-manager-create-profile.md) nella sottoscrizione di Azure.</span><span class="sxs-lookup"><span data-stu-id="418a5-174">For internet facing sites, [create a Traffic Manager profile of 'Priority' type](../traffic-manager/traffic-manager-create-profile.md) in the Azure subscription.</span></span> <span data-ttu-id="418a5-175">Configurare quindi il DNS e il profilo di Gestione traffico nel modo seguente.</span><span class="sxs-lookup"><span data-stu-id="418a5-175">And then configure your DNS and Traffic Manager profile in the following manner.</span></span>


| <span data-ttu-id="418a5-176">**Dove**</span><span class="sxs-lookup"><span data-stu-id="418a5-176">**Where**</span></span> | <span data-ttu-id="418a5-177">**Origine**</span><span class="sxs-lookup"><span data-stu-id="418a5-177">**Source**</span></span> | <span data-ttu-id="418a5-178">**Destinazione**</span><span class="sxs-lookup"><span data-stu-id="418a5-178">**Target**</span></span>|
| --- | --- | --- |
| <span data-ttu-id="418a5-179">DNS pubblico</span><span class="sxs-lookup"><span data-stu-id="418a5-179">Public DNS</span></span> | <span data-ttu-id="418a5-180">DNS pubblico per siti di SharePoint</span><span class="sxs-lookup"><span data-stu-id="418a5-180">Public DNS for SharePoint sites</span></span> <br/><br/> <span data-ttu-id="418a5-181">Esempio: sharepoint.contoso.com</span><span class="sxs-lookup"><span data-stu-id="418a5-181">Ex: sharepoint.contoso.com</span></span> | <span data-ttu-id="418a5-182">Gestione traffico</span><span class="sxs-lookup"><span data-stu-id="418a5-182">Traffic Manager</span></span> <br/><br/> <span data-ttu-id="418a5-183">contososharepoint.trafficmanager.net</span><span class="sxs-lookup"><span data-stu-id="418a5-183">contososharepoint.trafficmanager.net</span></span> |
| <span data-ttu-id="418a5-184">DNS locale</span><span class="sxs-lookup"><span data-stu-id="418a5-184">On-premises DNS</span></span> | <span data-ttu-id="418a5-185">sharepointonprem.contoso.com</span><span class="sxs-lookup"><span data-stu-id="418a5-185">sharepointonprem.contoso.com</span></span> | <span data-ttu-id="418a5-186">IP pubblico nella farm locale</span><span class="sxs-lookup"><span data-stu-id="418a5-186">Public IP on the on-premises farm</span></span> |


<span data-ttu-id="418a5-187">Nel profilo di Gestione traffico [creare gli endpoint primario e di ripristino](../traffic-manager/traffic-manager-configure-priority-routing-method.md).</span><span class="sxs-lookup"><span data-stu-id="418a5-187">In the Traffic Manager profile, [create the primary and recovery endpoints](../traffic-manager/traffic-manager-configure-priority-routing-method.md).</span></span> <span data-ttu-id="418a5-188">Usare l'endpoint esterno per l'endpoint locale e l'indirizzo IP pubblico per l'endpoint di Azure.</span><span class="sxs-lookup"><span data-stu-id="418a5-188">Use the external endpoint for on-premises endpoint and public IP for Azure endpoint.</span></span> <span data-ttu-id="418a5-189">Assicurarsi che la priorità sia impostata come più alta per l'endpoint locale.</span><span class="sxs-lookup"><span data-stu-id="418a5-189">Ensure that the priority is set higher to on-premises endpoint.</span></span>

<span data-ttu-id="418a5-190">Ospitare una pagina di test su una porta specifica, ad esempio la porta 800, nel livello Web di SharePoint in modo che Gestione traffico possa rilevare automaticamente la disponibilità dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="418a5-190">Host a test page on a specific port (for example, 800) in the SharePoint web tier in order for Traffic Manager to automatically detect availability post failover.</span></span> <span data-ttu-id="418a5-191">Questa è una soluzione alternativa per i casi in cui non è possibile abilitare l'autenticazione anonima in uno dei siti di SharePoint.</span><span class="sxs-lookup"><span data-stu-id="418a5-191">This is a workaround in case you cannot enable anonymous authentication on any of your SharePoint sites.</span></span>

<span data-ttu-id="418a5-192">[Configurare il profilo di Gestione traffico](../traffic-manager/traffic-manager-configure-priority-routing-method.md) con le impostazioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="418a5-192">[Configure the Traffic Manager profile](../traffic-manager/traffic-manager-configure-priority-routing-method.md) with the below settings.</span></span>

* <span data-ttu-id="418a5-193">Metodo di routing: "Priorità"</span><span class="sxs-lookup"><span data-stu-id="418a5-193">Routing method - 'Priority'</span></span>
* <span data-ttu-id="418a5-194">Durata DNS: "30 secondi"</span><span class="sxs-lookup"><span data-stu-id="418a5-194">DNS time to live (TTL) - '30 seconds'</span></span>
* <span data-ttu-id="418a5-195">Impostazioni di monitoraggio degli endpoint: se l'autenticazione anonima può essere abilitata, è possibile fornire l'endpoint di un sito Web specifico.</span><span class="sxs-lookup"><span data-stu-id="418a5-195">Endpoint monitor settings - If you can enable anonymous authentication, you can give a specific website endpoint.</span></span> <span data-ttu-id="418a5-196">In alternativa, è possibile usare una pagina di test su una porta specifica, ad esempio la porta 800.</span><span class="sxs-lookup"><span data-stu-id="418a5-196">Or, you can use a test page on a specific port (for example, 800).</span></span>

## <a name="creating-a-recovery-plan"></a><span data-ttu-id="418a5-197">Creazione di un piano di ripristino</span><span class="sxs-lookup"><span data-stu-id="418a5-197">Creating a recovery plan</span></span>

<span data-ttu-id="418a5-198">Un piano di ripristino consente di definire la sequenza di failover di vari livelli in un'applicazione multilivello, conservando la coerenza dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="418a5-198">A recovery plan allows sequencing the failover of various tiers in a multi-tier application, hence, maintaining application consistency.</span></span> <span data-ttu-id="418a5-199">Seguire questa procedura durante la creazione di un piano di ripristino per un'applicazione Web multilivello.</span><span class="sxs-lookup"><span data-stu-id="418a5-199">Follow the below steps while creating a recovery plan for a multi-tier web application.</span></span> <span data-ttu-id="418a5-200">[Altre informazioni sulla creazione di un piano di ripristino](site-recovery-runbook-automation.md#customize-the-recovery-plan).</span><span class="sxs-lookup"><span data-stu-id="418a5-200">[Learn more about creating a recovery plan](site-recovery-runbook-automation.md#customize-the-recovery-plan).</span></span>

### <a name="adding-virtual-machines-to-failover-groups"></a><span data-ttu-id="418a5-201">Aggiunta di macchine virtuali a gruppi di failover</span><span class="sxs-lookup"><span data-stu-id="418a5-201">Adding virtual machines to failover groups</span></span>

1. <span data-ttu-id="418a5-202">Creare un piano di ripristino aggiungendo le VM di livello app e Web.</span><span class="sxs-lookup"><span data-stu-id="418a5-202">Create a recovery plan by adding the App and Web tier VMs.</span></span>
2. <span data-ttu-id="418a5-203">Fare clic su "Personalizza" per raggruppare le VM.</span><span class="sxs-lookup"><span data-stu-id="418a5-203">Click on 'Customize' to group the VMs.</span></span> <span data-ttu-id="418a5-204">Per impostazione predefinita, tutte le VM fanno parte di "Gruppo 1".</span><span class="sxs-lookup"><span data-stu-id="418a5-204">By default, all VMs are part of 'Group 1'.</span></span>

    ![Personalizzazione del piano di ripristino](./media/site-recovery-sharepoint/rp-groups.png)

3. <span data-ttu-id="418a5-206">Creare un altro gruppo (Gruppo 2) e spostare le VM di livello Web nel nuovo gruppo.</span><span class="sxs-lookup"><span data-stu-id="418a5-206">Create another Group (Group 2) and move the Web tier VMs into the new group.</span></span> <span data-ttu-id="418a5-207">Le VM di livello app devono fare parte di "Gruppo 1", mentre le VM di livello Web devono fare parte di "Gruppo 2".</span><span class="sxs-lookup"><span data-stu-id="418a5-207">Your App tier VMs should be part of 'Group 1' and Web tier VMs should be part of 'Group 2'.</span></span> <span data-ttu-id="418a5-208">In questo modo, le VM di livello app vengono avviate per prime, seguite dalle VM di livello Web.</span><span class="sxs-lookup"><span data-stu-id="418a5-208">This is to ensure that the App tier VMs boot up first followed by Web tier VMs.</span></span>


### <a name="adding-scripts-to-the-recovery-plan"></a><span data-ttu-id="418a5-209">Aggiunta di script al piano di ripristino</span><span class="sxs-lookup"><span data-stu-id="418a5-209">Adding scripts to the recovery plan</span></span>

<span data-ttu-id="418a5-210">È possibile distribuire gli script di Azure Site Recovery usate più comunemente nell'account di Automazione facendo clic sul pulsante "Distribuisci in Azure" di seguito.</span><span class="sxs-lookup"><span data-stu-id="418a5-210">You can deploy the most commonly used Azure Site Recovery scripts into your Automation account clicking the 'Deploy to Azure' button below.</span></span> <span data-ttu-id="418a5-211">Quando si usa uno script pubblicato, assicurarsi di seguire le istruzioni nello script.</span><span class="sxs-lookup"><span data-stu-id="418a5-211">When you are using any published script, ensure you follow the guidance in the script.</span></span>

<span data-ttu-id="418a5-212">[![Distribuzione in Azure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)</span><span class="sxs-lookup"><span data-stu-id="418a5-212">[![Deploy to Azure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)</span></span>

1. <span data-ttu-id="418a5-213">Aggiungere uno script precedente all'azione a "Gruppo 1" per il gruppo di disponibilità SQL.</span><span class="sxs-lookup"><span data-stu-id="418a5-213">Add a pre-action script to 'Group 1' to failover SQL Availability group.</span></span> <span data-ttu-id="418a5-214">Usare lo script "ASR-SQL-FailoverAG" pubblicato negli script di esempio.</span><span class="sxs-lookup"><span data-stu-id="418a5-214">Use the 'ASR-SQL-FailoverAG' script published in the sample scripts.</span></span> <span data-ttu-id="418a5-215">Assicurarsi di seguire le istruzioni nello script e apportare le modifiche necessarie nello script nel modo appropriato.</span><span class="sxs-lookup"><span data-stu-id="418a5-215">Ensure you follow the guidance in the script and make the required changes in the script appropriately.</span></span>

    ![Aggiunta dello script per il gruppo di disponibilità - Passaggio 1](./media/site-recovery-sharepoint/add-ag-script-step1.png)

    ![Aggiunta dello script per il gruppo di disponibilità - Passaggio 2](./media/site-recovery-sharepoint/add-ag-script-step2.png)

2. <span data-ttu-id="418a5-218">Aggiungere uno script successivo all'azione per collegare un servizio di bilanciamento del carico nelle macchine virtuali sottoposte a failover di livello Web (Gruppo 2).</span><span class="sxs-lookup"><span data-stu-id="418a5-218">Add a post action script to attach a load balancer on the failed over virtual machines of Web tier (Group 2).</span></span> <span data-ttu-id="418a5-219">Usare lo script "ASR-AddSingleLoadBalancer" pubblicato negli script di esempio.</span><span class="sxs-lookup"><span data-stu-id="418a5-219">Use the 'ASR-AddSingleLoadBalancer' script published in the sample scripts.</span></span> <span data-ttu-id="418a5-220">Assicurarsi di seguire le istruzioni nello script e apportare le modifiche necessarie nello script nel modo appropriato.</span><span class="sxs-lookup"><span data-stu-id="418a5-220">Ensure you follow the guidance in the script and make the required changes in the script appropriately.</span></span>

    ![Aggiunta dello script per il bilanciamento del carico - Passaggio 1](./media/site-recovery-sharepoint/add-lb-script-step1.png)

    ![Aggiunta dello script per il bilanciamento del carico - Passaggio 2](./media/site-recovery-sharepoint/add-lb-script-step2.png)

3. <span data-ttu-id="418a5-223">Aggiungere un passaggio manuale per aggiornare i record DNS perché puntino alla nuova farm in Azure.</span><span class="sxs-lookup"><span data-stu-id="418a5-223">Add a manual step to update the DNS records to point to the new farm in Azure.</span></span>

    * <span data-ttu-id="418a5-224">Per i siti con connessione Internet, non è necessario alcun aggiornamento dei record DNS dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="418a5-224">For internet facing sites, no DNS updates are required post failover.</span></span> <span data-ttu-id="418a5-225">Seguire i passaggi descritti nella sezione delle linee guida per le impostazioni di rete per configurare Gestione traffico.</span><span class="sxs-lookup"><span data-stu-id="418a5-225">Follow the steps described in the 'Networking guidance' section to configure Traffic Manager.</span></span> <span data-ttu-id="418a5-226">Se il profilo di Gestione traffico è stato configurato come descritto nella sezione precedente, aggiungere uno script per aprire una porta fittizia (porta 800 nell'esempio) nella VM di Azure.</span><span class="sxs-lookup"><span data-stu-id="418a5-226">If the Traffic Manager profile has been set up as described in the previous section, add a script to open dummy port (800 in the example) on the Azure VM.</span></span>

    * <span data-ttu-id="418a5-227">Per i siti interni, aggiungere un passaggio manuale per aggiornare il record DNS perché punti al nuovo indirizzo IP del servizio di bilanciamento del carico della VM di livello Web.</span><span class="sxs-lookup"><span data-stu-id="418a5-227">For internal facing sites, add a manual step to update the DNS record to point to the new Web tier VM’s load balancer IP.</span></span>

4. <span data-ttu-id="418a5-228">Aggiungere un passaggio manuale per ripristinare l'applicazione di ricerca da un backup o avviare un nuovo servizio di ricerca.</span><span class="sxs-lookup"><span data-stu-id="418a5-228">Add a manual step to restore search application from a backup or start a new search service.</span></span>

5. <span data-ttu-id="418a5-229">Per il ripristino dell'applicazione del servizio di ricerca da un backup, seguire i passaggi seguenti.</span><span class="sxs-lookup"><span data-stu-id="418a5-229">For restoring Search service application from a backup, follow below steps.</span></span>

    * <span data-ttu-id="418a5-230">Questo metodo presuppone che sia stato eseguito un backup dell'applicazione del servizio di ricerca prima dell'evento di emergenza e che il backup sia disponibile nel sito di ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="418a5-230">This method assumes that a backup of the Search Service Application was performed before the catastrophic event and that the backup is available at the DR site.</span></span>
    * <span data-ttu-id="418a5-231">A questo scopo, è possibile pianificare in tutta semplicità il backup (ad esempio, una volta al giorno) e usare una procedura di copia per spostare il backup nel sito di ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="418a5-231">This can easily be achieved by scheduling the backup (for example, once daily) and using a copy procedure to place the backup at the DR site.</span></span> <span data-ttu-id="418a5-232">Le procedure di copia possono includere programmi basati su script come AzCopy (Azure Copy) o la configurazione di DFSR (Distributed File Services Replication).</span><span class="sxs-lookup"><span data-stu-id="418a5-232">Copy procedures could include scripted programs such as AzCopy (Azure Copy) or setting up DFSR (Distributed File Services Replication).</span></span>
    * <span data-ttu-id="418a5-233">Quando la farm di SharePoint è in esecuzione, passare ad Amministrazione centrale, quindi a "Backup e ripristino" e selezionare Ripristina.</span><span class="sxs-lookup"><span data-stu-id="418a5-233">Now that the SharePoint farm is running, navigate the Central Administration, 'Backup and Restore' and select Restore.</span></span> <span data-ttu-id="418a5-234">Il ripristino interroga il percorso di backup specificato. Potrebbe essere necessario aggiornare il valore.</span><span class="sxs-lookup"><span data-stu-id="418a5-234">The restore interrogates the backup location specified (you may need to update the value).</span></span> <span data-ttu-id="418a5-235">Selezionare il backup dell'applicazione del servizio di ricerca che si vuole ripristinare.</span><span class="sxs-lookup"><span data-stu-id="418a5-235">Select the Search Service Application backup you would like to restore.</span></span>
    * <span data-ttu-id="418a5-236">La ricerca viene ripristinata.</span><span class="sxs-lookup"><span data-stu-id="418a5-236">Search is restored.</span></span> <span data-ttu-id="418a5-237">Tenere presente che l'operazione di ripristino si aspetta di trovare la stessa topologia, ovvero lo stesso numero di server, e le stesse lettere di unità assegnate ai server.</span><span class="sxs-lookup"><span data-stu-id="418a5-237">Keep in mind that the restore expects to find the same topology (same number of servers) and same hard drive letters assigned to those servers.</span></span> <span data-ttu-id="418a5-238">Per altre informazioni, vedere il documento [Ripristinare le applicazioni del servizio di ricerca in SharePoint 2013](https://technet.microsoft.com/library/ee748654.aspx).</span><span class="sxs-lookup"><span data-stu-id="418a5-238">For more information, see ['Restore Search service application in SharePoint 2013'](https://technet.microsoft.com/library/ee748654.aspx) document.</span></span>


6. <span data-ttu-id="418a5-239">Per avviare il sistema con una nuova applicazione del servizio di ricerca, seguire i passaggi seguenti.</span><span class="sxs-lookup"><span data-stu-id="418a5-239">For starting with a new Search service application, follow below steps.</span></span>

    * <span data-ttu-id="418a5-240">Questo metodo presuppone che nel sito di ripristino di emergenza sia disponibile un backup del database di amministrazione della ricerca.</span><span class="sxs-lookup"><span data-stu-id="418a5-240">This method assumes that a backup of the “Search Administration” database is available at the DR site.</span></span>
    * <span data-ttu-id="418a5-241">Poiché gli altri database dell'applicazione del servizio di ricerca non vengono replicati, devono essere ricreati.</span><span class="sxs-lookup"><span data-stu-id="418a5-241">Since the other Search Service Application databases are not replicated, they need to be re-created.</span></span> <span data-ttu-id="418a5-242">A questo scopo, passare ad Amministrazione centrale ed eliminare l'applicazione del servizio di ricerca.</span><span class="sxs-lookup"><span data-stu-id="418a5-242">To do so, navigate to Central Administration and delete the Search Service Application.</span></span> <span data-ttu-id="418a5-243">Eliminare i file di indice in tutti i server che ospitano l'indice di ricerca.</span><span class="sxs-lookup"><span data-stu-id="418a5-243">On any servers which host the Search Index, delete the index files.</span></span>
    * <span data-ttu-id="418a5-244">Ricreare l'applicazione del servizio di ricerca perché vengano ricreati i database.</span><span class="sxs-lookup"><span data-stu-id="418a5-244">Re-create the Search Service Application and this re-creates the databases.</span></span> <span data-ttu-id="418a5-245">È consigliabile aver preparato uno script che ricrea questa applicazione di servizio, perché non è possibile eseguire tutte le operazioni tramite l'interfaccia utente grafica.</span><span class="sxs-lookup"><span data-stu-id="418a5-245">It is recommended to have a prepared script that re-creates this service application since it is not possible to perform all actions via the GUI.</span></span> <span data-ttu-id="418a5-246">Ad esempio, l'impostazione del percorso dell'unità degli indici e la configurazione della topologia di ricerca sono possibili solo usando i cmdlet di PowerShell per SharePoint.</span><span class="sxs-lookup"><span data-stu-id="418a5-246">For example, setting the index drive location and configuring the search topology are only possible by using SharePoint PowerShell cmdlets.</span></span> <span data-ttu-id="418a5-247">Usare il cmdlet di Windows PowerShell Restore-SPEnterpriseSearchServiceApplication e specificare il database di amministrazione della ricerca Search_Service__DB fornito dal log e replicato.</span><span class="sxs-lookup"><span data-stu-id="418a5-247">Use the Windows PowerShell cmdlet Restore-SPEnterpriseSearchServiceApplication and specify the log-shipped and replicated Search Administration database, Search_Service__DB.</span></span> <span data-ttu-id="418a5-248">Questo cmdlet fornisce la configurazione, lo schema, le proprietà gestite, le regole e le origini della ricerca e crea un set predefinito degli altri componenti.</span><span class="sxs-lookup"><span data-stu-id="418a5-248">This cmdlet gives the search configuration, schema, managed properties, rules, and sources and creates a default set of the other components.</span></span>
    * <span data-ttu-id="418a5-249">Una volta ricreata l'applicazione del servizio di ricerca, è necessario avviare una ricerca per indicizzazione completa per ogni origine di contenuto per ripristinare il servizio di ricerca.</span><span class="sxs-lookup"><span data-stu-id="418a5-249">Once the Search Service Application has be re-created, you must start a full crawl for each content source to restore the Search Service.</span></span> <span data-ttu-id="418a5-250">Verranno perse alcune informazioni di analisi dalla farm locale, ad esempio i suggerimenti per la ricerca.</span><span class="sxs-lookup"><span data-stu-id="418a5-250">You lose some analytics information from the on-premises farm, such as search recommendations.</span></span>

7. <span data-ttu-id="418a5-251">Al termine di tutti i passaggi, salvare il piano di ripristino. Il piano di ripristino finale avrà un aspetto simile al seguente.</span><span class="sxs-lookup"><span data-stu-id="418a5-251">Once all the steps are completed, save the recovery plan and the final recovery plan will look like following.</span></span>

    ![Piano di ripristino salvato](./media/site-recovery-sharepoint/saved-rp.png)

## <a name="doing-a-test-failover"></a><span data-ttu-id="418a5-253">Esecuzione di un failover di test</span><span class="sxs-lookup"><span data-stu-id="418a5-253">Doing a test failover</span></span>
<span data-ttu-id="418a5-254">Seguire [queste linee guida](site-recovery-test-failover-to-azure.md) per eseguire un failover di test.</span><span class="sxs-lookup"><span data-stu-id="418a5-254">Follow [this guidance](site-recovery-test-failover-to-azure.md) to do a test failover.</span></span>

1.  <span data-ttu-id="418a5-255">Accedere al portale di Azure e selezionare l'insieme di credenziali di Servizi di ripristino.</span><span class="sxs-lookup"><span data-stu-id="418a5-255">Go to Azure portal and select your Recovery Service vault.</span></span>
2.  <span data-ttu-id="418a5-256">Fare clic sul piano di ripristino creato per l'applicazione di SharePoint.</span><span class="sxs-lookup"><span data-stu-id="418a5-256">Click on the recovery plan created for SharePoint application.</span></span>
3.  <span data-ttu-id="418a5-257">Fare clic su 'Failover di test'.</span><span class="sxs-lookup"><span data-stu-id="418a5-257">Click on 'Test Failover'.</span></span>
4.  <span data-ttu-id="418a5-258">Selezionare il punto di recupero e la rete virtuale di Azure per avviare il processo di failover di test.</span><span class="sxs-lookup"><span data-stu-id="418a5-258">Select recovery point and Azure virtual network to start the test failover process.</span></span>
5.  <span data-ttu-id="418a5-259">Quando l'ambiente secondario è disponibile, è possibile eseguire le convalide.</span><span class="sxs-lookup"><span data-stu-id="418a5-259">Once the secondary environment is up, you can perform your validations.</span></span>
6.  <span data-ttu-id="418a5-260">Al termine delle convalide, è possibile fare clic su "Pulizia failover di test" nel piano di ripristino perché l'ambiente di failover di test venga pulito.</span><span class="sxs-lookup"><span data-stu-id="418a5-260">Once the validations are complete, you can click 'Cleanup test failover' on the recovery plan and the test failover environment is cleaned.</span></span>

<span data-ttu-id="418a5-261">Per le linee guida su come eseguire il failover di test per Active Directory e DNS, fare riferimento al documento [Considerazioni sul failover di test per Active Directory e DNS](site-recovery-active-directory.md#test-failover-considerations).</span><span class="sxs-lookup"><span data-stu-id="418a5-261">For guidance on doing test failover for AD and DNS, refer to [Test failover considerations for AD and DNS](site-recovery-active-directory.md#test-failover-considerations) document.</span></span>

<span data-ttu-id="418a5-262">Per le linee guida su come eseguire il failover di test per gruppi di disponibilità SQL AlwaysOn, fare riferimento al documento [Esecuzione di un failover di test per SQL AlwaysOn](site-recovery-sql.md#steps-to-do-a-test-failover).</span><span class="sxs-lookup"><span data-stu-id="418a5-262">For guidance on doing test failover for SQL Always ON availability groups, refer to [Doing Test failover for SQL Server Always On](site-recovery-sql.md#steps-to-do-a-test-failover) document.</span></span>

## <a name="doing-a-failover"></a><span data-ttu-id="418a5-263">Esecuzione di un failover</span><span class="sxs-lookup"><span data-stu-id="418a5-263">Doing a failover</span></span>
<span data-ttu-id="418a5-264">Seguire [queste linee guida](site-recovery-failover.md) per eseguire un failover.</span><span class="sxs-lookup"><span data-stu-id="418a5-264">Follow [this guidance](site-recovery-failover.md) for doing a failover.</span></span>

1.  <span data-ttu-id="418a5-265">Accedere al portale di Azure e selezionare l'insieme di credenziali di Servizi di ripristino.</span><span class="sxs-lookup"><span data-stu-id="418a5-265">Go to Azure portal and select your Recovery Services vault.</span></span>
2.  <span data-ttu-id="418a5-266">Fare clic sul piano di ripristino creato per l'applicazione di SharePoint.</span><span class="sxs-lookup"><span data-stu-id="418a5-266">Click on the recovery plan created for SharePoint application.</span></span>
3.  <span data-ttu-id="418a5-267">Fare clic su 'Failover'.</span><span class="sxs-lookup"><span data-stu-id="418a5-267">Click on 'Failover'.</span></span>
4.  <span data-ttu-id="418a5-268">Selezionare il punto di recupero per avviare il processo di failover.</span><span class="sxs-lookup"><span data-stu-id="418a5-268">Select recovery point to start the failover process.</span></span>

## <a name="next-steps"></a><span data-ttu-id="418a5-269">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="418a5-269">Next steps</span></span>
<span data-ttu-id="418a5-270">Altre informazioni sulla [replica di altre applicazioni](site-recovery-workload.md) con Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="418a5-270">You can learn more about [replicating other applications](site-recovery-workload.md) using Site Recovery.</span></span>
