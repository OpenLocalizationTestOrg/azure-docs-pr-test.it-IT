---
title: Messaggistica asincrona del bus di servizio | Documentazione Microsoft
description: Descrizione della messaggistica asincrona del bus di servizio di Azure.
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: f1435549-e1f2-40cb-a280-64ea07b39fc7
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/19/2017
ms.author: sethm
ms.openlocfilehash: 95d6f295ba145a55fe4ed3fc7c6f627c9d419a3c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="asynchronous-messaging-patterns-and-high-availability"></a><span data-ttu-id="e7b63-103">Modelli di messaggistica asincrona e disponibilità elevata</span><span class="sxs-lookup"><span data-stu-id="e7b63-103">Asynchronous messaging patterns and high availability</span></span>

<span data-ttu-id="e7b63-104">La messaggistica asincrona può essere implementata in molti modi diversi.</span><span class="sxs-lookup"><span data-stu-id="e7b63-104">Asynchronous messaging can be implemented in a variety of different ways.</span></span> <span data-ttu-id="e7b63-105">Con code, argomenti e sottoscrizioni, il bus di servizio di Azure supporta la messaggistica asincrona tramite un meccanismo di archiviazione e inoltro.</span><span class="sxs-lookup"><span data-stu-id="e7b63-105">With queues, topics, and subscriptions, Azure Service Bus supports asynchronism via a store and forward mechanism.</span></span> <span data-ttu-id="e7b63-106">In un'operazione normale (sincrona) i messaggi vengono inviati a code e argomenti e ricevuti da code e sottoscrizioni.</span><span class="sxs-lookup"><span data-stu-id="e7b63-106">In normal (synchronous) operation, you send messages to queues and topics, and receive messages from queues and subscriptions.</span></span> <span data-ttu-id="e7b63-107">Le applicazioni create dipendono dalla disponibilità continua di queste entità.</span><span class="sxs-lookup"><span data-stu-id="e7b63-107">Applications you write depend on these entities always being available.</span></span> <span data-ttu-id="e7b63-108">Quando l'integrità dell'entità cambia a causa di diverse circostanze, è necessario fornire un'entità a capacità limitata che possa soddisfare la maggior parte delle esigenze.</span><span class="sxs-lookup"><span data-stu-id="e7b63-108">When the entity health changes, due to a variety of circumstances, you need a way to provide a reduced capability entity that can satisfy most needs.</span></span>

<span data-ttu-id="e7b63-109">In genere, le applicazioni usano modelli di messaggistica asincrona per consentire diversi scenari di comunicazione.</span><span class="sxs-lookup"><span data-stu-id="e7b63-109">Applications typically use asynchronous messaging patterns to enable a number of communication scenarios.</span></span> <span data-ttu-id="e7b63-110">È possibile creare applicazioni in cui i client possono inviare messaggi ai servizi anche quando questi non sono in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="e7b63-110">You can build applications in which clients can send messages to services, even when the service is not running.</span></span> <span data-ttu-id="e7b63-111">Per le applicazioni in cui si verificano picchi nelle comunicazioni, si può usare una coda per livellare il carico fornendo un'area per il buffer delle comunicazioni. </span><span class="sxs-lookup"><span data-stu-id="e7b63-111">For applications that experience bursts of communications, a queue can help level the load by providing a place to buffer communications.</span></span> <span data-ttu-id="e7b63-112">Infine è possibile ottenere un semplice ma efficace servizio di bilanciamento del carico per distribuire i messaggi tra più computer.</span><span class="sxs-lookup"><span data-stu-id="e7b63-112">Finally, you can get a simple but effective load balancer to distribute messages across multiple machines.</span></span>

<span data-ttu-id="e7b63-113">Per mantenere la disponibilità di una qualsiasi di queste entità, è necessario considerare i diversi casi in cui le entità possono risultare non disponibili per un sistema di messaggistica permanente.</span><span class="sxs-lookup"><span data-stu-id="e7b63-113">In order to maintain availability of any of these entities, consider a number of different ways in which these entities can appear unavailable for a durable messaging system.</span></span> <span data-ttu-id="e7b63-114">In generale, l'entità risulta non disponibile alle applicazioni nelle circostanze seguenti:</span><span class="sxs-lookup"><span data-stu-id="e7b63-114">Generally speaking, we see the entity become unavailable to applications we write in the following different ways:</span></span>

* <span data-ttu-id="e7b63-115">Impossibilità di inviare messaggi.</span><span class="sxs-lookup"><span data-stu-id="e7b63-115">Unable to send messages.</span></span>
* <span data-ttu-id="e7b63-116">Impossibilità di ricevere messaggi.</span><span class="sxs-lookup"><span data-stu-id="e7b63-116">Unable to receive messages.</span></span>
* <span data-ttu-id="e7b63-117">Impossibilità di gestire le entità, ad esempio eseguire operazioni di creazione, recupero, aggiornamento o eliminazione.</span><span class="sxs-lookup"><span data-stu-id="e7b63-117">Unable to manage entities (create, retrieve, update, or delete entities).</span></span>
* <span data-ttu-id="e7b63-118">Impossibilità di contattare il servizio.</span><span class="sxs-lookup"><span data-stu-id="e7b63-118">Unable to contact the service.</span></span>

<span data-ttu-id="e7b63-119">Per ognuno di questi problemi, esistono diverse modalità di errore che consentono a un'applicazione di continuare a funzionare a un certo livello di capacità limitata.</span><span class="sxs-lookup"><span data-stu-id="e7b63-119">For each of these failures, different failure modes exist that enable an application to continue to perform work at some level of reduced capability.</span></span> <span data-ttu-id="e7b63-120">Ad esempio, un sistema che può inviare messaggi, ma non riceverli, e continuare comunque a ricevere ordini dai clienti senza però poterli elaborare.</span><span class="sxs-lookup"><span data-stu-id="e7b63-120">For example, a system that can send messages but not receive them can still receive orders from customers but cannot process those orders.</span></span> <span data-ttu-id="e7b63-121">Questo argomento illustra i problemi che possono verificarsi e le tecniche per attenuarne gli effetti.</span><span class="sxs-lookup"><span data-stu-id="e7b63-121">This topic discusses potential issues that can occur, and how those issues are mitigated.</span></span> <span data-ttu-id="e7b63-122">Nel bus di servizio sono state introdotte numerose misure di prevenzione che richiedono un consenso esplicito, le cui regole d'uso sono illustrate in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="e7b63-122">Service Bus has introduced a number of mitigations which you must opt into, and this topic also discusses the rules governing the use of those opt-in mitigations.</span></span>

## <a name="reliability-in-service-bus"></a><span data-ttu-id="e7b63-123">Affidabilità nel bus di servizio</span><span class="sxs-lookup"><span data-stu-id="e7b63-123">Reliability in Service Bus</span></span>
<span data-ttu-id="e7b63-124">Sono disponibili diverse modalità di gestione dei problemi relativi a entità e messaggi, oltre a linee guida per l'utilizzo appropriato di queste misure di prevenzione.</span><span class="sxs-lookup"><span data-stu-id="e7b63-124">There are several ways to handle message and entity issues, and there are guidelines governing the appropriate use of those mitigations.</span></span> <span data-ttu-id="e7b63-125">Per comprendere le linee guida, è necessario comprendere prima di tutto i motivi per cui nel bus di servizio si possono verificare errori.</span><span class="sxs-lookup"><span data-stu-id="e7b63-125">To understand the guidelines, you must first understand what can fail in Service Bus.</span></span> <span data-ttu-id="e7b63-126">Considerata la progettazione dei sistemi Azure, tutti questi problemi sono in genere di breve durata.</span><span class="sxs-lookup"><span data-stu-id="e7b63-126">Due to the design of Azure systems, all of these issues tend to be short-lived.</span></span> <span data-ttu-id="e7b63-127">Ad alto livello, le diverse cause della mancata disponibilità si manifestano nei modi seguenti:</span><span class="sxs-lookup"><span data-stu-id="e7b63-127">At a high level, the different causes of unavailability appear as follows:</span></span>

* <span data-ttu-id="e7b63-128">Limitazione da un sistema esterno dal quale dipende il bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="e7b63-128">Throttling from an external system on which Service Bus depends.</span></span> <span data-ttu-id="e7b63-129">La limitazione è generata da interazioni con le risorse di archiviazione e calcolo.</span><span class="sxs-lookup"><span data-stu-id="e7b63-129">Throttling occurs from interactions with storage and compute resources.</span></span>
* <span data-ttu-id="e7b63-130">Problema dovuto a un sistema dal quale dipende il bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="e7b63-130">Issue for a system on which Service Bus depends.</span></span> <span data-ttu-id="e7b63-131">Ad esempio, problemi che possono verificarsi in una determinata risorsa di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="e7b63-131">For example, a given part of storage can encounter issues.</span></span>
* <span data-ttu-id="e7b63-132">Errore del bus di servizio in un singolo sottosistema.</span><span class="sxs-lookup"><span data-stu-id="e7b63-132">Failure of Service Bus on single subsystem.</span></span> <span data-ttu-id="e7b63-133">In questo caso, è possibile che un nodo di calcolo si trovi in uno stato incoerente e debba essere riavviato, causando il bilanciamento del carico in altri nodi di tutte le entità servite.</span><span class="sxs-lookup"><span data-stu-id="e7b63-133">In this situation, a compute node can get into an inconsistent state and must restart itself, causing all entities it serves to load balance to other nodes.</span></span> <span data-ttu-id="e7b63-134">Questa situazione può causare a sua volta un breve periodo di elaborazione lenta dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="e7b63-134">This in turn can cause a short period of slow message processing.</span></span>
* <span data-ttu-id="e7b63-135">Errore del bus di servizio in un data center di Azure.</span><span class="sxs-lookup"><span data-stu-id="e7b63-135">Failure of Service Bus within an Azure datacenter.</span></span> <span data-ttu-id="e7b63-136">Questo è un "errore irreversibile" durante il quale il sistema risulta irraggiungibile per diversi minuti o per alcune ore.</span><span class="sxs-lookup"><span data-stu-id="e7b63-136">This is a "catastrophic failure" during which the system is unreachable for many minutes or a few hours.</span></span>

> [!NOTE]
> <span data-ttu-id="e7b63-137">Il termine **archiviazione** può indicare sia archiviazione di Azure sia di SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="e7b63-137">The term **storage** can mean both Azure Storage and SQL Azure.</span></span>
> 
> 

<span data-ttu-id="e7b63-138">Nel bus di servizio sono disponibili diverse misure di prevenzione per questi problemi.</span><span class="sxs-lookup"><span data-stu-id="e7b63-138">Service Bus contains a number of mitigations for these issues.</span></span> <span data-ttu-id="e7b63-139">Le sezioni seguenti illustrano ogni problema e le relative misure di prevenzione.</span><span class="sxs-lookup"><span data-stu-id="e7b63-139">The following sections discuss each issue and their respective mitigations.</span></span>

### <a name="throttling"></a><span data-ttu-id="e7b63-140">Limitazione</span><span class="sxs-lookup"><span data-stu-id="e7b63-140">Throttling</span></span>
<span data-ttu-id="e7b63-141">Nel bus di servizio la limitazione consente la gestione congiunta della frequenza dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="e7b63-141">With Service Bus, throttling enables cooperative message rate management.</span></span> <span data-ttu-id="e7b63-142">Ogni singolo nodo del bus di servizio ospita molte entità,</span><span class="sxs-lookup"><span data-stu-id="e7b63-142">Each individual Service Bus node houses many entities.</span></span> <span data-ttu-id="e7b63-143">ognuna delle quali invia richieste al sistema in termini di CPU, memoria, archiviazione e altri facet.</span><span class="sxs-lookup"><span data-stu-id="e7b63-143">Each of those entities makes demands on the system in terms of CPU, memory, storage, and other facets.</span></span> <span data-ttu-id="e7b63-144">Quando uno di questi facet individua un utilizzo superiore alla soglia predefinita, il bus di servizio può negare una richiesta specifica.</span><span class="sxs-lookup"><span data-stu-id="e7b63-144">When any of these facets detects usage that exceeds defined thresholds, Service Bus can deny a given request.</span></span> <span data-ttu-id="e7b63-145">Il chiamante riceve un'eccezione di tipo [ServerBusyException][ServerBusyException] e riprova dopo 10 secondi.</span><span class="sxs-lookup"><span data-stu-id="e7b63-145">The caller receives a [ServerBusyException][ServerBusyException] and retries after 10 seconds.</span></span>

<span data-ttu-id="e7b63-146">Come misura di prevenzione, il codice deve leggere l'errore e bloccare ogni nuovo tentativo del messaggio per almeno 10 secondi.</span><span class="sxs-lookup"><span data-stu-id="e7b63-146">As a mitigation, the code must read the error and halt any retries of the message for at least 10 seconds.</span></span> <span data-ttu-id="e7b63-147">Poiché l'errore può verificarsi in varie parti dell'applicazione del cliente, si presuppone che ogni parte esegua indipendentemente la logica di ripetizione dei tentativi.</span><span class="sxs-lookup"><span data-stu-id="e7b63-147">Since the error can happen across pieces of the customer application, it is expected that each piece independently executes the retry logic.</span></span> <span data-ttu-id="e7b63-148">Il codice può ridurre l'occorrenza delle limitazioni abilitando il partizionamento di una coda o un argomento.</span><span class="sxs-lookup"><span data-stu-id="e7b63-148">The code can reduce the probability of being throttled by enabling partitioning on a queue or topic.</span></span>

### <a name="issue-for-an-azure-dependency"></a><span data-ttu-id="e7b63-149">Problema per una dipendenza di Azure</span><span class="sxs-lookup"><span data-stu-id="e7b63-149">Issue for an Azure dependency</span></span>
<span data-ttu-id="e7b63-150">Anche per altri componenti di Azure possono occasionalmente verificarsi problemi di servizio.</span><span class="sxs-lookup"><span data-stu-id="e7b63-150">Other components within Azure can occasionally have service issues.</span></span> <span data-ttu-id="e7b63-151">Quando, ad esempio, si aggiorna un sistema usato dal bus di servizio, è possibile che il sistema funzioni temporaneamente con capacità limitate.</span><span class="sxs-lookup"><span data-stu-id="e7b63-151">For example, when a system that Service Bus uses is being upgraded, that system can temporarily experience reduced capabilities.</span></span> <span data-ttu-id="e7b63-152">Per risolvere questo tipo di problemi, il bus di servizio analizza e implementa regolarmente le misure di prevenzione.</span><span class="sxs-lookup"><span data-stu-id="e7b63-152">To work around these types of issues, Service Bus regularly investigates and implements mitigations.</span></span> <span data-ttu-id="e7b63-153">È tuttavia possibile che si verifichino effetti collaterali di misure di prevenzione.</span><span class="sxs-lookup"><span data-stu-id="e7b63-153">Side effects of these mitigations do appear.</span></span> <span data-ttu-id="e7b63-154">Ad esempio, per gestire problemi temporanei con l'archiviazione, il bus di servizio implementa un sistema che consente il funzionamento uniforme delle operazioni di invio dei messaggi. </span><span class="sxs-lookup"><span data-stu-id="e7b63-154">For example, to handle transient issues with storage, Service Bus implements a system that allows message send operations to work consistently.</span></span> <span data-ttu-id="e7b63-155">Considerata la natura della misura di prevenzione, un messaggio inviato può impiegare fino a 15 minuti prima di essere visualizzato nella sottoscrizione o nella coda interessata ed essere pronto per un'operazione di ricezione.</span><span class="sxs-lookup"><span data-stu-id="e7b63-155">Due to the nature of the mitigation, a sent message can take up to 15 minutes to appear in the affected queue or subscription and be ready for a receive operation.</span></span> <span data-ttu-id="e7b63-156">In genere, la maggior parte delle entità non è interessata da questo problema.</span><span class="sxs-lookup"><span data-stu-id="e7b63-156">Generally speaking, most entities will not experience this issue.</span></span> <span data-ttu-id="e7b63-157">Dato tuttavia il numero di entità presenti nel bus di servizio all'interno di Azure, questa misura di prevenzione può essere utile a volte per un limitato sottoinsieme di clienti del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="e7b63-157">However, given the number of entities in Service Bus within Azure, this mitigation is sometimes needed for a small subset of Service Bus customers.</span></span>

### <a name="service-bus-failure-on-a-single-subsystem"></a><span data-ttu-id="e7b63-158">Errore del bus di servizio in un singolo sottosistema</span><span class="sxs-lookup"><span data-stu-id="e7b63-158">Service Bus failure on a single subsystem</span></span>
<span data-ttu-id="e7b63-159">In qualsiasi applicazione possono verificarsi casi in cui un componente interno del bus di servizio diventa incoerente.</span><span class="sxs-lookup"><span data-stu-id="e7b63-159">With any application, circumstances can cause an internal component of Service Bus to become inconsistent.</span></span> <span data-ttu-id="e7b63-160">Quando il bus di servizio rileva questo problema, raccoglie dati dall'applicazione a fini diagnostici.</span><span class="sxs-lookup"><span data-stu-id="e7b63-160">When Service Bus detects this, it collects data from the application to aid in diagnosing what happened.</span></span> <span data-ttu-id="e7b63-161">Una volta raccolti i dati, l'applicazione viene riavviata nel tentativo di ripristinarne un stato coerente.</span><span class="sxs-lookup"><span data-stu-id="e7b63-161">Once the data is collected, the application is restarted in an attempt to return it to a consistent state.</span></span> <span data-ttu-id="e7b63-162">Questo processo avviene abbastanza velocemente e causa la mancata disponibilità di un'entità per alcuni minuti, anche se in genere i tempi di inattività sono molto più brevi.</span><span class="sxs-lookup"><span data-stu-id="e7b63-162">This process happens fairly quickly, and results in an entity appearing to be unavailable for up to a few minutes, though typical down times are much shorter.</span></span>

<span data-ttu-id="e7b63-163">In questi casi, l'applicazione client genera un'eccezione di tipo [System.TimeoutException][System.TimeoutException] o [MessagingException][MessagingException].</span><span class="sxs-lookup"><span data-stu-id="e7b63-163">In these cases, the client application generates a [System.TimeoutException][System.TimeoutException] or [MessagingException][MessagingException] exception.</span></span> <span data-ttu-id="e7b63-164">Il bus di servizio include una misura di prevenzione per questo problema basata sulla logica di ripetizione automatica dei tentativi del client.</span><span class="sxs-lookup"><span data-stu-id="e7b63-164">Service Bus contains a mitigation for this issue in the form of automated client retry logic.</span></span> <span data-ttu-id="e7b63-165">Al termine del periodo di ripetizione, se il messaggio non è stato recapitato, è possibile provare a usare altre funzionalità, ad esempio gli [spazi dei nomi associati][paired namespaces].</span><span class="sxs-lookup"><span data-stu-id="e7b63-165">Once the retry period is exhausted and the message is not delivered, you can explore using other features such as [paired namespaces][paired namespaces].</span></span> <span data-ttu-id="e7b63-166">Questi ultimi presentano altri ostacoli che sono illustrati in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="e7b63-166">Paired namespaces have other caveats that are discussed in that article.</span></span>

### <a name="failure-of-service-bus-within-an-azure-datacenter"></a><span data-ttu-id="e7b63-167">Errore del bus di servizio in un data center di Azure</span><span class="sxs-lookup"><span data-stu-id="e7b63-167">Failure of Service Bus within an Azure datacenter</span></span>
<span data-ttu-id="e7b63-168">Il motivo più probabile di un errore in un data center di Azure è una distribuzione di aggiornamento non riuscita del bus di servizio o di un sistema dipendente.</span><span class="sxs-lookup"><span data-stu-id="e7b63-168">The most probable reason for a failure in an Azure datacenter is a failed upgrade deployment of Service Bus or a dependent system.</span></span> <span data-ttu-id="e7b63-169">Poiché la piattaforma è stata migliorata, la probabilità di questo tipo di errore è diminuita.</span><span class="sxs-lookup"><span data-stu-id="e7b63-169">As the platform has matured, the likelihood of this type of failure has diminished.</span></span> <span data-ttu-id="e7b63-170">Un errore di un data center può verificarsi anche per i motivi seguenti:</span><span class="sxs-lookup"><span data-stu-id="e7b63-170">A datacenter failure can also happen for reasons that include the following:</span></span>

* <span data-ttu-id="e7b63-171">Interruzione elettrica (arresto di alimentazione e produzione di energia).</span><span class="sxs-lookup"><span data-stu-id="e7b63-171">Electrical outage (power supply and generating power disappear).</span></span>
* <span data-ttu-id="e7b63-172">Connettività (interruzione della connessione Internet tra i client e Azure).</span><span class="sxs-lookup"><span data-stu-id="e7b63-172">Connectivity (internet break between your clients and Azure).</span></span>

<span data-ttu-id="e7b63-173">In entrambi i casi, il problema è dovuto a una calamità naturale o a un errore umano.</span><span class="sxs-lookup"><span data-stu-id="e7b63-173">In both cases, a natural or man-made disaster caused the issue.</span></span> <span data-ttu-id="e7b63-174">Per aggirare il problema e assicurarsi di poter continuare a inviare messaggi, è possibile usare gli [spazi dei nomi associati][paired namespaces] per attivare l'invio dei messaggi a una seconda destinazione mentre viene ristabilita l'integrità della prima destinazione.</span><span class="sxs-lookup"><span data-stu-id="e7b63-174">To work around this and make sure that you can still send messages, you can use [paired namespaces][paired namespaces] to enable messages to be sent to a second location while the primary location is made healthy again.</span></span> <span data-ttu-id="e7b63-175">Per altre informazioni, vedere [Procedure consigliate per isolare le applicazioni del bus di servizio da interruzioni ed emergenze del servizio][Best practices for insulating applications against Service Bus outages and disasters].</span><span class="sxs-lookup"><span data-stu-id="e7b63-175">For more information, see [Best practices for insulating applications against Service Bus outages and disasters][Best practices for insulating applications against Service Bus outages and disasters].</span></span>

## <a name="paired-namespaces"></a><span data-ttu-id="e7b63-176">Spazi dei nomi associati</span><span class="sxs-lookup"><span data-stu-id="e7b63-176">Paired namespaces</span></span>
<span data-ttu-id="e7b63-177">La funzionalità degli [spazi dei nomi associati][paired namespaces] supporta scenari in cui un'entità o una distribuzione del bus di servizio in un data center diventa non disponibile.</span><span class="sxs-lookup"><span data-stu-id="e7b63-177">The [paired namespaces][paired namespaces] feature supports scenarios in which a Service Bus entity or deployment within a data center becomes unavailable.</span></span> <span data-ttu-id="e7b63-178">Anche se eventi di questo tipo si verificano raramente, i sistemi distribuiti devono comunque essere in grado di gestire gli scenari peggiori.</span><span class="sxs-lookup"><span data-stu-id="e7b63-178">While this event occurs infrequently, distributed systems still must be prepared to handle worst case scenarios.</span></span> <span data-ttu-id="e7b63-179">In genere, questo tipo di evento si verifica perché in qualche elemento dal quale dipende il bus di servizio avviene un problema di breve durata.</span><span class="sxs-lookup"><span data-stu-id="e7b63-179">Typically, this event happens because some element on which Service Bus depends is experiencing a short-term issue.</span></span> <span data-ttu-id="e7b63-180">Per garantire la disponibilità di un'applicazione durante un'interruzione, gli utenti del bus di servizio possono usare due diversi spazi dei nomi, preferibilmente in due distinti data center, per ospitare le proprie entità di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="e7b63-180">To maintain application availability during an outage, Service Bus users can use two separate namespaces, preferably in separate data centers, to host their messaging entities.</span></span> <span data-ttu-id="e7b63-181">Nel resto di questa sezione si userà la terminologia seguente:</span><span class="sxs-lookup"><span data-stu-id="e7b63-181">The remainder of this section uses the following terminology:</span></span>

* <span data-ttu-id="e7b63-182">Spazio dei nomi primario: spazio dei nomi con cui interagisce l'applicazione per operazioni di invio e ricezione.</span><span class="sxs-lookup"><span data-stu-id="e7b63-182">Primary namespace: The namespace with which your application interacts, for send and receive operations.</span></span>
* <span data-ttu-id="e7b63-183">Spazio dei nomi secondario: spazio dei nomi che agisce come backup dello spazio dei nomi primario.</span><span class="sxs-lookup"><span data-stu-id="e7b63-183">Secondary namespace: The namespace that acts as a backup to the primary namespace.</span></span> <span data-ttu-id="e7b63-184">La logica dell'applicazione non interagisce con questo spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="e7b63-184">Application logic does not interact with this namespace.</span></span>
* <span data-ttu-id="e7b63-185">Intervallo di failover: intervallo di tempo per accettare gli errori normali prima che l'applicazione passi dallo spazio dei nomi primario a quello secondario.</span><span class="sxs-lookup"><span data-stu-id="e7b63-185">Failover interval: The amount of time to accept normal failures before the application switches from the primary namespace to the secondary namespace.</span></span>

<span data-ttu-id="e7b63-186">Gli spazi dei nomi associati supportano *sendavailability*,</span><span class="sxs-lookup"><span data-stu-id="e7b63-186">Paired namespaces support *send availability*.</span></span> <span data-ttu-id="e7b63-187">che consente di preservare la capacità di inviare messaggi.</span><span class="sxs-lookup"><span data-stu-id="e7b63-187">Send availability preserves the ability to send messages.</span></span> <span data-ttu-id="e7b63-188">Per usare la funzionalità SendAvailability, l'applicazione deve soddisfare i requisiti seguenti:</span><span class="sxs-lookup"><span data-stu-id="e7b63-188">To use send availability, your application must meet the following requirements:</span></span>

1. <span data-ttu-id="e7b63-189">I messaggi vengono ricevuti solo dallo spazio dei nomi primario.</span><span class="sxs-lookup"><span data-stu-id="e7b63-189">Messages are only received from the primary namespace.</span></span>
2. <span data-ttu-id="e7b63-190">I messaggi inviati a una coda o a un argomento specifico possono arrivare senza un ordine preciso.</span><span class="sxs-lookup"><span data-stu-id="e7b63-190">Messages sent to a given queue or topic might arrive out of order.</span></span>
3. <span data-ttu-id="e7b63-191">I messaggi in una sessione possono arrivare senza un ordine preciso.</span><span class="sxs-lookup"><span data-stu-id="e7b63-191">Messages within a session might arrive out of order.</span></span> <span data-ttu-id="e7b63-192">Questa è un'interruzione rispetto alla normale funzionalità delle sessioni,</span><span class="sxs-lookup"><span data-stu-id="e7b63-192">This is a break from normal functionality of sessions.</span></span> <span data-ttu-id="e7b63-193">che sta a indicare che l'applicazione usa le sessioni per il raggruppamento logico dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="e7b63-193">This means that your application uses sessions to logically group messages.</span></span>
4. <span data-ttu-id="e7b63-194">Lo stato delle sessioni viene mantenuto solo nello spazio dei nomi primario.</span><span class="sxs-lookup"><span data-stu-id="e7b63-194">Session state is only maintained on the primary namespace.</span></span>
5. <span data-ttu-id="e7b63-195">La coda primaria può tornare online e iniziare ad accettare i messaggi prima che la coda secondaria recapiti tutti i messaggi alla coda primaria.</span><span class="sxs-lookup"><span data-stu-id="e7b63-195">The primary queue can come online and start accepting messages before the secondary queue delivers all messages into the primary queue.</span></span>

<span data-ttu-id="e7b63-196">Le sezioni seguenti illustrano l'API, la relativa modalità di implementazione e il codice di esempio che usa la funzionalità.</span><span class="sxs-lookup"><span data-stu-id="e7b63-196">The following sections discuss the APIs, how the APIs are implemented, and shows sample code that uses the feature.</span></span> <span data-ttu-id="e7b63-197">Si noti che a questa funzionalità sono associati costi di fatturazione.</span><span class="sxs-lookup"><span data-stu-id="e7b63-197">Note that there are billing implications associated with this feature.</span></span>

### <a name="the-messagingfactorypairnamespaceasync-api"></a><span data-ttu-id="e7b63-198">API MessagingFactory.PairNamespaceAsync</span><span class="sxs-lookup"><span data-stu-id="e7b63-198">The MessagingFactory.PairNamespaceAsync API</span></span>
<span data-ttu-id="e7b63-199">La funzionalità degli spazi dei nomi associati include il metodo [PairNamespaceAsync][PairNamespaceAsync] sulla classe [Microsoft.ServiceBus.Messaging.MessagingFactory][Microsoft.ServiceBus.Messaging.MessagingFactory]:</span><span class="sxs-lookup"><span data-stu-id="e7b63-199">The paired namespaces feature includes the [PairNamespaceAsync][PairNamespaceAsync] method on the [Microsoft.ServiceBus.Messaging.MessagingFactory][Microsoft.ServiceBus.Messaging.MessagingFactory] class:</span></span>

```csharp
public Task PairNamespaceAsync(PairedNamespaceOptions options);
```

<span data-ttu-id="e7b63-200">Quando l'attività è terminata, l'associazione degli spazi dei nomi è completa e pronta ad avere effetto su qualsiasi oggetto [MessageReceiver][MessageReceiver], [QueueClient][QueueClient] o [TopicClient][TopicClient] creato con l'istanza [MessagingFactory][MessagingFactory].</span><span class="sxs-lookup"><span data-stu-id="e7b63-200">When the task completes, the namespace pairing is also complete and ready to act upon for any [MessageReceiver][MessageReceiver], [QueueClient][QueueClient], or [TopicClient][TopicClient] created with the [MessagingFactory][MessagingFactory] instance.</span></span> <span data-ttu-id="e7b63-201">[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions][Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] è la classe di base per i vari tipi di associazioni disponibili con un oggetto [MessagingFactory][MessagingFactory].</span><span class="sxs-lookup"><span data-stu-id="e7b63-201">[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions][Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] is the base class for the different types of pairing that are available with a [MessagingFactory][MessagingFactory] object.</span></span> <span data-ttu-id="e7b63-202">[SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] è attualmente l'unica classe derivata che implementa i requisiti della funzionalità SendAvailability.</span><span class="sxs-lookup"><span data-stu-id="e7b63-202">Currently, the only derived class is one named [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions], which implements the send availability requirements.</span></span> <span data-ttu-id="e7b63-203">La classe [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] include un set di costruttori che si basano tra loro.</span><span class="sxs-lookup"><span data-stu-id="e7b63-203">[SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] has a set of constructors that build on each other.</span></span> <span data-ttu-id="e7b63-204">Se si osserva il costruttore con il maggior numero di parametri, è possibile comprendere il comportamento degli altri.</span><span class="sxs-lookup"><span data-stu-id="e7b63-204">Looking at the constructor with the most parameters, you can understand the behavior of the other constructors.</span></span>

```csharp
public SendAvailabilityPairedNamespaceOptions(
    NamespaceManager secondaryNamespaceManager,
    MessagingFactory messagingFactory,
    int backlogQueueCount,
    TimeSpan failoverInterval,
    bool enableSyphon)
```

<span data-ttu-id="e7b63-205">Ecco il significato di questi parametri:</span><span class="sxs-lookup"><span data-stu-id="e7b63-205">These parameters have the following meanings:</span></span>

* <span data-ttu-id="e7b63-206">*secondaryNamespaceManager*: istanza inizializzata di [NamespaceManager][NamespaceManager] per lo spazio dei nomi secondario che può essere usata dal metodo [PairNamespaceAsync][PairNamespaceAsync] per configurare lo spazio dei nomi secondario.</span><span class="sxs-lookup"><span data-stu-id="e7b63-206">*secondaryNamespaceManager*: An initialized [NamespaceManager][NamespaceManager] instance for the secondary namespace that the [PairNamespaceAsync][PairNamespaceAsync] method can use to set up the secondary namespace.</span></span> <span data-ttu-id="e7b63-207">Il gestore dello spazio dei nomi viene usato per ottenere l'elenco di code nello spazio dei nomi e assicurarsi che esistano le code di backlog necessarie.</span><span class="sxs-lookup"><span data-stu-id="e7b63-207">The namespace manager is used to obtain the list of queues in the namespace and to make sure that the required backlog queues exist.</span></span> <span data-ttu-id="e7b63-208">Se le code non esistono, vengono create.</span><span class="sxs-lookup"><span data-stu-id="e7b63-208">If those queues do not exist, they are created.</span></span> <span data-ttu-id="e7b63-209">[NamespaceManager][NamespaceManager] richiede la possibilità di creare un token con l'attestazione **Manage**.</span><span class="sxs-lookup"><span data-stu-id="e7b63-209">[NamespaceManager][NamespaceManager] requires the ability to create a token with the **Manage** claim.</span></span>
* <span data-ttu-id="e7b63-210">*messagingFactory*: istanza di [MessagingFactory][MessagingFactory] per lo spazio dei nomi secondario.</span><span class="sxs-lookup"><span data-stu-id="e7b63-210">*messagingFactory*: The [MessagingFactory][MessagingFactory] instance for the secondary namespace.</span></span> <span data-ttu-id="e7b63-211">L'oggetto [MessagingFactory][MessagingFactory] viene usato per inviare e, se la proprietà [EnableSyphon][EnableSyphon] è impostata su **true**, ricevere messaggi dalle code di backlog.</span><span class="sxs-lookup"><span data-stu-id="e7b63-211">The [MessagingFactory][MessagingFactory] object is used to send and, if the [EnableSyphon][EnableSyphon] property is set to **true**, receive messages from the backlog queues.</span></span>
* <span data-ttu-id="e7b63-212">*backlogQueueCount*: numero di code di backlog da creare.</span><span class="sxs-lookup"><span data-stu-id="e7b63-212">*backlogQueueCount*: The number of backlog queues to create.</span></span> <span data-ttu-id="e7b63-213">Il valore deve essere almeno 1.</span><span class="sxs-lookup"><span data-stu-id="e7b63-213">This value must be at least 1.</span></span> <span data-ttu-id="e7b63-214">Quando si inviano messaggi al backlog, viene scelta casualmente una di queste code.</span><span class="sxs-lookup"><span data-stu-id="e7b63-214">When sending messages to the backlog, one of these queues is randomly chosen.</span></span> <span data-ttu-id="e7b63-215">Se il valore è impostato su 1, è possibile usare una sola coda.</span><span class="sxs-lookup"><span data-stu-id="e7b63-215">If you set the value to 1, then only one queue can ever be used.</span></span> <span data-ttu-id="e7b63-216">In questo caso e se l'unica coda di backlog genera errori, il client non è in grado di usare un'altra coda di backlog e potrebbe non riuscire a inviare il messaggio.</span><span class="sxs-lookup"><span data-stu-id="e7b63-216">When this happens and the one backlog queue generates errors, the client is not able to try a different backlog queue and may fail to send your message.</span></span> <span data-ttu-id="e7b63-217">È quindi consigliabile impostare questo parametro su un valore maggiore e impostare il valore predefinito su 10.</span><span class="sxs-lookup"><span data-stu-id="e7b63-217">We recommend setting this value to some larger value and default the value to 10.</span></span> <span data-ttu-id="e7b63-218">Il parametro può essere impostato su un valore superiore o inferiore in base ai dati che vengono inviati dall'applicazione ogni giorno.</span><span class="sxs-lookup"><span data-stu-id="e7b63-218">You can change this to a higher or lower value depending on how much data your application sends per day.</span></span> <span data-ttu-id="e7b63-219">Ogni coda di backlog può contenere fino a 5 GB di messaggi.</span><span class="sxs-lookup"><span data-stu-id="e7b63-219">Each backlog queue can hold up to 5 GB of messages.</span></span>
* <span data-ttu-id="e7b63-220">*failoverInterval*: intervallo di tempo durante il quale vengono accettati errori nello spazio dei nomi primario, prima di passare ogni singola entità allo spazio dei nomi secondario.</span><span class="sxs-lookup"><span data-stu-id="e7b63-220">*failoverInterval*: The amount of time during which you will accept failures on the primary namespace before switching any single entity over to the secondary namespace.</span></span> <span data-ttu-id="e7b63-221">I failover si verificano su un'entità alla volta.</span><span class="sxs-lookup"><span data-stu-id="e7b63-221">Failovers occur on an entity-by-entity basis.</span></span> <span data-ttu-id="e7b63-222">Le entità in un singolo spazio dei nomi di solito risiedono in nodi diversi del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="e7b63-222">Entities in a single namespace frequently live in different nodes within Service Bus.</span></span> <span data-ttu-id="e7b63-223">Un errore in un'entità non implica che si verifichi in un'altra entità.</span><span class="sxs-lookup"><span data-stu-id="e7b63-223">A failure in one entity does not imply a failure in another.</span></span> <span data-ttu-id="e7b63-224">È possibile impostare questo valore su [System.TimeSpan.Zero][System.TimeSpan.Zero] per eseguire il failover allo spazio dei nomi secondario immediatamente dopo il primo errore non temporaneo.</span><span class="sxs-lookup"><span data-stu-id="e7b63-224">You can set this value to [System.TimeSpan.Zero][System.TimeSpan.Zero] to failover to the secondary immediately after your first, non-transient failure.</span></span> <span data-ttu-id="e7b63-225">Gli errori che attivano il timer del failover sono eccezioni di tipo [MessagingException][MessagingException], in cui la proprietà [IsTransient][IsTransient] è false, o di tipo [System.TimeoutException][System.TimeoutException].</span><span class="sxs-lookup"><span data-stu-id="e7b63-225">Failures that trigger the failover timer are any [MessagingException][MessagingException] in which the [IsTransient][IsTransient] property is false, or a [System.TimeoutException][System.TimeoutException].</span></span> <span data-ttu-id="e7b63-226">Altri tipi di eccezioni, ad esempio [UnauthorizedAccessException][UnauthorizedAccessException], non causano failover, perché indicano che il client non è configurato in modo corretto.</span><span class="sxs-lookup"><span data-stu-id="e7b63-226">Other exceptions, such as [UnauthorizedAccessException][UnauthorizedAccessException] do not cause failover, because they indicate that the client is configured incorrectly.</span></span> <span data-ttu-id="e7b63-227">Un'eccezione di tipo [ServerBusyException][ServerBusyException] non causa failover perché il modello corretto prevede un'attesa di 10 secondi e determina un nuovo invio del messaggio.</span><span class="sxs-lookup"><span data-stu-id="e7b63-227">A [ServerBusyException][ServerBusyException] does not cause failover because the correct pattern is to wait 10 seconds, then send the message again.</span></span>
* <span data-ttu-id="e7b63-228">*enableSyphon*: indica che l'associazione specificata dovrebbe spostare i messaggi dallo spazio dei nomi secondario a quello primario.</span><span class="sxs-lookup"><span data-stu-id="e7b63-228">*enableSyphon*: Indicates that this particular pairing should also syphon messages from the secondary namespace back to the primary namespace.</span></span> <span data-ttu-id="e7b63-229">In genere nelle applicazioni che inviano messaggi questo valore deve essere impostato su **false** e in quelle che ricevono messaggi deve essere impostato su **true**.</span><span class="sxs-lookup"><span data-stu-id="e7b63-229">In general, applications that send messages should set this value to **false**; applications that receive messages should set this value to **true**.</span></span> <span data-ttu-id="e7b63-230">Il motivo per cui si verifica questo tipo di errore è dato dal fatto che spesso il numero dei destinatari dei messaggi è inferiore a quello dei mittenti.</span><span class="sxs-lookup"><span data-stu-id="e7b63-230">The reason for this is that frequently, there are fewer message receivers than message senders.</span></span> <span data-ttu-id="e7b63-231">A seconda del numero dei destinatari, è possibile scegliere di impostare un'unica istanza dell'applicazione per la gestione delle attività del sifone.</span><span class="sxs-lookup"><span data-stu-id="e7b63-231">Depending on the number of receivers, you can choose to have a single application instance handle the syphon duties.</span></span> <span data-ttu-id="e7b63-232">All'uso di più destinatari sono associati costi di fatturazione per ogni coda di backlog.</span><span class="sxs-lookup"><span data-stu-id="e7b63-232">Using many receivers has billing implications for each backlog queue.</span></span>

<span data-ttu-id="e7b63-233">Per usare il codice, creare un'istanza primaria di [MessagingFactory][MessagingFactory], un'istanza secondaria di [MessagingFactory][MessagingFactory] e di [NamespaceManager][NamespaceManager] e un'istanza di [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions].</span><span class="sxs-lookup"><span data-stu-id="e7b63-233">To use the code, create a primary [MessagingFactory][MessagingFactory] instance, a secondary [MessagingFactory][MessagingFactory] instance, a secondary [NamespaceManager][NamespaceManager] instance, and a [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance.</span></span> <span data-ttu-id="e7b63-234">La chiamata può essere semplice come la seguente:</span><span class="sxs-lookup"><span data-stu-id="e7b63-234">The call can be as simple as the following:</span></span>

```csharp
SendAvailabilityPairedNamespaceOptions sendAvailabilityOptions = new SendAvailabilityPairedNamespaceOptions(secondaryNamespaceManager, secondary);
primary.PairNamespaceAsync(sendAvailabilityOptions).Wait();
```

<span data-ttu-id="e7b63-235">Quando l'attività restituita dal metodo [PairNamespaceAsync][PairNamespaceAsync] è completa, ogni componente è configurato e pronto per l'uso.</span><span class="sxs-lookup"><span data-stu-id="e7b63-235">When the task returned by the [PairNamespaceAsync][PairNamespaceAsync] method completes, everything is set up and ready to use.</span></span> <span data-ttu-id="e7b63-236">Prima della restituzione dell'attività, è possibile che non siano state completate tutte le attività in background necessarie per il corretto funzionamento dell'associazione.</span><span class="sxs-lookup"><span data-stu-id="e7b63-236">Before the task is returned, you may not have completed all of the background work necessary for the pairing to work right.</span></span> <span data-ttu-id="e7b63-237">È quindi consigliabile non iniziare a inviare messaggi prima della restituzione dell'attività.</span><span class="sxs-lookup"><span data-stu-id="e7b63-237">As a result, you should not start sending messages until the task returns.</span></span> <span data-ttu-id="e7b63-238">Se si verifica un errore, dovuto ad esempio a credenziali errate o all'impossibilità di creare code di backlog, le eccezioni verranno restituite al completamento dell'attività.</span><span class="sxs-lookup"><span data-stu-id="e7b63-238">If any failures occurred, such as bad credentials, or failure to create the backlog queues, those exceptions will be thrown once the task completes.</span></span> <span data-ttu-id="e7b63-239">Dopo la restituzione dell'attività, verificare che siano state trovate o create le code esaminando la proprietà [BacklogQueueCount][BacklogQueueCount] nell'istanza di [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions].</span><span class="sxs-lookup"><span data-stu-id="e7b63-239">Once the task returns, verify that the queues were found or created by examining the [BacklogQueueCount][BacklogQueueCount] property on your [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance.</span></span> <span data-ttu-id="e7b63-240">In base al codice precedente, questa operazione viene visualizzata nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="e7b63-240">For the preceding code, that operation appears as follows:</span></span>

```csharp
if (sendAvailabilityOptions.BacklogQueueCount < 1)
{
    // Handle case where no queues were created.
}
```

## <a name="next-steps"></a><span data-ttu-id="e7b63-241">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="e7b63-241">Next steps</span></span>
<span data-ttu-id="e7b63-242">Dopo avere appreso le nozioni di base della messaggistica asincrona nel bus di servizio, leggere altre informazioni sugli [spazi dei nomi associati][paired namespaces].</span><span class="sxs-lookup"><span data-stu-id="e7b63-242">Now that you've learned the basics of asynchronous messaging in Service Bus, read more details about [paired namespaces][paired namespaces].</span></span>

[ServerBusyException]: /dotnet/api/microsoft.servicebus.messaging.serverbusyexception
[System.TimeoutException]: https://msdn.microsoft.com/library/system.timeoutexception.aspx
[MessagingException]: /dotnet/api/microsoft.servicebus.messaging.messagingexception
[Best practices for insulating applications against Service Bus outages and disasters]: service-bus-outages-disasters.md
[Microsoft.ServiceBus.Messaging.MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[MessageReceiver]: /dotnet/api/microsoft.servicebus.messaging.messagereceiver
[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[TopicClient]: /dotnet/api/microsoft.servicebus.messaging.topicclient
[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.pairednamespaceoptions
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[SendAvailabilityPairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions
[NamespaceManager]: /dotnet/api/microsoft.servicebus.namespacemanager
[PairNamespaceAsync]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_PairNamespaceAsync_Microsoft_ServiceBus_Messaging_PairedNamespaceOptions_
[EnableSyphon]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_EnableSyphon
[System.TimeSpan.Zero]: https://msdn.microsoft.com/library/system.timespan.zero.aspx
[IsTransient]: /dotnet/api/microsoft.servicebus.messaging.messagingexception#Microsoft_ServiceBus_Messaging_MessagingException_IsTransient
[UnauthorizedAccessException]: https://msdn.microsoft.com/library/system.unauthorizedaccessexception.aspx
[BacklogQueueCount]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions?redirectedfrom=MSDN#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_BacklogQueueCount
[paired namespaces]: service-bus-paired-namespaces.md
