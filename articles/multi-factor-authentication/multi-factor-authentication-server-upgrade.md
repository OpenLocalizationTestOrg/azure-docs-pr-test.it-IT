---
title: Aggiornamento di Azure MFA | Microsoft Docs
description: "Passaggi e indicazioni per aggiornare il server Azure Multi-Factor Authentication a una versione più recente."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 50bb8ac3-5559-4d8b-a96a-799a74978b14
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: 6e4e09f8539aad56f92ad9137f4a6b9eb0d82370
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="upgrade-to-the-latest-azure-multi-factor-authentication-server"></a><span data-ttu-id="7fb98-103">Aggiornare il server Azure Multi-Factor Authentication alla versione più recente</span><span class="sxs-lookup"><span data-stu-id="7fb98-103">Upgrade to the latest Azure Multi-Factor Authentication Server</span></span>

<span data-ttu-id="7fb98-104">In questo articolo viene illustrato il processo di aggiornamento del Server Azure multi-Factor Authentication (MFA) alla versione 6.0 o successiva.</span><span class="sxs-lookup"><span data-stu-id="7fb98-104">This article walks you through the process of upgrading Azure Multi-Factor Authentication (MFA) Server v6.0 or higher.</span></span> <span data-ttu-id="7fb98-105">Se si desidera aggiornare una versione precedente dell'agente PhoneFactor, fare riferimento all'articolo [Aggiornare l'agente PhoneFactor al server Azure Multi-Factor Authentication](multi-factor-authentication-get-started-server-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="7fb98-105">If you need to upgrade an old version of the PhoneFactor Agent, refer to [Upgrade the PhoneFactor Agent to Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server-upgrade.md).</span></span>

<span data-ttu-id="7fb98-106">Se si esegue l'aggiornamento dalla versione 6.x o precedente alla versione 7.x o successiva, tutti i componenti da .NET 2.0 a .NET 4.5 cambiano.</span><span class="sxs-lookup"><span data-stu-id="7fb98-106">If you're upgrading from v6.x or older to v7.x or newer, all components change from .NET 2.0 to .NET 4.5.</span></span> <span data-ttu-id="7fb98-107">Inoltre per tutti i componenti è necessario l'aggiornamento di Microsoft Visual C++ 2015 1 o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="7fb98-107">All components also require Microsoft Visual C++ 2015 Redistributable Update 1 or higher.</span></span> <span data-ttu-id="7fb98-108">Il programma di installazione del server MFA installa entrambe le versioni, x86 e x64, di questi componenti se non sono già installati.</span><span class="sxs-lookup"><span data-stu-id="7fb98-108">The MFA Server installer installs both the x86 and x64 versions of these components if they aren't already installed.</span></span> <span data-ttu-id="7fb98-109">Se il Portale utenti e il servizio Web app per dispositivi mobili vengono eseguiti su server diversi, è necessario installare tali pacchetti prima di aggiornare i componenti.</span><span class="sxs-lookup"><span data-stu-id="7fb98-109">If the User Portal and Mobile App Web Service run on separate servers, you need to install those packages before upgrading those components.</span></span> <span data-ttu-id="7fb98-110">È possibile cercare l'aggiornamento più recente di Microsoft Visual C++ 2015 Redistributable nell'[Area download Microsoft](https://www.microsoft.com/en-us/download/).</span><span class="sxs-lookup"><span data-stu-id="7fb98-110">You can search for the latest Microsoft Visual C++ 2015 Redistributable update on the [Microsoft Download Center](https://www.microsoft.com/en-us/download/).</span></span> 

## <a name="install-the-latest-version-of-azure-mfa-server"></a><span data-ttu-id="7fb98-111">Installare la versione più recente del server Azure MFA</span><span class="sxs-lookup"><span data-stu-id="7fb98-111">Install the latest version of Azure MFA Server</span></span>

1. <span data-ttu-id="7fb98-112">Usare le istruzioni in [Scaricare il server Azure Multi-Factor Authentication](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) per ottenere la versione più recente del server Azure MFA.</span><span class="sxs-lookup"><span data-stu-id="7fb98-112">Use the instructions in [Download the Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) to get the latest version of the Azure MFA Server.</span></span>
2. <span data-ttu-id="7fb98-113">Eseguire il backup del file di dati del Server MFA che si trova in C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (prevedendo il percorso di installazione predefinito) sul server principale di MFA.</span><span class="sxs-lookup"><span data-stu-id="7fb98-113">Make a backup of the MFA Server data file located at C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (assuming the default install location) on your master MFA Server.</span></span>
3. <span data-ttu-id="7fb98-114">Se si eseguono più server per avere una disponibilità elevata, modificare i sistemi client che eseguono l'autenticazione nel server MFA in modo da arrestare l'invio del traffico ai server che si intende aggiornare.</span><span class="sxs-lookup"><span data-stu-id="7fb98-114">If you run multiple servers for high availability, change the client systems that authenticate to the MFA Server so that they stop sending traffic to the servers that are upgrading.</span></span> <span data-ttu-id="7fb98-115">Se si usa un bilanciamento del carico, rimuovere un server MFA dal bilanciamento del carico, eseguire l'aggiornamento e quindi aggiungere nuovamente il server alla farm.</span><span class="sxs-lookup"><span data-stu-id="7fb98-115">If you use a load balancer, remove a MFA Server from the load balancer, do the upgrade, and then add the server back into the farm.</span></span>
4. <span data-ttu-id="7fb98-116">Eseguire il nuovo programma di installazione in ogni server MFA.</span><span class="sxs-lookup"><span data-stu-id="7fb98-116">Run the new installer on each MFA Server.</span></span> <span data-ttu-id="7fb98-117">Aggiornare prima i server subordinati perché leggono il vecchio file di dati che viene replicato dal server principale.</span><span class="sxs-lookup"><span data-stu-id="7fb98-117">Upgrade subordinate servers first because they can read the old data file being replicated by the master.</span></span> 

  <span data-ttu-id="7fb98-118">Non è necessario disinstallare il server MFA corrente prima di eseguire il programma di installazione.</span><span class="sxs-lookup"><span data-stu-id="7fb98-118">You do not need to uninstall your current MFA Server before running the installer.</span></span> <span data-ttu-id="7fb98-119">Il programma di installazione esegue un aggiornamento sul posto.</span><span class="sxs-lookup"><span data-stu-id="7fb98-119">The installer performs an in-place upgrade.</span></span> <span data-ttu-id="7fb98-120">Il percorso di installazione viene rilevato dal registro dall'installazione precedente in modo da eseguire l'installazione nello stesso percorso, ad esempio C:\Program Files\Multi-Factor Authentication Server.</span><span class="sxs-lookup"><span data-stu-id="7fb98-120">The installation path is picked up from the registry from the previous installation, so it installs in the same location (for example, C:\Program Files\Multi-Factor Authentication Server).</span></span> 
  
5. <span data-ttu-id="7fb98-121">Se viene chiesto di installare un pacchetto di aggiornamento di Microsoft Visual C++ 2015 Redistributable, accettare la richiesta.</span><span class="sxs-lookup"><span data-stu-id="7fb98-121">If you're prompted to install a Microsoft Visual C++ 2015 Redistributable update package, accept the prompt.</span></span> <span data-ttu-id="7fb98-122">Entrambe le versioni, x86 e x64, del pacchetto vengono installate.</span><span class="sxs-lookup"><span data-stu-id="7fb98-122">Both the x86 and x64 versions of the package are installed.</span></span>
5. <span data-ttu-id="7fb98-123">Se si usa l'SDK servizio Web, viene chiesto di installare il nuovo SDK servizio Web.</span><span class="sxs-lookup"><span data-stu-id="7fb98-123">If you use the Web Service SDK, you are prompted to install the new Web Service SDK.</span></span> <span data-ttu-id="7fb98-124">Quando si installa il nuovo SDK servizio Web, assicurarsi che il nome della directory virtuale corrisponda alla directory virtuale installata in precedenza (ad esempio MultiFactorAuthWebServiceSdk).</span><span class="sxs-lookup"><span data-stu-id="7fb98-124">When you install the new Web Service SDK, make sure that the virtual directory name matches the previously installed virtual directory (for example, MultiFactorAuthWebServiceSdk).</span></span>
6. <span data-ttu-id="7fb98-125">Ripetere i passaggi in tutti i server subordinati.</span><span class="sxs-lookup"><span data-stu-id="7fb98-125">Repeat the steps on all subordinate servers.</span></span> <span data-ttu-id="7fb98-126">Alzare il livello di uno dei server subordinati a server principale, quindi aggiornare il vecchio server principale.</span><span class="sxs-lookup"><span data-stu-id="7fb98-126">Promote one of the subordinates to be the new master, then upgrade the old master server.</span></span> 

## <a name="upgrade-the-user-portal"></a><span data-ttu-id="7fb98-127">Aggiornare il Portale utenti</span><span class="sxs-lookup"><span data-stu-id="7fb98-127">Upgrade the User Portal</span></span>

1. <span data-ttu-id="7fb98-128">Eseguire il backup del file web.config che si trova nella directory virtuale del percorso di installazione del Portale utenti (ad esempio C:\inetpub\wwwroot\MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="7fb98-128">Make a backup of the web.config file that is in the virtual directory of the User Portal installation location (for example, C:\inetpub\wwwroot\MultiFactorAuth).</span></span> <span data-ttu-id="7fb98-129">Se sono state apportate delle modifiche al tema predefinito, eseguire il backup anche per la cartella App_Themes\Predefinito.</span><span class="sxs-lookup"><span data-stu-id="7fb98-129">If any changes were made to the default theme, make a backup of the App_Themes\Default folder as well.</span></span> <span data-ttu-id="7fb98-130">È preferibile creare una copia della cartella Predefinito e creare un nuovo tema per modificare il tema predefinito.</span><span class="sxs-lookup"><span data-stu-id="7fb98-130">It is better to create a copy of the Default folder and create a new theme than to change the Default theme.</span></span>
2. <span data-ttu-id="7fb98-131">Se il Portale utenti è in esecuzione nello stesso server come gli altri componenti del server MFA, l'installazione del server MFA richiede di aggiornare il Portale utenti.</span><span class="sxs-lookup"><span data-stu-id="7fb98-131">If the User Portal runs on the same server as the other MFA Server components, the MFA Server installation prompts you to update the User Portal.</span></span> <span data-ttu-id="7fb98-132">Accettare la richiesta e installare l'aggiornamento del Portale utenti.</span><span class="sxs-lookup"><span data-stu-id="7fb98-132">Accept the prompt and install the User Portal update.</span></span> <span data-ttu-id="7fb98-133">Assicurarsi che il nome della directory virtuale corrisponda alla directory virtuale installata in precedenza, ad esempio MultiFactorAuth.</span><span class="sxs-lookup"><span data-stu-id="7fb98-133">Check that the virtual directory name matches the previously installed virtual directory (for example, MultiFactorAuth).</span></span>
3. <span data-ttu-id="7fb98-134">Se il Portale utenti è installato sul proprio server, copiare il file MultiFactorAuthenticationUserPortalSetup64.msi dal percorso di installazione di uno dei server MFA e inserirlo nel server Web del Portale utenti.</span><span class="sxs-lookup"><span data-stu-id="7fb98-134">If the User Portal is on its own server, copy the MultiFactorAuthenticationUserPortalSetup64.msi file from the install location of one of the MFA Servers and put it onto the User Portal web server.</span></span> <span data-ttu-id="7fb98-135">Eseguire il programma di installazione.</span><span class="sxs-lookup"><span data-stu-id="7fb98-135">Run the installer.</span></span> 

  <span data-ttu-id="7fb98-136">Se si verifica un errore che informa che è necessario eseguire l'aggiornamento di Microsoft Visual C++ 2015 Redistributable 1 o di una versione successiva, scaricare e installare il pacchetto di aggiornamento più recente dall'[Area download Microsoft](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="7fb98-136">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="7fb98-137">Installare le versioni x86 e x64.</span><span class="sxs-lookup"><span data-stu-id="7fb98-137">Install both the x86 and x64 versions.</span></span>

4. <span data-ttu-id="7fb98-138">Dopo aver installato il software del Portale utenti aggiornato, confrontare il backup del file web.config fatto nel passaggio 1 con il nuovo file web.config.</span><span class="sxs-lookup"><span data-stu-id="7fb98-138">After the updated User Portal software is installed, compare the web.config backup you made in step 1 with the new web.config file.</span></span> <span data-ttu-id="7fb98-139">Se non sono presenti nuovi attributi nel nuovo file web.config, copiare il file di backup web.config nella directory virtuale per sovrascrivere quella nuova.</span><span class="sxs-lookup"><span data-stu-id="7fb98-139">If no new attributes exist in the new web.config, copy your backup web.config into the virtual directory to overwrite the new one.</span></span> <span data-ttu-id="7fb98-140">È inoltre possibile copiare e incollare i valori appSettings e l'URL di SDK servizio Web dal file di backup in un nuovo file web.config.</span><span class="sxs-lookup"><span data-stu-id="7fb98-140">Another option is to copy/paste the appSettings values and the Web Service SDK URL from the backup file into the new web.config.</span></span>

<span data-ttu-id="7fb98-141">Se il Portale utenti è su più server, ripetere l'installazione su tutti i server.</span><span class="sxs-lookup"><span data-stu-id="7fb98-141">If you have the User Portal on multiple servers, repeat the installation on all of them.</span></span> 


## <a name="upgrade-the-mobile-app-web-service"></a><span data-ttu-id="7fb98-142">Aggiornare il servizio Web app per dispositivi mobili</span><span class="sxs-lookup"><span data-stu-id="7fb98-142">Upgrade the Mobile App Web Service</span></span>

1. <span data-ttu-id="7fb98-143">Eseguire il backup del file web.config che si trova nella directory virtuale del percorso di installazione del servizio Web app per dispositivi mobili (ad esempio C:\inetpub\wwwroot\app or C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span><span class="sxs-lookup"><span data-stu-id="7fb98-143">Make a backup of the web.config file that is in the virtual directory of the Mobile App Web Service installation location (for example, C:\inetpub\wwwroot\app or C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span></span>
2. <span data-ttu-id="7fb98-144">Copiare il file MultiFactorAuthenticationMobileAppWebServiceSetup64.msi dal percorso di installazione dei server MFA e inserirlo nel server Web di registrazione dell'app per dispositivi mobili.</span><span class="sxs-lookup"><span data-stu-id="7fb98-144">Copy the MultiFactorAuthenticationMobileAppWebServiceSetup64.msi file from the install location of the MFA Servers and put it onto the Mobile App registration web server.</span></span>
3. <span data-ttu-id="7fb98-145">Eseguire il programma di installazione.</span><span class="sxs-lookup"><span data-stu-id="7fb98-145">Run the installer.</span></span> 

  <span data-ttu-id="7fb98-146">Se si verifica un errore che informa che è necessario eseguire l'aggiornamento di Microsoft Visual C++ 2015 Redistributable 1 o di una versione successiva, scaricare e installare il pacchetto di aggiornamento più recente dall'[Area download Microsoft](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="7fb98-146">If an error occurs stating that Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required, download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="7fb98-147">Installare le versioni x86 e x64.</span><span class="sxs-lookup"><span data-stu-id="7fb98-147">Install both the x86 and x64 versions.</span></span>

4. <span data-ttu-id="7fb98-148">Dopo avere installato l'aggiornamento del software per il servizio Web app per dispositivi mobili, confrontare il file web.config di cui è stato eseguito il backup nel passaggio 1 con il nuovo file web.config.</span><span class="sxs-lookup"><span data-stu-id="7fb98-148">After the updated Mobile App Web Service software installs, compare the web.config file that was backed up in step 1 with the new web.config file.</span></span> <span data-ttu-id="7fb98-149">Se non sono presenti nuovi attributi nel nuovo file web.config, è possibile ricopiare il file web.config salvato nella directory virtuale e sovrascrivere quello nuovo.</span><span class="sxs-lookup"><span data-stu-id="7fb98-149">If no new attributes exist in the new web.config, you can copy your saved web.config back into the virtual directory and overwrite the new one.</span></span> <span data-ttu-id="7fb98-150">È inoltre possibile copiare e incollare i valori appSettings e l'URL di SDK servizio Web dal file di backup in un nuovo file web.config.</span><span class="sxs-lookup"><span data-stu-id="7fb98-150">Another option is to copy/paste the appSettings values and the Web Service SDK URL from the backup file into the new web.config.</span></span>

<span data-ttu-id="7fb98-151">Se il servizio Web app per dispositivi mobili è su più server, ripetere l'installazione su tutti i server.</span><span class="sxs-lookup"><span data-stu-id="7fb98-151">If you have the Mobile App Web Service on multiple servers, repeat the installation on all of them.</span></span> 

## <a name="upgrade-the-ad-fs-adapters"></a><span data-ttu-id="7fb98-152">Aggiornare le schede AD FS</span><span class="sxs-lookup"><span data-stu-id="7fb98-152">Upgrade the AD FS Adapters</span></span>


### <a name="if-mfa-runs-on-different-servers-than-ad-fs"></a><span data-ttu-id="7fb98-153">Se MFA viene eseguito su server diversi da AD FS</span><span class="sxs-lookup"><span data-stu-id="7fb98-153">If MFA runs on different servers than AD FS</span></span>

<span data-ttu-id="7fb98-154">Queste istruzioni sono valide solo se si esegue il server Multi-Factor Authentication indipendentemente dai server AD FS.</span><span class="sxs-lookup"><span data-stu-id="7fb98-154">These instructions only apply if you run Multi-Factor Authentication Server separately from your AD FS servers.</span></span> <span data-ttu-id="7fb98-155">Se entrambi i servizi vengono eseguiti sugli stessi server, saltare questa sezione e passare alla fase di installazione.</span><span class="sxs-lookup"><span data-stu-id="7fb98-155">If both services run on the same servers, skip this section and go to the installation steps.</span></span> 

1. <span data-ttu-id="7fb98-156">Salvare una copia del file MultiFactorAuthenticationAdfsAdapter.config registrato in AD FS o esportare la configurazione esistente in un file usando il comando PowerShell seguente: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path to config file]`.</span><span class="sxs-lookup"><span data-stu-id="7fb98-156">Save a copy of the MultiFactorAuthenticationAdfsAdapter.config file that was registered in AD FS, or export the configuration using the following PowerShell command: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path to config file]`.</span></span> <span data-ttu-id="7fb98-157">Il nome della scheda è "WindowsAzureMultiFactorAuthentication" o "AzureMfaServerAuthentication" a seconda della versione precedentemente installata.</span><span class="sxs-lookup"><span data-stu-id="7fb98-157">The adapter name is either "WindowsAzureMultiFactorAuthentication" or "AzureMfaServerAuthentication" depending on the version previously installed.</span></span>
2. <span data-ttu-id="7fb98-158">Copiare i file seguenti dal percorso di installazione del server MFA nei server AD FS:</span><span class="sxs-lookup"><span data-stu-id="7fb98-158">Copy the following files from the MFA Server installation location to the AD FS servers:</span></span>

  - <span data-ttu-id="7fb98-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="7fb98-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
  - <span data-ttu-id="7fb98-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="7fb98-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="7fb98-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="7fb98-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="7fb98-162">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="7fb98-162">MultiFactorAuthenticationAdfsAdapter.config</span></span>

3. <span data-ttu-id="7fb98-163">Modificare lo script Register-MultiFactorAuthenticationAdfsAdapter.ps1 aggiungendo `-ConfigurationFilePath [path]` alla fine del comando `Register-AdfsAuthenticationProvider`.</span><span class="sxs-lookup"><span data-stu-id="7fb98-163">Edit the Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding `-ConfigurationFilePath [path]` to the end of the `Register-AdfsAuthenticationProvider` command.</span></span> <span data-ttu-id="7fb98-164">Sostituire *[percorso]* con il percorso completo del file MultiFactorAuthenticationAdfsAdapter.config o del file di configurazione esportato nel passaggio precedente.</span><span class="sxs-lookup"><span data-stu-id="7fb98-164">Replace *[path]* with the full path to the MultiFactorAuthenticationAdfsAdapter.config file or the configuration file exported in the previous step.</span></span> 

  <span data-ttu-id="7fb98-165">Controllare gli attributi nel nuovo file MultiFactorAuthenticationAdfsAdapter.config per verificare che corrispondano al vecchio file di configurazione.</span><span class="sxs-lookup"><span data-stu-id="7fb98-165">Check the attributes in the new MultiFactorAuthenticationAdfsAdapter.config to see if they match the old config file.</span></span> <span data-ttu-id="7fb98-166">Se sono stati aggiunti o rimossi attributi nella nuova versione, copiare i valori degli attributi dal file di configurazione precedente in quello nuovo o modificare il file di configurazione precedente per farlo corrispondere a quello nuovo.</span><span class="sxs-lookup"><span data-stu-id="7fb98-166">If any attributes were added or removed in the new version, copy the attribute values from the old configuration file to the new one or modify the old configuration file to match.</span></span>

### <a name="install-new-ad-fs-adapters"></a><span data-ttu-id="7fb98-167">Installare le nuove schede AD FS</span><span class="sxs-lookup"><span data-stu-id="7fb98-167">Install new AD FS adapters</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="7fb98-168">Gli utenti non dovranno eseguire la verifica in due passaggi durante i passaggi 3-8 di questa sezione.</span><span class="sxs-lookup"><span data-stu-id="7fb98-168">Your users will not be required to perform two-step verification during steps 3-8 of this section.</span></span> <span data-ttu-id="7fb98-169">Se ADFS è configurato in più cluster, è possibile rimuovere, aggiornare e ripristinare ogni cluster nella farm indipendentemente da altri cluster in modo da evitare tempi di inattività.</span><span class="sxs-lookup"><span data-stu-id="7fb98-169">If you have AD FS configured in multiple clusters, you can remove, upgrade, and restore each cluster in the farm independently of the other clusters to avoid downtime.</span></span>

1. <span data-ttu-id="7fb98-170">Rimuovere alcuni server AD FS dalla farm.</span><span class="sxs-lookup"><span data-stu-id="7fb98-170">Remove some AD FS servers from the farm.</span></span> <span data-ttu-id="7fb98-171">Aggiornare questi server, mentre gli altri sono ancora in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="7fb98-171">Update these servers while the others are still running.</span></span>
2. <span data-ttu-id="7fb98-172">Installare la nuova scheda AD FS su ogni server rimosso dalla farm AD FS.</span><span class="sxs-lookup"><span data-stu-id="7fb98-172">Install the new AD FS adapter on each server removed from the AD FS farm.</span></span> <span data-ttu-id="7fb98-173">Se il server MFA è installato su ogni server ADFS, è possibile aggiornare tramite l'esperienza utente dell'amministratore del server MFA.</span><span class="sxs-lookup"><span data-stu-id="7fb98-173">If the MFA Server is installed on each AD FS server, you can update through the MFA Server admin UX.</span></span> <span data-ttu-id="7fb98-174">Altrimenti fare l'aggiornamento eseguendo MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span><span class="sxs-lookup"><span data-stu-id="7fb98-174">Otherwise, update by running MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span></span> 

  <span data-ttu-id="7fb98-175">Se si verifica un errore che informa che è necessario eseguire l'aggiornamento di Microsoft Visual C++ 2015 Redistributable 1 o di una versione successiva, scaricare e installare il pacchetto di aggiornamento più recente dall'[Area download Microsoft](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="7fb98-175">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="7fb98-176">Installare le versioni x86 e x64.</span><span class="sxs-lookup"><span data-stu-id="7fb98-176">Install both the x86 and x64 versions.</span></span>

3. <span data-ttu-id="7fb98-177">Passare ad **AD FS** > **Criteri di autenticazione** > **Edit Global MultiFactor Authentication Policy** (Modifica i criteri di autenticazione a più fattori globali).</span><span class="sxs-lookup"><span data-stu-id="7fb98-177">Go to **AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="7fb98-178">Deselezionare **WindowsAzureMultiFactorAuthentication** o **AzureMfaServerAuthentication** a seconda della versione precedentemente installata.</span><span class="sxs-lookup"><span data-stu-id="7fb98-178">Uncheck **WindowsAzureMultiFactorAuthentication** or **AzureMFAServerAuthentication** (depending on the current version installed).</span></span> 

  <span data-ttu-id="7fb98-179">Dopo avere completato questo passaggio, la verifica in due passaggi tramite il server MFA non sarà disponibile in questo cluster AD FS fino al completamento del passaggio 8.</span><span class="sxs-lookup"><span data-stu-id="7fb98-179">Once this step is complete, two-step verification through MFA Server is not available in this AD FS cluster until you complete step 8.</span></span>

4. <span data-ttu-id="7fb98-180">Annullare la registrazione della versione precedente della scheda AD FS eseguendo lo script di PowerShell Unregister-MultiFactorAuthenticationAdfsAdapter.ps1.</span><span class="sxs-lookup"><span data-stu-id="7fb98-180">Unregister the older version of the AD FS adapter by running the Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="7fb98-181">Assicurarsi che il parametro *-Name* ("WindowsAzureMultiFactorAuthentication" o "AzureMFAServerAuthentication") corrisponda al nome visualizzato nel passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="7fb98-181">Ensure that the *-Name* parameter (either “WindowsAzureMultiFactorAuthentication” or "AzureMFAServerAuthentication") matches the name that was displayed in step 3.</span></span> <span data-ttu-id="7fb98-182">Questo si applica a tutti i server nello stesso cluster AD FS poiché è presente una configurazione centrale.</span><span class="sxs-lookup"><span data-stu-id="7fb98-182">This applies to all servers in the same AD FS cluster since there is a central configuration.</span></span>
5. <span data-ttu-id="7fb98-183">Registrare la nuova scheda AD FS eseguendo lo script di PowerShell Register-MultiFactorAuthenticationAdfsAdapter.ps1.</span><span class="sxs-lookup"><span data-stu-id="7fb98-183">Register the new AD FS adapter by running the Register-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="7fb98-184">Questo si applica a tutti i server nello stesso cluster AD FS poiché è presente una configurazione centrale.</span><span class="sxs-lookup"><span data-stu-id="7fb98-184">This applies to all servers in the same AD FS cluster since there is a central configuration.</span></span>
6. <span data-ttu-id="7fb98-185">Riavviare il nuovo servizio AD FS su ogni server rimosso dalla farm AD FS.</span><span class="sxs-lookup"><span data-stu-id="7fb98-185">Restart the AD FS service on each server removed from the AD FS farm.</span></span>
7. <span data-ttu-id="7fb98-186">Aggiungere nuovamente i server aggiornati alla farm AD FS e rimuovere gli altri server della farm.</span><span class="sxs-lookup"><span data-stu-id="7fb98-186">Add the updated servers back to the AD FS farm and remove the other servers from the farm.</span></span>
8. <span data-ttu-id="7fb98-187">Passare ad **AD FS** > **Criteri di autenticazione** > **Edit Global MultiFactor Authentication Policy** (Modifica i criteri di autenticazione a più fattori globali).</span><span class="sxs-lookup"><span data-stu-id="7fb98-187">Go to **AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="7fb98-188">Controllare **AzureMfaServerAuthentication**.</span><span class="sxs-lookup"><span data-stu-id="7fb98-188">Check **AzureMfaServerAuthentication**.</span></span>
9. <span data-ttu-id="7fb98-189">Ripetere il passaggio 2 per aggiornare i server rimossi dalla farm AD FS e riavviare il servizio AD FS in tali server.</span><span class="sxs-lookup"><span data-stu-id="7fb98-189">Repeat step 2 to update the servers now removed from the AD FS farm and restart the AD FS service on those servers.</span></span>
10. <span data-ttu-id="7fb98-190">Aggiungere di nuovo i server alla farm AD FS.</span><span class="sxs-lookup"><span data-stu-id="7fb98-190">Add those servers back into the AD FS farm.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7fb98-191">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="7fb98-191">Next steps</span></span>

- <span data-ttu-id="7fb98-192">Consultare gli esempi di [Scenari avanzati con Azure Multi-Factor Authentication e VPN di terze parti](multi-factor-authentication-advanced-vpn-configurations.md)</span><span class="sxs-lookup"><span data-stu-id="7fb98-192">Get examples of [Advanced scenarios with Azure Multi-Factor Authentication and third-party VPNs](multi-factor-authentication-advanced-vpn-configurations.md)</span></span>

- [<span data-ttu-id="7fb98-193">Sincronizzazione del server MFA con Windows Server Active Directory</span><span class="sxs-lookup"><span data-stu-id="7fb98-193">Synchronize MFA Server with Windows Server Active Directory</span></span>](multi-factor-authentication-get-started-server-dirint.md)

- <span data-ttu-id="7fb98-194">[Configurare l'autenticazione di Windows](multi-factor-authentication-get-started-server-windows.md) per le applicazioni</span><span class="sxs-lookup"><span data-stu-id="7fb98-194">[Configure Windows Authentication](multi-factor-authentication-get-started-server-windows.md) for your applications</span></span>
