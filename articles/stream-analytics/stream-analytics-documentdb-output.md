---
title: Output JSON per Analisi di flusso | Microsoft Docs
description: "Informazioni su come l'analisi di flusso può usare Azure Cosmos DB per l'output JSON, consentendo l'esecuzione di query di archiviazione dei dati e a bassa latenza su dati JSON non strutturati."
keywords: Output JSON
documentationcenter: 
services: stream-analytics,documentdb
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: 5d2a61a6-0dbf-4f1b-80af-60a80eb25dd1
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: samacha
ms.openlocfilehash: cc80b0080c806541362a1ef2d71b95862bd51ca2
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/29/2017
---
# <a name="target-azure-cosmos-db-for-json-output-from-stream-analytics"></a><span data-ttu-id="c8d43-104">Usare Azure Cosmos DB per l'output JSON dell'analisi di flusso</span><span class="sxs-lookup"><span data-stu-id="c8d43-104">Target Azure Cosmos DB for JSON output from Stream Analytics</span></span>
<span data-ttu-id="c8d43-105">L'analisi di flusso può usare [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) per l'output JSON, consentendo l'esecuzione di query di archiviazione dei dati e a bassa latenza su dati JSON non strutturati.</span><span class="sxs-lookup"><span data-stu-id="c8d43-105">Stream Analytics can target [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) for JSON output, enabling data archiving and low-latency queries on unstructured JSON data.</span></span> <span data-ttu-id="c8d43-106">Questo documento descrive alcune procedure consigliate per l'implementazione di questa configurazione.</span><span class="sxs-lookup"><span data-stu-id="c8d43-106">This document covers some best practices for implementing this configuration.</span></span>

<span data-ttu-id="c8d43-107">Se non si ha familiarità con Cosmos DB, vedere l'articolo che descrive il [percorso di apprendimento di Azure Cosmos DB](https://azure.microsoft.com/documentation/learning-paths/documentdb/) per un’introduzione.</span><span class="sxs-lookup"><span data-stu-id="c8d43-107">For those who are unfamiliar with Cosmos DB, take a look at [Azure Cosmos DB’s learning path](https://azure.microsoft.com/documentation/learning-paths/documentdb/) to get started.</span></span> 

<span data-ttu-id="c8d43-108">Nota: l'API di MongoDB basata su raccolte di Cosmos DB non è attualmente supportata.</span><span class="sxs-lookup"><span data-stu-id="c8d43-108">Note: Mongo DB API based Cosmos DB collections is currently not supported.</span></span> 

## <a name="basics-of-cosmos-db-as-an-output-target"></a><span data-ttu-id="c8d43-109">Nozioni di base di Cosmos DB come destinazione di output</span><span class="sxs-lookup"><span data-stu-id="c8d43-109">Basics of Cosmos DB as an output target</span></span>
<span data-ttu-id="c8d43-110">L'output di Azure Cosmos DB nell'analisi di flusso consente la scrittura dei risultati di elaborazione del flusso come output JSON nelle raccolte di Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="c8d43-110">The Azure Cosmos DB output in Stream Analytics enables writing your stream processing results as JSON output into your Cosmos DB collection(s).</span></span> <span data-ttu-id="c8d43-111">Analisi di flusso non crea raccolte nel database, ma ne richiede la creazione anticipata da parte dell'utente.</span><span class="sxs-lookup"><span data-stu-id="c8d43-111">Stream Analytics does not create collections in your database, instead requiring you to create them upfront.</span></span> <span data-ttu-id="c8d43-112">In questo modo, i costi di fatturazione delle raccolte di Cosmos DB sono trasparenti per l'utente ed è possibile ottimizzare direttamente le prestazioni, la coerenza e la capacità delle raccolte usando le [API di Cosmos DB](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span><span class="sxs-lookup"><span data-stu-id="c8d43-112">This is so that the billing costs of Cosmos DB collections are transparent to you, and so that you can tune the performance, consistency and capacity of your collections directly using the [Cosmos DB APIs](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span></span> <span data-ttu-id="c8d43-113">È consigliabile usare un database di Cosmos DB per ogni processo di streaming, per separare in modo logico le raccolte per un processo di streaming.</span><span class="sxs-lookup"><span data-stu-id="c8d43-113">We recommend using one Cosmos DB Database per streaming job to logically separate your collections for a streaming job.</span></span>

<span data-ttu-id="c8d43-114">Di seguito sono descritte alcune delle opzioni per le raccolte di Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="c8d43-114">Some of the Cosmos DB collection options are detailed below.</span></span>

## <a name="tune-consistency-availability-and-latency"></a><span data-ttu-id="c8d43-115">Ottimizzare coerenza, disponibilità e latenza</span><span class="sxs-lookup"><span data-stu-id="c8d43-115">Tune consistency, availability, and latency</span></span>
<span data-ttu-id="c8d43-116">In base ai requisiti dell'applicazione, Cosmos DB consente di ottimizzare il database e le raccolte e di bilanciare coerenza, disponibilità e latenza.</span><span class="sxs-lookup"><span data-stu-id="c8d43-116">To match your application requirements, Cosmos DB allows you to fine tune the database and collections and make trade-offs between consistency, availability and latency.</span></span> <span data-ttu-id="c8d43-117">A seconda dei livelli di coerenza di lettura richiesti dello scenario rispetto alla latenza di lettura e scrittura, è possibile scegliere un livello di coerenza per l'account del database.</span><span class="sxs-lookup"><span data-stu-id="c8d43-117">Depending on what levels of read consistency your scenario needs against read and write latency, you can choose a consistency level on your database account.</span></span> <span data-ttu-id="c8d43-118">Per impostazione predefinita, Cosmos DB consente anche l'indicizzazione sincrona per ogni operazione CRUD nella raccolta.</span><span class="sxs-lookup"><span data-stu-id="c8d43-118">Also by default, Cosmos DB enables synchronous indexing on each CRUD operation to your collection.</span></span> <span data-ttu-id="c8d43-119">Si tratta di un'altra opzione utile per controllare le prestazioni di lettura/scrittura di Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="c8d43-119">This is another useful option to control the write/read performance in Cosmos DB.</span></span> <span data-ttu-id="c8d43-120">Per altre informazioni su questo argomento, vedere l'articolo relativo a come [modificare i livelli di coerenza del database e delle query](../documentdb/documentdb-consistency-levels.md) .</span><span class="sxs-lookup"><span data-stu-id="c8d43-120">For further information on this topic, review the [change your database and query consistency levels](../documentdb/documentdb-consistency-levels.md) article.</span></span>

## <a name="upserts-from-stream-analytics"></a><span data-ttu-id="c8d43-121">Upsert di Analisi di flusso</span><span class="sxs-lookup"><span data-stu-id="c8d43-121">Upserts from Stream Analytics</span></span>
<span data-ttu-id="c8d43-122">L'integrazione dell'analisi di flusso con Cosmos DB consente di inserire o aggiornare i record nella raccolta di Cosmos DB in base a una determinata colonna ID documento.</span><span class="sxs-lookup"><span data-stu-id="c8d43-122">Stream Analytics integration with Cosmos DB allows you to insert or update records in your Cosmos DB collection based on a given Document ID column.</span></span> <span data-ttu-id="c8d43-123">Questa implementazione è detta anche *upsert*.</span><span class="sxs-lookup"><span data-stu-id="c8d43-123">This is also referred to as an *Upsert*.</span></span>

<span data-ttu-id="c8d43-124">Analisi di flusso usa un approccio upsert ottimistico in cui gli aggiornamenti vengono eseguiti solo quando l'inserimento non riesce a causa di un conflitto di ID documento.</span><span class="sxs-lookup"><span data-stu-id="c8d43-124">Stream Analytics utilizes an optimistic Upsert approach, where updates are only done when insert fails due to a Document ID conflict.</span></span> <span data-ttu-id="c8d43-125">Questo aggiornamento viene eseguito da Analisi di flusso come PATCH, consentendo aggiornamenti parziali al documento, ad esempio l'aggiunta di nuove proprietà o la sostituzione di una proprietà esistente eseguita in modo incrementale.</span><span class="sxs-lookup"><span data-stu-id="c8d43-125">This update is performed by Stream Analytics as a PATCH, so it enables partial updates to the document, i.e. addition of new properties or replacing an existing property is performed incrementally.</span></span> <span data-ttu-id="c8d43-126">Le modifiche ai valori delle proprietà di matrice nel documento JSON comporta la sovrascrittura dell'intera matrice, ovvero non viene eseguito il merge della matrice.</span><span class="sxs-lookup"><span data-stu-id="c8d43-126">Note that changes in the values of array properties in your JSON document result in the entire array getting overwritten, i.e. the array is not merged.</span></span>

## <a name="data-partitioning-in-cosmos-db"></a><span data-ttu-id="c8d43-127">Partizionamento dei dati in Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="c8d43-127">Data partitioning in Cosmos DB</span></span>
<span data-ttu-id="c8d43-128">Le [raccolte partizionate](../cosmos-db/partition-data.md) di Cosmos DB sono l'approccio consigliato per il partizionamento dei dati.</span><span class="sxs-lookup"><span data-stu-id="c8d43-128">Cosmos DB [partitioned collections](../cosmos-db/partition-data.md) are the recommended approach for partitioning your data.</span></span> 

<span data-ttu-id="c8d43-129">Per le raccolte Cosmos DB singole, l'analisi di flusso consente di partizionare i dati in base ai modelli di query e alle esigenze dell'applicazione in termini di prestazioni.</span><span class="sxs-lookup"><span data-stu-id="c8d43-129">For single Cosmos DB collections, Stream Analytics still allows you to partition your data based on both the query patterns and performance needs of your application.</span></span> <span data-ttu-id="c8d43-130">Ogni raccolta può contenere fino a 10 GB di dati (massimo) e attualmente non è possibile aumentare una raccolta o eseguirne l'overflow.</span><span class="sxs-lookup"><span data-stu-id="c8d43-130">Each collection may contain up to 10GB of data (maximum) and currently there is no way to scale up (or overflow) a collection.</span></span> <span data-ttu-id="c8d43-131">Per la scalabilità orizzontale, Analisi di flusso consente di scrivere in più raccolte con un determinato prefisso. Vedere i dettagli di utilizzo di seguito.</span><span class="sxs-lookup"><span data-stu-id="c8d43-131">For scaling out, Stream Analytics allows you to write to multiple collections with a given prefix (see usage details below).</span></span> <span data-ttu-id="c8d43-132">Per partizionare i record di output, Analisi di flusso usa la strategia coerente del [resolver di partizionamento hash](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) basata sulla colonna PartitionKey indicata dall'utente.</span><span class="sxs-lookup"><span data-stu-id="c8d43-132">Stream Analytics uses the consistent [Hash Partition Resolver](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategy based on the user provided PartitionKey column to partition its output records.</span></span> <span data-ttu-id="c8d43-133">Il numero di raccolte con il prefisso specificato all'avvio del processo di streaming viene usato come conteggio delle partizioni di output in cui il processo scrive in parallelo (raccolte di Cosmos DB = partizioni di output).</span><span class="sxs-lookup"><span data-stu-id="c8d43-133">The number of collections with the given prefix at the streaming job’s start time is used as the output partition count, to which the job writes to in parallel (Cosmos DB Collections = Output Partitions).</span></span> <span data-ttu-id="c8d43-134">Per una singola raccolta con indicizzazione differita che esegue solo inserimenti, è prevedibile una velocità effettiva di scrittura di 0,4 MB/s.</span><span class="sxs-lookup"><span data-stu-id="c8d43-134">For a single collection with lazy indexing doing only inserts, about 0.4 MB/s write throughput can be expected.</span></span> <span data-ttu-id="c8d43-135">L'uso di più raccolte può consentire di ottenere una maggiore capacità e una velocità effettiva più elevata.</span><span class="sxs-lookup"><span data-stu-id="c8d43-135">Using multiple collections can allow you to achieve higher throughput and increased capacity.</span></span>

<span data-ttu-id="c8d43-136">Se si prevede di aumentare il numero di partizioni in futuro, potrebbe essere necessario arrestare il processo, ripartizionare i dati dalle raccolte esistenti in nuove raccolte e quindi riavviare il processo di Analisi di flusso.</span><span class="sxs-lookup"><span data-stu-id="c8d43-136">If you intend to increase the partition count in the future, you may need to stop your job, repartition the data from your existing collections into new collections and then restart the Stream Analytics job.</span></span> <span data-ttu-id="c8d43-137">Altre informazioni sull'uso di PartitionResolver e sul ripartizionamento, con codice di esempio, saranno incluse in un post di approfondimento.</span><span class="sxs-lookup"><span data-stu-id="c8d43-137">More details on using PartitionResolver and re-partitioning along with sample code, will be included in a follow-up post.</span></span> <span data-ttu-id="c8d43-138">Anche l'articolo [Partizionamento e scalabilità in Cosmos DB](../documentdb/documentdb-partition-data.md) include informazioni dettagliate sull'argomento.</span><span class="sxs-lookup"><span data-stu-id="c8d43-138">The article [Partitioning and scaling in Cosmos DB](../documentdb/documentdb-partition-data.md) also provides details on this.</span></span>

## <a name="cosmos-db-settings-for-json-output"></a><span data-ttu-id="c8d43-139">Impostazioni di Cosmos DB per l'output JSON</span><span class="sxs-lookup"><span data-stu-id="c8d43-139">Cosmos DB settings for JSON output</span></span>
<span data-ttu-id="c8d43-140">La creazione di Cosmos DB come output nell'analisi di flusso genera una richiesta di informazioni, come illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="c8d43-140">Creating Cosmos DB as an output in Stream Analytics generates a prompt for information as seen below.</span></span> <span data-ttu-id="c8d43-141">Questa sezione fornisce una spiegazione della definizione delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="c8d43-141">This section provides an explanation of the properties definition.</span></span>

<span data-ttu-id="c8d43-142">Raccolta partizionata</span><span class="sxs-lookup"><span data-stu-id="c8d43-142">Partitioned Collection</span></span> | <span data-ttu-id="c8d43-143">Più raccolte a partizione singola</span><span class="sxs-lookup"><span data-stu-id="c8d43-143">Multiple “Single Partition” collections</span></span>
---|---
![documentdb analisi di flusso schermata di output](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-1.png) |  ![documentdb analisi di flusso schermata di output](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-2.png)


  
> [!NOTE]
> <span data-ttu-id="c8d43-146">Lo scenario con **più raccolte a partizione singola** richiede una chiave di partizione ed è una configurazione supportata.</span><span class="sxs-lookup"><span data-stu-id="c8d43-146">The **Multiple “Single Partition” collections** scenario requires a partition key and is a supported configuration.</span></span> 

* <span data-ttu-id="c8d43-147">**Alias di output** : alias per fare riferimento a questo output nella query ASA.</span><span class="sxs-lookup"><span data-stu-id="c8d43-147">**Output Alias** – An alias to refer this output in your ASA query</span></span>  
* <span data-ttu-id="c8d43-148">**Nome account**: nome o URI endpoint dell'account Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="c8d43-148">**Account Name** – The name or endpoint URI of the Cosmos DB account.</span></span>  
* <span data-ttu-id="c8d43-149">**Chiave account** : chiave di accesso condiviso per l'account Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="c8d43-149">**Account Key** – The shared access key for the Cosmos DB account.</span></span>  
* <span data-ttu-id="c8d43-150">**Database**: nome del database Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="c8d43-150">**Database** – The Cosmos DB database name.</span></span>  
* <span data-ttu-id="c8d43-151">**Modello del nome di raccolta**: nome della raccolta o modello per le raccolte da usare.</span><span class="sxs-lookup"><span data-stu-id="c8d43-151">**Collection Name Pattern** – The collection name or their pattern for the collections to be used.</span></span> <span data-ttu-id="c8d43-152">Il formato del nome di raccolta può essere costruito utilizzando il token {partizione} facoltativo, dove le partizioni iniziano da 0.</span><span class="sxs-lookup"><span data-stu-id="c8d43-152">The collection name format can be constructed using the optional {partition} token, where partitions start from 0.</span></span> <span data-ttu-id="c8d43-153">Di seguito sono riportati input di esempio validi:</span><span class="sxs-lookup"><span data-stu-id="c8d43-153">Following are sample valid inputs:</span></span>  
  <span data-ttu-id="c8d43-154">1\) MyCollection: deve essere presente una raccolta denominata "MyCollection".</span><span class="sxs-lookup"><span data-stu-id="c8d43-154">1\) MyCollection – One collection named “MyCollection” must exist.</span></span>  
  <span data-ttu-id="c8d43-155">2\) MyCollection{partizione}: devono essere presenti le raccolte "MyCollection0", "MyCollection1", "MyCollection2" e così via.</span><span class="sxs-lookup"><span data-stu-id="c8d43-155">2\) MyCollection{partition} – Such collections must exist– "MyCollection0”, “MyCollection1”, “MyCollection2” and so on.</span></span>  
* <span data-ttu-id="c8d43-156">**Chiave di partizione**: valore facoltativo.</span><span class="sxs-lookup"><span data-stu-id="c8d43-156">**Partition Key** – Optional.</span></span> <span data-ttu-id="c8d43-157">È necessario solo se si usa un token {partition} nel modello del nome di raccolta.</span><span class="sxs-lookup"><span data-stu-id="c8d43-157">This is only needed if you are using a {parition} token in your collection name pattern.</span></span> <span data-ttu-id="c8d43-158">Il nome del campo negli eventi di output utilizzato per specificare la chiave per il partizionamento di output nelle raccolte.</span><span class="sxs-lookup"><span data-stu-id="c8d43-158">The name of the field in output events used to specify the key for partitioning output across collections.</span></span> <span data-ttu-id="c8d43-159">Per l'output di una singola raccolta si può usare qualsiasi colonna di output arbitraria, ad esempio PartitionId.</span><span class="sxs-lookup"><span data-stu-id="c8d43-159">For single collection output, any arbitrary output column can be used e.g. PartitionId.</span></span>  
* <span data-ttu-id="c8d43-160">**ID documento** : valore facoltativo.</span><span class="sxs-lookup"><span data-stu-id="c8d43-160">**Document ID** – Optional.</span></span> <span data-ttu-id="c8d43-161">Il nome del campo negli eventi di output usato per specificare la chiave primaria su cui si basano le operazioni di inserimento o aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="c8d43-161">The name of the field in output events used to specify the primary key on which insert or update operations are based.</span></span>  
