---
title: Active Directory aaaAzure ambiti v 2.0, autorizzazioni e consenso | Documenti Microsoft
description: Descrizione dell'endpoint v 2.0 hello Azure AD, inclusi il consenso, autorizzazioni e ambiti di autorizzazione.
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 8f98cbf0-a71d-4e34-babf-e644ad9ff423
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/07/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 5721d368c435868bfb4ae91cff7fbb9bc4a79b66
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="scopes-permissions-and-consent-in-hello-azure-active-directory-v20-endpoint"></a><span data-ttu-id="ac904-103">Consenso hello Azure v 2.0 endpoint di Active Directory, autorizzazioni e ambiti</span><span class="sxs-lookup"><span data-stu-id="ac904-103">Scopes, permissions, and consent in hello Azure Active Directory v2.0 endpoint</span></span>
<span data-ttu-id="ac904-104">Le app che si integrano con Azure Active Directory (Azure AD) seguono un modello di autorizzazione che consente agli utenti di controllare la modalità di accesso ai dati da parte di un'app.</span><span class="sxs-lookup"><span data-stu-id="ac904-104">Apps that integrate with Azure Active Directory (Azure AD) follow an authorization model that gives users control over how an app can access their data.</span></span> <span data-ttu-id="ac904-105">implementazione v 2.0 Hello del modello di autorizzazione hello è stata aggiornata e viene modificato come un'app deve interagire con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ac904-105">hello v2.0 implementation of hello authorization model has been updated, and it changes how an app must interact with Azure AD.</span></span> <span data-ttu-id="ac904-106">In questo articolo vengono illustrati i concetti di base di questo modello di autorizzazione, inclusi gli ambiti, autorizzazioni e consenso hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-106">This article covers hello basic concepts of this authorization model, including scopes, permissions, and consent.</span></span>

> [!NOTE]
> <span data-ttu-id="ac904-107">endpoint di Hello v 2.0 non supporta tutti gli scenari di Azure Active Directory e le funzionalità.</span><span class="sxs-lookup"><span data-stu-id="ac904-107">hello v2.0 endpoint does not support all Azure Active Directory scenarios and features.</span></span> <span data-ttu-id="ac904-108">toodetermine se è necessario utilizzare endpoint v 2.0 hello, conoscenza [limitazioni v 2.0](active-directory-v2-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="ac904-108">toodetermine whether you should use hello v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>
>
>

## <a name="scopes-and-permissions"></a><span data-ttu-id="ac904-109">Ambiti e autorizzazioni</span><span class="sxs-lookup"><span data-stu-id="ac904-109">Scopes and permissions</span></span>
<span data-ttu-id="ac904-110">Azure AD implementa hello [OAuth 2.0](active-directory-v2-protocols.md) protocollo di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="ac904-110">Azure AD implements hello [OAuth 2.0](active-directory-v2-protocols.md) authorization protocol.</span></span> <span data-ttu-id="ac904-111">OAuth 2.0 è un metodo tramite cui un'applicazione di terze parti può accedere alle risorse ospitate sul Web per conto dell'utente.</span><span class="sxs-lookup"><span data-stu-id="ac904-111">OAuth 2.0 is a method through which a third-party app can access web-hosted resources on behalf of a user.</span></span> <span data-ttu-id="ac904-112">Qualsiasi risorsa ospitata sul Web che si integra con Azure AD dispoen di un identificatore di risorsa o di un *URI ID dell'applicazione*.</span><span class="sxs-lookup"><span data-stu-id="ac904-112">Any web-hosted resource that integrates with Azure AD has a resource identifier, or *Application ID URI*.</span></span> <span data-ttu-id="ac904-113">Ad esempio, alcune delle risorse ospitate sul Web di Microsoft includono:</span><span class="sxs-lookup"><span data-stu-id="ac904-113">For example, some of Microsoft's web-hosted resources include:</span></span>

* <span data-ttu-id="ac904-114">Hello API di Office 365 unificata posta elettronica:`https://outlook.office.com`</span><span class="sxs-lookup"><span data-stu-id="ac904-114">hello Office 365 Unified Mail API: `https://outlook.office.com`</span></span>
* <span data-ttu-id="ac904-115">Hello API Azure AD Graph:`https://graph.windows.net`</span><span class="sxs-lookup"><span data-stu-id="ac904-115">hello Azure AD Graph API: `https://graph.windows.net`</span></span>
* <span data-ttu-id="ac904-116">Microsoft Graph: `https://graph.microsoft.com`</span><span class="sxs-lookup"><span data-stu-id="ac904-116">Microsoft Graph: `https://graph.microsoft.com`</span></span>

<span data-ttu-id="ac904-117">Hello che lo stesso vale per tutte le risorse di terze parti che sono integrate con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ac904-117">hello same is true for any third-party resources that have integrated with Azure AD.</span></span> <span data-ttu-id="ac904-118">Una di queste risorse inoltre possibile definire un set di autorizzazioni che possono essere utilizzati toodivide hello di funzionalità di tale risorsa in blocchi più piccoli.</span><span class="sxs-lookup"><span data-stu-id="ac904-118">Any of these resources also can define a set of permissions that can be used toodivide hello functionality of that resource into smaller chunks.</span></span> <span data-ttu-id="ac904-119">Ad esempio, [Microsoft Graph](https://graph.microsoft.io) definito hello toodo le autorizzazioni seguenti attività, tra gli altri:</span><span class="sxs-lookup"><span data-stu-id="ac904-119">As an example, [Microsoft Graph](https://graph.microsoft.io) has defined permissions toodo hello following tasks, among others:</span></span>

* <span data-ttu-id="ac904-120">Lettura del calendario dell'utente</span><span class="sxs-lookup"><span data-stu-id="ac904-120">Read a user's calendar</span></span>
* <span data-ttu-id="ac904-121">Calendario dell'utente di scrittura tooa</span><span class="sxs-lookup"><span data-stu-id="ac904-121">Write tooa user's calendar</span></span>
* <span data-ttu-id="ac904-122">Invio di messaggi di posta elettronica come utente</span><span class="sxs-lookup"><span data-stu-id="ac904-122">Send mail as a user</span></span>

<span data-ttu-id="ac904-123">La definizione di questi tipi di autorizzazioni di risorsa hello è un controllo accurato dei dati e come dati hello esposti.</span><span class="sxs-lookup"><span data-stu-id="ac904-123">By defining these types of permissions, hello resource has fine-grained control over its data and how hello data is exposed.</span></span> <span data-ttu-id="ac904-124">Un'app di terze parti può richiedere tali autorizzazioni da un utente del'app.</span><span class="sxs-lookup"><span data-stu-id="ac904-124">A third-party app can request these permissions from an app user.</span></span> <span data-ttu-id="ac904-125">utente applicazione Hello necessario approvare autorizzazioni hello prima applicazione hello può agire per conto dell'utente hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-125">hello app user must approve hello permissions before hello app can act on hello user's behalf.</span></span> <span data-ttu-id="ac904-126">Da suddivisione in blocchi di funzionalità della risorsa hello in set di autorizzazioni più piccoli, App di terze parti possono essere toorequest compilato solo hello autorizzazioni specifiche necessarie tooperform le relative funzioni.</span><span class="sxs-lookup"><span data-stu-id="ac904-126">By chunking hello resource's functionality into smaller permission sets, third-party apps can be built toorequest only hello specific permissions that they need tooperform their function.</span></span> <span data-ttu-id="ac904-127">Gli utenti di App possono sapere esattamente come un'app utilizzerà i propri dati e possono essere più sicuri che app hello non funziona con malintenzionati.</span><span class="sxs-lookup"><span data-stu-id="ac904-127">App users can know exactly how an app will use their data, and they can be more confident that hello app is not behaving with malicious intent.</span></span>

<span data-ttu-id="ac904-128">In Azure AD e OAuth queste autorizzazioni vengono definite *ambiti* o</span><span class="sxs-lookup"><span data-stu-id="ac904-128">In Azure AD and OAuth, these types of permissions are called *scopes*.</span></span> <span data-ttu-id="ac904-129">Sono anche tooas cui *oAuth2Permissions*.</span><span class="sxs-lookup"><span data-stu-id="ac904-129">They also sometimes are referred tooas *oAuth2Permissions*.</span></span> <span data-ttu-id="ac904-130">Un ambito è rappresentato in Azure AD come valore stringa.</span><span class="sxs-lookup"><span data-stu-id="ac904-130">A scope is represented in Azure AD as a string value.</span></span> <span data-ttu-id="ac904-131">Riprendendo l'esempio di Microsoft Graph hello, hello valore ambito per ogni autorizzazione è:</span><span class="sxs-lookup"><span data-stu-id="ac904-131">Continuing with hello Microsoft Graph example, hello scope value for each permission is:</span></span>

* <span data-ttu-id="ac904-132">Lettura del calendario dell'utente tramite `Calendar.Read`</span><span class="sxs-lookup"><span data-stu-id="ac904-132">Read a user's calendar by using `Calendar.Read`</span></span>
* <span data-ttu-id="ac904-133">Calendario dell'utente di scrittura tooa utilizzando`Mail.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="ac904-133">Write tooa user's calendar by using `Mail.ReadWrite`</span></span>
* <span data-ttu-id="ac904-134">Invio di messaggi di posta elettronica come utente tramite `Mail.Send`</span><span class="sxs-lookup"><span data-stu-id="ac904-134">Send mail as a user using by `Mail.Send`</span></span>

<span data-ttu-id="ac904-135">Un'applicazione può richiedere tali autorizzazioni specificando gli ambiti di hello nell'endpoint di richieste toohello v 2.0.</span><span class="sxs-lookup"><span data-stu-id="ac904-135">An app can request these permissions by specifying hello scopes in requests toohello v2.0 endpoint.</span></span>

## <a name="openid-connect-scopes"></a><span data-ttu-id="ac904-136">Ambiti di OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="ac904-136">OpenID Connect scopes</span></span>
<span data-ttu-id="ac904-137">implementazione di v 2.0 Hello di OpenID Connect presenta alcuni ambiti ben definiti che si applicano risorsa specifica tooa: `openid`, `email`, `profile`, e `offline_access`.</span><span class="sxs-lookup"><span data-stu-id="ac904-137">hello v2.0 implementation of OpenID Connect has a few well-defined scopes that do not apply tooa specific resource: `openid`, `email`, `profile`, and `offline_access`.</span></span>

### <a name="openid"></a><span data-ttu-id="ac904-138">openid</span><span class="sxs-lookup"><span data-stu-id="ac904-138">openid</span></span>
<span data-ttu-id="ac904-139">Se un'applicazione esegue l'accesso tramite [OpenID Connect](active-directory-v2-protocols.md), deve richiedere hello `openid` ambito.</span><span class="sxs-lookup"><span data-stu-id="ac904-139">If an app performs sign-in by using [OpenID Connect](active-directory-v2-protocols.md), it must request hello `openid` scope.</span></span> <span data-ttu-id="ac904-140">Hello `openid` Mostra ambito account lavoro hello come autorizzazione "Accedi" hello, pagina di consenso e account Microsoft personale hello pagina di consenso come hello autorizzazione per "visualizzare il profilo e connettere tooapps e servizi con account Microsoft".</span><span class="sxs-lookup"><span data-stu-id="ac904-140">hello `openid` scope shows on hello work account consent page as hello "Sign you in" permission, and on hello personal Microsoft account consent page as hello "View your profile and connect tooapps and services using your Microsoft account" permission.</span></span> <span data-ttu-id="ac904-141">Con questa autorizzazione, un'app può ricevere un identificatore univoco per l'utente hello in forma di hello di hello `sub` attestazione.</span><span class="sxs-lookup"><span data-stu-id="ac904-141">With this permission, an app can receive a unique identifier for hello user in hello form of hello `sub` claim.</span></span> <span data-ttu-id="ac904-142">Fornisce inoltre un endpoint UserInfo toohello di hello app l'accesso.</span><span class="sxs-lookup"><span data-stu-id="ac904-142">It also gives hello app access toohello UserInfo endpoint.</span></span> <span data-ttu-id="ac904-143">Hello `openid` ambito può essere utilizzato in hello v 2.0 endpoint token tooacquire ID token, che può essere utilizzato toosecure HTTP chiamate tra i diversi componenti di un'app.</span><span class="sxs-lookup"><span data-stu-id="ac904-143">hello `openid` scope can be used at hello v2.0 token endpoint tooacquire ID tokens, which can be used toosecure HTTP calls between different components of an app.</span></span>

### <a name="email"></a><span data-ttu-id="ac904-144">email</span><span class="sxs-lookup"><span data-stu-id="ac904-144">email</span></span>
<span data-ttu-id="ac904-145">Hello `email` ambito può essere utilizzato con hello `openid` ambito e tutte le altre.</span><span class="sxs-lookup"><span data-stu-id="ac904-145">hello `email` scope can be used with hello `openid` scope and any others.</span></span> <span data-ttu-id="ac904-146">Fornisce l'indirizzo di posta elettronica principale dell'utente di hello app accesso toohello sotto forma di hello di hello `email` attestazione.</span><span class="sxs-lookup"><span data-stu-id="ac904-146">It gives hello app access toohello user's primary email address in hello form of hello `email` claim.</span></span> <span data-ttu-id="ac904-147">Hello `email` attestazione è incluso in un token solo se un indirizzo di posta elettronica è associato l'account utente hello, che non rappresenta sempre vere hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-147">hello `email` claim is included in a token only if an email address is associated with hello user account, which is not always hello case.</span></span> <span data-ttu-id="ac904-148">Se utilizza hello `email` ambito, l'applicazione deve essere preparato toohandle un caso in cui hello `email` attestazione non esiste nel token hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-148">If it uses hello `email` scope, your app should be prepared toohandle a case in which hello `email` claim does not exist in hello token.</span></span>

### <a name="profile"></a><span data-ttu-id="ac904-149">Profilo</span><span class="sxs-lookup"><span data-stu-id="ac904-149">profile</span></span>
<span data-ttu-id="ac904-150">Hello `profile` ambito può essere utilizzato con hello `openid` ambito e tutte le altre.</span><span class="sxs-lookup"><span data-stu-id="ac904-150">hello `profile` scope can be used with hello `openid` scope and any others.</span></span> <span data-ttu-id="ac904-151">Offre hello app accesso tooa notevole quantità di informazioni utente hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-151">It gives hello app access tooa substantial amount of information about hello user.</span></span> <span data-ttu-id="ac904-152">può accedere a informazioni di Hello includono, ma non sono limitate a, hello nome dell'utente, cognome, nome utente preferito, ID di oggetto</span><span class="sxs-lookup"><span data-stu-id="ac904-152">hello information it can access includes, but is not limited to, hello user's given name, surname, preferred username, and object ID.</span></span> <span data-ttu-id="ac904-153">Per un elenco completo di attestazioni di hello profilo nel parametro id_tokens hello disponibili per un utente specifico, vedere hello [v 2.0 token riferimento](active-directory-v2-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="ac904-153">For a complete list of hello profile claims available in hello id_tokens parameter for a specific user, see hello [v2.0 tokens reference](active-directory-v2-tokens.md).</span></span>

### <a name="offlineaccess"></a><span data-ttu-id="ac904-154">offline_access</span><span class="sxs-lookup"><span data-stu-id="ac904-154">offline_access</span></span>
<span data-ttu-id="ac904-155">Hello [ `offline_access` ambito](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) fornisce il tooresources accesso app per conto di utente hello per un periodo di tempo prolungato.</span><span class="sxs-lookup"><span data-stu-id="ac904-155">hello [`offline_access` scope](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) gives your app access tooresources on behalf of hello user for an extended time.</span></span> <span data-ttu-id="ac904-156">Nella pagina di consenso account lavoro hello, questo ambito viene visualizzato come "Accedere ai dati in qualsiasi momento" autorizzazione hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-156">On hello work account consent page, this scope appears as hello "Access your data anytime" permission.</span></span> <span data-ttu-id="ac904-157">Pagina hello personale Microsoft account consenso, venga visualizzato come "Accedere alle tue info in qualsiasi momento" autorizzazione hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-157">On hello personal Microsoft account consent page, it appears as hello "Access your info anytime" permission.</span></span> <span data-ttu-id="ac904-158">Quando un utente approva hello `offline_access` ambito, l'app può ricevere i token di aggiornamento dall'endpoint token di hello v 2.0.</span><span class="sxs-lookup"><span data-stu-id="ac904-158">When a user approves hello `offline_access` scope, your app can receive refresh tokens from hello v2.0 token endpoint.</span></span> <span data-ttu-id="ac904-159">I token di aggiornamento sono di lunga durata.</span><span class="sxs-lookup"><span data-stu-id="ac904-159">Refresh tokens are long-lived.</span></span> <span data-ttu-id="ac904-160">L'applicazione può ottenere nuovi token di accesso quando i vecchi scadono.</span><span class="sxs-lookup"><span data-stu-id="ac904-160">Your app can get new access tokens as older ones expire.</span></span>

<span data-ttu-id="ac904-161">Se l'app non viene richiesta hello `offline_access` ambito, non riceve i token di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="ac904-161">If your app does not request hello `offline_access` scope, it won't receive refresh tokens.</span></span> <span data-ttu-id="ac904-162">Ciò significa che quando si Riscatta un codice di autorizzazione in hello [flusso di codice di autorizzazione OAuth 2.0](active-directory-v2-protocols.md), verrà visualizzato solo un token di accesso da hello `/token` endpoint.</span><span class="sxs-lookup"><span data-stu-id="ac904-162">This means that when you redeem an authorization code in hello [OAuth 2.0 authorization code flow](active-directory-v2-protocols.md), you'll receive only an access token from hello `/token` endpoint.</span></span> <span data-ttu-id="ac904-163">token di accesso Hello è valida per un breve periodo di tempo.</span><span class="sxs-lookup"><span data-stu-id="ac904-163">hello access token is valid for a short time.</span></span> <span data-ttu-id="ac904-164">token di accesso Hello scade in genere in un'ora.</span><span class="sxs-lookup"><span data-stu-id="ac904-164">hello access token usually expires in one hour.</span></span> <span data-ttu-id="ac904-165">A questo punto, l'app deve tooredirect hello utente indietro toohello `/authorize` endpoint tooget un nuovo codice di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="ac904-165">At that point, your app needs tooredirect hello user back toohello `/authorize` endpoint tooget a new authorization code.</span></span> <span data-ttu-id="ac904-166">Durante questo reindirizzamento, a seconda dell'app, tipo di hello hello utente necessario tooenter nuovamente le proprie credenziali o toopermissions nuovamente di consenso.</span><span class="sxs-lookup"><span data-stu-id="ac904-166">During this redirect, depending on hello type of app, hello user might need tooenter their credentials again or consent again toopermissions.</span></span>

<span data-ttu-id="ac904-167">Per ulteriori informazioni sulla modalità di tooget e utilizzare token di aggiornamento, vedere hello [riferimento al protocollo v 2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="ac904-167">For more information about how tooget and use refresh tokens, see hello [v2.0 protocol reference](active-directory-v2-protocols.md).</span></span>

## <a name="requesting-individual-user-consent"></a><span data-ttu-id="ac904-168">Richiesta di consenso per un singolo utente</span><span class="sxs-lookup"><span data-stu-id="ac904-168">Requesting individual user consent</span></span>
<span data-ttu-id="ac904-169">In un [OpenID Connect o OAuth 2.0](active-directory-v2-protocols.md) richiesta di autorizzazione, un'applicazione può richiedere le autorizzazioni di hello necessarie tramite hello `scope` parametro di query.</span><span class="sxs-lookup"><span data-stu-id="ac904-169">In an [OpenID Connect or OAuth 2.0](active-directory-v2-protocols.md) authorization request, an app can request hello permissions it needs by using hello `scope` query parameter.</span></span> <span data-ttu-id="ac904-170">Ad esempio, quando un utente accede tooan app, l'applicazione hello invia una richiesta come hello di esempio seguente (con interruzioni di riga aggiunte per migliorare la leggibilità):</span><span class="sxs-lookup"><span data-stu-id="ac904-170">For example, when a user signs in tooan app, hello app sends a request like hello following example (with line breaks added for legibility):</span></span>

```
GET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=query
&scope=
https%3A%2F%2Fgraph.microsoft.com%2Fcalendar.read%20
https%3A%2F%2Fgraph.microsoft.com%2Fmail.send
&state=12345
```

<span data-ttu-id="ac904-171">Hello `scope` parametro è richiesto un elenco separato da spazi di ambiti che hello app.</span><span class="sxs-lookup"><span data-stu-id="ac904-171">hello `scope` parameter is a space-separated list of scopes that hello app is requesting.</span></span> <span data-ttu-id="ac904-172">Ogni ambito è indicato aggiungendo hello ambito valore toohello identificatore risorsa (Buongiorno URI ID applicazione).</span><span class="sxs-lookup"><span data-stu-id="ac904-172">Each scope is indicated by appending hello scope value toohello resource's identifier (hello Application ID URI).</span></span> <span data-ttu-id="ac904-173">Nell'esempio di richiesta hello, hello necessario app del calendario dell'utente di autorizzazione tooread hello e inviare un messaggio come utente hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-173">In hello request example, hello app needs permission tooread hello user's calendar and send mail as hello user.</span></span>

<span data-ttu-id="ac904-174">Dopo che l'utente hello immette le credenziali, endpoint v 2.0 hello Cerca un record corrispondente di *il consenso dell'utente*.</span><span class="sxs-lookup"><span data-stu-id="ac904-174">After hello user enters their credentials, hello v2.0 endpoint checks for a matching record of *user consent*.</span></span> <span data-ttu-id="ac904-175">Se l'utente hello non ha accettato le condizioni tooany di hello richieste le autorizzazioni in versioni precedenti di hello endpoint v 2.0 hello chiede hello utente toogrant hello autorizzazioni richieste.</span><span class="sxs-lookup"><span data-stu-id="ac904-175">If hello user has not consented tooany of hello requested permissions in hello past, hello v2.0 endpoint asks hello user toogrant hello requested permissions.</span></span>

![Consenso dell'account aziendale](../../media/active-directory-v2-flows/work_account_consent.png)

<span data-ttu-id="ac904-177">Quando l'utente hello Approva autorizzazione hello, consenso hello verrà registrato in modo che hello utente non dispone di tooconsent nuovamente per account successivi accessi.</span><span class="sxs-lookup"><span data-stu-id="ac904-177">When hello user approves hello permission, hello consent is recorded so that hello user doesn't have tooconsent again on subsequent account sign-ins.</span></span>

## <a name="requesting-consent-for-an-entire-tenant"></a><span data-ttu-id="ac904-178">Richiesta di consenso per un intero tenant</span><span class="sxs-lookup"><span data-stu-id="ac904-178">Requesting consent for an entire tenant</span></span>
<span data-ttu-id="ac904-179">Spesso, quando un'organizzazione acquista una licenza o una sottoscrizione per un'applicazione, hello organizzazione vuole che un'applicazione hello toofully il provisioning per tutti i dipendenti.</span><span class="sxs-lookup"><span data-stu-id="ac904-179">Often, when an organization purchases a license or subscription for an application, hello organization wants toofully provision hello application for its employees.</span></span> <span data-ttu-id="ac904-180">Come parte di questo processo, un amministratore può concedere il consenso per tooact applicazione hello per conto di qualsiasi dipendente.</span><span class="sxs-lookup"><span data-stu-id="ac904-180">As part of this process, an administrator can grant consent for hello application tooact on behalf of any employee.</span></span> <span data-ttu-id="ac904-181">Se salve concede il consenso per tenant intera hello, i dipendenti dell'organizzazione hello non verranno visualizzata una pagina di consenso per un'applicazione hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-181">If hello admin grants consent for hello entire tenant, hello organization's employees won't see a consent page for hello application.</span></span>

<span data-ttu-id="ac904-182">consenso toorequest per tutti gli utenti in un tenant, l'app è possibile utilizzare endpoint di autorizzazione Amministrazione hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-182">toorequest consent for all users in a tenant, your app can use hello admin consent endpoint.</span></span>

## <a name="admin-restricted-scopes"></a><span data-ttu-id="ac904-183">Ambiti riservati all'amministratore</span><span class="sxs-lookup"><span data-stu-id="ac904-183">Admin-restricted scopes</span></span>
<span data-ttu-id="ac904-184">È possibile impostare alcune autorizzazioni con privilegi elevati nell'ecosistema Microsoft hello troppo*admin con restrizioni*.</span><span class="sxs-lookup"><span data-stu-id="ac904-184">Some high-privilege permissions in hello Microsoft ecosystem can be set too*admin-restricted*.</span></span> <span data-ttu-id="ac904-185">Esempi di questi tipi di ambiti hello queste autorizzazioni:</span><span class="sxs-lookup"><span data-stu-id="ac904-185">Examples of these kinds of scopes include hello following permissions:</span></span>

* <span data-ttu-id="ac904-186">Lettura di dati in una directory aziendale tramite `Directory.Read`</span><span class="sxs-lookup"><span data-stu-id="ac904-186">Read an organization's directory data by using `Directory.Read`</span></span>
* <span data-ttu-id="ac904-187">Directory dell'organizzazione di scrittura dati tooan tramite`Directory.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="ac904-187">Write data tooan organization's directory by using `Directory.ReadWrite`</span></span>
* <span data-ttu-id="ac904-188">Lettura dei gruppi di sicurezza nella directory aziendale tramite `Groups.Read.All`</span><span class="sxs-lookup"><span data-stu-id="ac904-188">Read security groups in an organization's directory by using `Groups.Read.All`</span></span>

<span data-ttu-id="ac904-189">Anche se un utente di consumer potrebbe consentire un toothis di accesso dell'applicazione di tipo di dati, gli utenti dell'organizzazione sono limitati dalla concessione di accesso toohello stesso set di dati sensibili della società.</span><span class="sxs-lookup"><span data-stu-id="ac904-189">Although a consumer user might grant an application access toothis kind of data, organizational users are restricted from granting access toohello same set of sensitive company data.</span></span> <span data-ttu-id="ac904-190">Se l'applicazione richiede accesso tooone di tali autorizzazioni da un utente aziendale, l'utente hello riceve un messaggio di errore indicante che non sono le autorizzazioni dell'app tooyour tooconsent autorizzati.</span><span class="sxs-lookup"><span data-stu-id="ac904-190">If your application requests access tooone of these permissions from an organizational user, hello user receives an error message that says they are not authorized tooconsent tooyour app's permissions.</span></span>

<span data-ttu-id="ac904-191">Se l'app richiede l'accesso con restrizioni tooadmin ambiti per le organizzazioni, è necessario richiedere li direttamente da un amministratore della società, anche tramite l'endpoint di autorizzazione Amministrazione hello, descritto di seguito.</span><span class="sxs-lookup"><span data-stu-id="ac904-191">If your app requires access tooadmin-restricted scopes for organizations, you should request them directly from a company administrator, also by using hello admin consent endpoint, described next.</span></span>

<span data-ttu-id="ac904-192">Quando un amministratore concede che queste autorizzazioni tramite salve consenso all'endpoint, viene fornito il consenso per tutti gli utenti nel tenant di hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-192">When an administrator grants these permissions via hello admin consent endpoint, consent is granted for all users in hello tenant.</span></span>

## <a name="using-hello-admin-consent-endpoint"></a><span data-ttu-id="ac904-193">Hello endpoint consenso dell'amministratore</span><span class="sxs-lookup"><span data-stu-id="ac904-193">Using hello admin consent endpoint</span></span>
<span data-ttu-id="ac904-194">Seguendo questa procedura, l'applicazione può ottenere le autorizzazioni per tutti gli utenti di un tenant, inclusi gli ambiti riservati all'amministratore.</span><span class="sxs-lookup"><span data-stu-id="ac904-194">If you follow these steps, your app can gather permissions for all users in a tenant, including admin-restricted scopes.</span></span> <span data-ttu-id="ac904-195">un esempio di codice che implementa i passaggi di hello, toosee vedere hello [esempio ambiti admin con restrizioni](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span><span class="sxs-lookup"><span data-stu-id="ac904-195">toosee a code sample that implements hello steps, see hello [admin-restricted scopes sample](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span></span>

### <a name="request-hello-permissions-in-hello-app-registration-portal"></a><span data-ttu-id="ac904-196">Richiedere le autorizzazioni di hello nel portale di registrazione applicazione hello</span><span class="sxs-lookup"><span data-stu-id="ac904-196">Request hello permissions in hello app registration portal</span></span>
1. <span data-ttu-id="ac904-197">Passare tooyour applicazione hello [portale di registrazione applicazione](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), o [creare un'app](active-directory-v2-app-registration.md) se hai già fatto.</span><span class="sxs-lookup"><span data-stu-id="ac904-197">Go tooyour application in hello [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), or [create an app](active-directory-v2-app-registration.md) if you haven't already.</span></span>
2. <span data-ttu-id="ac904-198">Individuare hello **Microsoft Graph autorizzazioni** sezione e quindi aggiungere le autorizzazioni di hello che richiede l'app.</span><span class="sxs-lookup"><span data-stu-id="ac904-198">Locate hello **Microsoft Graph Permissions** section, and then add hello permissions that your app requires.</span></span>
3. <span data-ttu-id="ac904-199">Assicurarsi di aver **salvare** hello registrazione dell'app.</span><span class="sxs-lookup"><span data-stu-id="ac904-199">Make sure you **Save** hello app registration.</span></span>

### <a name="recommended-sign-hello-user-in-tooyour-app"></a><span data-ttu-id="ac904-200">Consigliato: Sign hello utente tooyour app</span><span class="sxs-lookup"><span data-stu-id="ac904-200">Recommended: Sign hello user in tooyour app</span></span>
<span data-ttu-id="ac904-201">In genere, quando si compila un'applicazione che utilizza l'endpoint di autorizzazione Amministrazione hello, hello app richiede una pagina o una vista in cui hello amministratore può approvare le autorizzazioni dell'applicazione hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-201">Typically, when you build an application that uses hello admin consent endpoint, hello app needs a page or view in which hello admin can approve hello app's permissions.</span></span> <span data-ttu-id="ac904-202">Questa pagina può essere parte del flusso di iscrizione dell'applicazione hello, parte di impostazioni dell'applicazione hello o può essere dedicato flusso "connect".</span><span class="sxs-lookup"><span data-stu-id="ac904-202">This page can be part of hello app's sign-up flow, part of hello app's settings, or it can be a dedicated "connect" flow.</span></span> <span data-ttu-id="ac904-203">In molti casi, è opportuno per hello app tooshow questo "connect" visualizzazione solo dopo che un utente ha eseguito l'accesso con un lavoro o scuola account Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ac904-203">In many cases, it makes sense for hello app tooshow this "connect" view only after a user has signed in with a work or school Microsoft account.</span></span>

<span data-ttu-id="ac904-204">Quando si accede utente hello in tooyour app, è possibile identificare l'organizzazione hello salve toowhich appartiene prima che richiede le autorizzazioni necessarie tooapprove hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-204">When you sign hello user in tooyour app, you can identify hello organization toowhich hello admin belongs before asking them tooapprove hello necessary permissions.</span></span> <span data-ttu-id="ac904-205">Sebbene non sia strettamente necessario, questo consente di creare un'esperienza più intuitiva per gli utenti dell'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="ac904-205">Although not strictly necessary, it can help you create a more intuitive experience for your organizational users.</span></span> <span data-ttu-id="ac904-206">toosign hello utente, seguire il nostro [esercitazioni protocollo v 2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="ac904-206">toosign hello user in, follow our [v2.0 protocol tutorials](active-directory-v2-protocols.md).</span></span>

### <a name="request-hello-permissions-from-a-directory-admin"></a><span data-ttu-id="ac904-207">Richiedere le autorizzazioni di hello da un amministratore di directory</span><span class="sxs-lookup"><span data-stu-id="ac904-207">Request hello permissions from a directory admin</span></span>
<span data-ttu-id="ac904-208">Quando sarai pronto toorequest autorizzazioni da amministratore dell'organizzazione, è possibile reindirizzare hello utente toohello 2.0 *admin consenso endpoint*.</span><span class="sxs-lookup"><span data-stu-id="ac904-208">When you're ready toorequest permissions from your organization's admin, you can redirect hello user toohello v2.0 *admin consent endpoint*.</span></span>

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/adminconsent?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&state=12345
&redirect_uri=http://localhost/myapp/permissions
```

```
// Pro tip: Try pasting hello below request in a browser!
```

```
https://login.microsoftonline.com/common/adminconsent?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&state=12345&redirect_uri=http://localhost/myapp/permissions
```

| <span data-ttu-id="ac904-209">.</span><span class="sxs-lookup"><span data-stu-id="ac904-209">Parameter</span></span> | <span data-ttu-id="ac904-210">Condizione</span><span class="sxs-lookup"><span data-stu-id="ac904-210">Condition</span></span> | <span data-ttu-id="ac904-211">Descrizione</span><span class="sxs-lookup"><span data-stu-id="ac904-211">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="ac904-212">tenant</span><span class="sxs-lookup"><span data-stu-id="ac904-212">tenant</span></span> |<span data-ttu-id="ac904-213">Obbligatorio</span><span class="sxs-lookup"><span data-stu-id="ac904-213">Required</span></span> |<span data-ttu-id="ac904-214">tenant di directory Hello che si desidera toorequest autorizzazioni.</span><span class="sxs-lookup"><span data-stu-id="ac904-214">hello directory tenant that you want toorequest permission from.</span></span> <span data-ttu-id="ac904-215">Può essere fornito nel formato di nome descrittivo o GUID.</span><span class="sxs-lookup"><span data-stu-id="ac904-215">Can be provided in GUID or friendly name format.</span></span> |
| <span data-ttu-id="ac904-216">client_id</span><span class="sxs-lookup"><span data-stu-id="ac904-216">client_id</span></span> |<span data-ttu-id="ac904-217">Obbligatorio</span><span class="sxs-lookup"><span data-stu-id="ac904-217">Required</span></span> |<span data-ttu-id="ac904-218">l'ID applicazione Hello che hello [portale di registrazione applicazione](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assegnato tooyour app.</span><span class="sxs-lookup"><span data-stu-id="ac904-218">hello Application ID that hello [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned tooyour app.</span></span> |
| <span data-ttu-id="ac904-219">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="ac904-219">redirect_uri</span></span> |<span data-ttu-id="ac904-220">Obbligatorio</span><span class="sxs-lookup"><span data-stu-id="ac904-220">Required</span></span> |<span data-ttu-id="ac904-221">Hello URI in cui si desidera hello toobe di risposta inviato per l'app toohandle di reindirizzamento.</span><span class="sxs-lookup"><span data-stu-id="ac904-221">hello redirect URI where you want hello response toobe sent for your app toohandle.</span></span> <span data-ttu-id="ac904-222">Deve corrispondere esattamente uno di reindirizzamento hello URI a cui è stato registrato nel portale di registrazione applicazione hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-222">It must exactly match one of hello redirect URIs that you registered in hello app registration portal.</span></span> |
| <span data-ttu-id="ac904-223">state</span><span class="sxs-lookup"><span data-stu-id="ac904-223">state</span></span> |<span data-ttu-id="ac904-224">Consigliato</span><span class="sxs-lookup"><span data-stu-id="ac904-224">Recommended</span></span> |<span data-ttu-id="ac904-225">Un valore incluso nella richiesta di hello che verrà anche restituito nella risposta token hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-225">A value included in hello request that will also be returned in hello token response.</span></span> <span data-ttu-id="ac904-226">Può trattarsi di una stringa di qualsiasi contenuto.</span><span class="sxs-lookup"><span data-stu-id="ac904-226">It can be a string of any content you want.</span></span> <span data-ttu-id="ac904-227">Utilizzare tooencode le informazioni sullo stato di hello sullo stato dell'utente hello in app hello prima dell'esecuzione della richiesta di autenticazione hello, ad esempio si trovassero nelle pagina hello o vista.</span><span class="sxs-lookup"><span data-stu-id="ac904-227">Use hello state tooencode information about hello user's state in hello app before hello authentication request occurred, such as hello page or view they were on.</span></span> |

<span data-ttu-id="ac904-228">A questo punto, Azure AD richiede un toosign amministratore tenant nella richiesta di hello toocomplete.</span><span class="sxs-lookup"><span data-stu-id="ac904-228">At this point, Azure AD requires a tenant administrator toosign in toocomplete hello request.</span></span> <span data-ttu-id="ac904-229">messaggio per l'amministratore ha richiesto tooapprove che tutti hello autorizzazioni richieste per l'app nel portale di registrazione applicazione hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-229">hello administrator is asked tooapprove all hello permissions that you have requested for your app in hello app registration portal.</span></span>

#### <a name="successful-response"></a><span data-ttu-id="ac904-230">Risposta con esito positivo</span><span class="sxs-lookup"><span data-stu-id="ac904-230">Successful response</span></span>
<span data-ttu-id="ac904-231">Se salve Approva autorizzazioni hello per l'app, la risposta corretta hello simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="ac904-231">If hello admin approves hello permissions for your app, hello successful response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?tenant=a8990e1f-ff32-408a-9f8e-78d3b9139b95&state=state=12345&admin_consent=True
```

| <span data-ttu-id="ac904-232">.</span><span class="sxs-lookup"><span data-stu-id="ac904-232">Parameter</span></span> | <span data-ttu-id="ac904-233">Descrizione</span><span class="sxs-lookup"><span data-stu-id="ac904-233">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="ac904-234">tenant</span><span class="sxs-lookup"><span data-stu-id="ac904-234">tenant</span></span> |<span data-ttu-id="ac904-235">tenant di directory Hello concesse le autorizzazioni per l'applicazione hello richiesti, in formato GUID.</span><span class="sxs-lookup"><span data-stu-id="ac904-235">hello directory tenant that granted your application hello permissions it requested, in GUID format.</span></span> |
| <span data-ttu-id="ac904-236">state</span><span class="sxs-lookup"><span data-stu-id="ac904-236">state</span></span> |<span data-ttu-id="ac904-237">Un valore incluso nella richiesta di hello che verrà anche restituito nella risposta token hello.</span><span class="sxs-lookup"><span data-stu-id="ac904-237">A value included in hello request that also will be returned in hello token response.</span></span> <span data-ttu-id="ac904-238">Può trattarsi di una stringa di qualsiasi contenuto.</span><span class="sxs-lookup"><span data-stu-id="ac904-238">It can be a string of any content you want.</span></span> <span data-ttu-id="ac904-239">lo stato di Hello è tooencode utilizzati informazioni sullo stato dell'utente hello in app hello prima dell'esecuzione della richiesta di autenticazione hello, ad esempio pagina hello o fossero nella vista.</span><span class="sxs-lookup"><span data-stu-id="ac904-239">hello state is used tooencode information about hello user's state in hello app before hello authentication request occurred, such as hello page or view they were on.</span></span> |
| <span data-ttu-id="ac904-240">admin_consent</span><span class="sxs-lookup"><span data-stu-id="ac904-240">admin_consent</span></span> |<span data-ttu-id="ac904-241">Verrà impostato troppo**true**.</span><span class="sxs-lookup"><span data-stu-id="ac904-241">Will be set too**true**.</span></span> |

#### <a name="error-response"></a><span data-ttu-id="ac904-242">Risposta di errore</span><span class="sxs-lookup"><span data-stu-id="ac904-242">Error response</span></span>
<span data-ttu-id="ac904-243">Se salve non approvare le autorizzazioni di hello per le app, hello Impossibile risposta ha un aspetto simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="ac904-243">If hello admin does not approve hello permissions for your app, hello failed response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?error=permission_denied&error_description=The+admin+canceled+the+request
```

| <span data-ttu-id="ac904-244">.</span><span class="sxs-lookup"><span data-stu-id="ac904-244">Parameter</span></span> | <span data-ttu-id="ac904-245">Descrizione</span><span class="sxs-lookup"><span data-stu-id="ac904-245">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="ac904-246">error</span><span class="sxs-lookup"><span data-stu-id="ac904-246">error</span></span> |<span data-ttu-id="ac904-247">Una stringa di codice di errore che può essere utilizzati tooclassify tipi di errori che si verificano e può essere utilizzati tooreact tooerrors.</span><span class="sxs-lookup"><span data-stu-id="ac904-247">An error code string that can be used tooclassify types of errors that occur, and can be used tooreact tooerrors.</span></span> |
| <span data-ttu-id="ac904-248">error_description</span><span class="sxs-lookup"><span data-stu-id="ac904-248">error_description</span></span> |<span data-ttu-id="ac904-249">Un messaggio di errore specifico che consente a uno sviluppatore di identificare causa radice di hello di un errore.</span><span class="sxs-lookup"><span data-stu-id="ac904-249">A specific error message that can help a developer identify hello root cause of an error.</span></span> |

<span data-ttu-id="ac904-250">Dopo aver ricevuto una risposta corretta dall'endpoint di consenso dell'amministratore hello, l'app ha ottenuto le autorizzazioni di hello che quando richiesto.</span><span class="sxs-lookup"><span data-stu-id="ac904-250">After you've received a successful response from hello admin consent endpoint, your app has gained hello permissions it requested.</span></span> <span data-ttu-id="ac904-251">Successivamente, è possibile richiedere un token per la risorsa hello desiderato.</span><span class="sxs-lookup"><span data-stu-id="ac904-251">Next, you can request a token for hello resource you want.</span></span>

## <a name="using-permissions"></a><span data-ttu-id="ac904-252">Uso delle autorizzazioni</span><span class="sxs-lookup"><span data-stu-id="ac904-252">Using permissions</span></span>
<span data-ttu-id="ac904-253">Dopo che l'utente hello acconsente toopermissions per l'app, l'app può acquisire i token di accesso che rappresentano tooaccess di autorizzazione dell'app una risorsa in alcune capacità.</span><span class="sxs-lookup"><span data-stu-id="ac904-253">After hello user consents toopermissions for your app, your app can acquire access tokens that represent your app's permission tooaccess a resource in some capacity.</span></span> <span data-ttu-id="ac904-254">Un token di accesso può essere utilizzato solo per una singola risorsa, ma infatti codificato all'interno di token di accesso hello è ogni autorizzazione che l'app è stata concessa per tale risorsa.</span><span class="sxs-lookup"><span data-stu-id="ac904-254">An access token can be used only for a single resource, but encoded inside hello access token is every permission that your app has been granted for that resource.</span></span> <span data-ttu-id="ac904-255">tooacquire un token di accesso, l'app può effettuare un richiesta toohello v 2.0 token endpoint simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="ac904-255">tooacquire an access token, your app can make a request toohello v2.0 token endpoint, like this:</span></span>

```
POST common/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/json

{
    "grant_type": "authorization_code",
    "client_id": "6731de76-14a6-49ae-97bc-6eba6914391e",
    "scope": "https://outlook.office.com/mail.read https://outlook.office.com/mail.send",
    "code": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq..."
    "redirect_uri": "https://localhost/myapp",
    "client_secret": "zc53fwe80980293klaj9823"  // NOTE: Only required for web apps
}
```

<span data-ttu-id="ac904-256">È possibile utilizzare il token di accesso risultante hello nella risorsa di toohello le richieste HTTP.</span><span class="sxs-lookup"><span data-stu-id="ac904-256">You can use hello resulting access token in HTTP requests toohello resource.</span></span> <span data-ttu-id="ac904-257">Indica in modo affidabile toohello risorse che l'app abbia hello delle autorizzazioni appropriate tooperform un'attività specifica.</span><span class="sxs-lookup"><span data-stu-id="ac904-257">It reliably indicates toohello resource that your app has hello proper permission tooperform a specific task.</span></span>  

<span data-ttu-id="ac904-258">Per ulteriori informazioni su OAuth 2.0 hello del protocollo e tooget i token di accesso, vedere hello [riferimento protocollo dell'endpoint v 2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="ac904-258">For more information about hello OAuth 2.0 protocol and how tooget access tokens, see hello [v2.0 endpoint protocol reference](active-directory-v2-protocols.md).</span></span>
