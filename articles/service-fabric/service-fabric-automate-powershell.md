---
title: Automatizzare la gestione dell'applicazione di Azure Service Fabric | Microsoft Docs
description: Distribuire, aggiornare, testare e rimuovere le applicazioni di Service Fabric tramite PowerShell.
services: service-fabric
documentationcenter: .net
author: rwike77
manager: timlt
editor: 
ms.assetid: f03f4294-571d-4262-8a77-cc8b481b959d
ms.service: service-fabric
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 06/16/2017
ms.author: ryanwi
redirect_url: /azure/service-fabric/service-fabric-deploy-remove-applications
ms.openlocfilehash: fb3c2a77ea887289eebf343e223c190781d0e4c2
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="automate-the-application-lifecycle-using-powershell"></a><span data-ttu-id="24998-103">Automatizzare il ciclo di vita dell'applicazione tramite PowerShell</span><span class="sxs-lookup"><span data-stu-id="24998-103">Automate the application lifecycle using PowerShell</span></span>
<span data-ttu-id="24998-104">È possibile automatizzare numerosi aspetti del [ciclo di vita dell'applicazione Service Fabric](service-fabric-application-lifecycle.md) .</span><span class="sxs-lookup"><span data-stu-id="24998-104">Many aspects of the [Service Fabric application lifecycle](service-fabric-application-lifecycle.md) can be automated.</span></span>  <span data-ttu-id="24998-105">Questo articolo illustra come usare PowerShell per automatizzare attività comuni per la distribuzione, l'aggiornamento, la rimozione e il test delle applicazioni di Service Fabric di Azure.</span><span class="sxs-lookup"><span data-stu-id="24998-105">This article shows how to use PowerShell to automate common tasks for deploying, upgrading, removing, and testing Azure Service Fabric applications.</span></span>  <span data-ttu-id="24998-106">Sono disponibili anche API gestite e HTTP per la gestione delle app.</span><span class="sxs-lookup"><span data-stu-id="24998-106">Managed and HTTP APIs for app management are also available.</span></span> <span data-ttu-id="24998-107">Per altre informazioni, vedere la pagina sul [ciclo di vita delle app](service-fabric-application-lifecycle.md) .</span><span class="sxs-lookup"><span data-stu-id="24998-107">See [app lifecycle](service-fabric-application-lifecycle.md) for more information.</span></span>  

## <a name="prerequisites"></a><span data-ttu-id="24998-108">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="24998-108">Prerequisites</span></span>
<span data-ttu-id="24998-109">Prima di passare alle attività nell'articolo, assicurarsi di:</span><span class="sxs-lookup"><span data-stu-id="24998-109">Before you move on to the tasks in the article, be sure to:</span></span>

* <span data-ttu-id="24998-110">Acquisire familiarità con i concetti di Service Fabric descritti nell'articolo sulla [panoramica tecnica di Service Fabric](service-fabric-technical-overview.md).</span><span class="sxs-lookup"><span data-stu-id="24998-110">Get familiar with the Service Fabric concepts described in [Technical overview of Service Fabric](service-fabric-technical-overview.md).</span></span>
* <span data-ttu-id="24998-111">[Installare runtime, SDK e strumenti](service-fabric-get-started.md), che a loro volta installano il modulo PowerShell **ServiceFabric** .</span><span class="sxs-lookup"><span data-stu-id="24998-111">[Install the runtime, SDK, and tools](service-fabric-get-started.md), which also installs the **ServiceFabric** PowerShell module.</span></span>
* <span data-ttu-id="24998-112">[Consentire l'esecuzione di script di PowerShell](service-fabric-get-started.md#enable-powershell-script-execution).</span><span class="sxs-lookup"><span data-stu-id="24998-112">[Enable PowerShell script execution](service-fabric-get-started.md#enable-powershell-script-execution).</span></span>
* <span data-ttu-id="24998-113">Avviare un cluster locale.</span><span class="sxs-lookup"><span data-stu-id="24998-113">Start a local cluster.</span></span>  <span data-ttu-id="24998-114">Avviare una nuova finestra di PowerShell come amministratore ed eseguire lo script di configurazione del cluster dalla cartella SDK: `& "$ENV:ProgramFiles\Microsoft SDKs\Service Fabric\ClusterSetup\DevClusterSetup.ps1"`</span><span class="sxs-lookup"><span data-stu-id="24998-114">Launch a new PowerShell window as an administrator and then run the cluster setup script from the SDK folder: `& "$ENV:ProgramFiles\Microsoft SDKs\Service Fabric\ClusterSetup\DevClusterSetup.ps1"`</span></span>
* <span data-ttu-id="24998-115">Prima di eseguire qualsiasi comando di PowerShell descritto in questo articolo, connettersi al cluster di Service Fabric locale mediante [Connect-ServiceFabricCluster](/powershell/module/servicefabric/connect-servicefabriccluster?view=azureservicefabricps): `Connect-ServiceFabricCluster localhost:19000`</span><span class="sxs-lookup"><span data-stu-id="24998-115">Before you run any PowerShell commands in this article, first connect to the local Service Fabric cluster by using [Connect-ServiceFabricCluster](/powershell/module/servicefabric/connect-servicefabriccluster?view=azureservicefabricps): `Connect-ServiceFabricCluster localhost:19000`</span></span>
* <span data-ttu-id="24998-116">Per le attività seguenti è necessario distribuire un pacchetto dell'applicazione V1 e V2 per l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="24998-116">The following tasks require a v1 application package to deploy and a v2 application package for upgrade.</span></span> <span data-ttu-id="24998-117">Scaricare l'[applicazione di esempio **WordCount**](http://aka.ms/servicefabricsamples), che si trova negli esempi della guida introduttiva.</span><span class="sxs-lookup"><span data-stu-id="24998-117">Download the [**WordCount** sample application](http://aka.ms/servicefabricsamples) (located in the Getting Started samples).</span></span> <span data-ttu-id="24998-118">Compilare e creare un pacchetto dell'applicazione in Visual Studio facendo clic con il pulsante destro del mouse su **WordCount** in Esplora soluzioni e selezionando **Pacchetto**.</span><span class="sxs-lookup"><span data-stu-id="24998-118">Build and package the application in Visual Studio (right-click on **WordCount** in Solution Explorer and select **Package**).</span></span> <span data-ttu-id="24998-119">Copiare il pacchetto v1 da `C:\ServiceFabricSamples\Services\WordCount\WordCount\pkg\Debug` a `C:\Temp\WordCount`.</span><span class="sxs-lookup"><span data-stu-id="24998-119">Copy the v1 package in `C:\ServiceFabricSamples\Services\WordCount\WordCount\pkg\Debug` to `C:\Temp\WordCount`.</span></span> <span data-ttu-id="24998-120">Copiare `C:\Temp\WordCount` in `C:\Temp\WordCountV2`, creando il pacchetto dell'applicazione v2 per l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="24998-120">Copy `C:\Temp\WordCount` to `C:\Temp\WordCountV2`, creating the v2 application package for upgrade.</span></span> <span data-ttu-id="24998-121">Aprire `C:\Temp\WordCountV2\ApplicationManifest.xml` in un editor di testo.</span><span class="sxs-lookup"><span data-stu-id="24998-121">Open `C:\Temp\WordCountV2\ApplicationManifest.xml` in a text editor.</span></span> <span data-ttu-id="24998-122">Nell'elemento **ApplicationManifest** modificare l'attributo **ApplicationTypeVersion** da "1.0.0" in "2.0.0" per aggiornare il numero di versione dell'app.</span><span class="sxs-lookup"><span data-stu-id="24998-122">In the **ApplicationManifest** element, change the **ApplicationTypeVersion** attribute from "1.0.0" to "2.0.0" to update the app version number.</span></span> <span data-ttu-id="24998-123">Salvare il file ApplicationManifest.xml modificato.</span><span class="sxs-lookup"><span data-stu-id="24998-123">Save the changed ApplicationManifest.xml file.</span></span>

## <a name="task-deploy-a-service-fabric-application"></a><span data-ttu-id="24998-124">Attività: Distribuire un'applicazione di Service Fabric</span><span class="sxs-lookup"><span data-stu-id="24998-124">Task: Deploy a Service Fabric application</span></span>
<span data-ttu-id="24998-125">Dopo aver compilato e creato o scaricato il pacchetto dell'applicazione, è possibile distribuire l'applicazione in un cluster di Service Fabric locale.</span><span class="sxs-lookup"><span data-stu-id="24998-125">After you've built and packaged the application (or downloaded the application package), you can deploy the application into a local Service Fabric cluster.</span></span> <span data-ttu-id="24998-126">La distribuzione comporta il caricamento del pacchetto dell'applicazione, la registrazione del tipo di applicazione e la creazione dell'istanza dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="24998-126">Deployment involves uploading the application package, registering the application type, and creating the application instance.</span></span> <span data-ttu-id="24998-127">Utilizzare le istruzioni riportate in questa sezione per distribuire una nuova applicazione in un cluster.</span><span class="sxs-lookup"><span data-stu-id="24998-127">Use the instructions in this section to deploy a new application to a cluster.</span></span>

### <a name="step-1-upload-the-application-package"></a><span data-ttu-id="24998-128">Passaggio 1: Caricare il pacchetto dell’applicazione</span><span class="sxs-lookup"><span data-stu-id="24998-128">Step 1: Upload the application package</span></span>
<span data-ttu-id="24998-129">Quando si carica il pacchetto dell'applicazione nell'archivio immagini, lo si inserisce in un percorso accessibile ai componenti interni di Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="24998-129">Uploading the application package to the image store puts it in a location accessible to internal Service Fabric components.</span></span>  <span data-ttu-id="24998-130">Il pacchetto dell'applicazione contiene il manifesto dell'applicazione necessario, i manifesti del servizio e i pacchetti di codice, configurazione e dati per creare le istanze dell'applicazione e del servizio.</span><span class="sxs-lookup"><span data-stu-id="24998-130">The application package contains the necessary application manifest, service manifests, and code, configuration, and data package(s) to create the application and service instances.</span></span> <span data-ttu-id="24998-131">Se si desidera verificare il pacchetto dell'applicazione in locale, usare il cmdlet [Test-ServiceFabricApplicationPackage](/powershell/servicefabric/vlatest/test-servicefabricapplicationpackage).</span><span class="sxs-lookup"><span data-stu-id="24998-131">If you want to verify the app package locally, use the [Test-ServiceFabricApplicationPackage](/powershell/servicefabric/vlatest/test-servicefabricapplicationpackage) cmdlet.</span></span>  <span data-ttu-id="24998-132">Il comando [Copy-ServiceFabricApplicationPackage](/powershell/module/servicefabric/copy-servicefabricapplicationpackage?view=azureservicefabricps) carica il pacchetto.</span><span class="sxs-lookup"><span data-stu-id="24998-132">The [Copy-ServiceFabricApplicationPackage](/powershell/module/servicefabric/copy-servicefabricapplicationpackage?view=azureservicefabricps) command uploads the package.</span></span> <span data-ttu-id="24998-133">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="24998-133">For example:</span></span>

```powershell
Copy-ServiceFabricApplicationPackage C:\Temp\WordCount\ -ImageStoreConnectionString file:C:\SfDevCluster\Data\ImageStoreShare -ApplicationPackagePathInImageStore WordCount
```

### <a name="step-2-register-the-application-type"></a><span data-ttu-id="24998-134">Passaggio 2: Registrare il tipo di applicazione</span><span class="sxs-lookup"><span data-stu-id="24998-134">Step 2: Register the application type</span></span>
<span data-ttu-id="24998-135">Quando si registra il pacchetto dell’applicazione, il tipo e la versione dell'applicazione dichiarati nel manifesto di quest'ultima diventano disponibili per l'uso </span><span class="sxs-lookup"><span data-stu-id="24998-135">Registering the application package makes the application type and version declared in the application manifest available for use.</span></span> <span data-ttu-id="24998-136">Il sistema legge il pacchetto caricato al passaggio 1, lo verifica mediante un'operazione equivalente all'esecuzione di [Test-ServiceFabricApplicationPackage](/powershell/servicefabric/vlatest/test-servicefabricapplicationpackage) in locale, ne elabora il contenuto e infine copia il pacchetto elaborato in un percorso di sistema interno.</span><span class="sxs-lookup"><span data-stu-id="24998-136">The system reads the package uploaded in the step 1, verify the package (equivalent to running [Test-ServiceFabricApplicationPackage](/powershell/servicefabric/vlatest/test-servicefabricapplicationpackage) locally), process the package contents, and copy the processed package to an internal system location.</span></span>  <span data-ttu-id="24998-137">Eseguire il cmdlet [Register-ServiceFabricApplicationType](/powershell/module/servicefabric/register-servicefabricapplicationtype?view=azureservicefabricps):</span><span class="sxs-lookup"><span data-stu-id="24998-137">Run the [Register-ServiceFabricApplicationType](/powershell/module/servicefabric/register-servicefabricapplicationtype?view=azureservicefabricps) cmdlet:</span></span>

```powershell
Register-ServiceFabricApplicationType WordCount
```
<span data-ttu-id="24998-138">Per visualizzare tutti i tipi di applicazione registrati nel cluster, eseguire il cmdlet [Get-ServiceFabricApplicationType](/powershell/module/servicefabric/get-servicefabricapplicationtype?view=azureservicefabricps):</span><span class="sxs-lookup"><span data-stu-id="24998-138">To see all the application types registered in the cluster, run the [Get-ServiceFabricApplicationType](/powershell/module/servicefabric/get-servicefabricapplicationtype?view=azureservicefabricps) cmdlet:</span></span>

```powershell
Get-ServiceFabricApplicationType
```

### <a name="step-3-create-the-application-instance"></a><span data-ttu-id="24998-139">Passaggio 3: Creare l'istanza dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="24998-139">Step 3: Create the application instance</span></span>
<span data-ttu-id="24998-140">È possibile creare un'istanza di un'applicazione usando qualsiasi versione del tipo di applicazione che sia stata registrata mediante il comando [New-ServiceFabricApplication](/powershell/module/servicefabric/new-servicefabricapplication?view=azureservicefabricps).</span><span class="sxs-lookup"><span data-stu-id="24998-140">An application can be instantiated by using any application type version that has been registered successfully by using the [New-ServiceFabricApplication](/powershell/module/servicefabric/new-servicefabricapplication?view=azureservicefabricps) command.</span></span> <span data-ttu-id="24998-141">Il nome di ogni applicazione viene dichiarato al momento della distribuzione e deve iniziare con lo schema **fabric:** ed essere univoco per ogni istanza dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="24998-141">The name of each application is declared at deploy time and must start with the **fabric:** scheme and be unique for each application instance.</span></span> <span data-ttu-id="24998-142">Il nome e la versione del tipo di applicazione vengono dichiarati nel file **ApplicationManifest.xml** del pacchetto dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="24998-142">The application type name and application type version are declared in the **ApplicationManifest.xml** file of the application package.</span></span> <span data-ttu-id="24998-143">Se nel manifesto dell'applicazione del tipo di applicazione di destinazione sono specificati servizi predefiniti, verranno creati in questa fase.</span><span class="sxs-lookup"><span data-stu-id="24998-143">If any default services were defined in the application manifest of the target application type, then those are created at this time.</span></span>

```powershell
New-ServiceFabricApplication fabric:/WordCount WordCount 1.0.0
```

<span data-ttu-id="24998-144">Il comando [Get-ServiceFabricApplication](/powershell/servicefabric/vlatest/get-servicefabricapplication) elenca tutte le istanze dell'applicazione create correttamente, indicando il relativo stato complessivo.</span><span class="sxs-lookup"><span data-stu-id="24998-144">The [Get-ServiceFabricApplication](/powershell/servicefabric/vlatest/get-servicefabricapplication) command lists all application instances that were successfully created, along with their overall status.</span></span> <span data-ttu-id="24998-145">Il comando [Get-ServiceFabricService](/powershell/module/servicefabric/get-servicefabricservice?view=azureservicefabricps) elenca tutte le istanze del servizio create all'interno di una determinata istanza dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="24998-145">The [Get-ServiceFabricService](/powershell/module/servicefabric/get-servicefabricservice?view=azureservicefabricps) command lists all of the service instances that were successfully created within a given application instance.</span></span> <span data-ttu-id="24998-146">Vengono elencati anche gli eventuali servizi predefiniti.</span><span class="sxs-lookup"><span data-stu-id="24998-146">Default services (if any) are listed.</span></span>

```powershell
Get-ServiceFabricApplication

Get-ServiceFabricApplication | Get-ServiceFabricService
```

## <a name="task-upgrade-a-service-fabric-application"></a><span data-ttu-id="24998-147">Attività: Aggiornare un'applicazione di Service Fabric</span><span class="sxs-lookup"><span data-stu-id="24998-147">Task: Upgrade a Service Fabric application</span></span>
<span data-ttu-id="24998-148">È possibile aggiornare un'applicazione di Service Fabric distribuita in precedenza con un pacchetto dell'applicazione aggiornato.</span><span class="sxs-lookup"><span data-stu-id="24998-148">You can upgrade a previously deployed Service Fabric application with an updated application package.</span></span> <span data-ttu-id="24998-149">Questa attività consente di aggiornare l'applicazione WordCount distribuita in "Attività: Distribuire un'applicazione di Service Fabric".</span><span class="sxs-lookup"><span data-stu-id="24998-149">This task upgrades the WordCount application that was deployed in "Task: Deploy a Service Fabric application."</span></span> <span data-ttu-id="24998-150">Per altre informazioni, vedere [Aggiornamento di un'applicazione di Service Fabric](service-fabric-application-upgrade.md) .</span><span class="sxs-lookup"><span data-stu-id="24998-150">Read through [Service Fabric application upgrade](service-fabric-application-upgrade.md) for more information.</span></span>

<span data-ttu-id="24998-151">Per semplificare le operazioni in questo esempio, è stato aggiornato solo il numero di versione dell'applicazione nel pacchetto dell'applicazione WordCountV2 creato nei prerequisiti.</span><span class="sxs-lookup"><span data-stu-id="24998-151">To keep things simple for this example, only the application version number was updated in the WordCountV2 application package created in the prerequisites.</span></span> <span data-ttu-id="24998-152">Uno scenario più realistico comporta l'aggiornamento dei file di codice, configurazione o dati del servizio e la ricompilazione e creazione del pacchetto dell'applicazione con i numeri di versione aggiornati.</span><span class="sxs-lookup"><span data-stu-id="24998-152">A more realistic scenario would involve updating your service code, configuration, or data files and then rebuilding and packaging the application with updated version numbers.</span></span>  

### <a name="step-1-upload-the-updated-application-package"></a><span data-ttu-id="24998-153">Passaggio 1: Caricare il pacchetto dell'applicazione aggiornato</span><span class="sxs-lookup"><span data-stu-id="24998-153">Step 1: Upload the updated application package</span></span>
<span data-ttu-id="24998-154">L'applicazione di V1 WordCount è pronta per l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="24998-154">The WordCount v1 application is ready to be upgraded.</span></span> <span data-ttu-id="24998-155">Se si apre una finestra di PowerShell come amministratore e si digita [**Get-ServiceFabricApplication**](/powershell/module/servicefabric/get-servicefabricapplication?view=azureservicefabricps), si noterà che è stata distribuita la versione 1.0.0 del tipo di applicazione WordCount.</span><span class="sxs-lookup"><span data-stu-id="24998-155">If you open up a PowerShell window as administrator and type [**Get-ServiceFabricApplication**](/powershell/module/servicefabric/get-servicefabricapplication?view=azureservicefabricps), you see that version 1.0.0 of the WordCount application type is deployed.</span></span>  

<span data-ttu-id="24998-156">Copiare ora il pacchetto dell'applicazione aggiornato nell'archivio immagini di Service Fabric (dove Service Fabric archivia i pacchetti dell'applicazione).</span><span class="sxs-lookup"><span data-stu-id="24998-156">Now copy the updated application package to the Service Fabric image store (where the application packages are stored by Service Fabric).</span></span> <span data-ttu-id="24998-157">Il parametro **ApplicationPackagePathInImageStore** indica a Service Fabric dove è contenuto il pacchetto applicazione.</span><span class="sxs-lookup"><span data-stu-id="24998-157">The parameter **ApplicationPackagePathInImageStore** informs Service Fabric where it can find the application package.</span></span> <span data-ttu-id="24998-158">Il comando seguente copia il pacchetto dell'applicazione in **WordCountV2** nell'archivio immagini:</span><span class="sxs-lookup"><span data-stu-id="24998-158">The following command copies the application package to **WordCountV2** in the image store:</span></span>  

```powershell
Copy-ServiceFabricApplicationPackage C:\Temp\WordCountV2\ -ImageStoreConnectionString file:C:\SfDevCluster\Data\ImageStoreShare -ApplicationPackagePathInImageStore WordCountV2

```
### <a name="step-2-register-the-updated-application-type"></a><span data-ttu-id="24998-159">Passaggio 2: Registrare il tipo di applicazione aggiornato</span><span class="sxs-lookup"><span data-stu-id="24998-159">Step 2: Register the updated application type</span></span>
<span data-ttu-id="24998-160">Il passaggio successivo consiste nel registrare la nuova versione dell'applicazione con Service Fabric usando il cmdlet [Register-ServiceFabricApplicationType](/powershell/module/servicefabric/register-servicefabricapplicationtype?view=azureservicefabricps):</span><span class="sxs-lookup"><span data-stu-id="24998-160">The next step is to register the new version of the application with Service Fabric, which can be performed by using the [Register-ServiceFabricApplicationType](/powershell/module/servicefabric/register-servicefabricapplicationtype?view=azureservicefabricps) cmdlet:</span></span>

```powershell
Register-ServiceFabricApplicationType WordCountV2
```

### <a name="step-3-start-the-upgrade"></a><span data-ttu-id="24998-161">Passaggio 3: Avviare l'aggiornamento</span><span class="sxs-lookup"><span data-stu-id="24998-161">Step 3: Start the upgrade</span></span>
<span data-ttu-id="24998-162">Vari parametri di aggiornamento, timeout e criteri di integrità possono essere applicati agli aggiornamenti dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="24998-162">Various upgrade parameters, timeouts, and health criteria can be applied to application upgrades.</span></span> <span data-ttu-id="24998-163">Per altre informazioni, leggere [Parametri di aggiornamento dell'applicazione](service-fabric-application-upgrade-parameters.md) e [Processo di aggiornamento](service-fabric-application-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="24998-163">Read through the [application upgrade parameters](service-fabric-application-upgrade-parameters.md) and [upgrade process](service-fabric-application-upgrade.md) documents to learn more.</span></span> <span data-ttu-id="24998-164">Tutti i servizi e le istanze devono essere *integri* dopo l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="24998-164">All services and instances should be *healthy* after the upgrade.</span></span>  <span data-ttu-id="24998-165">Impostare il valore di **HealthCheckStableDuration** su 60 secondi, in modo che i servizi siano integri per almeno 20 secondi prima che il processo di aggiornamento passi al dominio di aggiornamento successivo.</span><span class="sxs-lookup"><span data-stu-id="24998-165">Set the **HealthCheckStableDuration** to 60 seconds (so that the services are healthy for at least 20 seconds before the upgrade proceeds to the next upgrade domain).</span></span>  <span data-ttu-id="24998-166">Impostare inoltre **UpgradeDomainTimeout** su 1200 secondi e **UpgradeTimeout** su 3000 secondi.</span><span class="sxs-lookup"><span data-stu-id="24998-166">Also set the **UpgradeDomainTimeout** to 1200 seconds and the **UpgradeTimeout** to 3000 seconds.</span></span> <span data-ttu-id="24998-167">Infine, impostare **UpgradeFailureAction** per eseguire il **rollback**, operazione che richiede che Service Fabric esegua il rollback dell'applicazione alla versione precedente, se vengono rilevati errori durante l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="24998-167">Finally, set the **UpgradeFailureAction** to **rollback**, which requests that Service Fabric rolls back the application to the previous version if failures are encountered during upgrade.</span></span>

<span data-ttu-id="24998-168">È ora possibile avviare l'aggiornamento dell'applicazione usando il cmdlet [Start-ServiceFabricApplicationUpgrade](/powershell/module/servicefabric/start-servicefabricapplicationupgrade?view=azureservicefabricps):</span><span class="sxs-lookup"><span data-stu-id="24998-168">You can now start the application upgrade by using the [Start-ServiceFabricApplicationUpgrade](/powershell/module/servicefabric/start-servicefabricapplicationupgrade?view=azureservicefabricps) cmdlet:</span></span>

```powershell
Start-ServiceFabricApplicationUpgrade -ApplicationName fabric:/WordCount -ApplicationTypeVersion 2.0.0 -HealthCheckStableDurationSec 60 -UpgradeDomainTimeoutSec 1200 -UpgradeTimeout 3000  -FailureAction Rollback -Monitored
```

<span data-ttu-id="24998-169">Si noti che il nome dell'applicazione è uguale al nome dell'applicazione v1.0.0 distribuita in precedenza (fabric:/WordCount).</span><span class="sxs-lookup"><span data-stu-id="24998-169">Note that the application name is the same as the previously deployed v1.0.0 application name (fabric:/WordCount).</span></span> <span data-ttu-id="24998-170">Service Fabric usa questo nome per identificare l'applicazione che viene aggiornata.</span><span class="sxs-lookup"><span data-stu-id="24998-170">Service Fabric uses this name to identify which application is getting upgraded.</span></span> <span data-ttu-id="24998-171">Se si imposta un valore di timeout troppo breve, è possibile che venga visualizzato un messaggio di errore di timeout che indica il problema.</span><span class="sxs-lookup"><span data-stu-id="24998-171">If you set the time-outs to be too short, you might encounter a time-out failure message that states the problem.</span></span> <span data-ttu-id="24998-172">Fare riferimento a [Risolvere i problemi degli aggiornamenti dell'applicazione](service-fabric-application-upgrade-troubleshooting.md)o aumentare i timeout.</span><span class="sxs-lookup"><span data-stu-id="24998-172">Refer to [Troubleshoot application upgrades](service-fabric-application-upgrade-troubleshooting.md), or increase the time-outs.</span></span>

### <a name="step-4-check-upgrade-progress"></a><span data-ttu-id="24998-173">Passaggio 4: Verificare lo stato dell'aggiornamento</span><span class="sxs-lookup"><span data-stu-id="24998-173">Step 4: Check upgrade progress</span></span>
<span data-ttu-id="24998-174">È possibile monitorare lo stato dell'aggiornamento dell'applicazione usando [Service Fabric Explorer](service-fabric-visualizing-your-cluster.md) oppure il cmdlet [Get-ServiceFabricApplicationUpgrade](/powershell/module/servicefabric/get-servicefabricapplicationupgrade?view=azureservicefabricps):</span><span class="sxs-lookup"><span data-stu-id="24998-174">You can monitor application upgrade progress by using [Service Fabric Explorer](service-fabric-visualizing-your-cluster.md), or by using the [Get-ServiceFabricApplicationUpgrade](/powershell/module/servicefabric/get-servicefabricapplicationupgrade?view=azureservicefabricps) cmdlet:</span></span>

```powershell
Get-ServiceFabricApplicationUpgrade fabric:/WordCount
```

<span data-ttu-id="24998-175">In pochi minuti, il cmdlet [Get-ServiceFabricApplicationUpgrade](/powershell/module/servicefabric/get-servicefabricapplicationupgrade?view=azureservicefabricps) indica che tutti i domini di aggiornamento sono stati aggiornati (completati).</span><span class="sxs-lookup"><span data-stu-id="24998-175">In a few minutes, the [Get-ServiceFabricApplicationUpgrade](/powershell/module/servicefabric/get-servicefabricapplicationupgrade?view=azureservicefabricps) cmdlet shows that all upgrade domains were upgraded (completed).</span></span>

## <a name="task-test-a-service-fabric-application"></a><span data-ttu-id="24998-176">Attività: Testare un'applicazione di Service Fabric</span><span class="sxs-lookup"><span data-stu-id="24998-176">Task: Test a Service Fabric application</span></span>
<span data-ttu-id="24998-177">Per scrivere servizi di qualità elevata, gli sviluppatori devono essere in grado di mettere alla prova i difetti di un'infrastruttura inaffidabile per testarne la stabilità dei servizi.</span><span class="sxs-lookup"><span data-stu-id="24998-177">To write high-quality services, developers need to be able to induce unreliable infrastructure faults to test the stability of their services.</span></span> <span data-ttu-id="24998-178">Service Fabric offre agli sviluppatori la possibilità di causare azioni di errore e testare i servizi in presenza di errori usando gli scenari di test chaos e failover.</span><span class="sxs-lookup"><span data-stu-id="24998-178">Service Fabric gives developers the ability to induce fault actions and test services in the presence of failures by using the chaos and failover test scenarios.</span></span>  <span data-ttu-id="24998-179">Per altre informazioni, vedere [Introduzione al servizio di analisi degli errori](service-fabric-testability-overview.md).</span><span class="sxs-lookup"><span data-stu-id="24998-179">Read through [Introduction to the Fault Analysis Service](service-fabric-testability-overview.md) for additional information.</span></span>

### <a name="step-1-run-the-chaos-test-scenario"></a><span data-ttu-id="24998-180">Passaggio 1: Eseguire lo scenario di test chaos</span><span class="sxs-lookup"><span data-stu-id="24998-180">Step 1: Run the chaos test scenario</span></span>
<span data-ttu-id="24998-181">Lo scenario di test chaos genera errori nell'intero cluster di Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="24998-181">The chaos test scenario generates faults across the entire Service Fabric cluster.</span></span> <span data-ttu-id="24998-182">Lo scenario comprime in alcune ore gli errori che in genere si osservano in mesi o anni.</span><span class="sxs-lookup"><span data-stu-id="24998-182">The scenario compresses faults generally seen over months or years to a few hours.</span></span> <span data-ttu-id="24998-183">La combinazione di errori interfoliati con la frequenza di errori elevata consente di trovare casi limite che altrimenti non verrebbero considerati.</span><span class="sxs-lookup"><span data-stu-id="24998-183">The combination of interleaved faults with a high fault rate finds corner cases that would otherwise be missed.</span></span> <span data-ttu-id="24998-184">Nell'esempio seguente viene eseguito lo scenario di test chaos per 60 minuti.</span><span class="sxs-lookup"><span data-stu-id="24998-184">The following example runs the chaos test scenario for 60 minutes.</span></span>

```powershell
$timeToRun = 60
$maxStabilizationTimeSecs = 180
$concurrentFaults = 3
$waitTimeBetweenIterationsSec = 60

Invoke-ServiceFabricChaosTestScenario -TimeToRunMinute $timeToRun -MaxClusterStabilizationTimeoutSec $maxStabilizationTimeSecs -MaxConcurrentFaults $concurrentFaults -EnableMoveReplicaFaults -WaitTimeBetweenIterationsSec $waitTimeBetweenIterationsSec
```

### <a name="step-2-run-the-failover-test-scenario"></a><span data-ttu-id="24998-185">Passaggio 2: Eseguire lo scenario di test di failover</span><span class="sxs-lookup"><span data-stu-id="24998-185">Step 2: Run the failover test scenario</span></span>
<span data-ttu-id="24998-186">Lo scenario di test failover usa come destinazione la partizione di un servizio specifico, anziché l'intero cluster, e lascia inalterati altri servizi.</span><span class="sxs-lookup"><span data-stu-id="24998-186">The failover test scenario targets a specific service partition instead of the entire cluster, and it leaves other services unaffected.</span></span> <span data-ttu-id="24998-187">Lo scenario ripete una sequenza di errori simulati nella convalida del servizio, mentre viene eseguita la logica di business.</span><span class="sxs-lookup"><span data-stu-id="24998-187">The scenario iterates through a sequence of simulated faults in service validation while your business logic runs.</span></span> <span data-ttu-id="24998-188">Un errore nella convalida del servizio indica un problema necessita di ulteriore analisi.</span><span class="sxs-lookup"><span data-stu-id="24998-188">A failure in service validation indicates an issue that needs further investigation.</span></span> <span data-ttu-id="24998-189">Il test failover provoca solo un errore alla volta, a differenza dello scenario di test caos, che può provocare più errori.</span><span class="sxs-lookup"><span data-stu-id="24998-189">The failover test induces only one fault at a time, as opposed to the chaos test scenario, which can induce multiple faults.</span></span> <span data-ttu-id="24998-190">L'esempio seguente esegue il test di failover per 60 minuti sull'infrastruttura: servizio /WordCount/WordCountService.</span><span class="sxs-lookup"><span data-stu-id="24998-190">The following example runs the failover test for 60 minutes against the fabric:/WordCount/WordCountService service.</span></span>

```powershell
$timeToRun = 60
$maxStabilizationTimeSecs = 180
$waitTimeBetweenFaultsSec = 10
$serviceName = "fabric:/WordCount/WordCountService"

Invoke-ServiceFabricFailoverTestScenario -TimeToRunMinute $timeToRun -MaxServiceStabilizationTimeoutSec $maxStabilizationTimeSecs -WaitTimeBetweenFaultsSec $waitTimeBetweenFaultsSec -ServiceName $serviceName -PartitionKindUniformInt64 -PartitionKey 1
```

## <a name="task-remove-a-service-fabric-application"></a><span data-ttu-id="24998-191">Attività: Rimuovere un'applicazione di Service Fabric</span><span class="sxs-lookup"><span data-stu-id="24998-191">Task: Remove a Service Fabric application</span></span>
<span data-ttu-id="24998-192">È possibile eliminare un'istanza di un'applicazione distribuita, rimuovere il tipo di applicazione fornito dal cluster e rimuovere il pacchetto dell’applicazione dall’ImageStore.</span><span class="sxs-lookup"><span data-stu-id="24998-192">You can delete an instance of a deployed application, remove the provisioned application type from the cluster, and remove the application package from the ImageStore.</span></span>

### <a name="step-1-remove-an-application-instance"></a><span data-ttu-id="24998-193">Passaggio 1: Rimuovere un'istanza dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="24998-193">Step 1: Remove an application instance</span></span>
<span data-ttu-id="24998-194">Quando un'istanza dell'applicazione non è più necessaria, è possibile rimuoverla definitivamente usando il cmdlet [Remove-ServiceFabricApplication](/powershell/module/servicefabric/remove-servicefabricapplication?view=azureservicefabricps).</span><span class="sxs-lookup"><span data-stu-id="24998-194">When an application instance is no longer needed, you can permanently remove it by using the [Remove-ServiceFabricApplication](/powershell/module/servicefabric/remove-servicefabricapplication?view=azureservicefabricps) cmdlet.</span></span> <span data-ttu-id="24998-195">In questo modo vengono rimossi automaticamente anche tutti i servizi appartenenti all'applicazione, nonché il relativo stato di servizio.</span><span class="sxs-lookup"><span data-stu-id="24998-195">This also automatically removes all services belonging to the application, permanently removing all service state.</span></span> <span data-ttu-id="24998-196">Tale operazione non può essere annullata e lo stato dell'applicazione non può essere recuperato.</span><span class="sxs-lookup"><span data-stu-id="24998-196">This operation cannot be reversed and application state cannot be recovered.</span></span>

```powershell
Remove-ServiceFabricApplication fabric:/WordCount
```

### <a name="step-2-unregister-the-application-type"></a><span data-ttu-id="24998-197">Passaggio 2: Annullare la registrazione del tipo di applicazione.</span><span class="sxs-lookup"><span data-stu-id="24998-197">Step 2: Unregister the application type</span></span>
<span data-ttu-id="24998-198">Quando una determinata versione di un tipo di applicazione non è più necessaria, è possibile annullarne la registrazione usando il cmdlet [Unregister-ServiceFabricApplicationType](/powershell/module/servicefabric/unregister-servicefabricapplicationtype?view=azureservicefabricps).</span><span class="sxs-lookup"><span data-stu-id="24998-198">When you no longer need a particular version of an application type, unregister it by using the [Unregister-ServiceFabricApplicationType](/powershell/module/servicefabric/unregister-servicefabricapplicationtype?view=azureservicefabricps) cmdlet.</span></span> <span data-ttu-id="24998-199">L'annullamento della registrazione dei tipi inutilizzati rilascia lo spazio di archiviazione utilizzato dal pacchetto dell'applicazione nell'archivio immagini.</span><span class="sxs-lookup"><span data-stu-id="24998-199">Unregistering unused types releases storage space used by the application package in the image store.</span></span> <span data-ttu-id="24998-200">È possibile annullare la registrazione di un tipo di applicazione solo se non sono state create istanze di applicazioni basate su di esso o non vi sono aggiornamenti di applicazioni in sospeso che vi fanno riferimento.</span><span class="sxs-lookup"><span data-stu-id="24998-200">An application type can be unregistered as long as there are no applications instantiated against it or pending application upgrades referencing it.</span></span>

```powershell
Unregister-ServiceFabricApplicationType WordCount 1.0.0
```

### <a name="step-3-remove-the-application-package"></a><span data-ttu-id="24998-201">Passaggio 3: Rimuovere il pacchetto dell’applicazione</span><span class="sxs-lookup"><span data-stu-id="24998-201">Step 3: Remove the application package</span></span>
<span data-ttu-id="24998-202">Dopo aver annullato la registrazione del tipo di applicazione, il pacchetto dell'applicazione può essere rimosso dall'archivio servizi usando il cmdlet [Remove-ServiceFabricApplicationPackage](/powershell/module/servicefabric/remove-servicefabricapplicationpackage?view=azureservicefabricps).</span><span class="sxs-lookup"><span data-stu-id="24998-202">After the application type is unregistered, the application package can be removed from the image store by using the [Remove-ServiceFabricApplicationPackage](/powershell/module/servicefabric/remove-servicefabricapplicationpackage?view=azureservicefabricps) cmdlet.</span></span>

```powershell
Remove-ServiceFabricApplicationPackage -ImageStoreConnectionString file:C:\SfDevCluster\Data\ImageStoreShare -ApplicationPackagePathInImageStore WordCount
```

## <a name="next-steps"></a><span data-ttu-id="24998-203">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="24998-203">Next steps</span></span>
[<span data-ttu-id="24998-204">Ciclo di vita dell'applicazione Service Fabric</span><span class="sxs-lookup"><span data-stu-id="24998-204">Service Fabric application lifecycle</span></span>](service-fabric-application-lifecycle.md)

[<span data-ttu-id="24998-205">Distribuire un'applicazione</span><span class="sxs-lookup"><span data-stu-id="24998-205">Deploy an application</span></span>](service-fabric-deploy-remove-applications.md)

[<span data-ttu-id="24998-206">Aggiornamento dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="24998-206">Application upgrade</span></span>](service-fabric-application-upgrade.md)

[<span data-ttu-id="24998-207">Cmdlet di Service Fabric di Azure</span><span class="sxs-lookup"><span data-stu-id="24998-207">Azure Service Fabric cmdlets</span></span>](/powershell/azure/overview?view=azureservicefabricps)

