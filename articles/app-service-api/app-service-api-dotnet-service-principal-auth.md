---
title: l'autenticazione principale per App per le API in Azure App Service aaaService | Documenti Microsoft
description: Informazioni su come app tooprotect un'API in Azure App Service per gli scenari servizio-servizio.
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 94d9ee11f38293df4a2fd815ef02c59cc6defed4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="47921-103">Autenticazione dell'entità servizio per app per le API nel servizio app di Azure</span><span class="sxs-lookup"><span data-stu-id="47921-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="47921-104">Panoramica</span><span class="sxs-lookup"><span data-stu-id="47921-104">Overview</span></span>
<span data-ttu-id="47921-105">Questo articolo viene illustrato come l'autenticazione di servizio App toouse per *interno* accedere alle App tooAPI.</span><span class="sxs-lookup"><span data-stu-id="47921-105">This article explains how toouse App Service authentication for *internal* access tooAPI apps.</span></span> <span data-ttu-id="47921-106">Uno scenario interno è in cui si dispone di un'app di API che si desidera toobe utilizzabile solo dal codice dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="47921-106">An internal scenario is where you have an API app that you want toobe consumable only by your own application code.</span></span> <span data-ttu-id="47921-107">Hello consigliato tooimplement modo questo scenario nel servizio App è hello tooprotect toouse AD Azure chiamato app per le API.</span><span class="sxs-lookup"><span data-stu-id="47921-107">hello recommended way tooimplement this scenario in App Service is toouse Azure AD tooprotect hello called API app.</span></span> <span data-ttu-id="47921-108">Chiamare app per le API hello protetto con un token di connessione che si ottiene da Azure AD, fornendo le credenziali (entità servizio) di identità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="47921-108">You call hello protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="47921-109">Per alternative toousing Azure AD, vedere hello **authentication Service to service** sezione di hello [panoramica dell'autenticazione del servizio App di Azure](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span><span class="sxs-lookup"><span data-stu-id="47921-109">For alternatives toousing Azure AD, see hello **Service-to-service authentication** section of hello [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="47921-110">In questo articolo si apprenderà:</span><span class="sxs-lookup"><span data-stu-id="47921-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="47921-111">Accesso non autenticato come toouse Azure Active Directory (Azure AD) tooprotect un'API dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="47921-111">How toouse Azure Active Directory (Azure AD) tooprotect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="47921-112">Modalità app tooconsume un'API protetta da un'app per le API, app web o app per dispositivi mobili utilizzando le credenziali di identità (identità applicazione) del servizio di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47921-112">How tooconsume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="47921-113">Per informazioni su come tooconsume da un'app di logica, vedere [utilizzando l'API personalizzata ospitato nel servizio App con la logica app](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="47921-113">For information about how tooconsume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="47921-114">Come toomake che tale hello protetto app per le API non può essere chiamato da un browser, gli utenti collegati.</span><span class="sxs-lookup"><span data-stu-id="47921-114">How toomake sure that hello protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="47921-115">Come si toomake che tale hello protetto app per le API possa solo essere chiamato da uno specifico dell'entità servizio di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47921-115">How toomake sure that hello protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="47921-116">Hello articolo sono contenute due sezioni:</span><span class="sxs-lookup"><span data-stu-id="47921-116">hello article contains two sections:</span></span>

* <span data-ttu-id="47921-117">Hello [come tooconfigure servizio di autenticazione principale in Azure App Service](#authconfig) sezione viene illustrato in generale come autenticazione tooconfigure per qualsiasi app per le API e come tooconsume hello protetto app per le API.</span><span class="sxs-lookup"><span data-stu-id="47921-117">hello [How tooconfigure service principal authentication in Azure App Service](#authconfig) section explains in general how tooconfigure authentication for any API app, and how tooconsume hello protected API app.</span></span> <span data-ttu-id="47921-118">In questa sezione si applica equamente tooall Framework supportato dal servizio App, inclusi .NET, Node.js e Java.</span><span class="sxs-lookup"><span data-stu-id="47921-118">This section applies equally tooall frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="47921-119">A partire da hello [continuare esercitazioni su Guida introduttiva di .NET hello](#tutorialstart) sezione hello esercitazione viene illustrato uno scenario di "accesso interno" per un'applicazione di esempio .NET in esecuzione nel servizio App di configurazione.</span><span class="sxs-lookup"><span data-stu-id="47921-119">Starting with hello [Continuing hello .NET getting-started tutorials](#tutorialstart) section, hello tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="47921-120"><a id="authconfig"></a>Come tooconfigure servizio di autenticazione principale in Azure App Service</span><span class="sxs-lookup"><span data-stu-id="47921-120"><a id="authconfig"></a> How tooconfigure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="47921-121">In questa sezione fornisce istruzioni generali valide tooany API app.</span><span class="sxs-lookup"><span data-stu-id="47921-121">This section provides general instructions that apply tooany API app.</span></span> <span data-ttu-id="47921-122">Per passaggi specifici toohello tooDo applicazione di esempio elenco .NET, andare troppo[continuare serie di esercitazioni di App per le API .NET di hello](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="47921-122">For steps specific toohello tooDo List .NET sample application, go too[Continuing hello .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="47921-123">In hello [portale di Azure](https://portal.azure.com/), passare toohello **impostazioni** pannello App hello API che si desidera tooprotect e quindi trovare hello **funzionalità** sezione e fare clic su **Autenticazione / autorizzazione**.</span><span class="sxs-lookup"><span data-stu-id="47921-123">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you want tooprotect, and then find hello **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Autenticazione/Autorizzazione nel portale di Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="47921-125">In hello **autenticazione / autorizzazione** pannello, fare clic su **su**.</span><span class="sxs-lookup"><span data-stu-id="47921-125">In hello **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="47921-126">In hello **tootake azione quando la richiesta non è autenticata** elenco a discesa, seleziona **Accedi con Azure Active Directory** .</span><span class="sxs-lookup"><span data-stu-id="47921-126">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="47921-127">In **Provider di autenticazione** fare clic su **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="47921-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Pannello Autenticazione/Autorizzazione nel portale di Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="47921-129">Configurare hello **impostazioni di Azure Active Directory** pannello toocreate una nuova versione di Azure AD applicazione o utilizzare un'applicazione Azure AD esistente se si dispone già di uno che si desidera toouse.</span><span class="sxs-lookup"><span data-stu-id="47921-129">Configure hello **Azure Active Directory Settings** blade toocreate a new Azure AD application, or use an existing Azure AD application if you already have one that you want toouse.</span></span>
   
    <span data-ttu-id="47921-130">Gli scenari interni in genere comprendono un'app per le API che chiama un'app per le API.</span><span class="sxs-lookup"><span data-stu-id="47921-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="47921-131">È possibile usare applicazioni Azure AD separate per ogni app per le API o una sola applicazione Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47921-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="47921-132">Per istruzioni dettagliate su questo pannello, vedere [come tooconfigure l'accesso di Azure Active Directory di servizio App applicazione toouse](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="47921-132">For detailed instructions on this blade, see [How tooconfigure your App Service application toouse Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="47921-133">Al pannello di configurazione del provider di autenticazione hello termine, fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="47921-133">When you're done with hello authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="47921-134">In hello **autenticazione / autorizzazione** pannello, fare clic su **salvare**.</span><span class="sxs-lookup"><span data-stu-id="47921-134">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Fare clic su Salva.](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="47921-136">Quando questa operazione viene eseguita, servizio App consente solo le richieste dai chiamanti nel tenant di Azure AD hello configurato.</span><span class="sxs-lookup"><span data-stu-id="47921-136">When this is done, App Service only allows requests from callers in hello configured Azure AD tenant.</span></span> <span data-ttu-id="47921-137">In app per le API hello protetto, non è necessario alcun codice di autenticazione o autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="47921-137">No authentication or authorization code is required in hello protected API app.</span></span> <span data-ttu-id="47921-138">Hello token di connessione viene passato toohello API app insieme attestazioni comunemente utilizzate nelle intestazioni HTTP, ed è possibile leggere le informazioni nel codice toovalidate che sono richieste da un chiamante specifico, ad esempio un'entità servizio.</span><span class="sxs-lookup"><span data-stu-id="47921-138">hello bearer token is passed toohello API app along with commonly used claims in HTTP headers, and you can read that information in code toovalidate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="47921-139">Questa funzionalità di autenticazione funziona hello allo stesso modo per tutte le lingue che il servizio App supporta, tra cui .NET, Node.js e Java.</span><span class="sxs-lookup"><span data-stu-id="47921-139">This authentication functionality works hello same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-tooconsume-hello-protected-api-app"></a><span data-ttu-id="47921-140">Modalità di protezione delle app per le API tooconsume hello</span><span class="sxs-lookup"><span data-stu-id="47921-140">How tooconsume hello protected API app</span></span>
<span data-ttu-id="47921-141">chiamante Hello è necessario fornire un token di connessione di Azure AD con le chiamate API.</span><span class="sxs-lookup"><span data-stu-id="47921-141">hello caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="47921-142">tooget un token di connessione utilizzando le credenziali dell'entità servizio, il chiamante di hello utilizza Active Directory Authentication Library (ADAL per [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), o [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="47921-142">tooget a bearer token using service principal credentials, hello caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="47921-143">tooget un token, codice hello che chiama ADAL fornisce hello tooADAL le seguenti informazioni:</span><span class="sxs-lookup"><span data-stu-id="47921-143">tooget a token, hello code that calls ADAL provides tooADAL hello following information:</span></span>

* <span data-ttu-id="47921-144">nome Hello del tenant di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47921-144">hello name of your Azure AD tenant.</span></span>
* <span data-ttu-id="47921-145">Hello client ID e client segreto (chiave app) di app hello Azure AD associata al chiamante di hello.</span><span class="sxs-lookup"><span data-stu-id="47921-145">hello client ID and client secret (app key) of hello Azure AD app associated with hello caller.</span></span>
* <span data-ttu-id="47921-146">ID client Hello di applicazione di Azure AD associata hello hello protetto app per le API.</span><span class="sxs-lookup"><span data-stu-id="47921-146">hello client ID of hello Azure AD application associated with hello protected API app.</span></span> <span data-ttu-id="47921-147">(Se viene utilizzata una sola applicazione di Azure AD, questo è hello lo stesso ID client come hello uno per il chiamante di hello.)</span><span class="sxs-lookup"><span data-stu-id="47921-147">(If just one Azure AD application is used, this is hello same client ID as hello one for hello caller.)</span></span>

<span data-ttu-id="47921-148">Questi valori sono disponibili nelle pagine di hello Azure AD di hello [portale di Azure classico](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="47921-148">These values are available in hello Azure AD pages of hello [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="47921-149">Dopo che sono stati acquisiti i token hello, chiamante hello sono incluse le richieste HTTP nell'intestazione di autorizzazione hello.</span><span class="sxs-lookup"><span data-stu-id="47921-149">Once hello token has been acquired, hello caller includes it with HTTP requests in hello Authorization header.</span></span>  <span data-ttu-id="47921-150">Servizio App convalida token hello e consente di hello tooreach le richieste di hello protetto app per le API.</span><span class="sxs-lookup"><span data-stu-id="47921-150">App Service validates hello token and allows hello requests tooreach hello protected API app.</span></span>

#### <a name="how-tooprotect-hello-api-app-from-access-by-users-in-hello-same-tenant"></a><span data-ttu-id="47921-151">Modalità app hello API tooprotect dall'accesso di utenti in hello stesso tenant</span><span class="sxs-lookup"><span data-stu-id="47921-151">How tooprotect hello API app from access by users in hello same tenant</span></span>
<span data-ttu-id="47921-152">I token di connessione per gli utenti di hello stesso tenant sono considerati validi per hello protetto app per le API.</span><span class="sxs-lookup"><span data-stu-id="47921-152">Bearer tokens for users in hello same tenant are considered valid for hello protected API app.</span></span>  <span data-ttu-id="47921-153">Se si desidera tooensure che è possibile chiamare solo un'entità di servizio app API protetta hello, aggiungere il codice in hello protetto hello di toovalidate API app seguendo le attestazioni del token hello:</span><span class="sxs-lookup"><span data-stu-id="47921-153">If you want tooensure that only a service principal can call hello protected API app, add code in hello protected API app toovalidate hello following claims from hello token:</span></span>

* <span data-ttu-id="47921-154">`appid`deve essere l'ID client hello di un'applicazione hello Azure AD associata al chiamante di hello.</span><span class="sxs-lookup"><span data-stu-id="47921-154">`appid` should be hello client ID of hello Azure AD application that is associated with hello caller.</span></span> 
* <span data-ttu-id="47921-155">`oid`(`objectidentifier`) deve essere l'ID di entità servizio hello del chiamante hello.</span><span class="sxs-lookup"><span data-stu-id="47921-155">`oid` (`objectidentifier`) should be hello service principal ID of hello caller.</span></span> 

<span data-ttu-id="47921-156">Servizio App fornisce anche hello `objectidentifier` attestazione nell'intestazione X-MS-CLIENT--ID entità hello.</span><span class="sxs-lookup"><span data-stu-id="47921-156">App Service also provides hello `objectidentifier` claim in hello X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-tooprotect-hello-api-app-from-browser-access"></a><span data-ttu-id="47921-157">Come tooprotect hello app per le API di accesso del browser</span><span class="sxs-lookup"><span data-stu-id="47921-157">How tooprotect hello API app from browser access</span></span>
<span data-ttu-id="47921-158">Se si non convalida le attestazioni presenti nel codice di app per le API hello protetti e, se si utilizza un oggetto separato applicazione Azure AD per hello protetto API app, assicurarsi che tale hello URL di risposta dell'applicazione Azure AD è hello non uguali a quelli hello URL di base dell'app per le API.</span><span class="sxs-lookup"><span data-stu-id="47921-158">If you don't validate claims in code in hello protected API app, and if you use a separate Azure AD application for hello protected API app, make sure that hello Azure AD application's Reply URL is not hello same as hello API app's base URL.</span></span> <span data-ttu-id="47921-159">Se hello URL di risposta punta direttamente app per le API toohello protetto, un utente nel tenant di hello stesso Azure Active Directory potrebbe individuare app per le API toohello, accedere e chiamare correttamente hello API.</span><span class="sxs-lookup"><span data-stu-id="47921-159">If hello Reply URL points directly toohello protected API app, a user in hello same Azure AD tenant could browse toohello API app, log on, and successfully call hello API.</span></span>

## <span data-ttu-id="47921-160"><a id="tutorialstart"></a>Serie di esercitazioni di hello App per le API .NET di continuare</span><span class="sxs-lookup"><span data-stu-id="47921-160"><a id="tutorialstart"></a> Continuing hello .NET API Apps tutorial series</span></span>
<span data-ttu-id="47921-161">Se si segue hello Node.js o Java serie di esercitazioni per App per le API, ignorare toohello [passaggi successivi](#next-steps) sezione.</span><span class="sxs-lookup"><span data-stu-id="47921-161">If you are following hello Node.js or Java tutorial series for API apps, skip toohello [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="47921-162">resto Hello di questo articolo continua serie di esercitazioni di App per le API .NET di hello e si presuppone che siano state completate hello [esercitazione autenticazione utente](app-service-api-dotnet-user-principal-auth.md) e applicazione di esempio hello in esecuzione in Azure con l'autenticazione utente abilitata.</span><span class="sxs-lookup"><span data-stu-id="47921-162">hello remainder of this article continues hello .NET API Apps tutorial series and assumes that you have completed hello [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have hello sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="47921-163">Configurare l'autenticazione in Azure</span><span class="sxs-lookup"><span data-stu-id="47921-163">Set up authentication in Azure</span></span>
<span data-ttu-id="47921-164">In questa sezione Configura servizio App in modo tale hello solo HTTP richiede consente tooreach hello dati livello app per le API sono quelli in cui Azure valido hello i token di connessione Active Directory.</span><span class="sxs-lookup"><span data-stu-id="47921-164">In this section you configure App Service so that hello only HTTP requests it allows tooreach hello data tier API app are hello ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="47921-165">Nella seguente sezione di hello, configurare hello API di livello intermedio app toosend applicazione credenziali tooAzure Active Directory, ottenere un token di connessione e inviare connessione hello toohello token dati livello API app.</span><span class="sxs-lookup"><span data-stu-id="47921-165">In hello following section, you configure hello middle tier API app toosend application credentials tooAzure AD, get back a bearer token, and send hello bearer token toohello data tier API app.</span></span> <span data-ttu-id="47921-166">Questo processo è illustrato nel diagramma di hello.</span><span class="sxs-lookup"><span data-stu-id="47921-166">This process is illustrated in hello diagram.</span></span>

![Diagramma di autenticazione del servizio](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="47921-168">Se si verificano problemi durante le direzioni dell'esercitazione di hello seguenti, vedere hello [Troubleshooting](#troubleshooting) sezione alla fine di hello dell'esercitazione hello.</span><span class="sxs-lookup"><span data-stu-id="47921-168">If you run into problems while following hello tutorial directions, see hello [Troubleshooting](#troubleshooting) section at hello end of hello tutorial.</span></span> 

1. <span data-ttu-id="47921-169">In hello [portale di Azure](https://portal.azure.com/), passare toohello **impostazioni** pannello App hello API creato per app di API hello ToDoListDataAPI (livello di dati) e quindi fare clic su **impostazioni**.</span><span class="sxs-lookup"><span data-stu-id="47921-169">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you created for hello ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="47921-170">In hello **impostazioni** blade, hello trova **funzionalità** sezione e quindi fare clic su **autenticazione / autorizzazione**.</span><span class="sxs-lookup"><span data-stu-id="47921-170">In hello **Settings** blade, find hello **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Autenticazione/Autorizzazione nel portale di Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="47921-172">In hello **autenticazione / autorizzazione** pannello, fare clic su **su**.</span><span class="sxs-lookup"><span data-stu-id="47921-172">In hello **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="47921-173">In hello **tootake azione quando la richiesta non è autenticata** elenco a discesa, seleziona **Accedi con Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="47921-173">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="47921-174">Questo è l'impostazione di hello che causa tooensure di servizio App che ha autenticato solo app per le API hello richieste reach.</span><span class="sxs-lookup"><span data-stu-id="47921-174">This is hello setting that causes App Service tooensure that only authenticated requests reach hello API app.</span></span> <span data-ttu-id="47921-175">Per le richieste che hanno i token di connessione valida, passa il token hello lungo toohello API app servizio App e popola le intestazioni HTTP con toomake attestazioni diffuse informazioni codice tooyour più facilmente disponibile.</span><span class="sxs-lookup"><span data-stu-id="47921-175">For requests that have valid bearer tokens, App Service passes hello tokens along toohello API app and populates HTTP headers with commonly used claims toomake that information more easily available tooyour code.</span></span>
5. <span data-ttu-id="47921-176">In **Provider di autenticazione** fare clic su **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="47921-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Pannello Autenticazione/Autorizzazione nel portale di Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="47921-178">In hello **impostazioni di Azure Active Directory** pannello, fare clic su **Express**.</span><span class="sxs-lookup"><span data-stu-id="47921-178">In hello **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="47921-179">Con hello **Express** opzione Azure è possibile creare automaticamente un'applicazione AAD in Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="47921-179">With hello **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="47921-180">Non è necessario toocreate un tenant, perché ogni account di Azure dispone automaticamente di uno.</span><span class="sxs-lookup"><span data-stu-id="47921-180">You don't have toocreate a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="47921-181">In **Modalità di gestione** fare clic su **Crea nuova app AD** se questa opzione non è già selezionata.</span><span class="sxs-lookup"><span data-stu-id="47921-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="47921-182">portale Hello inserisce hello **creare App** casella di input con un valore predefinito.</span><span class="sxs-lookup"><span data-stu-id="47921-182">hello portal plugs hello **Create App** input box with a default value.</span></span> <span data-ttu-id="47921-183">Per impostazione predefinita, viene denominato hello applicazione AD Azure stesso hello come applicazione hello API.</span><span class="sxs-lookup"><span data-stu-id="47921-183">By default, hello Azure AD application is named hello same as hello API app.</span></span> <span data-ttu-id="47921-184">Se si preferisce, è possibile immettere un nome diverso.</span><span class="sxs-lookup"><span data-stu-id="47921-184">If you prefer, you can enter a different name.</span></span>
   
    ![Impostazioni di Azure AD](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="47921-186">**Nota**: in alternativa, è possibile usare un singola AD Azure dell'applicazione per entrambi hello app per chiamare le API e hello protetti app per le API.</span><span class="sxs-lookup"><span data-stu-id="47921-186">**Note**: As an alternative, you could use a single Azure AD application for both hello calling API app and hello protected API app.</span></span> <span data-ttu-id="47921-187">Se si sceglie tale alternativa, è necessario non hello **Crea nuova App AD** opzione qui perché già stato creato in precedenza nell'esercitazione di autenticazione utente hello un'applicazione Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47921-187">If you chose that alternative, you would not need hello **Create New AD App** option here because you already created an Azure AD application earlier in hello user authentication tutorial.</span></span> <span data-ttu-id="47921-188">Per questa esercitazione, si userà separare applicazioni Azure AD per la chiamata di app per le API e hello hello protetto app per le API.</span><span class="sxs-lookup"><span data-stu-id="47921-188">For this tutorial, you'll use separate Azure AD applications for hello calling API app and hello protected API app.</span></span>
8. <span data-ttu-id="47921-189">Prendere nota del valore di hello in hello **creare App** casella di input; verrà cercato questa applicazione AAD nella hello portale di Azure classico in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="47921-189">Make a note of hello value that is in hello **Create App** input box; you'll look up this AAD application in hello Azure classic portal later.</span></span>
9. <span data-ttu-id="47921-190">Fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="47921-190">Click **OK**.</span></span>
10. <span data-ttu-id="47921-191">In hello **autenticazione / autorizzazione** pannello, fare clic su **salvare**.</span><span class="sxs-lookup"><span data-stu-id="47921-191">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![Fare clic su Salva.](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="47921-193">Servizio App viene creata un'applicazione di Azure Active Directory con **Sign-on URL** e **URL di risposta** impostata automaticamente toohello URL dell'app per le API.</span><span class="sxs-lookup"><span data-stu-id="47921-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set toohello URL of your API app.</span></span> <span data-ttu-id="47921-194">valore di quest'ultimo Hello consente agli utenti nel toolog tenant AAD in e accesso hello API app.</span><span class="sxs-lookup"><span data-stu-id="47921-194">hello latter value enables users in your AAD tenant toolog in and access hello API app.</span></span>

### <a name="verify-that-hello-api-app-is-protected"></a><span data-ttu-id="47921-195">Verificare che app hello API sia protetto</span><span class="sxs-lookup"><span data-stu-id="47921-195">Verify that hello API app is protected</span></span>
1. <span data-ttu-id="47921-196">In un browser andare toohello URL dell'app hello API: in hello **app per le API** pannello in hello portale di Azure, fare clic su collegamento hello in **URL**.</span><span class="sxs-lookup"><span data-stu-id="47921-196">In a browser go toohello URL of hello API app: in hello **API app** blade in hello Azure portal, click hello link under **URL**.</span></span> 
   
    <span data-ttu-id="47921-197">Si è reindirizzato tooa schermata di accesso perché le richieste non autenticate non sono consentite tooreach hello API app.</span><span class="sxs-lookup"><span data-stu-id="47921-197">You are redirected tooa login screen because unauthenticated requests are not allowed tooreach hello API app.</span></span> 
   
    <span data-ttu-id="47921-198">Se il browser passare toohello Swagger dell'interfaccia utente, il browser potrebbe già essere connessi - in questo caso, aprire una finestra InPrivate o Incognito e passare toohello URL Swagger di interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="47921-198">If your browser does go toohello Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go toohello Swagger UI URL.</span></span>
2. <span data-ttu-id="47921-199">Accedere con le credenziali di un utente che appartiene al tenant AAD.</span><span class="sxs-lookup"><span data-stu-id="47921-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="47921-200">Quando si accede, hello "completata" pagina viene visualizzata nel browser hello.</span><span class="sxs-lookup"><span data-stu-id="47921-200">When you're logged on, hello "successfully created" page appears in hello browser.</span></span>

## <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="47921-201">Configurare hello ToDoListAPI progetto tooacquire e inviare il token di Azure AD hello</span><span class="sxs-lookup"><span data-stu-id="47921-201">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="47921-202">In questa sezione hello quanto segue:</span><span class="sxs-lookup"><span data-stu-id="47921-202">In this section you do hello following tasks:</span></span>

* <span data-ttu-id="47921-203">Aggiungere codice nell'app di API di livello intermedio hello che utilizza Azure AD applicazione credenziali tooacquire un token e inviare che con HTTP richiede toohello dati livello API app.</span><span class="sxs-lookup"><span data-stu-id="47921-203">Add code in hello middle tier API app that uses Azure AD application credentials tooacquire a token and send it with HTTP requests toohello data tier API app.</span></span>
* <span data-ttu-id="47921-204">Ottenere le credenziali di hello che è necessario da Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47921-204">Get hello credentials you need from Azure AD.</span></span>
* <span data-ttu-id="47921-205">Immettere le credenziali di hello in impostazioni di ambiente di runtime di servizio App di Azure nel livello intermedio hello app per le API.</span><span class="sxs-lookup"><span data-stu-id="47921-205">Enter hello credentials into Azure App Service runtime environment settings in hello middle tier API app.</span></span> 

### <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="47921-206">Configurare hello ToDoListAPI progetto tooacquire e inviare il token di Azure AD hello</span><span class="sxs-lookup"><span data-stu-id="47921-206">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="47921-207">Rendere hello dopo le modifiche apportate hello ToDoListAPI progetto in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="47921-207">Make hello following changes in hello ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="47921-208">Rimuovere il commento tutto il codice hello in hello *ServicePrincipal.cs* file.</span><span class="sxs-lookup"><span data-stu-id="47921-208">Uncomment all of hello code in hello *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="47921-209">Si tratta di codice hello Usa ADAL per i token di connessione .NET tooacquire hello Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47921-209">This is hello code that uses ADAL for .NET tooacquire hello Azure AD bearer token.</span></span>  <span data-ttu-id="47921-210">Usa diversi valori di configurazione che verrà impostata nell'ambiente di runtime Azure hello in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="47921-210">It uses several configuration values that you'll set in hello Azure runtime environment later.</span></span> <span data-ttu-id="47921-211">Ecco il codice hello:</span><span class="sxs-lookup"><span data-stu-id="47921-211">Here's hello code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="47921-212">**Nota:** questo codice richiede hello ADAL per il pacchetto NuGet di .NET (ActiveDirectory), che è già installato nel progetto hello.</span><span class="sxs-lookup"><span data-stu-id="47921-212">**Note:** This code requires hello ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in hello project.</span></span> <span data-ttu-id="47921-213">Se si crea il progetto da zero, sarebbe necessario tooinstall questo pacchetto.</span><span class="sxs-lookup"><span data-stu-id="47921-213">If you were creating this project from scratch, you would have tooinstall this package.</span></span> <span data-ttu-id="47921-214">Questo pacchetto non viene installato automaticamente dal modello nuovo progetto applicazione di hello API.</span><span class="sxs-lookup"><span data-stu-id="47921-214">This package is not automatically installed by hello API app new-project template.</span></span>
2. <span data-ttu-id="47921-215">In *controller/ToDoListController*, rimuovere il commento di codice hello in hello `NewDataAPIClient` metodo che aggiunge le richieste di token tooHTTP hello nell'intestazione di autorizzazione hello.</span><span class="sxs-lookup"><span data-stu-id="47921-215">In *Controllers/ToDoListController*, uncomment hello code in hello `NewDataAPIClient` method that adds hello token tooHTTP requests in hello authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="47921-216">Distribuire il progetto di ToDoListAPI hello.</span><span class="sxs-lookup"><span data-stu-id="47921-216">Deploy hello ToDoListAPI project.</span></span> <span data-ttu-id="47921-217">(Fare clic sul progetto hello, quindi fare clic su **pubblica > Pubblica**.)</span><span class="sxs-lookup"><span data-stu-id="47921-217">(Right-click hello project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="47921-218">Visual Studio distribuisce il progetto hello e apre l'URL di base dell'app di web toohello browser.</span><span class="sxs-lookup"><span data-stu-id="47921-218">Visual Studio deploys hello project and opens a browser toohello web app's base URL.</span></span> <span data-ttu-id="47921-219">Verranno visualizzati una pagina di 403 errore, che è norma per un tentativo di toogo tooa API Web URL di base da un browser.</span><span class="sxs-lookup"><span data-stu-id="47921-219">This will show a 403 error page, which is normal for an attempt toogo tooa Web API base URL from a browser.</span></span>
4. <span data-ttu-id="47921-220">Browser hello Chiudi.</span><span class="sxs-lookup"><span data-stu-id="47921-220">Close hello browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="47921-221">Ottenere i valori di configurazione di Azure AD</span><span class="sxs-lookup"><span data-stu-id="47921-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="47921-222">In hello [portale di Azure classico](https://manage.windowsazure.com/), andare troppo**Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="47921-222">In hello [Azure classic portal](https://manage.windowsazure.com/), go too**Azure Active Directory**.</span></span>
2. <span data-ttu-id="47921-223">In hello **Directory** scheda, fare clic su tenant di AAD.</span><span class="sxs-lookup"><span data-stu-id="47921-223">On hello **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="47921-224">Fare clic su **applicazioni > applicazioni proprietà dell'azienda**, quindi fare clic su hello segno di spunta.</span><span class="sxs-lookup"><span data-stu-id="47921-224">Click **Applications > Applications my company owns**, and then click hello check mark.</span></span>
4. <span data-ttu-id="47921-225">Nell'elenco di hello delle applicazioni, fare clic su nome hello di hello Azure creata automaticamente quando è abilitata l'autenticazione per app di API hello ToDoListDataAPI (livello di dati).</span><span class="sxs-lookup"><span data-stu-id="47921-225">In hello list of applications, click hello name of hello one that Azure created for you when you enabled authentication for hello ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="47921-226">Fare clic su hello **configura** scheda.</span><span class="sxs-lookup"><span data-stu-id="47921-226">Click hello **Configure** tab.</span></span>
6. <span data-ttu-id="47921-227">Hello copia **ID Client** valore e salvare identificabile da ottenere più tardi.</span><span class="sxs-lookup"><span data-stu-id="47921-227">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="47921-228">Nel portale di Azure classico hello tornare indietro elenco toohello di **applicazioni proprietà dell'azienda**, fare clic su un'applicazione AAD hello creato per app ToDoListAPI API di livello intermedio hello (Buongiorno uno creato nell'esercitazione precedente hello, non Hello uno creato in questa esercitazione).</span><span class="sxs-lookup"><span data-stu-id="47921-228">In hello Azure classic portal go back toohello list of **Applications my company owns**, and click hello AAD application that you created for hello middle tier ToDoListAPI API app (hello one you created in hello previous tutorial, not hello one you created in this tutorial).</span></span>
8. <span data-ttu-id="47921-229">Fare clic su hello **configura** scheda.</span><span class="sxs-lookup"><span data-stu-id="47921-229">Click hello **Configure** tab.</span></span>
9. <span data-ttu-id="47921-230">Hello copia **ID Client** valore e salvare identificabile da ottenere più tardi.</span><span class="sxs-lookup"><span data-stu-id="47921-230">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="47921-231">In **chiavi**selezionare **1 anno** da hello **Seleziona durata** elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="47921-231">Under **keys**, select **1 year** from hello **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="47921-232">Fare clic su **Salva**.</span><span class="sxs-lookup"><span data-stu-id="47921-232">Click **Save**.</span></span>
    
     ![Generare una chiave dell'app](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="47921-234">Copia valore chiave hello e salvarlo identificabile da ottenere più tardi.</span><span class="sxs-lookup"><span data-stu-id="47921-234">Copy hello key value and save it someplace you can get it from later.</span></span>
    
     ![Copiare una nuova chiave dell'app](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-hello-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="47921-236">Configurare le impostazioni di Azure AD nell'ambiente di runtime dell'applicazione di livello intermedio API hello</span><span class="sxs-lookup"><span data-stu-id="47921-236">Configure Azure AD settings in hello middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="47921-237">Passare toohello [portale di Azure](https://portal.azure.com/), quindi passare toohello **App per le API** pannello per l'applicazione hello API che ospita il progetto di TodoListAPI (intermedio) hello.</span><span class="sxs-lookup"><span data-stu-id="47921-237">Go toohello [Azure portal](https://portal.azure.com/), and then navigate toohello **API App** blade for hello API app that hosts hello TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="47921-238">Fare clic su **Impostazioni > Impostazioni applicazione**.</span><span class="sxs-lookup"><span data-stu-id="47921-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="47921-239">In hello **impostazioni App** sezione, aggiungere chiavi e valori di hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="47921-239">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="47921-240">**Chiave**</span><span class="sxs-lookup"><span data-stu-id="47921-240">**Key**</span></span> | <span data-ttu-id="47921-241">ida:Authority</span><span class="sxs-lookup"><span data-stu-id="47921-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="47921-242">**Valore**</span><span class="sxs-lookup"><span data-stu-id="47921-242">**Value**</span></span> |<span data-ttu-id="47921-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span><span class="sxs-lookup"><span data-stu-id="47921-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="47921-244">**Esempio**</span><span class="sxs-lookup"><span data-stu-id="47921-244">**Example**</span></span> |<span data-ttu-id="47921-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="47921-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="47921-246">**Chiave**</span><span class="sxs-lookup"><span data-stu-id="47921-246">**Key**</span></span> | <span data-ttu-id="47921-247">ida:ClientId</span><span class="sxs-lookup"><span data-stu-id="47921-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="47921-248">**Valore**</span><span class="sxs-lookup"><span data-stu-id="47921-248">**Value**</span></span> |<span data-ttu-id="47921-249">ID client dell'hello chiamano l'applicazione (livello intermedio - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="47921-249">Client ID of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="47921-250">**Esempio**</span><span class="sxs-lookup"><span data-stu-id="47921-250">**Example**</span></span> |<span data-ttu-id="47921-251">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="47921-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="47921-252">**Chiave**</span><span class="sxs-lookup"><span data-stu-id="47921-252">**Key**</span></span> | <span data-ttu-id="47921-253">ida:ClientSecret</span><span class="sxs-lookup"><span data-stu-id="47921-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="47921-254">**Valore**</span><span class="sxs-lookup"><span data-stu-id="47921-254">**Value**</span></span> |<span data-ttu-id="47921-255">Chiave dell'app di hello chiamano l'applicazione (livello intermedio - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="47921-255">App key of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="47921-256">**Esempio**</span><span class="sxs-lookup"><span data-stu-id="47921-256">**Example**</span></span> |<span data-ttu-id="47921-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="47921-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="47921-258">**Chiave**</span><span class="sxs-lookup"><span data-stu-id="47921-258">**Key**</span></span> | <span data-ttu-id="47921-259">ida:Resource</span><span class="sxs-lookup"><span data-stu-id="47921-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="47921-260">**Valore**</span><span class="sxs-lookup"><span data-stu-id="47921-260">**Value**</span></span> |<span data-ttu-id="47921-261">ID client di chiamare l'applicazione hello (livello di dati - ToDoListDataAPI)</span><span class="sxs-lookup"><span data-stu-id="47921-261">Client ID of hello called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="47921-262">**Esempio**</span><span class="sxs-lookup"><span data-stu-id="47921-262">**Example**</span></span> |<span data-ttu-id="47921-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="47921-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="47921-264">**Nota**: per `ida:Resource`, assicurarsi di utilizzare una chiamata dell'applicazione hello **ID client** e non il relativo **URI ID App**.</span><span class="sxs-lookup"><span data-stu-id="47921-264">**Note**: For `ida:Resource`, make sure you use hello called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="47921-265">`ida:ClientId`e `ida:Resource` sono diversi valori per questa esercitazione, poiché si utilizza separano applicaations AD Azure di livello intermedio hello e il livello dati.</span><span class="sxs-lookup"><span data-stu-id="47921-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for hello middle tier and data tier.</span></span> <span data-ttu-id="47921-266">Se si utilizza una singola applicazione di Azure AD per la chiamata di app per le API e hello hello protetto app per le API, si utilizzerebbe hello stesso valore in entrambi `ida:ClientId` e `ida:Resource`.</span><span class="sxs-lookup"><span data-stu-id="47921-266">If you were using a single Azure AD application for hello calling API app and hello protected API app, you would use hello same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="47921-267">codice Hello Usa ConfigurationManager tooget questi valori, quindi può essere archiviate nel file Web. config del progetto hello o nell'ambiente di runtime Azure hello.</span><span class="sxs-lookup"><span data-stu-id="47921-267">hello code uses ConfigurationManager tooget these values, so they could be stored in hello project's Web.config file or in hello Azure runtime environment.</span></span> <span data-ttu-id="47921-268">Mentre un'applicazione ASP.NET è in esecuzione nel servizio app di Azure, le impostazioni dell'ambiente eseguono automaticamente l'override delle impostazioni di Web.config. Le impostazioni di ambiente sono in genere un [le informazioni riservate più sicure modo toostore rispetto a file Web. config tooa](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span><span class="sxs-lookup"><span data-stu-id="47921-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config. Environment settings are generally a [more secure way toostore sensitive information compared tooa Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="47921-269">Fare clic su **Salva**.</span><span class="sxs-lookup"><span data-stu-id="47921-269">Click **Save**.</span></span>
   
    ![Fare clic su Salva.](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-hello-application"></a><span data-ttu-id="47921-271">Testare l'applicazione hello</span><span class="sxs-lookup"><span data-stu-id="47921-271">Test hello application</span></span>
1. <span data-ttu-id="47921-272">In un browser andare toohello URL HTTPS di hello AngularJS front-end web app.</span><span class="sxs-lookup"><span data-stu-id="47921-272">In a browser go toohello HTTPS URL of hello AngularJS front end web app.</span></span>
2. <span data-ttu-id="47921-273">Fare clic su hello **tooDo elenco** scheda e accedere con le credenziali per un utente nel tenant di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47921-273">Click hello **tooDo List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="47921-274">Aggiungere attività elementi tooverify che un'applicazione hello sia in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="47921-274">Add to-do items tooverify that hello application is working.</span></span>
   
    ![pagina di elenco tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="47921-276">Se un'applicazione hello non funziona come previsto, verificare le impostazioni di hello che immesso nel portale di Azure hello.</span><span class="sxs-lookup"><span data-stu-id="47921-276">If hello application doesn't work as expected, double-check all of hello settings you entered in hello Azure portal.</span></span> <span data-ttu-id="47921-277">Se vengono visualizzate tutte le impostazioni di hello toobe corretto, vedere hello [Troubleshooting](#troubleshooting) sezione più avanti in questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="47921-277">If all of hello settings appear toobe correct, see hello [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-hello-api-app-from-browser-access"></a><span data-ttu-id="47921-278">Proteggere app per le API hello dall'accesso di browser</span><span class="sxs-lookup"><span data-stu-id="47921-278">Protect hello API app from browser access</span></span>
<span data-ttu-id="47921-279">Per questa esercitazione è stato creato un apposito applicazione Azure AD per l'applicazione hello API ToDoListDataAPI (livello di dati).</span><span class="sxs-lookup"><span data-stu-id="47921-279">For this tutorial you created a separate Azure AD application for hello ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="47921-280">Come si è visto, quando il servizio App viene creata un'applicazione di AAD, in modo che consente a URL di un utente toogo toohello app per le API in un browser e accedere in Configura applicazione AAD hello.</span><span class="sxs-lookup"><span data-stu-id="47921-280">As you've seen, when App Service creates an AAD application, it configures hello AAD application in a way that enables a user toogo toohello API app's URL in a browser and log on.</span></span> <span data-ttu-id="47921-281">Pertanto, è possibile che un utente finale nel tenant di Azure AD, non solo un'entità di servizio, tooaccess hello API.</span><span class="sxs-lookup"><span data-stu-id="47921-281">That means it's possible for an end user in your Azure AD tenant, not just a service principal, tooaccess hello API.</span></span> 

<span data-ttu-id="47921-282">Se si desidera l'accesso al browser tooprevent senza scrivere alcun codice in hello protetti app per le API, è possibile modificare hello **URL di risposta** nell'applicazione AAD hello in modo che sia diverso da dell'applicazione hello API URL di base.</span><span class="sxs-lookup"><span data-stu-id="47921-282">If you want tooprevent browser access without writing any code in hello protected API app, you can change hello **Reply URL** in hello AAD application so that it's different from hello API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="47921-283">Disabilitare l'accesso dal browser</span><span class="sxs-lookup"><span data-stu-id="47921-283">Disable browser access</span></span>
1. <span data-ttu-id="47921-284">In un portale classico hello **configura** per un'applicazione AAD hello che è stata creata per hello TodoListService scheda, modificare il valore di hello in hello **URL di risposta** campo in modo che sia un URL valido ma non hello API dell'applicazione URL.</span><span class="sxs-lookup"><span data-stu-id="47921-284">In hello classic portal's **Configure** tab for hello AAD application that was created for hello TodoListService, change hello value in hello **Reply URL** field so that it is a valid URL but not hello API app's URL.</span></span>
2. <span data-ttu-id="47921-285">Fare clic su **Salva**.</span><span class="sxs-lookup"><span data-stu-id="47921-285">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="47921-286">Verificare che non sia più possibile accedere dal browser</span><span class="sxs-lookup"><span data-stu-id="47921-286">Verify browser access no longer works</span></span>
<span data-ttu-id="47921-287">Si è verificato in precedenza che è possibile passare l'URL dell'app toohello API da un browser mediante l'accesso con credenziali di un singolo utente.</span><span class="sxs-lookup"><span data-stu-id="47921-287">Earlier you verified that you can go toohello API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="47921-288">In questa sezione si verifica che non sia più possibile.</span><span class="sxs-lookup"><span data-stu-id="47921-288">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="47921-289">In una nuova finestra del browser, passare toohello URL dell'app per le API hello.</span><span class="sxs-lookup"><span data-stu-id="47921-289">In a new browser window, go toohello URL of hello API app again.</span></span>
2. <span data-ttu-id="47921-290">Quando l'accesso richiesto toodo così.</span><span class="sxs-lookup"><span data-stu-id="47921-290">Log in when prompted toodo so.</span></span>
3. <span data-ttu-id="47921-291">Account di accesso ha esito positivo, ma provoca tooan pagina di errore.</span><span class="sxs-lookup"><span data-stu-id="47921-291">Login succeeds but leads tooan error page.</span></span>
   
    <span data-ttu-id="47921-292">App AAD hello configurati in modo che gli utenti nel tenant AAD hello non possono accedere e accedere hello API da un browser.</span><span class="sxs-lookup"><span data-stu-id="47921-292">You've configured hello AAD app so that users in hello AAD tenant cannot log in and access hello API from a browser.</span></span> <span data-ttu-id="47921-293">È comunque possibile accedere applicazione API hello utilizzando un token dell'entità servizio, è possibile verificare che l'URL dell'app web toohello e l'aggiunta di altre attività da svolgere.</span><span class="sxs-lookup"><span data-stu-id="47921-293">You can still access hello API app by using a service principal token, which you can verify by going toohello web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-tooa-particular-service-principal"></a><span data-ttu-id="47921-294">Limitare l'accesso tooa particolare SPN</span><span class="sxs-lookup"><span data-stu-id="47921-294">Restrict access tooa particular service principal</span></span>
<span data-ttu-id="47921-295">Attualmente, qualsiasi chiamante che è possibile ottenere un token per un utente o dell'entità servizio nel tenant di Azure AD può chiamare l'applicazione hello API TodoListDataAPI (livello di dati).</span><span class="sxs-lookup"><span data-stu-id="47921-295">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call hello TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="47921-296">È possibile che tale app per le API livello dati hello accetta chiamate da app per le API (intermedio) TodoListAPI hello e solo da un'entità servizio particolare solo toomake.</span><span class="sxs-lookup"><span data-stu-id="47921-296">You might want toomake sure that hello data tier API app only accepts calls from hello TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="47921-297">È possibile aggiungere queste restrizioni aggiungendo hello toovalidate codice `appid` e `objectidentifier` attestazioni su chiamate in ingresso.</span><span class="sxs-lookup"><span data-stu-id="47921-297">You can add these restrictions by adding code toovalidate hello `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="47921-298">Per questa esercitazione è inserire codice hello che convalida l'ID dell'app e l'ID dell'entità servizio direttamente nelle azioni del controller.</span><span class="sxs-lookup"><span data-stu-id="47921-298">For this tutorial you put hello code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="47921-299">Sono disponibili alternative toouse personalizzato `Authorize` attributo o toodo la convalida nelle sequenze di avvio (ad esempio, il middleware OWIN).</span><span class="sxs-lookup"><span data-stu-id="47921-299">Alternatives are toouse a custom `Authorize` attribute or toodo this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="47921-300">Per un esempio di hello quest'ultimo, vedere [questa applicazione di esempio](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span><span class="sxs-lookup"><span data-stu-id="47921-300">For an example of hello latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="47921-301">Rendere hello seguente progetto TodoListDataAPI toohello di modifiche.</span><span class="sxs-lookup"><span data-stu-id="47921-301">Make hello following changes toohello TodoListDataAPI project.</span></span>

1. <span data-ttu-id="47921-302">Aprire hello *Controllers/TodoListController.cs* file.</span><span class="sxs-lookup"><span data-stu-id="47921-302">Open hello *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="47921-303">Rimuovi commento hello che impostare `trustedCallerClientId` e `trustedCallerServicePrincipalId`.</span><span class="sxs-lookup"><span data-stu-id="47921-303">Uncomment hello lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="47921-304">Rimuovere il commento di codice hello in hello CheckCallerId metodo.</span><span class="sxs-lookup"><span data-stu-id="47921-304">Uncomment hello code in hello CheckCallerId method.</span></span> <span data-ttu-id="47921-305">Questo metodo viene chiamato all'inizio di hello di ogni metodo di azione nel controller hello.</span><span class="sxs-lookup"><span data-stu-id="47921-305">This method is called at hello start of every action method in hello controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "hello appID or service principal ID is not hello expected value." });
            }
        }
4. <span data-ttu-id="47921-306">Ridistribuire hello ToDoListDataAPI progetto tooAzure servizio App.</span><span class="sxs-lookup"><span data-stu-id="47921-306">Redeploy hello ToDoListDataAPI project tooAzure App Service.</span></span>
5. <span data-ttu-id="47921-307">Nel browser, URL HTTPS dell'app di toohello AngularJS front-end web, scegliere nella home page di hello hello **tooDo elenco** scheda.</span><span class="sxs-lookup"><span data-stu-id="47921-307">In your browser, go toohello AngularJS front end web app's HTTPS URL, and in hello home page click hello **tooDo List** tab.</span></span>
   
    <span data-ttu-id="47921-308">un'applicazione Hello non funziona perché toohello nuovamente terminare le chiamate hanno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="47921-308">hello application doesn't work because calls toohello back end are failing.</span></span> <span data-ttu-id="47921-309">nuovo codice Hello controllo appid effettivo e objectidentifier ma non è ancora hello valori corretti toocheck loro base.</span><span class="sxs-lookup"><span data-stu-id="47921-309">hello new code is checking actual appid and objectidentifier but it doesn't yet have hello correct values toocheck them against.</span></span> <span data-ttu-id="47921-310">browser Hello Console degli strumenti per sviluppatori segnala che il server hello ha restituito un errore HTTP 401.</span><span class="sxs-lookup"><span data-stu-id="47921-310">hello browser Developer Tools Console reports that hello server is returning an HTTP 401 error.</span></span>
   
    ![Errore nella console degli strumenti di sviluppo](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="47921-312">In hello alla procedura seguente verranno configurati i valori previsti hello.</span><span class="sxs-lookup"><span data-stu-id="47921-312">In hello following steps you configure hello expected values.</span></span>
6. <span data-ttu-id="47921-313">Con Azure AD PowerShell, ottenere il valore di hello del servizio hello principale per l'applicazione Azure Active Directory creata per il progetto TodoListWebApp hello hello.</span><span class="sxs-lookup"><span data-stu-id="47921-313">Using Azure AD PowerShell, get hello value of hello service principal for hello Azure AD application that you created for hello TodoListWebApp project.</span></span>
   
    <span data-ttu-id="47921-314">a.</span><span class="sxs-lookup"><span data-stu-id="47921-314">a.</span></span> <span data-ttu-id="47921-315">Per istruzioni su come tooinstall Azure PowerShell e connettersi tooyour sottoscrizione, vedere [tramite Azure PowerShell con Azure Resource Manager](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="47921-315">For instructions on how tooinstall Azure PowerShell and connect tooyour subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="47921-316">b.</span><span class="sxs-lookup"><span data-stu-id="47921-316">b.</span></span> <span data-ttu-id="47921-317">tooget un elenco delle entità servizio, eseguire hello `Login-AzureRmAccount` comando e quindi hello `Get-AzureRmADServicePrincipal` comando.</span><span class="sxs-lookup"><span data-stu-id="47921-317">tooget a list of service principals, execute hello `Login-AzureRmAccount` command and then hello `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="47921-318">c.</span><span class="sxs-lookup"><span data-stu-id="47921-318">c.</span></span> <span data-ttu-id="47921-319">Cercare hello objectid hello dell'entità servizio dell'applicazione TodoListAPI hello e salvarlo in una posizione in cui da che è possibile copiare in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="47921-319">Find hello objectid for hello service principal of hello TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="47921-320">Nel portale di Azure hello, passare toohello API app pannello app hello API che è stato distribuito il progetto ToDoListDataAPI hello per.</span><span class="sxs-lookup"><span data-stu-id="47921-320">In hello Azure portal, navigate toohello API app blade for hello API app that you deployed hello ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="47921-321">Fare clic su **Impostazioni > Impostazioni applicazione**.</span><span class="sxs-lookup"><span data-stu-id="47921-321">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="47921-322">In hello **impostazioni App** sezione, aggiungere chiavi e valori di hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="47921-322">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="47921-323">**Chiave**</span><span class="sxs-lookup"><span data-stu-id="47921-323">**Key**</span></span> | <span data-ttu-id="47921-324">todo:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="47921-324">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="47921-325">**Valore**</span><span class="sxs-lookup"><span data-stu-id="47921-325">**Value**</span></span> |<span data-ttu-id="47921-326">ID entità servizio dell'applicazione chiamante</span><span class="sxs-lookup"><span data-stu-id="47921-326">Service principal id of calling application</span></span> |
   | <span data-ttu-id="47921-327">**Esempio**</span><span class="sxs-lookup"><span data-stu-id="47921-327">**Example**</span></span> |<span data-ttu-id="47921-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="47921-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="47921-329">**Chiave**</span><span class="sxs-lookup"><span data-stu-id="47921-329">**Key**</span></span> | <span data-ttu-id="47921-330">todo:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="47921-330">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="47921-331">**Valore**</span><span class="sxs-lookup"><span data-stu-id="47921-331">**Value**</span></span> |<span data-ttu-id="47921-332">ID client dell'applicazione - copiato dall'applicazione di Azure AD TodoListAPI hello chiamante</span><span class="sxs-lookup"><span data-stu-id="47921-332">Client ID of calling application - copied from hello TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="47921-333">**Esempio**</span><span class="sxs-lookup"><span data-stu-id="47921-333">**Example**</span></span> |<span data-ttu-id="47921-334">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="47921-334">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="47921-335">Fare clic su **Save**.</span><span class="sxs-lookup"><span data-stu-id="47921-335">Click **Save**.</span></span>
    
     ![Fare clic su Salva.](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="47921-337">Nel browser, restituire l'URL dell'app web toohello e nella home page di hello fare clic su hello **tooDo elenco** scheda.</span><span class="sxs-lookup"><span data-stu-id="47921-337">In your browser, return toohello web app's URL, and in hello home page click hello **tooDo List** tab.</span></span>
    
     <span data-ttu-id="47921-338">Questa applicazione hello ora funziona come previsto perché i valori previsti hello hello chiamante attendibile app ID e l'ID dell'entità servizio.</span><span class="sxs-lookup"><span data-stu-id="47921-338">This time hello application works as expected because hello trusted caller app ID and service principal ID are hello expected values.</span></span>
    
     ![pagina di elenco tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-hello-projects-from-scratch"></a><span data-ttu-id="47921-340">Compilazione di progetti hello da zero</span><span class="sxs-lookup"><span data-stu-id="47921-340">Building hello projects from scratch</span></span>
<span data-ttu-id="47921-341">progetti API Web Hello due sono stati creati tramite hello **Azure API App** progetto di modello e sostituendo i controller di valori predefinito hello con un controller elenco attività.</span><span class="sxs-lookup"><span data-stu-id="47921-341">hello two Web API projects were created by using hello **Azure API App** project template and replacing hello default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="47921-342">Per acquisire token dell'entità servizio di Azure AD nel progetto ToDoListAPI hello, hello [Active Directory Authentication Library (ADAL) per .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) il pacchetto NuGet è stato installato.</span><span class="sxs-lookup"><span data-stu-id="47921-342">For acquiring Azure AD service principal tokens in hello ToDoListAPI project, hello [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="47921-343">Per informazioni sulla creazione di un'applicazione a pagina singola AngularJS troppo con un back-end di API Web come ToDoListAngular, vedere [mani nel Lab: creare un'applicazione a pagina singola (SPA) con ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span><span class="sxs-lookup"><span data-stu-id="47921-343">For information about how too create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="47921-344">Per informazioni su come tooadd il codice di autenticazione di Azure AD, vedere [protezione AngularJS singola pagina le app con Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="47921-344">For information about how tooadd Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="47921-345">Risoluzione dei problemi</span><span class="sxs-lookup"><span data-stu-id="47921-345">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="47921-346">Assicurarsi di non confondere ToDoListAPI (livello intermedio) e ToDoListDataAPI (livello dati).</span><span class="sxs-lookup"><span data-stu-id="47921-346">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="47921-347">Ad esempio, in questa esercitazione è aggiungere app authentication toohello dati livello API **ma chiave dell'applicazione hello deve provenire da applicazione AD Azure creato per l'applicazione di livello intermedio API hello hello**.</span><span class="sxs-lookup"><span data-stu-id="47921-347">For example, in this tutorial you add authentication toohello data tier API app, **but hello app key must come from hello Azure AD application that you created for hello middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="47921-348">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="47921-348">Next steps</span></span>
<span data-ttu-id="47921-349">Si tratta di esercitazione di ultima hello in hello serie di App per le API.</span><span class="sxs-lookup"><span data-stu-id="47921-349">This is hello last tutorial in hello API Apps series.</span></span> 

<span data-ttu-id="47921-350">Per ulteriori informazioni su Azure Active Directory, vedere hello seguenti risorse.</span><span class="sxs-lookup"><span data-stu-id="47921-350">For more information about Azure Active Directory, see hello following resources.</span></span>

* [<span data-ttu-id="47921-351">Guida per sviluppatori Azure AD</span><span class="sxs-lookup"><span data-stu-id="47921-351">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="47921-352">Scenari per Azure AD</span><span class="sxs-lookup"><span data-stu-id="47921-352">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="47921-353">Esempi di Azure AD</span><span class="sxs-lookup"><span data-stu-id="47921-353">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="47921-354">Hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) esempio è simile toowhat viene visualizzato in questa esercitazione, ma senza utilizzare l'autenticazione del servizio App.</span><span class="sxs-lookup"><span data-stu-id="47921-354">hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar toowhat is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="47921-355">Per informazioni su altri modi toodeploy Visual Studio progetti tooAPI App, tramite Visual Studio o [l'automatizzazione della distribuzione](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) da un [sistema di controllo di origine](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), vedere [come toodeploy un Applicazione di servizio App di Azure](../app-service-web/web-sites-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="47921-355">For information about other ways toodeploy Visual Studio projects tooAPI apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How toodeploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>

