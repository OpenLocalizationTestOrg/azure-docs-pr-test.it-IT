---
title: Panoramica del ciclo di vita di Reliable Services di Azure Service Fabric | Microsoft Docs
description: Informazioni sui diversi eventi del ciclo di vita di Reliable Services di Service Fabric
services: Service-Fabric
documentationcenter: java
author: PavanKunapareddyMSFT
manager: timlt
ms.assetid: 
ms.service: Service-Fabric
ms.devlang: java
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/30/2017
ms.author: pakunapa;
ms.openlocfilehash: 80eb68346dd05c256c60725eb082aa0651fe7cbd
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/18/2017
---
# <a name="reliable-services-lifecycle-overview"></a><span data-ttu-id="dbe14-103">Panoramica del ciclo di vita di Reliable Services</span><span class="sxs-lookup"><span data-stu-id="dbe14-103">Reliable services lifecycle overview</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="dbe14-104">C# su Windows</span><span class="sxs-lookup"><span data-stu-id="dbe14-104">C# on Windows</span></span>](service-fabric-reliable-services-lifecycle.md)
> * [<span data-ttu-id="dbe14-105">Java su Linux</span><span class="sxs-lookup"><span data-stu-id="dbe14-105">Java on Linux</span></span>](service-fabric-reliable-services-lifecycle-java.md)
>
>

<span data-ttu-id="dbe14-106">Quando si pensa al ciclo di vita di Reliable Services, le nozioni di base del ciclo di vita sono quelle più importanti.</span><span class="sxs-lookup"><span data-stu-id="dbe14-106">When thinking about the lifecycles of Reliable Services, the basics of the lifecycle are the most important.</span></span> <span data-ttu-id="dbe14-107">In generale:</span><span class="sxs-lookup"><span data-stu-id="dbe14-107">In general:</span></span>

* <span data-ttu-id="dbe14-108">Durante l'avvio</span><span class="sxs-lookup"><span data-stu-id="dbe14-108">During Startup</span></span>
  * <span data-ttu-id="dbe14-109">I servizi vengono costruiti</span><span class="sxs-lookup"><span data-stu-id="dbe14-109">Services are constructed</span></span>
  * <span data-ttu-id="dbe14-110">Hanno la possibilità di creare e restituire zero o più listener</span><span class="sxs-lookup"><span data-stu-id="dbe14-110">They have an opportunity to construct and return zero or more listeners</span></span>
  * <span data-ttu-id="dbe14-111">Qualsiasi listener restituito è aperto, consentendo la comunicazione con il servizio</span><span class="sxs-lookup"><span data-stu-id="dbe14-111">Any returned listeners are opened, allowing communication with the service</span></span>
  * <span data-ttu-id="dbe14-112">Viene chiamato il metodo RunAsync del servizio che consente al servizio stesso di eseguire operazioni a esecuzione prolungata o in background</span><span class="sxs-lookup"><span data-stu-id="dbe14-112">The Service's runAsync method is called, allowing the service to do long running or background work</span></span>
* <span data-ttu-id="dbe14-113">Durante l'arresto</span><span class="sxs-lookup"><span data-stu-id="dbe14-113">During shutdown</span></span>
  * <span data-ttu-id="dbe14-114">Il token di annullamento passato a RunAsync viene cancellato e i listener vengono chiusi</span><span class="sxs-lookup"><span data-stu-id="dbe14-114">The cancellation token passed to runAsync is canceled, and the listeners are closed</span></span>
  * <span data-ttu-id="dbe14-115">Una volta completata l'operazione, viene eliminato l'oggetto servizio stesso</span><span class="sxs-lookup"><span data-stu-id="dbe14-115">Once that is complete, the service object itself is destructed</span></span>

<span data-ttu-id="dbe14-116">Sono disponibili informazioni dettagliate sull'esatto ordine di questi eventi.</span><span class="sxs-lookup"><span data-stu-id="dbe14-116">There are details around the exact ordering of these events.</span></span> <span data-ttu-id="dbe14-117">In particolare, l'ordine degli eventi potrebbe cambiare leggermente a seconda che il servizio Reliable sia con o senza stato.</span><span class="sxs-lookup"><span data-stu-id="dbe14-117">In particular, the order of events may change slightly depending on whether the Reliable Service is Stateless or Stateful.</span></span> <span data-ttu-id="dbe14-118">Inoltre, per i servizi con stato, è necessario affrontare lo scenario di scambio del ruolo di primario.</span><span class="sxs-lookup"><span data-stu-id="dbe14-118">In addition, for stateful services, we have to deal with the Primary swap scenario.</span></span> <span data-ttu-id="dbe14-119">Durante tale sequenza il ruolo di primario viene trasferito a un'altra replica (o ritorna) senza l'arresto del servizio.</span><span class="sxs-lookup"><span data-stu-id="dbe14-119">During this sequence, the role of Primary is transferred to another replica (or comes back) without the service shutting down.</span></span> <span data-ttu-id="dbe14-120">Infine è necessario considerare le condizioni di errore.</span><span class="sxs-lookup"><span data-stu-id="dbe14-120">Finally, we have to think about error or failure conditions.</span></span>

## <a name="stateless-service-startup"></a><span data-ttu-id="dbe14-121">Avvio di un servizio senza stato</span><span class="sxs-lookup"><span data-stu-id="dbe14-121">Stateless service startup</span></span>
<span data-ttu-id="dbe14-122">Il ciclo di vita di un servizio senza stato è piuttosto semplice.</span><span class="sxs-lookup"><span data-stu-id="dbe14-122">The lifecycle of a stateless service is fairly straightforward.</span></span> <span data-ttu-id="dbe14-123">Di seguito è riportato l'ordine degli eventi:</span><span class="sxs-lookup"><span data-stu-id="dbe14-123">Here's the order of events:</span></span>

1. <span data-ttu-id="dbe14-124">Il servizio viene costruito</span><span class="sxs-lookup"><span data-stu-id="dbe14-124">The Service is constructed</span></span>
2. <span data-ttu-id="dbe14-125">Quindi si verificano due cose in parallelo:</span><span class="sxs-lookup"><span data-stu-id="dbe14-125">Then, in parallel two things happen:</span></span>
    - <span data-ttu-id="dbe14-126">Viene chiamato `StatelessService.createServiceInstanceListeners()` e viene aperto qualsiasi listener restituito (viene chiamato `CommunicationListener.openAsync()` su ogni listener)</span><span class="sxs-lookup"><span data-stu-id="dbe14-126">`StatelessService.createServiceInstanceListeners()` is invoked and any returned listeners are Opened (`CommunicationListener.openAsync()` is called on each listener)</span></span>
    - <span data-ttu-id="dbe14-127">Viene chiamato il metodo RunAsync (`StatelessService.runAsync()`) del servizio</span><span class="sxs-lookup"><span data-stu-id="dbe14-127">The service's runAsync method (`StatelessService.runAsync()`) is called</span></span>
3. <span data-ttu-id="dbe14-128">Se è presente, viene chiamato il metodo OnOpenAsync del servizio (in particolare, viene chiamato `StatelessService.onOpenAsync()`;</span><span class="sxs-lookup"><span data-stu-id="dbe14-128">If present, the service's own onOpenAsync method is called (Specifically, `StatelessService.onOpenAsync()` is called.</span></span> <span data-ttu-id="dbe14-129">si tratta di un override insolito ma comunque disponibile).</span><span class="sxs-lookup"><span data-stu-id="dbe14-129">This is an uncommon override but it is available).</span></span>

<span data-ttu-id="dbe14-130">È importante notare che non vi è alcun ordine tra le chiamate per creare e aprire i listener e RunAsync.</span><span class="sxs-lookup"><span data-stu-id="dbe14-130">It is important to note that there is no ordering between the calls to create and open the listeners and runAsync.</span></span> <span data-ttu-id="dbe14-131">I listener possono essere aperti prima dell'avvio di RunAsync.</span><span class="sxs-lookup"><span data-stu-id="dbe14-131">The listeners may open before runAsync is started.</span></span> <span data-ttu-id="dbe14-132">Analogamente RunAsync potrebbe essere chiamato prima che i listener di comunicazione vengano aperti o persino creati.</span><span class="sxs-lookup"><span data-stu-id="dbe14-132">Similarly, runAsync may end up invoked before the communication listeners are open or have even been constructed.</span></span> <span data-ttu-id="dbe14-133">Se è necessaria una sincronizzazione, la si lascia come esercizio per il responsabile dell'implementazione.</span><span class="sxs-lookup"><span data-stu-id="dbe14-133">If any synchronization is required, it is left as an exercise to the implementer.</span></span> <span data-ttu-id="dbe14-134">Soluzioni comuni:</span><span class="sxs-lookup"><span data-stu-id="dbe14-134">Common solutions:</span></span>

* <span data-ttu-id="dbe14-135">Talvolta i listener non possono funzionare fino a quando non vengono create altre informazioni o eseguite determinate operazioni.</span><span class="sxs-lookup"><span data-stu-id="dbe14-135">Sometimes listeners can't function until some other information is created or work done.</span></span> <span data-ttu-id="dbe14-136">Per i servizi senza stato queste operazioni solitamente possono essere eseguite nel costruttore del servizio, durante la chiamata di `createServiceInstanceListeners()` o come parte della costruzione del listener stesso.</span><span class="sxs-lookup"><span data-stu-id="dbe14-136">For stateless services that work can usually be done in the service's constructor, during the `createServiceInstanceListeners()` call, or as a part of the construction of the listener itself.</span></span>
* <span data-ttu-id="dbe14-137">In alcuni casi il codice in RunAsync non si avvia fino a quando i listener sono aperti.</span><span class="sxs-lookup"><span data-stu-id="dbe14-137">Sometimes the code in runAsync does not want to start until the listeners are open.</span></span> <span data-ttu-id="dbe14-138">In questo caso è necessario un po' di coordinamento in più.</span><span class="sxs-lookup"><span data-stu-id="dbe14-138">In this case additional coordination is necessary.</span></span> <span data-ttu-id="dbe14-139">Una soluzione comune è un flag interno ai listener che indica quando vengono completati e viene controllato in RunAsync prima di procedere con il lavoro effettivo.</span><span class="sxs-lookup"><span data-stu-id="dbe14-139">One common solution is some flag within the listeners indicating when they have completed, which is checked in runAsync before continuing to actual work.</span></span>

## <a name="stateless-service-shutdown"></a><span data-ttu-id="dbe14-140">Arresto di un servizio senza stato</span><span class="sxs-lookup"><span data-stu-id="dbe14-140">Stateless service shutdown</span></span>
<span data-ttu-id="dbe14-141">Quando si arresta un servizio senza stato, si segue lo stesso modello, solo in senso inverso:</span><span class="sxs-lookup"><span data-stu-id="dbe14-141">When shutting down a stateless service, the same pattern is followed, just in reverse:</span></span>

1. <span data-ttu-id="dbe14-142">In parallelo</span><span class="sxs-lookup"><span data-stu-id="dbe14-142">In parallel</span></span>
    - <span data-ttu-id="dbe14-143">Tutti i listener aperti vengono chiusi (viene chiamato `CommunicationListener.closeAsync()` su ogni listener)</span><span class="sxs-lookup"><span data-stu-id="dbe14-143">Any open listeners are Closed (`CommunicationListener.closeAsync()` is called on each listener)</span></span>
    - <span data-ttu-id="dbe14-144">Il token di annullamento passato a `runAsync()` viene annullato (il controllo della proprietà `isCancelled` del token di annullamento restituisce true e, se viene chiamato, il metodo `throwIfCancellationRequested` del token restituisce `CancellationException`)</span><span class="sxs-lookup"><span data-stu-id="dbe14-144">The cancellation token passed to `runAsync()` is canceled (checking the cancellation token's `isCancelled` property returns true, and if called the token's `throwIfCancellationRequested` method throws a `CancellationException`)</span></span>
2. <span data-ttu-id="dbe14-145">Dopo il completamento di `closeAsync()` su ogni listener e il completamento di `runAsync()`, viene chiamato il metodo `StatelessService.onCloseAsync()` del servizio, se è presente (anche in questo caso si tratta di un override insolito).</span><span class="sxs-lookup"><span data-stu-id="dbe14-145">Once `closeAsync()` completes on each listener and `runAsync()` also completes, the service's `StatelessService.onCloseAsync()` method is called, if present (again this is an uncommon override).</span></span>
3. <span data-ttu-id="dbe14-146">Dopo il completamento di `StatelessService.onCloseAsync()`, l'oggetto servizio viene eliminato</span><span class="sxs-lookup"><span data-stu-id="dbe14-146">After `StatelessService.onCloseAsync()` completes, the service object is destructed</span></span>

## <a name="notes-on-service-lifecycle"></a><span data-ttu-id="dbe14-147">Note sul ciclo di vita del servizio</span><span class="sxs-lookup"><span data-stu-id="dbe14-147">Notes on service lifecycle</span></span>
* <span data-ttu-id="dbe14-148">Entrambe le chiamate del metodo `runAsync()` e di `createServiceInstanceListeners` sono facoltative.</span><span class="sxs-lookup"><span data-stu-id="dbe14-148">Both the `runAsync()` method and the `createServiceInstanceListeners` calls are optional.</span></span> <span data-ttu-id="dbe14-149">Un servizio può averne una, entrambe o nessuna.</span><span class="sxs-lookup"><span data-stu-id="dbe14-149">A service may have one of them, both, or neither.</span></span> <span data-ttu-id="dbe14-150">Ad esempio, se il servizio esegue tutte le attività in risposta alle chiamate dell'utente, non è necessario implementare `runAsync()`.</span><span class="sxs-lookup"><span data-stu-id="dbe14-150">For example, if the service does all its work in response to user calls, there is no need for it to implement `runAsync()`.</span></span> <span data-ttu-id="dbe14-151">Sono necessari solo i listener di comunicazione e il codice associato.</span><span class="sxs-lookup"><span data-stu-id="dbe14-151">Only the communication listeners and their associated code are necessary.</span></span> <span data-ttu-id="dbe14-152">Analogamente creare e restituire i listener di comunicazione è facoltativo, in quanto il servizio potrebbe avere solo operazioni in background da eseguire e perciò richiedere solo l'implementazione di `runAsync()`</span><span class="sxs-lookup"><span data-stu-id="dbe14-152">Similarly, creating and returning communication listeners is optional, as the service may have only background work to do, and so only needs to implement `runAsync()`</span></span>
* <span data-ttu-id="dbe14-153">È un comportamento valido per un servizio completare `runAsync()` correttamente e ritornare.</span><span class="sxs-lookup"><span data-stu-id="dbe14-153">It is valid for a service to complete `runAsync()` successfully and return from it.</span></span> <span data-ttu-id="dbe14-154">Questa non è considerata una condizione di errore e rappresenterebbe il completamento dell'attività in background del servizio.</span><span class="sxs-lookup"><span data-stu-id="dbe14-154">This is not considered a failure condition and would represent the background work of the service completing.</span></span> <span data-ttu-id="dbe14-155">Per i servizi Reliable Services con stato viene chiamato nuovamente `runAsync()` se il servizio è stato abbassato dal livello primario e poi alzato di nuovo al livello primario.</span><span class="sxs-lookup"><span data-stu-id="dbe14-155">For stateful reliable services `runAsync()` would be called again if the service were demoted from primary and then promoted back to primary.</span></span>
* <span data-ttu-id="dbe14-156">Se un servizio esce da `runAsync()` generando un'eccezione imprevista, questo è un errore: l'oggetto servizio viene arrestato e viene segnalato un errore di integrità.</span><span class="sxs-lookup"><span data-stu-id="dbe14-156">If a service exits from `runAsync()` by throwing some unexpected exception, this is a failure and the service object is shut down and a health error reported.</span></span>
* <span data-ttu-id="dbe14-157">Mentre non c'è alcun limite di tempo per il completamento di questi metodi, si perde immediatamente la possibilità di scrivere e quindi non è possibile completare alcuna operazione effettiva.</span><span class="sxs-lookup"><span data-stu-id="dbe14-157">While there is no time limit on returning from these methods, you immediately lose the ability to write and therefore cannot complete any real work.</span></span> <span data-ttu-id="dbe14-158">È consigliabile completare al più presto la richiesta di annullamento ricevuta.</span><span class="sxs-lookup"><span data-stu-id="dbe14-158">It is recommended that you return as quickly as possible upon receiving the cancellation request.</span></span> <span data-ttu-id="dbe14-159">Se il servizio non risponde a queste chiamate API entro un intervallo di tempo ragionevole, Service Fabric può terminare forzatamente il servizio.</span><span class="sxs-lookup"><span data-stu-id="dbe14-159">If your service does not respond to these API calls in a reasonable amount of time Service Fabric may forcibly terminate your service.</span></span> <span data-ttu-id="dbe14-160">In genere ciò accade solo durante gli aggiornamenti delle applicazioni o quando viene eliminato un servizio.</span><span class="sxs-lookup"><span data-stu-id="dbe14-160">Usually this only happens during application upgrades or when a service is being deleted.</span></span> <span data-ttu-id="dbe14-161">Questo timeout è di 15 minuti per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="dbe14-161">This timeout is 15 minutes by default.</span></span>
* <span data-ttu-id="dbe14-162">Gli errori nel percorso `onCloseAsync()` generano la chiamata di `onAbort()` che rappresenta l'ultima e migliore opportunità del servizio di pulire e rilasciare le risorse che sono state richieste.</span><span class="sxs-lookup"><span data-stu-id="dbe14-162">Failures in the `onCloseAsync()` path result in `onAbort()` being called which is a last-chance best-effort opportunity for the service to clean up and release any resources that they have claimed.</span></span>

> [!NOTE]
> <span data-ttu-id="dbe14-163">Reliable Services con stato non è ancora supportato in Java.</span><span class="sxs-lookup"><span data-stu-id="dbe14-163">Stateful reliable services are not supported in java yet.</span></span>
>
>

## <a name="next-steps"></a><span data-ttu-id="dbe14-164">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="dbe14-164">Next steps</span></span>
* [<span data-ttu-id="dbe14-165">Introduzione a Reliable Services</span><span class="sxs-lookup"><span data-stu-id="dbe14-165">Introduction to Reliable Services</span></span>](service-fabric-reliable-services-introduction.md)
* [<span data-ttu-id="dbe14-166">Guida introduttiva a Reliable Services di Microsoft Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="dbe14-166">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
* [<span data-ttu-id="dbe14-167">Uso avanzato del modello di programmazione Reliable Services</span><span class="sxs-lookup"><span data-stu-id="dbe14-167">Reliable Services advanced usage</span></span>](service-fabric-reliable-services-advanced-usage.md)
