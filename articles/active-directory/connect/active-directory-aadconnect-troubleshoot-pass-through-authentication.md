---
title: 'Azure AD Connect: Risolvere i problemi di autenticazione pass-through | Microsoft Docs'
description: Questo articolo descrive come risolvere i problemi di autenticazione pass-through di Azure Active Directory (Azure AD).
services: active-directory
keywords: Risolvere i problemi di autenticazione pass-through di Azure AD Connect, installare Active Directory, componenti necessari per Azure AD, SSO, Single Sign-On
documentationcenter: 
author: swkrish
manager: femila
ms.assetid: 9f994aca-6088-40f5-b2cc-c753a4f41da7
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/04/2017
ms.author: billmath
ms.openlocfilehash: 72bd39bcf720cf5704274fcdfa0f2b8fc44a77bc
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/18/2017
---
# <a name="troubleshoot-azure-active-directory-pass-through-authentication"></a><span data-ttu-id="02ff3-104">Risolvere i problemi di autenticazione pass-through di Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="02ff3-104">Troubleshoot Azure Active Directory Pass-through Authentication</span></span>

<span data-ttu-id="02ff3-105">Questo articolo consente di trovare informazioni utili per risolvere i problemi comuni relativi all'autenticazione pass-through di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="02ff3-105">This article helps you find troubleshooting information about common issues regarding Azure AD Pass-through Authentication.</span></span>

>[!IMPORTANT]
><span data-ttu-id="02ff3-106">Se si verificano problemi di accesso utente con l'autenticazione pass-through, non disabilitare la funzionalità o disinstallare gli agenti di autenticazione pass-through se non è disponibile un account amministratore globale solo cloud per eseguire il fallback.</span><span class="sxs-lookup"><span data-stu-id="02ff3-106">If you are facing user sign-in issues with Pass-through Authentication, don't disable the feature or uninstall Pass-through Authentication Agents without having a cloud-only Global Administrator account to fall back on.</span></span> <span data-ttu-id="02ff3-107">Informazioni su come [aggiungere un account amministratore globale di tipo solo cloud](../active-directory-users-create-azure-portal.md).</span><span class="sxs-lookup"><span data-stu-id="02ff3-107">Learn about [adding a cloud-only Global Administrator account](../active-directory-users-create-azure-portal.md).</span></span> <span data-ttu-id="02ff3-108">L'esecuzione di questo passaggio è fondamentale ed evita di rimanere bloccati fuori dal tenant.</span><span class="sxs-lookup"><span data-stu-id="02ff3-108">Doing this step is critical and ensures that you don't get locked out of your tenant.</span></span>

## <a name="general-issues"></a><span data-ttu-id="02ff3-109">Problemi generali</span><span class="sxs-lookup"><span data-stu-id="02ff3-109">General issues</span></span>

### <a name="check-status-of-the-feature-and-authentication-agents"></a><span data-ttu-id="02ff3-110">Controllare lo stato della funzionalità e degli agenti di autenticazione</span><span class="sxs-lookup"><span data-stu-id="02ff3-110">Check status of the feature and Authentication Agents</span></span>

<span data-ttu-id="02ff3-111">Verificare che la funzionalità di autenticazione pass-through sia ancora **abilitata** nel tenant e che lo stato degli agenti di autenticazione mostri **Attivo**e non **Inattivo**.</span><span class="sxs-lookup"><span data-stu-id="02ff3-111">Ensure that the Pass-through Authentication feature is still **Enabled** on your tenant and the status of Authentication Agents shows **Active**, and not **Inactive**.</span></span> <span data-ttu-id="02ff3-112">Per verificare lo stato, è possibile passare al pannello **Azure AD Connect** nell'[interfaccia di amministrazione di Azure Active Directory](https://aad.portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="02ff3-112">You can check status by going to the **Azure AD Connect** blade on the [Azure Active Directory admin center](https://aad.portal.azure.com/).</span></span>

![Interfaccia di amministrazione di Azure Active Directory - Pannello Azure AD Connect](./media/active-directory-aadconnect-pass-through-authentication/pta7.png)

![Interfaccia di amministrazione di Azure Active Directory - Pannello Autenticazione pass-through](./media/active-directory-aadconnect-pass-through-authentication/pta11.png)

### <a name="user-facing-sign-in-error-messages"></a><span data-ttu-id="02ff3-115">Messaggi di errore visualizzati in fase di accesso</span><span class="sxs-lookup"><span data-stu-id="02ff3-115">User-facing sign-in error messages</span></span>

<span data-ttu-id="02ff3-116">Se l'utente non è in grado di accedere usando l'autenticazione pass-through, è possibile che venga visualizzato uno dei seguenti errori nella schermata di accesso di Azure AD:</span><span class="sxs-lookup"><span data-stu-id="02ff3-116">If the user is unable to sign into using Pass-through Authentication, they may see one of the following user-facing errors on the Azure AD sign-in screen:</span></span> 

|<span data-ttu-id="02ff3-117">Errore</span><span class="sxs-lookup"><span data-stu-id="02ff3-117">Error</span></span>|<span data-ttu-id="02ff3-118">Description</span><span class="sxs-lookup"><span data-stu-id="02ff3-118">Description</span></span>|<span data-ttu-id="02ff3-119">Risoluzione</span><span class="sxs-lookup"><span data-stu-id="02ff3-119">Resolution</span></span>
| --- | --- | ---
|<span data-ttu-id="02ff3-120">AADSTS80001</span><span class="sxs-lookup"><span data-stu-id="02ff3-120">AADSTS80001</span></span>|<span data-ttu-id="02ff3-121">Impossibile connettersi ad Active Directory</span><span class="sxs-lookup"><span data-stu-id="02ff3-121">Unable to connect to Active Directory</span></span>|<span data-ttu-id="02ff3-122">Verificare che i server degli agenti siano membri della stessa foresta AD degli utenti le cui password devono essere convalidate e siano in grado di connettersi ad Active Directory.</span><span class="sxs-lookup"><span data-stu-id="02ff3-122">Ensure that agent servers are members of the same AD forest as the users whose passwords need to be validated and they are able to connect to Active Directory.</span></span>  
|<span data-ttu-id="02ff3-123">AADSTS8002</span><span class="sxs-lookup"><span data-stu-id="02ff3-123">AADSTS8002</span></span>|<span data-ttu-id="02ff3-124">Si è verificato un timeout di connessione ad Active Directory</span><span class="sxs-lookup"><span data-stu-id="02ff3-124">A timeout occurred connecting to Active Directory</span></span>|<span data-ttu-id="02ff3-125">Verificare che Active Directory sia disponibile e risponda alle richieste degli agenti.</span><span class="sxs-lookup"><span data-stu-id="02ff3-125">Check to ensure that Active Directory is available and is responding to requests from the agents.</span></span>
|<span data-ttu-id="02ff3-126">AADSTS80004</span><span class="sxs-lookup"><span data-stu-id="02ff3-126">AADSTS80004</span></span>|<span data-ttu-id="02ff3-127">Il nome utente passato all'agente non era valido</span><span class="sxs-lookup"><span data-stu-id="02ff3-127">The username passed to the agent was not valid</span></span>|<span data-ttu-id="02ff3-128">Assicurarsi che l'utente stia tentando di accedere con il nome utente corretto.</span><span class="sxs-lookup"><span data-stu-id="02ff3-128">Ensure the user is attempting to sign in with the right username.</span></span>
|<span data-ttu-id="02ff3-129">AADSTS80005</span><span class="sxs-lookup"><span data-stu-id="02ff3-129">AADSTS80005</span></span>|<span data-ttu-id="02ff3-130">La convalida ha rilevato un errore WebException imprevedibile</span><span class="sxs-lookup"><span data-stu-id="02ff3-130">Validation encountered unpredictable WebException</span></span>|<span data-ttu-id="02ff3-131">Errore temporaneo.</span><span class="sxs-lookup"><span data-stu-id="02ff3-131">A transient error.</span></span> <span data-ttu-id="02ff3-132">ripetere la richiesta.</span><span class="sxs-lookup"><span data-stu-id="02ff3-132">Retry the request.</span></span> <span data-ttu-id="02ff3-133">Se il problema persiste, contattare il supporto Microsoft.</span><span class="sxs-lookup"><span data-stu-id="02ff3-133">If it continues to fail, contact Microsoft support.</span></span>
|<span data-ttu-id="02ff3-134">AADSTS80007</span><span class="sxs-lookup"><span data-stu-id="02ff3-134">AADSTS80007</span></span>|<span data-ttu-id="02ff3-135">Errore durante la comunicazione con Active Directory</span><span class="sxs-lookup"><span data-stu-id="02ff3-135">An error occurred communicating with Active Directory</span></span>|<span data-ttu-id="02ff3-136">Controllare i registri dell'agente per altre informazioni e verificare che Active Directory funzioni come previsto.</span><span class="sxs-lookup"><span data-stu-id="02ff3-136">Check the agent logs for more information and verify that Active Directory is operating as expected.</span></span>

### <a name="sign-in-failure-reasons-on-the-azure-active-directory-admin-center"></a><span data-ttu-id="02ff3-137">Motivi degli errori di accesso dell'interfaccia di amministrazione di Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="02ff3-137">Sign-in failure reasons on the Azure Active Directory admin center</span></span>

<span data-ttu-id="02ff3-138">Iniziare la risoluzione dei problemi di accesso dell'utente esaminando il [report delle attività di accesso](../active-directory-reporting-activity-sign-ins.md) nell'[interfaccia di amministrazione di Azure Active Directory](https://aad.portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="02ff3-138">Start troubleshooting user sign-in issues by looking at the [sign-in activity report](../active-directory-reporting-activity-sign-ins.md) on the [Azure Active Directory admin center](https://aad.portal.azure.com/).</span></span>

![Interfaccia di amministrazione di Azure Active Directory - Report sugli accessi](./media/active-directory-aadconnect-pass-through-authentication/pta4.png)

<span data-ttu-id="02ff3-140">Passare ad **Azure Active Directory** -> **Accessi** nell'[interfaccia di amministrazione di Azure Active Directory](https://aad.portal.azure.com/) e fare clic sull'attività di accesso di un utente specifico.</span><span class="sxs-lookup"><span data-stu-id="02ff3-140">Navigate to **Azure Active Directory** -> **Sign-ins** on the [Azure Active Directory admin center](https://aad.portal.azure.com/) and click a specific user's sign-in activity.</span></span> <span data-ttu-id="02ff3-141">Individuare il campo **CODICE ERRORE DI ACCESSO**.</span><span class="sxs-lookup"><span data-stu-id="02ff3-141">Look for the **SIGN-IN ERROR CODE** field.</span></span> <span data-ttu-id="02ff3-142">Eseguire il mapping del valore del campo a un motivo e una risoluzione dell'errore usando la tabella seguente:</span><span class="sxs-lookup"><span data-stu-id="02ff3-142">Map the value of that field to a failure reason and resolution using the following table:</span></span>

|<span data-ttu-id="02ff3-143">Codice dell'errore di accesso</span><span class="sxs-lookup"><span data-stu-id="02ff3-143">Sign-in error code</span></span>|<span data-ttu-id="02ff3-144">Motivo dell'errore di accesso</span><span class="sxs-lookup"><span data-stu-id="02ff3-144">Sign-in failure reason</span></span>|<span data-ttu-id="02ff3-145">Risoluzione</span><span class="sxs-lookup"><span data-stu-id="02ff3-145">Resolution</span></span>
| --- | --- | ---
| <span data-ttu-id="02ff3-146">50144</span><span class="sxs-lookup"><span data-stu-id="02ff3-146">50144</span></span> | <span data-ttu-id="02ff3-147">La password di Active Directory dell'utente è scaduta.</span><span class="sxs-lookup"><span data-stu-id="02ff3-147">User's Active Directory password has expired.</span></span> | <span data-ttu-id="02ff3-148">Reimpostare la password dell'utente nella sessione locale di Active Directory.</span><span class="sxs-lookup"><span data-stu-id="02ff3-148">Reset the user's password in your on-premises Active Directory.</span></span>
| <span data-ttu-id="02ff3-149">80001</span><span class="sxs-lookup"><span data-stu-id="02ff3-149">80001</span></span> | <span data-ttu-id="02ff3-150">Non sono disponibili agenti di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="02ff3-150">No Authentication Agent available.</span></span> | <span data-ttu-id="02ff3-151">Installare e registrare un agente di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="02ff3-151">Install and register an Authentication Agent.</span></span>
| <span data-ttu-id="02ff3-152">80002</span><span class="sxs-lookup"><span data-stu-id="02ff3-152">80002</span></span> | <span data-ttu-id="02ff3-153">Timeout della richiesta di convalida della password dell'agente di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="02ff3-153">Authentication Agent's password validation request timed out.</span></span> | <span data-ttu-id="02ff3-154">Verificare se Active Directory è raggiungibile dall'agente di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="02ff3-154">Check if your Active Directory is reachable from the Authentication Agent.</span></span>
| <span data-ttu-id="02ff3-155">80003</span><span class="sxs-lookup"><span data-stu-id="02ff3-155">80003</span></span> | <span data-ttu-id="02ff3-156">Risposta non valida ricevuta dall'agente di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="02ff3-156">Invalid response received by Authentication Agent.</span></span> | <span data-ttu-id="02ff3-157">Se il problema è riproducibile in modo coerente tra più utenti, controllare la configurazione di Active Directory.</span><span class="sxs-lookup"><span data-stu-id="02ff3-157">If the problem is consistently reproducible across multiple users, check your Active Directory configuration.</span></span>
| <span data-ttu-id="02ff3-158">80004</span><span class="sxs-lookup"><span data-stu-id="02ff3-158">80004</span></span> | <span data-ttu-id="02ff3-159">È stato usato un nome dell'entità utente (UPN) non corretto nella richiesta di accesso.</span><span class="sxs-lookup"><span data-stu-id="02ff3-159">Incorrect User Principal Name (UPN) used in sign-in request.</span></span> | <span data-ttu-id="02ff3-160">Chiedere all'utente di accedere con il nome utente corretto.</span><span class="sxs-lookup"><span data-stu-id="02ff3-160">Ask the user to sign in with the correct username.</span></span>
| <span data-ttu-id="02ff3-161">80005</span><span class="sxs-lookup"><span data-stu-id="02ff3-161">80005</span></span> | <span data-ttu-id="02ff3-162">Agente di autenticazione: si è verificato un errore.</span><span class="sxs-lookup"><span data-stu-id="02ff3-162">Authentication Agent: Error occurred.</span></span> | <span data-ttu-id="02ff3-163">Errore temporaneo.</span><span class="sxs-lookup"><span data-stu-id="02ff3-163">Transient error.</span></span> <span data-ttu-id="02ff3-164">Riprovare.</span><span class="sxs-lookup"><span data-stu-id="02ff3-164">Try again later.</span></span>
| <span data-ttu-id="02ff3-165">80007</span><span class="sxs-lookup"><span data-stu-id="02ff3-165">80007</span></span> | <span data-ttu-id="02ff3-166">L'agente di autenticazione non è in grado di connettersi ad Active Directory.</span><span class="sxs-lookup"><span data-stu-id="02ff3-166">Authentication Agent unable to connect to Active Directory.</span></span> | <span data-ttu-id="02ff3-167">Verificare se Active Directory è raggiungibile dall'agente di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="02ff3-167">Check if your Active Directory is reachable from the Authentication Agent.</span></span>
| <span data-ttu-id="02ff3-168">80010</span><span class="sxs-lookup"><span data-stu-id="02ff3-168">80010</span></span> | <span data-ttu-id="02ff3-169">L'agente di autenticazione non è in grado di decrittografare la password.</span><span class="sxs-lookup"><span data-stu-id="02ff3-169">Authentication Agent unable to decrypt password.</span></span> | <span data-ttu-id="02ff3-170">Se il problema è riproducibile in modo coerente, installare e registrare un nuovo agente di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="02ff3-170">If the problem is consistently reproducible, install and register a new Authentication Agent.</span></span> <span data-ttu-id="02ff3-171">E disinstallare quello corrente.</span><span class="sxs-lookup"><span data-stu-id="02ff3-171">And uninstall the current one.</span></span> 
| <span data-ttu-id="02ff3-172">80011</span><span class="sxs-lookup"><span data-stu-id="02ff3-172">80011</span></span> | <span data-ttu-id="02ff3-173">L'agente di autenticazione non è in grado di recuperare la chiave di decrittografia.</span><span class="sxs-lookup"><span data-stu-id="02ff3-173">Authentication Agent unable to retrieve decryption key.</span></span> | <span data-ttu-id="02ff3-174">Se il problema è riproducibile in modo coerente, installare e registrare un nuovo agente di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="02ff3-174">If the problem is consistently reproducible, install and register a new Authentication Agent.</span></span> <span data-ttu-id="02ff3-175">E disinstallare quello corrente.</span><span class="sxs-lookup"><span data-stu-id="02ff3-175">And uninstall the current one.</span></span>

## <a name="authentication-agent-installation-issues"></a><span data-ttu-id="02ff3-176">Problemi di installazione dell'agente di autenticazione</span><span class="sxs-lookup"><span data-stu-id="02ff3-176">Authentication Agent installation issues</span></span>

### <a name="an-unexpected-error-occurred"></a><span data-ttu-id="02ff3-177">Si è verificato un errore imprevisto</span><span class="sxs-lookup"><span data-stu-id="02ff3-177">An unexpected error occurred</span></span>

<span data-ttu-id="02ff3-178">[Raccogliere i registri dell'agente](#collecting-pass-through-authentication-agent-logs) dal server e contattare il supporto tecnico Microsoft per risolvere il problema.</span><span class="sxs-lookup"><span data-stu-id="02ff3-178">[Collect agent logs](#collecting-pass-through-authentication-agent-logs) from the server and contact Microsoft Support with your issue.</span></span>

## <a name="authentication-agent-registration-issues"></a><span data-ttu-id="02ff3-179">Problemi di registrazione dell'agente di autenticazione</span><span class="sxs-lookup"><span data-stu-id="02ff3-179">Authentication Agent registration issues</span></span>

### <a name="registration-of-the-authentication-agent-failed-due-to-blocked-ports"></a><span data-ttu-id="02ff3-180">La registrazione dell'agente di autenticazione non è riuscita a causa di porte bloccate</span><span class="sxs-lookup"><span data-stu-id="02ff3-180">Registration of the Authentication Agent failed due to blocked ports</span></span>

<span data-ttu-id="02ff3-181">Verificare che il server in cui è installato l'agente di autenticazione sia in grado di comunicare con gli URL del nostro servizio e le porte indicate [qui](active-directory-aadconnect-pass-through-authentication-quick-start.md#step-1-check-prerequisites).</span><span class="sxs-lookup"><span data-stu-id="02ff3-181">Ensure that the server on which the Authentication Agent has been installed can communicate with our service URLs and ports listed [here](active-directory-aadconnect-pass-through-authentication-quick-start.md#step-1-check-prerequisites).</span></span>

### <a name="registration-of-the-authentication-agent-failed-due-to-token-or-account-authorization-errors"></a><span data-ttu-id="02ff3-182">La registrazione dell'agente di autenticazione non è riuscita a causa di errori di autorizzazione dell'account o del token</span><span class="sxs-lookup"><span data-stu-id="02ff3-182">Registration of the Authentication Agent failed due to token or account authorization errors</span></span>

<span data-ttu-id="02ff3-183">Assicurarsi di usare un account amministratore globale solo cloud per tutte le operazioni di installazione e registrazione dell'agente di autenticazione autonomo o di Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="02ff3-183">Ensure that you use a cloud-only Global Administrator account for all Azure AD Connect or standalone Authentication Agent installation and registration operations.</span></span> <span data-ttu-id="02ff3-184">Esiste un problema noto con gli account amministratore globale con autenticazione MFA abilitata: disattivare l'autenticazione MFA temporaneamente (solo per completare le operazioni) come soluzione alternativa.</span><span class="sxs-lookup"><span data-stu-id="02ff3-184">There is a known issue with MFA-enabled Global Administrator accounts; turn off MFA temporarily (only to complete the operations) as a workaround.</span></span>

### <a name="an-unexpected-error-occurred"></a><span data-ttu-id="02ff3-185">Si è verificato un errore imprevisto</span><span class="sxs-lookup"><span data-stu-id="02ff3-185">An unexpected error occurred</span></span>

<span data-ttu-id="02ff3-186">[Raccogliere i registri dell'agente](#collecting-pass-through-authentication-agent-logs) dal server e contattare il supporto tecnico Microsoft per risolvere il problema.</span><span class="sxs-lookup"><span data-stu-id="02ff3-186">[Collect agent logs](#collecting-pass-through-authentication-agent-logs) from the server and contact Microsoft Support with your issue.</span></span>

## <a name="authentication-agent-uninstallation-issues"></a><span data-ttu-id="02ff3-187">Problemi di disinstallazione dell'agente di autenticazione</span><span class="sxs-lookup"><span data-stu-id="02ff3-187">Authentication Agent uninstallation issues</span></span>

### <a name="warning-message-when-uninstalling-azure-ad-connect"></a><span data-ttu-id="02ff3-188">Messaggio di avviso quando si disinstalla Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="02ff3-188">Warning message when uninstalling Azure AD Connect</span></span>

<span data-ttu-id="02ff3-189">Se l'autenticazione pass-through è abilitata nel tenant e si tenta di disinstallare Azure AD Connect, un messaggio di avviso indica che gli utenti non potranno accedere ad Azure AD se non sono installati altri agenti di autenticazione pass-through in altri server.</span><span class="sxs-lookup"><span data-stu-id="02ff3-189">If you have Pass-through Authentication enabled on your tenant and you try to uninstall Azure AD Connect, it shows you the following warning message: "Users will not be able to sign-in to Azure AD unless you have other Pass-through Authentication agents installed on other servers."</span></span>

<span data-ttu-id="02ff3-190">Verificare che l'installazione in uso sia a [disponibilità elevata](active-directory-aadconnect-pass-through-authentication-quick-start.md#step-5-ensure-high-availability) prima di disinstallare Azure AD Connect per evitare interruzioni degli accessi utente.</span><span class="sxs-lookup"><span data-stu-id="02ff3-190">Ensure that your setup is [high available](active-directory-aadconnect-pass-through-authentication-quick-start.md#step-5-ensure-high-availability) before you uninstall Azure AD Connect to avoid breaking user sign-in.</span></span>

## <a name="issues-with-enabling-the-feature"></a><span data-ttu-id="02ff3-191">Problemi con l'abilitazione della funzionalità</span><span class="sxs-lookup"><span data-stu-id="02ff3-191">Issues with enabling the feature</span></span>

### <a name="enabling-the-feature-failed-because-there-were-no-authentication-agents-available"></a><span data-ttu-id="02ff3-192">L'abilitazione della funzionalità non è riuscita perché non erano disponibili agenti di autenticazione</span><span class="sxs-lookup"><span data-stu-id="02ff3-192">Enabling the feature failed because there were no Authentication Agents available</span></span>

<span data-ttu-id="02ff3-193">È necessario che sia attivo almeno un agente di autenticazione per abilitare l'autenticazione pass-through nel tenant.</span><span class="sxs-lookup"><span data-stu-id="02ff3-193">You need to have at least one active Authentication Agent to enable Pass-through Authentication on your tenant.</span></span> <span data-ttu-id="02ff3-194">È possibile installare sia un agente di autenticazione di Azure AD Connect sia un agente di autenticazione autonomo.</span><span class="sxs-lookup"><span data-stu-id="02ff3-194">You can install an Authentication Agent by either installing Azure AD Connect or a standalone Authentication Agent.</span></span>

### <a name="enabling-the-feature-failed-due-to-blocked-ports"></a><span data-ttu-id="02ff3-195">L'abilitazione della funzionalità non è riuscita a causa di porte bloccate</span><span class="sxs-lookup"><span data-stu-id="02ff3-195">Enabling the feature failed due to blocked ports</span></span>

<span data-ttu-id="02ff3-196">Assicurasi che il server in cui è installato Azure AD Connect possa comunicare con gli URL del nostro servizio e le porte elencate [qui](active-directory-aadconnect-pass-through-authentication-quick-start.md#step-1-check-prerequisites).</span><span class="sxs-lookup"><span data-stu-id="02ff3-196">Ensure that the server on which Azure AD Connect is installed can communicate with our service URLs and ports listed [here](active-directory-aadconnect-pass-through-authentication-quick-start.md#step-1-check-prerequisites).</span></span>

### <a name="enabling-the-feature-failed-due-to-token-or-account-authorization-errors"></a><span data-ttu-id="02ff3-197">L'abilitazione della funzionalità non è riuscita a causa di errori di autorizzazione dell'account o del token</span><span class="sxs-lookup"><span data-stu-id="02ff3-197">Enabling the feature failed due to token or account authorization errors</span></span>

<span data-ttu-id="02ff3-198">Assicurarsi di usare un account amministratore globale solo cloud quando si abilita la funzionalità.</span><span class="sxs-lookup"><span data-stu-id="02ff3-198">Ensure that you use a cloud-only Global Administrator account when enabling the feature.</span></span> <span data-ttu-id="02ff3-199">Esiste un problema noto con gli account amministratore globale con autenticazione MFA abilitata: disattivare l'autenticazione MFA temporaneamente (solo per completare le operazioni) come soluzione alternativa.</span><span class="sxs-lookup"><span data-stu-id="02ff3-199">There is a known issue with multi-factor authentication (MFA)-enabled Global Administrator accounts; turn off MFA temporarily (only to complete the operation) as a workaround.</span></span>

## <a name="exchange-activesync-configuration-issues"></a><span data-ttu-id="02ff3-200">Problemi di configurazione di Exchange ActiveSync</span><span class="sxs-lookup"><span data-stu-id="02ff3-200">Exchange ActiveSync configuration issues</span></span>

<span data-ttu-id="02ff3-201">Questi sono i problemi comuni quando si configura il supporto di Exchange ActiveSync per l'autenticazione pass-through.</span><span class="sxs-lookup"><span data-stu-id="02ff3-201">These are the common issues when you configure Exchange ActiveSync support for Pass-through Authentication.</span></span>

### <a name="exchange-powershell-issue"></a><span data-ttu-id="02ff3-202">Problema relativo a PowerShell per Exchange</span><span class="sxs-lookup"><span data-stu-id="02ff3-202">Exchange PowerShell issue</span></span>

<span data-ttu-id="02ff3-203">Se viene restituito l'errore "**Impossibile trovare un parametro corrispondente al nome 'PerTenantSwitchToESTSEnabled'\.**"</span><span class="sxs-lookup"><span data-stu-id="02ff3-203">If you see the "**A parameter cannot be found that matches parameter name 'PerTenantSwitchToESTSEnabled'\.**"</span></span> <span data-ttu-id="02ff3-204">quando si esegue il comando `Set-OrganizationConfig` di PowerShell per Exchange, contattare il supporto Microsoft.</span><span class="sxs-lookup"><span data-stu-id="02ff3-204">error when you run the `Set-OrganizationConfig` Exchange PowerShell command, contact Microsoft Support.</span></span>

### <a name="exchange-activesync-not-working"></a><span data-ttu-id="02ff3-205">Exchange ActiveSync non funziona</span><span class="sxs-lookup"><span data-stu-id="02ff3-205">Exchange ActiveSync not working</span></span>

<span data-ttu-id="02ff3-206">L'applicazione della configurazione richiede tempo. Il periodo di tempo dipende dall'ambiente.</span><span class="sxs-lookup"><span data-stu-id="02ff3-206">The configuration takes some time to take effect - the time period depends on your environment.</span></span> <span data-ttu-id="02ff3-207">Se il problema persiste a lungo, contattare il supporto Microsoft.</span><span class="sxs-lookup"><span data-stu-id="02ff3-207">If the situation persists for a long time, contact Microsoft Support.</span></span>

## <a name="collecting-pass-through-authentication-agent-logs"></a><span data-ttu-id="02ff3-208">Raccolta dei registri dell'agente di autenticazione pass-through</span><span class="sxs-lookup"><span data-stu-id="02ff3-208">Collecting Pass-through Authentication Agent logs</span></span>

<span data-ttu-id="02ff3-209">In base al tipo di problema, i registri dell'agente di autenticazione pass-through vanno cercati in posizioni diverse.</span><span class="sxs-lookup"><span data-stu-id="02ff3-209">Depending on the type of issue you may have, you need to look in different places for Pass-through Authentication Agent logs.</span></span>

### <a name="authentication-agent-event-logs"></a><span data-ttu-id="02ff3-210">Registri eventi dell'agente di autenticazione</span><span class="sxs-lookup"><span data-stu-id="02ff3-210">Authentication Agent event logs</span></span>

<span data-ttu-id="02ff3-211">Per gli errori correlati all'agente di autenticazione aprire l'applicazione Visualizzatore eventi sul server e controllare in **Application and Service Logs\Microsoft\AzureAdConnect\AuthenticationAgent\Admin**.</span><span class="sxs-lookup"><span data-stu-id="02ff3-211">For errors related to the Authentication Agent, open up the Event Viewer application on the server and check under **Application and Service Logs\Microsoft\AzureAdConnect\AuthenticationAgent\Admin**.</span></span>

<span data-ttu-id="02ff3-212">Per un'analisi dettagliata, abilitare il registro "Session".</span><span class="sxs-lookup"><span data-stu-id="02ff3-212">For detailed analytics, enable the "Session" log.</span></span> <span data-ttu-id="02ff3-213">Non eseguire l'agente di autenticazione con questo registro abilitato durante il funzionamento normale, usarlo solo per la risoluzione dei problemi.</span><span class="sxs-lookup"><span data-stu-id="02ff3-213">Don't run the Authentication Agent with this log enabled during normal operations; use only for troubleshooting.</span></span> <span data-ttu-id="02ff3-214">Il contenuto del registro è visibile solo dopo che il registro è stato nuovamente disattivato.</span><span class="sxs-lookup"><span data-stu-id="02ff3-214">The log contents are only visible after the log is disabled again.</span></span>

### <a name="detailed-trace-logs"></a><span data-ttu-id="02ff3-215">Log di traccia dettagliati</span><span class="sxs-lookup"><span data-stu-id="02ff3-215">Detailed trace logs</span></span>

<span data-ttu-id="02ff3-216">Per risolvere gli errori di accesso utente, esaminare i registri di traccia in **%programdata%\Microsoft\Azure AD Connect Authentication Agent\Trace\\**.</span><span class="sxs-lookup"><span data-stu-id="02ff3-216">To troubleshoot user sign-in failures, look for trace logs at **%programdata%\Microsoft\Azure AD Connect Authentication Agent\Trace\\**.</span></span> <span data-ttu-id="02ff3-217">Questi log includono i motivi per cui l'accesso di un utente specifico non è riuscito tramite la funzionalità di autenticazione pass-through.</span><span class="sxs-lookup"><span data-stu-id="02ff3-217">These logs include reasons why a specific user sign-in failed using the Pass-through Authentication feature.</span></span> <span data-ttu-id="02ff3-218">Questi errori sono anche associati ai motivi degli errori di accesso indicati nella [tabella](#sign-in-failure-reasons-on-the-Azure-portal) precedente.</span><span class="sxs-lookup"><span data-stu-id="02ff3-218">These errors are also mapped to the sign-in failure reasons shown in the preceding [table](#sign-in-failure-reasons-on-the-Azure-portal).</span></span> <span data-ttu-id="02ff3-219">Di seguito è riportato un esempio di voce di registro:</span><span class="sxs-lookup"><span data-stu-id="02ff3-219">Following is an example log entry:</span></span>

```
    AzureADConnectAuthenticationAgentService.exe Error: 0 : Passthrough Authentication request failed. RequestId: 'df63f4a4-68b9-44ae-8d81-6ad2d844d84e'. Reason: '1328'.
        ThreadId=5
        DateTime=xxxx-xx-xxTxx:xx:xx.xxxxxxZ
```

<span data-ttu-id="02ff3-220">È possibile ottenere una descrizione dettagliata dell'errore, "1328" nell'esempio precedente, aprendo il prompt dei comandi ed eseguendo il comando seguente (sostituire "1328" con il numero di errore effettivo visualizzato nei registri):</span><span class="sxs-lookup"><span data-stu-id="02ff3-220">You can get descriptive details of the error ('1328' in the preceding example) by opening up the command prompt and running the following command (Note: Replace '1328' with the actual error number that you see in your logs):</span></span>

`Net helpmsg 1328`

![Autenticazione pass-through](./media/active-directory-aadconnect-pass-through-authentication/pta3.png)

### <a name="domain-controller-logs"></a><span data-ttu-id="02ff3-222">Log del controller di dominio</span><span class="sxs-lookup"><span data-stu-id="02ff3-222">Domain Controller logs</span></span>

<span data-ttu-id="02ff3-223">Se la registrazione di controllo è abilitata, sono disponibili informazioni aggiuntive nei log di sicurezza dei controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="02ff3-223">If audit logging is enabled, additional information can be found in the security logs of your Domain Controllers.</span></span> <span data-ttu-id="02ff3-224">Un modo semplice per eseguire query sulle richieste di accesso inviate dagli agenti di autenticazione pass-through è il seguente:</span><span class="sxs-lookup"><span data-stu-id="02ff3-224">A simple way to query sign-in requests sent by Pass-through Authentication Agents is as follows:</span></span>

```
    <QueryList>
    <Query Id="0" Path="Security">
    <Select Path="Security">*[EventData[Data[@Name='ProcessName'] and (Data='C:\Program Files\Microsoft Azure AD Connect Authentication Agent\AzureADConnectAuthenticationAgentService.exe')]]</Select>
    </Query>
    </QueryList>
```

### <a name="performance-monitor-counters"></a><span data-ttu-id="02ff3-225">Contatori di Performance Monitor</span><span class="sxs-lookup"><span data-stu-id="02ff3-225">Performance Monitor counters</span></span>

<span data-ttu-id="02ff3-226">Un altro metodo per monitorare gli agenti di autenticazione consiste nel monitorare contatori di Performance Monitor specifici in ogni server in cui è installato l'agente di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="02ff3-226">Another way to monitor Authentication Agents is to track specific Performance Monitor counters on each server where the Authentication Agent is installed.</span></span> <span data-ttu-id="02ff3-227">Usare i contatori globali (relativi a **numero di autenticazioni pass-through**, **numero di autenticazioni pass-through non riuscite** e **numero di autenticazioni pass-through riuscite**) e i contatori di errori (relativi a **numero di errori di autenticazione pass-through**) seguenti:</span><span class="sxs-lookup"><span data-stu-id="02ff3-227">Use the following Global counters (**# PTA authentications**, **#PTA failed authentications** and **#PTA successful authentications**) and Error counters (**# PTA authentication errors**):</span></span>

![Contatori di Performance Monitor per l'autenticazione pass-through](./media/active-directory-aadconnect-pass-through-authentication/pta12.png)

>[!IMPORTANT]
><span data-ttu-id="02ff3-229">L'autenticazione pass-through fornisce disponibilità elevata tramite più agenti di autenticazione, _senza_ il bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="02ff3-229">Pass-through Authentication provides high availability using multiple Authentication Agents, and _not_ load balancing.</span></span> <span data-ttu-id="02ff3-230">A seconda della configurazione, _non_ tutti gli agenti di autenticazione ricevono all'incirca un numero _uguale_ di richieste.</span><span class="sxs-lookup"><span data-stu-id="02ff3-230">Depending on your configuration, _not_ all your Authentication Agents receive roughly _equal_ number of requests.</span></span> <span data-ttu-id="02ff3-231">È possibile che un agente di autenticazione specifico non riceva traffico del tutto.</span><span class="sxs-lookup"><span data-stu-id="02ff3-231">It is possible that a specific Authentication Agent receives no traffic at all.</span></span>
