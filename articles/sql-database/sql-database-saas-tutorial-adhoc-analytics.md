---
title: "query di analitica aaaRun ad hoc in più database SQL di Azure | Documenti Microsoft"
description: "Eseguire query ad hoc analitica tra più database SQL in app di hello Wingtip SaaS multi-tenant."
keywords: esercitazione database SQL
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/23/2017
ms.author: billgib; sstein
ms.openlocfilehash: 140cd51fdd03b5a548147282b51ceb0ad80c944d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="run-ad-hoc-analytics-queries-across-all-wingtip-saas-tenants"></a><span data-ttu-id="aefd6-104">Eseguire query di analisi ad-hoc su tutti i tenant SaaS Wingtip</span><span class="sxs-lookup"><span data-stu-id="aefd6-104">Run ad-hoc analytics queries across all Wingtip SaaS tenants</span></span>

<span data-ttu-id="aefd6-105">In questa esercitazione, eseguire le query distribuite tra l'intero set di database di tenant di hello tooenable ad hoc analitica.</span><span class="sxs-lookup"><span data-stu-id="aefd6-105">In this tutorial, you run distributed queries across hello entire set of tenant databases tooenable ad-hoc analytics.</span></span> <span data-ttu-id="aefd6-106">Query elastico è usato tooenable distribuita query, che richiede un database aggiuntivo analitica viene distribuito (server di catalogo toohello).</span><span class="sxs-lookup"><span data-stu-id="aefd6-106">Elastic Query is used tooenable distributed queries, which requires an additional analytics database is deployed (toohello catalog server).</span></span> <span data-ttu-id="aefd6-107">Queste query possono estrarre informazioni far parte di hello quotidiane sui dati operativi di app SaaS Wingtip hello.</span><span class="sxs-lookup"><span data-stu-id="aefd6-107">These queries can extract insights buried in hello day-to-day operational data of hello Wingtip SaaS app.</span></span>


<span data-ttu-id="aefd6-108">In questa esercitazione si apprenderà:</span><span class="sxs-lookup"><span data-stu-id="aefd6-108">In this tutorial you learn:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="aefd6-109">Informazioni sulle viste globali di hello in ogni database, che consentono l'esecuzione di query efficienti tra tenant</span><span class="sxs-lookup"><span data-stu-id="aefd6-109">About hello global views in each database, that enable efficient querying across tenants</span></span>
> * <span data-ttu-id="aefd6-110">Come toodeploy un database analitica ad hoc</span><span class="sxs-lookup"><span data-stu-id="aefd6-110">How toodeploy an ad-hoc analytics database</span></span>
> * <span data-ttu-id="aefd6-111">Come toorun query distribuite tra tutti i database tenant</span><span class="sxs-lookup"><span data-stu-id="aefd6-111">How toorun distributed queries across all tenant databases</span></span>



<span data-ttu-id="aefd6-112">toocomplete completamento di questa esercitazione, assicurarsi che i hello seguenti prerequisiti:</span><span class="sxs-lookup"><span data-stu-id="aefd6-112">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="aefd6-113">app SaaS Wingtip Hello viene distribuita.</span><span class="sxs-lookup"><span data-stu-id="aefd6-113">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="aefd6-114">toodeploy in meno di cinque minuti, vedere [Distribuisci ed esplorare l'applicazione SaaS Wingtip hello](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="aefd6-114">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="aefd6-115">Azure PowerShell è installato.</span><span class="sxs-lookup"><span data-stu-id="aefd6-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="aefd6-116">Per informazioni dettagliate, vedere [Introduzione ad Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="aefd6-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>
* <span data-ttu-id="aefd6-117">SQL Server Management Studio (SSMS) è installato.</span><span class="sxs-lookup"><span data-stu-id="aefd6-117">SQL Server Management Studio (SSMS) is installed.</span></span> <span data-ttu-id="aefd6-118">toodownload e installare SQL Server Management Studio, vedere [scaricare SQL Server Management Studio (SQL Server Management Studio)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span><span class="sxs-lookup"><span data-stu-id="aefd6-118">toodownload and install SSMS, see [Download SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span></span>


## <a name="ad-hoc-analytics-pattern"></a><span data-ttu-id="aefd6-119">Modello di analisi ad hoc</span><span class="sxs-lookup"><span data-stu-id="aefd6-119">Ad-hoc analytics pattern</span></span>

<span data-ttu-id="aefd6-120">Uno dei hello delle opportunità con applicazioni SaaS è quantità hello toouse di dati archiviati centralmente nel cloud hello del tenant.</span><span class="sxs-lookup"><span data-stu-id="aefd6-120">One of hello great opportunities with SaaS applications is toouse hello vast amount of tenant data stored centrally in hello cloud.</span></span> <span data-ttu-id="aefd6-121">Utilizzare questo dati toogain approfondite operazione hello e l'utilizzo di applicazione, i tenant, i relativi utenti, le preferenze, comportamenti, e così via. Queste informazioni possono essere utili come base per progettare sviluppi futuri, miglioramenti dell'usabilità e altri investimenti per app e servizi.</span><span class="sxs-lookup"><span data-stu-id="aefd6-121">Use this data toogain insights into hello operation and usage of your application, your tenants, their users, preferences, behaviors, etc. These insights can guide feature development, usability improvements, and other investments in your apps and services.</span></span>

<span data-ttu-id="aefd6-122">L'accesso a questi dati è semplice quando sono raccolti in un singolo database multi-tenant, ma non è altrettanto semplice in una distribuzione su larga scala potenzialmente in migliaia di database.</span><span class="sxs-lookup"><span data-stu-id="aefd6-122">Accessing this data in a single multi-tenant database is easy, but not so easy when distributed at scale across potentially thousands of databases.</span></span> <span data-ttu-id="aefd6-123">Un approccio consiste toouse [Query elastico](sql-database-elastic-query-overview.md), che consente l'esecuzione di query su un set distribuito di database con schema comune.</span><span class="sxs-lookup"><span data-stu-id="aefd6-123">One approach is toouse [Elastic Query](sql-database-elastic-query-overview.md), which enables querying across a distributed set of databases with common schema.</span></span> <span data-ttu-id="aefd6-124">Query elastico utilizza un singolo *head* database in cui sono definite le tabelle esterne che mirror tabelle o viste in hello distribuiti database (tenant).</span><span class="sxs-lookup"><span data-stu-id="aefd6-124">Elastic Query uses a single *head* database in which external tables are defined that mirror tables or views in hello distributed (tenant) databases.</span></span> <span data-ttu-id="aefd6-125">Le query inviate toothis head database è tooproduce compilato un piano di query distribuite con parti di query hello propagati database tenant toohello in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="aefd6-125">Queries submitted toothis head database are compiled tooproduce a distributed query plan, with portions of hello query pushed down toohello tenant databases as needed.</span></span> <span data-ttu-id="aefd6-126">Query elastico utilizza mappa partizioni hello hello catalogo database tooprovide hello il percorso del database tenant hello.</span><span class="sxs-lookup"><span data-stu-id="aefd6-126">Elastic Query uses hello shard map in hello catalog database tooprovide hello location of hello tenant databases.</span></span> <span data-ttu-id="aefd6-127">La configurazione e l'esecuzione di query sono semplici con il linguaggio [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference) standard e sono supportate query ad hoc da strumenti come Power BI ed Excel.</span><span class="sxs-lookup"><span data-stu-id="aefd6-127">Setup and query are straightforward using standard [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference), and support ad-hoc querying from tools like Power BI and Excel.</span></span>

<span data-ttu-id="aefd6-128">Distribuendo le query tra database tenant hello, elastico Query fornisce informazioni dettagliate immediate sui dati di produzione in tempo reale.</span><span class="sxs-lookup"><span data-stu-id="aefd6-128">By distributing queries across hello tenant databases, Elastic Query provides immediate insight into live production data.</span></span> <span data-ttu-id="aefd6-129">Tuttavia, come Query elastico estrae i dati da molti database, latenza a volte può essere superiore per le query equivalente query inviati tooa singolo database di multi-tenant.</span><span class="sxs-lookup"><span data-stu-id="aefd6-129">However, as Elastic Query pulls data from potentially many databases, query latency can sometimes be higher than for equivalent queries submitted tooa single multi-tenant database.</span></span> <span data-ttu-id="aefd6-130">Deve prestare attenzione quando si progetta una query toominimize hello i dati restituiti.</span><span class="sxs-lookup"><span data-stu-id="aefd6-130">Care should be taken when designing queries toominimize hello data that is returned.</span></span> <span data-ttu-id="aefd6-131">Query elastico è spesso adatto principalmente per piccole quantità di dati in tempo reale, l'esecuzione di query anziché toobuilding utilizzati di frequente, le query complesse analitica o report.</span><span class="sxs-lookup"><span data-stu-id="aefd6-131">Elastic Query is often best suited for querying small amounts of real-time data, as opposed toobuilding frequently used or complex analytics queries or reports.</span></span> <span data-ttu-id="aefd6-132">Se le query non eseguono correttamente, esaminare hello [piano di esecuzione](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) toosee quale parte di query hello è stato inserito il database remoto toohello e viene restituita la quantità di dati.</span><span class="sxs-lookup"><span data-stu-id="aefd6-132">If queries don't perform well, look at hello [execution plan](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) toosee what part of hello query has been pushed down toohello remote database and how much data is being returned.</span></span> <span data-ttu-id="aefd6-133">Per ottenere un servizio migliore per le query che richiedono un'elaborazione analitica complessa, in alcuni casi è consigliabile estrarre i dati tenant in un database dedicato o in un data warehouse ottimizzato per le query analitiche.</span><span class="sxs-lookup"><span data-stu-id="aefd6-133">Queries that require complex analytical processing may be better served in some cases by extracting tenant data into a dedicated database or data warehouse optimized for analytics queries.</span></span> <span data-ttu-id="aefd6-134">Questo modello è illustrato in hello [esercitazione analitica tenant](sql-database-saas-tutorial-tenant-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="aefd6-134">This pattern is explained in hello [tenant analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md).</span></span> 

## <a name="get-hello-wingtip-application-scripts"></a><span data-ttu-id="aefd6-135">Ottenere script per l'applicazione hello Wingtip</span><span class="sxs-lookup"><span data-stu-id="aefd6-135">Get hello Wingtip application scripts</span></span>

<span data-ttu-id="aefd6-136">Hello Wingtip SaaS script e codice sorgente dell'applicazione sono disponibili in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) repository github.</span><span class="sxs-lookup"><span data-stu-id="aefd6-136">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="aefd6-137">[I passaggi di script di SaaS Wingtip hello toodownload](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="aefd6-137">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="create-ticket-sales-data"></a><span data-ttu-id="aefd6-138">Creare i dati di vendita dei biglietti</span><span class="sxs-lookup"><span data-stu-id="aefd6-138">Create ticket sales data</span></span>

<span data-ttu-id="aefd6-139">toorun esegue query su un set di dati più interessante, creare i dati di vendita ticket eseguendo il ticket hello-generatore.</span><span class="sxs-lookup"><span data-stu-id="aefd6-139">toorun queries against a more interesting data set, create ticket sales data by running hello ticket-generator.</span></span>

1. <span data-ttu-id="aefd6-140">In hello *PowerShell ISE*aprire hello... \\Moduli learning\\Analitica Operational\\Analitica ad hoc\\*Demo AdhocAnalytics.ps1* script e impostare hello seguenti valori:</span><span class="sxs-lookup"><span data-stu-id="aefd6-140">In hello *PowerShell ISE*, open hello ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* script and set hello following values:</span></span>
   * <span data-ttu-id="aefd6-141">**$DemoScenario** = 1, **Acquistare biglietti per gli eventi in tutte le sedi**.</span><span class="sxs-lookup"><span data-stu-id="aefd6-141">**$DemoScenario** = 1, **Purchase tickets for events at all venues**.</span></span>
2. <span data-ttu-id="aefd6-142">Premere **F5** per eseguire script hello e generare le vendite di ticket.</span><span class="sxs-lookup"><span data-stu-id="aefd6-142">Press **F5** to run hello script and generate ticket sales.</span></span> <span data-ttu-id="aefd6-143">Durante l'esecuzione di script hello continuare passaggi hello in questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="aefd6-143">While hello script is running, continue hello steps in this tutorial.</span></span> <span data-ttu-id="aefd6-144">viene eseguita una query di dati del ticket Hello in hello *eseguire query ad hoc distribuita* sezione, quindi attendere hello ticket generatore toocomplete se è ancora in esecuzione quando si otterrà toothat esercizio.</span><span class="sxs-lookup"><span data-stu-id="aefd6-144">hello ticket data is queried in hello *Run ad-hoc distributed queries* section, so wait for hello ticket generator toocomplete if it's still running when you get toothat exercise.</span></span>

## <a name="explore-hello-global-views"></a><span data-ttu-id="aefd6-145">Esplorazione delle viste globali hello</span><span class="sxs-lookup"><span data-stu-id="aefd6-145">Explore hello global views</span></span>

<span data-ttu-id="aefd6-146">applicazione SaaS Wingtip Hello viene creato utilizzando un modello di database per ogni tenant, in modo che lo schema del database tenant hello è definito da una prospettiva single-tenant.</span><span class="sxs-lookup"><span data-stu-id="aefd6-146">hello Wingtip SaaS application is built using a tenant-per-database model, so hello tenant database schema is defined from a single-tenant perspective.</span></span> <span data-ttu-id="aefd6-147">Le informazioni specifiche sul tenant sono presenti in una sola tabella *Venue*, che contiene sempre una singola riga ed è implementata come heap, senza una chiave primaria.</span><span class="sxs-lookup"><span data-stu-id="aefd6-147">Tenant-specific information exists in one table, *Venue*, which always has a single row, and is implemented as a heap, without a primary key.</span></span> <span data-ttu-id="aefd6-148">Non è necessario aprire altre tabelle nello schema hello toobe correlati toohello *luogo* tabella, perché in uso normale, non è mai dubbi tenant hello dati appartengono.</span><span class="sxs-lookup"><span data-stu-id="aefd6-148">Other tables in hello schema don't need toobe related toohello *Venue* table, because in normal use, there is never any doubt which tenant hello data belongs to.</span></span>

<span data-ttu-id="aefd6-149">Tuttavia, quando si eseguono query in tutti i database, è importante che Query elastico può gestire dati hello come se fosse parte di un singolo database logico partizionato dal tenant.</span><span class="sxs-lookup"><span data-stu-id="aefd6-149">However, when querying across all databases, it's important that Elastic Query can treat hello data as if it is part of a single logical database sharded by tenant.</span></span> <span data-ttu-id="aefd6-150">tooachieve questo set di viste 'globale' sono database tenant toohello aggiunto che un id tenant del progetto in ognuna delle tabelle di hello che vengono eseguita una query a livello globale.</span><span class="sxs-lookup"><span data-stu-id="aefd6-150">tooachieve this, a set of 'global' views are added toohello tenant database that project a tenant id into each of hello tables that are queried globally.</span></span> <span data-ttu-id="aefd6-151">Ad esempio, hello *VenueEvents* visualizzazione aggiunge calcolato *VenueId* toohello colonne proiettata dai hello *eventi* tabella.</span><span class="sxs-lookup"><span data-stu-id="aefd6-151">For example, hello *VenueEvents* view adds a computed *VenueId* toohello columns projected from hello *Events* table.</span></span> <span data-ttu-id="aefd6-152">Mediante la definizione di tabella esterna di hello nel database head hello su *VenueEvents* (anziché hello sottostante *eventi* tabella), Query elastico è in grado di toopush verso il basso di join basati su *VenueId* affinché possano essere eseguite in parallelo in ogni database remoto (anziché nel database head hello).</span><span class="sxs-lookup"><span data-stu-id="aefd6-152">By defining hello external table in hello head database over *VenueEvents* (rather than hello underlying *Events* table), Elastic Query is able toopush down joins based on *VenueId* so they can be executed in parallel on each remote database (rather than on hello head database).</span></span> <span data-ttu-id="aefd6-153">Questo riduce notevolmente hello quantità di dati viene restituiti, che comporta un miglioramento significativo delle prestazioni per molte query.</span><span class="sxs-lookup"><span data-stu-id="aefd6-153">This dramatically reduces hello amount of data that is returned, which results in a substantial increase in performance for many queries.</span></span> <span data-ttu-id="aefd6-154">Queste viste globali sono state già create in tutti i database tenant e in *basetenantdb*.</span><span class="sxs-lookup"><span data-stu-id="aefd6-154">These global views have been pre-created in all tenant databases (and in *basetenantdb*).</span></span>

1. <span data-ttu-id="aefd6-155">Aprire SQL Server Management Studio e [connessione toohello tenants1 -&lt;utente&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span><span class="sxs-lookup"><span data-stu-id="aefd6-155">Open SSMS and [connect toohello tenants1-&lt;USER&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span></span>
2. <span data-ttu-id="aefd6-156">Espandere **Database**, fare clic con il pulsante destro del mouse su **contosoconcerthall** e selezionare **Nuova query**.</span><span class="sxs-lookup"><span data-stu-id="aefd6-156">Expand **Databases**, right-click **contosoconcerthall**, and select **New Query**.</span></span>
3. <span data-ttu-id="aefd6-157">Eseguire hello differenza hello tooexplore di query tra tabelle single-tenant hello e viste globali hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="aefd6-157">Run hello following queries tooexplore hello difference between hello single-tenant tables and hello global views:</span></span>

   ```T-SQL
   -- hello base Venue table, that has no VenueId associated.
   SELECT * FROM Venue

   -- Notice hello plural name 'Venues'. This view projects a VenueId column.
   SELECT * FROM Venues

   -- hello base Events table, which has no VenueId column.
   SELECT * FROM Events

   -- This view projects hello VenueId retrieved from hello Venues table.
   SELECT * FROM VenueEvents
   ```

<span data-ttu-id="aefd6-158">In queste visualizzazioni, hello *VenueId* viene calcolata come un hash di nome per eventi hello, ma qualsiasi approccio potrebbe essere toointroduce utilizzato un valore univoco.</span><span class="sxs-lookup"><span data-stu-id="aefd6-158">In these views, hello *VenueId* is computed as a hash of hello Venue name, but any approach could be used toointroduce a unique value.</span></span> <span data-ttu-id="aefd6-159">Questo approccio è simile a toohello chiave del tenant hello viene calcolata per l'utilizzo nel catalogo di hello.</span><span class="sxs-lookup"><span data-stu-id="aefd6-159">This approach is similar toohello way hello tenant key is computed for use in hello catalog.</span></span>

<span data-ttu-id="aefd6-160">definizione di hello tooexamine di hello *eventi* Vista:</span><span class="sxs-lookup"><span data-stu-id="aefd6-160">tooexamine hello definition of hello *Venues* view:</span></span>

1. <span data-ttu-id="aefd6-161">In **Esplora oggetti** espandere **contosoconcethall** > **Viste**:</span><span class="sxs-lookup"><span data-stu-id="aefd6-161">In **Object Explorer**, expand **contosoconcethall** > **Views**:</span></span>

   ![Viste](media/sql-database-saas-tutorial-adhoc-analytics/views.png)

2. <span data-ttu-id="aefd6-163">Fare clic con il pulsante destro del mouse su **dbo.Venues**.</span><span class="sxs-lookup"><span data-stu-id="aefd6-163">Right-click **dbo.Venues**.</span></span>
3. <span data-ttu-id="aefd6-164">Selezionare **Crea script per vista** > **CREATE in** > **Nuova finestra editor di query**.</span><span class="sxs-lookup"><span data-stu-id="aefd6-164">Select **Script View as** > **CREATE To** > **New Query Editor Window**</span></span>

<span data-ttu-id="aefd6-165">Script qualsiasi altri hello *luogo* toosee Visualizza la modalità di aggiunta hello *VenueId*.</span><span class="sxs-lookup"><span data-stu-id="aefd6-165">Script any of hello other *Venue* views toosee how they add hello *VenueId*.</span></span>

## <a name="deploy-hello-database-used-for-ad-hoc-distributed-queries"></a><span data-ttu-id="aefd6-166">Distribuire database hello per le query distribuite ad hoc</span><span class="sxs-lookup"><span data-stu-id="aefd6-166">Deploy hello database used for ad-hoc distributed queries</span></span>

<span data-ttu-id="aefd6-167">Questo esercizio distribuisce hello *adhocanalytics* database.</span><span class="sxs-lookup"><span data-stu-id="aefd6-167">This exercise deploys hello *adhocanalytics* database.</span></span> <span data-ttu-id="aefd6-168">Si tratta di database hello head conterrà schema hello utilizzato per l'esecuzione di query in tutti i database tenant.</span><span class="sxs-lookup"><span data-stu-id="aefd6-168">This is hello head database that will contain hello schema used for querying across all tenant databases.</span></span> <span data-ttu-id="aefd6-169">database Hello è distribuito toohello esistente di server di catalogo, ovvero server hello utilizzato per i database relative alla gestione di app di esempio hello.</span><span class="sxs-lookup"><span data-stu-id="aefd6-169">hello database is deployed toohello existing catalog server, which is hello server used for all management-related databases in hello sample app.</span></span>

1. <span data-ttu-id="aefd6-170">Apri... \\Moduli learning\\Analitica Operational\\Analitica ad hoc\\*Demo AdhocAnalytics.ps1* in hello *PowerShell ISE* e hello set valori seguenti:</span><span class="sxs-lookup"><span data-stu-id="aefd6-170">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* in hello *PowerShell ISE* and set hello following values:</span></span>
   * <span data-ttu-id="aefd6-171">**$DemoScenario** = 2, **Distribuire un database di analisi ad hoc**.</span><span class="sxs-lookup"><span data-stu-id="aefd6-171">**$DemoScenario** = 2, **Deploy Ad-hoc analytics database**.</span></span>

2. <span data-ttu-id="aefd6-172">Premere **F5** toorun hello script e creare hello *adhocanalytics* database.</span><span class="sxs-lookup"><span data-stu-id="aefd6-172">Press **F5** toorun hello script and create hello *adhocanalytics* database.</span></span>

<span data-ttu-id="aefd6-173">Nella sezione successiva hello, aggiungere database toohello schema può quindi essere utilizzato toorun distribuita query.</span><span class="sxs-lookup"><span data-stu-id="aefd6-173">In hello next section, you add schema toohello database so it can be used toorun distributed queries.</span></span>

## <a name="configure-hello-database-for-running-distributed-queries"></a><span data-ttu-id="aefd6-174">Configurare il database di hello per l'esecuzione di query distribuite</span><span class="sxs-lookup"><span data-stu-id="aefd6-174">Configure hello database for running distributed queries</span></span>

<span data-ttu-id="aefd6-175">Questo esercizio aggiunge schema (origine dati esterna hello e definizioni di tabella esterna) toohello ad hoc analitica database consente l'esecuzione di query in tutti i database tenant.</span><span class="sxs-lookup"><span data-stu-id="aefd6-175">This exercise adds schema (hello external data source and external table definitions) toohello ad-hoc analytics database that enables querying across all tenant databases.</span></span>

1. <span data-ttu-id="aefd6-176">Aprire SQL Server Management Studio e connettersi toohello database Analitica ad hoc creato nel passaggio precedente hello.</span><span class="sxs-lookup"><span data-stu-id="aefd6-176">Open SQL Server Management Studio, and connect toohello Adhoc Analytics database you created in hello previous step.</span></span> <span data-ttu-id="aefd6-177">nome di Hello del database hello sarà adhocanalytics.</span><span class="sxs-lookup"><span data-stu-id="aefd6-177">hello name of hello database will be adhocanalytics.</span></span>
2. <span data-ttu-id="aefd6-178">Aprire ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *Initialize-AdhocAnalyticsDB.sql* in SSMS.</span><span class="sxs-lookup"><span data-stu-id="aefd6-178">Open ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *Initialize-AdhocAnalyticsDB.sql* in SSMS.</span></span>
3. <span data-ttu-id="aefd6-179">Rivedere lo script SQL hello e prendere nota delle seguenti hello:</span><span class="sxs-lookup"><span data-stu-id="aefd6-179">Review hello SQL script and note hello following:</span></span>

   <span data-ttu-id="aefd6-180">Elastico Query utilizza una credenziale con ambito database tooaccess ogni database tenant hello.</span><span class="sxs-lookup"><span data-stu-id="aefd6-180">Elastic Query uses a database-scoped credential tooaccess each of hello tenant databases.</span></span> <span data-ttu-id="aefd6-181">Questa credenziale deve toobe disponibile in tutti i database hello e deve essere concesse in genere necessari i diritti minimi hello tooenable queste query ad hoc.</span><span class="sxs-lookup"><span data-stu-id="aefd6-181">This credential needs toobe available in all hello databases and should normally be granted hello minimum rights required tooenable these ad-hoc queries.</span></span>

    ![creare le credenziali](media/sql-database-saas-tutorial-adhoc-analytics/create-credential.png)

   <span data-ttu-id="aefd6-183">Hello origine dati esterna, che viene definita mappa partizioni di toouse hello tenant nel database di catalogo hello.</span><span class="sxs-lookup"><span data-stu-id="aefd6-183">hello external data source, that is defined toouse hello tenant shard map in hello catalog database.</span></span> <span data-ttu-id="aefd6-184">Tramite questo come origine dati esterna hello, le query sono distribuiti tooall database registrati nel catalogo di hello quando viene eseguita la query hello.</span><span class="sxs-lookup"><span data-stu-id="aefd6-184">By using this as hello external data source, queries are distributed tooall databases registered in hello catalog when hello query is run.</span></span> <span data-ttu-id="aefd6-185">Poiché i nomi dei server sono diversi per ogni distribuzione, questo script di inizializzazione Ottiene il percorso di hello del database del catalogo hello tramite il recupero dei server corrente hello (@@servername) in cui viene eseguito uno script hello.</span><span class="sxs-lookup"><span data-stu-id="aefd6-185">Because server names are different for each deployment, this initialization script gets hello location of hello catalog database by retrieving hello current server (@@servername) where hello script is executed.</span></span>

    ![creare l'origine dati esterna](media/sql-database-saas-tutorial-adhoc-analytics/create-external-data-source.png)

   <span data-ttu-id="aefd6-187">tabelle esterne che fanno riferimento a viste globali di hello descritto nella sezione precedente hello e definita con Hello **distribuzione = SHARDED(VenueId)**.</span><span class="sxs-lookup"><span data-stu-id="aefd6-187">hello external tables that reference hello global views described in hello previous section, and defined with **DISTRIBUTION = SHARDED(VenueId)**.</span></span> <span data-ttu-id="aefd6-188">Poiché ogni *VenueId* tooa singolo database, viene eseguito il mapping Ciò migliora le prestazioni per molti scenari come illustrato nella sezione successiva hello.</span><span class="sxs-lookup"><span data-stu-id="aefd6-188">Because each *VenueId* maps tooa single database, this improves performance for many scenarios as shown in hello next section.</span></span>

    ![creare tabelle esterne](media/sql-database-saas-tutorial-adhoc-analytics/external-tables.png)

   <span data-ttu-id="aefd6-190">tabella locale Hello *VenueTypes* che viene creata e popolata.</span><span class="sxs-lookup"><span data-stu-id="aefd6-190">hello local table *VenueTypes* that is created and populated.</span></span> <span data-ttu-id="aefd6-191">Questa tabella di dati di riferimento è comune in tutti i database tenant, pertanto può essere rappresentato come una tabella locale e popolati con dati comuni hello.</span><span class="sxs-lookup"><span data-stu-id="aefd6-191">This reference data table is common in all tenant databases, so it can be represented here as a local table and populated with hello common data.</span></span> <span data-ttu-id="aefd6-192">Per alcune query questo potrebbe ridurre hello quantità di dati spostati tra i database tenant hello e hello *adhocanalytics* database.</span><span class="sxs-lookup"><span data-stu-id="aefd6-192">For some queries this may reduce hello amount of data moved between hello tenant databases and hello *adhocanalytics* database.</span></span>

    ![creare la tabella](media/sql-database-saas-tutorial-adhoc-analytics/create-table.png)

   <span data-ttu-id="aefd6-194">Se si includono tabelle di riferimento in questo modo, sia dati e schema della tabella hello tooupdate che ogni volta che si aggiornano i database tenant hello.</span><span class="sxs-lookup"><span data-stu-id="aefd6-194">If you include reference tables in this manner, be sure tooupdate hello table schema and data whenever you update hello tenant databases.</span></span>

4. <span data-ttu-id="aefd6-195">Premere **F5** toorun hello script e inizializzare hello *adhocanalytics* database.</span><span class="sxs-lookup"><span data-stu-id="aefd6-195">Press **F5** toorun hello script and initialize hello *adhocanalytics* database.</span></span> 

<span data-ttu-id="aefd6-196">È ora possibile eseguire query distribuite e ottenere informazioni dettagliate da tutti i tenant.</span><span class="sxs-lookup"><span data-stu-id="aefd6-196">Now you can run distributed queries, and gather insights across all tenants!</span></span>

## <a name="run-ad-hoc-distributed-queries"></a><span data-ttu-id="aefd6-197">Eseguire query distribuite ad hoc</span><span class="sxs-lookup"><span data-stu-id="aefd6-197">Run ad-hoc distributed queries</span></span>

<span data-ttu-id="aefd6-198">Ora che hello *adhocanalytics* database è impostato, vado Avanti ed eseguire alcune query distribuite.</span><span class="sxs-lookup"><span data-stu-id="aefd6-198">Now that hello *adhocanalytics* database is set up, go ahead and run some distributed queries.</span></span> <span data-ttu-id="aefd6-199">Includi piano di esecuzione hello per una migliore comprensione di in cui è in corso l'elaborazione delle query hello.</span><span class="sxs-lookup"><span data-stu-id="aefd6-199">Include hello execution plan for a better understanding of where hello query processing is happening.</span></span> 

<span data-ttu-id="aefd6-200">Quando si esamina il piano di esecuzione hello, passare il mouse sulle icone di hello piano per i dettagli.</span><span class="sxs-lookup"><span data-stu-id="aefd6-200">When inspecting hello execution plan, hover over hello plan icons for details.</span></span> 

<span data-ttu-id="aefd6-201">Toonote importanti, è l'impostazione **distribuzione = SHARDED(VenueId)** quando è definito l'origine dati esterna hello, migliora le prestazioni per molti scenari.</span><span class="sxs-lookup"><span data-stu-id="aefd6-201">Important toonote, is that setting **DISTRIBUTION = SHARDED(VenueId)** when we defined hello external data source, improves performance for many scenarios.</span></span> <span data-ttu-id="aefd6-202">Poiché ogni *VenueId* tooa viene eseguito il mapping solo database, il filtro è dati hello solo facilmente eseguite in modalità remota, la restituzione è necessario.</span><span class="sxs-lookup"><span data-stu-id="aefd6-202">Because each *VenueId* maps tooa single database, filtering is easily done remotely, returning only hello data we need.</span></span>

1. <span data-ttu-id="aefd6-203">Aprire ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalyticsQueries.sql* in SSMS.</span><span class="sxs-lookup"><span data-stu-id="aefd6-203">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalyticsQueries.sql* in SSMS.</span></span>
2. <span data-ttu-id="aefd6-204">Verificare di essere connesso toohello **adhocanalytics** database.</span><span class="sxs-lookup"><span data-stu-id="aefd6-204">Ensure you are connected toohello **adhocanalytics** database.</span></span>
3. <span data-ttu-id="aefd6-205">Seleziona hello **Query** menu e fare clic su **Includi piano di esecuzione effettivo**</span><span class="sxs-lookup"><span data-stu-id="aefd6-205">Select hello **Query** menu and click **Include Actual Execution Plan**</span></span>
4. <span data-ttu-id="aefd6-206">Evidenziare hello *quali eventi sono registrati?* query e premere **F5**.</span><span class="sxs-lookup"><span data-stu-id="aefd6-206">Highlight hello *Which venues are currently registered?* query, and press **F5**.</span></span>

   <span data-ttu-id="aefd6-207">query di Hello restituisce l'elenco di eventi intera hello, che illustra la modalità rapida ed è facile tooquery in tutti i dati restituiti da ogni tenant e tenant.</span><span class="sxs-lookup"><span data-stu-id="aefd6-207">hello query returns hello entire venue list, illustrating how quick and easy it is tooquery across all tenants and return data from each tenant.</span></span>

   <span data-ttu-id="aefd6-208">Esaminare il piano di hello e verificare che intero costo di hello è query remota hello perché siamo semplicemente database tenant di corso tooeach e selezionando informazioni luogo hello.</span><span class="sxs-lookup"><span data-stu-id="aefd6-208">Inspect hello plan and see that hello entire cost is hello remote query because we're simply going tooeach tenant database and selecting hello venue information.</span></span>

   ![SELECT * FROM dbo.Venues](media/sql-database-saas-tutorial-adhoc-analytics/query1-plan.png)

5. <span data-ttu-id="aefd6-210">La query successiva selezionare hello e premere **F5**.</span><span class="sxs-lookup"><span data-stu-id="aefd6-210">Select hello next query, and press **F5**.</span></span>

   <span data-ttu-id="aefd6-211">La query unisce i dati dal database tenant hello e hello locale *VenueTypes* tabella (locale, perché è una tabella di hello *adhocanalytics* database).</span><span class="sxs-lookup"><span data-stu-id="aefd6-211">This query joins data from hello tenant databases and hello local *VenueTypes* table (local, as its a table in hello *adhocanalytics* database).</span></span>

   <span data-ttu-id="aefd6-212">Esaminare il piano di hello e vedere tale hello maggioranza dei costi è query remota hello perché viene eseguita una query info per eventi di ciascun tenant (dbo. Eventi), quindi effettuare un rapido join locale con hello locale *VenueTypes* nome descrittivo della tabella toodisplay hello.</span><span class="sxs-lookup"><span data-stu-id="aefd6-212">Inspect hello plan and see that hello majority of cost is hello remote query because we query each tenant's venue info (dbo.Venues), and then do a quick local join with hello local *VenueTypes* table toodisplay hello friendly name.</span></span>

   ![Creare un join su dati remoti e locali](media/sql-database-saas-tutorial-adhoc-analytics/query2-plan.png)

6. <span data-ttu-id="aefd6-214">A questo punto selezionare hello *il giorno in cui sono stati hello la maggior parte dei ticket vendute?* query e premere **F5**.</span><span class="sxs-lookup"><span data-stu-id="aefd6-214">Now select hello *On which day were hello most tickets sold?* query, and press **F5**.</span></span>

   <span data-ttu-id="aefd6-215">Questa query esegue operazioni un po' più complesse di join e aggregazione.</span><span class="sxs-lookup"><span data-stu-id="aefd6-215">This query does a bit more complex joining and aggregation.</span></span> <span data-ttu-id="aefd6-216">Che cos'è toonote importante è che la maggior parte dell'elaborazione hello viene eseguita in modalità remota, e in questo caso, è ripristinare solo le righe di hello che è necessario restituire un'unica riga per il conteggio di vendita per ogni sessione ticket di aggregazione al giorno.</span><span class="sxs-lookup"><span data-stu-id="aefd6-216">What's important toonote is that most of hello processing is done remotely, and once again, we bring back only hello rows we need, returning just a single row for each venue's aggregate ticket sale count per day.</span></span>

   ![query](media/sql-database-saas-tutorial-adhoc-analytics/query3-plan.png)


## <a name="next-steps"></a><span data-ttu-id="aefd6-218">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="aefd6-218">Next steps</span></span>

<span data-ttu-id="aefd6-219">In questa esercitazione si è appreso come:</span><span class="sxs-lookup"><span data-stu-id="aefd6-219">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="aefd6-220">Eseguire query distribuite su tutti i database tenant</span><span class="sxs-lookup"><span data-stu-id="aefd6-220">Run distributed queries across all tenant databases</span></span>
> * <span data-ttu-id="aefd6-221">Distribuire un database analitica ad hoc e aggiungere le query di schema tooit toorun distribuita.</span><span class="sxs-lookup"><span data-stu-id="aefd6-221">Deploy an ad-hoc analytics database and add schema tooit toorun distributed queries.</span></span>


<span data-ttu-id="aefd6-222">Ora provare hello [esercitazione Tenant Analitica](sql-database-saas-tutorial-tenant-analytics.md) tooexplore l'estrazione dei dati tooa analitica separato database per l'elaborazione analitica più complessa...</span><span class="sxs-lookup"><span data-stu-id="aefd6-222">Now try hello [Tenant Analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md) tooexplore extracting data tooa separate analytics database for more complex analytics processing...</span></span>

## <a name="additional-resources"></a><span data-ttu-id="aefd6-223">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="aefd6-223">Additional resources</span></span>

* <span data-ttu-id="aefd6-224">Ulteriori [esercitazioni in cui si basano su hello applicazione SaaS Wingtip](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="aefd6-224">Additional [tutorials that build upon hello Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="aefd6-225">Query elastica</span><span class="sxs-lookup"><span data-stu-id="aefd6-225">Elastic Query</span></span>](sql-database-elastic-query-overview.md)
