---
title: Transazioni distribuite in database cloud
description: Panoramica delle transazioni di database elastico con il database SQL di Azure
services: sql-database
documentationcenter: 
author: torsteng
manager: jhubbard
editor: torsteng
ms.assetid: e14df7a3-7788-4cfb-bcd1-7ad6433ef1f9
ms.service: sql-database
ms.custom: scale out apps
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: sql-database
ms.date: 05/27/2016
ms.author: torsteng
ms.openlocfilehash: f7f1ad3f1933b39a0030a784cae40521254037d6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="distributed-transactions-across-cloud-databases"></a><span data-ttu-id="103bd-103">Transazioni distribuite in database cloud</span><span class="sxs-lookup"><span data-stu-id="103bd-103">Distributed transactions across cloud databases</span></span>
<span data-ttu-id="103bd-104">Le transazioni di database elastico per il database SQL di Azure consentono di eseguire transazioni estese a più database nel database SQL.</span><span class="sxs-lookup"><span data-stu-id="103bd-104">Elastic database transactions for Azure SQL Database (SQL DB) allow you to run transactions that span several databases in SQL DB.</span></span> <span data-ttu-id="103bd-105">Le transazioni di database elastico per il database SQL sono disponibili per le applicazioni .NET tramite ADO .NET e si integrano con la familiare esperienza di programmazione usando le classi [System.Transaction](https://msdn.microsoft.com/library/system.transactions.aspx) .</span><span class="sxs-lookup"><span data-stu-id="103bd-105">Elastic database transactions for SQL DB are available for .NET applications using ADO .NET and integrate with the familiar programming experience using the [System.Transaction](https://msdn.microsoft.com/library/system.transactions.aspx) classes.</span></span> <span data-ttu-id="103bd-106">Per ottenere la libreria, vedere [Microsoft .NET Framework 4.6.1 (programma di installazione Web)](https://www.microsoft.com/download/details.aspx?id=49981).</span><span class="sxs-lookup"><span data-stu-id="103bd-106">To get the library, see [.NET Framework 4.6.1 (Web Installer)](https://www.microsoft.com/download/details.aspx?id=49981).</span></span>

<span data-ttu-id="103bd-107">In locale questo scenario richiede in genere l'esecuzione di Microsoft Distributed Transaction Coordinator (MSDTC).</span><span class="sxs-lookup"><span data-stu-id="103bd-107">On premises, such a scenario usually required running Microsoft Distributed Transaction Coordinator (MSDTC).</span></span> <span data-ttu-id="103bd-108">Poiché MSDTC non è disponibile per le applicazioni PaaS (piattaforma distribuita come servizio) in Azure, ora la possibilità di coordinare le transazioni distribuite è integrata direttamente nel database SQL.</span><span class="sxs-lookup"><span data-stu-id="103bd-108">Since MSDTC is not available for Platform-as-a-Service application in Azure, the ability to coordinate distributed transactions has now been directly integrated into SQL DB.</span></span> <span data-ttu-id="103bd-109">Le applicazioni possono connettersi a qualsiasi database SQL per avviare transazioni distribuite e uno dei database coordina in modo trasparente la transazione distribuita, come illustrato nella figura seguente.</span><span class="sxs-lookup"><span data-stu-id="103bd-109">Applications can connect to any SQL Database to launch distributed transactions, and one of the databases will transparently coordinate the distributed transaction, as shown in the following figure.</span></span> 

  ![<span data-ttu-id="103bd-110">Transazioni distribuite con il database SQL di Azure tramite transazioni di database elastico</span><span class="sxs-lookup"><span data-stu-id="103bd-110">Distributed transactions with Azure SQL Database using elastic database transactions</span></span> ][1]

## <a name="common-scenarios"></a><span data-ttu-id="103bd-111">Scenari comuni</span><span class="sxs-lookup"><span data-stu-id="103bd-111">Common scenarios</span></span>
<span data-ttu-id="103bd-112">Le transazioni di database elastico per il database SQL consentono alle applicazioni di apportare modifiche atomiche ai dati archiviati in diversi database SQL.</span><span class="sxs-lookup"><span data-stu-id="103bd-112">Elastic database transactions for SQL DB enable applications to make atomic changes to data stored in several different SQL Databases.</span></span> <span data-ttu-id="103bd-113">L'anteprima è incentrata sulle esperienze di sviluppo sul lato client in C# e .NET.</span><span class="sxs-lookup"><span data-stu-id="103bd-113">The preview focuses on client-side development experiences in C# and .NET.</span></span> <span data-ttu-id="103bd-114">Un'esperienza sul lato server con T-SQL è prevista per un momento successivo.</span><span class="sxs-lookup"><span data-stu-id="103bd-114">A server-side experience using T-SQL is planned for a later time.</span></span>  
<span data-ttu-id="103bd-115">Le transazioni di database elastico sono destinate agli scenari seguenti:</span><span class="sxs-lookup"><span data-stu-id="103bd-115">Elastic database transactions targets the following scenarios:</span></span>

* <span data-ttu-id="103bd-116">Applicazioni con più database in Azure: con questo scenario i dati sono partizionati verticalmente in più database nel database SQL, in modo che diversi tipi di dati risiedano in database diversi.</span><span class="sxs-lookup"><span data-stu-id="103bd-116">Multi-database applications in Azure: With this scenario, data is vertically partitioned across several databases in SQL DB such that different kinds of data reside on different databases.</span></span> <span data-ttu-id="103bd-117">Alcune operazioni richiedono modifiche ai dati mantenuti in due o più database.</span><span class="sxs-lookup"><span data-stu-id="103bd-117">Some operations require changes to data which is kept in two or more databases.</span></span> <span data-ttu-id="103bd-118">L'applicazione usa le transazioni di database elastico per coordinare le modifiche tra i database e garantire l'atomicità.</span><span class="sxs-lookup"><span data-stu-id="103bd-118">The application uses elastic database transactions to coordinate the changes across databases and ensure atomicity.</span></span>
* <span data-ttu-id="103bd-119">Applicazioni di database partizionato in Azure: con questo scenario il livello dati usa la [libreria client dei database elastici](sql-database-elastic-database-client-library.md) o il partizionamento automatico per eseguire il partizionamento orizzontale dei dati in molti database nel database SQL.</span><span class="sxs-lookup"><span data-stu-id="103bd-119">Sharded database applications in Azure: With this scenario, the data tier uses the [Elastic Database client library](sql-database-elastic-database-client-library.md) or self-sharding to horizontally partition the data across many databases in SQL DB.</span></span> <span data-ttu-id="103bd-120">Un caso d'uso significativo è la necessità di eseguire modifiche atomiche per un'applicazione multi-tenant partizionata, quando le modifiche si estendono a più tenant.</span><span class="sxs-lookup"><span data-stu-id="103bd-120">One prominent use case is the need to perform atomic changes for a sharded multi-tenant application when changes span tenants.</span></span> <span data-ttu-id="103bd-121">Si pensi ad esempio a un trasferimento da un tenant all'altro, entrambi residenti in database diversi.</span><span class="sxs-lookup"><span data-stu-id="103bd-121">Think for instance of a transfer from one tenant to another, both residing on different databases.</span></span> <span data-ttu-id="103bd-122">Un secondo caso è il partizionamento orizzontale con granularità fine per soddisfare le esigenze di capacità per un tenant di grandi dimensioni che, a sua volta, implica in genere la necessità che alcune operazioni atomiche siano estese a diversi database usati per lo stesso tenant.</span><span class="sxs-lookup"><span data-stu-id="103bd-122">A second case is fine-grained sharding to accommodate capacity needs for a large tenant which in turn typically implies that some atomic operations needs to stretch across several databases used for the same tenant.</span></span> <span data-ttu-id="103bd-123">Un terzo caso sono gli aggiornamenti atomici per fare riferimento ai dati replicati tra i database.</span><span class="sxs-lookup"><span data-stu-id="103bd-123">A third case is atomic updates to reference data that are replicated across databases.</span></span> <span data-ttu-id="103bd-124">Le operazioni atomiche e transazionali che seguono questo schema ora possono essere coordinate in diversi database usando l'anteprima.</span><span class="sxs-lookup"><span data-stu-id="103bd-124">Atomic, transacted, operations along these lines can now be coordinated across several databases using the preview.</span></span>
  <span data-ttu-id="103bd-125">Le transazioni di database elastico usano il protocollo 2PC per garantire l'atomicità delle transazioni nei database.</span><span class="sxs-lookup"><span data-stu-id="103bd-125">Elastic database transactions use two-phase commit to ensure transaction atomicity across databases.</span></span> <span data-ttu-id="103bd-126">È una scelta ideale per le transazioni che coinvolgono meno di 100 database alla volta in una singola transazione.</span><span class="sxs-lookup"><span data-stu-id="103bd-126">It is a good fit for transactions that involve less than 100 databases at a time within a single transaction.</span></span> <span data-ttu-id="103bd-127">Questi limiti non vengono applicati, ma quando vengono superati è consigliabile prevedere una riduzione delle prestazioni e delle percentuali di riuscita delle transazioni di database elastico.</span><span class="sxs-lookup"><span data-stu-id="103bd-127">These limits are not enforced, but one should expect performance and success rates for elastic database transactions to suffer when exceeding these limits.</span></span>

## <a name="installation-and-migration"></a><span data-ttu-id="103bd-128">Installazione e migrazione</span><span class="sxs-lookup"><span data-stu-id="103bd-128">Installation and migration</span></span>
<span data-ttu-id="103bd-129">Le funzionalità per le transazioni di database elastico nel database SQL vengono fornite tramite aggiornamenti alle librerie .NET System.Data.dll e System.Transactions.dll.</span><span class="sxs-lookup"><span data-stu-id="103bd-129">The capabilities for elastic database transactions in SQL DB are provided through updates to the .NET libraries System.Data.dll and System.Transactions.dll.</span></span> <span data-ttu-id="103bd-130">Le DLL assicurano che il protocollo 2PC venga usato dove necessario per garantire l'atomicità.</span><span class="sxs-lookup"><span data-stu-id="103bd-130">The DLLs ensure that two-phase commit is used where necessary to ensure atomicity.</span></span> <span data-ttu-id="103bd-131">Per iniziare a sviluppare applicazioni che usano transazioni di database elastico, installare [.NET Framework 4.6.1](https://www.microsoft.com/download/details.aspx?id=49981) o una versione successiva.</span><span class="sxs-lookup"><span data-stu-id="103bd-131">To start developing applications using elastic database transactions, install [.NET Framework 4.6.1](https://www.microsoft.com/download/details.aspx?id=49981) or a later version.</span></span> <span data-ttu-id="103bd-132">Quando si esegue una versione precedente di .NET Framework, le transazioni non verranno alzate di livello a una transazione distribuita e verrà generata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="103bd-132">When running on an earlier version of the .NET framework, transactions will fail to promote to a distributed transaction and an exception will be raised.</span></span>

<span data-ttu-id="103bd-133">Dopo l'installazione, è possibile usare l'API di transazione distribuita in System.Transactions con connessioni al database SQL.</span><span class="sxs-lookup"><span data-stu-id="103bd-133">After installation, you can use the distributed transaction APIs in System.Transactions with connections to SQL DB.</span></span> <span data-ttu-id="103bd-134">Se sono disponibili applicazioni di MSDTC che usano queste API, è sufficiente ricompilare le applicazioni esistenti per .NET 4.6 dopo avere installato la versione 4.6.1 di Framework.</span><span class="sxs-lookup"><span data-stu-id="103bd-134">If you have existing MSDTC applications using these APIs, simply rebuild your existing applications for .NET 4.6 after installing the 4.6.1 Framework.</span></span> <span data-ttu-id="103bd-135">Se i progetti sono destinati a .NET 4.6, verranno usate automaticamente le DLL aggiornate della nuova versione di Framework e le chiamate API di transazione distribuita in combinazione con le connessioni al database SQL ora riusciranno.</span><span class="sxs-lookup"><span data-stu-id="103bd-135">If your projects target .NET 4.6, they will automatically use the updated DLLs from the new Framework version and distributed transaction API calls in combination with connections to SQL DB will now succeed.</span></span>

<span data-ttu-id="103bd-136">Tenere presente che le transazioni di database elastico non richiedono l'installazione di MSDTC.</span><span class="sxs-lookup"><span data-stu-id="103bd-136">Remember that elastic database transactions do not require installing MSDTC.</span></span> <span data-ttu-id="103bd-137">Al contrario, le transazioni di database elastico sono gestite direttamente e internamente dal database SQL.</span><span class="sxs-lookup"><span data-stu-id="103bd-137">Instead, elastic database transactions are directly managed by and within SQL DB.</span></span> <span data-ttu-id="103bd-138">In questo modo gli scenari basati sul cloud sono notevolmente più semplici, perché non è necessaria una distribuzione di MSDTC per usare transazioni distribuite con il database SQL.</span><span class="sxs-lookup"><span data-stu-id="103bd-138">This significantly simplifies cloud scenarios since a deployment of MSDTC is not necessary to use distributed transactions with SQL DB.</span></span> <span data-ttu-id="103bd-139">La sezione 4 illustra in dettaglio come distribuire le transazioni di database elastico e la versione di .NET Framework necessaria insieme alle proprie applicazioni cloud in Azure.</span><span class="sxs-lookup"><span data-stu-id="103bd-139">Section 4 explains in more detail how to deploy elastic database transactions and the required .NET framework together with your cloud applications to Azure.</span></span>

## <a name="development-experience"></a><span data-ttu-id="103bd-140">Esperienza di sviluppo</span><span class="sxs-lookup"><span data-stu-id="103bd-140">Development experience</span></span>
### <a name="multi-database-applications"></a><span data-ttu-id="103bd-141">Applicazioni con più database</span><span class="sxs-lookup"><span data-stu-id="103bd-141">Multi-database applications</span></span>
<span data-ttu-id="103bd-142">L'esempio di codice seguente usa l'esperienza di programmazione familiare con System.Transactions per .NET.</span><span class="sxs-lookup"><span data-stu-id="103bd-142">The following sample code uses the familiar programming experience with .NET System.Transactions.</span></span> <span data-ttu-id="103bd-143">La classe TransactionScope definisce una transazione di ambiente in .NET.</span><span class="sxs-lookup"><span data-stu-id="103bd-143">The TransactionScope class establishes an ambient transaction in .NET.</span></span> <span data-ttu-id="103bd-144">Una "transazione di ambiente" risiede nel thread corrente. Tutte le connessioni aperte all'interno di TransactionScope partecipano alla transazione.</span><span class="sxs-lookup"><span data-stu-id="103bd-144">(An “ambient transaction” is one that lives in the current thread.) All connections opened within the TransactionScope participate in the transaction.</span></span> <span data-ttu-id="103bd-145">Se partecipano diversi database, la transazione viene automaticamente elevata a transazione distribuita.</span><span class="sxs-lookup"><span data-stu-id="103bd-145">If different databases participate, the transaction is automatically elevated to a distributed transaction.</span></span> <span data-ttu-id="103bd-146">Il risultato della transazione viene controllato impostando l'ambito da completare per indicare un commit.</span><span class="sxs-lookup"><span data-stu-id="103bd-146">The outcome of the transaction is controlled by setting the scope to complete to indicate a commit.</span></span>

    using (var scope = new TransactionScope())
    {
        using (var conn1 = new SqlConnection(connStrDb1))
        {
            conn1.Open();
            SqlCommand cmd1 = conn1.CreateCommand();
            cmd1.CommandText = string.Format("insert into T1 values(1)");
            cmd1.ExecuteNonQuery();
        }

        using (var conn2 = new SqlConnection(connStrDb2))
        {
            conn2.Open();
            var cmd2 = conn2.CreateCommand();
            cmd2.CommandText = string.Format("insert into T2 values(2)");
            cmd2.ExecuteNonQuery();
        }

        scope.Complete();
    }

### <a name="sharded-database-applications"></a><span data-ttu-id="103bd-147">Applicazioni di database partizionato</span><span class="sxs-lookup"><span data-stu-id="103bd-147">Sharded database applications</span></span>
<span data-ttu-id="103bd-148">Le transazioni di database elastico per il database SQL supportano anche il coordinamento delle transazioni distribuite per cui si usa il metodo OpenConnectionForKey della libreria client dei database elastici per aprire le connessioni per un livello dati con scalabilità orizzontale.</span><span class="sxs-lookup"><span data-stu-id="103bd-148">Elastic database transactions for SQL DB also support coordinating distributed transactions where you use the OpenConnectionForKey method of the elastic database client library to open connections for a scaled out data tier.</span></span> <span data-ttu-id="103bd-149">Considerare i casi in cui è necessario garantire la coerenza delle transazioni per le modifiche dei diversi valori delle chiavi di partizionamento orizzontale.</span><span class="sxs-lookup"><span data-stu-id="103bd-149">Consider cases where you need to guarantee transactional consistency for changes across several different sharding key values.</span></span> <span data-ttu-id="103bd-150">Le connessioni alle partizioni che ospitano i diversi valori delle chiavi di partizionamento orizzontale sono negoziate tramite OpenConnectionForKey.</span><span class="sxs-lookup"><span data-stu-id="103bd-150">Connections to the shards hosting the different sharding key values are brokered using OpenConnectionForKey.</span></span> <span data-ttu-id="103bd-151">In generale, le connessioni possono essere stabilite a partizioni diverse, in modo tale che per assicurare garanzie transazionali sia richiesta una transazione distribuita.</span><span class="sxs-lookup"><span data-stu-id="103bd-151">In the general case, the connections can be to different shards such that ensuring transactional guarantees requires a distributed transaction.</span></span> <span data-ttu-id="103bd-152">Il seguente esempio di codice illustra questo approccio.</span><span class="sxs-lookup"><span data-stu-id="103bd-152">The following code sample illustrates this approach.</span></span> <span data-ttu-id="103bd-153">Si presuppone che venga usata una variabile denominata shardmap per rappresentare un mappa partizioni dalla libreria client dei database elastici:</span><span class="sxs-lookup"><span data-stu-id="103bd-153">It assumes that a variable called shardmap is used to represent a shard map from the elastic database client library:</span></span>

    using (var scope = new TransactionScope())
    {
        using (var conn1 = shardmap.OpenConnectionForKey(tenantId1, credentialsStr))
        {
            conn1.Open();
            SqlCommand cmd1 = conn1.CreateCommand();
            cmd1.CommandText = string.Format("insert into T1 values(1)");
            cmd1.ExecuteNonQuery();
        }

        using (var conn2 = shardmap.OpenConnectionForKey(tenantId2, credentialsStr))
        {
            conn2.Open();
            var cmd2 = conn2.CreateCommand();
            cmd2.CommandText = string.Format("insert into T1 values(2)");
            cmd2.ExecuteNonQuery();
        }

        scope.Complete();
    }


## <a name="net-installation-for-azure-cloud-services"></a><span data-ttu-id="103bd-154">Installazione di .NET per i servizi cloud di Azure</span><span class="sxs-lookup"><span data-stu-id="103bd-154">.NET installation for Azure Cloud Services</span></span>
<span data-ttu-id="103bd-155">Azure offre diverse soluzioni per l'hosting di applicazioni .NET.</span><span class="sxs-lookup"><span data-stu-id="103bd-155">Azure provides several offerings to host .NET applications.</span></span> <span data-ttu-id="103bd-156">Per un confronto delle diverse soluzioni, vedere [Confronto tra Azure App Service, Servizi cloud e Macchine virtuali di Azure](../app-service-web/choose-web-site-cloud-service-vm.md).</span><span class="sxs-lookup"><span data-stu-id="103bd-156">A comparison of the different offerings is available in [Azure App Service, Cloud Services, and Virtual Machines comparison](../app-service-web/choose-web-site-cloud-service-vm.md).</span></span> <span data-ttu-id="103bd-157">Se il sistema operativo guest della soluzione è precedente alla versione 4.6.1 di .NET richiesta per le transazioni elastiche, è necessario aggiornare il sistema operativo guest alla versione 4.6.1.</span><span class="sxs-lookup"><span data-stu-id="103bd-157">If the guest OS of the offering is smaller than .NET 4.6.1 required for elastic transactions, you need to upgrade the guest OS to 4.6.1.</span></span> 

<span data-ttu-id="103bd-158">Per i servizi app di Azure, gli aggiornamenti del sistema operativo guest non sono attualmente supportati.</span><span class="sxs-lookup"><span data-stu-id="103bd-158">For Azure App Services, upgrades to the guest OS are currently not supported.</span></span> <span data-ttu-id="103bd-159">Per le macchine virtuali di Azure, è sufficiente accedere alla macchina virtuale ed eseguire il programma di installazione del framework .NET più recente.</span><span class="sxs-lookup"><span data-stu-id="103bd-159">For Azure Virtual Machines, simply log into the VM and run the installer for the latest .NET framework.</span></span> <span data-ttu-id="103bd-160">Per i servizi cloud di Azure, è necessario includere l'installazione di una versione più recente di .NET nelle attività di avvio della distribuzione.</span><span class="sxs-lookup"><span data-stu-id="103bd-160">For Azure Cloud Services, you need to include the installation of a newer .NET version into the startup tasks of your deployment.</span></span> <span data-ttu-id="103bd-161">I concetti e i passaggi sono documentati in [Installare .NET in un ruolo del servizio cloud](../cloud-services/cloud-services-dotnet-install-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="103bd-161">The concepts and steps are documented in [Install .NET on a Cloud Service Role](../cloud-services/cloud-services-dotnet-install-dotnet.md).</span></span>  

<span data-ttu-id="103bd-162">Si noti che il programma di installazione per .NET 4.6.1 può richiedere più spazio di archiviazione temporaneo durante il processo di bootstrap nei servizi cloud di Azure rispetto al programma di installazione per .NET 4.6.</span><span class="sxs-lookup"><span data-stu-id="103bd-162">Note that the installer for .NET 4.6.1 may require more temporary storage during the bootstrapping process on Azure cloud services than the installer for .NET 4.6.</span></span> <span data-ttu-id="103bd-163">Per garantire una corretta installazione, è necessario aumentare l'archiviazione temporanea per il servizio cloud di Azure nel file ServiceDefinition.csdef nella sezione LocalResources e le impostazioni di ambiente dell'attività di avvio, come illustrato nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="103bd-163">To ensure a successful installation, you need to increase temporary storage for your Azure cloud service in your ServiceDefinition.csdef file in the LocalResources section and the environment settings of your startup task, as shown in the following sample:</span></span>

    <LocalResources>
    ...
        <LocalStorage name="TEMP" sizeInMB="5000" cleanOnRoleRecycle="false" />
        <LocalStorage name="TMP" sizeInMB="5000" cleanOnRoleRecycle="false" />
    </LocalResources>
    <Startup>
        <Task commandLine="install.cmd" executionContext="elevated" taskType="simple">
            <Environment>
        ...
                <Variable name="TEMP">
                    <RoleInstanceValue xpath="/RoleEnvironment/CurrentInstance/LocalResources/LocalResource[@name='TEMP']/@path" />
                </Variable>
                <Variable name="TMP">
                    <RoleInstanceValue xpath="/RoleEnvironment/CurrentInstance/LocalResources/LocalResource[@name='TMP']/@path" />
                </Variable>
            </Environment>
        </Task>
    </Startup>

## <a name="transactions-across-multiple-servers"></a><span data-ttu-id="103bd-164">Transazioni tra più server</span><span class="sxs-lookup"><span data-stu-id="103bd-164">Transactions across multiple servers</span></span>
<span data-ttu-id="103bd-165">Le transazioni di database elastici sono supportate in diversi server logici del database SQL di Azure.</span><span class="sxs-lookup"><span data-stu-id="103bd-165">Elastic database transactions are supported across different logical servers in Azure SQL Database.</span></span> <span data-ttu-id="103bd-166">Quando le transazioni oltrepassano i limiti dei server logici, i server partecipanti devono essere innanzitutto inseriti in una relazione di comunicazione reciproca.</span><span class="sxs-lookup"><span data-stu-id="103bd-166">When transactions cross logical server boundaries, the participating servers first need to be entered into a mutual communication relationship.</span></span> <span data-ttu-id="103bd-167">Dopo aver stabilito la relazione di comunicazione, qualsiasi database in uno dei due server può partecipare alle transazioni elastiche con i database dell'altro server.</span><span class="sxs-lookup"><span data-stu-id="103bd-167">Once the communication relationship has been established, any database in any of the two servers can participate in elastic transactions with databases from the other server.</span></span> <span data-ttu-id="103bd-168">Con le transazioni che si estendono su più di due server logici, è necessaria una relazione di comunicazione per ogni coppia di server logici.</span><span class="sxs-lookup"><span data-stu-id="103bd-168">With transactions spanning more than two logical servers, a communication relationship needs to be in place for any pair of logical servers.</span></span>

<span data-ttu-id="103bd-169">Usare i seguenti cmdlet di PowerShell per la gestione delle relazioni di comunicazione tra server per le transazioni di database elastici:</span><span class="sxs-lookup"><span data-stu-id="103bd-169">Use the following PowerShell cmdlets to manage cross-server communication relationships for elastic database transactions:</span></span>

* <span data-ttu-id="103bd-170">**New AzureRmSqlServerCommunicationLink**: usare questo cmdlet per creare una nuova relazione di comunicazione tra due server logici in un database SQL di Azure.</span><span class="sxs-lookup"><span data-stu-id="103bd-170">**New-AzureRmSqlServerCommunicationLink**: Use this cmdlet to create a new communication relationship between two logical servers in Azure SQL DB.</span></span> <span data-ttu-id="103bd-171">La relazione è simmetrica, ovvero entrambi i server possono avviare le transazioni con l'altro server.</span><span class="sxs-lookup"><span data-stu-id="103bd-171">The relationship is symmetric which means both servers can initiate transactions with the other server.</span></span>
* <span data-ttu-id="103bd-172">**Get-AzureRmSqlServerCommunicationLink**: usare questo cmdlet per recuperare le relazioni di comunicazione esistenti e le relative proprietà.</span><span class="sxs-lookup"><span data-stu-id="103bd-172">**Get-AzureRmSqlServerCommunicationLink**: Use this cmdlet to retrieve existing communication relationships and their properties.</span></span>
* <span data-ttu-id="103bd-173">**Remove-AzureRmSqlServerCommunicationLink**: usare questo cmdlet per rimuovere una relazione di comunicazione esistente.</span><span class="sxs-lookup"><span data-stu-id="103bd-173">**Remove-AzureRmSqlServerCommunicationLink**: Use this cmdlet to remove an existing communication relationship.</span></span> 

## <a name="monitoring-transaction-status"></a><span data-ttu-id="103bd-174">Monitoraggio dello stato delle transazioni</span><span class="sxs-lookup"><span data-stu-id="103bd-174">Monitoring transaction status</span></span>
<span data-ttu-id="103bd-175">Per monitorare lo stato e l'avanzamento delle transazioni di database elastico in corso, usare viste a gestione dinamica (DMV) nel database SQL.</span><span class="sxs-lookup"><span data-stu-id="103bd-175">Use Dynamic Management Views (DMVs) in SQL DB to monitor status and progress of your ongoing elastic database transactions.</span></span> <span data-ttu-id="103bd-176">Tutte le viste a gestione dinamica correlate alle transazioni sono rilevanti per le transazioni distribuite nel database SQL.</span><span class="sxs-lookup"><span data-stu-id="103bd-176">All DMVs related to transactions are relevant for distributed transactions in SQL DB.</span></span> <span data-ttu-id="103bd-177">È possibile trovare l'elenco delle viste a gestione dinamica corrispondente in [Funzioni e viste a gestione dinamica relative alle transazioni (Transact-SQL)](https://msdn.microsoft.com/library/ms178621.aspx).</span><span class="sxs-lookup"><span data-stu-id="103bd-177">You can find the corresponding list of DMVs here: [Transaction Related Dynamic Management Views and Functions (Transact-SQL)](https://msdn.microsoft.com/library/ms178621.aspx).</span></span>

<span data-ttu-id="103bd-178">Queste viste a gestione dinamica sono particolarmente utili:</span><span class="sxs-lookup"><span data-stu-id="103bd-178">These DMVs are particularly useful:</span></span>

* <span data-ttu-id="103bd-179">**sys.dm\_tran\_active\_transactions**: elenca le transazioni attualmente attive e il relativo stato.</span><span class="sxs-lookup"><span data-stu-id="103bd-179">**sys.dm\_tran\_active\_transactions**: Lists currently active transactions and their status.</span></span> <span data-ttu-id="103bd-180">La colonna UOW (unità di lavoro) può identificare le diverse transazioni figlio che appartengono alla stessa transazione distribuita.</span><span class="sxs-lookup"><span data-stu-id="103bd-180">The UOW (Unit Of Work) column can identify the different child transactions that belong to the same distributed transaction.</span></span> <span data-ttu-id="103bd-181">Tutte le transazioni all'interno della stessa transazione distribuita hanno lo stesso valore di unità di lavoro.</span><span class="sxs-lookup"><span data-stu-id="103bd-181">All transactions within the same distributed transaction carry the same UOW value.</span></span> <span data-ttu-id="103bd-182">Per altri dettagli, vedere la [documentazione sulle viste a gestione dinamica](https://msdn.microsoft.com/library/ms174302.aspx) .</span><span class="sxs-lookup"><span data-stu-id="103bd-182">See the [DMV documentation](https://msdn.microsoft.com/library/ms174302.aspx) for more details.</span></span>
* <span data-ttu-id="103bd-183">**sys.dm\_tran\_database\_transactions**: fornisce altre informazioni sulle transazioni, ad esempio la posizione della transazione nel log.</span><span class="sxs-lookup"><span data-stu-id="103bd-183">**sys.dm\_tran\_database\_transactions**: Provides additional information about transactions, such as placement of the transaction in the log.</span></span> <span data-ttu-id="103bd-184">Per altri dettagli, vedere la [documentazione sulle viste a gestione dinamica](https://msdn.microsoft.com/library/ms186957.aspx) .</span><span class="sxs-lookup"><span data-stu-id="103bd-184">See the [DMV documentation](https://msdn.microsoft.com/library/ms186957.aspx) for more details.</span></span>
* <span data-ttu-id="103bd-185">**sys.dm\_tran\_locks**: fornisce informazioni sui blocchi attualmente mantenuti dalle transazioni in corso.</span><span class="sxs-lookup"><span data-stu-id="103bd-185">**sys.dm\_tran\_locks**: Provides information about the locks that are currently held by ongoing transactions.</span></span> <span data-ttu-id="103bd-186">Per altri dettagli, vedere la [documentazione sulle viste a gestione dinamica](https://msdn.microsoft.com/library/ms190345.aspx) .</span><span class="sxs-lookup"><span data-stu-id="103bd-186">See the [DMV documentation](https://msdn.microsoft.com/library/ms190345.aspx) for more details.</span></span>

## <a name="limitations"></a><span data-ttu-id="103bd-187">Limitazioni</span><span class="sxs-lookup"><span data-stu-id="103bd-187">Limitations</span></span>
<span data-ttu-id="103bd-188">Per le transazioni di database elastico nel database SQL si applicano attualmente le limitazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="103bd-188">The following limitations currently apply to elastic database transactions in SQL DB:</span></span>

* <span data-ttu-id="103bd-189">Sono supportate solo le transazioni tra database nel database SQL.</span><span class="sxs-lookup"><span data-stu-id="103bd-189">Only transactions across databases in SQL DB are supported.</span></span> <span data-ttu-id="103bd-190">Altri provider di risorse [X/Open XA](https://en.wikipedia.org/wiki/X/Open_XA) e database al di fuori del database SQL non possono partecipare alle transazioni di database elastico.</span><span class="sxs-lookup"><span data-stu-id="103bd-190">Other [X/Open XA](https://en.wikipedia.org/wiki/X/Open_XA) resource providers and databases outside of SQL DB cannot participate in elastic database transactions.</span></span> <span data-ttu-id="103bd-191">Ciò significa che le transazioni di database elastico non possono estendersi in locale al database SQL Server e al database SQL di Azure.</span><span class="sxs-lookup"><span data-stu-id="103bd-191">That means that elastic database transactions cannot stretch across on premises SQL Server and Azure SQL Databases.</span></span> <span data-ttu-id="103bd-192">Per le transazioni distribuite in locale, continuare a usare MSDTC.</span><span class="sxs-lookup"><span data-stu-id="103bd-192">For distributed transactions on premises, continue to use MSDTC.</span></span> 
* <span data-ttu-id="103bd-193">Sono supportate solo le transazioni coordinate tramite client da un'applicazione .NET.</span><span class="sxs-lookup"><span data-stu-id="103bd-193">Only client-coordinated transactions from a .NET application are supported.</span></span> <span data-ttu-id="103bd-194">Il supporto sul lato server per T-SQL, ad esempio BEGIN DISTRIBUTED TRANSACTION, è pianificato, ma non ancora disponibile.</span><span class="sxs-lookup"><span data-stu-id="103bd-194">Server-side support for T-SQL such as BEGIN DISTRIBUTED TRANSACTION is planned, but not yet available.</span></span> 
* <span data-ttu-id="103bd-195">Le transazioni tra i servizi WCF non sono supportate.</span><span class="sxs-lookup"><span data-stu-id="103bd-195">Transactions across WCF services are not supported.</span></span> <span data-ttu-id="103bd-196">Ad esempio, si dispone di un metodo del servizio WCF che esegue una transazione.</span><span class="sxs-lookup"><span data-stu-id="103bd-196">For example, you have a WCF service method that executes a transaction.</span></span> <span data-ttu-id="103bd-197">Se si racchiude la chiamata all'interno di un ambito della transazione, essa avrà esito negativo come eccezione [System.ServiceModel.ProtocolException](https://msdn.microsoft.com/library/system.servicemodel.protocolexception).</span><span class="sxs-lookup"><span data-stu-id="103bd-197">Enclosing the call within a transaction scope will fail as a [System.ServiceModel.ProtocolException](https://msdn.microsoft.com/library/system.servicemodel.protocolexception).</span></span>

## <a name="next-steps"></a><span data-ttu-id="103bd-198">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="103bd-198">Next steps</span></span>
<span data-ttu-id="103bd-199">Se ci sono domande, è possibile visitare il [forum sul database SQL](http://social.msdn.microsoft.com/forums/azure/home?forum=ssdsgetstarted) mentre è possibile inserire le richieste di nuove funzionalità nel [forum relativo a commenti e suggerimenti sul database SQL](https://feedback.azure.com/forums/217321-sql-database/).</span><span class="sxs-lookup"><span data-stu-id="103bd-199">For questions, please reach out to us on the [SQL Database forum](http://social.msdn.microsoft.com/forums/azure/home?forum=ssdsgetstarted) and for feature requests, please add them to the [SQL Database feedback forum](https://feedback.azure.com/forums/217321-sql-database/).</span></span>

<!--Image references-->
[1]: ./media/sql-database-elastic-transactions-overview/distributed-transactions.png



