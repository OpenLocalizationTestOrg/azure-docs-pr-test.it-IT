---
title: Eseguire Cassandra con Linux in Azure | Microsoft Docs
description: "Spiega come eseguire un cluster Cassandra in Linux in Macchine virtuali di Azure da un’app Node.js"
services: virtual-machines-linux
documentationcenter: nodejs
author: tomarcher
manager: routlaw
editor: 
tags: azure-service-management
ms.assetid: 30de1f29-e97d-492f-ae34-41ec83488de0
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 08/17/2017
ms.author: tarcher
ms.openlocfilehash: 1ff3d77ced6c9d90029b251490c05e52d9b43515
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/29/2017
---
# <a name="running-cassandra-with-linux-on-azure-and-accessing-it-from-nodejs"></a><span data-ttu-id="1c11d-103">Esecuzione di Cassandra con Linux in Azure e accesso da Node.js</span><span class="sxs-lookup"><span data-stu-id="1c11d-103">Running Cassandra with Linux on Azure and Accessing it from Node.js</span></span>
> [!IMPORTANT] 
> <span data-ttu-id="1c11d-104">Azure offre due diversi modelli di distribuzione per creare e usare le risorse: [Gestione risorse e la distribuzione classica](../../../resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="1c11d-104">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../resource-manager-deployment-model.md).</span></span> <span data-ttu-id="1c11d-105">Questo articolo illustra l'uso del modello di distribuzione classica.</span><span class="sxs-lookup"><span data-stu-id="1c11d-105">This article covers using the Classic deployment model.</span></span> <span data-ttu-id="1c11d-106">Microsoft consiglia di usare il modello di Gestione risorse per le distribuzioni più recenti.</span><span class="sxs-lookup"><span data-stu-id="1c11d-106">Microsoft recommends that most new deployments use the Resource Manager model.</span></span> <span data-ttu-id="1c11d-107">Vedere i modelli di Resource Manager per cluster [Datastax Enterprise](https://azure.microsoft.com/documentation/templates/datastax) e [Spark e Cassandra in CentOS](https://azure.microsoft.com/documentation/templates/spark-and-cassandra-on-centos/).</span><span class="sxs-lookup"><span data-stu-id="1c11d-107">See Resource Manager templates for [Datastax Enterprise](https://azure.microsoft.com/documentation/templates/datastax) and [Spark cluster and Cassandra on CentOS](https://azure.microsoft.com/documentation/templates/spark-and-cassandra-on-centos/).</span></span>

## <a name="overview"></a><span data-ttu-id="1c11d-108">Panoramica</span><span class="sxs-lookup"><span data-stu-id="1c11d-108">Overview</span></span>
<span data-ttu-id="1c11d-109">Microsoft Azure è una piattaforma cloud aperta che esegue software sia Microsoft che non Microsoft, inclusi sistemi operativi, server applicazioni, middleware di messaggistica, oltre a database SQL e NoSQL da modelli sia commerciali che open source.</span><span class="sxs-lookup"><span data-stu-id="1c11d-109">Microsoft Azure is an open cloud platform that runs both Microsoft as well as non-Microsoft software which  includes operating systems, application servers, messaging middleware as well as SQL and NoSQL databases from both commercial and open source models.</span></span> <span data-ttu-id="1c11d-110">La compilazione di servizi resilienti su cloud pubblici, incluso Azure, richiede un'attenta pianificazione e un'architettura mirata sia per i server applicazioni che per i livelli di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="1c11d-110">Building resilient services on public clouds including Azure requires careful planning and deliberate architecture for both applications servers as well storage layers.</span></span> <span data-ttu-id="1c11d-111">L'architettura di archiviazione distribuita di Cassandra aiuta a compilare con facilità sistemi a disponibilità elevata a tolleranza di errore del cluster.</span><span class="sxs-lookup"><span data-stu-id="1c11d-111">Cassandra’s distributed storage architecture naturally helps in building highly available systems that are fault tolerant for cluster failures.</span></span> <span data-ttu-id="1c11d-112">Cassandra è un database NoSQL con scalabilità cloud gestito da Apache Software Foundation all'indirizzo cassandra.apache.org. Cassandra, essendo scritto in Java, viene eseguito su piattaforme sia Windows che Linux.</span><span class="sxs-lookup"><span data-stu-id="1c11d-112">Cassandra is a cloud scale NoSQL database maintained by Apache Software Foundation at cassandra.apache.org; Cassandra is written in Java and hence runs on both on Windows as well as Linux platforms.</span></span>

<span data-ttu-id="1c11d-113">Lo scopo di questo articolo è mostrare la distribuzione di Cassandra in Ubuntu come cluster di uno solo o di più data center sfruttando le macchine virtuali di Microsoft Azure e le reti virtuali.</span><span class="sxs-lookup"><span data-stu-id="1c11d-113">The focus of this article is to show Cassandra deployment on Ubuntu as a single and multi-data center cluster leveraging Microsoft Azure Virtual Machines and Virtual Networks.</span></span> <span data-ttu-id="1c11d-114">La distribuzione del cluster per i carichi di lavoro ottimizzati per la produzione esula dall'ambito di questo articolo perché richiede una configurazione nodi a più dischi, una progettazione appropriata della topologia ad anello e la modellazione dati per supportare i requisiti necessari di replica, coerenza dei dati, velocità effettiva e disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="1c11d-114">The cluster deployment for production optimized workloads is out of scope of this article as it requires multi-disk node configuration, appropriate ring topology design and data modeling to support the needed replication, data consistency, throughput and high availability requirements.</span></span>

<span data-ttu-id="1c11d-115">Questo articolo usa un approccio di base per spiegare che cosa comporta la compilazione del cluster Cassandra rispetto a Docker, Chef o Puppet, semplificando notevolmente la distribuzione dell'infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="1c11d-115">This article takes a fundamental approach to show what is involved in building the Cassandra cluster compared Docker, Chef or Puppet which can make the infrastructure deployment a lot easier.</span></span>  

## <a name="the-deployment-models"></a><span data-ttu-id="1c11d-116">Modelli di distribuzione</span><span class="sxs-lookup"><span data-stu-id="1c11d-116">The Deployment Models</span></span>
<span data-ttu-id="1c11d-117">La rete di Microsoft Azure consente di distribuire cluster privati isolati, il cui accesso può essere limitato per ottenere una sicurezza di rete con granularità fine.</span><span class="sxs-lookup"><span data-stu-id="1c11d-117">Microsoft Azure networking allows the deployment of isolated private clusters, the access of which can be restricted to attain fine grained network security.</span></span>  <span data-ttu-id="1c11d-118">Poiché lo scopo di questo articolo è illustrare la distribuzione di Cassandra a un livello di base, non si parlerà del livello di coerenza e della progettazione delle risorse di archiviazione ottimale per la velocità effettiva.</span><span class="sxs-lookup"><span data-stu-id="1c11d-118">Since this article is about showing the Cassandra deployment at a fundamental level, we will not focus on the consistency level and the optimal storage design for throughput.</span></span> <span data-ttu-id="1c11d-119">Ecco i requisiti di rete per l'ipotetico cluster:</span><span class="sxs-lookup"><span data-stu-id="1c11d-119">Here is the list of networking requirements for our hypothetical cluster:</span></span>

* <span data-ttu-id="1c11d-120">I sistemi esterni non possono accedere al database Cassandra da Azure o all'esterno di Azure</span><span class="sxs-lookup"><span data-stu-id="1c11d-120">External systems can’t access Cassandra database from within or outside Azure</span></span>
* <span data-ttu-id="1c11d-121">Il cluster Cassandra deve trovarsi dietro un bilanciamento del carico per il traffico Thrift</span><span class="sxs-lookup"><span data-stu-id="1c11d-121">Cassandra cluster has to be behind a load balancer for thrift traffic</span></span>
* <span data-ttu-id="1c11d-122">Distribuire i nodi di Cassandra in due gruppi in ogni data center per una migliore disponibilità del cluster</span><span class="sxs-lookup"><span data-stu-id="1c11d-122">Deploy Cassandra nodes in two groups in each data center for an enhanced cluster availability</span></span>
* <span data-ttu-id="1c11d-123">Bloccare il cluster in modo che solo la server farm applicazioni abbia accesso diretto al database</span><span class="sxs-lookup"><span data-stu-id="1c11d-123">Lock down the cluster so that only application server farm has access to the database directly</span></span>
* <span data-ttu-id="1c11d-124">Nessun endpoint di rete pubblico diverso da SSH</span><span class="sxs-lookup"><span data-stu-id="1c11d-124">No public networking endpoints other than SSH</span></span>
* <span data-ttu-id="1c11d-125">Ogni nodo di Cassandra richiede un indirizzo IP interno fisso</span><span class="sxs-lookup"><span data-stu-id="1c11d-125">Each Cassandra node needs a fixed internal IP address</span></span>

<span data-ttu-id="1c11d-126">Cassandra può essere distribuito in una singola area di Azure o in più aree a seconda della natura distribuita del carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="1c11d-126">Cassandra can be deployed to a single Azure region or to multiple regions based on the distributed nature of the workload.</span></span> <span data-ttu-id="1c11d-127">Il modello di distribuzione in più aree può essere usato per gestire gli utenti finali più vicini a una determinata area geografica con la stessa infrastruttura di Cassandra.</span><span class="sxs-lookup"><span data-stu-id="1c11d-127">Multi-region deployment model can be leveraged to serve end users closer to a particular geography through the same Cassandra infrastructure.</span></span> <span data-ttu-id="1c11d-128">La replica dei nodi predefiniti di Cassandra consente di sincronizzare le scritture multimaster derivanti da più data center e presenta alle applicazioni una visualizzazione coerente dei dati.</span><span class="sxs-lookup"><span data-stu-id="1c11d-128">Cassandra’s built-in node replication takes care of the synchronization of multi-master writes originating from multiple data centers and presents a consistent view of the data to applications.</span></span> <span data-ttu-id="1c11d-129">La distribuzione in più aree è utile anche per attenuare i rischi causati dalle interruzioni di Servizi di Azure.</span><span class="sxs-lookup"><span data-stu-id="1c11d-129">Multi-region deployment can also help with the risk mitigation of the broader Azure service outages.</span></span> <span data-ttu-id="1c11d-130">La coerenza perfezionabile e la topologia di replica di Cassandra saranno di aiuto anche per soddisfare diverse esigenze RPO delle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="1c11d-130">Cassandra’s tunable consistency and replication topology will help in meeting diverse RPO needs of applications.</span></span>

### <a name="single-region-deployment"></a><span data-ttu-id="1c11d-131">Distribuzione in un'area singola</span><span class="sxs-lookup"><span data-stu-id="1c11d-131">Single Region Deployment</span></span>
<span data-ttu-id="1c11d-132">Si inizierà con una distribuzione in una singola area e si raccoglieranno le istruzioni per creare un modello a più aree.</span><span class="sxs-lookup"><span data-stu-id="1c11d-132">We will start with a single region deployment and harvest the learnings in creating a multi-region model.</span></span> <span data-ttu-id="1c11d-133">La rete virtuale di Azure verrà usata per creare subnet isolate per poter soddisfare i requisiti di sicurezza della rete citati sopra.</span><span class="sxs-lookup"><span data-stu-id="1c11d-133">Azure virtual networking will be used to create isolated subnets so that the network security requirements mentioned above can be met.</span></span>  <span data-ttu-id="1c11d-134">Il processo descritto nella creazione della distribuzione in una singola area usa Ubuntu 14.04 LTS e Cassandra 2.08. Il processo può però essere facilmente adottato anche per le altre varianti di Linux.</span><span class="sxs-lookup"><span data-stu-id="1c11d-134">The process described in creating the single region deployment uses Ubuntu 14.04 LTS and Cassandra 2.08; however, the process can easily be adopted to the other Linux variants.</span></span> <span data-ttu-id="1c11d-135">Di seguito sono riportate alcune caratteristiche di sistema della distribuzione in una singola area.</span><span class="sxs-lookup"><span data-stu-id="1c11d-135">The following are some of the systemic characteristics of the single region deployment.</span></span>  

<span data-ttu-id="1c11d-136">**Disponibilità elevata:** i nodi di Cassandra illustrati nella figura 1 vengono distribuiti in due set di disponibilità in modo da diffonderli tra più domini di errore a scopo di disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="1c11d-136">**High Availability:** The Cassandra nodes shown in the Figure 1 are deployed to two availability sets so that the nodes are spread between multiple fault domains for high availability.</span></span> <span data-ttu-id="1c11d-137">Viene eseguito il mapping delle macchine virtuali annotate con ogni set di disponibilità a 2 domini di errore.</span><span class="sxs-lookup"><span data-stu-id="1c11d-137">VMs annotated with each availability set is mapped to 2 fault domains.</span></span>  <span data-ttu-id="1c11d-138">Il concetto di dominio di errore si applica alla gestione dei periodi di inattività (ad esempio errori hardware o software) mentre quello di dominio di aggiornamento (ad esempio aggiornamenti o patch del sistema operativo guest o host, aggiornamenti di applicazioni) si applica alla gestione dei tempi di inattività pianificati.</span><span class="sxs-lookup"><span data-stu-id="1c11d-138">Microsoft Azure uses the concept of fault domain to manage unplanned down time (e.g. hardware or software failures) while the concept of upgrade domain (e.g. host or guest OS patching/upgrades, application upgrades) is used for managing scheduled down time.</span></span> <span data-ttu-id="1c11d-139">Vedere [Ripristino di emergenza e disponibilità elevata per applicazioni Azure](http://msdn.microsoft.com/library/dn251004.aspx) per il ruolo dei domini di errore e di aggiornamento nel conseguimento dell'alta disponibilità.</span><span class="sxs-lookup"><span data-stu-id="1c11d-139">Please see [Disaster Recovery and High Availability for Azure Applications](http://msdn.microsoft.com/library/dn251004.aspx) for the role of fault and upgrade domains in attaining high availability.</span></span>

![Distribuzione in un'area singola](./media/cassandra-nodejs/cassandra-linux1.png)

<span data-ttu-id="1c11d-141">Figura 1: Distribuzione in un'area singola</span><span class="sxs-lookup"><span data-stu-id="1c11d-141">Figure 1: Single region deployment</span></span>

<span data-ttu-id="1c11d-142">Al momento della stesura di questo articolo, Azure non consente il mapping esplicito di un gruppo di macchine virtuali a un dominio di errore specifico. Quindi, anche con il modello di distribuzione mostrato nella figura 1, è statisticamente probabile che venga eseguito il mapping di tutte le macchine virtuali a due domini di errore invece che a quattro.</span><span class="sxs-lookup"><span data-stu-id="1c11d-142">Note that at the time of this writing, Azure doesn’t allow the explicit mapping of a group of VMs to a specific fault domain; consequently, even with the deployment model shown in Figure 1, it is statistically probable that all the virtual machines may be mapped to two fault domains instead of four.</span></span>

<span data-ttu-id="1c11d-143">**Traffico Thrift con bilanciamento del carico:** le librerie client Thrift all'interno del server web si connettono al cluster tramite un servizio di bilanciamento del carico interno.</span><span class="sxs-lookup"><span data-stu-id="1c11d-143">**Load Balancing Thrift Traffic:** Thrift client libraries inside the web server connect to the cluster through an internal load balancer.</span></span> <span data-ttu-id="1c11d-144">Questa operazione richiede il processo di aggiunta del servizio di bilanciamento del carico interno alla subnet "data" (vedere la figura 1) nel contesto del servizio cloud che ospita il cluster Cassandra.</span><span class="sxs-lookup"><span data-stu-id="1c11d-144">This requires the process of adding the internal load balancer to the “data” subnet (refer Figure 1) in the context of the cloud service hosting the Cassandra cluster.</span></span> <span data-ttu-id="1c11d-145">Una volta definito il servizio di bilanciamento del carico interno, per ogni nodo è necessaria l’aggiunta dell'endpoint con carico bilanciato con le annotazioni di un set con carico bilanciato con il nome del servizio di bilanciamento del carico definito in precedenza.</span><span class="sxs-lookup"><span data-stu-id="1c11d-145">Once the internal load balancer is defined, each node requires the load balanced endpoint to be added with the annotations of a load balanced set with previously defined load balancer name.</span></span> <span data-ttu-id="1c11d-146">Per ulteriori dettagli, vedere [Bilanciamento del carico interno di Azure ](../../../load-balancer/load-balancer-internal-overview.md).</span><span class="sxs-lookup"><span data-stu-id="1c11d-146">See [Azure Internal Load Balancing ](../../../load-balancer/load-balancer-internal-overview.md)for more details.</span></span>

<span data-ttu-id="1c11d-147">**Valori di inizializzazione del cluster** : è importante selezionare i nodi con disponibilità più elevata per i valori di inizializzazione perché i nuovi nodi comunicheranno con i nodi dei valori di inizializzazione per individuare la topologia del cluster.</span><span class="sxs-lookup"><span data-stu-id="1c11d-147">**Cluster Seeds:** It is important to select the most highly available nodes for seeds as the new nodes will communicate with seed nodes to discover the topology of the cluster.</span></span> <span data-ttu-id="1c11d-148">Un nodo da ogni set di disponibilità viene designato come nodo di inizializzazione per evitare il singolo punto di errore.</span><span class="sxs-lookup"><span data-stu-id="1c11d-148">One node from each availability set is designated as seed nodes to avoid single point of failure.</span></span>

<span data-ttu-id="1c11d-149">**Fattore di replica e livello di coerenza:** la durabilità dei dati e l’alta disponibilità incorporate in Cassandra sono caratterizzate dal fattore di replica (RF - numero di copie di ogni riga archiviata nel cluster) e dal livello di coerenza (numero di repliche da leggere/scrivere prima della restituzione del risultato al chiamante).</span><span class="sxs-lookup"><span data-stu-id="1c11d-149">**Replication Factor and Consistency Level:** Cassandra’s build-in high-availability and data durability is characterized by the Replication Factor (RF - number of copies of each row stored on the cluster) and Consistency Level (number of replicas to be read/written before returning the result to the caller).</span></span> <span data-ttu-id="1c11d-150">Il fattore di replica viene specificato durante la creazione di KEYSPACE, simile a un database relazionale, mentre il livello di coerenza viene specificato eseguendo la query CRUD.</span><span class="sxs-lookup"><span data-stu-id="1c11d-150">Replication factor is specified during the KEYSPACE (similar to a relational database) creation whereas the consistency level is specified while issuing the CRUD query.</span></span> <span data-ttu-id="1c11d-151">Vedere la documentazione di Cassandra in [Configuring for Consistency](http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html) per i dettagli della coerenza e la formula per il calcolo del quorum.</span><span class="sxs-lookup"><span data-stu-id="1c11d-151">See Cassandra documentation at [Configuring for Consistency](http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html) for consistency details and the formula for quorum computation.</span></span>

<span data-ttu-id="1c11d-152">Cassandra supporta due tipi di modelli di integrità dei dati: coerenza e coerenza finale. Il fattore di replica e il livello di coerenza determineranno insieme se i dati saranno coerenti non appena l'operazione di scrittura sarà completata o se saranno coerenti alla fine.</span><span class="sxs-lookup"><span data-stu-id="1c11d-152">Cassandra supports two types of data integrity models – Consistency and Eventual Consistency; the Replication Factor and Consistency Level will together determine if the data will be consistent as soon as a write operation is complete or it will be eventually consistent.</span></span> <span data-ttu-id="1c11d-153">Ad esempio, se si specifica QUORUM come livello di coerenza, la coerenza dei dati sarà sempre garantita, mentre con un altro livello di coerenza, al di sotto del numero di repliche da scrivere necessarie per ottenere QUORUM (ad esempio, ONE), i dati risulteranno coerenti alla fine.</span><span class="sxs-lookup"><span data-stu-id="1c11d-153">For example, specifying QUORUM as the Consistency Level will always ensures data Consistency while any consistency level, below the number of replicas to be written as needed to attain QUORUM (e.g. ONE) results in data being eventually consistent.</span></span>

<span data-ttu-id="1c11d-154">Con il cluster a 8 nodi illustrato in precedenza, con un fattore di replica pari a 3 e un livello di coerenza in lettura/scrittura QUORUM (2 nodi vengono letti o scritti per coerenza), sarebbe possibile perdere un massimo di 1 nodo per gruppo di repliche prima che l'applicazione individuasse l'errore.</span><span class="sxs-lookup"><span data-stu-id="1c11d-154">The 8-node cluster shown above, with a replication factor of 3 and QUORUM (2 nodes are read or written for consistency) read/write consistency level, can survive the theoretical loss of at the most 1 node per replication group before the application start noticing the failure.</span></span> <span data-ttu-id="1c11d-155">Ciò presuppone che tutti gli spazi chiave abbiano ben bilanciato le richieste in lettura/scrittura.</span><span class="sxs-lookup"><span data-stu-id="1c11d-155">This assumes that all the key spaces have well balanced read/write requests.</span></span>  <span data-ttu-id="1c11d-156">I parametri seguenti verranno usati per il cluster distribuito:</span><span class="sxs-lookup"><span data-stu-id="1c11d-156">The following are the parameters we will use for the deployed cluster:</span></span>

<span data-ttu-id="1c11d-157">Configurazione del cluster Cassandra in un'area singola:</span><span class="sxs-lookup"><span data-stu-id="1c11d-157">Single region Cassandra cluster configuration:</span></span>

| <span data-ttu-id="1c11d-158">Parametro cluster</span><span class="sxs-lookup"><span data-stu-id="1c11d-158">Cluster Parameter</span></span> | <span data-ttu-id="1c11d-159">Valore</span><span class="sxs-lookup"><span data-stu-id="1c11d-159">Value</span></span> | <span data-ttu-id="1c11d-160">Osservazioni</span><span class="sxs-lookup"><span data-stu-id="1c11d-160">Remarks</span></span> |
| --- | --- | --- |
| <span data-ttu-id="1c11d-161">Number of Nodes (N)</span><span class="sxs-lookup"><span data-stu-id="1c11d-161">Number of Nodes (N)</span></span> |<span data-ttu-id="1c11d-162">8</span><span class="sxs-lookup"><span data-stu-id="1c11d-162">8</span></span> |<span data-ttu-id="1c11d-163">Numero totale di nodi nel cluster</span><span class="sxs-lookup"><span data-stu-id="1c11d-163">Total number of nodes in the cluster</span></span> |
| <span data-ttu-id="1c11d-164">Replication Factor (RF)</span><span class="sxs-lookup"><span data-stu-id="1c11d-164">Replication Factor (RF)</span></span> |<span data-ttu-id="1c11d-165">3</span><span class="sxs-lookup"><span data-stu-id="1c11d-165">3</span></span> |<span data-ttu-id="1c11d-166">Numero di repliche di una determinata riga</span><span class="sxs-lookup"><span data-stu-id="1c11d-166">Number of replicas of a given row</span></span> |
| <span data-ttu-id="1c11d-167">Consistency Level (Write)</span><span class="sxs-lookup"><span data-stu-id="1c11d-167">Consistency Level (Write)</span></span> |<span data-ttu-id="1c11d-168">QUORUM[(RF/2) +1) = 2] Il risultato della formula viene arrotondato per difetto</span><span class="sxs-lookup"><span data-stu-id="1c11d-168">QUORUM[(RF/2) +1) = 2] The result of the formula is rounded down</span></span> |<span data-ttu-id="1c11d-169">Scrive al massimo 2 repliche prima che la risposta venga inviata al chiamante. La terza replica viene scritta in modo coerente alla fine.</span><span class="sxs-lookup"><span data-stu-id="1c11d-169">Writes at the most 2 replicas before the response is sent to the caller; 3rd replica is written in an eventually consistent manner.</span></span> |
| <span data-ttu-id="1c11d-170">Consistency Level (Read)</span><span class="sxs-lookup"><span data-stu-id="1c11d-170">Consistency Level (Read)</span></span> |<span data-ttu-id="1c11d-171">QUORUM [(RF/2) +1= 2] Il risultato della formula viene arrotondato per difetto</span><span class="sxs-lookup"><span data-stu-id="1c11d-171">QUORUM [(RF/2) +1= 2] The result of the formula is rounded down</span></span> |<span data-ttu-id="1c11d-172">Legge 2 repliche prima di inviare la risposta al chiamante.</span><span class="sxs-lookup"><span data-stu-id="1c11d-172">Reads 2 replicas before sending response to the caller.</span></span> |
| <span data-ttu-id="1c11d-173">Replication Strategy</span><span class="sxs-lookup"><span data-stu-id="1c11d-173">Replication Strategy</span></span> |<span data-ttu-id="1c11d-174">NetworkTopologyStrategy: per ulteriori informazioni, vedere [Replica dei dati](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) nella documentazione di Cassandra</span><span class="sxs-lookup"><span data-stu-id="1c11d-174">NetworkTopologyStrategy see [Data Replication](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="1c11d-175">Riconosce la topologia della distribuzione e inserisce le repliche nei nodi in modo che tutte le repliche non finiscano nello stesso rack</span><span class="sxs-lookup"><span data-stu-id="1c11d-175">Understands the deployment topology and places replicas on nodes so that all the replicas don’t end up on the same rack</span></span> |
| <span data-ttu-id="1c11d-176">Snitch</span><span class="sxs-lookup"><span data-stu-id="1c11d-176">Snitch</span></span> |<span data-ttu-id="1c11d-177">GossipingPropertyFileSnitch: per ulteriori informazioni, vedere [Snitch](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) nella documentazione di Cassandra</span><span class="sxs-lookup"><span data-stu-id="1c11d-177">GossipingPropertyFileSnitch see [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="1c11d-178">NetworkTopologyStrategy usa il concetto di snitch per conoscere la topologia.</span><span class="sxs-lookup"><span data-stu-id="1c11d-178">NetworkTopologyStrategy uses a concept of snitch to understand the topology.</span></span> <span data-ttu-id="1c11d-179">GossipingPropertyFileSnitch offre un maggior controllo sul mapping di ogni nodo al data center e al rack.</span><span class="sxs-lookup"><span data-stu-id="1c11d-179">GossipingPropertyFileSnitch gives better control in mapping each node to data center and rack.</span></span> <span data-ttu-id="1c11d-180">Il cluster usa quindi il protocollo gossip per propagare queste informazioni.</span><span class="sxs-lookup"><span data-stu-id="1c11d-180">The cluster then uses gossip to propagate this information.</span></span> <span data-ttu-id="1c11d-181">Questo è molto più semplice nell'impostazione IP dinamico relativa a PropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="1c11d-181">This is much simpler in dynamic IP setting relative to PropertyFileSnitch</span></span> |

<span data-ttu-id="1c11d-182">**Considerazioni di Azure per Cluster Cassandra:** la funzionalità Macchine virtuali di Microsoft Azure utilizza l'archiviazione BLOB di Azure per la persistenza del disco; Archiviazione di Azure consente di salvare 3 repliche di ciascun disco per garantire una durabilità elevata.</span><span class="sxs-lookup"><span data-stu-id="1c11d-182">**Azure Considerations for Cassandra Cluster:** Microsoft Azure Virtual Machines capability uses Azure Blob storage for disk persistence; Azure Storage saves 3 replicas of each disk for high durability.</span></span> <span data-ttu-id="1c11d-183">Ciò significa che ogni riga di dati inserita in una tabella di Cassandra è già archiviata in 3 repliche e, pertanto, la coerenza dei dati è già assicurata anche se il fattore di replica (RF) è 1.</span><span class="sxs-lookup"><span data-stu-id="1c11d-183">That means each row of data inserted into a Cassandra table is already stored in 3 replicas and hence data consistency is already taken care of even if the Replication Factor (RF) is 1.</span></span> <span data-ttu-id="1c11d-184">Il problema principale con un fattore di replica pari a 1 è che l'applicazione subirà tempi di inattività anche in caso di errore di un singolo nodo di Cassandra.</span><span class="sxs-lookup"><span data-stu-id="1c11d-184">The main problem with Replication Factor being 1 is that the application will experience downtime even if a single Cassandra node fails.</span></span> <span data-ttu-id="1c11d-185">Tuttavia, se un nodo è inattivo per problemi riconosciuti dal Controller di infrastruttura di Azure, ad esempio errori hardware o del software di sistema, verrà effettuato il provisioning di un nuovo nodo utilizzando le stesse unità di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="1c11d-185">However, if a node is down for the problems (e.g. hardware, system software failures) recognized by Azure Fabric Controller, it will provision a new node in its place using the same storage drives.</span></span> <span data-ttu-id="1c11d-186">Il provisioning di un nuovo nodo per sostituire quello vecchio potrebbe richiedere alcuni minuti.</span><span class="sxs-lookup"><span data-stu-id="1c11d-186">Provisioning a new node to replace the old one may take a few minutes.</span></span>  <span data-ttu-id="1c11d-187">Allo stesso modo, per le attività di manutenzione pianificata come le modifiche del sistema operativo guest, gli aggiornamenti e le modifiche dell’applicazione di Cassandra, il controller di infrastruttura di Azure esegue in sequenza gli aggiornamenti dei nodi del cluster.</span><span class="sxs-lookup"><span data-stu-id="1c11d-187">Similarly for planned maintenance activities like guest OS changes, Cassandra upgrades and application changes Azure Fabric Controller performs rolling upgrades of the nodes in the cluster.</span></span>  <span data-ttu-id="1c11d-188">Gli aggiornamenti in sequenza potrebbero comportare l’inattività di alcuni nodi, per cui nel cluster potrebbe verificarsi breve periodo di inattività per alcune partizioni.</span><span class="sxs-lookup"><span data-stu-id="1c11d-188">Rolling upgrades also may take down a few nodes at a time and hence the cluster may experience brief downtime for a few partitions.</span></span> <span data-ttu-id="1c11d-189">Tuttavia, i dati non saranno persi grazie alla ridondanza di archiviazione di Azure incorporata.</span><span class="sxs-lookup"><span data-stu-id="1c11d-189">However, the data will not be lost due to the built-in Azure Storage redundancy.</span></span>  

<span data-ttu-id="1c11d-190">Per i sistemi distribuiti in Azure che non richiedono una disponibilità elevata (ad esempio circa 99,9, equivalente a 8,76 ore/anno; per i dettagli, vedere [Disponibilità elevata](http://en.wikipedia.org/wiki/High_availability) ), è possibile l'esecuzione con RF=1 e livello di coerenza = UNO.</span><span class="sxs-lookup"><span data-stu-id="1c11d-190">For systems deployed to Azure that doesn’t require high availability (e.g. around 99.9 which is equivalent to 8.76 hrs/year; see [High Availability](http://en.wikipedia.org/wiki/High_availability) for details) you may be able to run with RF=1 and Consistency Level=ONE.</span></span>  <span data-ttu-id="1c11d-191">Per le applicazioni con requisiti di disponibilità elevata, RF=3 e Consistency Level=QUORUM consentiranno di tollerare il tempo di inattività di uno dei nodi delle repliche.</span><span class="sxs-lookup"><span data-stu-id="1c11d-191">For applications with high availability requirements, RF=3 and Consistency Level=QUORUM will tolerate the down time of one of the nodes one of the replicas.</span></span> <span data-ttu-id="1c11d-192">RF=1 nelle distribuzioni tradizionali (ad esempio quelle locali) non può essere usato a causa della possibile perdita di dati causata da problemi come gli errori dei dischi.</span><span class="sxs-lookup"><span data-stu-id="1c11d-192">RF=1 in traditional deployments (e.g. on-premises) can’t be used due to the possible data loss resulting from problems like disk failures.</span></span>   

## <a name="multi-region-deployment"></a><span data-ttu-id="1c11d-193">Distribuzione in più aree</span><span class="sxs-lookup"><span data-stu-id="1c11d-193">Multi-region Deployment</span></span>
<span data-ttu-id="1c11d-194">Il modello descritto di replica e coerenza con riconoscimento del data center di Cassandra è di aiuto nella distribuzione in più aree predefinita, senza necessità di alcuno strumento esterno.</span><span class="sxs-lookup"><span data-stu-id="1c11d-194">Cassandra’s data-center-aware replication and consistency model described above helps with the multi-region deployment out of the box without the need for any external tooling.</span></span> <span data-ttu-id="1c11d-195">La differenza con i tradizionali database relazionali, in cui la configurazione per il mirroring del database per le scritture multimaster può essere molto complessa, è considerevole.</span><span class="sxs-lookup"><span data-stu-id="1c11d-195">This is quite different from the traditional relational databases where the setup for database mirroring for multi-master writes can be quite complex.</span></span> <span data-ttu-id="1c11d-196">Cassandra in una configurazione a più aree può essere utile negli scenari d'utilizzo seguenti:</span><span class="sxs-lookup"><span data-stu-id="1c11d-196">Cassandra in a multi-region set up can help with the usage scenarios including the following:</span></span>

<span data-ttu-id="1c11d-197">**Distribuzione basata su prossimità:** applicazioni multi-tenant, con mapping chiaro di utenti tenant all’area, possono trarre vantaggio dalle basse latenze del cluster con più aree.</span><span class="sxs-lookup"><span data-stu-id="1c11d-197">**Proximity based deployment:** Multi-tenant applications, with clear mapping of tenant users -to-region, can be benefited by the multi-region cluster’s low latencies.</span></span> <span data-ttu-id="1c11d-198">Ad esempio, sistemi di gestione della formazione per istituzioni didattiche possono distribuire un cluster distribuito nelle aree degli Stati Uniti orientali e degli Stati Uniti occidentali per servire i rispettivi campus sia per scopi di transazione che di analisi.</span><span class="sxs-lookup"><span data-stu-id="1c11d-198">For example a learning management systems for educational institutions can deploy a distributed cluster in East US and West US regions to serve the respective campuses for transactional as well as analytics.</span></span> <span data-ttu-id="1c11d-199">I dati possono essere coerenti localmente in fase di lettura e scrittura e possono essere alla fine coerenti tra le due aree.</span><span class="sxs-lookup"><span data-stu-id="1c11d-199">The data can be locally consistent at the time reads and writes and can be eventually consistent across both the regions.</span></span> <span data-ttu-id="1c11d-200">Sono disponibili altri esempi quali la distribuzione su supporti, e-commerce, e qualsiasi elemento serva alla base utenti concentrata geograficamente è un buon caso di utilizzo per questo modello di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="1c11d-200">There are other examples like media distribution, e-commerce and anything and everything that serves geo concentrated user base is a good use case for this deployment model.</span></span>

<span data-ttu-id="1c11d-201">**Disponibilità elevata:** la ridondanza è un fattore chiave per ottenere un'elevata disponibilità di software e hardware; per ulteriori informazioni, vedere la sezione sulla compilazione di sistemi cloud affidabili in Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="1c11d-201">**High Availability:** Redundancy is a key factor in attaining high availability of software and hardware; see Building Reliable Cloud Systems on Microsoft Azure for details.</span></span> <span data-ttu-id="1c11d-202">In Microsoft Azure, l'unico modo affidabile per ottenere una vera ridondanza è la distribuzione di un cluster con più aree.</span><span class="sxs-lookup"><span data-stu-id="1c11d-202">On Microsoft Azure, the only reliable way of achieving true redundancy is by deploying a multi-region cluster.</span></span> <span data-ttu-id="1c11d-203">Le applicazioni possono essere distribuite in modalità attivo-attivo o attivo-passivo e se una delle aree è inattiva, Gestione traffico di Azure può reindirizzare il traffico all'area attiva.</span><span class="sxs-lookup"><span data-stu-id="1c11d-203">Applications can be deployed in an active-active or active-passive mode and if one of the regions is down, Azure Traffic Manager can redirect traffic to the active region.</span></span>  <span data-ttu-id="1c11d-204">Con la distribuzione della singola area, se la disponibilità è 99,9, una distribuzione di due aree può raggiungere una disponibilità di 99,9999, calcolata con la formula: (1-(1-0,999) * (1-0,999))*100). Vedere il documento precedente per informazioni dettagliate.</span><span class="sxs-lookup"><span data-stu-id="1c11d-204">With the single region deployment, if the availability is 99.9, a two-region deployment can attain an availability of 99.9999 computed by the formula: (1-(1-0.999) * (1-0.999))*100); see the above paper for details.</span></span>

<span data-ttu-id="1c11d-205">**Ripristino di emergenza:** il cluster Cassandra con più aree, se correttamente progettato, può far fronte a potenziali interruzioni irreversibili del centro.</span><span class="sxs-lookup"><span data-stu-id="1c11d-205">**Disaster Recovery:** Multi-region Cassandra cluster, if properly designed, can withstand catastrophic data center outages.</span></span> <span data-ttu-id="1c11d-206">Se un'area è inattiva, l'applicazione distribuita in altre aree può iniziare a servire gli utenti finali.</span><span class="sxs-lookup"><span data-stu-id="1c11d-206">If one region is down, the application deployed to other regions can start serving the end users.</span></span> <span data-ttu-id="1c11d-207">Come le altre implementazioni di continuità aziendale, l'applicazione deve tollerare una certa perdita di dati risultante dai dati della pipeline asincrona.</span><span class="sxs-lookup"><span data-stu-id="1c11d-207">Like any other business continuity implementations, the application has to be tolerant for some data loss resulting from the data in the asynchronous pipeline.</span></span> <span data-ttu-id="1c11d-208">Tuttavia, Cassandra rende il ripristino molto più veloce rispetto ai tradizionali processi di ripristino dei database.</span><span class="sxs-lookup"><span data-stu-id="1c11d-208">However, Cassandra makes the recovery much swifter than the time taken by traditional database recovery processes.</span></span> <span data-ttu-id="1c11d-209">La figura 2 mostra il tipico modello di distribuzione con più aree con otto nodi in ogni area.</span><span class="sxs-lookup"><span data-stu-id="1c11d-209">Figure 2 shows the typical multi-region deployment model with eight nodes in each region.</span></span> <span data-ttu-id="1c11d-210">Entrambe le aree sono immagini speculari tra loro per simmetria; i progetti reali dipendono dai requisiti relativi a tipo di carico di lavoro (ad esempio transazionale o analitico), RPO, RTO, coerenza dei dati e disponibilità.</span><span class="sxs-lookup"><span data-stu-id="1c11d-210">Both regions are mirror images of each other for the same of symmetry; real world designs depend on the workload type (e.g. transactional or analytical), RPO, RTO, data consistency and availability requirements.</span></span>

![Distribuzione in più aree](./media/cassandra-nodejs/cassandra-linux2.png)

<span data-ttu-id="1c11d-212">Figura 2: Distribuzione di Cassandra con più aree</span><span class="sxs-lookup"><span data-stu-id="1c11d-212">Figure 2: Multi-region Cassandra deployment</span></span>

### <a name="network-integration"></a><span data-ttu-id="1c11d-213">Integrazione della rete</span><span class="sxs-lookup"><span data-stu-id="1c11d-213">Network Integration</span></span>
<span data-ttu-id="1c11d-214">I set di macchine virtuali distribuiti in reti private in due aree diverse comunicano tra loro con un tunnel VPN.</span><span class="sxs-lookup"><span data-stu-id="1c11d-214">Sets of virtual machines deployed to private networks located on two regions communicates with each other using a VPN tunnel.</span></span> <span data-ttu-id="1c11d-215">Il tunnel VPN connette due gateway software di cui viene effettuato il provisioning durante il processo di distribuzione in rete.</span><span class="sxs-lookup"><span data-stu-id="1c11d-215">The VPN tunnel connects two software gateways provisioned during the network deployment process.</span></span> <span data-ttu-id="1c11d-216">Entrambe le aree hanno un'architettura di rete simile a livello di subnet Web e di dati. La rete di Azure consente di creare tutte le subnet necessarie e di applicare gli elenchi ACL come richiesto dalla sicurezza di rete.</span><span class="sxs-lookup"><span data-stu-id="1c11d-216">Both regions have similar network architecture in terms of “web” and “data” subnets; Azure networking allows the creation of as many subnets as needed and apply ACLs as needed by network security.</span></span> <span data-ttu-id="1c11d-217">Quando si progetta la topologia del cluster, è necessario tenere in considerazione la latenza della comunicazione tra data center e l'impatto economico del traffico di rete.</span><span class="sxs-lookup"><span data-stu-id="1c11d-217">While designing the cluster topology inter data center communication latency and the economic impact of the network traffic need to be considered.</span></span>

### <a name="data-consistency-for-multi-data-center-deployment"></a><span data-ttu-id="1c11d-218">Coerenza dei dati per la distribuzione in più data center</span><span class="sxs-lookup"><span data-stu-id="1c11d-218">Data Consistency for Multi-Data Center Deployment</span></span>
<span data-ttu-id="1c11d-219">Le distribuzioni devono riconoscere l'impatto della topologia del cluster sulla velocità effettiva e sulla disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="1c11d-219">Distributed deployments need to be aware of the cluster topology impact on throughput and high availability.</span></span> <span data-ttu-id="1c11d-220">Il fattore di replica e il livello di coerenza devono essere selezionati in modo che il quorum non dipenda dalla disponibilità di tutti i data center.</span><span class="sxs-lookup"><span data-stu-id="1c11d-220">The RF and Consistency Level need to be selected in such way that the quorum doesn’t depend on the availability of all the data centers.</span></span>
<span data-ttu-id="1c11d-221">Per un sistema che richiede una coerenza elevata, un livello di coerenza LOCAL_QUORUM (per letture e scritture) garantirà che le letture e le scritture locali vengano soddisfatte dai nodi locali mentre i dati vengono replicati in modo asincrono nei data center remoti.</span><span class="sxs-lookup"><span data-stu-id="1c11d-221">For a system that needs high consistency, a LOCAL_QUORUM for consistency level (for reads and writes) will make sure that the local reads and writes are satisfied from the local nodes while data is replicated asynchronously to the remote data centers.</span></span>  <span data-ttu-id="1c11d-222">La tabella 2 riepiloga i dettagli della configurazione per il cluster in più aree, che verrà illustrata più avanti in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="1c11d-222">Table 2 summarizes the configuration details for the multi-region cluster outlined later in the write up.</span></span>

<span data-ttu-id="1c11d-223">**Configurazione del cluster Cassandra in due aree**</span><span class="sxs-lookup"><span data-stu-id="1c11d-223">**Two-region Cassandra cluster configuration**</span></span>

| <span data-ttu-id="1c11d-224">Parametro cluster</span><span class="sxs-lookup"><span data-stu-id="1c11d-224">Cluster Parameter</span></span> | <span data-ttu-id="1c11d-225">Valore</span><span class="sxs-lookup"><span data-stu-id="1c11d-225">Value</span></span> | <span data-ttu-id="1c11d-226">Osservazioni</span><span class="sxs-lookup"><span data-stu-id="1c11d-226">Remarks</span></span> |
| --- | --- | --- |
| <span data-ttu-id="1c11d-227">Number of Nodes (N)</span><span class="sxs-lookup"><span data-stu-id="1c11d-227">Number of Nodes (N)</span></span> |<span data-ttu-id="1c11d-228">8 + 8</span><span class="sxs-lookup"><span data-stu-id="1c11d-228">8 + 8</span></span> |<span data-ttu-id="1c11d-229">Numero totale di nodi nel cluster</span><span class="sxs-lookup"><span data-stu-id="1c11d-229">Total number of nodes in the cluster</span></span> |
| <span data-ttu-id="1c11d-230">Replication Factor (RF)</span><span class="sxs-lookup"><span data-stu-id="1c11d-230">Replication Factor (RF)</span></span> |<span data-ttu-id="1c11d-231">3</span><span class="sxs-lookup"><span data-stu-id="1c11d-231">3</span></span> |<span data-ttu-id="1c11d-232">Numero di repliche di una determinata riga</span><span class="sxs-lookup"><span data-stu-id="1c11d-232">Number of replicas of a given row</span></span> |
| <span data-ttu-id="1c11d-233">Consistency Level (Write)</span><span class="sxs-lookup"><span data-stu-id="1c11d-233">Consistency Level (Write)</span></span> |<span data-ttu-id="1c11d-234">LOCAL_QUORUM [(sum(RF)/2) +1) = 4] Il risultato della formula viene arrotondato per difetto</span><span class="sxs-lookup"><span data-stu-id="1c11d-234">LOCAL_QUORUM [(sum(RF)/2) +1) = 4] The result of the formula is rounded down</span></span> |<span data-ttu-id="1c11d-235">2 nodi verranno scritti nel primo data center in modo sincrono. Gli altri 2 nodi necessari per il quorum verranno scritti in modo asincrono nel secondo data center.</span><span class="sxs-lookup"><span data-stu-id="1c11d-235">2 nodes will be written to the first data center synchronously; the additional 2 nodes needed for quorum will be written asynchronously to the 2nd data center.</span></span> |
| <span data-ttu-id="1c11d-236">Consistency Level (Read)</span><span class="sxs-lookup"><span data-stu-id="1c11d-236">Consistency Level (Read)</span></span> |<span data-ttu-id="1c11d-237">LOCAL_QUORUM((RF/2) +1) = 2 Il risultato della formula viene arrotondato per difetto</span><span class="sxs-lookup"><span data-stu-id="1c11d-237">LOCAL_QUORUM ((RF/2) +1) = 2 The result of the formula is rounded down</span></span> |<span data-ttu-id="1c11d-238">Le richieste di lettura vengono soddisfatte da una sola area. 2 nodi vengono letti prima che la risposta venga inviata nuovamente al client.</span><span class="sxs-lookup"><span data-stu-id="1c11d-238">Read requests are satisfied from only one region; 2 nodes are read before the response is sent back to the client.</span></span> |
| <span data-ttu-id="1c11d-239">Replication Strategy</span><span class="sxs-lookup"><span data-stu-id="1c11d-239">Replication Strategy</span></span> |<span data-ttu-id="1c11d-240">NetworkTopologyStrategy: per ulteriori informazioni, vedere [Replica dei dati](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) nella documentazione di Cassandra</span><span class="sxs-lookup"><span data-stu-id="1c11d-240">NetworkTopologyStrategy see [Data Replication](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="1c11d-241">Riconosce la topologia della distribuzione e inserisce le repliche nei nodi in modo che tutte le repliche non finiscano nello stesso rack</span><span class="sxs-lookup"><span data-stu-id="1c11d-241">Understands the deployment topology and places replicas on nodes so that all the replicas don’t end up on the same rack</span></span> |
| <span data-ttu-id="1c11d-242">Snitch</span><span class="sxs-lookup"><span data-stu-id="1c11d-242">Snitch</span></span> |<span data-ttu-id="1c11d-243">GossipingPropertyFileSnitch: per ulteriori informazioni, vedere [Snitch](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) nella documentazione di Cassandra</span><span class="sxs-lookup"><span data-stu-id="1c11d-243">GossipingPropertyFileSnitch see [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="1c11d-244">NetworkTopologyStrategy usa il concetto di snitch per conoscere la topologia.</span><span class="sxs-lookup"><span data-stu-id="1c11d-244">NetworkTopologyStrategy uses a concept of snitch to understand the topology.</span></span> <span data-ttu-id="1c11d-245">GossipingPropertyFileSnitch offre un maggior controllo sul mapping di ogni nodo al data center e al rack.</span><span class="sxs-lookup"><span data-stu-id="1c11d-245">GossipingPropertyFileSnitch gives better control in mapping each node to data center and rack.</span></span> <span data-ttu-id="1c11d-246">Il cluster usa quindi il protocollo gossip per propagare queste informazioni.</span><span class="sxs-lookup"><span data-stu-id="1c11d-246">The cluster then uses gossip to propagate this information.</span></span> <span data-ttu-id="1c11d-247">Questo è molto più semplice nell'impostazione IP dinamico relativa a PropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="1c11d-247">This is much simpler in dynamic IP setting relative to PropertyFileSnitch</span></span> |

## <a name="the-software-configuration"></a><span data-ttu-id="1c11d-248">CONFIGURAZIONE SOFTWARE</span><span class="sxs-lookup"><span data-stu-id="1c11d-248">THE SOFTWARE CONFIGURATION</span></span>
<span data-ttu-id="1c11d-249">Durante la distribuzione vengono usate le seguenti versioni software:</span><span class="sxs-lookup"><span data-stu-id="1c11d-249">The following software versions are used during the deployment:</span></span>

<table>
<tr><th><span data-ttu-id="1c11d-250">Software</span><span class="sxs-lookup"><span data-stu-id="1c11d-250">Software</span></span></th><th><span data-ttu-id="1c11d-251">Sorgente</span><span class="sxs-lookup"><span data-stu-id="1c11d-251">Source</span></span></th><th><span data-ttu-id="1c11d-252">Versione</span><span class="sxs-lookup"><span data-stu-id="1c11d-252">Version</span></span></th></tr>
<tr><td><span data-ttu-id="1c11d-253">JRE</span><span class="sxs-lookup"><span data-stu-id="1c11d-253">JRE</span></span>    </td><td><span data-ttu-id="1c11d-254">[JRE 8](http://www.oracle.com/technetwork/java/javase/downloads/server-jre8-downloads-2133154.html) </span><span class="sxs-lookup"><span data-stu-id="1c11d-254">[JRE 8](http://www.oracle.com/technetwork/java/javase/downloads/server-jre8-downloads-2133154.html) </span></span></td><td><span data-ttu-id="1c11d-255">8U5</span><span class="sxs-lookup"><span data-stu-id="1c11d-255">8U5</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-256">JNA</span><span class="sxs-lookup"><span data-stu-id="1c11d-256">JNA</span></span>    </td><td><span data-ttu-id="1c11d-257">[JNA](https://github.com/twall/jna) </span><span class="sxs-lookup"><span data-stu-id="1c11d-257">[JNA](https://github.com/twall/jna) </span></span></td><td> <span data-ttu-id="1c11d-258">3.2.7</span><span class="sxs-lookup"><span data-stu-id="1c11d-258">3.2.7</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-259">Cassandra</span><span class="sxs-lookup"><span data-stu-id="1c11d-259">Cassandra</span></span></td><td>[<span data-ttu-id="1c11d-260">Apache Cassandra 2.0.8</span><span class="sxs-lookup"><span data-stu-id="1c11d-260">Apache Cassandra 2.0.8</span></span>](http://www.apache.org/dist/cassandra/2.0.8/apache-cassandra-2.0.8-bin.tar.gz)</td><td> <span data-ttu-id="1c11d-261">2.0.8</span><span class="sxs-lookup"><span data-stu-id="1c11d-261">2.0.8</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-262">Ubuntu</span><span class="sxs-lookup"><span data-stu-id="1c11d-262">Ubuntu</span></span>    </td><td><span data-ttu-id="1c11d-263">[Microsoft Azure](https://azure.microsoft.com/) </span><span class="sxs-lookup"><span data-stu-id="1c11d-263">[Microsoft Azure](https://azure.microsoft.com/) </span></span></td><td><span data-ttu-id="1c11d-264">14.04 LTS</span><span class="sxs-lookup"><span data-stu-id="1c11d-264">14.04 LTS</span></span></td></tr>
</table>

<span data-ttu-id="1c11d-265">Poiché il download di JRE richiede di accettare manualmente la licenza Oracle, per semplificare la distribuzione, scaricare tutto il software necessario nel desktop per caricarlo in seguito nell'immagine modello di Ubuntu che verrà creata come precursore della distribuzione cluster.</span><span class="sxs-lookup"><span data-stu-id="1c11d-265">Since downloading of JRE requires manual acceptance of Oracle license, to simplify the deployment, download all the required software to the desktop for later uploading into the Ubuntu template image we will be creating as a precursor to the cluster deployment.</span></span>

<span data-ttu-id="1c11d-266">Scaricare il software citato sopra in una directory per i download nota (ad esempio, %TEMP%/Downloads in Windows o ~/nella maggior parte di distribuzioni Linux o Mac) nel computer locale.</span><span class="sxs-lookup"><span data-stu-id="1c11d-266">Download the above software into a well-known download directory (e.g. %TEMP%/downloads on Windows or ~/Downloads on most Linux distributions or Mac) on the local computer.</span></span>

### <a name="create-ubuntu-vm"></a><span data-ttu-id="1c11d-267">CREARE UNA MACCHINA VIRTUALE UBUNTU</span><span class="sxs-lookup"><span data-stu-id="1c11d-267">CREATE UBUNTU VM</span></span>
<span data-ttu-id="1c11d-268">In questo passaggio del processo verrà creata l'immagine di Ubuntu con i prerequisiti software per poter riusare l'immagine per il provisioning di più nodi di Cassandra.</span><span class="sxs-lookup"><span data-stu-id="1c11d-268">In this step of the process we will create Ubuntu image with the pre-requisite software so that the image can be reused for provisioning several Cassandra nodes.</span></span>  

#### <a name="step-1-generate-ssh-key-pair"></a><span data-ttu-id="1c11d-269">PASSAGGIO 1: Generare la coppia di chiavi SSH</span><span class="sxs-lookup"><span data-stu-id="1c11d-269">STEP 1: Generate SSH key pair</span></span>
<span data-ttu-id="1c11d-270">In fase di provisioning Azure richiede una chiave pubblica X509 con codifica PEM o DER.</span><span class="sxs-lookup"><span data-stu-id="1c11d-270">Azure needs an X509 public key that is either PEM or DER encoded at the provisioning time.</span></span> <span data-ttu-id="1c11d-271">Generare una coppia di chiavi pubbliche/private seguendo le istruzioni contenute in Come usare SSH con Linux in Azure.</span><span class="sxs-lookup"><span data-stu-id="1c11d-271">Generate a public/private key pair using the instructions located at How to Use SSH with Linux on Azure.</span></span> <span data-ttu-id="1c11d-272">Se si prevede di usare putty.exe come client SSH in Windows o Linux, è necessario convertire la chiave privata RSA con codifica PEM nel formato PPK mediante puttygen.exe. Le istruzioni relative a questa operazione sono disponibili nella pagina Web precedente.</span><span class="sxs-lookup"><span data-stu-id="1c11d-272">If you plan to use putty.exe as an SSH client either on Windows or Linux, you have to convert the PEM encoded RSA private key to PPK format using puttygen.exe; the instructions for this can be found in the above web page.</span></span>

#### <a name="step-2-create-ubuntu-template-vm"></a><span data-ttu-id="1c11d-273">PASSAGGIO 2: Creare una macchina virtuale modello Ubuntu</span><span class="sxs-lookup"><span data-stu-id="1c11d-273">STEP 2: Create Ubuntu template VM</span></span>
<span data-ttu-id="1c11d-274">Per creare il modello di macchina virtuale, accedere al portale di Azure classico e usare la sequenza seguente: fare clic su NUOVO, CALCOLO, MACCHINA VIRTUALE, DA RACCOLTA, UBUNTU, Ubuntu Server 14.04 LTS e quindi fare clic sulla freccia a destra.</span><span class="sxs-lookup"><span data-stu-id="1c11d-274">To create the template VM, log into the Azure classic portal and use the following sequence: Click NEW, COMPUTE, VIRTUAL MACHINE, FROM GALLERY, UBUNTU, Ubuntu Server 14.04 LTS, and then click the right arrow.</span></span> <span data-ttu-id="1c11d-275">Per un'esercitazione che descrive come creare una macchina virtuale Linux, vedere Creazione di una macchina virtuale che esegue Linux.</span><span class="sxs-lookup"><span data-stu-id="1c11d-275">For a tutorial that describes how to create a Linux VM, see Create a Virtual Machine Running Linux.</span></span>

<span data-ttu-id="1c11d-276">Immettere le informazioni seguenti nella schermata n. 1 "Configurazione macchina virtuale":</span><span class="sxs-lookup"><span data-stu-id="1c11d-276">Enter the following information on the “Virtual machine configuration” screen #1:</span></span>

<table>
<tr><th><span data-ttu-id="1c11d-277">NOME CAMPO</span><span class="sxs-lookup"><span data-stu-id="1c11d-277">FIELD NAME</span></span>              </td><td>       <span data-ttu-id="1c11d-278">VALORE CAMPO</span><span class="sxs-lookup"><span data-stu-id="1c11d-278">FIELD VALUE</span></span>               </td><td>         <span data-ttu-id="1c11d-279">OSSERVAZIONI</span><span class="sxs-lookup"><span data-stu-id="1c11d-279">REMARKS</span></span>                </td><tr>
<tr><td><span data-ttu-id="1c11d-280">DATA DI RILASCIO VERSIONE</span><span class="sxs-lookup"><span data-stu-id="1c11d-280">VERSION RELEASE DATE</span></span>    </td><td> <span data-ttu-id="1c11d-281">Selezionare una data dall'elenco a discesa</span><span class="sxs-lookup"><span data-stu-id="1c11d-281">Select a date from the drop down</span></span></td><td></td><tr>
<tr><td><span data-ttu-id="1c11d-282">NOME MACCHINA VIRTUALE</span><span class="sxs-lookup"><span data-stu-id="1c11d-282">VIRTUAL MACHINE NAME</span></span>    </td><td> <span data-ttu-id="1c11d-283">cass-template</span><span class="sxs-lookup"><span data-stu-id="1c11d-283">cass-template</span></span>                   </td><td> <span data-ttu-id="1c11d-284">Nome host della macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="1c11d-284">This is the hostname of the VM</span></span> </td><tr>
<tr><td><span data-ttu-id="1c11d-285">LIVELLO</span><span class="sxs-lookup"><span data-stu-id="1c11d-285">TIER</span></span>                     </td><td> <span data-ttu-id="1c11d-286">STANDARD</span><span class="sxs-lookup"><span data-stu-id="1c11d-286">STANDARD</span></span>                           </td><td> <span data-ttu-id="1c11d-287">Lasciare l'impostazione predefinita</span><span class="sxs-lookup"><span data-stu-id="1c11d-287">Leave the default</span></span>              </td><tr>
<tr><td><span data-ttu-id="1c11d-288">DIMENSIONE</span><span class="sxs-lookup"><span data-stu-id="1c11d-288">SIZE</span></span>                     </td><td> <span data-ttu-id="1c11d-289">A1</span><span class="sxs-lookup"><span data-stu-id="1c11d-289">A1</span></span>                              </td><td><span data-ttu-id="1c11d-290">Selezionare la macchina virtuale in base alle esigenze di IO; per questo scopo, lasciare l'impostazione predefinita</span><span class="sxs-lookup"><span data-stu-id="1c11d-290">Select the VM based on the IO needs; for this purpose leave the default</span></span> </td><tr>
<tr><td> <span data-ttu-id="1c11d-291">NUOVO NOME UTENTE</span><span class="sxs-lookup"><span data-stu-id="1c11d-291">NEW USER NAME</span></span>             </td><td> <span data-ttu-id="1c11d-292">localadmin</span><span class="sxs-lookup"><span data-stu-id="1c11d-292">localadmin</span></span>                       </td><td> <span data-ttu-id="1c11d-293">"admin" è un nome utente riservato in Ubuntu 12.xx e versioni successive</span><span class="sxs-lookup"><span data-stu-id="1c11d-293">"admin" is a reserved user name in Ubuntu 12.xx and after</span></span></td><tr>
<tr><td> <span data-ttu-id="1c11d-294">AUTENTICAZIONE</span><span class="sxs-lookup"><span data-stu-id="1c11d-294">AUTHENTICATION</span></span>         </td><td> <span data-ttu-id="1c11d-295">Fare clic sulla casella di controllo</span><span class="sxs-lookup"><span data-stu-id="1c11d-295">Click check box</span></span>                 </td><td><span data-ttu-id="1c11d-296">Selezionare se si desidera applicare la protezione con una chiave SSH</span><span class="sxs-lookup"><span data-stu-id="1c11d-296">Check if you want to secure with an SSH key</span></span> </td><tr>
<tr><td> <span data-ttu-id="1c11d-297">CERTIFICATO</span><span class="sxs-lookup"><span data-stu-id="1c11d-297">CERTIFICATE</span></span>             </td><td> <span data-ttu-id="1c11d-298">nome file del certificato di chiave pubblica</span><span class="sxs-lookup"><span data-stu-id="1c11d-298">file name of the public key certificate</span></span> </td><td> <span data-ttu-id="1c11d-299">Usare la chiave pubblica generata in precedenza</span><span class="sxs-lookup"><span data-stu-id="1c11d-299">Use the public key generated previously</span></span></td><tr>
<tr><td> <span data-ttu-id="1c11d-300">Nuova password</span><span class="sxs-lookup"><span data-stu-id="1c11d-300">New Password</span></span>    </td><td> <span data-ttu-id="1c11d-301">password complessa</span><span class="sxs-lookup"><span data-stu-id="1c11d-301">strong password</span></span> </td><td> </td><tr>
<tr><td> <span data-ttu-id="1c11d-302">Confirm Password</span><span class="sxs-lookup"><span data-stu-id="1c11d-302">Confirm Password</span></span>    </td><td> <span data-ttu-id="1c11d-303">password complessa</span><span class="sxs-lookup"><span data-stu-id="1c11d-303">strong password</span></span> </td><td></td><tr>
</table>

<span data-ttu-id="1c11d-304">Immettere le informazioni seguenti nella schermata n. 2 "Configurazione macchina virtuale":</span><span class="sxs-lookup"><span data-stu-id="1c11d-304">Enter the following information on the “Virtual machine configuration” screen #2:</span></span>

<table>
<tr><th><span data-ttu-id="1c11d-305">NOME CAMPO</span><span class="sxs-lookup"><span data-stu-id="1c11d-305">FIELD NAME</span></span>             </th><th> <span data-ttu-id="1c11d-306">VALORE CAMPO</span><span class="sxs-lookup"><span data-stu-id="1c11d-306">FIELD VALUE</span></span>                       </th><th> <span data-ttu-id="1c11d-307">OSSERVAZIONI</span><span class="sxs-lookup"><span data-stu-id="1c11d-307">REMARKS</span></span>                                 </th></tr>
<tr><td> <span data-ttu-id="1c11d-308">SERVIZIO CLOUD</span><span class="sxs-lookup"><span data-stu-id="1c11d-308">CLOUD SERVICE</span></span>    </td><td> <span data-ttu-id="1c11d-309">Crea un nuovo servizio cloud</span><span class="sxs-lookup"><span data-stu-id="1c11d-309">Create a new cloud service</span></span>    </td><td><span data-ttu-id="1c11d-310">Il servizio cloud è un contenitore per le risorse di calcolo come le macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="1c11d-310">Cloud service is a container compute resources like virtual machines</span></span></td></tr>
<tr><td> <span data-ttu-id="1c11d-311">NOME DNS DEL SERVIZIO CLOUD:</span><span class="sxs-lookup"><span data-stu-id="1c11d-311">CLOUD SERVICE DNS NAME</span></span>    </td><td><span data-ttu-id="1c11d-312">ubuntu-template.cloudapp.net</span><span class="sxs-lookup"><span data-stu-id="1c11d-312">ubuntu-template.cloudapp.net</span></span>    </td><td><span data-ttu-id="1c11d-313">Assegnare un nome bilanciamento del carico indipendente dal computer</span><span class="sxs-lookup"><span data-stu-id="1c11d-313">Give a machine agnostic load balancer name</span></span></td></tr>
<tr><td> <span data-ttu-id="1c11d-314">AREA/GRUPPO DI AFFINITÀ/RETE VIRTUALE</span><span class="sxs-lookup"><span data-stu-id="1c11d-314">REGION/AFFINITY GROUP/VIRTUAL NETWORK</span></span> </td><td>    <span data-ttu-id="1c11d-315">Stati Uniti occidentali</span><span class="sxs-lookup"><span data-stu-id="1c11d-315">West US</span></span>    </td><td> <span data-ttu-id="1c11d-316">Selezionare un'area da cui le applicazioni Web accedono al cluster Cassandra</span><span class="sxs-lookup"><span data-stu-id="1c11d-316">Select a region from which your web applications access the Cassandra cluster</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-317">ACCOUNT DI ARCHIVIAZIONE</span><span class="sxs-lookup"><span data-stu-id="1c11d-317">STORAGE ACCOUNT</span></span> </td><td>    <span data-ttu-id="1c11d-318">Usare l'impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="1c11d-318">Use default</span></span>    </td><td><span data-ttu-id="1c11d-319">Usare l'account di archiviazione predefinito o un account di archiviazione creato in precedenza in una determinata area</span><span class="sxs-lookup"><span data-stu-id="1c11d-319">Use the default storage account  or a pre-created storage account in a particular region</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-320">Set di disponibilità</span><span class="sxs-lookup"><span data-stu-id="1c11d-320">AVAILABILITY SET</span></span> </td><td>    <span data-ttu-id="1c11d-321">None</span><span class="sxs-lookup"><span data-stu-id="1c11d-321">None</span></span> </td><td>    <span data-ttu-id="1c11d-322">Lasciare vuoto</span><span class="sxs-lookup"><span data-stu-id="1c11d-322">Leave it blank</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-323">ENDPOINT</span><span class="sxs-lookup"><span data-stu-id="1c11d-323">ENDPOINTS</span></span>    </td><td><span data-ttu-id="1c11d-324">Usare l'impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="1c11d-324">Use default</span></span> </td><td>    <span data-ttu-id="1c11d-325">Usare la configurazione SSH predefinita</span><span class="sxs-lookup"><span data-stu-id="1c11d-325">Use the default SSH configuration</span></span> </td></tr>
</table>

<span data-ttu-id="1c11d-326">Fare clic sulla freccia destra, lasciare le impostazioni predefinite nella schermata n. 3 e fare clic sul pulsante con il segno di spunta per completare il processo di provisioning della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="1c11d-326">Click right arrow, leave the defaults on the screen #3 and click the “check” button to complete the VM provisioning process.</span></span> <span data-ttu-id="1c11d-327">Dopo alcuni minuti, la macchina virtuale "ubuntu-template" sarà in stato "In esecuzione".</span><span class="sxs-lookup"><span data-stu-id="1c11d-327">After a few minutes, the VM with the name “ubuntu-template” should be in a “running” status.</span></span>

### <a name="install-the-necessary-software"></a><span data-ttu-id="1c11d-328">INSTALLARE IL SOFTWARE NECESSARIO</span><span class="sxs-lookup"><span data-stu-id="1c11d-328">INSTALL THE NECESSARY SOFTWARE</span></span>
#### <a name="step-1-upload-tarballs"></a><span data-ttu-id="1c11d-329">PASSAGGIO 1: Caricare i file tarball</span><span class="sxs-lookup"><span data-stu-id="1c11d-329">STEP 1: Upload tarballs</span></span>
<span data-ttu-id="1c11d-330">Con scp o pscp, copiare il software scaricato in precedenza nella directory ~/downloads con il seguente formato del comando:</span><span class="sxs-lookup"><span data-stu-id="1c11d-330">Using scp or pscp, copy the previously downloaded software to ~/downloads directory using the following command format:</span></span>

##### <a name="pscp-server-jre-8u5-linux-x64targz-localadminhk-cas-templatecloudappnethomelocaladmindownloadsserver-jre-8u5-linux-x64targz"></a><span data-ttu-id="1c11d-331">pscp server-jre-8u5-linux-x64.tar.gz localadmin@hk-cas-template.cloudapp.net:/home/localadmin/downloads/server-jre-8u5-linux-x64.tar.gz</span><span class="sxs-lookup"><span data-stu-id="1c11d-331">pscp server-jre-8u5-linux-x64.tar.gz localadmin@hk-cas-template.cloudapp.net:/home/localadmin/downloads/server-jre-8u5-linux-x64.tar.gz</span></span>
<span data-ttu-id="1c11d-332">Ripetere il comando precedente per JRE e per i bit di Cassandra.</span><span class="sxs-lookup"><span data-stu-id="1c11d-332">Repeat the above command for JRE as well as for the Cassandra bits.</span></span>

#### <a name="step-2-prepare-the-directory-structure-and-extract-the-archives"></a><span data-ttu-id="1c11d-333">PASSAGGIO 2: Preparare la struttura di directory ed estrarre gli archivi</span><span class="sxs-lookup"><span data-stu-id="1c11d-333">STEP 2: Prepare the directory structure and extract the archives</span></span>
<span data-ttu-id="1c11d-334">Accedere alla macchina virtuale e creare la struttura di directory ed estrarre il software come utente con privilegi avanzati con lo script bash seguente:</span><span class="sxs-lookup"><span data-stu-id="1c11d-334">Log into the VM and create the directory structure and extract software as a super user using the bash script below:</span></span>

    #!/bin/bash
    CASS_INSTALL_DIR="/opt/cassandra"
    JRE_INSTALL_DIR="/opt/java"
    CASS_DATA_DIR="/var/lib/cassandra"
    CASS_LOG_DIR="/var/log/cassandra"
    DOWNLOADS_DIR="~/downloads"
    JRE_TARBALL="server-jre-8u5-linux-x64.tar.gz"
    CASS_TARBALL="apache-cassandra-2.0.8-bin.tar.gz"
    SVC_USER="localadmin"

    RESET_ERROR=1
    MKDIR_ERROR=2

    reset_installation ()
    {
       rm -rf $CASS_INSTALL_DIR 2> /dev/null
       rm -rf $JRE_INSTALL_DIR 2> /dev/null
       rm -rf $CASS_DATA_DIR 2> /dev/null
       rm -rf $CASS_LOG_DIR 2> /dev/null
    }
    make_dir ()
    {
       if [ -z "$1" ]
       then
          echo "make_dir: invalid directory name"
          exit $MKDIR_ERROR
       fi

       if [ -d "$1" ]
       then
          echo "make_dir: directory already exists"
          exit $MKDIR_ERROR
       fi

       mkdir $1 2>/dev/null
       if [ $? != 0 ]
       then
          echo "directory creation failed"
          exit $MKDIR_ERROR
       fi
    }

    unzip()
    {
       if [ $# == 2 ]
       then
          tar xzf $1 -C $2
       else
          echo "archive error"
       fi

    }

    if [ -n "$1" ]
    then
       SVC_USER=$1
    fi

    reset_installation
    make_dir $CASS_INSTALL_DIR
    make_dir $JRE_INSTALL_DIR
    make_dir $CASS_DATA_DIR
    make_dir $CASS_LOG_DIR

    #unzip JRE and Cassandra
    unzip $HOME/downloads/$JRE_TARBALL $JRE_INSTALL_DIR
    unzip $HOME/downloads/$CASS_TARBALL $CASS_INSTALL_DIR

    #Change the ownership to the service credentials

    chown -R $SVC_USER:$GROUP $CASS_DATA_DIR
    chown -R $SVC_USER:$GROUP $CASS_LOG_DIR
    echo "edit /etc/profile to add JRE to the PATH"
    echo "installation is complete"


<span data-ttu-id="1c11d-335">Se si incolla questo script in una finestra di vim, rimuovere il ritorno a capo (‘\r”) con il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="1c11d-335">If you paste this script into vim window, make sure to remove the carriage return (‘\r”) using the following command:</span></span>

    tr -d '\r' <infile.sh >outfile.sh

#### <a name="step-3-edit-etcprofile"></a><span data-ttu-id="1c11d-336">Passaggio 3: Modificare etc/profile</span><span class="sxs-lookup"><span data-stu-id="1c11d-336">Step 3: Edit etc/profile</span></span>
<span data-ttu-id="1c11d-337">Aggiungere il codice seguente alla fine:</span><span class="sxs-lookup"><span data-stu-id="1c11d-337">Append the following at the end:</span></span>

    JAVA_HOME=/opt/java/jdk1.8.0_05
    CASS_HOME= /opt/cassandra/apache-cassandra-2.0.8
    PATH=$PATH:$HOME/bin:$JAVA_HOME/bin:$CASS_HOME/bin
    export JAVA_HOME
    export CASS_HOME
    export PATH

#### <a name="step-4-install-jna-for-production-systems"></a><span data-ttu-id="1c11d-338">Passaggio 4: Installare JNA per i sistemi di produzione</span><span class="sxs-lookup"><span data-stu-id="1c11d-338">Step 4: Install JNA for production systems</span></span>
<span data-ttu-id="1c11d-339">Utilizzare la sequenza di comandi seguente: il comando seguente installerà jna-3.2.7.jar e jna-platform 3.2.7.jar nella directory /usr/share.java sudo apt-get install libjna-java</span><span class="sxs-lookup"><span data-stu-id="1c11d-339">Use the following command sequence: The following command will install jna-3.2.7.jar and jna-platform-3.2.7.jar to /usr/share.java directory sudo apt-get install libjna-java</span></span>

<span data-ttu-id="1c11d-340">Creare collegamenti simbolici nella directory $CASS_HOME/lib in modo che lo script di avvio di Cassandra possa trovare questi file jar:</span><span class="sxs-lookup"><span data-stu-id="1c11d-340">Create symbolic links in $CASS_HOME/lib directory so that Cassandra startup script can find these jars:</span></span>

    ln -s /usr/share/java/jna-3.2.7.jar $CASS_HOME/lib/jna.jar

    ln -s /usr/share/java/jna-platform-3.2.7.jar $CASS_HOME/lib/jna-platform.jar

#### <a name="step-5-configure-cassandrayaml"></a><span data-ttu-id="1c11d-341">Passaggio 5: Configurare cassandra.yaml</span><span class="sxs-lookup"><span data-stu-id="1c11d-341">Step 5: Configure cassandra.yaml</span></span>
<span data-ttu-id="1c11d-342">Modificare cassandra.yaml su ciascuna macchina virtuale in modo da rispecchiare la configurazione necessaria per tutte le macchine virtuali [questo passaggio verrà perfezionato durante il provisioning vero e proprio]:</span><span class="sxs-lookup"><span data-stu-id="1c11d-342">Edit cassandra.yaml on each VM to reflect configuration needed by all the virtual machines [we will tweak this during the actual provisioning]:</span></span>

<table>
<tr><th><span data-ttu-id="1c11d-343">Nome campo</span><span class="sxs-lookup"><span data-stu-id="1c11d-343">Field Name</span></span>   </th><th> <span data-ttu-id="1c11d-344">Valore</span><span class="sxs-lookup"><span data-stu-id="1c11d-344">Value</span></span>  </th><th>    <span data-ttu-id="1c11d-345">Osservazioni</span><span class="sxs-lookup"><span data-stu-id="1c11d-345">Remarks</span></span> </th></tr>
<tr><td><span data-ttu-id="1c11d-346">cluster_name</span><span class="sxs-lookup"><span data-stu-id="1c11d-346">cluster_name</span></span> </td><td>    <span data-ttu-id="1c11d-347">"CustomerService"</span><span class="sxs-lookup"><span data-stu-id="1c11d-347">“CustomerService”</span></span>    </td><td> <span data-ttu-id="1c11d-348">Usare il nome che rispecchia la distribuzione</span><span class="sxs-lookup"><span data-stu-id="1c11d-348">Use the name that reflects your deployment</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-349">listen_address</span><span class="sxs-lookup"><span data-stu-id="1c11d-349">listen_address</span></span>    </td><td><span data-ttu-id="1c11d-350">[lasciare vuoto]</span><span class="sxs-lookup"><span data-stu-id="1c11d-350">[leave it blank]</span></span>    </td><td> <span data-ttu-id="1c11d-351">Eliminare "localhost"</span><span class="sxs-lookup"><span data-stu-id="1c11d-351">Delete “localhost”</span></span> </td></tr>
<tr><td><span data-ttu-id="1c11d-352">rpc_addres</span><span class="sxs-lookup"><span data-stu-id="1c11d-352">rpc_addres</span></span>   </td><td><span data-ttu-id="1c11d-353">[lasciare vuoto]</span><span class="sxs-lookup"><span data-stu-id="1c11d-353">[leave it blank]</span></span>    </td><td> <span data-ttu-id="1c11d-354">Eliminare "localhost"</span><span class="sxs-lookup"><span data-stu-id="1c11d-354">Delete “localhost”</span></span> </td></tr>
<tr><td><span data-ttu-id="1c11d-355">seeds</span><span class="sxs-lookup"><span data-stu-id="1c11d-355">seeds</span></span>    </td><td><span data-ttu-id="1c11d-356">"10.1.2.4, 10.1.2.6, 10.1.2.8"</span><span class="sxs-lookup"><span data-stu-id="1c11d-356">"10.1.2.4, 10.1.2.6, 10.1.2.8"</span></span>    </td><td><span data-ttu-id="1c11d-357">Elenco di tutti gli indirizzi IP designati come valori di inizializzazione.</span><span class="sxs-lookup"><span data-stu-id="1c11d-357">List of  all the IP addresses which are designated as seeds.</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-358">endpoint_snitch</span><span class="sxs-lookup"><span data-stu-id="1c11d-358">endpoint_snitch</span></span> </td><td> <span data-ttu-id="1c11d-359">org.apache.cassandra.locator.GossipingPropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="1c11d-359">org.apache.cassandra.locator.GossipingPropertyFileSnitch</span></span> </td><td> <span data-ttu-id="1c11d-360">Viene usato da NetworkTopologyStrateg per derivare il data center e il rack della macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="1c11d-360">This is used by the NetworkTopologyStrateg for inferring the data center and the rack of the VM</span></span></td></tr>
</table>

#### <a name="step-6-capture-the-vm-image"></a><span data-ttu-id="1c11d-361">Passaggio 6: Acquisire l'immagine della macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="1c11d-361">Step 6: Capture the VM image</span></span>
<span data-ttu-id="1c11d-362">Accedere alla macchina virtuale con il nome host (hk-cas-template.cloudapp.net) e la chiave privata SSH creata in precedenza.</span><span class="sxs-lookup"><span data-stu-id="1c11d-362">Log into the virtual machine using the hostname (hk-cas-template.cloudapp.net) and the SSH private key previously created.</span></span> <span data-ttu-id="1c11d-363">Per informazioni dettagliate su come accedere con il comando SSH o putty.exe, vedere Come usare SSH con Linux in Azure.</span><span class="sxs-lookup"><span data-stu-id="1c11d-363">See How to Use SSH with Linux on Azure for details on how to log in using the command ssh or putty.exe.</span></span>

<span data-ttu-id="1c11d-364">Per acquisire l'immagine, eseguire la sequenza di azioni seguente:</span><span class="sxs-lookup"><span data-stu-id="1c11d-364">Execute the following sequence of actions to capture the image:</span></span>

##### <a name="1-deprovision"></a><span data-ttu-id="1c11d-365">1. Effettuare il deprovisioning</span><span class="sxs-lookup"><span data-stu-id="1c11d-365">1. Deprovision</span></span>
<span data-ttu-id="1c11d-366">Usare il comando "sudo waagent –deprovision+user" per rimuovere le informazioni specifiche dell'istanza della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="1c11d-366">Use the command “sudo waagent –deprovision+user” to remove Virtual Machine instance specific information.</span></span> <span data-ttu-id="1c11d-367">Per altri dettagli sul processo di acquisizione di un'immagine, vedere [Come acquisire una macchina virtuale Linux da usare come modello](capture-image.md) .</span><span class="sxs-lookup"><span data-stu-id="1c11d-367">See for [How to Capture a Linux Virtual Machine](capture-image.md) to Use as a Template more details on the image capture process.</span></span>

##### <a name="2-shutdown-the-vm"></a><span data-ttu-id="1c11d-368">2: Arrestare la macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="1c11d-368">2: Shutdown the VM</span></span>
<span data-ttu-id="1c11d-369">Assicurarsi che la macchina virtuale sia evidenziata e fare clic sul collegamento ARRESTA nella barra dei comandi in basso.</span><span class="sxs-lookup"><span data-stu-id="1c11d-369">Make sure that the virtual machine is highlighted and click the SHUTDOWN link from the bottom command bar.</span></span>

##### <a name="3-capture-the-image"></a><span data-ttu-id="1c11d-370">3: Acquisire l'immagine</span><span class="sxs-lookup"><span data-stu-id="1c11d-370">3: Capture the image</span></span>
<span data-ttu-id="1c11d-371">Assicurarsi che la macchina virtuale sia evidenziata e fare clic sul collegamento ACQUISISCI nella barra dei comandi in basso.</span><span class="sxs-lookup"><span data-stu-id="1c11d-371">Make sure that the virtual machine is highlighted and click the CAPTURE link from the bottom command bar.</span></span> <span data-ttu-id="1c11d-372">Nella schermata successiva assegnare un NOME IMMAGINE (ad esempio, hk-cas-2-08-ub-14-04-2014071) e una DESCRIZIONE IMMAGINE appropriata e fare clic sul segno di spunta per terminare il processo di ACQUISIZIONE.</span><span class="sxs-lookup"><span data-stu-id="1c11d-372">In the next screen, give an IMAGE NAME (e.g. hk-cas-2-08-ub-14-04-2014071), appropriate IMAGE DESCRIPTION, and click the “check” mark to finish the CAPTURE process.</span></span>

<span data-ttu-id="1c11d-373">Dopo alcuni secondi l'immagine dovrebbe essere disponibile nella sezione IMMAGINI PERSONALI della raccolta immagini.</span><span class="sxs-lookup"><span data-stu-id="1c11d-373">This will take a few seconds and the image should be available in MY IMAGES section of the image gallery.</span></span> <span data-ttu-id="1c11d-374">La macchina virtuale di origine verrà automaticamente eliminata una volta acquisita l'immagine.</span><span class="sxs-lookup"><span data-stu-id="1c11d-374">The source VM will be automatically deleted after the image is successfully captured.</span></span> 

## <a name="single-region-deployment-process"></a><span data-ttu-id="1c11d-375">Processo di distribuzione in un'area singola</span><span class="sxs-lookup"><span data-stu-id="1c11d-375">Single Region Deployment Process</span></span>
<span data-ttu-id="1c11d-376">**Passaggio 1: Creare la rete virtuale** Accedere al portale di Azure e creare una rete virtuale (versione classica) con gli attributi elencati nella tabella seguente.</span><span class="sxs-lookup"><span data-stu-id="1c11d-376">**Step 1: Create the Virtual Network** Log into the Azure portal and create a virtual network (classic) with the attributes shown in the following table.</span></span> <span data-ttu-id="1c11d-377">Per i singoli passaggi del processo, vedere [Creare una rete virtuale (versione classica) usando il portale di Azure](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md).</span><span class="sxs-lookup"><span data-stu-id="1c11d-377">See [Create a virtual network (classic) using the Azure portal](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) for detailed steps of the process.</span></span>      

<table>
<tr><th><span data-ttu-id="1c11d-378">Nome attributo macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="1c11d-378">VM Attribute Name</span></span></th><th><span data-ttu-id="1c11d-379">Valore</span><span class="sxs-lookup"><span data-stu-id="1c11d-379">Value</span></span></th><th><span data-ttu-id="1c11d-380">Osservazioni</span><span class="sxs-lookup"><span data-stu-id="1c11d-380">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="1c11d-381">Nome</span><span class="sxs-lookup"><span data-stu-id="1c11d-381">Name</span></span></td><td><span data-ttu-id="1c11d-382">vnet-cass-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-382">vnet-cass-west-us</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="1c11d-383">Region</span><span class="sxs-lookup"><span data-stu-id="1c11d-383">Region</span></span></td><td><span data-ttu-id="1c11d-384">Stati Uniti occidentali</span><span class="sxs-lookup"><span data-stu-id="1c11d-384">West US</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="1c11d-385">Server DNS</span><span class="sxs-lookup"><span data-stu-id="1c11d-385">DNS Servers</span></span></td><td><span data-ttu-id="1c11d-386">None</span><span class="sxs-lookup"><span data-stu-id="1c11d-386">None</span></span></td><td><span data-ttu-id="1c11d-387">Ignorare questo attributo perché non si userà un server DNS</span><span class="sxs-lookup"><span data-stu-id="1c11d-387">Ignore this as we are not using a DNS Server</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-388">Spazio di indirizzi</span><span class="sxs-lookup"><span data-stu-id="1c11d-388">Address Space</span></span></td><td><span data-ttu-id="1c11d-389">10.1.0.0/16</span><span class="sxs-lookup"><span data-stu-id="1c11d-389">10.1.0.0/16</span></span></td><td></td></tr>    
<tr><td><span data-ttu-id="1c11d-390">IP iniziale</span><span class="sxs-lookup"><span data-stu-id="1c11d-390">Starting IP</span></span></td><td><span data-ttu-id="1c11d-391">10.1.0.0</span><span class="sxs-lookup"><span data-stu-id="1c11d-391">10.1.0.0</span></span></td><td></td></tr>    
<tr><td><span data-ttu-id="1c11d-392">CIDR</span><span class="sxs-lookup"><span data-stu-id="1c11d-392">CIDR</span></span> </td><td><span data-ttu-id="1c11d-393">/16 (65531)</span><span class="sxs-lookup"><span data-stu-id="1c11d-393">/16 (65531)</span></span></td><td></td></tr>
</table>

<span data-ttu-id="1c11d-394">Aggiungere le subnet seguenti:</span><span class="sxs-lookup"><span data-stu-id="1c11d-394">Add the following subnets:</span></span>

<table>
<tr><th><span data-ttu-id="1c11d-395">Nome</span><span class="sxs-lookup"><span data-stu-id="1c11d-395">Name</span></span></th><th><span data-ttu-id="1c11d-396">IP iniziale</span><span class="sxs-lookup"><span data-stu-id="1c11d-396">Starting IP</span></span></th><th><span data-ttu-id="1c11d-397">CIDR</span><span class="sxs-lookup"><span data-stu-id="1c11d-397">CIDR</span></span></th><th><span data-ttu-id="1c11d-398">Osservazioni</span><span class="sxs-lookup"><span data-stu-id="1c11d-398">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="1c11d-399">Web</span><span class="sxs-lookup"><span data-stu-id="1c11d-399">web</span></span></td><td><span data-ttu-id="1c11d-400">10.1.1.0</span><span class="sxs-lookup"><span data-stu-id="1c11d-400">10.1.1.0</span></span></td><td><span data-ttu-id="1c11d-401">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="1c11d-401">/24 (251)</span></span></td><td><span data-ttu-id="1c11d-402">Subnet per la Web farm</span><span class="sxs-lookup"><span data-stu-id="1c11d-402">Subnet for the web farm</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-403">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-403">data</span></span></td><td><span data-ttu-id="1c11d-404">10.1.2.0</span><span class="sxs-lookup"><span data-stu-id="1c11d-404">10.1.2.0</span></span></td><td><span data-ttu-id="1c11d-405">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="1c11d-405">/24 (251)</span></span></td><td><span data-ttu-id="1c11d-406">Subnet per i nodi del database</span><span class="sxs-lookup"><span data-stu-id="1c11d-406">Subnet for the database nodes</span></span></td></tr>
</table>

<span data-ttu-id="1c11d-407">Le subnet dati e Web possono essere protette con i gruppi di sicurezza di rete che esulano dall'ambito di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="1c11d-407">Data and Web subnets can be protected through network security groups the coverage of which is out of scope for this article.</span></span>  

<span data-ttu-id="1c11d-408">**Passaggio 2: Provisioning di macchine virtuali** Utilizzando l’immagine creata in precedenza, verranno create le macchine virtuali seguenti nel server cloud “hk-c-svc-west” e saranno associate alle rispettive subnet, come mostrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="1c11d-408">**Step 2: Provision Virtual Machines** Using the image created previously, we will create the following virtual machines in the cloud server “hk-c-svc-west” and bind them to the respective subnets as shown below:</span></span>

<table>
<tr><th><span data-ttu-id="1c11d-409">Nome computer</span><span class="sxs-lookup"><span data-stu-id="1c11d-409">Machine Name</span></span>    </th><th><span data-ttu-id="1c11d-410">Subnet</span><span class="sxs-lookup"><span data-stu-id="1c11d-410">Subnet</span></span>    </th><th><span data-ttu-id="1c11d-411">Indirizzo IP</span><span class="sxs-lookup"><span data-stu-id="1c11d-411">IP Address</span></span>    </th><th><span data-ttu-id="1c11d-412">Set di disponibilità</span><span class="sxs-lookup"><span data-stu-id="1c11d-412">Availability set</span></span></th><th><span data-ttu-id="1c11d-413">DC/Rack</span><span class="sxs-lookup"><span data-stu-id="1c11d-413">DC/Rack</span></span></th><th><span data-ttu-id="1c11d-414">Valore di inizializzazione?</span><span class="sxs-lookup"><span data-stu-id="1c11d-414">Seed?</span></span></th></tr>
<tr><td><span data-ttu-id="1c11d-415">hk-c1-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-415">hk-c1-west-us</span></span>    </td><td><span data-ttu-id="1c11d-416">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-416">data</span></span>    </td><td><span data-ttu-id="1c11d-417">10.1.2.4</span><span class="sxs-lookup"><span data-stu-id="1c11d-417">10.1.2.4</span></span>    </td><td><span data-ttu-id="1c11d-418">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="1c11d-418">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="1c11d-419">dc =WESTUS rack =rack1</span><span class="sxs-lookup"><span data-stu-id="1c11d-419">dc =WESTUS rack =rack1</span></span> </td><td><span data-ttu-id="1c11d-420">Sì</span><span class="sxs-lookup"><span data-stu-id="1c11d-420">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-421">hk-c2-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-421">hk-c2-west-us</span></span>    </td><td><span data-ttu-id="1c11d-422">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-422">data</span></span>    </td><td><span data-ttu-id="1c11d-423">10.1.2.5</span><span class="sxs-lookup"><span data-stu-id="1c11d-423">10.1.2.5</span></span>    </td><td><span data-ttu-id="1c11d-424">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="1c11d-424">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="1c11d-425">dc =WESTUS rack =rack1</span><span class="sxs-lookup"><span data-stu-id="1c11d-425">dc =WESTUS rack =rack1</span></span>    </td><td><span data-ttu-id="1c11d-426">No</span><span class="sxs-lookup"><span data-stu-id="1c11d-426">No</span></span> </td></tr>
<tr><td><span data-ttu-id="1c11d-427">hk-c3-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-427">hk-c3-west-us</span></span>    </td><td><span data-ttu-id="1c11d-428">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-428">data</span></span>    </td><td><span data-ttu-id="1c11d-429">10.1.2.6</span><span class="sxs-lookup"><span data-stu-id="1c11d-429">10.1.2.6</span></span>    </td><td><span data-ttu-id="1c11d-430">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="1c11d-430">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="1c11d-431">dc =WESTUS rack =rack2</span><span class="sxs-lookup"><span data-stu-id="1c11d-431">dc =WESTUS rack =rack2</span></span>    </td><td><span data-ttu-id="1c11d-432">Sì</span><span class="sxs-lookup"><span data-stu-id="1c11d-432">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-433">hk-c4-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-433">hk-c4-west-us</span></span>    </td><td><span data-ttu-id="1c11d-434">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-434">data</span></span>    </td><td><span data-ttu-id="1c11d-435">10.1.2.7</span><span class="sxs-lookup"><span data-stu-id="1c11d-435">10.1.2.7</span></span>    </td><td><span data-ttu-id="1c11d-436">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="1c11d-436">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="1c11d-437">dc =WESTUS rack =rack2</span><span class="sxs-lookup"><span data-stu-id="1c11d-437">dc =WESTUS rack =rack2</span></span>    </td><td><span data-ttu-id="1c11d-438">No</span><span class="sxs-lookup"><span data-stu-id="1c11d-438">No</span></span> </td></tr>
<tr><td><span data-ttu-id="1c11d-439">hk-c5-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-439">hk-c5-west-us</span></span>    </td><td><span data-ttu-id="1c11d-440">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-440">data</span></span>    </td><td><span data-ttu-id="1c11d-441">10.1.2.8</span><span class="sxs-lookup"><span data-stu-id="1c11d-441">10.1.2.8</span></span>    </td><td><span data-ttu-id="1c11d-442">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="1c11d-442">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="1c11d-443">dc =WESTUS rack =rack3</span><span class="sxs-lookup"><span data-stu-id="1c11d-443">dc =WESTUS rack =rack3</span></span>    </td><td><span data-ttu-id="1c11d-444">Sì</span><span class="sxs-lookup"><span data-stu-id="1c11d-444">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-445">hk-c6-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-445">hk-c6-west-us</span></span>    </td><td><span data-ttu-id="1c11d-446">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-446">data</span></span>    </td><td><span data-ttu-id="1c11d-447">10.1.2.9</span><span class="sxs-lookup"><span data-stu-id="1c11d-447">10.1.2.9</span></span>    </td><td><span data-ttu-id="1c11d-448">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="1c11d-448">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="1c11d-449">dc =WESTUS rack =rack3</span><span class="sxs-lookup"><span data-stu-id="1c11d-449">dc =WESTUS rack =rack3</span></span>    </td><td><span data-ttu-id="1c11d-450">No</span><span class="sxs-lookup"><span data-stu-id="1c11d-450">No</span></span> </td></tr>
<tr><td><span data-ttu-id="1c11d-451">hk-c7-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-451">hk-c7-west-us</span></span>    </td><td><span data-ttu-id="1c11d-452">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-452">data</span></span>    </td><td><span data-ttu-id="1c11d-453">10.1.2.10</span><span class="sxs-lookup"><span data-stu-id="1c11d-453">10.1.2.10</span></span>    </td><td><span data-ttu-id="1c11d-454">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="1c11d-454">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="1c11d-455">dc =WESTUS rack =rack4</span><span class="sxs-lookup"><span data-stu-id="1c11d-455">dc =WESTUS rack =rack4</span></span>    </td><td><span data-ttu-id="1c11d-456">Sì</span><span class="sxs-lookup"><span data-stu-id="1c11d-456">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-457">hk-c8-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-457">hk-c8-west-us</span></span>    </td><td><span data-ttu-id="1c11d-458">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-458">data</span></span>    </td><td><span data-ttu-id="1c11d-459">10.1.2.11</span><span class="sxs-lookup"><span data-stu-id="1c11d-459">10.1.2.11</span></span>    </td><td><span data-ttu-id="1c11d-460">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="1c11d-460">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="1c11d-461">dc =WESTUS rack =rack4</span><span class="sxs-lookup"><span data-stu-id="1c11d-461">dc =WESTUS rack =rack4</span></span>    </td><td><span data-ttu-id="1c11d-462">No</span><span class="sxs-lookup"><span data-stu-id="1c11d-462">No</span></span> </td></tr>
<tr><td><span data-ttu-id="1c11d-463">hk-w1-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-463">hk-w1-west-us</span></span>    </td><td><span data-ttu-id="1c11d-464">Web</span><span class="sxs-lookup"><span data-stu-id="1c11d-464">web</span></span>    </td><td><span data-ttu-id="1c11d-465">10.1.1.4</span><span class="sxs-lookup"><span data-stu-id="1c11d-465">10.1.1.4</span></span>    </td><td><span data-ttu-id="1c11d-466">hk-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="1c11d-466">hk-w-aset-1</span></span>    </td><td>                       </td><td><span data-ttu-id="1c11d-467">N/D</span><span class="sxs-lookup"><span data-stu-id="1c11d-467">N/A</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-468">hk-w2-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-468">hk-w2-west-us</span></span>    </td><td><span data-ttu-id="1c11d-469">Web</span><span class="sxs-lookup"><span data-stu-id="1c11d-469">web</span></span>    </td><td><span data-ttu-id="1c11d-470">10.1.1.5</span><span class="sxs-lookup"><span data-stu-id="1c11d-470">10.1.1.5</span></span>    </td><td><span data-ttu-id="1c11d-471">hk-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="1c11d-471">hk-w-aset-1</span></span>    </td><td>                       </td><td><span data-ttu-id="1c11d-472">N/D</span><span class="sxs-lookup"><span data-stu-id="1c11d-472">N/A</span></span></td></tr>
</table>

<span data-ttu-id="1c11d-473">Per creare l'elenco precedente di macchine virtuali, è necessario eseguire il processo seguente:</span><span class="sxs-lookup"><span data-stu-id="1c11d-473">Creation of the above list of VMs requires the following process:</span></span>

1. <span data-ttu-id="1c11d-474">Creare un servizio cloud vuoto in una determinata area</span><span class="sxs-lookup"><span data-stu-id="1c11d-474">Create an empty cloud service in a particular region</span></span>
2. <span data-ttu-id="1c11d-475">Creare una macchina virtuale dall'immagine acquisita in precedenza e collegarla alla rete virtuale creata in precedenza e ripetere questo passaggio per tutte le macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="1c11d-475">Create a VM from the previously captured image and attach it to the virtual network created previously; repeat this for all the VMs</span></span>
3. <span data-ttu-id="1c11d-476">Aggiungere al servizio cloud un dispositivo di bilanciamento del carico interno e collegarlo alla subnet "dati"</span><span class="sxs-lookup"><span data-stu-id="1c11d-476">Add an internal load balancer to the cloud service and attach it to the “data” subnet</span></span>
4. <span data-ttu-id="1c11d-477">Per ogni macchina virtuale creata in precedenza, aggiungere un endpoint con carico bilanciato per il traffico Thrift con un set con carico bilanciato connesso al dispositivo di bilanciamento del carico creato in precedenza</span><span class="sxs-lookup"><span data-stu-id="1c11d-477">For each VM created previously, add a load balanced endpoint for thrift traffic through a load balanced set connected to the previously created internal load balancer</span></span>

<span data-ttu-id="1c11d-478">Il processo precedente può essere eseguito dal portale di Azure classico. Usare un computer Windows (ricorrere a una macchina virtuale in Azure se non si ha accesso a un computer Windows) e applicare il seguente script PowerShell per il provisioning automatico di tutte le 8 macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="1c11d-478">The above process can be executed using Azure classic portal; use a Windows machine (use a VM on Azure if you don't have access to a Windows machine), use the following PowerShell script to provision all 8 VMs automatically.</span></span>

<span data-ttu-id="1c11d-479">**Elenco 1: script di PowerShell per il provisioning delle macchine virtuali**</span><span class="sxs-lookup"><span data-stu-id="1c11d-479">**List 1: PowerShell script for provisioning virtual machines**</span></span>

        #Tested with Azure Powershell - November 2014
        #This powershell script deployes a number of VMs from an existing image inside an Azure region
        #Import your Azure subscription into the current Powershell session before proceeding
        #The process: 1. create Azure Storage account, 2. create virtual network, 3.create the VM template, 2. crate a list of VMs from the template

        #fundamental variables - change these to reflect your subscription
        $country="us"; $region="west"; $vnetName = "your_vnet_name";$storageAccount="your_storage_account"
        $numVMs=8;$prefix = "hk-cass";$ilbIP="your_ilb_ip"
        $subscriptionName = "Azure_subscription_name";
        $vmSize="ExtraSmall"; $imageName="your_linux_image_name"
        $ilbName="ThriftInternalLB"; $thriftEndPoint="ThriftEndPoint"

        #generated variables
        $serviceName = "$prefix-svc-$region-$country"; $azureRegion = "$region $country"

        $vmNames = @()
        for ($i=0; $i -lt $numVMs; $i++)
        {
           $vmNames+=("$prefix-vm"+($i+1) + "-$region-$country" );
        }

        #select an Azure subscription already imported into Powershell session
        Select-AzureSubscription -SubscriptionName $subscriptionName -Current
        Set-AzureSubscription -SubscriptionName $subscriptionName -CurrentStorageAccountName $storageAccount

        #create an empty cloud service
        New-AzureService -ServiceName $serviceName -Label "hkcass$region" -Location $azureRegion
        Write-Host "Created $serviceName"

        $VMList= @()   # stores the list of azure vm configuration objects
        #create the list of VMs
        foreach($vmName in $vmNames)
        {
           $VMList += New-AzureVMConfig -Name $vmName -InstanceSize ExtraSmall -ImageName $imageName |
           Add-AzureProvisioningConfig -Linux -LinuxUser "localadmin" -Password "Local123" |
           Set-AzureSubnet "data"
        }

        New-AzureVM -ServiceName $serviceName -VNetName $vnetName -VMs $VMList

        #Create internal load balancer
        Add-AzureInternalLoadBalancer -ServiceName $serviceName -InternalLoadBalancerName $ilbName -SubnetName "data" -StaticVNetIPAddress "$ilbIP"
        Write-Host "Created $ilbName"
        #Add add the thrift endpoint to the internal load balancer for all the VMs
        foreach($vmName in $vmNames)
        {
            Get-AzureVM -ServiceName $serviceName -Name $vmName |
                Add-AzureEndpoint -Name $thriftEndPoint -LBSetName "ThriftLBSet" -Protocol tcp -LocalPort 9160 -PublicPort 9160 -ProbePort 9160 -ProbeProtocol tcp -ProbeIntervalInSeconds 10 -InternalLoadBalancerName $ilbName |
                Update-AzureVM

            Write-Host "created $vmName"     
        }

<span data-ttu-id="1c11d-480">**Passaggio 3: Configurare Cassandra in ogni macchina virtuale**</span><span class="sxs-lookup"><span data-stu-id="1c11d-480">**Step 3: Configure Cassandra on each VM**</span></span>

<span data-ttu-id="1c11d-481">Accedere alla macchina virtuale ed eseguire la procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="1c11d-481">Log into the VM and perform the following:</span></span>

* <span data-ttu-id="1c11d-482">Modificare $CASS_HOME/conf/cassandra-rackdc.properties per specificare le proprietà del data center e del rack:</span><span class="sxs-lookup"><span data-stu-id="1c11d-482">Edit $CASS_HOME/conf/cassandra-rackdc.properties to specify the data center and rack properties:</span></span>
  
       dc =EASTUS, rack =rack1
* <span data-ttu-id="1c11d-483">Modificare cassandra.yaml per configurare i nodi dei valori di inizializzazione come segue:</span><span class="sxs-lookup"><span data-stu-id="1c11d-483">Edit cassandra.yaml to configure seed nodes as below:</span></span>
  
       Seeds: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10"

<span data-ttu-id="1c11d-484">**Passaggio 4: Avviare le macchine virtuali e testare il cluster**</span><span class="sxs-lookup"><span data-stu-id="1c11d-484">**Step 4: Start the VMs and test the cluster**</span></span>

<span data-ttu-id="1c11d-485">Accedere a uno dei nodi (ad esempio, hk-c1-west-us) ed eseguire il comando seguente per visualizzare lo stato del cluster:</span><span class="sxs-lookup"><span data-stu-id="1c11d-485">Log into one of the nodes (e.g. hk-c1-west-us) and run the following command to see the status of the cluster:</span></span>

       nodetool –h 10.1.2.4 –p 7199 status

<span data-ttu-id="1c11d-486">Per un cluster a 8 nodi i dati visualizzati saranno simili ai seguenti:</span><span class="sxs-lookup"><span data-stu-id="1c11d-486">You should see the display similar to the one below for an 8-node cluster:</span></span>

<table>
<tr><th><span data-ttu-id="1c11d-487">Stato</span><span class="sxs-lookup"><span data-stu-id="1c11d-487">Status</span></span></th><th><span data-ttu-id="1c11d-488">Indirizzo</span><span class="sxs-lookup"><span data-stu-id="1c11d-488">Address</span></span>    </th><th><span data-ttu-id="1c11d-489">chiudi</span><span class="sxs-lookup"><span data-stu-id="1c11d-489">Load</span></span>    </th><th><span data-ttu-id="1c11d-490">Tokens</span><span class="sxs-lookup"><span data-stu-id="1c11d-490">Tokens</span></span>    </th><th><span data-ttu-id="1c11d-491">Owns</span><span class="sxs-lookup"><span data-stu-id="1c11d-491">Owns</span></span> </th><th><span data-ttu-id="1c11d-492">Host ID</span><span class="sxs-lookup"><span data-stu-id="1c11d-492">Host ID</span></span>    </th><th><span data-ttu-id="1c11d-493">Rack</span><span class="sxs-lookup"><span data-stu-id="1c11d-493">Rack</span></span></th></tr>
<tr><th><span data-ttu-id="1c11d-494">UN</span><span class="sxs-lookup"><span data-stu-id="1c11d-494">UN</span></span>    </td><td><span data-ttu-id="1c11d-495">10.1.2.4</span><span class="sxs-lookup"><span data-stu-id="1c11d-495">10.1.2.4</span></span>     </td><td><span data-ttu-id="1c11d-496">87,81 KB</span><span class="sxs-lookup"><span data-stu-id="1c11d-496">87.81 KB</span></span>    </td><td><span data-ttu-id="1c11d-497">256</span><span class="sxs-lookup"><span data-stu-id="1c11d-497">256</span></span>    </td><td><span data-ttu-id="1c11d-498">38,0%</span><span class="sxs-lookup"><span data-stu-id="1c11d-498">38.0%</span></span>    </td><td><span data-ttu-id="1c11d-499">Guid (removed)</span><span class="sxs-lookup"><span data-stu-id="1c11d-499">Guid (removed)</span></span></td><td><span data-ttu-id="1c11d-500">rack1</span><span class="sxs-lookup"><span data-stu-id="1c11d-500">rack1</span></span></td></tr>
<tr><th><span data-ttu-id="1c11d-501">UN</span><span class="sxs-lookup"><span data-stu-id="1c11d-501">UN</span></span>    </td><td><span data-ttu-id="1c11d-502">10.1.2.5</span><span class="sxs-lookup"><span data-stu-id="1c11d-502">10.1.2.5</span></span>     </td><td><span data-ttu-id="1c11d-503">41,08 KB</span><span class="sxs-lookup"><span data-stu-id="1c11d-503">41.08 KB</span></span>    </td><td><span data-ttu-id="1c11d-504">256</span><span class="sxs-lookup"><span data-stu-id="1c11d-504">256</span></span>    </td><td><span data-ttu-id="1c11d-505">68,9% </span><span class="sxs-lookup"><span data-stu-id="1c11d-505">68.9%</span></span>    </td><td><span data-ttu-id="1c11d-506">Guid (removed)</span><span class="sxs-lookup"><span data-stu-id="1c11d-506">Guid (removed)</span></span></td><td><span data-ttu-id="1c11d-507">rack1</span><span class="sxs-lookup"><span data-stu-id="1c11d-507">rack1</span></span></td></tr>
<tr><th><span data-ttu-id="1c11d-508">UN</span><span class="sxs-lookup"><span data-stu-id="1c11d-508">UN</span></span>    </td><td><span data-ttu-id="1c11d-509">10.1.2.6</span><span class="sxs-lookup"><span data-stu-id="1c11d-509">10.1.2.6</span></span>     </td><td><span data-ttu-id="1c11d-510">55,29 KB</span><span class="sxs-lookup"><span data-stu-id="1c11d-510">55.29 KB</span></span>    </td><td><span data-ttu-id="1c11d-511">256</span><span class="sxs-lookup"><span data-stu-id="1c11d-511">256</span></span>    </td><td><span data-ttu-id="1c11d-512">68,8%</span><span class="sxs-lookup"><span data-stu-id="1c11d-512">68.8%</span></span>    </td><td><span data-ttu-id="1c11d-513">Guid (removed)</span><span class="sxs-lookup"><span data-stu-id="1c11d-513">Guid (removed)</span></span></td><td><span data-ttu-id="1c11d-514">rack2</span><span class="sxs-lookup"><span data-stu-id="1c11d-514">rack2</span></span></td></tr>
<tr><th><span data-ttu-id="1c11d-515">UN</span><span class="sxs-lookup"><span data-stu-id="1c11d-515">UN</span></span>    </td><td><span data-ttu-id="1c11d-516">10.1.2.7</span><span class="sxs-lookup"><span data-stu-id="1c11d-516">10.1.2.7</span></span>     </td><td><span data-ttu-id="1c11d-517">55,29 KB</span><span class="sxs-lookup"><span data-stu-id="1c11d-517">55.29 KB</span></span>    </td><td><span data-ttu-id="1c11d-518">256</span><span class="sxs-lookup"><span data-stu-id="1c11d-518">256</span></span>    </td><td><span data-ttu-id="1c11d-519">68,8%</span><span class="sxs-lookup"><span data-stu-id="1c11d-519">68.8%</span></span>    </td><td><span data-ttu-id="1c11d-520">Guid (removed)</span><span class="sxs-lookup"><span data-stu-id="1c11d-520">Guid (removed)</span></span></td><td><span data-ttu-id="1c11d-521">rack2</span><span class="sxs-lookup"><span data-stu-id="1c11d-521">rack2</span></span></td></tr>
<tr><th><span data-ttu-id="1c11d-522">UN</span><span class="sxs-lookup"><span data-stu-id="1c11d-522">UN</span></span>    </td><td><span data-ttu-id="1c11d-523">10.1.2.8</span><span class="sxs-lookup"><span data-stu-id="1c11d-523">10.1.2.8</span></span>     </td><td><span data-ttu-id="1c11d-524">55,29 KB</span><span class="sxs-lookup"><span data-stu-id="1c11d-524">55.29 KB</span></span>    </td><td><span data-ttu-id="1c11d-525">256</span><span class="sxs-lookup"><span data-stu-id="1c11d-525">256</span></span>    </td><td><span data-ttu-id="1c11d-526">68,8%</span><span class="sxs-lookup"><span data-stu-id="1c11d-526">68.8%</span></span>    </td><td><span data-ttu-id="1c11d-527">Guid (removed)</span><span class="sxs-lookup"><span data-stu-id="1c11d-527">Guid (removed)</span></span></td><td><span data-ttu-id="1c11d-528">rack3</span><span class="sxs-lookup"><span data-stu-id="1c11d-528">rack3</span></span></td></tr>
<tr><th><span data-ttu-id="1c11d-529">UN</span><span class="sxs-lookup"><span data-stu-id="1c11d-529">UN</span></span>    </td><td><span data-ttu-id="1c11d-530">10.1.2.9</span><span class="sxs-lookup"><span data-stu-id="1c11d-530">10.1.2.9</span></span>     </td><td><span data-ttu-id="1c11d-531">55,29 KB</span><span class="sxs-lookup"><span data-stu-id="1c11d-531">55.29 KB</span></span>    </td><td><span data-ttu-id="1c11d-532">256</span><span class="sxs-lookup"><span data-stu-id="1c11d-532">256</span></span>    </td><td><span data-ttu-id="1c11d-533">68,8%</span><span class="sxs-lookup"><span data-stu-id="1c11d-533">68.8%</span></span>    </td><td><span data-ttu-id="1c11d-534">Guid (removed)</span><span class="sxs-lookup"><span data-stu-id="1c11d-534">Guid (removed)</span></span></td><td><span data-ttu-id="1c11d-535">rack3</span><span class="sxs-lookup"><span data-stu-id="1c11d-535">rack3</span></span></td></tr>
<tr><th><span data-ttu-id="1c11d-536">UN</span><span class="sxs-lookup"><span data-stu-id="1c11d-536">UN</span></span>    </td><td><span data-ttu-id="1c11d-537">10.1.2.10</span><span class="sxs-lookup"><span data-stu-id="1c11d-537">10.1.2.10</span></span>     </td><td><span data-ttu-id="1c11d-538">55,29 KB</span><span class="sxs-lookup"><span data-stu-id="1c11d-538">55.29 KB</span></span>    </td><td><span data-ttu-id="1c11d-539">256</span><span class="sxs-lookup"><span data-stu-id="1c11d-539">256</span></span>    </td><td><span data-ttu-id="1c11d-540">68,8%</span><span class="sxs-lookup"><span data-stu-id="1c11d-540">68.8%</span></span>    </td><td><span data-ttu-id="1c11d-541">Guid (removed)</span><span class="sxs-lookup"><span data-stu-id="1c11d-541">Guid (removed)</span></span></td><td><span data-ttu-id="1c11d-542">rack4</span><span class="sxs-lookup"><span data-stu-id="1c11d-542">rack4</span></span></td></tr>
<tr><th><span data-ttu-id="1c11d-543">UN</span><span class="sxs-lookup"><span data-stu-id="1c11d-543">UN</span></span>    </td><td><span data-ttu-id="1c11d-544">10.1.2.11</span><span class="sxs-lookup"><span data-stu-id="1c11d-544">10.1.2.11</span></span>     </td><td><span data-ttu-id="1c11d-545">55,29 KB</span><span class="sxs-lookup"><span data-stu-id="1c11d-545">55.29 KB</span></span>    </td><td><span data-ttu-id="1c11d-546">256</span><span class="sxs-lookup"><span data-stu-id="1c11d-546">256</span></span>    </td><td><span data-ttu-id="1c11d-547">68,8%</span><span class="sxs-lookup"><span data-stu-id="1c11d-547">68.8%</span></span>    </td><td><span data-ttu-id="1c11d-548">Guid (removed)</span><span class="sxs-lookup"><span data-stu-id="1c11d-548">Guid (removed)</span></span></td><td><span data-ttu-id="1c11d-549">rack4</span><span class="sxs-lookup"><span data-stu-id="1c11d-549">rack4</span></span></td></tr>
</table>

## <a name="test-the-single-region-cluster"></a><span data-ttu-id="1c11d-550">Testare il cluster in un'area singola</span><span class="sxs-lookup"><span data-stu-id="1c11d-550">Test the Single Region Cluster</span></span>
<span data-ttu-id="1c11d-551">Usare i passaggi seguenti per testare il cluster:</span><span class="sxs-lookup"><span data-stu-id="1c11d-551">Use the following steps to test the cluster:</span></span>

1. <span data-ttu-id="1c11d-552">Con il commandlet Get-AzureInternalLoadbalancer dei comandi Powershell, ottenere l'indirizzo IP del dispositivo di bilanciamento del carico interno, ad esempio 10.1.2.101.</span><span class="sxs-lookup"><span data-stu-id="1c11d-552">Using the Powershell command Get-AzureInternalLoadbalancer commandlet, obtain the IP address of the internal load balancer (e.g.  10.1.2.101).</span></span> <span data-ttu-id="1c11d-553">La sintassi del comando viene mostrata di seguito: Get-AzureLoadbalancer –ServiceName "hk-c-svc-west-us" [vengono visualizzati i dettagli del servizio di bilanciamento del carico interno con l'indirizzo IP]</span><span class="sxs-lookup"><span data-stu-id="1c11d-553">The syntax of the command is shown below: Get-AzureLoadbalancer –ServiceName "hk-c-svc-west-us” [displays the details of the internal load balancer along with its IP address]</span></span>
2. <span data-ttu-id="1c11d-554">Accedere alla macchina virtuale della Web farm (ad esempio, hk-w1-west-us) con Putty o SSH</span><span class="sxs-lookup"><span data-stu-id="1c11d-554">Log into the web farm VM (e.g. hk-w1-west-us) using Putty or ssh</span></span>
3. <span data-ttu-id="1c11d-555">Eseguire $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="1c11d-555">Execute $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span></span>
4. <span data-ttu-id="1c11d-556">Usare i seguenti comandi CQL per verificare se il cluster è in funzione:</span><span class="sxs-lookup"><span data-stu-id="1c11d-556">Use the following CQL commands to verify if the cluster is working:</span></span>
   
     <span data-ttu-id="1c11d-557">CREATE KEYSPACE customers_ks WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 3 };   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');</span><span class="sxs-lookup"><span data-stu-id="1c11d-557">CREATE KEYSPACE customers_ks WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 3 };   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');</span></span>
   
     <span data-ttu-id="1c11d-558">SELECT * FROM Customers;</span><span class="sxs-lookup"><span data-stu-id="1c11d-558">SELECT * FROM Customers;</span></span>

<span data-ttu-id="1c11d-559">I dati visualizzati saranno simili ai seguenti:</span><span class="sxs-lookup"><span data-stu-id="1c11d-559">You should see a display like the one below:</span></span>

<table>
  <tr><th> <span data-ttu-id="1c11d-560">customer_id</span><span class="sxs-lookup"><span data-stu-id="1c11d-560">customer_id</span></span> </th><th> <span data-ttu-id="1c11d-561">firstname</span><span class="sxs-lookup"><span data-stu-id="1c11d-561">firstname</span></span> </th><th> <span data-ttu-id="1c11d-562">Lastname</span><span class="sxs-lookup"><span data-stu-id="1c11d-562">lastname</span></span> </th></tr>
  <tr><td> <span data-ttu-id="1c11d-563">1</span><span class="sxs-lookup"><span data-stu-id="1c11d-563">1</span></span> </td><td> <span data-ttu-id="1c11d-564">John</span><span class="sxs-lookup"><span data-stu-id="1c11d-564">John</span></span> </td><td> <span data-ttu-id="1c11d-565">Doe</span><span class="sxs-lookup"><span data-stu-id="1c11d-565">Doe</span></span> </td></tr>
  <tr><td> <span data-ttu-id="1c11d-566">2</span><span class="sxs-lookup"><span data-stu-id="1c11d-566">2</span></span> </td><td> <span data-ttu-id="1c11d-567">Jane</span><span class="sxs-lookup"><span data-stu-id="1c11d-567">Jane</span></span> </td><td> <span data-ttu-id="1c11d-568">Doe</span><span class="sxs-lookup"><span data-stu-id="1c11d-568">Doe</span></span> </td></tr>
</table>

<span data-ttu-id="1c11d-569">Si noti che il keyspace creato nel passaggio 4 usa SimpleStrategy con replication_factor pari a 3.</span><span class="sxs-lookup"><span data-stu-id="1c11d-569">Please note that the keyspace created in step 4 uses SimpleStrategy with a  replication_factor of 3.</span></span> <span data-ttu-id="1c11d-570">SimpleStrategy è consigliato per le distribuzioni in un data center singolo, NetworkTopologyStrategy invece per le distribuzioni in più data center.</span><span class="sxs-lookup"><span data-stu-id="1c11d-570">SimpleStrategy is recommended for single data center deployments whereas NetworkTopologyStrategy for multi-data center deployments.</span></span> <span data-ttu-id="1c11d-571">Un replication_factor pari a 3 garantirà la tolleranza per gli errori dei nodi.</span><span class="sxs-lookup"><span data-stu-id="1c11d-571">A replication_factor of 3 will give tolerance for node failures.</span></span>

## <span data-ttu-id="1c11d-572"><a id="tworegion"> </a>Processo di distribuzione in più aree</span><span class="sxs-lookup"><span data-stu-id="1c11d-572"><a id="tworegion"> </a>Multi-Region Deployment Process</span></span>
<span data-ttu-id="1c11d-573">Verrà sfruttata la distribuzione in un'area singola completata e si ripeterà lo stesso processo per l'installazione della seconda area.</span><span class="sxs-lookup"><span data-stu-id="1c11d-573">Will leverage the single region deployment completed and repeat the same process for installing the second region.</span></span> <span data-ttu-id="1c11d-574">La differenza principale tra la distribuzione in un'area singola e in più aree è la configurazione del tunnel VPN per la comunicazione tra le aree. Si inizierà con l'installazione di rete, il provisioning delle macchine virtuali e la configurazione di Cassandra.</span><span class="sxs-lookup"><span data-stu-id="1c11d-574">The key difference between the single and multiple region deployment is the VPN tunnel setup for inter-region communication; we will start with the network installation, provision the VMs and configure Cassandra.</span></span>

### <a name="step-1-create-the-virtual-network-at-the-2nd-region"></a><span data-ttu-id="1c11d-575">Passaggio 1: Creare la rete virtuale nella seconda area</span><span class="sxs-lookup"><span data-stu-id="1c11d-575">Step 1: Create the Virtual Network at the 2nd Region</span></span>
<span data-ttu-id="1c11d-576">Accedere al portale di Azure classico e creare una rete virtuale con gli attributi elencati nella tabella.</span><span class="sxs-lookup"><span data-stu-id="1c11d-576">Log into the Azure classic portal and create a Virtual Network with the attributes show in the table.</span></span> <span data-ttu-id="1c11d-577">Per i singoli passaggi del processo, vedere [Configurare una rete virtuale usando il portale di Azure classico](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) .</span><span class="sxs-lookup"><span data-stu-id="1c11d-577">See [Configure a Cloud-Only Virtual Network in the Azure classic portal](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) for detailed steps of the process.</span></span>      

<table>
<tr><th><span data-ttu-id="1c11d-578">Nome attributo</span><span class="sxs-lookup"><span data-stu-id="1c11d-578">Attribute Name</span></span>    </th><th><span data-ttu-id="1c11d-579">Valore</span><span class="sxs-lookup"><span data-stu-id="1c11d-579">Value</span></span>    </th><th><span data-ttu-id="1c11d-580">Osservazioni</span><span class="sxs-lookup"><span data-stu-id="1c11d-580">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="1c11d-581">Nome</span><span class="sxs-lookup"><span data-stu-id="1c11d-581">Name</span></span>    </td><td><span data-ttu-id="1c11d-582">vnet-cass-east-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-582">vnet-cass-east-us</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="1c11d-583">Region</span><span class="sxs-lookup"><span data-stu-id="1c11d-583">Region</span></span>    </td><td><span data-ttu-id="1c11d-584">Stati Uniti orientali</span><span class="sxs-lookup"><span data-stu-id="1c11d-584">East US</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="1c11d-585">Server DNS</span><span class="sxs-lookup"><span data-stu-id="1c11d-585">DNS Servers</span></span>        </td><td></td><td><span data-ttu-id="1c11d-586">Ignorare questo attributo perché non si userà un server DNS</span><span class="sxs-lookup"><span data-stu-id="1c11d-586">Ignore this as we are not using a DNS Server</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-587">Configura una VPN Point-to-Site</span><span class="sxs-lookup"><span data-stu-id="1c11d-587">Configure a point-to-site VPN</span></span></td><td></td><td>        <span data-ttu-id="1c11d-588">Ignorare questo attributo</span><span class="sxs-lookup"><span data-stu-id="1c11d-588">Ignore this</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-589">Configura una VPN Site-to-Site</span><span class="sxs-lookup"><span data-stu-id="1c11d-589">Configure a site-to-site VPN</span></span></td><td></td><td>        <span data-ttu-id="1c11d-590">Ignorare questo attributo</span><span class="sxs-lookup"><span data-stu-id="1c11d-590">Ignore this</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-591">Spazio di indirizzi</span><span class="sxs-lookup"><span data-stu-id="1c11d-591">Address Space</span></span>    </td><td><span data-ttu-id="1c11d-592">10.2.0.0/16</span><span class="sxs-lookup"><span data-stu-id="1c11d-592">10.2.0.0/16</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="1c11d-593">IP iniziale</span><span class="sxs-lookup"><span data-stu-id="1c11d-593">Starting IP</span></span>    </td><td><span data-ttu-id="1c11d-594">10.2.0.0</span><span class="sxs-lookup"><span data-stu-id="1c11d-594">10.2.0.0</span></span>    </td><td></td></tr>
<tr><td><span data-ttu-id="1c11d-595">CIDR</span><span class="sxs-lookup"><span data-stu-id="1c11d-595">CIDR</span></span>    </td><td><span data-ttu-id="1c11d-596">/16 (65531)</span><span class="sxs-lookup"><span data-stu-id="1c11d-596">/16 (65531)</span></span></td><td></td></tr>
</table>

<span data-ttu-id="1c11d-597">Aggiungere le subnet seguenti:</span><span class="sxs-lookup"><span data-stu-id="1c11d-597">Add the following subnets:</span></span>

<table>
<tr><th><span data-ttu-id="1c11d-598">Nome</span><span class="sxs-lookup"><span data-stu-id="1c11d-598">Name</span></span>    </th><th><span data-ttu-id="1c11d-599">IP iniziale</span><span class="sxs-lookup"><span data-stu-id="1c11d-599">Starting IP</span></span>    </th><th><span data-ttu-id="1c11d-600">CIDR</span><span class="sxs-lookup"><span data-stu-id="1c11d-600">CIDR</span></span>    </th><th><span data-ttu-id="1c11d-601">Osservazioni</span><span class="sxs-lookup"><span data-stu-id="1c11d-601">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="1c11d-602">Web</span><span class="sxs-lookup"><span data-stu-id="1c11d-602">web</span></span>    </td><td><span data-ttu-id="1c11d-603">10.2.1.0</span><span class="sxs-lookup"><span data-stu-id="1c11d-603">10.2.1.0</span></span>    </td><td><span data-ttu-id="1c11d-604">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="1c11d-604">/24 (251)</span></span>    </td><td><span data-ttu-id="1c11d-605">Subnet per la Web farm</span><span class="sxs-lookup"><span data-stu-id="1c11d-605">Subnet for the web farm</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-606">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-606">data</span></span>    </td><td><span data-ttu-id="1c11d-607">10.2.2.0</span><span class="sxs-lookup"><span data-stu-id="1c11d-607">10.2.2.0</span></span>    </td><td><span data-ttu-id="1c11d-608">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="1c11d-608">/24 (251)</span></span>    </td><td><span data-ttu-id="1c11d-609">Subnet per i nodi del database</span><span class="sxs-lookup"><span data-stu-id="1c11d-609">Subnet for the database nodes</span></span></td></tr>
</table>


### <a name="step-2-create-local-networks"></a><span data-ttu-id="1c11d-610">Passaggio 2: Creazione delle reti locali</span><span class="sxs-lookup"><span data-stu-id="1c11d-610">Step 2: Create Local Networks</span></span>
<span data-ttu-id="1c11d-611">Una rete locale nella rete virtuale di Azure è uno spazio di indirizzi proxy che esegue il mapping a un sito remoto, incluso un cloud privato o un'altra area di Azure.</span><span class="sxs-lookup"><span data-stu-id="1c11d-611">A Local Network in Azure virtual networking is a proxy address space that maps to a remote site including a private cloud or another Azure region.</span></span> <span data-ttu-id="1c11d-612">Questo spazio di indirizzi proxy è associato a un gateway remoto per il routing della rete alle destinazioni di rete appropriate.</span><span class="sxs-lookup"><span data-stu-id="1c11d-612">This proxy address space is bound to a remote gateway for routing network to the right networking destinations.</span></span> <span data-ttu-id="1c11d-613">Per le istruzioni per stabilire la connessione tra reti virtuali, vedere [Configurare una connessione tra reti virtuali](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) .</span><span class="sxs-lookup"><span data-stu-id="1c11d-613">See [Configure a VNet to VNet Connection](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) for the instructions on establishing VNET-to-VNET connection.</span></span>

<span data-ttu-id="1c11d-614">Creare due reti locali con i dettagli seguenti:</span><span class="sxs-lookup"><span data-stu-id="1c11d-614">Create two local networks per the following details:</span></span>

| <span data-ttu-id="1c11d-615">Nome rete</span><span class="sxs-lookup"><span data-stu-id="1c11d-615">Network Name</span></span> | <span data-ttu-id="1c11d-616">Indirizzo gateway VPN</span><span class="sxs-lookup"><span data-stu-id="1c11d-616">VPN Gateway Address</span></span> | <span data-ttu-id="1c11d-617">Spazio di indirizzi</span><span class="sxs-lookup"><span data-stu-id="1c11d-617">Address Space</span></span> | <span data-ttu-id="1c11d-618">Osservazioni</span><span class="sxs-lookup"><span data-stu-id="1c11d-618">Remarks</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="1c11d-619">hk-lnet-map-to-east-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-619">hk-lnet-map-to-east-us</span></span> |<span data-ttu-id="1c11d-620">23.1.1.1</span><span class="sxs-lookup"><span data-stu-id="1c11d-620">23.1.1.1</span></span> |<span data-ttu-id="1c11d-621">10.2.0.0/16</span><span class="sxs-lookup"><span data-stu-id="1c11d-621">10.2.0.0/16</span></span> |<span data-ttu-id="1c11d-622">Durante la creazione della rete locale assegnare un indirizzo gateway segnaposto.</span><span class="sxs-lookup"><span data-stu-id="1c11d-622">While creating the Local Network give a placeholder gateway address.</span></span> <span data-ttu-id="1c11d-623">Il vero indirizzo gateway verrà inserito una volta creato il gateway.</span><span class="sxs-lookup"><span data-stu-id="1c11d-623">The real gateway address is filled once the gateway is created.</span></span> <span data-ttu-id="1c11d-624">Verificare che lo spazio di indirizzi corrisponda esattamente alla rispettiva rete virtuale remota, in questo caso la rete virtuale creata nell'area Stati Uniti orientali.</span><span class="sxs-lookup"><span data-stu-id="1c11d-624">Make sure the address space exactly matches the respective remote VNET; in this case the VNET created in the East US region.</span></span> |
| <span data-ttu-id="1c11d-625">hk-lnet-map-to-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-625">hk-lnet-map-to-west-us</span></span> |<span data-ttu-id="1c11d-626">23.2.2.2</span><span class="sxs-lookup"><span data-stu-id="1c11d-626">23.2.2.2</span></span> |<span data-ttu-id="1c11d-627">10.1.0.0/16</span><span class="sxs-lookup"><span data-stu-id="1c11d-627">10.1.0.0/16</span></span> |<span data-ttu-id="1c11d-628">Durante la creazione della rete locale assegnare un indirizzo gateway segnaposto.</span><span class="sxs-lookup"><span data-stu-id="1c11d-628">While creating the Local Network give a placeholder gateway address.</span></span> <span data-ttu-id="1c11d-629">Il vero indirizzo gateway verrà inserito una volta creato il gateway.</span><span class="sxs-lookup"><span data-stu-id="1c11d-629">The real gateway address is filled once the gateway is created.</span></span> <span data-ttu-id="1c11d-630">Verificare che lo spazio di indirizzi corrisponda esattamente alla rispettiva rete virtuale remota, in questo caso la rete virtuale creata nell'area Stati Uniti occidentali.</span><span class="sxs-lookup"><span data-stu-id="1c11d-630">Make sure the address space exactly matches the respective remote VNET; in this case the VNET created in the West US region.</span></span> |

### <a name="step-3-map-local-network-to-the-respective-vnets"></a><span data-ttu-id="1c11d-631">Passaggio 3: Eseguire il mapping della rete "locale" alle rispettive reti virtuali</span><span class="sxs-lookup"><span data-stu-id="1c11d-631">Step 3: Map “Local” network to the respective VNETs</span></span>
<span data-ttu-id="1c11d-632">Nel portale di Azure classico, selezionare ogni rete virtuale, fare clic su "Configura", scegliere "Connetti alla rete locale" e selezionare le reti locali con i dettagli seguenti:</span><span class="sxs-lookup"><span data-stu-id="1c11d-632">From the Azure classic portal, select each vnet, click “Configure”, check “Connect to the local network”, and select the Local Networks per the following details:</span></span>

| <span data-ttu-id="1c11d-633">Rete virtuale</span><span class="sxs-lookup"><span data-stu-id="1c11d-633">Virtual Network</span></span> | <span data-ttu-id="1c11d-634">Rete locale</span><span class="sxs-lookup"><span data-stu-id="1c11d-634">Local Network</span></span> |
| --- | --- |
| <span data-ttu-id="1c11d-635">hk-vnet-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-635">hk-vnet-west-us</span></span> |<span data-ttu-id="1c11d-636">hk-lnet-map-to-east-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-636">hk-lnet-map-to-east-us</span></span> |
| <span data-ttu-id="1c11d-637">hk-vnet-east-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-637">hk-vnet-east-us</span></span> |<span data-ttu-id="1c11d-638">hk-lnet-map-to-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-638">hk-lnet-map-to-west-us</span></span> |

### <a name="step-4-create-gateways-on-vnet1-and-vnet2"></a><span data-ttu-id="1c11d-639">Passaggio 4: Creare i gateway nella rete virtuale 1 e nella rete virtuale 2</span><span class="sxs-lookup"><span data-stu-id="1c11d-639">Step 4: Create Gateways on VNET1 and VNET2</span></span>
<span data-ttu-id="1c11d-640">Nel dashboard di entrambe le reti virtuali fare clic su CREA GATEWAY per attivare il processo di provisioning dei gateway VPN.</span><span class="sxs-lookup"><span data-stu-id="1c11d-640">From the dashboard of both the virtual networks, click CREATE GATEWAY which will trigger the VPN gateway provisioning process.</span></span> <span data-ttu-id="1c11d-641">Dopo alcuni minuti nel dashboard di ogni rete virtuale verrà visualizzato l'effettivo indirizzo gateway.</span><span class="sxs-lookup"><span data-stu-id="1c11d-641">After a few minutes the dashboard of each virtual network should display the actual gateway address.</span></span>

### <a name="step-5-update-local-networks-with-the-respective-gateway-addresses"></a><span data-ttu-id="1c11d-642">Passaggio 5: Aggiornare le reti "locali" con i rispettivi indirizzi "gateway"</span><span class="sxs-lookup"><span data-stu-id="1c11d-642">Step 5: Update “Local” networks with the respective “Gateway” addresses</span></span>
<span data-ttu-id="1c11d-643">Modificare entrambe le reti locali per poter sostituire l'indirizzo IP gateway segnaposto con il vero indirizzo IP dei gateway di cui è appena stato effettuato il provisioning.</span><span class="sxs-lookup"><span data-stu-id="1c11d-643">Edit both the local networks to replace the placeholder gateway IP address with the real IP address of the just provisioned gateways.</span></span> <span data-ttu-id="1c11d-644">Usare il mapping seguente:</span><span class="sxs-lookup"><span data-stu-id="1c11d-644">Use the following mapping:</span></span>

<table>
<tr><th><span data-ttu-id="1c11d-645">Rete locale</span><span class="sxs-lookup"><span data-stu-id="1c11d-645">Local Network</span></span>    </th><th><span data-ttu-id="1c11d-646">Gateway di rete virtuale</span><span class="sxs-lookup"><span data-stu-id="1c11d-646">Virtual Network Gateway</span></span></th></tr>
<tr><td><span data-ttu-id="1c11d-647">hk-lnet-map-to-east-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-647">hk-lnet-map-to-east-us</span></span> </td><td><span data-ttu-id="1c11d-648">Gateway di hk-vnet-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-648">Gateway of hk-vnet-west-us</span></span></td></tr>
<tr><td><span data-ttu-id="1c11d-649">hk-lnet-map-to-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-649">hk-lnet-map-to-west-us</span></span> </td><td><span data-ttu-id="1c11d-650">Gateway di hk-vnet-east-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-650">Gateway of hk-vnet-east-us</span></span></td></tr>
</table>

### <a name="step-6-update-the-shared-key"></a><span data-ttu-id="1c11d-651">Passaggio 6: Aggiornare la chiave condivisa</span><span class="sxs-lookup"><span data-stu-id="1c11d-651">Step 6: Update the shared key</span></span>
<span data-ttu-id="1c11d-652">Utilizzare lo script di Powershell seguente per aggiornare la chiave IPSec di ciascun gateway VPN [utilizzare la chiave SAKE per entrambi i gateway]: Set-AzureVNetGatewayKey -VNetName hk-vnet-east-us -LocalNetworkSiteName hk-lnet-map-to-west-us -SharedKey D9E76BKK Set-AzureVNetGatewayKey -VNetName hk-vnet-west-us -LocalNetworkSiteName hk-lnet-map-to-east-us -SharedKey D9E76BKK</span><span class="sxs-lookup"><span data-stu-id="1c11d-652">Use the following Powershell script to update the IPSec key of each VPN gateway [use the sake key for both the gateways]: Set-AzureVNetGatewayKey -VNetName hk-vnet-east-us -LocalNetworkSiteName hk-lnet-map-to-west-us -SharedKey D9E76BKK Set-AzureVNetGatewayKey -VNetName hk-vnet-west-us -LocalNetworkSiteName hk-lnet-map-to-east-us -SharedKey D9E76BKK</span></span>

### <a name="step-7-establish-the-vnet-to-vnet-connection"></a><span data-ttu-id="1c11d-653">Passaggio 7: Stabilire la connessione tra reti virtuali</span><span class="sxs-lookup"><span data-stu-id="1c11d-653">Step 7: Establish the VNET-to-VNET connection</span></span>
<span data-ttu-id="1c11d-654">Nel portale di Azure classico, usare il menu "DASHBOARD" di entrambe le reti virtuali per stabilire la connessione da gateway a gateway.</span><span class="sxs-lookup"><span data-stu-id="1c11d-654">From the Azure classic portal, use the “DASHBOARD” menu of both the virtual networks to establish gateway-to-gateway connection.</span></span> <span data-ttu-id="1c11d-655">Usare le voci del menu "CONNETTI" nella barra degli strumenti in basso.</span><span class="sxs-lookup"><span data-stu-id="1c11d-655">Use the “CONNECT” menu items in the bottom toolbar.</span></span> <span data-ttu-id="1c11d-656">Dopo alcuni minuti nel dashboard apparirà la visualizzazione grafica dei dettagli della connessione.</span><span class="sxs-lookup"><span data-stu-id="1c11d-656">After a few minutes the dashboard should display the connection details graphically.</span></span>

### <a name="step-8-create-the-virtual-machines-in-region-2"></a><span data-ttu-id="1c11d-657">Passaggio 8: Creare le macchine virtuali nell'area n. 2</span><span class="sxs-lookup"><span data-stu-id="1c11d-657">Step 8: Create the virtual machines in region #2</span></span>
<span data-ttu-id="1c11d-658">Creare l'immagine Ubuntu descritta nella distribuzione nell'area n. 1 seguendo gli stessi passaggi o copiare il file VHD dell'immagine nell'account di archiviazione di Azure dell'area n. 2 e creare l'immagine.</span><span class="sxs-lookup"><span data-stu-id="1c11d-658">Create the Ubuntu image as described in region #1 deployment by following the same steps or copy the image VHD file to the Azure storage account located in region #2 and create the image.</span></span> <span data-ttu-id="1c11d-659">Usare questa immagine e creare il seguente elenco di macchine virtuali in un nuovo servizio cloud hk-c-svc-east-us:</span><span class="sxs-lookup"><span data-stu-id="1c11d-659">Use this image and create the following list of virtual machines into a new cloud service hk-c-svc-east-us:</span></span>

| <span data-ttu-id="1c11d-660">Nome computer</span><span class="sxs-lookup"><span data-stu-id="1c11d-660">Machine Name</span></span> | <span data-ttu-id="1c11d-661">Subnet</span><span class="sxs-lookup"><span data-stu-id="1c11d-661">Subnet</span></span> | <span data-ttu-id="1c11d-662">Indirizzo IP</span><span class="sxs-lookup"><span data-stu-id="1c11d-662">IP Address</span></span> | <span data-ttu-id="1c11d-663">Set di disponibilità</span><span class="sxs-lookup"><span data-stu-id="1c11d-663">Availability set</span></span> | <span data-ttu-id="1c11d-664">DC/Rack</span><span class="sxs-lookup"><span data-stu-id="1c11d-664">DC/Rack</span></span> | <span data-ttu-id="1c11d-665">Valore di inizializzazione?</span><span class="sxs-lookup"><span data-stu-id="1c11d-665">Seed?</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="1c11d-666">hk-c1-east-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-666">hk-c1-east-us</span></span> |<span data-ttu-id="1c11d-667">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-667">data</span></span> |<span data-ttu-id="1c11d-668">10.2.2.4</span><span class="sxs-lookup"><span data-stu-id="1c11d-668">10.2.2.4</span></span> |<span data-ttu-id="1c11d-669">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="1c11d-669">hk-c-aset-1</span></span> |<span data-ttu-id="1c11d-670">dc =EASTUS rack =rack1</span><span class="sxs-lookup"><span data-stu-id="1c11d-670">dc =EASTUS rack =rack1</span></span> |<span data-ttu-id="1c11d-671">Sì</span><span class="sxs-lookup"><span data-stu-id="1c11d-671">Yes</span></span> |
| <span data-ttu-id="1c11d-672">hk-c2-east-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-672">hk-c2-east-us</span></span> |<span data-ttu-id="1c11d-673">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-673">data</span></span> |<span data-ttu-id="1c11d-674">10.2.2.5</span><span class="sxs-lookup"><span data-stu-id="1c11d-674">10.2.2.5</span></span> |<span data-ttu-id="1c11d-675">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="1c11d-675">hk-c-aset-1</span></span> |<span data-ttu-id="1c11d-676">dc =EASTUS rack =rack1</span><span class="sxs-lookup"><span data-stu-id="1c11d-676">dc =EASTUS rack =rack1</span></span> |<span data-ttu-id="1c11d-677">No</span><span class="sxs-lookup"><span data-stu-id="1c11d-677">No</span></span> |
| <span data-ttu-id="1c11d-678">hk-c3-east-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-678">hk-c3-east-us</span></span> |<span data-ttu-id="1c11d-679">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-679">data</span></span> |<span data-ttu-id="1c11d-680">10.2.2.6</span><span class="sxs-lookup"><span data-stu-id="1c11d-680">10.2.2.6</span></span> |<span data-ttu-id="1c11d-681">hk-c-aset-1</span><span class="sxs-lookup"><span data-stu-id="1c11d-681">hk-c-aset-1</span></span> |<span data-ttu-id="1c11d-682">dc =EASTUS rack =rack2</span><span class="sxs-lookup"><span data-stu-id="1c11d-682">dc =EASTUS rack =rack2</span></span> |<span data-ttu-id="1c11d-683">Sì</span><span class="sxs-lookup"><span data-stu-id="1c11d-683">Yes</span></span> |
| <span data-ttu-id="1c11d-684">hk-c5-east-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-684">hk-c5-east-us</span></span> |<span data-ttu-id="1c11d-685">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-685">data</span></span> |<span data-ttu-id="1c11d-686">10.2.2.8</span><span class="sxs-lookup"><span data-stu-id="1c11d-686">10.2.2.8</span></span> |<span data-ttu-id="1c11d-687">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="1c11d-687">hk-c-aset-2</span></span> |<span data-ttu-id="1c11d-688">dc =EASTUS rack =rack3</span><span class="sxs-lookup"><span data-stu-id="1c11d-688">dc =EASTUS rack =rack3</span></span> |<span data-ttu-id="1c11d-689">Sì</span><span class="sxs-lookup"><span data-stu-id="1c11d-689">Yes</span></span> |
| <span data-ttu-id="1c11d-690">hk-c6-east-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-690">hk-c6-east-us</span></span> |<span data-ttu-id="1c11d-691">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-691">data</span></span> |<span data-ttu-id="1c11d-692">10.2.2.9</span><span class="sxs-lookup"><span data-stu-id="1c11d-692">10.2.2.9</span></span> |<span data-ttu-id="1c11d-693">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="1c11d-693">hk-c-aset-2</span></span> |<span data-ttu-id="1c11d-694">dc =EASTUS rack =rack3</span><span class="sxs-lookup"><span data-stu-id="1c11d-694">dc =EASTUS rack =rack3</span></span> |<span data-ttu-id="1c11d-695">No</span><span class="sxs-lookup"><span data-stu-id="1c11d-695">No</span></span> |
| <span data-ttu-id="1c11d-696">hk-c7-east-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-696">hk-c7-east-us</span></span> |<span data-ttu-id="1c11d-697">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-697">data</span></span> |<span data-ttu-id="1c11d-698">10.2.2.10</span><span class="sxs-lookup"><span data-stu-id="1c11d-698">10.2.2.10</span></span> |<span data-ttu-id="1c11d-699">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="1c11d-699">hk-c-aset-2</span></span> |<span data-ttu-id="1c11d-700">dc =EASTUS rack =rack4</span><span class="sxs-lookup"><span data-stu-id="1c11d-700">dc =EASTUS rack =rack4</span></span> |<span data-ttu-id="1c11d-701">Sì</span><span class="sxs-lookup"><span data-stu-id="1c11d-701">Yes</span></span> |
| <span data-ttu-id="1c11d-702">hk-c8-east-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-702">hk-c8-east-us</span></span> |<span data-ttu-id="1c11d-703">data</span><span class="sxs-lookup"><span data-stu-id="1c11d-703">data</span></span> |<span data-ttu-id="1c11d-704">10.2.2.11</span><span class="sxs-lookup"><span data-stu-id="1c11d-704">10.2.2.11</span></span> |<span data-ttu-id="1c11d-705">hk-c-aset-2</span><span class="sxs-lookup"><span data-stu-id="1c11d-705">hk-c-aset-2</span></span> |<span data-ttu-id="1c11d-706">dc =EASTUS rack =rack4</span><span class="sxs-lookup"><span data-stu-id="1c11d-706">dc =EASTUS rack =rack4</span></span> |<span data-ttu-id="1c11d-707">No</span><span class="sxs-lookup"><span data-stu-id="1c11d-707">No</span></span> |
| <span data-ttu-id="1c11d-708">hk-w1-east-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-708">hk-w1-east-us</span></span> |<span data-ttu-id="1c11d-709">Web</span><span class="sxs-lookup"><span data-stu-id="1c11d-709">web</span></span> |<span data-ttu-id="1c11d-710">10.2.1.4</span><span class="sxs-lookup"><span data-stu-id="1c11d-710">10.2.1.4</span></span> |<span data-ttu-id="1c11d-711">hk-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="1c11d-711">hk-w-aset-1</span></span> |<span data-ttu-id="1c11d-712">N/D</span><span class="sxs-lookup"><span data-stu-id="1c11d-712">N/A</span></span> |<span data-ttu-id="1c11d-713">N/D</span><span class="sxs-lookup"><span data-stu-id="1c11d-713">N/A</span></span> |
| <span data-ttu-id="1c11d-714">hk-w2-east-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-714">hk-w2-east-us</span></span> |<span data-ttu-id="1c11d-715">Web</span><span class="sxs-lookup"><span data-stu-id="1c11d-715">web</span></span> |<span data-ttu-id="1c11d-716">10.2.1.5</span><span class="sxs-lookup"><span data-stu-id="1c11d-716">10.2.1.5</span></span> |<span data-ttu-id="1c11d-717">hk-w-aset-1</span><span class="sxs-lookup"><span data-stu-id="1c11d-717">hk-w-aset-1</span></span> |<span data-ttu-id="1c11d-718">N/D</span><span class="sxs-lookup"><span data-stu-id="1c11d-718">N/A</span></span> |<span data-ttu-id="1c11d-719">N/D</span><span class="sxs-lookup"><span data-stu-id="1c11d-719">N/A</span></span> |

<span data-ttu-id="1c11d-720">Seguire le stesse istruzioni dell'area n. 1, ma usare lo spazio di indirizzi 10.2.xxx.xxx.</span><span class="sxs-lookup"><span data-stu-id="1c11d-720">Follow the same instructions as region #1 but use 10.2.xxx.xxx address space.</span></span>

### <a name="step-9-configure-cassandra-on-each-vm"></a><span data-ttu-id="1c11d-721">Passaggio 9: Configurare Cassandra in ogni VM</span><span class="sxs-lookup"><span data-stu-id="1c11d-721">Step 9: Configure Cassandra on each VM</span></span>
<span data-ttu-id="1c11d-722">Accedere alla macchina virtuale ed eseguire la procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="1c11d-722">Log into the VM and perform the following:</span></span>

1. <span data-ttu-id="1c11d-723">Modificare $CASS_HOME/conf/cassandra-rackdc.properties per specificare le proprietà del centro dati e del rack nel formato: dc =EASTUS rack =rack1</span><span class="sxs-lookup"><span data-stu-id="1c11d-723">Edit $CASS_HOME/conf/cassandra-rackdc.properties to specify the data center and rack properties in the format:  dc =EASTUS  rack =rack1</span></span>
2. <span data-ttu-id="1c11d-724">Modificare cassandra.yaml per configurare i nodi dei valori di inizializzazione. Valori di inizializzazione: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10,10.2.2.4,10.2.2.6,10.2.2.8,10.2.2.10"</span><span class="sxs-lookup"><span data-stu-id="1c11d-724">Edit cassandra.yaml to configure seed nodes:  Seeds: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10,10.2.2.4,10.2.2.6,10.2.2.8,10.2.2.10"</span></span>

### <a name="step-10-start-cassandra"></a><span data-ttu-id="1c11d-725">Passaggio 10: Avviare Cassandra</span><span class="sxs-lookup"><span data-stu-id="1c11d-725">Step 10: Start Cassandra</span></span>
<span data-ttu-id="1c11d-726">Accedere a ogni macchina virtuale e avviare Cassandra in background eseguendo il comando seguente: $CASS_HOME/bin/cassandra</span><span class="sxs-lookup"><span data-stu-id="1c11d-726">Log into each VM and start Cassandra in the background by running the following command: $CASS_HOME/bin/cassandra</span></span>

## <a name="test-the-multi-region-cluster"></a><span data-ttu-id="1c11d-727">Testare il cluster in più aree</span><span class="sxs-lookup"><span data-stu-id="1c11d-727">Test the Multi-Region Cluster</span></span>
<span data-ttu-id="1c11d-728">Per ora Cassandra è stato distribuito in 16 nodi con 8 nodi in ogni area di Azure.</span><span class="sxs-lookup"><span data-stu-id="1c11d-728">By now Cassandra has been deployed to 16 nodes with 8 nodes in each Azure region.</span></span> <span data-ttu-id="1c11d-729">Questi nodi sono nello stesso cluster grazie al nome cluster comune e alla configurazione dei nodi dei valori di inizializzazione.</span><span class="sxs-lookup"><span data-stu-id="1c11d-729">These nodes are in the same cluster by virtue of the common cluster name and the seed node configuration.</span></span> <span data-ttu-id="1c11d-730">Usare il processo seguente per testare il cluster:</span><span class="sxs-lookup"><span data-stu-id="1c11d-730">Use the following process to test the cluster:</span></span>

### <a name="step-1-get-the-internal-load-balancer-ip-for-both-the-regions-using-powershell"></a><span data-ttu-id="1c11d-731">Passaggio 1: Ottenere l'IP del servizio di bilanciamento del carico interno per entrambe le aree con PowerShell</span><span class="sxs-lookup"><span data-stu-id="1c11d-731">Step 1: Get the internal load balancer IP for both the regions using PowerShell</span></span>
* <span data-ttu-id="1c11d-732">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-west-us"</span><span class="sxs-lookup"><span data-stu-id="1c11d-732">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-west-us"</span></span>
* <span data-ttu-id="1c11d-733">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-east-us"</span><span class="sxs-lookup"><span data-stu-id="1c11d-733">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-east-us"</span></span>  
  
    <span data-ttu-id="1c11d-734">Prendere nota degli indirizzi IP (ad esempio, west - 10.1.2.101, east - 10.2.2.101) visualizzati.</span><span class="sxs-lookup"><span data-stu-id="1c11d-734">Note the IP addresses (e.g. west - 10.1.2.101, east - 10.2.2.101) displayed.</span></span>

### <a name="step-2-execute-the-following-in-the-west-region-after-logging-into-hk-w1-west-us"></a><span data-ttu-id="1c11d-735">Passaggio 2: Eseguire quanto segue nell'area occidentale dopo l'accesso a hk-w1-west-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-735">Step 2: Execute the following in the west region after logging into hk-w1-west-us</span></span>
1. <span data-ttu-id="1c11d-736">Eseguire $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="1c11d-736">Execute $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span></span>
2. <span data-ttu-id="1c11d-737">Eseguire i comandi CQL seguenti:</span><span class="sxs-lookup"><span data-stu-id="1c11d-737">Execute the following CQL commands:</span></span>
   
     <span data-ttu-id="1c11d-738">CREATE KEYSPACE customers_ks   WITH REPLICATION = { 'class' : 'NetworkToplogyStrategy', 'WESTUS' : 3, 'EASTUS' : 3};   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span><span class="sxs-lookup"><span data-stu-id="1c11d-738">CREATE KEYSPACE customers_ks   WITH REPLICATION = { 'class' : 'NetworkToplogyStrategy', 'WESTUS' : 3, 'EASTUS' : 3};   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span></span>

<span data-ttu-id="1c11d-739">I dati visualizzati saranno simili ai seguenti:</span><span class="sxs-lookup"><span data-stu-id="1c11d-739">You should see a display like the one below:</span></span>

| <span data-ttu-id="1c11d-740">customer_id</span><span class="sxs-lookup"><span data-stu-id="1c11d-740">customer_id</span></span> | <span data-ttu-id="1c11d-741">firstname</span><span class="sxs-lookup"><span data-stu-id="1c11d-741">firstname</span></span> | <span data-ttu-id="1c11d-742">Lastname</span><span class="sxs-lookup"><span data-stu-id="1c11d-742">Lastname</span></span> |
| --- | --- | --- |
| <span data-ttu-id="1c11d-743">1</span><span class="sxs-lookup"><span data-stu-id="1c11d-743">1</span></span> |<span data-ttu-id="1c11d-744">John</span><span class="sxs-lookup"><span data-stu-id="1c11d-744">John</span></span> |<span data-ttu-id="1c11d-745">Doe</span><span class="sxs-lookup"><span data-stu-id="1c11d-745">Doe</span></span> |
| <span data-ttu-id="1c11d-746">2</span><span class="sxs-lookup"><span data-stu-id="1c11d-746">2</span></span> |<span data-ttu-id="1c11d-747">Jane</span><span class="sxs-lookup"><span data-stu-id="1c11d-747">Jane</span></span> |<span data-ttu-id="1c11d-748">Doe</span><span class="sxs-lookup"><span data-stu-id="1c11d-748">Doe</span></span> |

### <a name="step-3-execute-the-following-in-the-east-region-after-logging-into-hk-w1-east-us"></a><span data-ttu-id="1c11d-749">Passaggio 3: Eseguire quanto segue nell'area orientale dopo l'accesso a hk-w1-east-us</span><span class="sxs-lookup"><span data-stu-id="1c11d-749">Step 3: Execute the following in the east region after logging into hk-w1-east-us:</span></span>
1. <span data-ttu-id="1c11d-750">Eseguire $CASS_HOME/bin/cqlsh 10.2.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="1c11d-750">Execute $CASS_HOME/bin/cqlsh 10.2.2.101 9160</span></span>
2. <span data-ttu-id="1c11d-751">Eseguire i comandi CQL seguenti:</span><span class="sxs-lookup"><span data-stu-id="1c11d-751">Execute the following CQL commands:</span></span>
   
     <span data-ttu-id="1c11d-752">USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span><span class="sxs-lookup"><span data-stu-id="1c11d-752">USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span></span>

<span data-ttu-id="1c11d-753">I dati visualizzati saranno uguali a quelli dell'area occidentale:</span><span class="sxs-lookup"><span data-stu-id="1c11d-753">You should see the same display as seen for the West region:</span></span>

| <span data-ttu-id="1c11d-754">customer_id</span><span class="sxs-lookup"><span data-stu-id="1c11d-754">customer_id</span></span> | <span data-ttu-id="1c11d-755">firstname</span><span class="sxs-lookup"><span data-stu-id="1c11d-755">firstname</span></span> | <span data-ttu-id="1c11d-756">Lastname</span><span class="sxs-lookup"><span data-stu-id="1c11d-756">Lastname</span></span> |
| --- | --- | --- |
| <span data-ttu-id="1c11d-757">1</span><span class="sxs-lookup"><span data-stu-id="1c11d-757">1</span></span> |<span data-ttu-id="1c11d-758">John</span><span class="sxs-lookup"><span data-stu-id="1c11d-758">John</span></span> |<span data-ttu-id="1c11d-759">Doe</span><span class="sxs-lookup"><span data-stu-id="1c11d-759">Doe</span></span> |
| <span data-ttu-id="1c11d-760">2</span><span class="sxs-lookup"><span data-stu-id="1c11d-760">2</span></span> |<span data-ttu-id="1c11d-761">Jane</span><span class="sxs-lookup"><span data-stu-id="1c11d-761">Jane</span></span> |<span data-ttu-id="1c11d-762">Doe</span><span class="sxs-lookup"><span data-stu-id="1c11d-762">Doe</span></span> |

<span data-ttu-id="1c11d-763">Inserire ancora alcuni dati per vedere che verranno replicati nella parte west-us del cluster.</span><span class="sxs-lookup"><span data-stu-id="1c11d-763">Execute a few more inserts and see that those get replicated to west-us part of the cluster.</span></span>

## <a name="test-cassandra-cluster-from-nodejs"></a><span data-ttu-id="1c11d-764">Testare il cluster Cassandra da Node.js</span><span class="sxs-lookup"><span data-stu-id="1c11d-764">Test Cassandra Cluster from Node.js</span></span>
<span data-ttu-id="1c11d-765">Con una delle macchine virtuali Linux create nel livello "Web" in precedenza, verrà eseguito un semplice script Node.js per leggere i dati inseriti in precedenza</span><span class="sxs-lookup"><span data-stu-id="1c11d-765">Using one of the Linux VMs crated in the "web" tier previously, we will execute a simple Node.js script to read the previously inserted data</span></span>

<span data-ttu-id="1c11d-766">**Passaggio 1: Installare Node.js e il client Cassandra**</span><span class="sxs-lookup"><span data-stu-id="1c11d-766">**Step 1: Install Node.js and Cassandra Client**</span></span>

1. <span data-ttu-id="1c11d-767">Installare Node.js e NPM</span><span class="sxs-lookup"><span data-stu-id="1c11d-767">Install Node.js and npm</span></span>
2. <span data-ttu-id="1c11d-768">Installare il pacchetto di nodi "cassandra-client" con NPM</span><span class="sxs-lookup"><span data-stu-id="1c11d-768">Install node package "cassandra-client" using npm</span></span>
3. <span data-ttu-id="1c11d-769">Eseguire lo script seguente al prompt della shell. Viene visualizzata la stringa json dei dati recuperati:</span><span class="sxs-lookup"><span data-stu-id="1c11d-769">Execute the following script at the shell prompt which displays the json string of the retrieved data:</span></span>
   
        var pooledCon = require('cassandra-client').PooledConnection;
        var ksName = "custsupport_ks";
        var cfName = "customers_cf";
        var hostList = ['internal_loadbalancer_ip:9160'];
        var ksConOptions = { hosts: hostList,
                             keyspace: ksName, use_bigints: false };
   
        function createKeyspace(callback){
           var cql = 'CREATE KEYSPACE ' + ksName + ' WITH strategy_class=SimpleStrategy AND strategy_options:replication_factor=1';
           var sysConOptions = { hosts: hostList,  
                                 keyspace: 'system', use_bigints: false };
           var con = new pooledCon(sysConOptions);
           con.execute(cql,[],function(err) {
           if (err) {
             console.log("Failed to create Keyspace: " + ksName);
             console.log(err);
           }
           else {
             console.log("Created Keyspace: " + ksName);
             callback(ksConOptions, populateCustomerData);
           }
           });
           con.shutdown();
        }
   
        function createColumnFamily(ksConOptions, callback){
          var params = ['customers_cf','custid','varint','custname',
                        'text','custaddress','text'];
          var cql = 'CREATE COLUMNFAMILY ? (? ? PRIMARY KEY,? ?, ? ?)';
        var con =  new pooledCon(ksConOptions);
          con.execute(cql,params,function(err) {
              if (err) {
                 console.log("Failed to create column family: " + params[0]);
                 console.log(err);
              }
              else {
                 console.log("Created column family: " + params[0]);
                 callback();
              }
          });
          con.shutdown();
        }
   
        //populate Data
        function populateCustomerData() {
           var params = ['John','Infinity Dr, TX', 1];
           updateCustomer(ksConOptions,params);
   
           params = ['Tom','Fermat Ln, WA', 2];
           updateCustomer(ksConOptions,params);
        }
   
        //update will also insert the record if none exists
        function updateCustomer(ksConOptions,params)
        {
          var cql = 'UPDATE customers_cf SET custname=?,custaddress=? where custid=?';
          var con = new pooledCon(ksConOptions);
          con.execute(cql,params,function(err) {
              if (err) console.log(err);
              else console.log("Inserted customer : " + params[0]);
          });
          con.shutdown();
        }
   
        //read the two rows inserted above
        function readCustomer(ksConOptions)
        {
          var cql = 'SELECT * FROM customers_cf WHERE custid IN (1,2)';
          var con = new pooledCon(ksConOptions);
          con.execute(cql,[],function(err,rows) {
              if (err)
                 console.log(err);
              else
                 for (var i=0; i<rows.length; i++)
                    console.log(JSON.stringify(rows[i]));
            });
           con.shutdown();
        }
   
        //exectue the code
        createKeyspace(createColumnFamily);
        readCustomer(ksConOptions)

## <a name="conclusion"></a><span data-ttu-id="1c11d-770">Conclusione</span><span class="sxs-lookup"><span data-stu-id="1c11d-770">Conclusion</span></span>
<span data-ttu-id="1c11d-771">Microsoft Azure è una piattaforma flessibile che consente di eseguire software sia Microsoft che open source, come è stato illustrato in questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="1c11d-771">Microsoft Azure is a flexible platform that allows the running of both Microsoft as well as open source software as demonstrated by this exercise.</span></span> <span data-ttu-id="1c11d-772">I cluster Cassandra a disponibilità elevata possono essere distribuiti in un data center singolo distribuendo i nodi dei cluster in più domini di errore.</span><span class="sxs-lookup"><span data-stu-id="1c11d-772">Highly available Cassandra clusters can be deployed on a single data center through the spreading of the cluster nodes across multiple fault domains.</span></span> <span data-ttu-id="1c11d-773">I cluster Cassandra possono essere distribuiti anche in più area di Azure geograficamente distanti per sistemi a prova di emergenza.</span><span class="sxs-lookup"><span data-stu-id="1c11d-773">Cassandra clusters can also be deployed across multiple geographically distant Azure regions for disaster proof systems.</span></span> <span data-ttu-id="1c11d-774">La combinazione di Azure e Cassandra consente di creare servizi cloud a scalabilità elevata, a disponibilità elevata e ripristinabili in caso di emergenza, necessari per gli odierni servizi su scala Internet.</span><span class="sxs-lookup"><span data-stu-id="1c11d-774">Azure and Cassandra together enables the construction of highly scalable, highly available and disaster recoverable cloud services needed by today's internet scale services.</span></span>  

## <a name="references"></a><span data-ttu-id="1c11d-775">Riferimenti</span><span class="sxs-lookup"><span data-stu-id="1c11d-775">References</span></span>
* [<span data-ttu-id="1c11d-776">http://cassandra.apache.org</span><span class="sxs-lookup"><span data-stu-id="1c11d-776">http://cassandra.apache.org</span></span>](http://cassandra.apache.org)
* [<span data-ttu-id="1c11d-777">http://www.datastax.com</span><span class="sxs-lookup"><span data-stu-id="1c11d-777">http://www.datastax.com</span></span>](http://www.datastax.com)
* [<span data-ttu-id="1c11d-778">http://www.nodejs.org</span><span class="sxs-lookup"><span data-stu-id="1c11d-778">http://www.nodejs.org</span></span>](http://www.nodejs.org)

