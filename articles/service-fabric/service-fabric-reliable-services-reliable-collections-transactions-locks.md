---
title: "Modalità di blocco e in Azure Service Fabric affidabile raccolte aaaTransactions | Documenti Microsoft"
description: Transazioni e blocco delle raccolte Reliable Collections e di Reliable State Manager in Azure Service Fabric.
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/1/2017
ms.author: mcoskun
ms.openlocfilehash: 340e029aa98f43ad6e46b48f687dad01f9d96f69
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="transactions-and-lock-modes-in-azure-service-fabric-reliable-collections"></a><span data-ttu-id="a2a67-103">Transazioni e modalità di blocco delle raccolte Reliable Collections in Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="a2a67-103">Transactions and lock modes in Azure Service Fabric Reliable Collections</span></span>

## <a name="transaction"></a><span data-ttu-id="a2a67-104">Transazione</span><span class="sxs-lookup"><span data-stu-id="a2a67-104">Transaction</span></span>
<span data-ttu-id="a2a67-105">Una transazione è una sequenza di operazioni eseguite in un'unica unità logica di lavoro</span><span class="sxs-lookup"><span data-stu-id="a2a67-105">A transaction is a sequence of operations performed as a single logical unit of work.</span></span>
<span data-ttu-id="a2a67-106">Una transazione deve presentare hello seguenti proprietà ACID.</span><span class="sxs-lookup"><span data-stu-id="a2a67-106">A transaction must exhibit hello following ACID properties.</span></span> <span data-ttu-id="a2a67-107">(vedere https://technet.microsoft.com/it-it/library/ms190612):</span><span class="sxs-lookup"><span data-stu-id="a2a67-107">(see: https://technet.microsoft.com/en-us/library/ms190612)</span></span>
* <span data-ttu-id="a2a67-108">**Atomicità**: una transazione deve essere un'unità di lavoro atomica.</span><span class="sxs-lookup"><span data-stu-id="a2a67-108">**Atomicity**: A transaction must be an atomic unit of work.</span></span> <span data-ttu-id="a2a67-109">In altre parole, devono essere eseguite tutte le modifiche dei dati oppure non ne deve essere eseguita nessuna.</span><span class="sxs-lookup"><span data-stu-id="a2a67-109">In other words, either all its data modifications are performed, or none of them is performed.</span></span>
* <span data-ttu-id="a2a67-110">**Coerenza**: al termine della transazione, tutti i dati devono essere coerenti</span><span class="sxs-lookup"><span data-stu-id="a2a67-110">**Consistency**: When completed, a transaction must leave all data in a consistent state.</span></span> <span data-ttu-id="a2a67-111">Tutte le strutture dati interne devono essere corrette al termine di hello della transazione hello.</span><span class="sxs-lookup"><span data-stu-id="a2a67-111">All internal data structures must be correct at hello end of hello transaction.</span></span>
* <span data-ttu-id="a2a67-112">**Isolamento**: le modifiche eseguite da transazioni simultanee devono essere isolate dalle modifiche apportate da altre transazioni simultanee hello.</span><span class="sxs-lookup"><span data-stu-id="a2a67-112">**Isolation**: Modifications made by concurrent transactions must be isolated from hello modifications made by any other concurrent transactions.</span></span> <span data-ttu-id="a2a67-113">livello di isolamento Hello utilizzato per un'operazione all'interno di un ITransaction è determinato dal hello IReliableState l'operazione di hello.</span><span class="sxs-lookup"><span data-stu-id="a2a67-113">hello isolation level used for an operation within an ITransaction is determined by hello IReliableState performing hello operation.</span></span>
* <span data-ttu-id="a2a67-114">**Durabilità**: al termine di una transazione, gli effetti sono permanenti nel sistema hello.</span><span class="sxs-lookup"><span data-stu-id="a2a67-114">**Durability**: After a transaction has completed, its effects are permanently in place in hello system.</span></span> <span data-ttu-id="a2a67-115">modifiche di Hello permangono anche nell'evento hello di un errore di sistema.</span><span class="sxs-lookup"><span data-stu-id="a2a67-115">hello modifications persist even in hello event of a system failure.</span></span>

### <a name="isolation-levels"></a><span data-ttu-id="a2a67-116">Livelli di isolamento</span><span class="sxs-lookup"><span data-stu-id="a2a67-116">Isolation levels</span></span>
<span data-ttu-id="a2a67-117">Livello di isolamento definisce il grado di hello transazione hello toowhich deve essere isolate dalle modifiche apportate da altre transazioni.</span><span class="sxs-lookup"><span data-stu-id="a2a67-117">Isolation level defines hello degree toowhich hello transaction must be isolated from modifications made by other transactions.</span></span>
<span data-ttu-id="a2a67-118">Le raccolte Reliable Collections supportano due livelli di isolamento:</span><span class="sxs-lookup"><span data-stu-id="a2a67-118">There are two isolation levels that are supported in Reliable Collections:</span></span>

* <span data-ttu-id="a2a67-119">**Lettura ripetibile**: Specifica che le istruzioni non possono leggere i dati che sono stati modificati ma non ancora eseguito il commit da altre transazioni e che nessun'altra transazione possono modificare i dati letti dalla transazione corrente di hello finché hello corrente al termine della transazione.</span><span class="sxs-lookup"><span data-stu-id="a2a67-119">**Repeatable Read**: Specifies that statements cannot read data that has been modified but not yet committed by other transactions and that no other transactions can modify data that has been read by hello current transaction until hello current transaction finishes.</span></span> <span data-ttu-id="a2a67-120">Per altre informazioni, vedere [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="a2a67-120">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>
* <span data-ttu-id="a2a67-121">**Snapshot**: Specifica che i dati letti da qualsiasi istruzione in una transazione sono versione consistente dal punto di hello di hello i dati esistenti all'inizio di hello della transazione hello.</span><span class="sxs-lookup"><span data-stu-id="a2a67-121">**Snapshot**: Specifies that data read by any statement in a transaction is hello transactionally consistent version of hello data that existed at hello start of hello transaction.</span></span>
  <span data-ttu-id="a2a67-122">transazione Hello in grado di riconoscere solo le modifiche dei dati che è sono eseguito il commit prima di inizio della transazione hello hello.</span><span class="sxs-lookup"><span data-stu-id="a2a67-122">hello transaction can recognize only data modifications that were committed before hello start of hello transaction.</span></span>
  <span data-ttu-id="a2a67-123">Modifiche apportate da altre transazioni dopo hello avvio della transazione corrente di hello non sono visibili toostatements esecuzione nella transazione corrente hello.</span><span class="sxs-lookup"><span data-stu-id="a2a67-123">Data modifications made by other transactions after hello start of hello current transaction are not visible toostatements executing in hello current transaction.</span></span>
  <span data-ttu-id="a2a67-124">effetto Hello è come se istruzioni hello in una transazione ottenessero uno snapshot dei dati hello eseguito il commit si trovavano all'inizio di hello di transazione hello.</span><span class="sxs-lookup"><span data-stu-id="a2a67-124">hello effect is as if hello statements in a transaction get a snapshot of hello committed data as it existed at hello start of hello transaction.</span></span>
  <span data-ttu-id="a2a67-125">Gli snapshot tra le Reliable Collections sono coerenti.</span><span class="sxs-lookup"><span data-stu-id="a2a67-125">Snapshots are consistent across Reliable Collections.</span></span>
  <span data-ttu-id="a2a67-126">Per altre informazioni, vedere [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="a2a67-126">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>

<span data-ttu-id="a2a67-127">Raccolte affidabile scegliere automaticamente hello toouse livello di isolamento per una determinata operazione di lettura a seconda operazione hello e ruolo hello della replica di hello in fase di hello della creazione della transazione.</span><span class="sxs-lookup"><span data-stu-id="a2a67-127">Reliable Collections automatically choose hello isolation level toouse for a given read operation depending on hello operation and hello role of hello replica at hello time of transaction's creation.</span></span>
<span data-ttu-id="a2a67-128">Di seguito è tabella hello che raffigura impostazioni predefinite a livello di isolamento per le operazioni di dizionario affidabile e di Accodamento.</span><span class="sxs-lookup"><span data-stu-id="a2a67-128">Following is hello table that depicts isolation level defaults for Reliable Dictionary and Queue operations.</span></span>

| <span data-ttu-id="a2a67-129">Operazione\Ruolo</span><span class="sxs-lookup"><span data-stu-id="a2a67-129">Operation \ Role</span></span> | <span data-ttu-id="a2a67-130">Primario</span><span class="sxs-lookup"><span data-stu-id="a2a67-130">Primary</span></span> | <span data-ttu-id="a2a67-131">Secondario</span><span class="sxs-lookup"><span data-stu-id="a2a67-131">Secondary</span></span> |
| --- |:--- |:--- |
| <span data-ttu-id="a2a67-132">Lettura di entità singola</span><span class="sxs-lookup"><span data-stu-id="a2a67-132">Single Entity Read</span></span> |<span data-ttu-id="a2a67-133">Repeatable Read</span><span class="sxs-lookup"><span data-stu-id="a2a67-133">Repeatable Read</span></span> |<span data-ttu-id="a2a67-134">Snapshot</span><span class="sxs-lookup"><span data-stu-id="a2a67-134">Snapshot</span></span> |
| <span data-ttu-id="a2a67-135">Enumerazione, conteggio</span><span class="sxs-lookup"><span data-stu-id="a2a67-135">Enumeration, Count</span></span> |<span data-ttu-id="a2a67-136">Snapshot</span><span class="sxs-lookup"><span data-stu-id="a2a67-136">Snapshot</span></span> |<span data-ttu-id="a2a67-137">Snapshot</span><span class="sxs-lookup"><span data-stu-id="a2a67-137">Snapshot</span></span> |

> [!NOTE]
> <span data-ttu-id="a2a67-138">Alcuni esempi comuni per le operazioni sulla singola entità sono `IReliableDictionary.TryGetValueAsync` e `IReliableQueue.TryPeekAsync`.</span><span class="sxs-lookup"><span data-stu-id="a2a67-138">Common examples for Single Entity Operations are `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.</span></span>
> 

<span data-ttu-id="a2a67-139">Hello dizionario affidabile e hello coda affidabile supportano entrambi scrive di lettura.</span><span class="sxs-lookup"><span data-stu-id="a2a67-139">Both hello Reliable Dictionary and hello Reliable Queue support Read Your Writes.</span></span>
<span data-ttu-id="a2a67-140">In altre parole, qualsiasi scrittura all'interno di una transazione saranno visibili tooa seguente letti appartenente toohello stessa transazione.</span><span class="sxs-lookup"><span data-stu-id="a2a67-140">In other words, any write within a transaction will be visible tooa following read that belongs toohello same transaction.</span></span>

## <a name="locks"></a><span data-ttu-id="a2a67-141">Blocchi</span><span class="sxs-lookup"><span data-stu-id="a2a67-141">Locks</span></span>
<span data-ttu-id="a2a67-142">In raccolte affidabile, implementano tutti di transazioni rigorosi a due fasi di blocco: una transazione non rilascia i blocchi di hello ha acquisito finché non termina la transazione hello con un'interruzione o un'operazione di commit.</span><span class="sxs-lookup"><span data-stu-id="a2a67-142">In Reliable Collections, all transactions implement rigorous two phase locking: a transaction does not release hello locks it has acquired until hello transaction terminates with either an abort or a commit.</span></span>

<span data-ttu-id="a2a67-143">L'operazione Reliable Dictionary usa il blocco a livello di riga per tutte le operazioni sulla singola entità.</span><span class="sxs-lookup"><span data-stu-id="a2a67-143">Reliable Dictionary uses row level locking for all single entity operations.</span></span>
<span data-ttu-id="a2a67-144">L'operazione Reliable Queue bilancia la concorrenza in cambio di una proprietà FIFO transazionale rigorosa.</span><span class="sxs-lookup"><span data-stu-id="a2a67-144">Reliable Queue trades off concurrency for strict transactional FIFO property.</span></span>
<span data-ttu-id="a2a67-145">Reliable Queue usa i blocchi a livello di operazione che consentono una transazione con `TryPeekAsync` e/o `TryDequeueAsync` e una transazione con `EnqueueAsync` per volta.</span><span class="sxs-lookup"><span data-stu-id="a2a67-145">Reliable Queue uses operation level locks allowing one transaction with `TryPeekAsync` and/or `TryDequeueAsync` and one transaction with `EnqueueAsync` at a time.</span></span>
<span data-ttu-id="a2a67-146">Si noti che toopreserve FIFO, se un `TryPeekAsync` o `TryDequeueAsync` mai osserva che hello affidabile coda è vuota, anche bloccherà `EnqueueAsync`.</span><span class="sxs-lookup"><span data-stu-id="a2a67-146">Note that toopreserve FIFO, if a `TryPeekAsync` or `TryDequeueAsync` ever observes that hello Reliable Queue is empty, they will also lock `EnqueueAsync`.</span></span>

<span data-ttu-id="a2a67-147">Le operazioni di scrittura acquisiscono sempre blocchi esclusivi.</span><span class="sxs-lookup"><span data-stu-id="a2a67-147">Write operations always take Exclusive locks.</span></span>
<span data-ttu-id="a2a67-148">Per le operazioni di lettura, hello blocco dipende da due fattori.</span><span class="sxs-lookup"><span data-stu-id="a2a67-148">For read operations, hello locking depends on a couple of factors.</span></span>
<span data-ttu-id="a2a67-149">Le operazioni di lettura eseguite con Shapshot Isolation sono prive di blocchi.</span><span class="sxs-lookup"><span data-stu-id="a2a67-149">Any read operation done using Snapshot isolation is lock free.</span></span>
<span data-ttu-id="a2a67-150">Per impostazione predefinita, ogni operazione di lettura ripetibile acquisisce blocchi condivisi.</span><span class="sxs-lookup"><span data-stu-id="a2a67-150">Any Repeatable Read operation by default takes Shared locks.</span></span>
<span data-ttu-id="a2a67-151">Tuttavia, per qualsiasi operazione di lettura che supporta la lettura ripetibile, utente hello può richiedere un blocco di aggiornamento anziché hello blocco condiviso.</span><span class="sxs-lookup"><span data-stu-id="a2a67-151">However, for any read operation that supports Repeatable Read, hello user can ask for an Update lock instead of hello Shared lock.</span></span>
<span data-ttu-id="a2a67-152">Un blocco di aggiornamento è che un blocco asimmetrico utilizzato tooprevent una forma comune di deadlock che si verifica quando più transazioni bloccate risorse quali aggiornamenti in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="a2a67-152">An Update lock is an asymmetric lock used tooprevent a common form of deadlock that occurs when multiple transactions lock resources for potential updates at a later time.</span></span>

<span data-ttu-id="a2a67-153">Matrice di compatibilità dei blocchi Hello è reperibile in hello nella tabella seguente:</span><span class="sxs-lookup"><span data-stu-id="a2a67-153">hello lock compatibility matrix can be found in hello following table:</span></span>

| <span data-ttu-id="a2a67-154">Richiesto\Concesso</span><span class="sxs-lookup"><span data-stu-id="a2a67-154">Request \ Granted</span></span> | <span data-ttu-id="a2a67-155">Nessuno</span><span class="sxs-lookup"><span data-stu-id="a2a67-155">None</span></span> | <span data-ttu-id="a2a67-156">Condiviso</span><span class="sxs-lookup"><span data-stu-id="a2a67-156">Shared</span></span> | <span data-ttu-id="a2a67-157">Aggiornamento</span><span class="sxs-lookup"><span data-stu-id="a2a67-157">Update</span></span> | <span data-ttu-id="a2a67-158">Esclusivo</span><span class="sxs-lookup"><span data-stu-id="a2a67-158">Exclusive</span></span> |
| --- |:--- |:--- |:--- |:--- |
| <span data-ttu-id="a2a67-159">Condiviso</span><span class="sxs-lookup"><span data-stu-id="a2a67-159">Shared</span></span> |<span data-ttu-id="a2a67-160">Nessun conflitto</span><span class="sxs-lookup"><span data-stu-id="a2a67-160">No conflict</span></span> |<span data-ttu-id="a2a67-161">Nessun conflitto</span><span class="sxs-lookup"><span data-stu-id="a2a67-161">No conflict</span></span> |<span data-ttu-id="a2a67-162">Conflitto</span><span class="sxs-lookup"><span data-stu-id="a2a67-162">Conflict</span></span> |<span data-ttu-id="a2a67-163">Conflitto</span><span class="sxs-lookup"><span data-stu-id="a2a67-163">Conflict</span></span> |
| <span data-ttu-id="a2a67-164">Aggiornamento</span><span class="sxs-lookup"><span data-stu-id="a2a67-164">Update</span></span> |<span data-ttu-id="a2a67-165">Nessun conflitto</span><span class="sxs-lookup"><span data-stu-id="a2a67-165">No conflict</span></span> |<span data-ttu-id="a2a67-166">Nessun conflitto</span><span class="sxs-lookup"><span data-stu-id="a2a67-166">No conflict</span></span> |<span data-ttu-id="a2a67-167">Conflitto</span><span class="sxs-lookup"><span data-stu-id="a2a67-167">Conflict</span></span> |<span data-ttu-id="a2a67-168">Conflitto</span><span class="sxs-lookup"><span data-stu-id="a2a67-168">Conflict</span></span> |
| <span data-ttu-id="a2a67-169">Esclusivo</span><span class="sxs-lookup"><span data-stu-id="a2a67-169">Exclusive</span></span> |<span data-ttu-id="a2a67-170">Nessun conflitto</span><span class="sxs-lookup"><span data-stu-id="a2a67-170">No conflict</span></span> |<span data-ttu-id="a2a67-171">Conflitto</span><span class="sxs-lookup"><span data-stu-id="a2a67-171">Conflict</span></span> |<span data-ttu-id="a2a67-172">Conflitto</span><span class="sxs-lookup"><span data-stu-id="a2a67-172">Conflict</span></span> |<span data-ttu-id="a2a67-173">Conflitto</span><span class="sxs-lookup"><span data-stu-id="a2a67-173">Conflict</span></span> |

<span data-ttu-id="a2a67-174">Argomento timeout hello affidabile API raccolte viene utilizzata per il rilevamento dei deadlock.</span><span class="sxs-lookup"><span data-stu-id="a2a67-174">Time-out argument in hello Reliable Collections APIs is used for deadlock detection.</span></span>
<span data-ttu-id="a2a67-175">Ad esempio, due transazioni (T1 e T2) siano tentando di tooread e aggiornare K1.</span><span class="sxs-lookup"><span data-stu-id="a2a67-175">For example, two transactions (T1 and T2) are trying tooread and update K1.</span></span>
<span data-ttu-id="a2a67-176">È possibile che li toodeadlock, perché entrambi finire con hello condiviso blocco.</span><span class="sxs-lookup"><span data-stu-id="a2a67-176">It is possible for them toodeadlock, because they both end up having hello Shared lock.</span></span>
<span data-ttu-id="a2a67-177">In questo caso, una o entrambe le operazioni di hello scadrà.</span><span class="sxs-lookup"><span data-stu-id="a2a67-177">In this case, one or both of hello operations will time out.</span></span>

<span data-ttu-id="a2a67-178">Questo scenario di deadlock è un perfetto esempio di come il blocco di aggiornamento possa impedire i deadlock.</span><span class="sxs-lookup"><span data-stu-id="a2a67-178">This deadlock scenario is a great example of how an Update lock can prevent deadlocks.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a2a67-179">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="a2a67-179">Next steps</span></span>
* [<span data-ttu-id="a2a67-180">Lavorare con le raccolte Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="a2a67-180">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="a2a67-181">Notifiche di Reliable Services</span><span class="sxs-lookup"><span data-stu-id="a2a67-181">Reliable Services notifications</span></span>](service-fabric-reliable-services-notifications.md)
* [<span data-ttu-id="a2a67-182">Eseguire il backup e il ripristino di Reliable Services (ripristino di emergenza)</span><span class="sxs-lookup"><span data-stu-id="a2a67-182">Reliable Services backup and restore (disaster recovery)</span></span>](service-fabric-reliable-services-backup-restore.md)
* [<span data-ttu-id="a2a67-183">Reliable State Manager configuration (Configurazione di Reliable State Manager)</span><span class="sxs-lookup"><span data-stu-id="a2a67-183">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* [<span data-ttu-id="a2a67-184">Guida di riferimento per gli sviluppatori per Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="a2a67-184">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)

