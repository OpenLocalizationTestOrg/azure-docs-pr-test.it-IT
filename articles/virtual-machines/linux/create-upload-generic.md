---
title: Creazione e caricamento di un file VHD Linux in Azure
description: Come creare e caricare un disco rigido virtuale Azure (VHD) che contiene un sistema operativo Linux.
services: virtual-machines-linux
documentationcenter: 
author: szarkos
manager: timlt
editor: tysonn
tags: azure-resource-manager,azure-service-management
ms.assetid: d351396c-95a0-4092-b7bf-c6aae0bbd112
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 02/02/2017
ms.author: szark
ms.openlocfilehash: ccadf55c492c097ef96f25e469dbf36fc87b6102
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/03/2017
---
# <a name="information-for-non-endorsed-distributions"></a><span data-ttu-id="a8a0c-103">Informazioni per le distribuzioni non approvate</span><span class="sxs-lookup"><span data-stu-id="a8a0c-103">Information for Non-Endorsed Distributions</span></span>
[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="a8a0c-104">Il contratto di servizio della piattaforma Azure si applica alle macchine virtuali che eseguono il sistema operativo Linux solo quando viene usata una delle [distribuzioni approvate](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="a8a0c-104">The Azure platform SLA applies to virtual machines running the Linux OS only when one of the [endorsed distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) is used.</span></span> <span data-ttu-id="a8a0c-105">Tutte le distribuzioni di Linux disponibili nella raccolta immagini di Azure sono distribuzioni approvate con la configurazione richiesta.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-105">All Linux distributions that are provided in the Azure image gallery are endorsed distributions with the required configuration.</span></span>

* [<span data-ttu-id="a8a0c-106">Linux in Azure - Distribuzioni supportate</span><span class="sxs-lookup"><span data-stu-id="a8a0c-106">Linux on Azure - Endorsed Distributions</span></span>](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
* [<span data-ttu-id="a8a0c-107">Supporto delle immagini Linux in Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="a8a0c-107">Support for Linux images in Microsoft Azure</span></span>](https://support.microsoft.com/kb/2941892)

<span data-ttu-id="a8a0c-108">Tutte le distribuzioni eseguite in Azure dovranno soddisfare numerosi prerequisiti per poter essere eseguite correttamente sulla piattaforma.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-108">All distributions running on Azure will need to meet a number of prerequisites to have a chance to properly run on the platform.</span></span>  <span data-ttu-id="a8a0c-109">Questo articolo non è in alcun modo esaustivo in quanto ogni distribuzione è diversa. È persino possibile che, anche nel caso in cui tutti i criteri seguenti vengano soddisfatti, sia comunque necessario modificare in modo significativo il sistema Linux per garantirne il funzionamento corretto sulla piattaforma.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-109">This article is by no means comprehensive as every distribution is different; and it is quite possible that even if you meet all the criteria below you will still need to significantly tweak your Linux system to ensure that it properly runs on the platform.</span></span>

<span data-ttu-id="a8a0c-110">Per questo motivo, è consigliabile iniziare, laddove possibile, con una delle [distribuzioni approvate di Linux su Azure](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) .</span><span class="sxs-lookup"><span data-stu-id="a8a0c-110">It is for this reason that we recommend that you start with one of our [Linux on Azure Endorsed Distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) when possible.</span></span> <span data-ttu-id="a8a0c-111">Gli articoli seguenti forniscono le istruzioni per preparare le varie distribuzioni Linux approvate che sono supportate in Azure:</span><span class="sxs-lookup"><span data-stu-id="a8a0c-111">The following articles will guide you through how to prepare the various endorsed Linux distributions that are supported on Azure:</span></span>

* <span data-ttu-id="a8a0c-112">**[Distribuzioni basate su CentOS](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="a8a0c-112">**[CentOS-based Distributions](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="a8a0c-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="a8a0c-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="a8a0c-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="a8a0c-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="a8a0c-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="a8a0c-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="a8a0c-116">**[SLES e openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="a8a0c-116">**[SLES & openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="a8a0c-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="a8a0c-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>

<span data-ttu-id="a8a0c-118">La restante parte di questo articolo sarà incentrata sulle indicazioni generali per l'esecuzione della distribuzione Linux in Azure.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-118">The rest of this article will focus on general guidance for running your Linux distribution on Azure.</span></span>

## <a name="general-linux-installation-notes"></a><span data-ttu-id="a8a0c-119">Note generali sull'installazione di Linux</span><span class="sxs-lookup"><span data-stu-id="a8a0c-119">General Linux Installation Notes</span></span>
* <span data-ttu-id="a8a0c-120">Il formato VHDX non è supportato in Azure, solo nei **VHD fissi**.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-120">The VHDX format is not supported in Azure, only **fixed VHD**.</span></span>  <span data-ttu-id="a8a0c-121">È possibile convertire il disco in formato VHD tramite la console di gestione di Hyper-V o il cmdlet convert-vhd.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-121">You can convert the disk to VHD format using Hyper-V Manager or the convert-vhd cmdlet.</span></span> <span data-ttu-id="a8a0c-122">Se si usa VirtualBox, ciò significa che è stato selezionato **Dimensioni fisse** anziché il valore predefinito allocato in modo dinamico durante la creazione del disco.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-122">If you are using VirtualBox this means selecting **Fixed size** as opposed to the default dynamically allocated when creating the disk.</span></span>
* <span data-ttu-id="a8a0c-123">Azure supporta solo macchine virtuali di generazione 1.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-123">Azure only supports generation 1 virtual machines.</span></span> <span data-ttu-id="a8a0c-124">È possibile convertire una macchina virtuale di prima generazione dal formato VHDX al formato VHD ed espandendo in maniera dinamica in un disco di dimensioni prestabilite.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-124">You can convert a generation 1 virtual machine from VHDX to the VHD file format and from dynamically expanding to a fixed sized disk.</span></span> <span data-ttu-id="a8a0c-125">Tuttavia non è possibile modificare la generazione di una macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-125">But you can't change a virtual machine's generation.</span></span> <span data-ttu-id="a8a0c-126">Per ulteriori informazioni, vedere [Creare una macchina virtuale di prima o seconda generazione in Hyper-V](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span><span class="sxs-lookup"><span data-stu-id="a8a0c-126">For more information, see [Should I create a generation 1 or 2 virtual machine in Hyper-V?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span></span>
* <span data-ttu-id="a8a0c-127">La dimensione massima consentita per il disco rigido virtuale è 1023 GB.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-127">The maximum size allowed for the VHD is 1,023 GB.</span></span>
* <span data-ttu-id="a8a0c-128">Durante l'installazione del sistema Linux è *consigliabile* usare partizioni standard anziché LVM, spesso la scelta predefinita per numerose installazioni.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-128">When installing the Linux system it is *recommended* that you use standard partitions rather than LVM (often the default for many installations).</span></span> <span data-ttu-id="a8a0c-129">In questo modo sarà possibile evitare conflitti di nome LVM con le macchine virtuali clonate, in particolare se fosse necessario collegare un disco del sistema operativo a un'altra macchina virtuale identica per la risoluzione dei problemi.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-129">This will avoid LVM name conflicts with cloned VMs, particularly if an OS disk ever needs to be attached to another identical VM for troubleshooting.</span></span> <span data-ttu-id="a8a0c-130">È possibile usare [LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) o [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) su dischi di dati.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-130">[LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) or [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) may be used on data disks.</span></span>
* <span data-ttu-id="a8a0c-131">Per l'installazione di file system UDF è necessario il supporto di kernel.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-131">Kernel support for mounting UDF file systems is required.</span></span> <span data-ttu-id="a8a0c-132">Al primo avvio in Azure la configurazione del provisioning viene passata alla macchina virtuale Linux tramite supporti di memorizzazione formattati con UDF, collegati al guest.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-132">At first boot on Azure the provisioning configuration is passed to the Linux VM via UDF-formatted media that is attached to the guest.</span></span> <span data-ttu-id="a8a0c-133">È necessario che l'agente Linux di Azure possa montare il file system UDF per leggere la relativa configurazione ed eseguire il provisioning della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-133">The Azure Linux agent must be able to mount the UDF file system to read its configuration and provision the VM.</span></span>
* <span data-ttu-id="a8a0c-134">Le versioni di kernel Linux inferiori a 2.6.37 non supportano NUMA su Hyper-V con macchine virtuali di dimensioni maggiori.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-134">Linux kernel versions below 2.6.37 do not support NUMA on Hyper-V with larger VM sizes.</span></span> <span data-ttu-id="a8a0c-135">Questo problema incide principalmente sulle distribuzioni precedenti che usavano il kernel upstream Red Hat 2.6.32. Il problema è stato risolto in RHEL 6.6 (kernel-2.6.32-504).</span><span class="sxs-lookup"><span data-stu-id="a8a0c-135">This issue primarily impacts older distributions using the upstream Red Hat 2.6.32 kernel, and was fixed in RHEL 6.6 (kernel-2.6.32-504).</span></span> <span data-ttu-id="a8a0c-136">I sistemi che eseguono kernel personalizzati con versione precedente alla versione 2.6.37 o kernel basati su RHEL con versione precedente alla versione 2.6.32-504 devono impostare il parametro di avvio `numa=off` nella riga di comando del kernel in rub.conf.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-136">Systems running custom kernels older than 2.6.37, or RHEL-based kernels older than 2.6.32-504 must set the boot parameter `numa=off` on the kernel command-line in grub.conf.</span></span> <span data-ttu-id="a8a0c-137">Per altre informazioni, vedere l'articolo Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span><span class="sxs-lookup"><span data-stu-id="a8a0c-137">For more information see Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span></span>
* <span data-ttu-id="a8a0c-138">Non configurare una partizione swap nel disco del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-138">Do not configure a swap partition on the OS disk.</span></span> <span data-ttu-id="a8a0c-139">L'agente Linux può essere configurato in modo da creare un file swap sul disco temporaneo delle risorse.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-139">The Linux agent can be configured to create a swap file on the temporary resource disk.</span></span>  <span data-ttu-id="a8a0c-140">Altre informazioni su questo argomento sono disponibili nei passaggi seguenti.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-140">More information about this can be found in the steps below.</span></span>
* <span data-ttu-id="a8a0c-141">Tutti i dischi rigidi virtuali devono avere dimensioni multiple di 1 MB.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-141">All of the VHDs must have sizes that are multiples of 1 MB.</span></span>

### <a name="installing-kernel-modules-without-hyper-v"></a><span data-ttu-id="a8a0c-142">Installazione dei moduli kernel senza Hyper-V</span><span class="sxs-lookup"><span data-stu-id="a8a0c-142">Installing kernel modules without Hyper-V</span></span>
<span data-ttu-id="a8a0c-143">Azure viene eseguito nell'hypervisor Hyper-V, pertanto è necessario per Linux che alcuni moduli kernel siano installati per l'esecuzione in Azure.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-143">Azure runs on the Hyper-V hypervisor, so Linux requires that certain kernel modules are installed in order to run in Azure.</span></span> <span data-ttu-id="a8a0c-144">Se si dispone di una macchina virtuale creata fuori da Hyper-V, i programmi di installazione di Linux potrebbero non includere i driver per Hyper-V nel disco RAM iniziale (initrd o initramfs), a meno che non rilevi di essere in esecuzione in un ambiente Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-144">If you have a VM that was created outside of Hyper-V, the Linux installers may not include the drivers for Hyper-V in the initial ramdisk (initrd or initramfs) unless it detects that it is running an a Hyper-V environment.</span></span> <span data-ttu-id="a8a0c-145">Quando si usa un sistema di virtualizzazione diverso (ad esempio Virtualbox, KVM e così via) per preparare l'immagine Linux, potrebbe essere necessario ricreare initrd per assicurarsi che almeno i moduli kernel `hv_vmbus` e `hv_storvsc` siano disponibili sul disco RAM iniziale.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-145">When using a different virtualization system (i.e. Virtualbox, KVM, etc.) to prepare your Linux image, you may need to rebuild the initrd to ensure that at least the `hv_vmbus` and `hv_storvsc` kernel modules are available on the initial ramdisk.</span></span>  <span data-ttu-id="a8a0c-146">Questo è un problema noto, almeno nei sistemi basati sulla distribuzione upstream di Red Hat.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-146">This is a known issue at least on systems based on the upstream Red Hat distribution.</span></span>

<span data-ttu-id="a8a0c-147">Il meccanismo per ricreare l'immagine initrd o initramfs può variare a seconda della distribuzione.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-147">The mechanism for rebuilding the initrd or initramfs image may vary depending on the distribution.</span></span> <span data-ttu-id="a8a0c-148">Per la procedura appropriata, consultare la documentazione della distribuzione o il supporto.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-148">Please consult your distribution's documentation or support for the proper procedure.</span></span>  <span data-ttu-id="a8a0c-149">Di seguito è riportato un esempio di come ricreare l'immagine initrd tramite l'utilità `mkinitrd` :</span><span class="sxs-lookup"><span data-stu-id="a8a0c-149">Here is one example for how to rebuild the initrd using the `mkinitrd` utility:</span></span>

<span data-ttu-id="a8a0c-150">Innanzitutto, eseguire il backup dell'immagine initrd esistente:</span><span class="sxs-lookup"><span data-stu-id="a8a0c-150">First, back up the existing initrd image:</span></span>

    # cd /boot
    # sudo cp initrd-`uname -r`.img  initrd-`uname -r`.img.bak

<span data-ttu-id="a8a0c-151">Quindi, ricompilare initrd con i moduli kernel `hv_vmbus` e `hv_storvsc`:</span><span class="sxs-lookup"><span data-stu-id="a8a0c-151">Next, rebuild the initrd with the `hv_vmbus` and `hv_storvsc` kernel modules:</span></span>

    # sudo mkinitrd --preload=hv_storvsc --preload=hv_vmbus -v -f initrd-`uname -r`.img `uname -r`


### <a name="resizing-vhds"></a><span data-ttu-id="a8a0c-152">Ridimensionamento dei dischi rigidi virtuali</span><span class="sxs-lookup"><span data-stu-id="a8a0c-152">Resizing VHDs</span></span>
<span data-ttu-id="a8a0c-153">Le dimensioni virtuali delle immagini VHD su Azure devono essere allineate a 1 MB.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-153">VHD images on Azure must have a virtual size aligned to 1MB.</span></span>  <span data-ttu-id="a8a0c-154">Solitamente, i VHD creati usando Hyper-V sono già allineati correttamente.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-154">Typically, VHDs created using Hyper-V should already be aligned correctly.</span></span>  <span data-ttu-id="a8a0c-155">Se il disco rigido virtuale non è allineato correttamente, è possibile che venga visualizzato un messaggio di errore simile al seguente quando si tenta di creare un' *immagine* dal disco rigido virtuale:</span><span class="sxs-lookup"><span data-stu-id="a8a0c-155">If the VHD is not aligned correctly then you may receive an error message similar to the following when you attempt to create an *image* from your VHD:</span></span>

    "The VHD http://<mystorageaccount>.blob.core.windows.net/vhds/MyLinuxVM.vhd has an unsupported virtual size of 21475270656 bytes. The size must be a whole number (in MBs).”

<span data-ttu-id="a8a0c-156">Per risolvere questo problema, è possibile ridimensionare la macchina virtuale usando la console di gestione di Hyper-V o il cmdlet Powershell [Resize-VHD](http://technet.microsoft.com/library/hh848535.aspx) .</span><span class="sxs-lookup"><span data-stu-id="a8a0c-156">To remedy this you can resize the VM using either the Hyper-V Manager console or the [Resize-VHD](http://technet.microsoft.com/library/hh848535.aspx) Powershell cmdlet.</span></span>  <span data-ttu-id="a8a0c-157">Se l'ambiente è diverso da Windows, si consiglia di usare qemu-img per convertire (se necessario) e ridimensionare il disco rigido virtuale:</span><span class="sxs-lookup"><span data-stu-id="a8a0c-157">If you are not running in a Windows environment then it is recommended to use qemu-img to convert (if needed) and resize the VHD.</span></span>

> [!NOTE]
> <span data-ttu-id="a8a0c-158">Esiste un bug noto nelle versioni qemu-img > = 2.2.1 risultante in un disco rigido virtuale non formattato correttamente.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-158">There is a known bug in qemu-img versions >=2.2.1 that results in an improperly formatted VHD.</span></span> <span data-ttu-id="a8a0c-159">Il problema è stato risolto in QEMU 2.6.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-159">The issue has been fixed in QEMU 2.6.</span></span> <span data-ttu-id="a8a0c-160">Si consiglia di usare qemu-img 2.2.0 o versione precedente oppure di eseguire l'aggiornamento alla versione 2.6 o successiva.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-160">It is recommended to use either qemu-img 2.2.0 or lower, or update to 2.6 or higher.</span></span> <span data-ttu-id="a8a0c-161">Riferimento: https://bugs.launchpad.net/qemu/+bug/1490611.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-161">Reference: https://bugs.launchpad.net/qemu/+bug/1490611.</span></span>
> 
> 

1. <span data-ttu-id="a8a0c-162">Il ridimensionamento diretto del disco rigido virtuale con strumenti quali `qemu-img` o `vbox-manage` può determinare un disco rigido virtuale che non può essere avviato.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-162">Resizing the VHD directly using tools such as `qemu-img` or `vbox-manage` may result in an unbootable VHD.</span></span>  <span data-ttu-id="a8a0c-163">Pertanto, è consigliabile convertire prima il VHD in un'immagine disco RAW.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-163">So it is recommended to first convert the VHD to a RAW disk image.</span></span>  <span data-ttu-id="a8a0c-164">Se l'immagine della VM è già stata creata come immagine disco RAW (questa è l'impostazione predefinita per alcuni hypervisor, ad esempio KVM), è possibile saltare questo passaggio:</span><span class="sxs-lookup"><span data-stu-id="a8a0c-164">If the VM image was already created as RAW disk image (the default for some Hypervisors such as KVM) then you may skip this step:</span></span>
   
       # qemu-img convert -f vpc -O raw MyLinuxVM.vhd MyLinuxVM.raw

2. <span data-ttu-id="a8a0c-165">Calcolare le dimensioni richieste dell'immagine disco per assicurare che le dimensioni virtuali siano allineate a 1 MB.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-165">Calculate the required size of the disk image to ensure that the virtual size is aligned to 1MB.</span></span>  <span data-ttu-id="a8a0c-166">A questo scopo, può essere utile il seguente script bash shell.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-166">The following bash shell script can assist with this.</span></span>  <span data-ttu-id="a8a0c-167">Lo script usa "`qemu-img info`" per determinare le dimensioni virtuali dell'immagine disco, quindi calcola le dimensioni al successivo 1 MB:</span><span class="sxs-lookup"><span data-stu-id="a8a0c-167">The script uses "`qemu-img info`" to determine the virtual size of the disk image and then calculates the size to the next 1MB:</span></span>
   
       rawdisk="MyLinuxVM.raw"
       vhddisk="MyLinuxVM.vhd"
   
       MB=$((1024*1024))
       size=$(qemu-img info -f raw --output json "$rawdisk" | \
              gawk 'match($0, /"virtual-size": ([0-9]+),/, val) {print val[1]}')
   
       rounded_size=$((($size/$MB + 1)*$MB))
       echo "Rounded Size = $rounded_size"

3. <span data-ttu-id="a8a0c-168">Ridimensionare il disco RAW usando $rounded_size, come impostato nello script precedente:</span><span class="sxs-lookup"><span data-stu-id="a8a0c-168">Resize the raw disk using $rounded_size as set in the above script:</span></span>
   
       # qemu-img resize MyLinuxVM.raw $rounded_size

4. <span data-ttu-id="a8a0c-169">A questo punto, convertire nuovamente il disco RAW in un disco rigido virtuale a dimensione fissa:</span><span class="sxs-lookup"><span data-stu-id="a8a0c-169">Now, convert the RAW disk back to a fixed-size VHD:</span></span>
   
       # qemu-img convert -f raw -o subformat=fixed -O vpc MyLinuxVM.raw MyLinuxVM.vhd

   <span data-ttu-id="a8a0c-170">Oppure, con qemu versione **2.6+** includere l'opzione `force_size`:</span><span class="sxs-lookup"><span data-stu-id="a8a0c-170">Or, with qemu version **2.6+** include the `force_size` option:</span></span>

       # qemu-img convert -f raw -o subformat=fixed,force_size -O vpc MyLinuxVM.raw MyLinuxVM.vhd

## <a name="linux-kernel-requirements"></a><span data-ttu-id="a8a0c-171">Requisiti del kernel Linux</span><span class="sxs-lookup"><span data-stu-id="a8a0c-171">Linux Kernel Requirements</span></span>
<span data-ttu-id="a8a0c-172">I driver di Linux Integration Services (LIS) per Hyper-V e Azure vengono forniti direttamente nel kernel Linux upstream.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-172">The Linux Integration Services (LIS) drivers for Hyper-V and Azure are contributed directly to the upstream Linux kernel.</span></span> <span data-ttu-id="a8a0c-173">Per molte distribuzioni che includono una versione recente del kernel Linux (cioè 3.x) questi driver sono già disponibili; in alternativa, fornire versioni backport dei driver con i relativi kernel.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-173">Many distributions that include a recent Linux kernel version (i.e. 3.x) will have these drivers available already, or otherwise provide backported versions of these drivers with their kernels.</span></span>  <span data-ttu-id="a8a0c-174">Questi driver vengono aggiornati costantemente nel kernel upstream con nuove correzioni e funzionalità, pertanto, quando è possibile, è consigliabile eseguire una [distribuzione approvata](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) , che include tali correzioni e aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-174">These drivers are constantly being updated in the upstream kernel with new fixes and features, so when possible it is recommended to run an [endorsed distribution](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) that will include these fixes and updates.</span></span>

<span data-ttu-id="a8a0c-175">Se si esegue una variante di Red Hat Enterprise Linux versioni **6.0-6.3**, è necessario installare i driver LIS più recenti per Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-175">If you are running a variant of Red Hat Enterprise Linux versions **6.0-6.3**, then you will need to install the latest LIS drivers for Hyper-V.</span></span> <span data-ttu-id="a8a0c-176">I driver sono disponibili [a questo indirizzo](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="a8a0c-176">The drivers can be found [at this location](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span></span> <span data-ttu-id="a8a0c-177">Per quanto riguarda RHEL **6.4 e versioni successive** (e distribuzioni derivate) i driver LIS sono già inclusi nel kernel e pertanto non sono necessari pacchetti di installazione aggiuntivi per eseguire tali sistemi su Azure.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-177">As of RHEL **6.4+** (and derivatives) the LIS drivers are already included with the kernel and so no additional installation packages are needed to run those systems on Azure.</span></span>

<span data-ttu-id="a8a0c-178">Se è necessario un kernel personalizzato, è consigliabile usare una versione più recente del kernel (ad esempio **3.8 e versioni successive**).</span><span class="sxs-lookup"><span data-stu-id="a8a0c-178">If a custom kernel is required, it is recommended to use a more recent kernel version (i.e. **3.8+**).</span></span> <span data-ttu-id="a8a0c-179">Per le distribuzioni o i fornitori che gestiscono il proprio kernel, è consigliabile eseguire il backport ai driver LIS dal kernel upstream al kernel personalizzato.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-179">For those distributions or vendors who maintain their own kernel, some effort will be required to regularly backport the LIS drivers from the upstream kernel to your custom kernel.</span></span>  <span data-ttu-id="a8a0c-180">Anche se si esegue già una versione relativamente recente del kernel, è generalmente consigliabile tenere traccia di eventuali correzioni upstream nei driver LIS ed eseguirne il backport in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-180">Even if you are already running a relatively recent kernel version, it is highly recommended to keep track of any upstream fixes in the LIS drivers and backport those as needed.</span></span> <span data-ttu-id="a8a0c-181">La posizione dei file di origine dei driver LIS è disponibile nel file [MAINTAINERS](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) nell'albero di origine del kernel Linux:</span><span class="sxs-lookup"><span data-stu-id="a8a0c-181">The location of the LIS driver source files is available in the [MAINTAINERS](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) file in the Linux kernel source tree:</span></span>

    F:    arch/x86/include/asm/mshyperv.h
    F:    arch/x86/include/uapi/asm/hyperv.h
    F:    arch/x86/kernel/cpu/mshyperv.c
    F:    drivers/hid/hid-hyperv.c
    F:    drivers/hv/
    F:    drivers/input/serio/hyperv-keyboard.c
    F:    drivers/net/hyperv/
    F:    drivers/scsi/storvsc_drv.c
    F:    drivers/video/fbdev/hyperv_fb.c
    F:    include/linux/hyperv.h
    F:    tools/hv/

<span data-ttu-id="a8a0c-182">Come minimo, l'assenza delle seguenti patch causa problemi in Azure e quindi tali patch devono essere incluse nel kernel.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-182">At a very minimum, the absence of the following patches have been known to cause problems on Azure and so these must be included in the kernel.</span></span> <span data-ttu-id="a8a0c-183">L'elenco non è esaustivo o completo per tutte le distribuzioni:</span><span class="sxs-lookup"><span data-stu-id="a8a0c-183">This list is by no means exhaustive or complete for all distributions:</span></span>

* [<span data-ttu-id="a8a0c-184">ata_piix: defer disks to the Hyper-V drivers by default</span><span class="sxs-lookup"><span data-stu-id="a8a0c-184">ata_piix: defer disks to the Hyper-V drivers by default</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/ata/ata_piix.c?id=cd006086fa5d91414d8ff9ff2b78fbb593878e3c)
* [<span data-ttu-id="a8a0c-185">storvsc: Account for in-transit packets in the RESET path</span><span class="sxs-lookup"><span data-stu-id="a8a0c-185">storvsc: Account for in-transit packets in the RESET path</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/scsi/storvsc_drv.c?id=5c1b10ab7f93d24f29b5630286e323d1c5802d5c)
* [<span data-ttu-id="a8a0c-186">storvsc: avoid usage of WRITE_SAME</span><span class="sxs-lookup"><span data-stu-id="a8a0c-186">storvsc: avoid usage of WRITE_SAME</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=3e8f4f4065901c8dfc51407e1984495e1748c090)
* [<span data-ttu-id="a8a0c-187">storvsc: Disable WRITE SAME for RAID and virtual host adapter drivers</span><span class="sxs-lookup"><span data-stu-id="a8a0c-187">storvsc: Disable WRITE SAME for RAID and virtual host adapter drivers</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=54b2b50c20a61b51199bedb6e5d2f8ec2568fb43)
* [<span data-ttu-id="a8a0c-188">storvsc: NULL pointer dereference fix</span><span class="sxs-lookup"><span data-stu-id="a8a0c-188">storvsc: NULL pointer dereference fix</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=b12bb60d6c350b348a4e1460cd68f97ccae9822e)
* [<span data-ttu-id="a8a0c-189">storvsc: ring buffer failures may result in I/O freeze</span><span class="sxs-lookup"><span data-stu-id="a8a0c-189">storvsc: ring buffer failures may result in I/O freeze</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=e86fb5e8ab95f10ec5f2e9430119d5d35020c951)
* [<span data-ttu-id="a8a0c-190">scsi_sysfs: protect against double execution of __scsi_remove_device</span><span class="sxs-lookup"><span data-stu-id="a8a0c-190">scsi_sysfs: protect against double execution of __scsi_remove_device</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/scsi_sysfs.c?id=be821fd8e62765de43cc4f0e2db363d0e30a7e9b)

## <a name="the-azure-linux-agent"></a><span data-ttu-id="a8a0c-191">Agente Linux di Azure</span><span class="sxs-lookup"><span data-stu-id="a8a0c-191">The Azure Linux Agent</span></span>
<span data-ttu-id="a8a0c-192">L' [agente Linux di Azure](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) è necessario per eseguire correttamente il provisioning di una macchina virtuale Linux in Azure.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-192">The [Azure Linux Agent](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) is required to properly provision a Linux virtual machine in Azure.</span></span> <span data-ttu-id="a8a0c-193">È possibile scaricare la versione più recente, inviare problemi o inviare richieste pull all' [archivio GitHub dell'agente Linux](https://github.com/Azure/WALinuxAgent).</span><span class="sxs-lookup"><span data-stu-id="a8a0c-193">You can get the latest version, file issues or submit pull requests at the [Linux Agent GitHub repo](https://github.com/Azure/WALinuxAgent).</span></span>

* <span data-ttu-id="a8a0c-194">L'agente Linux viene rilasciato con la licenza Apache 2.0.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-194">The Linux agent is released under the Apache 2.0 license.</span></span> <span data-ttu-id="a8a0c-195">Molte distribuzioni forniscono già pacchetti RPM o Debian per l'agente, che pertanto può, in alcuni casi, essere installato e aggiornato con un livello minimo di impegno.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-195">Many distributions already provide RPM or deb packages for the agent, and so in some cases this can be installed and updated with little effort.</span></span>
* <span data-ttu-id="a8a0c-196">L'agente Linux di Azure richiede Python 2.6 o versioni successive.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-196">The Azure Linux Agent requires Python v2.6+.</span></span>
* <span data-ttu-id="a8a0c-197">Inoltre, l'agente richiede il modulo python-pyasn1,</span><span class="sxs-lookup"><span data-stu-id="a8a0c-197">The agent also requires the python-pyasn1 module.</span></span> <span data-ttu-id="a8a0c-198">che nella maggior parte delle distribuzioni viene fornito come pacchetto separato installabile.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-198">Most distributions provide this as a separate package that can be installed.</span></span>
* <span data-ttu-id="a8a0c-199">In alcuni casi l'agente Linux di Azure potrebbe non essere compatibile con NetworkManager.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-199">In some cases the Azure Linux Agent may not be compatible with NetworkManager.</span></span> <span data-ttu-id="a8a0c-200">Molti dei pacchetti RPM/Debian forniti dalle distribuzioni configurano NetworkManager come in conflitto con il pacchetto waagent, pertanto disinstalleranno NetworkManager quando si installa il pacchetto dell'agente Linux.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-200">Many of the RPM/Deb packages provided by distributions configure NetworkManager as a conflict to the waagent package, and thus will uninstall NetworkManager when you install the Linux agent package.</span></span>

## <a name="general-linux-system-requirements"></a><span data-ttu-id="a8a0c-201">Requisiti generali di sistema relativi a Linux</span><span class="sxs-lookup"><span data-stu-id="a8a0c-201">General Linux System Requirements</span></span>

* <span data-ttu-id="a8a0c-202">Modificare la riga di avvio del kernel in GRUB o GRUB2 per includere i parametri seguenti.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-202">Modify the kernel boot line in GRUB or GRUB2 to include the following parameters.</span></span> <span data-ttu-id="a8a0c-203">In questo modo si garantisce inoltre che tutti i messaggi della console vengano inviati alla prima porta seriale, agevolando così il supporto di Azure nella risoluzione dei problemi di debug:</span><span class="sxs-lookup"><span data-stu-id="a8a0c-203">This will also ensure all console messages are sent to the first serial port, which can assist Azure support with debugging issues:</span></span>
  
        console=ttyS0,115200n8 earlyprintk=ttyS0,115200 rootdelay=300
  
    <span data-ttu-id="a8a0c-204">In questo modo si garantisce inoltre che tutti i messaggi della console vengano inviati alla prima porta seriale, agevolando così il supporto di Azure nella risoluzione dei problemi di debug.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-204">This will also ensure all console messages are sent to the first serial port, which can assist Azure support with debugging issues.</span></span>
  
    <span data-ttu-id="a8a0c-205">Inoltre, è consigliabile *rimuovere* i parametri seguenti, se esistenti:</span><span class="sxs-lookup"><span data-stu-id="a8a0c-205">In addition to the above, it is recommended to *remove* the following parameters if they exist:</span></span>
  
        rhgb quiet crashkernel=auto
  
    <span data-ttu-id="a8a0c-206">L'avvio grafico e l'avvio silenzioso non sono utili in un ambiente cloud se tutti i log devono essere inviati alla porta seriale.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-206">Graphical and quiet boot are not useful in a cloud environment where we want all the logs to be sent to the serial port.</span></span> <span data-ttu-id="a8a0c-207">L'opzione `crashkernel` può essere configurata, ma si tenga presente che questo parametro ridurrà la quantità di memoria disponibile nella macchina virtuale di almeno 128 MB, il che potrebbe causare problemi con le macchine virtuali di dimensioni inferiori.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-207">The `crashkernel` option may be left configured if desired, but note that this parameter will reduce the amount of available memory in the VM by 128MB or more, which may be problematic on the smaller VM sizes.</span></span>

* <span data-ttu-id="a8a0c-208">Installazione dell'agente Linux di Azure</span><span class="sxs-lookup"><span data-stu-id="a8a0c-208">Installing the Azure Linux Agent</span></span>
  
    <span data-ttu-id="a8a0c-209">L'agente Linux di Azure è necessario per eseguire il provisioning di un'immagine Linux su Azure.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-209">The Azure Linux Agent is required for provisioning a Linux image on Azure.</span></span>  <span data-ttu-id="a8a0c-210">Molte distribuzioni forniscono l'agente come pacchetto RPM o Debian (il pacchetto è in genere denominato "WALinuxAgent" or "walinuxagent").</span><span class="sxs-lookup"><span data-stu-id="a8a0c-210">Many distributions provide the agent as an RPM or Deb package (the package is typically called 'WALinuxAgent' or 'walinuxagent').</span></span>  <span data-ttu-id="a8a0c-211">È inoltre possibile installare l'agente manualmente seguendo la procedura indicata nella [Guida all'agente Linux](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="a8a0c-211">The agent can also be installed manually by following the steps in the [Linux Agent Guide](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span>

* <span data-ttu-id="a8a0c-212">Verificare che il server SSH sia installato e configurato per l'esecuzione all'avvio.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-212">Ensure that the SSH server is installed and configured to start at boot time.</span></span>  <span data-ttu-id="a8a0c-213">Questo è in genere il valore predefinito.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-213">This is usually the default.</span></span>

* <span data-ttu-id="a8a0c-214">Non creare l'area di swap sul disco del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-214">Do not create swap space on the OS disk</span></span>
  
    <span data-ttu-id="a8a0c-215">L'agente Linux di Azure può configurare automaticamente l'area di swap utilizzando il disco risorse locale collegato alla VM dopo il provisioning in Azure.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-215">The Azure Linux Agent can automatically configure swap space using the local resource disk that is attached to the VM after provisioning on Azure.</span></span> <span data-ttu-id="a8a0c-216">Si noti che il disco risorse locale è un disco *temporaneo* e potrebbe essere svuotato in seguito al deprovisioning della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-216">Note that the local resource disk is a *temporary* disk, and might be emptied when the VM is deprovisioned.</span></span> <span data-ttu-id="a8a0c-217">Dopo aver installato l'agente Linux di Azure come illustrato nel passaggio precedente, modificare i parametri seguenti in /etc/waagent.conf in modo appropriato:</span><span class="sxs-lookup"><span data-stu-id="a8a0c-217">After installing the Azure Linux Agent (see previous step), modify the following parameters in /etc/waagent.conf appropriately:</span></span>
  
        ResourceDisk.Format=y
        ResourceDisk.Filesystem=ext4
        ResourceDisk.MountPoint=/mnt/resource
        ResourceDisk.EnableSwap=y
        ResourceDisk.SwapSizeMB=2048    ## NOTE: set this to whatever you need it to be.

* <span data-ttu-id="a8a0c-218">Infine, eseguire i comandi seguenti per effettuare il deprovisioning della macchina virtuale:</span><span class="sxs-lookup"><span data-stu-id="a8a0c-218">As a final step, run the following commands to deprovision the virtual machine:</span></span>
  
        # sudo waagent -force -deprovision
        # export HISTSIZE=0
        # logout
  
  > [!NOTE]
  > <span data-ttu-id="a8a0c-219">Dopo l'esecuzione del comando "waagent -force -deprovision", su Virtualbox potrebbe essere visualizzato l'errore seguente: `[Errno 5] Input/output error`.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-219">On Virtualbox you may see the following error after running 'waagent -force -deprovision': `[Errno 5] Input/output error`.</span></span> <span data-ttu-id="a8a0c-220">Questo messaggio di errore non è critico e può essere ignorato.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-220">This error message is not critical and can be ignored.</span></span>
  > 
  > 

* <span data-ttu-id="a8a0c-221">Arrestare la macchina virtuale e caricare il VHD in Azure.</span><span class="sxs-lookup"><span data-stu-id="a8a0c-221">You will then need to shut down the virtual machine and upload the VHD to Azure.</span></span>

