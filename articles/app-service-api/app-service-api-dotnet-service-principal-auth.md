---
title: "Autenticazione dell'entità servizio per app per le API nel servizio app di Azure | Documentazione Microsoft"
description: Informazioni su come proteggere un'app per le API nel servizio app di Azure per scenari da servizio a servizio.
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 95653287546bbe358111ed16af0c30a53caff2b5
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="b0350-103">Autenticazione dell'entità servizio per app per le API nel servizio app di Azure</span><span class="sxs-lookup"><span data-stu-id="b0350-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="b0350-104">Panoramica</span><span class="sxs-lookup"><span data-stu-id="b0350-104">Overview</span></span>
<span data-ttu-id="b0350-105">Questo articolo illustra come usare l'autenticazione del servizio app per l'accesso *interno* alle app per le API.</span><span class="sxs-lookup"><span data-stu-id="b0350-105">This article explains how to use App Service authentication for *internal* access to API apps.</span></span> <span data-ttu-id="b0350-106">In uno scenario interno un'app per le API deve essere utilizzabile solo dal codice dell'applicazione dell'utente.</span><span class="sxs-lookup"><span data-stu-id="b0350-106">An internal scenario is where you have an API app that you want to be consumable only by your own application code.</span></span> <span data-ttu-id="b0350-107">Il modo consigliato per implementare questo scenario nel servizio app consiste nell'usare Azure AD per proteggere l'app per le API chiamata.</span><span class="sxs-lookup"><span data-stu-id="b0350-107">The recommended way to implement this scenario in App Service is to use Azure AD to protect the called API app.</span></span> <span data-ttu-id="b0350-108">L'app per le API protetta viene chiamata con un token di connessione ottenuto da Azure AD fornendo le credenziali dell'identità di applicazione (entità servizio).</span><span class="sxs-lookup"><span data-stu-id="b0350-108">You call the protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="b0350-109">Per alternative all'uso di Azure AD, vedere la sezione **Autenticazione da servizio a servizio** in [Autenticazione e autorizzazione nel servizio app di Azure](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span><span class="sxs-lookup"><span data-stu-id="b0350-109">For alternatives to using Azure AD, see the **Service-to-service authentication** section of the [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="b0350-110">In questo articolo si apprenderà:</span><span class="sxs-lookup"><span data-stu-id="b0350-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="b0350-111">Come usare Azure Active Directory (Azure AD) per proteggere un'app per le API dall'accesso non autenticato.</span><span class="sxs-lookup"><span data-stu-id="b0350-111">How to use Azure Active Directory (Azure AD) to protect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="b0350-112">Come utilizzare un'app per le API protetta da un'app per le API, un'app Web o un'app per dispositivi mobili usando le credenziali dell'entità servizio (identità di app) di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b0350-112">How to consume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="b0350-113">Per informazioni sull'utilizzo da un'app per la logica, vedere [Uso dell'API personalizzata ospitata nel servizio app con App per la logica](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="b0350-113">For information about how to consume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="b0350-114">Come verificare che l'app per le API protetta non possa essere chiamata dagli utenti connessi da un browser.</span><span class="sxs-lookup"><span data-stu-id="b0350-114">How to make sure that the protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="b0350-115">Come verificare che l'app per le API protetta possa essere chiamata solo da un'entità servizio di Azure AD specifica.</span><span class="sxs-lookup"><span data-stu-id="b0350-115">How to make sure that the protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="b0350-116">L'articolo contiene due sezioni:</span><span class="sxs-lookup"><span data-stu-id="b0350-116">The article contains two sections:</span></span>

* <span data-ttu-id="b0350-117">La sezione [Come configurare l'autenticazione dell'entità servizio di Servizio app di Azure](#authconfig) illustra in generale come configurare l'autenticazione per le app per le API e come utilizzare un'app per le API protetta.</span><span class="sxs-lookup"><span data-stu-id="b0350-117">The [How to configure service principal authentication in Azure App Service](#authconfig) section explains in general how to configure authentication for any API app, and how to consume the protected API app.</span></span> <span data-ttu-id="b0350-118">Questa sezione si applica allo stesso modo a tutti i framework supportati dal servizio app, inclusi .NET, Node.js e Java.</span><span class="sxs-lookup"><span data-stu-id="b0350-118">This section applies equally to all frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="b0350-119">A partire dalla sezione [Proseguimento della serie di esercitazioni sulle app per le API .NET](#tutorialstart) , l'esercitazione descrive la configurazione di uno scenario di "accesso interno" per un'applicazione .NET di esempio in esecuzione nel servizio app.</span><span class="sxs-lookup"><span data-stu-id="b0350-119">Starting with the [Continuing the .NET getting-started tutorials](#tutorialstart) section, the tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="b0350-120"><a id="authconfig"></a> Come configurare l'autenticazione dell'entità servizio nel servizio app di Azure</span><span class="sxs-lookup"><span data-stu-id="b0350-120"><a id="authconfig"></a> How to configure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="b0350-121">Questa sezione fornisce istruzioni generali applicabili a tutte le app per le API.</span><span class="sxs-lookup"><span data-stu-id="b0350-121">This section provides general instructions that apply to any API app.</span></span> <span data-ttu-id="b0350-122">Per i passaggi specifici dell'applicazione .NET di esempio, To Do List, vedere [Proseguimento della serie di esercitazioni sulle app per le API .NET](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="b0350-122">For steps specific to the To Do List .NET sample application, go to [Continuing the .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="b0350-123">Nel [portale di Azure](https://portal.azure.com/) passare al pannello **Impostazioni** dell'app per le API da proteggere, individuare la sezione **Funzionalità**, quindi fare clic su **Autenticazione/Autorizzazione**.</span><span class="sxs-lookup"><span data-stu-id="b0350-123">In the [Azure portal](https://portal.azure.com/), navigate to the **Settings** blade of the API app that you want to protect, and then find the **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Autenticazione/Autorizzazione nel portale di Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="b0350-125">Nel pannello **Autenticazione/Autorizzazione** fare clic su **Sì**.</span><span class="sxs-lookup"><span data-stu-id="b0350-125">In the **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="b0350-126">Nell'elenco a discesa **Azione da eseguire quando la richiesta non è autenticata** selezionare **Accedi con Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="b0350-126">In the **Action to take when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="b0350-127">In **Provider di autenticazione** fare clic su **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="b0350-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Pannello Autenticazione/Autorizzazione nel portale di Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="b0350-129">Configurare il pannello **Impostazioni di Azure Active Directory** per creare una nuova applicazione Azure AD oppure, se disponibile, usare un'applicazione Azure AD esistente.</span><span class="sxs-lookup"><span data-stu-id="b0350-129">Configure the **Azure Active Directory Settings** blade to create a new Azure AD application, or use an existing Azure AD application if you already have one that you want to use.</span></span>
   
    <span data-ttu-id="b0350-130">Gli scenari interni in genere comprendono un'app per le API che chiama un'app per le API.</span><span class="sxs-lookup"><span data-stu-id="b0350-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="b0350-131">È possibile usare applicazioni Azure AD separate per ogni app per le API o una sola applicazione Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b0350-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="b0350-132">Per istruzioni dettagliate su questo pannello, vedere [Come configurare un'applicazione del servizio app per usare l'account di accesso di Azure Active Directory](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="b0350-132">For detailed instructions on this blade, see [How to configure your App Service application to use Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="b0350-133">Dopo aver completato le operazioni nel pannello di configurazione del provider di autenticazione, fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="b0350-133">When you're done with the authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="b0350-134">Nel pannello **Autenticazione/Autorizzazione** fare clic su **Salva**.</span><span class="sxs-lookup"><span data-stu-id="b0350-134">In the **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Fare clic su Salva.](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="b0350-136">Al termine, il servizio app consente solo le richieste dai chiamanti nel tenant di Azure AD configurato.</span><span class="sxs-lookup"><span data-stu-id="b0350-136">When this is done, App Service only allows requests from callers in the configured Azure AD tenant.</span></span> <span data-ttu-id="b0350-137">Nell'app per le API protetta non sono necessari codici di autenticazione o di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="b0350-137">No authentication or authorization code is required in the protected API app.</span></span> <span data-ttu-id="b0350-138">Il token di connessione viene passato all'app per le API con le attestazioni di uso comune nelle intestazioni HTTP ed è possibile leggere tali informazioni nel codice per convalidare la provenienza delle richieste da un determinato chiamante, ad esempio un'entità servizio.</span><span class="sxs-lookup"><span data-stu-id="b0350-138">The bearer token is passed to the API app along with commonly used claims in HTTP headers, and you can read that information in code to validate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="b0350-139">Questa funzionalità di autenticazione è la stessa per tutti i linguaggi supportati dal servizio app, inclusi .NET, Node.js e Java.</span><span class="sxs-lookup"><span data-stu-id="b0350-139">This authentication functionality works the same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-to-consume-the-protected-api-app"></a><span data-ttu-id="b0350-140">Come utilizzare l'app per le API protetta</span><span class="sxs-lookup"><span data-stu-id="b0350-140">How to consume the protected API app</span></span>
<span data-ttu-id="b0350-141">Il chiamante deve fornire un token di connessione di Azure AD con le chiamate API.</span><span class="sxs-lookup"><span data-stu-id="b0350-141">The caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="b0350-142">Per ottenere un token di connessione con le credenziali dell'entità servizio, il chiamante usa Active Directory Authentication Library (ADAL per [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs) o [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="b0350-142">To get a bearer token using service principal credentials, the caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="b0350-143">Per ottenere un token, il codice che chiama ADAL fornisce ad ADAL le informazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="b0350-143">To get a token, the code that calls ADAL provides to ADAL the following information:</span></span>

* <span data-ttu-id="b0350-144">Nome del tenant di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b0350-144">The name of your Azure AD tenant.</span></span>
* <span data-ttu-id="b0350-145">ID client e segreto client (chiave app) dell'app Azure AD associata al chiamante.</span><span class="sxs-lookup"><span data-stu-id="b0350-145">The client ID and client secret (app key) of the Azure AD app associated with the caller.</span></span>
* <span data-ttu-id="b0350-146">ID client dell'applicazione Azure AD associata all'app per le API protetta.</span><span class="sxs-lookup"><span data-stu-id="b0350-146">The client ID of the Azure AD application associated with the protected API app.</span></span> <span data-ttu-id="b0350-147">Se viene usata una sola applicazione Azure AD, è lo stesso ID client del chiamante.</span><span class="sxs-lookup"><span data-stu-id="b0350-147">(If just one Azure AD application is used, this is the same client ID as the one for the caller.)</span></span>

<span data-ttu-id="b0350-148">Questi valori sono disponibili nelle pagine di Azure AD del [portale di Azure classico](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="b0350-148">These values are available in the Azure AD pages of the [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="b0350-149">Una volta acquisito il token, il chiamante lo include con le richieste HTTP nell'intestazione dell'autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="b0350-149">Once the token has been acquired, the caller includes it with HTTP requests in the Authorization header.</span></span>  <span data-ttu-id="b0350-150">Il servizio app convalida il token e consente alle richieste di raggiungere l'app per le API protetta.</span><span class="sxs-lookup"><span data-stu-id="b0350-150">App Service validates the token and allows the requests to reach the protected API app.</span></span>

#### <a name="how-to-protect-the-api-app-from-access-by-users-in-the-same-tenant"></a><span data-ttu-id="b0350-151">Come proteggere l'app per le API dall'accesso di utenti nello stesso tenant</span><span class="sxs-lookup"><span data-stu-id="b0350-151">How to protect the API app from access by users in the same tenant</span></span>
<span data-ttu-id="b0350-152">I token di connessione per gli utenti nello stesso tenant sono considerati validi per l'app per le API protetta.</span><span class="sxs-lookup"><span data-stu-id="b0350-152">Bearer tokens for users in the same tenant are considered valid for the protected API app.</span></span>  <span data-ttu-id="b0350-153">Per assicurarsi che una sola entità servizio possa chiamare l'app per le API protetta, aggiungere il codice nell'app per le API protetta per convalidare le attestazioni seguenti dal token:</span><span class="sxs-lookup"><span data-stu-id="b0350-153">If you want to ensure that only a service principal can call the protected API app, add code in the protected API app to validate the following claims from the token:</span></span>

* <span data-ttu-id="b0350-154">`appid` deve essere l'ID client dell'applicazione Azure AD associata al chiamante.</span><span class="sxs-lookup"><span data-stu-id="b0350-154">`appid` should be the client ID of the Azure AD application that is associated with the caller.</span></span> 
* <span data-ttu-id="b0350-155">`oid` (`objectidentifier`) deve essere l'ID entità servizio del chiamante.</span><span class="sxs-lookup"><span data-stu-id="b0350-155">`oid` (`objectidentifier`) should be the service principal ID of the caller.</span></span> 

<span data-ttu-id="b0350-156">Il servizio app fornisce anche l'attestazione `objectidentifier` nell'intestazione X-MS-CLIENT-PRINCIPAL-ID.</span><span class="sxs-lookup"><span data-stu-id="b0350-156">App Service also provides the `objectidentifier` claim in the X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-to-protect-the-api-app-from-browser-access"></a><span data-ttu-id="b0350-157">Come proteggere l'app per le API dall'accesso dal browser</span><span class="sxs-lookup"><span data-stu-id="b0350-157">How to protect the API app from browser access</span></span>
<span data-ttu-id="b0350-158">Se non si convalidano le attestazioni nel codice nell'app per le API protetta e si usa un'applicazione Azure AD separata per l'app per le API protetta, verificare che l'URL di risposta dell'applicazione Azure AD non sia lo stesso URL di base dell'app per le API.</span><span class="sxs-lookup"><span data-stu-id="b0350-158">If you don't validate claims in code in the protected API app, and if you use a separate Azure AD application for the protected API app, make sure that the Azure AD application's Reply URL is not the same as the API app's base URL.</span></span> <span data-ttu-id="b0350-159">Se l'URL di risposta punta direttamente all'app per le API protetta, un utente nello stesso tenant di Azure AD potrebbe selezionare l'app per le API, accedere e chiamare l'API.</span><span class="sxs-lookup"><span data-stu-id="b0350-159">If the Reply URL points directly to the protected API app, a user in the same Azure AD tenant could browse to the API app, log on, and successfully call the API.</span></span>

## <span data-ttu-id="b0350-160"><a id="tutorialstart"></a> Proseguimento della serie di esercitazioni su .NET</span><span class="sxs-lookup"><span data-stu-id="b0350-160"><a id="tutorialstart"></a> Continuing the .NET API Apps tutorial series</span></span>
<span data-ttu-id="b0350-161">Se si sta seguendo la serie di esercitazioni su Node.js o Java per le app per le API, passare alla sezione [Passaggi successivi](#next-steps) .</span><span class="sxs-lookup"><span data-stu-id="b0350-161">If you are following the Node.js or Java tutorial series for API apps, skip to the [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="b0350-162">Il resto di questo articolo rappresenta la continuazione della serie di esercitazioni sulle app per le API .NET. Queste esercitazioni presuppongono che sia stata completata l'[esercitazione sull'autenticazione utente](app-service-api-dotnet-user-principal-auth.md) e che l'applicazione di esempio sia in esecuzione in Azure con l'autenticazione utente abilitata.</span><span class="sxs-lookup"><span data-stu-id="b0350-162">The remainder of this article continues the .NET API Apps tutorial series and assumes that you have completed the [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have the sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="b0350-163">Configurare l'autenticazione in Azure</span><span class="sxs-lookup"><span data-stu-id="b0350-163">Set up authentication in Azure</span></span>
<span data-ttu-id="b0350-164">In questa sezione si configura il servizio app in modo che le sole richieste HTTP a cui è consentito raggiungere l'app per le API del livello dati siano quelle con token di connessione di Azure AD validi.</span><span class="sxs-lookup"><span data-stu-id="b0350-164">In this section you configure App Service so that the only HTTP requests it allows to reach the data tier API app are the ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="b0350-165">Nella sezione seguente si configura l'app per le API del livello intermedio in modo che invii le credenziali dell'applicazione ad Azure AD, ottenga un token di connessione e invii il token di connessione all'app per le API del livello dati.</span><span class="sxs-lookup"><span data-stu-id="b0350-165">In the following section, you configure the middle tier API app to send application credentials to Azure AD, get back a bearer token, and send the bearer token to the data tier API app.</span></span> <span data-ttu-id="b0350-166">Questo processo è illustrato nel diagramma.</span><span class="sxs-lookup"><span data-stu-id="b0350-166">This process is illustrated in the diagram.</span></span>

![Diagramma di autenticazione del servizio](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="b0350-168">Se si verificano problemi mentre si seguono le istruzioni dell'esercitazione, vedere la sezione [Risoluzione dei problemi](#troubleshooting) alla fine dell'esercitazione.</span><span class="sxs-lookup"><span data-stu-id="b0350-168">If you run into problems while following the tutorial directions, see the [Troubleshooting](#troubleshooting) section at the end of the tutorial.</span></span> 

1. <span data-ttu-id="b0350-169">Nel [portale di Azure](https://portal.azure.com/) passare al pannello **Impostazioni** dell'app per le API creata per l'app per le API ToDoListDataAPI (livello dati) e quindi fare clic su **Impostazioni**.</span><span class="sxs-lookup"><span data-stu-id="b0350-169">In the [Azure portal](https://portal.azure.com/), navigate to the **Settings** blade of the API app that you created for the ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="b0350-170">Nel pannello **Impostazioni** individuare la sezione **Funzionalità** e quindi fare clic su **Autenticazione/Autorizzazione**.</span><span class="sxs-lookup"><span data-stu-id="b0350-170">In the **Settings** blade, find the **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Autenticazione/Autorizzazione nel portale di Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="b0350-172">Nel pannello **Autenticazione/Autorizzazione** fare clic su **Sì**.</span><span class="sxs-lookup"><span data-stu-id="b0350-172">In the **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="b0350-173">Nell'elenco a discesa **Azione da eseguire quando la richiesta non è autenticata** selezionare **Accedi con Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="b0350-173">In the **Action to take when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="b0350-174">Questa impostazione fa in modo che il servizio app verifichi che solo le richieste autenticate raggiungano l'app per le API.</span><span class="sxs-lookup"><span data-stu-id="b0350-174">This is the setting that causes App Service to ensure that only authenticated requests reach the API app.</span></span> <span data-ttu-id="b0350-175">Per le richieste con token di connessione validi, il servizio app passa i token all'app per le API e popola le intestazioni HTTP con attestazioni di uso comune per rendere tali informazioni più facilmente disponibili al codice.</span><span class="sxs-lookup"><span data-stu-id="b0350-175">For requests that have valid bearer tokens, App Service passes the tokens along to the API app and populates HTTP headers with commonly used claims to make that information more easily available to your code.</span></span>
5. <span data-ttu-id="b0350-176">In **Provider di autenticazione** fare clic su **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="b0350-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Pannello Autenticazione/Autorizzazione nel portale di Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="b0350-178">Nel pannello **Impostazioni di Azure Active Directory** fare clic su **Rapida**.</span><span class="sxs-lookup"><span data-stu-id="b0350-178">In the **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="b0350-179">Con l'opzione **Rapida** Azure può creare automaticamente un'applicazione AAD nel [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant)di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b0350-179">With the **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="b0350-180">Non è necessario creare un tenant, perché ne esiste già uno per ogni account Azure.</span><span class="sxs-lookup"><span data-stu-id="b0350-180">You don't have to create a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="b0350-181">In **Modalità di gestione** fare clic su **Crea nuova app AD** se questa opzione non è già selezionata.</span><span class="sxs-lookup"><span data-stu-id="b0350-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="b0350-182">Il portale inserisce un valore predefinito nella casella di input **Crea app** .</span><span class="sxs-lookup"><span data-stu-id="b0350-182">The portal plugs the **Create App** input box with a default value.</span></span> <span data-ttu-id="b0350-183">Per impostazione predefinita, all'applicazione Azure AD viene assegnato lo stesso nome dell'app per le API.</span><span class="sxs-lookup"><span data-stu-id="b0350-183">By default, the Azure AD application is named the same as the API app.</span></span> <span data-ttu-id="b0350-184">Se si preferisce, è possibile immettere un nome diverso.</span><span class="sxs-lookup"><span data-stu-id="b0350-184">If you prefer, you can enter a different name.</span></span>
   
    ![Impostazioni di Azure AD](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="b0350-186">**Nota**: in alternativa, è possibile usare una sola applicazione Azure AD sia per l'app per le API chiamante che per l'app per le API protetta.</span><span class="sxs-lookup"><span data-stu-id="b0350-186">**Note**: As an alternative, you could use a single Azure AD application for both the calling API app and the protected API app.</span></span> <span data-ttu-id="b0350-187">Se si sceglie questa alternativa, l'opzione **Crea nuova app AD** non sarà necessaria perché un'applicazione Azure AD è già stata creata prima nell'esercitazione sull'autenticazione utente.</span><span class="sxs-lookup"><span data-stu-id="b0350-187">If you chose that alternative, you would not need the **Create New AD App** option here because you already created an Azure AD application earlier in the user authentication tutorial.</span></span> <span data-ttu-id="b0350-188">Per questa esercitazione si useranno applicazioni Azure AD separate per l'app per le API chiamante e per l'app per le API protetta.</span><span class="sxs-lookup"><span data-stu-id="b0350-188">For this tutorial, you'll use separate Azure AD applications for the calling API app and the protected API app.</span></span>
8. <span data-ttu-id="b0350-189">Prendere nota del valore nella casella di input **Crea app**. Più avanti sarà necessario cercare questa applicazione AAD nel portale di Azure classico.</span><span class="sxs-lookup"><span data-stu-id="b0350-189">Make a note of the value that is in the **Create App** input box; you'll look up this AAD application in the Azure classic portal later.</span></span>
9. <span data-ttu-id="b0350-190">Fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="b0350-190">Click **OK**.</span></span>
10. <span data-ttu-id="b0350-191">Nel pannello **Autenticazione/Autorizzazione** fare clic su **Salva**.</span><span class="sxs-lookup"><span data-stu-id="b0350-191">In the **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![Fare clic su Salva.](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="b0350-193">Il servizio app crea l'applicazione Azure Active Directory con **URL accesso** e **URL di risposta** impostati automaticamente sull'URL dell'app per le API.</span><span class="sxs-lookup"><span data-stu-id="b0350-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set to the URL of your API app.</span></span> <span data-ttu-id="b0350-194">Il secondo valore consente agli utenti nel tenant di AAD di accedere all'app per le API.</span><span class="sxs-lookup"><span data-stu-id="b0350-194">The latter value enables users in your AAD tenant to log in and access the API app.</span></span>

### <a name="verify-that-the-api-app-is-protected"></a><span data-ttu-id="b0350-195">Verificare che l'app per le API sia protetta</span><span class="sxs-lookup"><span data-stu-id="b0350-195">Verify that the API app is protected</span></span>
1. <span data-ttu-id="b0350-196">In un browser passare all'URL dell'app per le API. Nel pannello **App per le API** del portale di Azure fare clic sul collegamento in **URL**.</span><span class="sxs-lookup"><span data-stu-id="b0350-196">In a browser go to the URL of the API app: in the **API app** blade in the Azure portal, click the link under **URL**.</span></span> 
   
    <span data-ttu-id="b0350-197">Si viene reindirizzati a una schermata di accesso, perché alle richieste non autenticate non è consentito raggiungere l'app per le API.</span><span class="sxs-lookup"><span data-stu-id="b0350-197">You are redirected to a login screen because unauthenticated requests are not allowed to reach the API app.</span></span> 
   
    <span data-ttu-id="b0350-198">Se il browser passa all'interfaccia utente di Swagger, potrebbe già essere connesso. In tal caso, aprire una finestra di InPrivate o in incognito e andare all'URL dell'interfaccia utente di Swagger.</span><span class="sxs-lookup"><span data-stu-id="b0350-198">If your browser does go to the Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go to the Swagger UI URL.</span></span>
2. <span data-ttu-id="b0350-199">Accedere con le credenziali di un utente che appartiene al tenant AAD.</span><span class="sxs-lookup"><span data-stu-id="b0350-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="b0350-200">Dopo avere effettuato l'accesso, viene visualizzata una pagina che informa che l'operazione di creazione è riuscita.</span><span class="sxs-lookup"><span data-stu-id="b0350-200">When you're logged on, the "successfully created" page appears in the browser.</span></span>

## <a name="configure-the-todolistapi-project-to-acquire-and-send-the-azure-ad-token"></a><span data-ttu-id="b0350-201">Configurare il progetto ToDoListAPI per acquisire e inviare il token di Azure AD</span><span class="sxs-lookup"><span data-stu-id="b0350-201">Configure the ToDoListAPI project to acquire and send the Azure AD token</span></span>
<span data-ttu-id="b0350-202">In questa sezione vengono eseguite le attività seguenti:</span><span class="sxs-lookup"><span data-stu-id="b0350-202">In this section you do the following tasks:</span></span>

* <span data-ttu-id="b0350-203">Aggiunta di codice nell'app per le API del livello intermedio che usa le credenziali dell'applicazione Azure AD per acquisire un token e inviarlo con le richieste HTTP all'app per le API del livello dati.</span><span class="sxs-lookup"><span data-stu-id="b0350-203">Add code in the middle tier API app that uses Azure AD application credentials to acquire a token and send it with HTTP requests to the data tier API app.</span></span>
* <span data-ttu-id="b0350-204">Acquisizione delle credenziali necessarie da Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b0350-204">Get the credentials you need from Azure AD.</span></span>
* <span data-ttu-id="b0350-205">Immissione delle credenziali nelle impostazioni dell'ambiente di runtime di Servizio app di Azure nell'app per le API del livello intermedio.</span><span class="sxs-lookup"><span data-stu-id="b0350-205">Enter the credentials into Azure App Service runtime environment settings in the middle tier API app.</span></span> 

### <a name="configure-the-todolistapi-project-to-acquire-and-send-the-azure-ad-token"></a><span data-ttu-id="b0350-206">Configurare il progetto ToDoListAPI per acquisire e inviare il token di Azure AD</span><span class="sxs-lookup"><span data-stu-id="b0350-206">Configure the ToDoListAPI project to acquire and send the Azure AD token</span></span>
<span data-ttu-id="b0350-207">Apportare le modifiche seguenti al progetto ToDoListAPI in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b0350-207">Make the following changes in the ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="b0350-208">Rimuovere il commento da tutto il codice nel file *ServicePrincipal.cs* .</span><span class="sxs-lookup"><span data-stu-id="b0350-208">Uncomment all of the code in the *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="b0350-209">Si tratta del codice che usa ADAL per .NET per acquisire il token di connessione di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b0350-209">This is the code that uses ADAL for .NET to acquire the Azure AD bearer token.</span></span>  <span data-ttu-id="b0350-210">Usa diversi valori di configurazione che si imposteranno più avanti nell'ambiente di runtime di Azure.</span><span class="sxs-lookup"><span data-stu-id="b0350-210">It uses several configuration values that you'll set in the Azure runtime environment later.</span></span> <span data-ttu-id="b0350-211">Ecco il codice:</span><span class="sxs-lookup"><span data-stu-id="b0350-211">Here's the code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="b0350-212">**Nota:** questo codice richiede il pacchetto NuGet ADAL per .NET (Microsoft.IdentityModel.Clients.ActiveDirectory), che è già installato nel progetto.</span><span class="sxs-lookup"><span data-stu-id="b0350-212">**Note:** This code requires the ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in the project.</span></span> <span data-ttu-id="b0350-213">Se si crea questo progetto da zero, sarà necessario installare il pacchetto.</span><span class="sxs-lookup"><span data-stu-id="b0350-213">If you were creating this project from scratch, you would have to install this package.</span></span> <span data-ttu-id="b0350-214">Questo pacchetto non viene installato automaticamente dal modello di nuovo progetto dell'app per le API.</span><span class="sxs-lookup"><span data-stu-id="b0350-214">This package is not automatically installed by the API app new-project template.</span></span>
2. <span data-ttu-id="b0350-215">In *Controllers/ToDoListController* rimuovere il commento dal codice nel metodo `NewDataAPIClient` che aggiunge il token alle richieste HTTP nell'intestazione dell'autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="b0350-215">In *Controllers/ToDoListController*, uncomment the code in the `NewDataAPIClient` method that adds the token to HTTP requests in the authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="b0350-216">Distribuire il progetto ToDoListAPI.</span><span class="sxs-lookup"><span data-stu-id="b0350-216">Deploy the ToDoListAPI project.</span></span> <span data-ttu-id="b0350-217">Fare clic con il pulsante destro del mouse sul progetto, quindi selezionare **Pubblica > Pubblica**.</span><span class="sxs-lookup"><span data-stu-id="b0350-217">(Right-click the project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="b0350-218">Visual Studio distribuisce il progetto e apre una finestra del browser all'URL di base dell'app Web.</span><span class="sxs-lookup"><span data-stu-id="b0350-218">Visual Studio deploys the project and opens a browser to the web app's base URL.</span></span> <span data-ttu-id="b0350-219">Viene visualizzata la pagina dell'errore 403, che rappresenta la risposta normale quando si tenta di passare a un URL di base dell'API Web da un browser.</span><span class="sxs-lookup"><span data-stu-id="b0350-219">This will show a 403 error page, which is normal for an attempt to go to a Web API base URL from a browser.</span></span>
4. <span data-ttu-id="b0350-220">Chiudere il browser.</span><span class="sxs-lookup"><span data-stu-id="b0350-220">Close the browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="b0350-221">Ottenere i valori di configurazione di Azure AD</span><span class="sxs-lookup"><span data-stu-id="b0350-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="b0350-222">Nel [portale di Azure classico](https://manage.windowsazure.com/)passare a **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="b0350-222">In the [Azure classic portal](https://manage.windowsazure.com/), go to **Azure Active Directory**.</span></span>
2. <span data-ttu-id="b0350-223">Nella scheda **Directory** fare clic sul tenant AAD.</span><span class="sxs-lookup"><span data-stu-id="b0350-223">On the **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="b0350-224">Fare clic su **Applicazioni > Applicazioni di proprietà dell'azienda** e quindi fare clic sul segno di spunta.</span><span class="sxs-lookup"><span data-stu-id="b0350-224">Click **Applications > Applications my company owns**, and then click the check mark.</span></span>
4. <span data-ttu-id="b0350-225">Nell'elenco delle applicazioni fare clic sul nome di quella creata automaticamente da Azure quando è stata abilitata l'autenticazione per l'app per le API ToDoListDataAPI (livello dati).</span><span class="sxs-lookup"><span data-stu-id="b0350-225">In the list of applications, click the name of the one that Azure created for you when you enabled authentication for the ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="b0350-226">Fare clic sulla scheda **Configure** .</span><span class="sxs-lookup"><span data-stu-id="b0350-226">Click the **Configure** tab.</span></span>
6. <span data-ttu-id="b0350-227">Copiare il valore **ID client** e salvarlo in una posizione da cui poterlo recuperare più tardi.</span><span class="sxs-lookup"><span data-stu-id="b0350-227">Copy the **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="b0350-228">Nel portale di Azure classico tornare all'elenco **Applicazioni di proprietà dell'azienda** e fare clic sull'applicazione AAD creata per l'app per le API ToDoListAPI di livello intermedio. Si tratta dell'app creata nell'esercitazione precedente, non in quella corrente.</span><span class="sxs-lookup"><span data-stu-id="b0350-228">In the Azure classic portal go back to the list of **Applications my company owns**, and click the AAD application that you created for the middle tier ToDoListAPI API app (the one you created in the previous tutorial, not the one you created in this tutorial).</span></span>
8. <span data-ttu-id="b0350-229">Fare clic sulla scheda **Configure** .</span><span class="sxs-lookup"><span data-stu-id="b0350-229">Click the **Configure** tab.</span></span>
9. <span data-ttu-id="b0350-230">Copiare il valore **ID client** e salvarlo in una posizione da cui poterlo recuperare più tardi.</span><span class="sxs-lookup"><span data-stu-id="b0350-230">Copy the **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="b0350-231">In **chiavi** selezionare **1 anno** dall'elenco a discesa **Seleziona durata**.</span><span class="sxs-lookup"><span data-stu-id="b0350-231">Under **keys**, select **1 year** from the **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="b0350-232">Fare clic su **Save**.</span><span class="sxs-lookup"><span data-stu-id="b0350-232">Click **Save**.</span></span>
    
     ![Generare una chiave dell'app](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="b0350-234">Copiare il valore chiave e salvarlo in una posizione da cui poterlo recuperare più tardi.</span><span class="sxs-lookup"><span data-stu-id="b0350-234">Copy the key value and save it someplace you can get it from later.</span></span>
    
     ![Copiare una nuova chiave dell'app](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-the-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="b0350-236">Configurare le impostazioni di Azure AD nell'ambiente di runtime dell'app per le API del livello intermedio</span><span class="sxs-lookup"><span data-stu-id="b0350-236">Configure Azure AD settings in the middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="b0350-237">Passare al [portale di Azure](https://portal.azure.com/)e quindi passare al pannello **App per le API** per l'app per le API che ospita il progetto TodoListAPI (livello intermedio).</span><span class="sxs-lookup"><span data-stu-id="b0350-237">Go to the [Azure portal](https://portal.azure.com/), and then navigate to the **API App** blade for the API app that hosts the TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="b0350-238">Fare clic su **Impostazioni > Impostazioni applicazione**.</span><span class="sxs-lookup"><span data-stu-id="b0350-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="b0350-239">Nella sezione **Impostazioni app** aggiungere le chiavi e i valori seguenti:</span><span class="sxs-lookup"><span data-stu-id="b0350-239">In the **App settings** section, add the following keys and values:</span></span>
   
   | <span data-ttu-id="b0350-240">**Chiave**</span><span class="sxs-lookup"><span data-stu-id="b0350-240">**Key**</span></span> | <span data-ttu-id="b0350-241">ida:Authority</span><span class="sxs-lookup"><span data-stu-id="b0350-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="b0350-242">**Valore**</span><span class="sxs-lookup"><span data-stu-id="b0350-242">**Value**</span></span> |<span data-ttu-id="b0350-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span><span class="sxs-lookup"><span data-stu-id="b0350-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="b0350-244">**Esempio**</span><span class="sxs-lookup"><span data-stu-id="b0350-244">**Example**</span></span> |<span data-ttu-id="b0350-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="b0350-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="b0350-246">**Chiave**</span><span class="sxs-lookup"><span data-stu-id="b0350-246">**Key**</span></span> | <span data-ttu-id="b0350-247">ida:ClientId</span><span class="sxs-lookup"><span data-stu-id="b0350-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="b0350-248">**Valore**</span><span class="sxs-lookup"><span data-stu-id="b0350-248">**Value**</span></span> |<span data-ttu-id="b0350-249">ID client dell'applicazione chiamante (livello intermedio - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="b0350-249">Client ID of the calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="b0350-250">**Esempio**</span><span class="sxs-lookup"><span data-stu-id="b0350-250">**Example**</span></span> |<span data-ttu-id="b0350-251">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="b0350-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="b0350-252">**Chiave**</span><span class="sxs-lookup"><span data-stu-id="b0350-252">**Key**</span></span> | <span data-ttu-id="b0350-253">ida:ClientSecret</span><span class="sxs-lookup"><span data-stu-id="b0350-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="b0350-254">**Valore**</span><span class="sxs-lookup"><span data-stu-id="b0350-254">**Value**</span></span> |<span data-ttu-id="b0350-255">Chiave app dell'applicazione chiamante (livello intermedio - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="b0350-255">App key of the calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="b0350-256">**Esempio**</span><span class="sxs-lookup"><span data-stu-id="b0350-256">**Example**</span></span> |<span data-ttu-id="b0350-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="b0350-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="b0350-258">**Chiave**</span><span class="sxs-lookup"><span data-stu-id="b0350-258">**Key**</span></span> | <span data-ttu-id="b0350-259">ida:Resource</span><span class="sxs-lookup"><span data-stu-id="b0350-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="b0350-260">**Valore**</span><span class="sxs-lookup"><span data-stu-id="b0350-260">**Value**</span></span> |<span data-ttu-id="b0350-261">ID client dell'applicazione chiamata (livello dati - ToDoListDataAPI)</span><span class="sxs-lookup"><span data-stu-id="b0350-261">Client ID of the called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="b0350-262">**Esempio**</span><span class="sxs-lookup"><span data-stu-id="b0350-262">**Example**</span></span> |<span data-ttu-id="b0350-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="b0350-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="b0350-264">**Nota**: per `ida:Resource`, assicurarsi di usare l'**ID client** dell'applicazione chiamata e non il relativo **URI ID App**.</span><span class="sxs-lookup"><span data-stu-id="b0350-264">**Note**: For `ida:Resource`, make sure you use the called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="b0350-265">`ida:ClientId` e `ida:Resource` sono valori diversi per questa esercitazione perché si usano applicazioni Azure AD diverse per il livello intermedio e il livello dati.</span><span class="sxs-lookup"><span data-stu-id="b0350-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for the middle tier and data tier.</span></span> <span data-ttu-id="b0350-266">Se si usa una sola applicazione Azure AD sia per l'app per le API chiamante che per l'app per le API protetta, usare lo stesso valore sia in `ida:ClientId` che in `ida:Resource`.</span><span class="sxs-lookup"><span data-stu-id="b0350-266">If you were using a single Azure AD application for the calling API app and the protected API app, you would use the same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="b0350-267">Il codice usa ConfigurationManager per ottenere questi valori, che quindi possono essere archiviati nel file Web.config del progetto o nell'ambiente di runtime di Azure.</span><span class="sxs-lookup"><span data-stu-id="b0350-267">The code uses ConfigurationManager to get these values, so they could be stored in the project's Web.config file or in the Azure runtime environment.</span></span> <span data-ttu-id="b0350-268">Mentre un'applicazione ASP.NET è in esecuzione nel servizio app di Azure, le impostazioni dell'ambiente eseguono automaticamente l'override delle impostazioni di Web.config.</span><span class="sxs-lookup"><span data-stu-id="b0350-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config.</span></span> <span data-ttu-id="b0350-269">Le impostazioni dell'ambiente in genere rappresentano un [modo più sicuro di archiviare le informazioni riservate rispetto a un file Web.config](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span><span class="sxs-lookup"><span data-stu-id="b0350-269">Environment settings are generally a [more secure way to store sensitive information compared to a Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="b0350-270">Fare clic su **Save**.</span><span class="sxs-lookup"><span data-stu-id="b0350-270">Click **Save**.</span></span>
   
    ![Fare clic su Salva.](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-the-application"></a><span data-ttu-id="b0350-272">Test dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="b0350-272">Test the application</span></span>
1. <span data-ttu-id="b0350-273">In un browser andare all'URL HTTPS dell'app Web front-end AngularJS.</span><span class="sxs-lookup"><span data-stu-id="b0350-273">In a browser go to the HTTPS URL of the AngularJS front end web app.</span></span>
2. <span data-ttu-id="b0350-274">Fare clic sulla scheda **To Do List** e accedere con le credenziali di un utente nel tenant di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b0350-274">Click the **To Do List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="b0350-275">Aggiungere alcune attività per verificare che l'applicazione funzioni.</span><span class="sxs-lookup"><span data-stu-id="b0350-275">Add to-do items to verify that the application is working.</span></span>
   
    ![Pagina To Do List](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="b0350-277">Se l'applicazione non funziona come previsto, controllare tutte le impostazioni immesse nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="b0350-277">If the application doesn't work as expected, double-check all of the settings you entered in the Azure portal.</span></span> <span data-ttu-id="b0350-278">Se si ritiene che tutte le impostazioni siano corrette, vedere la sezione [Risoluzione dei problemi](#troubleshooting) più avanti in questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="b0350-278">If all of the settings appear to be correct, see the [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-the-api-app-from-browser-access"></a><span data-ttu-id="b0350-279">Proteggere l'app per le API dall'accesso dal browser</span><span class="sxs-lookup"><span data-stu-id="b0350-279">Protect the API app from browser access</span></span>
<span data-ttu-id="b0350-280">Per questa esercitazione è stata creata un'applicazione Azure AD separata per l'app per le API ToDoListDataAPI (livello dati).</span><span class="sxs-lookup"><span data-stu-id="b0350-280">For this tutorial you created a separate Azure AD application for the ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="b0350-281">Come si è visto, quando il servizio app crea un'applicazione AAD, configura l'applicazione AAD per poter consentire all'utente di passare all'URL dell'app per le API in un browser ed eseguire l'accesso.</span><span class="sxs-lookup"><span data-stu-id="b0350-281">As you've seen, when App Service creates an AAD application, it configures the AAD application in a way that enables a user to go to the API app's URL in a browser and log on.</span></span> <span data-ttu-id="b0350-282">Ciò significa che anche un utente finale nel tenant di Azure AD può accedere all'API, non solo un'entità servizio.</span><span class="sxs-lookup"><span data-stu-id="b0350-282">That means it's possible for an end user in your Azure AD tenant, not just a service principal, to access the API.</span></span> 

<span data-ttu-id="b0350-283">Se si vuole impedire l'accesso dal browser senza scrivere codice nell'app per le API protetta, è possibile modificare l' **URL di risposta** nell'applicazione AAD in modo che sia diverso dall'URL di base dell'app per le API.</span><span class="sxs-lookup"><span data-stu-id="b0350-283">If you want to prevent browser access without writing any code in the protected API app, you can change the **Reply URL** in the AAD application so that it's different from the API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="b0350-284">Disabilitare l'accesso dal browser</span><span class="sxs-lookup"><span data-stu-id="b0350-284">Disable browser access</span></span>
1. <span data-ttu-id="b0350-285">Nella scheda **Configura** del portale classico per l'applicazione AAD creata per TodoListService modificare il valore del campo **URL di risposta** in modo che sia un URL valido, ma non l'URL dell'app per le API.</span><span class="sxs-lookup"><span data-stu-id="b0350-285">In the classic portal's **Configure** tab for the AAD application that was created for the TodoListService, change the value in the **Reply URL** field so that it is a valid URL but not the API app's URL.</span></span>
2. <span data-ttu-id="b0350-286">Fare clic su **Save**.</span><span class="sxs-lookup"><span data-stu-id="b0350-286">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="b0350-287">Verificare che non sia più possibile accedere dal browser</span><span class="sxs-lookup"><span data-stu-id="b0350-287">Verify browser access no longer works</span></span>
<span data-ttu-id="b0350-288">Prima si è verificato che sia possibile andare all'URL dell'app per le API da un browser accedendo con le credenziali di un singolo utente.</span><span class="sxs-lookup"><span data-stu-id="b0350-288">Earlier you verified that you can go to the API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="b0350-289">In questa sezione si verifica che non sia più possibile.</span><span class="sxs-lookup"><span data-stu-id="b0350-289">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="b0350-290">In una nuova finestra del browser passare nuovamente all'URL dell'app per le API.</span><span class="sxs-lookup"><span data-stu-id="b0350-290">In a new browser window, go to the URL of the API app again.</span></span>
2. <span data-ttu-id="b0350-291">Eseguire l'accesso quando viene richiesto di farlo.</span><span class="sxs-lookup"><span data-stu-id="b0350-291">Log in when prompted to do so.</span></span>
3. <span data-ttu-id="b0350-292">L'accesso ha esito positivo, ma viene visualizzata una pagina di errore.</span><span class="sxs-lookup"><span data-stu-id="b0350-292">Login succeeds but leads to an error page.</span></span>
   
    <span data-ttu-id="b0350-293">L'app AAD è stata configurata in modo che gli utenti nel tenant AAD non possano accedere all'API da un browser.</span><span class="sxs-lookup"><span data-stu-id="b0350-293">You've configured the AAD app so that users in the AAD tenant cannot log in and access the API from a browser.</span></span> <span data-ttu-id="b0350-294">È tuttavia possibile accedere all'app per le API usando un token per un'entità servizio, che è possibile verificare andando all'URL dell'app Web e aggiungendo altre attività.</span><span class="sxs-lookup"><span data-stu-id="b0350-294">You can still access the API app by using a service principal token, which you can verify by going to the web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-to-a-particular-service-principal"></a><span data-ttu-id="b0350-295">Limitare l'accesso a una particolare entità servizio</span><span class="sxs-lookup"><span data-stu-id="b0350-295">Restrict access to a particular service principal</span></span>
<span data-ttu-id="b0350-296">Attualmente qualsiasi chiamante possa ottenere un token per un'utente o un'entità servizio nel tenant di Azure AD può chiamare l'app per le API TodoListDataAPI (livello dati).</span><span class="sxs-lookup"><span data-stu-id="b0350-296">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call the TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="b0350-297">È possibile verificare che l'app per le API del livello dati accetti chiamate solo dall'app per le API TodoListAPI (livello intermedio) e solo da una particolare entità servizio.</span><span class="sxs-lookup"><span data-stu-id="b0350-297">You might want to make sure that the data tier API app only accepts calls from the TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="b0350-298">Per aggiungere queste restrizioni, aggiungere il codice per convalidare le attestazioni `appid` e `objectidentifier` nelle chiamate in arrivo.</span><span class="sxs-lookup"><span data-stu-id="b0350-298">You can add these restrictions by adding code to validate the `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="b0350-299">Per questa esercitazione, inserire il codice che convalida l'ID app e l'ID entità servizio direttamente nelle azioni del controller.</span><span class="sxs-lookup"><span data-stu-id="b0350-299">For this tutorial you put the code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="b0350-300">In alternativa, usare un attributo `Authorize` personalizzato o eseguire la convalida nelle sequenze di avvio (ad esempio, il middleware OWIN).</span><span class="sxs-lookup"><span data-stu-id="b0350-300">Alternatives are to use a custom `Authorize` attribute or to do this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="b0350-301">Per un esempio della seconda opzione, vedere [questa applicazione di esempio](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span><span class="sxs-lookup"><span data-stu-id="b0350-301">For an example of the latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="b0350-302">Apportare le modifiche seguenti al progetto TodoListDataAPI.</span><span class="sxs-lookup"><span data-stu-id="b0350-302">Make the following changes to the TodoListDataAPI project.</span></span>

1. <span data-ttu-id="b0350-303">Aprire il file *Controllers/TodoListController.cs* .</span><span class="sxs-lookup"><span data-stu-id="b0350-303">Open the *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="b0350-304">Rimuovere il commento dalle righe che impostano `trustedCallerClientId` e `trustedCallerServicePrincipalId`.</span><span class="sxs-lookup"><span data-stu-id="b0350-304">Uncomment the lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="b0350-305">Rimuovere il commento dal codice nel metodo CheckCallerId,</span><span class="sxs-lookup"><span data-stu-id="b0350-305">Uncomment the code in the CheckCallerId method.</span></span> <span data-ttu-id="b0350-306">che viene chiamato all'avvio di ogni metodo azione nel controller.</span><span class="sxs-lookup"><span data-stu-id="b0350-306">This method is called at the start of every action method in the controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "The appID or service principal ID is not the expected value." });
            }
        }
4. <span data-ttu-id="b0350-307">Ridistribuire il progetto ToDoListDataAPI nel servizio app di Azure.</span><span class="sxs-lookup"><span data-stu-id="b0350-307">Redeploy the ToDoListDataAPI project to Azure App Service.</span></span>
5. <span data-ttu-id="b0350-308">Nel browser passare all'URL HTTPS dell'app Web front-end AngularJS e nella home page fare clic sulla scheda **To Do List** .</span><span class="sxs-lookup"><span data-stu-id="b0350-308">In your browser, go to the AngularJS front end web app's HTTPS URL, and in the home page click the **To Do List** tab.</span></span>
   
    <span data-ttu-id="b0350-309">L'applicazione non funziona perché le chiamate al back-end hanno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="b0350-309">The application doesn't work because calls to the back end are failing.</span></span> <span data-ttu-id="b0350-310">Il nuovo codice sta controllando gli effettivi appid e objectidentifier, ma non ha ancora i valori corretti con cui confrontarli.</span><span class="sxs-lookup"><span data-stu-id="b0350-310">The new code is checking actual appid and objectidentifier but it doesn't yet have the correct values to check them against.</span></span> <span data-ttu-id="b0350-311">La console degli strumenti di sviluppo del browser segnala che il server restituisce un errore HTTP 401.</span><span class="sxs-lookup"><span data-stu-id="b0350-311">The browser Developer Tools Console reports that the server is returning an HTTP 401 error.</span></span>
   
    ![Errore nella console degli strumenti di sviluppo](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="b0350-313">Nei passaggi seguenti vengono configurati i valori previsti.</span><span class="sxs-lookup"><span data-stu-id="b0350-313">In the following steps you configure the expected values.</span></span>
6. <span data-ttu-id="b0350-314">Usando Azure AD PowerShell, ottenere il valore dell'entità servizio per l'applicazione Azure AD creata per il progetto TodoListWebApp.</span><span class="sxs-lookup"><span data-stu-id="b0350-314">Using Azure AD PowerShell, get the value of the service principal for the Azure AD application that you created for the TodoListWebApp project.</span></span>
   
    <span data-ttu-id="b0350-315">a.</span><span class="sxs-lookup"><span data-stu-id="b0350-315">a.</span></span> <span data-ttu-id="b0350-316">Per istruzioni su come installare Azure PowerShell e connettersi alla sottoscrizione, vedere [Uso di Azure PowerShell con Azure Resource Manager](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="b0350-316">For instructions on how to install Azure PowerShell and connect to your subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="b0350-317">b.</span><span class="sxs-lookup"><span data-stu-id="b0350-317">b.</span></span> <span data-ttu-id="b0350-318">Per ottenere un elenco di entità servizio, eseguire il comando `Login-AzureRmAccount` e quindi il comando `Get-AzureRmADServicePrincipal`.</span><span class="sxs-lookup"><span data-stu-id="b0350-318">To get a list of service principals, execute the `Login-AzureRmAccount` command and then the `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="b0350-319">c.</span><span class="sxs-lookup"><span data-stu-id="b0350-319">c.</span></span> <span data-ttu-id="b0350-320">Trovare il valore di objectid per l'entità servizio dell'applicazione TodoListAPI e salvarlo in una posizione da cui poterlo copiare più tardi.</span><span class="sxs-lookup"><span data-stu-id="b0350-320">Find the objectid for the service principal of the TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="b0350-321">Nel portale di Azure passare al pannello App per le API dell'app per le API in cui è stato distribuito il progetto ToDoListDataAPI.</span><span class="sxs-lookup"><span data-stu-id="b0350-321">In the Azure portal, navigate to the API app blade for the API app that you deployed the ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="b0350-322">Fare clic su **Impostazioni > Impostazioni applicazione**.</span><span class="sxs-lookup"><span data-stu-id="b0350-322">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="b0350-323">Nella sezione **Impostazioni app** aggiungere le chiavi e i valori seguenti:</span><span class="sxs-lookup"><span data-stu-id="b0350-323">In the **App settings** section, add the following keys and values:</span></span>
   
   | <span data-ttu-id="b0350-324">**Chiave**</span><span class="sxs-lookup"><span data-stu-id="b0350-324">**Key**</span></span> | <span data-ttu-id="b0350-325">todo:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="b0350-325">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="b0350-326">**Valore**</span><span class="sxs-lookup"><span data-stu-id="b0350-326">**Value**</span></span> |<span data-ttu-id="b0350-327">ID entità servizio dell'applicazione chiamante</span><span class="sxs-lookup"><span data-stu-id="b0350-327">Service principal id of calling application</span></span> |
   | <span data-ttu-id="b0350-328">**Esempio**</span><span class="sxs-lookup"><span data-stu-id="b0350-328">**Example**</span></span> |<span data-ttu-id="b0350-329">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="b0350-329">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="b0350-330">**Chiave**</span><span class="sxs-lookup"><span data-stu-id="b0350-330">**Key**</span></span> | <span data-ttu-id="b0350-331">todo:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="b0350-331">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="b0350-332">**Valore**</span><span class="sxs-lookup"><span data-stu-id="b0350-332">**Value**</span></span> |<span data-ttu-id="b0350-333">ID client dell'applicazione chiamante, copiato dall'applicazione Azure AD TodoListAPI</span><span class="sxs-lookup"><span data-stu-id="b0350-333">Client ID of calling application - copied from the TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="b0350-334">**Esempio**</span><span class="sxs-lookup"><span data-stu-id="b0350-334">**Example**</span></span> |<span data-ttu-id="b0350-335">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="b0350-335">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="b0350-336">Fare clic su **Save**.</span><span class="sxs-lookup"><span data-stu-id="b0350-336">Click **Save**.</span></span>
    
     ![Fare clic su Salva.](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="b0350-338">Nel browser tornare all'URL dell'app Web e nella home page fare clic sulla scheda **To Do List** .</span><span class="sxs-lookup"><span data-stu-id="b0350-338">In your browser, return to the web app's URL, and in the home page click the **To Do List** tab.</span></span>
    
     <span data-ttu-id="b0350-339">Ora l'applicazione funziona come previsto perché l'ID app chiamante attendibile e l'ID entità servizio hanno i valori previsti.</span><span class="sxs-lookup"><span data-stu-id="b0350-339">This time the application works as expected because the trusted caller app ID and service principal ID are the expected values.</span></span>
    
     ![Pagina To Do List](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-the-projects-from-scratch"></a><span data-ttu-id="b0350-341">Compilazione dei progetti da zero</span><span class="sxs-lookup"><span data-stu-id="b0350-341">Building the projects from scratch</span></span>
<span data-ttu-id="b0350-342">I due progetti API Web sono stati creati usando il modello di progetto **App per le API di Azure** e sostituendo il controller predefinito Values con un controller ToDoList.</span><span class="sxs-lookup"><span data-stu-id="b0350-342">The two Web API projects were created by using the **Azure API App** project template and replacing the default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="b0350-343">Per acquisire i token dell'entità servizio di Azure AD nel progetto ToDoListAPI, è stato installato il pacchetto NuGet [Active Directory Authentication Library (ADAL) per .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) .</span><span class="sxs-lookup"><span data-stu-id="b0350-343">For acquiring Azure AD service principal tokens in the ToDoListAPI project, the [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="b0350-344">Per informazioni su come creare un'applicazione a pagina singola AngularJS con un back-end API Web, ad esempio ToDoListAngular, vedere [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs)(Laboratorio pratico: creare un'applicazione a pagina singola con un'API Web e Angular.js).</span><span class="sxs-lookup"><span data-stu-id="b0350-344">For information about how to  create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="b0350-345">Per informazioni su come aggiungere il codice di autenticazione di Azure AD, vedere [Protezione di app AngularJS a singola pagina con Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="b0350-345">For information about how to add Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="b0350-346">Risoluzione dei problemi</span><span class="sxs-lookup"><span data-stu-id="b0350-346">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="b0350-347">Assicurarsi di non confondere ToDoListAPI (livello intermedio) e ToDoListDataAPI (livello dati).</span><span class="sxs-lookup"><span data-stu-id="b0350-347">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="b0350-348">Ad esempio, in questa esercitazione viene aggiunta l'autenticazione per l'app per le API di livello dati, **ma la chiave dell'app deve provenire dall'applicazione Azure AD creata per l'app per le API di livello intermedio**.</span><span class="sxs-lookup"><span data-stu-id="b0350-348">For example, in this tutorial you add authentication to the data tier API app, **but the app key must come from the Azure AD application that you created for the middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b0350-349">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="b0350-349">Next steps</span></span>
<span data-ttu-id="b0350-350">Questa è l'ultima esercitazione della serie sulle app per le API.</span><span class="sxs-lookup"><span data-stu-id="b0350-350">This is the last tutorial in the API Apps series.</span></span> 

<span data-ttu-id="b0350-351">Per altre informazioni su Azure Active Directory, vedere le risorse seguenti.</span><span class="sxs-lookup"><span data-stu-id="b0350-351">For more information about Azure Active Directory, see the following resources.</span></span>

* [<span data-ttu-id="b0350-352">Guida per sviluppatori Azure AD</span><span class="sxs-lookup"><span data-stu-id="b0350-352">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="b0350-353">Scenari per Azure AD</span><span class="sxs-lookup"><span data-stu-id="b0350-353">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="b0350-354">Esempi di Azure AD</span><span class="sxs-lookup"><span data-stu-id="b0350-354">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="b0350-355">L'esempio [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) è simile a quanto illustrato in questa esercitazione, ma non usa l'autenticazione del servizio app.</span><span class="sxs-lookup"><span data-stu-id="b0350-355">The [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar to what is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="b0350-356">Per informazioni su altre modalità di distribuzione di progetti Visual Studio in app per le API usando Visual Studio o [automatizzando la distribuzione](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) da un [sistema di controllo del codice sorgente](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), vedere [Distribuire l'app nel servizio app di Azure](../app-service-web/web-sites-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="b0350-356">For information about other ways to deploy Visual Studio projects to API apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How to deploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>

