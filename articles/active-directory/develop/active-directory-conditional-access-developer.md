---
title: linee guida per Azure Active Directory l'accesso condizionale aaaDeveloper | Documenti Microsoft
description: Scenari e linee guida per gli sviluppatori per l'accesso condizionale di Azure AD
services: active-directory
keywords: 
author: danieldobalian
manager: mbaldwin
editor: PatAltimore
ms.author: dadobali
ms.date: 07/19/2017
ms.assetid: 115bdab2-e1fd-4403-ac15-d4195e24ac95
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.openlocfilehash: 589393f5d084d64872b372d895dc889f300592bf
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="developer-guidance-for-azure-active-directory-conditional-access"></a><span data-ttu-id="81b71-103">Linee guida per gli sviluppatori per l'accesso condizionale di Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="81b71-103">Developer Guidance for Azure Active Directory Conditional Access</span></span>

<span data-ttu-id="81b71-104">Azure Active Directory (AD) offre diversi modi toosecure l'app e proteggere un servizio.</span><span class="sxs-lookup"><span data-stu-id="81b71-104">Azure Active Directory (AD) offers several ways toosecure your app and protect a service.</span></span>  <span data-ttu-id="81b71-105">Una di queste funzionalità uniche è l'accesso condizionale.</span><span class="sxs-lookup"><span data-stu-id="81b71-105">One of these unique features is conditional access.</span></span>  <span data-ttu-id="81b71-106">Accesso condizionale consente agli sviluppatori e i servizi di tooprotect i clienti aziendali in svariati modi, ad esempio:</span><span class="sxs-lookup"><span data-stu-id="81b71-106">Conditional access enables developers and enterprise customers tooprotect services in a multitude of ways including:</span></span>

* <span data-ttu-id="81b71-107">Autenticazione a più fattori</span><span class="sxs-lookup"><span data-stu-id="81b71-107">Multi-factor authentication</span></span>
* <span data-ttu-id="81b71-108">Consentire solo Intune registrati servizi specifici di dispositivi tooaccess</span><span class="sxs-lookup"><span data-stu-id="81b71-108">Allowing only Intune enrolled devices tooaccess specific services</span></span>
* <span data-ttu-id="81b71-109">Limitazione delle posizioni dell'utente e degli intervalli IP</span><span class="sxs-lookup"><span data-stu-id="81b71-109">Restricting user locations and IP ranges</span></span>

<span data-ttu-id="81b71-110">Per ulteriori informazioni sulle funzionalità complete di hello di accesso condizionale, vedere [accesso condizionale nel portale di Azure classico hello](../active-directory-conditional-access.md).</span><span class="sxs-lookup"><span data-stu-id="81b71-110">For more information on hello full capabilities of conditional access, see [Conditional access in hello Azure classic portal](../active-directory-conditional-access.md).</span></span> 

<span data-ttu-id="81b71-111">In questo articolo l'attenzione sul tipo di accesso condizionale significa toodevelopers creazione di applicazioni per Azure AD.</span><span class="sxs-lookup"><span data-stu-id="81b71-111">In this article, we focus on what conditional access means toodevelopers building apps for Azure AD.</span></span>  <span data-ttu-id="81b71-112">Si presuppone una conoscenza delle app a [tenant singolo](active-directory-integrating-applications.md) e [multi-tenant](active-directory-devhowto-multi-tenant-overview.md) e dei [modelli di autenticazione comuni](active-directory-authentication-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="81b71-112">It assumes knowledge of [single](active-directory-integrating-applications.md) and [multi-tenant](active-directory-devhowto-multi-tenant-overview.md) apps and [common authentication patterns](active-directory-authentication-scenarios.md).</span></span>

<span data-ttu-id="81b71-113">Verranno esaminate impatto hello di accedere alle risorse non è possibile controllare che siano applicati criteri di accesso condizionale.</span><span class="sxs-lookup"><span data-stu-id="81b71-113">We'll dive into hello impact of accessing resources you don't have control over that may have conditional access policies applied.</span></span>  <span data-ttu-id="81b71-114">Inoltre, è esplorare implicazioni hello di accesso condizionale nel flusso di hello, per conto di applicazioni web, l'accesso di Microsoft Graph hello e chiamare le API.</span><span class="sxs-lookup"><span data-stu-id="81b71-114">Moreover, we explore hello implications of conditional access in hello on-behalf-of flow, web apps, accessing hello Microsoft Graph, and calling APIs.</span></span>

## <a name="how-does-conditional-access-impact-an-app"></a><span data-ttu-id="81b71-115">Qual è l'impatto dell'accesso condizionale su un'app?</span><span class="sxs-lookup"><span data-stu-id="81b71-115">How does conditional access impact an app?</span></span>

### <a name="app-topologies-impacted"></a><span data-ttu-id="81b71-116">Topologie di app interessate</span><span class="sxs-lookup"><span data-stu-id="81b71-116">App topologies impacted</span></span>

<span data-ttu-id="81b71-117">Nella maggior parte dei casi, l'accesso condizionale non viene modificato il comportamento di un'app o richiede modifiche da Developer Edition hello.</span><span class="sxs-lookup"><span data-stu-id="81b71-117">In most common cases, conditional access does not change an app's behavior or requires any changes from hello developer.</span></span>  <span data-ttu-id="81b71-118">Solo in alcuni casi, quando un'app in modalità invisibile all'utente o indirettamente richiede un token per un servizio, un'app richiede problematiche"toohandle accesso condizionale" di modifiche del codice.</span><span class="sxs-lookup"><span data-stu-id="81b71-118">Only in certain cases when an app indirectly or silently requests a token for a service, an app requires code changes toohandle conditional access "challenges".</span></span>  <span data-ttu-id="81b71-119">L'operazione può essere semplice quanto l'esecuzione di una richiesta di accesso interattiva.</span><span class="sxs-lookup"><span data-stu-id="81b71-119">It may be as simple as performing an interactive sign-in request.</span></span> 

<span data-ttu-id="81b71-120">In particolare, hello negli scenari seguenti richiedono accesso condizionale di codice toohandle "problematiche":</span><span class="sxs-lookup"><span data-stu-id="81b71-120">Specifically, hello following scenarios require code toohandle conditional access "challenges":</span></span> 

* <span data-ttu-id="81b71-121">App che accedono hello Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="81b71-121">Apps accessing hello Microsoft Graph</span></span>
* <span data-ttu-id="81b71-122">Esecuzione di flusso di on-behalf-of hello App</span><span class="sxs-lookup"><span data-stu-id="81b71-122">Apps performing hello on-behalf-of flow</span></span>
* <span data-ttu-id="81b71-123">App che accedono a più servizi o risorse</span><span class="sxs-lookup"><span data-stu-id="81b71-123">Apps accessing multiple services/resources</span></span>
* <span data-ttu-id="81b71-124">App a pagina singola che usano ADAL.js</span><span class="sxs-lookup"><span data-stu-id="81b71-124">Single page apps using ADAL.js</span></span>

<span data-ttu-id="81b71-125">Criteri di accesso condizionale può essere applicato toohello app, ma può inoltre essere applicate tooa web API app accede.</span><span class="sxs-lookup"><span data-stu-id="81b71-125">Conditional access policies can be applied toohello app, but also can be applied tooa web API your app accesses.</span></span> <span data-ttu-id="81b71-126">altre informazioni sulle toolearn come tooconfigure un criterio di accesso condizionale, vedere [Introduzione a Azure Active Directory l'accesso condizionale](../active-directory-conditional-access-azuread-connected-apps.md#configure-per-application-access-rules).</span><span class="sxs-lookup"><span data-stu-id="81b71-126">toolearn more about how tooconfigure a conditional access policy, please see [Getting started with Azure Active Directory Conditional Access](../active-directory-conditional-access-azuread-connected-apps.md#configure-per-application-access-rules).</span></span>

<span data-ttu-id="81b71-127">A seconda dello scenario di hello, clienti aziendali possono applicare e rimuovere i criteri di accesso condizionale in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="81b71-127">Depending on hello scenario, an enterprise customer can apply and remove conditional access policies at any time.</span></span>  <span data-ttu-id="81b71-128">Per il funzionamento di toocontinue di app quando viene applicato un nuovo criterio, è necessario Gestione richiesta"tooimplement hello".</span><span class="sxs-lookup"><span data-stu-id="81b71-128">In order for your app toocontinue functioning when a new policy is applied, you need tooimplement hello "challenge" handling.</span></span> <span data-ttu-id="81b71-129">Hello seguenti esempi illustrata Gestione richiesta.</span><span class="sxs-lookup"><span data-stu-id="81b71-129">hello following examples illustrate challenge handling.</span></span> 

### <a name="conditional-access-examples"></a><span data-ttu-id="81b71-130">Esempi di accesso condizionale</span><span class="sxs-lookup"><span data-stu-id="81b71-130">Conditional access examples</span></span>

<span data-ttu-id="81b71-131">Alcuni scenari richiedono l'accesso condizionale toohandle modifiche al codice mentre altri funziona in modo corretto.</span><span class="sxs-lookup"><span data-stu-id="81b71-131">Some scenarios require code changes toohandle conditional access whereas others work as is.</span></span>  <span data-ttu-id="81b71-132">Ecco alcuni scenari con accesso condizionale toodo multi-factor authentication offre alcune informazioni dettagliate sulla differenza hello.</span><span class="sxs-lookup"><span data-stu-id="81b71-132">Here are a few scenarios using conditional access toodo multi-factor authentication that gives some insight into hello difference.</span></span>

* <span data-ttu-id="81b71-133">Si sta creando un'app iOS a tenant singolo e si applicano criteri di accesso condizionale.</span><span class="sxs-lookup"><span data-stu-id="81b71-133">You are building a single-tenant iOS app and apply a conditional access policy.</span></span>  <span data-ttu-id="81b71-134">app Hello accede un utente e non richiedere l'accesso tooan API.</span><span class="sxs-lookup"><span data-stu-id="81b71-134">hello app signs in a user and doesn't request access tooan API.</span></span>  <span data-ttu-id="81b71-135">Quando l'accesso dell'utente hello, criteri hello sono richiamato automaticamente e hello deve tooperform autenticazione a più fattori (MFA).</span><span class="sxs-lookup"><span data-stu-id="81b71-135">When hello user signs in, hello policy is automatically invoked and hello user needs tooperform multi-factor authentication (MFA).</span></span> 
* <span data-ttu-id="81b71-136">Si sta compilando un'applicazione web multi-tenant che usa hello Microsoft Graph tooaccess Exchange, tra gli altri servizi.</span><span class="sxs-lookup"><span data-stu-id="81b71-136">You are building a multi-tenant web app that uses hello Microsoft Graph tooaccess Exchange, among other services.</span></span>  <span data-ttu-id="81b71-137">Un cliente aziendale che usa questa app imposta criteri in SharePoint Online.</span><span class="sxs-lookup"><span data-stu-id="81b71-137">An enterprise customer who adopts this app sets a policy on SharePoint Online.</span></span>  <span data-ttu-id="81b71-138">Quando l'app web hello richiede un token di Microsoft Graph, viene applicato un criterio in qualsiasi Microsoft Service (in particolare i servizi che è possibile accedere tramite graph).</span><span class="sxs-lookup"><span data-stu-id="81b71-138">When hello web app requests a token for MS Graph, a policy on any Microsoft Service is applied (specifically services that can be accessed through graph).</span></span>  <span data-ttu-id="81b71-139">All'utente finale viene richiesta l'autenticazione a più fattori (MFA).</span><span class="sxs-lookup"><span data-stu-id="81b71-139">This end-user is prompted for MFA.</span></span> <span data-ttu-id="81b71-140">In caso di hello, per l'utente finale hello è connesso con un token valido, una richiesta"attestazioni" viene restituita toohello web app.</span><span class="sxs-lookup"><span data-stu-id="81b71-140">In hello case, hello end-user is signed in with valid tokens, a claims "challenge" is returned toohello web app.</span></span>  
* <span data-ttu-id="81b71-141">Si sta compilando un'applicazione nativa che utilizza un hello tooaccess servizio di livello intermedio Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="81b71-141">You are building a native app that uses a middle tier service tooaccess hello Microsoft Graph.</span></span>  <span data-ttu-id="81b71-142">Clienti aziendali società hello utilizzando questa applicazione si applicano un tooExchange criteri Online.</span><span class="sxs-lookup"><span data-stu-id="81b71-142">An enterprise customer at hello company using this app applies a policy tooExchange Online.</span></span>  <span data-ttu-id="81b71-143">Quando un utente finale accede, app nativa hello le richieste di livello intermedio toohello di accesso e invia il token di hello.</span><span class="sxs-lookup"><span data-stu-id="81b71-143">When an end-user signs in, hello native app requests access toohello middle tier and sends hello token.</span></span>  <span data-ttu-id="81b71-144">livello intermedio Hello esegue per conto di flusso toorequest accesso toohello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="81b71-144">hello middle tier performs on-behalf-of flow toorequest access toohello MS Graph.</span></span>  <span data-ttu-id="81b71-145">A questo punto, una richiesta"attestazioni" viene presentata toohello di livello intermedio.</span><span class="sxs-lookup"><span data-stu-id="81b71-145">At this point, a claims "challenge" is presented toohello middle tier.</span></span> <span data-ttu-id="81b71-146">livello intermedio Hello invia hello challenge toohello indietro app nativa, che deve toocomply con criteri di accesso condizionale hello.</span><span class="sxs-lookup"><span data-stu-id="81b71-146">hello middle tier sends hello challenge back toohello native app, which needs toocomply with hello conditional access policy.</span></span>

### <a name="complying-with-a-conditional-access-policy"></a><span data-ttu-id="81b71-147">Conformità ai criteri di accesso condizionale</span><span class="sxs-lookup"><span data-stu-id="81b71-147">Complying with a conditional access policy</span></span>

<span data-ttu-id="81b71-148">Per diverse topologie di app diversi, i criteri di accesso condizionale viene valutato quando viene stabilita la sessione hello.</span><span class="sxs-lookup"><span data-stu-id="81b71-148">For several different app topologies, a conditional access policy is evaluated when hello session is established.</span></span>  <span data-ttu-id="81b71-149">Come criteri di accesso condizionale opera su hello granularità App e servizi, notevolmente influenzate dalla punto hello in corrispondenza del quale viene richiamato in uno scenario di hello si sta tentando di tooaccomplish.</span><span class="sxs-lookup"><span data-stu-id="81b71-149">As a conditional access policy operates on hello granularity of apps and services, hello point at which it is invoked depends heavily on hello scenario you're trying tooaccomplish.</span></span>

<span data-ttu-id="81b71-150">Quando l'app prova tooaccess un servizio con un criterio di accesso condizionale, potrebbe verificarsi un problema di accesso condizionale.</span><span class="sxs-lookup"><span data-stu-id="81b71-150">When your app attempts tooaccess a service with a conditional access policy, it may encounter a conditional access challenge.</span></span>  <span data-ttu-id="81b71-151">Questo problema è codificato in hello `claims` parametro che viene fornito in una risposta da Azure AD o hello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="81b71-151">This challenge is encoded in hello `claims` parameter that comes in a response from Azure AD or hello Microsoft Graph.</span></span>  <span data-ttu-id="81b71-152">Ecco un esempio del parametro della richiesta:</span><span class="sxs-lookup"><span data-stu-id="81b71-152">Here's an example of this challenge parameter:</span></span> 

```
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
```

<span data-ttu-id="81b71-153">Gli sviluppatori possono richiedere questo problema e li aggiunge in un nuovo tooAzure richiesta Active Directory.</span><span class="sxs-lookup"><span data-stu-id="81b71-153">Developers can take this challenge and append it onto a new request tooAzure AD.</span></span>  <span data-ttu-id="81b71-154">Il passaggio di questo stato richiede hello dell'utente finale tooperform qualsiasi toocomply necessarie azione con i criteri di accesso condizionale hello.</span><span class="sxs-lookup"><span data-stu-id="81b71-154">Passing this state prompts hello end-user tooperform any action necessary toocomply with hello conditional access policy.</span></span> <span data-ttu-id="81b71-155">In seguito gli scenari di hello, vengono spiegate specifiche dell'errore hello e come tooextract hello parametro.</span><span class="sxs-lookup"><span data-stu-id="81b71-155">In hello following scenarios, specifics of hello error and how tooextract hello parameter are explained.</span></span> 

## <a name="scenarios"></a><span data-ttu-id="81b71-156">Scenari</span><span class="sxs-lookup"><span data-stu-id="81b71-156">Scenarios</span></span>

### <a name="prerequisites"></a><span data-ttu-id="81b71-157">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="81b71-157">Prerequisites</span></span>

<span data-ttu-id="81b71-158">L'accesso condizionale di Azure AD è una funzionalità inclusa in [Azure AD Premium](../active-directory-whatis.md#choose-an-edition).</span><span class="sxs-lookup"><span data-stu-id="81b71-158">Azure AD conditional access is a feature included in [Azure AD Premium](../active-directory-whatis.md#choose-an-edition).</span></span>  <span data-ttu-id="81b71-159">Maggiori informazioni sulle licenze di requisiti di hello [report di utilizzo senza licenza](../active-directory-conditional-access-unlicensed-usage-report.md).</span><span class="sxs-lookup"><span data-stu-id="81b71-159">You can learn more about licensing requirements in hello [unlicensed usage report](../active-directory-conditional-access-unlicensed-usage-report.md).</span></span>  <span data-ttu-id="81b71-160">Gli sviluppatori possono unirsi hello [Microsoft Developer Network](https://msdn.microsoft.com/dn308572.aspx), che include un toohello sottoscrizione gratuita Enterprise Mobility Suite, che include Azure AD Premium.</span><span class="sxs-lookup"><span data-stu-id="81b71-160">Developers can join hello [Microsoft Developer Network](https://msdn.microsoft.com/dn308572.aspx), which includes a free subscription toohello Enterprise Mobility Suite which includes Azure AD Premium.</span></span>

### <a name="considerations-for-specific-scenarios"></a><span data-ttu-id="81b71-161">Considerazioni per scenari specifici</span><span class="sxs-lookup"><span data-stu-id="81b71-161">Considerations for specific scenarios</span></span>

<span data-ttu-id="81b71-162">le seguenti informazioni solo Hello si applica in questi scenari di accesso condizionale:</span><span class="sxs-lookup"><span data-stu-id="81b71-162">hello following information only applies in these conditional access scenarios:</span></span>

* <span data-ttu-id="81b71-163">App che accedono hello Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="81b71-163">Apps accessing hello Microsoft Graph</span></span>
* <span data-ttu-id="81b71-164">Esecuzione di flusso di on-behalf-of hello App</span><span class="sxs-lookup"><span data-stu-id="81b71-164">Apps performing hello on-behalf-of flow</span></span>
* <span data-ttu-id="81b71-165">App che accedono a più servizi o risorse</span><span class="sxs-lookup"><span data-stu-id="81b71-165">Apps accessing multiple services/resources</span></span>
* <span data-ttu-id="81b71-166">App a pagina singola che usano ADAL.js</span><span class="sxs-lookup"><span data-stu-id="81b71-166">Single page apps using ADAL.js</span></span>

<span data-ttu-id="81b71-167">Nelle seguenti sezioni di hello, parleremo comuni scenari nei quali sono più complessi.</span><span class="sxs-lookup"><span data-stu-id="81b71-167">In hello following sections, we'll get into common scenarios in which are more complex.</span></span>  <span data-ttu-id="81b71-168">core Hello il principio di funzionamento è l'accesso condizionale criteri vengono valutati in fase di hello hello token viene richiesto per il servizio di hello che dispone di un criterio di accesso condizionale a meno che non si accede tramite hello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="81b71-168">hello core operating principle is conditional access policies are evaluated at hello time hello token is requested for hello service that has a conditional access policy applied unless it's being accessed through hello Microsoft Graph.</span></span>

### <a name="scenario-app-accessing-hello-microsoft-graph"></a><span data-ttu-id="81b71-169">Scenario: App l'accesso a Microsoft Graph hello</span><span class="sxs-lookup"><span data-stu-id="81b71-169">Scenario: App accessing hello Microsoft Graph</span></span>

<span data-ttu-id="81b71-170">In questo scenario, vengono illustrate le case hello quando un'app web richiede l'accesso toohello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="81b71-170">In this scenario, we walk through hello case when a web app requests access toohello Microsoft Graph.</span></span> <span data-ttu-id="81b71-171">criteri di accesso condizionale Hello potrebbero essere assegnati in questo caso tooSharePoint, Exchange o qualche altro servizio che si accede come carico di lavoro tramite hello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="81b71-171">hello conditional access policy in this case could be assigned tooSharePoint, Exchange, or some other service that is accessed as a workload through hello Microsoft Graph.</span></span>  <span data-ttu-id="81b71-172">In questo esempio si presuppone che i criteri di accesso condizionale siano applicati a SharePoint Online.</span><span class="sxs-lookup"><span data-stu-id="81b71-172">In this example, let's assume there's a conditional access policy on Sharepoint Online.</span></span>

![App l'accesso a diagramma di flusso Microsoft Graph hello](media/active-directory-conditional-access-developer/app-accessing-microsoft-graph-scenario.png)

<span data-ttu-id="81b71-174">app Hello richiede innanzitutto autorizzazione toohello Microsoft Graph che richiede l'accesso a un carico di lavoro a valle senza accesso condizionale.</span><span class="sxs-lookup"><span data-stu-id="81b71-174">hello app first requests authorization toohello Microsoft Graph which requires accessing a downstream workload without conditional access.</span></span>  <span data-ttu-id="81b71-175">richiesta di Hello venga eseguita senza richiamare tutti i criteri e app hello riceve i token di Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="81b71-175">hello request succeeds without invoking any policy and hello app receives tokens for Microsoft Graph.</span></span>  <span data-ttu-id="81b71-176">A questo punto, hello app potrebbe usare hello token di accesso in una richiesta di connessione per l'endpoint di hello richiesto.</span><span class="sxs-lookup"><span data-stu-id="81b71-176">At this point, hello app may use hello access token in a bearer request for hello endpoint requested.</span></span> <span data-ttu-id="81b71-177">A questo punto, hello app deve tooaccess un endpoint di Sharepoint Online di Microsoft Graph, ad esempio:`https://graph.microsoft.com/v1.0/me/mySite`</span><span class="sxs-lookup"><span data-stu-id="81b71-177">Now, hello app needs tooaccess a Sharepoint Online endpoint of Microsoft Graph, for example: `https://graph.microsoft.com/v1.0/me/mySite`</span></span>

<span data-ttu-id="81b71-178">applicazione Hello dispone già di un token valido per hello Microsoft Graph, pertanto è possibile eseguire nuova richiesta di hello senza viene rilasciato un nuovo token.</span><span class="sxs-lookup"><span data-stu-id="81b71-178">hello app already has a valid token for hello Microsoft Graph, so it can perform hello new request without being issued a new token.</span></span> <span data-ttu-id="81b71-179">Questa richiesta non riesce e viene generata una richiesta di attestazioni da Microsoft Graph sotto forma di hello di un HTTP 403-accesso negato con un ```WWW-Authenticate``` richiesta.</span><span class="sxs-lookup"><span data-stu-id="81b71-179">This request fails and a claims challenge is issued from Microsoft Graph in hello form of an HTTP 403 Forbidden with a ```WWW-Authenticate``` challenge.</span></span>
<span data-ttu-id="81b71-180">Di seguito è riportato un esempio di risposta hello:</span><span class="sxs-lookup"><span data-stu-id="81b71-180">Here's an example of hello response:</span></span> 

```
HTTP 403; Forbidden 
error=insufficient_claims
www-authenticate="Bearer realm="", authorization_uri="https://login.windows.net/common/oauth2/authorize", client_id="<GUID>", error=insufficient_claims, claims={"access_token":{"polids":{"essential":true,"values":["<GUID>"]}}}"
```

<span data-ttu-id="81b71-181">Hello attestazioni sfida è all'interno di hello ```WWW-Authenticate``` intestazione, che può essere analizzato tooextract hello attestazioni parametro per la richiesta successiva hello.</span><span class="sxs-lookup"><span data-stu-id="81b71-181">hello claims challenge is inside hello ```WWW-Authenticate``` header, which can be parsed tooextract hello claims parameter for hello next request.</span></span>  <span data-ttu-id="81b71-182">Una volta aggiunto toohello nuova richiesta, Azure AD conosce criteri di accesso condizionale hello tooevaluate quando l'accesso utente hello e app hello è ora compatibile con i criteri di accesso condizionale hello.</span><span class="sxs-lookup"><span data-stu-id="81b71-182">Once it's appended toohello new request, Azure AD knows tooevaluate hello conditional access policy when signing in hello user and hello app is now in compliance with hello conditional access policy.</span></span>  <span data-ttu-id="81b71-183">Ripetizione di hello richiesta toohello Sharepoint Online endpoint ha esito positivo.</span><span class="sxs-lookup"><span data-stu-id="81b71-183">Repeating hello request toohello Sharepoint Online endpoint succeeds.</span></span>

<span data-ttu-id="81b71-184">Per esempi di codice che illustrano come toohandle hello attestazioni di richiesta di verifica, fare riferimento toohello [nell'esempio di codice .NET Desktop](https://github.com/Azure-Samples/active-directory-dotnet-native-desktop) per .NET ADAL o hello [nell'esempio di codice per conto di](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca) per .NET ADAL.</span><span class="sxs-lookup"><span data-stu-id="81b71-184">For code samples that demonstrate how toohandle hello claims challenge, refer toohello [.NET Desktop code sample](https://github.com/Azure-Samples/active-directory-dotnet-native-desktop) for ADAL .NET or hello [On-behalf-of code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca) for ADAL .NET.</span></span>

### <a name="scenario-app-performing-hello-on-behalf-of-flow"></a><span data-ttu-id="81b71-185">Scenario: App esecuzione flusso hello di on-behalf-of</span><span class="sxs-lookup"><span data-stu-id="81b71-185">Scenario: App performing hello on-behalf-of flow</span></span>

<span data-ttu-id="81b71-186">In questo scenario, vengono illustrate le case hello in cui un'applicazione nativa chiama un'API o un servizio web.</span><span class="sxs-lookup"><span data-stu-id="81b71-186">In this scenario, we walk through hello case in which a native app calls a web service/API.</span></span>  <span data-ttu-id="81b71-187">A sua volta, questo servizio effettua [hello flusso "on-behalf-of"](active-directory-authentication-scenarios.md#application-types-and-scenarios) toocall un servizio a valle.</span><span class="sxs-lookup"><span data-stu-id="81b71-187">In turn, this service does [hello "on-behalf-of" flow](active-directory-authentication-scenarios.md#application-types-and-scenarios) toocall a downstream service.</span></span>  <span data-ttu-id="81b71-188">In questo caso, è stato applicato l'accesso condizionale criteri toohello downstream servizio (API Web 2) e si utilizza un'applicazione nativa anziché un'app/daemon del server.</span><span class="sxs-lookup"><span data-stu-id="81b71-188">In our case, we've applied our conditional access policy toohello downstream service (Web API 2) and are using a native app rather than a server/daemon app.</span></span> 

![App hello on-behalf-of diagramma di flusso di esecuzione](media/active-directory-conditional-access-developer/app-performing-on-behalf-of-scenario.png)

<span data-ttu-id="81b71-190">richiesta token Hello iniziale per l'API Web 1 non viene richiesta dell'utente finale hello multi-factor Authentication come API Web 1 non può raggiungere sempre hello downstream API.</span><span class="sxs-lookup"><span data-stu-id="81b71-190">hello initial token request for Web API 1 does not prompt hello end-user for multi-factor authentication as Web API 1 may not always hit hello downstream API.</span></span>  <span data-ttu-id="81b71-191">Una volta API Web 1 tenta toorequest un utente di token hello on-behalf-of per API Web 2, richiesta di hello ha esito negativo perché l'utente hello non ha sottoscritto con multi-factor authentication.</span><span class="sxs-lookup"><span data-stu-id="81b71-191">Once Web API 1 tries toorequest a token on-behalf-of hello user for Web API 2, hello request fails since hello user has not signed in with multi-factor authentication.</span></span>

<span data-ttu-id="81b71-192">Azure AD restituisce una risposta HTTP con alcuni dati interessanti:</span><span class="sxs-lookup"><span data-stu-id="81b71-192">Azure AD returns an HTTP response with some interesting data:</span></span> 

> [!NOTE]
> <span data-ttu-id="81b71-193">In questa istanza è una descrizione dell'errore di autenticazione a più fattori, ma è un'ampia gamma di `interaction_required` accessi tooconditional relativi possibili.</span><span class="sxs-lookup"><span data-stu-id="81b71-193">In this instance it's a multi-factor authentication error description, but there's a wide range of `interaction_required` possible pertaining tooconditional access.</span></span>  

```
HTTP 400; Bad Request 
error=interaction_required
error_description=AADSTS50076: Due tooa configuration change made by your administrator, or because you moved tooa new location, you must use multi-factor authentication tooaccess '<Web API 2 App/Client ID>'.
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
```

<span data-ttu-id="81b71-194">Nel nostro API Web 1, si intercetta l'errore hello `error=interaction_required`e inviare hello Indietro `claims` app desktop toohello di richiesta di verifica.</span><span class="sxs-lookup"><span data-stu-id="81b71-194">In our Web API 1, we catch hello error `error=interaction_required`, and send back hello `claims` challenge toohello desktop app.</span></span>  <span data-ttu-id="81b71-195">A questo punto, può creare un nuovo app desktop hello `acquireToken()` chiamare e accodare hello `claims`challenge come parametro di stringa di query aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="81b71-195">At that point, hello desktop app can make a new `acquireToken()` call and append hello `claims`challenge as an extra query string parameter.</span></span>  <span data-ttu-id="81b71-196">Questa nuova richiesta richiede l'autenticazione a più fattori di hello utente toodo e quindi inviare questo token nuovo indietro tooWeb 1 API e un flusso di on-behalf-of hello completo.</span><span class="sxs-lookup"><span data-stu-id="81b71-196">This new request requires hello user toodo multi-factor authentication and then send this new token back tooWeb API 1 and complete hello on-behalf-of flow.</span></span>

<span data-ttu-id="81b71-197">tootry out questo scenario, vedere il nostro [nell'esempio di codice .NET](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span><span class="sxs-lookup"><span data-stu-id="81b71-197">tootry out this scenario, see our [.NET code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span></span>  <span data-ttu-id="81b71-198">Viene illustrato come toopass hello richiesta di attestazioni da app nativa di API Web 1 toohello e creare una nuova richiesta all'interno di app client hello.</span><span class="sxs-lookup"><span data-stu-id="81b71-198">It demonstrates how toopass hello claims challenge back from Web API 1 toohello native app and construct a new request inside hello client app.</span></span> 

### <a name="scenario-app-accessing-multiple-services"></a><span data-ttu-id="81b71-199">Scenario: App che accede a più servizi</span><span class="sxs-lookup"><span data-stu-id="81b71-199">Scenario: App accessing multiple services</span></span>

<span data-ttu-id="81b71-200">In questo scenario, vengono illustrate le case hello in cui un'app web accede a due servizi di cui uno è assegnato un criterio di accesso condizionale.</span><span class="sxs-lookup"><span data-stu-id="81b71-200">In this scenario, we walk through hello case in which a web app accesses two services one of which has a conditional access policy assigned.</span></span>  <span data-ttu-id="81b71-201">A seconda della logica di app, potrebbe esistere un percorso in cui l'applicazione non richiede servizi web di accesso tooboth.</span><span class="sxs-lookup"><span data-stu-id="81b71-201">Depending on your app logic, there may exist a path in which your app does not require access tooboth web services.</span></span>  <span data-ttu-id="81b71-202">In questo scenario, in cui si richiesta un token di ordine di hello svolge un ruolo importante nell'esperienza utente finale di hello.</span><span class="sxs-lookup"><span data-stu-id="81b71-202">In this scenario, hello order in which you request a token plays an important role in hello end-user experience.</span></span>

<span data-ttu-id="81b71-203">Si supponga di avere i servizi Web A e B e che al servizio Web B siano applicati i criteri di accesso condizionale.</span><span class="sxs-lookup"><span data-stu-id="81b71-203">Let's assume we have web service A and B and web service B has our conditional access policy applied.</span></span>  <span data-ttu-id="81b71-204">Mentre la richiesta di autenticazione interattiva iniziale hello richiede il consenso per entrambi i servizi, criteri di accesso condizionale hello non sono necessario in tutti i casi.</span><span class="sxs-lookup"><span data-stu-id="81b71-204">While hello initial interactive auth request requires consent for both services, hello conditional access policy is not required in all cases.</span></span>  <span data-ttu-id="81b71-205">Se l'applicazione hello richiede un token per il servizio web B, quindi richiamare i criteri di hello e le successive richieste di servizio web viene eseguita anche come indicato di seguito.</span><span class="sxs-lookup"><span data-stu-id="81b71-205">If hello app requests a token for web service B, then hello policy is invoked and subsequent requests for web service A also succeeds as follows.</span></span>

![Diagramma di flusso per le app che accedono a più servizi](media/active-directory-conditional-access-developer/app-accessing-multiple-services-scenario.png)

<span data-ttu-id="81b71-207">In alternativa, se l'applicazione hello inizialmente richiede un token per il servizio web, dell'utente finale hello non richiama i criteri di accesso condizionale hello.</span><span class="sxs-lookup"><span data-stu-id="81b71-207">Alternatively, if hello app initially requests a token for web service A, hello end-user does not invoke hello conditional access policy.</span></span>  <span data-ttu-id="81b71-208">Questo consente allo sviluppatore di app di hello esperienza dell'utente finale di toocontrol hello e non forzare toobe criteri di accesso condizionale hello richiamato in tutti i casi.</span><span class="sxs-lookup"><span data-stu-id="81b71-208">This allows hello app developer toocontrol hello end-user experience and not force hello conditional access policy toobe invoked in all cases.</span></span> <span data-ttu-id="81b71-209">Hello complessa si verifica se app hello successivamente richiede un token per il servizio web B. A questo punto, per l'utente finale hello deve toocomply con criteri di accesso condizionale hello.</span><span class="sxs-lookup"><span data-stu-id="81b71-209">hello tricky case is if hello app subsequently requests a token for web service B. At this point, hello end-user needs toocomply with hello conditional access policy.</span></span>  <span data-ttu-id="81b71-210">Quando tenta di app hello troppo`acquireToken`, potrebbero essere generati hello (illustrato nel seguente diagramma hello) di errore seguente:</span><span class="sxs-lookup"><span data-stu-id="81b71-210">When hello app tries too`acquireToken`, it may generate hello following error (illustrated in hello following diagram):</span></span> 

```
HTTP 400; Bad Request
error=interaction_required
error_description=AADSTS50076: Due tooa configuration change made by your administrator, or because you moved tooa new location, you must use multi-factor authentication tooaccess '<Web API App/Client ID>'.
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
``` 

![App che accede a più servizi e richiede un nuovo token](media/active-directory-conditional-access-developer/app-accessing-multiple-services-new-token.png)

<span data-ttu-id="81b71-212">Se l'applicazione hello utilizza la libreria ADAL hello, un token di hello tooacquire errore viene sempre ripetuto in modo interattivo.</span><span class="sxs-lookup"><span data-stu-id="81b71-212">If hello app is using hello ADAL library, a failure tooacquire hello token is always retried interactively.</span></span>  <span data-ttu-id="81b71-213">Quando si verifica questa richiesta interattiva, degli utenti finali hello sono hello opportunità toocomply con accesso condizionale hello.</span><span class="sxs-lookup"><span data-stu-id="81b71-213">When this interactive request occurs, hello end-user has hello opportunity toocomply with hello conditional access.</span></span>  <span data-ttu-id="81b71-214">Questo è vero, a meno che non è richiesta hello un `AcquireTokenSilentAsync` o `PromptBehavior.Never` nel qual caso è necessario tooperform interattivo hello app ```AcquireToken``` richiesta toogive hello utilizzo finale hello opportunità toocomply con i criteri di hello.</span><span class="sxs-lookup"><span data-stu-id="81b71-214">This is true unless hello request is a `AcquireTokenSilentAsync` or `PromptBehavior.Never` in which case hello app needs tooperform an interactive ```AcquireToken``` request toogive hello end use hello opportunity toocomply with hello policy.</span></span> 

### <a name="scenario-single-page-app-spa-using-adaljs"></a><span data-ttu-id="81b71-215">Scenario: App a pagina singola che usa ADAL.js</span><span class="sxs-lookup"><span data-stu-id="81b71-215">Scenario: Single Page App (SPA) using ADAL.js</span></span>

<span data-ttu-id="81b71-216">In questo scenario, esaminare i case di hello quando si dispone di un'applicazione a pagina singola (SPA), ADAL.js toocall utilizzando un accesso condizionale protetti API web.</span><span class="sxs-lookup"><span data-stu-id="81b71-216">In this scenario, we walk through hello case when we have a single page app (SPA), using ADAL.js toocall a conditional access protected web API.</span></span>  <span data-ttu-id="81b71-217">Si tratta di un'architettura semplice ma dispone di alcuni aspetti correlati che è necessario tenere conto durante lo sviluppo dell'accesso condizionale toobe.</span><span class="sxs-lookup"><span data-stu-id="81b71-217">This is a simple architecture but has some nuances that need toobe taken into account when developing around conditional access.</span></span>

<span data-ttu-id="81b71-218">In ADAL.js ci sono poche funzioni che ottengono token: `login()`, `acquireToken(...)`, `acquireTokenPopup(…)` e `acquireTokenRedirect(…)`.</span><span class="sxs-lookup"><span data-stu-id="81b71-218">In ADAL.js, there are a few functions that obtain tokens: `login()`, `acquireToken(...)`, `acquireTokenPopup(…)`, and `acquireTokenRedirect(…)`.</span></span> 

* <span data-ttu-id="81b71-219">`login()` ottiene un token ID tramite una richiesta di accesso interattiva, ma non ottiene token di accesso per alcun servizio (inclusa un'API Web protetta con accesso condizionale).</span><span class="sxs-lookup"><span data-stu-id="81b71-219">`login()` obtains an ID token through an interactive sign-in request but does not obtain access tokens for any service (including a conditional access protected web API).</span></span>  
* <span data-ttu-id="81b71-220">`acquireToken(…)`può quindi essere utilizzato toosilently ottenere un token di accesso, ovvero l'interfaccia utente non viene visualizzato in nessuna circostanza.</span><span class="sxs-lookup"><span data-stu-id="81b71-220">`acquireToken(…)` can then be used toosilently obtain an access token meaning it does not show UI in any circumstance.</span></span>  
* <span data-ttu-id="81b71-221">`acquireTokenPopup(…)`e `acquireTokenRedirect(…)` vengono entrambi utilizzati toointeractively richiedere un token per una risorsa, ovvero presentano sempre l'interfaccia utente di accesso.</span><span class="sxs-lookup"><span data-stu-id="81b71-221">`acquireTokenPopup(…)` and `acquireTokenRedirect(…)` are both used toointeractively request a token for a resource meaning they always show sign-in UI.</span></span>

<span data-ttu-id="81b71-222">Quando un'app richiede un toocall token di accesso un'API Web, viene effettuato un tentativo un `acquireToken(…)`.</span><span class="sxs-lookup"><span data-stu-id="81b71-222">When an app needs an access token toocall a Web API, it attempts an `acquireToken(…)`.</span></span>  <span data-ttu-id="81b71-223">Se la sessione di hello token è scaduta o è necessario toocomply con un criterio di accesso condizionale, hello *acquireToken* funzione ha esito negativo e hello app utilizza `acquireTokenPopup()` o `acquireTokenRedirect()`.</span><span class="sxs-lookup"><span data-stu-id="81b71-223">If hello token session is expired or we need toocomply with a conditional access policy, then hello *acquireToken* function fails and hello app uses `acquireTokenPopup()` or `acquireTokenRedirect()`.</span></span>

![Diagramma di flusso per le app a pagina singola che usano ADAL](media/active-directory-conditional-access-developer/spa-using-adal-scenario.png)

<span data-ttu-id="81b71-225">Verrà ora esaminato un esempio con lo scenario di accesso condizionale.</span><span class="sxs-lookup"><span data-stu-id="81b71-225">Let's walk through an example with our conditional access scenario.</span></span>  <span data-ttu-id="81b71-226">per l'utente finale Hello sufficiente ottenuto nel sito hello e non dispone di una sessione.</span><span class="sxs-lookup"><span data-stu-id="81b71-226">hello end-user just landed on hello site and doesn’t have a session.</span></span>  <span data-ttu-id="81b71-227">Si esegue una chiamata a `login()` e si ottiene un token ID senza autenticazione a più fattori.</span><span class="sxs-lookup"><span data-stu-id="81b71-227">We perform a `login()` call, get an ID token without multi-factor authentication.</span></span>  <span data-ttu-id="81b71-228">Utente hello raggiunge quindi un pulsante che richiede hello app toorequest dati da un'API web.</span><span class="sxs-lookup"><span data-stu-id="81b71-228">Then hello user hits a button that requires hello app toorequest data from a web API.</span></span>  <span data-ttu-id="81b71-229">app Hello tenta toodo un `acquireToken()` chiamata ma ha esito negativo poiché utente hello non ha eseguito l'autenticazione a più fattori ancora e deve toocomply con criteri di accesso condizionale hello.</span><span class="sxs-lookup"><span data-stu-id="81b71-229">hello app tries toodo an `acquireToken()` call but fails since hello user has not performed multi-factor authentication yet and needs toocomply with hello conditional access policy.</span></span>

<span data-ttu-id="81b71-230">Azure AD invia Indietro hello risposta HTTP seguenti:</span><span class="sxs-lookup"><span data-stu-id="81b71-230">Azure AD sends back hello following HTTP response:</span></span> 

```
HTTP 400; Bad Request 
error=interaction_required
error_description=AADSTS50076: Due tooa configuration change made by your administrator, or because you moved tooa new location, you must use multi-factor authentication tooaccess '<Web API App/Client ID>'.
```

<span data-ttu-id="81b71-231">L'app deve hello toocatch `error=interaction_required`.</span><span class="sxs-lookup"><span data-stu-id="81b71-231">Our app needs toocatch hello `error=interaction_required`.</span></span>  <span data-ttu-id="81b71-232">Hello applicazione può quindi utilizzare uno `acquireTokenPopup()` o `acquireTokenRedirect()` hello nella stessa risorsa.</span><span class="sxs-lookup"><span data-stu-id="81b71-232">hello application can then use either `acquireTokenPopup()` or `acquireTokenRedirect()` on hello same resource.</span></span>  <span data-ttu-id="81b71-233">utente Hello è forzato toodo un'autenticazione a più fattori.</span><span class="sxs-lookup"><span data-stu-id="81b71-233">hello user is forced toodo a multi-factor authentication.</span></span> <span data-ttu-id="81b71-234">Al termine dell'autenticazione a più fattori hello utente hello, app hello viene rilasciato un nuovo token di accesso per hello la risorsa richiesta.</span><span class="sxs-lookup"><span data-stu-id="81b71-234">After hello user completes hello multi-factor authentication, hello app is issued a fresh access token for hello requested resource.</span></span>

<span data-ttu-id="81b71-235">tootry out questo scenario, vedere il nostro [nell'esempio di codice per conto di SPA JS](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span><span class="sxs-lookup"><span data-stu-id="81b71-235">tootry out this scenario, see our [JS SPA On-behalf-of code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span></span>  <span data-ttu-id="81b71-236">In questo esempio di codice Usa Criteri di accesso condizionale hello e web API è registrato in precedenza con un toodemonstrate SPA JS questo scenario.</span><span class="sxs-lookup"><span data-stu-id="81b71-236">This code sample uses hello conditional access policy and web API you registered earlier with a JS SPA toodemonstrate this scenario.</span></span> <span data-ttu-id="81b71-237">Viene illustrato come tooproperly handle hello crediti affrontare e ottenere un token di accesso che può essere utilizzato per l'API Web.</span><span class="sxs-lookup"><span data-stu-id="81b71-237">It shows how tooproperly handle hello claims challenge and get an access token that can be used for your Web API.</span></span> <span data-ttu-id="81b71-238">In alternativa, hello estrazione generale [nell'esempio di codice Angular.js](https://github.com/Azure-Samples/active-directory-angularjs-singlepageapp) per informazioni aggiuntive su un SPA Angular</span><span class="sxs-lookup"><span data-stu-id="81b71-238">Alternatively, checkout hello general [Angular.js code sample](https://github.com/Azure-Samples/active-directory-angularjs-singlepageapp) for guidance on an Angular SPA</span></span>


## <a name="see-also"></a><span data-ttu-id="81b71-239">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="81b71-239">See also</span></span>

* <span data-ttu-id="81b71-240">toolearn ulteriori informazioni su funzionalità hello, vedere [accesso condizionale di Azure AD](../active-directory-conditional-access.md).</span><span class="sxs-lookup"><span data-stu-id="81b71-240">toolearn more about hello capabilities, see [Conditional Access in Azure AD](../active-directory-conditional-access.md).</span></span>
* <span data-ttu-id="81b71-241">Per altri esempi di codice di Azure AD, vedere il [repository GitHub di esempi di codice](https://github.com/azure-samples?utf8=%E2%9C%93&q=active-directory).</span><span class="sxs-lookup"><span data-stu-id="81b71-241">For more Azure AD code samples, see [Github Repo of Code Samples](https://github.com/azure-samples?utf8=%E2%9C%93&q=active-directory).</span></span> 
* <span data-ttu-id="81b71-242">Per ulteriori informazioni su hello la documentazione di riferimento hello ADAL SDK e di accesso, vedere [Guida libreria](active-directory-authentication-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="81b71-242">For more info on hello ADAL SDK's and access hello reference documentation, see [library guide](active-directory-authentication-libraries.md).</span></span>
* <span data-ttu-id="81b71-243">toolearn ulteriori informazioni su scenari multi-tenant, vedere [come toosign utenti usando il modello di multi-tenant hello](active-directory-devhowto-multi-tenant-overview.md).</span><span class="sxs-lookup"><span data-stu-id="81b71-243">toolearn more about multi-tenant scenarios, see [How toosign in users using hello multi-tenant pattern](active-directory-devhowto-multi-tenant-overview.md).</span></span>
