---
title: "Come compilare un'app che può consentire l'accesso a qualsiasi utente di Azure AD | Documentazione Microsoft"
description: Istruzioni dettagliate per la creazione di un'applicazione che consenta a un utente di accedere da qualsiasi tenant Azure Active Directory, nota anche come applicazione multi-tenant.
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 35af95cb-ced3-46ad-b01d-5d2f6fd064a3
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/26/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: f1c79fa7e3b0e160487b5941741f6a6c677c6b81
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-sign-in-any-azure-active-directory-ad-user-using-the-multi-tenant-application-pattern"></a><span data-ttu-id="b7ab2-103">Come consentire l'accesso a qualsiasi utente di Azure Active Directory (AD) usando il modello di applicazione multi-tenant</span><span class="sxs-lookup"><span data-stu-id="b7ab2-103">How to sign in any Azure Active Directory (AD) user using the multi-tenant application pattern</span></span>
<span data-ttu-id="b7ab2-104">Se si offre un'applicazione Software as a Service a molte organizzazioni, è possibile configurare l'applicazione in modo da consentire accessi da qualsiasi tenant di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-104">If you offer a Software as a Service application to many organizations, you can configure your application to accept sign-ins from any Azure AD tenant.</span></span>  <span data-ttu-id="b7ab2-105">In Azure AD questa operazione viene definita impostazione dell'applicazione multi-tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-105">In Azure AD this is called making your application multi-tenant.</span></span>  <span data-ttu-id="b7ab2-106">Gli utenti in qualsiasi tenant Azure AD saranno in grado di accedere all'applicazione dopo il consenso ad usare il loro account con l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-106">Users in any Azure AD tenant will be able to sign in to your application after consenting to use their account with your application.</span></span>  

<span data-ttu-id="b7ab2-107">Se si dispone di un'applicazione esistente che ha un proprio sistema di account, o supporta altri tipi di accesso da altri provider di cloud, l'aggiunta dell'accesso di Azure AD da un qualsiasi tenant è semplice.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-107">If you have an existing application that has its own account system, or supports other kinds of sign-in from other cloud providers, adding Azure AD sign-in from any tenant is simple.</span></span> <span data-ttu-id="b7ab2-108">Registrare l'app, aggiungere il codice di accesso tramite OAuth2, OpenID Connect o SAML e inserire un pulsante "Accedi con Microsoft" all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-108">Just register your app, add sign-in code via OAuth2, OpenID Connect, or SAML, and put a "Sign In with Microsoft" button on your application.</span></span> <span data-ttu-id="b7ab2-109">Fare clic sul pulsante seguente per ottenere altre informazioni sulla personalizzazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-109">Click the following button to learn more about branding your application.</span></span>

<span data-ttu-id="b7ab2-110">[![Pulsante di accesso][AAD-Sign-In]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="b7ab2-110">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="b7ab2-111">Questo articolo presuppone che l'utente abbia già familiarità con la creazione di un'applicazione single-tenant per Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-111">This article assumes you’re already familiar with building a single tenant application for Azure AD.</span></span>  <span data-ttu-id="b7ab2-112">In caso contrario, tornare alla [home page della Guida per sviluppatori][AAD-Dev-Guide] e provare una delle procedure di avvio rapido.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-112">If you’re not, head back up to the [developer guide homepage][AAD-Dev-Guide] and try one of our quick starts!</span></span>

<span data-ttu-id="b7ab2-113">Quattro semplici passaggi consentono di convertire l'applicazione in un'applicazione multi-tenant di Azure AD:</span><span class="sxs-lookup"><span data-stu-id="b7ab2-113">There are four simple steps to convert your application into an Azure AD multi-tenant app:</span></span>

1. <span data-ttu-id="b7ab2-114">Aggiornare la registrazione dell'applicazione in modo che sia multi-tenant</span><span class="sxs-lookup"><span data-stu-id="b7ab2-114">Update your application registration to be multi-tenant</span></span>
2. <span data-ttu-id="b7ab2-115">Aggiornare il codice per l'invio delle richieste all'endpoint /common</span><span class="sxs-lookup"><span data-stu-id="b7ab2-115">Update your code to send requests to the /common endpoint</span></span> 
3. <span data-ttu-id="b7ab2-116">Aggiornare il codice per gestire più valori dell'autorità di certificazione</span><span class="sxs-lookup"><span data-stu-id="b7ab2-116">Update your code to handle multiple issuer values</span></span>
4. <span data-ttu-id="b7ab2-117">Informarsi sul consenso dell'utente e dell'amministratore e apportare le modifiche appropriate al codice</span><span class="sxs-lookup"><span data-stu-id="b7ab2-117">Understand user and admin consent and make appropriate code changes</span></span>

<span data-ttu-id="b7ab2-118">Esaminiamo in dettaglio ogni passaggio.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-118">Let’s look at each step in detail.</span></span> <span data-ttu-id="b7ab2-119">È anche possibile passare direttamente a [questo elenco di esempi multi-tenant][AAD-Samples-MT].</span><span class="sxs-lookup"><span data-stu-id="b7ab2-119">You can also jump straight to [this list of multi-tenant samples][AAD-Samples-MT].</span></span>

## <a name="update-registration-to-be-multi-tenant"></a><span data-ttu-id="b7ab2-120">Aggiornare la registrazione in modo che sia multi-tenant</span><span class="sxs-lookup"><span data-stu-id="b7ab2-120">Update registration to be multi-tenant</span></span>
<span data-ttu-id="b7ab2-121">Per impostazione predefinita, le registrazioni di API o app Web in Azure AD sono single-tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-121">By default, web app/API registrations in Azure AD are single tenant.</span></span>  <span data-ttu-id="b7ab2-122">È possibile rendere la registrazione multi-tenant individuando l'opzione corrispondente nella pagina delle proprietà della registrazione dell'applicazione nel [portale di Azure][AZURE-portal] e impostandola su "Sì".</span><span class="sxs-lookup"><span data-stu-id="b7ab2-122">You can make your registration multi-tenant by finding the “Multi-Tenanted” switch on the properties page of your application registration in the [Azure portal][AZURE-portal] and setting it to “Yes”.</span></span>

<span data-ttu-id="b7ab2-123">Si noti anche che, per poter rendere un'applicazione multi-tenant in Azure AD, l'URI dell'ID app dell'applicazione deve essere univoco a livello globale.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-123">Also note, before an application can be made multi-tenant, Azure AD requires the App ID URI of the application to be globally unique.</span></span> <span data-ttu-id="b7ab2-124">L'URI dell'ID App è uno dei modi in cui un'applicazione viene identificata nei messaggi di protocollo.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-124">The App ID URI is one of the ways an application is identified in protocol messages.</span></span>  <span data-ttu-id="b7ab2-125">Per un'applicazione single-tenant, è sufficiente che l'URI dell'ID App sia univoco all'interno del tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-125">For a single tenant application, it is sufficient for the App ID URI to be unique within that tenant.</span></span>  <span data-ttu-id="b7ab2-126">Per un'applicazione multi-tenant, è necessario che sia univoco a livello globale in modo da Azure AD possa trovare l'applicazione in tutti i tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-126">For a multi-tenant application, it must be globally unique so Azure AD can find the application across all tenants.</span></span>  <span data-ttu-id="b7ab2-127">L'univocità globale viene applicata richiedendo che l'URI dell'ID App abbia un nome host corrispondente a un dominio verificato del tenant di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-127">Global uniqueness is enforced by requiring the App ID URI to have a host name that matches a verified domain of the Azure AD tenant.</span></span>  <span data-ttu-id="b7ab2-128">Ad esempio, se il nome del tenant è contoso.onmicrosoft.com, l'URI ID app sarà `https://contoso.onmicrosoft.com/myapp`.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-128">For example, if the name of your tenant was contoso.onmicrosoft.com then a valid App ID URI would be `https://contoso.onmicrosoft.com/myapp`.</span></span>  <span data-ttu-id="b7ab2-129">Se il tenant ha un dominio verificato `contoso.com`, l'URI ID app valido sarà `https://contoso.com/myapp`.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-129">If your tenant had a verified domain of `contoso.com`, then a valid App ID URI would also be `https://contoso.com/myapp`.</span></span>  <span data-ttu-id="b7ab2-130">L'impostazione di un'applicazione come multi-tenant avrà esito negativo se l'URI dell'ID App non segue questo modello.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-130">Setting an application as multi-tenant will fail if the App ID URI doesn’t follow this pattern.</span></span>

<span data-ttu-id="b7ab2-131">Per impostazione predefinita, le registrazioni client native sono multi-tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-131">Native client registrations are multi-tenant by default.</span></span>  <span data-ttu-id="b7ab2-132">Non è necessario intraprendere alcuna azione per rendere multi-tenant una registrazione nativa dell'applicazione client.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-132">You don’t need to take any action to make a native client application registration multi-tenant.</span></span>

## <a name="update-your-code-to-send-requests-to-common"></a><span data-ttu-id="b7ab2-133">Aggiornare il codice per l'invio delle richieste all'endpoint /common</span><span class="sxs-lookup"><span data-stu-id="b7ab2-133">Update your code to send requests to /common</span></span>
<span data-ttu-id="b7ab2-134">In un'applicazione single-tenant le richieste di accesso vengono inviate all'endpoint di accesso del tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-134">In a single tenant application, sign-in requests are sent to the tenant’s sign-in endpoint.</span></span> <span data-ttu-id="b7ab2-135">Ad esempio, per contoso.onmicrosoft.com l'endpoint sarà:</span><span class="sxs-lookup"><span data-stu-id="b7ab2-135">For example, for contoso.onmicrosoft.com the endpoint would be:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="b7ab2-136">Le richieste inviate all'endpoint del tenant possono eseguire l'accesso degli utenti (o guest) in questo tenant alle applicazioni in questo tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-136">Requests sent to a tenant’s endpoint can sign in users (or guests) in that tenant to applications in that tenant.</span></span>  <span data-ttu-id="b7ab2-137">Con un'applicazione multi-tenant, l'applicazione non determina in anticipo il tenant di provienienza dell'utente, pertanto non è possibile inviare richieste all'endpoint del tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-137">With a multi-tenant application, the application doesn’t know up front what tenant the user is from, so you can’t send requests to a tenant’s endpoint.</span></span>  <span data-ttu-id="b7ab2-138">Al contrario, le richieste vengono inviate a un endpoint che esegue il multiplexing tra tutti i tenant di Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="b7ab2-138">Instead, requests are sent to an endpoint that multiplexes across all Azure AD tenants:</span></span>

    https://login.microsoftonline.com/common

<span data-ttu-id="b7ab2-139">Quando Azure AD riceve una richiesta sull'endpoint /common, consente l'accesso dell'utente e quindi individua il tenant di provenienza dell'utente.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-139">When Azure AD receives a request on the /common endpoint, it signs the user in and as a consequence discovers which tenant the user is from.</span></span>  <span data-ttu-id="b7ab2-140">L'endpoint /common funziona con tutti i protocolli di autenticazione supportati da Azure AD: OpenID Connect, OAuth 2.0, SAML 2.0 e WS-Federation.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-140">The /common endpoint works with all of the authentication protocols supported by Azure AD:  OpenID Connect, OAuth 2.0, SAML 2.0, and WS-Federation.</span></span>

<span data-ttu-id="b7ab2-141">La risposta di accesso all'applicazione di accesso contiene un token che rappresenta l'utente.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-141">The sign-in response to the application then contains a token representing the user.</span></span>  <span data-ttu-id="b7ab2-142">Il valore dell'autorità di certificazione nel token indica a un'applicazione il tenant di provenienza dell'utente.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-142">The issuer value in the token tells an application what tenant the user is from.</span></span>  <span data-ttu-id="b7ab2-143">Quando l'endpoint /common restituisce una risposta, il valore dell'autorità di certificazione nel token corrisponderà al tenant dell'utente.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-143">When a response returns from the /common endpoint, the issuer value in the token will correspond to the user’s tenant.</span></span>  <span data-ttu-id="b7ab2-144">È importante notare che l'endpoint /common non è un tenant o un'autorità di certificazione, ma è semplicemente un multiplexer.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-144">It’s important to note the /common endpoint is not a tenant and is not an issuer, it’s just a multiplexer.</span></span>  <span data-ttu-id="b7ab2-145">Quando si usa l'endpoint /common, è necessario aggiornare la logica dell'applicazione per la convalida dei token in modo da tenerne conto.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-145">When using /common, the logic in your application to validate tokens needs to be updated to take this into account.</span></span> 

<span data-ttu-id="b7ab2-146">Come indicato in precedenza, le applicazioni multi-tenant devono offrire anche un'esperienza di accesso coerente per gli utenti, adeguandosi alle linee guida di personalizzazione delle applicazioni di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-146">As mentioned earlier, multi-tenant applications should also provide a consistent sign-in experience for users, following the Azure AD application branding guidelines.</span></span> <span data-ttu-id="b7ab2-147">Fare clic sul pulsante seguente per ottenere altre informazioni sulla personalizzazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-147">Click the following button to learn more about branding your application.</span></span>

<span data-ttu-id="b7ab2-148">[![Pulsante di accesso][AAD-Sign-In]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="b7ab2-148">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="b7ab2-149">È ora possibile esaminare in modo più dettagliato l'uso dell'endpoint /common e l'implementazione del codice.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-149">Let’s take a look at the use of the /common endpoint and your code implementation in more detail.</span></span>

## <a name="update-your-code-to-handle-multiple-issuer-values"></a><span data-ttu-id="b7ab2-150">Aggiornare il codice per gestire più valori dell'autorità di certificazione</span><span class="sxs-lookup"><span data-stu-id="b7ab2-150">Update your code to handle multiple issuer values</span></span>
<span data-ttu-id="b7ab2-151">Le applicazioni Web e le API Web ricevono e convalidano i token da Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-151">Web applications and web APIs receive and validate tokens from Azure AD.</span></span>  

> [!NOTE]
> <span data-ttu-id="b7ab2-152">Le applicazioni client native richiedono e ricevono i token da Azure AD e li inviano alle API in cui vengono convalidati.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-152">While native client applications request and receive tokens from Azure AD, they do so to send them to APIs, where they are validated.</span></span>  <span data-ttu-id="b7ab2-153">Le applicazioni native non convalidano i token e devono gestirli come opachi.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-153">Native applications do not validate tokens and must treat them as opaque.</span></span>
> 
> 

<span data-ttu-id="b7ab2-154">Passiamo ora al modo in cui un'applicazione convalida i token ricevuti da Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-154">Let’s look at how an application validates tokens it receives from Azure AD.</span></span>  <span data-ttu-id="b7ab2-155">Un'applicazione single-tenant prende in genere un valore dell'endpoint come:</span><span class="sxs-lookup"><span data-stu-id="b7ab2-155">A single tenant application will normally take an endpoint value like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="b7ab2-156">e lo usa per creare un URL di metadati, in questo caso OpenID Connect, come:</span><span class="sxs-lookup"><span data-stu-id="b7ab2-156">and use it to construct a metadata URL (in this case, OpenID Connect) like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com/.well-known/openid-configuration

<span data-ttu-id="b7ab2-157">per scaricare due informazioni critiche che vengono usate per convalidare i token: il valore dell'autorità di certificazione e le chiavi di firma del tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-157">to download two critical pieces of information that are used to validate tokens:  the tenant’s signing keys and issuer value.</span></span>  <span data-ttu-id="b7ab2-158">Ogni tenant di Azure AD ha un valore univoco dell'autorità di certificazione del formato:</span><span class="sxs-lookup"><span data-stu-id="b7ab2-158">Each Azure AD tenant has a unique issuer value of the form:</span></span>

    https://sts.windows.net/31537af4-6d77-4bb9-a681-d2394888ea26/

<span data-ttu-id="b7ab2-159">dove il valore GUID è la versione sicura di ridenominazione dell'ID tenant del tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-159">where the GUID value is the rename-safe version of the tenant ID of the tenant.</span></span>  <span data-ttu-id="b7ab2-160">Se si fa clic sul collegamento dei metadati precedente per `contoso.onmicrosoft.com`, è possibile visualizzare il valore dell'autorità di certificazione nel documento.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-160">If you click on the preceding metadata link for `contoso.onmicrosoft.com`, you can see this issuer value in the document.</span></span>

<span data-ttu-id="b7ab2-161">Quando un'applicazione single-tenant convalida un token, controlla la firma del token con le chiavi di firma del documento di metadati.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-161">When a single tenant application validates a token, it checks the signature of the token against the signing keys from the metadata document.</span></span> <span data-ttu-id="b7ab2-162">In questo modo è possibile verificare che il valore dell'autorità di certificazione nel token corrisponda a quello che è stato trovato nel documento di metadati.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-162">This allows it to make sure the issuer value in the token matches the one that was found in the metadata document.</span></span>

<span data-ttu-id="b7ab2-163">Poiché l'endpoint /common non corrisponde a un tenant e non è un'autorità di certificazione, il valore dell'autorità di certificazione nei metadati per /common ha un URL basato su modello anziché un valore effettivo:</span><span class="sxs-lookup"><span data-stu-id="b7ab2-163">Since the /common endpoint doesn’t correspond to a tenant and isn’t an issuer, when you examine the issuer value in the metadata for /common it has a templated URL instead of an actual value:</span></span>

    https://sts.windows.net/{tenantid}/

<span data-ttu-id="b7ab2-164">Un'applicazione multi-tenant non può quindi convalidare i token semplicemente confrontando il valore dell'autorità di certificazione nei metadati con il valore `issuer` nel token.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-164">Therefore, a multi-tenant application can’t validate tokens just by matching the issuer value in the metadata with the `issuer` value in the token.</span></span>  <span data-ttu-id="b7ab2-165">Un'applicazione multi-tenant richiede una logica per decidere quali valori di autorità di certificazione sono validi, in base alla parte ID del tenant del valore dell'autorità di certificazione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-165">A multi-tenant application needs logic to decide which issuer values are valid and which are not, based on the tenant ID portion of the issuer value.</span></span>  

<span data-ttu-id="b7ab2-166">Se ad esempio un'applicazione multi-tenant consente l'accesso solo da tenant specifici che hanno eseguito l'accesso ai servizi, è necessario verificare il valore dell'autorità di certificazione o il valore di attestazione `tid` nel token per assicurarsi che sia incluso nel relativo elenco di sottoscrittori.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-166">For example, if a multi-tenant application only allows sign-in from specific tenants who have signed up for their service, then it must check either the issuer value or the `tid` claim value in the token to make sure that tenant is in their list of subscribers.</span></span>  <span data-ttu-id="b7ab2-167">Se un'applicazione multi-tenant gestisce solo persone e non adotta decisioni di accesso basate su tenant, è possibile ignorare il valore dell'autorità di certificazione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-167">If a multi-tenant application only deals with individuals and doesn’t make any access decisions based on tenants, then it can ignore the issuer value altogether.</span></span>

<span data-ttu-id="b7ab2-168">Negli esempi multi-tenant nella sezione [Contenuti correlati](#related-content) alla fine di questo articolo la convalida dell'autorità di certificazione è disattivata per consentire l'accesso a qualsiasi tenant di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-168">In the multi-tenant samples in the [Related Content](#related-content) section at the end of this article, issuer validation is disabled to enable any Azure AD tenant to sign in.</span></span>

<span data-ttu-id="b7ab2-169">Esaminiamo l'esperienza utente per gli utenti che accedono ad applicazioni multi-tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-169">Now let’s look at the user experience for users that are signing in to multi-tenant applications.</span></span>

## <a name="understanding-user-and-admin-consent"></a><span data-ttu-id="b7ab2-170">Informazioni sul consenso dell'utente e dell'amministratore</span><span class="sxs-lookup"><span data-stu-id="b7ab2-170">Understanding user and admin consent</span></span>
<span data-ttu-id="b7ab2-171">Per fare in modo che un utente possa accedere a un'applicazione in Azure AD, l'applicazione deve essere rappresentata nel tenant dell'utente.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-171">For a user to sign in to an application in Azure AD, the application must be represented in the user’s tenant.</span></span>  <span data-ttu-id="b7ab2-172">Ciò consente alle organizzazioni di eseguire operazioni come applicare criteri univoci quando gli utenti dal tenant accedono all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-172">This allows the organization to do things like apply unique policies when users from their tenant sign in to the application.</span></span>  <span data-ttu-id="b7ab2-173">Per un'applicazione single-tenant questa registrazione è semplice. È l'azione che viene eseguita quando si registra l'applicazione nel [portale di Azure][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="b7ab2-173">For a single tenant application, this registration is simple; it’s the one that happens when you register the application in the [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="b7ab2-174">Per un'applicazione multi-tenant, la registrazione iniziale per l'applicazione si trova nel tenant di Azure AD usato dallo sviluppatore.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-174">For a multi-tenant application, the initial registration for the application lives in the Azure AD tenant used by the developer.</span></span>  <span data-ttu-id="b7ab2-175">Quando un utente di un tenant diverso accede all'applicazione per la prima volta, Azure AD richiede il consenso alle autorizzazioni richieste dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-175">When a user from a different tenant signs in to the application for the first time, Azure AD asks them to consent to the permissions requested by the application.</span></span>  <span data-ttu-id="b7ab2-176">Se fornisce il consenso, viene creata una rappresentazione dell'applicazione denominata *entità servizio* nel tenant dell'utente ed è possibile procedere con l'accesso.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-176">If they consent, then a representation of the application called a *service principal* is created in the user’s tenant, and sign-in can continue.</span></span> <span data-ttu-id="b7ab2-177">Viene anche creata una delega nella directory che registra il consenso dell'utente all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-177">A delegation is also created in the directory that records the user’s consent to the application.</span></span> <span data-ttu-id="b7ab2-178">Vedere [Oggetti applicazione e oggetti entità servizio][AAD-App-SP-Objects] per informazioni dettagliate sugli oggetti applicazione ed entità servizio dell'applicazione e su come interagiscono tra loro.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-178">See [Application Objects and Service Principal Objects][AAD-App-SP-Objects] for details on the application's Application and ServicePrincipal objects, and how they relate to each other.</span></span>

![Consenso per l'app a livello singolo][Consent-Single-Tier] 

<span data-ttu-id="b7ab2-180">Questa esperienza di consenso è interessata dalle autorizzazioni richieste dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-180">This consent experience is affected by the permissions requested by the application.</span></span>  <span data-ttu-id="b7ab2-181">Azure AD supporta due tipi di autorizzazioni, delegate e solo app:</span><span class="sxs-lookup"><span data-stu-id="b7ab2-181">Azure AD supports two kinds of permissions, app-only and delegated:</span></span>

* <span data-ttu-id="b7ab2-182">Un'autorizzazione delegata concede a un'applicazione la possibilità di agire come utente connesso per un sottoinsieme di operazioni che l'utente può eseguire.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-182">A delegated permission grants an application the ability to act as a signed in user for a subset of the things the user can do.</span></span>  <span data-ttu-id="b7ab2-183">Ad esempio, è possibile concedere a un'applicazione l'autorizzazione delegata per la lettura del calendario dell'utente connesso.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-183">For example, you can grant an application the delegated permission to read the signed in user’s calendar.</span></span>
* <span data-ttu-id="b7ab2-184">Un'autorizzazione solo app viene concessa direttamente all'identità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-184">An app-only permission is granted directly to the identity of the application.</span></span>  <span data-ttu-id="b7ab2-185">Ad esempio, è possibile concedere a un'applicazione l'autorizzazione solo app per leggere l'elenco di utenti in un tenant, indipendentemente dall'utente che ha eseguito l'accesso all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-185">For example, you can grant an application the app-only permission to read the list of users in a tenant, regardless of who is signed in to the application.</span></span>

<span data-ttu-id="b7ab2-186">Alcune autorizzazioni possono essere concesse da un utente normale, mentre altre richiedono il consenso dell'amministratore tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-186">Some permissions can be consented to by a regular user, while others require a tenant administrator’s consent.</span></span> 

### <a name="admin-consent"></a><span data-ttu-id="b7ab2-187">Consenso dell'amministratore</span><span class="sxs-lookup"><span data-stu-id="b7ab2-187">Admin consent</span></span>
<span data-ttu-id="b7ab2-188">Le autorizzazioni solo app richiedono il consenso dell'amministratore tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-188">App-only permissions always require a tenant administrator’s consent.</span></span>  <span data-ttu-id="b7ab2-189">Se l'applicazione richiede un'autorizzazione solo per app e un utente tenta di accedere all'applicazione, verrà visualizzato un messaggio di errore che informa che l'utente non è in grado di fornire il consenso.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-189">If your application requests an app-only permission and a user tries to sign in to the application, an error message will be displayed saying the user isn’t able to consent.</span></span>

<span data-ttu-id="b7ab2-190">Alcune autorizzazioni delegate richiedono anche il consenso dell'amministratore tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-190">Certain delegated permissions also require a tenant administrator’s consent.</span></span>  <span data-ttu-id="b7ab2-191">Ad esempio, il writeback in Azure AD come utente connesso richiede il consenso dell'amministratore tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-191">For example, the ability to write back to Azure AD as the signed in user requires a tenant administrator’s consent.</span></span>  <span data-ttu-id="b7ab2-192">Come le autorizzazioni solo app, se un utente comune tenta di accedere a un'applicazione che richiede un'autorizzazione delegata che necessita del consenso dell'amministratore, verrà visualizzato un errore nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-192">Like app-only permissions, if an ordinary user tries to sign in to an application that requests a delegated permission that requires administrator consent, your application will receive an error.</span></span>  <span data-ttu-id="b7ab2-193">La richiesta del consenso di amministratore da parte di un'applicazione è determinata dallo sviluppatore che ha pubblicato la risorsa ed è presente nella documentazione per la risorsa.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-193">Whether or not a permission requires admin consent is determined by the developer that published the resource, and can be found in the documentation for the resource.</span></span>  <span data-ttu-id="b7ab2-194">Collegamenti ad argomenti che descrivono le autorizzazioni disponibili per le API Graph di Azure AD e API Graph di Microsoft sono disponibili nella sezione [Contenuti correlati](#related-content) di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-194">Links to topics describing the available permissions for the Azure AD Graph API and Microsoft Graph API are in the [Related Content](#related-content) section of this article.</span></span>

<span data-ttu-id="b7ab2-195">Se l'applicazione usa autorizzazioni che richiedono il consenso dell'amministratore, è necessario che sia presente un movimento, ad esempio un pulsante o un collegamento, con cui l'amministratore può avviare l'azione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-195">If your application uses permissions that require admin consent, you need to have a gesture such as a button or link where the admin can initiate the action.</span></span>  <span data-ttu-id="b7ab2-196">La richiesta inviata dall'applicazione per questa azione è una richiesta di autorizzazione OAuth2/OpenID Connect standard, ma che include anche il parametro `prompt=admin_consent` della stringa di query.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-196">The request your application sends for this action is a usual OAuth2/OpenID Connect authorization request, but that also includes the `prompt=admin_consent` query string parameter.</span></span>  <span data-ttu-id="b7ab2-197">Dopo che l'amministratore ha fornito il consenso e l'entità servizio è stata creata nel tenant del cliente, le successive richieste di accesso non richiedono il parametro `prompt=admin_consent`.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-197">Once the admin has consented and the service principal is created in the customer’s tenant, subsequent sign-in requests do not need the `prompt=admin_consent` parameter.</span></span> <span data-ttu-id="b7ab2-198">Poiché l'amministratore ha deciso che le autorizzazioni richieste sono accettabili, a nessun altro utente nel tenant verrà richiesto il consenso da questo punto in poi.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-198">Since the administrator has decided the requested permissions are acceptable, no other users in the tenant will be prompted for consent from that point forward.</span></span>

<span data-ttu-id="b7ab2-199">Il parametro `prompt=admin_consent` può essere usato anche dalle applicazioni che richiedono autorizzazioni che non necessitano del consenso dell'amministratore.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-199">The `prompt=admin_consent` parameter can also be used by applications that request permissions that do not require admin consent.</span></span> <span data-ttu-id="b7ab2-200">Questa operazione viene eseguita quando l'applicazione richiede un'esperienza in cui il tenant amministratore "si iscrive" una volta e a nessun altro utente viene richiesto il consenso da tale punto in poi.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-200">This is done when the applicaton requires an experience where the tenant admin “signs up” one time, and no other users are prompted for consent from that point on.</span></span>

<span data-ttu-id="b7ab2-201">Se un'applicazione richiede l'autorizzazione dell'amministratore, e un amministratore accede ma il parametro `prompt=admin_consent` non viene inviato, l'amministratore darà correttamente il consenso all'applicazione **solo per l'account utente**.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-201">If an application requires admin consent, and an admin signs in but the `prompt=admin_consent` parameter is not sent, the admin will successfully consent to the application **only for their user account**.</span></span>  <span data-ttu-id="b7ab2-202">Gli utenti normali non saranno ancora in grado di eseguire l'accesso e fornire il consenso all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-202">Regular users will still not be able to sign in and consent to the application.</span></span>  <span data-ttu-id="b7ab2-203">Questa condizione è utile se si vuole assegnare all'amministratore tenant la possibilità di esplorare l'applicazione prima di consentire l'accesso ad altri utenti.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-203">This is useful if you want to give the tenant administrator the ability to explore your application before allowing other users access.</span></span>

<span data-ttu-id="b7ab2-204">Un amministratore tenant può disabilitare la possibilità che gli utenti normali possano il consenso alle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-204">A tenant administrator can disable the ability for regular users to consent to applications.</span></span>  <span data-ttu-id="b7ab2-205">Se questa funzionalità è disabilitata, è necessario impostare il consenso dell'amministratore come obbligatorio sempre per l'applicazione nel tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-205">If this capability is disabled, admin consent is always required for the application to be set up in the tenant.</span></span>  <span data-ttu-id="b7ab2-206">Se si vuole testare l'applicazione con il consenso dell'utente normale disabilitato, è possibile trovare l'opzione di configurazione nella sezione di configurazione del tenant di Azure AD del [portale di Azure][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="b7ab2-206">If you want to test your application with regular user consent disabled, you can find the configuration switch in the Azure AD tenant configuration section of the [Azure portal][AZURE-portal].</span></span>

> [!NOTE]
> <span data-ttu-id="b7ab2-207">Alcune applicazioni offrono un'esperienza in cui gli utenti normali sono inizialmente in grado di fornire il consenso e successivamente l'applicazione può coinvolgere l'amministratore e richiedere le autorizzazioni che necessitano del consenso dell'amministratore.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-207">Some applications want an experience where regular users are able to consent initially, and later the application can involve the administrator and request permissions that require admin consent.</span></span>  <span data-ttu-id="b7ab2-208">Non è attualmente possibile eseguire questa operazione con una singola registrazione all'applicazione in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-208">There is no way to do this with a single application registration in Azure AD today.</span></span>  <span data-ttu-id="b7ab2-209">L'imminente endpoint Azure AD v2 consente alle applicazioni di richiedere le autorizzazioni in fase di esecuzione, anziché al momento della registrazione abilitando questo scenario.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-209">The upcoming Azure AD v2 endpoint will allow applications to request permissions at runtime, instead of at registration time, which will enable this scenario.</span></span>  <span data-ttu-id="b7ab2-210">Per altre informazioni, vedere la [Guida per gli sviluppatori del modello di app di Azure AD versione 2][AAD-V2-Dev-Guide].</span><span class="sxs-lookup"><span data-stu-id="b7ab2-210">For more information, see the [Azure AD App Model v2 Developer Guide][AAD-V2-Dev-Guide].</span></span>
> 
> 

### <a name="consent-and-multi-tier-applications"></a><span data-ttu-id="b7ab2-211">Consenso e applicazioni multilivello</span><span class="sxs-lookup"><span data-stu-id="b7ab2-211">Consent and multi-tier applications</span></span>
<span data-ttu-id="b7ab2-212">L'applicazione può avere più livelli, ognuno rappresentato dalla propria registrazione in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-212">Your application may have multiple tiers, each represented by its own registration in Azure AD.</span></span>  <span data-ttu-id="b7ab2-213">Un esempio è un'applicazione nativa che esegue una chiamata a un'API Web o un'applicazione Web che esegue una chiamata a un'API Web.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-213">For example, a native application that calls a web API, or a web application that calls a web API.</span></span>  <span data-ttu-id="b7ab2-214">In entrambi i casi, il client (app nativa o app Web) richiede le autorizzazioni per eseguire la chiamata alla risorsa (API Web).</span><span class="sxs-lookup"><span data-stu-id="b7ab2-214">In both of these cases, the client (native app or web app) requests permissions to call the resource (web API).</span></span>  <span data-ttu-id="b7ab2-215">Per fare in modo il client venga autorizzato correttamente nel tenant del cliente, tutte le risorse a cui richiede le autorizzazioni devono esistere già nel tenant del cliente.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-215">For the client to be successfully consented into a customer’s tenant, all resources to which it requests permissions must already exist in the customer’s tenant.</span></span>  <span data-ttu-id="b7ab2-216">Se questa condizione non viene soddisfatta, Azure AD restituirà un errore indicante che prima deve essere aggiunta la risorsa.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-216">If this condition isn’t met, Azure AD will return an error that the resource must be added first.</span></span>

<span data-ttu-id="b7ab2-217">**Più livelli in un tenant singolo**</span><span class="sxs-lookup"><span data-stu-id="b7ab2-217">**Multiple tiers in a single tenant**</span></span>

<span data-ttu-id="b7ab2-218">Può trattarsi di un problema se l'applicazione logica è costituita da due o più registrazioni di applicazioni, ad esempio un client e una risorsa separati.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-218">This can be a problem if your logical application consists of two or more application registrations, for example a separate client and resource.</span></span>  <span data-ttu-id="b7ab2-219">Come ottenere prima la risorsa nel tenant del cliente?</span><span class="sxs-lookup"><span data-stu-id="b7ab2-219">How do you get the resource into the customer tenant first?</span></span>  <span data-ttu-id="b7ab2-220">Azure AD si occupa di questo caso, concedendo al client e alla risorsa l'autorizzazione in un unico passaggio.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-220">Azure AD covers this case by enabling client and resource to be consented in a single step.</span></span> <span data-ttu-id="b7ab2-221">L'utente visualizza la somma totale delle autorizzazioni richieste dal client e dalla risorsa nella pagina del consenso.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-221">The user sees the sum total of the permissions requested by both the client and resource on the consent page.</span></span>  <span data-ttu-id="b7ab2-222">Per abilitare questo comportamento, la registrazione dell'applicazione della risorsa deve includere l'ID app del client come `knownClientApplications` nel manifesto dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-222">To enable this behavior, the resource’s application registration must include the client’s App ID as a `knownClientApplications` in its application manifest.</span></span>  <span data-ttu-id="b7ab2-223">ad esempio:</span><span class="sxs-lookup"><span data-stu-id="b7ab2-223">For example:</span></span>

    knownClientApplications": ["94da0930-763f-45c7-8d26-04d5938baab2"]

<span data-ttu-id="b7ab2-224">Questa proprietà può essere aggiornata tramite il [manifesto dell'applicazione][AAD-App-Manifest] della risorsa.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-224">This property can be updated via the resource [application’s manifest][AAD-App-Manifest].</span></span> <span data-ttu-id="b7ab2-225">Ciò viene illustrato in un client nativo multilivello che esegue la chiamata all'esempio di API Web nella sezione [Contenuti correlati](#related-content) alla fine di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-225">This is demonstrated in a multi-tier native client calling web API sample in the [Related Content](#related-content) section at the end of this article.</span></span> <span data-ttu-id="b7ab2-226">Il diagramma seguente fornisce una panoramica del consenso per un'app multilivello registrata in un singolo tenant:</span><span class="sxs-lookup"><span data-stu-id="b7ab2-226">The following diagram provides an overview of consent for a multi-tier app registered in a single tenant :</span></span>

![Consenso per l'app client nota multilivello][Consent-Multi-Tier-Known-Client] 

<span data-ttu-id="b7ab2-228">**Più livelli in tenant multipli**</span><span class="sxs-lookup"><span data-stu-id="b7ab2-228">**Multiple tiers in multiple tenants**</span></span>

<span data-ttu-id="b7ab2-229">Un caso simile si verifica se i diversi livelli di un'applicazione vengono registrati in tenant diversi.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-229">A similar case happens if the different tiers of an application are registered in different tenants.</span></span>  <span data-ttu-id="b7ab2-230">Ad esempio, si consideri il caso della creazione di un'applicazione client nativa che esegue la chiamata all'API di Office 365 Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-230">For example, consider the case of building a native client application that calls the Office 365 Exchange Online API.</span></span>  <span data-ttu-id="b7ab2-231">Per sviluppare l'applicazione nativa e successivamente eseguire l'applicazione nativa nel tenant del cliente, è necessario che sia presente l'entità servizio Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-231">To develop the native application, and later for the native application to run in a customer’s tenant, the Exchange Online service principal must be present.</span></span>  <span data-ttu-id="b7ab2-232">In questo caso lo sviluppatore e il cliente devono acquistare Exchange Online per creare l'entità servizio nei tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-232">In this case, the developer and customer must purchase Exchange Online for the service principal to be created in their tenants.</span></span>  

<span data-ttu-id="b7ab2-233">Nel caso di un'API creata da un'organizzazione diversa da Microsoft, lo sviluppatore dell'API deve includere un modo che consenta ai clienti di fornire il consenso per l'applicazione nei tenant dei clienti.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-233">In the case of an API built by an organization other than Microsoft, the developer of the API needs to provide a way for their customers to consent the application into their customers' tenants.</span></span> <span data-ttu-id="b7ab2-234">La progettazione consigliata è affinché lo sviluppatore di una terza parte compili l'API in modo tale che possa fungere anche da client Web per implementare l'iscrizione:</span><span class="sxs-lookup"><span data-stu-id="b7ab2-234">The recommended design is for the 3rd party developer to build the API such that it can also function as a web client to implement sign-up :</span></span>

1. <span data-ttu-id="b7ab2-235">Seguire le sezioni precedenti per verificare che l'API implementi i requisiti del codice/registrazione dell'applicazione multi-tenant</span><span class="sxs-lookup"><span data-stu-id="b7ab2-235">Follow the earlier sections to ensure the API implements the multi-tenant application registration/code requirements</span></span>
2. <span data-ttu-id="b7ab2-236">Oltre a esporre gli ambiti/ruoli dell'API, verificare che la registrazione comprenda l'autorizzazione di Azure AD "Accedi e leggi il profilo di un altro utente" (fornita per impostazione predefinita)</span><span class="sxs-lookup"><span data-stu-id="b7ab2-236">In addition to exposing the API's scopes/roles, ensure the registration includes the "Sign in and read user profile" Azure AD permission (provided by default)</span></span>
3. <span data-ttu-id="b7ab2-237">Implementare una pagina di iscrizione/accesso nel client Web, seguendo le linee guida del [consenso dell'amministratore](#admin-consent) descritte in precedenza</span><span class="sxs-lookup"><span data-stu-id="b7ab2-237">Implement a sign-in/sign-up page in the web client, following the [admin consent](#admin-consent) guidance discussed earlier</span></span> 
4. <span data-ttu-id="b7ab2-238">Quando l'utente acconsente all'applicazione, vengono creati i collegamenti all'entità servizio e alla delega di consenso nel tenant e l'applicazione nativa è in grado di ottenere i token per l'API</span><span class="sxs-lookup"><span data-stu-id="b7ab2-238">Once the user consents to the application, the service principal and consent delegation links are created in their tenant, and the native application can get tokens for the API</span></span>

<span data-ttu-id="b7ab2-239">Il diagramma seguente fornisce una panoramica del consenso per un'app multilivello registrata in diversi tenant:</span><span class="sxs-lookup"><span data-stu-id="b7ab2-239">The following diagram provides an overview of consent for a multi-tier app registered in different tenants:</span></span>

![Consenso per l'app di terze parti multilivello][Consent-Multi-Tier-Multi-Party] 

### <a name="revoking-consent"></a><span data-ttu-id="b7ab2-241">Revoca del consenso</span><span class="sxs-lookup"><span data-stu-id="b7ab2-241">Revoking Consent</span></span>
<span data-ttu-id="b7ab2-242">Gli utenti e gli amministratori possono revocare il consenso all'applicazione in qualsiasi momento:</span><span class="sxs-lookup"><span data-stu-id="b7ab2-242">Users and administrators can revoke consent to your application at any time:</span></span>

* <span data-ttu-id="b7ab2-243">Gli utenti revocano l'accesso alle singole applicazioni rimuovendole dall'elenco [Applicazioni riquadro di accesso][AAD-Access-Panel].</span><span class="sxs-lookup"><span data-stu-id="b7ab2-243">Users revoke access to individual applications by removing them from their [Access Panel Applications][AAD-Access-Panel] list.</span></span>
* <span data-ttu-id="b7ab2-244">Gli amministratori revocano l'accesso alle applicazioni rimuovendole da Azure AD usando la sezione di gestione di Azure AD del [portale di Azure][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="b7ab2-244">Administrators revoke access to applications by removing them from Azure AD using the Azure AD management section of the [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="b7ab2-245">Se un amministratore fornisce il consenso a un'applicazione per tutti gli utenti in un tenant, gli utenti non possono revocare l'accesso singolarmente.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-245">If an administrator consents to an application for all users in a tenant, users cannot revoke access individually.</span></span>  <span data-ttu-id="b7ab2-246">Solo l'amministratore può revocare l'accesso e soltanto per l'intera applicazione.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-246">Only the administrator can revoke access, and only for the whole application.</span></span>

### <a name="consent-and-protocol-support"></a><span data-ttu-id="b7ab2-247">Supporto del consenso e dei protocolli</span><span class="sxs-lookup"><span data-stu-id="b7ab2-247">Consent and Protocol Support</span></span>
<span data-ttu-id="b7ab2-248">Il consenso è supportato in Azure AD tramite i protocolli OAuth, OpenID Connect, WS-Federation e SAML.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-248">Consent is supported in Azure AD via the OAuth, OpenID Connect, WS-Federation, and SAML protocols.</span></span>  <span data-ttu-id="b7ab2-249">I protocolli WS-Federation e SAML non supportano il parametro `prompt=admin_consent` e il consenso dell'amministratore è possibile solo tramite OAuth e OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-249">The SAML and WS-Federation protocols do not support the `prompt=admin_consent` parameter, so admin consent is only possible via OAuth and OpenID Connect.</span></span>

## <a name="multi-tenant-applications-and-caching-access-tokens"></a><span data-ttu-id="b7ab2-250">Applicazioni multi-tenant e memorizzazione nella cache dei token di accesso</span><span class="sxs-lookup"><span data-stu-id="b7ab2-250">Multi-Tenant Applications and Caching Access Tokens</span></span>
<span data-ttu-id="b7ab2-251">Le applicazioni multi-tenant possono anche ottenere i token di accesso per eseguire chiamate alle API protette da Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-251">Multi-tenant applications can also get access tokens to call APIs that are protected by Azure AD.</span></span>  <span data-ttu-id="b7ab2-252">Un errore comune quando si usa Active Directory Authentication Library (ADAL) con un'applicazione multi-tenant è quello di richiedere inizialmente un token per un utente tramite /common, ricevere una risposta e quindi richiedere un token successivo per lo stesso utente usando sempre /common.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-252">A common error when using the Active Directory Authentication Library (ADAL) with a multi-tenant application, is to initially request a token for a user using /common, receive a response, then request a subsequent token for that same user also using /common.</span></span>  <span data-ttu-id="b7ab2-253">Poiché la risposta da Azure AD proviene da un tenant, non /common, la libreria ADAL memorizza nella cache il token come proveniente dal tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-253">Since the response from Azure AD comes from a tenant, not /common, ADAL caches the token as being from the tenant.</span></span> <span data-ttu-id="b7ab2-254">Nella chiamata successiva a /common per ottenere un token di accesso per l'utente non è presente la voce della cache e all'utente viene richiesto di accedere di nuovo.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-254">The subsequent call to /common to get an access token for the user misses the cache entry, and the user is prompted to sign in again.</span></span>  <span data-ttu-id="b7ab2-255">Per evitare questo errore della cache, assicurarsi che le chiamate successive per un utente già connesso vengano eseguite all'endpoint del tenant.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-255">To avoid missing the cache, make sure subsequent calls for an already signed in user are made to the tenant’s endpoint.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b7ab2-256">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="b7ab2-256">Next steps</span></span>
<span data-ttu-id="b7ab2-257">Questo articolo illustra come compilare un'applicazione che consente a un utente di accedere da qualsiasi tenant Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-257">In this article, you learned how to build an application that can sign in a user from any Azure Active Directory tenant.</span></span> <span data-ttu-id="b7ab2-258">Dopo aver abilitato l'accesso Single Sign-On tra l'app e Azure Active Directory, è anche possibile aggiornare l'applicazione per accedere alle API esposte dalle risorse di Microsoft, come Office 365.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-258">After enabling Single Sign-On between your app and Azure Active Directory, you can also update your application to access APIs exposed by Microsoft resources, like Office 365.</span></span> <span data-ttu-id="b7ab2-259">Pertanto, è possibile offrire un'esperienza personalizzata nell'applicazione, ad esempio mostrando informazioni contestuali per gli utenti, ad esempio l'immagine del profilo o il successivo appuntamento nel calendario.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-259">So you can offer a personalized experience in your application, for example showing contextual information to the users, like their profile picture or their next calendar appointment.</span></span> <span data-ttu-id="b7ab2-260">Per altre informazioni sulle chiamate API ai servizi di Azure Active Directory e Office 365 come Exchange, SharePoint, OneDrive, OneNote, pianificazione, Excel e altri ancora, visitare: [API di Microsoft Graph][MSFT-Graph-overview].</span><span class="sxs-lookup"><span data-stu-id="b7ab2-260">To learn more about making API calls to Azure Active Directory and Office 365 services like Exchange, SharePoint, OneDrive, OneNote, Planner, Excel and more, visit: [Microsoft Graph API][MSFT-Graph-overview].</span></span>


## <a name="related-content"></a><span data-ttu-id="b7ab2-261">Contenuti correlati</span><span class="sxs-lookup"><span data-stu-id="b7ab2-261">Related content</span></span>
* <span data-ttu-id="b7ab2-262">[Esempi di applicazioni multi-tenant][AAD-Samples-MT]</span><span class="sxs-lookup"><span data-stu-id="b7ab2-262">[Multi-tenant application samples][AAD-Samples-MT]</span></span>
* <span data-ttu-id="b7ab2-263">[Linee guida sulla personalizzazione per le applicazioni][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="b7ab2-263">[Branding Guidelines for Applications][AAD-App-Branding]</span></span>
* <span data-ttu-id="b7ab2-264">[Guida per sviluppatori di Azure AD][AAD-Dev-Guide]</span><span class="sxs-lookup"><span data-stu-id="b7ab2-264">[Azure AD Developer's Guide][AAD-Dev-Guide]</span></span>
* <span data-ttu-id="b7ab2-265">[Oggetti applicazione e oggetti entità servizio][AAD-App-SP-Objects]</span><span class="sxs-lookup"><span data-stu-id="b7ab2-265">[Application Objects and Service Principal Objects][AAD-App-SP-Objects]</span></span>
* <span data-ttu-id="b7ab2-266">[Integrazione di applicazioni con Azure Active Directory][AAD-Integrating-Apps]</span><span class="sxs-lookup"><span data-stu-id="b7ab2-266">[Integrating Applications with Azure Active Directory][AAD-Integrating-Apps]</span></span>
* <span data-ttu-id="b7ab2-267">[Panoramica del framework di consenso][AAD-Consent-Overview]</span><span class="sxs-lookup"><span data-stu-id="b7ab2-267">[Overview of the Consent Framework][AAD-Consent-Overview]</span></span>
* <span data-ttu-id="b7ab2-268">[Ambiti di autorizzazione di Microsoft API Graph][MSFT-Graph-permision-scopes]</span><span class="sxs-lookup"><span data-stu-id="b7ab2-268">[Microsoft Graph API Permission Scopes][MSFT-Graph-permision-scopes]</span></span>
* <span data-ttu-id="b7ab2-269">[Ambiti di autorizzazione di Azure AD API Graph][AAD-Graph-Perm-Scopes]</span><span class="sxs-lookup"><span data-stu-id="b7ab2-269">[Azure AD Graph API Permission Scopes][AAD-Graph-Perm-Scopes]</span></span>

<span data-ttu-id="b7ab2-270">La sezione dei commenti di seguito consente di fornire commenti e suggerimenti utili per migliorare e organizzare i contenuti disponibili.</span><span class="sxs-lookup"><span data-stu-id="b7ab2-270">Please use the following comments section to provide feedback and help us refine and shape our content.</span></span>

<!--Reference style links IN USE -->
[AAD-Access-Panel]:  https://myapps.microsoft.com
[AAD-App-Branding]: ./active-directory-branding-guidelines.md
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Consent-Overview]: ./active-directory-integrating-applications.md#overview-of-the-consent-framework
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Overview]: https://azure.microsoft.com/en-us/documentation/articles/active-directory-graph-api/
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Samples-MT]: https://azure.microsoft.com/documentation/samples/?service=active-directory&term=multitenant
[AAD-Why-To-Integrate]: ./active-directory-how-to-integrate.md
[AZURE-portal]: https://portal.azure.com
[MSFT-Graph-overview]: https://graph.microsoft.io/en-us/docs/overview/overview
[MSFT-Graph-permision-scopes]: https://graph.microsoft.io/en-us/docs/authorization/permission_scopes

<!--Image references-->
[AAD-Sign-In]: ./media/active-directory-devhowto-multi-tenant-overview/sign-in-with-microsoft-light.png
[Consent-Single-Tier]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-single-tier.png
[Consent-Multi-Tier-Known-Client]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-known-clients.png
[Consent-Multi-Tier-Multi-Party]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-multi-party.png

<!--Reference style links -->
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Graph-App-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#application-entity
[AAD-Graph-Sp-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity
[AAD-Graph-User-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#user-entity
[AAD-How-To-Integrate]: ./active-directory-how-to-integrate.md
[AAD-Security-Token-Claims]: ./active-directory-authentication-scenarios/#claims-in-azure-ad-security-tokens
[AAD-Tokens-Claims]: ./active-directory-token-and-claims.md
[AAD-V2-Dev-Guide]: ../active-directory-appmodel-v2-overview.md
[AZURE-portal]: https://portal.azure.com
[Duyshant-Role-Blog]: http://www.dushyantgill.com/blog/2014/12/10/roles-based-access-control-in-cloud-applications-using-azure-ad/
[JWT]: https://tools.ietf.org/html/draft-ietf-oauth-json-web-token-32
[O365-Perm-Ref]: https://msdn.microsoft.com/en-us/office/office365/howto/application-manifest
[OAuth2-Access-Token-Scopes]: https://tools.ietf.org/html/rfc6749#section-3.3
[OAuth2-AuthZ-Code-Grant-Flow]: https://msdn.microsoft.com/library/azure/dn645542.aspx
[OAuth2-AuthZ-Grant-Types]: https://tools.ietf.org/html/rfc6749#section-1.3 
[OAuth2-Client-Types]: https://tools.ietf.org/html/rfc6749#section-2.1
[OAuth2-Role-Def]: https://tools.ietf.org/html/rfc6749#page-6
[OpenIDConnect]: http://openid.net/specs/openid-connect-core-1_0.html
[OpenIDConnect-ID-Token]: http://openid.net/specs/openid-connect-core-1_0.html#IDToken














