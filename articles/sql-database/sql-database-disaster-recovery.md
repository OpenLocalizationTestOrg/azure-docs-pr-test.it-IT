---
title: Ripristino di emergenza del database SQL | Documentazione Microsoft
description: "Informazioni su come ripristinare un database da un guasto o un'interruzione del servizio del data center a livello di area con le funzionalità di replica geografica attiva e ripristino geografico del database SQL."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 4800960e-3f9d-40ce-9e55-fb7f2784c067
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/14/2017
ms.author: sashan
ms.openlocfilehash: e33f69bf04b32a31aae3c311c41aa44e4da5016a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="restore-an-azure-sql-database-or-failover-to-a-secondary"></a><span data-ttu-id="a1897-103">Ripristinare un database SQL di Azure o eseguire il failover in un database secondario</span><span class="sxs-lookup"><span data-stu-id="a1897-103">Restore an Azure SQL Database or failover to a secondary</span></span>
<span data-ttu-id="a1897-104">Il database SQL di Azure offre le funzionalità riportate di seguito per il ripristino da un'interruzione del servizio:</span><span class="sxs-lookup"><span data-stu-id="a1897-104">Azure SQL Database offers the following capabilities for recovering from an outage:</span></span>

* [<span data-ttu-id="a1897-105">Replica geografica attiva</span><span class="sxs-lookup"><span data-stu-id="a1897-105">Active geo-replication</span></span>](sql-database-geo-replication-overview.md)
* [<span data-ttu-id="a1897-106">Ripristino geografico</span><span class="sxs-lookup"><span data-stu-id="a1897-106">Geo-restore</span></span>](sql-database-recovery-using-backups.md#point-in-time-restore)

<span data-ttu-id="a1897-107">Per informazioni sugli scenari di continuità aziendale e sulle funzionalità che supportano questi scenari, vedere [Continuità aziendale del database SQL di Azure](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="a1897-107">To learn about business continuity scenarios and the features supporting these scenarios, see [Business continuity](sql-database-business-continuity.md).</span></span>

### <a name="prepare-for-the-event-of-an-outage"></a><span data-ttu-id="a1897-108">Prepararsi per un evento di interruzione del servizio</span><span class="sxs-lookup"><span data-stu-id="a1897-108">Prepare for the event of an outage</span></span>
<span data-ttu-id="a1897-109">Per completare correttamente il ripristino su un'altra area dati tramite la replica geografica attiva o i backup con ridondanza geografica, è necessario preparare un server in un altro data center perché diventi il nuovo server primario in caso di necessità, nonché procedure ben definite, documentate e testate per garantire un ripristino senza problemi.</span><span class="sxs-lookup"><span data-stu-id="a1897-109">For success with recovery to another data region using either active geo-replication or geo-redundant backups, you need to prepare a server in another data center outage to become the new primary server should the need arise as well as have well-defined steps documented and tested to ensure a smooth recovery.</span></span> <span data-ttu-id="a1897-110">La procedura di preparazione comprende:</span><span class="sxs-lookup"><span data-stu-id="a1897-110">These preparation steps include:</span></span>

* <span data-ttu-id="a1897-111">Identificare il server logico in un'altra area perché diventi il nuovo server primario.</span><span class="sxs-lookup"><span data-stu-id="a1897-111">Identify the logical server in another region to become the new primary server.</span></span> <span data-ttu-id="a1897-112">Con la replica geografica attiva, questo sarà almeno uno o forse ognuno dei server secondari.</span><span class="sxs-lookup"><span data-stu-id="a1897-112">With active geo-replication, this will be at least one and perhaps each of the secondary servers.</span></span> <span data-ttu-id="a1897-113">Per il ripristino geografico, questo sarà in genere un server di un'[area abbinata](../best-practices-availability-paired-regions.md) all'area in cui si trova il database.</span><span class="sxs-lookup"><span data-stu-id="a1897-113">For geo-restore, this will generally be a server in the [paired region](../best-practices-availability-paired-regions.md) for the region in which your database is located.</span></span>
* <span data-ttu-id="a1897-114">Identificare e definire, facoltativamente, le regole del firewall a livello di server necessarie agli utenti per accedere al nuovo database primario.</span><span class="sxs-lookup"><span data-stu-id="a1897-114">Identify, and optionally define, the server-level firewall rules needed on for users to access the new primary database.</span></span>
* <span data-ttu-id="a1897-115">Determinare come si desidera reindirizzare gli utenti al nuovo server primario, ad esempio tramite modifica delle stringhe di connessione o delle voci del DNS.</span><span class="sxs-lookup"><span data-stu-id="a1897-115">Determine how you are going to redirect users to the new primary server, such as by changing connection strings or by changing DNS entries.</span></span>
* <span data-ttu-id="a1897-116">Identificare e, facoltativamente, creare gli account di accesso presenti nel database master nel nuovo server primario e verificare che questi account di accesso dispongano delle autorizzazioni appropriate nel database master, se necessarie.</span><span class="sxs-lookup"><span data-stu-id="a1897-116">Identify, and optionally create, the logins that must be present in the master database on the new primary server, and ensure these logins have appropriate permissions in the master database, if any.</span></span> <span data-ttu-id="a1897-117">Per altre informazioni, vedere [Come gestire la sicurezza del database SQL di Azure dopo il ripristino di emergenza](sql-database-geo-replication-security-config.md)</span><span class="sxs-lookup"><span data-stu-id="a1897-117">For more information, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md)</span></span>
* <span data-ttu-id="a1897-118">Stabilire le regole di avviso che dovranno essere aggiornata per eseguire il mapping verso il nuovo database primario.</span><span class="sxs-lookup"><span data-stu-id="a1897-118">Identify alert rules that will need to be updated to map to the new primary database.</span></span>
* <span data-ttu-id="a1897-119">Documentare la configurazione di controllo nel database primario corrente</span><span class="sxs-lookup"><span data-stu-id="a1897-119">Document the auditing configuration on the current primary database</span></span>
* <span data-ttu-id="a1897-120">[Esercitazione per il ripristino di emergenza](sql-database-disaster-recovery-drills.md).</span><span class="sxs-lookup"><span data-stu-id="a1897-120">Perform a [disaster recovery drill](sql-database-disaster-recovery-drills.md).</span></span> <span data-ttu-id="a1897-121">Per simulare un'interruzione del servizio di ripristino geografico, è possibile eliminare o rinominare il database di origine per provocare un errore di connettività dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="a1897-121">To simulate an outage for geo-restore, you can delete or rename the source database to cause application connectivity failure.</span></span> <span data-ttu-id="a1897-122">Per simulare un'interruzione del servizio per la replica geografica attiva, è possibile disabilitare l'applicazione Web o la macchina virtuale connessa al database o il failover del database per causare errori di connettività dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="a1897-122">To simulate an outage for active geo-replication, you can disable the web application or virtual machine connected to the database or failover the database to cause application connectivity failures.</span></span>

## <a name="when-to-initiate-recovery"></a><span data-ttu-id="a1897-123">Quando avviare il ripristino</span><span class="sxs-lookup"><span data-stu-id="a1897-123">When to initiate recovery</span></span>
<span data-ttu-id="a1897-124">L'operazione di ripristino ha un impatto sull'applicazione.</span><span class="sxs-lookup"><span data-stu-id="a1897-124">The recovery operation impacts the application.</span></span> <span data-ttu-id="a1897-125">Richiede la modifica della stringa di connessione SQL o il reindirizzamento tramite DNS e può comportare una perdita di dati permanente.</span><span class="sxs-lookup"><span data-stu-id="a1897-125">It requires changing the SQL connection string or redirection using DNS and could result in permanent data loss.</span></span> <span data-ttu-id="a1897-126">Pertanto, è necessario eseguirla solo quando è probabile che l'interruzione del servizio duri più a lungo dell'obiettivo del tempo di ripristino dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="a1897-126">Therefore, it should be done only when the outage is likely to last longer than your application's recovery time objective.</span></span> <span data-ttu-id="a1897-127">Quando l'applicazione viene distribuita nell'ambiente di produzione, è consigliabile eseguire il monitoraggio regolare dell'integrità dell'applicazione e usare i punti dati seguenti per determinare se il ripristino è possibile:</span><span class="sxs-lookup"><span data-stu-id="a1897-127">When the application is deployed to production you should perform regular monitoring of the application health and use the following data points to assert that the recovery is warranted:</span></span>

1. <span data-ttu-id="a1897-128">Si è verificato un errore di connettività permanente dal livello applicazione al database.</span><span class="sxs-lookup"><span data-stu-id="a1897-128">Permanent connectivity failure from the application tier to the database.</span></span>
2. <span data-ttu-id="a1897-129">Il portale di Azure visualizza un avviso relativo a un evento imprevisto nell'area con un impatto importante.</span><span class="sxs-lookup"><span data-stu-id="a1897-129">The Azure portal shows an alert about an incident in the region with broad impact.</span></span>
3. <span data-ttu-id="a1897-130">Il server di database SQL di Azure è contrassegnato come danneggiato.</span><span class="sxs-lookup"><span data-stu-id="a1897-130">The Azure SQL Database server is marked as degraded.</span></span>

<span data-ttu-id="a1897-131">A seconda della tolleranza dell'applicazione ai tempi di inattività e delle eventuali responsabilità aziendali è possibile prendere in considerazione le opzioni di ripristino seguenti.</span><span class="sxs-lookup"><span data-stu-id="a1897-131">Depending on your application tolerance to downtime and possible business liability you can consider the following recovery options.</span></span>

<span data-ttu-id="a1897-132">Usare [Get Recoverable Database](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*), che consente di ottenere l'ultimo punto di ripristino con replica geografica.</span><span class="sxs-lookup"><span data-stu-id="a1897-132">Use the [Get Recoverable Database](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) to get the latest Geo-replicated restore point.</span></span>

## <a name="wait-for-service-recovery"></a><span data-ttu-id="a1897-133">Attendere il ripristino del servizio</span><span class="sxs-lookup"><span data-stu-id="a1897-133">Wait for service recovery</span></span>
<span data-ttu-id="a1897-134">I team di Azure puntano a ripristinare la disponibilità del servizio quanto più rapidamente possibile, ma questo può richiedere ore o giorni a seconda della causa radice.</span><span class="sxs-lookup"><span data-stu-id="a1897-134">The Azure teams work diligently to restore service availability as quickly as possible but depending on the root cause it can take hours or days.</span></span>  <span data-ttu-id="a1897-135">Se l'applicazione può tollerare tempi di inattività significativi è possibile attendere semplicemente il completamento del ripristino.</span><span class="sxs-lookup"><span data-stu-id="a1897-135">If your application can tolerate significant downtime you can simply wait for the recovery to complete.</span></span> <span data-ttu-id="a1897-136">In tal caso, non è necessaria alcuna azione da parte dell'utente.</span><span class="sxs-lookup"><span data-stu-id="a1897-136">In this case, no action on your part is required.</span></span> <span data-ttu-id="a1897-137">È possibile vedere lo stato corrente del servizio nel [dashboard per l'integrità dei servizi di Azure](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="a1897-137">You can see the current service status on our [Azure Service Health Dashboard](https://azure.microsoft.com/status/).</span></span> <span data-ttu-id="a1897-138">Dopo il ripristino dell'area verrà ripristinata la disponibilità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="a1897-138">After the recovery of the region your application’s availability will be restored.</span></span>

## <a name="fail-over-to-geo-replicated-secondary-database"></a><span data-ttu-id="a1897-139">Failover al database secondario con replica geografica</span><span class="sxs-lookup"><span data-stu-id="a1897-139">Fail over to geo-replicated secondary database</span></span>
<span data-ttu-id="a1897-140">Se i tempi di inattività dell'applicazione possono comportare una responsabilità aziendale, è consigliabile usare database con replica geografica nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="a1897-140">If your application’s downtime can result in business liability you should be using geo-replicated database(s) in your application.</span></span> <span data-ttu-id="a1897-141">Questo permette all'applicazione di ripristinare rapidamente la disponibilità in un'area diversa in caso di interruzione del servizio.</span><span class="sxs-lookup"><span data-stu-id="a1897-141">It will enable the application to quickly restore availability in a different region in case of an outage.</span></span> <span data-ttu-id="a1897-142">Informazioni su [come configurare la replica geografica](sql-database-geo-replication-portal.md).</span><span class="sxs-lookup"><span data-stu-id="a1897-142">Learn how to [configure geo-replication](sql-database-geo-replication-portal.md).</span></span>

<span data-ttu-id="a1897-143">Per ripristinare la disponibilità dei database è necessario avviare il failover nel database secondario con replica geografica usando uno dei metodi supportati.</span><span class="sxs-lookup"><span data-stu-id="a1897-143">To restore availability of the database(s) you need to initiate the failover to the geo-replicated secondary using one of the supported methods.</span></span>

<span data-ttu-id="a1897-144">Per eseguire il failover in un database secondario con replica geografica, seguire una di queste procedure:</span><span class="sxs-lookup"><span data-stu-id="a1897-144">Use one of the following guides to fail over to a geo-replicated secondary database:</span></span>

* [<span data-ttu-id="a1897-145">Failover in un database secondario con replica geografica tramite il portale di Azure</span><span class="sxs-lookup"><span data-stu-id="a1897-145">Fail over to a geo-replicated secondary using Azure Portal</span></span>](sql-database-geo-replication-portal.md)
* [<span data-ttu-id="a1897-146">Failover in un database secondario con replica geografica tramite PowerShell</span><span class="sxs-lookup"><span data-stu-id="a1897-146">Fail over to a geo-replicated secondary using PowerShell</span></span>](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
* [<span data-ttu-id="a1897-147">Failover in un database secondario con replica geografica tramite T-SQL</span><span class="sxs-lookup"><span data-stu-id="a1897-147">Fail over to a geo-replicated secondary using T-SQL</span></span>](sql-database-geo-replication-transact-sql.md)

## <a name="recover-using-geo-restore"></a><span data-ttu-id="a1897-148">Ripristino tramite il ripristino geografico</span><span class="sxs-lookup"><span data-stu-id="a1897-148">Recover using geo-restore</span></span>
<span data-ttu-id="a1897-149">Se i tempi di inattività dell'applicazione non comportano una responsabilità aziendale è possibile usare il [ripristino geografico](sql-database-recovery-using-backups.md) come metodo per il ripristino dei database dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="a1897-149">If your application’s downtime does not result in business liability you can use [geo-restore](sql-database-recovery-using-backups.md) as a method to recover your application database(s).</span></span> <span data-ttu-id="a1897-150">Questo metodo crea una copia del database dal backup con ridondanza geografica più recente.</span><span class="sxs-lookup"><span data-stu-id="a1897-150">It creates a copy of the database from its latest geo-redundant backup.</span></span>

## <a name="configure-your-database-after-recovery"></a><span data-ttu-id="a1897-151">Configurare il database dopo il ripristino</span><span class="sxs-lookup"><span data-stu-id="a1897-151">Configure your database after recovery</span></span>
<span data-ttu-id="a1897-152">Se si esegue il ripristino da un'interruzione del servizio usando il failover con replica geografica o il ripristino geografico, è necessario assicurarsi che la connettività ai nuovi database sia configurata correttamente per poter riprendere il normale funzionamento dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="a1897-152">If you are using either geo-replication failover or geo-restore to recover from an outage, you must make sure that the connectivity to the new databases is properly configured so that the normal application function can be resumed.</span></span> <span data-ttu-id="a1897-153">Di seguito è riportato un elenco di controllo di attività per fare in modo che il database ripristinato sia pronto per la produzione.</span><span class="sxs-lookup"><span data-stu-id="a1897-153">This is a checklist of tasks to get your recovered database production ready.</span></span>

### <a name="update-connection-strings"></a><span data-ttu-id="a1897-154">Aggiornare le stringhe di connessione</span><span class="sxs-lookup"><span data-stu-id="a1897-154">Update connection strings</span></span>
<span data-ttu-id="a1897-155">Poiché il database ripristinato si troverà in un server diverso, è necessario aggiornare la stringa di connessione dell'applicazione in modo che punti a tale server.</span><span class="sxs-lookup"><span data-stu-id="a1897-155">Because your recovered database will reside in a different server, you need to update your application’s connection string to point to that server.</span></span>

<span data-ttu-id="a1897-156">Per altre informazioni sulla modifica delle stringhe di connessione, vedere il linguaggio di sviluppo appropriato per le [raccolte di connessioni](sql-database-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="a1897-156">For more information about changing connection strings, see the appropriate development language for your [connection library](sql-database-libraries.md).</span></span>

### <a name="configure-firewall-rules"></a><span data-ttu-id="a1897-157">Configurare le regole firewall</span><span class="sxs-lookup"><span data-stu-id="a1897-157">Configure Firewall Rules</span></span>
<span data-ttu-id="a1897-158">Verificare che le regole firewall configurate nel server e nel database corrispondano a quelle configurate nel server primario e nel database primario.</span><span class="sxs-lookup"><span data-stu-id="a1897-158">You need to make sure that the firewall rules configured on server and on the database match those that were configured on the primary server and primary database.</span></span> <span data-ttu-id="a1897-159">Per altre informazioni, vedere [Procedura: Configurare le impostazioni del firewall (Database SQL di Azure)](sql-database-configure-firewall-settings.md).</span><span class="sxs-lookup"><span data-stu-id="a1897-159">For more information, see [How to: Configure Firewall Settings (Azure SQL Database)](sql-database-configure-firewall-settings.md).</span></span>

### <a name="configure-logins-and-database-users"></a><span data-ttu-id="a1897-160">Configurare gli account di accesso e gli utenti del database</span><span class="sxs-lookup"><span data-stu-id="a1897-160">Configure logins and database users</span></span>
<span data-ttu-id="a1897-161">Verificare che tutti gli account di accesso usati dall'applicazione siano presenti nel server che ospita il database ripristinato.</span><span class="sxs-lookup"><span data-stu-id="a1897-161">You need to make sure that all the logins used by your application exist on the server which is hosting your recovered database.</span></span> <span data-ttu-id="a1897-162">Per altre informazioni, vedere [Configurazione della sicurezza per la replica geografica](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="a1897-162">For more information, see [Security Configuration for geo-replication](sql-database-geo-replication-security-config.md).</span></span>

> [!NOTE]
> <span data-ttu-id="a1897-163">È necessario configurare e testare le regole del firewall del server e gli account di accesso (con le relative autorizzazioni) durante un'analisi di ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="a1897-163">You should configure and test your server firewall rules and logins (and their permissions) during a disaster recovery drill.</span></span> <span data-ttu-id="a1897-164">Questi oggetti a livello di server e la relativa configurazione potrebbero non essere disponibili durante l'interruzione del servizio.</span><span class="sxs-lookup"><span data-stu-id="a1897-164">These server-level objects and their configuration may not be available during the outage.</span></span>
> 
> 

### <a name="setup-telemetry-alerts"></a><span data-ttu-id="a1897-165">Avvisi di telemetria di configurazione</span><span class="sxs-lookup"><span data-stu-id="a1897-165">Setup telemetry alerts</span></span>
<span data-ttu-id="a1897-166">Verificare che le impostazioni della regola di avviso esistenti vengano aggiornate per il mapping al database ripristinato e al nuovo server.</span><span class="sxs-lookup"><span data-stu-id="a1897-166">You need to make sure your existing alert rule settings are updated to map to the recovered database and the different server.</span></span>

<span data-ttu-id="a1897-167">Per altre informazioni sulle regole di avviso per il database, vedere [Ricevere notifiche di avviso](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) e [Tracciare l’integrità del servizio](../monitoring-and-diagnostics/insights-service-health.md).</span><span class="sxs-lookup"><span data-stu-id="a1897-167">For more information about database alert rules, see [Receive Alert Notifications](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) and [Track Service Health](../monitoring-and-diagnostics/insights-service-health.md).</span></span>

### <a name="enable-auditing"></a><span data-ttu-id="a1897-168">Attivare il controllo</span><span class="sxs-lookup"><span data-stu-id="a1897-168">Enable auditing</span></span>
<span data-ttu-id="a1897-169">Se è necessario il controllo di accesso al database, occorre attivare il controllo dopo il ripristino del database.</span><span class="sxs-lookup"><span data-stu-id="a1897-169">If auditing is required to access your database, you need to enable Auditing after the database recovery.</span></span> <span data-ttu-id="a1897-170">Per altre informazioni, vedere l'articolo sul [controllo del database](sql-database-auditing.md).</span><span class="sxs-lookup"><span data-stu-id="a1897-170">For more information, see [Database auditing](sql-database-auditing.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="a1897-171">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="a1897-171">Next steps</span></span>
* <span data-ttu-id="a1897-172">Per informazioni sui backup automatici del database SQL di Azure, vedere [Backup automatici del database SQL](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="a1897-172">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="a1897-173">Per informazioni sugli scenari di progettazione e ripristino della continuità aziendale, vedere l'articolo relativo agli [scenari di continuità aziendale](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="a1897-173">To learn about business continuity design and recovery scenarios, see [Continuity scenarios](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="a1897-174">Per altre informazioni sull'uso dei backup automatici per il ripristino, vedere l'articolo relativo al [ripristino di un database dai backup avviati dal servizio](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="a1897-174">To learn about using automated backups for recovery, see [restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span></span>

