---
title: Aggiornare un cluster di Azure Service Fabric | Documentazione Microsoft
description: "Aggiornamento del codice di Service Fabric e/o della configurazione eseguita in un cluster di Service Fabric, con impostazione della modalità di aggiornamento del cluster, aggiornamento dei certificati, aggiunta di porte dell'applicazione, applicazione di patch del sistema operativo e così via. Possibili risultati degli aggiornamenti."
services: service-fabric
documentationcenter: .net
author: ChackDan
manager: timlt
editor: 
ms.assetid: 15190ace-31ed-491f-a54b-b5ff61e718db
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 8/10/2017
ms.author: chackdan
ms.openlocfilehash: 7ea71ab891583c51b3c07a4d0a9f0b4f54e56669
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/18/2017
---
# <a name="upgrade-an-azure-service-fabric-cluster"></a><span data-ttu-id="385ef-104">Aggiornare un cluster di Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="385ef-104">Upgrade an Azure Service Fabric cluster</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="385ef-105">Cluster di Azure</span><span class="sxs-lookup"><span data-stu-id="385ef-105">Azure Cluster</span></span>](service-fabric-cluster-upgrade.md)
> * [<span data-ttu-id="385ef-106">Cluster autonomo</span><span class="sxs-lookup"><span data-stu-id="385ef-106">Standalone Cluster</span></span>](service-fabric-cluster-upgrade-windows-server.md)
> 
> 

<span data-ttu-id="385ef-107">Per i sistemi attuali la progettazione a livello di aggiornamento è fondamentale per il successo a lungo termine di un prodotto.</span><span class="sxs-lookup"><span data-stu-id="385ef-107">For any modern system, designing for upgradability is key to achieving long-term success of your product.</span></span> <span data-ttu-id="385ef-108">Un cluster di Azure Service Fabric è una risorsa di proprietà dell'utente parzialmente gestita da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="385ef-108">An Azure Service Fabric cluster is a resource that you own, but is partly managed by Microsoft.</span></span> <span data-ttu-id="385ef-109">Questo articolo descrive ciò che viene gestito automaticamente e ciò che è possibile configurare manualmente.</span><span class="sxs-lookup"><span data-stu-id="385ef-109">This article describes what is managed automatically and what you can configure yourself.</span></span>

## <a name="controlling-the-fabric-version-that-runs-on-your-cluster"></a><span data-ttu-id="385ef-110">Controllo della versione di Fabric eseguita nel cluster</span><span class="sxs-lookup"><span data-stu-id="385ef-110">Controlling the fabric version that runs on your Cluster</span></span>
<span data-ttu-id="385ef-111">È possibile impostare il cluster per ricevere gli aggiornamenti automatici di Fabric quando vengono rilasciati da Microsoft oppure è possibile selezionare una versione di Fabric supportata da eseguire nel cluster.</span><span class="sxs-lookup"><span data-stu-id="385ef-111">You can set your cluster to receive automatic fabric upgrades as they are released by Microsoft or you can select a supported fabric version you want your cluster to be on.</span></span>

<span data-ttu-id="385ef-112">A questo scopo, impostare l'opzione di configurazione "upgradeMode" del cluster nel portale oppure usare Resource Manager al momento della creazione o successivamente in un cluster attivo.</span><span class="sxs-lookup"><span data-stu-id="385ef-112">You do this by setting the "upgradeMode" cluster configuration on the portal or using Resource Manager at the time of creation or later on a live cluster</span></span> 

> [!NOTE]
> <span data-ttu-id="385ef-113">Verificare che il cluster esegua sempre una versione di Fabric supportata.</span><span class="sxs-lookup"><span data-stu-id="385ef-113">Make sure to keep your cluster running a supported fabric version always.</span></span> <span data-ttu-id="385ef-114">Quando viene annunciato il rilascio di una nuova versione di Service Fabric, viene segnalato il termine del periodo di supporto per la versione precedente dopo un minimo di 60 giorni da tale data.</span><span class="sxs-lookup"><span data-stu-id="385ef-114">As and when we announce the release of a new version of service fabric, the previous version is marked for end of support after a minimum of 60 days from that date.</span></span> <span data-ttu-id="385ef-115">Le nuove versioni vengono annunciate nel [blog del team di Service Fabric](https://blogs.msdn.microsoft.com/azureservicefabric/).</span><span class="sxs-lookup"><span data-stu-id="385ef-115">the  The new releases are announced [on the service fabric team blog](https://blogs.msdn.microsoft.com/azureservicefabric/).</span></span> <span data-ttu-id="385ef-116">A questo punto è possibile scegliere la nuova versione.</span><span class="sxs-lookup"><span data-stu-id="385ef-116">The new release is available to choose then.</span></span> 
> 
> 

<span data-ttu-id="385ef-117">14 giorni prima della scadenza della versione in esecuzione nel cluster, viene generato un evento di integrità e il cluster passa a uno stato di avviso.</span><span class="sxs-lookup"><span data-stu-id="385ef-117">14 days prior to the expiry of the release your cluster is running, a health event is generated that puts your cluster into a warning health state.</span></span> <span data-ttu-id="385ef-118">Il cluster rimane in stato di avviso fino a quando non viene eseguito l'aggiornamento a una versione di Fabric supportata.</span><span class="sxs-lookup"><span data-stu-id="385ef-118">The cluster remains in a warning state until you upgrade to a supported fabric version.</span></span>

### <a name="setting-the-upgrade-mode-via-portal"></a><span data-ttu-id="385ef-119">Impostazione della modalità di aggiornamento tramite il portale</span><span class="sxs-lookup"><span data-stu-id="385ef-119">Setting the upgrade mode via portal</span></span>
<span data-ttu-id="385ef-120">È possibile impostare l'aggiornamento automatico o manuale durante la creazione del cluster.</span><span class="sxs-lookup"><span data-stu-id="385ef-120">You can set the cluster to automatic or manual when you are creating the cluster.</span></span>

![Creazione - Modalità manuale][Create_Manualmode]

<span data-ttu-id="385ef-122">È possibile impostare l'aggiornamento automatico o manuale in un cluster attivo con l'esperienza di gestione.</span><span class="sxs-lookup"><span data-stu-id="385ef-122">You can set the cluster to automatic or manual when on a live cluster, using the manage experience.</span></span> 

#### <a name="upgrading-to-a-new-version-on-a-cluster-that-is-set-to-manual-mode-via-portal"></a><span data-ttu-id="385ef-123">Aggiornamento a una nuova versione in un cluster impostato sulla modalità manuale tramite il portale</span><span class="sxs-lookup"><span data-stu-id="385ef-123">Upgrading to a new version on a cluster that is set to Manual mode via portal.</span></span>
<span data-ttu-id="385ef-124">Per eseguire l'aggiornamento a una nuova versione, è sufficiente selezionare la versione disponibile nell'elenco a discesa e salvare.</span><span class="sxs-lookup"><span data-stu-id="385ef-124">To upgrade to a new version, all you need to do is select the available version from the dropdown and save.</span></span> <span data-ttu-id="385ef-125">L'aggiornamento di Fabric viene avviato automaticamente.</span><span class="sxs-lookup"><span data-stu-id="385ef-125">The Fabric upgrade gets kicked off automatically.</span></span> <span data-ttu-id="385ef-126">Durante l'aggiornamento vengono rispettati i criteri di integrità del cluster (una combinazione dell'integrità del nodo e dell'integrità di tutte le applicazioni in esecuzione nel cluster).</span><span class="sxs-lookup"><span data-stu-id="385ef-126">The cluster health policies (a combination of node health and the health all the applications running in the cluster) are adhered to during the upgrade.</span></span>

<span data-ttu-id="385ef-127">Se i criteri di integrità del cluster non vengono soddisfatti, viene eseguito il rollback dell'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="385ef-127">If the cluster health policies are not met, the upgrade is rolled back.</span></span> <span data-ttu-id="385ef-128">Per altre informazioni su come impostare questi criteri di integrità personalizzati, scorrere questo documento verso il basso.</span><span class="sxs-lookup"><span data-stu-id="385ef-128">Scroll down this document to read more on how to set those custom health policies.</span></span> 

<span data-ttu-id="385ef-129">Dopo aver risolto i problemi che hanno determinato il rollback, è necessario avviare di nuovo l'aggiornamento, seguendo la stessa procedura precedente.</span><span class="sxs-lookup"><span data-stu-id="385ef-129">Once you have fixed the issues that resulted in the rollback, you need to initiate the upgrade again, by following the same steps as before.</span></span>

![Gestione - Modalità automatica][Manage_Automaticmode]

### <a name="setting-the-upgrade-mode-via-a-resource-manager-template"></a><span data-ttu-id="385ef-131">Impostazione della modalità di aggiornamento tramite un modello di Resource Manager</span><span class="sxs-lookup"><span data-stu-id="385ef-131">Setting the upgrade mode via a Resource Manager template</span></span>
<span data-ttu-id="385ef-132">Aggiungere l'opzione di configurazione "upgradeMode" alla definizione della risorsa Microsoft.ServiceFabric/clusters e impostare "clusterCodeVersion" su una delle versioni di Fabric supportate come illustrato di seguito, quindi distribuire il modello.</span><span class="sxs-lookup"><span data-stu-id="385ef-132">Add the "upgradeMode" configuration to the Microsoft.ServiceFabric/clusters resource definition and set the "clusterCodeVersion" to one of the supported fabric versions as shown below and then deploy the template.</span></span> <span data-ttu-id="385ef-133">I valori validi per "upgradeMode" sono "Manual" e "Automatic"</span><span class="sxs-lookup"><span data-stu-id="385ef-133">The valid values for "upgradeMode" are "Manual" or "Automatic"</span></span>

![Modalità di aggiornamento tramite Azure Resource Manager][ARMUpgradeMode]

#### <a name="upgrading-to-a-new-version-on-a-cluster-that-is-set-to-manual-mode-via-a-resource-manager-template"></a><span data-ttu-id="385ef-135">Aggiornamento a una nuova versione in un cluster impostato sulla modalità manuale tramite un modello di Resource Manager</span><span class="sxs-lookup"><span data-stu-id="385ef-135">Upgrading to a new version on a cluster that is set to Manual mode via a Resource Manager template.</span></span>
<span data-ttu-id="385ef-136">Quando il cluster è in modalità manuale, per eseguire l'aggiornamento a una nuova versione modificare "clusterCodeVersion" impostando una versione supportata e quindi eseguire la distribuzione.</span><span class="sxs-lookup"><span data-stu-id="385ef-136">When the cluster is in Manual mode, to upgrade to a new version, change the "clusterCodeVersion" to a supported version and deploy it.</span></span> <span data-ttu-id="385ef-137">Con la distribuzione del modello, l'aggiornamento di Fabric viene avviato automaticamente.</span><span class="sxs-lookup"><span data-stu-id="385ef-137">The deployment of the template, kicks of the Fabric upgrade gets kicked off automatically.</span></span> <span data-ttu-id="385ef-138">Durante l'aggiornamento vengono rispettati i criteri di integrità del cluster (una combinazione dell'integrità del nodo e dell'integrità di tutte le applicazioni in esecuzione nel cluster).</span><span class="sxs-lookup"><span data-stu-id="385ef-138">The cluster health policies (a combination of node health and the health all the applications running in the cluster) are adhered to during the upgrade.</span></span>

<span data-ttu-id="385ef-139">Se i criteri di integrità del cluster non vengono soddisfatti, viene eseguito il rollback dell'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="385ef-139">If the cluster health policies are not met, the upgrade is rolled back.</span></span> <span data-ttu-id="385ef-140">Per altre informazioni su come impostare questi criteri di integrità personalizzati, scorrere questo documento verso il basso.</span><span class="sxs-lookup"><span data-stu-id="385ef-140">Scroll down this document to read more on how to set those custom health policies.</span></span> 

<span data-ttu-id="385ef-141">Dopo aver risolto i problemi che hanno determinato il rollback, è necessario avviare di nuovo l'aggiornamento, seguendo la stessa procedura precedente.</span><span class="sxs-lookup"><span data-stu-id="385ef-141">Once you have fixed the issues that resulted in the rollback, you need to initiate the upgrade again, by following the same steps as before.</span></span>

### <a name="get-list-of-all-available-version-for-all-environments-for-a-given-subscription"></a><span data-ttu-id="385ef-142">Ottenere l'elenco di tutte le versioni disponibili per tutti gli ambienti per una determinata sottoscrizione</span><span class="sxs-lookup"><span data-stu-id="385ef-142">Get list of all available version for all environments for a given subscription</span></span>
<span data-ttu-id="385ef-143">Eseguendo questo comando si otterrà un output simile al seguente.</span><span class="sxs-lookup"><span data-stu-id="385ef-143">Run the following command, and you should get an output similar to this.</span></span>

<span data-ttu-id="385ef-144">"supportExpiryUtc" indica la scadenza di una determinata versione.</span><span class="sxs-lookup"><span data-stu-id="385ef-144">"supportExpiryUtc" tells your when a given release is expiring or has expired.</span></span> <span data-ttu-id="385ef-145">La versione più recente non ha una data valida, ma un valore "9999-12-31T23:59:59.9999999", che indica che la data di scadenza non è ancora stata impostata.</span><span class="sxs-lookup"><span data-stu-id="385ef-145">The latest release does not have a valid date - it has a value of "9999-12-31T23:59:59.9999999", which just means that the expiry date is not yet set.</span></span>

```REST
GET https://<endpoint>/subscriptions/{{subscriptionId}}/providers/Microsoft.ServiceFabric/locations/{{location}}/clusterVersions?api-version=2016-09-01

Example: https://management.azure.com/subscriptions/1857f442-3bce-4b96-ad95-627f76437a67/providers/Microsoft.ServiceFabric/locations/eastus/clusterVersions?api-version=2016-09-01

Output:
{
                  "value": [
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/5.0.1427.9490",
                      "name": "5.0.1427.9490",
                      "type": "Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "5.0.1427.9490",
                        "supportExpiryUtc": "2016-11-26T23:59:59.9999999",
                        "environment": "Windows"
                      }
                    },
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/4.0.1427.9490",
                      "name": "5.1.1427.9490",
                      "type": " Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "5.1.1427.9490",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Windows"
                      }
                    },
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/4.4.1427.9490",
                      "name": "4.4.1427.9490",
                      "type": " Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "4.4.1427.9490",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Linux"
                      }
                    }
                  ]
                }


```

## <a name="fabric-upgrade-behavior-when-the-cluster-upgrade-mode-is-automatic"></a><span data-ttu-id="385ef-146">Comportamento di aggiornamento di Fabric in caso di cluster con modalità automatica di aggiornamento</span><span class="sxs-lookup"><span data-stu-id="385ef-146">Fabric upgrade behavior when the cluster Upgrade Mode is Automatic</span></span>
<span data-ttu-id="385ef-147">Microsoft gestisce il codice dell'infrastruttura e la configurazione eseguita in un cluster di Azure</span><span class="sxs-lookup"><span data-stu-id="385ef-147">Microsoft maintains the fabric code and configuration that runs in an Azure cluster.</span></span> <span data-ttu-id="385ef-148">e, in base alle esigenze, esegue aggiornamenti monitorati del software in modo automatico.</span><span class="sxs-lookup"><span data-stu-id="385ef-148">We perform automatic monitored upgrades to the software on an as-needed basis.</span></span> <span data-ttu-id="385ef-149">Gli aggiornamenti possono interessare il codice, la configurazione o entrambi.</span><span class="sxs-lookup"><span data-stu-id="385ef-149">These upgrades could be code, configuration, or both.</span></span> <span data-ttu-id="385ef-150">Per assicurarsi che gli aggiornamenti abbiano un impatto minimo o nullo sull'applicazione, vengono eseguiti nelle fasi descritte di seguito.</span><span class="sxs-lookup"><span data-stu-id="385ef-150">To make sure that your application suffers no impact or minimal impact due to these upgrades, we perform the upgrades in the following phases:</span></span>

### <a name="phase-1-an-upgrade-is-performed-by-using-all-cluster-health-policies"></a><span data-ttu-id="385ef-151">Fase 1: Un aggiornamento viene eseguito usando tutti i criteri di integrità del cluster</span><span class="sxs-lookup"><span data-stu-id="385ef-151">Phase 1: An upgrade is performed by using all cluster health policies</span></span>
<span data-ttu-id="385ef-152">In questa fase gli aggiornamenti interessano un dominio di aggiornamento per volta e le applicazioni in esecuzione sul cluster non subiscono tempi di inattività.</span><span class="sxs-lookup"><span data-stu-id="385ef-152">During this phase, the upgrades proceed one upgrade domain at a time, and the applications that were running in the cluster continue to run without any downtime.</span></span> <span data-ttu-id="385ef-153">Durante l'aggiornamento vengono rispettati i criteri di integrità del cluster (una combinazione dell'integrità del nodo e dell'integrità di tutte le applicazioni in esecuzione nel cluster).</span><span class="sxs-lookup"><span data-stu-id="385ef-153">The cluster health policies (a combination of node health and the health all the applications running in the cluster) are adhered to during the upgrade.</span></span>

<span data-ttu-id="385ef-154">Se i criteri di integrità del cluster non vengono soddisfatti, viene eseguito il rollback dell'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="385ef-154">If the cluster health policies are not met, the upgrade is rolled back.</span></span> <span data-ttu-id="385ef-155">Al proprietario della sottoscrizione verrà quindi inviato un messaggio di posta elettronica</span><span class="sxs-lookup"><span data-stu-id="385ef-155">Then an email is sent to the owner of the subscription.</span></span> <span data-ttu-id="385ef-156">contenente le informazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="385ef-156">The email contains the following information:</span></span>

* <span data-ttu-id="385ef-157">Notifica che era necessario eseguire il rollback di un aggiornamento del cluster.</span><span class="sxs-lookup"><span data-stu-id="385ef-157">Notification that we had to roll back a cluster upgrade.</span></span>
* <span data-ttu-id="385ef-158">Eventuali azioni correttive suggerite.</span><span class="sxs-lookup"><span data-stu-id="385ef-158">Suggested remedial actions, if any.</span></span>
* <span data-ttu-id="385ef-159">Il numero di giorni (n) prima dell'avvio della fase 2.</span><span class="sxs-lookup"><span data-stu-id="385ef-159">The number of days (n) until we execute Phase 2.</span></span>

<span data-ttu-id="385ef-160">Si tenta di eseguire più volte lo stesso aggiornamento nel caso in cui non sia riuscito a causa di problemi di infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="385ef-160">We try to execute the same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="385ef-161">Dopo che gli n giorni dalla data di invio del messaggio di posta elettronica sono trascorsi, si passa alla fase 2.</span><span class="sxs-lookup"><span data-stu-id="385ef-161">After the n days from the date the email was sent, we proceed to Phase 2.</span></span>

<span data-ttu-id="385ef-162">Se i criteri di integrità del cluster sono soddisfatti, l'aggiornamento si considera riuscito e viene contrassegnato come completato.</span><span class="sxs-lookup"><span data-stu-id="385ef-162">If the cluster health policies are met, the upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="385ef-163">Questa situazione può verificarsi durante l'aggiornamento iniziale o in una delle repliche previste in questa fase.</span><span class="sxs-lookup"><span data-stu-id="385ef-163">This can happen during the initial upgrade or any of the upgrade reruns in this phase.</span></span> <span data-ttu-id="385ef-164">Non viene inviato alcun messaggio di posta elettronica di conferma in caso di esecuzione riuscita.</span><span class="sxs-lookup"><span data-stu-id="385ef-164">There is no email confirmation of a successful run.</span></span> <span data-ttu-id="385ef-165">in modo da evitare l'invio di troppi messaggi e per far sì che la ricezione di un messaggio rappresenti un'eccezione alla norma.</span><span class="sxs-lookup"><span data-stu-id="385ef-165">This is to avoid sending you too many emails--receiving an email should be seen as an exception to normal.</span></span> <span data-ttu-id="385ef-166">Si prevede che la maggior parte degli aggiornamenti del cluster abbia esito positivo, senza alcun impatto sulla disponibilità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="385ef-166">We expect most of the cluster upgrades to succeed without impacting your application availability.</span></span>

### <a name="phase-2-an-upgrade-is-performed-by-using-default-health-policies-only"></a><span data-ttu-id="385ef-167">Fase 2: Un aggiornamento viene eseguito usando solo i criteri di integrità predefiniti</span><span class="sxs-lookup"><span data-stu-id="385ef-167">Phase 2: An upgrade is performed by using default health policies only</span></span>
<span data-ttu-id="385ef-168">I criteri di integrità in questa fase vengono impostati in modo che il numero di applicazioni integre all'inizio dell'aggiornamento rimanga invariato per l'intera durata del processo di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="385ef-168">The health policies in this phase are set in such a way that the number of applications that were healthy at the beginning of the upgrade remains the same for the duration of the upgrade process.</span></span> <span data-ttu-id="385ef-169">Come nella fase 1, in questa fase gli aggiornamenti interessano un dominio di aggiornamento per volta e le applicazioni in esecuzione sul cluster non subiscono tempi di inattività.</span><span class="sxs-lookup"><span data-stu-id="385ef-169">As in Phase 1, the Phase 2 upgrades proceed one upgrade domain at a time, and the applications that were running in the cluster continue to run without any downtime.</span></span> <span data-ttu-id="385ef-170">I criteri di integrità del cluster (una combinazione dell'integrità del nodo e dell'integrità di tutte le applicazioni in esecuzione sul cluster) vengono rispettati per l'intera durata dell'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="385ef-170">The cluster health policies (a combination of node health and the health all the applications running in the cluster) are adhered to for the duration of the upgrade.</span></span>

<span data-ttu-id="385ef-171">Se i criteri di integrità del cluster in vigore non vengono soddisfatti, viene eseguito il rollback dell'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="385ef-171">If the cluster health policies in effect are not met, the upgrade is rolled back.</span></span> <span data-ttu-id="385ef-172">Al proprietario della sottoscrizione verrà quindi inviato un messaggio di posta elettronica</span><span class="sxs-lookup"><span data-stu-id="385ef-172">Then an email is sent to the owner of the subscription.</span></span> <span data-ttu-id="385ef-173">contenente le informazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="385ef-173">The email contains the following information:</span></span>

* <span data-ttu-id="385ef-174">Notifica che era necessario eseguire il rollback di un aggiornamento del cluster.</span><span class="sxs-lookup"><span data-stu-id="385ef-174">Notification that we had to roll back a cluster upgrade.</span></span>
* <span data-ttu-id="385ef-175">Eventuali azioni correttive suggerite.</span><span class="sxs-lookup"><span data-stu-id="385ef-175">Suggested remedial actions, if any.</span></span>
* <span data-ttu-id="385ef-176">Il numero di giorni (n) prima dell'avvio della fase 3.</span><span class="sxs-lookup"><span data-stu-id="385ef-176">The number of days (n) until we execute Phase 3.</span></span>

<span data-ttu-id="385ef-177">Si tenta di eseguire più volte lo stesso aggiornamento nel caso in cui non sia riuscito a causa di problemi di infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="385ef-177">We try to execute the same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="385ef-178">Viene inviato un messaggio di sollecito alcuni giorni prima della scadenza degli n giorni.</span><span class="sxs-lookup"><span data-stu-id="385ef-178">A reminder email is sent a couple of days before n days are up.</span></span> <span data-ttu-id="385ef-179">Dopo che gli n giorni dalla data di invio del messaggio di posta elettronica sono trascorsi, si passa alla fase 3.</span><span class="sxs-lookup"><span data-stu-id="385ef-179">After the n days from the date the email was sent, we proceed to Phase 3.</span></span> <span data-ttu-id="385ef-180">I messaggi di posta elettronica inviati nella fase 2 devono essere tenuti in alta considerazione e devono essere intraprese azioni correttive.</span><span class="sxs-lookup"><span data-stu-id="385ef-180">The emails we send you in Phase 2 must be taken seriously and remedial actions must be taken.</span></span>

<span data-ttu-id="385ef-181">Se i criteri di integrità del cluster sono soddisfatti, l'aggiornamento si considera riuscito e viene contrassegnato come completato.</span><span class="sxs-lookup"><span data-stu-id="385ef-181">If the cluster health policies are met, the upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="385ef-182">Questa situazione può verificarsi durante l'aggiornamento iniziale o in una delle repliche previste in questa fase.</span><span class="sxs-lookup"><span data-stu-id="385ef-182">This can happen during the initial upgrade or any of the upgrade reruns in this phase.</span></span> <span data-ttu-id="385ef-183">Non viene inviato alcun messaggio di posta elettronica di conferma in caso di esecuzione riuscita.</span><span class="sxs-lookup"><span data-stu-id="385ef-183">There is no email confirmation of a successful run.</span></span>

### <a name="phase-3-an-upgrade-is-performed-by-using-aggressive-health-policies"></a><span data-ttu-id="385ef-184">Fase 3: Un aggiornamento viene eseguito usando criteri di integrità aggressivi</span><span class="sxs-lookup"><span data-stu-id="385ef-184">Phase 3: An upgrade is performed by using aggressive health policies</span></span>
<span data-ttu-id="385ef-185">Tali criteri di integrità in questa fase sono pensati per il completamento dell'aggiornamento piuttosto che per l'integrità delle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="385ef-185">These health policies in this phase are geared towards completion of the upgrade rather than the health of the applications.</span></span> <span data-ttu-id="385ef-186">In questa fase verranno completati pochi aggiornamenti del cluster.</span><span class="sxs-lookup"><span data-stu-id="385ef-186">Very few cluster upgrades end up in this phase.</span></span> <span data-ttu-id="385ef-187">Se il cluster giunge a questa fase, è molto probabile che l'applicazione divenga non integra e/o perda disponibilità.</span><span class="sxs-lookup"><span data-stu-id="385ef-187">If your cluster gets to this phase, there is a good chance that your application becomes unhealthy and/or lose availability.</span></span>

<span data-ttu-id="385ef-188">In modo analogo alle altre due fasi, gli aggiornamenti della fase 3 procedono in base a un dominio di aggiornamento alla volta.</span><span class="sxs-lookup"><span data-stu-id="385ef-188">Similar to the other two phases, Phase 3 upgrades proceed one upgrade domain at a time.</span></span>

<span data-ttu-id="385ef-189">Se i criteri di integrità del cluster non vengono soddisfatti, viene eseguito il rollback dell'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="385ef-189">If the cluster health policies are not met, the upgrade is rolled back.</span></span> <span data-ttu-id="385ef-190">Si tenta di eseguire più volte lo stesso aggiornamento nel caso in cui non sia riuscito a causa di problemi di infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="385ef-190">We try to execute the same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="385ef-191">A questo punto, il cluster viene bloccato in modo che non riceva più supporto e/o aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="385ef-191">After that, the cluster is pinned, so that it will no longer receive support and/or upgrades.</span></span>

<span data-ttu-id="385ef-192">Al proprietario della sottoscrizione viene inviato un messaggio di posta elettronica contenente queste informazioni e le azioni correttive.</span><span class="sxs-lookup"><span data-stu-id="385ef-192">An email with this information is sent to the subscription owner, along with the remedial actions.</span></span> <span data-ttu-id="385ef-193">Se la fase 3 ha esito negativo, si prevede che il cluster non venga impostato su alcun tipo di stato.</span><span class="sxs-lookup"><span data-stu-id="385ef-193">We do not expect any clusters to get into a state where Phase 3 has failed.</span></span>

<span data-ttu-id="385ef-194">Se i criteri di integrità del cluster sono soddisfatti, l'aggiornamento si considera riuscito e viene contrassegnato come completato.</span><span class="sxs-lookup"><span data-stu-id="385ef-194">If the cluster health policies are met, the upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="385ef-195">Questa situazione può verificarsi durante l'aggiornamento iniziale o in una delle repliche previste in questa fase.</span><span class="sxs-lookup"><span data-stu-id="385ef-195">This can happen during the initial upgrade or any of the upgrade reruns in this phase.</span></span> <span data-ttu-id="385ef-196">Non viene inviato alcun messaggio di posta elettronica di conferma in caso di esecuzione riuscita.</span><span class="sxs-lookup"><span data-stu-id="385ef-196">There is no email confirmation of a successful run.</span></span>

## <a name="cluster-configurations-that-you-control"></a><span data-ttu-id="385ef-197">Configurazioni del cluster controllate manualmente</span><span class="sxs-lookup"><span data-stu-id="385ef-197">Cluster configurations that you control</span></span>
<span data-ttu-id="385ef-198">Oltre a poter impostare la modalità di aggiornamento del cluster, in un cluster attivo è possibile modificare le configurazioni riportate di seguito.</span><span class="sxs-lookup"><span data-stu-id="385ef-198">In addition to the ability to set the cluster upgrade mode, Here are the configurations that you can change on a live cluster.</span></span>

### <a name="certificates"></a><span data-ttu-id="385ef-199">Certificati</span><span class="sxs-lookup"><span data-stu-id="385ef-199">Certificates</span></span>
<span data-ttu-id="385ef-200">È facile aggiungere o eliminare i certificati di cluster e client tramite il portale.</span><span class="sxs-lookup"><span data-stu-id="385ef-200">You can add new or delete certificates for the cluster and client via the portal easily.</span></span> <span data-ttu-id="385ef-201">Fare riferimento a [questo documento per altre informazioni](service-fabric-cluster-security-update-certs-azure.md)</span><span class="sxs-lookup"><span data-stu-id="385ef-201">Refer to [this document for detailed instructions](service-fabric-cluster-security-update-certs-azure.md)</span></span>

![Schermata che illustra le identificazioni personali del certificato nel portale di Azure.][CertificateUpgrade]

### <a name="application-ports"></a><span data-ttu-id="385ef-203">Porte dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="385ef-203">Application ports</span></span>
<span data-ttu-id="385ef-204">È possibile modificare le porte dell'applicazione modificando le proprietà della risorsa del servizio di bilanciamento del carico associate al tipo di nodo.</span><span class="sxs-lookup"><span data-stu-id="385ef-204">You can change application ports by changing the Load Balancer resource properties that are associated with the node type.</span></span> <span data-ttu-id="385ef-205">A questo scopo, è possibile usare il portale oppure direttamente PowerShell per Gestione risorse.</span><span class="sxs-lookup"><span data-stu-id="385ef-205">You can use the portal, or you can use Resource Manager PowerShell directly.</span></span>

<span data-ttu-id="385ef-206">Per aprire una nuova porta in tutte le VM di un tipo di nodo, seguire questa procedura.</span><span class="sxs-lookup"><span data-stu-id="385ef-206">To open a new port on all VMs in a node type, do the following:</span></span>

1. <span data-ttu-id="385ef-207">Aggiungere un nuovo probe al servizio di bilanciamento del carico appropriato.</span><span class="sxs-lookup"><span data-stu-id="385ef-207">Add a new probe to the appropriate load balancer.</span></span>
   
    <span data-ttu-id="385ef-208">Se il cluster è stato distribuito tramite il portale, il bilanciamento del carico verrà denominato "LB-nome del gruppo di risorse-NodeTypename", uno per ogni tipo di nodo.</span><span class="sxs-lookup"><span data-stu-id="385ef-208">If you deployed your cluster by using the portal, the load balancers are named "LB-name of the Resource group-NodeTypename", one for each node type.</span></span> <span data-ttu-id="385ef-209">Poiché i nomi del servizio di bilanciamento del carico sono univoci solo nell'ambito di un gruppo di risorse, è consigliabile cercarli in uno specifico gruppo di risorse.</span><span class="sxs-lookup"><span data-stu-id="385ef-209">Since the load balancer names are unique only within a resource group, it is best if you search for them under a specific resource group.</span></span>
   
    ![Schermata che illustra l'aggiunta di un probe a un servizio di bilanciamento del carico nel portale.][AddingProbes]
2. <span data-ttu-id="385ef-211">Aggiungere una nuova regola al servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="385ef-211">Add a new rule to the load balancer.</span></span>
   
    <span data-ttu-id="385ef-212">Aggiungere una nuova regola allo stesso servizio di bilanciamento del carico usando il probe creato nel passaggio precedente.</span><span class="sxs-lookup"><span data-stu-id="385ef-212">Add a new rule to the same load balancer by using the probe that you created in the previous step.</span></span>
   
    ![Aggiunta di una nuova regola a un servizio di bilanciamento del carico nel portale][AddingLBRules]

### <a name="placement-properties"></a><span data-ttu-id="385ef-214">Proprietà di posizionamento</span><span class="sxs-lookup"><span data-stu-id="385ef-214">Placement properties</span></span>
<span data-ttu-id="385ef-215">Per ogni tipo di nodo è possibile aggiungere proprietà di posizionamento personalizzate da usare nelle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="385ef-215">For each of the node types, you can add custom placement properties that you want to use in your applications.</span></span> <span data-ttu-id="385ef-216">NodeType è una proprietà predefinita che è possibile usare senza aggiungerla in modo esplicito.</span><span class="sxs-lookup"><span data-stu-id="385ef-216">NodeType is a default property that you can use without adding it explicitly.</span></span>

> [!NOTE]
> <span data-ttu-id="385ef-217">Per informazioni dettagliate sull'uso dei vincoli di posizionamento, le proprietà dei nodi e le relative definizioni, vedere la sezione relativa ai vincoli di posizionamento e proprietà dei nodi nell'articolo di Gestione risorse del cluster di Service Fabric relativo alla [descrizione del cluster](service-fabric-cluster-resource-manager-cluster-description.md).</span><span class="sxs-lookup"><span data-stu-id="385ef-217">For details on the use of placement constraints, node properties, and how to define them, refer to the section "Placement Constraints and Node Properties" in the Service Fabric Cluster Resource Manager Document on [Describing Your Cluster](service-fabric-cluster-resource-manager-cluster-description.md).</span></span>
> 
> 

### <a name="capacity-metrics"></a><span data-ttu-id="385ef-218">Metriche della capacità</span><span class="sxs-lookup"><span data-stu-id="385ef-218">Capacity metrics</span></span>
<span data-ttu-id="385ef-219">Per ogni tipo di nodo è possibile aggiungere metriche di capacità personalizzate da usare nelle applicazioni per creare report sul carico.</span><span class="sxs-lookup"><span data-stu-id="385ef-219">For each of the node types, you can add custom capacity metrics that you want to use in your applications to report load.</span></span> <span data-ttu-id="385ef-220">Per informazioni dettagliate sull'uso di metriche di capacità per la segnalazione del carico, vedere i documenti di Gestione risorse del cluster di Service Fabric relativi a [descrizione del cluster](service-fabric-cluster-resource-manager-cluster-description.md) e [metriche e carico](service-fabric-cluster-resource-manager-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="385ef-220">For details on the use of capacity metrics to report load, refer to the Service Fabric Cluster Resource Manager Documents on [Describing Your Cluster](service-fabric-cluster-resource-manager-cluster-description.md) and [Metrics and Load](service-fabric-cluster-resource-manager-metrics.md).</span></span>

### <a name="fabric-upgrade-settings---health-polices"></a><span data-ttu-id="385ef-221">Impostazioni di aggiornamento di Fabric: criteri di integrità</span><span class="sxs-lookup"><span data-stu-id="385ef-221">Fabric upgrade settings - Health polices</span></span>
<span data-ttu-id="385ef-222">È possibile specificare criteri di integrità personalizzati per l'aggiornamento di Fabric.</span><span class="sxs-lookup"><span data-stu-id="385ef-222">You can specify custom health polices for fabric upgrade.</span></span> <span data-ttu-id="385ef-223">Se nel cluster è stato impostato l'aggiornamento automatico di Fabric, questi criteri vengono applicati alla fase 1 degli aggiornamenti automatici di Fabric.</span><span class="sxs-lookup"><span data-stu-id="385ef-223">If you have set your cluster to Automatic fabric upgrades, then these policies get applied to the Phase-1 of the automatic fabric upgrades.</span></span>
<span data-ttu-id="385ef-224">Se nel cluster è stato impostato l'aggiornamento manuale di Fabric, questi criteri vengono applicati ogni volta che si seleziona una nuova versione attivando nel sistema l'avvio dell'aggiornamento di Fabric nel cluster.</span><span class="sxs-lookup"><span data-stu-id="385ef-224">If you have set your cluster for Manual fabric upgrades, then these policies get applied each time you select a new version triggering the system to kick off the fabric upgrade in your cluster.</span></span> <span data-ttu-id="385ef-225">Se non si esegue l'override dei criteri, vengono usati quelli predefiniti.</span><span class="sxs-lookup"><span data-stu-id="385ef-225">If you do not override the policies, the defaults are used.</span></span>

<span data-ttu-id="385ef-226">È possibile specificare criteri di integrità personalizzati o esaminare le impostazioni correnti nel pannello relativo agli aggiornamenti di Fabric, selezionando le impostazioni di aggiornamento avanzate.</span><span class="sxs-lookup"><span data-stu-id="385ef-226">You can specify the custom health policies or review the current settings under the "fabric upgrade" blade, by selecting the advanced upgrade settings.</span></span> <span data-ttu-id="385ef-227">La figura seguente illustra questo passaggio.</span><span class="sxs-lookup"><span data-stu-id="385ef-227">Review the following picture on how to.</span></span> 

![Gestire criteri di integrità personalizzati][HealthPolices]

### <a name="customize-fabric-settings-for-your-cluster"></a><span data-ttu-id="385ef-229">Personalizzare le impostazioni di Fabric per il cluster</span><span class="sxs-lookup"><span data-stu-id="385ef-229">Customize Fabric settings for your cluster</span></span>
<span data-ttu-id="385ef-230">Per informazioni sulle impostazioni personalizzabili e su come possono essere personalizzate, vedere l'articolo relativo alle [impostazioni dei cluster di Service Fabric](service-fabric-cluster-fabric-settings.md) .</span><span class="sxs-lookup"><span data-stu-id="385ef-230">Refer to [service fabric cluster fabric settings](service-fabric-cluster-fabric-settings.md) on what and how you can customize them.</span></span>

### <a name="os-patches-on-the-vms-that-make-up-the-cluster"></a><span data-ttu-id="385ef-231">Patch del sistema operativo nelle VM che costituiscono il cluster</span><span class="sxs-lookup"><span data-stu-id="385ef-231">OS patches on the VMs that make up the cluster</span></span>
<span data-ttu-id="385ef-232">Fare riferimento a [Patch Orchestration Application](service-fabric-patch-orchestration-application.md) che può essere distribuito nel cluster per installare le patch di Windows Update in modo orchestrato, mantenendo i servizi sempre disponibili.</span><span class="sxs-lookup"><span data-stu-id="385ef-232">Refer to [Patch Orchestration Application](service-fabric-patch-orchestration-application.md) which can be deployed on your cluster to install patches from Windows Update in an orchestrated manner, keeping the services available all the time.</span></span> 

### <a name="os-upgrades-on-the-vms-that-make-up-the-cluster"></a><span data-ttu-id="385ef-233">Aggiornamenti del sistema operativo nelle VM che costituiscono il cluster</span><span class="sxs-lookup"><span data-stu-id="385ef-233">OS upgrades on the VMs that make up the cluster</span></span>
<span data-ttu-id="385ef-234">Se è necessario aggiornare l'immagine del sistema operativo nelle macchine virtuali del cluster, eseguire questa operazione su una VM per volta.</span><span class="sxs-lookup"><span data-stu-id="385ef-234">If you must upgrade the OS image on the virtual machines of the cluster, you must do it one VM at a time.</span></span> <span data-ttu-id="385ef-235">L'esecuzione dell'aggiornamento è un'operazione manuale, non è attualmente disponibile alcun tipo di automazione.</span><span class="sxs-lookup"><span data-stu-id="385ef-235">You are responsible for this upgrade--there is currently no automation for this.</span></span>

## <a name="next-steps"></a><span data-ttu-id="385ef-236">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="385ef-236">Next steps</span></span>
* <span data-ttu-id="385ef-237">Informazioni su come personalizzare alcune [impostazioni dei cluster di Service Fabric](service-fabric-cluster-fabric-settings.md)</span><span class="sxs-lookup"><span data-stu-id="385ef-237">Learn how to customize some of the [service fabric cluster fabric settings](service-fabric-cluster-fabric-settings.md)</span></span>
* <span data-ttu-id="385ef-238">Informazioni su come [aumentare o ridurre le istanze del cluster](service-fabric-cluster-scale-up-down.md)</span><span class="sxs-lookup"><span data-stu-id="385ef-238">Learn how to [scale your cluster in and out](service-fabric-cluster-scale-up-down.md)</span></span>
* <span data-ttu-id="385ef-239">Informazioni su come eseguire [aggiornamenti dell'applicazione](service-fabric-application-upgrade.md)</span><span class="sxs-lookup"><span data-stu-id="385ef-239">Learn about [application upgrades](service-fabric-application-upgrade.md)</span></span>

<!--Image references-->
[CertificateUpgrade]: ./media/service-fabric-cluster-upgrade/CertificateUpgrade2.png
[AddingProbes]: ./media/service-fabric-cluster-upgrade/addingProbes2.PNG
[AddingLBRules]: ./media/service-fabric-cluster-upgrade/addingLBRules.png
[HealthPolices]: ./media/service-fabric-cluster-upgrade/Manage_AutomodeWadvSettings.PNG
[ARMUpgradeMode]: ./media/service-fabric-cluster-upgrade/ARMUpgradeMode.PNG
[Create_Manualmode]: ./media/service-fabric-cluster-upgrade/Create_Manualmode.PNG
[Manage_Automaticmode]: ./media/service-fabric-cluster-upgrade/Manage_Automaticmode.PNG
