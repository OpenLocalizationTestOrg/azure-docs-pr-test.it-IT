---
title: Uso dell'archivio query nel database SQL di Azure
description: Informazioni su come usare l'archivio query nel database SQL di Azure
keywords: 
services: sql-database
documentationcenter: 
author: bonova
manager: jhubbard
editor: 
ms.assetid: 0cccf6bd-1327-44f7-a6f9-8eff0c210463
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: sqldb-performance
ms.workload: data-management
ms.date: 11/08/2016
ms.author: bonova
ms.openlocfilehash: 4e13f265c32037abdba67a68ca5be81e167c01e4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="operating-the-query-store-in-azure-sql-database"></a><span data-ttu-id="a05b0-103">Uso dell'archivio query nel database SQL di Azure</span><span class="sxs-lookup"><span data-stu-id="a05b0-103">Operating the Query Store in Azure SQL Database</span></span>
<span data-ttu-id="a05b0-104">L'archivio query di Azure è una funzionalità di database completamente gestita che raccoglie e presenta informazioni cronologiche dettagliate su tutte le query in modo continuo.</span><span class="sxs-lookup"><span data-stu-id="a05b0-104">Query Store in Azure is a fully managed database feature that continuously collects and presents detailed historic information about all queries.</span></span> <span data-ttu-id="a05b0-105">L'archivio query può essere concepito come un registratore dei dati di volo di un aeroplano che semplifica notevolmente la risoluzione dei problemi relativi alle prestazioni delle query sia per i clienti del cloud sia per i clienti locali.</span><span class="sxs-lookup"><span data-stu-id="a05b0-105">You can think about Query Store as similar to an airplane's flight data recorder that significantly simplifies query performance troubleshooting both for cloud and on-premises customers.</span></span> <span data-ttu-id="a05b0-106">Questo articolo spiega alcuni aspetti specifici dell'uso dell'archivio query in Azure.</span><span class="sxs-lookup"><span data-stu-id="a05b0-106">This article explains specific aspects of operating Query Store in Azure.</span></span> <span data-ttu-id="a05b0-107">Usando questi dati di query pre-raccolti, è possibile diagnosticare e risolvere velocemente i problemi di prestazioni e dedicare così più tempo alla propria attività.</span><span class="sxs-lookup"><span data-stu-id="a05b0-107">Using this pre-collected query data, you can quickly diagnose and resolve performance problems and thus spend more time focusing on their business.</span></span> 

<span data-ttu-id="a05b0-108">Archivio query è [disponibile a livello globale](https://azure.microsoft.com/updates/general-availability-azure-sql-database-query-store/) nel database SQL di Azure da novembre 2015.</span><span class="sxs-lookup"><span data-stu-id="a05b0-108">Query Store has been [globally available](https://azure.microsoft.com/updates/general-availability-azure-sql-database-query-store/) in Azure SQL Database since November, 2015.</span></span> <span data-ttu-id="a05b0-109">Archivio query è la base per le funzionalità di analisi delle prestazioni e ottimizzazione, come [Advisor per database SQL e il dashboard delle prestazioni](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span><span class="sxs-lookup"><span data-stu-id="a05b0-109">Query Store is the foundation for performance analysis and tuning features, such as [SQL Database Advisor and Performance Dashboard](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span></span> <span data-ttu-id="a05b0-110">Al momento della pubblicazione di questo articolo, l'archivio query è in esecuzione in più di 200.000 database utente in Azure e raccoglie informazioni relative alle query da molti mesi senza interruzioni.</span><span class="sxs-lookup"><span data-stu-id="a05b0-110">At the moment of publishing this article, Query Store is running in more than 200,000 user databases in Azure, collecting query-related information for several months, without interruption.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a05b0-111">Microsoft sta per attivare l'archivio query per tutti i database SQL di Azure esistenti e nuovi.</span><span class="sxs-lookup"><span data-stu-id="a05b0-111">Microsoft is in the process of activating Query Store for all Azure SQL databases (existing and new).</span></span> 
> 
> 

## <a name="optimal-query-store-configuration"></a><span data-ttu-id="a05b0-112">Configurazione ottimale dell'archivio query</span><span class="sxs-lookup"><span data-stu-id="a05b0-112">Optimal Query Store Configuration</span></span>
<span data-ttu-id="a05b0-113">Questa sezione descrive impostazioni di configurazione predefinite ottimali progettate per garantire un funzionamento affidabile dell'archivio query e delle funzionalità dipendenti, come indicato nell'articolo [Advisor per database SQL e dashboard delle prestazioni](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span><span class="sxs-lookup"><span data-stu-id="a05b0-113">This section describes optimal configuration defaults that are designed to ensure reliable operation of the Query Store and dependent features, such as [SQL Database Advisor and Performance Dashboard](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span></span> <span data-ttu-id="a05b0-114">La configurazione predefinita è ottimizzata per la raccolta di dati continua, ossia per un tempo minimo di OFF/READ_ONLY.</span><span class="sxs-lookup"><span data-stu-id="a05b0-114">Default configuration is optimized for continuous data collection, that is minimal time spent in OFF/READ_ONLY states.</span></span>

| <span data-ttu-id="a05b0-115">Configurazione</span><span class="sxs-lookup"><span data-stu-id="a05b0-115">Configuration</span></span> | <span data-ttu-id="a05b0-116">Descrizione</span><span class="sxs-lookup"><span data-stu-id="a05b0-116">Description</span></span> | <span data-ttu-id="a05b0-117">Default</span><span class="sxs-lookup"><span data-stu-id="a05b0-117">Default</span></span> | <span data-ttu-id="a05b0-118">Commento</span><span class="sxs-lookup"><span data-stu-id="a05b0-118">Comment</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="a05b0-119">MAX_STORAGE_SIZE_MB</span><span class="sxs-lookup"><span data-stu-id="a05b0-119">MAX_STORAGE_SIZE_MB</span></span> |<span data-ttu-id="a05b0-120">Specifica il limite per lo spazio dati che l'archivio query occupa all'interno del database del cliente z</span><span class="sxs-lookup"><span data-stu-id="a05b0-120">Specifies the limit for the data space that Query Store can take inside z customer database</span></span> |<span data-ttu-id="a05b0-121">100</span><span class="sxs-lookup"><span data-stu-id="a05b0-121">100</span></span> |<span data-ttu-id="a05b0-122">Applicato per i nuovi database</span><span class="sxs-lookup"><span data-stu-id="a05b0-122">Enforced for new databases</span></span> |
| <span data-ttu-id="a05b0-123">INTERVAL_LENGTH_MINUTES</span><span class="sxs-lookup"><span data-stu-id="a05b0-123">INTERVAL_LENGTH_MINUTES</span></span> |<span data-ttu-id="a05b0-124">Definisce la dimensione dell'intervallo di tempo durante il quale le statistiche di runtime raccolte per i piani di query vengono aggregate e rese persistenti.</span><span class="sxs-lookup"><span data-stu-id="a05b0-124">Defines size of time window during which collected runtime statistics for query plans are aggregated and persisted.</span></span> <span data-ttu-id="a05b0-125">Tutti i piani di query attivi hanno al massimo una riga per un periodo di tempo definito con questa configurazione</span><span class="sxs-lookup"><span data-stu-id="a05b0-125">Every active query plan has at most one row for a period of time defined with this configuration</span></span> |<span data-ttu-id="a05b0-126">60</span><span class="sxs-lookup"><span data-stu-id="a05b0-126">60</span></span> |<span data-ttu-id="a05b0-127">Applicato per i nuovi database</span><span class="sxs-lookup"><span data-stu-id="a05b0-127">Enforced for new databases</span></span> |
| <span data-ttu-id="a05b0-128">STALE_QUERY_THRESHOLD_DAYS</span><span class="sxs-lookup"><span data-stu-id="a05b0-128">STALE_QUERY_THRESHOLD_DAYS</span></span> |<span data-ttu-id="a05b0-129">Criterio di pulizia basato sul tempo che controlla il periodo di memorizzazione delle statistiche di runtime persistenti e delle query inattive</span><span class="sxs-lookup"><span data-stu-id="a05b0-129">Time-based cleanup policy that controls the retention period of persisted runtime statistics and inactive queries</span></span> |<span data-ttu-id="a05b0-130">30</span><span class="sxs-lookup"><span data-stu-id="a05b0-130">30</span></span> |<span data-ttu-id="a05b0-131">Applicato per i nuovi database e i database con un'impostazione predefinita precedente (367)</span><span class="sxs-lookup"><span data-stu-id="a05b0-131">Enforced for new databases and databases with previous default (367)</span></span> |
| <span data-ttu-id="a05b0-132">SIZE_BASED_CLEANUP_MODE</span><span class="sxs-lookup"><span data-stu-id="a05b0-132">SIZE_BASED_CLEANUP_MODE</span></span> |<span data-ttu-id="a05b0-133">Specifica se la pulizia automatica dei dati viene eseguita quando la dimensione dati dell'archivio query si avvicina al limite</span><span class="sxs-lookup"><span data-stu-id="a05b0-133">Specifies whether automatic data cleanup takes place when Query Store data size approaches the limit</span></span> |<span data-ttu-id="a05b0-134">AUTO</span><span class="sxs-lookup"><span data-stu-id="a05b0-134">AUTO</span></span> |<span data-ttu-id="a05b0-135">Applicato per tutti i database</span><span class="sxs-lookup"><span data-stu-id="a05b0-135">Enforced for all databases</span></span> |
| <span data-ttu-id="a05b0-136">QUERY_CAPTURE_MODE</span><span class="sxs-lookup"><span data-stu-id="a05b0-136">QUERY_CAPTURE_MODE</span></span> |<span data-ttu-id="a05b0-137">Specifica se vengono monitorate tutte le query o solo un sottoinsieme di esse</span><span class="sxs-lookup"><span data-stu-id="a05b0-137">Specifies whether all queries or only a subset of queries are tracked</span></span> |<span data-ttu-id="a05b0-138">AUTO</span><span class="sxs-lookup"><span data-stu-id="a05b0-138">AUTO</span></span> |<span data-ttu-id="a05b0-139">Applicato per tutti i database</span><span class="sxs-lookup"><span data-stu-id="a05b0-139">Enforced for all databases</span></span> |
| <span data-ttu-id="a05b0-140">FLUSH_INTERVAL_SECONDS</span><span class="sxs-lookup"><span data-stu-id="a05b0-140">FLUSH_INTERVAL_SECONDS</span></span> |<span data-ttu-id="a05b0-141">Specifica il periodo massimo durante il quale le statistiche di runtime acquisite vengono mantenute in memoria prima di essere scaricate su disco</span><span class="sxs-lookup"><span data-stu-id="a05b0-141">Specifies maximum period during which captured runtime statistics are kept in memory, before flushing to disk</span></span> |<span data-ttu-id="a05b0-142">900</span><span class="sxs-lookup"><span data-stu-id="a05b0-142">900</span></span> |<span data-ttu-id="a05b0-143">Applicato per i nuovi database</span><span class="sxs-lookup"><span data-stu-id="a05b0-143">Enforced for new databases</span></span> |
|  | | | |

> [!IMPORTANT]
> <span data-ttu-id="a05b0-144">I valori predefiniti indicati sopra vengono applicati automaticamente nella fase finale dell'attivazione dell'archivio query in tutti i database SQL di Azure (vedere la precedente nota importante).</span><span class="sxs-lookup"><span data-stu-id="a05b0-144">These defaults are automatically applied in the final stage of Query Store activation in all Azure SQL databases (see preceding important note).</span></span> <span data-ttu-id="a05b0-145">Dopo questa attivazione, il database SQL di Azure non modificherà i valori di configurazione impostati dai clienti, a meno che non abbiano un impatto negativo sul carico di lavoro primario o sull'affidabilità di funzionamento dell'archivio query.</span><span class="sxs-lookup"><span data-stu-id="a05b0-145">After this light up, Azure SQL Database won’t be changing configuration values set by customers, unless they negatively impact primary workload or reliable operations of the Query Store.</span></span>
> 
> 

<span data-ttu-id="a05b0-146">Se si desidera mantenere le impostazioni personalizzate, usare [ALTER DATABASE con le opzioni dell'archivio query](https://msdn.microsoft.com/library/bb522682.aspx) per riportare la configurazione allo stato precedente.</span><span class="sxs-lookup"><span data-stu-id="a05b0-146">If you want to stay with your custom settings, use [ALTER DATABASE with Query Store options](https://msdn.microsoft.com/library/bb522682.aspx) to revert configuration to the previous state.</span></span> <span data-ttu-id="a05b0-147">Vedere [Procedure consigliate per l'archivio query](https://msdn.microsoft.com/library/mt604821.aspx) per informazioni su come scegliere i parametri di configurazione ottimali.</span><span class="sxs-lookup"><span data-stu-id="a05b0-147">Check out [Best Practices with the Query Store](https://msdn.microsoft.com/library/mt604821.aspx) in order to learn how top chose optimal configuration parameters.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a05b0-148">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="a05b0-148">Next steps</span></span>
[<span data-ttu-id="a05b0-149">Informazioni dettagliate sulle prestazioni del database SQL</span><span class="sxs-lookup"><span data-stu-id="a05b0-149">SQL Database Performance Insight</span></span>](sql-database-performance.md)

## <a name="additional-resources"></a><span data-ttu-id="a05b0-150">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="a05b0-150">Additional resources</span></span>
<span data-ttu-id="a05b0-151">Per altre informazioni, vedere gli articoli dedicati ai seguenti argomenti:</span><span class="sxs-lookup"><span data-stu-id="a05b0-151">For more information check out the following articles:</span></span>

* [<span data-ttu-id="a05b0-152">Un registratore dei dati di volo per il database</span><span class="sxs-lookup"><span data-stu-id="a05b0-152">A flight data recorder for your database</span></span>](https://azure.microsoft.com/blog/query-store-a-flight-data-recorder-for-your-database) 
* [<span data-ttu-id="a05b0-153">Monitoraggio delle prestazioni mediante l'archivio query</span><span class="sxs-lookup"><span data-stu-id="a05b0-153">Monitoring Performance By Using the Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx)
* [<span data-ttu-id="a05b0-154">Scenari di utilizzo dell'archivio query</span><span class="sxs-lookup"><span data-stu-id="a05b0-154">Query Store Usage Scenarios</span></span>](https://msdn.microsoft.com/library/mt614796.aspx)
* [<span data-ttu-id="a05b0-155">Monitoraggio delle prestazioni mediante l'archivio query</span><span class="sxs-lookup"><span data-stu-id="a05b0-155">Monitoring Performance By Using the Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx) 

