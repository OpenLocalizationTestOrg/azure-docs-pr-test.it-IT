---
title: le applicazioni che usano code di Azure Service Bus aaaWrite | Documenti Microsoft
description: Come toowrite una semplice applicazione basata su coda che utilizza Azure Service Bus.
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 754d91b3-1426-405e-84b4-fd36d65b114a
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/07/2017
ms.author: sethm
ms.openlocfilehash: 93b75902a06becd6e33e05298e09f5669d0e2aef
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="create-applications-that-use-service-bus-queues"></a><span data-ttu-id="aa126-103">Creare applicazioni che utilizzano le code del Bus di servizio</span><span class="sxs-lookup"><span data-stu-id="aa126-103">Create applications that use Service Bus queues</span></span>
<span data-ttu-id="aa126-104">In questo argomento vengono descritte le code di Service Bus e Mostra come toowrite una semplice applicazione basata su coda che utilizza Service Bus.</span><span class="sxs-lookup"><span data-stu-id="aa126-104">This topic describes Service Bus queues and shows how toowrite a simple queue-based application that uses Service Bus.</span></span>

<span data-ttu-id="aa126-105">Si consideri uno scenario da HelloWorld vendita al dettaglio, in cui i dati di vendita da singoli punto vendita (POS) terminali devono essere indirizzati tooan sistema di gestione che usa hello dati toodetermine quando è toobe un nuovo approvvigionamento.</span><span class="sxs-lookup"><span data-stu-id="aa126-105">Consider a scenario from hello world of retail in which sales data from individual Point-of-Sale (POS) terminals must be routed tooan inventory management system that uses hello data toodetermine when stock has toobe replenished.</span></span> <span data-ttu-id="aa126-106">Questa soluzione Usa messaggistica del Bus di servizio per la comunicazione hello tra i terminali hello e sistema di gestione inventario hello, come illustrato nella seguente illustrazione hello:</span><span class="sxs-lookup"><span data-stu-id="aa126-106">This solution uses Service Bus messaging for hello communication between hello terminals and hello inventory management system, as illustrated in hello following figure:</span></span>

![Figura 1 Code del bus di servizio](./media/service-bus-create-queues/IC657161.gif)

<span data-ttu-id="aa126-108">Ogni terminale segnala i dati di vendita tramite l'invio di messaggi toohello **DataCollectionQueue**.</span><span class="sxs-lookup"><span data-stu-id="aa126-108">Each POS terminal reports its sales data by sending messages toohello **DataCollectionQueue**.</span></span> <span data-ttu-id="aa126-109">I messaggi rimangono nella coda finché vengono recuperati dal sistema di gestione inventario hello.</span><span class="sxs-lookup"><span data-stu-id="aa126-109">These messages remain in this queue until they are retrieved by hello inventory management system.</span></span> <span data-ttu-id="aa126-110">Questo modello viene spesso definito *messaggistica asincrona*, perché non dispone di toowait per una risposta dall'elaborazione di hello inventario Gestione sistema toocontinue terminal hello POS.</span><span class="sxs-lookup"><span data-stu-id="aa126-110">This pattern is often termed *asynchronous messaging*, because hello POS terminal does not have toowait for a reply from hello inventory management system toocontinue processing.</span></span>

## <a name="why-queuing"></a><span data-ttu-id="aa126-111">Quali sono i vantaggi offerti dalle code?</span><span class="sxs-lookup"><span data-stu-id="aa126-111">Why queuing?</span></span>
<span data-ttu-id="aa126-112">Prima di esaminare il codice hello in tooset necessario configurare l'applicazione, prendere in considerazione i vantaggi di hello dell'utilizzo di una coda in questo scenario invece di dover terminali hello POS comunicare direttamente (sincrona) toohello inventario di sistema di gestione.</span><span class="sxs-lookup"><span data-stu-id="aa126-112">Before we look at hello code that is required tooset up this application, consider hello advantages of using a queue in this scenario instead of having hello POS terminals talk directly (synchronously) toohello inventory management system.</span></span>

### <a name="temporal-decoupling"></a><span data-ttu-id="aa126-113">Disaccoppiamento temporaneo.</span><span class="sxs-lookup"><span data-stu-id="aa126-113">Temporal decoupling</span></span>
<span data-ttu-id="aa126-114">Con modello di messaggistica asincrona di hello, producer e consumer non è in linea toobe in hello contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="aa126-114">With hello asynchronous messaging pattern, producers and consumers do not have toobe online at hello same time.</span></span> <span data-ttu-id="aa126-115">infrastruttura di messaggistica Hello archivia in modo affidabile i messaggi hello finché consumer non è pronto tooreceive li.</span><span class="sxs-lookup"><span data-stu-id="aa126-115">hello messaging infrastructure reliably stores messages until hello consuming party is ready tooreceive them.</span></span> <span data-ttu-id="aa126-116">Ciò significa che i componenti di hello di un'applicazione hello distribuita possono essere disconnesso, sia volontariamente; ad esempio, per la manutenzione o a causa di arresto anomalo del componente tooa, senza influire sull'intero sistema hello.</span><span class="sxs-lookup"><span data-stu-id="aa126-116">This means hello components of hello distributed application can be disconnected, either voluntarily; for example, for maintenance, or due tooa component crash, without affecting hello whole system.</span></span> <span data-ttu-id="aa126-117">Inoltre, utilizzano l'applicazione hello può avere solo toobe online durante determinate ore del giorno hello.</span><span class="sxs-lookup"><span data-stu-id="aa126-117">Furthermore, hello consuming application may only have toobe online during certain times of hello day.</span></span> <span data-ttu-id="aa126-118">Ad esempio, in questo scenario di vendita al dettaglio, il sistema di gestione inventario hello può avere toocome online dopo la fine di hello della giornata lavorativa hello.</span><span class="sxs-lookup"><span data-stu-id="aa126-118">For example, in this retail scenario, hello inventory management system may only have toocome online after hello end of hello business day.</span></span>

### <a name="load-leveling"></a><span data-ttu-id="aa126-119">Livellamento del carico</span><span class="sxs-lookup"><span data-stu-id="aa126-119">Load leveling</span></span>
<span data-ttu-id="aa126-120">In molte applicazioni carico del sistema varia nel tempo, mentre il tempo di elaborazione di hello necessario per ogni unità di lavoro è in genere costante.</span><span class="sxs-lookup"><span data-stu-id="aa126-120">In many applications system load varies over time, whereas hello processing time required for each unit of work is typically constant.</span></span> <span data-ttu-id="aa126-121">Messaggio interposizione producer e consumer indica una coda che hello applicazione consumer (lavoratore hello) ha solo toobe il provisioning tooservice anziché un carico di picco di carico una Media.</span><span class="sxs-lookup"><span data-stu-id="aa126-121">Intermediating message producers and consumers with a queue means that hello consuming application (hello worker) only has toobe provisioned tooservice an average load rather than a peak load.</span></span> <span data-ttu-id="aa126-122">profondità Hello della coda di hello aumenteranno e contratto come hello in arrivo carico varia.</span><span class="sxs-lookup"><span data-stu-id="aa126-122">hello depth of hello queue will grow and contract as hello incoming load varies.</span></span> <span data-ttu-id="aa126-123">Direttamente, ciò consente di risparmiare denaro con quantità toohello considerare infrastruttura richiesto tooservice hello carico dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="aa126-123">This directly saves money with regard toohello amount of infrastructure required tooservice hello application load.</span></span>

![Figura 2 Code del bus di servizio](./media/service-bus-create-queues/IC657162.gif)

### <a name="load-balancing"></a><span data-ttu-id="aa126-125">Bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="aa126-125">Load balancing</span></span>
<span data-ttu-id="aa126-126">Aumento del carico come hello, altri processi di lavoro possono essere aggiunto tooread dalla coda di lavoro hello.</span><span class="sxs-lookup"><span data-stu-id="aa126-126">As hello load increases, more worker processes can be added tooread from hello worker queue.</span></span> <span data-ttu-id="aa126-127">Ogni messaggio viene elaborato da un solo hello di processi di lavoro.</span><span class="sxs-lookup"><span data-stu-id="aa126-127">Each message is processed by only one of hello worker processes.</span></span> <span data-ttu-id="aa126-128">Inoltre, il bilanciamento del carico basato su pull consente un uso ottimale dei computer di lavoro hello anche se il computer di lavoro hello differiscono con power tooprocessing conto, come verrà estraggono i messaggi alla propria velocità massima.</span><span class="sxs-lookup"><span data-stu-id="aa126-128">Furthermore, this pull-based load balancing allows for optimum usage of hello worker computers even if hello worker computers differ with regard tooprocessing power, as they will pull messages at their own maximum rate.</span></span> <span data-ttu-id="aa126-129">Questo modello viene spesso definito modello consumer concorrenti hello.</span><span class="sxs-lookup"><span data-stu-id="aa126-129">This pattern is often termed hello competing consumer pattern.</span></span>

![Figura 3 Code del bus di servizio](./media/service-bus-create-queues/IC657163.gif)

### <a name="loose-coupling"></a><span data-ttu-id="aa126-131">Accoppiamento di tipo loose</span><span class="sxs-lookup"><span data-stu-id="aa126-131">Loose coupling</span></span>
<span data-ttu-id="aa126-132">Utilizzo di toointermediate accodamento del messaggio tra messaggio producer e consumer fornisce un accoppiamento intrinseco tra i componenti di hello.</span><span class="sxs-lookup"><span data-stu-id="aa126-132">Using message queuing toointermediate between message producers and consumers provides an intrinsic loose coupling between hello components.</span></span> <span data-ttu-id="aa126-133">Poiché producer e consumer non sono consapevoli di altra, è possibile aggiornare un consumer senza causare alcun effetto sul producer hello.</span><span class="sxs-lookup"><span data-stu-id="aa126-133">Because producers and consumers are not aware of each other, a consumer can be upgraded without having any effect on hello producer.</span></span> <span data-ttu-id="aa126-134">Inoltre, hello topologia di messaggistica può evolvere senza influire sull'endpoint esistenti hello.</span><span class="sxs-lookup"><span data-stu-id="aa126-134">Furthermore, hello messaging topology can evolve without affecting hello existing endpoints.</span></span> <span data-ttu-id="aa126-135">Tratteremo questo in modo più approfondito quando si parlerà di pubblicazione/sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="aa126-135">We’ll discuss this more when we talk about publish/subscribe.</span></span>

## <a name="show-me-hello-code"></a><span data-ttu-id="aa126-136">Mostra il codice hello</span><span class="sxs-lookup"><span data-stu-id="aa126-136">Show me hello code</span></span>
<span data-ttu-id="aa126-137">Hello seguente sezione mostra come toouse Bus di servizio toobuild questa applicazione.</span><span class="sxs-lookup"><span data-stu-id="aa126-137">hello following section shows how toouse Service Bus toobuild this application.</span></span>

### <a name="sign-up-for-an-azure-account"></a><span data-ttu-id="aa126-138">Iscriversi a un account Azure</span><span class="sxs-lookup"><span data-stu-id="aa126-138">Sign up for an Azure account</span></span>
<span data-ttu-id="aa126-139">È necessario un account Azure in ordine toostart funziona con il Bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="aa126-139">You’ll need an Azure account in order toostart working with Service Bus.</span></span> <span data-ttu-id="aa126-140">Se non si ha già una sottoscrizione, è possibile registrarsi per un account gratuito [qui](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A85619ABF).</span><span class="sxs-lookup"><span data-stu-id="aa126-140">If you do not already have one, you can sign up for a free account [here](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A85619ABF).</span></span>

### <a name="create-a-namespace"></a><span data-ttu-id="aa126-141">Creare uno spazio dei nomi</span><span class="sxs-lookup"><span data-stu-id="aa126-141">Create a namespace</span></span>
<span data-ttu-id="aa126-142">Dopo avere creato una sottoscrizione è possibile [creare uno spazio dei nomi del servizio](service-bus-create-namespace-portal.md).</span><span class="sxs-lookup"><span data-stu-id="aa126-142">Once you have a subscription, you can [create a service namespace](service-bus-create-namespace-portal.md).</span></span> <span data-ttu-id="aa126-143">Ogni spazio dei nomi funge da contenitore di ambito per un set di entità del Bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="aa126-143">Each namespace acts as a scoping container for a set of Service Bus entities.</span></span> <span data-ttu-id="aa126-144">Assegnare al nuovo spazio dei nomi un nome univoco tra tutti gli account del Bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="aa126-144">Give your new namespace a unique name across all Service Bus accounts.</span></span> 

### <a name="install-hello-nuget-package"></a><span data-ttu-id="aa126-145">Installare il pacchetto NuGet hello</span><span class="sxs-lookup"><span data-stu-id="aa126-145">Install hello NuGet package</span></span>
<span data-ttu-id="aa126-146">spazio dei nomi Service Bus toouse hello, un'applicazione deve fare riferimento hello assembly Bus di servizio, in particolare Microsoft.ServiceBus.dll.</span><span class="sxs-lookup"><span data-stu-id="aa126-146">toouse hello Service Bus namespace, an application must reference hello Service Bus assembly, specifically Microsoft.ServiceBus.dll.</span></span> <span data-ttu-id="aa126-147">È possibile trovare questo assembly come parte di Microsoft Azure SDK hello e download di hello è disponibile all'indirizzo hello [pagina di download di Azure SDK](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="aa126-147">You can find this assembly as part of hello Microsoft Azure SDK, and hello download is available at hello [Azure SDK download page](https://azure.microsoft.com/downloads/).</span></span> <span data-ttu-id="aa126-148">Tuttavia, hello [pacchetto NuGet di Service Bus](https://www.nuget.org/packages/WindowsAzure.ServiceBus) è hello più semplice modo tooget hello API del Bus di servizio e tooconfigure l'applicazione con tutte le dipendenze di hello Bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="aa126-148">However, hello [Service Bus NuGet package](https://www.nuget.org/packages/WindowsAzure.ServiceBus) is hello easiest way tooget hello Service Bus API and tooconfigure your application with all of hello Service Bus dependencies.</span></span>

### <a name="create-hello-queue"></a><span data-ttu-id="aa126-149">Creare la coda hello</span><span class="sxs-lookup"><span data-stu-id="aa126-149">Create hello queue</span></span>
<span data-ttu-id="aa126-150">Le operazioni di gestione per il Bus di servizio, le entità di messaggistica (code e pubblicazione/sottoscrizione argomenti) vengono eseguite tramite hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) classe.</span><span class="sxs-lookup"><span data-stu-id="aa126-150">Management operations for Service Bus messaging entities (queues and publish/subscribe topics) are performed via hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) class.</span></span> <span data-ttu-id="aa126-151">Il bus di servizio usa un modello di sicurezza basato su [SAS (Shared Access Signature, Firma di accesso condiviso)](service-bus-sas.md).</span><span class="sxs-lookup"><span data-stu-id="aa126-151">Service Bus uses a [Shared Access Signature (SAS)](service-bus-sas.md) based security model.</span></span> <span data-ttu-id="aa126-152">Hello [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider) classe rappresenta un provider di token di sicurezza con metodi factory incorporati restituzione di alcuni provider di token noti.</span><span class="sxs-lookup"><span data-stu-id="aa126-152">hello [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider) class represents a security token provider with built-in factory methods returning some well-known token providers.</span></span> <span data-ttu-id="aa126-153">Si userà un [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) le credenziali di firma di accesso condiviso di metodo toohold hello.</span><span class="sxs-lookup"><span data-stu-id="aa126-153">We’ll use a [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) method toohold hello SAS credentials.</span></span> <span data-ttu-id="aa126-154">Hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) istanza viene quindi costruita con indirizzo di base di spazio dei nomi Service Bus hello e provider di token hello hello.</span><span class="sxs-lookup"><span data-stu-id="aa126-154">hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) instance is then constructed with hello base address of hello Service Bus namespace and hello token provider.</span></span>

<span data-ttu-id="aa126-155">Hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) classe fornisce metodi toocreate, enumerare ed eliminare entità di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="aa126-155">hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) class provides methods toocreate, enumerate and delete messaging entities.</span></span> <span data-ttu-id="aa126-156">Hello codice riportata di seguito viene illustrato come hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) istanza viene creata e utilizzata toocreate hello **DataCollectionQueue** coda.</span><span class="sxs-lookup"><span data-stu-id="aa126-156">hello code that is shown here shows how hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) instance is created and used toocreate hello **DataCollectionQueue** queue.</span></span>

```csharp
Uri uri = ServiceBusEnvironment.CreateServiceUri("sb", 
                "test-blog", string.Empty);
string name = "RootManageSharedAccessKey";
string key = "abcdefghijklmopqrstuvwxyz";

TokenProvider tokenProvider = 
    TokenProvider.CreateSharedAccessSignatureTokenProvider(name, key);
NamespaceManager namespaceManager = 
    new NamespaceManager(uri, tokenProvider);
namespaceManager.CreateQueue("DataCollectionQueue");
```

<span data-ttu-id="aa126-157">Si noti che esistono overload di hello [CreateQueue](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateQueue_System_String_) metodo che abilita le proprietà di hello coda toobe ottimizzati.</span><span class="sxs-lookup"><span data-stu-id="aa126-157">Note that there are overloads of hello [CreateQueue](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateQueue_System_String_) method that enable properties of hello queue toobe tuned.</span></span> <span data-ttu-id="aa126-158">Ad esempio, è possibile impostare hello time-to-live (TTL) predefinita per i messaggi inviati toohello coda.</span><span class="sxs-lookup"><span data-stu-id="aa126-158">For example, you can set hello default time-to-live (TTL) value for messages sent toohello queue.</span></span>

### <a name="send-messages-toohello-queue"></a><span data-ttu-id="aa126-159">Messaggi toohello coda di invio</span><span class="sxs-lookup"><span data-stu-id="aa126-159">Send messages toohello queue</span></span>
<span data-ttu-id="aa126-160">Per le operazioni di runtime su entità del bus di servizio, ad esempio l'invio e la ricezione di messaggi, un'applicazione deve prima creare un oggetto [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory).</span><span class="sxs-lookup"><span data-stu-id="aa126-160">For run-time operations on Service Bus entities; for example, sending and receiving messages, an application must first create a [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) object.</span></span> <span data-ttu-id="aa126-161">Toohello simile [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) classe hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) dall'indirizzo di base di spazio dei nomi servizio hello e provider di token hello hello viene creata l'istanza.</span><span class="sxs-lookup"><span data-stu-id="aa126-161">Similar toohello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) class, hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instance is created from hello base address of hello service namespace and hello token provider.</span></span>

```csharp
 BrokeredMessage bm = new BrokeredMessage(salesData);
 bm.Label = "SalesReport";
 bm.Properties["StoreName"] = "Redmond";
 bm.Properties["MachineID"] = "POS_1";
```

<span data-ttu-id="aa126-162">I messaggi inviati a e ricevuti dal Bus di servizio code sono istanze di hello [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) classe.</span><span class="sxs-lookup"><span data-stu-id="aa126-162">Messages sent to, and received from Service Bus queues are instances of hello [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) class.</span></span> <span data-ttu-id="aa126-163">Questa classe è costituita da un set di proprietà standard (ad esempio [etichetta](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) e [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), un dizionario di proprietà dell'applicazione usato toohold e un corpo di dati applicazione arbitrari.</span><span class="sxs-lookup"><span data-stu-id="aa126-163">This class consists of a set of standard properties (such as [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) and [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), a dictionary that is used toohold application properties, and a body of arbitrary application data.</span></span> <span data-ttu-id="aa126-164">Un'applicazione può impostare corpo hello passando qualsiasi oggetto serializzabile (hello seguente esempio di viene passata una **SalesData** oggetto che rappresenta i dati di vendita hello dal terminale POS hello), che verrà utilizzato hello [ DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) oggetto hello tooserialize.</span><span class="sxs-lookup"><span data-stu-id="aa126-164">An application can set hello body by passing in any serializable object (hello following example passes in a **SalesData** object that represents hello sales data from hello POS terminal), which will use hello [DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) tooserialize hello object.</span></span> <span data-ttu-id="aa126-165">In alternativa, può essere specificato un oggetto [Flusso](https://msdn.microsoft.com/library/system.io.stream.aspx).</span><span class="sxs-lookup"><span data-stu-id="aa126-165">Alternatively, a [Stream](https://msdn.microsoft.com/library/system.io.stream.aspx) object can be provided.</span></span>

<span data-ttu-id="aa126-166">Hello tooa messaggi toosend di modo più semplice al coda, il case hello **DataCollectionQueue**, è toouse [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) toocreate un [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) oggetto direttamente dal hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) istanza.</span><span class="sxs-lookup"><span data-stu-id="aa126-166">hello easiest way toosend messages tooa given queue, in our case hello **DataCollectionQueue**, is toouse [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) toocreate a [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) object directly from hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instance.</span></span>

```csharp
MessageSender sender = factory.CreateMessageSender("DataCollectionQueue");
sender.Send(bm);
```

### <a name="receiving-messages-from-hello-queue"></a><span data-ttu-id="aa126-167">Ricezione di messaggi dalla coda hello</span><span class="sxs-lookup"><span data-stu-id="aa126-167">Receiving messages from hello queue</span></span>
<span data-ttu-id="aa126-168">tooreceive messaggi dalla coda di hello, è possibile utilizzare un [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) oggetto creato direttamente tramite hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) utilizzando [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span><span class="sxs-lookup"><span data-stu-id="aa126-168">tooreceive messages from hello queue, you can use a [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) object which you create directly from hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) using [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span></span> <span data-ttu-id="aa126-169">I ricevitori dei messaggi possono lavorare in due modalità diverse: **ReceiveAndDelete** e **PeekLock**.</span><span class="sxs-lookup"><span data-stu-id="aa126-169">Message receivers can work in two different modes: **ReceiveAndDelete** and **PeekLock**.</span></span> <span data-ttu-id="aa126-170">Hello [ReceiveMode](/dotnet/api/microsoft.servicebus.messaging.receivemode) è impostato quando viene creato dal destinatario del messaggio hello, come un parametro toohello [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory?redirectedfrom=MSDN#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_Microsoft_ServiceBus_Messaging_ReceiveMode_) chiamare.</span><span class="sxs-lookup"><span data-stu-id="aa126-170">hello [ReceiveMode](/dotnet/api/microsoft.servicebus.messaging.receivemode) is set when hello message receiver is created, as a parameter toohello [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory?redirectedfrom=MSDN#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_Microsoft_ServiceBus_Messaging_ReceiveMode_) call.</span></span>

<span data-ttu-id="aa126-171">Quando si utilizza hello **ReceiveAndDelete** hello di modalità di ricezione è un'operazione singola cattura; vale a dire quando Bus di servizio riceve una richiesta di hello, contrassegna il messaggio hello come usato e lo restituisce toohello applicazione.</span><span class="sxs-lookup"><span data-stu-id="aa126-171">When using hello **ReceiveAndDelete** mode, hello receive is a single-shot operation; that is, when Service Bus receives hello request, it marks hello message as being consumed and returns it toohello application.</span></span> <span data-ttu-id="aa126-172">**ReceiveAndDelete** modalità modello più semplice di hello ed è adatta per scenari in cui hello un'applicazione può tollerare non elabora un messaggio se un errore toooccur.</span><span class="sxs-lookup"><span data-stu-id="aa126-172">**ReceiveAndDelete** mode is hello simplest model and works best for scenarios in which hello application can tolerate not processing a message if a failure were toooccur.</span></span> <span data-ttu-id="aa126-173">toounderstand, si consideri uno scenario in cui problemi relativi ai consumer hello hello di ricezione richiesta e quindi si blocca prima dell'elaborazione.</span><span class="sxs-lookup"><span data-stu-id="aa126-173">toounderstand this, consider a scenario in which hello consumer issues hello receive request and then crashes before processing it.</span></span> <span data-ttu-id="aa126-174">Poiché il Bus di servizio è contrassegnato come messaggio come usato, quando riavvio dell'applicazione hello e inizia a usare nuovamente, i messaggi risulterà perso messaggio hello utilizzato prima dell'arresto anomalo di hello.</span><span class="sxs-lookup"><span data-stu-id="aa126-174">Since Service Bus marked hello message as being consumed, when hello application restarts and starts consuming messages again, it will have missed hello message that was consumed before hello crash.</span></span>

<span data-ttu-id="aa126-175">In **PeekLock** hello di modalità di ricezione diventa un'operazione in due fasi, che rende possibile toosupport applicazioni che non sono in grado di tollerare messaggi mancanti.</span><span class="sxs-lookup"><span data-stu-id="aa126-175">In **PeekLock** mode, hello receive becomes a two-stage operation, which makes it possible toosupport applications that cannot tolerate missing messages.</span></span> <span data-ttu-id="aa126-176">Quando il Bus di servizio riceve una richiesta di hello, trova hello successivo messaggio toobe utilizzati Blocca tooprevent altri consumer di ricezione e lo restituisce quindi toohello applicazione.</span><span class="sxs-lookup"><span data-stu-id="aa126-176">When Service Bus receives hello request, it finds hello next message toobe consumed, locks it tooprevent other consumers receiving it, and then returns it toohello application.</span></span> <span data-ttu-id="aa126-177">Dopo l'applicazione hello completa l'elaborazione messaggio hello o archiviarlo in modo affidabile per l'elaborazione futura, completa hello seconda fase di hello ricevere processo chiamando [completa](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) nel messaggio ricevuto.</span><span class="sxs-lookup"><span data-stu-id="aa126-177">After hello application finishes processing hello message (or stores it reliably for future processing), it completes hello second stage of hello receive process by calling [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) on hello received message.</span></span> <span data-ttu-id="aa126-178">Quando il Bus di servizio rileva hello [completa](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) chiamata, contrassegna il messaggio hello come usato.</span><span class="sxs-lookup"><span data-stu-id="aa126-178">When Service Bus sees hello [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) call, it marks hello message as being consumed.</span></span>

<span data-ttu-id="aa126-179">Sono possibili altri due risultati.</span><span class="sxs-lookup"><span data-stu-id="aa126-179">Two other outcomes are possible.</span></span> <span data-ttu-id="aa126-180">Innanzitutto, se è in grado di un'applicazione hello tooprocess hello messaggio per qualche motivo, è possibile chiamare [abbandonare](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) nel messaggio ricevuto (invece di [completa](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete)).</span><span class="sxs-lookup"><span data-stu-id="aa126-180">First, if hello application is unable tooprocess hello message for some reason, it can call [Abandon](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) on hello received message (instead of [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete)).</span></span> <span data-ttu-id="aa126-181">In questo modo messaggio hello toounlock del Bus di servizio e renderlo disponibile toobe nuovamente ricevuto, tramite hello stesso consumer o da un altro consumer concorrente.</span><span class="sxs-lookup"><span data-stu-id="aa126-181">This causes Service Bus toounlock hello message and make it available toobe received again, either by hello same consumer or by another completing consumer.</span></span> <span data-ttu-id="aa126-182">In secondo luogo, vi è un timeout associato hello blocco e, se l'applicazione hello Impossibile elaborare il messaggio hello prima che il timeout di blocco hello scade (ad esempio, se si blocca l'applicazione hello), quindi verrà sbloccato Bus di servizio hello messaggio e renderlo disponibile toobe ricevuto nuovo (esecuzione essenzialmente un [abbandonare](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) operazione per impostazione predefinita).</span><span class="sxs-lookup"><span data-stu-id="aa126-182">Second, there is a time-out associated with hello lock and if hello application cannot process hello message before hello lock time-out expires (for example, if hello application crashes), then Service Bus will unlock hello message and make it available toobe received again (essentially performing an [Abandon](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) operation by default).</span></span>

<span data-ttu-id="aa126-183">Si noti che se hello applicazione si blocca dopo l'elaborazione messaggio hello ma prima di hello [completa](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) richiesta inoltrata, il messaggio hello sarà applicazione toohello consegnati nuovamente dopo il riavvio.</span><span class="sxs-lookup"><span data-stu-id="aa126-183">Note that if hello application crashes after it processes hello message but before hello [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) request was issued, hello message will be redelivered toohello application when it restarts.</span></span> <span data-ttu-id="aa126-184">Questo è spesso definito * almeno una volta * l'elaborazione.</span><span class="sxs-lookup"><span data-stu-id="aa126-184">This is often termed *At Least Once * processing.</span></span> <span data-ttu-id="aa126-185">Ciò significa che ogni messaggio verrà elaborato almeno una volta ma in hello determinate situazioni potrebbe essere recapitato nuovamente stesso messaggio.</span><span class="sxs-lookup"><span data-stu-id="aa126-185">This means that each message will be processed at least once but in certain situations hello same message may be redelivered.</span></span> <span data-ttu-id="aa126-186">Se hello scenario non tollera la doppia elaborazione, sarà necessaria logica aggiuntiva dei duplicati di toodetect applicazione hello.</span><span class="sxs-lookup"><span data-stu-id="aa126-186">If hello scenario cannot tolerate duplicate processing, then additional logic is required in hello application toodetect duplicates.</span></span> <span data-ttu-id="aa126-187">Ciò può essere ottenuto in base a hello [MessageId](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId) proprietà del messaggio hello.</span><span class="sxs-lookup"><span data-stu-id="aa126-187">This can be achieved based on hello [MessageId](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId) property of hello message.</span></span> <span data-ttu-id="aa126-188">il valore di Hello di questa proprietà rimane costante tra i tentativi di recapito.</span><span class="sxs-lookup"><span data-stu-id="aa126-188">hello value of this property remains constant across delivery attempts.</span></span> <span data-ttu-id="aa126-189">In questo caso si parla di elaborazione *Una sola volta*.</span><span class="sxs-lookup"><span data-stu-id="aa126-189">This is termed *Exactly Once* processing.</span></span>

<span data-ttu-id="aa126-190">riceve Hello codice riportata di seguito ed elabora un messaggio hello utilizzando **PeekLock** modalità, che è hello predefinito se non [ReceiveMode](/dotnet/api/microsoft.servicebus.messaging.receivemode) valore viene fornito in modo esplicito.</span><span class="sxs-lookup"><span data-stu-id="aa126-190">hello code that is shown here receives and processes a message using hello **PeekLock** mode, which is hello default if no [ReceiveMode](/dotnet/api/microsoft.servicebus.messaging.receivemode) value is explicitly provided.</span></span>

```csharp
MessageReceiver receiver = factory.CreateMessageReceiver("DataCollectionQueue");
BrokeredMessage receivedMessage = receiver.Receive();
try
{
    ProcessMessage(receivedMessage);
    receivedMessage.Complete();
}
catch (Exception e)
{
    receivedMessage.Abandon();
}
```

### <a name="use-hello-queue-client"></a><span data-ttu-id="aa126-191">Utilizzare il client di coda hello</span><span class="sxs-lookup"><span data-stu-id="aa126-191">Use hello queue client</span></span>
<span data-ttu-id="aa126-192">Negli esempi precedenti in questa sezione creato Hello [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) e [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) oggetti direttamente da hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) toosend e ricevere messaggi dalla coda di hello, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="aa126-192">hello examples earlier in this section created [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) and [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) objects directly from hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) toosend and receive messages from hello queue, respectively.</span></span> <span data-ttu-id="aa126-193">Un approccio alternativo consiste toouse un [QueueClient](/dotnet/api/microsoft.servicebus.messaging.queueclient) oggetto, che supporta sia Invia e ricezione le operazioni in aggiunta toomore funzionalità avanzate, ad esempio le sessioni.</span><span class="sxs-lookup"><span data-stu-id="aa126-193">An alternative approach is toouse a [QueueClient](/dotnet/api/microsoft.servicebus.messaging.queueclient) object, which supports both send and receive operations in addition toomore advanced features, such as sessions.</span></span>

```csharp
QueueClient queueClient = factory.CreateQueueClient("DataCollectionQueue");
queueClient.Send(bm);

BrokeredMessage message = queueClient.Receive();

try
{
    ProcessMessage(message);
    message.Complete();
}
catch (Exception e)
{
    message.Abandon();
} 
```

## <a name="next-steps"></a><span data-ttu-id="aa126-194">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="aa126-194">Next steps</span></span>
<span data-ttu-id="aa126-195">Dopo aver appreso nozioni fondamentali di hello di code, vedere [creare applicazioni che utilizzano gli argomenti del Bus di servizio e le sottoscrizioni](service-bus-create-topics-subscriptions.md) toocontinue questa discussione con funzionalità di pubblicazione/sottoscrizione hello di argomenti del Bus di servizio e sottoscrizioni.</span><span class="sxs-lookup"><span data-stu-id="aa126-195">Now that you've learned hello basics of queues, see [Create applications that use Service Bus topics and subscriptions](service-bus-create-topics-subscriptions.md) toocontinue this discussion using hello publish/subscribe capabilities of Service Bus topics and subscriptions.</span></span>

