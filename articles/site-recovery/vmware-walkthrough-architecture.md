---
title: Esaminare l'architettura per la replica VMware in Azure | Microsoft Docs
description: Questo articolo fornisce una panoramica dei componenti e dell'architettura usati durante la replica di VM VMware locali in Azure con il servizio Azure Site Recovery
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27.017
ms.author: raynew
ms.openlocfilehash: 4aae04a793bab11562c20ceec0e1ae8f1a035a0f
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="step-1-review-the-architecture-for-vmware-replication-to-azure"></a><span data-ttu-id="1eba2-103">Passaggio 1: Esaminare l'architettura per la replica VMware in Azure</span><span class="sxs-lookup"><span data-stu-id="1eba2-103">Step 1: Review the architecture for VMware replication to Azure</span></span>

<span data-ttu-id="1eba2-104">Questo articolo illustra i componenti e i processi interessati durante la replica di macchine virtuali VMware locali in Azure usando il servizio [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="1eba2-104">This article describes the components and processes used when replicating on-premises VMware virtual machines to Azure using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="1eba2-105">È possibile inserire commenti alla fine di questo articolo oppure porre domande nel [forum sui Servizi di ripristino di Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="1eba2-105">Post any comments at the bottom of this article, or ask questions in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="1eba2-106">Componenti dell'architettura</span><span class="sxs-lookup"><span data-stu-id="1eba2-106">Architectural components</span></span>

<span data-ttu-id="1eba2-107">La tabella riepiloga i componenti necessari.</span><span class="sxs-lookup"><span data-stu-id="1eba2-107">The table summarizes the components you need.</span></span>

<span data-ttu-id="1eba2-108">**Componente**</span><span class="sxs-lookup"><span data-stu-id="1eba2-108">**Component**</span></span> | <span data-ttu-id="1eba2-109">**Requisito**</span><span class="sxs-lookup"><span data-stu-id="1eba2-109">**Requirement**</span></span> | <span data-ttu-id="1eba2-110">**Dettagli**</span><span class="sxs-lookup"><span data-stu-id="1eba2-110">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="1eba2-111">**Azzurro**</span><span class="sxs-lookup"><span data-stu-id="1eba2-111">**Azure**</span></span> | <span data-ttu-id="1eba2-112">Sono necessari una sottoscrizione di Azure, un account di archiviazione di Azure e una rete di Azure.</span><span class="sxs-lookup"><span data-stu-id="1eba2-112">You need an Azure subscription, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="1eba2-113">I dati replicati vengono archiviati nell'account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="1eba2-113">Replicated data is stored in the storage account.</span></span> <span data-ttu-id="1eba2-114">Quando si verifica un failover dal sito locale, vengono create le VM di Azure con i dati replicati.</span><span class="sxs-lookup"><span data-stu-id="1eba2-114">Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span></span> <span data-ttu-id="1eba2-115">Le VM di Azure si connettono alla rete virtuale di Azure quando vengono create.</span><span class="sxs-lookup"><span data-stu-id="1eba2-115">The Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="1eba2-116">**Server di configurazione**</span><span class="sxs-lookup"><span data-stu-id="1eba2-116">**Configuration server**</span></span> | <span data-ttu-id="1eba2-117">Un singolo server di gestione locale (VM VMware) che esegue tutti i componenti locali di Site Recovery per la distribuzione.</span><span class="sxs-lookup"><span data-stu-id="1eba2-117">A single on-premises management server (VMware VM) that runs all the on-premises Site Recovery components for the deployment.</span></span> <span data-ttu-id="1eba2-118">Sono inclusi un server di configurazione, un server di elaborazione e un server di destinazione master.</span><span class="sxs-lookup"><span data-stu-id="1eba2-118">These include a configuration server, process server, master target server.</span></span> | <span data-ttu-id="1eba2-119">Il componente server di configurazione coordina le comunicazioni tra i componenti locali e Azure e gestisce la replica dei dati.</span><span class="sxs-lookup"><span data-stu-id="1eba2-119">The configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="1eba2-120">**Server di elaborazione**</span><span class="sxs-lookup"><span data-stu-id="1eba2-120">**Process server**:</span></span>  | <span data-ttu-id="1eba2-121">Installato per impostazione predefinita nel server di configurazione.</span><span class="sxs-lookup"><span data-stu-id="1eba2-121">Installed by default on the configuration server.</span></span> | <span data-ttu-id="1eba2-122">Agisce come un gateway di replica.</span><span class="sxs-lookup"><span data-stu-id="1eba2-122">Acts as a replication gateway.</span></span> <span data-ttu-id="1eba2-123">Riceve i dati di replica, li ottimizza attraverso la memorizzazione nella cache, la compressione e la crittografia e li invia all'archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="1eba2-123">Receives replication data, optimizes it with caching, compression, and encryption, and sends it to Azure storage.</span></span><br/><br/> <span data-ttu-id="1eba2-124">Il server di elaborazione gestisce anche l'installazione push del servizio Mobility nei computer protetti ed esegue l'individuazione automatica delle VM VMware.</span><span class="sxs-lookup"><span data-stu-id="1eba2-124">The process server also handles push installation of the Mobility service to protected machines, and performs automatic discovery of VMware VMs.</span></span><br/><br/> <span data-ttu-id="1eba2-125">Man mano che la distribuzione cresce, è possibile aggiungere altri server di elaborazione dedicati e distinti per gestire i volumi più elevati di traffico di replica.</span><span class="sxs-lookup"><span data-stu-id="1eba2-125">As your deployment grows you can add additional separate dedicated process servers to handle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="1eba2-126">**Server master di destinazione**</span><span class="sxs-lookup"><span data-stu-id="1eba2-126">**Master target server**</span></span> | <span data-ttu-id="1eba2-127">Installato per impostazione predefinita nel server di configurazione locale.</span><span class="sxs-lookup"><span data-stu-id="1eba2-127">Installed by default on the on-premises configuration server.</span></span> | <span data-ttu-id="1eba2-128">Gestisce i dati di replica durante il failback da Azure.</span><span class="sxs-lookup"><span data-stu-id="1eba2-128">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="1eba2-129">Se i volumi del traffico di failback sono elevati, è possibile distribuire un server di destinazione master separato per il failback.</span><span class="sxs-lookup"><span data-stu-id="1eba2-129">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="1eba2-130">**Server VMware**</span><span class="sxs-lookup"><span data-stu-id="1eba2-130">**VMware servers**</span></span> | <span data-ttu-id="1eba2-131">Le macchine virtuali VMware sono ospitate nei server vSphere ESXi e si consiglia un server vCenter per la gestione degli host.</span><span class="sxs-lookup"><span data-stu-id="1eba2-131">VMware VMs are hosted on vSphere ESXi servers, and we recommend a vCenter server to manage the hosts.</span></span> | <span data-ttu-id="1eba2-132">È possibile aggiungere server VMware all'insieme di credenziali di Servizi di ripristino.</span><span class="sxs-lookup"><span data-stu-id="1eba2-132">You add VMware servers to your Recovery Services vault.</span></span>
<span data-ttu-id="1eba2-133">**Computer replicati**</span><span class="sxs-lookup"><span data-stu-id="1eba2-133">**Replicated machines**</span></span> | <span data-ttu-id="1eba2-134">Il servizio Mobility verrà installato in ogni VM VMware di cui viene eseguita la replica.</span><span class="sxs-lookup"><span data-stu-id="1eba2-134">The Mobility service will be installed on each VMware VM you replicate.</span></span> <span data-ttu-id="1eba2-135">Può essere installato manualmente in ogni computer o con un'installazione push dal server di elaborazione.</span><span class="sxs-lookup"><span data-stu-id="1eba2-135">It can be installed manually on each machine, or with a push installation from the process server.</span></span>

<span data-ttu-id="1eba2-136">**Figura 1: Componenti da VMware ad Azure**</span><span class="sxs-lookup"><span data-stu-id="1eba2-136">**Figure 1: VMware to Azure components**</span></span>

![Componenti](./media/vmware-walkthrough-architecture/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="1eba2-138">Processo di replica</span><span class="sxs-lookup"><span data-stu-id="1eba2-138">Replication process</span></span>

1. <span data-ttu-id="1eba2-139">Si configura la distribuzione, inclusi i componenti locali e di Azure.</span><span class="sxs-lookup"><span data-stu-id="1eba2-139">You set up the deployment, including on-premises and Azure components.</span></span> <span data-ttu-id="1eba2-140">Nell'insieme di credenziali di Servizi di ripristino si specificano l'origine e la destinazione della replica, si imposta il server di configurazione, si creano criteri di replica, si distribuisce il servizio Mobility, si abilita la replica e si esegue un failover di test.</span><span class="sxs-lookup"><span data-stu-id="1eba2-140">In the Recovery Services vault, you specify the replication source and target, set up the configuration server, create a replication policy, deploy the Mobility service, enable replication, and run a test failover.</span></span>
2. <span data-ttu-id="1eba2-141">La replica avviene in base ai criteri di replica e viene eseguita la replica di una copia iniziale dei dati in Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="1eba2-141">Machines replicate in accordance with the replication policy, and an initial copy of the data is replicated to Azure storage.</span></span>
3. <span data-ttu-id="1eba2-142">Al termine della replica iniziale, viene avviata la replica differenziale in Azure.</span><span class="sxs-lookup"><span data-stu-id="1eba2-142">After initial replication finishes, replication of delta changes to Azure begins.</span></span> <span data-ttu-id="1eba2-143">Le modifiche rilevate vengono salvate in un file HRL.</span><span class="sxs-lookup"><span data-stu-id="1eba2-143">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="1eba2-144">I computer di replica comunicano con il server di configurazione tramite la porta HTTPS 443 in ingresso, per la gestione delle repliche.</span><span class="sxs-lookup"><span data-stu-id="1eba2-144">Replicating machines communicate with the configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="1eba2-145">I computer di replica inviano i dati di replica al server di elaborazione sulla porta HTTPS 9443 in ingresso (configurabile).</span><span class="sxs-lookup"><span data-stu-id="1eba2-145">Replicating machines send replication data to the process server on port HTTPS 9443 inbound (can be modified).</span></span>
    - <span data-ttu-id="1eba2-146">Il server di configurazione orchestra la gestione delle repliche con Azure tramite la porta HTTPS 443 in uscita.</span><span class="sxs-lookup"><span data-stu-id="1eba2-146">The configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="1eba2-147">Il server di elaborazione riceve i dati dai computer di origine, li ottimizza e li crittografa e li invia ad Archiviazione di Azure tramite la porta 443 in uscita.</span><span class="sxs-lookup"><span data-stu-id="1eba2-147">The process server receives data from source machines, optimizes and encrypts it, and sends it to Azure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="1eba2-148">Se si abilita la coerenza tra più VM, i computer del gruppo di replica comunicano tra loro tramite la porta 20004.</span><span class="sxs-lookup"><span data-stu-id="1eba2-148">If you enable multi-VM consistency, then machines in the replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="1eba2-149">La coerenza tra più VM viene usata se si raggruppano più computer in gruppi di replica che condividono punti di ripristino coerenti con l'arresto anomalo del sistema e coerenti con l'app quando si esegue il failover.</span><span class="sxs-lookup"><span data-stu-id="1eba2-149">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="1eba2-150">È utile se i computer eseguono lo stesso carico di lavoro e devono essere coerenti.</span><span class="sxs-lookup"><span data-stu-id="1eba2-150">This is useful if machines are running the same workload and need to be consistent.</span></span>
4. <span data-ttu-id="1eba2-151">Il traffico viene replicato negli endpoint pubblici di archiviazione di Azure, tramite Internet.</span><span class="sxs-lookup"><span data-stu-id="1eba2-151">Traffic is replicated to Azure storage public endpoints, over the internet.</span></span> <span data-ttu-id="1eba2-152">In alternativa, è possibile usare il [peering pubblico](../expressroute/expressroute-circuit-peerings.md#public-peering) di Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="1eba2-152">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="1eba2-153">La replica del traffico tramite una VPN da sito a sito da un sito locale ad Azure non è supportata.</span><span class="sxs-lookup"><span data-stu-id="1eba2-153">Replicating traffic over a site-to-site VPN from an on-premises site to Azure isn't supported.</span></span>


<span data-ttu-id="1eba2-154">**Figura 2: Replica VMware in Azure**</span><span class="sxs-lookup"><span data-stu-id="1eba2-154">**Figure 2: VMware to Azure replication**</span></span>

![Avanzato](./media/vmware-walkthrough-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="1eba2-156">Processo di failover e failback</span><span class="sxs-lookup"><span data-stu-id="1eba2-156">Failover and failback process</span></span>

1. <span data-ttu-id="1eba2-157">Dopo aver verificato che il failover di test funzioni come previsto, è possibile eseguire failover non pianificati in Azure in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="1eba2-157">After you verify that test failover is working as expected, you can run unplanned failovers to Azure as required.</span></span> <span data-ttu-id="1eba2-158">Il failover pianificato non è supportato.</span><span class="sxs-lookup"><span data-stu-id="1eba2-158">Planned failover isn't supported.</span></span>
2. <span data-ttu-id="1eba2-159">È possibile effettuare il failover di un solo computer o creare [piani di ripristino](site-recovery-create-recovery-plans.md) per il failover di più macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="1eba2-159">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), to fail over multiple VMs.</span></span>
3. <span data-ttu-id="1eba2-160">Quando si esegue un failover, vengono create VM di replica in Azure.</span><span class="sxs-lookup"><span data-stu-id="1eba2-160">When you run a failover, replica VMs are created in Azure.</span></span> <span data-ttu-id="1eba2-161">Si esegue il commit di un failover per avviare l'accesso al carico di lavoro dalla VM di Azure di replica.</span><span class="sxs-lookup"><span data-stu-id="1eba2-161">You commit a failover to start accessing the workload from the replica Azure VM.</span></span>
4. <span data-ttu-id="1eba2-162">Quando il sito locale primario è di nuovo disponibile, è possibile effettuare il failback.</span><span class="sxs-lookup"><span data-stu-id="1eba2-162">When your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="1eba2-163">Si configura un'infrastruttura di failback, si avvia la replica del computer dal sito secondario a quello primario e si esegue un failover non pianificato dal sito secondario.</span><span class="sxs-lookup"><span data-stu-id="1eba2-163">You set up a failback infrastructure, start replicating the machine from the secondary site to the primary, and run an unplanned failover from the secondary site.</span></span> <span data-ttu-id="1eba2-164">Dopo il commit di questo failover, i dati saranno di nuovo locali e sarà necessario abilitare ancora la replica in Azure.</span><span class="sxs-lookup"><span data-stu-id="1eba2-164">After you commit this failover, data will be back on-premises, and you need to enable replication to Azure again.</span></span> [<span data-ttu-id="1eba2-165">Altre informazioni</span><span class="sxs-lookup"><span data-stu-id="1eba2-165">Learn more</span></span>](site-recovery-failback-azure-to-vmware.md)

<span data-ttu-id="1eba2-166">Esistono alcuni requisiti per il failback:</span><span class="sxs-lookup"><span data-stu-id="1eba2-166">There are a few failback requirements:</span></span>


- <span data-ttu-id="1eba2-167">**Server di elaborazione temporaneo in Azure**: se si vuole eseguire il failback da Azure dopo il failover, è necessario impostare una VM di Azure configurata come server di elaborazione per gestire la replica da Azure.</span><span class="sxs-lookup"><span data-stu-id="1eba2-167">**Temporary process server in Azure**: If you want to fail back from Azure after failover you'll need to set up an Azure VM configured as a process server, to handle replication from Azure.</span></span> <span data-ttu-id="1eba2-168">Questa VM può essere eliminata al termine del failback.</span><span class="sxs-lookup"><span data-stu-id="1eba2-168">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="1eba2-169">**Connessione VPN**: per eseguire il failback è necessaria una connessione VPN, oppure Azure ExpressRoute, configurata dalla rete di Azure al sito locale.</span><span class="sxs-lookup"><span data-stu-id="1eba2-169">**VPN connection**: For failback you'll need a VPN connection (or Azure ExpressRoute) set up from the Azure network to the on-premises site.</span></span>
- <span data-ttu-id="1eba2-170">**Server di destinazione master locale distinto**: il server di destinazione master locale gestisce il failback.</span><span class="sxs-lookup"><span data-stu-id="1eba2-170">**Separate on-premises master target server**: The on-premises master target server handles failback.</span></span> <span data-ttu-id="1eba2-171">Il server di destinazione master viene installato per impostazione predefinita nel server di gestione, ma se si esegue il failback di volumi di traffico più grandi, è consigliabile configurare un server di destinazione master locale distinto a questo scopo.</span><span class="sxs-lookup"><span data-stu-id="1eba2-171">The master target server is installed by default on the management server, but if you're failing back larger volumes of traffic you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="1eba2-172">**Criteri di failback**: per eseguire la replica nel sito locale, è necessario un criterio di failback,</span><span class="sxs-lookup"><span data-stu-id="1eba2-172">**Failback policy**: To replicate back to your on-premises site, you need a failback policy.</span></span> <span data-ttu-id="1eba2-173">che viene creato automaticamente quando si crea il criterio di replica.</span><span class="sxs-lookup"><span data-stu-id="1eba2-173">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="1eba2-174">**Infrastruttura VMware**: è necessario eseguire il failback a una macchina virtuale VMware locale.</span><span class="sxs-lookup"><span data-stu-id="1eba2-174">**VMware infrastructure**: You must fail back to an on-premises VMware VM.</span></span> <span data-ttu-id="1eba2-175">Questo significa che è necessaria un'infrastruttura VMware locale, anche se si esegue la replica di server fisici locali in Azure.</span><span class="sxs-lookup"><span data-stu-id="1eba2-175">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers to Azure.</span></span>

<span data-ttu-id="1eba2-176">**Figura 3: Failback VMware/fisico**</span><span class="sxs-lookup"><span data-stu-id="1eba2-176">**Figure 3: VMware/physical failback**</span></span>

![Failback](./media/vmware-walkthrough-architecture/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="1eba2-178">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="1eba2-178">Next steps</span></span>

<span data-ttu-id="1eba2-179">Andare a [Passaggio 2: Esaminare i prerequisiti e le limitazioni](vmware-walkthrough-prerequisites.md)</span><span class="sxs-lookup"><span data-stu-id="1eba2-179">Go to [Step 2: Verify prerequisites and limitations](vmware-walkthrough-prerequisites.md)</span></span>
