---
title: Eseguire un failover di test per la replica Hyper-V (con System Center VMM) in Azure | Microsoft Docs
description: Riepiloga i passaggi necessari per eseguire un failover di test per le VM Hyper-V nei cloud VMM di cui viene eseguita la replica in Azure usando il servizio Azure Site Recovery.
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 7b562a23-7ba7-48ee-905d-c22b4b5d6466
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 07/25/2017
ms.author: raynew
ms.openlocfilehash: 4688fc4bc74a9e0e04487cfbe965006070fd9a7b
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/29/2017
---
# <a name="step-11-run-a-test-failover-for-hyper-v-replication-with-vmm-to-azure"></a><span data-ttu-id="d7aa9-103">Passaggio 11: Eseguire un failover di test per la replica Hyper-V (con VMM) in Azure</span><span class="sxs-lookup"><span data-stu-id="d7aa9-103">Step 11: Run a test failover for Hyper-V replication (with VMM) to Azure</span></span>

<span data-ttu-id="d7aa9-104">Dopo avere [abilitato la replica per VM Hyper-V](vmm-to-azure-walkthrough-enable-replication.md), usare le istruzioni disponibili in questo articolo per eseguire un failover di test dalle macchine virtuali Hyper-V locali gestite in cloud System Center Virtual Machine Manager (VMM) in Azure tramite il servizio [Azure Site Recovery](site-recovery-overview.md) nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-104">After you [enable replication for Hyper-V VMs](vmm-to-azure-walkthrough-enable-replication.md), use this article to run a test failover from  on-premises Hyper-V virtual machines managed in System Center Virtual Machine Manager (VMM) clouds to Azure, using the [Azure Site Recovery](site-recovery-overview.md) service in the Azure portal.</span></span>

<span data-ttu-id="d7aa9-105">Inserire commenti e domande nella parte inferiore di questo articolo oppure nel [forum sui servizi di ripristino di Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="d7aa9-105">Post comments and questions at the bottom of this article, or on the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

## <a name="before-you-start"></a><span data-ttu-id="d7aa9-106">Prima di iniziare</span><span class="sxs-lookup"><span data-stu-id="d7aa9-106">Before you start</span></span>

<span data-ttu-id="d7aa9-107">Prima di eseguire un failover di test, è consigliabile verificare le proprietà delle VM e apportare eventuali modifiche necessarie.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-107">Before you run a test failover we recommend that you verify the VM properties, and make any changes you need to.</span></span> <span data-ttu-id="d7aa9-108">È possibile accedere alle proprietà delle VM in **Elementi replicati**.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-108">you can access the VM properties in **Replicated items**.</span></span> <span data-ttu-id="d7aa9-109">Il pannello **Informazioni di base** visualizza informazioni sulle impostazioni e sullo stato dei computer.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-109">The **Essentials** blade shows information about machines settings and status.</span></span>

## <a name="managed-disk-considerations"></a><span data-ttu-id="d7aa9-110">Considerazioni su Managed Disks</span><span class="sxs-lookup"><span data-stu-id="d7aa9-110">Managed disk considerations</span></span>

<span data-ttu-id="d7aa9-111">[Managed Disks](../virtual-machines/windows/managed-disks-overview.md) semplifica la gestione dei dischi per le VM di Azure grazie alla gestione degli account di archiviazione associati ai dischi delle VM.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-111">[Managed disks](../virtual-machines/windows/managed-disks-overview.md) simplify disk management for Azure VMs, by managing the storage accounts associated with the VM disks.</span></span> 

- <span data-ttu-id="d7aa9-112">I dischi di Managed Disks vengono creati e collegati alla VM solo in caso di failover in Azure.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-112">Managed disks are created and attached to the VM only when a failover to Azure occurs.</span></span> <span data-ttu-id="d7aa9-113">Abilitando la protezione, i dati delle VM locali vengono replicati negli account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-113">When you enable protection, data from on-premises VMs replicates to storage accounts.</span></span>
- <span data-ttu-id="d7aa9-114">È possibile creare dischi di Managed Disks solo per le VM distribuite tramite il modello di distribuzione Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-114">Managed disks can be created only for VMs that are deployed using the Resource manager deployment model.</span></span>
- <span data-ttu-id="d7aa9-115">Il failback da Azure a un ambiente Hyper-V locale non è al momento supportato per i computer con Managed Disks.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-115">Failback from Azure to an on-premises Hyper-V environment is not currently supported for machines with managed disks.</span></span> <span data-ttu-id="d7aa9-116">Impostare **Usa il servizio Managed Disks** su **Sì** solo se si sta eseguendo esclusivamente una migrazione (failover in Azure senza failback)</span><span class="sxs-lookup"><span data-stu-id="d7aa9-116">You should only set **Use managed disks** to **Yes** if you're doing a migration only (failover to Azure without failback)</span></span>
- <span data-ttu-id="d7aa9-117">Quando questa impostazione è abilitata, possono essere selezionati solo i set di disponibilità in gruppi di risorse con l'impostazione **Usa il servizio Managed Disks** abilitata.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-117">With this setting enabled, only availability sets in Resource Groups that have **Use managed disks** enabled can be selected.</span></span> <span data-ttu-id="d7aa9-118">Le VM con Managed Disks devono trovarsi nei set di disponibilità con l'opzione **Usa il servizio Managed Disks** impostata su **Sì**.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-118">VMs with managed disks must be in availability sets with **Use managed disks** set to **Yes**.</span></span> <span data-ttu-id="d7aa9-119">Se l'impostazione non è abilitata per le VM, possono essere selezionati solo i set di disponibilità nei gruppi di risorse senza Managed Disks.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-119">If the setting isn't enabled for VMs, then only availability sets in Resource Groups without managed disks enabled can be selected.</span></span> <span data-ttu-id="d7aa9-120">[Altre informazioni](../virtual-machines/windows/manage-availability.md#use-managed-disks-for-vms-in-an-availability-set).</span><span class="sxs-lookup"><span data-stu-id="d7aa9-120">[Learn more](../virtual-machines/windows/manage-availability.md#use-managed-disks-for-vms-in-an-availability-set).</span></span>
- - <span data-ttu-id="d7aa9-121">Se l'account di archiviazione usato per la replica è stato crittografato con Crittografia del servizio di archiviazione, la creazione dei dischi di Managed Disks durante il failover non riuscirà.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-121">If the storage account you use for replication has been encrypted with Storage Service Encryption, managed disks can't be created during failover.</span></span> <span data-ttu-id="d7aa9-122">In questo caso, non abilitare l'uso del servizio Managed Disks oppure disabilitare la protezione per la VM e riabilitarla per usare un account di archiviazione senza la crittografia abilitata.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-122">In this case either don't enable use of managed disks, or disable protection for the VM, and reenable it to use a storage account that doesn't have encryption enabled.</span></span> <span data-ttu-id="d7aa9-123">[Altre informazioni](../virtual-machines/windows/managed-disks-overview.md#managed-disks-and-encryption).</span><span class="sxs-lookup"><span data-stu-id="d7aa9-123">[Learn more](../virtual-machines/windows/managed-disks-overview.md#managed-disks-and-encryption).</span></span>

 
## <a name="network-considerations"></a><span data-ttu-id="d7aa9-124">Considerazioni sulla rete</span><span class="sxs-lookup"><span data-stu-id="d7aa9-124">Network considerations</span></span>
    
- <span data-ttu-id="d7aa9-125">È possibile impostare l'indirizzo IP di destinazione da usare per la VM di Azure dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-125">You can set the target IP address to be used for the Azure VM after failover.</span></span> <span data-ttu-id="d7aa9-126">Se non si specifica un indirizzo, il computer di cui è stato eseguito il failover usa DHCP.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-126">If you don't provide an address, the failed over machine will use DHCP.</span></span> <span data-ttu-id="d7aa9-127">Se si imposta un indirizzo che non è disponibile al momento del failover, il failover ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-127">If you set an address that isn't available at failover, the failover will fail.</span></span> <span data-ttu-id="d7aa9-128">Se l'indirizzo è disponibile nella rete di failover di test, è possibile usare lo stesso indirizzo IP di destinazione per il failover di test.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-128">The same target IP address can be used for test failover if the address is available in the test failover network.</span></span>
- <span data-ttu-id="d7aa9-129">Il numero di schede di rete dipende dalle dimensioni specificate per la macchina virtuale di destinazione, come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="d7aa9-129">The number of network adapters is dictated by the size you specify for the target virtual machine, as follows:</span></span>
    - <span data-ttu-id="d7aa9-130">Se il numero di schede di rete nella macchina di origine è minore o uguale al numero di schede consentite per la macchina di destinazione, la destinazione avrà lo stesso numero di schede dell’origine.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-130">If the number of network adapters on the source machine is less than or equal to the number of adapters allowed for the target machine size, then the target will have the same number of adapters as the source.</span></span>
    - <span data-ttu-id="d7aa9-131">Se il numero di schede per la macchina virtuale di origine supera il numero consentito per le dimensioni di destinazione, verrà utilizzata la dimensione di destinazione massima.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-131">If the number of adapters for the source virtual machine exceeds the number allowed for the target size then the target size maximum will be used.</span></span>
    - <span data-ttu-id="d7aa9-132">Ad esempio, se una macchina di origine dispone di due schede di rete e le dimensioni della macchina di destinazione ne supportano quattro, la macchina di destinazione avrà due schede.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-132">For example if a source machine has two network adapters and the target machine size supports four, the target machine will have two adapters.</span></span> <span data-ttu-id="d7aa9-133">Se la macchina di origine dispone di due schede ma le dimensioni di destinazione supportate ne consentono solo una, la macchina di destinazione avrà una sola scheda.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-133">If the source machine has two adapters but the supported target size only supports one then the target machine will have only one adapter.</span></span>     
- <span data-ttu-id="d7aa9-134">Se la macchina virtuale ha più schede di rete, si connetteranno tutte alla stessa rete.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-134">If the VM has multiple network adapters they will all connect to the same network.</span></span>
- <span data-ttu-id="d7aa9-135">Se la macchina virtuale ha più schede di rete, la prima nell'elenco diventa la scheda di rete *predefinita* nella macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-135">If the virtual machine has multiple network adapters then the first one shown in the list becomes the *Default* network adapter in the Azure virtual machine.</span></span>


## <a name="view-and-manage-vm-settings"></a><span data-ttu-id="d7aa9-136">Visualizzare e gestire le impostazioni delle VM</span><span class="sxs-lookup"><span data-stu-id="d7aa9-136">View and manage VM settings</span></span>

<span data-ttu-id="d7aa9-137">È consigliabile verificare le proprietà del computer di origine prima di eseguire un failover.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-137">We recommend that you verify the properties of the source machine before you run a failover.</span></span>

1. <span data-ttu-id="d7aa9-138">In **Elementi protetti** fare clic su **Elementi replicati** e quindi sulla VM.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-138">In **Protected Items**, click **Replicated Items**, and click the VM.</span></span>

    ![Abilitare la replica](./media/vmm-to-azure-walkthrough-test-failover/test-failover1.png)
2. <span data-ttu-id="d7aa9-140">Nel riquadro **Elemento replicato** è possibile vedere un riepilogo relativo a informazioni sulla VM, stato integrità e ultimi punti di recupero disponibili.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-140">In the **Replicated item** pane, you can see a summary of VM information, health status, and the latest available recovery points.</span></span> <span data-ttu-id="d7aa9-141">Fare clic su **Proprietà** per visualizzare altri dettagli.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-141">Click **Properties** to view more details.</span></span>

    ![Abilitare la replica](./media/vmm-to-azure-walkthrough-test-failover/test-failover2.png)
3. <span data-ttu-id="d7aa9-143">In **Calcolo e rete** è possibile:</span><span class="sxs-lookup"><span data-stu-id="d7aa9-143">In **Compute and Network**, you can:</span></span>
    - <span data-ttu-id="d7aa9-144">Modificare il nome della VM di Azure.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-144">Modify the Azure VM name.</span></span> <span data-ttu-id="d7aa9-145">Il nome deve soddisfare i [requisiti di Azure](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).</span><span class="sxs-lookup"><span data-stu-id="d7aa9-145">The name must meet [Azure requirements](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).</span></span>
    - <span data-ttu-id="d7aa9-146">Specificare un [gruppo di risorse] successivo al failover.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-146">Specify a post-failover [resource group].</span></span>
    - <span data-ttu-id="d7aa9-147">Specificare le dimensioni di destinazione per la VM di Azure</span><span class="sxs-lookup"><span data-stu-id="d7aa9-147">Specify a target size for the Azure VM</span></span>
    - <span data-ttu-id="d7aa9-148">Selezionare un [set di disponibilità](../virtual-machines/windows/tutorial-availability-sets.md).</span><span class="sxs-lookup"><span data-stu-id="d7aa9-148">Select an [availability set](../virtual-machines/windows/tutorial-availability-sets.md).</span></span>
    - <span data-ttu-id="d7aa9-149">Specificare se usare [Managed Disks](#managed-disk-considerations).</span><span class="sxs-lookup"><span data-stu-id="d7aa9-149">Specify whether to use [managed disks](#managed-disk-considerations).</span></span> <span data-ttu-id="d7aa9-150">Selezionare **Sì** per collegare i dischi di Managed Disks al computer nella migrazione in Azure.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-150">Select **Yes**, if you want to attach managed disks to your machine on migration to Azure.</span></span>
    - <span data-ttu-id="d7aa9-151">Visualizzare o modificare le impostazioni di rete, inclusi la rete/subnet in cui si troverà la VM di Azure dopo il failover e l'indirizzo IP che verrà assegnato a essa.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-151">View or modify network settings, including the network/subnet in which the Azure VM will be located after failover, and the IP address that will be assigned to it.</span></span>

    ![Abilitare la replica](./media/vmm-to-azure-walkthrough-test-failover/test-failover4.png)
4. <span data-ttu-id="d7aa9-153">In **Dischi** è possibile vedere le informazioni sul sistema operativo e sui dischi dati della VM.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-153">In **Disks**, you can see information about the operating system and data disks on the VM.</span></span>


## <a name="run-a-test-failover"></a><span data-ttu-id="d7aa9-154">Eseguire un failover di test</span><span class="sxs-lookup"><span data-stu-id="d7aa9-154">Run a test failover</span></span>

<span data-ttu-id="d7aa9-155">Eseguire quindi un failover di test per verificare che tutto funzioni come previsto.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-155">Now, run a test failover to make sure everything's working as expected.</span></span>

- <span data-ttu-id="d7aa9-156">Per connettersi alle VM di Azure con RDP dopo il failover, eseguire la [preparazione alla connessione](site-recovery-test-failover-to-azure.md#prepare-to-connect-to-azure-vms-after-failover).</span><span class="sxs-lookup"><span data-stu-id="d7aa9-156">If you want to connect to Azure VMs using RDP after failover, [prepare to connect](site-recovery-test-failover-to-azure.md#prepare-to-connect-to-azure-vms-after-failover).</span></span>
 - <span data-ttu-id="d7aa9-157">Per un test completo è necessario copiare Active Directory e DNS nell'ambiente di test.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-157">To fully test you need to copy of Active Directory and DNS in your test environment.</span></span> <span data-ttu-id="d7aa9-158">[Altre informazioni](site-recovery-active-directory.md#test-failover-considerations).</span><span class="sxs-lookup"><span data-stu-id="d7aa9-158">[Learn more](site-recovery-active-directory.md#test-failover-considerations).</span></span>
 - <span data-ttu-id="d7aa9-159">Per informazioni complete sul failover di test, leggere [questo articolo](site-recovery-test-failover-to-azure.md).</span><span class="sxs-lookup"><span data-stu-id="d7aa9-159">For full information about test failover, read [this article](site-recovery-test-failover-to-azure.md) article.</span></span>
 
 <span data-ttu-id="d7aa9-160">Eseguire quindi un failover:</span><span class="sxs-lookup"><span data-stu-id="d7aa9-160">Now run a failover:</span></span>

1. <span data-ttu-id="d7aa9-161">Per eseguire il failover di una singola macchina, in **Elementi replicati** fare clic sulla VM e quindi sull'icona **+Failover di test**.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-161">To fail over a single machine, in **Replicated Items**, click the VM > **+Test Failover** icon.</span></span>
2. <span data-ttu-id="d7aa9-162">Per eseguire il failover di un piano di ripristino, in **Piani di ripristino** fare clic con il pulsante destro del mouse sul piano e quindi su **Failover di test**.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-162">To fail over a recovery plan, in **Recovery Plans**, right-click the plan > **Test Failover**.</span></span> <span data-ttu-id="d7aa9-163">Per creare un piano di ripristino, [seguire queste istruzioni](site-recovery-create-recovery-plans.md).</span><span class="sxs-lookup"><span data-stu-id="d7aa9-163">To create a recovery plan, [follow these instructions](site-recovery-create-recovery-plans.md).</span></span>
3. <span data-ttu-id="d7aa9-164">In **Failover di test** selezionare la rete di Azure a cui dovranno connettersi le VM di Azure dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-164">In **Test Failover**, select the Azure network to which Azure VMs will be connected after failover occurs.</span></span>
4. <span data-ttu-id="d7aa9-165">Fare clic su **OK** per iniziare il failover.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-165">Click **OK** to begin the failover.</span></span> <span data-ttu-id="d7aa9-166">Per tenere traccia dello stato del processo, fare clic sulla VM per visualizzarne le proprietà oppure fare clic sul processo **Failover di test** nel nome dell'insieme di credenziali > **Processi** > **Site Recovery jobs** (Processi di Site Recovery).</span><span class="sxs-lookup"><span data-stu-id="d7aa9-166">You can track progress by clicking on the VM to open its properties, or on the **Test Failover** job in vault name > **Jobs** > **Site Recovery jobs**.</span></span>
5. <span data-ttu-id="d7aa9-167">Al termine del failover sarà possibile visualizzare la macchina virtuale di Azure di replica in **Macchine virtuali** nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-167">After the failover completes, you should also be able to see the replica Azure machine appear in the Azure portal > **Virtual Machines**.</span></span> <span data-ttu-id="d7aa9-168">Assicurarsi che la macchina virtuale sia delle dimensioni appropriate, che sia connessa alla rete giusta e che sia in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-168">You should make sure that the VM is the appropriate size, that it's connected to the appropriate network, and that it's running.</span></span>
6. <span data-ttu-id="d7aa9-169">Se sono state preparate le connessioni dopo il failover, sarà possibile connettersi alla VM di Azure.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-169">If you prepared for connections after failover, you should be able to connect to the Azure VM.</span></span>
7. <span data-ttu-id="d7aa9-170">Al termine, fare clic su **Cleanup test failover** (Pulizia failover di test) nel piano di ripristino.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-170">After you finish, click on **Cleanup test failover** on the recovery plan.</span></span> <span data-ttu-id="d7aa9-171">Fare clic su **Note** per registrare e salvare eventuali osservazioni associate al failover di test.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-171">In **Notes** record and save any observations associated with the test failover.</span></span> <span data-ttu-id="d7aa9-172">Verranno eliminate le macchine virtuali create durante il failover di test.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-172">This will delete the virtual machines that were created during test failover.</span></span>



## <a name="next-steps"></a><span data-ttu-id="d7aa9-173">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="d7aa9-173">Next steps</span></span>

- <span data-ttu-id="d7aa9-174">[Altre informazioni](site-recovery-failover.md) sui diversi tipi di failover e su come eseguirli.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-174">[Learn more](site-recovery-failover.md) about different types of failovers, and how to run them.</span></span>
- <span data-ttu-id="d7aa9-175">[Informazioni sul failback](site-recovery-failback-from-azure-to-hyper-v.md), per il failback e la replica di macchine virtuali di Azure nel cloud VMM locale primario.</span><span class="sxs-lookup"><span data-stu-id="d7aa9-175">[Read about failback](site-recovery-failback-from-azure-to-hyper-v.md), to fail back and replicate Azure VMs back to the primary on-premises VMM cloud.</span></span>

