---
title: Route definite dall'utente e inoltro IP in Azure | Microsoft Docs
description: Informazioni su come configurare route definite dall'utente e l'inoltro IP per inoltrare il traffico a dispositivi virtuali di rete in Azure.
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: c39076c4-11b7-4b46-a904-817503c4b486
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/15/2016
ms.author: jdial
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 6274e0101f6fb0864c8d1efaef7fcde78b8760c3
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="user-defined-routes-and-ip-forwarding"></a><span data-ttu-id="84bd5-103">Route definite dall'utente e inoltro IP</span><span class="sxs-lookup"><span data-stu-id="84bd5-103">User-defined routes and IP forwarding</span></span>

<span data-ttu-id="84bd5-104">Quando si aggiungono macchine virtuali (VM) a una rete virtuale (VNet) in Azure, si noterà che le macchine virtuali sono in grado di comunicare con altri in rete, automaticamente.</span><span class="sxs-lookup"><span data-stu-id="84bd5-104">When you add virtual machines (VMs) to a virtual network (VNet) in Azure, you will notice that the VMs are able to communicate with each other over the network, automatically.</span></span> <span data-ttu-id="84bd5-105">Non è necessario specificare un gateway, anche se le macchine virtuali si trovano in subnet diverse.</span><span class="sxs-lookup"><span data-stu-id="84bd5-105">You do not need to specify a gateway, even though the VMs are in different subnets.</span></span> <span data-ttu-id="84bd5-106">Lo stesso vale per la comunicazione tra macchine virtuali e rete Internet pubblica e anche rete locale se è presente una connessione ibrida tra Azure e il proprio Data Center.</span><span class="sxs-lookup"><span data-stu-id="84bd5-106">The same is true for communication from the VMs to the public Internet, and even to your on-premises network when a hybrid connection from Azure to your own datacenter is present.</span></span>

<span data-ttu-id="84bd5-107">Questo flusso di comunicazione è possibile perché Azure utilizza una serie di route di sistema per definire il flusso di traffico IP.</span><span class="sxs-lookup"><span data-stu-id="84bd5-107">This flow of communication is possible because Azure uses a series of system routes to define how IP traffic flows.</span></span> <span data-ttu-id="84bd5-108">I route di sistema controllano il flusso delle comunicazioni negli scenari seguenti:</span><span class="sxs-lookup"><span data-stu-id="84bd5-108">System routes control the flow of communication in the following scenarios:</span></span>

* <span data-ttu-id="84bd5-109">All'interno della stessa subnet.</span><span class="sxs-lookup"><span data-stu-id="84bd5-109">From within the same subnet.</span></span>
* <span data-ttu-id="84bd5-110">Da una subnet a altra all'interno di una rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="84bd5-110">From a subnet to another within a VNet.</span></span>
* <span data-ttu-id="84bd5-111">Da macchine virtuali a Internet.</span><span class="sxs-lookup"><span data-stu-id="84bd5-111">From VMs to the Internet.</span></span>
* <span data-ttu-id="84bd5-112">Da una rete virtuale a un'altra rete virtuale tramite un gateway VPN.</span><span class="sxs-lookup"><span data-stu-id="84bd5-112">From a VNet to another VNet through a VPN gateway.</span></span>
* <span data-ttu-id="84bd5-113">Da una rete virtuale a un'altra tramite il peering di rete virtuale (concatenamento dei servizi).</span><span class="sxs-lookup"><span data-stu-id="84bd5-113">From a VNet to another VNet through VNet Peering (Service Chaining).</span></span>
* <span data-ttu-id="84bd5-114">Da una rete virtuale alla rete locale tramite un gateway VPN.</span><span class="sxs-lookup"><span data-stu-id="84bd5-114">From a VNet to your on-premises network through a VPN gateway.</span></span>

<span data-ttu-id="84bd5-115">Nella figura seguente viene illustrato un semplice programma di installazione con una rete virtuale, due subnet e alcune macchine virtuali, con le route di sistema che consentono il flusso del traffico IP.</span><span class="sxs-lookup"><span data-stu-id="84bd5-115">The figure below shows a simple setup with a VNet, two subnets, and a few VMs, along with the system routes that allow IP traffic to flow.</span></span>

![Route di sistema in Azure](./media/virtual-networks-udr-overview/Figure1.png)

<span data-ttu-id="84bd5-117">Sebbene l'utilizzo di route del sistema faciliti il traffico automaticamente per la distribuzione, esistono casi in cui si desidera controllare il routing dei pacchetti tramite un dispositivo virtuale.</span><span class="sxs-lookup"><span data-stu-id="84bd5-117">Although the use of system routes facilitates traffic automatically for your deployment, there are cases in which you want to control the routing of packets through a virtual appliance.</span></span> <span data-ttu-id="84bd5-118">Questo è possibile tramite la creazione di route definite dall'utente che specifichino l'hop successivo per i pacchetti che passano a una subnet specifica per accedere all'applicazione virtuale e tramite l’attivazione dell'inoltro IP per la macchina virtuale in esecuzione come dispositivo virtuale.</span><span class="sxs-lookup"><span data-stu-id="84bd5-118">You can do so by creating user defined routes that specify the next hop for packets flowing to a specific subnet to go to your virtual appliance instead, and enabling IP forwarding for the VM running as the virtual appliance.</span></span>

<span data-ttu-id="84bd5-119">Nella figura seguente viene illustrato un esempio di route definite dall'utente e di inoltro IP per imporre i pacchetti inviati a una subnet da un altro per passare attraverso un dispositivo virtuale su una terza subnet.</span><span class="sxs-lookup"><span data-stu-id="84bd5-119">The figure below shows an example of user defined routes and IP forwarding to force packets sent to one subnet from another to go through a virtual appliance on a third subnet.</span></span>

![Route di sistema in Azure](./media/virtual-networks-udr-overview/Figure2.png)

> [!IMPORTANT]
> <span data-ttu-id="84bd5-121">Le route definite dall'utente vengono applicate al traffico che lascia una subnet da qualsiasi risorsa (ad esempio le interfacce di rete collegate alle VM) della subnet.</span><span class="sxs-lookup"><span data-stu-id="84bd5-121">User-defined routes are applied to traffic leaving a subnet from any resource (such as network interfaces attached to VMs) in the subnet.</span></span> <span data-ttu-id="84bd5-122">Non è possibile creare una route per specificare come il traffico entra in una subnet da Internet, ad esempio.</span><span class="sxs-lookup"><span data-stu-id="84bd5-122">You cannot create routes to specify how traffic enters a subnet from the Internet, for instance.</span></span> <span data-ttu-id="84bd5-123">Il dispositivo in cui si vuole inoltrare il traffico non può essere nella stessa subnet da cui ha origine il traffico.</span><span class="sxs-lookup"><span data-stu-id="84bd5-123">The appliance you are forwarding traffic to cannot be in the same subnet where the traffic originates.</span></span> <span data-ttu-id="84bd5-124">Creare sempre una subnet separata per i dispositivi.</span><span class="sxs-lookup"><span data-stu-id="84bd5-124">Always create a separate subnet for your appliances.</span></span> 
> 
> 

## <a name="route-resource"></a><span data-ttu-id="84bd5-125">Risorsa di route</span><span class="sxs-lookup"><span data-stu-id="84bd5-125">Route resource</span></span>
<span data-ttu-id="84bd5-126">I pacchetti vengono inoltrati attraverso una rete TCP/IP basata su una tabella di route definita in ogni nodo nella rete fisica.</span><span class="sxs-lookup"><span data-stu-id="84bd5-126">Packets are routed over a TCP/IP network based on a route table defined at each node on the physical network.</span></span> <span data-ttu-id="84bd5-127">Una tabella di route è un insieme di route singoli utilizzata per decidere dove inoltrare pacchetti in base a indirizzo IP di destinazione.</span><span class="sxs-lookup"><span data-stu-id="84bd5-127">A route table is a collection of individual routes used to decide where to forward packets based on the destination IP address.</span></span> <span data-ttu-id="84bd5-128">Una route è costituita dai seguenti elementi:</span><span class="sxs-lookup"><span data-stu-id="84bd5-128">A route consists of the following:</span></span>

| <span data-ttu-id="84bd5-129">Proprietà</span><span class="sxs-lookup"><span data-stu-id="84bd5-129">Property</span></span> | <span data-ttu-id="84bd5-130">Descrizione</span><span class="sxs-lookup"><span data-stu-id="84bd5-130">Description</span></span> | <span data-ttu-id="84bd5-131">Vincoli</span><span class="sxs-lookup"><span data-stu-id="84bd5-131">Constraints</span></span> | <span data-ttu-id="84bd5-132">Considerazioni</span><span class="sxs-lookup"><span data-stu-id="84bd5-132">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="84bd5-133">Prefisso indirizzo</span><span class="sxs-lookup"><span data-stu-id="84bd5-133">Address Prefix</span></span> |<span data-ttu-id="84bd5-134">CIDR di destinazione a cui viene applicata la route, ad esempio 10.1.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="84bd5-134">The destination CIDR to which the route applies, such as 10.1.0.0/16.</span></span> |<span data-ttu-id="84bd5-135">Deve essere un intervallo CIDR valido che rappresenta gli indirizzi sulla rete Internet pubblica, la rete virtuale di Azure o un data center locale.</span><span class="sxs-lookup"><span data-stu-id="84bd5-135">Must be a valid CIDR range representing addresses on the public Internet, Azure virtual network, or on-premises datacenter.</span></span> |<span data-ttu-id="84bd5-136">Assicurarsi che **Prefisso indirizzo** non contenga il valore di **Indirizzo hop successivo**, in caso contrario i pacchetti entreranno in un ciclo tra l'origine e l'hop successivo, senza mai raggiungere la destinazione.</span><span class="sxs-lookup"><span data-stu-id="84bd5-136">Make sure the **Address prefix** does not contain the address for the **Next hop address**, otherwise your packets will enter in a loop going from the source to the next hop without ever reaching the destination.</span></span> |
| <span data-ttu-id="84bd5-137">Tipo hop successivo</span><span class="sxs-lookup"><span data-stu-id="84bd5-137">Next hop type</span></span> |<span data-ttu-id="84bd5-138">Il tipo di hop Azure il pacchetto deve essere inviato.</span><span class="sxs-lookup"><span data-stu-id="84bd5-138">The type of Azure hop the packet should be sent to.</span></span> |<span data-ttu-id="84bd5-139">Deve essere uno dei valori seguenti: </span><span class="sxs-lookup"><span data-stu-id="84bd5-139">Must be one of the following values:</span></span> <br/> <span data-ttu-id="84bd5-140">**Rete virtuale**.</span><span class="sxs-lookup"><span data-stu-id="84bd5-140">**Virtual Network**.</span></span> <span data-ttu-id="84bd5-141">Rappresenta la rete virtuale locale.</span><span class="sxs-lookup"><span data-stu-id="84bd5-141">Represents the local virtual network.</span></span> <span data-ttu-id="84bd5-142">Se ad esempio sono presenti due subnet, 10.1.0.0/16 e 10.2.0.0/16 nella stessa rete virtuale, la route per ogni subnet nella tabella route avrà un valore di hop successivo di *Rete virtuale*.</span><span class="sxs-lookup"><span data-stu-id="84bd5-142">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in the same virtual network, the route for each subnet in the route table will have a next hop value of *Virtual Network*.</span></span> <br/> <span data-ttu-id="84bd5-143">**Gateway di rete virtuale**.</span><span class="sxs-lookup"><span data-stu-id="84bd5-143">**Virtual Network Gateway**.</span></span> <span data-ttu-id="84bd5-144">Rappresenta un Gateway VPN S2S Azure.</span><span class="sxs-lookup"><span data-stu-id="84bd5-144">Represents an Azure S2S VPN Gateway.</span></span> <br/> <span data-ttu-id="84bd5-145">**Internet**.</span><span class="sxs-lookup"><span data-stu-id="84bd5-145">**Internet**.</span></span> <span data-ttu-id="84bd5-146">Rappresenta il gateway Internet predefinito fornito dall'infrastruttura di Azure.</span><span class="sxs-lookup"><span data-stu-id="84bd5-146">Represents the default Internet gateway provided by the Azure Infrastructure.</span></span> <br/> <span data-ttu-id="84bd5-147">**Dispositivo virtuale**.</span><span class="sxs-lookup"><span data-stu-id="84bd5-147">**Virtual Appliance**.</span></span> <span data-ttu-id="84bd5-148">Rappresenta un dispositivo virtuale che aggiunto alla rete virtuale Azure.</span><span class="sxs-lookup"><span data-stu-id="84bd5-148">Represents a virtual appliance you added to your Azure virtual network.</span></span> <br/> <span data-ttu-id="84bd5-149">**Nessuno**.</span><span class="sxs-lookup"><span data-stu-id="84bd5-149">**None**.</span></span> <span data-ttu-id="84bd5-150">Rappresenta un black hole.</span><span class="sxs-lookup"><span data-stu-id="84bd5-150">Represents a black hole.</span></span> <span data-ttu-id="84bd5-151">I pacchetti inoltrati a un black hole non verranno inoltrati affatto.</span><span class="sxs-lookup"><span data-stu-id="84bd5-151">Packets forwarded to a black hole will not be forwarded at all.</span></span> |<span data-ttu-id="84bd5-152">Si consiglia di usare **appliance virtuale**  per indirizzare il traffico a una macchina virtuale o a un indirizzo IP interno di Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="84bd5-152">Consider using **Virtual Appliance** to direct traffic to a VM or Azure Load Balancer internal IP address.</span></span>  <span data-ttu-id="84bd5-153">Questo tipo consente di specificare un indirizzo IP come descritto di seguito.</span><span class="sxs-lookup"><span data-stu-id="84bd5-153">This type allows the specification of an IP address as described below.</span></span> <span data-ttu-id="84bd5-154">È consigliabile usare un tipo **Nessuno** per arrestare il flusso dei pacchetti verso una data destinazione.</span><span class="sxs-lookup"><span data-stu-id="84bd5-154">Consider using a **None** type to stop packets from flowing to a given destination.</span></span> |
| <span data-ttu-id="84bd5-155">Indirizzo hop successivo</span><span class="sxs-lookup"><span data-stu-id="84bd5-155">Next hop address</span></span> |<span data-ttu-id="84bd5-156">L'indirizzo hop successivo contiene l'indirizzo IP per inoltrare i pacchetti.</span><span class="sxs-lookup"><span data-stu-id="84bd5-156">The next hop address contains the IP address packets should be forwarded to.</span></span> <span data-ttu-id="84bd5-157">I valori di hop successivo sono consentiti solo nelle route dove il tipo di hop successivo è *dispositivo virtuale*.</span><span class="sxs-lookup"><span data-stu-id="84bd5-157">Next hop values are only allowed in routes where the next hop type is *Virtual Appliance*.</span></span> |<span data-ttu-id="84bd5-158">Deve essere un indirizzo IP raggiungibile nella rete virtuale in cui viene applicata la route definita dall'utente, senza passare per un **gateway di rete virtuale**.</span><span class="sxs-lookup"><span data-stu-id="84bd5-158">Must be an IP address that is reachable within the Virtual Network where the User Defined Route is applied, without going through a **Virtual Network Gateway**.</span></span> <span data-ttu-id="84bd5-159">L'indirizzo IP deve trovarsi nella stessa rete virtuale in cui viene applicato o in una rete virtuale con peering.</span><span class="sxs-lookup"><span data-stu-id="84bd5-159">The IP address has to be on the same Virtual Network where it is applied, or on a peered Virtual Network.</span></span> |<span data-ttu-id="84bd5-160">Se l'indirizzo IP rappresenta una macchina virtuale, assicurarsi di abilitare [Inoltro IP](#IP-forwarding) in Azure per la macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="84bd5-160">If the IP address represents a VM, make sure you enable [IP forwarding](#IP-forwarding) in Azure for the VM.</span></span> <span data-ttu-id="84bd5-161">Se l'indirizzo IP rappresenta l'indirizzo IP interno di Azure Load Balancer, assicurarsi che ci sia una regola di bilanciamento del carico corrispondente per ogni porta per cui si desidera bilanciare il carico.</span><span class="sxs-lookup"><span data-stu-id="84bd5-161">If the IP address represents the internal IP address of Azure Load Balancer, make sure you have a matching load balancing rule for each port you wish to load balance.</span></span>|

<span data-ttu-id="84bd5-162">In Azure PowerShell, alcuni dei valori di "NextHopType" hanno nomi diversi:</span><span class="sxs-lookup"><span data-stu-id="84bd5-162">In Azure PowerShell some of the "NextHopType" values have different names:</span></span>

* <span data-ttu-id="84bd5-163">Rete virtuale è VnetLocal</span><span class="sxs-lookup"><span data-stu-id="84bd5-163">Virtual Network is VnetLocal</span></span>
* <span data-ttu-id="84bd5-164">Gateway di rete virtuale è VirtualNetworkGateway</span><span class="sxs-lookup"><span data-stu-id="84bd5-164">Virtual Network Gateway is VirtualNetworkGateway</span></span>
* <span data-ttu-id="84bd5-165">Appliance virtuale è VirtualAppliance</span><span class="sxs-lookup"><span data-stu-id="84bd5-165">Virtual Appliance is VirtualAppliance</span></span>
* <span data-ttu-id="84bd5-166">Internet è Internet</span><span class="sxs-lookup"><span data-stu-id="84bd5-166">Internet is Internet</span></span>
* <span data-ttu-id="84bd5-167">Nessuno è None</span><span class="sxs-lookup"><span data-stu-id="84bd5-167">None is None</span></span>

### <a name="system-routes"></a><span data-ttu-id="84bd5-168">Route di sistema</span><span class="sxs-lookup"><span data-stu-id="84bd5-168">System routes</span></span>
<span data-ttu-id="84bd5-169">Ogni subnet creata in una rete virtuale viene associata automaticamente a una tabella di route che contiene le seguenti regole di route di sistema:</span><span class="sxs-lookup"><span data-stu-id="84bd5-169">Every subnet created in a virtual network is automatically associated with a route table that contains the following system route rules:</span></span>

* <span data-ttu-id="84bd5-170">**Regola di rete virtuale locale**: questa regola viene creata automaticamente per ogni subnet in una rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="84bd5-170">**Local Vnet Rule**: This rule is automatically created for every subnet in a virtual network.</span></span> <span data-ttu-id="84bd5-171">Specifica che vi è un collegamento diretto tra le macchine virtuali nella rete virtuale e che non esiste alcun  hop successivo intermediario.</span><span class="sxs-lookup"><span data-stu-id="84bd5-171">It specifies that there is a direct link between the VMs in the VNet and there is no intermediate next hop.</span></span>
* <span data-ttu-id="84bd5-172">**Regola Locale**: questa regola si applica a tutto il traffico destinato ad un intervallo di indirizzi locali e utilizza il gateway VPN come destinazione hop successiva.</span><span class="sxs-lookup"><span data-stu-id="84bd5-172">**On-premises Rule**: This rule applies to all traffic destined to the on-premises address range and uses VPN gateway as the next hop destination.</span></span>
* <span data-ttu-id="84bd5-173">**Regola Internet**: questa regola gestisce tutto il traffico destinato alla rete Internet pubblica (prefisso indirizzo 0.0.0.0/0) e usa il gateway Internet dell'infrastruttura come hop successivo per tutto il traffico destinato a Internet.</span><span class="sxs-lookup"><span data-stu-id="84bd5-173">**Internet Rule**: This rule handles all traffic destined to the public Internet (address prefix 0.0.0.0/0) and uses the infrastructure internet gateway as the next hop for all traffic destined to the Internet.</span></span>

### <a name="user-defined-routes"></a><span data-ttu-id="84bd5-174">Route definite dall'utente</span><span class="sxs-lookup"><span data-stu-id="84bd5-174">User-defined routes</span></span>
<span data-ttu-id="84bd5-175">Per la maggior parte degli ambienti saranno necessarie solo le route di sistema già definite da Azure.</span><span class="sxs-lookup"><span data-stu-id="84bd5-175">For most environments you will only need the system routes already defined by Azure.</span></span> <span data-ttu-id="84bd5-176">Tuttavia, è necessario creare una tabella di route e aggiungere una o più route in casi specifici, ad esempio:</span><span class="sxs-lookup"><span data-stu-id="84bd5-176">However, you may need to create a route table and add one or more routes in specific cases, such as:</span></span>

* <span data-ttu-id="84bd5-177">Il tunneling forzato a Internet tramite la rete locale.</span><span class="sxs-lookup"><span data-stu-id="84bd5-177">Force tunneling to the Internet via your on-premises network.</span></span>
* <span data-ttu-id="84bd5-178">Utilizzo di dispositivi virtuali nell'ambiente Azure.</span><span class="sxs-lookup"><span data-stu-id="84bd5-178">Use of virtual appliances in your Azure environment.</span></span>

<span data-ttu-id="84bd5-179">Negli scenari precedenti, è necessario creare una tabella di route e aggiungervi route definite dall'utente.</span><span class="sxs-lookup"><span data-stu-id="84bd5-179">In the scenarios above, you will have to create a route table and add user defined routes to it.</span></span> <span data-ttu-id="84bd5-180">È possibile avere più tabelle di routing e la stessa tabella di route può essere associata a una o più subnet.</span><span class="sxs-lookup"><span data-stu-id="84bd5-180">You can have multiple route tables, and the same route table can be associated to one or more subnets.</span></span> <span data-ttu-id="84bd5-181">E ogni subnet può essere associato a una tabella singola route.</span><span class="sxs-lookup"><span data-stu-id="84bd5-181">And each subnet can only be associated to a single route table.</span></span> <span data-ttu-id="84bd5-182">Tutte le macchine virtuali e servizi cloud in uso una subnet la tabella di route associato a tale subnet.</span><span class="sxs-lookup"><span data-stu-id="84bd5-182">All VMs and cloud services in a subnet use the route table associated to that subnet.</span></span>

<span data-ttu-id="84bd5-183">Le subnet si basano su route predefinite fino a quando una tabella di route viene associata alla subnet.</span><span class="sxs-lookup"><span data-stu-id="84bd5-183">Subnets rely on system routes until a route table is associated to the subnet.</span></span> <span data-ttu-id="84bd5-184">Una volta che esiste un’associazione,il routing viene eseguito in base alla corrispondenza più lunga del prefisso (LPM) tra le route definite dall'utente e le route predefinite.</span><span class="sxs-lookup"><span data-stu-id="84bd5-184">Once an association exists, routing is done based on Longest Prefix Match (LPM) among both user defined routes and system routes.</span></span> <span data-ttu-id="84bd5-185">Se è presente più di una route con la stessa corrispondenza LPM una route viene selezionata in base alla sua origine nell'ordine seguente:</span><span class="sxs-lookup"><span data-stu-id="84bd5-185">If there is more than one route with the same LPM match then a route is selected based on its origin in the following order:</span></span>

1. <span data-ttu-id="84bd5-186">Route definita utente</span><span class="sxs-lookup"><span data-stu-id="84bd5-186">User defined route</span></span>
2. <span data-ttu-id="84bd5-187">Route BGP (quando viene utilizzato ExpressRoute)</span><span class="sxs-lookup"><span data-stu-id="84bd5-187">BGP route (when ExpressRoute is used)</span></span>
3. <span data-ttu-id="84bd5-188">La route di sistema</span><span class="sxs-lookup"><span data-stu-id="84bd5-188">System route</span></span>

<span data-ttu-id="84bd5-189">Per informazioni su come creare route definite dall'utente, vedere [come creare route e abilitare l'inoltro dell'IP in Azure](virtual-network-create-udr-arm-template.md).</span><span class="sxs-lookup"><span data-stu-id="84bd5-189">To learn how to create user defined routes, see [How to Create Routes and Enable IP Forwarding in Azure](virtual-network-create-udr-arm-template.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="84bd5-190">Route definite dall'utente vengono applicate solo a servizi cloud e macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="84bd5-190">User defined routes are only applied to Azure VMs and cloud services.</span></span> <span data-ttu-id="84bd5-191">Ad esempio, se si vuole aggiungere un dispositivo virtuale firewall tra la rete locale e Azure, è necessario creare una route definita dall'utente per le tabelle di route di Azure per inoltrare tutto il traffico indirizzato allo spazio degli indirizzi locale al dispositivo virtuale.</span><span class="sxs-lookup"><span data-stu-id="84bd5-191">For instance, if you want to add a firewall virtual appliance between your on-premises network and Azure, you will have to create a user defined route for your Azure route tables that forwards all traffic going to the on-premises address space to the virtual appliance.</span></span> <span data-ttu-id="84bd5-192">È anche possibile aggiungere una route definita dall'utente a GatewaySubnet per inoltrare tutto il traffico da locale ad Azure tramite l'appliance virtuale.</span><span class="sxs-lookup"><span data-stu-id="84bd5-192">You can also add a user defined route (UDR) to the GatewaySubnet to forward all traffic from on-premises to Azure through the virtual appliance.</span></span> <span data-ttu-id="84bd5-193">Si tratta di un'aggiunta recente.</span><span class="sxs-lookup"><span data-stu-id="84bd5-193">This is a recent addition.</span></span>
> 
> 

### <a name="bgp-routes"></a><span data-ttu-id="84bd5-194">Route BGP</span><span class="sxs-lookup"><span data-stu-id="84bd5-194">BGP routes</span></span>
<span data-ttu-id="84bd5-195">Se si dispone di una connessione ExpressRoute tra la rete locale e Azure, è possibile abilitare BGP propagare route dalla rete locale in Azure.</span><span class="sxs-lookup"><span data-stu-id="84bd5-195">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP to propagate routes from your on-premises network to Azure.</span></span> <span data-ttu-id="84bd5-196">Queste route BGP vengono utilizzate nello stesso modo delle route predefinite e delle route definite dall'utente in ogni subnet di Azure.</span><span class="sxs-lookup"><span data-stu-id="84bd5-196">These BGP routes are used in the same way as system routes and user defined routes in each Azure subnet.</span></span> <span data-ttu-id="84bd5-197">Per altre informazioni, vedere [Panoramica tecnica relativa a ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="84bd5-197">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="84bd5-198">È possibile configurare l'ambiente Azure per utilizzare il tunneling forzato attraverso la rete locale tramite la creazione di una route definita utente per 0.0.0.0/0 subnet che utilizza il gateway VPN come hop successivo.</span><span class="sxs-lookup"><span data-stu-id="84bd5-198">You can configure your Azure environment to use force tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses the VPN gateway as the next hop.</span></span> <span data-ttu-id="84bd5-199">Tuttavia, funziona solo se si utilizza un gateway VPN, non ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="84bd5-199">However, this only works if you are using a VPN gateway, not ExpressRoute.</span></span> <span data-ttu-id="84bd5-200">Per ExpressRoute, il tunneling forzato viene configurato tramite BGP.</span><span class="sxs-lookup"><span data-stu-id="84bd5-200">For ExpressRoute, forced tunneling is configured through BGP.</span></span>
> 
> 

## <a name="ip-forwarding"></a><span data-ttu-id="84bd5-201">Inoltro IP</span><span class="sxs-lookup"><span data-stu-id="84bd5-201">IP forwarding</span></span>
<span data-ttu-id="84bd5-202">Come descritto sopra, uno dei motivi principali per creare una route definita dall’utente consiste nell’inoltrare il traffico a un dispositivo virtuale.</span><span class="sxs-lookup"><span data-stu-id="84bd5-202">As described above, one of the main reasons to create a user defined route is to forward traffic to a virtual appliance.</span></span> <span data-ttu-id="84bd5-203">Un dispositivo virtuale non è altro che una macchina virtuale che esegue un'applicazione utilizzata per gestire il traffico di rete in qualche modo, ad esempio un firewall o un dispositivo NAT.</span><span class="sxs-lookup"><span data-stu-id="84bd5-203">A virtual appliance is nothing more than a VM that runs an application used to handle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="84bd5-204">Questo dispositivo virtuale macchina virtuale deve essere in grado di ricevere traffico in ingresso non viene indirizzato a se stesso.</span><span class="sxs-lookup"><span data-stu-id="84bd5-204">This virtual appliance VM must be able to receive incoming traffic that is not addressed to itself.</span></span> <span data-ttu-id="84bd5-205">Per consentire a una macchina virtuale di ricevere il traffico indirizzato ad altre destinazioni, è necessario abilitare l'inoltro IP per la macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="84bd5-205">To allow a VM to receive traffic addressed to other destinations, you must enable IP Forwarding for the VM.</span></span> <span data-ttu-id="84bd5-206">Si tratta di un'impostazione di Azure e non del sistema operativo guest.</span><span class="sxs-lookup"><span data-stu-id="84bd5-206">This is an Azure setting, not a setting in the guest operating system.</span></span>

## <a name="next-steps"></a><span data-ttu-id="84bd5-207">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="84bd5-207">Next steps</span></span>
* <span data-ttu-id="84bd5-208">Informazioni su come [Creare route definite dall'utente in Resource Manager usando un modello](virtual-network-create-udr-arm-template.md) e associarle alle subnet.</span><span class="sxs-lookup"><span data-stu-id="84bd5-208">Learn how to [create routes in the Resource Manager deployment model](virtual-network-create-udr-arm-template.md) and associate them to subnets.</span></span> 
* <span data-ttu-id="84bd5-209">Informazioni su come [creare route nel modello di distribuzione classica](virtual-network-create-udr-classic-ps.md) e associarle a subnet.</span><span class="sxs-lookup"><span data-stu-id="84bd5-209">Learn how to [create routes in the classic deployment model](virtual-network-create-udr-classic-ps.md) and associate them to subnets.</span></span>

