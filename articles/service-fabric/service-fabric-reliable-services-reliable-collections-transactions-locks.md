---
title: "Transazioni e modalità di blocco delle raccolte Reliable Collections in Azure Service Fabric | Microsoft Docs"
description: Transazioni e blocco delle raccolte Reliable Collections e di Reliable State Manager in Azure Service Fabric.
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/1/2017
ms.author: mcoskun
ms.openlocfilehash: 3452473f5b2f86d29e46339c997193bc6403736a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="transactions-and-lock-modes-in-azure-service-fabric-reliable-collections"></a><span data-ttu-id="6fa57-103">Transazioni e modalità di blocco delle raccolte Reliable Collections in Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="6fa57-103">Transactions and lock modes in Azure Service Fabric Reliable Collections</span></span>

## <a name="transaction"></a><span data-ttu-id="6fa57-104">Transazione</span><span class="sxs-lookup"><span data-stu-id="6fa57-104">Transaction</span></span>
<span data-ttu-id="6fa57-105">Una transazione è una sequenza di operazioni eseguite in un'unica unità logica di lavoro</span><span class="sxs-lookup"><span data-stu-id="6fa57-105">A transaction is a sequence of operations performed as a single logical unit of work.</span></span>
<span data-ttu-id="6fa57-106">e deve includere le proprietà seguenti, dette ACID (atomicità, coerenza, isolamento e durabilità)</span><span class="sxs-lookup"><span data-stu-id="6fa57-106">A transaction must exhibit the following ACID properties.</span></span> <span data-ttu-id="6fa57-107">(vedere https://technet.microsoft.com/it-it/library/ms190612):</span><span class="sxs-lookup"><span data-stu-id="6fa57-107">(see: https://technet.microsoft.com/en-us/library/ms190612)</span></span>
* <span data-ttu-id="6fa57-108">**Atomicità**: una transazione deve essere un'unità di lavoro atomica.</span><span class="sxs-lookup"><span data-stu-id="6fa57-108">**Atomicity**: A transaction must be an atomic unit of work.</span></span> <span data-ttu-id="6fa57-109">In altre parole, devono essere eseguite tutte le modifiche dei dati oppure non ne deve essere eseguita nessuna.</span><span class="sxs-lookup"><span data-stu-id="6fa57-109">In other words, either all its data modifications are performed, or none of them is performed.</span></span>
* <span data-ttu-id="6fa57-110">**Coerenza**: al termine della transazione, tutti i dati devono essere coerenti</span><span class="sxs-lookup"><span data-stu-id="6fa57-110">**Consistency**: When completed, a transaction must leave all data in a consistent state.</span></span> <span data-ttu-id="6fa57-111">e tutte le strutture di dati interne devono risultare corrette.</span><span class="sxs-lookup"><span data-stu-id="6fa57-111">All internal data structures must be correct at the end of the transaction.</span></span>
* <span data-ttu-id="6fa57-112">**Isolamento**: le modifiche eseguite da transazioni simultanee devono essere isolate da quelle eseguite da qualsiasi altra transazione simultanea.</span><span class="sxs-lookup"><span data-stu-id="6fa57-112">**Isolation**: Modifications made by concurrent transactions must be isolated from the modifications made by any other concurrent transactions.</span></span> <span data-ttu-id="6fa57-113">Il livello di isolamento usato per un'operazione all'interno di un oggetto ITransaction è determinato dall'interfaccia IReliableState che esegue l'operazione.</span><span class="sxs-lookup"><span data-stu-id="6fa57-113">The isolation level used for an operation within an ITransaction is determined by the IReliableState performing the operation.</span></span>
* <span data-ttu-id="6fa57-114">**Durabilità**: gli effetti di una transazione completata sono permanenti all'interno del sistema.</span><span class="sxs-lookup"><span data-stu-id="6fa57-114">**Durability**: After a transaction has completed, its effects are permanently in place in the system.</span></span> <span data-ttu-id="6fa57-115">Le modifiche eseguite rimangono valide anche in caso di errore del sistema.</span><span class="sxs-lookup"><span data-stu-id="6fa57-115">The modifications persist even in the event of a system failure.</span></span>

### <a name="isolation-levels"></a><span data-ttu-id="6fa57-116">Livelli di isolamento</span><span class="sxs-lookup"><span data-stu-id="6fa57-116">Isolation levels</span></span>
<span data-ttu-id="6fa57-117">Il livello di isolamento definisce il grado in cui la transazione deve essere isolata dalle modifiche apportate da altre transazioni.</span><span class="sxs-lookup"><span data-stu-id="6fa57-117">Isolation level defines the degree to which the transaction must be isolated from modifications made by other transactions.</span></span>
<span data-ttu-id="6fa57-118">Le raccolte Reliable Collections supportano due livelli di isolamento:</span><span class="sxs-lookup"><span data-stu-id="6fa57-118">There are two isolation levels that are supported in Reliable Collections:</span></span>

* <span data-ttu-id="6fa57-119">**Repeatable Read**: specifica che le istruzioni non possono leggere dati modificati da altre transazioni di cui non è ancora stato eseguito il commit e che nessun'altra transazione può modificare i dati letti dalla transazione corrente, finché quest'ultima non viene completata.</span><span class="sxs-lookup"><span data-stu-id="6fa57-119">**Repeatable Read**: Specifies that statements cannot read data that has been modified but not yet committed by other transactions and that no other transactions can modify data that has been read by the current transaction until the current transaction finishes.</span></span> <span data-ttu-id="6fa57-120">Per altre informazioni, vedere [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="6fa57-120">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>
* <span data-ttu-id="6fa57-121">**Snapshot**: specifica che i dati letti da qualsiasi istruzione in una transazione rappresentano la versione coerente dal punto di vista transazionale dei dati esistenti al momento dell'avvio della transazione.</span><span class="sxs-lookup"><span data-stu-id="6fa57-121">**Snapshot**: Specifies that data read by any statement in a transaction is the transactionally consistent version of the data that existed at the start of the transaction.</span></span>
  <span data-ttu-id="6fa57-122">La transazione può quindi riconoscere solo le modifiche dei dati di cui è stato eseguito il commit prima dell'avvio della transazione.</span><span class="sxs-lookup"><span data-stu-id="6fa57-122">The transaction can recognize only data modifications that were committed before the start of the transaction.</span></span>
  <span data-ttu-id="6fa57-123">Le modifiche apportate da altre transazioni dopo l'inizio della transazione corrente non sono visibili per le istruzioni eseguite nella transazione corrente.</span><span class="sxs-lookup"><span data-stu-id="6fa57-123">Data modifications made by other transactions after the start of the current transaction are not visible to statements executing in the current transaction.</span></span>
  <span data-ttu-id="6fa57-124">È come se le istruzioni di una transazione ottenessero uno snapshot dei dati di cui è stato eseguito il commit così come si presentavano al momento dell'avvio della transazione.</span><span class="sxs-lookup"><span data-stu-id="6fa57-124">The effect is as if the statements in a transaction get a snapshot of the committed data as it existed at the start of the transaction.</span></span>
  <span data-ttu-id="6fa57-125">Gli snapshot tra le Reliable Collections sono coerenti.</span><span class="sxs-lookup"><span data-stu-id="6fa57-125">Snapshots are consistent across Reliable Collections.</span></span>
  <span data-ttu-id="6fa57-126">Per altre informazioni, vedere [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="6fa57-126">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>

<span data-ttu-id="6fa57-127">Le raccolte Reliable Collections scelgono automaticamente il livello di isolamento da usare per una determinata operazione di lettura a seconda dell'operazione stessa e del ruolo della replica al momento della creazione della transazione.</span><span class="sxs-lookup"><span data-stu-id="6fa57-127">Reliable Collections automatically choose the isolation level to use for a given read operation depending on the operation and the role of the replica at the time of transaction's creation.</span></span>
<span data-ttu-id="6fa57-128">La tabella seguente descrive i valori predefiniti del livello di isolamento per le operazioni Reliable Dictionary e Reliable Queue.</span><span class="sxs-lookup"><span data-stu-id="6fa57-128">Following is the table that depicts isolation level defaults for Reliable Dictionary and Queue operations.</span></span>

| <span data-ttu-id="6fa57-129">Operazione\Ruolo</span><span class="sxs-lookup"><span data-stu-id="6fa57-129">Operation \ Role</span></span> | <span data-ttu-id="6fa57-130">Primario</span><span class="sxs-lookup"><span data-stu-id="6fa57-130">Primary</span></span> | <span data-ttu-id="6fa57-131">Secondario</span><span class="sxs-lookup"><span data-stu-id="6fa57-131">Secondary</span></span> |
| --- |:--- |:--- |
| <span data-ttu-id="6fa57-132">Lettura di entità singola</span><span class="sxs-lookup"><span data-stu-id="6fa57-132">Single Entity Read</span></span> |<span data-ttu-id="6fa57-133">Repeatable Read</span><span class="sxs-lookup"><span data-stu-id="6fa57-133">Repeatable Read</span></span> |<span data-ttu-id="6fa57-134">Snapshot</span><span class="sxs-lookup"><span data-stu-id="6fa57-134">Snapshot</span></span> |
| <span data-ttu-id="6fa57-135">Enumerazione, conteggio</span><span class="sxs-lookup"><span data-stu-id="6fa57-135">Enumeration, Count</span></span> |<span data-ttu-id="6fa57-136">Snapshot</span><span class="sxs-lookup"><span data-stu-id="6fa57-136">Snapshot</span></span> |<span data-ttu-id="6fa57-137">Snapshot</span><span class="sxs-lookup"><span data-stu-id="6fa57-137">Snapshot</span></span> |

> [!NOTE]
> <span data-ttu-id="6fa57-138">Alcuni esempi comuni per le operazioni sulla singola entità sono `IReliableDictionary.TryGetValueAsync` e `IReliableQueue.TryPeekAsync`.</span><span class="sxs-lookup"><span data-stu-id="6fa57-138">Common examples for Single Entity Operations are `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.</span></span>
> 

<span data-ttu-id="6fa57-139">Gli oggetti ReliableDictionary e ReliableQueue supportano entrambi il criterio "Read Your Writes".</span><span class="sxs-lookup"><span data-stu-id="6fa57-139">Both the Reliable Dictionary and the Reliable Queue support Read Your Writes.</span></span>
<span data-ttu-id="6fa57-140">In altri termini, qualsiasi operazione di scrittura all'interno di una transazione sarà visibile a una lettura successiva appartenente alla stessa transazione.</span><span class="sxs-lookup"><span data-stu-id="6fa57-140">In other words, any write within a transaction will be visible to a following read that belongs to the same transaction.</span></span>

## <a name="locks"></a><span data-ttu-id="6fa57-141">Blocchi</span><span class="sxs-lookup"><span data-stu-id="6fa57-141">Locks</span></span>
<span data-ttu-id="6fa57-142">Nelle raccolte Reliable Collections tutte le transazioni implementano un rigoroso blocco in due fasi: una transazione non rilascia i blocchi acquisiti fino a quando non termina con un'interruzione o un commit.</span><span class="sxs-lookup"><span data-stu-id="6fa57-142">In Reliable Collections, all transactions implement rigorous two phase locking: a transaction does not release the locks it has acquired until the transaction terminates with either an abort or a commit.</span></span>

<span data-ttu-id="6fa57-143">L'operazione Reliable Dictionary usa il blocco a livello di riga per tutte le operazioni sulla singola entità.</span><span class="sxs-lookup"><span data-stu-id="6fa57-143">Reliable Dictionary uses row level locking for all single entity operations.</span></span>
<span data-ttu-id="6fa57-144">L'operazione Reliable Queue bilancia la concorrenza in cambio di una proprietà FIFO transazionale rigorosa.</span><span class="sxs-lookup"><span data-stu-id="6fa57-144">Reliable Queue trades off concurrency for strict transactional FIFO property.</span></span>
<span data-ttu-id="6fa57-145">Reliable Queue usa i blocchi a livello di operazione che consentono una transazione con `TryPeekAsync` e/o `TryDequeueAsync` e una transazione con `EnqueueAsync` per volta.</span><span class="sxs-lookup"><span data-stu-id="6fa57-145">Reliable Queue uses operation level locks allowing one transaction with `TryPeekAsync` and/or `TryDequeueAsync` and one transaction with `EnqueueAsync` at a time.</span></span>
<span data-ttu-id="6fa57-146">Si noti che per mantenere il modello FIFO, se `TryPeekAsync` o `TryDequeueAsync` rileva che la coda affidabile è vuota, bloccherà anche `EnqueueAsync`.</span><span class="sxs-lookup"><span data-stu-id="6fa57-146">Note that to preserve FIFO, if a `TryPeekAsync` or `TryDequeueAsync` ever observes that the Reliable Queue is empty, they will also lock `EnqueueAsync`.</span></span>

<span data-ttu-id="6fa57-147">Le operazioni di scrittura acquisiscono sempre blocchi esclusivi.</span><span class="sxs-lookup"><span data-stu-id="6fa57-147">Write operations always take Exclusive locks.</span></span>
<span data-ttu-id="6fa57-148">Per le operazioni di lettura, il blocco dipende da due fattori.</span><span class="sxs-lookup"><span data-stu-id="6fa57-148">For read operations, the locking depends on a couple of factors.</span></span>
<span data-ttu-id="6fa57-149">Le operazioni di lettura eseguite con Shapshot Isolation sono prive di blocchi.</span><span class="sxs-lookup"><span data-stu-id="6fa57-149">Any read operation done using Snapshot isolation is lock free.</span></span>
<span data-ttu-id="6fa57-150">Per impostazione predefinita, ogni operazione di lettura ripetibile acquisisce blocchi condivisi.</span><span class="sxs-lookup"><span data-stu-id="6fa57-150">Any Repeatable Read operation by default takes Shared locks.</span></span>
<span data-ttu-id="6fa57-151">Tuttavia, per ogni operazione di lettura che supporta Repeatable Read, l'utente può chiedere un blocco di aggiornamento al posto del blocco condiviso.</span><span class="sxs-lookup"><span data-stu-id="6fa57-151">However, for any read operation that supports Repeatable Read, the user can ask for an Update lock instead of the Shared lock.</span></span>
<span data-ttu-id="6fa57-152">Il blocco di aggiornamento è asimmetrico e viene usato per impedire una forma comune di deadlock che si verifica quando più transazioni bloccano le risorse per un potenziale aggiornamento in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="6fa57-152">An Update lock is an asymmetric lock used to prevent a common form of deadlock that occurs when multiple transactions lock resources for potential updates at a later time.</span></span>

<span data-ttu-id="6fa57-153">La matrice di compatibilità dei blocchi è disponibile nella tabella seguente:</span><span class="sxs-lookup"><span data-stu-id="6fa57-153">The lock compatibility matrix can be found in the following table:</span></span>

| <span data-ttu-id="6fa57-154">Richiesto\Concesso</span><span class="sxs-lookup"><span data-stu-id="6fa57-154">Request \ Granted</span></span> | <span data-ttu-id="6fa57-155">Nessuno</span><span class="sxs-lookup"><span data-stu-id="6fa57-155">None</span></span> | <span data-ttu-id="6fa57-156">Condiviso</span><span class="sxs-lookup"><span data-stu-id="6fa57-156">Shared</span></span> | <span data-ttu-id="6fa57-157">Aggiornamento</span><span class="sxs-lookup"><span data-stu-id="6fa57-157">Update</span></span> | <span data-ttu-id="6fa57-158">Esclusivo</span><span class="sxs-lookup"><span data-stu-id="6fa57-158">Exclusive</span></span> |
| --- |:--- |:--- |:--- |:--- |
| <span data-ttu-id="6fa57-159">Condiviso</span><span class="sxs-lookup"><span data-stu-id="6fa57-159">Shared</span></span> |<span data-ttu-id="6fa57-160">Nessun conflitto</span><span class="sxs-lookup"><span data-stu-id="6fa57-160">No conflict</span></span> |<span data-ttu-id="6fa57-161">Nessun conflitto</span><span class="sxs-lookup"><span data-stu-id="6fa57-161">No conflict</span></span> |<span data-ttu-id="6fa57-162">Conflitto</span><span class="sxs-lookup"><span data-stu-id="6fa57-162">Conflict</span></span> |<span data-ttu-id="6fa57-163">Conflitto</span><span class="sxs-lookup"><span data-stu-id="6fa57-163">Conflict</span></span> |
| <span data-ttu-id="6fa57-164">Aggiornamento</span><span class="sxs-lookup"><span data-stu-id="6fa57-164">Update</span></span> |<span data-ttu-id="6fa57-165">Nessun conflitto</span><span class="sxs-lookup"><span data-stu-id="6fa57-165">No conflict</span></span> |<span data-ttu-id="6fa57-166">Nessun conflitto</span><span class="sxs-lookup"><span data-stu-id="6fa57-166">No conflict</span></span> |<span data-ttu-id="6fa57-167">Conflitto</span><span class="sxs-lookup"><span data-stu-id="6fa57-167">Conflict</span></span> |<span data-ttu-id="6fa57-168">Conflitto</span><span class="sxs-lookup"><span data-stu-id="6fa57-168">Conflict</span></span> |
| <span data-ttu-id="6fa57-169">Esclusivo</span><span class="sxs-lookup"><span data-stu-id="6fa57-169">Exclusive</span></span> |<span data-ttu-id="6fa57-170">Nessun conflitto</span><span class="sxs-lookup"><span data-stu-id="6fa57-170">No conflict</span></span> |<span data-ttu-id="6fa57-171">Conflitto</span><span class="sxs-lookup"><span data-stu-id="6fa57-171">Conflict</span></span> |<span data-ttu-id="6fa57-172">Conflitto</span><span class="sxs-lookup"><span data-stu-id="6fa57-172">Conflict</span></span> |<span data-ttu-id="6fa57-173">Conflitto</span><span class="sxs-lookup"><span data-stu-id="6fa57-173">Conflict</span></span> |

<span data-ttu-id="6fa57-174">Per il rilevamento dei deadlock viene usato un argomento timeout delle API Reliable Collections.</span><span class="sxs-lookup"><span data-stu-id="6fa57-174">Time-out argument in the Reliable Collections APIs is used for deadlock detection.</span></span>
<span data-ttu-id="6fa57-175">Si supponga, ad esempio, che due transazioni (T1 e T2) stiano cercando di leggere e aggiornare K1.</span><span class="sxs-lookup"><span data-stu-id="6fa57-175">For example, two transactions (T1 and T2) are trying to read and update K1.</span></span>
<span data-ttu-id="6fa57-176">È possibile che si verifichi un deadlock, poiché entrambe le transazioni si concludono con il blocco condiviso.</span><span class="sxs-lookup"><span data-stu-id="6fa57-176">It is possible for them to deadlock, because they both end up having the Shared lock.</span></span>
<span data-ttu-id="6fa57-177">In questo caso, potrebbe verificarsi il timeout di una o di entrambe le operazioni.</span><span class="sxs-lookup"><span data-stu-id="6fa57-177">In this case, one or both of the operations will time out.</span></span>

<span data-ttu-id="6fa57-178">Questo scenario di deadlock è un perfetto esempio di come il blocco di aggiornamento possa impedire i deadlock.</span><span class="sxs-lookup"><span data-stu-id="6fa57-178">This deadlock scenario is a great example of how an Update lock can prevent deadlocks.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6fa57-179">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="6fa57-179">Next steps</span></span>
* [<span data-ttu-id="6fa57-180">Lavorare con le raccolte Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="6fa57-180">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="6fa57-181">Notifiche di Reliable Services</span><span class="sxs-lookup"><span data-stu-id="6fa57-181">Reliable Services notifications</span></span>](service-fabric-reliable-services-notifications.md)
* [<span data-ttu-id="6fa57-182">Eseguire il backup e il ripristino di Reliable Services (ripristino di emergenza)</span><span class="sxs-lookup"><span data-stu-id="6fa57-182">Reliable Services backup and restore (disaster recovery)</span></span>](service-fabric-reliable-services-backup-restore.md)
* [<span data-ttu-id="6fa57-183">Reliable State Manager configuration (Configurazione di Reliable State Manager)</span><span class="sxs-lookup"><span data-stu-id="6fa57-183">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* [<span data-ttu-id="6fa57-184">Guida di riferimento per gli sviluppatori per Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="6fa57-184">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)

