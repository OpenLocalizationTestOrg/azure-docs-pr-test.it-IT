---
title: procedure consigliate aaaBest per migliorare le prestazioni utilizzando Azure Service Bus | Documenti Microsoft
description: Viene descritto come toouse prestazioni toooptimize del Bus di servizio quando si scambiano negoziata messaggi.
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: e756c15d-31fc-45c0-8df4-0bca0da10bb2
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/10/2017
ms.author: sethm
ms.openlocfilehash: 52764d227757cbb11246675878933f21685817f1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="best-practices-for-performance-improvements-using-service-bus-messaging"></a><span data-ttu-id="9752e-103">Procedure consigliate per il miglioramento delle prestazioni tramite la messaggistica del bus di servizio</span><span class="sxs-lookup"><span data-stu-id="9752e-103">Best Practices for performance improvements using Service Bus Messaging</span></span>

<span data-ttu-id="9752e-104">Questo articolo viene descritto come toouse [messaggistica del Bus di servizio di Azure](https://azure.microsoft.com/services/service-bus/) negoziata di toooptimize prestazioni durante lo scambio di messaggi.</span><span class="sxs-lookup"><span data-stu-id="9752e-104">This article describes how toouse [Azure Service Bus messaging](https://azure.microsoft.com/services/service-bus/) toooptimize performance when exchanging brokered messages.</span></span> <span data-ttu-id="9752e-105">prima parte di Hello di questo argomento descrive i meccanismi diversi hello offerti toohelp aumento delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="9752e-105">hello first part of this topic describes hello different mechanisms that are offered toohelp increase performance.</span></span> <span data-ttu-id="9752e-106">seconda parte Hello fornisce indicazioni su come toouse Bus di servizio in modo che può offrire hello prestazioni ottimali in un determinato scenario.</span><span class="sxs-lookup"><span data-stu-id="9752e-106">hello second part provides guidance on how toouse Service Bus in a way that can offer hello best performance in a given scenario.</span></span>

<span data-ttu-id="9752e-107">In questo argomento, il termine di hello "client" si riferisce tooany entità che accede a Bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="9752e-107">Throughout this topic, hello term "client" refers tooany entity that accesses Service Bus.</span></span> <span data-ttu-id="9752e-108">Un client può assumere il ruolo di hello di un mittente o ricevitore.</span><span class="sxs-lookup"><span data-stu-id="9752e-108">A client can take hello role of a sender or a receiver.</span></span> <span data-ttu-id="9752e-109">il termine di Hello "mittente" viene usato per un client di coda o argomento Bus di servizio che invia messaggi tooa Bus di servizio coda o argomento.</span><span class="sxs-lookup"><span data-stu-id="9752e-109">hello term "sender" is used for a Service Bus queue or topic client that sends messages tooa Service Bus queue or topic.</span></span> <span data-ttu-id="9752e-110">il termine Hello "ricevente" si riferisce tooa client coda o sottoscrizione del Bus di servizio che riceve i messaggi da una coda di Service Bus o la sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="9752e-110">hello term "receiver" refers tooa Service Bus queue or subscription client that receives messages from a Service Bus queue or subscription.</span></span>

<span data-ttu-id="9752e-111">Queste sezioni presentano alcuni concetti che Service Bus Usa toohelp incrementare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="9752e-111">These sections introduce several concepts that Service Bus uses toohelp boost performance.</span></span>

## <a name="protocols"></a><span data-ttu-id="9752e-112">Protocolli</span><span class="sxs-lookup"><span data-stu-id="9752e-112">Protocols</span></span>
<span data-ttu-id="9752e-113">Bus di servizio consente ai client toosend e ricevere messaggi tramite uno dei tre protocolli:</span><span class="sxs-lookup"><span data-stu-id="9752e-113">Service Bus enables clients toosend and receive messages via one of three protocols:</span></span>

1. <span data-ttu-id="9752e-114">Advanced Message Queuing Protocol (AMQP)</span><span class="sxs-lookup"><span data-stu-id="9752e-114">Advanced Message Queuing Protocol (AMQP)</span></span>
2. <span data-ttu-id="9752e-115">Service Bus Messaging Protocol (SBMP)</span><span class="sxs-lookup"><span data-stu-id="9752e-115">Service Bus Messaging Protocol (SBMP)</span></span>
3. <span data-ttu-id="9752e-116">HTTP</span><span class="sxs-lookup"><span data-stu-id="9752e-116">HTTP</span></span>

<span data-ttu-id="9752e-117">AMQP e SBMP sono più efficienti, perché mantengono hello connessione tooService Bus, purché le factory di messaggistica hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-117">AMQP and SBMP are more efficient, because they maintain hello connection tooService Bus as long as hello messaging factory exists.</span></span> <span data-ttu-id="9752e-118">Implementa anche le operazioni di invio in batch e prelettura.</span><span class="sxs-lookup"><span data-stu-id="9752e-118">It also implements batching and prefetching.</span></span> <span data-ttu-id="9752e-119">A meno che non indicato in modo esplicito, tutto il contenuto in questo argomento si presuppone l'uso di hello di AMQP o SBMP.</span><span class="sxs-lookup"><span data-stu-id="9752e-119">Unless explicitly mentioned, all content in this topic assumes hello use of AMQP or SBMP.</span></span>

## <a name="reusing-factories-and-clients"></a><span data-ttu-id="9752e-120">Riutilizzo di factory e client</span><span class="sxs-lookup"><span data-stu-id="9752e-120">Reusing factories and clients</span></span>
<span data-ttu-id="9752e-121">Gli oggetti client del bus di servizio, ad esempio [QueueClient][QueueClient] o [MessageSender][MessageSender], vengono creati tramite un oggetto [MessagingFactory][MessagingFactory] che offre anche la gestione interna delle connessioni.</span><span class="sxs-lookup"><span data-stu-id="9752e-121">Service Bus client objects, such as [QueueClient][QueueClient] or [MessageSender][MessageSender], are created through a [MessagingFactory][MessagingFactory] object, which also provides internal management of connections.</span></span> <span data-ttu-id="9752e-122">È consigliabile non chiudere le factory di messaggistica o coda, argomento e sottoscrizione client dopo aver inviare un messaggio e quindi ricrearli quando si invia il messaggio hello successivo.</span><span class="sxs-lookup"><span data-stu-id="9752e-122">You should not close messaging factories or queue, topic, and subscription clients after you send a message, and then re-create them when you send hello next message.</span></span> <span data-ttu-id="9752e-123">Chiusura di una factory di messaggistica Elimina hello connessione toohello servizio service Bus e una nuova connessione viene stabilita quando si ricreano factory hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-123">Closing a messaging factory deletes hello connection toohello Service Bus service, and a new connection is established when recreating hello factory.</span></span> <span data-ttu-id="9752e-124">Tentativo di stabilire che una connessione è un'operazione dispendiosa, che è possibile evitare riutilizzando hello stessa factory e client, gli oggetti per più operazioni.</span><span class="sxs-lookup"><span data-stu-id="9752e-124">Establishing a connection is an expensive operation that you can avoid by re-using hello same factory and client objects for multiple operations.</span></span> <span data-ttu-id="9752e-125">È possibile utilizzare hello [QueueClient] [ QueueClient] oggetto per l'invio di messaggi da più thread e le operazioni asincrone simultanee.</span><span class="sxs-lookup"><span data-stu-id="9752e-125">You can safely use hello [QueueClient][QueueClient] object for sending messages from concurrent asynchronous operations and multiple threads.</span></span> 

## <a name="concurrent-operations"></a><span data-ttu-id="9752e-126">Operazioni simultanee</span><span class="sxs-lookup"><span data-stu-id="9752e-126">Concurrent operations</span></span>
<span data-ttu-id="9752e-127">L'esecuzione di un'operazione (invio, ricezione, eliminazione e così via) richiede tempo.</span><span class="sxs-lookup"><span data-stu-id="9752e-127">Performing an operation (send, receive, delete, etc.) takes some time.</span></span> <span data-ttu-id="9752e-128">Questo tempo include l'elaborazione di hello dell'operazione hello dal servizio Bus di servizio hello latenza toohello aggiunta di hello richiesta e risposta di hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-128">This time includes hello processing of hello operation by hello Service Bus service in addition toohello latency of hello request and hello reply.</span></span> <span data-ttu-id="9752e-129">numero di hello tooincrease di operazioni per volta, le operazioni vengano eseguite simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="9752e-129">tooincrease hello number of operations per time, operations must execute concurrently.</span></span> <span data-ttu-id="9752e-130">È possibile farlo in diversi modi:</span><span class="sxs-lookup"><span data-stu-id="9752e-130">You can do this in several different ways:</span></span>

* <span data-ttu-id="9752e-131">**Operazioni asincrone**: client hello Pianifica operazioni eseguendo operazioni asincrone.</span><span class="sxs-lookup"><span data-stu-id="9752e-131">**Asynchronous operations**: hello client schedules operations by performing asynchronous operations.</span></span> <span data-ttu-id="9752e-132">la richiesta successiva Hello sia stata avviata prima hello precedente richiesta è stata completata.</span><span class="sxs-lookup"><span data-stu-id="9752e-132">hello next request is started before hello previous request is completed.</span></span> <span data-ttu-id="9752e-133">Hello Ecco un esempio di un'operazione asincrona di invio:</span><span class="sxs-lookup"><span data-stu-id="9752e-133">hello following is an example of an asynchronous send operation:</span></span>
  
 ```csharp
  BrokeredMessage m1 = new BrokeredMessage(body);
  BrokeredMessage m2 = new BrokeredMessage(body);
  
  Task send1 = queueClient.SendAsync(m1).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #1");
    });
  Task send2 = queueClient.SendAsync(m2).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #2");
    });
  Task.WaitAll(send1, send2);
  Console.WriteLine("All messages sent");
  ```
  
  <span data-ttu-id="9752e-134">Ecco un esempio di operazione di ricezione in modalità asincrona:</span><span class="sxs-lookup"><span data-stu-id="9752e-134">This is an example of an asynchronous receive operation:</span></span>
  
  ```csharp
  Task receive1 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  Task receive2 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  
  Task.WaitAll(receive1, receive2);
  Console.WriteLine("All messages received");
  
  async void ProcessReceivedMessage(Task<BrokeredMessage> t)
  {
    BrokeredMessage m = t.Result;
    Console.WriteLine("{0} received", m.Label);
    await m.CompleteAsync();
    Console.WriteLine("{0} complete", m.Label);
  }
  ```
* <span data-ttu-id="9752e-135">**Più factory**: tutti i client (mittenti in aggiunta tooreceivers) che vengono creati hello stessa factory condivisione di una connessione TCP.</span><span class="sxs-lookup"><span data-stu-id="9752e-135">**Multiple factories**: all clients (senders in addition tooreceivers) that are created by hello same factory share one TCP connection.</span></span> <span data-ttu-id="9752e-136">velocità effettiva massima del messaggio Hello è limitata dal numero di hello di operazioni che può essere eseguita per questa connessione TCP.</span><span class="sxs-lookup"><span data-stu-id="9752e-136">hello maximum message throughput is limited by hello number of operations that can go through this TCP connection.</span></span> <span data-ttu-id="9752e-137">velocità effettiva di Hello che può essere ottenuta con una singola factory varia notevolmente con tempi di round trip TCP e le dimensioni di messaggio.</span><span class="sxs-lookup"><span data-stu-id="9752e-137">hello throughput that can be obtained with a single factory varies greatly with TCP round-trip times and message size.</span></span> <span data-ttu-id="9752e-138">tooobtain una velocità effettiva superiore, è consigliabile usare più factory di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="9752e-138">tooobtain higher throughput rates, you should use multiple messaging factories.</span></span>

## <a name="receive-mode"></a><span data-ttu-id="9752e-139">Modalità di ricezione</span><span class="sxs-lookup"><span data-stu-id="9752e-139">Receive mode</span></span>
<span data-ttu-id="9752e-140">Quando si crea un client di coda o sottoscrizione, è possibile specificare una modalità di ricezione: *PeekLock* o *ReceiveAndDelete*.</span><span class="sxs-lookup"><span data-stu-id="9752e-140">When creating a queue or subscription client, you can specify a receive mode: *Peek-lock* or *Receive and Delete*.</span></span> <span data-ttu-id="9752e-141">modalità di ricezione predefinita Hello è [PeekLock][PeekLock].</span><span class="sxs-lookup"><span data-stu-id="9752e-141">hello default receive mode is [PeekLock][PeekLock].</span></span> <span data-ttu-id="9752e-142">Quando si opera in questa modalità, hello client invia una richiesta tooreceive un messaggio dal Bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="9752e-142">When operating in this mode, hello client sends a request tooreceive a message from Service Bus.</span></span> <span data-ttu-id="9752e-143">Dopo che il client hello ha ricevuto il messaggio hello, invia un messaggio hello toocomplete di richiesta.</span><span class="sxs-lookup"><span data-stu-id="9752e-143">After hello client has received hello message, it sends a request toocomplete hello message.</span></span>

<span data-ttu-id="9752e-144">Quando l'impostazione di hello modalità di ricezione troppo[ReceiveAndDelete][ReceiveAndDelete], entrambi i passaggi vengono combinati in una singola richiesta.</span><span class="sxs-lookup"><span data-stu-id="9752e-144">When setting hello receive mode too[ReceiveAndDelete][ReceiveAndDelete], both steps are combined in a single request.</span></span> <span data-ttu-id="9752e-145">Questo riduce hello al numero complessivo di operazioni e può migliorare hello velocità effettiva complessiva di messaggio.</span><span class="sxs-lookup"><span data-stu-id="9752e-145">This reduces hello overall number of operations, and can improve hello overall message throughput.</span></span> <span data-ttu-id="9752e-146">Questo miglioramento delle prestazioni comporta il rischio di hello di perdita dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="9752e-146">This performance gain comes at hello risk of losing messages.</span></span>

<span data-ttu-id="9752e-147">Il bus di servizio non supporta le transazioni per le operazioni receive-and-delete.</span><span class="sxs-lookup"><span data-stu-id="9752e-147">Service Bus does not support transactions for receive-and-delete operations.</span></span> <span data-ttu-id="9752e-148">Inoltre, la semantica di blocco di visualizzazione è necessaria per gli scenari in cui hello client desidera toodefer o [recapitabili](service-bus-dead-letter-queues.md) un messaggio.</span><span class="sxs-lookup"><span data-stu-id="9752e-148">In addition, peek-lock semantics are required for any scenarios in which hello client wants toodefer or [dead-letter](service-bus-dead-letter-queues.md) a message.</span></span>

## <a name="client-side-batching"></a><span data-ttu-id="9752e-149">Invio in batch sul lato client</span><span class="sxs-lookup"><span data-stu-id="9752e-149">Client-side batching</span></span>
<span data-ttu-id="9752e-150">Invio in batch sul lato client consente a una coda o argomento client toodelay hello l'invio di un messaggio per un determinato periodo di tempo.</span><span class="sxs-lookup"><span data-stu-id="9752e-150">Client-side batching enables a queue or topic client toodelay hello sending of a message for a certain period of time.</span></span> <span data-ttu-id="9752e-151">Se il client di hello invia altri messaggi durante questo periodo di tempo, trasmette messaggi hello in un unico batch.</span><span class="sxs-lookup"><span data-stu-id="9752e-151">If hello client sends additional messages during this time period, it transmits hello messages in a single batch.</span></span> <span data-ttu-id="9752e-152">Invio in batch sul lato client comporta un toobatch client coda o sottoscrizione più **completa** le richieste in un'unica richiesta.</span><span class="sxs-lookup"><span data-stu-id="9752e-152">Client-side batching also causes a queue or subscription client toobatch multiple **Complete** requests into a single request.</span></span> <span data-ttu-id="9752e-153">L'invio in batch è disponibile solo per le operazioni asincrone **Send** e **Complete**.</span><span class="sxs-lookup"><span data-stu-id="9752e-153">Batching is only available for asynchronous **Send** and **Complete** operations.</span></span> <span data-ttu-id="9752e-154">Operazioni sincrone vengono immediatamente inviate toohello servizio service Bus.</span><span class="sxs-lookup"><span data-stu-id="9752e-154">Synchronous operations are immediately sent toohello Service Bus service.</span></span> <span data-ttu-id="9752e-155">L'invio in batch non si verifica per le operazioni di anteprima (peek) o ricezione né tra più client.</span><span class="sxs-lookup"><span data-stu-id="9752e-155">Batching does not occur for peek or receive operations, nor does batching occur across clients.</span></span>

<span data-ttu-id="9752e-156">Per impostazione predefinita, i client usano un intervallo di invio in batch di 20 ms.</span><span class="sxs-lookup"><span data-stu-id="9752e-156">By default, a client uses a batch interval of 20ms.</span></span> <span data-ttu-id="9752e-157">È possibile modificare l'impostazione hello intervallo batch di hello [BatchFlushInterval] [ BatchFlushInterval] proprietà prima di creare hello factory di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="9752e-157">You can change hello batch interval by setting hello [BatchFlushInterval][BatchFlushInterval] property before creating hello messaging factory.</span></span> <span data-ttu-id="9752e-158">Questa impostazione interessa tutti i client creati da questa factory.</span><span class="sxs-lookup"><span data-stu-id="9752e-158">This setting affects all clients that are created by this factory.</span></span>

<span data-ttu-id="9752e-159">invio in batch toodisable, impostare hello [BatchFlushInterval] [ BatchFlushInterval] proprietà troppo**TimeSpan**.</span><span class="sxs-lookup"><span data-stu-id="9752e-159">toodisable batching, set hello [BatchFlushInterval][BatchFlushInterval] property too**TimeSpan.Zero**.</span></span> <span data-ttu-id="9752e-160">ad esempio:</span><span class="sxs-lookup"><span data-stu-id="9752e-160">For example:</span></span>

```csharp
MessagingFactorySettings mfs = new MessagingFactorySettings();
mfs.TokenProvider = tokenProvider;
mfs.NetMessagingTransportSettings.BatchFlushInterval = TimeSpan.FromSeconds(0.05);
MessagingFactory messagingFactory = MessagingFactory.Create(namespaceUri, mfs);
```

<span data-ttu-id="9752e-161">L'invio in batch non influisce sul numero di hello di operazioni di messaggistica fatturabili ed è disponibile solo per hello protocollo client di Service Bus.</span><span class="sxs-lookup"><span data-stu-id="9752e-161">Batching does not affect hello number of billable messaging operations, and is available only for hello Service Bus client protocol.</span></span> <span data-ttu-id="9752e-162">Hello protocollo HTTP non supporta l'invio in batch.</span><span class="sxs-lookup"><span data-stu-id="9752e-162">hello HTTP protocol does not support batching.</span></span>

## <a name="batching-store-access"></a><span data-ttu-id="9752e-163">Invio in batch per l'accesso all'archivio</span><span class="sxs-lookup"><span data-stu-id="9752e-163">Batching store access</span></span>
<span data-ttu-id="9752e-164">tooincrease hello velocità effettiva di una coda, argomento o sottoscrizione, Bus di servizio invia in batch più messaggi quando scrive archivio interno tooits.</span><span class="sxs-lookup"><span data-stu-id="9752e-164">tooincrease hello throughput of a queue, topic, or subscription, Service Bus batches multiple messages when it writes tooits internal store.</span></span> <span data-ttu-id="9752e-165">Se abilitato in una coda o un argomento, la scrittura di messaggi nell'archivio di hello verrà inseriti nel batch.</span><span class="sxs-lookup"><span data-stu-id="9752e-165">If enabled on a queue or topic, writing messages into hello store will be batched.</span></span> <span data-ttu-id="9752e-166">Se abilitato in una coda o sottoscrizione, l'eliminazione di messaggi dall'archivio di hello verranno inseriti nel batch.</span><span class="sxs-lookup"><span data-stu-id="9752e-166">If enabled on a queue or subscription, deleting messages from hello store will be batched.</span></span> <span data-ttu-id="9752e-167">Se l'accesso in batch all'archivio è abilitato per un'entità, Bus di servizio ritarda un'operazione di scrittura relativa all'entità da backup too20ms store.</span><span class="sxs-lookup"><span data-stu-id="9752e-167">If batched store access is enabled for an entity, Service Bus delays a store write operation regarding that entity by up too20ms.</span></span> <span data-ttu-id="9752e-168">Operazioni di archiviazione aggiuntive che si verificano durante questo intervallo vengono aggiunti toohello batch.</span><span class="sxs-lookup"><span data-stu-id="9752e-168">Additional store operations that occur during this interval are added toohello batch.</span></span> <span data-ttu-id="9752e-169">L'accesso in batch all'archivio influisce solo sulle operazioni **Send** e **Complete** e non sulle operazioni di ricezione.</span><span class="sxs-lookup"><span data-stu-id="9752e-169">Batched store access only affects **Send** and **Complete** operations; receive operations are not affected.</span></span> <span data-ttu-id="9752e-170">L'accesso in batch all'archivio è una proprietà di un'entità.</span><span class="sxs-lookup"><span data-stu-id="9752e-170">Batched store access is a property on an entity.</span></span> <span data-ttu-id="9752e-171">L'invio in batch si verifica per tutte le entità per cui è abilitato l'accesso in batch all'archivio.</span><span class="sxs-lookup"><span data-stu-id="9752e-171">Batching occurs across all entities that enable batched store access.</span></span>

<span data-ttu-id="9752e-172">Quando si crea una nuova coda, un nuovo argomento o una nuova sottoscrizione, l'accesso in batch all'archivio è abilitato per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="9752e-172">When creating a new queue, topic or subscription, batched store access is enabled by default.</span></span> <span data-ttu-id="9752e-173">accesso a store, set hello in batch di toodisable [EnableBatchedOperations] [ EnableBatchedOperations] proprietà troppo**false** prima di creare entità hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-173">toodisable batched store access, set hello [EnableBatchedOperations][EnableBatchedOperations] property too**false** before creating hello entity.</span></span> <span data-ttu-id="9752e-174">ad esempio:</span><span class="sxs-lookup"><span data-stu-id="9752e-174">For example:</span></span>

```csharp
QueueDescription qd = new QueueDescription();
qd.EnableBatchedOperations = false;
Queue q = namespaceManager.CreateQueue(qd);
```

<span data-ttu-id="9752e-175">Accesso in batch all'archivio non influisce sul numero di hello di operazioni di messaggistica fatturabili ed è una proprietà di una coda, argomento o sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="9752e-175">Batched store access does not affect hello number of billable messaging operations, and is a property of a queue, topic, or subscription.</span></span> <span data-ttu-id="9752e-176">È indipendente di hello modalità e hello protocollo usato tra un client e hello servizio Bus di servizio di ricezione.</span><span class="sxs-lookup"><span data-stu-id="9752e-176">It is independent of hello receive mode and hello protocol that is used between a client and hello Service Bus service.</span></span>

## <a name="prefetching"></a><span data-ttu-id="9752e-177">Prelettura</span><span class="sxs-lookup"><span data-stu-id="9752e-177">Prefetching</span></span>
<span data-ttu-id="9752e-178">La prelettura consente hello coda o sottoscrizione client tooload altri messaggi dal servizio hello quando esegue un'operazione di ricezione.</span><span class="sxs-lookup"><span data-stu-id="9752e-178">Prefetching enables hello queue or subscription client tooload additional messages from hello service when it performs a receive operation.</span></span> <span data-ttu-id="9752e-179">client Hello archivia questi messaggi in una cache locale.</span><span class="sxs-lookup"><span data-stu-id="9752e-179">hello client stores these messages in a local cache.</span></span> <span data-ttu-id="9752e-180">Hello dimensione della cache di hello è determinata da hello [Prefetchcount] [ QueueClient.PrefetchCount] o [prefetchcount su] [ SubscriptionClient.PrefetchCount] proprietà.</span><span class="sxs-lookup"><span data-stu-id="9752e-180">hello size of hello cache is determined by hello [QueueClient.PrefetchCount][QueueClient.PrefetchCount] or [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] properties.</span></span> <span data-ttu-id="9752e-181">Ogni client che abilita la prelettura mantiene la propria cache.</span><span class="sxs-lookup"><span data-stu-id="9752e-181">Each client that enables prefetching maintains its own cache.</span></span> <span data-ttu-id="9752e-182">La cache non è condivisa tra i client.</span><span class="sxs-lookup"><span data-stu-id="9752e-182">A cache is not shared across clients.</span></span> <span data-ttu-id="9752e-183">Se hello client avvia un'operazione di ricezione e la cache è vuota, il servizio di hello trasmette un batch di messaggi.</span><span class="sxs-lookup"><span data-stu-id="9752e-183">If hello client initiates a receive operation and its cache is empty, hello service transmits a batch of messages.</span></span> <span data-ttu-id="9752e-184">dimensione di Hello del batch hello pari hello dimensione della cache di hello o 256 KB, a seconda del valore minore.</span><span class="sxs-lookup"><span data-stu-id="9752e-184">hello size of hello batch equals hello size of hello cache or 256 KB, whichever is smaller.</span></span> <span data-ttu-id="9752e-185">Se hello client avvia un'operazione di ricezione e della cache di hello contiene un messaggio, il messaggio hello viene eseguito dalla cache di hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-185">If hello client initiates a receive operation and hello cache contains a message, hello message is taken from hello cache.</span></span>

<span data-ttu-id="9752e-186">Quando un messaggio viene sottoposto a prelettura, messaggio hello di blocchi servizio hello caricate in background.</span><span class="sxs-lookup"><span data-stu-id="9752e-186">When a message is prefetched, hello service locks hello prefetched message.</span></span> <span data-ttu-id="9752e-187">In questo modo, messaggio di prelettura hello non può essere ricevuto da un ricevitore diverso.</span><span class="sxs-lookup"><span data-stu-id="9752e-187">By doing this, hello prefetched message cannot be received by a different receiver.</span></span> <span data-ttu-id="9752e-188">Se il ricevitore di hello non può completare il messaggio hello prima della scadenza del blocco di hello, messaggio hello diventa ricevitori tooother disponibili.</span><span class="sxs-lookup"><span data-stu-id="9752e-188">If hello receiver cannot complete hello message before hello lock expires, hello message becomes available tooother receivers.</span></span> <span data-ttu-id="9752e-189">copia di Hello eseguita la prelettura del messaggio hello rimane nella cache di hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-189">hello prefetched copy of hello message remains in hello cache.</span></span> <span data-ttu-id="9752e-190">Hello ricevitore che usa hello scaduta memorizzata nella cache copia riceverà un'eccezione durante il tentativo di toocomplete tale messaggio.</span><span class="sxs-lookup"><span data-stu-id="9752e-190">hello receiver that consumes hello expired cached copy will receive an exception when it tries toocomplete that message.</span></span> <span data-ttu-id="9752e-191">Per impostazione predefinita, il blocco di messaggio hello scade dopo 60 secondi.</span><span class="sxs-lookup"><span data-stu-id="9752e-191">By default, hello message lock expires after 60 seconds.</span></span> <span data-ttu-id="9752e-192">Questo valore può essere estesa too5 minuti.</span><span class="sxs-lookup"><span data-stu-id="9752e-192">This value can be extended too5 minutes.</span></span> <span data-ttu-id="9752e-193">utilizzo di hello tooprevent messaggi scaduti, la dimensione della cache di hello deve essere sempre inferiore al numero di hello di messaggi che possono essere utilizzati da un client nell'intervallo di timeout di blocco hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-193">tooprevent hello consumption of expired messages, hello cache size should always be smaller than hello number of messages that can be consumed by a client within hello lock time-out interval.</span></span>

<span data-ttu-id="9752e-194">Quando si usa hello scadenza del blocco predefinito di 60 secondi, il valore per una buona [prefetchcount su] [ SubscriptionClient.PrefetchCount] hello 20 volte massimo elaborazione frequenze di tutti i ricevitori della factory hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-194">When using hello default lock expiration of 60 seconds, a good value for [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] is 20 times hello maximum processing rates of all receivers of hello factory.</span></span> <span data-ttu-id="9752e-195">Ad esempio, una factory crei 3 ricevitori e ogni ricevitore può elaborare i messaggi too10 al secondo.</span><span class="sxs-lookup"><span data-stu-id="9752e-195">For example, a factory creates 3 receivers, and each receiver can process up too10 messages per second.</span></span> <span data-ttu-id="9752e-196">conteggio di Hello prelettura non deve superare 20 X 3 X 10 = 600.</span><span class="sxs-lookup"><span data-stu-id="9752e-196">hello prefetch count should not exceed 20 X 3 X 10 = 600.</span></span> <span data-ttu-id="9752e-197">Per impostazione predefinita, [Prefetchcount] [ QueueClient.PrefetchCount] è too0 set, il che significa che nessun altro messaggio viene recuperato dal servizio hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-197">By default, [QueueClient.PrefetchCount][QueueClient.PrefetchCount] is set too0, which means that no additional messages are fetched from hello service.</span></span>

<span data-ttu-id="9752e-198">La prelettura dei messaggi aumenta hello velocità effettiva globale per una coda o sottoscrizione perché riduce hello al numero complessivo di operazioni di messaggio, o round trip.</span><span class="sxs-lookup"><span data-stu-id="9752e-198">Prefetching messages increases hello overall throughput for a queue or subscription because it reduces hello overall number of message operations, or round trips.</span></span> <span data-ttu-id="9752e-199">Recupero del primo messaggio hello, tuttavia, richiede più tempo (a causa delle dimensioni del messaggio toohello aumentato).</span><span class="sxs-lookup"><span data-stu-id="9752e-199">Fetching hello first message, however, will take longer (due toohello increased message size).</span></span> <span data-ttu-id="9752e-200">Ricezione di messaggi sottoposti a prelettura sarà essere più veloce perché questi messaggi sono stati già scaricati dal client hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-200">Receiving prefetched messages will be faster because these messages have already been downloaded by hello client.</span></span>

<span data-ttu-id="9752e-201">proprietà di (durata TTL) time-to-live Hello di un messaggio viene controllata dal server hello in fase di hello server hello invia client toohello di messaggio hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-201">hello time-to-live (TTL) property of a message is checked by hello server at hello time hello server sends hello message toohello client.</span></span> <span data-ttu-id="9752e-202">client Hello selezionare proprietà di durata (TTL) del messaggio hello quando viene ricevuto il messaggio hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-202">hello client does not check hello message’s TTL property when hello message is received.</span></span> <span data-ttu-id="9752e-203">Al contrario, il messaggio hello può essere ricevuto anche se ha superato durata (TTL) del messaggio hello mentre il messaggio hello è memorizzata nella cache dal client hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-203">Instead, hello message can be received even if hello message’s TTL has passed while hello message was cached by hello client.</span></span>

<span data-ttu-id="9752e-204">La prelettura non influisce sul numero di hello di operazioni di messaggistica fatturabili ed è disponibile solo per hello protocollo client di Service Bus.</span><span class="sxs-lookup"><span data-stu-id="9752e-204">Prefetching does not affect hello number of billable messaging operations, and is available only for hello Service Bus client protocol.</span></span> <span data-ttu-id="9752e-205">Hello protocollo HTTP non supporta la prelettura.</span><span class="sxs-lookup"><span data-stu-id="9752e-205">hello HTTP protocol does not support prefetching.</span></span> <span data-ttu-id="9752e-206">Questa funzionalità è disponibile per le operazioni di ricezione sincrone e asincrone.</span><span class="sxs-lookup"><span data-stu-id="9752e-206">Prefetching is available for both synchronous and asynchronous receive operations.</span></span>

## <a name="express-queues-and-topics"></a><span data-ttu-id="9752e-207">Code e argomenti rapidi</span><span class="sxs-lookup"><span data-stu-id="9752e-207">Express queues and topics</span></span>

<span data-ttu-id="9752e-208">Entità Express abilitare scenari di riduzione della latenza e velocità effettiva elevata e sono supportate solo nel livello di messaggistica Standard hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-208">Express entities enable high throughput and reduced latency scenarios, and are supported only in hello Standard messaging tier.</span></span> <span data-ttu-id="9752e-209">Le entità create nelle [spazi dei nomi Premium](service-bus-premium-messaging.md) hello express opzione non è supportata.</span><span class="sxs-lookup"><span data-stu-id="9752e-209">Entities created in [Premium namespaces](service-bus-premium-messaging.md) do not support hello express option.</span></span> <span data-ttu-id="9752e-210">Con le entità rapide, se viene inviato un messaggio tooa coda o argomento, il messaggio hello non viene archiviato immediatamente nell'archivio di messaggistica hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-210">With express entities, if a message is sent tooa queue or topic, hello message is not immediately stored in hello messaging store.</span></span> <span data-ttu-id="9752e-211">ma viene memorizzato nella cache in memoria.</span><span class="sxs-lookup"><span data-stu-id="9752e-211">Instead, it is cached in memory.</span></span> <span data-ttu-id="9752e-212">Se il messaggio rimane nella coda di hello per più di pochi secondi, viene scritta automaticamente toostable archiviazione, pertanto la protezione da perdita a causa di un'interruzione di tooan.</span><span class="sxs-lookup"><span data-stu-id="9752e-212">If a message remains in hello queue for more than a few seconds, it is automatically written toostable storage, thus protecting it against loss due tooan outage.</span></span> <span data-ttu-id="9752e-213">Scrittura di messaggi hello in una cache di memoria aumentano la velocità effettiva e riducono la latenza poiché non esiste alcun toostable accesso spazio di archiviazione nel messaggio hello in fase di hello viene inviato.</span><span class="sxs-lookup"><span data-stu-id="9752e-213">Writing hello message into a memory cache increases throughput and reduces latency because there is no access toostable storage at hello time hello message is sent.</span></span> <span data-ttu-id="9752e-214">I messaggi usati entro pochi secondi non vengono scritte toohello archivio messaggi.</span><span class="sxs-lookup"><span data-stu-id="9752e-214">Messages that are consumed within a few seconds are not written toohello messaging store.</span></span> <span data-ttu-id="9752e-215">Hello di esempio seguente crea un argomento rapido.</span><span class="sxs-lookup"><span data-stu-id="9752e-215">hello following example creates an express topic.</span></span>

```csharp
TopicDescription td = new TopicDescription(TopicName);
td.EnableExpress = true;
namespaceManager.CreateTopic(td);
```

<span data-ttu-id="9752e-216">Se un messaggio contenente informazioni critiche che non devono andare perdute viene inviato entità express tooan, mittente hello possibile forzare il Bus di servizio tooimmediately mantenere archiviazione toostable dei messaggi hello dall'impostazione hello [ForcePersistence] [ ForcePersistence] proprietà troppo**true**.</span><span class="sxs-lookup"><span data-stu-id="9752e-216">If a message containing critical information that must not be lost is sent tooan express entity, hello sender can force Service Bus tooimmediately persist hello message toostable storage by setting hello [ForcePersistence][ForcePersistence] property too**true**.</span></span>

> [!NOTE]
> <span data-ttu-id="9752e-217">Le entità express non supportano le transazioni.</span><span class="sxs-lookup"><span data-stu-id="9752e-217">Express entities do not support transactions.</span></span>

## <a name="use-of-partitioned-queues-or-topics"></a><span data-ttu-id="9752e-218">Uso di code o argomenti partizionati</span><span class="sxs-lookup"><span data-stu-id="9752e-218">Use of partitioned queues or topics</span></span>
<span data-ttu-id="9752e-219">Internamente, viene utilizzato il Bus di servizio hello stesso nodo e tooprocess di archivio di messaggistica e archiviazione tutti i messaggi per un'entità di messaggistica (coda o argomento).</span><span class="sxs-lookup"><span data-stu-id="9752e-219">Internally, Service Bus uses hello same node and messaging store tooprocess and store all messages for a messaging entity (queue or topic).</span></span> <span data-ttu-id="9752e-220">Una coda o argomento partizionato, su hello invece viene distribuito tra più nodi e archivi di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="9752e-220">A partitioned queue or topic, on hello other hand, is distributed across multiple nodes and messaging stores.</span></span> <span data-ttu-id="9752e-221">Le code e gli argomenti partizionati non solo registrano una velocità effettiva superiore rispetto a quella delle code e degli argomenti normali, ma presentano anche una maggiore disponibilità.</span><span class="sxs-lookup"><span data-stu-id="9752e-221">Partitioned queues and topics not only yield a higher throughput than regular queues and topics, they also exhibit superior availability.</span></span> <span data-ttu-id="9752e-222">toocreate un'entità partizionata, hello set [proprietà EnablePartitioning] [ EnablePartitioning] proprietà troppo**true**, come illustrato nell'esempio seguente hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-222">toocreate a partitioned entity, set hello [EnablePartitioning][EnablePartitioning] property too**true**, as shown in hello following example.</span></span> <span data-ttu-id="9752e-223">Per altre informazioni sulle entità partizionate, vedere le [entità di messaggistica partizionate][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="9752e-223">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

```csharp
// Create partitioned queue.
QueueDescription qd = new QueueDescription(QueueName);
qd.EnablePartitioning = true;
namespaceManager.CreateQueue(qd);
```

## <a name="use-of-multiple-queues"></a><span data-ttu-id="9752e-224">Uso di più code</span><span class="sxs-lookup"><span data-stu-id="9752e-224">Use of multiple queues</span></span>

<span data-ttu-id="9752e-225">Se non è possibile toouse che una coda o argomento o partizionato hello previsto carico non può essere gestito da una singola coda o argomento partizionato, è necessario utilizzare più entità di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="9752e-225">If it is not possible toouse a partitioned queue or topic, or hello expected load cannot be handled by a single partitioned queue or topic, you must use multiple messaging entities.</span></span> <span data-ttu-id="9752e-226">Quando si usano più entità, creare un client dedicato per ogni entità, anziché utilizzare hello stesso client per tutte le entità.</span><span class="sxs-lookup"><span data-stu-id="9752e-226">When using multiple entities, create a dedicated client for each entity, instead of using hello same client for all entities.</span></span>

## <a name="development-and-testing-features"></a><span data-ttu-id="9752e-227">Funzionalità di sviluppo e test</span><span class="sxs-lookup"><span data-stu-id="9752e-227">Development and testing features</span></span>

<span data-ttu-id="9752e-228">Il bus di servizio presenta una funzionalità che viene usata in particolare per lo sviluppo e che **non deve mai essere usata nelle configurazioni di produzione**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span><span class="sxs-lookup"><span data-stu-id="9752e-228">Service Bus has one feature that is used specifically for development which **should never be used in production configurations**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span></span>

<span data-ttu-id="9752e-229">Nuove regole o i filtri vengono aggiunti toohello argomento, è possibile utilizzare [TopicDescription.EnableFilteringMessagesBeforePublishing][] tooverify che hello nuova espressione di filtro funziona come previsto.</span><span class="sxs-lookup"><span data-stu-id="9752e-229">When new rules or filters are added toohello topic, you can use [TopicDescription.EnableFilteringMessagesBeforePublishing][] tooverify that hello new filter expression is working as expected.</span></span>

## <a name="scenarios"></a><span data-ttu-id="9752e-230">Scenari</span><span class="sxs-lookup"><span data-stu-id="9752e-230">Scenarios</span></span>
<span data-ttu-id="9752e-231">Hello nelle sezioni seguenti descrivono tipici scenari di messaggistica e descrive le impostazioni Bus di servizio hello preferito.</span><span class="sxs-lookup"><span data-stu-id="9752e-231">hello following sections describe typical messaging scenarios and outline hello preferred Service Bus settings.</span></span> <span data-ttu-id="9752e-232">La velocità effettiva è classificata come bassa (minore di 1 messaggio al secondo), moderata (maggiore o uguale a 1 messaggio al secondo ma minore di 100 messaggi al secondo) ed elevata (maggiore o uguale a 100 messaggi al secondo).</span><span class="sxs-lookup"><span data-stu-id="9752e-232">Throughput rates are classified as small (less than 1 message/second), moderate (1 message/second or greater but less than 100 messages/second) and high (100 messages/second or greater).</span></span> <span data-ttu-id="9752e-233">Hello numero di client è classificato come ridotto (5 o meno), moderato (più di 5 ma minore di o too20 uguale) e grandi dimensioni (oltre 20).</span><span class="sxs-lookup"><span data-stu-id="9752e-233">hello number of clients are classified as small (5 or fewer), moderate (more than 5 but less than or equal too20), and large (more than 20).</span></span>

### <a name="high-throughput-queue"></a><span data-ttu-id="9752e-234">Coda ad alta velocità effettiva</span><span class="sxs-lookup"><span data-stu-id="9752e-234">High-throughput queue</span></span>
<span data-ttu-id="9752e-235">Obiettivo: Ottimizzare la velocità effettiva di hello di una singola coda.</span><span class="sxs-lookup"><span data-stu-id="9752e-235">Goal: Maximize hello throughput of a single queue.</span></span> <span data-ttu-id="9752e-236">numero di Hello di mittenti e ricevitori è limitato.</span><span class="sxs-lookup"><span data-stu-id="9752e-236">hello number of senders and receivers is small.</span></span>

* <span data-ttu-id="9752e-237">Usare una coda partizionata per migliorare prestazioni e disponibilità.</span><span class="sxs-lookup"><span data-stu-id="9752e-237">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="9752e-238">hello tooincrease complessivo velocità di invio nella coda di hello, utilizzare più mittenti toocreate factory.</span><span class="sxs-lookup"><span data-stu-id="9752e-238">tooincrease hello overall send rate into hello queue, use multiple message factories toocreate senders.</span></span> <span data-ttu-id="9752e-239">Per ogni mittente usare operazioni asincrone o più thread.</span><span class="sxs-lookup"><span data-stu-id="9752e-239">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="9752e-240">hello tooincrease complessivo velocità di ricezione dalla coda di hello, utilizzare più ricevitori toocreate factory di messaggio.</span><span class="sxs-lookup"><span data-stu-id="9752e-240">tooincrease hello overall receive rate from hello queue, use multiple message factories toocreate receivers.</span></span>
* <span data-ttu-id="9752e-241">Usare il vantaggio tootake operazioni asincrone di invio in batch sul lato client.</span><span class="sxs-lookup"><span data-stu-id="9752e-241">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="9752e-242">Impostare hello batch numero di intervallo too50ms tooreduce hello di trasmissioni tramite il protocollo client Bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="9752e-242">Set hello batching interval too50ms tooreduce hello number of Service Bus client protocol transmissions.</span></span> <span data-ttu-id="9752e-243">Se vengono usati più mittenti, aumentare hello too100ms intervallo di invio in batch.</span><span class="sxs-lookup"><span data-stu-id="9752e-243">If multiple senders are used, increase hello batching interval too100ms.</span></span>
* <span data-ttu-id="9752e-244">Lasciare abilitato l'accesso in batch all'archivio.</span><span class="sxs-lookup"><span data-stu-id="9752e-244">Leave batched store access enabled.</span></span> <span data-ttu-id="9752e-245">In questo modo aumenta hello complessiva frequenza in cui i messaggi possono essere scritti nella coda di hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-245">This increases hello overall rate at which messages can be written into hello queue.</span></span>
* <span data-ttu-id="9752e-246">Impostare i tempi di too20 di hello prefetch count velocità di elaborazione massima hello di tutti i ricevitori della factory.</span><span class="sxs-lookup"><span data-stu-id="9752e-246">Set hello prefetch count too20 times hello maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="9752e-247">In questo modo si riduce il numero di hello di trasmissioni tramite il protocollo client Bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="9752e-247">This reduces hello number of Service Bus client protocol transmissions.</span></span>

### <a name="multiple-high-throughput-queues"></a><span data-ttu-id="9752e-248">Code multiple ad alta velocità effettiva</span><span class="sxs-lookup"><span data-stu-id="9752e-248">Multiple high-throughput queues</span></span>
<span data-ttu-id="9752e-249">Obiettivo: aumentare la velocità effettiva complessiva di più code.</span><span class="sxs-lookup"><span data-stu-id="9752e-249">Goal: Maximize overall throughput of multiple queues.</span></span> <span data-ttu-id="9752e-250">velocità effettiva di Hello di una singola coda è moderata o elevata.</span><span class="sxs-lookup"><span data-stu-id="9752e-250">hello throughput of an individual queue is moderate or high.</span></span>

<span data-ttu-id="9752e-251">velocità effettiva massima di tooobtain tra più code, utilizza le impostazioni di hello descritte la velocità effettiva hello toomaximize di una singola coda.</span><span class="sxs-lookup"><span data-stu-id="9752e-251">tooobtain maximum throughput across multiple queues, use hello settings outlined toomaximize hello throughput of a single queue.</span></span> <span data-ttu-id="9752e-252">Inoltre, utilizzare i client toocreate factory diverse che inviano o ricevono da code diverse.</span><span class="sxs-lookup"><span data-stu-id="9752e-252">In addition, use different factories toocreate clients that send or receive from different queues.</span></span>

### <a name="low-latency-queue"></a><span data-ttu-id="9752e-253">Coda a bassa latenza</span><span class="sxs-lookup"><span data-stu-id="9752e-253">Low latency queue</span></span>
<span data-ttu-id="9752e-254">Obiettivo: ridurre la latenza end-to-end di una coda o di un argomento.</span><span class="sxs-lookup"><span data-stu-id="9752e-254">Goal: Minimize end-to-end latency of a queue or topic.</span></span> <span data-ttu-id="9752e-255">numero di Hello di mittenti e ricevitori è limitato.</span><span class="sxs-lookup"><span data-stu-id="9752e-255">hello number of senders and receivers is small.</span></span> <span data-ttu-id="9752e-256">velocità effettiva di Hello di hello coda è ridotta o moderata.</span><span class="sxs-lookup"><span data-stu-id="9752e-256">hello throughput of hello queue is small or moderate.</span></span>

* <span data-ttu-id="9752e-257">Usare una coda partizionata migliorare la disponibilità.</span><span class="sxs-lookup"><span data-stu-id="9752e-257">Use a partitioned queue for improved availability.</span></span>
* <span data-ttu-id="9752e-258">Disabilitare l'invio in batch sul lato client.</span><span class="sxs-lookup"><span data-stu-id="9752e-258">Disable client-side batching.</span></span> <span data-ttu-id="9752e-259">client Hello invia immediatamente un messaggio.</span><span class="sxs-lookup"><span data-stu-id="9752e-259">hello client immediately sends a message.</span></span>
* <span data-ttu-id="9752e-260">Disabilitare l'accesso in batch all'archivio.</span><span class="sxs-lookup"><span data-stu-id="9752e-260">Disable batched store access.</span></span> <span data-ttu-id="9752e-261">servizio Hello scrive immediatamente l'archivio di toohello messaggi hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-261">hello service immediately writes hello message toohello store.</span></span>
* <span data-ttu-id="9752e-262">Se si utilizza un singolo client, impostare hello prefetch count too20 volte hello velocità di elaborazione del ricevitore hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-262">If using a single client, set hello prefetch count too20 times hello processing rate of hello receiver.</span></span> <span data-ttu-id="9752e-263">Se più messaggi arrivano nella coda di hello hello stesso tempo, hello protocollo client di Service Bus trasmette tutto a hello contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="9752e-263">If multiple messages arrive at hello queue at hello same time, hello Service Bus client protocol transmits them all at hello same time.</span></span> <span data-ttu-id="9752e-264">Quando il client di hello riceve il messaggio successivo hello, che il messaggio è già nella cache locale hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-264">When hello client receives hello next message, that message is already in hello local cache.</span></span> <span data-ttu-id="9752e-265">cache di Hello dovrebbe essere basso.</span><span class="sxs-lookup"><span data-stu-id="9752e-265">hello cache should be small.</span></span>
* <span data-ttu-id="9752e-266">Se si utilizza più client, impostare hello prefetch count too0.</span><span class="sxs-lookup"><span data-stu-id="9752e-266">If using multiple clients, set hello prefetch count too0.</span></span> <span data-ttu-id="9752e-267">In questo modo, l'utente hello secondo client può ricevere secondo messaggio hello mentre il primo client hello sta ancora elaborando primo messaggio hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-267">By doing this, hello second client can receive hello second message while hello first client is still processing hello first message.</span></span>

### <a name="queue-with-a-large-number-of-senders"></a><span data-ttu-id="9752e-268">Coda con un numero elevato di mittenti</span><span class="sxs-lookup"><span data-stu-id="9752e-268">Queue with a large number of senders</span></span>
<span data-ttu-id="9752e-269">Obiettivo: aumentare la velocità effettiva di una coda o di un argomento con un numero elevato di mittenti.</span><span class="sxs-lookup"><span data-stu-id="9752e-269">Goal: Maximize throughput of a queue or topic with a large number of senders.</span></span> <span data-ttu-id="9752e-270">Ogni mittente invia messaggi con una velocità moderata.</span><span class="sxs-lookup"><span data-stu-id="9752e-270">Each sender sends messages with a moderate rate.</span></span> <span data-ttu-id="9752e-271">numero di Hello di ricevitori è limitato.</span><span class="sxs-lookup"><span data-stu-id="9752e-271">hello number of receivers is small.</span></span>

<span data-ttu-id="9752e-272">Bus di servizio consente di tooa di connessioni simultanee too1000 entità di messaggistica (o 5000 con AMQP).</span><span class="sxs-lookup"><span data-stu-id="9752e-272">Service Bus enables up too1000 concurrent connections tooa messaging entity (or 5000 using AMQP).</span></span> <span data-ttu-id="9752e-273">Questo limite viene applicato a livello di spazio dei nomi hello e dal limite hello di connessioni simultanee per spazio dei nomi sono limitate in code o argomenti/sottoscrizioni.</span><span class="sxs-lookup"><span data-stu-id="9752e-273">This limit is enforced at hello namespace level, and queues/topics/subscriptions are capped by hello limit of concurrent connections per namespace.</span></span> <span data-ttu-id="9752e-274">Per le code, questo numero è condiviso tra mittenti e ricevitori.</span><span class="sxs-lookup"><span data-stu-id="9752e-274">For queues, this number is shared between senders and receivers.</span></span> <span data-ttu-id="9752e-275">Se tutte le connessioni di 1000 sono necessari per i mittenti, è necessario sostituire coda hello con un argomento e una singola sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="9752e-275">If all 1000 connections are required for senders, you should replace hello queue with a topic and a single subscription.</span></span> <span data-ttu-id="9752e-276">Un argomento accetta too1000 connessioni simultanee dai mittenti, mentre la sottoscrizione hello accetta un ulteriori connessioni simultanee di 1000 dai ricevitori.</span><span class="sxs-lookup"><span data-stu-id="9752e-276">A topic accepts up too1000 concurrent connections from senders, whereas hello subscription accepts an additional 1000 concurrent connections from receivers.</span></span> <span data-ttu-id="9752e-277">Se sono necessari più di 1000 mittenti simultanei mittenti hello per l'invio di messaggi toohello protocollo di Service Bus tramite HTTP.</span><span class="sxs-lookup"><span data-stu-id="9752e-277">If more than 1000 concurrent senders are required, hello senders should send messages toohello Service Bus protocol via HTTP.</span></span>

<span data-ttu-id="9752e-278">velocità effettiva toomaximize, hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="9752e-278">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="9752e-279">Usare una coda partizionata per migliorare prestazioni e disponibilità.</span><span class="sxs-lookup"><span data-stu-id="9752e-279">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="9752e-280">Se ogni mittente si trova in un processo diverso, usare solo una singola factory per processo.</span><span class="sxs-lookup"><span data-stu-id="9752e-280">If each sender resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="9752e-281">Usare il vantaggio tootake operazioni asincrone di invio in batch sul lato client.</span><span class="sxs-lookup"><span data-stu-id="9752e-281">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="9752e-282">Utilizzare il valore predefinito hello batch intervallo di 20 ms tooreduce hello numero di trasmissioni tramite il protocollo client Bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="9752e-282">Use hello default batching interval of 20ms tooreduce hello number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="9752e-283">Lasciare abilitato l'accesso in batch all'archivio.</span><span class="sxs-lookup"><span data-stu-id="9752e-283">Leave batched store access enabled.</span></span> <span data-ttu-id="9752e-284">In questo modo aumenta hello complessiva frequenza in cui possono essere scritti i messaggi in coda hello o un argomento.</span><span class="sxs-lookup"><span data-stu-id="9752e-284">This increases hello overall rate at which messages can be written into hello queue or topic.</span></span>
* <span data-ttu-id="9752e-285">Impostare i tempi di too20 di hello prefetch count velocità di elaborazione massima hello di tutti i ricevitori della factory.</span><span class="sxs-lookup"><span data-stu-id="9752e-285">Set hello prefetch count too20 times hello maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="9752e-286">In questo modo si riduce il numero di hello di trasmissioni tramite il protocollo client Bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="9752e-286">This reduces hello number of Service Bus client protocol transmissions.</span></span>

### <a name="queue-with-a-large-number-of-receivers"></a><span data-ttu-id="9752e-287">Coda con un numero elevato di ricevitori</span><span class="sxs-lookup"><span data-stu-id="9752e-287">Queue with a large number of receivers</span></span>
<span data-ttu-id="9752e-288">Obiettivo: Hello ottimizzare la velocità di una coda o sottoscrizione con un numero elevato di ricevitori di ricezione.</span><span class="sxs-lookup"><span data-stu-id="9752e-288">Goal: Maximize hello receive rate of a queue or subscription with a large number of receivers.</span></span> <span data-ttu-id="9752e-289">Ogni ricevitore riceve messaggi a una velocità moderata.</span><span class="sxs-lookup"><span data-stu-id="9752e-289">Each receiver receives messages at a moderate rate.</span></span> <span data-ttu-id="9752e-290">numero di Hello di mittenti è limitato.</span><span class="sxs-lookup"><span data-stu-id="9752e-290">hello number of senders is small.</span></span>

<span data-ttu-id="9752e-291">Bus di servizio consente di entità di tooan too1000 connessioni simultanee.</span><span class="sxs-lookup"><span data-stu-id="9752e-291">Service Bus enables up too1000 concurrent connections tooan entity.</span></span> <span data-ttu-id="9752e-292">Se una coda richiede più di 1000 ricevitori, è necessario sostituire coda hello con un argomento e più sottoscrizioni.</span><span class="sxs-lookup"><span data-stu-id="9752e-292">If a queue requires more than 1000 receivers, you should replace hello queue with a topic and multiple subscriptions.</span></span> <span data-ttu-id="9752e-293">Ogni sottoscrizione può supportare le connessioni simultanee too1000.</span><span class="sxs-lookup"><span data-stu-id="9752e-293">Each subscription can support up too1000 concurrent connections.</span></span> <span data-ttu-id="9752e-294">In alternativa, ricevitori possono accedere coda hello tramite hello protocollo HTTP.</span><span class="sxs-lookup"><span data-stu-id="9752e-294">Alternatively, receivers can access hello queue via hello HTTP protocol.</span></span>

<span data-ttu-id="9752e-295">velocità effettiva toomaximize, hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="9752e-295">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="9752e-296">Usare una coda partizionata per migliorare prestazioni e disponibilità.</span><span class="sxs-lookup"><span data-stu-id="9752e-296">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="9752e-297">Se ogni ricevitore si trova in un processo diverso, usare solo una singola factory per processo.</span><span class="sxs-lookup"><span data-stu-id="9752e-297">If each receiver resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="9752e-298">I ricevitori possono usare operazioni sincrone o asincrone.</span><span class="sxs-lookup"><span data-stu-id="9752e-298">Receivers can use synchronous or asynchronous operations.</span></span> <span data-ttu-id="9752e-299">Specificato con gravità moderata hello velocità di un singolo ricevitore di ricezione, invio in batch sul lato client di una richiesta Complete non influisce sulla velocità effettiva del ricevitore.</span><span class="sxs-lookup"><span data-stu-id="9752e-299">Given hello moderate receive rate of an individual receiver, client-side batching of a Complete request does not affect receiver throughput.</span></span>
* <span data-ttu-id="9752e-300">Lasciare abilitato l'accesso in batch all'archivio.</span><span class="sxs-lookup"><span data-stu-id="9752e-300">Leave batched store access enabled.</span></span> <span data-ttu-id="9752e-301">Hello questo modo si riduce il carico complessivo dell'entità hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-301">This reduces hello overall load of hello entity.</span></span> <span data-ttu-id="9752e-302">Riduce inoltre hello velocità con cui possono essere scritti i messaggi in coda hello o un argomento.</span><span class="sxs-lookup"><span data-stu-id="9752e-302">It also reduces hello overall rate at which messages can be written into hello queue or topic.</span></span>
* <span data-ttu-id="9752e-303">Impostare valore piccola tooa hello prefetch count (ad esempio PrefetchCount = 10).</span><span class="sxs-lookup"><span data-stu-id="9752e-303">Set hello prefetch count tooa small value (for example, PrefetchCount = 10).</span></span> <span data-ttu-id="9752e-304">In questo modo si evita che i ricevitori rimangano inattivi mentre per altri è presente un numero elevato di messaggi memorizzati nella cache.</span><span class="sxs-lookup"><span data-stu-id="9752e-304">This prevents receivers from being idle while other receivers have large numbers of messages cached.</span></span>

### <a name="topic-with-a-small-number-of-subscriptions"></a><span data-ttu-id="9752e-305">Argomento con un numero limitato di sottoscrizioni</span><span class="sxs-lookup"><span data-stu-id="9752e-305">Topic with a small number of subscriptions</span></span>
<span data-ttu-id="9752e-306">Obiettivo: Ottimizzare la velocità effettiva di hello di un argomento con un numero limitato di sottoscrizioni.</span><span class="sxs-lookup"><span data-stu-id="9752e-306">Goal: Maximize hello throughput of a topic with a small number of subscriptions.</span></span> <span data-ttu-id="9752e-307">Un messaggio viene ricevuto da molte sottoscrizioni, ovvero hello combinato ricezione velocità su tutte le sottoscrizioni è maggiore velocità di invio hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-307">A message is received by many subscriptions, which means hello combined receive rate over all subscriptions is larger than hello send rate.</span></span> <span data-ttu-id="9752e-308">numero di Hello di mittenti è limitato.</span><span class="sxs-lookup"><span data-stu-id="9752e-308">hello number of senders is small.</span></span> <span data-ttu-id="9752e-309">numero di Hello di ricevitori per sottoscrizione è limitato.</span><span class="sxs-lookup"><span data-stu-id="9752e-309">hello number of receivers per subscription is small.</span></span>

<span data-ttu-id="9752e-310">velocità effettiva toomaximize, hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="9752e-310">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="9752e-311">Usare un argomento partizionato per migliorare prestazioni e disponibilità.</span><span class="sxs-lookup"><span data-stu-id="9752e-311">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="9752e-312">hello tooincrease complessivo velocità di invio in argomento hello, utilizzare più mittenti toocreate factory.</span><span class="sxs-lookup"><span data-stu-id="9752e-312">tooincrease hello overall send rate into hello topic, use multiple message factories toocreate senders.</span></span> <span data-ttu-id="9752e-313">Per ogni mittente usare operazioni asincrone o più thread.</span><span class="sxs-lookup"><span data-stu-id="9752e-313">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="9752e-314">hello tooincrease complessivo velocità di ricezione da una sottoscrizione, utilizzare più ricevitori toocreate factory di messaggio.</span><span class="sxs-lookup"><span data-stu-id="9752e-314">tooincrease hello overall receive rate from a subscription, use multiple message factories toocreate receivers.</span></span> <span data-ttu-id="9752e-315">Per ogni ricevitore usare operazioni asincrone o più thread.</span><span class="sxs-lookup"><span data-stu-id="9752e-315">For each receiver, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="9752e-316">Usare il vantaggio tootake operazioni asincrone di invio in batch sul lato client.</span><span class="sxs-lookup"><span data-stu-id="9752e-316">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="9752e-317">Utilizzare il valore predefinito hello batch intervallo di 20 ms tooreduce hello numero di trasmissioni tramite il protocollo client Bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="9752e-317">Use hello default batching interval of 20ms tooreduce hello number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="9752e-318">Lasciare abilitato l'accesso in batch all'archivio.</span><span class="sxs-lookup"><span data-stu-id="9752e-318">Leave batched store access enabled.</span></span> <span data-ttu-id="9752e-319">In questo modo aumenta hello complessiva frequenza in cui i messaggi possono essere scritti in argomento hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-319">This increases hello overall rate at which messages can be written into hello topic.</span></span>
* <span data-ttu-id="9752e-320">Impostare i tempi di too20 di hello prefetch count velocità di elaborazione massima hello di tutti i ricevitori della factory.</span><span class="sxs-lookup"><span data-stu-id="9752e-320">Set hello prefetch count too20 times hello maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="9752e-321">In questo modo si riduce il numero di hello di trasmissioni tramite il protocollo client Bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="9752e-321">This reduces hello number of Service Bus client protocol transmissions.</span></span>

### <a name="topic-with-a-large-number-of-subscriptions"></a><span data-ttu-id="9752e-322">Argomento con un numero elevato di sottoscrizioni</span><span class="sxs-lookup"><span data-stu-id="9752e-322">Topic with a large number of subscriptions</span></span>
<span data-ttu-id="9752e-323">Obiettivo: Ottimizzare la velocità effettiva di hello di un argomento con un numero elevato di sottoscrizioni.</span><span class="sxs-lookup"><span data-stu-id="9752e-323">Goal: Maximize hello throughput of a topic with a large number of subscriptions.</span></span> <span data-ttu-id="9752e-324">Un messaggio viene ricevuto da molte sottoscrizioni, ovvero hello combinato ricezione velocità su tutte le sottoscrizioni è maggiori rispetto alla velocità di invio hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-324">A message is received by many subscriptions, which means hello combined receive rate over all subscriptions is much larger than hello send rate.</span></span> <span data-ttu-id="9752e-325">numero di Hello di mittenti è limitato.</span><span class="sxs-lookup"><span data-stu-id="9752e-325">hello number of senders is small.</span></span> <span data-ttu-id="9752e-326">numero di Hello di ricevitori per sottoscrizione è limitato.</span><span class="sxs-lookup"><span data-stu-id="9752e-326">hello number of receivers per subscription is small.</span></span>

<span data-ttu-id="9752e-327">Gli argomenti con un numero elevato di sottoscrizioni in genere espongono una velocità effettiva globale ridotta se tutti i messaggi vengono indirizzati tooall sottoscrizioni.</span><span class="sxs-lookup"><span data-stu-id="9752e-327">Topics with a large number of subscriptions typically expose a low overall throughput if all messages are routed tooall subscriptions.</span></span> <span data-ttu-id="9752e-328">Ciò è causato dal fatto di hello che ogni messaggio viene ricevuto più volte e tutti i messaggi contenuti in un argomento e tutte le relative sottoscrizioni vengono archiviate in hello stesso archivio.</span><span class="sxs-lookup"><span data-stu-id="9752e-328">This is caused by hello fact that each message is received many times, and all messages that are contained in a topic and all its subscriptions are stored in hello same store.</span></span> <span data-ttu-id="9752e-329">Si presuppone che il numero di hello di mittenti e numero di ricevitori per sottoscrizione è piccoli.</span><span class="sxs-lookup"><span data-stu-id="9752e-329">It is assumed that hello number of senders and number of receivers per subscription is small.</span></span> <span data-ttu-id="9752e-330">Bus di servizio supporta backup too2, 000 sottoscrizioni per argomento.</span><span class="sxs-lookup"><span data-stu-id="9752e-330">Service Bus supports up too2,000 subscriptions per topic.</span></span>

<span data-ttu-id="9752e-331">velocità effettiva toomaximize, hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="9752e-331">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="9752e-332">Usare un argomento partizionato per migliorare prestazioni e disponibilità.</span><span class="sxs-lookup"><span data-stu-id="9752e-332">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="9752e-333">Usare il vantaggio tootake operazioni asincrone di invio in batch sul lato client.</span><span class="sxs-lookup"><span data-stu-id="9752e-333">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="9752e-334">Utilizzare il valore predefinito hello batch intervallo di 20 ms tooreduce hello numero di trasmissioni tramite il protocollo client Bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="9752e-334">Use hello default batching interval of 20ms tooreduce hello number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="9752e-335">Lasciare abilitato l'accesso in batch all'archivio.</span><span class="sxs-lookup"><span data-stu-id="9752e-335">Leave batched store access enabled.</span></span> <span data-ttu-id="9752e-336">In questo modo aumenta hello complessiva frequenza in cui i messaggi possono essere scritti in argomento hello.</span><span class="sxs-lookup"><span data-stu-id="9752e-336">This increases hello overall rate at which messages can be written into hello topic.</span></span>
* <span data-ttu-id="9752e-337">Impostare i tempi di hello prefetch count too20 ricezione hello previsto frequenza in secondi.</span><span class="sxs-lookup"><span data-stu-id="9752e-337">Set hello prefetch count too20 times hello expected receive rate in seconds.</span></span> <span data-ttu-id="9752e-338">In questo modo si riduce il numero di hello di trasmissioni tramite il protocollo client Bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="9752e-338">This reduces hello number of Service Bus client protocol transmissions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9752e-339">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="9752e-339">Next steps</span></span>
<span data-ttu-id="9752e-340">toolearn più sull'ottimizzazione delle prestazioni del Bus di servizio, vedere [le entità di messaggistica partizionate][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="9752e-340">toolearn more about optimizing Service Bus performance, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[MessageSender]: /dotnet/api/microsoft.servicebus.messaging.messagesender
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[PeekLock]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[ReceiveAndDelete]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[BatchFlushInterval]: /dotnet/api/microsoft.servicebus.messaging.netmessagingtransportsettings.batchflushinterval#Microsoft_ServiceBus_Messaging_NetMessagingTransportSettings_BatchFlushInterval
[EnableBatchedOperations]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablebatchedoperations#Microsoft_ServiceBus_Messaging_QueueDescription_EnableBatchedOperations
[QueueClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.queueclient.prefetchcount#Microsoft_ServiceBus_Messaging_QueueClient_PrefetchCount
[SubscriptionClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.subscriptionclient.prefetchcount#Microsoft_ServiceBus_Messaging_SubscriptionClient_PrefetchCount
[ForcePersistence]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence#Microsoft_ServiceBus_Messaging_BrokeredMessage_ForcePersistence
[EnablePartitioning]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablepartitioning#Microsoft_ServiceBus_Messaging_QueueDescription_EnablePartitioning
[Partitioned messaging entities]: service-bus-partitioning.md
[TopicDescription.EnableFilteringMessagesBeforePublishing]: /dotnet/api/microsoft.servicebus.messaging.topicdescription.enablefilteringmessagesbeforepublishing#Microsoft_ServiceBus_Messaging_TopicDescription_EnableFilteringMessagesBeforePublishing
