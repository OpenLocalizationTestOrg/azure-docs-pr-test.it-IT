---
title: Risolvere i problemi di Azure Load Balancer | Microsoft Docs
description: Risolvere i problemi noti di Azure Load Balancer
services: load-balancer
documentationcenter: na
author: RamanDhillon
manager: timlt
editor: 
ms.assetid: 
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/10/2017
ms.author: kumud
ms.openlocfilehash: df5c836abbf09889f4859170359c0ee6c1b03378
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/03/2017
---
# <a name="troubleshoot-azure-load-balancer"></a><span data-ttu-id="e2a8b-103">Risolvere i problemi di Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="e2a8b-103">Troubleshoot Azure Load Balancer</span></span>

<span data-ttu-id="e2a8b-104">Questa pagina fornisce informazioni sulla risoluzione dei problemi comuni di Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-104">This page provides troubleshooting information for common Azure Load Balancer questions.</span></span> <span data-ttu-id="e2a8b-105">Quando la connettività di Load Balancer non è disponibile, i sintomi più comuni sono i seguenti:</span><span class="sxs-lookup"><span data-stu-id="e2a8b-105">When the Load Balancer connectivity is unavailable, the most common symptoms are as follows:</span></span> 
- <span data-ttu-id="e2a8b-106">Le macchine virtuali controllate da Load Balancer non rispondono ai probe di integrità</span><span class="sxs-lookup"><span data-stu-id="e2a8b-106">VMs behind the Load Balancer are not responding to health probes</span></span> 
- <span data-ttu-id="e2a8b-107">Le macchine virtuali dietro Load Balancer non rispondono al traffico nella porta configurata</span><span class="sxs-lookup"><span data-stu-id="e2a8b-107">VMs behind the Load Balancer are not responding to the traffic on the configured port</span></span>

## <a name="symptom-vms-behind-the-load-balancer-are-not-responding-to-health-probes"></a><span data-ttu-id="e2a8b-108">Sintomo: le macchine virtuali dietro Load Balancer non rispondono ai probe di integrità</span><span class="sxs-lookup"><span data-stu-id="e2a8b-108">Symptom: VMs behind the Load Balancer are not responding to health probes</span></span>
<span data-ttu-id="e2a8b-109">Per partecipare al set di bilanciamento del carico, i server back-end devono superare il controllo del probe.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-109">For the backend servers to participate in the load balancer set, they must pass the probe check.</span></span> <span data-ttu-id="e2a8b-110">Per altre informazioni sui probe di integrità, vedere [Informazioni sui probe di bilanciamento del carico](load-balancer-custom-probe-overview.md).</span><span class="sxs-lookup"><span data-stu-id="e2a8b-110">For more information about health probes, see [Understanding Load Balancer Probes](load-balancer-custom-probe-overview.md).</span></span> 

<span data-ttu-id="e2a8b-111">Le macchine virtuali del pool back-end di Load Balancer possono non rispondere ai probe per i motivi seguenti:</span><span class="sxs-lookup"><span data-stu-id="e2a8b-111">The Load Balancer backend pool VMs may not be responding to the probes due to any of the following reasons:</span></span> 
- <span data-ttu-id="e2a8b-112">La macchina virtuale del pool back-end di Load Balancer non è integra</span><span class="sxs-lookup"><span data-stu-id="e2a8b-112">Load Balancer backend pool VM is unhealthy</span></span> 
- <span data-ttu-id="e2a8b-113">La macchina virtuale del pool back-end di Load Balancer non è in ascolto nella porta probe</span><span class="sxs-lookup"><span data-stu-id="e2a8b-113">Load Balancer backend pool VM is not listening on the probe port</span></span> 
- <span data-ttu-id="e2a8b-114">Un firewall o un gruppo di sicurezza di rete blocca la porta nelle macchine virtuali del pool back-end di Load Balancer</span><span class="sxs-lookup"><span data-stu-id="e2a8b-114">Firewall, or a network security group is blocking the port on the Load Balancer backend pool VMs</span></span> 
- <span data-ttu-id="e2a8b-115">Altri errori di configurazione in Load Balancer</span><span class="sxs-lookup"><span data-stu-id="e2a8b-115">Other misconfigurations in Load Balancer</span></span>

### <a name="cause-1-load-balancer-backend-pool-vm-is-unhealthy"></a><span data-ttu-id="e2a8b-116">Causa 1: la macchina virtuale del pool back-end di Load Balancer non è integra</span><span class="sxs-lookup"><span data-stu-id="e2a8b-116">Cause 1: Load Balancer backend pool VM is unhealthy</span></span> 

<span data-ttu-id="e2a8b-117">**Convalida e la risoluzione**</span><span class="sxs-lookup"><span data-stu-id="e2a8b-117">**Validation and resolution**</span></span>

<span data-ttu-id="e2a8b-118">Per risolvere questo problema, accedere alle macchine virtuali partecipanti e verificare se la macchina virtuale è integra e può rispondere a richieste **PsPing** o **TCPing** inviate da un'altra macchina virtuale nel pool.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-118">To resolve this issue, log in to the participating VMs, and check if the VM state is healthy, and can respond to **PsPing** or **TCPing** from another VM in the pool.</span></span> <span data-ttu-id="e2a8b-119">Se la macchina virtuale non è integra o non riesce a rispondere al probe, è necessario risolvere il problema e ripristinare l'integrità della macchina virtuale prima che questa possa partecipare al bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-119">If the VM is unhealthy, or is unable to respond to the probe, you must rectify the issue and get the VM back to a healthy state before it can participate in load balancing.</span></span>

### <a name="cause-2-load-balancer-backend-pool-vm-is-not-listening-on-the-probe-port"></a><span data-ttu-id="e2a8b-120">Causa 2: la macchina virtuale del pool back-end di Load Balancer non è in ascolto nella porta probe</span><span class="sxs-lookup"><span data-stu-id="e2a8b-120">Cause 2: Load Balancer backend pool VM is not listening on the probe port</span></span>
<span data-ttu-id="e2a8b-121">Se la macchina virtuale è integra, ma non risponde al probe, è possibile che la porta probe non sia aperta nella macchina virtuale partecipante o che la macchina virtuale non sia in ascolto su tale porta.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-121">If the VM is healthy, but is not responding to the probe, then one possible reason could be that the probe port is not open on the participating VM, or the VM is not listening on that port.</span></span>

<span data-ttu-id="e2a8b-122">**Convalida e la risoluzione**</span><span class="sxs-lookup"><span data-stu-id="e2a8b-122">**Validation and resolution**</span></span>

1. <span data-ttu-id="e2a8b-123">Accedere alla macchina virtuale back-end.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-123">Log in to the backend VM.</span></span> 
2. <span data-ttu-id="e2a8b-124">Aprire un prompt dei comandi ed eseguire questo comando per verificare che un'applicazione sia in ascolto nella porta probe:</span><span class="sxs-lookup"><span data-stu-id="e2a8b-124">Open a command prompt and run the following command to validate there is an application listening on the probe port:</span></span>   
            <span data-ttu-id="e2a8b-125">netstat -an</span><span class="sxs-lookup"><span data-stu-id="e2a8b-125">netstat -an</span></span>
3. <span data-ttu-id="e2a8b-126">Se lo stato della porta non è elencato come **LISTENING**, configurare la porta corretta.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-126">If the port state is not listed as **LISTENING**, configure the proper port.</span></span> 
4. <span data-ttu-id="e2a8b-127">In alternativa, selezionare un'altra porta che sia elencata come **LISTENING** e aggiornare la configurazione di Load Balancer di conseguenza.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-127">Alternatively, select another port, that is listed as **LISTENING**, and update load balancer configuration accordingly.</span></span>              

###<a name="cause-3-firewall-or-a-network-security-group-is-blocking-the-port-on-the-load-balancer-backend-pool-vms"></a><span data-ttu-id="e2a8b-128">Causa 3: un firewall o un gruppo di sicurezza di rete blocca la porta nelle macchine virtuali del pool back-end di Load Balancer</span><span class="sxs-lookup"><span data-stu-id="e2a8b-128">Cause 3: Firewall, or a network security group is blocking the port on the load balancer backend pool VMs</span></span>  
<span data-ttu-id="e2a8b-129">Se il firewall nella macchina virtuale blocca la porta probe oppure uno o più gruppi di sicurezza di rete configurati nella subnet o nella macchina virtuale non consentono al probe di raggiungere la porta, la macchina virtuale non può rispondere al probe di integrità.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-129">If the firewall on the VM is blocking the probe port, or one or more network security groups configured on the subnet or on the VM, is not allowing the probe to reach the port, the VM is unable to respond to the health probe.</span></span>          

<span data-ttu-id="e2a8b-130">**Convalida e la risoluzione**</span><span class="sxs-lookup"><span data-stu-id="e2a8b-130">**Validation and resolution**</span></span>

* <span data-ttu-id="e2a8b-131">Se il firewall è abilitato, verificare se è configurato per consentire la porta probe.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-131">If the firewall is enabled, check if it is configured to allow the probe port.</span></span> <span data-ttu-id="e2a8b-132">In caso contrario, configurare il firewall per consentire il traffico nella porta probe e riprovare.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-132">If not, configure the firewall to allow traffic on the probe port, and test again.</span></span> 
* <span data-ttu-id="e2a8b-133">Dall'elenco dei gruppi di sicurezza di rete, verificare se il traffico in ingresso o in uscita nella porta probe ha interferenze.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-133">From the list of network security groups, check if the incoming or outgoing traffic on the probe port has interference.</span></span> 
* <span data-ttu-id="e2a8b-134">Verificare anche se nella scheda di interfaccia di rete della macchina virtuale o nella subnet è presente una regola di tipo **Nega tutto** di un gruppo di sicurezza di rete avente una priorità superiore rispetto alla regola predefinita che consente il traffico e i probe di Load Balancer. I gruppi di sicurezza di rete devono consentire l'IP 168.63.129.16 di Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-134">Also, check if a **Deny All** network security groups rule on the NIC of the VM or the subnet that has a higher priority than the default rule that allows LB probes & traffic (network security groups must allow Load Balancer IP of 168.63.129.16).</span></span> 
* <span data-ttu-id="e2a8b-135">Se alcune di queste regole bloccano il traffico probe, rimuoverle e riconfigurarle per consentire il traffico probe.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-135">If any of these rules are blocking the probe traffic, remove and reconfigure the rules to allow the probe traffic.</span></span>  
* <span data-ttu-id="e2a8b-136">Verificare se la macchina virtuale ha ora iniziato a rispondere ai probe di integrità.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-136">Test if the VM has now started responding to the health probes.</span></span> 

### <a name="cause-4-other-misconfigurations-in-load-balancer"></a><span data-ttu-id="e2a8b-137">Causa 4: altri errori di configurazione in Load Balancer</span><span class="sxs-lookup"><span data-stu-id="e2a8b-137">Cause 4: Other misconfigurations in Load Balancer</span></span>
<span data-ttu-id="e2a8b-138">Se tutte le cause precedenti sembrano essere state verificate e risolte correttamente, ma la macchina virtuale back-end continua a non rispondere al probe di integrità, testare manualmente la connettività e raccogliere alcune tracce per ottenere informazioni sulla connettività stessa.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-138">If all the preceding causes seem to be validated and resolved correctly, and the backend VM still does not respond to the health probe, then manually test for connectivity, and collect some traces to understand the connectivity.</span></span>

<span data-ttu-id="e2a8b-139">**Convalida e la risoluzione**</span><span class="sxs-lookup"><span data-stu-id="e2a8b-139">**Validation and resolution**</span></span>

* <span data-ttu-id="e2a8b-140">Usare **Psping** da una delle altre macchine virtuali all'interno della rete virtuale per testare la risposta della porta probe, ad esempio \psping.exe -t 10.0.0.4:3389, e registrare i risultati.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-140">Use **Psping** from one of the other VMs within the VNet to test the probe port response (example: .\psping.exe -t 10.0.0.4:3389) and record results.</span></span> 
* <span data-ttu-id="e2a8b-141">Usare **TCPing** da una delle altre macchine virtuali all'interno della rete virtuale per testare la risposta della porta probe (esempio: \tcping.exe 10.0.0.4 3389) e registrare i risultati.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-141">Use **TCPing** from one of the other VMs within the VNet to test the probe port response (example: .\tcping.exe 10.0.0.4 3389) and record results.</span></span> 
* <span data-ttu-id="e2a8b-142">Se non si ricevono risposte con questi test di ping:</span><span class="sxs-lookup"><span data-stu-id="e2a8b-142">If no response is received in these ping tests, then</span></span>
    - <span data-ttu-id="e2a8b-143">Eseguire una traccia Netsh simultanea nella macchina virtuale del pool back-end e un'altra macchina virtuale di test dalla stessa rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-143">Run a simultaneous Netsh trace on the target backend pool VM and another test VM from the same VNet.</span></span> <span data-ttu-id="e2a8b-144">Eseguire ora un test PsPing per un certo periodo, raccogliere alcune tracce di rete e quindi interrompere il test.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-144">Now, run a PsPing test for some time, collect some network traces, and then stop the test.</span></span> 
    - <span data-ttu-id="e2a8b-145">Analizzare l'acquisizione di rete e verificare se sono disponibili pacchetti in ingresso e in uscita correlati alla query di ping.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-145">Analyze the network capture and see if there are both incoming and outgoing packets related to the ping query.</span></span> 
        - <span data-ttu-id="e2a8b-146">Se non si osservano pacchetti in ingresso nella macchina virtuale del pool back-end, è possibile che un gruppo di sicurezza di rete o una route definita dall'utente configurata in modo errato blocchi il traffico.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-146">If no incoming packets are observed on the backend pool VM, there is potentially a network security groups or UDR mis-configuration blocking the traffic.</span></span> 
        - <span data-ttu-id="e2a8b-147">Se non si osservano pacchetti in uscita nella macchina virtuale del pool back-end, è necessario identificare eventuali problemi non correlati nella macchina virtuale, ad esempio la presenza di un'applicazione che blocca la porta probe.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-147">If no outgoing packets are observed on the backend pool VM, the VM needs to be checked for any unrelated issues (for eample, Application blocking the probe port).</span></span> 
    - <span data-ttu-id="e2a8b-148">Verificare se i pacchetti probe vengono forzati verso un'altra destinazione, magari tramite impostazioni delle route definite dall'utente, prima di raggiungere il servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-148">Verify if the probe packets are being forced to another destination (possibly via UDR settings) before reaching the load balancer.</span></span> <span data-ttu-id="e2a8b-149">Ciò può impedire costantemente al traffico di raggiungere la macchina virtuale back-end.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-149">This can cause the traffic to never reach the backend VM.</span></span> 
* <span data-ttu-id="e2a8b-150">Modificare il tipo di probe, ad esempio da HTTP a TCP, e configurare la porta corrispondente negli ACL dei gruppi di sicurezza di rete e nel firewall per verificare se il problema è la configurazione della risposta probe.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-150">Change the probe type (for example, HTTP to TCP), and configure the corresponding port in network security groups ACLs and firewall to validate if the issue is with the configuration of probe response.</span></span> <span data-ttu-id="e2a8b-151">Per altre informazioni sulla configurazione del probe di integrità, vedere la [configurazione del probe di integrità di bilanciamento del carico con endpoint](https://blogs.msdn.microsoft.com/mast/2016/01/26/endpoint-load-balancing-heath-probe-configuration-details/).</span><span class="sxs-lookup"><span data-stu-id="e2a8b-151">For more information about health probe configuration, see [Endpoint Load Balancing health probe configuration](https://blogs.msdn.microsoft.com/mast/2016/01/26/endpoint-load-balancing-heath-probe-configuration-details/).</span></span>

## <a name="symptom-vms-behind-load-balancer-are-not-responding-to-traffic-on-the-configured-data-port"></a><span data-ttu-id="e2a8b-152">Sintomo: le macchine virtuali dietro Load Balancer non rispondono al traffico nella porta di dati configurata</span><span class="sxs-lookup"><span data-stu-id="e2a8b-152">Symptom: VMs behind Load Balancer are not responding to traffic on the configured data port</span></span>

<span data-ttu-id="e2a8b-153">Se una macchina virtuale del pool back-end è elencata come integra e risponde ai probe di integrità, ma comunque non partecipa al bilanciamento del carico o non risponde al traffico dati, i motivi potrebbero essere i seguenti:</span><span class="sxs-lookup"><span data-stu-id="e2a8b-153">If a backend pool VM is listed as healthy and responds to the health probes, but is still not participating in the Load Balancing, or is not responding to the data traffic, it may be due to any of the following reasons:</span></span> 
* <span data-ttu-id="e2a8b-154">La macchina virtuale del pool back-end di Load Balancer non è in ascolto nella porta dati</span><span class="sxs-lookup"><span data-stu-id="e2a8b-154">Load Balancer Backend pool VM is not listening on the data port</span></span> 
* <span data-ttu-id="e2a8b-155">Un gruppo di sicurezza di rete blocca la porta nella macchina virtuale del pool back-end di Load Balancer</span><span class="sxs-lookup"><span data-stu-id="e2a8b-155">Network security group is blocking the port on the Load Balancer backend pool VM</span></span>  
* <span data-ttu-id="e2a8b-156">Accesso a Load Balancer dalla stessa macchina virtuale e interfaccia di rete</span><span class="sxs-lookup"><span data-stu-id="e2a8b-156">Accessing the Load Balancer from the same VM and NIC</span></span> 
* <span data-ttu-id="e2a8b-157">Accesso all'indirizzo VIP del servizio di bilanciamento del carico Internet dalla macchina virtuale del pool back-end di Load Balancer</span><span class="sxs-lookup"><span data-stu-id="e2a8b-157">Accessing the Internet Load Balancer VIP from the participating Load Balancer backend pool VM</span></span> 

### <a name="cause-1-load-balancer-backend-pool-vm-is-not-listening-on-the-data-port"></a><span data-ttu-id="e2a8b-158">Causa 1: la macchina virtuale del pool back-end di Load Balancer non è in ascolto nella porta dati</span><span class="sxs-lookup"><span data-stu-id="e2a8b-158">Cause 1: Load Balancer backend pool VM is not listening on the data port</span></span> 
<span data-ttu-id="e2a8b-159">Se una macchina virtuale non risponde al traffico dati, è possibile che la porta di destinazione non sia aperta nella macchina virtuale partecipante oppure che la macchina virtuale non sia in ascolto nella porta.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-159">If a VM does not respond to the data traffic, it may be because either the target port is not open on the participating VM, or, the VM is not listening on that port.</span></span> 

<span data-ttu-id="e2a8b-160">**Convalida e la risoluzione**</span><span class="sxs-lookup"><span data-stu-id="e2a8b-160">**Validation and resolution**</span></span>

1. <span data-ttu-id="e2a8b-161">Accedere alla macchina virtuale back-end.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-161">Log in to the backend VM.</span></span> 
2. <span data-ttu-id="e2a8b-162">Aprire un prompt dei comandi ed eseguire questo comando per verificare che un'applicazione sia in ascolto nella porta dati:</span><span class="sxs-lookup"><span data-stu-id="e2a8b-162">Open a command prompt and run the following command to validate there is an application listening on the data port:</span></span>  
            <span data-ttu-id="e2a8b-163">netstat -an</span><span class="sxs-lookup"><span data-stu-id="e2a8b-163">netstat -an</span></span> 
3. <span data-ttu-id="e2a8b-164">Se lo stato della porta non è elencato come "LISTENING", configurare la porta di attesa corretta.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-164">If the port is not listed with State “LISTENING”, configure the proper listener port</span></span> 
4. <span data-ttu-id="e2a8b-165">Se la porta è contrassegnata come LISTENING, verificare se sono presenti problemi nell'applicazione di destinazione in ascolto su tale porta.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-165">If the port is marked as Listening, then check the target application on that port for any possible issues.</span></span> 

### <a name="cause-2-network-security-group-is-blocking-the-port-on-the-load-balancer-backend-pool-vm"></a><span data-ttu-id="e2a8b-166">Causa 2: un gruppo di sicurezza di rete blocca la porta nella macchina virtuale del pool back-end di Load Balancer</span><span class="sxs-lookup"><span data-stu-id="e2a8b-166">Cause 2: Network security group is blocking the port on the Load Balancer backend pool VM</span></span>  

<span data-ttu-id="e2a8b-167">Se uno o più gruppi di sicurezza di rete configurati nella subnet o nella macchina virtuale bloccano l'indirizzo IP o la porta di origine, la macchina virtuale non potrà rispondere.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-167">If one or more network security groups configured on the subnet or on the VM, is blocking the source IP or port, then the VM is unable to respond.</span></span>

* <span data-ttu-id="e2a8b-168">Elencare i gruppi di sicurezza di rete configurati nella macchina virtuale back-end.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-168">List the network security groups configured on the backend VM.</span></span> <span data-ttu-id="e2a8b-169">Per altre informazioni, vedere:</span><span class="sxs-lookup"><span data-stu-id="e2a8b-169">For more information, see:</span></span>
    -  [<span data-ttu-id="e2a8b-170">Gestire gruppi di sicurezza di rete usando il portale</span><span class="sxs-lookup"><span data-stu-id="e2a8b-170">Manage network security groups using the Portal</span></span>](../virtual-network/virtual-network-manage-nsg-arm-portal.md)
    -  [<span data-ttu-id="e2a8b-171">Gestire i gruppi di sicurezza di rete usando PowerShell</span><span class="sxs-lookup"><span data-stu-id="e2a8b-171">Manage network security groups using PowerShell</span></span>](../virtual-network/virtual-network-manage-nsg-arm-ps.md)
* <span data-ttu-id="e2a8b-172">Dall'elenco dei gruppi di sicurezza di rete verificare se:</span><span class="sxs-lookup"><span data-stu-id="e2a8b-172">From the list of network security groups, check if:</span></span>
    - <span data-ttu-id="e2a8b-173">il traffico in ingresso o in uscita nella porta dati ha interferenze.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-173">the incoming or outgoing traffic on the data port has interference.</span></span> 
    - <span data-ttu-id="e2a8b-174">nella scheda di interfaccia di rete della macchina virtuale o nella subnet è presente una regola di tipo **Nega tutto** di un gruppo di sicurezza di rete avente una priorità superiore rispetto alla regola predefinita che consente il traffico e i probe di Load Balancer. I gruppi di sicurezza di rete devono consentire l'IP 168.63.129.16 di Load Balancer, ovvero la porta probe</span><span class="sxs-lookup"><span data-stu-id="e2a8b-174">a **Deny All** network security group rule on the NIC of the VM or the subnet that has a higher priority that the default rule that allows Load Balancer probes and traffic (network security groups must allow Load Balancer IP of 168.63.129.16, that is probe port)</span></span> 
* <span data-ttu-id="e2a8b-175">Se alcune di queste regole bloccano il traffico, rimuoverle e riconfigurarle per consentire il traffico dati.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-175">If any of the rules are blocking the traffic, remove and reconfigure those rules to allow the data traffic.</span></span>  
* <span data-ttu-id="e2a8b-176">Verificare se la macchina virtuale ha ora iniziato a rispondere ai probe di integrità.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-176">Test if the VM has now started to respond to the health probes.</span></span>

### <a name="cause-3-accessing-the-load-balancer-from-the-same-vm-and-network-interface"></a><span data-ttu-id="e2a8b-177">Causa 3: accesso a Load Balancer dalla stessa macchina virtuale e interfaccia di rete</span><span class="sxs-lookup"><span data-stu-id="e2a8b-177">Cause 3: Accessing the Load Balancer from the same VM and Network interface</span></span> 

<span data-ttu-id="e2a8b-178">Se l'applicazione ospitata nella macchina virtuale back-end di un servizio di bilanciamento del carico sta provando ad accedere a un'altra applicazione ospitata nella stessa macchina virtuale back-end tramite la stessa interfaccia di rete, questo scenario non è supportato e avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-178">If your application hosted in the backend VM of a Load Balancer is trying to access another application hosted in the same backend VM over the same Network Interface, it is an unsupported scenario and will fail.</span></span> 

<span data-ttu-id="e2a8b-179">**Risoluzione**: è possibile risolvere questo problema con uno dei metodi seguenti:</span><span class="sxs-lookup"><span data-stu-id="e2a8b-179">**Resolution** You can resolve this issue via one of the following methods:</span></span>
* <span data-ttu-id="e2a8b-180">Configurare macchine virtuali del pool back-end separate per ogni applicazione.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-180">Configure separate backend pool VMs per application.</span></span> 
* <span data-ttu-id="e2a8b-181">Configurare l'applicazione in macchine virtuali con due schede di interfaccia di rete in modo che ogni applicazione usi un'interfaccia di rete e un indirizzo IP propri.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-181">Configure the application in dual NIC VMs so each application was using its own Network interface and IP address.</span></span> 

### <a name="cause-4-accessing-the-internal-load-balancer-vip-from-the-participating-load-balancer-backend-pool-vm"></a><span data-ttu-id="e2a8b-182">Causa 4: accesso all'indirizzo VIP del servizio di bilanciamento del carico interno dalla macchina virtuale del pool back-end di Load Balancer</span><span class="sxs-lookup"><span data-stu-id="e2a8b-182">Cause 4: Accessing the Internal Load Balancer VIP from the participating Load Balancer backend pool VM</span></span>

<span data-ttu-id="e2a8b-183">Se è configurato un indirizzo VIP del bilanciamento del carico interno in una rete virtuale e una delle VM del back-end sta tentando di accedere all'indirizzo VIP del servizio di bilanciamento del carico Internet, verrà generato un errore.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-183">If an ILB VIP is configured inside a VNet, and one of the participant backend VMs is trying to access the Internal Load Balancer VIP, that results in failure.</span></span> <span data-ttu-id="e2a8b-184">Questo scenario non è supportato.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-184">This is an unsupported scenario.</span></span>
<span data-ttu-id="e2a8b-185">**Risoluzione**: valutare un gateway applicazione o altri proxy, ad esempio nginx o haproxy, per supportare questo tipo di scenario.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-185">**Resolution** Evaluate Application Gateway or other proxies (for example, nginx or haproxy) to support that kind of scenario.</span></span> <span data-ttu-id="e2a8b-186">Per altre informazioni sul gateway applicazione, vedere [Panoramica del gateway applicazione](../application-gateway/application-gateway-introduction.md)</span><span class="sxs-lookup"><span data-stu-id="e2a8b-186">For more information about Application Gateway, see [Overview of Application Gateway](../application-gateway/application-gateway-introduction.md)</span></span>

## <a name="additional-network-captures"></a><span data-ttu-id="e2a8b-187">Altre acquisizioni di rete</span><span class="sxs-lookup"><span data-stu-id="e2a8b-187">Additional network captures</span></span>
<span data-ttu-id="e2a8b-188">Se si decide di aprire un caso di supporto, raccogliere le informazioni seguenti per una soluzione più rapida.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-188">If you decide to open a support case, collect the following information for a quicker resolution.</span></span> <span data-ttu-id="e2a8b-189">Scegliere una singola macchina virtuale back-end per eseguire questi test:</span><span class="sxs-lookup"><span data-stu-id="e2a8b-189">Choose a single backend VM to perform the following tests:</span></span>
- <span data-ttu-id="e2a8b-190">Usare Psping da una delle macchine virtuali back-end all'interno della rete virtuale per testare la risposta della porta probe, ad esempio psping 10.0.0.4:3389, e registrare i risultati.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-190">Use Psping from one of the backend VMs within the VNet to test the probe port response (example: psping 10.0.0.4:3389) and record results.</span></span> 
- <span data-ttu-id="e2a8b-191">Usare TCPing da una delle macchine virtuali back-end all'interno della rete virtuale per testare la risposta della porta probe, ad esempio psping 10.0.0.4:3389, e registrare i risultati.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-191">Use TCPing from one of the backend VMs within the VNet to test the probe port response (example: psping 10.0.0.4:3389) and record results.</span></span>
- <span data-ttu-id="e2a8b-192">Se non si ricevono risposte in questi test di ping, eseguire una traccia Netsh simultanea nella macchina virtuale back-end e nella macchina virtuale di test della rete virtuale mentre si esegue PsPing, quindi arrestare la traccia Netsh.</span><span class="sxs-lookup"><span data-stu-id="e2a8b-192">If no response is received in these ping tests, run a simultaneous Netsh trace on the backend VM and the VNet test VM while you run PsPing then stop the Netsh trace.</span></span> 
  
## <a name="next-steps"></a><span data-ttu-id="e2a8b-193">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="e2a8b-193">Next steps</span></span>

<span data-ttu-id="e2a8b-194">Se i passaggi precedenti non risolvono il problema, aprire un [ticket di supporto](https://azure.microsoft.com/support/options/).</span><span class="sxs-lookup"><span data-stu-id="e2a8b-194">If the preceding steps do not resolve the issue, open a [support ticket](https://azure.microsoft.com/support/options/).</span></span>

