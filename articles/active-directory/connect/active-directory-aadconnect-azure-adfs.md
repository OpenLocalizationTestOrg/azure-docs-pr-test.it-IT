---
title: Active Directory Federation Services in Azure | Documentazione Microsoft
description: "Questo documento illustra come distribuire AD FS in Azure per ottenere una disponibilità elevata."
keywords: distribuire AD FS in azure, distribuire azure adfs, azure adfs, azure ad fs, distribuire adfs, distribuire ad fs, adfs in azure, distribuire adfs in azure, distribuire AD FS in azure, adfs azure, introduzione ad AD FS, Azure, AD FS in Azure, iaas, ADFS, trasferire adfs in azure
services: active-directory
documentationcenter: 
author: anandyadavmsft
manager: femila
editor: 
ms.assetid: 692a188c-badc-44aa-ba86-71c0e8074510
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 07/17/2017
ms.author: anandy; billmath
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: ddd29a1230286de8999175498ee793f3b3ea24e2
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/03/2017
---
# <a name="deploying-active-directory-federation-services-in-azure"></a><span data-ttu-id="4d91a-104">Distribuzione di Active Directory Federation Services in Azure</span><span class="sxs-lookup"><span data-stu-id="4d91a-104">Deploying Active Directory Federation Services in Azure</span></span>
<span data-ttu-id="4d91a-105">AD FS offre funzionalità di federazione delle identità e Single Sign-On (SSO) Web protette e semplificate.</span><span class="sxs-lookup"><span data-stu-id="4d91a-105">AD FS provides simplified, secured identity federation and Web single sign-on (SSO) capabilities.</span></span> <span data-ttu-id="4d91a-106">La federazione con Azure AD o O365 consente agli utenti di eseguire l'autenticazione con credenziali locali e accedere a tutte le risorse nel cloud.</span><span class="sxs-lookup"><span data-stu-id="4d91a-106">Federation with Azure AD or O365 enables users to authenticate using on-premises credentials and access all resources in cloud.</span></span> <span data-ttu-id="4d91a-107">Di conseguenza, diventa importante la presenza di un'infrastruttura AD FS a disponibilità elevata per garantire l'accesso alle risorse sia in locale sia nel cloud.</span><span class="sxs-lookup"><span data-stu-id="4d91a-107">As a result, it becomes important to have a highly available AD FS infrastructure to ensure access to resources both on-premises and in the cloud.</span></span> <span data-ttu-id="4d91a-108">La distribuzione di AD FS in Azure consente di raggiungere facilmente la disponibilità elevata necessaria.</span><span class="sxs-lookup"><span data-stu-id="4d91a-108">Deploying AD FS in Azure can help achieve the high availability required with minimal efforts.</span></span>
<span data-ttu-id="4d91a-109">Distribuire AD FS in Azure offre diverse vantaggi. Di seguito ne sono elencati alcuni.</span><span class="sxs-lookup"><span data-stu-id="4d91a-109">There are several advantages of deploying AD FS in Azure, a few of them are listed below:</span></span>

* <span data-ttu-id="4d91a-110">**Disponibilità elevata** : gli avanzati set di disponibilità di Azure assicurano un'infrastruttura a disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="4d91a-110">**High Availability** - With the power of Azure Availability Sets, you ensure a highly available infrastructure.</span></span>
* <span data-ttu-id="4d91a-111">**Scalabilità semplificata**: se sono necessarie più prestazioni,</span><span class="sxs-lookup"><span data-stu-id="4d91a-111">**Easy to Scale** – Need more performance?</span></span> <span data-ttu-id="4d91a-112">è possibile eseguire facilmente la migrazione a computer più potenti con pochi clic in Azure.</span><span class="sxs-lookup"><span data-stu-id="4d91a-112">Easily migrate to more powerful machines by just a few clicks in Azure</span></span>
* <span data-ttu-id="4d91a-113">**Ridondanza tra diverse aree geografiche** : la ridondanza geografica di Azure assicura la disponibilità elevata dell'infrastruttura a livello globale.</span><span class="sxs-lookup"><span data-stu-id="4d91a-113">**Cross-Geo Redundancy** – With Azure Geo Redundancy you can be assured that your infrastructure is highly available across the globe</span></span>
* <span data-ttu-id="4d91a-114">**Facilità di gestione** : le opzioni di gestione estremamente semplificate del portale di Azure consentono di gestire l'infrastruttura con la massima facilità.</span><span class="sxs-lookup"><span data-stu-id="4d91a-114">**Easy to Manage** – With highly simplified management options in Azure portal, managing your infrastructure is very easy and hassle-free</span></span> 

## <a name="design-principles"></a><span data-ttu-id="4d91a-115">Principi di progettazione</span><span class="sxs-lookup"><span data-stu-id="4d91a-115">Design principles</span></span>
![Progettazione della distribuzione](./media/active-directory-aadconnect-azure-adfs/deployment.png)

<span data-ttu-id="4d91a-117">Il diagramma riportato sopra illustra la topologia di base consigliata come punto di partenza per la distribuzione di un'infrastruttura AD FS in Azure.</span><span class="sxs-lookup"><span data-stu-id="4d91a-117">The diagram above shows the recommended basic topology to start deploying your AD FS infrastructure in Azure.</span></span> <span data-ttu-id="4d91a-118">Di seguito sono elencati i principi alla base dei vari componenti della topologia.</span><span class="sxs-lookup"><span data-stu-id="4d91a-118">The principles behind the various components of the topology are listed below:</span></span>

* <span data-ttu-id="4d91a-119">**Controller di dominio/server AD FS**: se il numero di utenti è inferiore a 1.000, è sufficiente installare il ruolo AD FS nei controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="4d91a-119">**DC / ADFS Servers**: If you have fewer than 1,000 users you can simply install AD FS role on your domain controllers.</span></span> <span data-ttu-id="4d91a-120">Se si vuole evitare qualsiasi impatto sulle prestazioni dei controller di dominio o sono presenti più di 1.000 utenti, distribuire AD FS su server separati.</span><span class="sxs-lookup"><span data-stu-id="4d91a-120">If you do not want any performance impact on the domain controllers or if you have more than 1,000 users, then deploy AD FS on separate servers.</span></span>
* <span data-ttu-id="4d91a-121">**Server WAP** : è necessario per distribuire server proxy applicazione Web in modo che gli utenti possano raggiungere AD FS anche quando si trovano all'esterno della rete aziendale.</span><span class="sxs-lookup"><span data-stu-id="4d91a-121">**WAP Server** – it is necessary to deploy Web Application Proxy servers, so that users can reach the AD FS when they are not on the company network also.</span></span>
* <span data-ttu-id="4d91a-122">**Rete perimetrale**: i server proxy applicazione Web verranno inseriti nella rete perimetrale e tra la rete perimetrale e la subnet interna sarà consentito SOLO l'accesso TCP/443.</span><span class="sxs-lookup"><span data-stu-id="4d91a-122">**DMZ**: The Web Application Proxy servers will be placed in the DMZ and ONLY TCP/443 access is allowed between the DMZ and the internal subnet.</span></span>
* <span data-ttu-id="4d91a-123">**Servizi di bilanciamento del carico**: per garantire la disponibilità elevata dei server proxy applicazione Web e AD FS è consigliabile usare un servizio di bilanciamento del carico interno per i server AD FS e Azure Load Balancer per i server proxy applicazione Web.</span><span class="sxs-lookup"><span data-stu-id="4d91a-123">**Load Balancers**: To ensure high availability of AD FS and Web Application Proxy servers, we recommend using an internal load balancer for AD FS servers and Azure Load Balancer for Web Application Proxy servers.</span></span>
* <span data-ttu-id="4d91a-124">**Set di disponibilità**: per implementare la ridondanza nella distribuzione di AD FS, è consigliabile raggruppare due o più macchine virtuali in un set disponibilità per carichi di lavoro simili.</span><span class="sxs-lookup"><span data-stu-id="4d91a-124">**Availability Sets**: To provide redundancy to your AD FS deployment, it is recommended that you group two or more virtual machines in an Availability Set for similar workloads.</span></span> <span data-ttu-id="4d91a-125">Questa configurazione assicura che durante un evento di manutenzione pianificata o non pianificata sia disponibile almeno una macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="4d91a-125">This configuration ensures that during either a planned or unplanned maintenance event, at least one virtual machine will be available</span></span>
* <span data-ttu-id="4d91a-126">**Account di archiviazione**: è consigliabile avere due account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="4d91a-126">**Storage Accounts**: It is recommended to have two storage accounts.</span></span> <span data-ttu-id="4d91a-127">Un singolo account di archiviazione può determinare un singolo punto di guasto e causare l'indisponibilità della distribuzione nell'improbabile scenario in cui l'account di archiviazione diventi inattivo.</span><span class="sxs-lookup"><span data-stu-id="4d91a-127">Having a single storage account can lead to creation of a single point of failure and can cause the deployment to become unavailable in an unlikely scenario where the storage account goes down.</span></span> <span data-ttu-id="4d91a-128">Con due account di archiviazione è possibile associare un account di archiviazione per ogni linea di guasto.</span><span class="sxs-lookup"><span data-stu-id="4d91a-128">Two storage accounts will help associate one storage account for each fault line.</span></span>
* <span data-ttu-id="4d91a-129">**Separazione delle reti**: i server proxy applicazione Web verranno distribuiti in una rete perimetrale separata.</span><span class="sxs-lookup"><span data-stu-id="4d91a-129">**Network segregation**:  Web Application Proxy servers should be deployed in a separate DMZ network.</span></span> <span data-ttu-id="4d91a-130">È possibile dividere una rete virtuale in due subnet e quindi distribuire i server proxy applicazione Web in una subnet isolata.</span><span class="sxs-lookup"><span data-stu-id="4d91a-130">You can divide one virtual network into two subnets and then deploy the Web Application Proxy server(s) in an isolated subnet.</span></span> <span data-ttu-id="4d91a-131">È sufficiente configurare le impostazioni dei gruppi di sicurezza di rete per ogni subnet e consentire solo la comunicazione necessaria tra le due subnet.</span><span class="sxs-lookup"><span data-stu-id="4d91a-131">You can simply configure the network security group settings for each subnet and allow only required communication between the two subnets.</span></span> <span data-ttu-id="4d91a-132">Altri dettagli sono riportati di seguito per i singoli scenari di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="4d91a-132">More details are given per deployment scenario below</span></span>

## <a name="steps-to-deploy-ad-fs-in-azure"></a><span data-ttu-id="4d91a-133">Passaggi per la distribuzione di AD FS in Azure</span><span class="sxs-lookup"><span data-stu-id="4d91a-133">Steps to deploy AD FS in Azure</span></span>
<span data-ttu-id="4d91a-134">I passaggi indicati in questa sezione offrono una guida per distribuire l'infrastruttura AD FS illustrata di seguito in Azure.</span><span class="sxs-lookup"><span data-stu-id="4d91a-134">The steps mentioned in this section outline the guide to deploy the below depicted AD FS infrastructure in Azure.</span></span>

### <a name="1-deploying-the-network"></a><span data-ttu-id="4d91a-135">1. Distribuire la rete</span><span class="sxs-lookup"><span data-stu-id="4d91a-135">1. Deploying the network</span></span>
<span data-ttu-id="4d91a-136">Come indicato in precedenza, è possibile creare due subnet in una singola rete virtuale oppure creare due reti virtuali completamente diverse.</span><span class="sxs-lookup"><span data-stu-id="4d91a-136">As outlined above, you can either create two subnets in a single virtual network or else create two completely different virtual networks (VNet).</span></span> <span data-ttu-id="4d91a-137">Questo articolo è incentrato sulla distribuzione di una singola rete virtuale e sulla relativa divisione in due subnet.</span><span class="sxs-lookup"><span data-stu-id="4d91a-137">This article will focus on deploying a single virtual network and divide it into two subnets.</span></span> <span data-ttu-id="4d91a-138">È attualmente un approccio più semplice perché due reti virtuali separate richiederebbero un gateway da rete virtuale a rete virtuale per le comunicazioni.</span><span class="sxs-lookup"><span data-stu-id="4d91a-138">This is currently an easier approach as two separate VNets would require a VNet to VNet gateway for communications.</span></span>

<span data-ttu-id="4d91a-139">**1.1 Creare una rete virtuale**</span><span class="sxs-lookup"><span data-stu-id="4d91a-139">**1.1 Create virtual network**</span></span>

![Creare una rete virtuale](./media/active-directory-aadconnect-azure-adfs/deploynetwork1.png)

<span data-ttu-id="4d91a-141">Nel portale di Azure selezionare la rete virtuale. È possibile distribuire immediatamente la rete virtuale e una subnet con un solo clic.</span><span class="sxs-lookup"><span data-stu-id="4d91a-141">In the Azure portal, select virtual network and you can deploy the virtual network and one subnet immediately with just one click.</span></span> <span data-ttu-id="4d91a-142">Viene definita anche la subnet INT, che è pronta per l'aggiunta di VM.</span><span class="sxs-lookup"><span data-stu-id="4d91a-142">INT subnet is also defined and is ready now for VMs to be added.</span></span>
<span data-ttu-id="4d91a-143">Il passaggio successivo consiste nell’aggiungere un’altra subnet (denominata “rete perimetrale”) alla rete.</span><span class="sxs-lookup"><span data-stu-id="4d91a-143">The next step is to add another subnet to the network, i.e. the DMZ subnet.</span></span> <span data-ttu-id="4d91a-144">Per creare la subnet DMZ, è sufficiente:</span><span class="sxs-lookup"><span data-stu-id="4d91a-144">To create the DMZ subnet, simply</span></span>

* <span data-ttu-id="4d91a-145">Selezionare la rete appena creata</span><span class="sxs-lookup"><span data-stu-id="4d91a-145">Select the newly created network</span></span>
* <span data-ttu-id="4d91a-146">Nelle proprietà selezionare Subnet</span><span class="sxs-lookup"><span data-stu-id="4d91a-146">In the properties select subnet</span></span>
* <span data-ttu-id="4d91a-147">Nel pannello Subnet fare clic sul pulsante di aggiunta</span><span class="sxs-lookup"><span data-stu-id="4d91a-147">In the subnet panel click on the add button</span></span>
* <span data-ttu-id="4d91a-148">Specificare il nome della subnet e le informazioni relative allo spazio indirizzi per creare la subnet</span><span class="sxs-lookup"><span data-stu-id="4d91a-148">Provide the subnet name and address space information to create the subnet</span></span>

![Subnet](./media/active-directory-aadconnect-azure-adfs/deploynetwork2.png)

![Subnet DMZ](./media/active-directory-aadconnect-azure-adfs/deploynetwork3.png)

<span data-ttu-id="4d91a-151">**1.2. Creare i gruppi di sicurezza di rete**</span><span class="sxs-lookup"><span data-stu-id="4d91a-151">**1.2. Creating the network security groups**</span></span>

<span data-ttu-id="4d91a-152">Un gruppo di sicurezza di rete (NSG) contiene un elenco di regole dell'elenco di controllo di accesso (ACL) che consentono o rifiutano il traffico di rete alle istanze di VM in una rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="4d91a-152">A Network security group (NSG) contains a list of Access Control List (ACL) rules that allow or deny network traffic to your VM instances in a Virtual Network.</span></span> <span data-ttu-id="4d91a-153">I gruppi di sicurezza di rete possono essere associati a subnet o singole istanze VM in una subnet.</span><span class="sxs-lookup"><span data-stu-id="4d91a-153">NSGs can be associated with either subnets or individual VM instances within that subnet.</span></span> <span data-ttu-id="4d91a-154">Quando un gruppo di sicurezza di rete viene associato a una subnet, le regole ACL si applicano a tutte le istanze di VM in tale subnet.</span><span class="sxs-lookup"><span data-stu-id="4d91a-154">When an NSG is associated with a subnet, the ACL rules apply to all the VM instances in that subnet.</span></span>
<span data-ttu-id="4d91a-155">Ai fini di questa guida, verranno creati due gruppi di sicurezza di rete, uno per una rete interna e uno per una rete perimetrale,</span><span class="sxs-lookup"><span data-stu-id="4d91a-155">For the purpose of this guidance, we will create two NSGs: one each for an internal network and a DMZ.</span></span> <span data-ttu-id="4d91a-156">denominati rispettivamente NSG_INT e NSG_DMZ.</span><span class="sxs-lookup"><span data-stu-id="4d91a-156">They will be labeled NSG_INT and NSG_DMZ respectively.</span></span>

![Creare un gruppo di sicurezza di rete](./media/active-directory-aadconnect-azure-adfs/creatensg1.png)

<span data-ttu-id="4d91a-158">Al termine della creazione del gruppo di sicurezza di rete, esisteranno 0 regole in ingresso e 0 in uscita.</span><span class="sxs-lookup"><span data-stu-id="4d91a-158">After the NSG is created, there will be 0 inbound and 0 outbound rules.</span></span> <span data-ttu-id="4d91a-159">Dopo che i ruoli nei rispettivi server sono installati e funzionanti, è possibile definire le regole in ingresso e in uscita in base al livello di sicurezza desiderato.</span><span class="sxs-lookup"><span data-stu-id="4d91a-159">Once the roles on the respective servers are installed and functional, then the inbound and outbound rules can be made according to the desired level of security.</span></span>

![Inizializzare il gruppo di sicurezza di rete](./media/active-directory-aadconnect-azure-adfs/nsgint1.png)

<span data-ttu-id="4d91a-161">azione dei gruppi di sicurezza di rete, associare NSG\_INT alla subnet INT e NSG\_DMZ alla subnet della rete perimetrale.</span><span class="sxs-lookup"><span data-stu-id="4d91a-161">After the NSGs are created, associate NSG_INT with subnet INT and NSG_DMZ with subnet DMZ.</span></span> <span data-ttu-id="4d91a-162">Di seguito è riportato uno screenshot di esempio:</span><span class="sxs-lookup"><span data-stu-id="4d91a-162">An example screenshot is given below:</span></span>

![Configurazione dei gruppi di sicurezza di rete](./media/active-directory-aadconnect-azure-adfs/nsgconfigure1.png)

* <span data-ttu-id="4d91a-164">Fare clic su Subnet per aprire il pannello delle subnet</span><span class="sxs-lookup"><span data-stu-id="4d91a-164">Click on Subnets to open the panel for subnets</span></span>
* <span data-ttu-id="4d91a-165">Selezionare la subnet da associare al gruppo di sicurezza di rete</span><span class="sxs-lookup"><span data-stu-id="4d91a-165">Select the subnet to associate with the NSG</span></span> 

<span data-ttu-id="4d91a-166">Al termine della configurazione, il pannello Subnet avrà l'aspetto seguente:</span><span class="sxs-lookup"><span data-stu-id="4d91a-166">After configuration, the panel for Subnets should look like below:</span></span>

![Subnet dopo la configurazione dei gruppi di sicurezza di rete](./media/active-directory-aadconnect-azure-adfs/nsgconfigure2.png)

<span data-ttu-id="4d91a-168">**1.3. Creare una connessione all'ambiente locale**</span><span class="sxs-lookup"><span data-stu-id="4d91a-168">**1.3. Create Connection to on-premises**</span></span>

<span data-ttu-id="4d91a-169">Per distribuire il controller di dominio in Azure sarà necessaria una connessione all'ambiente locale.</span><span class="sxs-lookup"><span data-stu-id="4d91a-169">We will need a connection to on-premises in order to deploy the domain controller (DC) in azure.</span></span> <span data-ttu-id="4d91a-170">Azure offre varie opzioni di connettività per connettere l'infrastruttura locale all'infrastruttura di Azure.</span><span class="sxs-lookup"><span data-stu-id="4d91a-170">Azure offers various connectivity options to connect your on-premises infrastructure to your Azure infrastructure.</span></span>

* <span data-ttu-id="4d91a-171">Da punto a sito</span><span class="sxs-lookup"><span data-stu-id="4d91a-171">Point-to-site</span></span>
* <span data-ttu-id="4d91a-172">Da sito a sito di rete virtuale</span><span class="sxs-lookup"><span data-stu-id="4d91a-172">Virtual Network Site-to-site</span></span>
* <span data-ttu-id="4d91a-173">ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="4d91a-173">ExpressRoute</span></span>

<span data-ttu-id="4d91a-174">È consigliabile usare ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="4d91a-174">It is recommended to use ExpressRoute.</span></span> <span data-ttu-id="4d91a-175">ExpressRoute consente di creare connessioni private tra i data center di Azure e l'infrastruttura disponibile localmente o in un ambiente con percorso condiviso.</span><span class="sxs-lookup"><span data-stu-id="4d91a-175">ExpressRoute lets you create private connections between Azure datacenters and infrastructure that’s on your premises or in a co-location environment.</span></span> <span data-ttu-id="4d91a-176">Le connessioni ExpressRoute non sfruttano la rete Internet pubblica.</span><span class="sxs-lookup"><span data-stu-id="4d91a-176">ExpressRoute connections do not go over the public Internet.</span></span> <span data-ttu-id="4d91a-177">Queste connessioni offrono maggiore affidabilità, velocità più elevate, latenze minori e sicurezza superiore rispetto alle tipiche connessioni tramite Internet.</span><span class="sxs-lookup"><span data-stu-id="4d91a-177">They offer more reliability, faster speeds, lower latencies and higher security than typical connections over the Internet.</span></span>
<span data-ttu-id="4d91a-178">Nonostante sia consigliabile usare ExpressRoute, si può scegliere qualsiasi metodo di connessione sia più adatto per l'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="4d91a-178">While it is recommended to use ExpressRoute, you may choose any connection method best suited for your organization.</span></span> <span data-ttu-id="4d91a-179">Per altre informazioni su ExpressRoute e sulle varie opzioni di connettività con ExpressRoute, vedere [Panoramica tecnica relativa a ExpressRoute](https://aka.ms/Azure/ExpressRoute).</span><span class="sxs-lookup"><span data-stu-id="4d91a-179">To learn more about ExpressRoute and the various connectivity options using ExpressRoute, read [ExpressRoute technical overview](https://aka.ms/Azure/ExpressRoute).</span></span>

### <a name="2-create-storage-accounts"></a><span data-ttu-id="4d91a-180">2. Creare gli account di archiviazione</span><span class="sxs-lookup"><span data-stu-id="4d91a-180">2. Create storage accounts</span></span>
<span data-ttu-id="4d91a-181">Per mantenere una disponibilità elevata e non dipendere da un singolo account di archiviazione, è possibile creare due account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="4d91a-181">In order to maintain high availability and avoid dependence on a single storage account, you can create two storage accounts.</span></span> <span data-ttu-id="4d91a-182">Dividere i computer di ogni set di disponibilità in due gruppi e assegnare quindi a ogni gruppo un account di archiviazione separato.</span><span class="sxs-lookup"><span data-stu-id="4d91a-182">Divide the machines in each availability set into two groups and then assign each group a separate storage account.</span></span>

![Creare gli account di archiviazione](./media/active-directory-aadconnect-azure-adfs/storageaccount1.png)

### <a name="3-create-availability-sets"></a><span data-ttu-id="4d91a-184">3. Creare set di disponibilità</span><span class="sxs-lookup"><span data-stu-id="4d91a-184">3. Create availability sets</span></span>
<span data-ttu-id="4d91a-185">Per ogni ruolo (controller di dominio/AD FS e WAP), creare set di disponibilità contenenti almeno 2 computer ognuno.</span><span class="sxs-lookup"><span data-stu-id="4d91a-185">For each role (DC/AD FS and WAP), create availability sets that will contain 2 machines each at the minimum.</span></span> <span data-ttu-id="4d91a-186">Sarà così possibile ottenere una disponibilità più elevata per ogni ruolo.</span><span class="sxs-lookup"><span data-stu-id="4d91a-186">This will help achieve higher availability for each role.</span></span> <span data-ttu-id="4d91a-187">Durante la creazione dei set di disponibilità, è essenziale stabilire quanto segue.</span><span class="sxs-lookup"><span data-stu-id="4d91a-187">While creating the availability sets, it is essential to decide on the following:</span></span>

* <span data-ttu-id="4d91a-188">**Domini di errore**: le macchine virtuali nello stesso dominio di errore condividono la stessa alimentazione e lo stesso commutatore di rete fisico.</span><span class="sxs-lookup"><span data-stu-id="4d91a-188">**Fault Domains**: Virtual machines in the same fault domain share the same power source and physical network switch.</span></span> <span data-ttu-id="4d91a-189">È consigliabile usare almeno 2 domini di errore.</span><span class="sxs-lookup"><span data-stu-id="4d91a-189">A minimum of 2 fault domains are recommended.</span></span> <span data-ttu-id="4d91a-190">Ai fini di questa distribuzione può essere mantenuto il valore predefinito di 3.</span><span class="sxs-lookup"><span data-stu-id="4d91a-190">The default value is 3 and you can leave it as is for the purpose of this deployment</span></span>
* <span data-ttu-id="4d91a-191">**Domini di aggiornamento**: i computer appartenenti allo stesso dominio di aggiornamento vengono riavviati insieme nel corso di un aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="4d91a-191">**Update domains**: Machines belonging to the same update domain are restarted together during an update.</span></span> <span data-ttu-id="4d91a-192">È opportuno avere almeno 2 domini di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="4d91a-192">You want to have minimum of 2 update domains.</span></span> <span data-ttu-id="4d91a-193">Ai fini di questa distribuzione può essere mantenuto il valore predefinito di 5.</span><span class="sxs-lookup"><span data-stu-id="4d91a-193">The default value is 5 and you can leave it as is for the purpose of this deployment</span></span>

![Set di disponibilità](./media/active-directory-aadconnect-azure-adfs/availabilityset1.png)

<span data-ttu-id="4d91a-195">Creare i set di disponibilità seguenti</span><span class="sxs-lookup"><span data-stu-id="4d91a-195">Create the following availability sets</span></span>

| <span data-ttu-id="4d91a-196">Set di disponibilità</span><span class="sxs-lookup"><span data-stu-id="4d91a-196">Availability Set</span></span> | <span data-ttu-id="4d91a-197">Ruolo</span><span class="sxs-lookup"><span data-stu-id="4d91a-197">Role</span></span> | <span data-ttu-id="4d91a-198">Domini di errore</span><span class="sxs-lookup"><span data-stu-id="4d91a-198">Fault domains</span></span> | <span data-ttu-id="4d91a-199">Domini di aggiornamento</span><span class="sxs-lookup"><span data-stu-id="4d91a-199">Update domains</span></span> |
|:---:|:---:|:---:|:--- |
| <span data-ttu-id="4d91a-200">contosodcset</span><span class="sxs-lookup"><span data-stu-id="4d91a-200">contosodcset</span></span> |<span data-ttu-id="4d91a-201">Controller di dominio/AD FS</span><span class="sxs-lookup"><span data-stu-id="4d91a-201">DC/ADFS</span></span> |<span data-ttu-id="4d91a-202">3</span><span class="sxs-lookup"><span data-stu-id="4d91a-202">3</span></span> |<span data-ttu-id="4d91a-203">5</span><span class="sxs-lookup"><span data-stu-id="4d91a-203">5</span></span> |
| <span data-ttu-id="4d91a-204">contosowapset</span><span class="sxs-lookup"><span data-stu-id="4d91a-204">contosowapset</span></span> |<span data-ttu-id="4d91a-205">WAP</span><span class="sxs-lookup"><span data-stu-id="4d91a-205">WAP</span></span> |<span data-ttu-id="4d91a-206">3</span><span class="sxs-lookup"><span data-stu-id="4d91a-206">3</span></span> |<span data-ttu-id="4d91a-207">5</span><span class="sxs-lookup"><span data-stu-id="4d91a-207">5</span></span> |

### <a name="4-deploy-virtual-machines"></a><span data-ttu-id="4d91a-208">4. Distribuire le macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="4d91a-208">4. Deploy virtual machines</span></span>
<span data-ttu-id="4d91a-209">Il passaggio successivo consiste nel distribuire le macchine virtuali che ospiteranno i diversi ruoli nell'infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="4d91a-209">The next step is to deploy virtual machines that will host the different roles in your infrastructure.</span></span> <span data-ttu-id="4d91a-210">In ogni set di disponibilità è consigliato un minimo di due computer.</span><span class="sxs-lookup"><span data-stu-id="4d91a-210">A minimum of two machines are recommended in each availability set.</span></span> <span data-ttu-id="4d91a-211">Creare quattro macchine virtuali per la distribuzione di base.</span><span class="sxs-lookup"><span data-stu-id="4d91a-211">Create four virtual machines for the basic deployment.</span></span>

| <span data-ttu-id="4d91a-212">Machine</span><span class="sxs-lookup"><span data-stu-id="4d91a-212">Machine</span></span> | <span data-ttu-id="4d91a-213">Ruolo</span><span class="sxs-lookup"><span data-stu-id="4d91a-213">Role</span></span> | <span data-ttu-id="4d91a-214">Subnet</span><span class="sxs-lookup"><span data-stu-id="4d91a-214">Subnet</span></span> | <span data-ttu-id="4d91a-215">Set di disponibilità</span><span class="sxs-lookup"><span data-stu-id="4d91a-215">Availability set</span></span> | <span data-ttu-id="4d91a-216">Account di archiviazione</span><span class="sxs-lookup"><span data-stu-id="4d91a-216">Storage account</span></span> | <span data-ttu-id="4d91a-217">Indirizzo IP</span><span class="sxs-lookup"><span data-stu-id="4d91a-217">IP Address</span></span> |
|:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="4d91a-218">contosodc1</span><span class="sxs-lookup"><span data-stu-id="4d91a-218">contosodc1</span></span> |<span data-ttu-id="4d91a-219">Controller di dominio/AD FS</span><span class="sxs-lookup"><span data-stu-id="4d91a-219">DC/ADFS</span></span> |<span data-ttu-id="4d91a-220">INT</span><span class="sxs-lookup"><span data-stu-id="4d91a-220">INT</span></span> |<span data-ttu-id="4d91a-221">contosodcset</span><span class="sxs-lookup"><span data-stu-id="4d91a-221">contosodcset</span></span> |<span data-ttu-id="4d91a-222">contososac1</span><span class="sxs-lookup"><span data-stu-id="4d91a-222">contososac1</span></span> |<span data-ttu-id="4d91a-223">Static</span><span class="sxs-lookup"><span data-stu-id="4d91a-223">Static</span></span> |
| <span data-ttu-id="4d91a-224">contosodc2</span><span class="sxs-lookup"><span data-stu-id="4d91a-224">contosodc2</span></span> |<span data-ttu-id="4d91a-225">Controller di dominio/AD FS</span><span class="sxs-lookup"><span data-stu-id="4d91a-225">DC/ADFS</span></span> |<span data-ttu-id="4d91a-226">INT</span><span class="sxs-lookup"><span data-stu-id="4d91a-226">INT</span></span> |<span data-ttu-id="4d91a-227">contosodcset</span><span class="sxs-lookup"><span data-stu-id="4d91a-227">contosodcset</span></span> |<span data-ttu-id="4d91a-228">contososac2</span><span class="sxs-lookup"><span data-stu-id="4d91a-228">contososac2</span></span> |<span data-ttu-id="4d91a-229">Static</span><span class="sxs-lookup"><span data-stu-id="4d91a-229">Static</span></span> |
| <span data-ttu-id="4d91a-230">contosowap1</span><span class="sxs-lookup"><span data-stu-id="4d91a-230">contosowap1</span></span> |<span data-ttu-id="4d91a-231">WAP</span><span class="sxs-lookup"><span data-stu-id="4d91a-231">WAP</span></span> |<span data-ttu-id="4d91a-232">Rete perimetrale</span><span class="sxs-lookup"><span data-stu-id="4d91a-232">DMZ</span></span> |<span data-ttu-id="4d91a-233">contosowapset</span><span class="sxs-lookup"><span data-stu-id="4d91a-233">contosowapset</span></span> |<span data-ttu-id="4d91a-234">contososac1</span><span class="sxs-lookup"><span data-stu-id="4d91a-234">contososac1</span></span> |<span data-ttu-id="4d91a-235">Static</span><span class="sxs-lookup"><span data-stu-id="4d91a-235">Static</span></span> |
| <span data-ttu-id="4d91a-236">contosowap2</span><span class="sxs-lookup"><span data-stu-id="4d91a-236">contosowap2</span></span> |<span data-ttu-id="4d91a-237">WAP</span><span class="sxs-lookup"><span data-stu-id="4d91a-237">WAP</span></span> |<span data-ttu-id="4d91a-238">Rete perimetrale</span><span class="sxs-lookup"><span data-stu-id="4d91a-238">DMZ</span></span> |<span data-ttu-id="4d91a-239">contosowapset</span><span class="sxs-lookup"><span data-stu-id="4d91a-239">contosowapset</span></span> |<span data-ttu-id="4d91a-240">contososac2</span><span class="sxs-lookup"><span data-stu-id="4d91a-240">contososac2</span></span> |<span data-ttu-id="4d91a-241">Static</span><span class="sxs-lookup"><span data-stu-id="4d91a-241">Static</span></span> |

<span data-ttu-id="4d91a-242">Come è possibile osservare, non sono stati specificati gruppi di sicurezza di rete.</span><span class="sxs-lookup"><span data-stu-id="4d91a-242">As you might have noticed, no NSG has been specified.</span></span> <span data-ttu-id="4d91a-243">Ciò è dovuto al fatto che Azure consente di usare un gruppo di sicurezza di rete a livello di subnet.</span><span class="sxs-lookup"><span data-stu-id="4d91a-243">This is because azure lets you use NSG at the subnet level.</span></span> <span data-ttu-id="4d91a-244">È quindi possibile controllare il traffico di rete dei computer con il singolo gruppo di sicurezza di rete associato alla subnet o alla scheda di interfaccia di rete.</span><span class="sxs-lookup"><span data-stu-id="4d91a-244">Then, you can control machine network traffic by using the individual NSG associated with either the subnet or else the NIC object.</span></span> <span data-ttu-id="4d91a-245">Per altre informazioni, vedere [Che cos'è un gruppo di sicurezza di rete](https://aka.ms/Azure/NSG).</span><span class="sxs-lookup"><span data-stu-id="4d91a-245">Read more on [What is a Network Security Group (NSG)](https://aka.ms/Azure/NSG).</span></span>
<span data-ttu-id="4d91a-246">Se si gestisce il DNS, è consigliabile usare un indirizzo IP statico.</span><span class="sxs-lookup"><span data-stu-id="4d91a-246">Static IP address is recommended if you are managing the DNS.</span></span> <span data-ttu-id="4d91a-247">È possibile usare il DNS di Azure e nei record DNS per il dominio fare invece riferimento ai nuovi computer con i relativi FQDN di Azure.</span><span class="sxs-lookup"><span data-stu-id="4d91a-247">You can use Azure DNS and instead in the DNS records for your domain, refer to the new machines by their Azure FQDNs.</span></span>
<span data-ttu-id="4d91a-248">Al termine della distribuzione, il riquadro relativo alle macchine virtuali avrà l'aspetto seguente:</span><span class="sxs-lookup"><span data-stu-id="4d91a-248">Your virtual machine pane should look like below after the deployment is completed:</span></span>

![Macchine virtuali distribuite](./media/active-directory-aadconnect-azure-adfs/virtualmachinesdeployed_noadfs.png)

### <a name="5-configuring-the-domain-controller--ad-fs-servers"></a><span data-ttu-id="4d91a-250">5. Configurare controller di dominio e server AD FS</span><span class="sxs-lookup"><span data-stu-id="4d91a-250">5. Configuring the domain controller / AD FS servers</span></span>
 <span data-ttu-id="4d91a-251">Per autenticare qualsiasi richiesta in ingresso, AD FS dovrà contattare il controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="4d91a-251">In order to authenticate any incoming request, AD FS will need to contact the domain controller.</span></span> <span data-ttu-id="4d91a-252">Per evitare il costoso trasferimento da Azure al controller di dominio locale per l'autenticazione, è consigliabile distribuire una replica del controller di dominio in Azure.</span><span class="sxs-lookup"><span data-stu-id="4d91a-252">To save the costly trip from Azure to on-premises DC for authentication, it is recommended to deploy a replica of the domain controller in Azure.</span></span> <span data-ttu-id="4d91a-253">Per ottenere una disponibilità elevata, è consigliabile creare un set di disponibilità con almeno 2 controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="4d91a-253">In order to attain high availability, it is recommended to create an availability set of at-least 2 domain controllers.</span></span>

| <span data-ttu-id="4d91a-254">Controller di dominio</span><span class="sxs-lookup"><span data-stu-id="4d91a-254">Domain controller</span></span> | <span data-ttu-id="4d91a-255">Ruolo</span><span class="sxs-lookup"><span data-stu-id="4d91a-255">Role</span></span> | <span data-ttu-id="4d91a-256">Account di archiviazione</span><span class="sxs-lookup"><span data-stu-id="4d91a-256">Storage account</span></span> |
|:---:|:---:|:---:|
| <span data-ttu-id="4d91a-257">contosodc1</span><span class="sxs-lookup"><span data-stu-id="4d91a-257">contosodc1</span></span> |<span data-ttu-id="4d91a-258">Replica</span><span class="sxs-lookup"><span data-stu-id="4d91a-258">Replica</span></span> |<span data-ttu-id="4d91a-259">contososac1</span><span class="sxs-lookup"><span data-stu-id="4d91a-259">contososac1</span></span> |
| <span data-ttu-id="4d91a-260">contosodc2</span><span class="sxs-lookup"><span data-stu-id="4d91a-260">contosodc2</span></span> |<span data-ttu-id="4d91a-261">Replica</span><span class="sxs-lookup"><span data-stu-id="4d91a-261">Replica</span></span> |<span data-ttu-id="4d91a-262">contososac2</span><span class="sxs-lookup"><span data-stu-id="4d91a-262">contososac2</span></span> |

* <span data-ttu-id="4d91a-263">Innalzare i due server al livello di controller di dominio di replica con DNS</span><span class="sxs-lookup"><span data-stu-id="4d91a-263">Promote the two servers as replica domain controllers with DNS</span></span>
* <span data-ttu-id="4d91a-264">Configurare i server AD FS installando il ruolo AD FS con Server Manager</span><span class="sxs-lookup"><span data-stu-id="4d91a-264">Configure the AD FS servers by installing the AD FS role using the server manager.</span></span>

### <a name="6-deploying-internal-load-balancer-ilb"></a><span data-ttu-id="4d91a-265">6. Distribuire il servizio di bilanciamento del carico interno</span><span class="sxs-lookup"><span data-stu-id="4d91a-265">6. Deploying Internal Load Balancer (ILB)</span></span>
<span data-ttu-id="4d91a-266">**6.1. Creare il servizio di bilanciamento del carico interno**</span><span class="sxs-lookup"><span data-stu-id="4d91a-266">**6.1. Create the ILB**</span></span>

<span data-ttu-id="4d91a-267">Per distribuire un servizio di bilanciamento del carico interno, selezionare Servizi di bilanciamento del carico nel portale di Azure e fare clic su Aggiungi (+).</span><span class="sxs-lookup"><span data-stu-id="4d91a-267">To deploy an ILB, select Load Balancers in the Azure portal and click on add (+).</span></span>

> [!NOTE]
> <span data-ttu-id="4d91a-268">Se nel menu non viene visualizzato **Servizi di bilanciamento del carico** fare clic su **Esplora** in basso a sinistra nel portale e scorrere fino a visualizzare **l'opzione**.</span><span class="sxs-lookup"><span data-stu-id="4d91a-268">if you do not see **Load Balancers** in your menu, click **Browse** in the lower left of the portal and scroll until you see **Load Balancers**.</span></span>  <span data-ttu-id="4d91a-269">Fare quindi clic sulla stella gialla per aggiungere la voce al menu.</span><span class="sxs-lookup"><span data-stu-id="4d91a-269">Then click the yellow star to add it to your menu.</span></span> <span data-ttu-id="4d91a-270">Selezionare l'icona di nuovo servizio di bilanciamento del carico per aprire il pannello e iniziare la relativa configurazione.</span><span class="sxs-lookup"><span data-stu-id="4d91a-270">Now select the new load balancer icon to open the panel to begin configuration of the load balancer.</span></span>
> 
> 

![Visualizzazione di Servizi di bilanciamento del carico](./media/active-directory-aadconnect-azure-adfs/browseloadbalancer.png)

* <span data-ttu-id="4d91a-272">**Nome**: assegnare qualsiasi nome idoneo al servizio di bilanciamento del carico</span><span class="sxs-lookup"><span data-stu-id="4d91a-272">**Name**: Give any suitable name to the load balancer</span></span>
* <span data-ttu-id="4d91a-273">**Schema**: poiché il servizio di bilanciamento del carico verrà inserito a monte dei server AD FS e verrà usato SOLO per le connessioni della rete interna, selezionare "Interno"</span><span class="sxs-lookup"><span data-stu-id="4d91a-273">**Scheme**: Since this load balancer will be placed in front of the AD FS servers and is meant for internal network connections ONLY, select “Internal”</span></span>
* <span data-ttu-id="4d91a-274">**Rete virtuale**: scegliere la rete virtuale in cui viene distribuito AD FS</span><span class="sxs-lookup"><span data-stu-id="4d91a-274">**Virtual Network**: Choose the virtual network where you are deploying your AD FS</span></span>
* <span data-ttu-id="4d91a-275">**Subnet**: scegliere la subnet interna</span><span class="sxs-lookup"><span data-stu-id="4d91a-275">**Subnet**: Choose the internal subnet here</span></span>
* <span data-ttu-id="4d91a-276">**Assegnazione di indirizzi IP**: statici</span><span class="sxs-lookup"><span data-stu-id="4d91a-276">**IP Address assignment**: Static</span></span>

![Servizio di bilanciamento del carico interno](./media/active-directory-aadconnect-azure-adfs/ilbdeployment1.png)

<span data-ttu-id="4d91a-278">Dopo che si è fatto clic su Crea, il servizio di bilanciamento del carico interno viene distribuito e dovrebbe essere visualizzato nell'elenco dei servizi di bilanciamento del carico:</span><span class="sxs-lookup"><span data-stu-id="4d91a-278">After you click create and the ILB is deployed, you should see it in the list of load balancers:</span></span>

![Servizi di bilanciamento del carico dopo la distribuzione del servizio di bilanciamento del carico interno](./media/active-directory-aadconnect-azure-adfs/ilbdeployment2.png)

<span data-ttu-id="4d91a-280">Il passaggio successivo consiste nel configurare il pool back-end e il probe del back-end.</span><span class="sxs-lookup"><span data-stu-id="4d91a-280">Next step is to configure the backend pool and the backend probe.</span></span>

<span data-ttu-id="4d91a-281">**6.2. Configurare il pool back-end del servizio di bilanciamento del carico interno**</span><span class="sxs-lookup"><span data-stu-id="4d91a-281">**6.2. Configure ILB backend pool**</span></span>

<span data-ttu-id="4d91a-282">Selezionare il servizio di bilanciamento del carico interno appena creato nel pannello Servizi di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="4d91a-282">Select the newly created ILB in the Load Balancers panel.</span></span> <span data-ttu-id="4d91a-283">Verrà aperto il pannello delle impostazioni.</span><span class="sxs-lookup"><span data-stu-id="4d91a-283">It will open the settings panel.</span></span> 

1. <span data-ttu-id="4d91a-284">Selezionare i pool back-end nel pannello delle impostazioni</span><span class="sxs-lookup"><span data-stu-id="4d91a-284">Select backend pools from the settings panel</span></span>
2. <span data-ttu-id="4d91a-285">Nel pannello Aggiungi pool back-end fare clic su Aggiungi una macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="4d91a-285">In the add backend pool panel, click on add virtual machine</span></span>
3. <span data-ttu-id="4d91a-286">Verrà visualizzato un pannello in cui è possibile scegliere un set di disponibilità</span><span class="sxs-lookup"><span data-stu-id="4d91a-286">You will be presented with a panel where you can choose availability set</span></span>
4. <span data-ttu-id="4d91a-287">Scegliere il set di disponibilità AD FS</span><span class="sxs-lookup"><span data-stu-id="4d91a-287">Choose the AD FS availability set</span></span>

![Configurare il pool back-end del servizio di bilanciamento del carico interno](./media/active-directory-aadconnect-azure-adfs/ilbdeployment3.png)

<span data-ttu-id="4d91a-289">**6.3. Configurare il probe**</span><span class="sxs-lookup"><span data-stu-id="4d91a-289">**6.3. Configuring probe**</span></span>

<span data-ttu-id="4d91a-290">Nel pannello Impostazioni del servizio di bilanciamento del carico interno selezionare Probe.</span><span class="sxs-lookup"><span data-stu-id="4d91a-290">In the ILB settings panel, select Probes.</span></span>

1. <span data-ttu-id="4d91a-291">Fare clic su Aggiungi</span><span class="sxs-lookup"><span data-stu-id="4d91a-291">Click on add</span></span>
2. <span data-ttu-id="4d91a-292">Specificare i dettagli del probe a.</span><span class="sxs-lookup"><span data-stu-id="4d91a-292">Provide details for probe a.</span></span> <span data-ttu-id="4d91a-293">**Nome**: nome del probe b.</span><span class="sxs-lookup"><span data-stu-id="4d91a-293">**Name**: Probe name b.</span></span> <span data-ttu-id="4d91a-294">**Protocollo**: TCP c.</span><span class="sxs-lookup"><span data-stu-id="4d91a-294">**Protocol**: TCP c.</span></span> <span data-ttu-id="4d91a-295">**Porta**: 443 (HTTPS) d.</span><span class="sxs-lookup"><span data-stu-id="4d91a-295">**Port**: 443 (HTTPS) d.</span></span> <span data-ttu-id="4d91a-296">**Intervallo**: 5 (valore predefinito). È l'intervallo con cui il servizio di bilanciamento del carico interno eseguirà il probe dei computer del pool back-end e.</span><span class="sxs-lookup"><span data-stu-id="4d91a-296">**Interval**: 5 (default value) – this is the interval at which ILB will probe the machines in the backend pool e.</span></span> <span data-ttu-id="4d91a-297">**Soglia di non integrità**: 2 (valore predefinito). È la soglia di errori di probe consecutivi in seguito ai quali il servizio di bilanciamento del carico interno dichiarerà che un computer del pool back-end non risponde e interromperà l'invio di traffico a tale computer.</span><span class="sxs-lookup"><span data-stu-id="4d91a-297">**Unhealthy threshold limit**: 2 (default val ue) – this is the threshold of consecutive probe failures after which ILB will declare a machine in the backend pool non-responsive and stop sending traffic to it.</span></span>

![Configurare il probe del servizio di bilanciamento del carico interno](./media/active-directory-aadconnect-azure-adfs/ilbdeployment4.png)

<span data-ttu-id="4d91a-299">**6.4. Creare le regole di bilanciamento del carico**</span><span class="sxs-lookup"><span data-stu-id="4d91a-299">**6.4. Create load balancing rules**</span></span>

<span data-ttu-id="4d91a-300">Per bilanciare efficacemente il traffico, il servizio di bilanciamento del carico interno dovrà essere configurato con regole di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="4d91a-300">In order to effectively balance the traffic, the ILB should be configured with load balancing rules.</span></span> <span data-ttu-id="4d91a-301">Per creare una regola di bilanciamento del carico:</span><span class="sxs-lookup"><span data-stu-id="4d91a-301">In order to create a load balancing rule,</span></span> 

1. <span data-ttu-id="4d91a-302">Selezionare Regole di bilanciamento del carico nel pannello Impostazioni del servizio di bilanciamento del carico interno</span><span class="sxs-lookup"><span data-stu-id="4d91a-302">Select Load balancing rule from the settings panel of the ILB</span></span>
2. <span data-ttu-id="4d91a-303">Fare clic su Aggiungi nel pannello Regole di bilanciamento del carico</span><span class="sxs-lookup"><span data-stu-id="4d91a-303">Click on Add in the Load balancing rule panel</span></span>
3. <span data-ttu-id="4d91a-304">Nel pannello Aggiungi regola di bilanciamento del carico a.</span><span class="sxs-lookup"><span data-stu-id="4d91a-304">In the Add load balancing rule panel a.</span></span> <span data-ttu-id="4d91a-305">**Nome**: specificare un nome per la regola b.</span><span class="sxs-lookup"><span data-stu-id="4d91a-305">**Name**: Provide a name for the rule b.</span></span> <span data-ttu-id="4d91a-306">**Protocollo**: selezionare TCP c.</span><span class="sxs-lookup"><span data-stu-id="4d91a-306">**Protocol**: Select TCP c.</span></span> <span data-ttu-id="4d91a-307">**Porta**: 443 d.</span><span class="sxs-lookup"><span data-stu-id="4d91a-307">**Port**: 443 d.</span></span> <span data-ttu-id="4d91a-308">**Porta back-end**: 443 e.</span><span class="sxs-lookup"><span data-stu-id="4d91a-308">**Backend port**: 443 e.</span></span> <span data-ttu-id="4d91a-309">**Pool back-end**: selezionare il pool creato in precedenza per il cluster AD FS f.</span><span class="sxs-lookup"><span data-stu-id="4d91a-309">**Backend pool**: Select the pool you created for the AD FS cluster earlier f.</span></span> <span data-ttu-id="4d91a-310">**Probe**: selezionare il probe creato in precedenza per i server AD FS</span><span class="sxs-lookup"><span data-stu-id="4d91a-310">**Probe**: Select the probe created for AD FS servers earlier</span></span>

![Configurare le regole di bilanciamento del servizio di bilanciamento del carico interno](./media/active-directory-aadconnect-azure-adfs/ilbdeployment5.png)

<span data-ttu-id="4d91a-312">**6.5. Aggiornare il DNS con il servizio di bilanciamento del carico interno**</span><span class="sxs-lookup"><span data-stu-id="4d91a-312">**6.5. Update DNS with ILB**</span></span>

<span data-ttu-id="4d91a-313">Passare al server DNS e creare un CNAME per il servizio di bilanciamento del carico interno.</span><span class="sxs-lookup"><span data-stu-id="4d91a-313">Go to your DNS server and create a CNAME for the ILB.</span></span> <span data-ttu-id="4d91a-314">Il CNAME dovrà essere creato per il servizio federativo con indirizzo IP che punta all'indirizzo IP del servizio di bilanciamento del carico interno.</span><span class="sxs-lookup"><span data-stu-id="4d91a-314">The CNAME should be for the federation service with the IP address pointing to the IP address of the ILB.</span></span> <span data-ttu-id="4d91a-315">Se l'indirizzo DIP del servizio di bilanciamento del carico interno è 10.3.0.8 e il servizio federativo installato è fs.contoso.com, ad esempio, creare un CNAME per fs.contoso.com che punta a 10.3.0.8.</span><span class="sxs-lookup"><span data-stu-id="4d91a-315">For example if the ILB DIP address is 10.3.0.8, and the federation service installed is fs.contoso.com, then create a CNAME for fs.contoso.com pointing to 10.3.0.8.</span></span>
<span data-ttu-id="4d91a-316">In questo modo, tutta la comunicazione relativa a fs.contoso.com raggiungerà il servizio di bilanciamento del carico interno e verrà indirizzata correttamente.</span><span class="sxs-lookup"><span data-stu-id="4d91a-316">This will ensure that all communication regarding fs.contoso.com end up at the ILB and are appropriately routed.</span></span>

### <a name="7-configuring-the-web-application-proxy-server"></a><span data-ttu-id="4d91a-317">7. Configurare il server proxy applicazione Web</span><span class="sxs-lookup"><span data-stu-id="4d91a-317">7. Configuring the Web Application Proxy server</span></span>
<span data-ttu-id="4d91a-318">**7.1. Configurare i server proxy applicazione Web per raggiungere i server AD FS**</span><span class="sxs-lookup"><span data-stu-id="4d91a-318">**7.1. Configuring the Web Application Proxy servers to reach AD FS servers**</span></span>

<span data-ttu-id="4d91a-319">Affinché i server proxy applicazione Web possano raggiungere i server AD FS controllati dal servizio di bilanciamento del carico interno, creare un record per il servizio di bilanciamento del carico interno in %systemroot%\system32\drivers\etc\hosts.</span><span class="sxs-lookup"><span data-stu-id="4d91a-319">In order to ensure that Web Application Proxy servers are able to reach the AD FS servers behind the ILB, create a record in the %systemroot%\system32\drivers\etc\hosts for the ILB.</span></span> <span data-ttu-id="4d91a-320">Si noti che il nome distinto dovrà essere il nome del servizio federativo, ad esempio fs.contoso.com,</span><span class="sxs-lookup"><span data-stu-id="4d91a-320">Note that the distinguished name (DN) should be the federation service name, for example fs.contoso.com.</span></span> <span data-ttu-id="4d91a-321">e la voce dell'indirizzo IP dovrà essere quella dell'indirizzo IP del servizio di bilanciamento del carico interno (10.3.0.8 nell'esempio).</span><span class="sxs-lookup"><span data-stu-id="4d91a-321">And the IP entry should be that of the ILB’s IP address (10.3.0.8 as in the example).</span></span>

<span data-ttu-id="4d91a-322">**7.2. Installare il ruolo Proxy applicazione Web**</span><span class="sxs-lookup"><span data-stu-id="4d91a-322">**7.2. Installing the Web Application Proxy role**</span></span>

<span data-ttu-id="4d91a-323">Dopo aver verificato che i server proxy applicazione Web possano raggiungere i server AD FS controllati dal servizio di bilanciamento del carico interno, è possibile installare i server proxy applicazione Web.</span><span class="sxs-lookup"><span data-stu-id="4d91a-323">After you ensure that Web Application Proxy servers are able to reach the AD FS servers behind ILB, you can next install the Web Application Proxy servers.</span></span> <span data-ttu-id="4d91a-324">I server proxy applicazione Web non vengono aggiunti al dominio.</span><span class="sxs-lookup"><span data-stu-id="4d91a-324">Web Application Proxy servers do not be joined to the domain.</span></span> <span data-ttu-id="4d91a-325">Installare i ruoli Proxy applicazione Web nei due server proxy applicazione Web selezionando il ruolo Accesso remoto.</span><span class="sxs-lookup"><span data-stu-id="4d91a-325">Install the Web Application Proxy roles on the two Web Application Proxy servers by selecting the Remote Access role.</span></span> <span data-ttu-id="4d91a-326">Server Manager consentirà di completare l'installazione di WAP.</span><span class="sxs-lookup"><span data-stu-id="4d91a-326">The server manager will guide you to complete the WAP installation.</span></span>
<span data-ttu-id="4d91a-327">Per altre informazioni sulla distribuzione di WAP, vedere [Installare e configurare il server del proxy dell'applicazione Web](https://technet.microsoft.com/library/dn383662.aspx).</span><span class="sxs-lookup"><span data-stu-id="4d91a-327">For more information on how to deploy WAP, read [Install and Configure the Web Application Proxy Server](https://technet.microsoft.com/library/dn383662.aspx).</span></span>

### <a name="8--deploying-the-internet-facing-public-load-balancer"></a><span data-ttu-id="4d91a-328">8.  Distribuire il servizio di bilanciamento del carico con connessione Internet (pubblico)</span><span class="sxs-lookup"><span data-stu-id="4d91a-328">8.  Deploying the Internet Facing (Public) Load Balancer</span></span>
<span data-ttu-id="4d91a-329">**8.1.  Creare il servizio di bilanciamento del carico con connessione Internet (pubblico)**</span><span class="sxs-lookup"><span data-stu-id="4d91a-329">**8.1.  Create Internet Facing (Public) Load Balancer**</span></span>

<span data-ttu-id="4d91a-330">Nel portale di Azure selezionare Servizi di bilanciamento del carico e quindi fare clic su Aggiungi.</span><span class="sxs-lookup"><span data-stu-id="4d91a-330">In the Azure portal, select Load balancers and then click on Add.</span></span> <span data-ttu-id="4d91a-331">Nel pannello Crea servizio di bilanciamento del carico immettere le informazioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="4d91a-331">In the Create load balancer panel, enter the following information</span></span>

1. <span data-ttu-id="4d91a-332">**Nome**: nome del servizio di bilanciamento del carico</span><span class="sxs-lookup"><span data-stu-id="4d91a-332">**Name**: Name for the load balancer</span></span>
2. <span data-ttu-id="4d91a-333">**Schema**: Pubblico. Questa opzione indica ad Azure che il servizio di bilanciamento del carico dovrà avere un indirizzo pubblico.</span><span class="sxs-lookup"><span data-stu-id="4d91a-333">**Scheme**: Public – this option tells Azure that this load balancer will need a public address.</span></span>
3. <span data-ttu-id="4d91a-334">**Indirizzo IP**: creare un nuovo indirizzo IP (dinamico)</span><span class="sxs-lookup"><span data-stu-id="4d91a-334">**IP Address**: Create a new IP address (dynamic)</span></span>

![Servizio di bilanciamento del carico con connessione Internet](./media/active-directory-aadconnect-azure-adfs/elbdeployment1.png)

<span data-ttu-id="4d91a-336">Al termine della distribuzione, il servizio di bilanciamento del carico verrà visualizzato nell'elenco Servizi di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="4d91a-336">After deployment, the load balancer will appear in the Load balancers list.</span></span>

![Elenco dei servizi di bilanciamento del carico](./media/active-directory-aadconnect-azure-adfs/elbdeployment2.png)

<span data-ttu-id="4d91a-338">**8.2. Assegnare un'etichetta DNS all'IP pubblico**</span><span class="sxs-lookup"><span data-stu-id="4d91a-338">**8.2. Assign a DNS label to the public IP**</span></span>

<span data-ttu-id="4d91a-339">Fare clic sulla voce del servizio di bilanciamento del carico appena creato nel pannello Servizi di bilanciamento del carico per visualizzare il pannello per la configurazione.</span><span class="sxs-lookup"><span data-stu-id="4d91a-339">Click on the newly created load balancer entry in the Load balancers panel to bring up the panel for configuration.</span></span> <span data-ttu-id="4d91a-340">Per configurare l'etichetta DNS per l'IP pubblico, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="4d91a-340">Follow below steps to configure the DNS label for the public IP:</span></span>

1. <span data-ttu-id="4d91a-341">Fare clic sull'indirizzo IP pubblico.</span><span class="sxs-lookup"><span data-stu-id="4d91a-341">Click on the public IP address.</span></span> <span data-ttu-id="4d91a-342">Verrà aperto il pannello per l'IP pubblico e le relative impostazioni</span><span class="sxs-lookup"><span data-stu-id="4d91a-342">This will open the panel for the public IP and its settings</span></span>
2. <span data-ttu-id="4d91a-343">Fare clic su Configurazione</span><span class="sxs-lookup"><span data-stu-id="4d91a-343">Click on Configuration</span></span>
3. <span data-ttu-id="4d91a-344">Specificare un'etichetta DNS,</span><span class="sxs-lookup"><span data-stu-id="4d91a-344">Provide a DNS label.</span></span> <span data-ttu-id="4d91a-345">che diventerà l'etichetta DNS pubblica accessibile da qualsiasi posizione, ad esempio contosofs.westus.cloudapp.azure.com.</span><span class="sxs-lookup"><span data-stu-id="4d91a-345">This will become the public DNS label that you can access from anywhere, for example contosofs.westus.cloudapp.azure.com.</span></span> <span data-ttu-id="4d91a-346">È possibile aggiungere una voce nel DNS esterno per il servizio federativo (come fs.contoso.com) che verrà risolta nell'etichetta DNS del servizio di bilanciamento del carico esterno (contosofs.westus.cloudapp.azure.com).</span><span class="sxs-lookup"><span data-stu-id="4d91a-346">You can add an entry in the external DNS for the federation service (like fs.contoso.com) that resolves to the DNS label of the external load balancer (contosofs.westus.cloudapp.azure.com).</span></span>

![Configurare il servizio di bilanciamento del carico con connessione Internet](./media/active-directory-aadconnect-azure-adfs/elbdeployment3.png) 

![Configurare il servizio di bilanciamento del carico con connessione Internet (DNS)](./media/active-directory-aadconnect-azure-adfs/elbdeployment4.png)

<span data-ttu-id="4d91a-349">**8.3. Configurare il pool back-end per il servizio di bilanciamento del carico con connessione Internet (pubblico)**</span><span class="sxs-lookup"><span data-stu-id="4d91a-349">**8.3. Configure backend pool for Internet Facing (Public) Load Balancer**</span></span> 

<span data-ttu-id="4d91a-350">Seguire la stessa procedura indicata per la creazione del servizio di bilanciamento del carico interno per configurare il pool back-end per il servizio di bilanciamento del carico con connessione Internet (pubblico) come set di disponibilità per i server WAP,</span><span class="sxs-lookup"><span data-stu-id="4d91a-350">Follow the same steps as in creating the internal load balancer, to configure the backend pool for Internet Facing (Public) Load Balancer as the availability set for the WAP servers.</span></span> <span data-ttu-id="4d91a-351">ad esempio contosowapset.</span><span class="sxs-lookup"><span data-stu-id="4d91a-351">For example, contosowapset.</span></span>

![Configurare il pool back-end del servizio di bilanciamento del carico con connessione Internet](./media/active-directory-aadconnect-azure-adfs/elbdeployment5.png)

<span data-ttu-id="4d91a-353">**8.4. Configurare il probe**</span><span class="sxs-lookup"><span data-stu-id="4d91a-353">**8.4. Configure probe**</span></span>

<span data-ttu-id="4d91a-354">Seguire la stessa procedura impiegata durante la configurazione del servizio di bilanciamento del carico interno per configurare il probe per il pool back-end dei server WAP.</span><span class="sxs-lookup"><span data-stu-id="4d91a-354">Follow the same steps as in configuring the internal load balancer  to configure the probe for the backend pool of WAP servers.</span></span>

![Configurare il probe del servizio di bilanciamento del carico con connessione Internet](./media/active-directory-aadconnect-azure-adfs/elbdeployment6.png)

<span data-ttu-id="4d91a-356">**8.5. Creare regole di bilanciamento del carico**</span><span class="sxs-lookup"><span data-stu-id="4d91a-356">**8.5. Create load balancing rule(s)**</span></span>

<span data-ttu-id="4d91a-357">Seguire la stessa procedura indicata per il servizio di bilanciamento del carico interno per configurare la regola di bilanciamento del carico per la porta TCP 443.</span><span class="sxs-lookup"><span data-stu-id="4d91a-357">Follow the same steps as in ILB to configure the load balancing rule for TCP 443.</span></span>

![Configurare le regole di bilanciamento del servizio di bilanciamento del carico con connessione Internet](./media/active-directory-aadconnect-azure-adfs/elbdeployment7.png)

### <a name="9-securing-the-network"></a><span data-ttu-id="4d91a-359">9. Proteggere la rete</span><span class="sxs-lookup"><span data-stu-id="4d91a-359">9. Securing the network</span></span>
<span data-ttu-id="4d91a-360">**9.1. Proteggere la subnet interna**</span><span class="sxs-lookup"><span data-stu-id="4d91a-360">**9.1. Securing the internal subnet**</span></span>

<span data-ttu-id="4d91a-361">In generale, per proteggere efficacemente la subnet interna sono necessarie le regole seguenti, nell'ordine indicato di seguito.</span><span class="sxs-lookup"><span data-stu-id="4d91a-361">Overall, you need the following rules to efficiently secure your internal subnet (in the order as listed below)</span></span>

| <span data-ttu-id="4d91a-362">Regola</span><span class="sxs-lookup"><span data-stu-id="4d91a-362">Rule</span></span> | <span data-ttu-id="4d91a-363">Descrizione</span><span class="sxs-lookup"><span data-stu-id="4d91a-363">Description</span></span> | <span data-ttu-id="4d91a-364">Flusso</span><span class="sxs-lookup"><span data-stu-id="4d91a-364">Flow</span></span> |
|:--- |:--- |:---:|
| <span data-ttu-id="4d91a-365">AllowHTTPSFromDMZ</span><span class="sxs-lookup"><span data-stu-id="4d91a-365">AllowHTTPSFromDMZ</span></span> |<span data-ttu-id="4d91a-366">Consente la comunicazione HTTPS dalla rete perimetrale</span><span class="sxs-lookup"><span data-stu-id="4d91a-366">Allow the HTTPS communication from DMZ</span></span> |<span data-ttu-id="4d91a-367">In ingresso</span><span class="sxs-lookup"><span data-stu-id="4d91a-367">Inbound</span></span> |
| <span data-ttu-id="4d91a-368">DenyInternetOutbound</span><span class="sxs-lookup"><span data-stu-id="4d91a-368">DenyInternetOutbound</span></span> |<span data-ttu-id="4d91a-369">Nessun accesso a Internet</span><span class="sxs-lookup"><span data-stu-id="4d91a-369">No access to internet</span></span> |<span data-ttu-id="4d91a-370">In uscita</span><span class="sxs-lookup"><span data-stu-id="4d91a-370">Outbound</span></span> |

![Regole di accesso interno (in ingresso)](./media/active-directory-aadconnect-azure-adfs/nsg_int.png)

<span data-ttu-id="4d91a-372">[commento]: <> (![regole di accesso interno (in ingresso)](./media/active-directory-aadconnect-azure-adfs/nsgintinbound.png)) [commento]: <> (![regole di accesso interno (in uscita)](./media/active-directory-aadconnect-azure-adfs/nsgintoutbound.png))</span><span class="sxs-lookup"><span data-stu-id="4d91a-372">[comment]: <> (![INT access rules (inbound)](./media/active-directory-aadconnect-azure-adfs/nsgintinbound.png)) [comment]: <> (![INT access rules (outbound)](./media/active-directory-aadconnect-azure-adfs/nsgintoutbound.png))</span></span>

<span data-ttu-id="4d91a-373">**9.2. Proteggere la subnet perimetrale**</span><span class="sxs-lookup"><span data-stu-id="4d91a-373">**9.2. Securing the DMZ subnet**</span></span>

| <span data-ttu-id="4d91a-374">Regola</span><span class="sxs-lookup"><span data-stu-id="4d91a-374">Rule</span></span> | <span data-ttu-id="4d91a-375">Descrizione</span><span class="sxs-lookup"><span data-stu-id="4d91a-375">Description</span></span> | <span data-ttu-id="4d91a-376">Flusso</span><span class="sxs-lookup"><span data-stu-id="4d91a-376">Flow</span></span> |
|:--- |:--- |:---:|
| <span data-ttu-id="4d91a-377">AllowHTTPSFromInternet</span><span class="sxs-lookup"><span data-stu-id="4d91a-377">AllowHTTPSFromInternet</span></span> |<span data-ttu-id="4d91a-378">Consente il traffico HTTPS da Internet alla rete perimetrale</span><span class="sxs-lookup"><span data-stu-id="4d91a-378">Allow HTTPS from internet to the DMZ</span></span> |<span data-ttu-id="4d91a-379">In ingresso</span><span class="sxs-lookup"><span data-stu-id="4d91a-379">Inbound</span></span> |
| <span data-ttu-id="4d91a-380">DenyInternetOutbound</span><span class="sxs-lookup"><span data-stu-id="4d91a-380">DenyInternetOutbound</span></span> |<span data-ttu-id="4d91a-381">Tutto il traffico non HTTPS verso Internet viene bloccato</span><span class="sxs-lookup"><span data-stu-id="4d91a-381">Anything except HTTPS to internet is blocked</span></span> |<span data-ttu-id="4d91a-382">In uscita</span><span class="sxs-lookup"><span data-stu-id="4d91a-382">Outbound</span></span> |

![Regole di accesso esterno (in ingresso)](./media/active-directory-aadconnect-azure-adfs/nsg_dmz.png)

<span data-ttu-id="4d91a-384">[commento]: <> (![regole di accesso esterno (in ingresso)](./media/active-directory-aadconnect-azure-adfs/nsgdmzinbound.png)) [commento]: <> (![regole di accesso esterno (in uscita)](./media/active-directory-aadconnect-azure-adfs/nsgdmzoutbound.png))</span><span class="sxs-lookup"><span data-stu-id="4d91a-384">[comment]: <> (![EXT access rules (inbound)](./media/active-directory-aadconnect-azure-adfs/nsgdmzinbound.png)) [comment]: <> (![EXT access rules (outbound)](./media/active-directory-aadconnect-azure-adfs/nsgdmzoutbound.png))</span></span>

> [!NOTE]
> <span data-ttu-id="4d91a-385">Se è necessaria l'autenticazione del certificato utente client (autenticazione clientTLS con i certificati utente X509), AD FS richiede l'abilitazione della porta TCP 49443 per l'accesso in ingresso.</span><span class="sxs-lookup"><span data-stu-id="4d91a-385">If client user certificate authentication (clientTLS authentication using X509 user certificates) is required, then AD FS requires TCP port 49443 be enabled for inbound access.</span></span>
> 
> 

### <a name="10-test-the-ad-fs-sign-in"></a><span data-ttu-id="4d91a-386">10. Testare l'accesso ad AD FS</span><span class="sxs-lookup"><span data-stu-id="4d91a-386">10. Test the AD FS sign-in</span></span>
<span data-ttu-id="4d91a-387">Il modo più semplice per testare AD FS consiste nell'usare la pagina IdpInitiatedSignon.aspx.</span><span class="sxs-lookup"><span data-stu-id="4d91a-387">The easiest way is to test AD FS is by using the IdpInitiatedSignon.aspx page.</span></span> <span data-ttu-id="4d91a-388">A tale scopo, è necessario abilitare IdpInitiatedSignOn nelle proprietà di AD FS.</span><span class="sxs-lookup"><span data-stu-id="4d91a-388">In order to be able to do that, it is required to enable the IdpInitiatedSignOn on the AD FS properties.</span></span> <span data-ttu-id="4d91a-389">Per verificare l'installazione di AD FS, seguire questa procedura.</span><span class="sxs-lookup"><span data-stu-id="4d91a-389">Follow the steps below to verify your AD FS setup</span></span>

1. <span data-ttu-id="4d91a-390">Eseguire con PowerShell il cmdlet di seguito nel server AD FS per impostare l'abilitazione:</span><span class="sxs-lookup"><span data-stu-id="4d91a-390">Run the below cmdlet on the AD FS server, using PowerShell, to set it to enabled.</span></span>
   <span data-ttu-id="4d91a-391">Set-AdfsProperties -EnableIdPInitiatedSignonPage $true</span><span class="sxs-lookup"><span data-stu-id="4d91a-391">Set-AdfsProperties -EnableIdPInitiatedSignonPage $true</span></span> 
2. <span data-ttu-id="4d91a-392">Da qualsiasi computer esterno accedere a https://adfs.thecloudadvocate.com/adfs/ls/IdpInitiatedSignon.aspx</span><span class="sxs-lookup"><span data-stu-id="4d91a-392">From any external machine access https://adfs.thecloudadvocate.com/adfs/ls/IdpInitiatedSignon.aspx</span></span>  
3. <span data-ttu-id="4d91a-393">La pagina di AD FS dovrebbe essere visualizzata come segue:</span><span class="sxs-lookup"><span data-stu-id="4d91a-393">You should see the AD FS page like below:</span></span>

![Pagina di accesso di test](./media/active-directory-aadconnect-azure-adfs/test1.png)

<span data-ttu-id="4d91a-395">Dopo l'accesso, verrà visualizzato un messaggio di completamento dell'operazione come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="4d91a-395">On successful sign-in, it will provide you with a success message as shown below:</span></span>

![Completamento test](./media/active-directory-aadconnect-azure-adfs/test2.png)

## <a name="template-for-deploying-ad-fs-in-azure"></a><span data-ttu-id="4d91a-397">Modello per la distribuzione di AD FS in Azure</span><span class="sxs-lookup"><span data-stu-id="4d91a-397">Template for deploying AD FS in Azure</span></span>
<span data-ttu-id="4d91a-398">Il modello consente di distribuire una configurazione a 6 computer, 2 per ogni controller di dominio, AD FS e WAP.</span><span class="sxs-lookup"><span data-stu-id="4d91a-398">The template deploys a 6 machine setup, 2 each for Domain Controllers, AD FS and WAP.</span></span>

[<span data-ttu-id="4d91a-399">Modello di distribuzione di AD FS in Azure</span><span class="sxs-lookup"><span data-stu-id="4d91a-399">AD FS in Azure Deployment Template</span></span>](https://github.com/paulomarquesc/adfs-6vms-regular-template-based)

<span data-ttu-id="4d91a-400">Durante la distribuzione di questo modello, è possibile usare una rete virtuale esistente o crearne una nuova.</span><span class="sxs-lookup"><span data-stu-id="4d91a-400">You can use an existing virtual network or create a new VNET while deploying this template.</span></span> <span data-ttu-id="4d91a-401">I diversi parametri disponibili per personalizzare la distribuzione sono elencati di seguito insieme alla descrizione dell'uso del parametro nel processo di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="4d91a-401">The various parameters available for customizing the deployment are listed below with the description of usage of the parameter in the deployment process.</span></span> 

| <span data-ttu-id="4d91a-402">Parametro</span><span class="sxs-lookup"><span data-stu-id="4d91a-402">Parameter</span></span> | <span data-ttu-id="4d91a-403">Description</span><span class="sxs-lookup"><span data-stu-id="4d91a-403">Description</span></span> |
|:--- |:--- |
| <span data-ttu-id="4d91a-404">Percorso</span><span class="sxs-lookup"><span data-stu-id="4d91a-404">Location</span></span> |<span data-ttu-id="4d91a-405">L'area in cui distribuire le risorse, ad esempio Stati Uniti orientali.</span><span class="sxs-lookup"><span data-stu-id="4d91a-405">The region to deploy the resources into, e.g. East US.</span></span> |
| <span data-ttu-id="4d91a-406">StorageAccountType</span><span class="sxs-lookup"><span data-stu-id="4d91a-406">StorageAccountType</span></span> |<span data-ttu-id="4d91a-407">Il tipo di account di archiviazione creato</span><span class="sxs-lookup"><span data-stu-id="4d91a-407">The type of the Storage Account created</span></span> |
| <span data-ttu-id="4d91a-408">VirtualNetworkUsage</span><span class="sxs-lookup"><span data-stu-id="4d91a-408">VirtualNetworkUsage</span></span> |<span data-ttu-id="4d91a-409">Indica se verrà creata una nuova rete virtuale o ne verrà usata una esistente</span><span class="sxs-lookup"><span data-stu-id="4d91a-409">Indicates if a new virtual network will be created or use an existing one</span></span> |
| <span data-ttu-id="4d91a-410">VirtualNetworkName</span><span class="sxs-lookup"><span data-stu-id="4d91a-410">VirtualNetworkName</span></span> |<span data-ttu-id="4d91a-411">Il nome della rete virtuale da creare, obbligatorio sia in caso di uso di una rete esistente che con una rete nuova</span><span class="sxs-lookup"><span data-stu-id="4d91a-411">The name of the Virtual Network to Create, mandatory on both existing or new virtual network usage</span></span> |
| <span data-ttu-id="4d91a-412">VirtualNetworkResourceGroupName</span><span class="sxs-lookup"><span data-stu-id="4d91a-412">VirtualNetworkResourceGroupName</span></span> |<span data-ttu-id="4d91a-413">Specifica il nome del gruppo di risorse in cui risiede la rete virtuale esistente.</span><span class="sxs-lookup"><span data-stu-id="4d91a-413">Specifies the name of the resource group where the existing virtual network resides.</span></span> <span data-ttu-id="4d91a-414">Quando si usa una rete virtuale esistente, questo diventa un parametro obbligatorio per consentire alla distribuzione di trovare l'ID della rete virtuale esistente</span><span class="sxs-lookup"><span data-stu-id="4d91a-414">When using an existing virtual network, this becomes a mandatory parameter so the deployment can find the ID of the existing virtual network</span></span> |
| <span data-ttu-id="4d91a-415">VirtualNetworkAddressRange</span><span class="sxs-lookup"><span data-stu-id="4d91a-415">VirtualNetworkAddressRange</span></span> |<span data-ttu-id="4d91a-416">L'intervallo di indirizzi della nuova rete virtuale, obbligatorio in caso di creazione di una nuova rete virtuale</span><span class="sxs-lookup"><span data-stu-id="4d91a-416">The address range of the new VNET, mandatory if creating a new virtual network</span></span> |
| <span data-ttu-id="4d91a-417">InternalSubnetName</span><span class="sxs-lookup"><span data-stu-id="4d91a-417">InternalSubnetName</span></span> |<span data-ttu-id="4d91a-418">Il nome della subnet interna, obbligatorio sia in caso di uso di una rete virtuale esistente che con una rete virtuale nuova</span><span class="sxs-lookup"><span data-stu-id="4d91a-418">The name of the internal subnet, mandatory on both virtual network usage options (new or existing)</span></span> |
| <span data-ttu-id="4d91a-419">InternalSubnetAddressRange</span><span class="sxs-lookup"><span data-stu-id="4d91a-419">InternalSubnetAddressRange</span></span> |<span data-ttu-id="4d91a-420">L'intervallo di indirizzi della subnet interna, che contiene controller di dominio e server AD FS, obbligatorio in caso di creazione di una nuova rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="4d91a-420">The address range of the internal subnet, which contains the Domain Controllers and ADFS servers, mandatory if creating a new virtual network.</span></span> |
| <span data-ttu-id="4d91a-421">DMZSubnetAddressRange</span><span class="sxs-lookup"><span data-stu-id="4d91a-421">DMZSubnetAddressRange</span></span> |<span data-ttu-id="4d91a-422">L'intervallo di indirizzi della subnet della rete perimetrale, che contiene server proxy dell'applicazione Windows, obbligatorio in caso di creazione di una nuova rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="4d91a-422">The address range of the dmz subnet, which contains the Windows application proxy servers, mandatory if creating a new virtual network.</span></span> |
| <span data-ttu-id="4d91a-423">DMZSubnetName</span><span class="sxs-lookup"><span data-stu-id="4d91a-423">DMZSubnetName</span></span> |<span data-ttu-id="4d91a-424">Il nome della subnet interna, obbligatorio sia in caso di uso di una rete virtuale esistente che con una rete virtuale nuova.</span><span class="sxs-lookup"><span data-stu-id="4d91a-424">The name of the internal subnet, mandatory on both virtual network usage options (new or existing).</span></span> |
| <span data-ttu-id="4d91a-425">ADDC01NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="4d91a-425">ADDC01NICIPAddress</span></span> |<span data-ttu-id="4d91a-426">L'indirizzo IP interno del primo controller di dominio; verrà assegnato in modo statico al controller di dominio e deve essere un indirizzo IP valido nella subnet interna</span><span class="sxs-lookup"><span data-stu-id="4d91a-426">The internal IP address of the first Domain Controller, this IP address will be statically assigned to the DC and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="4d91a-427">ADDC02NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="4d91a-427">ADDC02NICIPAddress</span></span> |<span data-ttu-id="4d91a-428">L'indirizzo IP interno del secondo controller di dominio; verrà assegnato in modo statico al controller di dominio e deve essere un indirizzo IP valido nella subnet interna</span><span class="sxs-lookup"><span data-stu-id="4d91a-428">The internal IP address of the second Domain Controller, this IP address will be statically assigned to the DC and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="4d91a-429">ADFS01NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="4d91a-429">ADFS01NICIPAddress</span></span> |<span data-ttu-id="4d91a-430">L'indirizzo IP interno del primo server AD FS; verrà assegnato in modo statico al server AD FS e deve essere un indirizzo IP valido nella subnet interna</span><span class="sxs-lookup"><span data-stu-id="4d91a-430">The internal IP address of the first ADFS server, this IP address will be statically assigned to the ADFS server and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="4d91a-431">ADFS02NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="4d91a-431">ADFS02NICIPAddress</span></span> |<span data-ttu-id="4d91a-432">L'indirizzo IP interno del secondo server AD FS; verrà assegnato in modo statico al server AD FS e deve essere un indirizzo IP valido nella subnet interna</span><span class="sxs-lookup"><span data-stu-id="4d91a-432">The internal IP address of the second ADFS server, this IP address will be statically assigned to the ADFS server and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="4d91a-433">WAP01NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="4d91a-433">WAP01NICIPAddress</span></span> |<span data-ttu-id="4d91a-434">L'indirizzo IP interno del primo server WAP; verrà assegnato in modo statico al server WAP e deve essere un indirizzo IP valido nella subnet della rete perimetrale</span><span class="sxs-lookup"><span data-stu-id="4d91a-434">The internal IP address of the first WAP server, this IP address will be statically assigned to the WAP server and must be a valid ip address within the DMZ subnet</span></span> |
| <span data-ttu-id="4d91a-435">WAP02NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="4d91a-435">WAP02NICIPAddress</span></span> |<span data-ttu-id="4d91a-436">L'indirizzo IP interno del secondo server WAP; verrà assegnato in modo statico al server WAP e deve essere un indirizzo IP valido nella subnet della rete perimetrale</span><span class="sxs-lookup"><span data-stu-id="4d91a-436">The internal IP address of the second WAP server, this IP address will be statically assigned to the WAP server and must be a valid ip address within the DMZ subnet</span></span> |
| <span data-ttu-id="4d91a-437">ADFSLoadBalancerPrivateIPAddress</span><span class="sxs-lookup"><span data-stu-id="4d91a-437">ADFSLoadBalancerPrivateIPAddress</span></span> |<span data-ttu-id="4d91a-438">L'indirizzo IP interno del servizio di bilanciamento del carico AD FS; verrà assegnato in modo statico al servizio di bilanciamento del carico e deve essere un indirizzo IP valido nella subnet interna</span><span class="sxs-lookup"><span data-stu-id="4d91a-438">The internal IP address of the ADFS load balancer, this IP address will be statically assigned to the load balancer and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="4d91a-439">ADDCVMNamePrefix</span><span class="sxs-lookup"><span data-stu-id="4d91a-439">ADDCVMNamePrefix</span></span> |<span data-ttu-id="4d91a-440">Il prefisso del nome della macchina virtuale per i controller di dominio</span><span class="sxs-lookup"><span data-stu-id="4d91a-440">Virtual Machine name prefix for Domain Controllers</span></span> |
| <span data-ttu-id="4d91a-441">ADFSVMNamePrefix</span><span class="sxs-lookup"><span data-stu-id="4d91a-441">ADFSVMNamePrefix</span></span> |<span data-ttu-id="4d91a-442">Il prefisso del nome della macchina virtuale per i server AD FS</span><span class="sxs-lookup"><span data-stu-id="4d91a-442">Virtual Machine name prefix for ADFS servers</span></span> |
| <span data-ttu-id="4d91a-443">WAPVMNamePrefix</span><span class="sxs-lookup"><span data-stu-id="4d91a-443">WAPVMNamePrefix</span></span> |<span data-ttu-id="4d91a-444">Il prefisso del nome della macchina virtuale per i server WAP</span><span class="sxs-lookup"><span data-stu-id="4d91a-444">Virtual Machine name prefix for WAP servers</span></span> |
| <span data-ttu-id="4d91a-445">ADDCVMSize</span><span class="sxs-lookup"><span data-stu-id="4d91a-445">ADDCVMSize</span></span> |<span data-ttu-id="4d91a-446">Le dimensioni della VM dei controller di dominio</span><span class="sxs-lookup"><span data-stu-id="4d91a-446">The vm size of the Domain Controllers</span></span> |
| <span data-ttu-id="4d91a-447">ADFSVMSize</span><span class="sxs-lookup"><span data-stu-id="4d91a-447">ADFSVMSize</span></span> |<span data-ttu-id="4d91a-448">Le dimensioni della VM dei server AD FS</span><span class="sxs-lookup"><span data-stu-id="4d91a-448">The vm size of the ADFS servers</span></span> |
| <span data-ttu-id="4d91a-449">WAPVMSize</span><span class="sxs-lookup"><span data-stu-id="4d91a-449">WAPVMSize</span></span> |<span data-ttu-id="4d91a-450">Le dimensioni della VM dei server WAP</span><span class="sxs-lookup"><span data-stu-id="4d91a-450">The vm size of the WAP servers</span></span> |
| <span data-ttu-id="4d91a-451">AdminUserName</span><span class="sxs-lookup"><span data-stu-id="4d91a-451">AdminUserName</span></span> |<span data-ttu-id="4d91a-452">Il nome dell'amministratore locale delle macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="4d91a-452">The name of the local Administrator of the virtual machines</span></span> |
| <span data-ttu-id="4d91a-453">AdminPassword</span><span class="sxs-lookup"><span data-stu-id="4d91a-453">AdminPassword</span></span> |<span data-ttu-id="4d91a-454">La password dell'account dell'amministratore locale delle macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="4d91a-454">The password for the local Administrator account of the virtual machines</span></span> |

## <a name="additional-resources"></a><span data-ttu-id="4d91a-455">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="4d91a-455">Additional resources</span></span>
* [<span data-ttu-id="4d91a-456">Set di disponibilità</span><span class="sxs-lookup"><span data-stu-id="4d91a-456">Availability Sets</span></span>](https://aka.ms/Azure/Availability) 
* [<span data-ttu-id="4d91a-457">Servizio di bilanciamento del carico di Azure</span><span class="sxs-lookup"><span data-stu-id="4d91a-457">Azure Load Balancer</span></span>](https://aka.ms/Azure/ILB)
* [<span data-ttu-id="4d91a-458">Servizio di bilanciamento del carico interno</span><span class="sxs-lookup"><span data-stu-id="4d91a-458">Internal Load Balancer</span></span>](https://aka.ms/Azure/ILB/Internal)
* [<span data-ttu-id="4d91a-459">Servizio di bilanciamento del carico con connessione Internet</span><span class="sxs-lookup"><span data-stu-id="4d91a-459">Internet Facing Load Balancer</span></span>](https://aka.ms/Azure/ILB/Internet)
* [<span data-ttu-id="4d91a-460">Account di archiviazione</span><span class="sxs-lookup"><span data-stu-id="4d91a-460">Storage Accounts</span></span>](https://aka.ms/Azure/Storage)
* [<span data-ttu-id="4d91a-461">Reti virtuali di Azure</span><span class="sxs-lookup"><span data-stu-id="4d91a-461">Azure Virtual Networks</span></span>](https://aka.ms/Azure/VNet)
* [<span data-ttu-id="4d91a-462">Collegamenti relativi ad AD FS e proxy applicazione Web</span><span class="sxs-lookup"><span data-stu-id="4d91a-462">AD FS and Web Application Proxy Links</span></span>](http://aka.ms/ADFSLinks) 

## <a name="next-steps"></a><span data-ttu-id="4d91a-463">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="4d91a-463">Next steps</span></span>
* [<span data-ttu-id="4d91a-464">Integrazione delle identità locali con Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="4d91a-464">Integrating your on-premises identities with Azure Active Directory</span></span>](active-directory-aadconnect.md)
* [<span data-ttu-id="4d91a-465">Configurazione e gestione di AD FS con Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="4d91a-465">Configuring and managing your AD FS using Azure AD Connect</span></span>](active-directory-aadconnectfed-whatis.md)
* [<span data-ttu-id="4d91a-466">Distribuzione di AD FS a disponibilità elevata tra aree geografiche in Azure con Gestione traffico di Azure</span><span class="sxs-lookup"><span data-stu-id="4d91a-466">High availability cross-geographic AD FS deployment in Azure with Azure Traffic Manager</span></span>](../active-directory-adfs-in-azure-with-azure-traffic-manager.md)

