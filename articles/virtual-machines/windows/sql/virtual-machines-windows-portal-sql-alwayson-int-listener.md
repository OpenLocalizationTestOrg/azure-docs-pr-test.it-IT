---
title: "aaaCreate un listener del gruppo di disponibilità di SQL Server in macchine virtuali di Azure | Documenti Microsoft"
description: "Istruzioni dettagliate per creare un listener per un gruppo di disponibilità Always On per SQL Server nelle macchine virtuali di Azure"
services: virtual-machines
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: monicar
ms.assetid: d1f291e9-9af2-41ba-9d29-9541e3adcfcf
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/01/2017
ms.author: mikeray
ms.openlocfilehash: c6a44dc5c7c18b572c2bf5772b4651b7210aacbd
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="configure-a-load-balancer-for-an-always-on-availability-group-in-azure"></a><span data-ttu-id="6acfc-103">Configurare un servizio di bilanciamento del carico interno per un gruppo di disponibilità Always On in Azure</span><span class="sxs-lookup"><span data-stu-id="6acfc-103">Configure a load balancer for an Always On availability group in Azure</span></span>
<span data-ttu-id="6acfc-104">Questo articolo viene illustrato come un bilanciamento del carico per un gruppo di disponibilità SQL Server Always On in Azure virtuale toocreate computer che eseguono con Gestione risorse di Azure.</span><span class="sxs-lookup"><span data-stu-id="6acfc-104">This article explains how toocreate a load balancer for a SQL Server Always On availability group in Azure virtual machines that are running with Azure Resource Manager.</span></span> <span data-ttu-id="6acfc-105">Un gruppo di disponibilità richiede un bilanciamento del carico quando si trovano le istanze di SQL Server hello in macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="6acfc-105">An availability group requires a load balancer when hello SQL Server instances are on Azure virtual machines.</span></span> <span data-ttu-id="6acfc-106">servizio di bilanciamento del carico Hello archivia l'indirizzo IP hello per listener del gruppo di disponibilità hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-106">hello load balancer stores hello IP address for hello availability group listener.</span></span> <span data-ttu-id="6acfc-107">Se un gruppo di disponibilità si estende su più aree, è necessario un servizio di bilanciamento del carico per ogni area.</span><span class="sxs-lookup"><span data-stu-id="6acfc-107">If an availability group spans multiple regions, each region needs a load balancer.</span></span>

<span data-ttu-id="6acfc-108">toocomplete questa attività, è necessario un gruppo di disponibilità di SQL Server è distribuito in macchine virtuali di Azure che eseguono con Gestione risorse di toohave.</span><span class="sxs-lookup"><span data-stu-id="6acfc-108">toocomplete this task, you need toohave a SQL Server availability group deployed on Azure virtual machines that are running with Resource Manager.</span></span> <span data-ttu-id="6acfc-109">Entrambe le macchine virtuali di SQL Server deve appartenere toohello stesso set di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="6acfc-109">Both SQL Server virtual machines must belong toohello same availability set.</span></span> <span data-ttu-id="6acfc-110">È possibile utilizzare hello [modello Microsoft](virtual-machines-windows-portal-sql-alwayson-availability-groups.md) tooautomatically creare il gruppo di disponibilità di hello in Gestione risorse.</span><span class="sxs-lookup"><span data-stu-id="6acfc-110">You can use hello [Microsoft template](virtual-machines-windows-portal-sql-alwayson-availability-groups.md) tooautomatically create hello availability group in Resource Manager.</span></span> <span data-ttu-id="6acfc-111">Questo modello crea automaticamente un servizio di bilanciamento del carico interno.</span><span class="sxs-lookup"><span data-stu-id="6acfc-111">This template automatically creates an internal load balancer for you.</span></span> 

<span data-ttu-id="6acfc-112">Se si preferisce, è possibile [configurare manualmente un gruppo di disponibilità](virtual-machines-windows-portal-sql-alwayson-availability-groups-manual.md).</span><span class="sxs-lookup"><span data-stu-id="6acfc-112">If you prefer, you can [manually configure an availability group](virtual-machines-windows-portal-sql-alwayson-availability-groups-manual.md).</span></span>

<span data-ttu-id="6acfc-113">Per questo articolo è necessario che i gruppi di disponibilità siano già configurati.</span><span class="sxs-lookup"><span data-stu-id="6acfc-113">This article requires that your availability groups are already configured.</span></span>  

<span data-ttu-id="6acfc-114">Gli argomenti correlati includono:</span><span class="sxs-lookup"><span data-stu-id="6acfc-114">Related topics include:</span></span>

* [<span data-ttu-id="6acfc-115">Configurare i gruppi di disponibilità Always On in una macchina virtuale di Azure, GUI</span><span class="sxs-lookup"><span data-stu-id="6acfc-115">Configure Always On availability groups in Azure VM (GUI)</span></span>](virtual-machines-windows-portal-sql-alwayson-availability-groups-manual.md)   
* [<span data-ttu-id="6acfc-116">Configurare una connessione da VNet a VNet tramite Azure Resource Manager e PowerShell</span><span class="sxs-lookup"><span data-stu-id="6acfc-116">Configure a VNet-to-VNet connection by using Azure Resource Manager and PowerShell</span></span>](../../../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md)

<span data-ttu-id="6acfc-117">Esaminando questo articolo, creare e configurare un bilanciamento del carico in hello portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="6acfc-117">By walking through this article, you create and configure a load balancer in hello Azure portal.</span></span> <span data-ttu-id="6acfc-118">Una volta completato il processo di hello, configurare hello toouse hello indirizzo IP del cluster di bilanciamento del carico hello per listener del gruppo di disponibilità hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-118">After hello process is complete, you configure hello cluster toouse hello IP address from hello load balancer for hello availability group listener.</span></span>

## <a name="create-and-configure-hello-load-balancer-in-hello-azure-portal"></a><span data-ttu-id="6acfc-119">Creare e configurare Bilanciamento carico di hello in hello portale di Azure</span><span class="sxs-lookup"><span data-stu-id="6acfc-119">Create and configure hello load balancer in hello Azure portal</span></span>
<span data-ttu-id="6acfc-120">In questa parte dell'attività hello hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="6acfc-120">In this portion of hello task, do hello following:</span></span>

1. <span data-ttu-id="6acfc-121">Nel portale di Azure hello, bilanciamento del carico hello creare e configurare l'indirizzo IP di hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-121">In hello Azure portal, create hello load balancer and configure hello IP address.</span></span>
2. <span data-ttu-id="6acfc-122">Configurare il pool di back-end hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-122">Configure hello back-end pool.</span></span>
3. <span data-ttu-id="6acfc-123">Creare il probe hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-123">Create hello probe.</span></span> 
4. <span data-ttu-id="6acfc-124">Impostare regole di bilanciamento del carico di hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-124">Set hello load balancing rules.</span></span>

> [!NOTE]
> <span data-ttu-id="6acfc-125">Se le istanze di SQL Server hello in più gruppi di risorse e le aree, eseguire ogni passaggio due volte, una volta in ogni gruppo di risorse.</span><span class="sxs-lookup"><span data-stu-id="6acfc-125">If hello SQL Server instances are in multiple resource groups and regions, perform each step twice, once in each resource group.</span></span>
> 
> 

### <a name="step-1-create-hello-load-balancer-and-configure-hello-ip-address"></a><span data-ttu-id="6acfc-126">Passaggio 1: Creare bilanciamento del carico hello e configurare l'indirizzo IP hello</span><span class="sxs-lookup"><span data-stu-id="6acfc-126">Step 1: Create hello load balancer and configure hello IP address</span></span>
<span data-ttu-id="6acfc-127">Innanzitutto, creare bilanciamento del carico hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-127">First, create hello load balancer.</span></span> 

1. <span data-ttu-id="6acfc-128">Nel portale di Azure hello, aprire gruppo di risorse hello contenente hello macchine virtuali di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="6acfc-128">In hello Azure portal, open hello resource group that contains hello SQL Server virtual machines.</span></span> 

2. <span data-ttu-id="6acfc-129">Nel gruppo di risorse hello, fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-129">In hello resource group, click **Add**.</span></span>

3. <span data-ttu-id="6acfc-130">Cercare **bilanciamento del carico** nei risultati della ricerca hello, quindi selezionare **bilanciamento del carico**, che viene pubblicato da **Microsoft**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-130">Search for **load balancer** and then, in hello search results, select **Load Balancer**, which is published by **Microsoft**.</span></span>

4. <span data-ttu-id="6acfc-131">In hello **bilanciamento del carico** pannello, fare clic su **crea**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-131">On hello **Load Balancer** blade, click **Create**.</span></span>

5. <span data-ttu-id="6acfc-132">In hello **Crea servizio di bilanciamento del carico** finestra di dialogo casella, configurare il bilanciamento del carico di hello come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="6acfc-132">In hello **Create load balancer** dialog box, configure hello load balancer as follows:</span></span>

   | <span data-ttu-id="6acfc-133">Impostazione</span><span class="sxs-lookup"><span data-stu-id="6acfc-133">Setting</span></span> | <span data-ttu-id="6acfc-134">Valore</span><span class="sxs-lookup"><span data-stu-id="6acfc-134">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="6acfc-135">**Nome**</span><span class="sxs-lookup"><span data-stu-id="6acfc-135">**Name**</span></span> |<span data-ttu-id="6acfc-136">Un nome di testo che rappresenta di bilanciamento del carico hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-136">A text name representing hello load balancer.</span></span> <span data-ttu-id="6acfc-137">Ad esempio **sqlLB**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-137">For example, **sqlLB**.</span></span> |
   | <span data-ttu-id="6acfc-138">**Tipo**</span><span class="sxs-lookup"><span data-stu-id="6acfc-138">**Type**</span></span> |<span data-ttu-id="6acfc-139">**Interno**: la maggior parte delle implementazioni usano un servizio di bilanciamento del carico interno, che consente alle applicazioni all'interno di hello stesso gruppo di disponibilità toohello di tooconnect rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="6acfc-139">**Internal**: Most implementations use an internal load balancer, which allows applications within hello same virtual network tooconnect toohello availability group.</span></span>  </br> <span data-ttu-id="6acfc-140">**Esterno**: consente di gruppo di disponibilità di applicazioni tooconnect toohello tramite una connessione Internet pubblica.</span><span class="sxs-lookup"><span data-stu-id="6acfc-140">**External**: Allows applications tooconnect toohello availability group through a public Internet connection.</span></span> |
   | <span data-ttu-id="6acfc-141">**Rete virtuale**</span><span class="sxs-lookup"><span data-stu-id="6acfc-141">**Virtual network**</span></span> |<span data-ttu-id="6acfc-142">Selezionare hello la rete virtuale che si trovano in istanze di SQL Server hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-142">Select hello virtual network that hello SQL Server intances are in.</span></span> |
   | <span data-ttu-id="6acfc-143">**Subnet**</span><span class="sxs-lookup"><span data-stu-id="6acfc-143">**Subnet**</span></span> |<span data-ttu-id="6acfc-144">Selezionare subnet hello presenti istanze di SQL Server hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-144">Select hello subnet that hello SQL Server instances are in.</span></span> |
   | <span data-ttu-id="6acfc-145">**Assegnazione indirizzi IP**</span><span class="sxs-lookup"><span data-stu-id="6acfc-145">**IP address assignment**</span></span> |<span data-ttu-id="6acfc-146">**Statico**</span><span class="sxs-lookup"><span data-stu-id="6acfc-146">**Static**</span></span> |
   | <span data-ttu-id="6acfc-147">**Indirizzo IP privato**</span><span class="sxs-lookup"><span data-stu-id="6acfc-147">**Private IP address**</span></span> |<span data-ttu-id="6acfc-148">Specificare un indirizzo IP disponibile dalla subnet hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-148">Specify an available IP address from hello subnet.</span></span> <span data-ttu-id="6acfc-149">Utilizzare questo indirizzo IP quando si crea un listener in cluster hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-149">Use this IP address when you create a listener on hello cluster.</span></span> <span data-ttu-id="6acfc-150">In uno script di PowerShell, più avanti in questo articolo, utilizzare questo indirizzo per hello `$ILBIP` variabile.</span><span class="sxs-lookup"><span data-stu-id="6acfc-150">In a PowerShell script, later in this article, use this address for hello `$ILBIP` variable.</span></span> |
   | <span data-ttu-id="6acfc-151">**Sottoscrizione**</span><span class="sxs-lookup"><span data-stu-id="6acfc-151">**Subscription**</span></span> |<span data-ttu-id="6acfc-152">Se si hanno più sottoscrizioni, può essere visualizzato questo campo.</span><span class="sxs-lookup"><span data-stu-id="6acfc-152">If you have multiple subscriptions, this field might appear.</span></span> <span data-ttu-id="6acfc-153">Selezionare una sottoscrizione di hello che si desidera tooassociate con questa risorsa.</span><span class="sxs-lookup"><span data-stu-id="6acfc-153">Select hello subscription that you want tooassociate with this resource.</span></span> <span data-ttu-id="6acfc-154">Come tutte le risorse di hello per il gruppo di disponibilità hello in genere è hello stessa sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="6acfc-154">It is normally hello same subscription as all hello resources for hello availability group.</span></span> |
   | <span data-ttu-id="6acfc-155">**Gruppo di risorse**</span><span class="sxs-lookup"><span data-stu-id="6acfc-155">**Resource group**</span></span> |<span data-ttu-id="6acfc-156">Selezionare gruppo di risorse hello presenti istanze di SQL Server hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-156">Select hello resource group that hello SQL Server instances are in.</span></span> |
   | <span data-ttu-id="6acfc-157">**Posizione**</span><span class="sxs-lookup"><span data-stu-id="6acfc-157">**Location**</span></span> |<span data-ttu-id="6acfc-158">Selezionare una località di Azure che sono istanze di SQL Server hello in hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-158">Select hello Azure location that hello SQL Server instances are in.</span></span> |

6. <span data-ttu-id="6acfc-159">Fare clic su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-159">Click **Create**.</span></span> 

<span data-ttu-id="6acfc-160">Azure Crea servizio di bilanciamento del carico hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-160">Azure creates hello load balancer.</span></span> <span data-ttu-id="6acfc-161">servizio di bilanciamento del carico Hello appartiene tooa di rete specifica, subnet, gruppo di risorse e percorso.</span><span class="sxs-lookup"><span data-stu-id="6acfc-161">hello load balancer belongs tooa specific network, subnet, resource group, and location.</span></span> <span data-ttu-id="6acfc-162">Al termine dell'attività hello Azure, verificare le impostazioni del servizio di bilanciamento carico di hello in Azure.</span><span class="sxs-lookup"><span data-stu-id="6acfc-162">After Azure completes hello task, verify hello load balancer settings in Azure.</span></span> 

### <a name="step-2-configure-hello-back-end-pool"></a><span data-ttu-id="6acfc-163">Passaggio 2: Configurare i pool di back-end hello</span><span class="sxs-lookup"><span data-stu-id="6acfc-163">Step 2: Configure hello back-end pool</span></span>
<span data-ttu-id="6acfc-164">Le chiamate Azure hello pool di indirizzi back-end *pool back-end*.</span><span class="sxs-lookup"><span data-stu-id="6acfc-164">Azure calls hello back-end address pool *backend pool*.</span></span> <span data-ttu-id="6acfc-165">In questo caso, il pool di back-end hello è indirizzi hello hello due istanze di SQL Server nel gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="6acfc-165">In this case, hello back-end pool is hello addresses of hello two SQL Server instances in your availability group.</span></span> 

1. <span data-ttu-id="6acfc-166">Nel gruppo di risorse, fare clic su servizio di bilanciamento del carico hello creato.</span><span class="sxs-lookup"><span data-stu-id="6acfc-166">In your resource group, click hello load balancer that you created.</span></span> 

2. <span data-ttu-id="6acfc-167">In **Impostazioni** fare clic su **Pool back-end**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-167">On **Settings**, click **Backend pools**.</span></span>

3. <span data-ttu-id="6acfc-168">In **pool back-end**, fare clic su **Aggiungi** toocreate un pool di indirizzi back-end.</span><span class="sxs-lookup"><span data-stu-id="6acfc-168">On **Backend pools**, click **Add** toocreate a back-end address pool.</span></span> 

4. <span data-ttu-id="6acfc-169">In **aggiungere pool back-end**in **nome**, digitare un nome per il pool back-end hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-169">On **Add backend pool**, under **Name**, type a name for hello back-end pool.</span></span>

5. <span data-ttu-id="6acfc-170">In **Macchine virtuali** fare clic su **Aggiungi una macchina virtuale**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-170">Under **Virtual machines**, click **Add a virtual machine**.</span></span> 

6. <span data-ttu-id="6acfc-171">In **scegliere macchine virtuali**, fare clic su **scegliere un set di disponibilità**, quindi specificare set di disponibilità di hello che hello macchine virtuali di SQL Server deve appartenere a.</span><span class="sxs-lookup"><span data-stu-id="6acfc-171">Under **Choose virtual machines**, click **Choose an availability set**, and then specify hello availability set that hello SQL Server virtual machines belong to.</span></span>

7. <span data-ttu-id="6acfc-172">Dopo aver scelto il set di disponibilità di hello, fare clic su **scegliere macchine virtuali hello**, selezionare hello due macchine virtuali che ospitano istanze di SQL Server hello nel gruppo di disponibilità hello e quindi fare clic su **selezionare**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-172">After you have chosen hello availability set, click **Choose hello virtual machines**, select hello two virtual machines that host hello SQL Server instances in hello availability group, and then click **Select**.</span></span> 

8. <span data-ttu-id="6acfc-173">Fare clic su **OK** pannelli hello tooclose per **scegliere macchine virtuali**, e **aggiungere pool back-end**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-173">Click **OK** tooclose hello blades for **Choose virtual machines**, and **Add backend pool**.</span></span> 

<span data-ttu-id="6acfc-174">Azure Aggiorna le impostazioni di hello per il pool di indirizzi back-end di hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-174">Azure updates hello settings for hello back-end address pool.</span></span> <span data-ttu-id="6acfc-175">Il set di disponibilità ora include un pool di due istanze di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="6acfc-175">Now your availability set has a pool of two SQL Server instances.</span></span>

### <a name="step-3-create-a-probe"></a><span data-ttu-id="6acfc-176">Passaggio 3: Creare un probe</span><span class="sxs-lookup"><span data-stu-id="6acfc-176">Step 3: Create a probe</span></span>
<span data-ttu-id="6acfc-177">probe Hello definisce come Azure verifica hello istanze di SQL Server attualmente proprietario del listener del gruppo di disponibilità hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-177">hello probe defines how Azure verifies which of hello SQL Server instances currently owns hello availability group listener.</span></span> <span data-ttu-id="6acfc-178">Azure le ricerche basato sull'indirizzo IP hello su una porta definiti durante la creazione di probe hello del servizio di hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-178">Azure probes hello service based on hello IP address on a port that you define when you create hello probe.</span></span>

1. <span data-ttu-id="6acfc-179">In hello bilanciamento del carico **impostazioni** pannello, fare clic su **probe di integrità**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-179">On hello load balancer **Settings** blade, click **Health probes**.</span></span> 

2. <span data-ttu-id="6acfc-180">In hello **probe di integrità** pannello, fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-180">On hello **Health probes** blade, click **Add**.</span></span>

3. <span data-ttu-id="6acfc-181">Configurare il probe hello in hello **Aggiungi probe** blade.</span><span class="sxs-lookup"><span data-stu-id="6acfc-181">Configure hello probe on hello **Add probe** blade.</span></span> <span data-ttu-id="6acfc-182">Hello utilizzare valori tooconfigure hello probe seguenti:</span><span class="sxs-lookup"><span data-stu-id="6acfc-182">Use hello following values tooconfigure hello probe:</span></span>

   | <span data-ttu-id="6acfc-183">Impostazione</span><span class="sxs-lookup"><span data-stu-id="6acfc-183">Setting</span></span> | <span data-ttu-id="6acfc-184">Valore</span><span class="sxs-lookup"><span data-stu-id="6acfc-184">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="6acfc-185">**Nome**</span><span class="sxs-lookup"><span data-stu-id="6acfc-185">**Name**</span></span> |<span data-ttu-id="6acfc-186">Un nome di testo che rappresenta il probe hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-186">A text name representing hello probe.</span></span> <span data-ttu-id="6acfc-187">Ad esempio **SQLAlwaysOnEndPointProbe**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-187">For example, **SQLAlwaysOnEndPointProbe**.</span></span> |
   | <span data-ttu-id="6acfc-188">**Protocollo**</span><span class="sxs-lookup"><span data-stu-id="6acfc-188">**Protocol**</span></span> |<span data-ttu-id="6acfc-189">**TCP**</span><span class="sxs-lookup"><span data-stu-id="6acfc-189">**TCP**</span></span> |
   | <span data-ttu-id="6acfc-190">**Porta**</span><span class="sxs-lookup"><span data-stu-id="6acfc-190">**Port**</span></span> |<span data-ttu-id="6acfc-191">È possibile usare qualsiasi porta disponibile.</span><span class="sxs-lookup"><span data-stu-id="6acfc-191">You can use any available port.</span></span> <span data-ttu-id="6acfc-192">Ad esempio *59999*.</span><span class="sxs-lookup"><span data-stu-id="6acfc-192">For example, *59999*.</span></span> |
   | <span data-ttu-id="6acfc-193">**Interval**</span><span class="sxs-lookup"><span data-stu-id="6acfc-193">**Interval**</span></span> |<span data-ttu-id="6acfc-194">*5*</span><span class="sxs-lookup"><span data-stu-id="6acfc-194">*5*</span></span> |
   | <span data-ttu-id="6acfc-195">**Soglia non integra**</span><span class="sxs-lookup"><span data-stu-id="6acfc-195">**Unhealthy threshold**</span></span> |<span data-ttu-id="6acfc-196">*2*</span><span class="sxs-lookup"><span data-stu-id="6acfc-196">*2*</span></span> |

4.  <span data-ttu-id="6acfc-197">Fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-197">Click **OK**.</span></span> 

> [!NOTE]
> <span data-ttu-id="6acfc-198">Assicurarsi che porta hello specificata sia aperta nel firewall hello di entrambe le istanze di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="6acfc-198">Make sure that hello port you specify is open on hello firewall of both SQL Server instances.</span></span> <span data-ttu-id="6acfc-199">Entrambe le istanze richiedono una regola in ingresso per hello la porta TCP in uso.</span><span class="sxs-lookup"><span data-stu-id="6acfc-199">Both instances require an inbound rule for hello TCP port that you use.</span></span> <span data-ttu-id="6acfc-200">Per altre informazioni, vedere [Aggiungere o modificare una regola del firewall](http://technet.microsoft.com/library/cc753558.aspx).</span><span class="sxs-lookup"><span data-stu-id="6acfc-200">For more information, see [Add or Edit Firewall Rule](http://technet.microsoft.com/library/cc753558.aspx).</span></span> 
> 
> 

<span data-ttu-id="6acfc-201">Azure crea probe hello e viene utilizzata l'istanza di SQL Server ha listener hello per il gruppo di disponibilità hello tootest.</span><span class="sxs-lookup"><span data-stu-id="6acfc-201">Azure creates hello probe and then uses it tootest which SQL Server instance has hello listener for hello availability group.</span></span>

### <a name="step-4-set-hello-load-balancing-rules"></a><span data-ttu-id="6acfc-202">Passaggio 4: Impostare le regole di bilanciamento del carico di hello</span><span class="sxs-lookup"><span data-stu-id="6acfc-202">Step 4: Set hello load balancing rules</span></span>
<span data-ttu-id="6acfc-203">regole di bilanciamento del carico Hello configurare come servizio di bilanciamento del carico hello instrada le istanze di SQL Server toohello di traffico.</span><span class="sxs-lookup"><span data-stu-id="6acfc-203">hello load balancing rules configure how hello load balancer routes traffic toohello SQL Server instances.</span></span> <span data-ttu-id="6acfc-204">Per il bilanciamento del carico, abilitare direct server return perché solo uno di due istanze di SQL Server hello proprietario risorsa listener del gruppo di disponibilità hello alla volta.</span><span class="sxs-lookup"><span data-stu-id="6acfc-204">For this load balancer, you enable direct server return because only one of hello two SQL Server instances owns hello availability group listener resource at a time.</span></span>

1. <span data-ttu-id="6acfc-205">In hello bilanciamento del carico **impostazioni** pannello, fare clic su **regole di bilanciamento del carico**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-205">On hello load balancer **Settings** blade, click **Load balancing rules**.</span></span> 

2. <span data-ttu-id="6acfc-206">In hello **regole di bilanciamento del carico** pannello, fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-206">On hello **Load balancing rules** blade, click **Add**.</span></span>

3. <span data-ttu-id="6acfc-207">In hello **regole di bilanciamento del carico di Aggiungi** pannello, configurare una regola di bilanciamento del carico di hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-207">On hello **Add load balancing rules** blade, configure hello load balancing rule.</span></span> <span data-ttu-id="6acfc-208">Utilizzare hello seguenti impostazioni:</span><span class="sxs-lookup"><span data-stu-id="6acfc-208">Use hello following settings:</span></span> 

   | <span data-ttu-id="6acfc-209">Impostazione</span><span class="sxs-lookup"><span data-stu-id="6acfc-209">Setting</span></span> | <span data-ttu-id="6acfc-210">Valore</span><span class="sxs-lookup"><span data-stu-id="6acfc-210">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="6acfc-211">**Nome**</span><span class="sxs-lookup"><span data-stu-id="6acfc-211">**Name**</span></span> |<span data-ttu-id="6acfc-212">Un nome di testo che rappresenta le regole di bilanciamento del carico di hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-212">A text name representing hello load balancing rules.</span></span> <span data-ttu-id="6acfc-213">Ad esempio **SQLAlwaysOnEndPointListener**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-213">For example, **SQLAlwaysOnEndPointListener**.</span></span> |
   | <span data-ttu-id="6acfc-214">**Protocollo**</span><span class="sxs-lookup"><span data-stu-id="6acfc-214">**Protocol**</span></span> |<span data-ttu-id="6acfc-215">**TCP**</span><span class="sxs-lookup"><span data-stu-id="6acfc-215">**TCP**</span></span> |
   | <span data-ttu-id="6acfc-216">**Porta**</span><span class="sxs-lookup"><span data-stu-id="6acfc-216">**Port**</span></span> |<span data-ttu-id="6acfc-217">*1433*</span><span class="sxs-lookup"><span data-stu-id="6acfc-217">*1433*</span></span> |
   | <span data-ttu-id="6acfc-218">**Porta back-end**</span><span class="sxs-lookup"><span data-stu-id="6acfc-218">**Backend Port**</span></span> |<span data-ttu-id="6acfc-219">*1433*. Questo valore verrà ignorato perché questa regola usa **IP mobile (Direct Server Return)**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-219">*1433*. This value is ignored because this rule uses **Floating IP (direct server return)**.</span></span> |
   | <span data-ttu-id="6acfc-220">**Probe**</span><span class="sxs-lookup"><span data-stu-id="6acfc-220">**Probe**</span></span> |<span data-ttu-id="6acfc-221">Utilizzare il nome di hello del probe hello creato per il bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="6acfc-221">Use hello name of hello probe that you created for this load balancer.</span></span> |
   | <span data-ttu-id="6acfc-222">**Persistenza della sessione**</span><span class="sxs-lookup"><span data-stu-id="6acfc-222">**Session persistence**</span></span> |<span data-ttu-id="6acfc-223">**Nessuno**</span><span class="sxs-lookup"><span data-stu-id="6acfc-223">**None**</span></span> |
   | <span data-ttu-id="6acfc-224">**Timeout di inattività (minuti)**</span><span class="sxs-lookup"><span data-stu-id="6acfc-224">**Idle timeout (minutes)**</span></span> |<span data-ttu-id="6acfc-225">*4*</span><span class="sxs-lookup"><span data-stu-id="6acfc-225">*4*</span></span> |
   | <span data-ttu-id="6acfc-226">**IP mobile (Direct Server Return)**</span><span class="sxs-lookup"><span data-stu-id="6acfc-226">**Floating IP (direct server return)**</span></span> |<span data-ttu-id="6acfc-227">**Enabled**</span><span class="sxs-lookup"><span data-stu-id="6acfc-227">**Enabled**</span></span> |

   > [!NOTE]
   > <span data-ttu-id="6acfc-228">Potrebbe essere tooscroll verso il basso hello pannello tooview tutte le impostazioni di hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-228">You might have tooscroll down hello blade tooview all hello settings.</span></span>
   > 

4. <span data-ttu-id="6acfc-229">Fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-229">Click **OK**.</span></span> 
5. <span data-ttu-id="6acfc-230">Azure Configura regola di bilanciamento del carico di hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-230">Azure configures hello load balancing rule.</span></span> <span data-ttu-id="6acfc-231">Bilanciamento del carico hello è ora configurato tooroute traffico toohello istanza di SQL Server ospita hello listener per gruppo di disponibilità hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-231">Now hello load balancer is configured tooroute traffic toohello SQL Server instance that hosts hello listener for hello availability group.</span></span> 

<span data-ttu-id="6acfc-232">A questo punto, il gruppo di risorse hello dispone di un bilanciamento del carico che si connette tooboth macchine di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="6acfc-232">At this point, hello resource group has a load balancer that connects tooboth SQL Server machines.</span></span> <span data-ttu-id="6acfc-233">servizio di bilanciamento del carico Hello contiene anche un indirizzo IP per hello SQL Server Always On listener gruppo di disponibilità, in modo che entrambi i computer possano rispondere toorequests per gruppi di disponibilità hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-233">hello load balancer also contains an IP address for hello SQL Server Always On availability group listener, so that either machine can respond toorequests for hello availability groups.</span></span>

> [!NOTE]
> <span data-ttu-id="6acfc-234">Se le istanze di SQL Server sono in due aree distinte, ripetere i passaggi di hello in hello altre aree.</span><span class="sxs-lookup"><span data-stu-id="6acfc-234">If your SQL Server instances are in two separate regions, repeat hello steps in hello other region.</span></span> <span data-ttu-id="6acfc-235">Ogni area richiede un servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="6acfc-235">Each region requires a load balancer.</span></span> 
> 
> 

## <a name="configure-hello-cluster-toouse-hello-load-balancer-ip-address"></a><span data-ttu-id="6acfc-236">Configurare hello toouse hello carico bilanciamento del carico indirizzo IP del cluster</span><span class="sxs-lookup"><span data-stu-id="6acfc-236">Configure hello cluster toouse hello load balancer IP address</span></span>
<span data-ttu-id="6acfc-237">passaggio successivo Hello tooconfigure hello listener in cluster hello e portare hello listener online.</span><span class="sxs-lookup"><span data-stu-id="6acfc-237">hello next step is tooconfigure hello listener on hello cluster, and bring hello listener online.</span></span> <span data-ttu-id="6acfc-238">Hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="6acfc-238">Do hello following:</span></span> 

1. <span data-ttu-id="6acfc-239">Creare listener del gruppo di disponibilità hello nel cluster di failover hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-239">Create hello availability group listener on hello failover cluster.</span></span> 

2. <span data-ttu-id="6acfc-240">Portare hello listener online.</span><span class="sxs-lookup"><span data-stu-id="6acfc-240">Bring hello listener online.</span></span>

### <a name="step-5-create-hello-availability-group-listener-on-hello-failover-cluster"></a><span data-ttu-id="6acfc-241">Passaggio 5: Creare listener del gruppo di disponibilità hello nel cluster di failover hello</span><span class="sxs-lookup"><span data-stu-id="6acfc-241">Step 5: Create hello availability group listener on hello failover cluster</span></span>
<span data-ttu-id="6acfc-242">In questo passaggio, creare manualmente listener del gruppo di disponibilità di hello in Gestione Cluster di Failover e SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="6acfc-242">In this step, you manually create hello availability group listener in Failover Cluster Manager and SQL Server Management Studio.</span></span>

[!INCLUDE [ag-listener-configure](../../../../includes/virtual-machines-ag-listener-configure.md)]

### <a name="verify-hello-configuration-of-hello-listener"></a><span data-ttu-id="6acfc-243">Verificare la configurazione del listener hello hello</span><span class="sxs-lookup"><span data-stu-id="6acfc-243">Verify hello configuration of hello listener</span></span>

<span data-ttu-id="6acfc-244">Se le dipendenze e le risorse cluster hello siano configurate correttamente, dovrebbe essere in grado di tooview listener di hello in SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="6acfc-244">If hello cluster resources and dependencies are correctly configured, you should be able tooview hello listener in SQL Server Management Studio.</span></span> <span data-ttu-id="6acfc-245">tooset hello porta del listener, hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="6acfc-245">tooset hello listener port, do hello following:</span></span>

1. <span data-ttu-id="6acfc-246">Avviare SQL Server Management Studio e connettiti toohello replica primaria.</span><span class="sxs-lookup"><span data-stu-id="6acfc-246">Start SQL Server Management Studio, and then connect toohello primary replica.</span></span>

2. <span data-ttu-id="6acfc-247">Andare troppo**disponibilità elevata AlwaysOn** > **gruppi di disponibilità** > **listener del gruppo di disponibilità**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-247">Go too**AlwaysOn High Availability** > **Availability Groups** > **Availability Group Listeners**.</span></span>  
    <span data-ttu-id="6acfc-248">Viene visualizzato il nome del listener hello creati in Gestione Cluster di Failover.</span><span class="sxs-lookup"><span data-stu-id="6acfc-248">You should now see hello listener name that you created in Failover Cluster Manager.</span></span> 

3. <span data-ttu-id="6acfc-249">Il nome del listener hello destro e quindi fare clic su **proprietà**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-249">Right-click hello listener name, and then click **Properties**.</span></span>

4. <span data-ttu-id="6acfc-250">In hello **porta** , specificare il numero di porta hello del listener del gruppo di disponibilità hello utilizzando hello $EndpointPort utilizzato in precedenza (1433 è predefinito hello), quindi fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-250">In hello **Port** box, specify hello port number for hello availability group listener by using hello $EndpointPort you used earlier (1433 was hello default), and then click **OK**.</span></span>

<span data-ttu-id="6acfc-251">Ora si ha un gruppo di disponibilità nelle macchine virtuali di Azure in esecuzione in modalità Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="6acfc-251">You now have an availability group in Azure virtual machines running in Resource Manager mode.</span></span> 

## <a name="test-hello-connection-toohello-listener"></a><span data-ttu-id="6acfc-252">Listener toohello connessione hello di test</span><span class="sxs-lookup"><span data-stu-id="6acfc-252">Test hello connection toohello listener</span></span>
<span data-ttu-id="6acfc-253">Test connessione hello eseguendo hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="6acfc-253">Test hello connection by doing hello following:</span></span>

1. <span data-ttu-id="6acfc-254">Istanza di SQL Server tooa RDP in hello stesso virtuale di rete, ma non non replica hello personalizzati.</span><span class="sxs-lookup"><span data-stu-id="6acfc-254">RDP tooa SQL Server instance that is in hello same virtual network, but does not own hello replica.</span></span> <span data-ttu-id="6acfc-255">Questo server può essere hello altra istanza SQL Server in cluster hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-255">This server can be hello other SQL Server instance in hello cluster.</span></span>

2. <span data-ttu-id="6acfc-256">Utilizzare **sqlcmd** connessione hello tootest di utilità.</span><span class="sxs-lookup"><span data-stu-id="6acfc-256">Use **sqlcmd** utility tootest hello connection.</span></span> <span data-ttu-id="6acfc-257">Ad esempio, lo script seguente hello stabilisce un **sqlcmd** replica primaria toohello di connessione tramite il listener hello con l'autenticazione di Windows:</span><span class="sxs-lookup"><span data-stu-id="6acfc-257">For example, hello following script establishes a **sqlcmd** connection toohello primary replica through hello listener with Windows authentication:</span></span>
   
        sqlcmd -S <listenerName> -E

<span data-ttu-id="6acfc-258">connessione SQLCMD Hello si connette automaticamente toohello istanza di SQL Server che ospita la replica primaria hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-258">hello SQLCMD connection automatically connects toohello SQL Server instance that hosts hello primary replica.</span></span> 

## <a name="create-an-ip-address-for-an-additional-availability-group"></a><span data-ttu-id="6acfc-259">Creare un indirizzo IP per un gruppo di disponibilità aggiuntivo</span><span class="sxs-lookup"><span data-stu-id="6acfc-259">Create an IP address for an additional availability group</span></span>

<span data-ttu-id="6acfc-260">Ogni gruppo di disponibilità usa un listener diverso.</span><span class="sxs-lookup"><span data-stu-id="6acfc-260">Each availability group uses a separate listener.</span></span> <span data-ttu-id="6acfc-261">Ogni listener ha un proprio indirizzo IP.</span><span class="sxs-lookup"><span data-stu-id="6acfc-261">Each listener has its own IP address.</span></span> <span data-ttu-id="6acfc-262">Utilizzare hello stesso carica l'indirizzo IP di bilanciamento del carico toohold hello per listener aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="6acfc-262">Use hello same load balancer toohold hello IP address for additional listeners.</span></span> <span data-ttu-id="6acfc-263">Dopo aver creato un gruppo di disponibilità, aggiungere toohello hello IP indirizzo il bilanciamento del carico e quindi configurare il listener hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-263">After you create an availability group, add hello IP address toohello load balancer, and then configure hello listener.</span></span>

<span data-ttu-id="6acfc-264">tooadd un bilanciamento del carico IP indirizzo tooa con il portale di Azure, hello hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="6acfc-264">tooadd an IP address tooa load balancer with hello Azure portal, do hello following:</span></span>

1. <span data-ttu-id="6acfc-265">Nel portale di Azure hello, aprire gruppo di risorse hello contenente bilanciamento del carico hello e quindi fare clic su servizio di bilanciamento del carico hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-265">In hello Azure portal, open hello resource group that contains hello load balancer, and then click hello load balancer.</span></span> 

2. <span data-ttu-id="6acfc-266">In **IMPOSTAZIONI** fare clic su **Pool di indirizzi IP front-end** e quindi su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-266">Under **SETTINGS**, click **Frontend IP pool**, and then click **Add**.</span></span> 

3. <span data-ttu-id="6acfc-267">In **Aggiungi indirizzo IP di front-end**, assegnare un nome front-end hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-267">Under **Add frontend IP address**, assign a name for hello front end.</span></span> 

4. <span data-ttu-id="6acfc-268">Verificare che hello **rete virtuale** hello e **Subnet** sono hello stesso hello istanze di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="6acfc-268">Verify that hello **Virtual network** and hello **Subnet** are hello same as hello SQL Server instances.</span></span>

5. <span data-ttu-id="6acfc-269">Impostare l'indirizzo IP hello per listener hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-269">Set hello IP address for hello listener.</span></span> 
   
   >[!TIP]
   ><span data-ttu-id="6acfc-270">È possibile impostare toostatic indirizzo IP di hello e digitare un indirizzo che non è attualmente usato nella subnet hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-270">You can set hello IP address toostatic and type an address that is not currently used in hello subnet.</span></span> <span data-ttu-id="6acfc-271">In alternativa, è possibile impostare toodynamic indirizzo IP di hello e salvare il pool IP di hello nuovo front-end.</span><span class="sxs-lookup"><span data-stu-id="6acfc-271">Alternatively, you can set hello IP address toodynamic and save hello new front-end IP pool.</span></span> <span data-ttu-id="6acfc-272">Quando si esegue questa operazione, hello portale di Azure assegna automaticamente un pool di toohello di indirizzi IP disponibile.</span><span class="sxs-lookup"><span data-stu-id="6acfc-272">When you do so, hello Azure portal automatically assigns an available IP address toohello pool.</span></span> <span data-ttu-id="6acfc-273">È quindi possibile riaprire il pool IP front-end di hello e modificare toostatic assegnazione hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-273">You can then reopen hello front-end IP pool and change hello assignment toostatic.</span></span> 

6. <span data-ttu-id="6acfc-274">Salva l'indirizzo IP hello per listener hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-274">Save hello IP address for hello listener.</span></span> 

7. <span data-ttu-id="6acfc-275">Aggiungere un probe di integrità tramite hello seguenti impostazioni:</span><span class="sxs-lookup"><span data-stu-id="6acfc-275">Add a health probe by using hello following settings:</span></span>

   |<span data-ttu-id="6acfc-276">Impostazione</span><span class="sxs-lookup"><span data-stu-id="6acfc-276">Setting</span></span> |<span data-ttu-id="6acfc-277">Valore</span><span class="sxs-lookup"><span data-stu-id="6acfc-277">Value</span></span>
   |:-----|:----
   |<span data-ttu-id="6acfc-278">**Nome**</span><span class="sxs-lookup"><span data-stu-id="6acfc-278">**Name**</span></span> |<span data-ttu-id="6acfc-279">Probe di hello tooidentify un nome.</span><span class="sxs-lookup"><span data-stu-id="6acfc-279">A name tooidentify hello probe.</span></span>
   |<span data-ttu-id="6acfc-280">**Protocollo**</span><span class="sxs-lookup"><span data-stu-id="6acfc-280">**Protocol**</span></span> |<span data-ttu-id="6acfc-281">TCP</span><span class="sxs-lookup"><span data-stu-id="6acfc-281">TCP</span></span>
   |<span data-ttu-id="6acfc-282">**Porta**</span><span class="sxs-lookup"><span data-stu-id="6acfc-282">**Port**</span></span> |<span data-ttu-id="6acfc-283">Una porta TCP non usata che deve essere disponibile in tutte le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="6acfc-283">An unused TCP port, which must be available on all virtual machines.</span></span> <span data-ttu-id="6acfc-284">Non può essere usata per altri scopi.</span><span class="sxs-lookup"><span data-stu-id="6acfc-284">It cannot be used for any other purpose.</span></span> <span data-ttu-id="6acfc-285">Nessun due listener può utilizzare hello stessa porta probe.</span><span class="sxs-lookup"><span data-stu-id="6acfc-285">No two listeners can use hello same probe port.</span></span> 
   |<span data-ttu-id="6acfc-286">**Interval**</span><span class="sxs-lookup"><span data-stu-id="6acfc-286">**Interval**</span></span> |<span data-ttu-id="6acfc-287">tenta di Hello periodo di tempo tra probe.</span><span class="sxs-lookup"><span data-stu-id="6acfc-287">hello amount of time between probe attempts.</span></span> <span data-ttu-id="6acfc-288">Usare hello predefinito (5).</span><span class="sxs-lookup"><span data-stu-id="6acfc-288">Use hello default (5).</span></span>
   |<span data-ttu-id="6acfc-289">**Soglia non integra**</span><span class="sxs-lookup"><span data-stu-id="6acfc-289">**Unhealthy threshold**</span></span> |<span data-ttu-id="6acfc-290">numero di Hello delle soglie consecutive che devono verificarsi prima di una macchina virtuale viene considerata non integra.</span><span class="sxs-lookup"><span data-stu-id="6acfc-290">hello number of consecutive thresholds that should fail before a virtual machine is considered unhealthy.</span></span>

8. <span data-ttu-id="6acfc-291">Fare clic su **OK** probe hello toosave.</span><span class="sxs-lookup"><span data-stu-id="6acfc-291">Click **OK** toosave hello probe.</span></span> 

9. <span data-ttu-id="6acfc-292">Creare una regola di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="6acfc-292">Create a load balancing rule.</span></span> <span data-ttu-id="6acfc-293">Fare clic su **Regole di bilanciamento del carico** e quindi fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-293">Click **Load balancing rules**, and then click **Add**.</span></span>

10. <span data-ttu-id="6acfc-294">Configurare hello nuovo bilanciamento del carico regola utilizzando hello seguenti impostazioni:</span><span class="sxs-lookup"><span data-stu-id="6acfc-294">Configure hello new load balancing rule by using hello following settings:</span></span>

   |<span data-ttu-id="6acfc-295">Impostazione</span><span class="sxs-lookup"><span data-stu-id="6acfc-295">Setting</span></span> |<span data-ttu-id="6acfc-296">Valore</span><span class="sxs-lookup"><span data-stu-id="6acfc-296">Value</span></span>
   |:-----|:----
   |<span data-ttu-id="6acfc-297">**Nome**</span><span class="sxs-lookup"><span data-stu-id="6acfc-297">**Name**</span></span> |<span data-ttu-id="6acfc-298">Un hello tooidentify nome caricare la regola di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="6acfc-298">A name tooidentify hello load balancing rule.</span></span> 
   |<span data-ttu-id="6acfc-299">**Indirizzo IP front-end IP**</span><span class="sxs-lookup"><span data-stu-id="6acfc-299">**Frontend IP address**</span></span> |<span data-ttu-id="6acfc-300">Selezionare l'indirizzo IP hello che è stato creato.</span><span class="sxs-lookup"><span data-stu-id="6acfc-300">Select hello IP address you created.</span></span> 
   |<span data-ttu-id="6acfc-301">**Protocollo**</span><span class="sxs-lookup"><span data-stu-id="6acfc-301">**Protocol**</span></span> |<span data-ttu-id="6acfc-302">TCP</span><span class="sxs-lookup"><span data-stu-id="6acfc-302">TCP</span></span>
   |<span data-ttu-id="6acfc-303">**Porta**</span><span class="sxs-lookup"><span data-stu-id="6acfc-303">**Port**</span></span> |<span data-ttu-id="6acfc-304">Utilizzare hello porta che utilizzano le istanze di SQL Server hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-304">Use hello port that hello SQL Server instances are using.</span></span> <span data-ttu-id="6acfc-305">Un'istanza predefinita utilizza la porta 1433, a meno che non venga modificata.</span><span class="sxs-lookup"><span data-stu-id="6acfc-305">A default instance uses port 1433, unless you changed it.</span></span> 
   |<span data-ttu-id="6acfc-306">**Porta back-end**</span><span class="sxs-lookup"><span data-stu-id="6acfc-306">**Backend port**</span></span> |<span data-ttu-id="6acfc-307">Hello utilizzare lo stesso valore **porta**.</span><span class="sxs-lookup"><span data-stu-id="6acfc-307">Use hello same value as **Port**.</span></span>
   |<span data-ttu-id="6acfc-308">**Pool back-end**</span><span class="sxs-lookup"><span data-stu-id="6acfc-308">**Backend pool**</span></span> |<span data-ttu-id="6acfc-309">pool di Hello contenente macchine virtuali hello con istanze di SQL Server hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-309">hello pool that contains hello virtual machines with hello SQL Server instances.</span></span> 
   |<span data-ttu-id="6acfc-310">**Probe di integrità**</span><span class="sxs-lookup"><span data-stu-id="6acfc-310">**Health probe**</span></span> |<span data-ttu-id="6acfc-311">Scegliere probe hello che è stato creato.</span><span class="sxs-lookup"><span data-stu-id="6acfc-311">Choose hello probe you created.</span></span>
   |<span data-ttu-id="6acfc-312">**Persistenza della sessione**</span><span class="sxs-lookup"><span data-stu-id="6acfc-312">**Session persistence**</span></span> |<span data-ttu-id="6acfc-313">Nessuno</span><span class="sxs-lookup"><span data-stu-id="6acfc-313">None</span></span>
   |<span data-ttu-id="6acfc-314">**Timeout di inattività (minuti)**</span><span class="sxs-lookup"><span data-stu-id="6acfc-314">**Idle timeout (minutes)**</span></span> |<span data-ttu-id="6acfc-315">Valore predefinito (4)</span><span class="sxs-lookup"><span data-stu-id="6acfc-315">Default (4)</span></span>
   |<span data-ttu-id="6acfc-316">**IP mobile (Direct Server Return)**</span><span class="sxs-lookup"><span data-stu-id="6acfc-316">**Floating IP (direct server return)**</span></span> | <span data-ttu-id="6acfc-317">Enabled</span><span class="sxs-lookup"><span data-stu-id="6acfc-317">Enabled</span></span>

### <a name="configure-hello-availability-group-toouse-hello-new-ip-address"></a><span data-ttu-id="6acfc-318">Configurare hello disponibilità gruppo toouse hello nuovo indirizzo IP</span><span class="sxs-lookup"><span data-stu-id="6acfc-318">Configure hello availability group toouse hello new IP address</span></span>

<span data-ttu-id="6acfc-319">toofinish configurazione cluster hello, passaggi ripetizione hello eseguiti dopo il primo gruppo di disponibilità hello effettuato.</span><span class="sxs-lookup"><span data-stu-id="6acfc-319">toofinish configuring hello cluster, repeat hello steps that you followed when you made hello first availability group.</span></span> <span data-ttu-id="6acfc-320">Vale a dire, configurare hello [toouse hello nuovo indirizzo IP del cluster](#configure-the-cluster-to-use-the-load-balancer-ip-address).</span><span class="sxs-lookup"><span data-stu-id="6acfc-320">That is, configure hello [cluster toouse hello new IP address](#configure-the-cluster-to-use-the-load-balancer-ip-address).</span></span> 

<span data-ttu-id="6acfc-321">Dopo aver aggiunto un indirizzo IP del listener hello, configurare il gruppo di disponibilità aggiuntiva hello eseguendo hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="6acfc-321">After you have added an IP address for hello listener, configure hello additional availability group by doing hello following:</span></span> 

1. <span data-ttu-id="6acfc-322">Verificare che la porta probe hello nuovo indirizzo IP di hello è aperta in entrambe le macchine virtuali di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="6acfc-322">Verify that hello probe port for hello new IP address is open on both SQL Server virtual machines.</span></span> 

2. <span data-ttu-id="6acfc-323">[In Gestione Cluster di aggiungere il punto di accesso client hello](#addcap).</span><span class="sxs-lookup"><span data-stu-id="6acfc-323">[In Cluster Manager, add hello client access point](#addcap).</span></span>

3. <span data-ttu-id="6acfc-324">[Configurare la risorsa IP hello per il gruppo di disponibilità hello](#congroup).</span><span class="sxs-lookup"><span data-stu-id="6acfc-324">[Configure hello IP resource for hello availability group](#congroup).</span></span>

   >[!IMPORTANT]
   ><span data-ttu-id="6acfc-325">Quando si crea l'indirizzo IP di hello, utilizzare l'indirizzo IP hello aggiunto toohello servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="6acfc-325">When you create hello IP address, use hello IP address that you added toohello load balancer.</span></span>  

4. <span data-ttu-id="6acfc-326">[Rendere dipendente nel punto di accesso client hello risorsa gruppo di disponibilità SQL Server hello](#dependencyGroup).</span><span class="sxs-lookup"><span data-stu-id="6acfc-326">[Make hello SQL Server availability group resource dependent on hello client access point](#dependencyGroup).</span></span>

5. <span data-ttu-id="6acfc-327">[Rendere l'accesso ai client di hello punto risorsa dipendente dalla risorsa indirizzo IP hello](#listname).</span><span class="sxs-lookup"><span data-stu-id="6acfc-327">[Make hello client access point resource dependent on hello IP address](#listname).</span></span>
 
6. <span data-ttu-id="6acfc-328">[Impostare i parametri del cluster hello in PowerShell](#setparam).</span><span class="sxs-lookup"><span data-stu-id="6acfc-328">[Set hello cluster parameters in PowerShell](#setparam).</span></span>

<span data-ttu-id="6acfc-329">Dopo aver configurato hello disponibilità gruppo toouse hello nuovo indirizzo IP, configurare toohello listener della connessione hello.</span><span class="sxs-lookup"><span data-stu-id="6acfc-329">After you configure hello availability group toouse hello new IP address, configure hello connection toohello listener.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="6acfc-330">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="6acfc-330">Next steps</span></span>

- [<span data-ttu-id="6acfc-331">Configurare un gruppo di disponibilità SQL Server AlwaysOn nelle macchine virtuali di Azure</span><span class="sxs-lookup"><span data-stu-id="6acfc-331">Configure a SQL Server Always On availability group on Azure virtual machines in different regions</span></span>](virtual-machines-windows-portal-sql-availability-group-dr.md)
