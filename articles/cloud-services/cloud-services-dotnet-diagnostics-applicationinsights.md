---
title: Risolvere i problemi di Servizi cloud con Application Insights | Documentazione Microsoft
description: Informazioni su come risolvere i problemi relativi al servizio cloud mediante Application Insights per elaborare i dati del servizio Diagnostica di Azure.
services: cloud-services
documentationcenter: .net
author: sbtron
manager: timlt
editor: tysonn
ms.assetid: e93f387b-ef29-4731-ae41-0676722accb6
ms.service: cloud-services
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/23/2017
ms.author: saurabh
ms.openlocfilehash: 4001ca908ff00b1a40829d687589080e9b07b18a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshoot-cloud-services-using-application-insights"></a><span data-ttu-id="96cf3-103">Risoluzione dei problemi di Servizi Cloud tramite Application Insights</span><span class="sxs-lookup"><span data-stu-id="96cf3-103">Troubleshoot Cloud Services using Application Insights</span></span>
<span data-ttu-id="96cf3-104">Con [Azure SDK 2.8](https://azure.microsoft.com/downloads/) e l'estensione Diagnostica di Azure 1.5 è possibile inviare i dati del servizio Diagnostica di Azure per il servizio cloud direttamente ad Application Insights.</span><span class="sxs-lookup"><span data-stu-id="96cf3-104">With [Azure SDK 2.8](https://azure.microsoft.com/downloads/) and Azure diagnostics extension 1.5, you can send Azure Diagnostics data for your Cloud Service directly to Application Insights.</span></span> <span data-ttu-id="96cf3-105">I log raccolti da Diagnostica di Azure, tra cui log applicazioni, registri eventi di Windows, log ETW e contatori delle prestazioni possono essere inviati ad Application Insights.</span><span class="sxs-lookup"><span data-stu-id="96cf3-105">The logs collected by Azure Diagnostics&mdash;including application logs, Windows Event Logs, ETW Logs, and performance counters&mdash;can be sent to Application Insights.</span></span> <span data-ttu-id="96cf3-106">È quindi possibile visualizzare queste informazioni nell'interfaccia utente del portale Application Insights.</span><span class="sxs-lookup"><span data-stu-id="96cf3-106">You can then visualize this information in the Application Insights portal UI.</span></span> <span data-ttu-id="96cf3-107">Si può poi usare Application Insights SDK per ottenere informazioni dettagliate sulle metriche e i log provenienti dall'applicazione, nonché sui dati del livello di sistema e dell'infrastruttura provenienti da Diagnostica di Azure.</span><span class="sxs-lookup"><span data-stu-id="96cf3-107">You can then use the Application Insights SDK to get insights into metrics and logs that come from your application, as well as the system and infrastructure-level data that comes from Azure Diagnostics.</span></span>

## <a name="configure-azure-diagnostics-to-send-data-to-application-insights"></a><span data-ttu-id="96cf3-108">Configurare Diagnostica di Azure per inviare dati ad Application Insights</span><span class="sxs-lookup"><span data-stu-id="96cf3-108">Configure Azure Diagnostics to send data to Application Insights</span></span>
<span data-ttu-id="96cf3-109">Seguire questi passaggi per configurare il progetto del servizio cloud per l'invio di dati del servizio Diagnostica di Azure ad Application Insights.</span><span class="sxs-lookup"><span data-stu-id="96cf3-109">Follow these steps to set up your cloud service project to send Azure Diagnostics data to Application Insights.</span></span>

1. <span data-ttu-id="96cf3-110">In Esplora soluzioni di Visual Studio fare clic con il pulsante destro del mouse su un ruolo e scegliere **Proprietà** per aprire la finestra di progettazione dei ruoli.</span><span class="sxs-lookup"><span data-stu-id="96cf3-110">In Visual Studio Solution Explorer, right-click a role and select **Properties** to open the Role designer.</span></span>

    ![Proprietà del ruolo di Esplora soluzioni][1]

2. <span data-ttu-id="96cf3-112">Nella sezione **Diagnostica** della finestra di progettazione dei ruoli selezionare l'opzione **Invia i dati di diagnostica ad Application Insights**.</span><span class="sxs-lookup"><span data-stu-id="96cf3-112">In the **Diagnostics** section of the Role designer, select the **Send diagnostics data to Application Insights** option.</span></span>

    ![La finestra di progettazione dei ruoli invia dati di diagnostica ad Application Insights][2]

3. <span data-ttu-id="96cf3-114">Nella finestra di dialogo visualizzata selezionare la risorsa di Application Insights a cui si vogliono inviare i dati del servizio Diagnostica di Azure.</span><span class="sxs-lookup"><span data-stu-id="96cf3-114">In the dialog box that pops up, select the Application Insights resource that you want to send the Azure diagnostics data to.</span></span> <span data-ttu-id="96cf3-115">La finestra di dialogo consente di selezionare una risorsa di Application Insights esistente dalla sottoscrizione o di specificare manualmente una chiave di strumentazione per una risorsa di Application Insights.</span><span class="sxs-lookup"><span data-stu-id="96cf3-115">The dialog box allows you to select an existing Application Insights resource from your subscription or to manually specify an instrumentation key for an Application Insights resource.</span></span> <span data-ttu-id="96cf3-116">Per altre informazioni sulla creazione di una risorsa di Application Insights, vedere [Creare una nuova risorsa di Application Insights](../application-insights/app-insights-create-new-resource.md).</span><span class="sxs-lookup"><span data-stu-id="96cf3-116">For more information on creating an Application Insights resource, see [Create a new Application Insights resource](../application-insights/app-insights-create-new-resource.md).</span></span>

    ![selezionare una risorsa di Application Insights][3]

    <span data-ttu-id="96cf3-118">Dopo aver aggiunto la risorsa di Application Insights, la chiave di strumentazione per la risorsa viene archiviata come impostazione di configurazione del servizio con il nome **APPINSIGHTS_INSTRUMENTATIONKEY**.</span><span class="sxs-lookup"><span data-stu-id="96cf3-118">Once you have added the Application Insights resource, the instrumentation key for that resource is stored as a service configuration setting with the name **APPINSIGHTS_INSTRUMENTATIONKEY**.</span></span> <span data-ttu-id="96cf3-119">È possibile modificare questa impostazione di configurazione per ogni configurazione del servizio o ambiente.</span><span class="sxs-lookup"><span data-stu-id="96cf3-119">You can change this configuration setting for each service configuration or environment.</span></span> <span data-ttu-id="96cf3-120">A tale scopo, selezionare una configurazione diversa nell'elenco **Configurazione servizio** e specificare una nuova chiave di strumentazione per la configurazione.</span><span class="sxs-lookup"><span data-stu-id="96cf3-120">To do so, select a different configuration from the **Service Configuration** list and specify a new instrumentation key for that configuration.</span></span>

    ![selezionare una configurazione del servizio][4]

    <span data-ttu-id="96cf3-122">L'impostazione di configurazione **APPINSIGHTS_INSTRUMENTATIONKEY** viene usata da Visual Studio per configurare l'estensione di diagnostica con le informazioni appropriate sulle risorse di Application Insights durante la pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="96cf3-122">The **APPINSIGHTS_INSTRUMENTATIONKEY** configuration setting is used by Visual Studio to configure the diagnostics extension with the appropriate Application Insights resource information during publishing.</span></span> <span data-ttu-id="96cf3-123">L'impostazione di configurazione è un modo pratico per definire chiavi di strumentazione diverse per configurazioni del servizio diverse.</span><span class="sxs-lookup"><span data-stu-id="96cf3-123">The configuration setting is a convenient way of defining different instrumentation keys for different service configurations.</span></span> <span data-ttu-id="96cf3-124">Visual Studio converte tale impostazione e la inserisce nella configurazione pubblica dell'estensione di diagnostica durante il processo di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="96cf3-124">Visual Studio will translate that setting and insert it into the diagnostics extension public configuration during the publish process.</span></span> <span data-ttu-id="96cf3-125">Per semplificare il processo di configurazione dell'estensione di diagnostica con PowerShell, l'output del pacchetto di Visual Studio contiene anche il codice XML di configurazione pubblica con la chiave di strumentazione corretta di Application Insights.</span><span class="sxs-lookup"><span data-stu-id="96cf3-125">To simplify the process of configuring the diagnostics extension with PowerShell, the package output from Visual Studio also contains the public configuration XML with the appropriate Application Insights instrumentation key.</span></span> <span data-ttu-id="96cf3-126">I file di configurazione pubblica vengono creati nella cartella Extensions e seguono il modello *PaaSDiagnostics.&lt;RoleName&gt;.PubConfig.xml*.</span><span class="sxs-lookup"><span data-stu-id="96cf3-126">The public config files are created in the Extensions folder and follow the pattern *PaaSDiagnostics.&lt;RoleName&gt;.PubConfig.xml*.</span></span> <span data-ttu-id="96cf3-127">Eventuali distribuzioni basate su PowerShell possono usare questo modello per il mapping di ogni configurazione a un ruolo.</span><span class="sxs-lookup"><span data-stu-id="96cf3-127">Any PowerShell-based deployments can use this pattern to map each configuration to a role.</span></span>

4) <span data-ttu-id="96cf3-128">Per configurare il servizio Diagnostica di Azure per inviare tutti i contatori delle prestazioni e i log a livello di errore raccolti dall'agente di Diagnostica di Azure ad Application Insights, abilitare l'opzione **Invia i dati di diagnostica ad Application Insights**.</span><span class="sxs-lookup"><span data-stu-id="96cf3-128">To configure Azure diagnostics to send all performance counters and error-level logs collected by the Azure diagnostics agent to Application Insights, enable the **Send diagnostics data to Application Insights** option.</span></span> 

    <span data-ttu-id="96cf3-129">Se si vogliono configurare ulteriormente i dati inviati ad Application Insights, è necessario modificare manualmente il file *diagnostics.wadcfgx* per ogni ruolo.</span><span class="sxs-lookup"><span data-stu-id="96cf3-129">If you want to further configure what data is sent to Application Insights, you must manually edit the *diagnostics.wadcfgx* file for each role.</span></span> <span data-ttu-id="96cf3-130">Per altre informazioni sull'aggiornamento manuale della configurazione, vedere l'articolo relativo alla [configurazione di Diagnostica di Azure per inviare dati ad Application Insights](#configure-azure-diagnostics-to-send-data-to-application-insights) .</span><span class="sxs-lookup"><span data-stu-id="96cf3-130">See [Configure Azure Diagnostics to send data to Application Insights](#configure-azure-diagnostics-to-send-data-to-application-insights) to learn more about manually updating the configuration.</span></span>

<span data-ttu-id="96cf3-131">Quando il servizio cloud è configurato per l'invio di dati del servizio Diagnostica di Azure ad Application Insights, è possibile distribuirlo in Azure normalmente, verificando che l'estensione della diagnostica di Azure sia abilitata.</span><span class="sxs-lookup"><span data-stu-id="96cf3-131">When the cloud service is configured to send Azure diagnostics data to application insights, you can deploy it to Azure normally, making sure the Azure diagnostics extension is enabled.</span></span> <span data-ttu-id="96cf3-132">Per altre informazioni, vedere [Pubblicazione di un servizio cloud di Azure con Visual Studio](../vs-azure-tools-publishing-a-cloud-service.md).</span><span class="sxs-lookup"><span data-stu-id="96cf3-132">For more information, see  [Publishing a Cloud Service using Visual Studio](../vs-azure-tools-publishing-a-cloud-service.md).</span></span>  

## <a name="viewing-azure-diagnostics-data-in-application-insights"></a><span data-ttu-id="96cf3-133">Visualizzazione dei dati del servizio Diagnostica di Azure in Application Insights</span><span class="sxs-lookup"><span data-stu-id="96cf3-133">Viewing Azure diagnostics data in Application Insights</span></span>
<span data-ttu-id="96cf3-134">La telemetria diagnostica di Azure viene visualizzata nella risorsa di Application Insights configurata per il servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="96cf3-134">The Azure diagnostic telemetry shows up in the Application Insights resource configured for your cloud service.</span></span>

<span data-ttu-id="96cf3-135">I tipi di log di Diagnostica di Azure vengono mappati ai concetti di Application Insights in questi modi:</span><span class="sxs-lookup"><span data-stu-id="96cf3-135">Azure diagnostics log types map to Application Insights concepts in these ways:</span></span>

* <span data-ttu-id="96cf3-136">I contatori delle prestazioni vengono visualizzati come metriche personalizzate in Application Insights.</span><span class="sxs-lookup"><span data-stu-id="96cf3-136">Performance counters are displayed as Custom Metrics in Application Insights.</span></span>
* <span data-ttu-id="96cf3-137">I registri eventi di Windows vengono visualizzati come tracce ed eventi personalizzati in Application Insights.</span><span class="sxs-lookup"><span data-stu-id="96cf3-137">Windows Event Logs are shown as Traces and Custom Events in Application Insights.</span></span>
* <span data-ttu-id="96cf3-138">I log applicazioni, i log ETW e gli eventuali log dell'infrastruttura di diagnostica vengono visualizzati come tracce in Application Insights.</span><span class="sxs-lookup"><span data-stu-id="96cf3-138">Application logs, ETW logs, and any Diagnostics Infrastructure logs are shown as Traces in Application Insights.</span></span>

<span data-ttu-id="96cf3-139">Per visualizzare i dati del servizio Diagnostica di Azure in Application Insights, eseguire una delle operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="96cf3-139">To view Azure diagnostics data in Application Insights, do one of the following:</span></span>

* <span data-ttu-id="96cf3-140">Usare [Esplora metriche](../application-insights/app-insights-metrics-explorer.md) per visualizzare tutti i contatori delle prestazioni personalizzati o i conteggi di diversi tipi di eventi del registro eventi di Windows.</span><span class="sxs-lookup"><span data-stu-id="96cf3-140">Use [Metrics explorer](../application-insights/app-insights-metrics-explorer.md) to visualize any custom performance counters or counts of different types of Windows Event Log events.</span></span>

    ![Metriche personalizzate in Esplora metriche][5]

* <span data-ttu-id="96cf3-142">Usare [Cerca](../application-insights/app-insights-diagnostic-search.md) per eseguire ricerche nei log di traccia inviati da Diagnostica di Azure.</span><span class="sxs-lookup"><span data-stu-id="96cf3-142">Use [Search](../application-insights/app-insights-diagnostic-search.md) to search across the  trace logs sent by Azure Diagnostics.</span></span> <span data-ttu-id="96cf3-143">Se un'eccezione non gestita ha causato l'arresto anomalo e il riciclo del ruolo, ad esempio, le informazioni sull'eccezione vengono visualizzate nel canale *Applicazione* del *registro eventi di Windows*.</span><span class="sxs-lookup"><span data-stu-id="96cf3-143">For example, if an unhandled exception has caused the role to crash and recycle, information about the exception shows up in the *Application* channel of *Windows Event Log*.</span></span> <span data-ttu-id="96cf3-144">È possibile usare la funzionalità di ricerca per esaminare l'errore del registro eventi di Windows e ottenere l'analisi dello stack completa per l'eccezione per trovare più facilmente la causa del problema.</span><span class="sxs-lookup"><span data-stu-id="96cf3-144">You can use search to look at the Windows Event Log error and get the full stack trace for the exception to help find the cause of the issue.</span></span>

    ![Cerca tracce][6]

## <a name="next-steps"></a><span data-ttu-id="96cf3-146">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="96cf3-146">Next Steps</span></span>
* <span data-ttu-id="96cf3-147">[Aggiungere Application Insights SDK al servizio cloud](../application-insights/app-insights-cloudservices.md) per inviare dati relativi a richieste, eccezioni, dipendenze ed eventuale telemetria personalizzata dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="96cf3-147">[Add the Application Insights SDK to your cloud service](../application-insights/app-insights-cloudservices.md) to send data about requests, exceptions, dependencies, and any custom telemetry from your application.</span></span> <span data-ttu-id="96cf3-148">In combinazione con i dati del servizio Diagnostica di Azure, queste informazioni offriranno una visione completa dell'applicazione e del sistema nella stessa risorsa di Application Insight.</span><span class="sxs-lookup"><span data-stu-id="96cf3-148">When combined with the Azure Diagnostics data, this information you can get a complete view of your application and system, all in the same Application Insight resource.</span></span>  

<!--Image references-->
[1]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/solution-explorer-properties.png
[2]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/role-designer-sendtoappinsights.png
[3]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/select-appinsights-resource.png
[4]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/role-designer-appinsights-serviceconfig.png
[5]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/metrics-explorer-custom-metrics.png
[6]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/search-windowseventlog-error.png
