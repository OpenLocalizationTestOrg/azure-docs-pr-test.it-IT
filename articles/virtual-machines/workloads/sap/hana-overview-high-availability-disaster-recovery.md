---
title: "Disponibilità elevata e ripristino di emergenza di SAP HANA in Azure (istanze di grandi dimensioni) | Documentazione Microsoft"
description: "Implementare la disponibilità elevata e pianificare il ripristino di emergenza di SAP HANA in Azure (istanze di grandi dimensioni)."
services: virtual-machines-linux
documentationcenter: 
author: RicksterCDN
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 12/01/2016
ms.author: rclaus
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f95e944fc3ec3a831d97386443eb644420ae54dc
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="sap-hana-large-instances-high-availability-and-disaster-recovery-on-azure"></a><span data-ttu-id="204a9-103">Disponibilità elevata e ripristino di emergenza di SAP HANA (istanze di grandi dimensioni) in Azure</span><span class="sxs-lookup"><span data-stu-id="204a9-103">SAP HANA (large instances) high availability and disaster recovery on Azure</span></span> 

<span data-ttu-id="204a9-104">La disponibilità elevata e il ripristino di emergenza sono aspetti importanti per l'esecuzione di uno o più server SAP HANA di importanza critica in Azure (istanze di grandi dimensioni).</span><span class="sxs-lookup"><span data-stu-id="204a9-104">High availability and disaster recovery are important aspects of running your mission-critical SAP HANA on Azure (large instances) servers.</span></span> <span data-ttu-id="204a9-105">Per progettare e implementare la corretta strategia di disponibilità elevata e ripristino di emergenza è fondamentale la collaborazione con SAP, l'integratore di sistemi o Microsoft.</span><span class="sxs-lookup"><span data-stu-id="204a9-105">It's important to work with SAP, your system integrator, or Microsoft to properly architect and implement the right high-availability/disaster-recovery strategy.</span></span> <span data-ttu-id="204a9-106">È importante anche prendere in considerazione l'obiettivo punto di ripristino e l'obiettivo tempo di ripristino, che sono specifici dell'ambiente.</span><span class="sxs-lookup"><span data-stu-id="204a9-106">It is also important to consider the recovery point objective and recovery time objective, which are specific to your environment.</span></span>

## <a name="high-availability"></a><span data-ttu-id="204a9-107">Disponibilità elevata</span><span class="sxs-lookup"><span data-stu-id="204a9-107">High availability</span></span>

<span data-ttu-id="204a9-108">Microsoft supporta i metodi di disponibilità elevata "predefiniti" di SAP HANA, che comprendono:</span><span class="sxs-lookup"><span data-stu-id="204a9-108">Microsoft supports SAP HANA high-availability methods "out of the box," which include:</span></span>

- <span data-ttu-id="204a9-109">**Replica di archiviazione:** la capacità del sistema di archiviazione di replicare tutti i dati in un'altra posizione (all'interno dello stesso data center o separatamente).</span><span class="sxs-lookup"><span data-stu-id="204a9-109">**Storage replication:** The storage system's ability to replicate all data to another location (within, or separate from, the same datacenter).</span></span> <span data-ttu-id="204a9-110">SAP HANA funziona in modo indipendente da questo metodo.</span><span class="sxs-lookup"><span data-stu-id="204a9-110">SAP HANA operates independently of this method.</span></span>
- <span data-ttu-id="204a9-111">**Replica di sistema HANA:** la replica di tutti i dati di SAP HANA in un sistema SAP HANA separato.</span><span class="sxs-lookup"><span data-stu-id="204a9-111">**HANA system replication:** The replication of all data in SAP HANA to a separate SAP HANA system.</span></span> <span data-ttu-id="204a9-112">L'obiettivo tempo di ripristino è ridotto al minimo tramite la replica dei dati a intervalli regolari.</span><span class="sxs-lookup"><span data-stu-id="204a9-112">The recovery time objective is minimized through data replication at regular intervals.</span></span> <span data-ttu-id="204a9-113">SAP HANA supporta le modalità asincrona, sincrona in memoria e sincrona (consigliata solo per i sistemi SAP HANA all'interno della stesso data center o distanti meno di 100 km).</span><span class="sxs-lookup"><span data-stu-id="204a9-113">SAP HANA supports asynchronous, synchronous in-memory, and synchronous modes (recommended only for SAP HANA systems that are within the same datacenter or less than 100 KM apart).</span></span> <span data-ttu-id="204a9-114">Nell'attuale progettazione dei timestamp HANA delle istanze di grandi dimensioni, la replica di sistema HANA è utilizzabile solo per la disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="204a9-114">In the current design of HANA large-instance stamps, HANA system replication can be used for high availability only.</span></span>
- <span data-ttu-id="204a9-115">**Failover automatico dell'host:** una soluzione locale di ripristino dagli errore da usare come alternativa alla replica di sistema.</span><span class="sxs-lookup"><span data-stu-id="204a9-115">**Host auto-failover:** A local fault-recovery solution to use as an alternative to system replication.</span></span> <span data-ttu-id="204a9-116">Quando il nodo master diventa non disponibile, uno o più nodi SAP HANA in standby sono configurati in modalità di scalabilità orizzontale e SAP HANA esegue automaticamente il failover in un altro nodo.</span><span class="sxs-lookup"><span data-stu-id="204a9-116">When the master node becomes unavailable, one or more standby SAP HANA nodes are configured in scale-out mode and SAP HANA automatically fails over to another node.</span></span>

<span data-ttu-id="204a9-117">Per altre informazioni sulla disponibilità elevata di SAP HANA, vedere le risorse SAP seguenti:</span><span class="sxs-lookup"><span data-stu-id="204a9-117">For more information on SAP HANA high availability, see the following SAP information:</span></span>

- <span data-ttu-id="204a9-118">[SAP HANA High-Availability Whitepaper](http://go.sap.com/documents/2016/05/f8e5eeba-737c-0010-82c7-eda71af511fa.html) (White paper sulla disponibilità elevata di SAP HANA)</span><span class="sxs-lookup"><span data-stu-id="204a9-118">[SAP HANA High-Availability Whitepaper](http://go.sap.com/documents/2016/05/f8e5eeba-737c-0010-82c7-eda71af511fa.html)</span></span>
- <span data-ttu-id="204a9-119">[SAP HANA Administration Guide](http://help.sap.com/hana/SAP_HANA_Administration_Guide_en.pdf) (Guida all'amministrazione di SAP HANA)</span><span class="sxs-lookup"><span data-stu-id="204a9-119">[SAP HANA Administration Guide](http://help.sap.com/hana/SAP_HANA_Administration_Guide_en.pdf)</span></span>
- <span data-ttu-id="204a9-120">[SAP Academy Video on SAP HANA System Replication](http://scn.sap.com/community/hana-in-memory/blog/2015/05/19/sap-hana-system-replication) (Video della SAP Academy sulla replica di sistema di SAP HANA)</span><span class="sxs-lookup"><span data-stu-id="204a9-120">[SAP Academy Video on SAP HANA System Replication](http://scn.sap.com/community/hana-in-memory/blog/2015/05/19/sap-hana-system-replication)</span></span>
- <span data-ttu-id="204a9-121">[SAP Support Note #1999880 - FAQ on SAP HANA System Replication](https://bcs.wdf.sap.corp/sap/support/notes/1999880) (Nota di supporto SAP 1999880 - Domande frequenti sulla replica di sistema di SAP HANA)</span><span class="sxs-lookup"><span data-stu-id="204a9-121">[SAP Support Note #1999880 – FAQ on SAP HANA System Replication](https://bcs.wdf.sap.corp/sap/support/notes/1999880)</span></span>
- <span data-ttu-id="204a9-122">[SAP Support Note #2165547 - SAP HANA Backup and Restore within SAP HANA System Replication Environment](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3231363535343726) (Nota di supporto SAP 2165547 - Backup e ripristino di SAP HANA nell'ambiente di replica di sistema di SAP HANA)</span><span class="sxs-lookup"><span data-stu-id="204a9-122">[SAP Support Note #2165547 – SAP HANA Backup and Restore within SAP HANA System Replication Environment](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3231363535343726)</span></span>
- <span data-ttu-id="204a9-123">[SAP Support Note #1984882 - Using SAP HANA System Replication for Hardware Exchange with Minimum/Zero Downtime](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3139383438383226) (Nota di supporto SAP 1984882 - Uso della replica di sistema di SAP HANA per la sostituzione di hardware con tempo di inattività minimo o nullo)</span><span class="sxs-lookup"><span data-stu-id="204a9-123">[SAP Support Note #1984882 – Using SAP HANA System Replication for Hardware Exchange with Minimum/Zero Downtime](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3139383438383226)</span></span>

## <a name="disaster-recovery"></a><span data-ttu-id="204a9-124">Ripristino di emergenza</span><span class="sxs-lookup"><span data-stu-id="204a9-124">Disaster recovery</span></span>

<span data-ttu-id="204a9-125">SAP HANA in Azure (istanze di grandi dimensioni) è disponibile in due aree di Azure all'interno di un'area geopolitica.</span><span class="sxs-lookup"><span data-stu-id="204a9-125">SAP HANA on Azure (large instances) is offered in two Azure regions in a geopolitical region.</span></span> <span data-ttu-id="204a9-126">Tra i due moduli per istanze di grandi dimensioni delle due diverse aree è presente una connettività di rete diretta per la replica dei dati durante il ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="204a9-126">Between the two large-instance stamps of two different regions is a direct network connectivity for replicating data during disaster recovery.</span></span> <span data-ttu-id="204a9-127">La replica dei dati è basata sull'infrastruttura di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-127">The replication of the data is storage-infrastructure based.</span></span> <span data-ttu-id="204a9-128">La replica non viene eseguita per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="204a9-128">The replication is not done by default.</span></span> <span data-ttu-id="204a9-129">Viene eseguita per le configurazioni dei clienti che hanno ordinato il ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="204a9-129">It is done for the customer configurations that ordered the disaster recovery.</span></span> <span data-ttu-id="204a9-130">Nell'attuale progettazione la replica di sistema HANA non può essere usata per il ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="204a9-130">In the current design, HANA system replication can't be used for disaster recovery.</span></span>

<span data-ttu-id="204a9-131">Tuttavia, per sfruttare i vantaggi del ripristino di emergenza, è necessario iniziare a progettare la connettività di rete alle due diverse aree di Azure in base a questo requisito.</span><span class="sxs-lookup"><span data-stu-id="204a9-131">However, to take advantage of the disaster recovery, you need to start to design the network connectivity to the two different Azure regions.</span></span> <span data-ttu-id="204a9-132">Per farlo, occorre implementare un circuito ExpressRoute di Azure per la connessione dall'infrastruttura locale all'area principale di Azure e un altro circuito per la connessione dall'infrastruttura locale all'area di ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="204a9-132">To do so, you need an Azure ExpressRoute circuit connection from on-premises in your main Azure region and another circuit connection from on-premises to your disaster-recovery region.</span></span> <span data-ttu-id="204a9-133">Questa misura consente di gestire le situazioni in cui si verifica un problema all'interno di un'intera area di Azure, inclusa la posizione di un router MSEE (Microsoft Enterprise Edge).</span><span class="sxs-lookup"><span data-stu-id="204a9-133">This measure would cover a situation in which a complete Azure region, including a Microsoft enterprise edge router (MSEE) location, has an issue.</span></span>

<span data-ttu-id="204a9-134">Come seconda misura, è possibile connettere tutte le reti virtuali di Azure collegate a SAP HANA in Azure (istanze di grandi dimensioni) in una delle aree a entrambi i circuiti ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="204a9-134">As a second measure, you can connect all Azure virtual networks that connect to SAP HANA on Azure (large instances) in one of the regions to both of those ExpressRoute circuits.</span></span> <span data-ttu-id="204a9-135">In questo modo è possibile gestire il caso in cui una sola delle posizioni MSEE che connette l'infrastruttura locale ad Azure risulti fuori servizio.</span><span class="sxs-lookup"><span data-stu-id="204a9-135">This measure addresses a case where only one of the MSEE locations that connects your on-premises location with Azure goes off duty.</span></span>

<span data-ttu-id="204a9-136">La figura seguente mostra la configurazione ottimale per il ripristino di emergenza:</span><span class="sxs-lookup"><span data-stu-id="204a9-136">The following figure shows the optimal configuration for disaster recovery:</span></span>

![Configurazione ottimale per il ripristino di emergenza](./media/hana-overview-high-availability-disaster-recovery/image1-optimal-configuration.png)

<span data-ttu-id="204a9-138">La configurazione ottimale per il ripristino di emergenza della rete è costituita da due circuiti ExpressRoute che connettono l'infrastruttura locale alle due diverse aree di Azure.</span><span class="sxs-lookup"><span data-stu-id="204a9-138">The optimal case for a disaster-recovery configuration of the network is to have two ExpressRoute circuits from on-premises to the two different Azure regions.</span></span> <span data-ttu-id="204a9-139">Un circuito va verso l'area 1, in cui viene eseguita un'istanza di produzione.</span><span class="sxs-lookup"><span data-stu-id="204a9-139">One circuit goes to region #1, running a production instance.</span></span> <span data-ttu-id="204a9-140">Il secondo circuito ExpressRoute passa all'area numero 2, eseguendo alcune istanze HANA non di produzione.</span><span class="sxs-lookup"><span data-stu-id="204a9-140">The second ExpressRoute circuit goes to region #2, running some non-production HANA instances.</span></span> <span data-ttu-id="204a9-141">Questo è importante se un'intera area di Azure, incluso il timestamp di MSEE e dell'istanza di grandi dimensioni, esce dalla griglia.</span><span class="sxs-lookup"><span data-stu-id="204a9-141">(This is important if an entire Azure region, including the MSEE and large-instance stamp, goes off the grid.)</span></span>

<span data-ttu-id="204a9-142">Come seconda misura, le diverse reti virtuali sono connesse ai vari circuiti ExpressRoute collegati a SAP HANA in Azure (istanze di grandi dimensioni).</span><span class="sxs-lookup"><span data-stu-id="204a9-142">As a second measure, the various virtual networks are connected to the various ExpressRoute circuits that are connected to SAP HANA on Azure (large instances).</span></span> <span data-ttu-id="204a9-143">È possibile ignorare la posizione in cui un router MSEE smette di funzionare oppure ridurre l'obiettivo punto di ripristino per il ripristino di emergenza, come illustrato più avanti.</span><span class="sxs-lookup"><span data-stu-id="204a9-143">You can bypass the location where an MSEE is failing, or you can lower the recovery point objective for disaster recovery, as we discuss later.</span></span>

<span data-ttu-id="204a9-144">Per la configurazione del ripristino di emergenza sono previsti anche i requisiti seguenti:</span><span class="sxs-lookup"><span data-stu-id="204a9-144">The next requirements for a disaster-recovery setup are:</span></span>

- <span data-ttu-id="204a9-145">È necessario ordinare SKU di SAP HANA in Azure (istanze di grandi dimensioni) della stessa dimensione degli SKU di produzione e distribuirli nell'area di ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="204a9-145">You must order SAP HANA on Azure (large instances) SKUs of the same size as your production SKUs and deploy them in the disaster-recovery region.</span></span> <span data-ttu-id="204a9-146">Queste istanze possono essere usate per eseguire istanze di QA HANA, test o sandbox.</span><span class="sxs-lookup"><span data-stu-id="204a9-146">These instances can be used to run test, sandbox, or QA HANA instances.</span></span>
- <span data-ttu-id="204a9-147">È necessario ordinare un profilo di ripristino di emergenza per ogni SKU di SAP HANA in Azure (istanze di grandi dimensioni) che si vuole ripristinare nel sito di ripristino di emergenza, se necessario.</span><span class="sxs-lookup"><span data-stu-id="204a9-147">You must order a disaster-recovery profile for each of your SAP HANA on Azure (large instances) SKUs that you want to recover in the disaster-recovery site, if necessary.</span></span> <span data-ttu-id="204a9-148">In questo modo vengono allocati volumi di archiviazione, che vengono usati come destinazione della replica di archiviazione dall'area di produzione all'area di ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="204a9-148">This action leads to the allocation of storage volumes, which are the target of the storage replication from your production region into the disaster-recovery region.</span></span>

<span data-ttu-id="204a9-149">Una volta soddisfatti i requisiti precedenti, è responsabilità dell'utente avviare la replica di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-149">After you meet the preceding requirements, it is your responsibility to start the storage replication.</span></span> <span data-ttu-id="204a9-150">Nell'infrastruttura di archiviazione usata per SAP HANA in Azure (istanze di grandi dimensioni), la replica di archiviazione è basata sugli snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-150">In the storage infrastructure used for SAP HANA on Azure (large instances), the basis of storage replication is storage snapshots.</span></span> <span data-ttu-id="204a9-151">Per avviare la replica di ripristino di emergenza, è necessario eseguire questi snapshot:</span><span class="sxs-lookup"><span data-stu-id="204a9-151">To start the disaster-recovery replication, you need to perform:</span></span>

- <span data-ttu-id="204a9-152">Uno snapshot del LUN di avvio, come descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="204a9-152">A snapshot of your boot LUN, as described earlier.</span></span>
- <span data-ttu-id="204a9-153">Uno snapshot dei volumi correlati a HANA, come descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="204a9-153">A snapshot of your HANA-related volumes, as described earlier.</span></span>

<span data-ttu-id="204a9-154">Dopo l'esecuzione di questi snapshot, viene effettuato il seeding di una replica iniziale dei volumi nei volumi associati al profilo di ripristino di emergenza nell'area di ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="204a9-154">After you execute these snapshots, an initial replica of the volumes is seeded on the volumes that are associated with your disaster-recovery profile in the disaster-recovery region.</span></span>

<span data-ttu-id="204a9-155">Successivamente, il più recente snapshot di archiviazione viene utilizzato ogni ora per replicare i dati differenziali presenti nei volumi di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-155">Subsequently, the most recent storage snapshot is used every hour to replicate the deltas that develop on the storage volumes.</span></span>

<span data-ttu-id="204a9-156">L'obiettivo punto di ripristino che è possibile ottenere con questa configurazione va da 60 a 90 minuti.</span><span class="sxs-lookup"><span data-stu-id="204a9-156">The recovery point objective that's achieved with this configuration is from 60 to 90 minutes.</span></span> <span data-ttu-id="204a9-157">Per ottenere un migliore obiettivo punto di ripristino in caso di ripristino di emergenza, è necessario copiare i backup del log delle transazioni da SAP HANA in Azure (istanze di grandi dimensioni) all'altra area di Azure.</span><span class="sxs-lookup"><span data-stu-id="204a9-157">To achieve a better recovery point objective in the disaster-recovery case, copy the HANA transaction log backups from SAP HANA on Azure (large instances) to the other Azure region.</span></span> <span data-ttu-id="204a9-158">Per raggiungere questo obiettivo punto di ripristino, eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="204a9-158">To achieve this recovery point objective, do the following:</span></span>

1. <span data-ttu-id="204a9-159">Eseguire il backup del log delle transazioni di HANA il più frequentemente possibile in /hana/log/backup.</span><span class="sxs-lookup"><span data-stu-id="204a9-159">Back up the HANA transaction log as frequently as possible to /hana/log/backup.</span></span>
2. <span data-ttu-id="204a9-160">Copiare i backup del log delle transazioni completati in una macchina virtuale (VM) di Azure, che si trova in una rete virtuale connessa al server di SAP HANA in Azure (istanze di grandi dimensioni).</span><span class="sxs-lookup"><span data-stu-id="204a9-160">Copy the transaction log backups when they are finished to an Azure virtual machine (VM), which is in a virtual network that's connected to the SAP HANA on Azure (large instances) server.</span></span>
3. <span data-ttu-id="204a9-161">Da tale VM copiare il backup in una VM di una rete virtuale nell'area di ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="204a9-161">From that VM, copy the backup to a VM that's in a virtual network in the disaster-recovery region.</span></span>
4. <span data-ttu-id="204a9-162">Mantenere i backup del log delle transazioni in tale area nella VM.</span><span class="sxs-lookup"><span data-stu-id="204a9-162">Keep the transaction log backups in that region in the VM.</span></span>

<span data-ttu-id="204a9-163">In caso di emergenza, dopo avere distribuito il profilo di ripristino di emergenza su un server effettivo, copiare i backup del log delle transazioni dalla VM al server di SAP HANA in Azure (istanze di grandi dimensioni), che è ora il server primario nell'area di ripristino di emergenza, e ripristinare tali backup.</span><span class="sxs-lookup"><span data-stu-id="204a9-163">In case of disaster, after the disaster-recovery profile has been deployed on an actual server, copy the transaction log backups from the VM to the SAP HANA on Azure (large instances) that is now the primary server in the disaster-recovery region, and restore those backups.</span></span> <span data-ttu-id="204a9-164">Questo ripristino è possibile perché lo stato di HANA nei dischi di ripristino di emergenza corrisponde a uno snapshot HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-164">This recovery is possible because the state of HANA on the disaster-recovery disks is that of a HANA snapshot.</span></span> <span data-ttu-id="204a9-165">Questo è il punto di offset per altre operazioni di ripristino dei backup del log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="204a9-165">This is the offset point for further restorations of transaction log backups.</span></span>

## <a name="backup-and-restore"></a><span data-ttu-id="204a9-166">Backup e ripristino</span><span class="sxs-lookup"><span data-stu-id="204a9-166">Backup and restore</span></span>

<span data-ttu-id="204a9-167">Uno degli aspetti più importanti per i database operativi è quello di assicurarsi che i database possano essere protetti da diversi eventi catastrofici.</span><span class="sxs-lookup"><span data-stu-id="204a9-167">One of the most important aspects to operating databases is making sure the database can be protected from various catastrophic events.</span></span> <span data-ttu-id="204a9-168">Questi eventi possono avere diverse cause, da disastri naturali a semplici errori umani.</span><span class="sxs-lookup"><span data-stu-id="204a9-168">These events can be caused by anything from natural disasters to simple user errors.</span></span>

<span data-ttu-id="204a9-169">Il backup di un database con possibilità di ripristino a una temporizzazione qualsiasi, ad esempio prima dell'eliminazione di dati critici, consente di ripristinare il database a uno stato che sia il più vicino possibile a quello precedente l'interruzione.</span><span class="sxs-lookup"><span data-stu-id="204a9-169">Backing up a database, with the ability to restore it to any point in time (such as before somebody deleted critical data), allows restoration to a state that is as close as possible to the way it was before the disruption occurred.</span></span>

<span data-ttu-id="204a9-170">Per ottenere risultati ottimali, è necessario eseguire due tipi di backup:</span><span class="sxs-lookup"><span data-stu-id="204a9-170">Two types of backups must be performed for best results:</span></span>

- <span data-ttu-id="204a9-171">Backup del database</span><span class="sxs-lookup"><span data-stu-id="204a9-171">Database backups</span></span>
- <span data-ttu-id="204a9-172">Backup dei log delle transazioni</span><span class="sxs-lookup"><span data-stu-id="204a9-172">Transaction log backups</span></span>

<span data-ttu-id="204a9-173">Oltre a creare backup di database completi al livello applicazione, è possibile raggiungere risultati ancora migliori eseguendo i backup con gli snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-173">In addition to full database backups performed at an application-level, you can be even more thorough by performing backups with storage snapshots.</span></span> <span data-ttu-id="204a9-174">Anche i backup dei log sono importanti per ripristinare il database, oltre che per svuotare i log dalle transazioni di cui è già stato eseguito il commit.</span><span class="sxs-lookup"><span data-stu-id="204a9-174">Performing log backups is also important for restoring the database (and to empty the logs from already committed transactions).</span></span>

<span data-ttu-id="204a9-175">SAP HANA in Azure (istanze di grandi dimensioni) offre due opzioni di backup e ripristino:</span><span class="sxs-lookup"><span data-stu-id="204a9-175">SAP HANA on Azure (large instances) offers two backup and restore options:</span></span>

- <span data-ttu-id="204a9-176">Eseguire il backup e il ripristino manualmente.</span><span class="sxs-lookup"><span data-stu-id="204a9-176">Do it yourself (DIY).</span></span> <span data-ttu-id="204a9-177">Dopo avere eseguito gli opportuni calcoli per assicurarsi che sia disponibile spazio sufficiente sui dischi, eseguire backup completi di database e log usando specifici metodi di backup (su tali dischi).</span><span class="sxs-lookup"><span data-stu-id="204a9-177">After you calculate to ensure enough disk space, perform full database and log backups by using disk backup methods (to those disks).</span></span> <span data-ttu-id="204a9-178">Nel corso del tempo, i backup vengono copiati in Archiviazione di Azure, dopo la configurazione di un file server basato su Azure con archiviazione Standard virtualmente illimitata. In alternativa, è possibile usare l'insieme di credenziali di Backup di Azure o l'archiviazione di Azure ad accesso sporadico.</span><span class="sxs-lookup"><span data-stu-id="204a9-178">Over time, the backups are copied to an Azure storage account (after you set up an Azure-based file server with virtually unlimited storage), or use an Azure Backup vault or Azure cold storage.</span></span> <span data-ttu-id="204a9-179">Un'altra soluzione è usare uno strumento di protezione dei dati di terze parti, ad esempio Commvault, per archiviare i backup dopo averli copiati in un account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-179">Another option is to use a third-party data protection tool, such as Commvault, to store the backups after they are copied to a storage account.</span></span> <span data-ttu-id="204a9-180">L'opzione di backup manuale può essere necessaria anche per i dati che devono essere archiviati più a lungo a scopo di controllo e conformità.</span><span class="sxs-lookup"><span data-stu-id="204a9-180">The DIY backup option might also be necessary for data that needs to be stored for longer periods for compliancy and auditing purposes.</span></span>
- <span data-ttu-id="204a9-181">Usare la funzionalità per il backup e il ripristino offerta dall'infrastruttura sottostante di SAP HANA in Azure (istanze di grandi dimensioni).</span><span class="sxs-lookup"><span data-stu-id="204a9-181">Use the backup and restore functionality that the underlying infrastructure of SAP HANA on Azure (large instances) provides.</span></span> <span data-ttu-id="204a9-182">Questa opzione soddisfa le esigenze di backup e rende quasi obsoleti i backup manuali, tranne quando i backup dei dati sono necessari per motivi di conformità.</span><span class="sxs-lookup"><span data-stu-id="204a9-182">This option fulfills the need for backups, and it makes manual backups nearly obsolete (except where data backups are required for compliance purposes).</span></span> <span data-ttu-id="204a9-183">La parte restante di questa sezione illustra le funzionalità di backup e ripristino offerte con le istanze di grandi dimensioni HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-183">The rest of this section addresses the backup and restore functionality that's offered with HANA (large instances).</span></span>

> [!NOTE]
> <span data-ttu-id="204a9-184">La tecnologia di snapshot che viene utilizzata dall'infrastruttura sottostante di HANA (istanze di grandi dimensioni) presenta una dipendenza da snapshot di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-184">The snapshot technology that is used by the underlying infrastructure of HANA (large instances) has a dependency on SAP HANA snapshots.</span></span> <span data-ttu-id="204a9-185">Gli snapshot di SAP HANA non funzionano in combinazione con i contenitori di database multi-tenant SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-185">SAP HANA snapshots do not work in conjunction with SAP HANA Multitenant Database Containers.</span></span> <span data-ttu-id="204a9-186">Di conseguenza questo metodo di backup non può essere usato per distribuire contenitori di database multi-tenant SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-186">As a result, this method of backup cannot be used to deploy SAP HANA Multitenant Database Containers.</span></span>

### <a name="using-storage-snapshots-of-sap-hana-on-azure-large-instances"></a><span data-ttu-id="204a9-187">Uso degli snapshot di archiviazione di SAP HANA in Azure (istanze di grandi dimensioni)</span><span class="sxs-lookup"><span data-stu-id="204a9-187">Using storage snapshots of SAP HANA on Azure (large instances)</span></span>

<span data-ttu-id="204a9-188">L'infrastruttura di archiviazione sottostante di SAP HANA in Azure (istanze di grandi dimensioni) supporta il concetto di snapshot di archiviazione dei volumi.</span><span class="sxs-lookup"><span data-stu-id="204a9-188">The storage infrastructure underlying SAP HANA on Azure (large instances) supports the notion of a storage snapshot of volumes.</span></span> <span data-ttu-id="204a9-189">Il backup e il ripristino di un determinato volume sono supportati con le considerazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="204a9-189">Both backup and restoration of a particular volume are supported, with the following considerations:</span></span>

- <span data-ttu-id="204a9-190">In alternativa ai backup del database, vengono creati regolarmente snapshot di archiviazione dei volumi.</span><span class="sxs-lookup"><span data-stu-id="204a9-190">Instead of database backups, storage volume snapshots are taken on a frequent basis.</span></span>
- <span data-ttu-id="204a9-191">Prima dell'esecuzione, lo snapshot di archiviazione avvia uno snapshot di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-191">The storage snapshot initiates an SAP HANA snapshot before it executes the storage snapshot.</span></span> <span data-ttu-id="204a9-192">Questo snapshot di SAP HANA è il punto di installazione per i ripristini dei log finali dopo il ripristino dello snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-192">This SAP HANA snapshot is the setup point for eventual log restorations after recovery of the storage snapshot.</span></span>
- <span data-ttu-id="204a9-193">Al momento dell'esecuzione dello snapshot di archiviazione, lo snapshot di SAP HANA verrà eliminato.</span><span class="sxs-lookup"><span data-stu-id="204a9-193">At the point where the storage snapshot is executed successfully, the SAP HANA snapshot is deleted.</span></span>
- <span data-ttu-id="204a9-194">I backup dei log vengono creati di frequente e archiviati nel volume per il backup dei log o in Azure.</span><span class="sxs-lookup"><span data-stu-id="204a9-194">Log backups are taken frequently and stored in the log backup volume or in Azure.</span></span>
- <span data-ttu-id="204a9-195">Se è necessario ripristinare il database a una determinata temporizzazione, viene inviata una richiesta al supporto tecnico di Microsoft Azure (interruzione di produzione) o al team di gestione dei servizi SAP HANA in Azure per il ripristino in base a uno specifico snapshot di archiviazione, ad esempio un ripristino pianificato di un sistema sandbox allo stato originale.</span><span class="sxs-lookup"><span data-stu-id="204a9-195">If the database must be restored to a certain point in time, a request is made to Microsoft Azure Support (production outage) or SAP HANA on Azure Service Management to restore to a certain storage snapshot (for example, a planned restoration of a sandbox system to its original state).</span></span>
- <span data-ttu-id="204a9-196">Lo snapshot di SAP HANA incluso nello snapshot di archiviazione è un punto di offset per l'applicazione dei backup di log che sono stati creati e archiviati dopo l'esecuzione dello snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-196">The SAP HANA snapshot that's included in the storage snapshot is an offset point for applying log backups that have been executed and stored after the storage snapshot was taken.</span></span>
- <span data-ttu-id="204a9-197">Questi backup dei log vengono creati per ripristinare il database a una determinata temporizzazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-197">These log backups are taken to restore the database back to a certain point in time.</span></span>

<span data-ttu-id="204a9-198">Quando si specifica il valore di backup\_name, viene creato uno snapshot dei volumi seguenti:</span><span class="sxs-lookup"><span data-stu-id="204a9-198">Specifying the backup\_name creates a snapshot of the following volumes:</span></span>

- <span data-ttu-id="204a9-199">hana/data</span><span class="sxs-lookup"><span data-stu-id="204a9-199">hana/data</span></span>
- <span data-ttu-id="204a9-200">hana/log</span><span class="sxs-lookup"><span data-stu-id="204a9-200">hana/log</span></span>
- <span data-ttu-id="204a9-201">hana/log\_backup (montato come backup in hana/log)</span><span class="sxs-lookup"><span data-stu-id="204a9-201">hana/log\_backup (mounted as backup into hana/log)</span></span>
- <span data-ttu-id="204a9-202">hana/shared</span><span class="sxs-lookup"><span data-stu-id="204a9-202">hana/shared</span></span>

### <a name="storage-snapshot-considerations"></a><span data-ttu-id="204a9-203">Considerazioni sugli snapshot di archiviazione</span><span class="sxs-lookup"><span data-stu-id="204a9-203">Storage snapshot considerations</span></span>

>[!NOTE]
><span data-ttu-id="204a9-204">Gli snapshot di archiviazione _non_ vengono forniti gratuitamente perché richiedono l'allocazione di spazio di archiviazione aggiuntivo.</span><span class="sxs-lookup"><span data-stu-id="204a9-204">Storage snapshots are _not_ provided free of charge, because additional storage space must be allocated.</span></span>

<span data-ttu-id="204a9-205">I meccanismi specifici degli snapshot di archiviazione per SAP HANA in Azure (istanze di grandi dimensioni) comprendono:</span><span class="sxs-lookup"><span data-stu-id="204a9-205">The specific mechanics of storage snapshots for SAP HANA on Azure (large instances) include:</span></span>

- <span data-ttu-id="204a9-206">Nel momento in cui viene creato, uno specifico snapshot di archiviazione usa una quantità di spazio molto limitata.</span><span class="sxs-lookup"><span data-stu-id="204a9-206">A specific storage snapshot (at the point in time when it is taken) consumes very little storage.</span></span>
- <span data-ttu-id="204a9-207">A mano a mano che il contenuto dei dati cambia e il contenuto dei file di dati di SAP HANA viene modificato nel volume di archiviazione, lo snapshot deve archiviare il contenuto dei blocchi originali.</span><span class="sxs-lookup"><span data-stu-id="204a9-207">As data content changes and the content in SAP HANA data files change on the storage volume, the snapshot needs to store the original block content.</span></span>
- <span data-ttu-id="204a9-208">Le dimensioni dello snapshot di archiviazione aumentano progressivamente</span><span class="sxs-lookup"><span data-stu-id="204a9-208">The storage snapshot increases in size.</span></span> <span data-ttu-id="204a9-209">in proporzione alla durata.</span><span class="sxs-lookup"><span data-stu-id="204a9-209">The longer the snapshot exists, the larger the storage snapshot becomes.</span></span>
- <span data-ttu-id="204a9-210">Quante più modifiche vengono apportate al volume del database SAP HANA per tutta la durata di uno snapshot di archiviazione, tanto più grande diventa lo spazio utilizzato da tale snapshot.</span><span class="sxs-lookup"><span data-stu-id="204a9-210">The more changes made to the SAP HANA database volume over the lifetime of a storage snapshot, the larger the space consumption of the storage snapshot becomes.</span></span>

<span data-ttu-id="204a9-211">SAP HANA in Azure (istanze di grandi dimensioni) viene fornito con volumi di dimensioni fisse per l'archiviazione di dati e log.</span><span class="sxs-lookup"><span data-stu-id="204a9-211">SAP HANA on Azure (large instances) comes with fixed volume sizes for the SAP HANA data and log volume.</span></span> <span data-ttu-id="204a9-212">Con l'esecuzione di snapshot si utilizza spazio sui volumi ed è quindi responsabilità del cliente pianificare gli snapshot di archiviazione, nell'ambito del processo di SAP HANA in Azure (istanze di grandi dimensioni).</span><span class="sxs-lookup"><span data-stu-id="204a9-212">Performing snapshots of those volumes eats into your volume space, so it is your responsibility to schedule storage snapshots (within the SAP HANA on Azure [large instances] process).</span></span>

<span data-ttu-id="204a9-213">Le sezioni seguenti includono informazioni per l'esecuzione di questi snapshot oltre a consigli di carattere generale:</span><span class="sxs-lookup"><span data-stu-id="204a9-213">The following sections provide information for performing these snapshots, including general recommendations:</span></span>

- <span data-ttu-id="204a9-214">Anche se l'hardware può supportare 255 snapshot per volume, è consigliabile rimanere ben al di sotto di questa cifra.</span><span class="sxs-lookup"><span data-stu-id="204a9-214">Though the hardware can sustain 255 snapshots per volume, we highly recommend that you stay well below this number.</span></span>
- <span data-ttu-id="204a9-215">Prima di eseguire snapshot di archiviazione, monitorare e tenere traccia dello spazio libero.</span><span class="sxs-lookup"><span data-stu-id="204a9-215">Before you perform storage snapshots, monitor and keep track of free space.</span></span>
- <span data-ttu-id="204a9-216">Limitare il numero di snapshot di archiviazione in base allo spazio disponibile.</span><span class="sxs-lookup"><span data-stu-id="204a9-216">Lower the number of storage snapshots based on free space.</span></span> <span data-ttu-id="204a9-217">Potrebbe essere necessario ridurre il numero di snapshot conservati o potrebbe essere necessario estendere i volumi.</span><span class="sxs-lookup"><span data-stu-id="204a9-217">You might need to lower the number of snapshots that you keep, or you might need to extend the volumes.</span></span> <span data-ttu-id="204a9-218">È possibile ordinare ulteriore spazio di archiviazione in unità di 1 TB.</span><span class="sxs-lookup"><span data-stu-id="204a9-218">(You can order additional storage in 1-TB units.)</span></span>
- <span data-ttu-id="204a9-219">Durante determinate attività, come lo spostamento di dati in SAP HANA con strumenti di migrazione del sistema (R3load o la funzionalità per il ripristino di backup di database SAP HANA), è consigliabile non creare snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-219">During activities such as moving data into SAP HANA with system migration tools (with R3load, or by restoring SAP HANA databases from backups), we highly recommended that you not perform any storage snapshots.</span></span> <span data-ttu-id="204a9-220">Se viene eseguita una migrazione di sistema in un nuovo sistema SAP HANA, non è necessario creare snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-220">(If a system migration is being done on a new SAP HANA system, storage snapshots would not need to be performed.)</span></span>
- <span data-ttu-id="204a9-221">Durante una riorganizzazione più estesa delle tabelle di SAP HANA, evitare di creare snapshot di archiviazione, se possibile.</span><span class="sxs-lookup"><span data-stu-id="204a9-221">During larger reorganizations of SAP HANA tables, storage snapshots should be avoided if possible.</span></span>
- <span data-ttu-id="204a9-222">Gli snapshot di archiviazione sono inoltre un prerequisito per attivare le funzionalità di ripristino di emergenza di SAP HANA in Azure (istanze di grandi dimensioni).</span><span class="sxs-lookup"><span data-stu-id="204a9-222">Storage snapshots are a prerequisite to engaging the disaster-recovery capabilities of SAP HANA on Azure (large instances).</span></span>

### <a name="setting-up-storage-snapshots"></a><span data-ttu-id="204a9-223">Configurazione degli snapshot di archiviazione</span><span class="sxs-lookup"><span data-stu-id="204a9-223">Setting up storage snapshots</span></span>

1. <span data-ttu-id="204a9-224">Assicurarsi che Perl sia installato nel sistema operativo Linux sul server HANA (istanze di grandi dimensioni).</span><span class="sxs-lookup"><span data-stu-id="204a9-224">Make sure that Perl is installed in the Linux operating system on the HANA (large instances) server.</span></span>
2. <span data-ttu-id="204a9-225">Modificare /etc/ssh/ssh\_config in modo da aggiungere la riga _MACs hmac-sha1_.</span><span class="sxs-lookup"><span data-stu-id="204a9-225">Modify /etc/ssh/ssh\_config to add the line _MACs hmac-sha1_.</span></span>
3. <span data-ttu-id="204a9-226">Creare un account utente di backup di SAP HANA sul nodo master per ogni istanza SAP HANA in esecuzione (se applicabile).</span><span class="sxs-lookup"><span data-stu-id="204a9-226">Create an SAP HANA backup user account on the master node for each SAP HANA instance you are running (if applicable).</span></span>
4. <span data-ttu-id="204a9-227">Il client HDB di SAP HANA deve essere installato in tutti i server SAP HANA (istanze di grandi dimensioni).</span><span class="sxs-lookup"><span data-stu-id="204a9-227">The SAP HANA HDB client must be installed on all SAP HANA (large instances) servers.</span></span>
5. <span data-ttu-id="204a9-228">Nel primo server SAP HANA (istanze di grandi dimensioni) di ogni area è necessario creare una chiave pubblica per accedere all'infrastruttura di archiviazione sottostante che controlla la creazione di snapshot.</span><span class="sxs-lookup"><span data-stu-id="204a9-228">On the first SAP HANA (large instances) server of each region, a public key must be created to access the underlying storage infrastructure that controls snapshot creation.</span></span>
6. <span data-ttu-id="204a9-229">Copiare lo script azure\_hana\_backup.pl da /scripts nel percorso di **hdbsql** nell'installazione di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-229">Copy the script azure\_hana\_backup.pl from /scripts to the location of **hdbsql** of the SAP HANA installation.</span></span>
7. <span data-ttu-id="204a9-230">Copiare il file HANABackupDetails.txt dalla cartella /scripts nello stesso percorso dello script Perl.</span><span class="sxs-lookup"><span data-stu-id="204a9-230">Copy the HANABackupDetails.txt file from /scripts to the same location as the Perl script.</span></span>
8. <span data-ttu-id="204a9-231">Modificare il file HANABackupDetails.txt come necessario, in base alle specifiche del cliente.</span><span class="sxs-lookup"><span data-stu-id="204a9-231">Modify the HANABackupDetails.txt file as necessary for the appropriate customer specifications.</span></span>

### <a name="step-1-install-sap-hana-hdbclient"></a><span data-ttu-id="204a9-232">Passaggio 1: Installare il client HBD di SAP HANA</span><span class="sxs-lookup"><span data-stu-id="204a9-232">Step 1: Install SAP HANA HDBClient</span></span>

<span data-ttu-id="204a9-233">La distribuzione di Linux installata in SAP HANA in Azure (istanze di grandi dimensioni) include le cartelle e gli script necessari per eseguire snapshot di archiviazione di SAP HANA a scopo di backup e ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="204a9-233">The Linux installed on SAP HANA on Azure (large instances) includes the folders and scripts necessary to execute SAP HANA storage snapshots for backup and disaster-recovery purposes.</span></span> <span data-ttu-id="204a9-234">È tuttavia responsabilità del cliente installare il client HBD durante l'installazione di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-234">However, it is your responsibility to install SAP HANA HDBclient while you are installing SAP HANA.</span></span> <span data-ttu-id="204a9-235">Il client HDB e SAP HANA non vengono installati da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="204a9-235">(Microsoft installs neither the HDBclient nor SAP HANA.)</span></span>

### <a name="step-2-change-etcsshsshconfig"></a><span data-ttu-id="204a9-236">Passaggio 2: Modificare /etc/ssh/ssh\_config</span><span class="sxs-lookup"><span data-stu-id="204a9-236">Step 2: Change /etc/ssh/ssh\_config</span></span>

<span data-ttu-id="204a9-237">Modificare /etc/ssh/ssh\_config aggiungendo la riga _MACs hmac-sha1_ come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="204a9-237">Change /etc/ssh/ssh\_config by adding _MACs hmac-sha1_ line as shown here:</span></span>
```
#   RhostsRSAAuthentication no
#   RSAAuthentication yes
#   PasswordAuthentication yes
#   HostbasedAuthentication no
#   GSSAPIAuthentication no
#   GSSAPIDelegateCredentials no
#   GSSAPIKeyExchange no
#   GSSAPITrustDNS no
#   BatchMode no
#   CheckHostIP yes
#   AddressFamily any
#   ConnectTimeout 0
#   StrictHostKeyChecking ask
#   IdentityFile ~/.ssh/identity
#   IdentityFile ~/.ssh/id_rsa
#   IdentityFile ~/.ssh/id_dsa
#   Port 22
Protocol 2
#   Cipher 3des
#   Ciphers aes128-ctr,aes192-ctr,aes256-ctr,arcfour256,arcfour128,aes128-cbc,3des-cbc
#   MACs hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160
MACs hmac-sha1
#   EscapeChar ~
#   Tunnel no
#   TunnelDevice any:any
#   PermitLocalCommand no
#   VisualHostKey no
#   ProxyCommand ssh -q -W %h:%p gateway.example.com
```

### <a name="step-3-create-a-public-key"></a><span data-ttu-id="204a9-238">Passaggio 3: Creare una chiave pubblica</span><span class="sxs-lookup"><span data-stu-id="204a9-238">Step 3: Create a public key</span></span>

<span data-ttu-id="204a9-239">Nel primo server SAP HANA in Azure (istanze di grandi dimensioni) in ogni area di Azure creare una chiave pubblica da usare per accedere all'infrastruttura di archiviazione in modo da poter creare gli snapshot.</span><span class="sxs-lookup"><span data-stu-id="204a9-239">On the first SAP HANA on Azure (large instances) server in each Azure region, create a public key to be used to access the storage infrastructure so that you can create snapshots.</span></span> <span data-ttu-id="204a9-240">La chiave pubblica evita di dover usare una password per accedere alla risorsa di archiviazione e dover gestire le credenziali di accesso.</span><span class="sxs-lookup"><span data-stu-id="204a9-240">The public key ensures that a password is not required to sign in to the storage and that password credentials are not maintained.</span></span> <span data-ttu-id="204a9-241">In Linux, nel server SAP HANA (istanze di grandi dimensioni), eseguire il comando seguente per generare la chiave pubblica:</span><span class="sxs-lookup"><span data-stu-id="204a9-241">In Linux on the SAP HANA (large instances) server, execute the following command to generate the public key:</span></span>
```
  ssh-keygen –t dsa –b 1024
```
<span data-ttu-id="204a9-242">Il nuovo percorso è _/root/.ssh/id\_dsa.pub.</span><span class="sxs-lookup"><span data-stu-id="204a9-242">The new location is _/root/.ssh/id\_dsa.pub.</span></span> <span data-ttu-id="204a9-243">Non immettere una passphrase effettiva, altrimenti sarà necessario immetterla a ogni accesso.</span><span class="sxs-lookup"><span data-stu-id="204a9-243">Do not enter an actual passphrase, or else you will be required to enter the passphrase each time you sign in.</span></span> <span data-ttu-id="204a9-244">In alternativa, premere due volte **INVIO** per evitare che venga richiesta una passphrase in fase di accesso.</span><span class="sxs-lookup"><span data-stu-id="204a9-244">Instead, press **Enter** twice to remove the enter passphrase requirement for signing in.</span></span>

<span data-ttu-id="204a9-245">Verificare che la chiave pubblica sia corretta cambiando le cartelle in /root/.ssh/ e poi eseguendo il comando **ls**.</span><span class="sxs-lookup"><span data-stu-id="204a9-245">Check to make sure that the public key was corrected as expected by changing folders to /root/.ssh/ and then executing the **ls** command.</span></span> <span data-ttu-id="204a9-246">Se la chiave è presente, è possibile copiarla eseguendo il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="204a9-246">If the key is present, you can copy it by running the following command:</span></span>

![La chiave pubblica viene copiata eseguendo questo comando](./media/hana-overview-high-availability-disaster-recovery/image2-public-key.png)

<span data-ttu-id="204a9-248">A questo punto, contattare il team di gestione dei servizi SAP HANA in Azure e specificare la chiave,</span><span class="sxs-lookup"><span data-stu-id="204a9-248">At this point, contact SAP HANA on Azure Service Management and provide the key.</span></span> <span data-ttu-id="204a9-249">che verrà usata dal rappresentante del servizio per la registrazione nell'infrastruttura di archiviazione sottostante.</span><span class="sxs-lookup"><span data-stu-id="204a9-249">The service representative uses the public key to register it in the underlying storage infrastructure.</span></span>

### <a name="step-4-create-an-sap-hana-user-account"></a><span data-ttu-id="204a9-250">Passaggio 4: Creare un account utente SAP HANA</span><span class="sxs-lookup"><span data-stu-id="204a9-250">Step 4: Create an SAP HANA user account</span></span>

<span data-ttu-id="204a9-251">In SAP HANA Studio creare un account utente SAP HANA a scopo di backup.</span><span class="sxs-lookup"><span data-stu-id="204a9-251">Create an SAP HANA user account within SAP HANA Studio for backup purposes.</span></span> <span data-ttu-id="204a9-252">L'account deve disporre dei privilegi _Backup Admin_ e _Catalog Read_.</span><span class="sxs-lookup"><span data-stu-id="204a9-252">This account must have the following privileges: _Backup Admin_ and _Catalog Read_.</span></span> <span data-ttu-id="204a9-253">In questo esempio viene creato il nome utente SCADMIN.</span><span class="sxs-lookup"><span data-stu-id="204a9-253">In this example, the username SCADMIN is created.</span></span>

![Creazione di un utente in HANA Studio](./media/hana-overview-high-availability-disaster-recovery/image3-creating-user.png)

### <a name="step-5-authorize-the-sap-hana-user-account"></a><span data-ttu-id="204a9-255">Passaggio 5: Autorizzare l'account utente SAP HANA</span><span class="sxs-lookup"><span data-stu-id="204a9-255">Step 5: Authorize the SAP HANA user account</span></span>

<span data-ttu-id="204a9-256">Autorizzare l'account utente SAP HANA in modo che possa essere usato senza richiesta di autorizzazione ogni volta che viene eseguito lo script.</span><span class="sxs-lookup"><span data-stu-id="204a9-256">Authorize the SAP HANA user account (to be used by the scripts without requiring authorization every time the script is run).</span></span> <span data-ttu-id="204a9-257">Il comando `hdbuserstore` di SAP HANA consente la creazione di una chiave utente SAP HANA, che viene archiviata in uno o più nodi di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-257">The SAP HANA command `hdbuserstore` allows the creation of an SAP HANA user key, which is stored on one or more SAP HANA nodes.</span></span> <span data-ttu-id="204a9-258">La chiave utente consente anche di accedere a SAP HANA senza dover gestire le password dall'interno del processo di scripting che verrà discusso più avanti.</span><span class="sxs-lookup"><span data-stu-id="204a9-258">The user key also allows the user to access SAP HANA without having to manage passwords from within the scripting process that's discussed later.</span></span>

>[!IMPORTANT]
><span data-ttu-id="204a9-259">Eseguire il comando indicato di seguito come `_root_`.</span><span class="sxs-lookup"><span data-stu-id="204a9-259">Run the following command as `_root_`.</span></span> <span data-ttu-id="204a9-260">Altrimenti lo script non funzionerà correttamente.</span><span class="sxs-lookup"><span data-stu-id="204a9-260">Otherwise, the script cannot work properly.</span></span>

<span data-ttu-id="204a9-261">Immettere il comando `hdbuserstore` come segue:</span><span class="sxs-lookup"><span data-stu-id="204a9-261">Enter the `hdbuserstore` command as follows:</span></span>

![Immettere il comando hdbuserstore](./media/hana-overview-high-availability-disaster-recovery/image4-hdbuserstore-command.png)

<span data-ttu-id="204a9-263">Nell'esempio seguente, in cui l'utente è SCADMIN01 e il nome host è lhanad01, il comando è:</span><span class="sxs-lookup"><span data-stu-id="204a9-263">In the following example, where the user is SCADMIN01 and the hostname is lhanad01, the command is:</span></span>
```
hdbuserstore set SCADMIN01 lhanad01:30115 <backup username> <password>
```
<span data-ttu-id="204a9-264">Gestire tutti gli script da un singolo server per le istanze HANA con scalabilità orizzontale.</span><span class="sxs-lookup"><span data-stu-id="204a9-264">Manage all scripting from a single server for scale-out HANA instances.</span></span> <span data-ttu-id="204a9-265">In questo esempio la chiave di SAP HANA SCADMIN01 deve essere modificata per ogni host in modo che rifletta l'host correlato alla chiave.</span><span class="sxs-lookup"><span data-stu-id="204a9-265">In this example, the SAP HANA key SCADMIN01 must be altered for each host in a way that reflects the host that is related to the key.</span></span> <span data-ttu-id="204a9-266">In altre parole, l'account di backup SAP HANA viene modificato con il numero di istanza di HANA DB, **lhanad**.</span><span class="sxs-lookup"><span data-stu-id="204a9-266">That is, the SAP HANA backup account is amended with the instance number of the HANA DB, **lhanad**.</span></span> <span data-ttu-id="204a9-267">La chiave deve avere privilegi amministrativi sull'host a cui è assegnata e l'utente di backup per la scalabilità orizzontale deve disporre dei diritti di accesso a tutte le istanze SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-267">The key must have administrative privileges on the host it is assigned to, and the backup user for scale-out must have access rights to all SAP HANA instances.</span></span>
```
hdbuserstore set SCADMIN01 lhanad:30015 SCADMIN <password>
hdbuserstore set SCADMIN02 lhanad:30115 SCADMIN <password>
hdbuserstore set SCADMIN03 lhanad:30215 SCADMIN <password>
```

### <a name="step-6-copy-items-from-the-scripts-folder"></a><span data-ttu-id="204a9-268">Passaggio 6: Copiare elementi dalla cartella /scripts</span><span class="sxs-lookup"><span data-stu-id="204a9-268">Step 6: Copy items from the /scripts folder</span></span>

<span data-ttu-id="204a9-269">Copiare gli elementi seguenti dalla cartella /scripts, inclusa nell'immagine gold dell'installazione, alla directory di lavoro per **hdbsql**.</span><span class="sxs-lookup"><span data-stu-id="204a9-269">Copy the following items from the /scripts folder (included on the gold image of the installation) to the working directory for **hdbsql**.</span></span> <span data-ttu-id="204a9-270">Per le installazioni correnti di HANA, la directory è /hana/shared/D01/exe/linuxx86\_64/hdb.</span><span class="sxs-lookup"><span data-stu-id="204a9-270">For current HANA installations, this directory is /hana/shared/D01/exe/linuxx86\_64/hdb.</span></span>
```
azure\_hana\_backup.pl
testHANAConnection.pl
testStorageSnapshotConnection.pl
removeTestStorageSnapshot.pl
HANABackupCustomerDetails.txt
```
<span data-ttu-id="204a9-271">Nel caso di una configurazione con scalabilità orizzontale o OLAP, copiare gli elementi seguenti:</span><span class="sxs-lookup"><span data-stu-id="204a9-271">Copy the following items if they are running scale-out or OLAP:</span></span>
```
azure\_hana\_backup\_bw.pl
testHANAConnectionBW.pl
testStorageSnapshotConnectionBW.pl
removeTestStorageSnapshotBW.pl
HANABackupCustomerDetailsBW.txt
```
<span data-ttu-id="204a9-272">Il file HANABackupCustomerDetails.txt può essere modificato come indicato di seguito per una distribuzione con scalabilità verticale.</span><span class="sxs-lookup"><span data-stu-id="204a9-272">The HANABackupCustomerDetails.txt file is modifiable as follows for a scale-up deployment.</span></span> <span data-ttu-id="204a9-273">Si tratta del file di configurazione e controllo per lo script che eseguirà gli snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-273">It is the control and configuration file for the script that runs the storage snapshots.</span></span> <span data-ttu-id="204a9-274">Quando le istanze sono state distribuite, il team di gestione dei servizi di SAP HANA in Azure dovrebbe avere inviato i valori di _Storage Backup Name_ e _Storage IP Address_.</span><span class="sxs-lookup"><span data-stu-id="204a9-274">You should have received the _Storage Backup Name_ and _Storage IP Address_ from SAP HANA on Azure Service Management when your instances were deployed.</span></span> <span data-ttu-id="204a9-275">Non è possibile modificare la sequenza, l'ordinamento o la spaziatura per nessuna delle variabili, altrimenti lo script non funzionerà correttamente.</span><span class="sxs-lookup"><span data-stu-id="204a9-275">You cannot modify the sequence, ordering, or spacing of any of the variables, or the script does not run properly.</span></span>

<span data-ttu-id="204a9-276">Per una distribuzione con scalabilità verticale, il file di configurazione ha un aspetto simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="204a9-276">For a scale-up deployment, the configuration file would look like:</span></span>
```
#Provided by Microsoft Service Management
Storage Backup Name: lhanad01backup
Storage IP Address: 10.250.20.21
#Created by customer using hdbuserstore
HANA Backup Name: SCADMIND01
```
<span data-ttu-id="204a9-277">Per una configurazione con scalabilità orizzontale, il file HANABackupCustomerDetailsBW.txt ha un aspetto simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="204a9-277">For a scale-out configuration, the HANABackupCustomerDetailsBW.txt file would look like:</span></span>
```
#Provided by Microsoft Service Management
Storage Backup Name: lhanad01backup
Storage IP Address: 10.250.20.21
#Node IP addresses, instance numbers, and HANA backup name
#provided by customer.  HANA backup name created using
#hdbuserstore utility.
Node 1 IP Address: 10.254.15.21
Node 1 HANA instance number: 01
Node 1 HANA Backup Name: SCADMIN01
Node 2 IP Address: 10.254.15.22
Node 2 HANA instance number: 02
Node 2 HANA Backup Name: SCADMIN02
Node 3 IP Address: 10.254.15.23
Node 3 HANA instance number: 03
Node 3 HANA Backup Name: SCADMIN03
Node 4 IP Address: 10.254.15.24
Node 4 HANA instance number: 04
Node 4 HANA Backup Name: SCADMIN04
Node 5 IP Address: 10.254.15.25
Node 5 HANA instance number: 05
Node 5 HANA Backup Name: SCADMIN05
Node 6 IP Address: 10.254.15.26
Node 6 HANA instance number: 06
Node 6 HANA Backup Name: SCADMIN06
Node 7 IP Address: 10.254.15.27
Node 7 HANA instance number: 07
Node 7 HANA Backup Name: SCADMIN07
Node 8 IP Address: 10.254.15.28
Node 8 HANA instance number: 08
Node 8 HANA Backup Name: SCADMIN08
```
>[!NOTE]
><span data-ttu-id="204a9-278">Attualmente solo i dettagli del nodo 1 vengono usati nell'effettivo script per lo snapshot di archiviazione HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-278">Currently, only Node 1 details are used in the actual HANA storage snapshot script.</span></span> <span data-ttu-id="204a9-279">Si consiglia di testare l'accesso da e verso tutti i nodi HANA in modo che, se il nodo di backup master dovesse cambiare, è già stato verificato che un altro nodo può prendere il suo posto modificando i dettagli nel nodo 1.</span><span class="sxs-lookup"><span data-stu-id="204a9-279">We recommend that you test access to or from all HANA nodes so that, if the master backup node ever changes, you have already ensured that any other node can take its place by modifying the details in Node 1.</span></span>

<span data-ttu-id="204a9-280">Per verificare le configurazioni corrette nel file di configurazione o il funzionamento della connessione alle istanze HANA, eseguire uno dei seguenti script:</span><span class="sxs-lookup"><span data-stu-id="204a9-280">To check for the correct configurations in the configuration file or proper connectivity to the HANA instances, run either of the following scripts:</span></span>
- <span data-ttu-id="204a9-281">Per una configurazione con scalabilità verticale (indipendente dal carico di lavoro SAP):</span><span class="sxs-lookup"><span data-stu-id="204a9-281">For a scale-up configuration (independent on SAP workload):</span></span>

 ```
testHANAConnection.pl
```
- <span data-ttu-id="204a9-282">Per una configurazioni con scalabilità orizzontale:</span><span class="sxs-lookup"><span data-stu-id="204a9-282">For a scale-out configuration:</span></span>

 ```
testHANAConnectionBW.pl
```

<span data-ttu-id="204a9-283">Verificare che l'istanza HANA master abbia accesso a tutti i server HANA necessari.</span><span class="sxs-lookup"><span data-stu-id="204a9-283">Ensure that the master HANA instance has access to all required HANA servers.</span></span> <span data-ttu-id="204a9-284">Lo script non richiede parametri. Tuttavia, per la corretta esecuzione dello script, è necessario completare il file HANABackupCustomerDetails/ HANABackupCustomerDetailsBW appropriato.</span><span class="sxs-lookup"><span data-stu-id="204a9-284">There are no parameters to the script, but you must complete the appropriate HANABackupCustomerDetails/ HANABackupCustomerDetailsBW file for the script to run properly.</span></span> <span data-ttu-id="204a9-285">Poiché vengono restituiti solo i codici di errore dei comandi della shell, lo script non può eseguire il controllo degli errori di ogni istanza.</span><span class="sxs-lookup"><span data-stu-id="204a9-285">Because only the shell command error codes are returned, it is not possible for the script to error-check every instance.</span></span> <span data-ttu-id="204a9-286">Anche in questo caso lo script fornisce alcuni commenti che è utile controllare.</span><span class="sxs-lookup"><span data-stu-id="204a9-286">Even so, the script does provide some helpful comments for you to double-check.</span></span>

<span data-ttu-id="204a9-287">Per eseguire lo script:</span><span class="sxs-lookup"><span data-stu-id="204a9-287">To run the script:</span></span>
```
 ./testHANAConnection.pl
```
 <span data-ttu-id="204a9-288">Se lo script riesce a ottenere lo stato dell'istanza HANA, mostra un messaggio che conferma la riuscita della connessione HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-288">If the script successfully obtains the status of the HANA instance, it displays a message that the HANA connection was successful.</span></span>

<span data-ttu-id="204a9-289">Esiste anche un secondo tipo di script che consente di controllare se il server dell'istanza HANA master può accedere alla risorsa di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-289">Additionally, there is a second type of script you can use to check the master HANA instance server's ability to sign in to the storage.</span></span> <span data-ttu-id="204a9-290">Prima di eseguire lo script azure\_hana\_backup(\_bw).pl è necessario eseguire lo script seguente.</span><span class="sxs-lookup"><span data-stu-id="204a9-290">Before you execute the azure\_hana\_backup(\_bw).pl script, you must execute the next script.</span></span> <span data-ttu-id="204a9-291">Se un volume non contiene snapshot, non è possibile determinare se il volume è semplicemente vuoto o si è verificato un errore ssh che non consente di ottenere i dettagli dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="204a9-291">If a volume contains no snapshots, it is impossible to determine whether the volume is simply empty or there is an ssh failure to obtain the snapshot details.</span></span> <span data-ttu-id="204a9-292">Per questo motivo lo script esegue due passaggi:</span><span class="sxs-lookup"><span data-stu-id="204a9-292">For this reason, the script executes two steps:</span></span>

- <span data-ttu-id="204a9-293">Verifica che la console di archiviazione sia accessibile.</span><span class="sxs-lookup"><span data-stu-id="204a9-293">It verifies that the storage console is accessible.</span></span>
- <span data-ttu-id="204a9-294">Crea uno snapshot di test, o fittizio, per ogni volume di ogni istanza HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-294">It creates a test, or dummy, snapshot for each volume by HANA instance.</span></span>

<span data-ttu-id="204a9-295">Per questo motivo, l'istanza HANA è inclusa come argomento.</span><span class="sxs-lookup"><span data-stu-id="204a9-295">For this reason, the HANA instance is included as an argument.</span></span> <span data-ttu-id="204a9-296">Anche in questo caso non è possibile prevedere il controllo degli errori per la connessione di archiviazione, ma lo script fornisce suggerimenti utili se l'esecuzione ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="204a9-296">Again, it is not possible to provide error checking for the storage connection, but the script provides helpful hints if the execution fails.</span></span>

<span data-ttu-id="204a9-297">Lo script viene eseguito nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="204a9-297">The script is run as:</span></span>
```
 ./testStorageSnapshotConnection.pl <hana instance>
```
<span data-ttu-id="204a9-298">Oppure viene eseguito nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="204a9-298">Or it is run as:</span></span>
```
./testStorageSnapshotConnectionBW.pl <hana instance>
```
<span data-ttu-id="204a9-299">Lo script mostra anche un messaggio per segnalare che è possibile accedere in modo appropriato al tenant di archiviazione distribuita organizzato attorno ai numeri di unità logica (LUN) usati dalle istanze di server di cui si è proprietari.</span><span class="sxs-lookup"><span data-stu-id="204a9-299">The script also displays a message that you are able to sign in appropriately to your deployed storage tenant, which is organized around the logical unit numbers (LUNs) that are used by the server instances you own.</span></span>

<span data-ttu-id="204a9-300">Prima di eseguire i primi backup basati sugli snapshot di archiviazione, eseguire gli script seguenti per assicurarsi che la configurazione sia corretta.</span><span class="sxs-lookup"><span data-stu-id="204a9-300">Before you execute the first storage snapshot-based backups, run the next scripts to make sure that the configuration is correct.</span></span>

<span data-ttu-id="204a9-301">Dopo l'esecuzione di questi script, è possibile eliminare gli snapshot con lo script seguente:</span><span class="sxs-lookup"><span data-stu-id="204a9-301">After running these scripts, you can delete the snapshots by executing:</span></span>
```
./removeTestStorageSnapshot.pl <hana instance>
```
<span data-ttu-id="204a9-302">Oppure</span><span class="sxs-lookup"><span data-stu-id="204a9-302">Or</span></span>
```
./removeTestStorageSnapshot.pl <hana instance>
```

### <a name="step-7-perform-on-demand-snapshots"></a><span data-ttu-id="204a9-303">Passaggio 7: Eseguire snapshot su richiesta</span><span class="sxs-lookup"><span data-stu-id="204a9-303">Step 7: Perform on-demand snapshots</span></span>

<span data-ttu-id="204a9-304">Eseguire snapshot su richiesta (e pianificare snapshot regolari utilizzando cron) come descritto di seguito.</span><span class="sxs-lookup"><span data-stu-id="204a9-304">Perform on-demand snapshots (as well as schedule regular snapshots by using cron) as described here.</span></span>

<span data-ttu-id="204a9-305">Per le configurazioni con scalabilità verticale, eseguire lo script seguente:</span><span class="sxs-lookup"><span data-stu-id="204a9-305">For scale-up configurations, execute the following script:</span></span>
```
./azure_hana_backup.pl lhanad01 customer 20
```
<span data-ttu-id="204a9-306">Per le configurazioni con scalabilità orizzontale, eseguire lo script seguente:</span><span class="sxs-lookup"><span data-stu-id="204a9-306">For scale-out configurations, execute the following script:</span></span>
```
./azure_hana_backup_bw.pl lhanad01 customer 20
```
<span data-ttu-id="204a9-307">Lo script per la scalabilità orizzontale esegue alcuni controlli aggiuntivi per verificare che tutti i server HANA siano accessibili e che tutte le istanze HANA restituiscano lo stato appropriato prima di procedere con la creazione di snapshot di archiviazione o SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-307">The scale-out script does some additional checking to make sure that all HANA servers can be accessed, and all HANA instances return appropriate status of the instance before proceeding with creating SAP HANA or storage snapshots.</span></span>

<span data-ttu-id="204a9-308">Gli argomenti seguenti sono obbligatori:</span><span class="sxs-lookup"><span data-stu-id="204a9-308">The following arguments are required:</span></span>

- <span data-ttu-id="204a9-309">L'istanza HANA da sottoporre a backup.</span><span class="sxs-lookup"><span data-stu-id="204a9-309">The HANA instance requiring backup.</span></span>
- <span data-ttu-id="204a9-310">Il prefisso dello snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-310">The snapshot prefix for the storage snapshot.</span></span>
- <span data-ttu-id="204a9-311">Il numero di snapshot da mantenere per il prefisso specifico.</span><span class="sxs-lookup"><span data-stu-id="204a9-311">The number of snapshots to be kept for the specific prefix.</span></span>

```
./azure_hana_backup.pl lhanad01 customer 20
```

<span data-ttu-id="204a9-312">Il processo di creazione dello snapshot di archiviazione è costituito da queste tre fasi distinte:</span><span class="sxs-lookup"><span data-stu-id="204a9-312">The execution of the script creates the storage snapshot in these three distinct phases:</span></span>

- <span data-ttu-id="204a9-313">Eseguire uno snapshot HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-313">Execute a HANA snapshot.</span></span>
- <span data-ttu-id="204a9-314">Eseguire uno snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-314">Execute a storage snapshot.</span></span>
- <span data-ttu-id="204a9-315">Rimuovere lo snapshot HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-315">Remove the HANA snapshot.</span></span>

<span data-ttu-id="204a9-316">Per eseguire lo script, chiamarlo dalla cartella dell'eseguibile HDB in cui è stato copiato.</span><span class="sxs-lookup"><span data-stu-id="204a9-316">Execute the script by calling it from the HDB executable folder that it was copied to.</span></span> <span data-ttu-id="204a9-317">Lo script esegue sicuramente il backup dei volumi seguenti, ma anche di qualsiasi volume che include nel suo nome il nome di istanza SAP HANA esplicito.</span><span class="sxs-lookup"><span data-stu-id="204a9-317">It backs up at least the following volumes, but it also backs up any volume that has the explicit SAP HANA instance name in the volume name.</span></span>
```
hana_data_<hana instance>_prod_t020_vol
hana_log_<hana instance>_prod_t020_vol
hana_log_backup_<hana instance>_prod_t020_vol
hana_shared_<hana instance>_prod_t020_vol
```
<span data-ttu-id="204a9-318">Il periodo di mantenimento viene gestito rigorosamente in base al numero di snapshot specificato come parametro durante l'esecuzione dello script. Ad esempio 20, come indicato sopra.</span><span class="sxs-lookup"><span data-stu-id="204a9-318">The retention period is strictly administered, with the number of snapshots submitted as a parameter when you execute the script (such as 20, shown previously).</span></span> <span data-ttu-id="204a9-319">Pertanto, la quantità di tempo è calcolata in funzione del periodo di esecuzione e del numero di snapshot nella chiamata dello script.</span><span class="sxs-lookup"><span data-stu-id="204a9-319">So the amount of time is a function of the period of execution and the number of snapshots in the call of the script.</span></span> <span data-ttu-id="204a9-320">Se il numero di snapshot mantenuti supera il numero indicato come parametro nella chiamata dello script, lo snapshot di archiviazione meno recente di questa etichetta (_customer_ nel caso precedente) verrà eliminato prima dell'esecuzione di un nuovo snapshot.</span><span class="sxs-lookup"><span data-stu-id="204a9-320">If the number of snapshots that are kept exceeds the number that are named as a parameter in the call of the script, the oldest storage snapshot of this label (in our previous case, _custom_) is deleted before a new snapshot is executed.</span></span> <span data-ttu-id="204a9-321">Ciò significa che il numero specificato come ultimo parametro della chiamata è il numero che è possibile usare per controllare il numero di snapshot.</span><span class="sxs-lookup"><span data-stu-id="204a9-321">This means the number you give as the last parameter of the call is the number you can use to control the number of snapshots.</span></span>

>[!NOTE]
><span data-ttu-id="204a9-322">Non appena si modifica l'etichetta, il conteggio viene riavviato.</span><span class="sxs-lookup"><span data-stu-id="204a9-322">As soon as you change the label, the counting starts again.</span></span>

<span data-ttu-id="204a9-323">È necessario includere come argomento il nome dell'istanza HANA fornito dal team di gestione dei servizi SAP HANA in Azure se si creano snapshot di ambienti multinodo.</span><span class="sxs-lookup"><span data-stu-id="204a9-323">You need to include the HANA instance name that's provided by SAP HANA on Azure Service Management as an argument if they are creating snapshots in multi-node environments.</span></span> <span data-ttu-id="204a9-324">Negli ambienti a nodo singolo è sufficiente il nome nell'unità SAP HANA in Azure (istanza di grandi dimensioni), ma è comunque consigliabile specificare anche il nome dell'istanza HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-324">In single-node environments, the name of the SAP HANA on Azure (large instances) unit is sufficient, but the HANA instance name is still recommended.</span></span>

<span data-ttu-id="204a9-325">Inoltre è possibile eseguire il backup di volumi di avvio\LUN usando lo stesso script.</span><span class="sxs-lookup"><span data-stu-id="204a9-325">Additionally, you can back up boot volumes\LUNs by using the same script.</span></span> <span data-ttu-id="204a9-326">È necessario eseguire il backup del volume di avvio almeno una volta quando si esegue HANA per la prima volta, anche se è consigliabile pianificare backup settimanali o nelle ore notturne per tale volume tramite cron.</span><span class="sxs-lookup"><span data-stu-id="204a9-326">You must back up your boot volume at least once when you first run HANA, although we recommend a weekly or nightly backup schedule for booting in cron.</span></span> <span data-ttu-id="204a9-327">Anziché aggiungere il nome di un'istanza SAP HANA, inserire _boot_ come argomento dello script come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="204a9-327">Rather than add an SAP HANA instance name, insert _boot_ as the argument into the script as follows:</span></span>
```
./azure_hana_backup boot customer 20
```
<span data-ttu-id="204a9-328">Gli stessi criteri di mantenimento si applicano anche al volume di avvio.</span><span class="sxs-lookup"><span data-stu-id="204a9-328">The same retention policy is afforded to the boot volume as well.</span></span> <span data-ttu-id="204a9-329">Usare gli snapshot su richiesta, come descritto sopra, solo per casi speciali, ad esempio durante un aggiornamento di SAP Enhancement Package (EHP) o quando è necessario creare uno snapshot di archiviazione distinto.</span><span class="sxs-lookup"><span data-stu-id="204a9-329">Use on-demand snapshots, as described previously, for special cases only, such as during an SAP enhancement package (EHP) upgrade, or when you need to create a distinct storage snapshot.</span></span>

<span data-ttu-id="204a9-330">Si consiglia di eseguire snapshot di archiviazione pianificati tramite cron, nonché di usare lo stesso script per tutti i backup e le esigenze di ripristino di emergenza, modificando l'input dello script in base ai diversi orari di backup richiesti.</span><span class="sxs-lookup"><span data-stu-id="204a9-330">We encourage you to perform scheduled storage snapshots using cron, and we recommend that you use the same script for all backups and disaster-recovery needs (modifying the script inputs to match the various requested backup times).</span></span> <span data-ttu-id="204a9-331">Gli snapshot sono tutti pianificati in modo diverso in cron, in base alla frequenza di esecuzione: oraria, ogni 12 ore, giornaliera o settimanale.</span><span class="sxs-lookup"><span data-stu-id="204a9-331">These are all scheduled differently in cron depending on their execution time: hourly, 12-hour, daily, or weekly.</span></span> <span data-ttu-id="204a9-332">La pianificazione di cron è progettata in modo da creare snapshot di archiviazione che corrispondano alle etichette di mantenimento descritte in precedenza per il backup fuori sede a lungo termine.</span><span class="sxs-lookup"><span data-stu-id="204a9-332">The cron schedule is designed to create storage snapshots that match the previously discussed retention labeling for long-term off-site backup.</span></span> <span data-ttu-id="204a9-333">Lo script include comandi per eseguire il backup di tutti i volumi di produzione in base alla frequenza richiesta. Il backup dei file di dati e log viene eseguito ogni ora, mentre quello del volume di avvio viene eseguito ogni giorno.</span><span class="sxs-lookup"><span data-stu-id="204a9-333">The script includes commands to back up all production volumes, depending on their requested frequency (data and log files are backed up hourly, whereas the boot volume is backed up daily).</span></span>

<span data-ttu-id="204a9-334">Le voci nello script di cron seguente vengono eseguite ogni ora, ogni 12 ore e ogni giorno, sempre al decimo minuto.</span><span class="sxs-lookup"><span data-stu-id="204a9-334">The entries in the following cron script run every hour at the tenth minute, every 12 hours at the tenth minute, and daily at the tenth minute.</span></span> <span data-ttu-id="204a9-335">I processi di cron vengono creati in modo da eseguire un solo snapshot di archiviazione di SAP HANA a una determinata ora, evitando così di eseguire contemporaneamente il backup orario e quello giornaliero (alle ore 12.10).</span><span class="sxs-lookup"><span data-stu-id="204a9-335">The cron jobs are created in such a way that only one SAP HANA storage snapshot takes place during any particular hour, so that the hourly and daily backups do not occur at the same time (12:10 AM).</span></span> <span data-ttu-id="204a9-336">Per ottimizzare la creazione e la replica di snapshot, il team di gestione dei servizi SAP HANA in Azure fornirà suggerimenti riguardo ai tempi di esecuzione dei backup.</span><span class="sxs-lookup"><span data-stu-id="204a9-336">To help optimize your snapshot creation and replication, SAP HANA on Azure Service Management provides the recommended time for you to run your backups.</span></span>

<span data-ttu-id="204a9-337">Di seguito è indicata la pianificazione predefinita di cron in /etc/crontab:</span><span class="sxs-lookup"><span data-stu-id="204a9-337">The default cron scheduling in /etc/crontab is as follows:</span></span>
```
10 1-11,13-23 * * * ./azure_hana_backup.pl lhanad01 hourly 66
10 12 * * *  ./azure_hana_backup.pl lhanad01 12hour 14
```
<span data-ttu-id="204a9-338">Nelle istruzioni di cron sopra indicate lo snapshot dei volumi HANA (escluso il volume di avvio) viene creato ogni ora.</span><span class="sxs-lookup"><span data-stu-id="204a9-338">In the previous cron instructions, the HANA volumes (without boot volume) get an hourly snapshot with the label.</span></span> <span data-ttu-id="204a9-339">Di questi snapshot, ne vengono mantenuti 66.</span><span class="sxs-lookup"><span data-stu-id="204a9-339">Of these snapshots, 66 are retained.</span></span> <span data-ttu-id="204a9-340">Inoltre, vengono conservati 14 snapshot con l'etichetta di 12 ore.</span><span class="sxs-lookup"><span data-stu-id="204a9-340">Additionally, 14 snapshots with the 12-hour label are retained.</span></span> <span data-ttu-id="204a9-341">Si possono avere snapshot orari per tre giorni, oltre a snapshot ogni 12 ore per altri quattro giorni, ovvero un'intera settimana di snapshot.</span><span class="sxs-lookup"><span data-stu-id="204a9-341">You potentially get hourly snapshots for three days, plus 12-hour snapshots for another four days, which gives you an entire week of snapshots.</span></span>

<span data-ttu-id="204a9-342">La pianificazione in cron può risultare complessa poiché in un momento specifico è consentita l'esecuzione di un solo script, a meno che questo non sia sfalsato di alcuni minuti.</span><span class="sxs-lookup"><span data-stu-id="204a9-342">Scheduling within cron can be tricky, because only one script should be executed at any particular time, unless the scripts are staggered by several minutes.</span></span> <span data-ttu-id="204a9-343">Se si preferiscono i backup giornalieri per l'archiviazione a lungo termine, viene eseguito uno snapshot giornaliero insieme a uno snapshot ogni 12 ore, mantenendo sette backup per ciascun tipo. In alternativa, lo snapshot con frequenza oraria viene posticipato di 10 minuti.</span><span class="sxs-lookup"><span data-stu-id="204a9-343">If you want daily backups for long-term retention, either a daily snapshot is kept along with a 12-hour snapshot (with a retention count of seven each), or the hourly snapshot is staggered to take place 10 minutes later.</span></span> <span data-ttu-id="204a9-344">Un solo snapshot viene mantenuto nel volume di produzione.</span><span class="sxs-lookup"><span data-stu-id="204a9-344">Only one daily snapshot is kept in the production volume.</span></span>
```
10 1-11,13-23 * * * ./azure_hana_backup.pl lhanad01 hourly 66
10 12 * * *  ./azure_hana_backup.pl lhanad01 12hour 7
10 0 * * * ./azure_hana_backup.pl lhanad01 daily 7
```
<span data-ttu-id="204a9-345">Le frequenze elencate di seguito sono solo esempi.</span><span class="sxs-lookup"><span data-stu-id="204a9-345">The frequencies listed here are only examples.</span></span> <span data-ttu-id="204a9-346">Per ricavare il numero ottimale di snapshot, usare i criteri seguenti:</span><span class="sxs-lookup"><span data-stu-id="204a9-346">To derive your optimum number of snapshots, use the following criteria:</span></span>

- <span data-ttu-id="204a9-347">Requisiti dell'obiettivo tempo di ripristino per il ripristino temporizzato.</span><span class="sxs-lookup"><span data-stu-id="204a9-347">Requirements in recovery time objective for point-in-time recovery.</span></span>
- <span data-ttu-id="204a9-348">Utilizzo dello spazio.</span><span class="sxs-lookup"><span data-stu-id="204a9-348">Space usage.</span></span>
- <span data-ttu-id="204a9-349">Requisiti dell'obiettivo punto di ripristino e dell'obiettivo tempo di ripristino per un ripristino di emergenza potenziale.</span><span class="sxs-lookup"><span data-stu-id="204a9-349">Requirements in recovery point objective and recovery time objective for potential disaster recovery.</span></span>
- <span data-ttu-id="204a9-350">Eventuale esecuzione di backup completi del database HANA sui dischi.</span><span class="sxs-lookup"><span data-stu-id="204a9-350">Eventual execution of HANA full database backups against disks.</span></span> <span data-ttu-id="204a9-351">Ogni volta che viene creato un backup completo del database sui dischi o che viene eseguita l'interfaccia _backint_, l'esecuzione di snapshot di archiviazione ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="204a9-351">Whenever a full database backup against disks, or _backint_ interface, is performed, the execution of storage snapshots fails.</span></span> <span data-ttu-id="204a9-352">Se si pianifica l'esecuzione di backup completi del database oltre agli snapshot di archiviazione, assicurarsi che durante questo periodo l'esecuzione degli snapshot di archiviazione sia disabilitata.</span><span class="sxs-lookup"><span data-stu-id="204a9-352">If you plan to execute full database backups on top of storage snapshots, make sure that the execution of storage snapshots is disabled during this time.</span></span>

>[!IMPORTANT]
> <span data-ttu-id="204a9-353">L'uso di snapshot di archiviazione per i backup di SAP HANA è valido solo se gli snapshot vengono creati insieme ai backup dei log di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-353">The use of storage snapshots for SAP HANA backups is valid only when the snapshots are performed in conjunction with SAP HANA log backups.</span></span> <span data-ttu-id="204a9-354">Questi backup devono essere in grado di coprire i periodi di tempo che intercorrono tra gli snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-354">These log backups need to be able to cover the time periods between the storage snapshots.</span></span> <span data-ttu-id="204a9-355">Se agli utenti si è garantito un ripristino temporizzato di 30 giorni, è necessario che siano soddisfatti i requisiti seguenti:</span><span class="sxs-lookup"><span data-stu-id="204a9-355">If you've set a commitment to users of a point-in-time recovery of 30 days, you need the following:</span></span>

- <span data-ttu-id="204a9-356">Possibilità di accedere a uno snapshot di archiviazione di 30 giorni.</span><span class="sxs-lookup"><span data-stu-id="204a9-356">Ability to access a storage snapshot that is 30 days old.</span></span>
- <span data-ttu-id="204a9-357">Backup di log contigui nell'arco degli ultimi 30 giorni.</span><span class="sxs-lookup"><span data-stu-id="204a9-357">Contiguous log backups over the last 30 days.</span></span>

<span data-ttu-id="204a9-358">Nell'intervallo dei backup di log creare anche uno snapshot del volume dei log di backup.</span><span class="sxs-lookup"><span data-stu-id="204a9-358">In the range of log backups, create a snapshot of the backup log volume as well.</span></span> <span data-ttu-id="204a9-359">Assicurarsi tuttavia di eseguire backup regolari dei log in modo da poter:</span><span class="sxs-lookup"><span data-stu-id="204a9-359">However, be sure to perform regular log backups so that you can:</span></span>

- <span data-ttu-id="204a9-360">Disporre dei backup di log contigui necessari per eseguire ripristini temporizzati.</span><span class="sxs-lookup"><span data-stu-id="204a9-360">Have the contiguous log backups needed to perform point-in-time recoveries.</span></span>
- <span data-ttu-id="204a9-361">Evitare che il volume dei log di SAP HANA esaurisca lo spazio.</span><span class="sxs-lookup"><span data-stu-id="204a9-361">Prevent the SAP HANA log volume from running out of space.</span></span>

<span data-ttu-id="204a9-362">Uno degli ultimi passaggi consiste nel pianificare i log di backup di SAP HANA in SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="204a9-362">One of the last steps is to schedule SAP HANA backup logs in SAP HANA Studio.</span></span> <span data-ttu-id="204a9-363">La destinazione dei log di backup di SAP HANA è il volume hana/log\_backups appositamente creato con il punto di montaggio /hana/log/backups.</span><span class="sxs-lookup"><span data-stu-id="204a9-363">The SAP HANA backup log target destination is the specially created hana/log\_backups volume with the mount point of /hana/log/backups.</span></span>

![Pianificare i log di backup di SAP HANA in SAP HANA Studio](./media/hana-overview-high-availability-disaster-recovery/image5-schedule-backup.png)

<span data-ttu-id="204a9-365">È possibile scegliere backup con una frequenza maggiore di ogni 15 minuti.</span><span class="sxs-lookup"><span data-stu-id="204a9-365">You can choose backups that are more frequent than every 15 minutes.</span></span> <span data-ttu-id="204a9-366">Alcuni utenti eseguono il backup dei log ogni minuto, ma è sconsigliato impostare una frequenza _superiore_ a 15 minuti.</span><span class="sxs-lookup"><span data-stu-id="204a9-366">Some users even perform log backups every minute, although we do not recommend going _over_ 15 minutes.</span></span>

<span data-ttu-id="204a9-367">L'ultimo passaggio consiste nell'eseguire un backup basato su file (dopo l'installazione iniziale di SAP HANA) per creare una singola voce di backup che deve essere presente nel catalogo di backup.</span><span class="sxs-lookup"><span data-stu-id="204a9-367">The final step is to perform a file-based backup (after the initial installation of SAP HANA) to create a single backup entry that must exist within the backup catalog.</span></span> <span data-ttu-id="204a9-368">In caso contrario SAP HANA non può avviare i backup del log specificato.</span><span class="sxs-lookup"><span data-stu-id="204a9-368">Otherwise SAP HANA cannot initiate your specified log backups.</span></span>

![Eseguire un backup basato su file per creare una singola voce di backup](./media/hana-overview-high-availability-disaster-recovery/image6-make-backup.png)

### <a name="monitoring-the-number-and-size-of-snapshots-on-the-disk-volume"></a><span data-ttu-id="204a9-370">Monitoraggio del numero e della dimensione degli snapshot sul volume di archiviazione</span><span class="sxs-lookup"><span data-stu-id="204a9-370">Monitoring the number and size of snapshots on the disk volume</span></span>

<span data-ttu-id="204a9-371">Su un particolare volume di archiviazione è possibile monitorare il numero di snapshot e l'utilizzo dello spazio di archiviazione degli snapshot.</span><span class="sxs-lookup"><span data-stu-id="204a9-371">On a particular storage volume, you can monitor the number of snapshots and the storage consumption of snapshots.</span></span> <span data-ttu-id="204a9-372">Il comando `ls` non mostra i file e la directory degli snapshot,</span><span class="sxs-lookup"><span data-stu-id="204a9-372">The `ls` command doesn't show the snapshot directory or files.</span></span> <span data-ttu-id="204a9-373">diversamente dal comando `du` di Linux, che può essere eseguito con i parametri seguenti:</span><span class="sxs-lookup"><span data-stu-id="204a9-373">However, the Linux OS command `du` does, with the following commands:</span></span>

- <span data-ttu-id="204a9-374">`du –sh .snapshot` fornisce il totale di tutti gli snapshot all'interno della directory degli snapshot.</span><span class="sxs-lookup"><span data-stu-id="204a9-374">`du –sh .snapshot` provides a total of all snapshots within the snapshot directory.</span></span>
- <span data-ttu-id="204a9-375">`du –sh --max-depth=1` elenca tutti gli snapshot che vengono salvati nella cartella .snapshot e la dimensione di ciascuno.</span><span class="sxs-lookup"><span data-stu-id="204a9-375">`du –sh --max-depth=1` lists all snapshots that are saved in the .snapshot folder and the size of each snapshot.</span></span>
- <span data-ttu-id="204a9-376">`du –hc` fornisce la dimensione totale utilizzata da tutti gli snapshot.</span><span class="sxs-lookup"><span data-stu-id="204a9-376">`du –hc` provides the total size used by all snapshots.</span></span>

<span data-ttu-id="204a9-377">Usare questi comandi per assicurarsi che gli snapshot creati e archiviati non usino tutto lo spazio di archiviazione sui volumi.</span><span class="sxs-lookup"><span data-stu-id="204a9-377">Use these commands to make sure that the snapshots that are taken and stored are not consuming all the storage on the volumes.</span></span>

### <a name="reducing-the-number-of-snapshots-on-a-server"></a><span data-ttu-id="204a9-378">Riduzione del numero di snapshot in un server</span><span class="sxs-lookup"><span data-stu-id="204a9-378">Reducing the number of snapshots on a server</span></span>

<span data-ttu-id="204a9-379">Come illustrato in precedenza, è possibile ridurre il numero di snapshot archiviati con una determinata etichetta.</span><span class="sxs-lookup"><span data-stu-id="204a9-379">As explained earlier, you can reduce the number of certain labels of snapshots that you store.</span></span> <span data-ttu-id="204a9-380">Gli ultimi due parametri del comando per avviare uno snapshot sono un'etichetta e il numero di snapshot da mantenere.</span><span class="sxs-lookup"><span data-stu-id="204a9-380">The last two parameters of the command to initiate a snapshot are a label and the number of snapshots you want to retain.</span></span>
```
./azure_hana_backup.pl lhanad01 customer 20
```
<span data-ttu-id="204a9-381">Nell'esempio precedente l'etichetta dello snapshot è _customer_ e il numero di snapshot con questa etichetta da mantenere è _20_.</span><span class="sxs-lookup"><span data-stu-id="204a9-381">In the previous example, the snapshot label is _customer_ and the number of snapshots with this label to be retained is _20_.</span></span> <span data-ttu-id="204a9-382">Dovendo limitare l'uso dello spazio su disco, può essere opportuno ridurre il numero di snapshot archiviati.</span><span class="sxs-lookup"><span data-stu-id="204a9-382">As you respond to disk space consumption, you might want to reduce the number of stored snapshots.</span></span> <span data-ttu-id="204a9-383">Il modo più semplice per ridurre il numero di snapshot consiste nell'eseguire lo script con l'ultimo parametro impostato su 5:</span><span class="sxs-lookup"><span data-stu-id="204a9-383">The easy way to reduce the number of snapshots is to run the script with the last parameter set to 5:</span></span>
```
./azure_hana_backup.pl lhanad01 customer 5
```
<span data-ttu-id="204a9-384">Se si esegue lo script con questa impostazione, il numero di snapshot viene ridotto e pertanto il totale degli snapshot mantenuti, compreso quello nuovo, è _5_.</span><span class="sxs-lookup"><span data-stu-id="204a9-384">As a result of running the script with this setting, the number of snapshots, including the new storage snapshot, is _5_.</span></span>

 >[!NOTE]
 > <span data-ttu-id="204a9-385">Questo script consente di ridurre il numero di snapshot solo se lo snapshot precedente più recente è stato eseguito più di un'ora prima.</span><span class="sxs-lookup"><span data-stu-id="204a9-385">This script reduces the number of snapshots only if the most recent previous snapshot is more than one hour old.</span></span> <span data-ttu-id="204a9-386">Lo script non elimina gli snapshot che hanno meno di un'ora.</span><span class="sxs-lookup"><span data-stu-id="204a9-386">The script does not delete snapshots that are less than one hour old.</span></span>

<span data-ttu-id="204a9-387">Queste restrizioni sono correlate alla funzionalità di ripristino di emergenza facoltativa offerta.</span><span class="sxs-lookup"><span data-stu-id="204a9-387">These restrictions are related to the optional disaster-recovery functionality offered.</span></span>

<span data-ttu-id="204a9-388">Se non si desidera più mantenere un set di snapshot con tale prefisso, è possibile eseguire lo script con _0_ come numero di snapshot da mantenere per rimuovere tutti gli snapshot corrispondenti al prefisso.</span><span class="sxs-lookup"><span data-stu-id="204a9-388">If you no longer want to maintain a set of snapshots with that prefix, you can execute the script with _0_ as the retention number to remove all snapshots matching that prefix.</span></span> <span data-ttu-id="204a9-389">La rimozione di tutti gli snapshot può tuttavia influire sulle funzionalità di ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="204a9-389">However, removing all snapshots can affect the capabilities of disaster recovery.</span></span>

### <a name="recovering-to-the-most-recent-hana-snapshot"></a><span data-ttu-id="204a9-390">Ripristino in base allo snapshot HANA più recente</span><span class="sxs-lookup"><span data-stu-id="204a9-390">Recovering to the most recent HANA snapshot</span></span>

<span data-ttu-id="204a9-391">Se si riscontra un problema di inattività in fase di produzione, il processo di ripristino da uno snapshot di archiviazione può essere avviato come evento imprevisto del cliente con il team di gestione dei servizi SAP HANA in Azure.</span><span class="sxs-lookup"><span data-stu-id="204a9-391">In the event that you experience a production-down scenario, the process of recovering from a storage snapshot can be initiated as a customer incident with SAP HANA on Azure Service Management.</span></span> <span data-ttu-id="204a9-392">Un caso imprevisto di questo tipo potrebbe richiedere estrema urgenza se i dati sono stati eliminati in un sistema di produzione e l'unico modo per recuperare i dati è quello di ripristinare il database di produzione.</span><span class="sxs-lookup"><span data-stu-id="204a9-392">Such an unexpected scenario might be a high-urgency matter if data was deleted in a production system and the only way to retrieve the data is to restore the production database.</span></span>

<span data-ttu-id="204a9-393">Al contrario, un ripristino temporizzato può essere gestito come caso a bassa priorità e pianificato con diversi giorni di anticipo.</span><span class="sxs-lookup"><span data-stu-id="204a9-393">On the other hand, a point-in-time recovery could be low urgency and planned for days in advance.</span></span> <span data-ttu-id="204a9-394">È possibile pianificare questo ripristino con il team di gestione dei servizi SAP HANA in Azure anziché segnalare un problema ad alta priorità.</span><span class="sxs-lookup"><span data-stu-id="204a9-394">You can plan this recovery with SAP HANA on Azure Service Management instead of raising a high-priority issue.</span></span> <span data-ttu-id="204a9-395">Ad esempio si potrebbe pianificare un aggiornamento del software SAP con un nuovo Enhancement Package e successivamente dover eseguire il ripristino in base a uno snapshot che rappresenta lo stato precedente l'aggiornamento EHP.</span><span class="sxs-lookup"><span data-stu-id="204a9-395">For example, you might be planning to try an upgrade of the SAP software by applying a new enhancement package, and you then need to revert back to a snapshot that represents the state before the EHP upgrade.</span></span>

<span data-ttu-id="204a9-396">Prima di eseguire la richiesta è necessario completare alcune operazioni di preparazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-396">Before you issue the request, you need to do some preparation.</span></span> <span data-ttu-id="204a9-397">In questo modo il team di gestione dei servizi SAP HANA in Azure potrà gestire la richiesta e fornire i volumi ripristinati.</span><span class="sxs-lookup"><span data-stu-id="204a9-397">SAP HANA on Azure Service Management team can then handle the request and provide the restored volumes.</span></span> <span data-ttu-id="204a9-398">Sarà quindi responsabilità del cliente ripristinare il database HANA in base agli snapshot.</span><span class="sxs-lookup"><span data-stu-id="204a9-398">Afterward, it is up to you to restore the HANA database based on the snapshots.</span></span> <span data-ttu-id="204a9-399">Ecco come preparare la richiesta:</span><span class="sxs-lookup"><span data-stu-id="204a9-399">Here is how to prepare for the request:</span></span>

>[!NOTE]
><span data-ttu-id="204a9-400">L'interfaccia utente potrebbe essere diversa rispetto alle seguenti schermate, a seconda della versione di SAP HANA in uso.</span><span class="sxs-lookup"><span data-stu-id="204a9-400">Your user interface might vary from the following screenshots, depending on the SAP HANA release you are using.</span></span>

1. <span data-ttu-id="204a9-401">Scegliere lo snapshot da ripristinare.</span><span class="sxs-lookup"><span data-stu-id="204a9-401">Decide which snapshot to restore.</span></span> <span data-ttu-id="204a9-402">Viene ripristinato solo il volume hana/data, se non è diversamente specificato.</span><span class="sxs-lookup"><span data-stu-id="204a9-402">Only the hana/data volume would be restored unless you are instructed otherwise.</span></span>

2. <span data-ttu-id="204a9-403">Arrestare l'istanza HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-403">Shut down the HANA instance.</span></span>

 ![Arrestare l'istanza HANA](./media/hana-overview-high-availability-disaster-recovery/image7-shutdown-hana.png)

3. <span data-ttu-id="204a9-405">Smontare i volumi di dati in ogni nodo del database HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-405">Unmount the data volumes on each HANA database node.</span></span> <span data-ttu-id="204a9-406">Se i volumi di dati non sono smontati, il ripristino dello snapshot avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="204a9-406">The restoration of the snapshot fails if the data volumes are not unmounted.</span></span>

 ![Smontare i volumi di dati in ogni nodo del database HANA](./media/hana-overview-high-availability-disaster-recovery/image8-unmount-data-volumes.png)

4. <span data-ttu-id="204a9-408">Inviare una richiesta al supporto tecnico di Azure per il ripristino di uno snapshot specifico.</span><span class="sxs-lookup"><span data-stu-id="204a9-408">Open an Azure support request to instruct the restoration of a specific snapshot.</span></span>

 - <span data-ttu-id="204a9-409">Durante il ripristino: SAP HANA in Gestione servizi di Azure potrebbe chiedere di partecipare a una conferenza telefonica per evitare perdite di dati.</span><span class="sxs-lookup"><span data-stu-id="204a9-409">During the restoration: SAP HANA on Azure Service Management might ask you to attend a conference call to ensure that no data is getting lost.</span></span>

 - <span data-ttu-id="204a9-410">Dopo il ripristino: il team di gestione dei servizi SAP HANA in Azure invia una notifica per indicare quando è stato ripristinato lo snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-410">After the restoration: SAP HANA on Azure Service Management notifies you when the storage snapshot has been restored.</span></span>

5. <span data-ttu-id="204a9-411">Al termine del processo di ripristino montare nuovamente tutti i volumi di dati.</span><span class="sxs-lookup"><span data-stu-id="204a9-411">After the restoration process is complete, remount all data volumes.</span></span>

 ![Montare nuovamente tutti i volumi di dati](./media/hana-overview-high-availability-disaster-recovery/image9-remount-data-volumes.png)

6. <span data-ttu-id="204a9-413">Selezionare le opzioni di ripristino in SAP HANA Studio, se non vengono automaticamente visualizzate al momento della riconnessione al database HANA tramite SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="204a9-413">Select recovery options within SAP HANA Studio, if they do not automatically come up when you reconnect to HANA DB through SAP HANA Studio.</span></span> <span data-ttu-id="204a9-414">L'esempio seguente illustra un ripristino in base all'ultimo snapshot HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-414">The following example shows a restoration to the last HANA snapshot.</span></span> <span data-ttu-id="204a9-415">Uno snapshot di archiviazione incorpora un singolo snapshot HANA. Pertanto, se si esegue il ripristino in base all'ultimo snapshot di archiviazione, lo snapshot HANA ripristinato è quello più recente.</span><span class="sxs-lookup"><span data-stu-id="204a9-415">A storage snapshot embeds one HANA snapshot, and if you are restoring to the most recent storage snapshot, it should be the most recent HANA snapshot.</span></span> <span data-ttu-id="204a9-416">Se invece si esegue il ripristino in base a snapshot di archiviazione precedenti, è necessario individuare lo snapshot HANA basandosi sull'ora di creazione dello snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-416">(If you are restoring to older storage snapshots, you need to locate the HANA snapshot based on the time the storage snapshot was taken.)</span></span>

 ![Selezionare le opzioni di ripristino in SAP HANA Studio](./media/hana-overview-high-availability-disaster-recovery/image10-recover-options-a.png)

7. <span data-ttu-id="204a9-418">Selezionare **Recover the database to a specific data backup or storage snapshot** (Ripristina il database in base a un backup di dati o a uno snapshot di archiviazione specifico).</span><span class="sxs-lookup"><span data-stu-id="204a9-418">Select **Recover the database to a specific data backup or storage snapshot**.</span></span>

 ![La finestra "Specify Recovery Type" (Specifica tipo di ripristino)](./media/hana-overview-high-availability-disaster-recovery/image11-recover-options-b.png)

8. <span data-ttu-id="204a9-420">Scegliere **Specify backup without catalog** (Specifica il backup senza catalogo).</span><span class="sxs-lookup"><span data-stu-id="204a9-420">Select **Specify backup without catalog**.</span></span>

 ![La finestra "Specify Backup Location" (Specifica percorso backup)](./media/hana-overview-high-availability-disaster-recovery/image12-recover-options-c.png)

9. <span data-ttu-id="204a9-422">Nell'elenco **Destination Type** (Tipo di destinazione) selezionare **Snapshot**.</span><span class="sxs-lookup"><span data-stu-id="204a9-422">In the **Destination Type** list, select **Snapshot**.</span></span>

 ![La finestra "Specify the Backup to Recover" (Specifica il backup da ripristinare)](./media/hana-overview-high-availability-disaster-recovery/image13-recover-options-d.png)

10. <span data-ttu-id="204a9-424">Fare clic su **Finish** (Fine) per avviare il processo di ripristino.</span><span class="sxs-lookup"><span data-stu-id="204a9-424">Click **Finish** to start the recovery process.</span></span>

 ![Fare clic su "Finish" (Fine) per avviare il processo di ripristino](./media/hana-overview-high-availability-disaster-recovery/image14-recover-options-e.png)

11. <span data-ttu-id="204a9-426">Il database HANA viene ripristinato in base allo snapshot HANA incluso nello snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-426">The HANA database is restored and recovered to the HANA snapshot that's included in the storage snapshot.</span></span>

 ![Il database HANA viene ripristinato in base allo snapshot HANA](./media/hana-overview-high-availability-disaster-recovery/image15-recover-options-f.png)

### <a name="recovering-to-the-most-recent-state"></a><span data-ttu-id="204a9-428">Ripristino allo stato più recente</span><span class="sxs-lookup"><span data-stu-id="204a9-428">Recovering to the most recent state</span></span>

<span data-ttu-id="204a9-429">La procedura seguente ripristina lo snapshot HANA incluso nello snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-429">The following process restores the HANA snapshot that is included in the storage snapshot.</span></span> <span data-ttu-id="204a9-430">Quindi ripristina il backup del log delle transazioni allo stato più recente del database prima di ripristinare lo snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-430">It then restores the transaction log backups to the most recent state of the database before restoring the storage snapshot.</span></span>

>[!IMPORTANT]
><span data-ttu-id="204a9-431">Prima di procedere assicurarsi di avere una catena contigua e completa di backup dei log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="204a9-431">Before you proceed, make sure that you have a complete and contiguous chain of transaction log backups.</span></span> <span data-ttu-id="204a9-432">Senza questi backup non è possibile ripristinare lo stato corrente del database.</span><span class="sxs-lookup"><span data-stu-id="204a9-432">Without these backups, you cannot restore the current state of the database.</span></span>

1. <span data-ttu-id="204a9-433">Completare i passaggi da 1 a 6 della procedura precedente in "Ripristino in base allo snapshot HANA più recente".</span><span class="sxs-lookup"><span data-stu-id="204a9-433">Complete steps 1-6 of the preceding procedure in "Recovering to the most recent HANA snapshot."</span></span>

2. <span data-ttu-id="204a9-434">Selezionare **Recover the database to its most recent state** (Ripristina il database allo stato più recente).</span><span class="sxs-lookup"><span data-stu-id="204a9-434">Select **Recover the database to its most recent state**.</span></span>

 ![Selezionare "Recover the database to its most recent state" (Ripristina il database allo stato più recente)](./media/hana-overview-high-availability-disaster-recovery/image16-recover-database-a.png)

3. <span data-ttu-id="204a9-436">Specificare il percorso dei backup dei log di HANA più recenti.</span><span class="sxs-lookup"><span data-stu-id="204a9-436">Specify the location of the most recent HANA log backups.</span></span> <span data-ttu-id="204a9-437">Il percorso deve contenere tutti i backup dei log delle transazioni di HANA dallo snapshot HANA allo stato più recente.</span><span class="sxs-lookup"><span data-stu-id="204a9-437">The location needs to contain all HANA transaction log backups from the HANA snapshot to the most recent state.</span></span>

 ![Specificare il percorso dei backup dei log di HANA più recenti](./media/hana-overview-high-availability-disaster-recovery/image17-recover-database-b.png)

4. <span data-ttu-id="204a9-439">Selezionare un backup come base da cui ripristinare il database.</span><span class="sxs-lookup"><span data-stu-id="204a9-439">Select a backup as a base from which to recover the database.</span></span> <span data-ttu-id="204a9-440">Nell'esempio specifico si tratta dello snapshot HANA incluso nello snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-440">In our example, this is the HANA snapshot that was included in the storage snapshot.</span></span> <span data-ttu-id="204a9-441">Nella schermata seguente è indicato un solo snapshot.</span><span class="sxs-lookup"><span data-stu-id="204a9-441">(Only one snapshot is listed in the following screenshot.)</span></span>

 ![Selezionare un backup come base da cui ripristinare il database](./media/hana-overview-high-availability-disaster-recovery/image18-recover-database-c.png)

5. <span data-ttu-id="204a9-443">Deselezionare la casella di controllo **Use Delta Backups** (Usa backup differenziali) se non sono stati creati backup differenziali tra l'ora di creazione dello snapshot HANA e lo stato più recente.</span><span class="sxs-lookup"><span data-stu-id="204a9-443">Clear the **Use Delta Backups** check box if deltas do not exist between the time of the HANA snapshot and the most recent state.</span></span>

 ![Deselezionare la casella di controllo "Use Delta Backups" (Usa backup differenziali) se non esistono backup differenziali](./media/hana-overview-high-availability-disaster-recovery/image19-recover-database-d.png)

6. <span data-ttu-id="204a9-445">Nella schermata di riepilogo fare clic su **Finish** (Fine) per avviare la procedura di ripristino.</span><span class="sxs-lookup"><span data-stu-id="204a9-445">On the summary screen, click **Finish** to start the restoration procedure.</span></span>

 ![Nella schermata di riepilogo fare clic su "Finish" (Fine)](./media/hana-overview-high-availability-disaster-recovery/image20-recover-database-e.png)

### <a name="recovering-to-another-point-in-time"></a><span data-ttu-id="204a9-447">Ripristino a un'altra temporizzazione</span><span class="sxs-lookup"><span data-stu-id="204a9-447">Recovering to another point in time</span></span>
<span data-ttu-id="204a9-448">Per eseguire il ripristino a una temporizzazione compresa tra il momento di creazione dello snapshot HANA (incluso nello snapshot di archiviazione) e un momento successivo al ripristino temporizzato dello snapshot HANA, procedere come segue:</span><span class="sxs-lookup"><span data-stu-id="204a9-448">To recover to a point in time between the HANA snapshot (included in the storage snapshot) and one that is later than the HANA snapshot point-in-time recovery, do the following:</span></span>

1. <span data-ttu-id="204a9-449">Assicurarsi di avere tutti i backup dei log delle transazioni dal momento di creazione dello snapshot HANA al momento che si vuole ripristinare.</span><span class="sxs-lookup"><span data-stu-id="204a9-449">Make sure that you have all transaction log backups from the HANA snapshot to the time you want to recover.</span></span>
2. <span data-ttu-id="204a9-450">Iniziare la procedura riportata in "Ripristino allo stato più recente".</span><span class="sxs-lookup"><span data-stu-id="204a9-450">Begin the procedure under "Recovering to the most recent state."</span></span>
3. <span data-ttu-id="204a9-451">Al passaggio 2 della procedura, nella finestra **Specify Recovery Type** (Specifica tipo di ripristino), selezionare **Recover the database to the following point in time** (Ripristina il database alla temporizzazione seguente), specificare la temporizzazione e quindi completare i passaggi da 3 a 6.</span><span class="sxs-lookup"><span data-stu-id="204a9-451">In step 2 of the procedure, in the **Specify Recovery Type** window, select **Recover the database to the following point in time**, specify the point in time, and then complete steps 3-6.</span></span>

## <a name="monitoring-the-execution-of-snapshots"></a><span data-ttu-id="204a9-452">Monitorare l'esecuzione degli snapshot</span><span class="sxs-lookup"><span data-stu-id="204a9-452">Monitoring the execution of snapshots</span></span>

<span data-ttu-id="204a9-453">È necessario monitorare l'esecuzione degli snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-453">You need to monitor the execution of storage snapshots.</span></span> <span data-ttu-id="204a9-454">Lo script che esegue uno snapshot di archiviazione scrive l'output in un file e lo salva nello stesso percorso degli script Perl.</span><span class="sxs-lookup"><span data-stu-id="204a9-454">The script that executes a storage snapshot writes output to a file and then saves it to the same location as the Perl scripts.</span></span> <span data-ttu-id="204a9-455">Viene creato un file separato per ogni snapshot.</span><span class="sxs-lookup"><span data-stu-id="204a9-455">A separate file is written for each snapshot.</span></span> <span data-ttu-id="204a9-456">L'output di ogni file mostra chiaramente le diverse fasi che lo script degli snapshot esegue:</span><span class="sxs-lookup"><span data-stu-id="204a9-456">The output of each file clearly shows the various phases that the snapshot script executes:</span></span>

- <span data-ttu-id="204a9-457">Ricerca dei volumi per i quali è necessario creare uno snapshot</span><span class="sxs-lookup"><span data-stu-id="204a9-457">Finding the volumes that need to create a snapshot</span></span>
- <span data-ttu-id="204a9-458">Ricerca degli snapshot creati da tali volumi</span><span class="sxs-lookup"><span data-stu-id="204a9-458">Finding the snapshots taken from these volumes</span></span>
- <span data-ttu-id="204a9-459">Eliminazione di eventuali snapshot esistenti in modo da riflettere il numero di snapshot specificato</span><span class="sxs-lookup"><span data-stu-id="204a9-459">Deleting eventual existing snapshots to match the number of snapshots you specified</span></span>
- <span data-ttu-id="204a9-460">Creazione di uno snapshot HANA</span><span class="sxs-lookup"><span data-stu-id="204a9-460">Creating a HANA snapshot</span></span>
- <span data-ttu-id="204a9-461">Creazione dello snapshot di archiviazione sui volumi</span><span class="sxs-lookup"><span data-stu-id="204a9-461">Creating the storage snapshot over the volumes</span></span>
- <span data-ttu-id="204a9-462">Eliminazione dello snapshot HANA</span><span class="sxs-lookup"><span data-stu-id="204a9-462">Deleting the HANA snapshot</span></span>
- <span data-ttu-id="204a9-463">Rinomina dello snapshot più recente come **.0**</span><span class="sxs-lookup"><span data-stu-id="204a9-463">Renaming the most recent snapshot to **.0**</span></span>

<span data-ttu-id="204a9-464">La parte più importante dello script è la seguente:</span><span class="sxs-lookup"><span data-stu-id="204a9-464">The most important part of the script is this:</span></span>
```
**********************Creating HANA snapshot**********************
Creating the HANA snapshot with command: "./hdbsql -n localhost -i 01 -U SCADMIN01 "backup data create snapshot"" ...
HANA snapshot created successfully.
**********************Creating Storage snapshot**********************
Taking snapshot hourly.recent for hana_data_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for hana_log_backup_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for hana_log_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for hana_shared_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for sapmnt_lhanad01_t020_vol ...
Snapshot created successfully.
**********************Deleting HANA snapshot**********************
Deleting the HANA snapshot with command: "./hdbsql -n localhost -i 01 -U SCADMIN01 "backup data drop snapshot"" ...
HANA snapshot deletion successfully.
```
<span data-ttu-id="204a9-465">In questo esempio è possibile notare come lo script registra la creazione dello snapshot HANA.</span><span class="sxs-lookup"><span data-stu-id="204a9-465">You can see from this sample how the script records the creation of the HANA snapshot.</span></span> <span data-ttu-id="204a9-466">Nel caso di una configurazione con scalabilità orizzontale questa procedura viene avviata sul nodo master.</span><span class="sxs-lookup"><span data-stu-id="204a9-466">In the scale-out case, this process is initiated on the master node.</span></span> <span data-ttu-id="204a9-467">Il nodo master avvia la creazione sincrona degli snapshot su ciascuno dei nodi di lavoro,</span><span class="sxs-lookup"><span data-stu-id="204a9-467">The master node initiates the synchronous creation of the snapshots on each of the worker nodes.</span></span> <span data-ttu-id="204a9-468">quindi viene creato lo snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="204a9-468">Then the storage snapshot is taken.</span></span> <span data-ttu-id="204a9-469">Dopo l'esecuzione degli snapshot di archiviazione, lo snapshot HANA viene eliminato.</span><span class="sxs-lookup"><span data-stu-id="204a9-469">After the successful execution of the storage snapshots, the HANA snapshot is deleted.</span></span>
