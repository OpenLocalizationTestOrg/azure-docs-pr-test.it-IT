---
title: 'Suggerimenti sulle prestazioni: Azure Cosmos DB NoSQL | Microsoft Docs'
description: Informazioni sulle opzioni di configurazione client per migliorare le prestazioni del database Azure Cosmos DB
keywords: Come migliorare le prestazioni del database
services: cosmos-db
author: mimig1
manager: jhubbard
editor: 
documentationcenter: 
ms.assetid: 94ff155e-f9bc-488f-8c7a-5e7037091bb9
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/23/2017
ms.author: mimig
ms.openlocfilehash: a94cda90eca9dca2b93adb8f5091d829e7375aa5
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/03/2017
---
# <a name="performance-tips-for-azure-cosmos-db"></a><span data-ttu-id="f8556-104">Suggerimenti sulle prestazioni per Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="f8556-104">Performance tips for Azure Cosmos DB</span></span>
<span data-ttu-id="f8556-105">Azure Cosmos DB è un database distribuito veloce e flessibile, facilmente scalabile e con latenza e velocità effettiva garantite.</span><span class="sxs-lookup"><span data-stu-id="f8556-105">Azure Cosmos DB is a fast and flexible distributed database that scales seamlessly with guaranteed latency and throughput.</span></span> <span data-ttu-id="f8556-106">Non è necessario apportare modifiche significative all'architettura o scrivere codice complesso per ridimensionare il database con Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="f8556-106">You do not have to make major architecture changes or write complex code to scale your database with Cosmos DB.</span></span> <span data-ttu-id="f8556-107">Aumentare o ridurre le prestazioni è semplice come eseguire una singola chiamata API o una [chiamata al metodo SDK](set-throughput.md#set-throughput-sdk).</span><span class="sxs-lookup"><span data-stu-id="f8556-107">Scaling up and down is as easy as making a single API call or [SDK method call](set-throughput.md#set-throughput-sdk).</span></span> <span data-ttu-id="f8556-108">Dato che si accede a Cosmos DB tramite chiamate di rete, tuttavia, è possibile apportare ottimizzazioni lato client per ottenere prestazioni ottimali.</span><span class="sxs-lookup"><span data-stu-id="f8556-108">However, because Cosmos DB is accessed via network calls there are client-side optimizations you can make to achieve peak performance.</span></span>

<span data-ttu-id="f8556-109">Se si vogliono migliorare le prestazioni del database,</span><span class="sxs-lookup"><span data-stu-id="f8556-109">So if you're asking "How can I improve my database performance?"</span></span> <span data-ttu-id="f8556-110">prendere in considerazione le opzioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="f8556-110">consider the following options:</span></span>

## <a name="networking"></a><span data-ttu-id="f8556-111">Rete</span><span class="sxs-lookup"><span data-stu-id="f8556-111">Networking</span></span>
<a id="direct-connection"></a>

1. <span data-ttu-id="f8556-112">**Criteri di connessione: usare la modalità di connessione diretta**</span><span class="sxs-lookup"><span data-stu-id="f8556-112">**Connection policy: Use direct connection mode**</span></span>

    <span data-ttu-id="f8556-113">La modalità di connessione di un client a Cosmos DB influisce significativamente sulle prestazioni, in particolare in termini di latenza lato client osservata.</span><span class="sxs-lookup"><span data-stu-id="f8556-113">How a client connects to Cosmos DB has important implications on performance, especially in terms of observed client-side latency.</span></span> <span data-ttu-id="f8556-114">Sono disponibili due impostazioni di configurazione chiave per la configurazione dei criteri di connessione client, ovvero la *modalità* di connessione e il [protocollo di *connessione*](#connection-protocol).</span><span class="sxs-lookup"><span data-stu-id="f8556-114">There are two key configuration settings available for configuring client Connection Policy – the connection *mode* and the [connection *protocol*](#connection-protocol).</span></span>  <span data-ttu-id="f8556-115">Le due modalità disponibili sono:</span><span class="sxs-lookup"><span data-stu-id="f8556-115">The two available modes are:</span></span>

   1. <span data-ttu-id="f8556-116">Modalità gateway (predefinita)</span><span class="sxs-lookup"><span data-stu-id="f8556-116">Gateway Mode (default)</span></span>
   2. <span data-ttu-id="f8556-117">Modalità diretta</span><span class="sxs-lookup"><span data-stu-id="f8556-117">Direct Mode</span></span>

      <span data-ttu-id="f8556-118">La modalità gateway è supportata in tutte le piattaforme SDK ed è l'impostazione predefinita configurata.</span><span class="sxs-lookup"><span data-stu-id="f8556-118">Gateway Mode is supported on all SDK platforms and is the configured default.</span></span>  <span data-ttu-id="f8556-119">Se l'applicazione è in esecuzione in una rete aziendale con limitazioni rigide del firewall, la modalità gateway è la scelta migliore, perché usa la porta HTTPS standard e un singolo endpoint.</span><span class="sxs-lookup"><span data-stu-id="f8556-119">If your application runs within a corporate network with strict firewall restrictions, Gateway Mode is the best choice since it uses the standard HTTPS port and a single endpoint.</span></span> <span data-ttu-id="f8556-120">A livello di prestazioni, tuttavia, la modalità gateway prevede un hop di rete aggiuntivo ogni volta che i dati vengono letti o scritti in Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="f8556-120">The performance tradeoff, however, is that Gateway Mode involves an additional network hop every time data is read or written to Cosmos DB.</span></span> <span data-ttu-id="f8556-121">La modalità diretta offre quindi prestazioni migliori grazie al numero minore di hop di rete.</span><span class="sxs-lookup"><span data-stu-id="f8556-121">Because of this, Direct Mode offers better performance due to fewer network hops.</span></span>
<a id="use-tcp"></a>
2. <span data-ttu-id="f8556-122">**Criteri di connessione: usare il protocollo TCP**</span><span class="sxs-lookup"><span data-stu-id="f8556-122">**Connection policy: Use the TCP protocol**</span></span>

    <span data-ttu-id="f8556-123">Quando si usa la modalità diretta, sono disponibili due opzioni del protocollo:</span><span class="sxs-lookup"><span data-stu-id="f8556-123">When using Direct Mode, there are two protocol options available:</span></span>

   * <span data-ttu-id="f8556-124">TCP</span><span class="sxs-lookup"><span data-stu-id="f8556-124">TCP</span></span>
   * <span data-ttu-id="f8556-125">HTTPS</span><span class="sxs-lookup"><span data-stu-id="f8556-125">HTTPS</span></span>

     <span data-ttu-id="f8556-126">Cosmos DB offre un modello di programmazione RESTful su HTTPS semplice e aperto.</span><span class="sxs-lookup"><span data-stu-id="f8556-126">Cosmos DB offers a simple and open RESTful programming model over HTTPS.</span></span> <span data-ttu-id="f8556-127">DocumentDB offre anche un protocollo TCP efficiente, con un modello di comunicazione di tipo RESTful disponibile tramite .NET SDK per client.</span><span class="sxs-lookup"><span data-stu-id="f8556-127">Additionally, it offers an efficient TCP protocol, which is also RESTful in its communication model and is available through the .NET client SDK.</span></span> <span data-ttu-id="f8556-128">Sia il protocollo TCP diretto che il protocollo HTTPS usano SSL per l'autenticazione iniziale e la crittografia del traffico.</span><span class="sxs-lookup"><span data-stu-id="f8556-128">Both Direct TCP and HTTPS use SSL for initial authentication and encrypting traffic.</span></span> <span data-ttu-id="f8556-129">Per prestazioni ottimali, usare il protocollo TCP quando possibile.</span><span class="sxs-lookup"><span data-stu-id="f8556-129">For best performance, use the TCP protocol when possible.</span></span>

     <span data-ttu-id="f8556-130">Quando si usa TCP in modalità gateway, la porta TCP 443 è la porta di Cosmos DB, mentre la porta 10255 è la porta dell'API MongoDB.</span><span class="sxs-lookup"><span data-stu-id="f8556-130">When using TCP in Gateway Mode, TCP Port 443 is the Cosmos DB port, and 10255 is the MongoDB API port.</span></span> <span data-ttu-id="f8556-131">Quando si usa TCP in modalità diretta, oltre alle porte gateway è necessario verificare che le porte nell'intervallo tra 10000 e 20000 siano aperte perché Cosmos DB usa porte TCP dinamiche.</span><span class="sxs-lookup"><span data-stu-id="f8556-131">When using TCP in Direct Mode, in addition to the Gateway ports, you need to ensure the port range between 10000 and 20000 is open because Cosmos DB uses dynamic TCP ports.</span></span> <span data-ttu-id="f8556-132">Se queste porte non sono aperte e si tenta di usare TCP, si riceverà un errore 503 (Servizio non disponibile).</span><span class="sxs-lookup"><span data-stu-id="f8556-132">If these ports are not open and you attempt to use TCP, you receive a 503 Service Unavailable error.</span></span>

     <span data-ttu-id="f8556-133">La modalità di connessione viene configurata durante la creazione dell'istanza di DocumentClient con il parametro ConnectionPolicy.</span><span class="sxs-lookup"><span data-stu-id="f8556-133">The Connectivity Mode is configured during the construction of the DocumentClient instance with the ConnectionPolicy parameter.</span></span> <span data-ttu-id="f8556-134">Se si usa la modalità diretta, è possibile configurare il protocollo entro il parametro ConnectionPolicy.</span><span class="sxs-lookup"><span data-stu-id="f8556-134">If Direct Mode is used, the Protocol can also be set within the ConnectionPolicy parameter.</span></span>

    ```C#
    var serviceEndpoint = new Uri("https://contoso.documents.net");
    var authKey = new "your authKey from the Azure portal";
    DocumentClient client = new DocumentClient(serviceEndpoint, authKey,
    new ConnectionPolicy
    {
        ConnectionMode = ConnectionMode.Direct,
        ConnectionProtocol = Protocol.Tcp
    });
    ```

    <span data-ttu-id="f8556-135">Poiché TCP è supportato solo in modalità diretta, se si usa la modalità gateway viene usato sempre il protocollo HTTPS per comunicare con il gateway e il valore del protocollo in ConnectionPolicy viene ignorato.</span><span class="sxs-lookup"><span data-stu-id="f8556-135">Because TCP is only supported in Direct Mode, if Gateway Mode is used, then the HTTPS protocol is always used to communicate with the Gateway and the Protocol value in the ConnectionPolicy is ignored.</span></span>

    ![Illustrazione dei criteri di connessione di Azure Cosmos DB](./media/performance-tips/connection-policy.png)

3. <span data-ttu-id="f8556-137">**Chiamare OpenAsync per evitare la latenza di avvio alla prima richiesta**</span><span class="sxs-lookup"><span data-stu-id="f8556-137">**Call OpenAsync to avoid startup latency on first request**</span></span>

    <span data-ttu-id="f8556-138">Per impostazione predefinita, la prima richiesta ha una latenza più elevata perché deve recuperare la tabella di routing degli indirizzi.</span><span class="sxs-lookup"><span data-stu-id="f8556-138">By default, the first request has a higher latency because it has to fetch the address routing table.</span></span> <span data-ttu-id="f8556-139">Per evitare questa latenza di avvio alla prima richiesta, è necessario chiamare OpenAsync() una volta durante l'inizializzazione, come indicato di seguito.</span><span class="sxs-lookup"><span data-stu-id="f8556-139">To avoid this startup latency on the first request, you should call OpenAsync() once during initialization as follows.</span></span>

        await client.OpenAsync();
   <a id="same-region"></a>
4. <span data-ttu-id="f8556-140">**Collocare i client nella stessa area di Azure per ottenere prestazioni migliori**</span><span class="sxs-lookup"><span data-stu-id="f8556-140">**Collocate clients in same Azure region for performance**</span></span>

    <span data-ttu-id="f8556-141">Quando possibile, posizionare eventuali applicazioni che chiamano Cosmos DB nella stessa area del database Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="f8556-141">When possible, place any applications calling Cosmos DB in the same region as the Cosmos DB database.</span></span> <span data-ttu-id="f8556-142">Per un confronto approssimativo, le chiamate a Cosmos DB eseguite nella stessa area vengono completate entro 1-2 millisecondi, mentre la latenza tra la costa occidentale e quella orientale degli Stati Uniti è > 50 millisecondi.</span><span class="sxs-lookup"><span data-stu-id="f8556-142">For an approximate comparison, calls to Cosmos DB within the same region complete within 1-2 ms, but the latency between the West and East coast of the US is >50 ms.</span></span> <span data-ttu-id="f8556-143">Questa latenza può variare da richiesta a richiesta, in base alla route seguita dalla richiesta durante il passaggio dal client al limite del data center di Azure.</span><span class="sxs-lookup"><span data-stu-id="f8556-143">This latency can likely vary from request to request depending on the route taken by the request as it passes from the client to the Azure datacenter boundary.</span></span> <span data-ttu-id="f8556-144">È possibile ottenere la latenza più bassa possibile assicurandosi che l'applicazione chiamante si trovi nella stessa area di Azure in cui si trova l'endpoint di Cosmos DB con provisioning.</span><span class="sxs-lookup"><span data-stu-id="f8556-144">The lowest possible latency is achieved by ensuring the calling application is located within the same Azure region as the provisioned Cosmos DB endpoint.</span></span> <span data-ttu-id="f8556-145">Per un elenco delle aree disponibili, vedere [Aree di Azure](https://azure.microsoft.com/regions/#services).</span><span class="sxs-lookup"><span data-stu-id="f8556-145">For a list of available regions, see [Azure Regions](https://azure.microsoft.com/regions/#services).</span></span>

    <span data-ttu-id="f8556-146">![Illustrazione dei criteri di connessione di Azure Cosmos DB](./media/performance-tips/same-region.png)
   <a id="increase-threads"></a></span><span class="sxs-lookup"><span data-stu-id="f8556-146">![Illustration of the Azure Cosmos DB connection policy](./media/performance-tips/same-region.png)
<a id="increase-threads"></a></span></span>
5. <span data-ttu-id="f8556-147">**Aumentare il numero di thread/attività**</span><span class="sxs-lookup"><span data-stu-id="f8556-147">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="f8556-148">Dato che le chiamate ad Azure Cosmos DB vengono eseguite sulla rete, può essere necessario modificare il grado di parallelismo delle richieste in modo che i tempi di attesa dell'applicazione client tra le richieste siano molto ridotti.</span><span class="sxs-lookup"><span data-stu-id="f8556-148">Since calls to Azure Cosmos DB are made over the network, you may need to vary the degree of parallelism of your requests so that the client application spends very little time waiting between requests.</span></span> <span data-ttu-id="f8556-149">Se si usa [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx) di .NET, ad esempio, creare centinaia di attività di lettura o scrittura in Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="f8556-149">For example, if you're using .NET's [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx), create in the order of 100s of Tasks reading or writing to Cosmos DB.</span></span>

## <a name="sdk-usage"></a><span data-ttu-id="f8556-150">Uso dell'SDK</span><span class="sxs-lookup"><span data-stu-id="f8556-150">SDK Usage</span></span>
1. <span data-ttu-id="f8556-151">**Installare l'SDK più recente**</span><span class="sxs-lookup"><span data-stu-id="f8556-151">**Install the most recent SDK**</span></span>

    <span data-ttu-id="f8556-152">Agli SDK di Cosmos DB vengono apportati continui miglioramenti per offrire prestazioni ottimali.</span><span class="sxs-lookup"><span data-stu-id="f8556-152">The Cosmos DB SDKs are constantly being improved to provide the best performance.</span></span> <span data-ttu-id="f8556-153">Per determinare la versione di SDK più recente e verificare i miglioramenti, vedere le pagine relative agli [SDK di Cosmos DB](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="f8556-153">See the [Cosmos DB SDK](documentdb-sdk-dotnet.md) pages to determine the most recent SDK and review improvements.</span></span>
2. <span data-ttu-id="f8556-154">**Usare un client Cosmos DB singleton per la durata dell'applicazione**</span><span class="sxs-lookup"><span data-stu-id="f8556-154">**Use a singleton Cosmos DB client for the lifetime of your application**</span></span>

    <span data-ttu-id="f8556-155">Si noti che ogni istanza di DocumentClient è thread-safe ed esegue la gestione efficiente delle connessioni e la memorizzazione nella cache degli indirizzi quando viene usata la modalità diretta.</span><span class="sxs-lookup"><span data-stu-id="f8556-155">Note that each DocumentClient instance is thread-safe and performs efficient connection management and address caching when operating in Direct Mode.</span></span> <span data-ttu-id="f8556-156">Per consentire una gestione efficiente delle connessioni e prestazioni migliori da parte di DocumentClient, è consigliabile usare una singola istanza di DocumentClient per ogni AppDomain per la durata dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f8556-156">To allow efficient connection management and better performance by DocumentClient, it is recommended to use a single instance of DocumentClient per AppDomain for the lifetime of the application.</span></span>

   <a id="max-connection"></a>
3. <span data-ttu-id="f8556-157">**Aumentare il valore di System.Net MaxConnections per host se si usa la modalità Gateway**.</span><span class="sxs-lookup"><span data-stu-id="f8556-157">**Increase System.Net MaxConnections per host when using Gateway mode**</span></span>

    <span data-ttu-id="f8556-158">Quando si usa la modalità gateway, le richieste di Cosmos DB vengono eseguite su HTTPS/REST e sono soggette ai limiti di connessione predefiniti per ogni nome host o indirizzo IP.</span><span class="sxs-lookup"><span data-stu-id="f8556-158">Cosmos DB requests are made over HTTPS/REST when using Gateway mode, and are subjected to the default connection limit per hostname or IP address.</span></span> <span data-ttu-id="f8556-159">Può essere necessario impostare MaxConnections su un valore più alto (100-1000) in modo che la libreria client possa usare più connessioni simultanee a Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="f8556-159">You may need to set the MaxConnections to a higher value (100-1000) so that the client library can utilize multiple simultaneous connections to Cosmos DB.</span></span> <span data-ttu-id="f8556-160">In .NET SDK 1.8.0 e versioni successive il valore predefinito per [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) è 50 e per modificare il valore è possibile impostare [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) su un valore più elevato.</span><span class="sxs-lookup"><span data-stu-id="f8556-160">In the .NET SDK 1.8.0 and above, the default value for [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) is 50 and to change the value, you can set the [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) to a higher value.</span></span>   
4. <span data-ttu-id="f8556-161">**Ottimizzazione delle query parallele per le raccolte partizionate**</span><span class="sxs-lookup"><span data-stu-id="f8556-161">**Tuning parallel queries for partitioned collections**</span></span>

     <span data-ttu-id="f8556-162">DocumentDB .NET SDK 1.9.0 e versioni successive supportano le query parallele, che consentono di eseguire query in una raccolta partizionata in parallelo. Vedere [Uso degli SDK](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) e i relativi [esempi di codice](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) per maggiori dettagli.</span><span class="sxs-lookup"><span data-stu-id="f8556-162">DocumentDB .NET SDK version 1.9.0 and above support parallel queries, which enable you to query a partitioned collection in parallel (see [Working with the SDKs](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) and the related [code samples](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) for more info).</span></span> <span data-ttu-id="f8556-163">Le query parallele sono state concepite per migliorare la velocità e la latenza delle query sulle loro controparti seriali.</span><span class="sxs-lookup"><span data-stu-id="f8556-163">Parallel queries are designed to improve query latency and throughput over their serial counterpart.</span></span> <span data-ttu-id="f8556-164">Mettono a disposizione due parametri che gli utenti possono ottimizzare in funzione dei requisiti, ovvero (a) MaxDegreeOfParallelism per definire il numero massimo di partizioni sulle quali è possibile eseguire query in parallelo e (b) MaxBufferedItemCount per definire il numero di risultati di prelettura.</span><span class="sxs-lookup"><span data-stu-id="f8556-164">Parallel queries provide two parameters that users can tune to custom-fit their requirements, (a) MaxDegreeOfParallelism: to control the maximum number of partitions then can be queried in parallel, and (b) MaxBufferedItemCount: to control the number of pre-fetched results.</span></span>

    <span data-ttu-id="f8556-165">(a) ***Ottimizzazione di MaxDegreeOfParallelism\:*** la query parallela funziona eseguendo query su più partizioni in parallelo.</span><span class="sxs-lookup"><span data-stu-id="f8556-165">(a) ***Tuning MaxDegreeOfParallelism\:*** Parallel query works by querying multiple partitions in parallel.</span></span> <span data-ttu-id="f8556-166">I dati di una singola raccolta partizionata vengono recuperati in modo seriale per quanto riguarda la query.</span><span class="sxs-lookup"><span data-stu-id="f8556-166">However, data from an individual partitioned collect is fetched serially with respect to the query.</span></span> <span data-ttu-id="f8556-167">L'impostazione di MaxDegreeOfParallelism sul numero di partizioni offre quindi la massima probabilità di ottenere la query più efficiente, se tutte le altre condizioni del sistema rimangono invariate.</span><span class="sxs-lookup"><span data-stu-id="f8556-167">So, setting the MaxDegreeOfParallelism to the number of partitions has the maximum chance of achieving the most performant query, provided all other system conditions remain the same.</span></span> <span data-ttu-id="f8556-168">Se non si conosce il numero di partizioni, è possibile impostare il valore di MaxDegreeOfParallelism su un numero elevato; il sistema sceglie il numero minimo (numero di partizioni, input specificato dall'utente) come valore di MaxDegreeOfParallelism.</span><span class="sxs-lookup"><span data-stu-id="f8556-168">If you don't know the number of partitions, you can set the MaxDegreeOfParallelism to a high number, and the system chooses the minimum (number of partitions, user provided input) as the MaxDegreeOfParallelism.</span></span>

    <span data-ttu-id="f8556-169">È importante notare che le query parallele producono i vantaggi migliori se i dati sono distribuiti uniformemente tra tutte le partizioni per quanto riguarda la query.</span><span class="sxs-lookup"><span data-stu-id="f8556-169">It is important to note that parallel queries produce the best benefits if the data is evenly distributed across all partitions with respect to the query.</span></span> <span data-ttu-id="f8556-170">Se la raccolta è partizionata in modo tale che tutti o la maggior parte dei dati restituiti da una query siano concentrati in alcune partizioni (una sola partizione nel peggiore dei casi), le prestazioni della query potrebbero essere limitate da tali partizioni.</span><span class="sxs-lookup"><span data-stu-id="f8556-170">If the partitioned collection is partitioned such a way that all or a majority of the data returned by a query is concentrated in a few partitions (one partition in worst case), then the performance of the query would be bottlenecked by those partitions.</span></span>

    <span data-ttu-id="f8556-171">(b) ***Ottimizzazione di MaxBufferedItemCount\:*** la query parallela è progettata per la prelettura dei risultati mentre il client elabora il batch di risultati corrente.</span><span class="sxs-lookup"><span data-stu-id="f8556-171">(b) ***Tuning MaxBufferedItemCount\:*** Parallel query is designed to pre-fetch results while the current batch of results is being processed by the client.</span></span> <span data-ttu-id="f8556-172">La prelettura consente il miglioramento complessivo della latenza di una query.</span><span class="sxs-lookup"><span data-stu-id="f8556-172">The pre-fetching helps in overall latency improvement of a query.</span></span> <span data-ttu-id="f8556-173">MaxBufferedItemCount è il parametro che consente di limitare il numero di risultati di prelettura.</span><span class="sxs-lookup"><span data-stu-id="f8556-173">MaxBufferedItemCount is the parameter to limit the number of pre-fetched results.</span></span> <span data-ttu-id="f8556-174">L'impostazione di MaxBufferedItemCount sul numero previsto di risultati restituiti (o un numero più alto) consente alla query di ottenere il massimo vantaggio dalla prelettura.</span><span class="sxs-lookup"><span data-stu-id="f8556-174">Setting MaxBufferedItemCount to the expected number of results returned (or a higher number) allows the query to receive maximum benefit from pre-fetching.</span></span>

    <span data-ttu-id="f8556-175">Si noti che la prelettura funziona allo stesso modo indipendentemente dall'impostazione di MaxDegreeOfParallelism e che è presente un solo buffer per i dati di tutte le partizioni.</span><span class="sxs-lookup"><span data-stu-id="f8556-175">Note that pre-fetching works the same way irrespective of the MaxDegreeOfParallelism, and there is a single buffer for the data from all partitions.</span></span>  
5. <span data-ttu-id="f8556-176">**Attivare GC sul lato server**</span><span class="sxs-lookup"><span data-stu-id="f8556-176">**Turn on server-side GC**</span></span>

    <span data-ttu-id="f8556-177">In alcuni casi, può essere utile ridurre la frequenza di Garbage Collection.</span><span class="sxs-lookup"><span data-stu-id="f8556-177">Reducing the frequency of garbage collection may help in some cases.</span></span> <span data-ttu-id="f8556-178">In .NET impostare [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) su true.</span><span class="sxs-lookup"><span data-stu-id="f8556-178">In .NET, set [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) to true.</span></span>
6. <span data-ttu-id="f8556-179">**Implementare il backoff in corrispondenza di intervalli RetryAfter**</span><span class="sxs-lookup"><span data-stu-id="f8556-179">**Implement backoff at RetryAfter intervals**</span></span>

    <span data-ttu-id="f8556-180">Durante il test delle prestazioni, è necessario aumentare il carico fino a limitare un numero ridotto di richieste.</span><span class="sxs-lookup"><span data-stu-id="f8556-180">During performance testing, you should increase load until a small rate of requests get throttled.</span></span> <span data-ttu-id="f8556-181">Se limitata, l'applicazione client deve eseguire il backoff sulla limitazione per l'intervallo tra tentativi specificato dal server.</span><span class="sxs-lookup"><span data-stu-id="f8556-181">If throttled, the client application should backoff on throttle for the server-specified retry interval.</span></span> <span data-ttu-id="f8556-182">Rispettando il backoff si garantiscono tempi di attesa minimi tra i tentativi.</span><span class="sxs-lookup"><span data-stu-id="f8556-182">Respecting the backoff ensures that you spend minimal amount of time waiting between retries.</span></span> <span data-ttu-id="f8556-183">Il supporto dei criteri di ripetizione dei tentativi è incluso nella versione 1.8.0 e versioni successive degli SDK [.NET](documentdb-sdk-dotnet.md) e [Java](documentdb-sdk-java.md), nella versione 1.9.0 e versioni successive degli SDK [Node.js](documentdb-sdk-node.md) e [Python](documentdb-sdk-python.md) e in tutte le versioni supportate degli SDK [.NET Core](documentdb-sdk-dotnet-core.md) di DocumentDB.</span><span class="sxs-lookup"><span data-stu-id="f8556-183">Retry policy support is included in Version 1.8.0 and above of the DocumentDB [.NET](documentdb-sdk-dotnet.md) and [Java](documentdb-sdk-java.md), version 1.9.0 and above of the [Node.js](documentdb-sdk-node.md) and [Python](documentdb-sdk-python.md), and all supported versions of the [.NET Core](documentdb-sdk-dotnet-core.md) SDKs.</span></span> <span data-ttu-id="f8556-184">Per altre informazioni, vedere [Superamento dei limiti della velocità effettiva riservata](request-units.md#RequestRateTooLarge) e [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span><span class="sxs-lookup"><span data-stu-id="f8556-184">For more information, see [Exceeding reserved throughput limits](request-units.md#RequestRateTooLarge) and [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span></span>
7. <span data-ttu-id="f8556-185">**Aumentare il carico di lavoro client**</span><span class="sxs-lookup"><span data-stu-id="f8556-185">**Scale out your client-workload**</span></span>

    <span data-ttu-id="f8556-186">Se si sta eseguendo il test a livelli di velocità effettiva elevati (> 50.000 UR/sec), l'applicazione client può diventare un collo di bottiglia a causa della limitazione di utilizzo della CPU o della rete.</span><span class="sxs-lookup"><span data-stu-id="f8556-186">If you are testing at high throughput levels (>50,000 RU/s), the client application may become the bottleneck due to the machine capping out on CPU or Network utilization.</span></span> <span data-ttu-id="f8556-187">In questo caso, è possibile continuare a effettuare il push dell'account Cosmos DB aumentando il numero di istanze delle applicazioni client in più server.</span><span class="sxs-lookup"><span data-stu-id="f8556-187">If you reach this point, you can continue to push the Cosmos DB account further by scaling out your client applications across multiple servers.</span></span>
8. <span data-ttu-id="f8556-188">**Memorizzare nella cache gli URI dei documenti per una minore latenza di lettura**</span><span class="sxs-lookup"><span data-stu-id="f8556-188">**Cache document URIs for lower read latency**</span></span>

    <span data-ttu-id="f8556-189">Memorizzare nella cache gli URI dei documenti quando possibile per ottenere prestazioni di lettura ottimali.</span><span class="sxs-lookup"><span data-stu-id="f8556-189">Cache document URIs whenever possible for the best read performance.</span></span>
   <a id="tune-page-size"></a>
9. <span data-ttu-id="f8556-190">**Modificare le dimensioni di pagina per le query o i feed di lettura per ottenere prestazioni migliori**</span><span class="sxs-lookup"><span data-stu-id="f8556-190">**Tune the page size for queries/read feeds for better performance**</span></span>

    <span data-ttu-id="f8556-191">Quando si esegue una lettura in blocco di documenti usando la funzionalità dei feed di lettura, ad esempio ReadDocumentFeedAsync, oppure quando si emette una query SQL di DocumentDB, i risultati vengono restituiti in modo segmentato se il set di risultati è troppo grande.</span><span class="sxs-lookup"><span data-stu-id="f8556-191">When performing a bulk read of documents using read feed functionality (for example, ReadDocumentFeedAsync) or when issuing a DocumentDB SQL query, the results are returned in a segmented fashion if the result set is too large.</span></span> <span data-ttu-id="f8556-192">Per impostazione predefinita, i risultati vengono restituiti in blocchi di 100 elementi o 1 MB, a seconda del limite che viene raggiunto prima.</span><span class="sxs-lookup"><span data-stu-id="f8556-192">By default, results are returned in chunks of 100 items or 1 MB, whichever limit is hit first.</span></span>

    <span data-ttu-id="f8556-193">Per ridurre il numero di round trip di rete necessari per recuperare tutti i risultati applicabili, è possibile aumentare le dimensioni di pagina usando l'intestazione di richiesta x-ms-max-item-count fino a 1000.</span><span class="sxs-lookup"><span data-stu-id="f8556-193">To reduce the number of network round trips required to retrieve all applicable results, you can increase the page size using x-ms-max-item-count request header to up to 1000.</span></span> <span data-ttu-id="f8556-194">Nei casi in cui è necessario visualizzare solo alcuni risultati, ad esempio se l'interfaccia utente o l'API dell'applicazione restituisce solo 10 risultati alla volta, è anche possibile ridurre le dimensioni di pagina a 10 in modo da ridurre la velocità effettiva usata per le letture e le query.</span><span class="sxs-lookup"><span data-stu-id="f8556-194">In cases where you need to display only a few results, for example, if your user interface or application API returns only 10 results a time, you can also decrease the page size to 10 to reduce the throughput consumed for reads and queries.</span></span>

    <span data-ttu-id="f8556-195">È anche possibile impostare le dimensioni di pagina usando gli SDK di Cosmos DB disponibili.</span><span class="sxs-lookup"><span data-stu-id="f8556-195">You may also set the page size using the available Cosmos DB SDKs.</span></span>  <span data-ttu-id="f8556-196">ad esempio:</span><span class="sxs-lookup"><span data-stu-id="f8556-196">For example:</span></span>

        IQueryable<dynamic> authorResults = client.CreateDocumentQuery(documentCollection.SelfLink, "SELECT p.Author FROM Pages p WHERE p.Title = 'About Seattle'", new FeedOptions { MaxItemCount = 1000 });
10. <span data-ttu-id="f8556-197">**Aumentare il numero di thread/attività**</span><span class="sxs-lookup"><span data-stu-id="f8556-197">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="f8556-198">Vedere [Aumentare il numero di thread/attività](#increase-threads) nella sezione Rete.</span><span class="sxs-lookup"><span data-stu-id="f8556-198">See [Increase number of threads/tasks](#increase-threads) in the Networking section.</span></span>

11. <span data-ttu-id="f8556-199">**Usare processi host a 64 bit**</span><span class="sxs-lookup"><span data-stu-id="f8556-199">**Use 64-bit host processing**</span></span>

    <span data-ttu-id="f8556-200">L'SDK di DocumentDB funziona in un processo host a 32 bit quando si usa DocumentDB .NET SDK versione 1.11.4 e versioni successive.</span><span class="sxs-lookup"><span data-stu-id="f8556-200">The DocumentDB SDK works in a 32-bit host process when you are using DocumentDB .NET SDK version 1.11.4 and above.</span></span> <span data-ttu-id="f8556-201">Tuttavia, se si usano query tra partizioni, è consigliabile usare l'elaborazione dell'host a 64 bit per migliorare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f8556-201">However, if you are using cross partition queries, 64-bit host processing is recommended for improved performance.</span></span> <span data-ttu-id="f8556-202">I tipi seguenti di applicazioni dispongono di un processo host a 32 bit per impostazione predefinita; per passare a un processo a 64 bit, seguire questi passaggi in base al tipo di applicazione:</span><span class="sxs-lookup"><span data-stu-id="f8556-202">The following types of applications have 32-bit host process as the default, so in order to change that to 64-bit, follow these steps based on the type of your application:</span></span>

    - <span data-ttu-id="f8556-203">Per le applicazioni eseguibili è possibile, a tale scopo, deselezionare l'opzione **Preferisci 32 bit** nella scheda **Compila** della finestra **Proprietà progetto**.</span><span class="sxs-lookup"><span data-stu-id="f8556-203">For Executable applications, this can be done by unchecking the **Prefer 32-bit** option in the **Project Properties** window, on the **Build** tab.</span></span>

    - <span data-ttu-id="f8556-204">Per progetti di test basati su VSTest questa operazione può essere eseguita selezionando **Test**->**Impostazioni test**->**Default Processor Architecture as X64** (Imposta architettura processore X64 come predefinita) dall'opzione **Visual Studio Test**.</span><span class="sxs-lookup"><span data-stu-id="f8556-204">For VSTest based test projects, this can be done by selecting **Test**->**Test Settings**->**Default Processor Architecture as X64**, from the **Visual Studio Test** menu option.</span></span>

    - <span data-ttu-id="f8556-205">Per le applicazioni Web ASP.NET distribuite in locale questa operazione può essere eseguita selezionando **Utilizzare la versione a 64 bit di IIS Express per progetti e siti Web** in **Strumenti**->**Opzioni**->**Progetti e soluzioni**->**Progetti Web**.</span><span class="sxs-lookup"><span data-stu-id="f8556-205">For locally deployed ASP.NET Web applications, this can be done by checking the **Use the 64-bit version of IIS Express for web sites and projects**, under **Tools**->**Options**->**Projects and Solutions**->**Web Projects**.</span></span>

    - <span data-ttu-id="f8556-206">Per le applicazioni Web ASP.NET distribuite in Azure questa operazione può essere eseguita selezionando **Platform as 64-bit** (Piattaforma 64 bit) in **Impostazioni applicazione** nel Portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="f8556-206">For ASP.NET Web applications deployed on Azure, this can be done by choosing the **Platform as 64-bit** in the **Application Settings** on the Azure portal.</span></span>

## <a name="indexing-policy"></a><span data-ttu-id="f8556-207">Criterio di indicizzazione</span><span class="sxs-lookup"><span data-stu-id="f8556-207">Indexing Policy</span></span>
1. <span data-ttu-id="f8556-208">**Usare l'indicizzazione differita per frequenze di inserimento più veloci nei momenti di massima attività**</span><span class="sxs-lookup"><span data-stu-id="f8556-208">**Use lazy indexing for faster peak time ingestion rates**</span></span>

    <span data-ttu-id="f8556-209">Cosmos DB consente di specificare criteri di indicizzazione a livello di raccolta che permettono di scegliere se i documenti di una raccolta devono essere indicizzati automaticamente o meno.</span><span class="sxs-lookup"><span data-stu-id="f8556-209">Cosmos DB allows you to specify – at the collection level – an indexing policy, which enables you to choose if you want the documents in a collection to be automatically indexed or not.</span></span>  <span data-ttu-id="f8556-210">È anche possibile scegliere tra aggiornamenti sincroni (coerenti) e asincroni (differiti).</span><span class="sxs-lookup"><span data-stu-id="f8556-210">In addition, you may also choose between synchronous (Consistent) and asynchronous (Lazy) index updates.</span></span> <span data-ttu-id="f8556-211">Per impostazione predefinita, l'indice viene aggiornato in modo sincrono a ogni inserimento, sostituzione o eliminazione di un documento nella raccolta.</span><span class="sxs-lookup"><span data-stu-id="f8556-211">By default, the index is updated synchronously on each insert, replace, or delete of a document to the collection.</span></span> <span data-ttu-id="f8556-212">La modalità sincrona consente alle query di rispettare lo stesso [livello di coerenza](consistency-levels.md) delle letture di documenti, senza che l'indice debba recuperare alcun ritardo.</span><span class="sxs-lookup"><span data-stu-id="f8556-212">Synchronously mode enables the queries to honor the same [consistency level](consistency-levels.md) as that of the document reads without any delay for the index to “catch up".</span></span>

    <span data-ttu-id="f8556-213">L'indicizzazione differita è consigliabile per gli scenari in cui i dati vengono scritti in burst e si vuole ammortizzare il lavoro necessario per indicizzare il contenuto dell'indice in un periodo di tempo più lungo.</span><span class="sxs-lookup"><span data-stu-id="f8556-213">Lazy indexing may be considered for scenarios in which data is written in bursts, and you want to amortize the work required to index content over a longer period of time.</span></span> <span data-ttu-id="f8556-214">L'indicizzazione differita consente di usare in modo efficiente la velocità effettiva con provisioning e di gestire le richieste di scrittura nei momenti di massima attività con latenza minima.</span><span class="sxs-lookup"><span data-stu-id="f8556-214">Lazy indexing also allows you to use your provisioned throughput effectively and serve write requests at peak times with minimal latency.</span></span> <span data-ttu-id="f8556-215">È importante notare, tuttavia, che con l'indicizzazione differita attivata i risultati delle query sono comunque coerenti indipendentemente dal livello di coerenza configurato per l'account Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="f8556-215">It is important to note, however, that when lazy indexing is enabled, query results are eventually consistent regardless of the consistency level configured for the Cosmos DB account.</span></span>

    <span data-ttu-id="f8556-216">La modalità di indicizzazione coerente (IndexingPolicy.IndexingMode impostato su Consistent) comporta gli addebiti più elevati per unità richiesta per ogni scrittura, mentre la modalità di indicizzazione differita (IndexingPolicy.IndexingMode impostato su Lazy) e l'assenza di indicizzazione (IndexingPolicy.Automatic impostato su False) non comportano alcun costo di indicizzazione al momento della scrittura.</span><span class="sxs-lookup"><span data-stu-id="f8556-216">Hence, Consistent indexing mode (IndexingPolicy.IndexingMode is set to Consistent) incurs the highest request unit charge per write, while Lazy indexing mode (IndexingPolicy.IndexingMode is set to Lazy) and no indexing (IndexingPolicy.Automatic is set to False) have zero indexing cost at the time of write.</span></span>
2. <span data-ttu-id="f8556-217">**Escludere i percorsi non usati dall'indicizzazione per scritture più veloci**</span><span class="sxs-lookup"><span data-stu-id="f8556-217">**Exclude unused paths from indexing for faster writes**</span></span>

    <span data-ttu-id="f8556-218">I criteri di indicizzazione di Cosmos DB consentono anche di specificare i percorsi dei documenti da includere o escludere dall'indicizzazione sfruttando i percorsi di indicizzazione (IndexingPolicy.IncludedPaths e IndexingPolicy.ExcludedPaths).</span><span class="sxs-lookup"><span data-stu-id="f8556-218">Cosmos DB’s indexing policy also allows you to specify which document paths to include or exclude from indexing by leveraging Indexing Paths (IndexingPolicy.IncludedPaths and IndexingPolicy.ExcludedPaths).</span></span> <span data-ttu-id="f8556-219">L'uso dei percorsi di indicizzazione può consentire di ottenere prestazioni migliori e di ridurre le risorse di archiviazione dell'indice per gli scenari in cui i modelli di query sono noti in anticipo, poiché i costi dell'indicizzazione sono correlati direttamente al numero di percorsi univoci indicizzati.</span><span class="sxs-lookup"><span data-stu-id="f8556-219">The use of indexing paths can offer improved write performance and lower index storage for scenarios in which the query patterns are known beforehand, as indexing costs are directly correlated to the number of unique paths indexed.</span></span>  <span data-ttu-id="f8556-220">Ad esempio, il codice seguente illustra come escludere un'intera sezione dei documenti, detta anche</span><span class="sxs-lookup"><span data-stu-id="f8556-220">For example, the following code shows how to exclude an entire section of the documents (a.k.a.</span></span> <span data-ttu-id="f8556-221">sottoalbero, dall'indicizzazione usando il carattere jolly "*".</span><span class="sxs-lookup"><span data-stu-id="f8556-221">a subtree) from indexing using the "*" wildcard.</span></span>

    ```C#
    var collection = new DocumentCollection { Id = "excludedPathCollection" };
    collection.IndexingPolicy.IncludedPaths.Add(new IncludedPath { Path = "/*" });
    collection.IndexingPolicy.ExcludedPaths.Add(new ExcludedPath { Path = "/nonIndexedContent/*");
    collection = await client.CreateDocumentCollectionAsync(UriFactory.CreateDatabaseUri("db"), excluded);
    ```

    <span data-ttu-id="f8556-222">Per altre informazioni, vedere l'articolo relativo ai [criteri di indicizzazione di Azure Cosmos DB](indexing-policies.md).</span><span class="sxs-lookup"><span data-stu-id="f8556-222">For more information, see [Azure Cosmos DB indexing policies](indexing-policies.md).</span></span>

## <a name="throughput"></a><span data-ttu-id="f8556-223">Velocità effettiva</span><span class="sxs-lookup"><span data-stu-id="f8556-223">Throughput</span></span>
<a id="measure-rus"></a>

1. <span data-ttu-id="f8556-224">**Misurare e ottimizzare per ottenere un utilizzo minore di unità richiesta al secondo**</span><span class="sxs-lookup"><span data-stu-id="f8556-224">**Measure and tune for lower request units/second usage**</span></span>

    <span data-ttu-id="f8556-225">Cosmos DB offre un'ampia gamma di operazioni di database, incluse le query relazionali e gerarchiche con funzioni definite dall'utente, stored procedure e trigger, operative nei documenti in una raccolta di database.</span><span class="sxs-lookup"><span data-stu-id="f8556-225">Cosmos DB offers a rich set of database operations including relational and hierarchical queries with UDFs, stored procedures, and triggers – all operating on the documents within a database collection.</span></span> <span data-ttu-id="f8556-226">Il costo associato a ognuna di queste operazioni dipende da CPU, I/O e memoria necessari per il completamento dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="f8556-226">The cost associated with each of these operations varies based on the CPU, IO, and memory required to complete the operation.</span></span> <span data-ttu-id="f8556-227">Invece di occuparsi della pianificazione e della gestione delle risorse hardware, sarà possibile usare un'unità di richiesta come misura singola per le risorse necessarie per eseguire diverse operazioni di database e rispondere a una richiesta dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f8556-227">Instead of thinking about and managing hardware resources, you can think of a request unit (RU) as a single measure for the resources required to perform various database operations and service an application request.</span></span>

    <span data-ttu-id="f8556-228">[unità richiesta](request-units.md) viene eseguito per ogni account di database in base al numero di unità di capacità acquistato.</span><span class="sxs-lookup"><span data-stu-id="f8556-228">[Request units](request-units.md) are provisioned for each database account based on the number of capacity units that you purchase.</span></span> <span data-ttu-id="f8556-229">Il consumo delle unità di richiesta è valutato in base alla frequenza al secondo.</span><span class="sxs-lookup"><span data-stu-id="f8556-229">Request unit consumption is evaluated as a rate per second.</span></span> <span data-ttu-id="f8556-230">Le applicazioni che superano il livello di unità richiesta con provisioning previsto per il relativo account sono limitate fino al ritorno del livello sotto il valore riservato per l'account.</span><span class="sxs-lookup"><span data-stu-id="f8556-230">Applications that exceed the provisioned request unit rate for their account is limited until the rate drops below the reserved level for the account.</span></span> <span data-ttu-id="f8556-231">Se l'applicazione necessita di un livello superiore di velocità effettiva, sarà possibile acquistare unità di capacità aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="f8556-231">If your application requires a higher level of throughput, you can purchase additional capacity units.</span></span>

    <span data-ttu-id="f8556-232">La complessità di una query influisce sulla quantità di unità richiesta utilizzate per un'operazione.</span><span class="sxs-lookup"><span data-stu-id="f8556-232">The complexity of a query impacts how many Request Units are consumed for an operation.</span></span> <span data-ttu-id="f8556-233">Il numero di predicati, la natura dei predicati, il numero di funzioni definite dall'utente e le dimensioni del set di dati di origine sono tutti fattori che incidono sul costo delle operazioni di query.</span><span class="sxs-lookup"><span data-stu-id="f8556-233">The number of predicates, nature of the predicates, number of UDFs, and the size of the source data set all influence the cost of query operations.</span></span>

    <span data-ttu-id="f8556-234">Per misurare l'overhead di qualunque operazione (create, update o delete), esaminare l'intestazione x-ms-request-charge (o la proprietà RequestCharge equivalente in ResourceResponse<T> oppure FeedResponse<T> in .NET SDK) per determinare il numero di unità richiesta usate da queste operazioni.</span><span class="sxs-lookup"><span data-stu-id="f8556-234">To measure the overhead of any operation (create, update, or delete), inspect the x-ms-request-charge header (or the equivalent RequestCharge property in ResourceResponse<T> or FeedResponse<T> in the .NET SDK) to measure the number of request units consumed by these operations.</span></span>

    ```C#
    // Measure the performance (request units) of writes
    ResourceResponse<Document> response = await client.CreateDocumentAsync(collectionSelfLink, myDocument);
    Console.WriteLine("Insert of document consumed {0} request units", response.RequestCharge);
    // Measure the performance (request units) of queries
    IDocumentQuery<dynamic> queryable = client.CreateDocumentQuery(collectionSelfLink, queryString).AsDocumentQuery();
    while (queryable.HasMoreResults)
         {
              FeedResponse<dynamic> queryResponse = await queryable.ExecuteNextAsync<dynamic>();
              Console.WriteLine("Query batch consumed {0} request units", queryResponse.RequestCharge);
         }
    ```             

    <span data-ttu-id="f8556-235">L'addebito richiesta restituito in questa intestazione è una frazione della velocità effettiva con provisioning, ad esempio 2000 UR/secondo.</span><span class="sxs-lookup"><span data-stu-id="f8556-235">The request charge returned in this header is a fraction of your provisioned throughput (i.e., 2000 RUs / second).</span></span> <span data-ttu-id="f8556-236">Se, ad esempio, la query precedente restituisce 1000 documenti da 1 KB, il costo dell'operazione è 1000.</span><span class="sxs-lookup"><span data-stu-id="f8556-236">For example, if the preceding query returns 1000 1KB-documents, the cost of the operation is 1000.</span></span> <span data-ttu-id="f8556-237">Entro un secondo, il server rispetterà quindi solo due richieste di questo tipo prima di limitare le richieste successive.</span><span class="sxs-lookup"><span data-stu-id="f8556-237">As such, within one second, the server honors only two such requests before throttling subsequent requests.</span></span> <span data-ttu-id="f8556-238">Per altre informazioni, vedere [Unità richiesta](request-units.md) e il [calcolatore di unità richiesta](https://www.documentdb.com/capacityplanner).</span><span class="sxs-lookup"><span data-stu-id="f8556-238">For more information, see [Request units](request-units.md) and the [request unit calculator](https://www.documentdb.com/capacityplanner).</span></span>
<a id="429"></a>
2. <span data-ttu-id="f8556-239">**Gestire la limitazione della frequenza o una frequenza di richieste troppo elevata**</span><span class="sxs-lookup"><span data-stu-id="f8556-239">**Handle rate limiting/request rate too large**</span></span>

    <span data-ttu-id="f8556-240">Quando un client prova a superare la velocità effettiva riservata per un account, non si verifica alcun calo delle prestazioni del server e l'uso della capacità della velocità effettiva non supera il livello riservato.</span><span class="sxs-lookup"><span data-stu-id="f8556-240">When a client attempts to exceed the reserved throughput for an account, there is no performance degradation at the server and no use of throughput capacity beyond the reserved level.</span></span> <span data-ttu-id="f8556-241">Il server termina preventivamente la richiesta con RequestRateTooLarge (codice di stato HTTP 429) e restituisce l'intestazione x-ms-retry-after-ms, che indica la quantità di tempo, in millisecondi, che l'utente deve attendere prima di eseguire di nuovo la richiesta.</span><span class="sxs-lookup"><span data-stu-id="f8556-241">The server will preemptively end the request with RequestRateTooLarge (HTTP status code 429) and return the x-ms-retry-after-ms header indicating the amount of time, in milliseconds, that the user must wait before reattempting the request.</span></span>

        HTTP Status 429,
        Status Line: RequestRateTooLarge
        x-ms-retry-after-ms :100

    <span data-ttu-id="f8556-242">Tutti gli SDK intercettano implicitamente questa risposta, rispettano l'intestazione retry-after specificata dal server e ripetono la richiesta.</span><span class="sxs-lookup"><span data-stu-id="f8556-242">The SDKs all implicitly catch this response, respect the server-specified retry-after header, and retry the request.</span></span> <span data-ttu-id="f8556-243">A meno che all'account non accedano contemporaneamente più client, il tentativo successivo riuscirà.</span><span class="sxs-lookup"><span data-stu-id="f8556-243">Unless your account is being accessed concurrently by multiple clients, the next retry will succeed.</span></span>

    <span data-ttu-id="f8556-244">Se più client operano collettivamente in modo costante al di sopra della frequenza delle richieste, il numero di ripetizioni dei tentativi predefinito attualmente impostato su 9 internamente dal client potrebbe non essere sufficiente. In questo caso, il client genererà una DocumentClientException con codice di stato 429 per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f8556-244">If you have more than one client cumulatively operating consistently above the request rate, the default retry count currently set to 9 internally by the client may not suffice; in this case, the client throws a DocumentClientException with status code 429 to the application.</span></span> <span data-ttu-id="f8556-245">Il numero di ripetizioni dei tentativi predefinito può essere modificato impostando RetryOptions nell'istanza di ConnectionPolicy.</span><span class="sxs-lookup"><span data-stu-id="f8556-245">The default retry count can be changed by setting the RetryOptions on the ConnectionPolicy instance.</span></span> <span data-ttu-id="f8556-246">Per impostazione predefinita, l'eccezione DocumentClientException con codice di stato 429 viene restituita dopo un tempo di attesa cumulativo di 30 secondi, se la richiesta continua a funzionare al di sopra della frequenza delle richieste.</span><span class="sxs-lookup"><span data-stu-id="f8556-246">By default, the DocumentClientException with status code 429 is returned after a cumulative wait time of 30 seconds if the request continues to operate above the request rate.</span></span> <span data-ttu-id="f8556-247">Ciò si verifica anche quando il numero di ripetizioni dei tentativi corrente è inferiore al numero massimo di tentativi, indipendentemente dal fatto che si tratti del valore predefinito 9 o di un valore definito dall'utente.</span><span class="sxs-lookup"><span data-stu-id="f8556-247">This occurs even when the current retry count is less than the max retry count, be it the default of 9 or a user-defined value.</span></span>

    <span data-ttu-id="f8556-248">Benché il comportamento automatizzato per la ripetizione dei tentativi consenta di migliorare la resilienza e l'usabilità per la maggior parte delle applicazioni, è possibile che provochi conflitti durante l'esecuzione dei benchmark delle prestazioni, in particolare durante la misurazione della latenza.</span><span class="sxs-lookup"><span data-stu-id="f8556-248">While the automated retry behavior helps to improve resiliency and usability for the most applications, it might come at odds when doing performance benchmarks, especially when measuring latency.</span></span>  <span data-ttu-id="f8556-249">La latenza osservata dal client presenterà dei picchi se l'esperimento raggiunge il limite del server e fa in modo che l'SDK client ripeta automaticamente i tentativi.</span><span class="sxs-lookup"><span data-stu-id="f8556-249">The client-observed latency will spike if the experiment hits the server throttle and causes the client SDK to silently retry.</span></span> <span data-ttu-id="f8556-250">Per evitare i picchi di latenza durante gli esperimenti relativi alle prestazioni, misurare l'addebito restituito da ogni operazione e assicurarsi che le richieste operino al di sotto della frequenza delle richieste riservata.</span><span class="sxs-lookup"><span data-stu-id="f8556-250">To avoid latency spikes during performance experiments, measure the charge returned by each operation and ensure that requests are operating below the reserved request rate.</span></span> <span data-ttu-id="f8556-251">Per altre informazioni, vedere [Unità richiesta](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="f8556-251">For more information, see [Request units](request-units.md).</span></span>
3. <span data-ttu-id="f8556-252">**Progettare documenti di dimensioni minori per ottenere una velocità effettiva maggiore**</span><span class="sxs-lookup"><span data-stu-id="f8556-252">**Design for smaller documents for higher throughput**</span></span>

    <span data-ttu-id="f8556-253">L'addebito per le richieste, ovvero il costo di elaborazione delle richieste, per un'operazione specifica è correlato direttamente alle dimensioni del documento.</span><span class="sxs-lookup"><span data-stu-id="f8556-253">The request charge (i.e. request processing cost) of a given operation is directly correlated to the size of the document.</span></span> <span data-ttu-id="f8556-254">Le operazioni sui documenti di grandi dimensioni sono più costose rispetto alle operazioni per i documenti di piccole dimensioni.</span><span class="sxs-lookup"><span data-stu-id="f8556-254">Operations on large documents cost more than operations for small documents.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f8556-255">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="f8556-255">Next steps</span></span>
<span data-ttu-id="f8556-256">Per un'applicazione di esempio usata per valutare Cosmos DB per scenari a prestazioni elevate su un numero ridotto di computer client, vedere [Test delle prestazioni e della scalabilità con Azure Cosmos DB](performance-testing.md).</span><span class="sxs-lookup"><span data-stu-id="f8556-256">For a sample application used to evaluate Cosmos DB for high-performance scenarios on a few client machines, see [Performance and scale testing with Cosmos DB](performance-testing.md).</span></span>

<span data-ttu-id="f8556-257">Per altre informazioni sulla progettazione dell'applicazione per scalabilità e prestazioni elevate, vedere l'articolo relativo a [partizionamento e scalabilità in Azure Cosmos DB](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="f8556-257">Also, to learn more about designing your application for scale and high performance, see [Partitioning and scaling in Azure Cosmos DB](partition-data.md).</span></span>
