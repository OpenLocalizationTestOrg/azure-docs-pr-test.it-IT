---
title: Risolvere i problemi relativi alle route - Portale | Documentazione Microsoft
description: Informazioni su come risolvere i problemi relativi alle route nel modello di distribuzione Azure Resource Manager usando il portale di Azure.
services: virtual-network
documentationcenter: na
author: AnithaAdusumilli
manager: narayan
editor: 
tags: azure-resource-manager
ms.assetid: bdd8b6dc-02fb-4057-bb23-8289caa9de89
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/23/2016
ms.author: anithaa
ms.openlocfilehash: dad415936280b4af916b8c46df46f6c51ac0bca4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshoot-routes-using-the-azure-portal"></a><span data-ttu-id="cb077-103">Risolvere i problemi relativi alle route con il portale di Azure</span><span class="sxs-lookup"><span data-stu-id="cb077-103">Troubleshoot routes using the Azure Portal</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="cb077-104">Portale di Azure</span><span class="sxs-lookup"><span data-stu-id="cb077-104">Azure Portal</span></span>](virtual-network-routes-troubleshoot-portal.md)
> * [<span data-ttu-id="cb077-105">PowerShell</span><span class="sxs-lookup"><span data-stu-id="cb077-105">PowerShell</span></span>](virtual-network-routes-troubleshoot-powershell.md)
>
>

<span data-ttu-id="cb077-106">Se si verificano problemi di connettività di rete da o verso una macchina virtuale (VM) di Azure, le route possono influire sui flussi di traffico della VM.</span><span class="sxs-lookup"><span data-stu-id="cb077-106">If you are experiencing network connectivity issues to or from your Azure Virtual Machine (VM), routes may be impacting your VM traffic flows.</span></span> <span data-ttu-id="cb077-107">In questo articolo viene fornita una panoramica delle funzionalità di diagnostica per le route che consentono di risolvere il problema.</span><span class="sxs-lookup"><span data-stu-id="cb077-107">This article provides an overview of diagnostics capabilities for routes to help troubleshoot further.</span></span>

<span data-ttu-id="cb077-108">Le tabelle di route sono associate alle subnet e valgono per tutte le interfacce di rete della subnet.</span><span class="sxs-lookup"><span data-stu-id="cb077-108">Route tables are associated with subnets and are effective on all network interfaces (NIC) in that subnet.</span></span> <span data-ttu-id="cb077-109">I seguenti tipi di route sono applicabili a ogni interfaccia di rete:</span><span class="sxs-lookup"><span data-stu-id="cb077-109">The following types of routes can be applied to each network interface:</span></span>

* <span data-ttu-id="cb077-110">**Route di sistema:** per impostazione predefinita, ogni subnet creata in una rete virtuale di Azure dispone di tabelle di route di sistema che consentono il traffico di rete virtuale locale, il traffico locale tramite gateway VPN e il traffico Internet.</span><span class="sxs-lookup"><span data-stu-id="cb077-110">**System routes:** By default, every subnet created in an Azure Virtual Network (VNet) has system route tables that allow local VNet traffic, on-premises traffic via VPN gateways, and Internet traffic.</span></span> <span data-ttu-id="cb077-111">Le route di sistema esistono anche per le reti virtuali con peering.</span><span class="sxs-lookup"><span data-stu-id="cb077-111">System routes also exist for peered VNets.</span></span>
* <span data-ttu-id="cb077-112">**Route BGP:** sono propagate alle interfacce di rete tramite connessioni VPN site-to-site o ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="cb077-112">**BGP routes:** Propagated to network interfaces through ExpressRoute or site-to-site VPN connections.</span></span> <span data-ttu-id="cb077-113">Per altre informazioni sul routing BGP, vedere gli articoli [BGP con i gateway VPN](../vpn-gateway/vpn-gateway-bgp-overview.md) e [Panoramica relativa a ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="cb077-113">Learn more about BGP routing by reading the [BGP with VPN gateways](../vpn-gateway/vpn-gateway-bgp-overview.md) and [ExpressRoute overview](../expressroute/expressroute-introduction.md) articles.</span></span>
* <span data-ttu-id="cb077-114">**Route definite dall'utente:** se si usano dispositivi virtuali di rete o si forza il tunneling del traffico verso una rete locale tramite una VPN site-to-site, potrebbero esserci route definite dall'utente associate alla tabella di route della subnet.</span><span class="sxs-lookup"><span data-stu-id="cb077-114">**User-defined routes (UDR):** If you are using network virtual appliances or are forced-tunneling traffic to an on-premises network via a site-to-site VPN, you may have user-defined routes (UDRs) associated with your subnet route table.</span></span> <span data-ttu-id="cb077-115">Se non si ha dimestichezza con le route definite dall'utente, leggere l'articolo sulle [route definite dall'utente](virtual-networks-udr-overview.md#user-defined-routes) .</span><span class="sxs-lookup"><span data-stu-id="cb077-115">If you're not familiar with UDRs, read the [user-defined routes](virtual-networks-udr-overview.md#user-defined-routes) article.</span></span>

<span data-ttu-id="cb077-116">Con le varie route che possono essere applicate a un'interfaccia di rete, può essere difficile determinare quali route di aggregazione sono efficaci.</span><span class="sxs-lookup"><span data-stu-id="cb077-116">With the various routes that can be applied to a network interface, it can be difficult to determine which aggregate routes are effective.</span></span> <span data-ttu-id="cb077-117">Per risolvere i problemi di connettività di rete delle VM, è possibile visualizzare tutte le route valide per un'interfaccia di rete nel modello di distribuzione Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="cb077-117">To help troubleshoot VM network connectivity, you can view all the effective routes for a network interface in the Azure Resource Manager deployment model.</span></span>

## <a name="using-effective-routes-to-troubleshoot-vm-traffic-flow"></a><span data-ttu-id="cb077-118">Uso di regole efficaci per risolvere i problemi di flusso del traffico delle VM</span><span class="sxs-lookup"><span data-stu-id="cb077-118">Using Effective Routes to troubleshoot VM traffic flow</span></span>
<span data-ttu-id="cb077-119">In questo articolo viene usato lo scenario seguente come esempio per illustrare come risolvere i problemi di route valide per un'interfaccia di rete:</span><span class="sxs-lookup"><span data-stu-id="cb077-119">This article uses the following scenario as an example to illustrate how to troubleshoot the effective routes for a network interface:</span></span>

<span data-ttu-id="cb077-120">Una VM (*VM1*) connessa alla rete virtuale (*VNet1*, prefisso 10.9.0.0/16) non è in grado di connettersi a un VM (VM3) in una rete virtuale di cui è appena stato eseguito il peering (*VNet3*, prefisso 10.10.0.0/16).</span><span class="sxs-lookup"><span data-stu-id="cb077-120">A VM (*VM1*) connected to the VNet (*VNet1*, prefix: 10.9.0.0/16) fails to connect to a VM(VM3) in a newly peered VNet (*VNet3*, prefix 10.10.0.0/16).</span></span> <span data-ttu-id="cb077-121">Non ci sono route definite dall'utente o route BGP applicate all'interfaccia di rete VM1-NIC1 connessa alla VM; sono applicate solo le route di sistema.</span><span class="sxs-lookup"><span data-stu-id="cb077-121">There are no UDRs or BGP routes applied to VM1-NIC1 network interface connected to the VM, only system routes are applied.</span></span>

<span data-ttu-id="cb077-122">Questo articolo spiega come determinare la causa dell'errore di connessione usando la capacità delle route valide nel modello di distribuzione Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="cb077-122">This article explains how to determine the cause of the connection failure, using effective routes capability in Azure Resource Management deployment model.</span></span>
<span data-ttu-id="cb077-123">Sebbene in questo esempio si usino solo le route di sistema, è possibile attenersi alla stessa procedura per determinare gli errori di connessione in ingresso e in uscita su qualsiasi tipo di route.</span><span class="sxs-lookup"><span data-stu-id="cb077-123">While the example uses only system routes, the same steps can be used to determine inbound and outbound connection failures over any route type.</span></span>

> [!NOTE]
> <span data-ttu-id="cb077-124">Se alla VM è collegata più di un'interfaccia di rete, verificare le route valide per ciascuna delle interfacce di rete per diagnosticare i problemi di connettività di rete da e verso una VM.</span><span class="sxs-lookup"><span data-stu-id="cb077-124">If your VM has more than one NIC attached, check effective routes for each of the NICs to diagnose network connectivity issues to and from a VM.</span></span>
>
>

### <a name="view-effective-routes-for-a-virtual-machine"></a><span data-ttu-id="cb077-125">Visualizzare le route valide per una macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="cb077-125">View effective routes for a virtual machine</span></span>
<span data-ttu-id="cb077-126">Per visualizzare le route di aggregazione applicate a una VM, completare i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="cb077-126">To see the aggregate routes that are applied to a VM, complete the following steps:</span></span>

1. <span data-ttu-id="cb077-127">Accedere al portale di Azure all'indirizzo https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="cb077-127">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="cb077-128">Fare clic su **Altri servizi** e quindi su **Macchine virtuali** nell'elenco visualizzato.</span><span class="sxs-lookup"><span data-stu-id="cb077-128">Click **More services**, then click **Virtual machines** in the list that appears.</span></span>
3. <span data-ttu-id="cb077-129">Selezionare una VM in cui risolvere i problemi nell'elenco visualizzato. Verrà visualizzato un pannello della VM contenente opzioni.</span><span class="sxs-lookup"><span data-stu-id="cb077-129">Select a VM to troubleshoot from the list that appears and a VM blade with options appears.</span></span>
4. <span data-ttu-id="cb077-130">Fare clic su **Diagnostica e risoluzione dei problemi** e quindi selezionare un problema comune.</span><span class="sxs-lookup"><span data-stu-id="cb077-130">Click **Diagnose & solve problems** and then select a common problem.</span></span> <span data-ttu-id="cb077-131">Per questo esempio si seleziona **Non è possibile connettersi alla macchina virtuale Windows** .</span><span class="sxs-lookup"><span data-stu-id="cb077-131">For this example, **I can’t connect to my Windows VM** is selected.</span></span>

    ![](./media/virtual-network-routes-troubleshoot-portal/image1.png)
5. <span data-ttu-id="cb077-132">Sotto il problema vengono visualizzati i passaggi, come illustrato nell'immagine seguente:</span><span class="sxs-lookup"><span data-stu-id="cb077-132">Steps appear under the problem, as shown in the following picture:</span></span>

    ![](./media/virtual-network-routes-troubleshoot-portal/image2.png)

    <span data-ttu-id="cb077-133">Fare clic su *effective routes* (route valide) nell'elenco dei passaggi consigliati.</span><span class="sxs-lookup"><span data-stu-id="cb077-133">Click *effective routes* in the list of recommended steps.</span></span>
6. <span data-ttu-id="cb077-134">Verrà visualizzato il pannello **Route valide** , come illustrato nell'immagine seguente:</span><span class="sxs-lookup"><span data-stu-id="cb077-134">The **Effective routes** blade appears, as shown in the following picture:</span></span>

    ![](./media/virtual-network-routes-troubleshoot-portal/image3.png)

    <span data-ttu-id="cb077-135">Se la VM ha una sola interfaccia di rete, sarà selezionata per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="cb077-135">If your VM has only one NIC, it is selected by default.</span></span> <span data-ttu-id="cb077-136">Se sono presenti più interfacce di rete, selezionare quella per cui si vogliono visualizzare le route valide.</span><span class="sxs-lookup"><span data-stu-id="cb077-136">If you have more than one NIC, select the NIC for which you want to view the effective routes.</span></span>

   > [!NOTE]
   > <span data-ttu-id="cb077-137">Se la VM associata all'interfaccia di rete non si trova in stato di esecuzione, le route valide non verranno visualizzate.</span><span class="sxs-lookup"><span data-stu-id="cb077-137">If the VM associated with the NIC is not in a running state, effective routes will not be shown.</span></span> <span data-ttu-id="cb077-138">Nel portale vengono visualizzate solo le prime 200 route valide.</span><span class="sxs-lookup"><span data-stu-id="cb077-138">Only the first 200 effective routes are shown in the portal.</span></span> <span data-ttu-id="cb077-139">Per l'elenco completo, fare clic su **Scarica**.</span><span class="sxs-lookup"><span data-stu-id="cb077-139">For the full list, click **Download**.</span></span> <span data-ttu-id="cb077-140">È possibile filtrare ulteriormente i risultati nel file con estensione csv scaricato.</span><span class="sxs-lookup"><span data-stu-id="cb077-140">You can further filter on the results from the downloaded .csv file.</span></span>
   >
   >

    <span data-ttu-id="cb077-141">Nell'output prestare attenzione agli aspetti seguenti.</span><span class="sxs-lookup"><span data-stu-id="cb077-141">Notice the following in the output:</span></span>

   * <span data-ttu-id="cb077-142">**Source**: indica il tipo di route.</span><span class="sxs-lookup"><span data-stu-id="cb077-142">**Source**: Indicates the type of route.</span></span> <span data-ttu-id="cb077-143">Le route di sistema vengono visualizzate come *Default*, le route definite dall'utente come *User* e le route del gateway (statiche o BGP) come *VPNGateway*.</span><span class="sxs-lookup"><span data-stu-id="cb077-143">System routes are shown as *Default*, UDRs are shown as *User* and gateway routes (static or BGP) are shown as *VPNGateway*.</span></span>
   * <span data-ttu-id="cb077-144">**State**: indica lo stato della route valida.</span><span class="sxs-lookup"><span data-stu-id="cb077-144">**State**: Indicates state of the effective route.</span></span> <span data-ttu-id="cb077-145">Alcuni valori possibili sono *Active* o *Invalid*.</span><span class="sxs-lookup"><span data-stu-id="cb077-145">Possible values are *Active* or *Invalid*.</span></span>
   * <span data-ttu-id="cb077-146">**AddressPrefixes**: specifica il prefisso dell'indirizzo della route valida in notazione CIDR.</span><span class="sxs-lookup"><span data-stu-id="cb077-146">**AddressPrefixes**: Specifies the address prefix of the effective route in CIDR notation.</span></span>
   * <span data-ttu-id="cb077-147">**nextHopType**: indica l'hop successivo per la route specificata.</span><span class="sxs-lookup"><span data-stu-id="cb077-147">**nextHopType**: Indicates the next hop for the given route.</span></span> <span data-ttu-id="cb077-148">I valori possibili sono *VirtualAppliance*, *Internet*, *VNetLocal*, *VNetPeering* e *Null*.</span><span class="sxs-lookup"><span data-stu-id="cb077-148">Possible values are *VirtualAppliance*, *Internet*, *VNetLocal*, *VNetPeering*, or *Null*.</span></span> <span data-ttu-id="cb077-149">Un valore *Null* per **nextHopType** in una route definita dall'utente potrebbe indicare una route non valida.</span><span class="sxs-lookup"><span data-stu-id="cb077-149">A value of *Null* for **nextHopType** in a UDR may indicate an invalid route.</span></span> <span data-ttu-id="cb077-150">Ad esempio, se **nextHopType** è *VirtualAppliance* e la VM del dispositivo virtuale di rete non si trova nello stato di provisioning/esecuzione.</span><span class="sxs-lookup"><span data-stu-id="cb077-150">For example, if **nextHopType** is *VirtualAppliance* and the network virtual appliance VM is not in a provisioned/running state.</span></span> <span data-ttu-id="cb077-151">Se **nextHopType** è *VPNGateway* e non sono presenti gateway in provisioning/in esecuzione nella rete virtuale specificata, la route potrebbe diventare non valida.</span><span class="sxs-lookup"><span data-stu-id="cb077-151">If **nextHopType** is *VPNGateway* and there is no gateway provisioned/running in the given VNet, the route may become invalid.</span></span>
7. <span data-ttu-id="cb077-152">Nell'immagine del passaggio precedente non sono elencate route alla rete virtuale *WestUS-VNET3* (prefisso 10.10.0.0/16) da *WestUS-VNet1* (prefisso 10.9.0.0/16).</span><span class="sxs-lookup"><span data-stu-id="cb077-152">There is no route listed to the *WestUS-VNET3* VNet (Prefix 10.10.0.0/16) from the *WestUS-VNet1* (Prefix 10.9.0.0/16) in the picture in the previous step.</span></span> <span data-ttu-id="cb077-153">Nell'immagine seguente, lo stato del collegamento per il peering è *Disconnesso* :</span><span class="sxs-lookup"><span data-stu-id="cb077-153">In the following picture, the peering link is in the *Disconnected* state:</span></span>

    ![](./media/virtual-network-routes-troubleshoot-portal/image4.png)

    <span data-ttu-id="cb077-154">Il collegamento bidirezionale per il peering è interrotto e questo spiega perché la macchina virtuale VM1 non è riuscita a connettersi a VM3 nella rete virtuale *WestUS-VNet3* .</span><span class="sxs-lookup"><span data-stu-id="cb077-154">The bi-directional link for the peering is broken, which explains why VM1 could not connect to VM3 in the *WestUS-VNet3* VNet.</span></span>
8. <span data-ttu-id="cb077-155">L'immagine seguente illustra le route dopo che è stato stabilito il collegamento bidirezionale per il peering:</span><span class="sxs-lookup"><span data-stu-id="cb077-155">The following picture shows the routes after establishing the bi-directional peering link:</span></span>

    ![](./media/virtual-network-routes-troubleshoot-portal/image5.png)

<span data-ttu-id="cb077-156">Per altri scenari di risoluzione dei problemi correlati al tunneling forzato e alla valutazione delle route, vedere la sezione [Considerazioni](virtual-network-routes-troubleshoot-portal.md#considerations) di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="cb077-156">For more troubleshooting scenarios for forced-tunneling and route evaluation, read the [Considerations](virtual-network-routes-troubleshoot-portal.md#considerations) section of this article.</span></span>

### <a name="view-effective-routes-for-a-network-interface"></a><span data-ttu-id="cb077-157">Visualizzare le route valide per un'interfaccia di rete</span><span class="sxs-lookup"><span data-stu-id="cb077-157">View effective routes for a network interface</span></span>
<span data-ttu-id="cb077-158">In caso di impatto sul flusso del traffico di rete per una determinata interfaccia di rete, è possibile visualizzare direttamente un elenco completo delle route valide nell'interfaccia di rete.</span><span class="sxs-lookup"><span data-stu-id="cb077-158">If network traffic flow is impacted for a particular network interface (NIC), you can view a full list of effective routes on a NIC directly.</span></span> <span data-ttu-id="cb077-159">Per visualizzare le route aggregate applicate a un'interfaccia di rete, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="cb077-159">To see the aggregate routes that are applied to a NIC, complete the following steps:</span></span>

1. <span data-ttu-id="cb077-160">Accedere al portale di Azure all'indirizzo https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="cb077-160">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="cb077-161">Fare clic su **Altri servizi** e quindi su **Interfacce di rete**</span><span class="sxs-lookup"><span data-stu-id="cb077-161">Click **More services**, then click **Network interfaces**</span></span>
3. <span data-ttu-id="cb077-162">Cercare nell'elenco il nome di un'interfaccia di rete oppure selezionarlo nell'elenco visualizzato.</span><span class="sxs-lookup"><span data-stu-id="cb077-162">Search the list for the name of a NIC, or select it from the list that appears.</span></span> <span data-ttu-id="cb077-163">In questo esempio si seleziona **VM1-NIC1** .</span><span class="sxs-lookup"><span data-stu-id="cb077-163">In this example, **VM1-NIC1** is selected.</span></span>
4. <span data-ttu-id="cb077-164">Selezionare **Route valide** nel pannello **Interfaccia di rete**, come illustrato nell'immagine seguente:</span><span class="sxs-lookup"><span data-stu-id="cb077-164">Select **Effective routes** in the **Network interface** blade, as shown in the following picture:</span></span>

       ![](./media/virtual-network-routes-troubleshoot-portal/image6.png)

    <span data-ttu-id="cb077-165">L'impostazione predefinita di **Ambito** corrisponde all'interfaccia di rete selezionata.</span><span class="sxs-lookup"><span data-stu-id="cb077-165">The **Scope** defaults to the network interface selected.</span></span>

      ![](./media/virtual-network-routes-troubleshoot-portal/image7.png)

### <a name="view-effective-routes-for-a-route-table"></a><span data-ttu-id="cb077-166">Visualizzare le route valide per una tabella di route</span><span class="sxs-lookup"><span data-stu-id="cb077-166">View effective routes for a route table</span></span>
<span data-ttu-id="cb077-167">Quando si modificano route definite dall'utente in una tabella di route, può essere opportuno esaminare l'impatto delle route aggiunte in una determinata VM.</span><span class="sxs-lookup"><span data-stu-id="cb077-167">When modifying user-defined routes (UDRs) in a route table, you may want to review the impact of the routes being added on a particular VM.</span></span> <span data-ttu-id="cb077-168">Una tabella di route può essere associata a qualsiasi numero di subnet.</span><span class="sxs-lookup"><span data-stu-id="cb077-168">A route table can be associated with any number of subnets.</span></span> <span data-ttu-id="cb077-169">È ora possibile visualizzare tutte le route valide per tutte le interfacce di rete a cui è applicata una determinata tabella di route restando nel contesto del pannello della specifica tabella di route.</span><span class="sxs-lookup"><span data-stu-id="cb077-169">You can now view all the effective routes for all the NICs that a given route table is applied to, without having to switch context from the given route table blade.</span></span>

<span data-ttu-id="cb077-170">Per questo esempio, la route definita dall'utente *UDRoute* è specificata nella tabella di route *UDRouteTable*.</span><span class="sxs-lookup"><span data-stu-id="cb077-170">For this example, a UDR (*UDRoute*) is specified in a route table (*UDRouteTable*).</span></span> <span data-ttu-id="cb077-171">Questa route invia tutto il traffico Internet da *Subnet1* della rete virtuale *WestUS-VNet1*, attraverso un'appliance virtuale di rete, a *Subnet2* della stessa rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="cb077-171">This route sends all Internet traffic from *Subnet1* in the *WestUS-VNet1* VNet, through a network virtual appliance (NVA), in *Subnet2* of the same VNet.</span></span> <span data-ttu-id="cb077-172">La route è illustrata nella figura seguente:</span><span class="sxs-lookup"><span data-stu-id="cb077-172">The route is shown in the following picture:</span></span>

![](./media/virtual-network-routes-troubleshoot-portal/image8.png)

<span data-ttu-id="cb077-173">Per visualizzare le route aggregate per una tabella di rete, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="cb077-173">To see the aggregate routes for a route table, complete the following steps:</span></span>

1. <span data-ttu-id="cb077-174">Accedere al portale di Azure all'indirizzo https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="cb077-174">Login to the Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="cb077-175">Fare clic su **Altri servizi** e quindi su **Tabelle route**</span><span class="sxs-lookup"><span data-stu-id="cb077-175">Click **More services**, then click **Route tables**</span></span>
3. <span data-ttu-id="cb077-176">Cercare nell'elenco la tabella di route per cui si vogliono visualizzare le route aggregate e selezionarla.</span><span class="sxs-lookup"><span data-stu-id="cb077-176">Search the list for the route table you want to see aggregate routes for and select it.</span></span> <span data-ttu-id="cb077-177">In questo esempio si seleziona **UDRouteTable** .</span><span class="sxs-lookup"><span data-stu-id="cb077-177">In this example, **UDRouteTable** is selected.</span></span> <span data-ttu-id="cb077-178">Viene visualizzato un pannello per la tabella di route selezionata, come illustrato nell'immagine seguente:</span><span class="sxs-lookup"><span data-stu-id="cb077-178">A blade for the selected route table appears, as shown in the following picture:</span></span>

    ![](./media/virtual-network-routes-troubleshoot-portal/image9.png)
4. <span data-ttu-id="cb077-179">Selezionare **Route valide** nel pannello **Tabella route**.</span><span class="sxs-lookup"><span data-stu-id="cb077-179">Select **Effective Routes** in the **Route table** blade.</span></span> <span data-ttu-id="cb077-180">L'impostazione di **Ambito** corrisponde alla tabella di route selezionata.</span><span class="sxs-lookup"><span data-stu-id="cb077-180">The **Scope** is set to the route table you selected.</span></span>
5. <span data-ttu-id="cb077-181">Una tabella di route può essere applicata a più subnet.</span><span class="sxs-lookup"><span data-stu-id="cb077-181">A route table can be applied to multiple subnets.</span></span> <span data-ttu-id="cb077-182">In **Subnet** selezionare quella che si vuole esaminare nell'elenco.</span><span class="sxs-lookup"><span data-stu-id="cb077-182">Select the **Subnet** you want to review from the list.</span></span> <span data-ttu-id="cb077-183">In questo esempio si seleziona **Subnet1** .</span><span class="sxs-lookup"><span data-stu-id="cb077-183">In this example, **Subnet1** is selected.</span></span>
6. <span data-ttu-id="cb077-184">Selezionare un'opzione in **Interfaccia di rete**.</span><span class="sxs-lookup"><span data-stu-id="cb077-184">Select a **Network Interface**.</span></span> <span data-ttu-id="cb077-185">Nell'elenco sono incluse tutte le interfacce di rete connesse alla subnet selezionata.</span><span class="sxs-lookup"><span data-stu-id="cb077-185">All NICs connected to the selected subnet are listed.</span></span> <span data-ttu-id="cb077-186">In questo esempio si seleziona **VM1-NIC1** .</span><span class="sxs-lookup"><span data-stu-id="cb077-186">In this example, **VM1-NIC1** is selected.</span></span>

    ![](./media/virtual-network-routes-troubleshoot-portal/image10.png)

   > [!NOTE]
   > <span data-ttu-id="cb077-187">Se l'interfaccia di rete non è associata a una VM in esecuzione, non vengono visualizzate route valide.</span><span class="sxs-lookup"><span data-stu-id="cb077-187">If the NIC is not associated with a running VM, no effective routes are shown.</span></span>
   >
   >

## <a name="considerations"></a><span data-ttu-id="cb077-188">Considerazioni</span><span class="sxs-lookup"><span data-stu-id="cb077-188">Considerations</span></span>
<span data-ttu-id="cb077-189">Alcuni aspetti da tenere presenti quando si esamina l'elenco delle route restituito:</span><span class="sxs-lookup"><span data-stu-id="cb077-189">A few things to keep in mind when reviewing the list of routes returned:</span></span>

* <span data-ttu-id="cb077-190">Il routing è basato sulla corrispondenza del prefisso più lunga (LPM) tra le route definite dall'utente, BGP e di sistema.</span><span class="sxs-lookup"><span data-stu-id="cb077-190">Routing is based on Longest Prefix Match (LPM) among UDRs, BGP and system routes.</span></span> <span data-ttu-id="cb077-191">Se è presente più di una route con la stessa corrispondenza LPM, allora la route viene selezionata in base alla sua origine nell'ordine seguente:</span><span class="sxs-lookup"><span data-stu-id="cb077-191">If there is more than one route with the same LPM match, then a route is selected based on its origin in the following order:</span></span>

  * <span data-ttu-id="cb077-192">Route definita dall'utente</span><span class="sxs-lookup"><span data-stu-id="cb077-192">User-defined route</span></span>
  * <span data-ttu-id="cb077-193">Route BGP</span><span class="sxs-lookup"><span data-stu-id="cb077-193">BGP route</span></span>
  * <span data-ttu-id="cb077-194">Route di sistema (predefinita)</span><span class="sxs-lookup"><span data-stu-id="cb077-194">System (Default) route</span></span>

    <span data-ttu-id="cb077-195">Con route valide, è possibile vedere solo route valide con corrispondenza LPM basata su tutte le route disponibili.</span><span class="sxs-lookup"><span data-stu-id="cb077-195">With effective routes, you can only see effective routes that are LPM match based on all the availble routes.</span></span> <span data-ttu-id="cb077-196">Mostrando come le route vengono effettivamente valutate per un'interfaccia di rete specificata, è molto più semplice risolvere i problemi delle route specifiche che potrebbero influire sulle connettività da e verso la VM.</span><span class="sxs-lookup"><span data-stu-id="cb077-196">By showing how the routes are actually evaluated for a given NIC, this makes it a lot easier to troubleshoot specific routes that may be impacting connectivity to/from your VM.</span></span>
* <span data-ttu-id="cb077-197">Se si dispone di route definite dall'utente e si invia traffico a un dispositivo virtuale di rete, con *VirtualAppliance* come **nextHopType**, assicurarsi che l'inoltro IP sia abilitato nel dispositivo virtuale di rete che riceve il traffico o che i pacchetti vengano eliminati.</span><span class="sxs-lookup"><span data-stu-id="cb077-197">If you have UDRs and are sending traffic to a network virtual appliance (NVA), with *VirtualAppliance* as **nextHopType**, ensure that IP forwarding is enabled on the NVA receiving the traffic or packets are dropped.</span></span>
* <span data-ttu-id="cb077-198">Se è abilitato il tunneling forzato, tutto il traffico Internet in uscita verrà instradato in locale.</span><span class="sxs-lookup"><span data-stu-id="cb077-198">If Forced tunneling is enabled, all outbound Internet traffic will be routed to on-premises.</span></span> <span data-ttu-id="cb077-199">Una connessione RDP o SSH da Internet alla VM potrebbe non funzionare con questa impostazione, a seconda di come l'hardware di rete locale gestisce il traffico.</span><span class="sxs-lookup"><span data-stu-id="cb077-199">RDP/SSH from Internet to your VM may not work with this setting, depending on how the on-premises handles this traffic.</span></span>
  <span data-ttu-id="cb077-200">Il tunneling forzato può essere abilitato:</span><span class="sxs-lookup"><span data-stu-id="cb077-200">Forced-tunneling can be enabled:</span></span>
  * <span data-ttu-id="cb077-201">Se si usa una VPN site-to-site, impostando una route definita dall'utente con nextHopType come Gateway VPN</span><span class="sxs-lookup"><span data-stu-id="cb077-201">If using site-to-site VPN, by setting a user-defined route (UDR) with nextHopType as VPN Gateway</span></span>
  * <span data-ttu-id="cb077-202">Se una route predefinita è pubblicizzata su BGP</span><span class="sxs-lookup"><span data-stu-id="cb077-202">If a default route is advertised over BGP</span></span>
* <span data-ttu-id="cb077-203">Per il corretto funzionamento del traffico peering di rete virtuale, deve esistere una route di sistema con **nextHopType** *VNetPeering* per l'intervallo dei prefissi della rete virtuale con peering.</span><span class="sxs-lookup"><span data-stu-id="cb077-203">For VNet peering traffic to work correctly, a system route with **nextHopType** *VNetPeering* must exist for the peered VNet’s prefix range.</span></span> <span data-ttu-id="cb077-204">Se non esiste una route di questo tipo e il collegamento di peering della rete virtuale ha un aspetto corretto:</span><span class="sxs-lookup"><span data-stu-id="cb077-204">If such a route doesn’t exist and the VNet peering link looks OK:</span></span>
  * <span data-ttu-id="cb077-205">Attendere alcuni secondi e riprovare, se si tratta di un collegamento di peering appena stabilito.</span><span class="sxs-lookup"><span data-stu-id="cb077-205">Wait a few seconds and retry if it's a newly established peering link.</span></span> <span data-ttu-id="cb077-206">In alcuni casi è necessario più tempo per propagare le route a tutte le interfacce di rete in una subnet.</span><span class="sxs-lookup"><span data-stu-id="cb077-206">It occasionally takes longer to propagate routes to all the network interfaces in a subnet.</span></span>
  * <span data-ttu-id="cb077-207">Le regole del gruppo di sicurezza di rete possono influire sui flussi di traffico.</span><span class="sxs-lookup"><span data-stu-id="cb077-207">Network Security Group (NSG) rules may be impacting the traffic flows.</span></span> <span data-ttu-id="cb077-208">Per altre informazioni, vedere l'articolo [Troubleshoot Network Security Groups](virtual-network-nsg-troubleshoot-portal.md) (Risolvere i problemi dei gruppi di sicurezza di rete).</span><span class="sxs-lookup"><span data-stu-id="cb077-208">For more information, see the [Troubleshoot Network Security Groups](virtual-network-nsg-troubleshoot-portal.md) article.</span></span>
