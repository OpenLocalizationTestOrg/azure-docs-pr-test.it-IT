---
title: Abilitare l'accesso remoto a SharePoint con il proxy di applicazione di Azure AD | Microsoft Docs
description: Offre le informazioni di base necessarie per integrare un server SharePoint locale con il proxy di applicazione di Azure AD.
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/21/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: 97eeec3b3936bcbef6ac3966b890332901bcb153
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/03/2017
---
# <a name="enable-remote-access-to-sharepoint-with-azure-ad-application-proxy"></a><span data-ttu-id="c894e-103">Abilitare l'accesso remoto a SharePoint con il proxy di applicazione di Azure AD</span><span class="sxs-lookup"><span data-stu-id="c894e-103">Enable remote access to SharePoint with Azure AD Application Proxy</span></span>

<span data-ttu-id="c894e-104">Questo articolo illustra come integrare un server SharePoint locale con il proxy di applicazione di Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="c894e-104">This article discusses how to integrate an on-premises SharePoint server with Azure Active Directory (Azure AD) Application Proxy.</span></span>

<span data-ttu-id="c894e-105">Per abilitare l'accesso remoto a SharePoint con il proxy di applicazione di Azure AD, seguire le istruzioni dettagliate riportate nelle sezioni di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="c894e-105">To enable remote access to SharePoint with Azure AD Application Proxy, follow the sections in this article step by step.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="c894e-106">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="c894e-106">Prerequisites</span></span>

<span data-ttu-id="c894e-107">Questo articolo presuppone che SharePoint 2013 o versione successiva sia già installato nell'ambiente.</span><span class="sxs-lookup"><span data-stu-id="c894e-107">This article assumes that you already have SharePoint 2013 or newer in your environment.</span></span> <span data-ttu-id="c894e-108">Tenere in considerazione anche i seguenti prerequisiti:</span><span class="sxs-lookup"><span data-stu-id="c894e-108">In addition, consider the following prerequisites:</span></span>

* <span data-ttu-id="c894e-109">SharePoint include il supporto nativo di Kerberos.</span><span class="sxs-lookup"><span data-stu-id="c894e-109">SharePoint includes native Kerberos support.</span></span> <span data-ttu-id="c894e-110">Di conseguenza, gli utenti che accedono in remoto ai siti interni tramite il proxy di applicazione di Azure AD possono presumere di essere in possesso dell'esperienza Single Sign-On.</span><span class="sxs-lookup"><span data-stu-id="c894e-110">Therefore, users who are accessing internal sites remotely through Azure AD Application Proxy can assume to have a single sign-on (SSO) experience.</span></span>

* <span data-ttu-id="c894e-111">È necessario apportare alcune modifiche di configurazione al server SharePoint.</span><span class="sxs-lookup"><span data-stu-id="c894e-111">You need to make a few configuration changes to your SharePoint server.</span></span> <span data-ttu-id="c894e-112">Si consiglia di usare un ambiente di gestione temporanea.</span><span class="sxs-lookup"><span data-stu-id="c894e-112">We recommend using a staging environment.</span></span> <span data-ttu-id="c894e-113">In questo modo, è possibile apportare aggiornamenti al server di gestione temporanea e quindi facilitare un ciclo di test prima del passaggio in produzione.</span><span class="sxs-lookup"><span data-stu-id="c894e-113">This way, you can make updates to your staging server first, and then facilitate a testing cycle before going into production.</span></span>

* <span data-ttu-id="c894e-114">Si presuppone che sia già stato configurato SSL per SharePoint, poiché SSL è necessario sull'URL pubblicato.</span><span class="sxs-lookup"><span data-stu-id="c894e-114">We assume that you have already set up SSL for SharePoint, because we require SSL on the published URL.</span></span> <span data-ttu-id="c894e-115">Per garantire che i collegamenti vengano inviati e mappati correttamente, è necessario anche che SSL sia abilitato nel sito interno.</span><span class="sxs-lookup"><span data-stu-id="c894e-115">You need to have SSL enabled on your internal site, to ensure that links are sent/mapped correctly.</span></span> <span data-ttu-id="c894e-116">Se SSL non è ancora stato configurato, vedere [Configure SSL for SharePoint 2013](https://blogs.msdn.microsoft.com/fabdulwahab/2013/01/20/configure-ssl-for-sharepoint-2013) (Configurare SSL per SharePoint 2013) per le necessarie istruzioni.</span><span class="sxs-lookup"><span data-stu-id="c894e-116">If you haven't configured SSL, see [Configure SSL for SharePoint 2013](https://blogs.msdn.microsoft.com/fabdulwahab/2013/01/20/configure-ssl-for-sharepoint-2013) for instructions.</span></span> <span data-ttu-id="c894e-117">Inoltre assicurarsi che il computer di connessione consideri attendibile il certificato che si emette</span><span class="sxs-lookup"><span data-stu-id="c894e-117">Also, make sure that the connector machine trusts the certificate that you issue.</span></span> <span data-ttu-id="c894e-118">(non deve essere necessariamente un certificato rilasciato pubblicamente).</span><span class="sxs-lookup"><span data-stu-id="c894e-118">(The certificate does not need to be publicly issued.)</span></span>

## <a name="step-1-set-up-single-sign-on-to-sharepoint"></a><span data-ttu-id="c894e-119">Passaggio 1: Configurare l'accesso Single Sign-On a SharePoint</span><span class="sxs-lookup"><span data-stu-id="c894e-119">Step 1: Set up single sign-on to SharePoint</span></span>

<span data-ttu-id="c894e-120">I clienti vogliono disporre di un semplice accesso SSO alle applicazioni back-end, in questo caso al server SharePoint.</span><span class="sxs-lookup"><span data-stu-id="c894e-120">Our customers want the best SSO experience for their back-end applications, SharePoint server in this case.</span></span> <span data-ttu-id="c894e-121">In questo scenario comune di Azure AD, l'utente viene autenticato una sola volta poiché l'autenticazione non verrà richiesta nuovamente.</span><span class="sxs-lookup"><span data-stu-id="c894e-121">In this common Azure AD scenario, the user is authenticated only once, because they will not be prompted for authentication again.</span></span>

<span data-ttu-id="c894e-122">Per le applicazioni locali che richiedono o usano l'autenticazione di Windows è possibile ottenere l'accesso SSO usando il protocollo di autenticazione Kerberos e una funzionalità denominata delega vincolata Kerberos (KCD).</span><span class="sxs-lookup"><span data-stu-id="c894e-122">For on-premises applications that require or use Windows authentication, you can achieve SSO by using the Kerberos authentication protocol and a feature called Kerberos constrained delegation (KCD).</span></span> <span data-ttu-id="c894e-123">Se configurata, questa funzionalità consente al connettore del proxy di applicazione di ottenere un ticket/token di Windows per un utente, anche se questi non ha eseguito l'accesso direttamente in Windows.</span><span class="sxs-lookup"><span data-stu-id="c894e-123">KCD, when configured, allows the Application Proxy connector to obtain a windows ticket/token for a user, even if the user hasn’t signed in to Windows directly.</span></span> <span data-ttu-id="c894e-124">Per altre informazioni sulla delega vincolata Kerberos, vedere [Panoramica della delega vincolata Kerberos](https://technet.microsoft.com/library/jj553400.aspx).</span><span class="sxs-lookup"><span data-stu-id="c894e-124">To learn more about KCD, see [Kerberos Constrained Delegation Overview](https://technet.microsoft.com/library/jj553400.aspx).</span></span>

<span data-ttu-id="c894e-125">Per configurare la delega vincolata Kerberos per un server SharePoint, usare le procedure descritte nelle sezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="c894e-125">To set up KCD for a SharePoint server, use the procedures in the following sequential sections:</span></span>

### <a name="ensure-that-sharepoint-is-running-under-a-service-account"></a><span data-ttu-id="c894e-126">Verificare che SharePoint sia in esecuzione in un account di servizio</span><span class="sxs-lookup"><span data-stu-id="c894e-126">Ensure that SharePoint is running under a service account</span></span>

<span data-ttu-id="c894e-127">Verificare che SharePoint sia in esecuzione in un account di servizio definito, non in un sistema locale, un servizio locale o un servizio di rete.</span><span class="sxs-lookup"><span data-stu-id="c894e-127">First, make sure that SharePoint is running under a defined service account--not local system, local service, or network service.</span></span> <span data-ttu-id="c894e-128">Eseguire questa operazione in modo da poter associare i nomi di entità servizio (SPN) a un account valido.</span><span class="sxs-lookup"><span data-stu-id="c894e-128">Do this so that you can attach service principal names (SPNs) to a valid account.</span></span> <span data-ttu-id="c894e-129">I nomi SPN sono usati dal protocollo Kerberos per identificare i diversi servizi</span><span class="sxs-lookup"><span data-stu-id="c894e-129">SPNs are how the Kerberos protocol identifies different services.</span></span> <span data-ttu-id="c894e-130">e saranno necessari in seguito per configurare la delega vincolata Kerberos.</span><span class="sxs-lookup"><span data-stu-id="c894e-130">And you will need the account later to configure the KCD.</span></span>

<span data-ttu-id="c894e-131">Per garantire che i siti siano in esecuzione in un account di servizio definito, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="c894e-131">To ensure that your sites are running under a defined service account, perform the following steps:</span></span>

1. <span data-ttu-id="c894e-132">Aprire il sito **Amministrazione centrale SharePoint 2013**.</span><span class="sxs-lookup"><span data-stu-id="c894e-132">Open the **SharePoint 2013 Central Administration** site.</span></span>
2. <span data-ttu-id="c894e-133">Passare a **Sicurezza** e selezionare **Configura account di servizio**.</span><span class="sxs-lookup"><span data-stu-id="c894e-133">Go to **Security** and select **Configure service accounts**.</span></span>
3. <span data-ttu-id="c894e-134">Selezionare **Pool di applicazioni Web - SharePoint - 80**.</span><span class="sxs-lookup"><span data-stu-id="c894e-134">Select **Web Application Pool - SharePoint - 80**.</span></span> <span data-ttu-id="c894e-135">È possibile che le opzioni siano leggermente diverse, a seconda del nome del pool Web o se il pool Web usa SSL per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="c894e-135">The options may be slightly different based on the name of your web pool, or if the web pool uses SSL by default.</span></span>

  ![Opzioni per la configurazione di un account di servizio](./media/application-proxy-remote-sharepoint/remote-sharepoint-service-web-application.png)

4. <span data-ttu-id="c894e-137">Se l'opzione attiva per **Selezionare un account per il componente** è **Servizio locale** o **Servizio di rete**, sarà necessario creare un account.</span><span class="sxs-lookup"><span data-stu-id="c894e-137">If **Select an account for this component** is **Local Service** or **Network Service**, you need to create an account.</span></span> <span data-ttu-id="c894e-138">In caso contrario, l'operazione è terminata ed è possibile procedere alla sezione successiva.</span><span class="sxs-lookup"><span data-stu-id="c894e-138">If not, you're finished and can move to the next section.</span></span>
5. <span data-ttu-id="c894e-139">Selezionare **Registra nuovo account gestito**.</span><span class="sxs-lookup"><span data-stu-id="c894e-139">Select **Register new managed account**.</span></span> <span data-ttu-id="c894e-140">Dopo aver creato l'account, prima di poterlo usare è necessario impostare l'opzione **Pool di applicazioni Web**.</span><span class="sxs-lookup"><span data-stu-id="c894e-140">After your account is created, you must set **Web Application Pool** before you can use the account.</span></span>

> [!NOTE]
<span data-ttu-id="c894e-141">È necessario avere un account di Azure AD creato in precedenza per il servizio.</span><span class="sxs-lookup"><span data-stu-id="c894e-141">You need to have a previously created Azure AD account for the service.</span></span> <span data-ttu-id="c894e-142">Si consiglia di consentire la modifica automatica della password.</span><span class="sxs-lookup"><span data-stu-id="c894e-142">We suggest that you allow for an automatic password change.</span></span> <span data-ttu-id="c894e-143">Per altre informazioni sull'insieme completo di passaggi e sulla risoluzione di problemi, vedere [Configurare la modifica automatica della password in SharePoint 2013](https://technet.microsoft.com/library/ff724280.aspx).</span><span class="sxs-lookup"><span data-stu-id="c894e-143">For more information about the full set of steps and troubleshooting issues, see [Configure automatic password change in SharePoint 2013](https://technet.microsoft.com/library/ff724280.aspx).</span></span>

### <a name="configure-sharepoint-for-kerberos"></a><span data-ttu-id="c894e-144">Configurare SharePoint per Kerberos</span><span class="sxs-lookup"><span data-stu-id="c894e-144">Configure SharePoint for Kerberos</span></span>

<span data-ttu-id="c894e-145">Si usa la delega vincolata Kerberos per eseguire l'accesso Single Sign-On al server SharePoint (operazione possibile solo con Kerberos).</span><span class="sxs-lookup"><span data-stu-id="c894e-145">You use KCD to perform single sign-on to the SharePoint server, and this works only with Kerberos.</span></span>

<span data-ttu-id="c894e-146">Per configurare il sito di SharePoint per l'autenticazione Kerberos:</span><span class="sxs-lookup"><span data-stu-id="c894e-146">To configure your SharePoint site for Kerberos authentication:</span></span>

1. <span data-ttu-id="c894e-147">Aprire il sito **Amministrazione centrale SharePoint 2013**.</span><span class="sxs-lookup"><span data-stu-id="c894e-147">Open the **SharePoint 2013 Central Administration** site.</span></span>
2. <span data-ttu-id="c894e-148">Passare a **Gestione applicazioni**, selezionare **Gestisci applicazioni Web** e selezionare il sito di SharePoint.</span><span class="sxs-lookup"><span data-stu-id="c894e-148">Go to **Application Management**, select **Manage web applications**, and select your SharePoint site.</span></span> <span data-ttu-id="c894e-149">In questo esempio si tratta di **SharePoint - 80**.</span><span class="sxs-lookup"><span data-stu-id="c894e-149">In this example, it is **SharePoint - 80**.</span></span>

  ![Selezione del sito di SharePoint](./media/application-proxy-remote-sharepoint/remote-sharepoint-manage-web-applications.png)

3. <span data-ttu-id="c894e-151">Fare clic su **Provider di autenticazione** sulla barra degli strumenti.</span><span class="sxs-lookup"><span data-stu-id="c894e-151">Click **Authentication Providers** on the toolbar.</span></span>
4. <span data-ttu-id="c894e-152">Nella casella **Provider di autenticazione** fare clic su **Area predefinita** per visualizzare le impostazioni.</span><span class="sxs-lookup"><span data-stu-id="c894e-152">In the **Authentication Providers** box, click **Default Zone** to view the settings.</span></span>
5. <span data-ttu-id="c894e-153">Nella casella di controllo **Modifica autenticazione** scorrere verso il basso fino a visualizzare **Tipi di autenticazione delle attestazioni** e assicurarsi che siano selezionate entrambe le opzioni **Abilita autenticazione di Windows** e **Autenticazione di Windows integrata**.</span><span class="sxs-lookup"><span data-stu-id="c894e-153">In the **Edit Authentication** dialog box, scroll down until you see **Claims Authentication Types** and ensure that both **Enable Windows Authentication** and **Integrated Windows Authentication** are selected.</span></span>
6. <span data-ttu-id="c894e-154">Nella casella di riepilogo a discesa verificare che sia selezionata l'opzione **Negozia (Kerberos)**.</span><span class="sxs-lookup"><span data-stu-id="c894e-154">In the drop-down box, make sure that **Negotiate (Kerberos)** is selected.</span></span>

  ![Finestra di dialogo Modifica autenticazione](./media/application-proxy-remote-sharepoint/remote-sharepoint-service-edit-authentication.png)

7. <span data-ttu-id="c894e-156">Nella parte inferiore della finestra di dialogo **Modifica autenticazione** fare clic su **Salva**.</span><span class="sxs-lookup"><span data-stu-id="c894e-156">At the bottom of the **Edit Authentication** dialog box, click **Save**.</span></span>

### <a name="set-a-service-principal-name-for-the-sharepoint-service-account"></a><span data-ttu-id="c894e-157">Impostare un nome dell'entità servizio per l'account del servizio SharePoint</span><span class="sxs-lookup"><span data-stu-id="c894e-157">Set a service principal name for the SharePoint service account</span></span>

<span data-ttu-id="c894e-158">Prima di configurare la delega vincolata Kerberos è necessario identificare il servizio SharePoint in esecuzione come account del servizio configurato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="c894e-158">Before you configure the KCD, you need to identify the SharePoint service running as the service account that you've configured.</span></span> <span data-ttu-id="c894e-159">A questo scopo è necessario impostare un nome di entità servizio (SPN).</span><span class="sxs-lookup"><span data-stu-id="c894e-159">You do this by setting an SPN.</span></span> <span data-ttu-id="c894e-160">Per altre informazioni vedere [Service Principal Names](https://technet.microsoft.com/library/cc961723.aspx) (Nomi di entità servizio).</span><span class="sxs-lookup"><span data-stu-id="c894e-160">For more information, see [Service Principal Names](https://technet.microsoft.com/library/cc961723.aspx).</span></span>

<span data-ttu-id="c894e-161">Il formato del nome SPN è:</span><span class="sxs-lookup"><span data-stu-id="c894e-161">The SPN format is:</span></span>

```
<service class>/<host>:<port>
```

<span data-ttu-id="c894e-162">Nel formato SPN:</span><span class="sxs-lookup"><span data-stu-id="c894e-162">In the SPN format:</span></span>

* <span data-ttu-id="c894e-163">La _classe di servizio_ è un nome univoco per il servizio.</span><span class="sxs-lookup"><span data-stu-id="c894e-163">_service class_ is a unique name for the service.</span></span> <span data-ttu-id="c894e-164">Per SharePoint si usa **HTTP**.</span><span class="sxs-lookup"><span data-stu-id="c894e-164">For SharePoint, you use **HTTP**.</span></span>

* <span data-ttu-id="c894e-165">L'_host_ è il nome di dominio completo o il nome Netbios dell'host in cui il servizio è in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="c894e-165">_host_ is the fully qualified domain or NetBIOS name of the host that the service is running on.</span></span> <span data-ttu-id="c894e-166">Per un sito di SharePoint può essere necessario questo testo sia l'URL del sito, a seconda della versione di IIS in uso.</span><span class="sxs-lookup"><span data-stu-id="c894e-166">For a SharePoint site, this text might need to be the URL of the site, depending on the version of IIS that you're using.</span></span>

* <span data-ttu-id="c894e-167">La _porta_ è opzionale.</span><span class="sxs-lookup"><span data-stu-id="c894e-167">_port_ is optional.</span></span>

<span data-ttu-id="c894e-168">Se il nome di dominio completo del server SharePoint è:</span><span class="sxs-lookup"><span data-stu-id="c894e-168">If the FQDN of the SharePoint server is:</span></span>

```
sharepoint.demo.o365identity.us
```

<span data-ttu-id="c894e-169">Il nome SPN sarà:</span><span class="sxs-lookup"><span data-stu-id="c894e-169">Then the SPN is:</span></span>

```
HTTP/ sharepoint.demo.o365identity.us demo
```

<span data-ttu-id="c894e-170">Potrebbe essere necessario anche impostare nomi SPN per siti specifici sul server.</span><span class="sxs-lookup"><span data-stu-id="c894e-170">You might also need to set SPNs for specific sites on your server.</span></span> <span data-ttu-id="c894e-171">Per altre informazioni, vedere [Configurare l'autenticazione Kerberos](https://technet.microsoft.com/library/cc263449(v=office.12).aspx).</span><span class="sxs-lookup"><span data-stu-id="c894e-171">For more information, see [Configure Kerberos authentication](https://technet.microsoft.com/library/cc263449(v=office.12).aspx).</span></span> <span data-ttu-id="c894e-172">Leggere con attenzione la sezione "Creare nomi delle entità servizio per applicazioni Web mediante l'autenticazione Kerberos".</span><span class="sxs-lookup"><span data-stu-id="c894e-172">Pay close attention to the section "Create Service Principal Names for your Web applications using Kerberos authentication."</span></span>

<span data-ttu-id="c894e-173">Il modo più semplice per impostare nomi SPN è quello di seguire i formati dei nomi SPN già presenti per altri siti.</span><span class="sxs-lookup"><span data-stu-id="c894e-173">The easiest way for you to set SPNs is to follow the SPN formats that may already be present for your sites.</span></span> <span data-ttu-id="c894e-174">Copiare i nomi SPN per la registrazione con l'account del servizio.</span><span class="sxs-lookup"><span data-stu-id="c894e-174">Copy those SPNs to register against the service account.</span></span> <span data-ttu-id="c894e-175">A tale scopo, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="c894e-175">To do this:</span></span>

1. <span data-ttu-id="c894e-176">Passare al sito con il nome SPN da un altro computer.</span><span class="sxs-lookup"><span data-stu-id="c894e-176">Browse to the site with the SPN from another machine.</span></span>
 <span data-ttu-id="c894e-177">Quando si esegue questa operazione, il gruppo di ticket Kerberos pertinente viene memorizzato nella cache del computer.</span><span class="sxs-lookup"><span data-stu-id="c894e-177">When you do, the relevant set of Kerberos tickets is cached on the machine.</span></span> <span data-ttu-id="c894e-178">Questi ticket contengono il nome SPN del sito di destinazione a cui si è passati.</span><span class="sxs-lookup"><span data-stu-id="c894e-178">These tickets contain the SPN of the target site that you browsed to.</span></span>

2. <span data-ttu-id="c894e-179">È possibile estrarre il nome SPN per il sito usando uno strumento denominato [Klist](http://web.mit.edu/kerberos/krb5-devel/doc/user/user_commands/klist.html).</span><span class="sxs-lookup"><span data-stu-id="c894e-179">You can pull the SPN for that site by using a tool called [Klist](http://web.mit.edu/kerberos/krb5-devel/doc/user/user_commands/klist.html).</span></span> <span data-ttu-id="c894e-180">In una finestra di comando in esecuzione nello stesso contesto dell'utente che ha eseguito l'accesso al sito nel browser eseguire il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="c894e-180">In a command window that's running in the same context as the user who accessed the site in the browser, run the following command:</span></span>
```
Klist
```
<span data-ttu-id="c894e-181">Klist restituisce quindi il set di nomi SPN di destinazione.</span><span class="sxs-lookup"><span data-stu-id="c894e-181">Klist then returns the set of target SPNs.</span></span> <span data-ttu-id="c894e-182">In questo esempio il valore evidenziato è il nome SPN necessario:</span><span class="sxs-lookup"><span data-stu-id="c894e-182">In this example, the highlighted value is the SPN that's needed:</span></span>

  ![Risultati Klist di esempio](./media/application-proxy-remote-sharepoint/remote-sharepoint-target-service.png)

4. <span data-ttu-id="c894e-184">Ora che si dispone del nome SPN, è necessario assicurarsi che sia configurato correttamente per l'account del servizio impostato in precedenza per l'applicazione Web.</span><span class="sxs-lookup"><span data-stu-id="c894e-184">Now that you have the SPN, you need to make sure that it's configured correctly on the service account that you set up for the web application earlier.</span></span> <span data-ttu-id="c894e-185">Eseguire il comando seguente dal prompt dei comandi come amministratore del dominio:</span><span class="sxs-lookup"><span data-stu-id="c894e-185">Run the following command from the command prompt as an administrator of the domain:</span></span>

 ```
 setspn -S http/sharepoint.demo.o365identity.us demo\sp_svc
 ```

 <span data-ttu-id="c894e-186">Questo comando imposta il nome SPN per l'account del servizio SharePoint in esecuzione come _demo\sp_svc_.</span><span class="sxs-lookup"><span data-stu-id="c894e-186">This command sets the SPN for the SharePoint service account running as _demo\sp_svc_.</span></span>

 <span data-ttu-id="c894e-187">Sostituire _http/sharepoint.demo.o365identity.us_ con il nome SPN per il server e _demo\sp_svc_ con l'account del servizio nel proprio ambiente.</span><span class="sxs-lookup"><span data-stu-id="c894e-187">Replace _http/sharepoint.demo.o365identity.us_ with the SPN for your server and _demo\sp_svc_ with the service account in your environment.</span></span> <span data-ttu-id="c894e-188">Il comando Setspn cerca il nome SPN prima di aggiungerlo.</span><span class="sxs-lookup"><span data-stu-id="c894e-188">The Setspn command searches for the SPN before it adds it.</span></span> <span data-ttu-id="c894e-189">In questo caso è possibile che venga restituito un errore di **valore SPN duplicato**.</span><span class="sxs-lookup"><span data-stu-id="c894e-189">In this case, you might see a **Duplicate SPN Value** error.</span></span> <span data-ttu-id="c894e-190">Se viene visualizzato questo errore, assicurarsi che il valore sia associato con l'account del servizio.</span><span class="sxs-lookup"><span data-stu-id="c894e-190">If you see this error, make sure that the value is associated with the service account.</span></span>

<span data-ttu-id="c894e-191">È possibile verificare che il nome SPN sia stato aggiunto tramite il comando Setspn con l'opzione -l.</span><span class="sxs-lookup"><span data-stu-id="c894e-191">You can verify that the SPN was added by running the Setspn command with the -l option.</span></span> <span data-ttu-id="c894e-192">Per altre informazioni su questo comando, vedere [Setspn](https://technet.microsoft.com/library/cc731241.aspx).</span><span class="sxs-lookup"><span data-stu-id="c894e-192">To learn more about this command, see [Setspn](https://technet.microsoft.com/library/cc731241.aspx).</span></span>

### <a name="ensure-that-the-connector-is-set-as-a-trusted-delegate-to-sharepoint"></a><span data-ttu-id="c894e-193">Verificare che il connettore sia impostato come delegato attendibile a SharePoint</span><span class="sxs-lookup"><span data-stu-id="c894e-193">Ensure that the connector is set as a trusted delegate to SharePoint</span></span>

<span data-ttu-id="c894e-194">Configurare la delega vincolata Kerberos in modo che il servizio proxy di applicazione di Azure AD possa delegare le identità utente al servizio SharePoint.</span><span class="sxs-lookup"><span data-stu-id="c894e-194">Configure the KCD so that the Azure AD Application Proxy service can delegate user identities to the SharePoint service.</span></span> <span data-ttu-id="c894e-195">A questo scopo, consentire al connettore del proxy di applicazione di recuperare i ticket Kerberos per gli utenti che si sono autenticati in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c894e-195">You do this by enabling the Application Proxy connector to retrieve Kerberos tickets for your users who have been authenticated in Azure AD.</span></span> <span data-ttu-id="c894e-196">Quindi il server passa il contesto all'applicazione di destinazione o, in questo caso, a SharePoint.</span><span class="sxs-lookup"><span data-stu-id="c894e-196">Then that server passes the context to the target application, or SharePoint in this case.</span></span>

<span data-ttu-id="c894e-197">Per configurare la delega vincolata Kerberos, ripetere i passaggi seguenti per ogni computer di connessione:</span><span class="sxs-lookup"><span data-stu-id="c894e-197">To configure the KCD, repeat the following steps for each connector machine:</span></span>

1. <span data-ttu-id="c894e-198">Eseguire l'accesso come amministratore a un controller di dominio e quindi aprire un dominio **Utenti e computer di Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="c894e-198">Log in as a domain administrator to a DC, and then open **Active Directory Users and Computers**.</span></span>
2. <span data-ttu-id="c894e-199">Trovare il computer in cui è in esecuzione il connettore.</span><span class="sxs-lookup"><span data-stu-id="c894e-199">Find the computer that the connector is running on.</span></span> <span data-ttu-id="c894e-200">In questo esempio è lo stesso server SharePoint.</span><span class="sxs-lookup"><span data-stu-id="c894e-200">In this example, it's the same SharePoint server.</span></span>
3. <span data-ttu-id="c894e-201">Fare doppio clic sul computer e quindi sulla scheda **Delega**.</span><span class="sxs-lookup"><span data-stu-id="c894e-201">Double-click the computer, and then click the **Delegation** tab.</span></span>
4. <span data-ttu-id="c894e-202">Assicurarsi che l'impostazione attiva per la delega sia **Computer attendibile per la delega solo ai servizi specificati** e quindi selezionare **Usa un qualsiasi protocollo di autenticazione**.</span><span class="sxs-lookup"><span data-stu-id="c894e-202">Ensure that the delegation settings are set to **Trust this computer for delegation to the specified services only**, and then select **Use any authentication protocol**.</span></span>

  ![Impostazioni di delega](./media/application-proxy-remote-sharepoint/remote-sharepoint-delegation-box.png)

5. <span data-ttu-id="c894e-204">Fare clic sul pulsante **Aggiungi** e quindi su **Utenti o computer**e individuare l'account del servizio.</span><span class="sxs-lookup"><span data-stu-id="c894e-204">Click the **Add** button, click **Users or Computers**, and locate the service account.</span></span>

  ![Aggiungere il nome SPN per l'account del servizio](./media/application-proxy-remote-sharepoint/remote-sharepoint-users-computers.png)

6. <span data-ttu-id="c894e-206">Nell'elenco di nomi SPN selezionare quello creato in precedenza per l'account del servizio.</span><span class="sxs-lookup"><span data-stu-id="c894e-206">In the list of SPNs, select the one that you created earlier for the service account.</span></span>
7. <span data-ttu-id="c894e-207">Fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="c894e-207">Click **OK**.</span></span> <span data-ttu-id="c894e-208">Fare nuovamente clic su **OK** per salvare le modifiche.</span><span class="sxs-lookup"><span data-stu-id="c894e-208">Click **OK** again to save the changes.</span></span>

## <a name="step-2-enable-remote-access-to-sharepoint"></a><span data-ttu-id="c894e-209">Passaggio 2: Abilitare l'accesso remoto a SharePoint</span><span class="sxs-lookup"><span data-stu-id="c894e-209">Step 2: Enable remote access to SharePoint</span></span>

<span data-ttu-id="c894e-210">Ora che SharePoint è stato abilitato per Kerberos ed è stata configurata la delega vincolata Kerberos, è possibile configurare l'accesso Single Sign-On a SharePoint.</span><span class="sxs-lookup"><span data-stu-id="c894e-210">Now that you’ve enabled SharePoint for Kerberos and configured KCD, you're ready to set up single sign-on to SharePoint.</span></span> <span data-ttu-id="c894e-211">Dal connettore è quindi possibile pubblicare la farm di SharePoint per l'accesso remoto tramite il proxy di applicazione di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c894e-211">Then from the connector, you can publish the SharePoint farm for remote access through Azure AD Application Proxy.</span></span>

<span data-ttu-id="c894e-212">Per eseguire la procedura seguente è necessario essere un membro del ruolo Amministratore globale nell'account di Azure Active Directory aziendale.</span><span class="sxs-lookup"><span data-stu-id="c894e-212">To perform the following steps, you need to be a member of the Global Administrator Role in your organization's Azure Active Directory account.</span></span>

1. <span data-ttu-id="c894e-213">Accedere al [portale di Azure](https://manage.windowsazure.com) e trovare il tenant di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c894e-213">Sign in to the [Azure portal](https://manage.windowsazure.com) and find your Azure AD tenant.</span></span>
2. <span data-ttu-id="c894e-214">Fare clic su **Applicazioni** e quindi su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="c894e-214">Click **Applications**, and then click **Add**.</span></span>
3. <span data-ttu-id="c894e-215">Selezionare **Pubblica un'applicazione che sarà accessibile dall'esterno della rete**.</span><span class="sxs-lookup"><span data-stu-id="c894e-215">Select **Publish an application that will be accessible from outside your network**.</span></span> <span data-ttu-id="c894e-216">Se questa opzione non è presente, assicurarsi che nel tenant sia installato Azure AD Basic o Premium.</span><span class="sxs-lookup"><span data-stu-id="c894e-216">If you don’t see this option, make sure that you have Azure AD Basic or Premium set up in the tenant.</span></span>
4. <span data-ttu-id="c894e-217">Completare le opzioni come segue:</span><span class="sxs-lookup"><span data-stu-id="c894e-217">Complete each of the options as follows:</span></span>
 * <span data-ttu-id="c894e-218">**Nome**: qualsiasi valore desiderato, ad esempio **SharePoint**.</span><span class="sxs-lookup"><span data-stu-id="c894e-218">**Name**: Use any value that you want--for example, **SharePoint**.</span></span>
 * <span data-ttu-id="c894e-219">**URL interno**: si tratta dell'URL del sito di SharePoint nella forma interna, ad esempio **https://SharePoint/**.</span><span class="sxs-lookup"><span data-stu-id="c894e-219">**Internal URL**: This is the URL of the SharePoint site internally, such as **https://SharePoint/**.</span></span> <span data-ttu-id="c894e-220">In questo esempio assicurarsi di usare **https**.</span><span class="sxs-lookup"><span data-stu-id="c894e-220">In this example, make sure to use **https**.</span></span>
 * <span data-ttu-id="c894e-221">**Metodo di autenticazione preliminare**: selezionare **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="c894e-221">**Preauthentication Method**: Select **Azure Active Directory**.</span></span>

  ![Opzioni per l'aggiunta di un'applicazione](./media/application-proxy-remote-sharepoint/remote-sharepoint-add-application.png)

5. <span data-ttu-id="c894e-223">Dopo la pubblicazione dell'app fare clic sulla scheda **Configura**.</span><span class="sxs-lookup"><span data-stu-id="c894e-223">After the app is published, click the **Configure** tab.</span></span>
6. <span data-ttu-id="c894e-224">Scorrere fino all'opzione **Convertire l'URL nelle intestazioni**.</span><span class="sxs-lookup"><span data-stu-id="c894e-224">Scroll down to the option **Translate URL in Headers**.</span></span> <span data-ttu-id="c894e-225">Il valore predefinito è **SÌ**.</span><span class="sxs-lookup"><span data-stu-id="c894e-225">The default value is **YES**.</span></span> <span data-ttu-id="c894e-226">Modificarlo in **NO**.</span><span class="sxs-lookup"><span data-stu-id="c894e-226">Change it to **NO**.</span></span>

 <span data-ttu-id="c894e-227">SharePoint usa il valore _Intestazione host_ per cercare il sito</span><span class="sxs-lookup"><span data-stu-id="c894e-227">SharePoint uses the _Host Header_ value to look up the site.</span></span> <span data-ttu-id="c894e-228">e, in base a questo valore, genera i collegamenti.</span><span class="sxs-lookup"><span data-stu-id="c894e-228">It also generates links based on this value.</span></span> <span data-ttu-id="c894e-229">In questo modo si ha la sicurezza che qualsiasi collegamento generato da SharePoint sia un URL pubblicato correttamente impostato per l'uso dell'URL esterno.</span><span class="sxs-lookup"><span data-stu-id="c894e-229">The net effect is to make sure that any link that SharePoint generates is a published URL that is correctly set to use the external URL.</span></span> <span data-ttu-id="c894e-230">Impostando il valore su **SÌ** si consente al connettore di inoltrare la richiesta all'applicazione back-end.</span><span class="sxs-lookup"><span data-stu-id="c894e-230">Setting the value to **YES** also enables the connector to forward the request to the back-end application.</span></span> <span data-ttu-id="c894e-231">Se invece si imposta il valore su **NO**, il connettore non invierà il nome host interno,</span><span class="sxs-lookup"><span data-stu-id="c894e-231">However, setting the value to **NO** means that the connector will not send the internal host name.</span></span> <span data-ttu-id="c894e-232">ma invia l'intestazione host come URL pubblicato per l'applicazione back-end.</span><span class="sxs-lookup"><span data-stu-id="c894e-232">Instead, the connector sends the host header as the published URL to the back-end application.</span></span>

 <span data-ttu-id="c894e-233">Inoltre, per garantire che SharePoint accetti questo URL, è necessario completare un'ulteriore configurazione nel server SharePoint.</span><span class="sxs-lookup"><span data-stu-id="c894e-233">Also, to ensure that SharePoint accepts this URL, you need to complete one more configuration on the SharePoint server.</span></span> <span data-ttu-id="c894e-234">Questa operazione viene illustrata nella sezione seguente.</span><span class="sxs-lookup"><span data-stu-id="c894e-234">You'll do that in the next section.</span></span>

7. <span data-ttu-id="c894e-235">Impostare **Metodo di autenticazione interna** su **Autenticazione integrata di Windows**.</span><span class="sxs-lookup"><span data-stu-id="c894e-235">Change **Internal Authentication Method** to **Integrated Windows Authentication**.</span></span> <span data-ttu-id="c894e-236">Se il tenant Azure AD usa nel cloud un UPN diverso rispetto a quello locale, aggiornare anche l'opzione **Identità di accesso delegata**.</span><span class="sxs-lookup"><span data-stu-id="c894e-236">If your Azure AD tenant uses a UPN in the cloud that's different from the UPN on-premises, remember to update **Delegated Login Identity** as well.</span></span>
8. <span data-ttu-id="c894e-237">Impostare **Nome dell'entità servizio dell'applicazione interna** sul valore impostato in precedenza,</span><span class="sxs-lookup"><span data-stu-id="c894e-237">Set **Internal Application SPN** to the value that you set earlier.</span></span> <span data-ttu-id="c894e-238">ad esempio **http/sharepoint.demo.o365identity.us**.</span><span class="sxs-lookup"><span data-stu-id="c894e-238">For example, use **http/sharepoint.demo.o365identity.us**.</span></span>
9. <span data-ttu-id="c894e-239">Assegnare l'applicazione agli utenti di destinazione.</span><span class="sxs-lookup"><span data-stu-id="c894e-239">Assign the application to your target users.</span></span>

<span data-ttu-id="c894e-240">L'applicazione dovrebbe essere simile al seguente esempio:</span><span class="sxs-lookup"><span data-stu-id="c894e-240">Your application should look similar to the following example:</span></span>

  ![Applicazione finita](./media/application-proxy-remote-sharepoint/remote-sharepoint-internal-application-spn.png)

## <a name="step-3-ensure-that-sharepoint-knows-about-the-external-url"></a><span data-ttu-id="c894e-242">Passaggio 3: Assicurarsi che SharePoint sia al corrente dell'URL esterno</span><span class="sxs-lookup"><span data-stu-id="c894e-242">Step 3: Ensure that SharePoint knows about the external URL</span></span>

<span data-ttu-id="c894e-243">L'ultimo passaggio consiste nell'accertarsi che SharePoint possa trovare il sito in base all'URL esterno, in modo da poter sviluppare i collegamenti in base a tale URL.</span><span class="sxs-lookup"><span data-stu-id="c894e-243">Your last step to ensure that SharePoint can find the site based on the external URL, so that it will render links based on that external URL.</span></span> <span data-ttu-id="c894e-244">A questo scopo, si configurano mapping di accesso alternativo per SharePoint.</span><span class="sxs-lookup"><span data-stu-id="c894e-244">You do this by configuring alternate access mappings for the SharePoint site.</span></span>

1. <span data-ttu-id="c894e-245">Aprire il sito **Amministrazione centrale SharePoint 2013**.</span><span class="sxs-lookup"><span data-stu-id="c894e-245">Open the **SharePoint 2013 Central Administration** site.</span></span>
2. <span data-ttu-id="c894e-246">In **Impostazioni di sistema** selezionare **Configura mapping di accesso alternativo**.</span><span class="sxs-lookup"><span data-stu-id="c894e-246">Under **System Settings**, select **Configure Alternate Access Mappings**.</span></span>

 <span data-ttu-id="c894e-247">Verrà visualizzata la casella **Mapping di accesso alternativo**.</span><span class="sxs-lookup"><span data-stu-id="c894e-247">This opens the **Alternate Access Mappings** box.</span></span>

  ![Casella Mapping di accesso alternativo](./media/application-proxy-remote-sharepoint/remote-sharepoint-alternate-access1.png)

3. <span data-ttu-id="c894e-249">Nell'elenco a discesa accanto a **Raccolta di mapping di accesso alternativo** selezionare **Change Alternate Access Mapping Collection** (Cambia raccolta di mapping di accesso alternativo).</span><span class="sxs-lookup"><span data-stu-id="c894e-249">In the drop-down list beside **Alternate Access Mapping Collection**, select **Change Alternate Access Mapping Collection**.</span></span>
4. <span data-ttu-id="c894e-250">Selezionare il sito, ad esempio **SharePoint - 80**.</span><span class="sxs-lookup"><span data-stu-id="c894e-250">Select your site--for example, **SharePoint - 80**.</span></span>

  ![Selezione di un sito](./media/application-proxy-remote-sharepoint/remote-sharepoint-alternate-access2.png)

5. <span data-ttu-id="c894e-252">È possibile scegliere di aggiungere l'URL pubblicato come URL interno o URL pubblico.</span><span class="sxs-lookup"><span data-stu-id="c894e-252">You can choose to add the published URL as either an internal URL or a public URL.</span></span> <span data-ttu-id="c894e-253">Questo esempio usa un URL pubblico come extranet.</span><span class="sxs-lookup"><span data-stu-id="c894e-253">This example uses a public URL as the extranet.</span></span>
6. <span data-ttu-id="c894e-254">Fare clic su **Modifica URL pubblici** nel percorso **Extranet** e quindi immettere il percorso dell'applicazione pubblicata, come nel passaggio precedente.</span><span class="sxs-lookup"><span data-stu-id="c894e-254">Click **Edit Public URLs** in the **Extranet** path, and then enter the path for the published application, as in the previous step.</span></span> <span data-ttu-id="c894e-255">Ad esempio: **https://sharepoint-iddemo.msappproxy.net**.</span><span class="sxs-lookup"><span data-stu-id="c894e-255">For example, enter **https://sharepoint-iddemo.msappproxy.net**.</span></span>

  ![Definizione del percorso](./media/application-proxy-remote-sharepoint/remote-sharepoint-alternate-access3.png)

7. <span data-ttu-id="c894e-257">Fare clic su **Save**.</span><span class="sxs-lookup"><span data-stu-id="c894e-257">Click **Save**.</span></span>

 <span data-ttu-id="c894e-258">È ora possibile accedere al sito di SharePoint esternamente tramite il proxy di applicazione di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c894e-258">You can now access the SharePoint site externally via Azure AD Application Proxy.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c894e-259">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="c894e-259">Next steps</span></span>

- [<span data-ttu-id="c894e-260">Come fornire l'accesso remoto sicuro alle applicazioni locali</span><span class="sxs-lookup"><span data-stu-id="c894e-260">How to provide secure remote access to on-premises applications</span></span>](active-directory-application-proxy-get-started.md)
- [<span data-ttu-id="c894e-261">Comprendere i connettori del proxy applicazione Azure AD</span><span class="sxs-lookup"><span data-stu-id="c894e-261">Understand Azure AD Application Proxy connectors</span></span>](application-proxy-understand-connectors.md)
- <span data-ttu-id="c894e-262">[Publishing SharePoint 2016 and Office Online Server with Azure AD Application Proxy](https://blogs.technet.microsoft.com/dawiese/2016/06/09/publishing-sharepoint-2016-and-office-online-server-with-azure-ad-application-proxy/) (Pubblicazione su SharePoint 2016 e Office Online Server con il proxy di applicazione Azure AD)</span><span class="sxs-lookup"><span data-stu-id="c894e-262">[Publishing SharePoint 2016 and Office Online Server with Azure AD Application Proxy](https://blogs.technet.microsoft.com/dawiese/2016/06/09/publishing-sharepoint-2016-and-office-online-server-with-azure-ad-application-proxy/)</span></span>
