---
title: aaaOperating archivio Query nel Database SQL di Azure
description: Informazioni su come toooperate hello archivio Query nel Database SQL di Azure
keywords: 
services: sql-database
documentationcenter: 
author: bonova
manager: jhubbard
editor: 
ms.assetid: 0cccf6bd-1327-44f7-a6f9-8eff0c210463
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: sqldb-performance
ms.workload: data-management
ms.date: 11/08/2016
ms.author: bonova
ms.openlocfilehash: ab741e49685bf6df3bceab219aaf57ea51cdb25d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="operating-hello-query-store-in-azure-sql-database"></a><span data-ttu-id="59328-103">Hello operativa archivio Query nel Database SQL di Azure</span><span class="sxs-lookup"><span data-stu-id="59328-103">Operating hello Query Store in Azure SQL Database</span></span>
<span data-ttu-id="59328-104">L'archivio query di Azure è una funzionalità di database completamente gestita che raccoglie e presenta informazioni cronologiche dettagliate su tutte le query in modo continuo.</span><span class="sxs-lookup"><span data-stu-id="59328-104">Query Store in Azure is a fully managed database feature that continuously collects and presents detailed historic information about all queries.</span></span> <span data-ttu-id="59328-105">Può essere considerato sull'archivio Query come utilità di traccia eventi del simili tooan aereo in modo significativo semplifica la risoluzione dei problemi di entrambi per il cloud le prestazioni delle query e i clienti in locale.</span><span class="sxs-lookup"><span data-stu-id="59328-105">You can think about Query Store as similar tooan airplane's flight data recorder that significantly simplifies query performance troubleshooting both for cloud and on-premises customers.</span></span> <span data-ttu-id="59328-106">Questo articolo spiega alcuni aspetti specifici dell'uso dell'archivio query in Azure.</span><span class="sxs-lookup"><span data-stu-id="59328-106">This article explains specific aspects of operating Query Store in Azure.</span></span> <span data-ttu-id="59328-107">Usando questi dati di query pre-raccolti, è possibile diagnosticare e risolvere velocemente i problemi di prestazioni e dedicare così più tempo alla propria attività.</span><span class="sxs-lookup"><span data-stu-id="59328-107">Using this pre-collected query data, you can quickly diagnose and resolve performance problems and thus spend more time focusing on their business.</span></span> 

<span data-ttu-id="59328-108">Archivio query è [disponibile a livello globale](https://azure.microsoft.com/updates/general-availability-azure-sql-database-query-store/) nel database SQL di Azure da novembre 2015.</span><span class="sxs-lookup"><span data-stu-id="59328-108">Query Store has been [globally available](https://azure.microsoft.com/updates/general-availability-azure-sql-database-query-store/) in Azure SQL Database since November, 2015.</span></span> <span data-ttu-id="59328-109">Archivio query è di base di hello per le analisi delle prestazioni e ottimizzazione delle funzionalità, ad esempio [guidata Database SQL e Dashboard prestazioni](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span><span class="sxs-lookup"><span data-stu-id="59328-109">Query Store is hello foundation for performance analysis and tuning features, such as [SQL Database Advisor and Performance Dashboard](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span></span> <span data-ttu-id="59328-110">In un momento hello della pubblicazione di questo articolo, archivio Query è in esecuzione in più di 200.000 database utente in Azure, la raccolta di informazioni relative alla query da diversi mesi, senza interruzioni.</span><span class="sxs-lookup"><span data-stu-id="59328-110">At hello moment of publishing this article, Query Store is running in more than 200,000 user databases in Azure, collecting query-related information for several months, without interruption.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="59328-111">Microsoft è in corso di hello di attivazione di archivio Query per tutti i database SQL di Azure (nuovi ed esistenti).</span><span class="sxs-lookup"><span data-stu-id="59328-111">Microsoft is in hello process of activating Query Store for all Azure SQL databases (existing and new).</span></span> 
> 
> 

## <a name="optimal-query-store-configuration"></a><span data-ttu-id="59328-112">Configurazione ottimale dell'archivio query</span><span class="sxs-lookup"><span data-stu-id="59328-112">Optimal Query Store Configuration</span></span>
<span data-ttu-id="59328-113">Questa sezione vengono descritti i valori predefiniti di configurazione ottimale di tooensure progettato corretto funzionamento dell'archivio Query hello e delle funzionalità dipendenti, ad esempio [guidata Database SQL e Dashboard prestazioni](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span><span class="sxs-lookup"><span data-stu-id="59328-113">This section describes optimal configuration defaults that are designed tooensure reliable operation of hello Query Store and dependent features, such as [SQL Database Advisor and Performance Dashboard](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span></span> <span data-ttu-id="59328-114">La configurazione predefinita è ottimizzata per la raccolta di dati continua, ossia per un tempo minimo di OFF/READ_ONLY.</span><span class="sxs-lookup"><span data-stu-id="59328-114">Default configuration is optimized for continuous data collection, that is minimal time spent in OFF/READ_ONLY states.</span></span>

| <span data-ttu-id="59328-115">Configurazione</span><span class="sxs-lookup"><span data-stu-id="59328-115">Configuration</span></span> | <span data-ttu-id="59328-116">Descrizione</span><span class="sxs-lookup"><span data-stu-id="59328-116">Description</span></span> | <span data-ttu-id="59328-117">Default</span><span class="sxs-lookup"><span data-stu-id="59328-117">Default</span></span> | <span data-ttu-id="59328-118">Commento</span><span class="sxs-lookup"><span data-stu-id="59328-118">Comment</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="59328-119">MAX_STORAGE_SIZE_MB</span><span class="sxs-lookup"><span data-stu-id="59328-119">MAX_STORAGE_SIZE_MB</span></span> |<span data-ttu-id="59328-120">Specifica il limite di hello per spazio dati hello che archivio Query può occupare all'interno del database customer z</span><span class="sxs-lookup"><span data-stu-id="59328-120">Specifies hello limit for hello data space that Query Store can take inside z customer database</span></span> |<span data-ttu-id="59328-121">100</span><span class="sxs-lookup"><span data-stu-id="59328-121">100</span></span> |<span data-ttu-id="59328-122">Applicato per i nuovi database</span><span class="sxs-lookup"><span data-stu-id="59328-122">Enforced for new databases</span></span> |
| <span data-ttu-id="59328-123">INTERVAL_LENGTH_MINUTES</span><span class="sxs-lookup"><span data-stu-id="59328-123">INTERVAL_LENGTH_MINUTES</span></span> |<span data-ttu-id="59328-124">Definisce la dimensione dell'intervallo di tempo durante il quale le statistiche di runtime raccolte per i piani di query vengono aggregate e rese persistenti.</span><span class="sxs-lookup"><span data-stu-id="59328-124">Defines size of time window during which collected runtime statistics for query plans are aggregated and persisted.</span></span> <span data-ttu-id="59328-125">Tutti i piani di query attivi hanno al massimo una riga per un periodo di tempo definito con questa configurazione</span><span class="sxs-lookup"><span data-stu-id="59328-125">Every active query plan has at most one row for a period of time defined with this configuration</span></span> |<span data-ttu-id="59328-126">60</span><span class="sxs-lookup"><span data-stu-id="59328-126">60</span></span> |<span data-ttu-id="59328-127">Applicato per i nuovi database</span><span class="sxs-lookup"><span data-stu-id="59328-127">Enforced for new databases</span></span> |
| <span data-ttu-id="59328-128">STALE_QUERY_THRESHOLD_DAYS</span><span class="sxs-lookup"><span data-stu-id="59328-128">STALE_QUERY_THRESHOLD_DAYS</span></span> |<span data-ttu-id="59328-129">Criteri di pulizia basati sul tempo che controllano il periodo di conservazione hello di statistiche di runtime persistenti e query inattive</span><span class="sxs-lookup"><span data-stu-id="59328-129">Time-based cleanup policy that controls hello retention period of persisted runtime statistics and inactive queries</span></span> |<span data-ttu-id="59328-130">30</span><span class="sxs-lookup"><span data-stu-id="59328-130">30</span></span> |<span data-ttu-id="59328-131">Applicato per i nuovi database e i database con un'impostazione predefinita precedente (367)</span><span class="sxs-lookup"><span data-stu-id="59328-131">Enforced for new databases and databases with previous default (367)</span></span> |
| <span data-ttu-id="59328-132">SIZE_BASED_CLEANUP_MODE</span><span class="sxs-lookup"><span data-stu-id="59328-132">SIZE_BASED_CLEANUP_MODE</span></span> |<span data-ttu-id="59328-133">Specifica se la pulizia automatica dei dati ha luogo quando dimensioni di dati di archivio Query si avvicinano hello limite</span><span class="sxs-lookup"><span data-stu-id="59328-133">Specifies whether automatic data cleanup takes place when Query Store data size approaches hello limit</span></span> |<span data-ttu-id="59328-134">AUTO</span><span class="sxs-lookup"><span data-stu-id="59328-134">AUTO</span></span> |<span data-ttu-id="59328-135">Applicato per tutti i database</span><span class="sxs-lookup"><span data-stu-id="59328-135">Enforced for all databases</span></span> |
| <span data-ttu-id="59328-136">QUERY_CAPTURE_MODE</span><span class="sxs-lookup"><span data-stu-id="59328-136">QUERY_CAPTURE_MODE</span></span> |<span data-ttu-id="59328-137">Specifica se vengono monitorate tutte le query o solo un sottoinsieme di esse</span><span class="sxs-lookup"><span data-stu-id="59328-137">Specifies whether all queries or only a subset of queries are tracked</span></span> |<span data-ttu-id="59328-138">AUTO</span><span class="sxs-lookup"><span data-stu-id="59328-138">AUTO</span></span> |<span data-ttu-id="59328-139">Applicato per tutti i database</span><span class="sxs-lookup"><span data-stu-id="59328-139">Enforced for all databases</span></span> |
| <span data-ttu-id="59328-140">FLUSH_INTERVAL_SECONDS</span><span class="sxs-lookup"><span data-stu-id="59328-140">FLUSH_INTERVAL_SECONDS</span></span> |<span data-ttu-id="59328-141">Specifica il periodo massimo durante il quale le statistiche di runtime acquisiti vengono mantenute nella memoria, prima di scaricare toodisk</span><span class="sxs-lookup"><span data-stu-id="59328-141">Specifies maximum period during which captured runtime statistics are kept in memory, before flushing toodisk</span></span> |<span data-ttu-id="59328-142">900</span><span class="sxs-lookup"><span data-stu-id="59328-142">900</span></span> |<span data-ttu-id="59328-143">Applicato per i nuovi database</span><span class="sxs-lookup"><span data-stu-id="59328-143">Enforced for new databases</span></span> |
|  | | | |

> [!IMPORTANT]
> <span data-ttu-id="59328-144">Queste impostazioni predefinite vengono applicate automaticamente nella fase finale di hello dell'attivazione di archivio Query in tutti i database SQL di Azure (vedere la nota Importante precedente).</span><span class="sxs-lookup"><span data-stu-id="59328-144">These defaults are automatically applied in hello final stage of Query Store activation in all Azure SQL databases (see preceding important note).</span></span> <span data-ttu-id="59328-145">Dopo la luce backup, Database SQL di Azure non modifica i valori di configurazione impostati dai clienti, a meno che non sono influire negativamente sulle operazioni affidabile di hello archivio Query o di carico di lavoro principale.</span><span class="sxs-lookup"><span data-stu-id="59328-145">After this light up, Azure SQL Database won’t be changing configuration values set by customers, unless they negatively impact primary workload or reliable operations of hello Query Store.</span></span>
> 
> 

<span data-ttu-id="59328-146">Se si desidera toostay con le impostazioni personalizzate, utilizzare [ALTER DATABASE con le opzioni di archivio Query](https://msdn.microsoft.com/library/bb522682.aspx) lo stato precedente di toorevert configurazione toohello.</span><span class="sxs-lookup"><span data-stu-id="59328-146">If you want toostay with your custom settings, use [ALTER DATABASE with Query Store options](https://msdn.microsoft.com/library/bb522682.aspx) toorevert configuration toohello previous state.</span></span> <span data-ttu-id="59328-147">Estrarre [Best Practices with hello archivio Query](https://msdn.microsoft.com/library/mt604821.aspx) nell'ordine toolearn superiore come scegliere i parametri di configurazione ottimale.</span><span class="sxs-lookup"><span data-stu-id="59328-147">Check out [Best Practices with hello Query Store](https://msdn.microsoft.com/library/mt604821.aspx) in order toolearn how top chose optimal configuration parameters.</span></span>

## <a name="next-steps"></a><span data-ttu-id="59328-148">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="59328-148">Next steps</span></span>
[<span data-ttu-id="59328-149">Informazioni dettagliate sulle prestazioni del database SQL</span><span class="sxs-lookup"><span data-stu-id="59328-149">SQL Database Performance Insight</span></span>](sql-database-performance.md)

## <a name="additional-resources"></a><span data-ttu-id="59328-150">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="59328-150">Additional resources</span></span>
<span data-ttu-id="59328-151">Per ulteriori informazioni, vedere hello seguenti articoli:</span><span class="sxs-lookup"><span data-stu-id="59328-151">For more information check out hello following articles:</span></span>

* [<span data-ttu-id="59328-152">Un registratore dei dati di volo per il database</span><span class="sxs-lookup"><span data-stu-id="59328-152">A flight data recorder for your database</span></span>](https://azure.microsoft.com/blog/query-store-a-flight-data-recorder-for-your-database) 
* [<span data-ttu-id="59328-153">Monitoraggio delle prestazioni tramite archivio Query hello</span><span class="sxs-lookup"><span data-stu-id="59328-153">Monitoring Performance By Using hello Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx)
* [<span data-ttu-id="59328-154">Scenari di utilizzo dell'archivio query</span><span class="sxs-lookup"><span data-stu-id="59328-154">Query Store Usage Scenarios</span></span>](https://msdn.microsoft.com/library/mt614796.aspx)
* [<span data-ttu-id="59328-155">Monitoraggio delle prestazioni tramite archivio Query hello</span><span class="sxs-lookup"><span data-stu-id="59328-155">Monitoring Performance By Using hello Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx) 

