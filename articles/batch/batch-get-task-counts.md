---
title: "Monitorare lo stato di un processo conteggiando le attività in base allo stato - Azure Batch | Microsoft Docs"
description: "Monitorare lo stato di un processo chiamando l'operazione di recupero del conteggio delle attività per conteggiare le attività per ogni processo. È possibile ottenere un conteggio delle attività attive, in esecuzione e completate e delle attività riuscite o non riuscite."
services: batch
author: tamram
manager: timlt
ms.service: batch
ms.topic: article
ms.date: 08/02/2017
ms.author: tamram
ms.openlocfilehash: ceff59d7063b60a1344a47489d3d73e0e8ee07df
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/18/2017
---
# <a name="count-tasks-by-state-to-monitor-a-jobs-progress-preview"></a><span data-ttu-id="6adb2-104">Conteggiare le attività in base allo stato per monitorare lo stato di un processo (anteprima)</span><span class="sxs-lookup"><span data-stu-id="6adb2-104">Count tasks by state to monitor a job's progress (Preview)</span></span>

<span data-ttu-id="6adb2-105">Azure Batch offre un pratico metodo per monitorare lo stato di un processo mentre questo esegue le proprie attività.</span><span class="sxs-lookup"><span data-stu-id="6adb2-105">Azure Batch provides an efficient way to monitor the progress of a job as it runs its tasks.</span></span> <span data-ttu-id="6adb2-106">È possibile chiamare l'operazione di [recupero dei conteggi delle attività][rest_get_task_counts] per determinare quante attività hanno stato attivo, in esecuzione o completato e quante sono riuscite o non riuscite.</span><span class="sxs-lookup"><span data-stu-id="6adb2-106">You can call the [Get Task Counts][rest_get_task_counts] operation to find out how many tasks are in an active, running, or completed state, and how many have succeeded or failed.</span></span> <span data-ttu-id="6adb2-107">Conteggiando il numero di attività in ogni stato, è possibile visualizzare più facilmente lo stato del processo a un utente o rilevare ritardi o errori imprevisti che possono avere impatto sul processo.</span><span class="sxs-lookup"><span data-stu-id="6adb2-107">By counting the number of tasks in each state, you can more easily display the job's progress to a user, or detect unexpected delays or failures that may affect the job.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6adb2-108">L'operazione di recupero dei conteggi delle attività è attualmente in versione di anteprima e non è ancora disponibile in Azure per enti pubblici, Azure Cina e Azure Germania.</span><span class="sxs-lookup"><span data-stu-id="6adb2-108">The Get Task Counts operation is currently in preview, and is not yet available in Azure Government, Azure China, and Azure Germany.</span></span> 
>
>

## <a name="how-tasks-are-counted"></a><span data-ttu-id="6adb2-109">Come vengono conteggiate le attività</span><span class="sxs-lookup"><span data-stu-id="6adb2-109">How tasks are counted</span></span>

<span data-ttu-id="6adb2-110">L'operazione di recupero dei conteggi delle attività conta le attività in base allo stato, nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="6adb2-110">The Get Task Counts operation counts tasks by state, as follows:</span></span>

- <span data-ttu-id="6adb2-111">Un'attività viene conteggiata come **attiva** quando è accodata e può essere eseguita, ma non è attualmente assegnata a un nodo di calcolo.</span><span class="sxs-lookup"><span data-stu-id="6adb2-111">A task is counted as **active** when it is queued and able to run, but is not currently assigned to a compute node.</span></span> <span data-ttu-id="6adb2-112">Un'attività viene conteggiata come **attiva** anche se dipende da un'attività padre non ancora completata.</span><span class="sxs-lookup"><span data-stu-id="6adb2-112">A task is also counted as **active** if it is dependent on a parent task that has not yet completed.</span></span> <span data-ttu-id="6adb2-113">Per altre informazioni sulle dipendenze delle attività, vedere [Creare relazioni tra attività per eseguire attività che dipendono da altre attività](batch-task-dependencies.md).</span><span class="sxs-lookup"><span data-stu-id="6adb2-113">For more information on task dependencies, see [Create task dependencies to run tasks that depend on other tasks](batch-task-dependencies.md).</span></span> 
- <span data-ttu-id="6adb2-114">Un'attività viene conteggiata come **in esecuzione** quando è stata assegnata a un nodo di calcolo, ma non è ancora completata.</span><span class="sxs-lookup"><span data-stu-id="6adb2-114">A task is counted as **running** when it has been assigned to a compute node, but has not yet completed.</span></span> <span data-ttu-id="6adb2-115">Un'attività viene conteggiata come **in esecuzione** quando il suo stato è `preparing` o `running`, come indicato dall'operazione di [recupero delle informazioni su un'attività][rest_get_task].</span><span class="sxs-lookup"><span data-stu-id="6adb2-115">A task is counted as **running** when its state is either `preparing` or `running`, as indicated by the [Get information about a task][rest_get_task] operation.</span></span>
- <span data-ttu-id="6adb2-116">Un'attività viene conteggiata come **completata** quando non è più idonea per l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="6adb2-116">A task is counted as **completed** when it is no longer eligible to run.</span></span> <span data-ttu-id="6adb2-117">Un'attività conteggiata come **completata** è stata in genere completata correttamente o non è riuscita e ha anche superato il limite di nuovi tentativi.</span><span class="sxs-lookup"><span data-stu-id="6adb2-117">A task counted as **completed** has typically either finished successfully, or has finished unsuccessfully and has also exhausted its retry limit.</span></span> 

<span data-ttu-id="6adb2-118">L'operazione di recupero dei conteggi delle attività indica anche quante attività sono riuscite o non sono riuscite.</span><span class="sxs-lookup"><span data-stu-id="6adb2-118">The Get Task Counts operation also reports how many tasks have succeeded or failed.</span></span> <span data-ttu-id="6adb2-119">Batch determina se un'attività è riuscita o meno controllando la proprietà **result** della proprietà [executionInfo][https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-task#executionInfo]:</span><span class="sxs-lookup"><span data-stu-id="6adb2-119">Batch determines whether a task has succeeded or failed by checking the **result** property of the [executionInfo][https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-task#executionInfo] property:</span></span>

    - <span data-ttu-id="6adb2-120">Un'attività viene conteggiata come **riuscita** se il risultato dell'esecuzione dell'attività è `success`.</span><span class="sxs-lookup"><span data-stu-id="6adb2-120">A task is counted as **succeeded** if the result of task execution is `success`.</span></span>
    - <span data-ttu-id="6adb2-121">Un'attività viene conteggiata come **non riuscita** se il risultato dell'esecuzione dell'attività è `failure`.</span><span class="sxs-lookup"><span data-stu-id="6adb2-121">A task is counted as **failed** if the result of task execution is `failure`.</span></span>

<span data-ttu-id="6adb2-122">Per altre informazioni sugli stati delle attività, vedere [Get information about a task][rest_get_task] (Ottenere informazioni su un'attività).</span><span class="sxs-lookup"><span data-stu-id="6adb2-122">For more information about task states, see [Get information about a task][rest_get_task].</span></span>

<span data-ttu-id="6adb2-123">L'esempio di codice .NET seguente mostra come recuperare i conteggi delle attività in base allo stato:</span><span class="sxs-lookup"><span data-stu-id="6adb2-123">The following .NET code sample shows how to retrieve task counts by state:</span></span> 

```csharp
var taskCounts = await batchClient.JobOperations.GetTaskCountsAsync("job-1");

Console.WriteLine("Task count in active state: {0}", taskCounts.Active);
Console.WriteLine("Task count in preparing or running state: {0}", taskCounts.Running);
Console.WriteLine("Task count in completed state: {0}", taskCounts.Completed);
Console.WriteLine("Succeeded task count: {0}", taskCounts.Succeeded);
Console.WriteLine("Failed task count: {0}", taskCounts.Failed);
Console.WriteLine("ValidationStatus: {0}", taskCounts.ValidationStatus);
```

> [!NOTE]
> <span data-ttu-id="6adb2-124">Per ottenere i conteggi delle attività per un processo, è possibile usare un criterio simile per REST e per altri linguaggi supportati.</span><span class="sxs-lookup"><span data-stu-id="6adb2-124">You can use a similar pattern for REST and other supported languages to get task counts for a job.</span></span> 
> 
> 

## <a name="consistency-checking-for-task-counts"></a><span data-ttu-id="6adb2-125">Verifica della coerenza per i conteggi delle attività</span><span class="sxs-lookup"><span data-stu-id="6adb2-125">Consistency checking for task counts</span></span>

<span data-ttu-id="6adb2-126">Il servizio Batch aggrega i conteggi delle attività raccogliendo dati da più parti di un sistema distribuito asincrono.</span><span class="sxs-lookup"><span data-stu-id="6adb2-126">The Batch service aggregates task counts by gathering data from multiple parts of an asynchronous distributed system.</span></span> <span data-ttu-id="6adb2-127">Per garantire che i conteggi delle attività siano corretti, Batch offre un'ulteriore convalida per i conteggi in base allo stato tramite verifiche di coerenza su più componenti del sistema.</span><span class="sxs-lookup"><span data-stu-id="6adb2-127">To ensure that task counts are correct, Batch provides additional validation for state counts by performing consistency checks against multiple components of the system.</span></span> <span data-ttu-id="6adb2-128">Batch esegue queste verifiche di coerenza se il processo include meno di 200.000 attività.</span><span class="sxs-lookup"><span data-stu-id="6adb2-128">Batch performs these consistency checks as long as there are fewer than 200,000 tasks in the job.</span></span> <span data-ttu-id="6adb2-129">Nell'improbabile caso che la verifica di coerenza trovi errori, Batch corregge il risultato dell'operazione di recupero dei conteggi delle attività in base ai risultati della verifica di coerenza.</span><span class="sxs-lookup"><span data-stu-id="6adb2-129">In the unlikely event that the consistency check finds errors, Batch corrects the result of the Get Tasks Counts operation based on the results of the consistency check.</span></span> <span data-ttu-id="6adb2-130">La verifica di coerenza è una misura aggiuntiva per garantire che i clienti che usano l'operazione di recupero dei conteggi delle attività ricevano le informazioni corrette necessarie per la propria soluzione.</span><span class="sxs-lookup"><span data-stu-id="6adb2-130">The consistency check is an extra measure to ensure that customers who rely on the Get Task Counts operation get the right information they need for their solution.</span></span>

<span data-ttu-id="6adb2-131">La proprietà **validationStatus** nella risposta indica se Batch ha eseguito la verifica di coerenza.</span><span class="sxs-lookup"><span data-stu-id="6adb2-131">The **validationStatus** property in the response indicates whether Batch has performed the consistency check.</span></span> <span data-ttu-id="6adb2-132">Se Batch non è stato in grado di verificare i conteggi in base allo stato rispetto agli stati effettivi contenuti nel sistema, la proprietà **validationStatus** è impostata su `unvalidated`.</span><span class="sxs-lookup"><span data-stu-id="6adb2-132">If Batch has not been able to check state counts against the actual states held in the system, then the **validationStatus** property is set to `unvalidated`.</span></span> <span data-ttu-id="6adb2-133">Poiché per motivi di prestazioni Batch non esegue la verifica di coerenza se il processo include più di 200.000 attività, la proprietà **validationStatus** potrebbe essere impostata su `unvalidated` in questo caso.</span><span class="sxs-lookup"><span data-stu-id="6adb2-133">For performance reasons, Batch will not perform the consistency check if the job includes more than 200,000 tasks, so the **validationStatus** property may be set to `unvalidated` in this case.</span></span> <span data-ttu-id="6adb2-134">Tuttavia, il conteggio delle attività non è necessariamente errato in questo caso, perché anche una perdita di dati molto limitata è altamente improbabile.</span><span class="sxs-lookup"><span data-stu-id="6adb2-134">However, the task count is not necessarily wrong in this case, as even a very limited data loss is highly unlikely.</span></span> 

<span data-ttu-id="6adb2-135">Quando un'attività cambia stato, la pipeline di aggregazione elabora la modifica in pochi secondi.</span><span class="sxs-lookup"><span data-stu-id="6adb2-135">When a task changes state, the aggregation pipeline processes the change within few seconds.</span></span> <span data-ttu-id="6adb2-136">L'operazione di recupero dei conteggi delle attività riflette i conteggi delle attività aggiornati in questo periodo di tempo.</span><span class="sxs-lookup"><span data-stu-id="6adb2-136">The Get Task Counts operation reflects the updated task counts within that period.</span></span> <span data-ttu-id="6adb2-137">Tuttavia, se la pipeline di aggregazione non rileva una modifica nello stato di un'attività, la modifica non viene registrata fino al successivo passaggio di convalida.</span><span class="sxs-lookup"><span data-stu-id="6adb2-137">However, if the aggregation pipeline misses a change in a task state, then that change is not registered until the next validation pass.</span></span> <span data-ttu-id="6adb2-138">Durante questo periodo di tempo i conteggi delle attività possono essere leggermente imprecisi a causa dell'evento ignorato, ma verranno corretti nel successivo passaggio di convalida.</span><span class="sxs-lookup"><span data-stu-id="6adb2-138">During this time, task counts may be slightly inaccurate due to the missed event, but they are corrected on the next validation pass.</span></span>

## <a name="best-practices-for-counting-a-jobs-tasks"></a><span data-ttu-id="6adb2-139">Procedure consigliate per il conteggio della attività di un processo</span><span class="sxs-lookup"><span data-stu-id="6adb2-139">Best practices for counting a job's tasks</span></span>

<span data-ttu-id="6adb2-140">La chiamata dell'operazione di recupero dei conteggi delle attività è il modo più efficiente per restituire un conteggio di base delle attività di un processo in base allo stato.</span><span class="sxs-lookup"><span data-stu-id="6adb2-140">Calling the Get Task Counts operation is the most efficient way to return a basic count of a job's tasks by state.</span></span> <span data-ttu-id="6adb2-141">Se si usa il servizio Batch versione 2017-06-01.5.1, è consigliabile scrivere o aggiornare il codice in modo da usare l'operazione di recupero dei conteggi delle attività.</span><span class="sxs-lookup"><span data-stu-id="6adb2-141">If you are using Batch service version 2017-06-01.5.1, we recommend writing or updating your code to use Get Task Counts.</span></span>

<span data-ttu-id="6adb2-142">Questa operazione non è disponibile nelle versioni del servizio Batch precedenti alla 2017-06-01.5.1.</span><span class="sxs-lookup"><span data-stu-id="6adb2-142">The Get Task Counts operation is not available in Batch service versions earlier than 2017-06-01.5.1.</span></span> <span data-ttu-id="6adb2-143">Se si usa una versione meno recente del servizio, usare una query di tipo elenco per conteggiare le attività in un processo.</span><span class="sxs-lookup"><span data-stu-id="6adb2-143">If you are using an older version of the service, then use a list query to count tasks in a job instead.</span></span> <span data-ttu-id="6adb2-144">Per altre informazioni, vedere [Creare query per elencare le risorse di Batch in modo efficiente](batch-efficient-list-queries.md).</span><span class="sxs-lookup"><span data-stu-id="6adb2-144">For more information, see [Create queries to list Batch resources efficiently](batch-efficient-list-queries.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="6adb2-145">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="6adb2-145">Next steps</span></span>

* <span data-ttu-id="6adb2-146">Per altre informazioni sui concetti e sulle funzionalità del servizio Batch, vedere [Panoramica delle funzionalità di Batch](batch-api-basics.md).</span><span class="sxs-lookup"><span data-stu-id="6adb2-146">See the [Batch feature overview](batch-api-basics.md) to learn more about Batch service concepts and features.</span></span> <span data-ttu-id="6adb2-147">L'articolo descrive le risorse principali di Batch, tra cui pool, nodi di calcolo, processi e attività, e include una panoramica delle funzionalità del servizio.</span><span class="sxs-lookup"><span data-stu-id="6adb2-147">The article discusses the primary Batch resources such as pools, compute nodes, jobs, and tasks, and provides an overview of the service's features.</span></span>
* <span data-ttu-id="6adb2-148">Apprendere le nozioni di base dello sviluppo di un'applicazione abilitata per Batch con la [libreria client Batch .NET](batch-dotnet-get-started.md) o con [Python](batch-python-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="6adb2-148">Learn the basics of developing a Batch-enabled application using the [Batch .NET client library](batch-dotnet-get-started.md) or [Python](batch-python-tutorial.md).</span></span> <span data-ttu-id="6adb2-149">Gli articoli introduttivi mostrano un'applicazione funzionante che usa il servizio Batch per eseguire un carico di lavoro in più nodi di calcolo.</span><span class="sxs-lookup"><span data-stu-id="6adb2-149">These introductory articles guide you through a working application that uses the Batch service to execute a workload on multiple compute nodes.</span></span>


[rest_get_task_counts]: https://docs.microsoft.com/rest/api/batchservice/get-the-task-counts-for-a-job
[rest_get_task]: https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-task
[rest_list_tasks]: https://docs.microsoft.com/rest/api/batchservice/list-the-tasks-associated-with-a-job
