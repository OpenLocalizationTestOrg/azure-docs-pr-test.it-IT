---
title: prestazioni del database nel Database di SQL Azure aaaMonitoring | Documenti Microsoft
description: Informazioni sulle opzioni di hello per il monitoraggio del database con gli strumenti di Azure e viste a gestione dinamica.
keywords: monitoraggio database, prestazioni database cloud
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: a2e47475-c955-4a8d-a65c-cbef9a6d9b9f
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: b13771183d4ccf37f58e2fc518b9b14de38212dc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="monitoring-database-performance-in-azure-sql-database"></a><span data-ttu-id="80eb8-104">Monitoraggio delle prestazioni del database nel database SQL di Azure</span><span class="sxs-lookup"><span data-stu-id="80eb8-104">Monitoring database performance in Azure SQL Database</span></span>
<span data-ttu-id="80eb8-105">Monitoraggio delle prestazioni di hello di un database SQL di Azure inizia con hello risorse utilizzo toohello relativo livello di prestazioni del database che si sceglie di monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="80eb8-105">Monitoring hello performance of a SQL database in Azure starts with monitoring hello resource utilization relative toohello level of database performance you choose.</span></span> <span data-ttu-id="80eb8-106">Il monitoraggio consente di determinare se il database dispone di capacità in eccesso o non riesce perché le risorse sono raggiunge il limite massimo e quindi decidere se è a livello di prestazioni di tempo tooadjust hello e [livello di servizio](sql-database-service-tiers.md) del database.</span><span class="sxs-lookup"><span data-stu-id="80eb8-106">Monitoring helps you  determine whether your database has excess capacity or is having trouble because resources are maxed out, and then decide whether it's time tooadjust hello performance level and [service tier](sql-database-service-tiers.md) of your database.</span></span> <span data-ttu-id="80eb8-107">È possibile monitorare il database utilizzando gli strumenti di grafici in hello [portale di Azure](https://portal.azure.com) o mediante SQL [viste a gestione dinamica](https://msdn.microsoft.com/library/ms188754.aspx).</span><span class="sxs-lookup"><span data-stu-id="80eb8-107">You can monitor your database using graphical tools in hello [Azure portal](https://portal.azure.com) or using SQL [dynamic management views](https://msdn.microsoft.com/library/ms188754.aspx).</span></span>

## <a name="monitor-databases-using-hello-azure-portal"></a><span data-ttu-id="80eb8-108">Monitorare i database che utilizzano hello portale di Azure</span><span class="sxs-lookup"><span data-stu-id="80eb8-108">Monitor databases using hello Azure portal</span></span>
<span data-ttu-id="80eb8-109">In hello [portale di Azure](https://portal.azure.com/), è possibile monitorare l'utilizzo di un singolo database selezionandolo e facendo clic su hello **monitoraggio** grafico.</span><span class="sxs-lookup"><span data-stu-id="80eb8-109">In hello [Azure portal](https://portal.azure.com/), you can monitor a single database’s utilization by selecting your database and clicking hello **Monitoring** chart.</span></span> <span data-ttu-id="80eb8-110">Verrà visualizzata una **metrica** finestra che è possibile modificare, fare clic su hello **Modifica grafico** pulsante.</span><span class="sxs-lookup"><span data-stu-id="80eb8-110">This brings up a **Metric** window that you can change by clicking hello **Edit chart** button.</span></span> <span data-ttu-id="80eb8-111">Aggiungere hello seguenti metriche:</span><span class="sxs-lookup"><span data-stu-id="80eb8-111">Add hello following metrics:</span></span>

* <span data-ttu-id="80eb8-112">Percentuale CPU</span><span class="sxs-lookup"><span data-stu-id="80eb8-112">CPU percentage</span></span>
* <span data-ttu-id="80eb8-113">Percentuale di DTU</span><span class="sxs-lookup"><span data-stu-id="80eb8-113">DTU percentage</span></span>
* <span data-ttu-id="80eb8-114">Percentuale di I/O di dati</span><span class="sxs-lookup"><span data-stu-id="80eb8-114">Data IO percentage</span></span>
* <span data-ttu-id="80eb8-115">Percentuale di dimensioni del database</span><span class="sxs-lookup"><span data-stu-id="80eb8-115">Database size percentage</span></span>

<span data-ttu-id="80eb8-116">Dopo aver aggiunto queste metriche, è possibile continuare tooview nel hello **monitoraggio** grafico con ulteriori informazioni su hello **metrica** finestra.</span><span class="sxs-lookup"><span data-stu-id="80eb8-116">Once you’ve added these metrics, you can continue tooview them in hello **Monitoring** chart with more details on hello **Metric** window.</span></span> <span data-ttu-id="80eb8-117">Tutte e quattro le metriche mostrano toohello relativa percentuale di utilizzo medio hello **DTU** del database.</span><span class="sxs-lookup"><span data-stu-id="80eb8-117">All four metrics show hello average utilization percentage relative toohello **DTU** of your database.</span></span> <span data-ttu-id="80eb8-118">Vedere hello [livelli di servizio](sql-database-service-tiers.md) articolo per informazioni dettagliate su Dtu.</span><span class="sxs-lookup"><span data-stu-id="80eb8-118">See hello [service tiers](sql-database-service-tiers.md) article for details about DTUs.</span></span>

![Monitoraggio del livello di servizio delle prestazioni del database.](./media/sql-database-service-tiers/sqldb_service_tier_monitoring.png)

<span data-ttu-id="80eb8-120">È anche possibile configurare avvisi sulle metriche delle prestazioni hello.</span><span class="sxs-lookup"><span data-stu-id="80eb8-120">You can also configure alerts on hello performance metrics.</span></span> <span data-ttu-id="80eb8-121">Fare clic su hello **Aggiungi avviso** pulsante hello **metrica** finestra.</span><span class="sxs-lookup"><span data-stu-id="80eb8-121">Click hello **Add alert** button in hello **Metric** window.</span></span> <span data-ttu-id="80eb8-122">Seguire hello guidata tooconfigure l'avviso.</span><span class="sxs-lookup"><span data-stu-id="80eb8-122">Follow hello wizard tooconfigure your alert.</span></span> <span data-ttu-id="80eb8-123">È possibile hello opzione tooalert se le metriche hello superano una determinata soglia o hello scende di sotto di una determinata soglia.</span><span class="sxs-lookup"><span data-stu-id="80eb8-123">You have hello option tooalert if hello metrics exceed a certain threshold or if hello metric falls below a certain threshold.</span></span>

<span data-ttu-id="80eb8-124">Ad esempio, se si prevede che il carico di lavoro hello in toogrow del database, è possibile scegliere tooconfigure di avvisi di posta elettronica ogni volta che il database raggiunge l'80% per una qualsiasi delle metriche delle prestazioni hello.</span><span class="sxs-lookup"><span data-stu-id="80eb8-124">For example, if you expect hello workload on your database toogrow, you can choose tooconfigure an email alert whenever your database reaches 80% on any of hello performance metrics.</span></span> <span data-ttu-id="80eb8-125">È possibile utilizzare questo come un toofigure avviso anticipato out quando potrebbe essere tooswitch toohello livello di prestazioni superiore.</span><span class="sxs-lookup"><span data-stu-id="80eb8-125">You can use this as an early warning toofigure out when you might have tooswitch toohello next higher performance level.</span></span>

<span data-ttu-id="80eb8-126">le metriche delle prestazioni di Hello consentono inoltre di stabilire se è in grado di toodowngrade tooa livello di prestazioni inferiore.</span><span class="sxs-lookup"><span data-stu-id="80eb8-126">hello performance metrics can also help you determine if you are able toodowngrade tooa lower performance level.</span></span> <span data-ttu-id="80eb8-127">Si supponga che si utilizza un database Standard S2 e mostrano le metriche delle prestazioni tutti che hello medio database non utilizza più di 10% in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="80eb8-127">Assume you are using a Standard S2 database and all performance metrics show that hello database on average does not use more than 10% at any given time.</span></span> <span data-ttu-id="80eb8-128">È probabile che il database hello funzioni correttamente in S1 Standard.</span><span class="sxs-lookup"><span data-stu-id="80eb8-128">It is likely that hello database will work well in Standard S1.</span></span> <span data-ttu-id="80eb8-129">Tuttavia, essere consapevoli dei carichi di lavoro o in cui picchi fluttuare prima di apportare hello decisione toomove tooa livello di prestazioni inferiore.</span><span class="sxs-lookup"><span data-stu-id="80eb8-129">However, be aware of workloads that spike or fluctuate before making hello decision toomove tooa lower performance level.</span></span>

## <a name="monitor-databases-using-dmvs"></a><span data-ttu-id="80eb8-130">Monitorare i database con le viste a gestione dinamica</span><span class="sxs-lookup"><span data-stu-id="80eb8-130">Monitor databases using DMVs</span></span>
<span data-ttu-id="80eb8-131">Hello stesse metriche esposte nel portale di hello sono disponibili anche tramite viste di sistema: [resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) in hello logico **master** database del server, e [sys.dm_db_ statistiche sulle risorse](https://msdn.microsoft.com/library/dn800981.aspx) nel database utente hello.</span><span class="sxs-lookup"><span data-stu-id="80eb8-131">hello same metrics that are exposed in hello portal are also available through system views: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) in hello logical **master** database of your server, and [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) in hello user database.</span></span> <span data-ttu-id="80eb8-132">Utilizzare **resource_stats** se è necessario toomonitor meno dati granulari in un periodo di tempo più lungo.</span><span class="sxs-lookup"><span data-stu-id="80eb8-132">Use **sys.resource_stats** if you need toomonitor less granular data across a longer period of time.</span></span> <span data-ttu-id="80eb8-133">Utilizzare **Sys.dm db_resource_stats** se è necessario toomonitor dati più granulari in un intervallo di tempo minore.</span><span class="sxs-lookup"><span data-stu-id="80eb8-133">Use **sys.dm_db_resource_stats** if you need toomonitor more granular data within a smaller time frame.</span></span> <span data-ttu-id="80eb8-134">Per ulteriori informazioni, vedere la [Guida alle prestazioni del database SQL di Azure](sql-database-single-database-monitor.md#monitor-resource-use).</span><span class="sxs-lookup"><span data-stu-id="80eb8-134">For more information, see [Azure SQL Database Performance Guidance](sql-database-single-database-monitor.md#monitor-resource-use).</span></span>

> [!NOTE]
> <span data-ttu-id="80eb8-135">**sys.dm_db_resource_stats** restituisce un set di risultati vuoto quando viene usato nei database Web e Business Edition, che sono stati ritirati.</span><span class="sxs-lookup"><span data-stu-id="80eb8-135">**sys.dm_db_resource_stats** returns an empty result set when used in Web and Business edition databases, which are retired.</span></span>
>
>

### <a name="monitor-resource-use"></a><span data-ttu-id="80eb8-136">Monitorare l'uso delle risorse</span><span class="sxs-lookup"><span data-stu-id="80eb8-136">Monitor resource use</span></span>

<span data-ttu-id="80eb8-137">È possibile monitorare l'utilizzo di risorse usando [Informazioni dettagliate prestazioni query del Database SQL](sql-database-query-performance.md) e [Archivio query](https://msdn.microsoft.com/library/dn817826.aspx).</span><span class="sxs-lookup"><span data-stu-id="80eb8-137">You can monitor resource usage using [SQL Database Query Performance Insight](sql-database-query-performance.md) and [Query Store](https://msdn.microsoft.com/library/dn817826.aspx).</span></span>

<span data-ttu-id="80eb8-138">È inoltre possibile monitorare l'utilizzo tramite queste due viste:</span><span class="sxs-lookup"><span data-stu-id="80eb8-138">You can also monitor usage using these two views:</span></span>

* [<span data-ttu-id="80eb8-139">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="80eb8-139">sys.dm_db_resource_stats</span></span>](https://msdn.microsoft.com/library/dn800981.aspx)
* [<span data-ttu-id="80eb8-140">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="80eb8-140">sys.resource_stats</span></span>](https://msdn.microsoft.com/library/dn269979.aspx)

#### <a name="sysdmdbresourcestats"></a><span data-ttu-id="80eb8-141">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="80eb8-141">sys.dm_db_resource_stats</span></span>
<span data-ttu-id="80eb8-142">È possibile utilizzare hello [Sys.dm db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) vista in ogni database SQL.</span><span class="sxs-lookup"><span data-stu-id="80eb8-142">You can use hello [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) view in every SQL database.</span></span> <span data-ttu-id="80eb8-143">Hello **Sys.dm db_resource_stats** visualizzazione Mostra recente livello di servizio relativo toohello risorse utilizzare dati.</span><span class="sxs-lookup"><span data-stu-id="80eb8-143">hello **sys.dm_db_resource_stats** view shows recent resource use data relative toohello service tier.</span></span> <span data-ttu-id="80eb8-144">Informazioni relative a percentuali medie della CPU, dati I/O, scritture nei log e memoria vengono registrate ogni 15 secondi e vengono mantenute per un'ora.</span><span class="sxs-lookup"><span data-stu-id="80eb8-144">Average percentages for CPU, data I/O, log writes, and memory are recorded every 15 seconds and are maintained for 1 hour.</span></span>

<span data-ttu-id="80eb8-145">Poiché questa vista fornisce una visione più granulare sull'uso delle risorse, usare prima **sys.dm_db_resource_stats** per eventuali analisi o risoluzioni di problemi allo stato corrente.</span><span class="sxs-lookup"><span data-stu-id="80eb8-145">Because this view provides a more granular look at resource use, use **sys.dm_db_resource_stats** first for any current-state analysis or troubleshooting.</span></span> <span data-ttu-id="80eb8-146">Ad esempio, questa query Mostra Media hello e risorse massima utilizzo per il database corrente hello su hello ora precedente:</span><span class="sxs-lookup"><span data-stu-id="80eb8-146">For example, this query shows hello average and maximum resource use for hello current database over hello past hour:</span></span>

    SELECT  
        AVG(avg_cpu_percent) AS 'Average CPU use in percent',
        MAX(avg_cpu_percent) AS 'Maximum CPU use in percent',
        AVG(avg_data_io_percent) AS 'Average data I/O in percent',
        MAX(avg_data_io_percent) AS 'Maximum data I/O in percent',
        AVG(avg_log_write_percent) AS 'Average log write use in percent',
        MAX(avg_log_write_percent) AS 'Maximum log write use in percent',
        AVG(avg_memory_usage_percent) AS 'Average memory use in percent',
        MAX(avg_memory_usage_percent) AS 'Maximum memory use in percent'
    FROM sys.dm_db_resource_stats;  

<span data-ttu-id="80eb8-147">Per altre query, vedere gli esempi di hello in [Sys.dm db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span><span class="sxs-lookup"><span data-stu-id="80eb8-147">For other queries, see hello examples in [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span></span>

#### <a name="sysresourcestats"></a><span data-ttu-id="80eb8-148">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="80eb8-148">sys.resource_stats</span></span>
<span data-ttu-id="80eb8-149">Hello [resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) visualizzazione hello **master** database dispone di informazioni che consentono di monitorare le prestazioni di hello del database SQL a livello di prestazioni e il servizio specifico .</span><span class="sxs-lookup"><span data-stu-id="80eb8-149">hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view in hello **master** database has additional information that can help you monitor hello performance of your SQL database at its specific service tier and performance level.</span></span> <span data-ttu-id="80eb8-150">dati Hello vengono raccolti ogni 5 minuti e viene mantenuti per circa 35 giorni.</span><span class="sxs-lookup"><span data-stu-id="80eb8-150">hello data is collected every 5 minutes and is maintained for approximately 35 days.</span></span> <span data-ttu-id="80eb8-151">Questa vista è utile per analisi cronologiche a lungo termine dell'uso delle risorse del database SQL.</span><span class="sxs-lookup"><span data-stu-id="80eb8-151">This view is useful for a longer-term historical analysis of how your SQL database uses resources.</span></span>

<span data-ttu-id="80eb8-152">Hello seguente grafico mostra utilizzo delle risorse della CPU hello per un database Premium con livello di prestazioni P2 hello per ogni ora in una settimana.</span><span class="sxs-lookup"><span data-stu-id="80eb8-152">hello following graph shows hello CPU resource use for a Premium database with hello P2 performance level for each hour in a week.</span></span> <span data-ttu-id="80eb8-153">Questo grafico inizia di lunedì, viene 5 giorni lavorativi e un fine settimana, quando si verifica molto meno in un'applicazione hello.</span><span class="sxs-lookup"><span data-stu-id="80eb8-153">This graph starts on a Monday, shows 5 work days, and then shows a weekend, when much less happens on hello application.</span></span>

![Uso delle risorse del database SQL](./media/sql-database-performance-guidance/sql_db_resource_utilization.png)

<span data-ttu-id="80eb8-155">Dai dati hello, questo database dispone attualmente di un carico massimo della CPU di poco il 50% della CPU utilizzare il livello di prestazioni relativa toohello P2 (a mezzogiorno di martedì).</span><span class="sxs-lookup"><span data-stu-id="80eb8-155">From hello data, this database currently has a peak CPU load of just over 50 percent CPU use relative toohello P2 performance level (midday on Tuesday).</span></span> <span data-ttu-id="80eb8-156">Se fattore più importante di hello nel profilo dell'applicazione hello delle risorse della CPU, è possibile decidere che P2 è hello destra adatta tooguarantee di livello delle prestazioni che hello sempre il carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="80eb8-156">If CPU is hello dominant factor in hello application’s resource profile, then you might decide that P2 is hello right performance level tooguarantee that hello workload always fits.</span></span> <span data-ttu-id="80eb8-157">Se si prevede un toogrow applicazione nel tempo, è toohave una buona idea un buffer di risorse aggiuntive in modo che un'applicazione hello non raggiunge mai il limite di livello di prestazioni hello.</span><span class="sxs-lookup"><span data-stu-id="80eb8-157">If you expect an application toogrow over time, it's a good idea toohave an extra resource buffer so that hello application doesn't ever reach hello performance-level limit.</span></span> <span data-ttu-id="80eb8-158">Se si aumenta il livello di prestazioni hello, è possibile evitare errori visibili clienti che potrebbero verificarsi quando un database non è sufficiente richieste tooprocess power in modo efficace, soprattutto in ambienti sensibili alla latenza.</span><span class="sxs-lookup"><span data-stu-id="80eb8-158">If you increase hello performance level, you can help avoid customer-visible errors that might occur when a database doesn't have enough power tooprocess requests effectively, especially in latency-sensitive environments.</span></span> <span data-ttu-id="80eb8-159">Un esempio è un database che supporta un'applicazione quale vengono disegnate pagine Web in base ai risultati di hello delle chiamate di database.</span><span class="sxs-lookup"><span data-stu-id="80eb8-159">An example is a database that supports an application that paints webpages based on hello results of database calls.</span></span>

<span data-ttu-id="80eb8-160">Altri tipi di applicazioni può essere interpretato hello stesso grafico in modo diverso.</span><span class="sxs-lookup"><span data-stu-id="80eb8-160">Other application types might interpret hello same graph differently.</span></span> <span data-ttu-id="80eb8-161">Ad esempio, se un'applicazione tenta di tooprocess dati del libro paga ogni giorno e ha hello stesso grafico, questo tipo di modello "processo batch" potrebbe essere eseguito correttamente con un livello di prestazioni P1.</span><span class="sxs-lookup"><span data-stu-id="80eb8-161">For example, if an application tries tooprocess payroll data each day and has hello same chart, this kind of "batch job" model might do fine at a P1 performance level.</span></span> <span data-ttu-id="80eb8-162">livello di prestazioni P1 Hello è 100 mentre quello too200 Dtu a livello di prestazioni P2 hello.</span><span class="sxs-lookup"><span data-stu-id="80eb8-162">hello P1 performance level has 100 DTUs compared too200 DTUs at hello P2 performance level.</span></span> <span data-ttu-id="80eb8-163">livello di prestazioni P1 Hello fornisce prestazioni hello metà del livello di prestazioni P2 hello.</span><span class="sxs-lookup"><span data-stu-id="80eb8-163">hello P1 performance level provides half hello performance of hello P2 performance level.</span></span> <span data-ttu-id="80eb8-164">Il 50% dell'uso della CPU nel livello P2 equivale quindi al 100% dell'uso della CPU in P1.</span><span class="sxs-lookup"><span data-stu-id="80eb8-164">So, 50 percent of CPU use in P2 equals 100 percent CPU use in P1.</span></span> <span data-ttu-id="80eb8-165">Se i timeout non dispone di un'applicazione hello, non è rilevante se un processo richieda 2 o 2,5 ore toofinish, se però eseguito in giornata.</span><span class="sxs-lookup"><span data-stu-id="80eb8-165">If hello application does not have timeouts, it might not matter if a job takes 2 hours or 2.5 hours toofinish, if it gets done today.</span></span> <span data-ttu-id="80eb8-166">Per un'applicazione che rientra in questa categoria è probabilmente sufficiente usare il livello di prestazioni P1.</span><span class="sxs-lookup"><span data-stu-id="80eb8-166">An application in this category probably can use a P1 performance level.</span></span> <span data-ttu-id="80eb8-167">È possibile sfruttare il fatto di hello che vi sono periodi di tempo durante il giorno hello quando utilizzo delle risorse è inferiore, in modo che qualsiasi picco"grande" potrebbe trasformarsi in un unico di gestirle hello giornata hello.</span><span class="sxs-lookup"><span data-stu-id="80eb8-167">You can take advantage of hello fact that there are periods of time during hello day when resource use is lower, so that any "big peak" might spill over into one of hello troughs later in hello day.</span></span> <span data-ttu-id="80eb8-168">Hello a livello di prestazioni P1 potrebbe essere valido per questo tipo di applicazione e risparmiare denaro, purché i processi di hello possono terminare in orario ogni giorno.</span><span class="sxs-lookup"><span data-stu-id="80eb8-168">hello P1 performance level might be good for that kind of application (and save money), as long as hello jobs can finish on time each day.</span></span>

<span data-ttu-id="80eb8-169">Espone i Database di SQL Azure utilizzato informazioni sulle risorse per ogni database attivo nella hello **resource_stats** visualizzazione di hello **master** database in ogni server.</span><span class="sxs-lookup"><span data-stu-id="80eb8-169">Azure SQL Database exposes consumed resource information for each active database in hello **sys.resource_stats** view of hello **master** database in each server.</span></span> <span data-ttu-id="80eb8-170">dati Hello nella tabella hello vengono aggregati per intervalli di 5 minuti.</span><span class="sxs-lookup"><span data-stu-id="80eb8-170">hello data in hello table is aggregated for 5-minute intervals.</span></span> <span data-ttu-id="80eb8-171">Hello Basic, Standard e Premium livelli di servizio hello dati può richiedere più di 5 minuti tooappear nella tabella di hello, pertanto questi dati sono più utili per l'analisi cronologica anziché di analisi in tempo quasi reale.</span><span class="sxs-lookup"><span data-stu-id="80eb8-171">With hello Basic, Standard, and Premium service tiers, hello data can take more than 5 minutes tooappear in hello table, so this data is more useful for historical analysis rather than near-real-time analysis.</span></span> <span data-ttu-id="80eb8-172">Hello query **resource_stats** vista toosee hello cronologia recente di un database e toovalidate prenotazione hello scelta recapitati prestazioni hello desiderato quando necessario.</span><span class="sxs-lookup"><span data-stu-id="80eb8-172">Query hello **sys.resource_stats** view toosee hello recent history of a database and toovalidate whether hello reservation you chose delivered hello performance you want when needed.</span></span>

> [!NOTE]
> <span data-ttu-id="80eb8-173">È necessario essere connesso toohello **master** database la logica tooquery di server di database SQL **resource_stats** in hello seguono esempi.</span><span class="sxs-lookup"><span data-stu-id="80eb8-173">You must be connected toohello **master** database of your logical SQL database server tooquery **sys.resource_stats** in hello following examples.</span></span>
> 
> 

<span data-ttu-id="80eb8-174">Questo esempio viene illustrato come sono esposto dati hello in questa vista:</span><span class="sxs-lookup"><span data-stu-id="80eb8-174">This example shows you how hello data in this view is exposed:</span></span>

    SELECT TOP 10 *
    FROM sys.resource_stats
    WHERE database_name = 'resource1'
    ORDER BY start_time DESC

![vista del catalogo sys. resource_stats Hello](./media/sql-database-performance-guidance/sys_resource_stats.png)

<span data-ttu-id="80eb8-176">Hello esempio successivo illustra diversi modi, che è possibile utilizzare hello **resource_stats** catalogo tooget informazioni sull'utilizzo delle risorse del database SQL:</span><span class="sxs-lookup"><span data-stu-id="80eb8-176">hello next example shows you different ways that you can use hello **sys.resource_stats** catalog view tooget information about how your SQL database uses resources:</span></span>

1. <span data-ttu-id="80eb8-177">toolook in hello oltre risorse della settimana utilizzare per hello userdb1 di database, è possibile eseguire questa query:</span><span class="sxs-lookup"><span data-stu-id="80eb8-177">toolook at hello past week’s resource use for hello database userdb1, you can run this query:</span></span>
   
        SELECT *
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND
              start_time > DATEADD(day, -7, GETDATE())
        ORDER BY start_time DESC;
2. <span data-ttu-id="80eb8-178">tooevaluate come anche se il carico di lavoro si adatta a livello di prestazioni hello, occorre toodrill verso il basso in ogni aspetto hello la metrica delle risorse: CPU, letture, scritture, il numero di lavori e numero di sessioni.</span><span class="sxs-lookup"><span data-stu-id="80eb8-178">tooevaluate how well your workload fits hello performance level, you need toodrill down into each aspect of hello resource metrics: CPU, reads, writes, number of workers, and number of sessions.</span></span> <span data-ttu-id="80eb8-179">Ecco una rivista eseguire una query utilizzando **resource_stats** tooreport hello valori medi e massimi di queste metriche delle risorse:</span><span class="sxs-lookup"><span data-stu-id="80eb8-179">Here's a revised query using **sys.resource_stats** tooreport hello average and maximum values of these resource metrics:</span></span>
   
        SELECT
            avg(avg_cpu_percent) AS 'Average CPU use in percent',
            max(avg_cpu_percent) AS 'Maximum CPU use in percent',
            avg(avg_data_io_percent) AS 'Average physical data I/O use in percent',
            max(avg_data_io_percent) AS 'Maximum physical data I/O use in percent',
            avg(avg_log_write_percent) AS 'Average log write use in percent',
            max(avg_log_write_percent) AS 'Maximum log write use in percent',
            avg(max_session_percent) AS 'Average % of sessions',
            max(max_session_percent) AS 'Maximum % of sessions',
            avg(max_worker_percent) AS 'Average % of workers',
            max(max_worker_percent) AS 'Maximum % of workers'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
3. <span data-ttu-id="80eb8-180">Con queste informazioni sui valori medi e massimi di hello di ogni metrica della risorsa, è possibile valutare l'idoneità di rapporto al carico di lavoro nel livello di prestazioni hello che scelto.</span><span class="sxs-lookup"><span data-stu-id="80eb8-180">With this information about hello average and maximum values of each resource metric, you can assess how well your workload fits into hello performance level you chose.</span></span> <span data-ttu-id="80eb8-181">In genere, i valori medi di **resource_stats** consentono toouse una buona base di riferimento con dimensioni di destinazione hello.</span><span class="sxs-lookup"><span data-stu-id="80eb8-181">Usually, average values from **sys.resource_stats** give you a good baseline toouse against hello target size.</span></span> <span data-ttu-id="80eb8-182">Deve trattarsi dello strumento di misurazione principale.</span><span class="sxs-lookup"><span data-stu-id="80eb8-182">It should be your primary measurement stick.</span></span> <span data-ttu-id="80eb8-183">Per un esempio, è possibile utilizzare il livello di servizio Standard hello con livello di prestazioni S2.</span><span class="sxs-lookup"><span data-stu-id="80eb8-183">For an example, you might be using hello Standard service tier with S2 performance level.</span></span> <span data-ttu-id="80eb8-184">Media Hello utilizzare le percentuali per le letture dei / o e CPU, operazioni di scrittura sono sotto il 40%, numero medio di hello dei thread di lavoro è minore di 50 e numero medio di hello delle sessioni è inferiore a 200.</span><span class="sxs-lookup"><span data-stu-id="80eb8-184">hello average use percentages for CPU and I/O reads and writes are below 40 percent, hello average number of workers is below 50, and hello average number of sessions is below 200.</span></span> <span data-ttu-id="80eb8-185">Il carico di lavoro può rientrare nel livello di prestazioni S1 hello.</span><span class="sxs-lookup"><span data-stu-id="80eb8-185">Your workload might fit into hello S1 performance level.</span></span> <span data-ttu-id="80eb8-186">È facile toosee se il database rientra in lavoro hello e limiti di sessione.</span><span class="sxs-lookup"><span data-stu-id="80eb8-186">It's easy toosee whether your database fits in hello worker and session limits.</span></span> <span data-ttu-id="80eb8-187">toosee se un database può rientrare nel livello di prestazioni inferiore con l'attributo tooCPU, letture e scritture, dividere il numero di DTU hello del livello di prestazioni inferiore hello per hello numero di DTU del livello di prestazioni corrente e moltiplicare il risultato di hello 100:</span><span class="sxs-lookup"><span data-stu-id="80eb8-187">toosee whether a database fits into a lower performance level with regards tooCPU, reads, and writes, divide hello DTU number of hello lower performance level by hello DTU number of your current performance level, and then multiply hello result by 100:</span></span>
   
    <span data-ttu-id="80eb8-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span><span class="sxs-lookup"><span data-stu-id="80eb8-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span></span>
   
    <span data-ttu-id="80eb8-189">il risultato di Hello è la differenza di prestazioni relativa hello tra hello due livelli di prestazioni in percentuale.</span><span class="sxs-lookup"><span data-stu-id="80eb8-189">hello result is hello relative performance difference between hello two performance levels in percentage.</span></span> <span data-ttu-id="80eb8-190">Se l'utilizzo delle risorse non supera tale quantità, il carico di lavoro può rientrare nel livello di prestazioni inferiore hello.</span><span class="sxs-lookup"><span data-stu-id="80eb8-190">If your resource use doesn't exceed this amount, your workload might fit into hello lower performance level.</span></span> <span data-ttu-id="80eb8-191">Tuttavia, è necessario toolook tutti gli intervalli di valori di utilizzo delle risorse e determinare, in percentuale, la frequenza con cui il carico di lavoro del database può rientrare nel livello di prestazioni inferiore hello.</span><span class="sxs-lookup"><span data-stu-id="80eb8-191">However, you need toolook at all ranges of resource use values, and determine, by percentage, how often your database workload would fit into hello lower performance level.</span></span> <span data-ttu-id="80eb8-192">Hello nella query seguente restituisce hello adatta percentuale per ogni dimensione di risorsa, in base alla soglia di hello del 40% calcolata in questo esempio:</span><span class="sxs-lookup"><span data-stu-id="80eb8-192">hello following query outputs hello fit percentage per resource dimension, based on hello threshold of 40 percent that we calculated in this example:</span></span>
   
        SELECT
            (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log Write Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical Data IO Fit Percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="80eb8-193">In base all'obiettivo del livello servizio del database (SLO), è possibile decidere se il carico di lavoro rientra nel livello di prestazioni inferiore hello.</span><span class="sxs-lookup"><span data-stu-id="80eb8-193">Based on your database service level objective (SLO), you can decide whether your workload fits into hello lower performance level.</span></span> <span data-ttu-id="80eb8-194">Se il carico di lavoro database SLO è pari al 99,9% e hello query precedente restituisce i valori maggiori di 99,9% per tutti i tre dimensioni della risorsa, il carico di lavoro che si adatta nel livello di prestazioni inferiore hello.</span><span class="sxs-lookup"><span data-stu-id="80eb8-194">If your database workload SLO is 99.9 percent and hello preceding query returns values greater than 99.9 percent for all three resource dimensions, your workload likely fits into hello lower performance level.</span></span>
   
    <span data-ttu-id="80eb8-195">Esaminando hello adatta percentuale offre inoltre comprendere se è necessario spostare livello toomeet prestazioni Avanti superiore toohello il SLO.</span><span class="sxs-lookup"><span data-stu-id="80eb8-195">Looking at hello fit percentage also gives you insight into whether you should move toohello next higher performance level toomeet your SLO.</span></span> <span data-ttu-id="80eb8-196">Ad esempio, userdb1 hello dopo l'utilizzo della CPU per hello settimana precedente:</span><span class="sxs-lookup"><span data-stu-id="80eb8-196">For example, userdb1 shows hello following CPU use for hello past week:</span></span>
   
   | <span data-ttu-id="80eb8-197">Percentuale CPU media</span><span class="sxs-lookup"><span data-stu-id="80eb8-197">Average CPU percent</span></span> | <span data-ttu-id="80eb8-198">Percentuale CPU massima</span><span class="sxs-lookup"><span data-stu-id="80eb8-198">Maximum CPU percent</span></span> |
   | --- | --- |
   | <span data-ttu-id="80eb8-199">24,5</span><span class="sxs-lookup"><span data-stu-id="80eb8-199">24.5</span></span> |<span data-ttu-id="80eb8-200">100,00</span><span class="sxs-lookup"><span data-stu-id="80eb8-200">100.00</span></span> |
   
    <span data-ttu-id="80eb8-201">Hello utilizzo medio della CPU è circa un quarto del limite di hello del livello di prestazioni hello, che potrebbe rientrare perfettamente in hello livello delle prestazioni hello database.</span><span class="sxs-lookup"><span data-stu-id="80eb8-201">hello average CPU is about a quarter of hello limit of hello performance level, which would fit well into hello performance level of hello database.</span></span> <span data-ttu-id="80eb8-202">Tuttavia, valore massimo hello mostra che il database hello raggiunge il limite di hello del livello di prestazioni hello.</span><span class="sxs-lookup"><span data-stu-id="80eb8-202">But, hello maximum value shows that hello database reaches hello limit of hello performance level.</span></span> <span data-ttu-id="80eb8-203">È necessario toomove toohello livello di prestazioni superiore?</span><span class="sxs-lookup"><span data-stu-id="80eb8-203">Do you need toomove toohello next higher performance level?</span></span> <span data-ttu-id="80eb8-204">Osservare come più volte i carico di lavoro raggiunge il 100% e confrontare il carico di lavoro database tooyour SLO.</span><span class="sxs-lookup"><span data-stu-id="80eb8-204">Look at how many times your workload reaches 100 percent, and then compare it tooyour database workload SLO.</span></span>
   
        SELECT
        (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log write fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical data I/O fit percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="80eb8-205">Se questa query restituisce un valore inferiore a 99,9% per le dimensioni di hello tre risorse, uno spostamento toohello successivo livello di prestazioni superiore oppure usare l'ottimizzazione di applicazioni tecniche tooreduce hello carico nel database SQL di hello.</span><span class="sxs-lookup"><span data-stu-id="80eb8-205">If this query returns a value less than 99.9 percent for any of hello three resource dimensions, consider either moving toohello next higher performance level or use application-tuning techniques tooreduce hello load on hello SQL database.</span></span>
4. <span data-ttu-id="80eb8-206">In questo esercizio viene inoltre presa in considerazione l'aumento del carico di lavoro previsto di hello future.</span><span class="sxs-lookup"><span data-stu-id="80eb8-206">This exercise also considers your projected workload increase in hello future.</span></span>

<span data-ttu-id="80eb8-207">Per il pool elastico, è possibile monitorare i singoli database nel pool di hello con le tecniche di hello descritti in questa sezione.</span><span class="sxs-lookup"><span data-stu-id="80eb8-207">For elastic pools, you can monitor individual databases in hello pool with hello techniques described in this section.</span></span> <span data-ttu-id="80eb8-208">Ma è anche possibile monitorare il pool di hello nel suo complesso.</span><span class="sxs-lookup"><span data-stu-id="80eb8-208">But you can also monitor hello pool as a whole.</span></span> <span data-ttu-id="80eb8-209">Per informazioni, vedere [Monitorare e gestire un elastico](sql-database-elastic-pool-manage-portal.md).</span><span class="sxs-lookup"><span data-stu-id="80eb8-209">For information, see [Monitor and manage an elastic pool](sql-database-elastic-pool-manage-portal.md).</span></span>


### <a name="maximum-concurrent-requests"></a><span data-ttu-id="80eb8-210">Numero massimo di richieste simultanee</span><span class="sxs-lookup"><span data-stu-id="80eb8-210">Maximum concurrent requests</span></span>
<span data-ttu-id="80eb8-211">numero di hello toosee di richieste simultanee, eseguire la query Transact-SQL nel database SQL di:</span><span class="sxs-lookup"><span data-stu-id="80eb8-211">toosee hello number of concurrent requests, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R

<span data-ttu-id="80eb8-212">carico di lavoro hello tooanalyze di un database di SQL Server locale, modificare toofilter questa query sul database specifico hello desiderato tooanalyze.</span><span class="sxs-lookup"><span data-stu-id="80eb8-212">tooanalyze hello workload of an on-premises SQL Server database, modify this query toofilter on hello specific database you want tooanalyze.</span></span> <span data-ttu-id="80eb8-213">Ad esempio, se si dispone di un database locale denominato MyDatabase, questa query Transact-SQL restituisce il conteggio di hello di richieste simultanee in tale database:</span><span class="sxs-lookup"><span data-stu-id="80eb8-213">For example, if you have an on-premises database named MyDatabase, this Transact-SQL query returns hello count of concurrent requests in that database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R
    INNER JOIN sys.databases D ON D.database_id = R.database_id
    AND D.name = 'MyDatabase'

<span data-ttu-id="80eb8-214">Questo è solo uno snapshot in un singolo punto nel tempo.</span><span class="sxs-lookup"><span data-stu-id="80eb8-214">This is just a snapshot at a single point in time.</span></span> <span data-ttu-id="80eb8-215">tooget una migliore comprensione del carico di lavoro e requisiti di richieste simultanee, è necessario toocollect numero di campioni nel tempo.</span><span class="sxs-lookup"><span data-stu-id="80eb8-215">tooget a better understanding of your workload and concurrent request requirements, you'll need toocollect many samples over time.</span></span>

### <a name="maximum-concurrent-logins"></a><span data-ttu-id="80eb8-216">Numero massimo di accessi simultanei</span><span class="sxs-lookup"><span data-stu-id="80eb8-216">Maximum concurrent logins</span></span>
<span data-ttu-id="80eb8-217">È possibile analizzare il tooget modelli un'idea della frequenza di hello degli account di accesso utente e dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="80eb8-217">You can analyze your user and application patterns tooget an idea of hello frequency of logins.</span></span> <span data-ttu-id="80eb8-218">È anche possibile eseguire caricamenti realistici in un ambiente test per toomake assicurarsi che non si riscontrano questo o altri limiti che vengono discussi in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="80eb8-218">You also can run real-world loads in a test environment toomake sure that you're not hitting this or other limits we discuss in this article.</span></span> <span data-ttu-id="80eb8-219">Non è disponibile alcuna vista di query singola o vista a gestione dinamica per la visualizzazione dei numeri o della cronologia degli accessi simultanei.</span><span class="sxs-lookup"><span data-stu-id="80eb8-219">There isn’t a single query or dynamic management view (DMV) that can show you concurrent login counts or history.</span></span>

<span data-ttu-id="80eb8-220">Se più client utilizzano hello stessa stringa di connessione, hello autentica il servizio ogni account di accesso.</span><span class="sxs-lookup"><span data-stu-id="80eb8-220">If multiple clients use hello same connection string, hello service authenticates each login.</span></span> <span data-ttu-id="80eb8-221">Se 10 utenti di connettersi contemporaneamente database tooa tramite hello stesso nome utente e password, non vi sarà 10 accessi simultanei.</span><span class="sxs-lookup"><span data-stu-id="80eb8-221">If 10 users simultaneously connect tooa database by using hello same username and password, there would be 10 concurrent logins.</span></span> <span data-ttu-id="80eb8-222">Questo limite si applica solo toohello durata dell'accesso hello e l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="80eb8-222">This limit applies only toohello duration of hello login and authentication.</span></span> <span data-ttu-id="80eb8-223">Se gli utenti di hello 10 stesso database toohello si connettono in sequenza, il numero di hello di accessi simultanei mai sarebbe maggiore di 1.</span><span class="sxs-lookup"><span data-stu-id="80eb8-223">If hello same 10 users connect toohello database sequentially, hello number of concurrent logins would never be greater than 1.</span></span>

> [!NOTE]
> <span data-ttu-id="80eb8-224">Attualmente, questo limite non si applica toodatabases nel pool elastico.</span><span class="sxs-lookup"><span data-stu-id="80eb8-224">Currently, this limit does not apply toodatabases in elastic pools.</span></span>
> 
> 

### <a name="maximum-sessions"></a><span data-ttu-id="80eb8-225">Numero massimo di sessioni</span><span class="sxs-lookup"><span data-stu-id="80eb8-225">Maximum sessions</span></span>
<span data-ttu-id="80eb8-226">numero di hello toosee di sessioni attive correnti, eseguire la query Transact-SQL nel database SQL di:</span><span class="sxs-lookup"><span data-stu-id="80eb8-226">toosee hello number of current active sessions, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Sessions]
    FROM sys.dm_exec_connections

<span data-ttu-id="80eb8-227">Se si sta analizzando un carico di lavoro di SQL Server locale, è possibile modificare hello toofocus di query su un database specifico.</span><span class="sxs-lookup"><span data-stu-id="80eb8-227">If you're analyzing an on-premises SQL Server workload, modify hello query toofocus on a specific database.</span></span> <span data-ttu-id="80eb8-228">Questa query consente di determinare le esigenze di sessione possibili per il database di hello se si intende lo spostamento tooAzure Database SQL.</span><span class="sxs-lookup"><span data-stu-id="80eb8-228">This query helps you determine possible session needs for hello database if you are considering moving it tooAzure SQL Database.</span></span>

    SELECT COUNT(*)  AS [Sessions]
    FROM sys.dm_exec_connections C
    INNER JOIN sys.dm_exec_sessions S ON (S.session_id = C.session_id)
    INNER JOIN sys.databases D ON (D.database_id = S.database_id)
    WHERE D.name = 'MyDatabase'

<span data-ttu-id="80eb8-229">Queste query restituiscono un conteggio temporizzato.</span><span class="sxs-lookup"><span data-stu-id="80eb8-229">Again, these queries return a point-in-time count.</span></span> <span data-ttu-id="80eb8-230">Se si raccolgono più campioni nel tempo, è necessario migliore conoscenza di hello della sessione di utilizzare.</span><span class="sxs-lookup"><span data-stu-id="80eb8-230">If you collect multiple samples over time, you’ll have hello best understanding of your session use.</span></span>

<span data-ttu-id="80eb8-231">Per l'analisi di Database SQL, è possibile ottenere statistiche cronologiche sulle sessioni eseguendo una query hello [resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) visualizzazione e la revisione hello **active_session_count** colonna.</span><span class="sxs-lookup"><span data-stu-id="80eb8-231">For SQL Database analysis, you can get historical statistics on sessions by querying hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view and reviewing hello **active_session_count** column.</span></span> 
