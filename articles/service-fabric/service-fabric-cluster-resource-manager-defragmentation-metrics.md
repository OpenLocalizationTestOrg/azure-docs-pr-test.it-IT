---
title: Deframmentazione delle metriche in Azure Service Fabric | Documentazione Microsoft
description: Informazioni generali sull'uso della deframmentazione o della compressione come strategia per le metriche in Service Fabric
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: e5ebfae5-c8f7-4d6c-9173-3e22a9730552
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: b253cc07066092aa82d218c9c82c8aac502245a8
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/18/2017
---
# <a name="defragmentation-of-metrics-and-load-in-service-fabric"></a><span data-ttu-id="b0ad8-103">Deframmentazione delle metriche e del carico in Service Fabric</span><span class="sxs-lookup"><span data-stu-id="b0ad8-103">Defragmentation of metrics and load in Service Fabric</span></span>
<span data-ttu-id="b0ad8-104">La strategia predefinita di Cluster Resource Manager di Service Fabric per la gestione delle metriche di carico del cluster è di distribuire il carico.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-104">The Service Fabric Cluster Resource Manager's default strategy for managing load metrics in the cluster is to distribute the load.</span></span> <span data-ttu-id="b0ad8-105">Assicurare che i nodi vengano usati in modo uniforme evita aree sensibili e non sensibili che possono causare conflitti e spreco di risorse.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-105">Ensuring that nodes are evenly utilized avoids hot and cold spots that lead to both contention and wasted resources.</span></span> <span data-ttu-id="b0ad8-106">La distribuzione dei carichi di lavoro nel cluster è il modo più sicuro per la sopravvivenza agli errori perché garantisce che qualsiasi anomalia non interessi gran parte di un carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-106">Distributing workloads in the cluster is also the safest in terms of surviving failures since it ensures that a failure doesn’t take out a large percentage of a given workload.</span></span> 

<span data-ttu-id="b0ad8-107">Cluster Resource Manager di Service Fabric supporta anche una strategia diversa per la gestione del carico, ovvero la deframmentazione.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-107">The Service Fabric Cluster Resource Manager does support a different strategy for managing load, which is defragmentation.</span></span> <span data-ttu-id="b0ad8-108">La deframmentazione implica che invece di tentare di distribuire l'uso di una metrica all'interno del cluster, viene consolidata.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-108">Defragmentation means that instead of trying to distribute the utilization of a metric across the cluster, it is consolidated.</span></span> <span data-ttu-id="b0ad8-109">Il consolidamento rappresenta una inversione della strategia di bilanciamento predefinita: invece di ridurre al minimo la deviazione media standard del carico della metrica Cluster Resource Manager cerca di aumentarla.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-109">Consolidation is just an inversion of the default balancing strategy – instead of minimizing the average standard deviation of metric load, the Cluster Resource Manager tries to increase it.</span></span>

## <a name="when-to-use-defragmentation"></a><span data-ttu-id="b0ad8-110">Quando usare la deframmentazione</span><span class="sxs-lookup"><span data-stu-id="b0ad8-110">When to use defragmentation</span></span>
<span data-ttu-id="b0ad8-111">La distribuzione del carico nel cluster usa alcune delle risorse in ogni nodo.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-111">Distributing load in the cluster consumes some of the resources on each node.</span></span> <span data-ttu-id="b0ad8-112">Alcuni carichi di lavoro creano servizi di dimensioni eccezionalmente elevate e consumano la maggior parte o tutto un nodo.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-112">Some workloads create services that are exceptionally large and consume most or all of a node.</span></span> <span data-ttu-id="b0ad8-113">In questi casi, è possibile che durante la creazione di grandi carichi di lavoro non vi sia spazio sufficiente su qualsiasi nodo per eseguirli.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-113">In these cases, it's possible that when there are large workloads getting created that there isn't enough space on any node to run them.</span></span> <span data-ttu-id="b0ad8-114">I carichi di lavoro di grandi dimensioni non sono un problema in Service Fabric. Cluster Resource Manager determina come è necessario per riorganizzare il cluster per far spazio al carico di lavoro di dimensioni elevate.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-114">Large workloads aren't a problem in Service Fabric; in these cases the Cluster Resource Manager determines that it needs to reorganize the cluster to make room for this large workload.</span></span> <span data-ttu-id="b0ad8-115">Tuttavia, nel frattempo il carico di lavoro deve rimanere in attesa di essere pianificato nel cluster.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-115">However, in the meantime that workload has to wait to be scheduled in the cluster.</span></span>

<span data-ttu-id="b0ad8-116">Se sono presenti molti servizi e stati da spostare, potrebbe occorrere molto tempo per inserire nel cluster il carico di lavoro di dimensioni elevate.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-116">If there are many services and state to move around, then it could take a long time for the large workload to be placed in the cluster.</span></span> <span data-ttu-id="b0ad8-117">Ciò è più probabile se anche altri carichi di lavoro già nel cluster sono di dimensioni elevate e pertanto richiedono più tempo per la riorganizzazione.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-117">This is more likely if other workloads in the cluster are also large and so take longer to reorganize.</span></span> <span data-ttu-id="b0ad8-118">Il team di Service Fabric ha misurato i tempi di creazione nelle simulazioni di questo scenario.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-118">The Service Fabric team measured creation times in simulations of this scenario.</span></span> <span data-ttu-id="b0ad8-119">È stato rilevato che la creazione di servizi di grandi dimensioni ha richiesto molto più tempo quando l'uso del cluster ha superato il valore tra il 30 e il 50%.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-119">We found that creating large services took much longer as soon as cluster utilization got above between 30% and 50%.</span></span> <span data-ttu-id="b0ad8-120">Per gestire questo scenario, è stata introdotta la deframmentazione come strategia di bilanciamento.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-120">To handle this scenario, we introduced defragmentation as a balancing strategy.</span></span> <span data-ttu-id="b0ad8-121">È stato riscontrato che per i carichi di lavoro di grandi dimensioni, soprattutto quelli per cui il tempo di creazione era elevato, la deframmentazione ha davvero aiutato nella pianificazione di tali carichi nel cluster.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-121">We found that for large workloads, especially ones where creation time was important, defragmentation really helped those new workloads get scheduled in the cluster.</span></span>

<span data-ttu-id="b0ad8-122">È possibile configurare le metriche di deframmentazione in modo che Cluster Resource Manager tenti in maniera proattiva di condensare in meno nodi il carico dei servizi.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-122">You can configure defragmentation metrics to have the Cluster Resource Manager to proactively try to condense the load of the services into fewer nodes.</span></span> <span data-ttu-id="b0ad8-123">Questo garantisce che ci sia quasi sempre spazio per servizi di dimensioni ancora più elevate senza necessità di riorganizzare il cluster.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-123">This helps ensure that there is almost always room for large services without reorganizing the cluster.</span></span> <span data-ttu-id="b0ad8-124">Non dover riorganizzare il cluster consente di creare rapidamente grandi carichi di lavoro.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-124">Not having to reorganize the cluster allows creating large workloads quickly.</span></span>

<span data-ttu-id="b0ad8-125">La maggior parte degli utenti non avrà bisogno della deframmentazione.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-125">Most people don’t need defragmentation.</span></span> <span data-ttu-id="b0ad8-126">I servizi sono in genere di piccole dimensioni e non è difficile trovare spazio nel cluster.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-126">Services are usually be small, so it’s not hard to find room for them in the cluster.</span></span> <span data-ttu-id="b0ad8-127">Quando la riorganizzazione è possibile avviene rapidamente poiché la maggior parte dei servizi sono di dimensioni ridotte e possono essere spostati rapidamente e in parallelo.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-127">When reorganization is possible, it goes quickly, again because most services are small and can be moved quickly and in parallel.</span></span> <span data-ttu-id="b0ad8-128">Se tuttavia si dispone di servizi di grandi dimensioni da creare rapidamente allora la deframmentazione è la strategia più indicata.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-128">However, if you have large services and need them created quickly then the defragmentation strategy is for you.</span></span> <span data-ttu-id="b0ad8-129">Si illustreranno gli svantaggi dell'uso della deframmentazione qui di seguito.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-129">We'll discuss the tradeoffs of using defragmentation next.</span></span> 

## <a name="defragmentation-tradeoffs"></a><span data-ttu-id="b0ad8-130">Svantaggi della deframmentazione</span><span class="sxs-lookup"><span data-stu-id="b0ad8-130">Defragmentation tradeoffs</span></span>
<span data-ttu-id="b0ad8-131">La deframmentazione può aumentare l'impatto degli errori, poiché vengono eseguiti più servizi sui nodi che presentano errori.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-131">Defragmentation can increase impactfulness of failures, since more services are running on nodes that fail.</span></span> <span data-ttu-id="b0ad8-132">La deframmentazione può anche aumentare i costi poiché le risorse del cluster devono essere tenute di riserva in attesa della creazione di carichi di lavoro di grandi dimensioni.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-132">Defragmentation can also increase costs, since resources in the cluster must be held in reserve, waiting for the creation of large workloads.</span></span>

<span data-ttu-id="b0ad8-133">Il diagramma di seguito offre una rappresentazione visiva di due cluster, uno deframmentato e uno non deframmentato.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-133">The following diagram gives a visual representation of two clusters, one that is defragmented and one that is not.</span></span> 

<span data-ttu-id="b0ad8-134"><center>
![Confronto tra cluster bilanciati e deframmentati][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="b0ad8-134"><center>
![Comparing Balanced and Defragmented Clusters][Image1]
</center></span></span>

<span data-ttu-id="b0ad8-135">Nel caso bilanciato, considerare il numero di spostamenti necessari per posizionare uno degli oggetti servizio di dimensioni più grandi.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-135">In the balanced case, consider the number of movements that would be necessary to place one of the largest service objects.</span></span> <span data-ttu-id="b0ad8-136">Nel cluster deframmentato il carico di lavoro di grandi dimensioni potrebbe trovarsi nel nodo quattro o cinque senza dover attendere lo spostamento di altri servizi.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-136">In the defragmented cluster, the large workload could be placed on nodes four or five without having to wait for any other services to move.</span></span>

## <a name="defragmentation-pros-and-cons"></a><span data-ttu-id="b0ad8-137">Vantaggi e svantaggi della deframmentazione</span><span class="sxs-lookup"><span data-stu-id="b0ad8-137">Defragmentation pros and cons</span></span>
<span data-ttu-id="b0ad8-138">Quali sono quindi questi altri compromessi concettuali?</span><span class="sxs-lookup"><span data-stu-id="b0ad8-138">So what are those other conceptual tradeoffs?</span></span> <span data-ttu-id="b0ad8-139">Ecco una tabella riepilogativa degli aspetti da considerare:</span><span class="sxs-lookup"><span data-stu-id="b0ad8-139">Here’s a quick table of things to think about:</span></span>

| <span data-ttu-id="b0ad8-140">Vantaggi della deframmentazione</span><span class="sxs-lookup"><span data-stu-id="b0ad8-140">Defragmentation Pros</span></span> | <span data-ttu-id="b0ad8-141">Svantaggi della deframmentazione</span><span class="sxs-lookup"><span data-stu-id="b0ad8-141">Defragmentation Cons</span></span> |
| --- | --- |
| <span data-ttu-id="b0ad8-142">Consente di creare servizi di grandi dimensioni più rapidamente</span><span class="sxs-lookup"><span data-stu-id="b0ad8-142">Allows faster creation of large services</span></span> |<span data-ttu-id="b0ad8-143">Concentra i carichi in meno nodi, aumentando il conflitto</span><span class="sxs-lookup"><span data-stu-id="b0ad8-143">Concentrates load onto fewer nodes, increasing contention</span></span> |
| <span data-ttu-id="b0ad8-144">Consente di ridurre lo spostamento dei dati durante la creazione</span><span class="sxs-lookup"><span data-stu-id="b0ad8-144">Enables lower data movement during creation</span></span> |<span data-ttu-id="b0ad8-145">Eventuali errori possono impattare più servizi e causare una maggiore varianza</span><span class="sxs-lookup"><span data-stu-id="b0ad8-145">Failures can impact more services and cause more churn</span></span> |
| <span data-ttu-id="b0ad8-146">Consente una descrizione completa dei requisiti e il recupero di spazio</span><span class="sxs-lookup"><span data-stu-id="b0ad8-146">Allows rich description of requirements and reclamation of space</span></span> |<span data-ttu-id="b0ad8-147">Configurazione di gestione delle risorse complessiva più complessa</span><span class="sxs-lookup"><span data-stu-id="b0ad8-147">More complex overall Resource Management configuration</span></span> |

<span data-ttu-id="b0ad8-148">È possibile combinare le metriche normali e deframmentate nello stesso cluster.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-148">You can mix defragmented and normal metrics in the same cluster.</span></span> <span data-ttu-id="b0ad8-149">Cluster Resource Manager tenta di consolidare il più possibile le metriche di deframmentazione, diffondendo le altre.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-149">The Cluster Resource Manager tries to consolidate the defragmentation metrics as much as possible while spreading out the others.</span></span> <span data-ttu-id="b0ad8-150">I risultati della combinazione delle strategie di deframmentazione e bilanciamento del carico dipendono da diversi fattori, tra cui:</span><span class="sxs-lookup"><span data-stu-id="b0ad8-150">The results of mixing defragmentation and balancing strategies depends on several factors, including:</span></span>
  - <span data-ttu-id="b0ad8-151">il numero delle metriche di bilanciamento e il numero delle metriche di deframmentazione</span><span class="sxs-lookup"><span data-stu-id="b0ad8-151">the number of balancing metrics vs. the number of defragmentation metrics</span></span>
  - <span data-ttu-id="b0ad8-152">se un servizio usa entrambi i tipi di metriche</span><span class="sxs-lookup"><span data-stu-id="b0ad8-152">Whether any service uses both types of metrics</span></span> 
  - <span data-ttu-id="b0ad8-153">i pesi delle metriche</span><span class="sxs-lookup"><span data-stu-id="b0ad8-153">the metric weights</span></span>
  - <span data-ttu-id="b0ad8-154">i carichi correnti delle metriche</span><span class="sxs-lookup"><span data-stu-id="b0ad8-154">current metric loads</span></span>
  
<span data-ttu-id="b0ad8-155">È necessario fare delle prove per determinare la configurazione esatta necessaria.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-155">Experimentation is required to determine the exact configuration necessary.</span></span> <span data-ttu-id="b0ad8-156">Si consiglia di misurare accuratamente i carichi di lavoro prima di abilitare le metriche di deframmentazione nella produzione.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-156">We recommend thorough measurement of your workloads before you enable defragmentation metrics in production.</span></span> <span data-ttu-id="b0ad8-157">Ciò vale soprattutto quando si combinano metriche di deframmentazione e metriche bilanciate all'interno dello stesso servizio.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-157">This is especially true when mixing defragmentation and balanced metrics within the same service.</span></span> 

## <a name="configuring-defragmentation-metrics"></a><span data-ttu-id="b0ad8-158">Configurazione delle metriche di deframmentazione</span><span class="sxs-lookup"><span data-stu-id="b0ad8-158">Configuring defragmentation metrics</span></span>
<span data-ttu-id="b0ad8-159">La configurazione delle metriche di deframmentazione è una decisione globale nel cluster ed è possibile selezionare metriche singole per la deframmentazione.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-159">Configuring defragmentation metrics is a global decision in the cluster, and individual metrics can be selected for defragmentation.</span></span> <span data-ttu-id="b0ad8-160">I frammenti di codice di configurazione seguenti illustrano come configurare le metriche per la deframmentazione.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-160">The following config snippets show how to configure metrics for defragmentation.</span></span> <span data-ttu-id="b0ad8-161">In questo caso, "Metric1" è configurato come una metrica di deframmentazione, mentre "Metric2" continuerà a essere bilanciata normalmente.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-161">In this case, "Metric1" is configured as a defragmentation metric, while "Metric2" will continue to be balanced normally.</span></span> 

<span data-ttu-id="b0ad8-162">ClusterManifest.xml:</span><span class="sxs-lookup"><span data-stu-id="b0ad8-162">ClusterManifest.xml:</span></span>

```xml
<Section Name="DefragmentationMetrics">
    <Parameter Name="Metric1" Value="true" />
    <Parameter Name="Metric2" Value="false" />
</Section>
```

<span data-ttu-id="b0ad8-163">mediante ClusterConfig.json per le distribuzioni autonome o Template.json per i cluster ospitati in Azure:</span><span class="sxs-lookup"><span data-stu-id="b0ad8-163">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "DefragmentationMetrics",
    "parameters": [
      {
          "name": "Metric1",
          "value": "true"
      },
      {
          "name": "Metric2",
          "value": "false"
      }
    ]
  }
]
```


## <a name="next-steps"></a><span data-ttu-id="b0ad8-164">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="b0ad8-164">Next steps</span></span>
- <span data-ttu-id="b0ad8-165">Cluster Resource Manager dispone di varie opzioni per descrivere il cluster.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-165">The Cluster Resource Manager has man options for describing the cluster.</span></span> <span data-ttu-id="b0ad8-166">Per altre informazioni a riguardo vedere l'articolo [Descrivere un cluster di Service Fabric](service-fabric-cluster-resource-manager-cluster-description.md)</span><span class="sxs-lookup"><span data-stu-id="b0ad8-166">To find out more about them, check out this article on [describing a Service Fabric cluster](service-fabric-cluster-resource-manager-cluster-description.md)</span></span>
- <span data-ttu-id="b0ad8-167">Le metriche determinano il modo in cui Cluster Resource Manger di Service Fabric gestisce il consumo e la capacità del cluster.</span><span class="sxs-lookup"><span data-stu-id="b0ad8-167">Metrics are how the Service Fabric Cluster Resource Manger manages consumption and capacity in the cluster.</span></span> <span data-ttu-id="b0ad8-168">Per altre informazioni sulle metriche e su come configurarle, vedere [questo articolo](service-fabric-cluster-resource-manager-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="b0ad8-168">To learn more about metrics and how to configure them, check out [this article](service-fabric-cluster-resource-manager-metrics.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-defragmentation-metrics/balancing-defrag-compared.png
