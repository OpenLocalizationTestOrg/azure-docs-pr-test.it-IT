---
title: libreria client di database elastico aaaUsing con Dapper | Documenti Microsoft
description: Utilizzo della libreria client dei database elastici con Dapper.
services: sql-database
documentationcenter: 
manager: jhubbard
author: torsteng
ms.assetid: 463d2676-3b19-47c2-83df-f8c50492c9d2
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/27/2016
ms.author: torsteng
ms.openlocfilehash: c22ece2a977265e93850f0ad3f3ca48f0a8733ac
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="using-elastic-database-client-library-with-dapper"></a><span data-ttu-id="2ebe4-103">Utilizzo della libreria client dei database elastici con Dapper</span><span class="sxs-lookup"><span data-stu-id="2ebe4-103">Using elastic database client library with Dapper</span></span>
<span data-ttu-id="2ebe4-104">Questo documento è destinata agli sviluppatori che si basano sulle applicazioni toobuild Dapper, ma desidera anche tooembrace [degli strumenti di database elastico](sql-database-elastic-scale-introduction.md) toocreate applicazioni che implementano tooscale partizionamento orizzontale in orizzontale il livello dati.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-104">This document is for developers that rely on Dapper toobuild applications, but also want tooembrace [elastic database tooling](sql-database-elastic-scale-introduction.md) toocreate applications that implement sharding tooscale-out their data tier.</span></span>  <span data-ttu-id="2ebe4-105">Questo documento vengono illustrate le modifiche di hello nelle applicazioni basate su Dapper che sono necessarie toointegrate con gli strumenti di database elastico.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-105">This document illustrates hello changes in Dapper-based applications that are necessary toointegrate with elastic database tools.</span></span> <span data-ttu-id="2ebe4-106">L'obiettivo è la composizione di gestione di partizioni di database elastico hello e dipendente dai dati di routing con Dapper.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-106">Our focus is on composing hello elastic database shard management and data dependent routing with Dapper.</span></span> 

<span data-ttu-id="2ebe4-107">**Codice di esempio**: [Strumenti dei database elastici per il database SQL di Azure - Integrazione con Dapper](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span><span class="sxs-lookup"><span data-stu-id="2ebe4-107">**Sample Code**: [Elastic database tools for Azure SQL Database - Dapper integration](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span></span>

<span data-ttu-id="2ebe4-108">L'integrazione **Dapper** e **DapperExtensions** hello libreria client di database elastici per Database SQL di Azure in modo semplice.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-108">Integrating **Dapper** and **DapperExtensions** with hello elastic database client library for Azure SQL Database is easy.</span></span> <span data-ttu-id="2ebe4-109">L'applicazione può utilizzare dati routing modificando la creazione di hello e l'apertura di nuovi dipendenti [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) hello toouse oggetti [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) chiamare da hello [client libreria](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span><span class="sxs-lookup"><span data-stu-id="2ebe4-109">Your applications can use data dependent routing by changing hello creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call from hello [client library](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span></span> <span data-ttu-id="2ebe4-110">Consente di limitare le modifiche in tooonly l'applicazione in cui le nuove connessioni vengono create e aperto.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-110">This limits changes in your application tooonly where new connections are created and opened.</span></span> 

## <a name="dapper-overview"></a><span data-ttu-id="2ebe4-111">Informazioni generali su Dapper</span><span class="sxs-lookup"><span data-stu-id="2ebe4-111">Dapper overview</span></span>
<span data-ttu-id="2ebe4-112">**Dapper** è un mapper object-relational.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-112">**Dapper** is an object-relational mapper.</span></span> <span data-ttu-id="2ebe4-113">Eseguire il mapping di oggetti .NET dai database relazionali di tooa dell'applicazione (e viceversa).</span><span class="sxs-lookup"><span data-stu-id="2ebe4-113">It maps .NET objects from your application tooa relational database (and vice versa).</span></span> <span data-ttu-id="2ebe4-114">prima parte di Hello hello del codice di esempio viene illustrato come integrare libreria client di database elastico hello con le applicazioni basate su Dapper.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-114">hello first part of hello sample code illustrates how you can integrate hello elastic database client library with Dapper-based applications.</span></span> <span data-ttu-id="2ebe4-115">seconda parte di Hello hello del codice di esempio viene illustrato come toointegrate quando si utilizza Dapper sia DapperExtensions.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-115">hello second part of hello sample code illustrates how toointegrate when using both Dapper and DapperExtensions.</span></span>  

<span data-ttu-id="2ebe4-116">funzionalità di BizTalk mapper Hello Dapper fornisce metodi di estensione per le connessioni di database che semplificano l'invio di istruzioni T-SQL per l'esecuzione o l'esecuzione di query database hello.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-116">hello mapper functionality in Dapper provides extension methods on database connections that simplify submitting T-SQL statements for execution or querying hello database.</span></span> <span data-ttu-id="2ebe4-117">Ad esempio, Dapper rende facile toomap tra gli oggetti di .NET e i parametri hello delle istruzioni SQL per **Execute** chiamate o tooconsume hello risultati delle query SQL in oggetti .NET utilizzando **Query**chiamate da Dapper.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-117">For instance, Dapper makes it easy toomap between your .NET objects and hello parameters of SQL statements for **Execute** calls, or tooconsume hello results of your SQL queries into .NET objects using **Query** calls from Dapper.</span></span> 

<span data-ttu-id="2ebe4-118">Quando si utilizza DapperExtensions, non è più necessario istruzioni SQL di tooprovide hello.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-118">When using DapperExtensions, you no longer need tooprovide hello SQL statements.</span></span> <span data-ttu-id="2ebe4-119">Metodi di estensione, ad esempio **GetList** o **inserire** su connessione al database hello creare istruzioni SQL in background hello hello.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-119">Extensions methods such as **GetList** or **Insert** over hello database connection create hello SQL statements behind hello scenes.</span></span>

<span data-ttu-id="2ebe4-120">Un altro vantaggio della Dapper, nonché DapperExtensions è che i controlli dell'applicazione hello hello creazione della connessione al database hello.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-120">Another benefit of Dapper and also DapperExtensions is that hello application controls hello creation of hello database connection.</span></span> <span data-ttu-id="2ebe4-121">Ciò consente di interagire con una libreria client di database elastico hello che le connessioni basate su mapping hello di shardlet toodatabases Broker del database.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-121">This helps interact with hello elastic database client library which brokers database connections based on hello mapping of shardlets toodatabases.</span></span>

<span data-ttu-id="2ebe4-122">assembly di hello tooget Dapper, vedere [Dapper punto net](http://www.nuget.org/packages/Dapper/).</span><span class="sxs-lookup"><span data-stu-id="2ebe4-122">tooget hello Dapper assemblies, see [Dapper dot net](http://www.nuget.org/packages/Dapper/).</span></span> <span data-ttu-id="2ebe4-123">Per le estensioni di Dapper hello, vedere [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span><span class="sxs-lookup"><span data-stu-id="2ebe4-123">For hello Dapper extensions, see [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span></span>

## <a name="a-quick-look-at-hello-elastic-database-client-library"></a><span data-ttu-id="2ebe4-124">Una libreria client di database elastico hello sintesi</span><span class="sxs-lookup"><span data-stu-id="2ebe4-124">A quick Look at hello elastic database client library</span></span>
<span data-ttu-id="2ebe4-125">Libreria client di database elastico hello definire le partizioni di dati dell'applicazione denominati *shardlet* , eseguirne il mapping toodatabases e identificarli da *chiavi di partizionamento orizzontale*.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-125">With hello elastic database client library, you define partitions of your application data called *shardlets* , map them toodatabases, and identify them by *sharding keys*.</span></span> <span data-ttu-id="2ebe4-126">È possibile disporre di tutti i database desiderati e distribuire gli shardlet su tali database.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-126">You can have as many databases as you need and distribute your shardlets across these databases.</span></span> <span data-ttu-id="2ebe4-127">mapping di Hello dei database toohello valori di chiave di partizionamento orizzontale vengono archiviati per una mappa partizioni fornita dalle API della libreria hello.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-127">hello mapping of sharding key values toohello databases is stored by a shard map provided by hello library’s APIs.</span></span> <span data-ttu-id="2ebe4-128">Questa funzionalità è denominata **gestione mappe partizioni**.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-128">This capability is called **shard map management**.</span></span> <span data-ttu-id="2ebe4-129">mappa partizioni Hello funge anche da Service broker hello di connessioni di database per le richieste che contengono una chiave di partizionamento orizzontale.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-129">hello shard map also serves as hello broker of database connections for requests that carry a sharding key.</span></span> <span data-ttu-id="2ebe4-130">Questa funzionalità è denominata tooas **routing dipendente dai dati**.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-130">This capability is referred tooas **data dependent routing**.</span></span>

![Mappe di partizione e routing dipendente dai dati][1]

<span data-ttu-id="2ebe4-132">gestore mappe partizioni di Hello protegge gli utenti da visualizzazioni incoerenti nei dati di shardlet che possono verificarsi quando vengono eseguite operazioni di gestione di shardlet simultanee sui database hello.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-132">hello shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations are happening on hello databases.</span></span> <span data-ttu-id="2ebe4-133">toodo hello in tal caso, partizioni mappe broker hello connessioni al database per un'applicazione compilata con la libreria hello.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-133">toodo so, hello shard maps broker hello database connections for an application built with hello library.</span></span> <span data-ttu-id="2ebe4-134">Quando le operazioni di gestione di partizioni potrebbe influire sulla hello shardlet, in questo modo kill tooautomatically funzionalità di hello partizioni mappa una connessione al database.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-134">When shard management operations could impact hello shardlet, this allows hello shard map functionality tooautomatically kill a database connection.</span></span> 

<span data-ttu-id="2ebe4-135">Anziché utilizzare le connessioni di hello modalità tradizionale toocreate per Dapper, dobbiamo hello toouse [OpenConnectionForKey metodo](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span><span class="sxs-lookup"><span data-stu-id="2ebe4-135">Instead of using hello traditional way toocreate connections for Dapper, we need toouse hello [OpenConnectionForKey method](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span></span> <span data-ttu-id="2ebe4-136">Ciò garantisce che tutte le convalide hello viene eseguita e le connessioni vengono gestite correttamente quando si sposta tutti i dati tra le partizioni.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-136">This ensures that all hello validation takes place and connections are managed properly when any data moves between shards.</span></span>

### <a name="requirements-for-dapper-integration"></a><span data-ttu-id="2ebe4-137">Requisiti per l'integrazione con Dapper</span><span class="sxs-lookup"><span data-stu-id="2ebe4-137">Requirements for Dapper integration</span></span>
<span data-ttu-id="2ebe4-138">Quando si utilizza la libreria di client di database elastico hello e hello API Dapper, desideriamo hello tooretain le proprietà seguenti:</span><span class="sxs-lookup"><span data-stu-id="2ebe4-138">When working with both hello elastic database client library and hello Dapper APIs, we want tooretain hello following properties:</span></span>

* <span data-ttu-id="2ebe4-139">**Scalabilità orizzontale**: si desidera tooadd o rimuovere i database dal livello dati hello applicazione partizionati hello necessarie per le esigenze di capacità hello di un'applicazione hello.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-139">**Scaleout**: We want tooadd or remove databases from hello data tier of hello sharded application as necessary for hello capacity demands of hello application.</span></span> 
* <span data-ttu-id="2ebe4-140">**Coerenza**: poiché l'applicazione è scalabilità tramite il partizionamento orizzontale, è necessario tooperform routing dipendente dai dati.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-140">**Consistency**: Since our application is scaled out using sharding, we need tooperform data dependent routing.</span></span> <span data-ttu-id="2ebe4-141">È necessario pertanto toouse hello dati dipendenti funzionalità di routing di hello libreria toodo.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-141">We want toouse hello Data dependent routing capabilities of hello library toodo so.</span></span> <span data-ttu-id="2ebe4-142">In particolare, si desidera la convalida di hello tooretain e garanzie di coerenza per le connessioni che sono negoziate mediante gestore mappe partizioni di hello danneggiamento tooavoid ordine o risultati di query non corretto.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-142">In particular, we want tooretain hello validation and consistency guarantees provided by connections that are brokered through hello shard map manager in order tooavoid corruption or wrong query results.</span></span> <span data-ttu-id="2ebe4-143">Ciò garantisce che tooa di connessioni specificato shardlet vengono rifiutati o arrestato se (per l'istanza) shardlet hello è attualmente spostato tooa partizione diversa utilizzando le API di suddivisione/unione.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-143">This ensures that connections tooa given shardlet are rejected or stopped if (for instance) hello shardlet is currently moved tooa different shard using Split/Merge APIs.</span></span>
* <span data-ttu-id="2ebe4-144">**Mapping degli oggetti**: vogliamo praticità hello tooretain di mapping hello fornito da Dapper tootranslate tra le classi in un'applicazione hello e hello strutture di database sottostanti.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-144">**Object Mapping**: We want tooretain hello convenience of hello mappings provided by Dapper tootranslate between classes in hello application and hello underlying database structures.</span></span> 

<span data-ttu-id="2ebe4-145">Hello seguente sezione vengono fornite linee guida per i seguenti requisiti per le applicazioni basate su **Dapper** e **DapperExtensions**.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-145">hello following section provides guidance for these requirements for applications based on **Dapper** and **DapperExtensions**.</span></span>

## <a name="technical-guidance"></a><span data-ttu-id="2ebe4-146">Indicazioni tecniche</span><span class="sxs-lookup"><span data-stu-id="2ebe4-146">Technical Guidance</span></span>
### <a name="data-dependent-routing-with-dapper"></a><span data-ttu-id="2ebe4-147">Routing dipendente dai dati con Dapper</span><span class="sxs-lookup"><span data-stu-id="2ebe4-147">Data dependent routing with Dapper</span></span>
<span data-ttu-id="2ebe4-148">Con Dapper, un'applicazione hello è in genere responsabile della creazione e l'apertura di hello connessioni toohello database sottostante.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-148">With Dapper, hello application is typically responsible for creating and opening hello connections toohello underlying database.</span></span> <span data-ttu-id="2ebe4-149">Dato un tipo T da un'applicazione hello, Dapper restituisce risultati della query come raccolte di .NET di tipo T. Dapper esegue il mapping di hello da oggetti toohello righe hello T-SQL risultato di tipo T. Analogamente, Dapper esegue il mapping di oggetti .NET in valori SQL o i parametri per istruzioni data manipulation language (DML).</span><span class="sxs-lookup"><span data-stu-id="2ebe4-149">Given a type T by hello application, Dapper returns query results as .NET collections of type T. Dapper performs hello mapping from hello T-SQL result rows toohello objects of type T. Similarly, Dapper maps .NET objects into SQL values or parameters for data manipulation language (DML) statements.</span></span> <span data-ttu-id="2ebe4-150">Dapper offre questa funzionalità tramite i metodi di estensione in hello regolare [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) oggetto dalle librerie Client di SQL ADO .NET hello.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-150">Dapper offers this functionality via extension methods on hello regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) object from hello ADO .NET SQL Client libraries.</span></span> <span data-ttu-id="2ebe4-151">connessione SQL restituita dall'API di scalabilità elastica hello per DDR Hello sono anche regolare [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) oggetti.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-151">hello SQL connection returned by hello Elastic Scale APIs for DDR are also regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects.</span></span> <span data-ttu-id="2ebe4-152">In questo modo toodirectly utilizzano le estensioni Dapper su hello tipo restituito dall'API di DDR della libreria client hello, perché è anche una semplice connessione a SQL Client.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-152">This allows us toodirectly use Dapper extensions over hello type returned by hello client library’s DDR API, as it is also a simple SQL Client connection.</span></span>

<span data-ttu-id="2ebe4-153">Queste osservazioni rendono semplice toouse connessioni negoziate dalla libreria client di database elastico hello per Dapper.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-153">These observations make it straightforward toouse connections brokered by hello elastic database client library for Dapper.</span></span>

<span data-ttu-id="2ebe4-154">Questo esempio di codice (da hello che accompagna esempio) di seguito viene illustrato l'approccio hello in cui la chiave di partizionamento orizzontale hello viene fornita da hello applicazione toohello libreria toobroker hello connessione toohello destra partizioni.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-154">This code example (from hello accompanying sample) illustrates hello approach where hello sharding key is provided by hello application toohello library toobroker hello connection toohello right shard.</span></span>   

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                     key: tenantId1, 
                     connectionString: connStrBldr.ConnectionString, 
                     options: ConnectionOptions.Validate))
    {
        var blog = new Blog { Name = name };
        sqlconn.Execute(@"
                      INSERT INTO
                            Blog (Name)
                            VALUES (@name)", new { name = blog.Name }
                        );
    }

<span data-ttu-id="2ebe4-155">Hello chiamata toohello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API sostituisce creazione predefinita hello e apertura di una connessione SQL Client.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-155">hello call toohello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API replaces hello default creation and opening of a SQL Client connection.</span></span> <span data-ttu-id="2ebe4-156">Hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) chiamata accetta argomenti di hello necessari per il routing dipendente dai dati:</span><span class="sxs-lookup"><span data-stu-id="2ebe4-156">hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call takes hello arguments that are required for data dependent routing:</span></span> 

* <span data-ttu-id="2ebe4-157">Hello partizioni mappa tooaccess hello interfacce di routing dipendente di dati</span><span class="sxs-lookup"><span data-stu-id="2ebe4-157">hello shard map tooaccess hello data dependent routing interfaces</span></span>
* <span data-ttu-id="2ebe4-158">Hello shardlet hello tooidentify chiave di partizionamento orizzontale</span><span class="sxs-lookup"><span data-stu-id="2ebe4-158">hello sharding key tooidentify hello shardlet</span></span>
* <span data-ttu-id="2ebe4-159">partizioni toohello tooconnect di Hello credenziali (nome utente e password)</span><span class="sxs-lookup"><span data-stu-id="2ebe4-159">hello credentials (user name and password) tooconnect toohello shard</span></span>

<span data-ttu-id="2ebe4-160">oggetto mappa partizioni di Hello crea una partizione toohello connessione che contiene shardlet hello per hello data chiave di partizionamento orizzontale.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-160">hello shard map object creates a connection toohello shard that holds hello shardlet for hello given sharding key.</span></span> <span data-ttu-id="2ebe4-161">API client di database elastico Hello tag anche tooimplement connessione hello garantisce la consistenza.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-161">hello elastic database client APIs also tag hello connection tooimplement its consistency guarantees.</span></span> <span data-ttu-id="2ebe4-162">Poiché hello chiamare troppo[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) restituisce un oggetto di connessione SQL Client regolare, hello chiamata successiva toohello **Execute** metodo di estensione da segue Dapper hello Dapper standard procedure consigliate.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-162">Since hello call too[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) returns a regular SQL Client connection object, hello subsequent call toohello **Execute** extension method from Dapper follows hello standard Dapper practice.</span></span>

<span data-ttu-id="2ebe4-163">Le query molto lavoro hello stesso modo - Apertura connessione hello usando [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) da client hello API.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-163">Queries work very much hello same way - you first open hello connection using [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) from hello client API.</span></span> <span data-ttu-id="2ebe4-164">È quindi utilizzare risultati hello estensione Dapper regolare metodi toomap hello della query SQL in oggetti .NET:</span><span class="sxs-lookup"><span data-stu-id="2ebe4-164">Then you use hello regular Dapper extension methods toomap hello results of your SQL query into .NET objects:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId1, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate ))
    {    
           // Display all Blogs for tenant 1
           IEnumerable<Blog> result = sqlconn.Query<Blog>(@"
                                SELECT * 
                                FROM Blog
                                ORDER BY Name");

           Console.WriteLine("All blogs for tenant id {0}:", tenantId1);
           foreach (var item in result)
           {
                Console.WriteLine(item.Name);
            }
    }

<span data-ttu-id="2ebe4-165">Si noti che hello **utilizzando** blocco con gli ambiti di connessione DDR hello tutte le operazioni di database all'interno di hello blocco toohello una partizione in cui è stato conservato tenantId1.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-165">Note that hello **using** block with hello DDR connection scopes all database operations within hello block toohello one shard where tenantId1 is kept.</span></span> <span data-ttu-id="2ebe4-166">query Hello restituisce solo i blog archiviati nella partizione corrente hello, ma non hello quelli memorizzati su eventuali altre partizioni.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-166">hello query only returns blogs stored on hello current shard, but not hello ones stored on any other shards.</span></span> 

## <a name="data-dependent-routing-with-dapper-and-dapperextensions"></a><span data-ttu-id="2ebe4-167">Routing dipendente dai dati con Dapper e DapperExtensions</span><span class="sxs-lookup"><span data-stu-id="2ebe4-167">Data dependent routing with Dapper and DapperExtensions</span></span>
<span data-ttu-id="2ebe4-168">Dapper dotato di un ecosistema di estensioni aggiuntive che possono fornire ulteriori motivi di praticità e astrazione dal database hello durante lo sviluppo di applicazioni di database.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-168">Dapper comes with an ecosystem of additional extensions that can provide further convenience and abstraction from hello database when developing database applications.</span></span> <span data-ttu-id="2ebe4-169">Un esempio è rappresentato da DapperExtensions.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-169">DapperExtensions is an example.</span></span> 

<span data-ttu-id="2ebe4-170">L'uso di DapperExtensions nell'applicazione non comporta la modifica della modalità di creazione e gestione delle connessioni di database.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-170">Using DapperExtensions in your application does not change how database connections are created and managed.</span></span> <span data-ttu-id="2ebe4-171">È comunque connessioni tooopen di responsabilità dell'applicazione hello e oggetti di connessione SQL Client normali previsti da metodi di estensione hello.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-171">It is still hello application’s responsibility tooopen connections, and regular SQL Client connection objects are expected by hello extension methods.</span></span> <span data-ttu-id="2ebe4-172">È possibile affidarsi hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-172">We can rely on hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) as outlined above.</span></span> <span data-ttu-id="2ebe4-173">Hello esempi di codice seguenti illustrano, hello unica differenza sarà che non è più disponibile istruzioni T-SQL hello toowrite:</span><span class="sxs-lookup"><span data-stu-id="2ebe4-173">As hello following code samples show, hello only change is that we do no longer have toowrite hello T-SQL statements:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           var blog = new Blog { Name = name2 };
           sqlconn.Insert(blog);
    }

<span data-ttu-id="2ebe4-174">E l'esempio di codice hello per query hello:</span><span class="sxs-lookup"><span data-stu-id="2ebe4-174">And here is hello code sample for hello query:</span></span> 

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           // Display all Blogs for tenant 2
           IEnumerable<Blog> result = sqlconn.GetList<Blog>();
           Console.WriteLine("All blogs for tenant id {0}:", tenantId2);
           foreach (var item in result)
           {
               Console.WriteLine(item.Name);
           }
    }

### <a name="handling-transient-faults"></a><span data-ttu-id="2ebe4-175">Gestione degli errori temporanei</span><span class="sxs-lookup"><span data-stu-id="2ebe4-175">Handling transient faults</span></span>
<span data-ttu-id="2ebe4-176">Hello Microsoft Patterns & Practices team hello pubblicato [Transient Fault Handling Application Block](http://msdn.microsoft.com/library/hh680934.aspx) gli sviluppatori di applicazioni toohelp attenuare condizioni comuni di errori temporanei durante l'esecuzione nel cloud hello.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-176">hello Microsoft Patterns & Practices team published hello [Transient Fault Handling Application Block](http://msdn.microsoft.com/library/hh680934.aspx) toohelp application developers mitigate common transient fault conditions encountered when running in hello cloud.</span></span> <span data-ttu-id="2ebe4-177">Per ulteriori informazioni, vedere [Perseverance, segreto tutti luogo: hello Transient Fault Handling Application Block utilizzando](http://msdn.microsoft.com/library/dn440719.aspx).</span><span class="sxs-lookup"><span data-stu-id="2ebe4-177">For more information, see [Perseverance, Secret of All Triumphs: Using hello Transient Fault Handling Application Block](http://msdn.microsoft.com/library/dn440719.aspx).</span></span>

<span data-ttu-id="2ebe4-178">Nell'esempio di codice Hello si basa su hello errori temporanei della libreria tooprotect contro gli errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-178">hello code sample relies on hello transient fault library tooprotect against transient faults.</span></span> 

    SqlDatabaseUtils.SqlRetryPolicy.ExecuteAction(() =>
    {
       using (SqlConnection sqlconn = 
          shardingLayer.ShardMap.OpenConnectionForKey(tenantId2, connStrBldr.ConnectionString, ConnectionOptions.Validate))
          {
              var blog = new Blog { Name = name2 };
              sqlconn.Insert(blog);
          }
    });

<span data-ttu-id="2ebe4-179">**SqlDatabaseUtils.SqlRetryPolicy** in hello codice precedente viene definito come un **SqlDatabaseTransientErrorDetectionStrategy** con un numero di tentativi di 10 e 5 secondi di attesa tra i tentativi.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-179">**SqlDatabaseUtils.SqlRetryPolicy** in hello code above is defined as a **SqlDatabaseTransientErrorDetectionStrategy** with a retry count of 10, and 5 seconds wait time between retries.</span></span> <span data-ttu-id="2ebe4-180">Se si utilizzano transazioni, assicurarsi che l'ambito di tentativi viene reimpostato toohello dall'inizio della transazione hello in caso di hello di un errore temporaneo.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-180">If you are using transactions, make sure that your retry scope goes back toohello beginning of hello transaction in hello case of a transient fault.</span></span>

## <a name="limitations"></a><span data-ttu-id="2ebe4-181">Limitazioni</span><span class="sxs-lookup"><span data-stu-id="2ebe4-181">Limitations</span></span>
<span data-ttu-id="2ebe4-182">approcci Hello descritti nel presente documento comportano un paio di limitazioni:</span><span class="sxs-lookup"><span data-stu-id="2ebe4-182">hello approaches outlined in this document entail a couple of limitations:</span></span>

* <span data-ttu-id="2ebe4-183">codice di esempio Hello per questo documento viene illustrato come schema toomanage tra partizioni.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-183">hello sample code for this document does not demonstrate how toomanage schema across shards.</span></span>
* <span data-ttu-id="2ebe4-184">Data una richiesta, si presuppone che l'elaborazione di tutti i relativi database è contenuto all'interno di una singola partizione come identificato dalla chiave di partizionamento orizzontale hello fornita dalla richiesta hello.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-184">Given a request, we assume that all its database processing is contained within a single shard as identified by hello sharding key provided by hello request.</span></span> <span data-ttu-id="2ebe4-185">Tuttavia, questo presupposto non sempre contenere, ad esempio, quando non è possibile toomake una chiave di partizionamento orizzontale disponibile.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-185">However, this assumption does not always hold, for example, when it is not possible toomake a sharding key available.</span></span> <span data-ttu-id="2ebe4-186">tooaddress, hello libreria client di database elastico include hello [MultiShardQuery classe](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span><span class="sxs-lookup"><span data-stu-id="2ebe4-186">tooaddress this, hello elastic database client library includes hello [MultiShardQuery class](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span></span> <span data-ttu-id="2ebe4-187">classe Hello implementa un'astrazione di connessione per l'esecuzione di query su più partizioni.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-187">hello class implements a connection abstraction for querying over several shards.</span></span> <span data-ttu-id="2ebe4-188">Utilizzo di MultiShardQuery in combinazione con Dapper esula dall'ambito di hello di questo documento.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-188">Using MultiShardQuery in combination with Dapper is beyond hello scope of this document.</span></span>

## <a name="conclusion"></a><span data-ttu-id="2ebe4-189">Conclusioni</span><span class="sxs-lookup"><span data-stu-id="2ebe4-189">Conclusion</span></span>
<span data-ttu-id="2ebe4-190">Le applicazioni che usano Dapper e DapperExtensions possono trarre vantaggio facilmente dagli strumenti dei database elastici del database SQL di Azure.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-190">Applications using Dapper and DapperExtensions can easily benefit from elastic database tools for Azure SQL Database.</span></span> <span data-ttu-id="2ebe4-191">Passaggi hello descritte nel presente documento, tali applicazioni possono utilizzare funzionalità dello strumento hello per dipendenti routing modificando la creazione di hello e aprire i nuovi dati [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) hello toouse oggetti [ OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) chiamata della libreria client di database elastico hello.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-191">Through hello steps outlined in this document, those applications can use hello tool's capability for data dependent routing by changing hello creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call of hello elastic database client library.</span></span> <span data-ttu-id="2ebe4-192">Questo limita hello applicazione le modifiche necessarie toothose posizioni in cui le nuove connessioni vengono create e aperto.</span><span class="sxs-lookup"><span data-stu-id="2ebe4-192">This limits hello application changes required toothose places where new connections are created and opened.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-scale-working-with-dapper/dapperimage1.png
