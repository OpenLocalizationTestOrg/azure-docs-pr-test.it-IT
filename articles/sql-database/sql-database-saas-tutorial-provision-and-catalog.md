---
title: Eseguire il provisioning di nuovi tenant in un'app multi-tenant che usa il database SQL di Azure | Microsoft Docs
description: Informazioni su come eseguire il provisioning di nuovi tenant e catalogarli nell'app SaaS Wingtip
keywords: esercitazione database SQL
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: sstein
ms.openlocfilehash: 8fa4c4f95386a92c8c818eef1a5b4de5a086fe07
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/18/2017
---
# <a name="provision-new-tenants-and-register-them-in-the-catalog"></a><span data-ttu-id="6519f-104">Effettuare il provisioning di nuovi tenant e registrarli nel catalogo</span><span class="sxs-lookup"><span data-stu-id="6519f-104">Provision new tenants and register them in the catalog</span></span>

<span data-ttu-id="6519f-105">Questa esercitazione consente di acquisire informazioni sui modelli SaaS di provisioning e catalogo e sulle modalità di implementazione di questi nell'applicazione SaaS Wingtip.</span><span class="sxs-lookup"><span data-stu-id="6519f-105">In this tutorial, you learn about the provision and catalog SaaS patterns, and how they are implemented in the Wingtip SaaS application.</span></span> <span data-ttu-id="6519f-106">Verranno creati e inizializzati nuovi database tenant, che verranno registrati nel catalogo dei tenant dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="6519f-106">You create and initialize new tenant databases, and register them in the application’s tenant catalog.</span></span> <span data-ttu-id="6519f-107">Il catalogo è un database che gestisce il mapping tra i molti tenant dell'applicazione SaaS e i relativi dati.</span><span class="sxs-lookup"><span data-stu-id="6519f-107">The catalog is a database that maintains the mapping between the SaaS application's many tenants and their data.</span></span> <span data-ttu-id="6519f-108">Il catalogo gioca un ruolo importante indirizzando le richieste dell'applicazione al database corretto.</span><span class="sxs-lookup"><span data-stu-id="6519f-108">The catalog plays an important role directing application requests to the correct database.</span></span>  

<span data-ttu-id="6519f-109">In questa esercitazione si apprenderà come:</span><span class="sxs-lookup"><span data-stu-id="6519f-109">In this tutorial, you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="6519f-110">Eseguire il provisioning di un nuovo tenant singolo, con i passaggi dettagliati della relativa implementazione</span><span class="sxs-lookup"><span data-stu-id="6519f-110">Provision a single new tenant, including stepping through how this is implemented</span></span>
> * <span data-ttu-id="6519f-111">Effettuare il provisioning di un batch di altri tenant</span><span class="sxs-lookup"><span data-stu-id="6519f-111">Provision a batch of additional tenants</span></span>


<span data-ttu-id="6519f-112">Per completare questa esercitazione, verificare che siano soddisfatti i prerequisiti seguenti:</span><span class="sxs-lookup"><span data-stu-id="6519f-112">To complete this tutorial, make sure the following prerequisites are completed:</span></span>

* <span data-ttu-id="6519f-113">L'app SaaS Wingtip viene distribuita.</span><span class="sxs-lookup"><span data-stu-id="6519f-113">The Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="6519f-114">Per distribuire in meno di cinque minuti, vedere [Distribuire ed esplorare l'applicazione SaaS Wingtip](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="6519f-114">To deploy in less than five minutes, see [Deploy and explore the Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="6519f-115">Azure PowerShell è installato.</span><span class="sxs-lookup"><span data-stu-id="6519f-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="6519f-116">Per informazioni dettagliate, vedere [Introduzione ad Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="6519f-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-to-the-saas-catalog-pattern"></a><span data-ttu-id="6519f-117">Introduzione al modello di catalogazione SaaS</span><span class="sxs-lookup"><span data-stu-id="6519f-117">Introduction to the SaaS Catalog pattern</span></span>

<span data-ttu-id="6519f-118">In un'applicazione SaaS multi-tenant supportata da database è importante sapere dove sono archiviate le informazioni per ogni tenant.</span><span class="sxs-lookup"><span data-stu-id="6519f-118">In a database-backed multi-tenant SaaS application, it's important to know where information for each tenant is stored.</span></span> <span data-ttu-id="6519f-119">Nel modello di catalogo SaaS il mapping tra ogni tenant e la posizione in cui sono archiviati i relativi dati viene inserita all'interno di un database del catalogo.</span><span class="sxs-lookup"><span data-stu-id="6519f-119">In the SaaS catalog pattern, a catalog database is used to hold the mapping between each tenant and where their data is stored.</span></span> <span data-ttu-id="6519f-120">L'app SaaS Wingtip usa un'architettura di database a tenant singolo, ma viene applicato il modello di base che prevede l'archiviazione del mapping tenant-database in un catalogo, indipendentemente dal fatto che venga usato un database multi-tenant o a tenant singolo.</span><span class="sxs-lookup"><span data-stu-id="6519f-120">The Wingtip SaaS app uses a single-tenant per database architecture, but the basic pattern of storing tenant-to-database mapping in a catalog applies whether a multi-tenant or single-tenant database is used.</span></span>

<span data-ttu-id="6519f-121">A ogni tenant viene assegnata una chiave che lo identifica all'interno del catalogo. Ogni chiave è mappata alla posizione del database appropriato.</span><span class="sxs-lookup"><span data-stu-id="6519f-121">Each tenant is assigned a key that identifies them in the catalog and which is mapped to the location of the appropriate database.</span></span> <span data-ttu-id="6519f-122">Nell'app SaaS Wingtip la chiave viene creata partendo da un hash del nome del tenant.</span><span class="sxs-lookup"><span data-stu-id="6519f-122">In the Wingtip SaaS app, the key is formed from a hash of the tenant’s name.</span></span> <span data-ttu-id="6519f-123">Ciò consente di comporre la chiave usando la parte dell'URL dell'applicazione relativa al nome del tenant.</span><span class="sxs-lookup"><span data-stu-id="6519f-123">This allows the tenant name portion of the application URL to be used to construct the key.</span></span> <span data-ttu-id="6519f-124">Per la chiave del tenant è possibile usare anche altri schemi.</span><span class="sxs-lookup"><span data-stu-id="6519f-124">Other tenant key schemes could be used.</span></span>  

<span data-ttu-id="6519f-125">Il catalogo consente di modificare il nome o la posizione del database con un impatto minimo sull'applicazione.</span><span class="sxs-lookup"><span data-stu-id="6519f-125">The catalog allows the name or location of the database to be changed with minimal impact on the application.</span></span>  <span data-ttu-id="6519f-126">In un modello di database multi-tenant, ciò consente anche di "spostare" un tenant da un database a un altro.</span><span class="sxs-lookup"><span data-stu-id="6519f-126">In a multi-tenant database model, this also accommodates ‘moving’ a tenant between databases.</span></span>  <span data-ttu-id="6519f-127">Il catalogo può essere usato anche per indicare se un tenant o un database è offline per manutenzione o altre azioni.</span><span class="sxs-lookup"><span data-stu-id="6519f-127">The catalog can also be used to indicate whether a tenant or database is offline for maintenance or other actions.</span></span> <span data-ttu-id="6519f-128">Questo aspetto viene esaminato nell'[esercitazione relativa al ripristino di un tenant singolo](sql-database-saas-tutorial-restore-single-tenant.md).</span><span class="sxs-lookup"><span data-stu-id="6519f-128">This is explored in the [restore single tenant tutorial](sql-database-saas-tutorial-restore-single-tenant.md).</span></span>

<span data-ttu-id="6519f-129">Il catalogo, che in effetti è un database di gestione per un'applicazione SaaS, può anche archiviare metadati aggiuntivi di un tenant o di un database, ad esempio il livello o l'edizione del database, la versione dello schema, il piano di servizio o i contratti di servizio offerti ai tenant, oltre ad altre informazioni che consentono la gestione delle applicazioni, l'assistenza clienti o i processi DevOps.</span><span class="sxs-lookup"><span data-stu-id="6519f-129">In addition, the catalog, which is in effect a management database for a SaaS application, can store additional tenant or database metadata, such as the tier or edition of a database, schema version, service plan, or SLAs offered to tenants, and other info that enables application management, customer support, or devops processes.</span></span>  

<span data-ttu-id="6519f-130">Oltre all'applicazione SaaS, il catalogo può abilitare strumenti di database.</span><span class="sxs-lookup"><span data-stu-id="6519f-130">Beyond the SaaS application, the catalog can enable database tools.</span></span>  <span data-ttu-id="6519f-131">Nell'esempio SaaS Wingtip il catalogo viene usato per abilitare le query tra tenant, prese in esame nell'[esercitazione relativa all'analisi ad-hoc](sql-database-saas-tutorial-adhoc-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="6519f-131">In the Wingtip SaaS sample, the catalog is used to enable cross-tenant query, explored in the [ad hoc analytics tutorial](sql-database-saas-tutorial-adhoc-analytics.md).</span></span> <span data-ttu-id="6519f-132">La gestione dei processi tra database viene esaminata nelle esercitazioni relative alla [gestione dello schema](sql-database-saas-tutorial-schema-management.md) e all'[analisi del tenant](sql-database-saas-tutorial-tenant-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="6519f-132">Cross-database job management is explored in the [schema management](sql-database-saas-tutorial-schema-management.md) and [tenant analytics](sql-database-saas-tutorial-tenant-analytics.md) tutorials.</span></span> 

<span data-ttu-id="6519f-133">Nell'app SaaS Wingtip il catalogo viene implementato tramite le funzionalità di gestione delle partizioni della [libreria EDCL (Elastic Database Client Library, libreria client dei database elastici)](sql-database-elastic-database-client-library.md).</span><span class="sxs-lookup"><span data-stu-id="6519f-133">In the Wingtip SaaS app, the catalog is implemented using the Shard Management features of the [Elastic Database Client Library (EDCL)](sql-database-elastic-database-client-library.md).</span></span> <span data-ttu-id="6519f-134">La libreria EDCL consente a un'applicazione di creare, gestire e usare una mappa partizioni supportata da database.</span><span class="sxs-lookup"><span data-stu-id="6519f-134">The EDCL enables an application to create, manage, and use a database-backed shard map.</span></span> <span data-ttu-id="6519f-135">Una mappa partizioni contiene un elenco di partizioni (database) e il mapping tra le chiavi (tenant) e i database.</span><span class="sxs-lookup"><span data-stu-id="6519f-135">A shard map contains a list of shards (databases) and the mapping between keys (tenants) and databases.</span></span>  <span data-ttu-id="6519f-136">È possibile usare le funzioni della libreria EDCL da applicazioni o script di PowerShell durante il provisioning di tenant per creare le voci della mappa partizioni e da applicazioni per connettersi al database corretto in modo efficiente.</span><span class="sxs-lookup"><span data-stu-id="6519f-136">EDCL functions can be used from applications or PowerShell scripts during tenant provisioning to create the entries in the shard map, and from applications to efficiently connect to the correct database.</span></span> <span data-ttu-id="6519f-137">La libreria EDCL memorizza nella cache le informazioni di connessione per ridurre al minimo il traffico verso il database del catalogo e per velocizzare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="6519f-137">EDCL caches connection information to minimize the traffic to the catalog database and speed up the application.</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="6519f-138">I dati di mapping sono accessibili nel database del catalogo, ma *non modificarli*.</span><span class="sxs-lookup"><span data-stu-id="6519f-138">The mapping data is accessible in the catalog database, but *don't edit it*!</span></span> <span data-ttu-id="6519f-139">Modificare i dati di mapping solo tramite le API della libreria client dei database elastici.</span><span class="sxs-lookup"><span data-stu-id="6519f-139">Edit mapping data using Elastic Database Client Library APIs only.</span></span> <span data-ttu-id="6519f-140">La modifica diretta dei dati di mapping comporta il rischio di danneggiare il catalogo e non è supportata.</span><span class="sxs-lookup"><span data-stu-id="6519f-140">Directly manipulating the mapping data risks corrupting the catalog and is not supported.</span></span>


## <a name="introduction-to-the-saas-provisioning-pattern"></a><span data-ttu-id="6519f-141">Introduzione al modello di provisioning SaaS</span><span class="sxs-lookup"><span data-stu-id="6519f-141">Introduction to the SaaS Provisioning pattern</span></span>

<span data-ttu-id="6519f-142">Al momento del caricamento di un nuovo tenant in un'applicazione SaaS che usa un modello di database a tenant singolo, è necessario eseguire il provisioning di un nuovo database tenant.</span><span class="sxs-lookup"><span data-stu-id="6519f-142">When onboarding a new tenant in a SaaS application that uses a single-tenant database model a new tenant database must be provisioned.</span></span>  <span data-ttu-id="6519f-143">Questo deve essere creato nella posizione e nel livello di servizio appropriati, inizializzato con lo schema e i dati di riferimento corretti e quindi registrato nel catalogo sotto la chiave tenant appropriata.</span><span class="sxs-lookup"><span data-stu-id="6519f-143">It must be created in the appropriate location and service tier, initialized with appropriate schema and reference data, and then registered in the catalog under the appropriate tenant key.</span></span>  

<span data-ttu-id="6519f-144">Per il provisioning del database è possibile applicare approcci diversi, ad esempio l'esecuzione di script SQL, la distribuzione di un file BACPAC o la copia della versione finale di un database modello.</span><span class="sxs-lookup"><span data-stu-id="6519f-144">Different approaches can be used to database provisioning, which could include executing SQL scripts, deploying a bacpac, or copying a 'golden' template database.</span></span>  

<span data-ttu-id="6519f-145">L'approccio usato per il provisioning deve essere compreso nella strategia generale di gestione dello schema, che deve garantire che il provisioning di nuovi database venga effettuato con lo schema più recente.</span><span class="sxs-lookup"><span data-stu-id="6519f-145">The provisioning approach you use must be comprehended in your overall schema management strategy, which must ensure that new databases are provisioned with the latest schema.</span></span>  <span data-ttu-id="6519f-146">Questo aspetto viene esaminato nell'[esercitazione relativa alla gestione dello schema](sql-database-saas-tutorial-schema-management.md).</span><span class="sxs-lookup"><span data-stu-id="6519f-146">This is explored in the [schema management tutorial](sql-database-saas-tutorial-schema-management.md).</span></span>  

<span data-ttu-id="6519f-147">L'app SaaS Wingtip effettua il provisioning di nuovi tenant copiando la versione finale del database basetenantdb, distribuito nel server del catalogo.</span><span class="sxs-lookup"><span data-stu-id="6519f-147">The Wingtip SaaS app provisions new tenants by copying a golden database named basetenantdb, deployed on the catalog server.</span></span>  <span data-ttu-id="6519f-148">Il provisioning può essere integrato nell'applicazione nell'ambito dell'esperienza di iscrizione e/o può essere supportato offline tramite script.</span><span class="sxs-lookup"><span data-stu-id="6519f-148">Provisioning could be integrated into the application as part of a sign-up experience, and/or supported offline using scripts.</span></span> <span data-ttu-id="6519f-149">Questa esercitazione illustra il provisioning tramite PowerShell.</span><span class="sxs-lookup"><span data-stu-id="6519f-149">This tutorial will explore provisioning using PowerShell.</span></span> <span data-ttu-id="6519f-150">Gli script di provisioning copiano il database basetenantdb per creare un nuovo database tenant in un pool elastico, quindi lo inizializzano con informazioni specifiche del tenant e lo registrano nella mappa partizioni del catalogo.</span><span class="sxs-lookup"><span data-stu-id="6519f-150">The provisioning scripts copy the basetenantdb to create a new tenant database in an elastic pool, then initialize it with tenant-specific info and register it in the catalog shard map.</span></span>  <span data-ttu-id="6519f-151">Nell'app di esempio, ai database vengono assegnati nomi in base al nome del tenant, ma questo non è un aspetto essenziale del modello. L'uso del catalogo, infatti, consente di assegnare qualsiasi nome al database.+</span><span class="sxs-lookup"><span data-stu-id="6519f-151">In the sample app, databases are given names based on the tenant name, but this is not a critical part of the pattern – the use of the catalog allows any name to be assigned to the database.+</span></span> 


## <a name="get-the-wingtip-application-scripts"></a><span data-ttu-id="6519f-152">Ottenere gli script dell'applicazione Wingtip</span><span class="sxs-lookup"><span data-stu-id="6519f-152">Get the Wingtip application scripts</span></span>

<span data-ttu-id="6519f-153">Gli script dell'app SaaS Wingtip e il codice sorgente dell'applicazione sono disponibili nel repository GitHub [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS).</span><span class="sxs-lookup"><span data-stu-id="6519f-153">The Wingtip SaaS scripts and application source code are available in the [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="6519f-154">[Procedura per scaricare gli script dell'app SaaS Wingtip](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="6519f-154">[Steps to download the Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>


## <a name="provision-and-catalog-detailed-walkthrough"></a><span data-ttu-id="6519f-155">Procedura dettagliata per il provisioning e la catalogazione</span><span class="sxs-lookup"><span data-stu-id="6519f-155">Provision and catalog detailed walkthrough</span></span>

<span data-ttu-id="6519f-156">Per comprendere in che modo l'applicazione Wingtip implementa il nuovo provisioning di tenant, eseguire il provisioning di un tenant procedendo passo per passo attraverso il flusso di lavoro dopo aver aggiunto un punto di interruzione:</span><span class="sxs-lookup"><span data-stu-id="6519f-156">To understand how the Wingtip application implements new tenant provisioning, add a breakpoint and step through the workflow while provisioning a tenant:</span></span>

1. <span data-ttu-id="6519f-157">Aprire ...\\Learning Modules\\ProvisionAndCatalog\\_Demo-ProvisionAndCatalog.ps1_ e impostare i parametri seguenti:</span><span class="sxs-lookup"><span data-stu-id="6519f-157">Open ...\\Learning Modules\\ProvisionAndCatalog\\_Demo-ProvisionAndCatalog.ps1_ and set the following parameters:</span></span>
   * <span data-ttu-id="6519f-158">**$TenantName** = nome della nuova sede di eventi, ad esempio *Bushwillow Blues*.</span><span class="sxs-lookup"><span data-stu-id="6519f-158">**$TenantName** = the name of the new venue (for example, *Bushwillow Blues*).</span></span>
   * <span data-ttu-id="6519f-159">**$VenueType** = uno dei tipi di sede predefiniti: *blues*, classicalmusic, dance, jazz, judo, motorracing, multipurpose, opera, rockmusic, soccer.</span><span class="sxs-lookup"><span data-stu-id="6519f-159">**$VenueType** = one of the pre-defined venue types: *blues*, classicalmusic, dance, jazz, judo, motorracing, multipurpose, opera, rockmusic, soccer.</span></span>
   * <span data-ttu-id="6519f-160">**$DemoScenario** = **1**, impostare su **1** per *effettuare il provisioning di un singolo tenant*.</span><span class="sxs-lookup"><span data-stu-id="6519f-160">**$DemoScenario** = **1**, Set to **1** to *Provision a single tenant*.</span></span>

1. <span data-ttu-id="6519f-161">Aggiungere un punto di interruzione posizionando il cursore in un punto qualsiasi nella riga 48 contenente il testo: *New-Tenant \`* e premere **F9**.</span><span class="sxs-lookup"><span data-stu-id="6519f-161">Add a breakpoint by putting your cursor anywhere on line 48, the line that says: *New-Tenant \`*, and press **F9**.</span></span>

   ![punto di interruzione](media/sql-database-saas-tutorial-provision-and-catalog/breakpoint.png)

1. <span data-ttu-id="6519f-163">Premere **F5** per eseguire lo script.</span><span class="sxs-lookup"><span data-stu-id="6519f-163">To run the script press **F5**.</span></span>

1. <span data-ttu-id="6519f-164">Quando l'esecuzione dello script si arresta in corrispondenza del punto di interruzione, premere **F11** per eseguire l'istruzione del codice.</span><span class="sxs-lookup"><span data-stu-id="6519f-164">After the script execution stops at the breakpoint, press **F11** to step into the code.</span></span>

   ![punto di interruzione](media/sql-database-saas-tutorial-provision-and-catalog/debug.png)



<span data-ttu-id="6519f-166">Tenere traccia dell'esecuzione dello script usando le opzioni del menu **Debug** **F10** e **F11** per eseguire le istruzioni delle funzioni chiamate.</span><span class="sxs-lookup"><span data-stu-id="6519f-166">Trace the script's execution using the **Debug** menu options - **F10** and **F11** to step over or into the called functions.</span></span> <span data-ttu-id="6519f-167">Per altre informazioni sul debug degli script di PowerShell, vedere [Suggerimenti per l'utilizzo e il debug degli script di PowerShell](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span><span class="sxs-lookup"><span data-stu-id="6519f-167">For more information about debugging PowerShell scripts, see [Tips on working with and debugging PowerShell scripts](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span></span>


<span data-ttu-id="6519f-168">I seguenti non sono passaggi da usare esplicitamente, ma solo una spiegazione del flusso di lavoro seguito durante il debug dello script:</span><span class="sxs-lookup"><span data-stu-id="6519f-168">The following are not steps to explicitly follow, but an explanation of the workflow you step through while debugging the script:</span></span>

1. <span data-ttu-id="6519f-169">**Importazione del modulo SubscriptionManagement.psm1** che contiene funzioni per l'accesso ad Azure e la selezione della sottoscrizione di Azure da usare.</span><span class="sxs-lookup"><span data-stu-id="6519f-169">**Import the SubscriptionManagement.psm1** module that contains functions for signing in to Azure and selecting the Azure subscription you are working with.</span></span>
1. <span data-ttu-id="6519f-170">**Importazione del modulo CatalogAndDatabaseManagement.psm1** che fornisce un catalogo e l'astrazione a livello di tenant per le funzioni di [gestione delle partizioni](sql-database-elastic-scale-shard-map-management.md).</span><span class="sxs-lookup"><span data-stu-id="6519f-170">**Import the CatalogAndDatabaseManagement.psm1** module that provides a catalog and tenant-level abstraction over the [Shard Management](sql-database-elastic-scale-shard-map-management.md) functions.</span></span> <span data-ttu-id="6519f-171">Questo è un modulo importante che incapsula gran parte del modello di catalogazione e vale la pena esplorare.</span><span class="sxs-lookup"><span data-stu-id="6519f-171">This is an important module that encapsulates much of the catalog pattern and is worth exploring.</span></span>
1. <span data-ttu-id="6519f-172">**Recupero dei dettagli di configurazione**.</span><span class="sxs-lookup"><span data-stu-id="6519f-172">**Get configuration details**.</span></span> <span data-ttu-id="6519f-173">Eseguire l'istruzione Get-Configuration (con F11) e vedere come viene specificata la configurazione dell'app.</span><span class="sxs-lookup"><span data-stu-id="6519f-173">Step into Get-Configuration (with F11) and see how the app config is specified.</span></span> <span data-ttu-id="6519f-174">In questa posizione sono definiti i nomi delle risorse e altri valori specifici dell'app, ma non modificare questi valori fino a quando non si ha familiarità con gli script.</span><span class="sxs-lookup"><span data-stu-id="6519f-174">Resource names and other app-specific values are defined here, but do not change any of these values until you are familiar with the scripts.</span></span>
1. <span data-ttu-id="6519f-175">**Recupero dell'oggetto catalogo**.</span><span class="sxs-lookup"><span data-stu-id="6519f-175">**Get the catalog object**.</span></span> <span data-ttu-id="6519f-176">Eseguire l'istruzione Get-Catalog, che compone e restituisce l'oggetto catalogo usato nello script di livello superiore.</span><span class="sxs-lookup"><span data-stu-id="6519f-176">Step into Get-Catalog which composes and returns a catalog object that is used in the higher-level script.</span></span>  <span data-ttu-id="6519f-177">Questa funzione usa funzioni di gestione di partizioni importate da **AzureShardManagement.psm1**.</span><span class="sxs-lookup"><span data-stu-id="6519f-177">This function uses Shard Management functions that are imported from **AzureShardManagement.psm1**.</span></span> <span data-ttu-id="6519f-178">L'oggetto catalogo è composto da quanto segue:</span><span class="sxs-lookup"><span data-stu-id="6519f-178">The catalog object is composed of the following:</span></span>
   * <span data-ttu-id="6519f-179">$catalogServerFullyQualifiedName viene costruito usando l'origine standard e il nome utente: _catalog-\<utente\>.database.windows.net_.</span><span class="sxs-lookup"><span data-stu-id="6519f-179">$catalogServerFullyQualifiedName is constructed using the standard stem plus your User name: _catalog-\<user\>.database.windows.net_.</span></span>
   * <span data-ttu-id="6519f-180">Il valore $catalogDatabaseName viene recuperato dalla configurazione: *tenantcatalog*.</span><span class="sxs-lookup"><span data-stu-id="6519f-180">$catalogDatabaseName is retrieved from the config: *tenantcatalog*.</span></span>
   * <span data-ttu-id="6519f-181">L'oggetto $shardMapManager viene inizializzato dal database del catalogo.</span><span class="sxs-lookup"><span data-stu-id="6519f-181">$shardMapManager object is initialized from the catalog database.</span></span>
   * <span data-ttu-id="6519f-182">L'oggetto $shardMap viene inizializzato dalla mappa partizioni *tenantcatalog* nel database del catalogo.</span><span class="sxs-lookup"><span data-stu-id="6519f-182">$shardMap object is initialized from the *tenantcatalog* shard map in the catalog database.</span></span>
   <span data-ttu-id="6519f-183">Viene composto e restituito un oggetto catalogo, usato nello script di livello superiore.</span><span class="sxs-lookup"><span data-stu-id="6519f-183">A catalog object is composed and returned, and used in the higher-level script.</span></span>
1. <span data-ttu-id="6519f-184">**Calcolo della chiave per il nuovo tenant**.</span><span class="sxs-lookup"><span data-stu-id="6519f-184">**Calculate the new tenant key**.</span></span> <span data-ttu-id="6519f-185">Viene usata una funzione hash per creare la chiave del tenant dal nome del tenant.</span><span class="sxs-lookup"><span data-stu-id="6519f-185">A hash function is used to create the tenant key from the tenant name.</span></span>
1. <span data-ttu-id="6519f-186">**Controllo dell'esistenza della chiave del tenant**.</span><span class="sxs-lookup"><span data-stu-id="6519f-186">**Check if the tenant key already exists**.</span></span> <span data-ttu-id="6519f-187">Il catalogo viene controllato per verificare che la chiave sia disponibile.</span><span class="sxs-lookup"><span data-stu-id="6519f-187">The catalog is checked to ensure the key is available.</span></span>
1. <span data-ttu-id="6519f-188">**Provisioning del database tenant con New-TenantDatabase.**</span><span class="sxs-lookup"><span data-stu-id="6519f-188">**The tenant database is provisioned with New-TenantDatabase.**</span></span> <span data-ttu-id="6519f-189">Usare **F11** per eseguire le singole istruzioni e vedere come viene effettuato il provisioning del database con un [modello di Azure Resource Manager](../azure-resource-manager/resource-manager-template-walkthrough.md).</span><span class="sxs-lookup"><span data-stu-id="6519f-189">Use **F11** to step in and see how the database is provisioned using an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md).</span></span>

<span data-ttu-id="6519f-190">Il nome del database viene costruito dal nome del tenant, in modo che sia chiaro quale partizione appartiene a quale tenant.</span><span class="sxs-lookup"><span data-stu-id="6519f-190">The database name is constructed from the tenant name to make it clear which shard belongs to which tenant.</span></span> <span data-ttu-id="6519f-191">È possibile usare tranquillamente altre strategie per la denominazione dei database.+Viene usato un modello di Resource Manager per creare un database tenant copiando un database di riferimento (basetenantdb) nel server del catalogo.</span><span class="sxs-lookup"><span data-stu-id="6519f-191">(Other strategies for database naming could easily be used.)+ A Resource Manager template is used to create a tenant database by copying a golden database (baseTenantDB) on the catalog server.</span></span> <span data-ttu-id="6519f-192">Un approccio alternativo è costituito dalla creazione di un database vuoto, con la successiva inizializzazione tramite importazione di un file BACPAC, o dall'esecuzione di uno script di inizializzazione da una posizione nota.</span><span class="sxs-lookup"><span data-stu-id="6519f-192">An alternative approach could be to create an empty database and then initialize it by importing a bacpac, or to execute an initialization script from a well-known location.</span></span>  

<span data-ttu-id="6519f-193">Il modello di Resource Manager è disponibile nella cartella …\Learning Modules\Common: *tenantdatabasecopytemplate.json*</span><span class="sxs-lookup"><span data-stu-id="6519f-193">The Resource Manager template is in the …\Learning Modules\Common\ folder: *tenantdatabasecopytemplate.json*</span></span>

<span data-ttu-id="6519f-194">Dopo la creazione, il database tenant viene **inizializzato con il nome e il tipo della sede di eventi (tenant)**.</span><span class="sxs-lookup"><span data-stu-id="6519f-194">After the tenant database is created, it is then further **initialized with the venue (tenant) name and the venue type**.</span></span> <span data-ttu-id="6519f-195">In questa posizione è possibile eseguire anche altre inizializzazioni.</span><span class="sxs-lookup"><span data-stu-id="6519f-195">Other initialization could also be done here.</span></span>

<span data-ttu-id="6519f-196">Il **database tenant viene registrato nel catalogo** con *Add-TenantDatabaseToCatalog* usando la chiave del tenant.</span><span class="sxs-lookup"><span data-stu-id="6519f-196">The **tenant database is registered in the catalog** with *Add-TenantDatabaseToCatalog* using the tenant key.</span></span> <span data-ttu-id="6519f-197">Usare **F11** per esaminare i dettagli:</span><span class="sxs-lookup"><span data-stu-id="6519f-197">Use **F11** to step into the details:</span></span>

* <span data-ttu-id="6519f-198">Il database del catalogo viene aggiunto alla mappa partizioni (elenco dei database noti).</span><span class="sxs-lookup"><span data-stu-id="6519f-198">The catalog database is added to the shard map (the list of known databases).</span></span>
* <span data-ttu-id="6519f-199">Viene creato il mapping che collega il valore della chiave alla partizione.</span><span class="sxs-lookup"><span data-stu-id="6519f-199">The mapping that links the key value to the shard is created.</span></span>
* <span data-ttu-id="6519f-200">Altri metadati per il tenant (nome della sede) vengono aggiunti alla tabella Tenants nel catalogo.</span><span class="sxs-lookup"><span data-stu-id="6519f-200">Additional meta data (the venue's name) about the tenant is added to the Tenants table in the catalog.</span></span>  <span data-ttu-id="6519f-201">La tabella Tenants non fa parte dello schema ShardManagement e non viene installata dalla libreria EDCL.</span><span class="sxs-lookup"><span data-stu-id="6519f-201">The Tenants table is not part of the ShardManagement schema and is not installed by the EDCL.</span></span>  <span data-ttu-id="6519f-202">Questa tabella illustra in che modo è possibile estendere il database del catalogo perché sia in grado di supportare dati aggiuntivi specifici dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="6519f-202">This table illustrates how the Catalog database can be extended to support additional application-specific data.</span></span>   


<span data-ttu-id="6519f-203">Dopo aver completato il provisioning, l'esecuzione torna allo script originale *Demo-ProvisionAndCatalog*, che apre nel browser la pagina degli **eventi** per il nuovo tenant:</span><span class="sxs-lookup"><span data-stu-id="6519f-203">After provisioning completes, execution returns to the original *Demo-ProvisionAndCatalog* script, which opens the **Events** page for the new tenant in the browser:</span></span>

   ![eventi](media/sql-database-saas-tutorial-provision-and-catalog/new-tenant.png)


## <a name="provision-a-batch-of-tenants"></a><span data-ttu-id="6519f-205">Eseguire il provisioning di un batch di tenant</span><span class="sxs-lookup"><span data-stu-id="6519f-205">Provision a batch of tenants</span></span>

<span data-ttu-id="6519f-206">Questo esercizio descrive come effettuare il provisioning di un batch di 17 tenant.</span><span class="sxs-lookup"><span data-stu-id="6519f-206">This exercise provisions a batch of 17 tenants.</span></span> <span data-ttu-id="6519f-207">È consigliabile eseguire il provisioning di questo batch di tenant prima di iniziare le altre esercitazioni su SaaS Wingtip, in modo da avere più database da usare.</span><span class="sxs-lookup"><span data-stu-id="6519f-207">It’s recommended you provision this batch of tenants before starting other Wingtip SaaS tutorials, so there's more than just a few databases to work with.</span></span>

1. <span data-ttu-id="6519f-208">Aprire ...\\Learning Modules\\ProvisionAndCatalog\\*Demo-ProvisionAndCatalog.ps1* in *PowerShell ISE* e impostare il parametro *$DemoScenario* su 3:</span><span class="sxs-lookup"><span data-stu-id="6519f-208">Open ...\\Learning Modules\\ProvisionAndCatalog\\*Demo-ProvisionAndCatalog.ps1* in the *PowerShell ISE* and change the *$DemoScenario* parameter to 3:</span></span>
   * <span data-ttu-id="6519f-209">**$DemoScenario** = **3**, impostare su **3** per *effettuare il provisioning di un batch di tenant*.</span><span class="sxs-lookup"><span data-stu-id="6519f-209">**$DemoScenario** = **3**, change to **3** to *Provision a batch of tenants*.</span></span>
1. <span data-ttu-id="6519f-210">Premere **F5** ed eseguire lo script.</span><span class="sxs-lookup"><span data-stu-id="6519f-210">Press **F5** and run the script.</span></span>

<span data-ttu-id="6519f-211">Lo script distribuisce un batch di altri tenant</span><span class="sxs-lookup"><span data-stu-id="6519f-211">The script deploys a batch of additional tenants.</span></span> <span data-ttu-id="6519f-212">e usa [modello di Azure Resource Manager](../azure-resource-manager/resource-manager-template-walkthrough.md) che controlla il batch, quindi delega il provisioning di ogni database a un modello collegato.</span><span class="sxs-lookup"><span data-stu-id="6519f-212">It uses an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md) that controls the batch and then delegates provisioning of each database to a linked template.</span></span> <span data-ttu-id="6519f-213">L'uso dei modelli in questo modo consente ad Azure Resource Manager di gestire il processo di provisioning per lo script.</span><span class="sxs-lookup"><span data-stu-id="6519f-213">Using templates in this way allows Azure Resource Manager to broker the provisioning process for your script.</span></span> <span data-ttu-id="6519f-214">I modelli effettuano il provisioning dei database in parallelo, quando possibile, e gestiscono la ripetizione dei tentativi se necessario, ottimizzando il processo nel suo complesso.</span><span class="sxs-lookup"><span data-stu-id="6519f-214">Templates provision databases in parallel where it can, and handles retries if needed, optimizing the overall process.</span></span> <span data-ttu-id="6519f-215">Lo script è idempotent, pertanto, se non riesce o si interrompe per qualsiasi motivo, eseguirlo nuovamente.</span><span class="sxs-lookup"><span data-stu-id="6519f-215">The script is idempotent so if it fails or stops for any reason, run it again.</span></span>

### <a name="verify-the-batch-of-tenants-successfully-deployed"></a><span data-ttu-id="6519f-216">Verificare la corretta distribuzione del batch di tenant</span><span class="sxs-lookup"><span data-stu-id="6519f-216">Verify the batch of tenants successfully deployed</span></span>

* <span data-ttu-id="6519f-217">Aprire il server *tenants1* passando all'elenco dei server nel [portale di Azure](https://portal.azure.com), fare clic su **database SQL** e verificare che il batch di 17 database aggiuntivi sia ora nell'elenco:</span><span class="sxs-lookup"><span data-stu-id="6519f-217">Open the *tenants1* server by browsing to your list of servers in the [Azure portal](https://portal.azure.com), click **SQL databases**, and verify the batch of 17 additional databases are now in the list:</span></span>

   ![elenco di database](media/sql-database-saas-tutorial-provision-and-catalog/database-list.png)



## <a name="other-provisioning-patterns"></a><span data-ttu-id="6519f-219">Altri modelli di provisioning</span><span class="sxs-lookup"><span data-stu-id="6519f-219">Other provisioning patterns</span></span>

<span data-ttu-id="6519f-220">Gli altri modelli di provisioning non inclusi in questa esercitazione includono:</span><span class="sxs-lookup"><span data-stu-id="6519f-220">Other provisioning patterns not included in this tutorial include:</span></span>

<span data-ttu-id="6519f-221">**Pre-provisioning di database.**</span><span class="sxs-lookup"><span data-stu-id="6519f-221">**Pre-provisioning databases.**</span></span> <span data-ttu-id="6519f-222">Il modello di pre-provisioning sfrutta il fatto che i database in un pool elastico non hanno costi aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="6519f-222">The pre-provisioning pattern exploits the fact that databases in an elastic pool do not add extra cost.</span></span> <span data-ttu-id="6519f-223">La fatturazione si basa sul pool elastico, non sui database e i database inattivi non consumano risorse.</span><span class="sxs-lookup"><span data-stu-id="6519f-223">Billing is for the elastic pool, not the databases, and idle databases consume no resources.</span></span> <span data-ttu-id="6519f-224">Effettuando il pre-provisioning dei database in un pool e allocandoli poi all'occorrenza, il tempo di caricamento dei tenant può essere ridotto significativamente.</span><span class="sxs-lookup"><span data-stu-id="6519f-224">By pre-provisioning databases in a pool and allocating them when needed, tenant onboarding time can be reduced significantly.</span></span> <span data-ttu-id="6519f-225">Il numero di database di cui viene effettuato il pre-provisioning può essere modificato in base alle esigenze, per ottenere un buffer adatto alla frequenza di provisioning prevista.</span><span class="sxs-lookup"><span data-stu-id="6519f-225">The number of databases pre-provisioned could be adjusted as needed to keep a buffer suitable for the anticipated provisioning rate.</span></span>

<span data-ttu-id="6519f-226">**Provisioning automatico.**</span><span class="sxs-lookup"><span data-stu-id="6519f-226">**Auto-provisioning.**</span></span> <span data-ttu-id="6519f-227">In questo modello viene usato un servizio di provisioning dedicato per eseguire il provisioning di server, pool e database automaticamente in base alle esigenze, incluso il pre-provisioning di database in pool elastici se lo si desidera.</span><span class="sxs-lookup"><span data-stu-id="6519f-227">In the auto-provisioning pattern, a dedicated provisioning service is used to provision servers, pools, and databases automatically as needed – including pre-provisioning databases in elastic pools if desired.</span></span> <span data-ttu-id="6519f-228">In caso di ritiro ed eliminazione di database, inoltre, i vuoti nei pool elastici possono essere riempiti dal servizio di provisioning in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="6519f-228">And if databases are de-commissioned and deleted, gaps in elastic pools can be filled by the provisioning service as desired.</span></span> <span data-ttu-id="6519f-229">Un servizio di questo tipo può essere semplice o complesso, come nel caso della gestione del provisioning in più aree geografiche, e può includere la configurazione automatica della replica geografica se si usa tale strategia per il ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="6519f-229">Such a service could be simple or complex – for example, handling provisioning across multiple geographies, and could set up geo-replication automatically if that strategy is being used for disaster recovery.</span></span> <span data-ttu-id="6519f-230">Con il modello di provisioning automatico, un'applicazione client o uno script invia una richiesta di provisioning a una coda per l'elaborazione da parte del servizio di provisioning e quindi effettuerà il polling del servizio per stabilire quando viene completata l'operazione.</span><span class="sxs-lookup"><span data-stu-id="6519f-230">With the auto-provisioning pattern, a client application or script would submit a provisioning request to a queue to be processed by the provisioning service, and would then poll the service to determine completion.</span></span> <span data-ttu-id="6519f-231">Se si usa il pre-provisioning, le richieste vengono gestite rapidamente ed è il servizio a gestire il provisioning di un database sostitutivo in background.</span><span class="sxs-lookup"><span data-stu-id="6519f-231">If pre-provisioning is used, requests would be handled quickly with the service managing provisioning of a replacement database running in the background.</span></span>



## <a name="next-steps"></a><span data-ttu-id="6519f-232">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="6519f-232">Next steps</span></span>

<span data-ttu-id="6519f-233">In questa esercitazione si è appreso come:</span><span class="sxs-lookup"><span data-stu-id="6519f-233">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="6519f-234">Effettuare il provisioning di un nuovo tenant singolo</span><span class="sxs-lookup"><span data-stu-id="6519f-234">Provision a single new tenant</span></span>
> * <span data-ttu-id="6519f-235">Effettuare il provisioning di un batch di altri tenant</span><span class="sxs-lookup"><span data-stu-id="6519f-235">Provision a batch of additional tenants</span></span>
> * <span data-ttu-id="6519f-236">Eseguire in dettaglio le procedure per il provisioning dei tenant e la relativa registrazione nel catalogo</span><span class="sxs-lookup"><span data-stu-id="6519f-236">Step into the details of provisioning tenants, and registering them into the catalog</span></span>

<span data-ttu-id="6519f-237">Provare l'[Esercitazione sul monitoraggio delle prestazioni](sql-database-saas-tutorial-performance-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="6519f-237">Try the [Performance monitoring tutorial](sql-database-saas-tutorial-performance-monitoring.md).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="6519f-238">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="6519f-238">Additional Resources</span></span>

* <span data-ttu-id="6519f-239">Altre [esercitazioni basate sull'applicazione SaaS Wingtip](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="6519f-239">Additional [tutorials that build upon the Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="6519f-240">Libreria client dei database elastici</span><span class="sxs-lookup"><span data-stu-id="6519f-240">Elastic database client library</span></span>](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-database-client-library)
* [<span data-ttu-id="6519f-241">Modalità di esecuzione del debug degli script in Windows PowerShell ISE</span><span class="sxs-lookup"><span data-stu-id="6519f-241">How to Debug Scripts in Windows PowerShell ISE</span></span>](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise)
