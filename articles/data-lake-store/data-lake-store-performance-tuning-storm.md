---
title: Linee guida per l'ottimizzazione delle prestazioni di Storm in Azure Data Lake Store | Microsoft Docs
description: Linee guida per l'ottimizzazione delle prestazioni di Storm in Azure Data Lake Store
services: data-lake-store
documentationcenter: 
author: stewu
manager: amitkul
editor: stewu
ms.assetid: ebde7b9f-2e51-4d43-b7ab-566417221335
ms.service: data-lake-store
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 12/19/2016
ms.author: stewu
ms.openlocfilehash: 1dfa93643f45a96ded3fd022aa8b1c71d487acb4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="performance-tuning-guidance-for-storm-on-hdinsight-and-azure-data-lake-store"></a><span data-ttu-id="94812-103">Linee guida per l'ottimizzazione delle prestazioni di Storm in HDInsight e di Azure Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="94812-103">Performance tuning guidance for Storm on HDInsight and Azure Data Lake Store</span></span>

<span data-ttu-id="94812-104">È opportuno conoscere i fattori da tenere in considerazione quando si ottimizzano le prestazioni di una topologia di Storm in Azure.</span><span class="sxs-lookup"><span data-stu-id="94812-104">Understand the factors that should be considered when you tune the performance of an Azure Storm topology.</span></span> <span data-ttu-id="94812-105">È importante, ad esempio, comprendere le caratteristiche del lavoro svolto da spout e bolt (se il lavoro è I/O o usa intensivamente la memoria).</span><span class="sxs-lookup"><span data-stu-id="94812-105">For example, it's important to understand the characteristics of the work done by the spouts and the bolts (whether the work is I/O or memory intensive).</span></span> <span data-ttu-id="94812-106">Questo articolo illustra una serie di linee guida per l'ottimizzazione delle prestazioni, inclusa la risoluzione dei problemi comuni.</span><span class="sxs-lookup"><span data-stu-id="94812-106">This article covers a range of performance tuning guidelines, including troubleshooting common issues.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="94812-107">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="94812-107">Prerequisites</span></span>

* <span data-ttu-id="94812-108">**Una sottoscrizione di Azure**.</span><span class="sxs-lookup"><span data-stu-id="94812-108">**An Azure subscription**.</span></span> <span data-ttu-id="94812-109">Vedere [Ottenere una versione di valutazione gratuita di Azure](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="94812-109">See [Get Azure free trial](https://azure.microsoft.com/pricing/free-trial/).</span></span>
* <span data-ttu-id="94812-110">**Un account di Archivio Data Lake di Azure**.</span><span class="sxs-lookup"><span data-stu-id="94812-110">**An Azure Data Lake Store account**.</span></span> <span data-ttu-id="94812-111">Per istruzioni su come crearne uno, vedere [Introduzione ad Azure Data Lake Store](data-lake-store-get-started-portal.md).</span><span class="sxs-lookup"><span data-stu-id="94812-111">For instructions on how to create one, see [Get started with Azure Data Lake Store](data-lake-store-get-started-portal.md).</span></span>
* <span data-ttu-id="94812-112">**Un cluster Azure HDInsight** con accesso a un account di Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="94812-112">**An Azure HDInsight cluster** with access to a Data Lake Store account.</span></span> <span data-ttu-id="94812-113">Vedere [Creare un cluster HDInsight con Data Lake Store tramite il portale di Azure](data-lake-store-hdinsight-hadoop-use-portal.md).</span><span class="sxs-lookup"><span data-stu-id="94812-113">See [Create an HDInsight cluster with Data Lake Store](data-lake-store-hdinsight-hadoop-use-portal.md).</span></span> <span data-ttu-id="94812-114">Assicurarsi di abilitare il Desktop remoto per il cluster.</span><span class="sxs-lookup"><span data-stu-id="94812-114">Make sure you enable Remote Desktop for the cluster.</span></span>
* <span data-ttu-id="94812-115">**Esecuzione di un cluster Storm in Data Lake Store**.</span><span class="sxs-lookup"><span data-stu-id="94812-115">**Running a Storm cluster on Data Lake Store**.</span></span> <span data-ttu-id="94812-116">Per altre informazioni, vedere [Storm in HDInsight](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-storm-overview).</span><span class="sxs-lookup"><span data-stu-id="94812-116">For more information, see [Storm on HDInsight](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-storm-overview).</span></span>
* <span data-ttu-id="94812-117">**Linee guida per l'ottimizzazione delle prestazioni in Data Lake Store**.</span><span class="sxs-lookup"><span data-stu-id="94812-117">**Performance tuning guidelines on Data Lake Store**.</span></span>  <span data-ttu-id="94812-118">Per i concetti generali relativi alle prestazioni, vedere [Linee guida per l'ottimizzazione delle prestazioni in Data Lake Store](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance).</span><span class="sxs-lookup"><span data-stu-id="94812-118">For general performance concepts, see [Data Lake Store Performance Tuning Guidance](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance).</span></span>  

## <a name="tune-the-parallelism-of-the-topology"></a><span data-ttu-id="94812-119">Ottimizzare il parallelismo della topologia</span><span class="sxs-lookup"><span data-stu-id="94812-119">Tune the parallelism of the topology</span></span>

<span data-ttu-id="94812-120">È possibile migliorare le prestazioni aumentando la concorrenza di I/O o da e verso Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="94812-120">You might be able to improve performance by increasing the concurrency of the I/O to and from Data Lake Store.</span></span> <span data-ttu-id="94812-121">Una topologia Storm consiste in un set di configurazioni che determinano il parallelismo:</span><span class="sxs-lookup"><span data-stu-id="94812-121">A Storm topology has a set of configurations that determine the parallelism:</span></span>
* <span data-ttu-id="94812-122">Numero di processi di lavoro (i ruoli di lavoro sono distribuiti uniformemente tra le macchine virtuali).</span><span class="sxs-lookup"><span data-stu-id="94812-122">Number of worker processes (the workers are evenly distributed across the VMs).</span></span>
* <span data-ttu-id="94812-123">Numero di istanze di executor di spout.</span><span class="sxs-lookup"><span data-stu-id="94812-123">Number of spout executor instances.</span></span>
* <span data-ttu-id="94812-124">Numero di istanze di executor di bolt.</span><span class="sxs-lookup"><span data-stu-id="94812-124">Number of bolt executor instances.</span></span>
* <span data-ttu-id="94812-125">Numero di attività spout.</span><span class="sxs-lookup"><span data-stu-id="94812-125">Number of spout tasks.</span></span>
* <span data-ttu-id="94812-126">Numero di attività bolt.</span><span class="sxs-lookup"><span data-stu-id="94812-126">Number of bolt tasks.</span></span>

<span data-ttu-id="94812-127">Ad esempio, in un cluster con 4 macchine virtuali e 4 processi di lavoro, 32 executor di spout e 32 attività spout e 256 executor di bolt e 512 attività bolt, tenere presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="94812-127">For example, on a cluster with 4 VMs and 4 worker processes, 32 spout executors and 32 spout tasks, and 256 bolt executors and 512 bolt tasks, consider the following:</span></span>

<span data-ttu-id="94812-128">Ogni supervisore, che è un ruolo di lavoro, ha un singolo processo di lavoro JVM (Java Virtual Machine).</span><span class="sxs-lookup"><span data-stu-id="94812-128">Each supervisor, which is a worker node, has a single worker Java virtual machine (JVM) process.</span></span> <span data-ttu-id="94812-129">Questo processo JVM gestisce 4 thread di spout e 64 thread di bolt.</span><span class="sxs-lookup"><span data-stu-id="94812-129">This JVM process manages 4 spout threads and 64 bolt threads.</span></span> <span data-ttu-id="94812-130">In ogni thread le attività vengono eseguite in sequenza.</span><span class="sxs-lookup"><span data-stu-id="94812-130">Within each thread, tasks are run sequentially.</span></span> <span data-ttu-id="94812-131">Con la configurazione precedente, ogni thread di spout ha 1 attività e ogni thread di bolt ha 2 attività.</span><span class="sxs-lookup"><span data-stu-id="94812-131">With the preceding configuration, each spout thread has 1 task, and each bolt thread has 2 tasks.</span></span>

<span data-ttu-id="94812-132">Ecco i vari componenti coinvolti in Storm e il relativo effetto sul livello di parallelismo:</span><span class="sxs-lookup"><span data-stu-id="94812-132">In Storm, here are the various components involved, and how they affect the level of parallelism you have:</span></span>
* <span data-ttu-id="94812-133">Il nodo head (denominato Nimbus in Storm) viene usato per inviare e gestire i processi.</span><span class="sxs-lookup"><span data-stu-id="94812-133">The head node (called Nimbus in Storm) is used to submit and manage jobs.</span></span> <span data-ttu-id="94812-134">Questi nodi non hanno alcun impatto sul livello di parallelismo.</span><span class="sxs-lookup"><span data-stu-id="94812-134">These nodes have no impact on the degree of parallelism.</span></span>
* <span data-ttu-id="94812-135">I nodi supervisore.</span><span class="sxs-lookup"><span data-stu-id="94812-135">The supervisor nodes.</span></span> <span data-ttu-id="94812-136">In HDInsight corrispondono a una macchina virtuale di Azure con nodo di lavoro.</span><span class="sxs-lookup"><span data-stu-id="94812-136">In HDInsight, this corresponds to a worker node Azure VM.</span></span>
* <span data-ttu-id="94812-137">Le attività di lavoro sono processi di Storm in esecuzione sulle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="94812-137">The worker tasks are Storm processes running in the VMs.</span></span> <span data-ttu-id="94812-138">Ogni attività di lavoro corrisponde a un'istanza JVM.</span><span class="sxs-lookup"><span data-stu-id="94812-138">Each worker task corresponds to a JVM instance.</span></span> <span data-ttu-id="94812-139">Storm distribuisce il numero di processi di lavoro che vengono specificati ai nodi di lavoro nel modo più uniforme possibile.</span><span class="sxs-lookup"><span data-stu-id="94812-139">Storm distributes the number of worker processes you specify to the worker nodes as evenly as possible.</span></span>
* <span data-ttu-id="94812-140">Istanze di executor di spout e bolt.</span><span class="sxs-lookup"><span data-stu-id="94812-140">Spout and bolt executor instances.</span></span> <span data-ttu-id="94812-141">Ogni istanza dell'executor corrisponde a un thread in esecuzione nei ruoli di lavoro (JVM).</span><span class="sxs-lookup"><span data-stu-id="94812-141">Each executor instance corresponds to a thread running within the workers (JVMs).</span></span>
* <span data-ttu-id="94812-142">Attività di Storm.</span><span class="sxs-lookup"><span data-stu-id="94812-142">Storm tasks.</span></span> <span data-ttu-id="94812-143">Si tratta di attività logiche eseguite da ognuno di questi thread.</span><span class="sxs-lookup"><span data-stu-id="94812-143">These are logical tasks that each of these threads run.</span></span> <span data-ttu-id="94812-144">Ciò non modifica il livello di parallelismo, pertanto è necessario valutare se è opportuno disporre di più attività per ogni executor.</span><span class="sxs-lookup"><span data-stu-id="94812-144">This does not change the level of parallelism, so you should evaluate if you need multiple tasks per executor or not.</span></span>

### <a name="get-the-best-performance-from-data-lake-store"></a><span data-ttu-id="94812-145">Ottenere prestazioni ottimali da Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="94812-145">Get the best performance from Data Lake Store</span></span>

<span data-ttu-id="94812-146">Quando si lavora con Data Lake Store, è possibile ottenere prestazioni ottimali procedendo come segue:</span><span class="sxs-lookup"><span data-stu-id="94812-146">When working with Data Lake Store, you get the best performance if you do the following:</span></span>
* <span data-ttu-id="94812-147">Unire le piccole aggiunte in dimensioni maggiori (idealmente 4 MB).</span><span class="sxs-lookup"><span data-stu-id="94812-147">Coalesce your small appends into larger sizes (ideally 4 MB).</span></span>
* <span data-ttu-id="94812-148">Eseguire il maggior numero possibile di richieste simultanee.</span><span class="sxs-lookup"><span data-stu-id="94812-148">Do as many concurrent requests as you can.</span></span> <span data-ttu-id="94812-149">Poiché ogni thread di bolt esegue il blocco delle letture, è opportuno avere un punto compreso nell'intervallo tra 8 e 12 thread per core.</span><span class="sxs-lookup"><span data-stu-id="94812-149">Because each bolt thread is doing blocking reads, you want to have somewhere in the range of 8-12 threads per core.</span></span> <span data-ttu-id="94812-150">Questo favorisce un buon utilizzo della scheda di interfaccia di rete e della CPU.</span><span class="sxs-lookup"><span data-stu-id="94812-150">This keeps the NIC and the CPU well utilized.</span></span> <span data-ttu-id="94812-151">Una macchina virtuale più grande consente di eseguire un maggior numero di richieste simultanee.</span><span class="sxs-lookup"><span data-stu-id="94812-151">A larger VM enables more concurrent requests.</span></span>  

### <a name="example-topology"></a><span data-ttu-id="94812-152">Topologia di esempio</span><span class="sxs-lookup"><span data-stu-id="94812-152">Example topology</span></span>

<span data-ttu-id="94812-153">Si supponga di avere un cluster con 8 nodi di lavoro e una macchina virtuale di Azure D13v2.</span><span class="sxs-lookup"><span data-stu-id="94812-153">Let’s assume you have an 8 worker node cluster with a D13v2 Azure VM.</span></span> <span data-ttu-id="94812-154">Questa macchina virtuale ha 8 core, quindi negli 8 nodi di lavoro il totale è di 64 core.</span><span class="sxs-lookup"><span data-stu-id="94812-154">This VM has 8 cores, so among the 8 worker nodes, you have 64 total cores.</span></span>

<span data-ttu-id="94812-155">Si supponga di eseguire 8 thread bolt per core.</span><span class="sxs-lookup"><span data-stu-id="94812-155">Let’s say we do 8 bolt threads per core.</span></span> <span data-ttu-id="94812-156">Essendo i core 64, si vuole un totale di 512 istanze dell'executor (ovvero di thread) di bolt.</span><span class="sxs-lookup"><span data-stu-id="94812-156">Given 64 cores, that means we want 512 total bolt executor instances (that is, threads).</span></span> <span data-ttu-id="94812-157">In questo caso, si inizia con una JVM per ogni macchina virtuale e si usa principalmente la concorrenza tra thread nella JVM per ottenere una concorrenza.</span><span class="sxs-lookup"><span data-stu-id="94812-157">In this case, let’s say we start with one JVM per VM, and mainly use the thread concurrency within the JVM to achieve concurrency.</span></span> <span data-ttu-id="94812-158">Ciò significa che sono necessari 8 attività di lavoro (uno per ogni macchina virtuale di Azure) e 512 executor bolt.</span><span class="sxs-lookup"><span data-stu-id="94812-158">That means we need 8 worker tasks (one per Azure VM), and 512 bolt executors.</span></span> <span data-ttu-id="94812-159">Data questa configurazione, Storm prova a distribuire i ruoli di lavoro in modo uniforme tra i nodi di lavoro (chiamati anche nodi supervisore), assegnando a ogni nodo di lavoro 1 JVM.</span><span class="sxs-lookup"><span data-stu-id="94812-159">Given this configuration, Storm tries to distribute the workers evenly across worker nodes (also known as supervisor nodes), giving each worker node 1 JVM.</span></span> <span data-ttu-id="94812-160">A questo punto nei supervisor Storm prova a distribuire gli executor in modo uniforme tra i supervisori, assegnando a ogni supervisore (ovvero a ogni JVM) 8 thread.</span><span class="sxs-lookup"><span data-stu-id="94812-160">Now within the supervisors, Storm tries to distribute the executors evenly between supervisors, giving each supervisor (that is, JVM) 8 threads each.</span></span>

## <a name="tune-additional-parameters"></a><span data-ttu-id="94812-161">Ottimizzare i parametri aggiuntivi</span><span class="sxs-lookup"><span data-stu-id="94812-161">Tune additional parameters</span></span>
<span data-ttu-id="94812-162">Dopo aver creato la topologia di base, è possibile valutare se modificare uno dei parametri:</span><span class="sxs-lookup"><span data-stu-id="94812-162">After you have the basic topology, you can consider whether you want to tweak any of the parameters:</span></span>
* <span data-ttu-id="94812-163">**Number of JVMs per worker node** (Numero di JVM per nodo di lavoro).</span><span class="sxs-lookup"><span data-stu-id="94812-163">**Number of JVMs per worker node.**</span></span> <span data-ttu-id="94812-164">Se si ha una struttura dei dati di grandi dimensioni (ad esempio, tabella di ricerca) che si vuole ospitare in memoria, ogni JVM richiede una copia separata.</span><span class="sxs-lookup"><span data-stu-id="94812-164">If you have a large data structure (for example, a lookup table) that you host in memory, each JVM requires a separate copy.</span></span> <span data-ttu-id="94812-165">In alternativa, è possibile usare la struttura dei dati in diversi thread se si hanno meno JVM.</span><span class="sxs-lookup"><span data-stu-id="94812-165">Alternatively, you can use the data structure across many threads if you have fewer JVMs.</span></span> <span data-ttu-id="94812-166">Per l'I/O del bolt, il numero di JVM non definisce una differenza significativa come il numero di thread aggiunti su tali JVM.</span><span class="sxs-lookup"><span data-stu-id="94812-166">For the bolt’s I/O, the number of JVMs does not make as much of a difference as the number of threads added across those JVMs.</span></span> <span data-ttu-id="94812-167">Per semplicità, è consigliabile avere una sola JVM per ruolo di lavoro.</span><span class="sxs-lookup"><span data-stu-id="94812-167">For simplicity, it's a good idea to have one JVM per worker.</span></span> <span data-ttu-id="94812-168">A seconda delle operazioni eseguite dal bolt o dall'elaborazione dell'applicazione richiesta, potrebbe tuttavia essere necessario modificare questo numero.</span><span class="sxs-lookup"><span data-stu-id="94812-168">Depending on what your bolt is doing or what application processing you require, though, you may need to change this number.</span></span>
* <span data-ttu-id="94812-169">**Number of spout executors** (Numero di executor spout).</span><span class="sxs-lookup"><span data-stu-id="94812-169">**Number of spout executors.**</span></span> <span data-ttu-id="94812-170">Poiché l'esempio precedente usa bolt per la scrittura in Data Lake Store, il numero di spout non è strettamente correlato alle prestazioni del bolt.</span><span class="sxs-lookup"><span data-stu-id="94812-170">Because the preceding example uses bolts for writing to Data Lake Store, the number of spouts is not directly relevant to the bolt performance.</span></span> <span data-ttu-id="94812-171">Tuttavia, a seconda della quantità di elaborazione o I/O in corso nello spout, è consigliabile ottimizzare gli spout per ottenere le massime prestazioni.</span><span class="sxs-lookup"><span data-stu-id="94812-171">However, depending on the amount of processing or I/O happening in the spout, it's a good idea to tune the spouts for best performance.</span></span> <span data-ttu-id="94812-172">Assicurarsi di avere sufficienti spout per poter mantenere occupati i bolt.</span><span class="sxs-lookup"><span data-stu-id="94812-172">Ensure that you have enough spouts to be able to keep the bolts busy.</span></span> <span data-ttu-id="94812-173">Le velocità di output degli spout devono corrispondere alla velocità effettiva dei bolt.</span><span class="sxs-lookup"><span data-stu-id="94812-173">The output rates of the spouts should match the throughput of the bolts.</span></span> <span data-ttu-id="94812-174">La configurazione effettiva varia a seconda dello spout.</span><span class="sxs-lookup"><span data-stu-id="94812-174">The actual configuration depends on the spout.</span></span>
* <span data-ttu-id="94812-175">**Number of tasks** (Numero di attività).</span><span class="sxs-lookup"><span data-stu-id="94812-175">**Number of tasks.**</span></span> <span data-ttu-id="94812-176">Ogni bolt viene eseguito come thread singolo.</span><span class="sxs-lookup"><span data-stu-id="94812-176">Each bolt runs as a single thread.</span></span> <span data-ttu-id="94812-177">Attività aggiuntive sui bolt non forniscono concorrenza aggiuntiva.</span><span class="sxs-lookup"><span data-stu-id="94812-177">Additional tasks per bolt don't provide any additional concurrency.</span></span> <span data-ttu-id="94812-178">Esse risultano utili solo se il processo di riconoscimento della tupla occupa una porzione importante del tempo di esecuzione del bolt.</span><span class="sxs-lookup"><span data-stu-id="94812-178">The only time they are of benefit is if your process of acknowledging the tuple takes a large proportion of your bolt execution time.</span></span> <span data-ttu-id="94812-179">È consigliabile raggruppare più tuple in un'aggiunta di maggiori dimensioni prima di inviare un acknowledgement dal bolt.</span><span class="sxs-lookup"><span data-stu-id="94812-179">It's a good idea to group many tuples into a larger append before you send an acknowledgement from the bolt.</span></span> <span data-ttu-id="94812-180">Nella maggior parte dei casi quindi più attività non offrono vantaggi aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="94812-180">So, in most cases, multiple tasks provide no additional benefit.</span></span>
* <span data-ttu-id="94812-181">**Local or shuffle grouping** (Raggruppamento locale o casuale).</span><span class="sxs-lookup"><span data-stu-id="94812-181">**Local or shuffle grouping.**</span></span> <span data-ttu-id="94812-182">Quando questa impostazione è abilitata, le tuple vengono inviate ai bolt nello stesso processo di lavoro.</span><span class="sxs-lookup"><span data-stu-id="94812-182">When this setting is enabled, tuples are sent to bolts within the same worker process.</span></span> <span data-ttu-id="94812-183">In questo modo si riduce il numero di comunicazioni tra processi e chiamate di rete.</span><span class="sxs-lookup"><span data-stu-id="94812-183">This reduces inter-process communication and network calls.</span></span> <span data-ttu-id="94812-184">Tale operazione è consigliata per la maggior parte delle topologie.</span><span class="sxs-lookup"><span data-stu-id="94812-184">This is recommended for most topologies.</span></span>

<span data-ttu-id="94812-185">Questo scenario di base è un buon punto di partenza.</span><span class="sxs-lookup"><span data-stu-id="94812-185">This basic scenario is a good starting point.</span></span> <span data-ttu-id="94812-186">Usare i propri dati per un test per perfezionare i parametri precedenti e raggiungere così prestazioni ottimali.</span><span class="sxs-lookup"><span data-stu-id="94812-186">Test with your own data to tweak the preceding parameters to achieve optimal performance.</span></span>

## <a name="tune-the-spout"></a><span data-ttu-id="94812-187">Ottimizzare lo spout</span><span class="sxs-lookup"><span data-stu-id="94812-187">Tune the spout</span></span>

<span data-ttu-id="94812-188">È possibile modificare le impostazioni seguenti per ottimizzare lo spout.</span><span class="sxs-lookup"><span data-stu-id="94812-188">You can modify the following settings to tune the spout.</span></span>

- <span data-ttu-id="94812-189">**Tuple timeout: topology.message.timeout.secs** (Timeout tuple: topology.message.timeout.secs).</span><span class="sxs-lookup"><span data-stu-id="94812-189">**Tuple timeout: topology.message.timeout.secs**.</span></span> <span data-ttu-id="94812-190">Questa impostazione determina il tempo impiegato da un messaggio per completare e ricevere l'acknowledgement prima che questo abbia esito negativo.</span><span class="sxs-lookup"><span data-stu-id="94812-190">This setting determines the amount of time a message takes to complete, and receive acknowledgement, before it is considered failed.</span></span>

- <span data-ttu-id="94812-191">**Max memory per worker process: worker.childopts** (Memoria massima per processo di lavoro: worker.childopts).</span><span class="sxs-lookup"><span data-stu-id="94812-191">**Max memory per worker process: worker.childopts**.</span></span> <span data-ttu-id="94812-192">Questa impostazione consente di specificare i parametri della riga di comando aggiuntivi per ruoli di lavoro Java.</span><span class="sxs-lookup"><span data-stu-id="94812-192">This setting lets you specify additional command-line parameters to the Java workers.</span></span> <span data-ttu-id="94812-193">L'impostazione più comunemente usata in questo caso è XmX, che determina la memoria massima allocata nell'heap di JVM.</span><span class="sxs-lookup"><span data-stu-id="94812-193">The most commonly used setting here is XmX, which determines the maximum memory allocated to a JVM’s heap.</span></span>

- <span data-ttu-id="94812-194">**Max spout pending: topology.max.spout.pending** (Spout massimo in sospeso: topology.max.spout.pending).</span><span class="sxs-lookup"><span data-stu-id="94812-194">**Max spout pending: topology.max.spout.pending**.</span></span> <span data-ttu-id="94812-195">Questa configurazione determina il numero di tuple che possono essere in esecuzione (non ancora riconosciute in tutti i nodi della topologia) per thread di spout in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="94812-195">This setting determines the number of tuples that can in be flight (not yet acknowledged at all nodes in the topology) per spout thread at any time.</span></span>

 <span data-ttu-id="94812-196">Un buon calcolo da eseguire è la stima delle dimensioni di ogni tupla.</span><span class="sxs-lookup"><span data-stu-id="94812-196">A good calculation to do is to estimate the size of each of your tuples.</span></span> <span data-ttu-id="94812-197">Quindi capire di quanta memoria dispone un thread spout.</span><span class="sxs-lookup"><span data-stu-id="94812-197">Then figure out how much memory one spout thread has.</span></span> <span data-ttu-id="94812-198">La memoria totale allocata in un thread, divisa per questo valore, fornisce il limite superiore per il parametro di spout massimo in sospeso.</span><span class="sxs-lookup"><span data-stu-id="94812-198">The total memory allocated to a thread, divided by this value, should give you the upper bound for the max spout pending parameter.</span></span>

## <a name="tune-the-bolt"></a><span data-ttu-id="94812-199">Ottimizzare il bolt</span><span class="sxs-lookup"><span data-stu-id="94812-199">Tune the bolt</span></span>
<span data-ttu-id="94812-200">Durante la scrittura in Data Lake Store, impostare un criterio di sincronizzazione delle dimensioni (buffer sul lato client) pari a 4 MB.</span><span class="sxs-lookup"><span data-stu-id="94812-200">When you're writing to Data Lake Store, set a size sync policy (buffer on the client side) to 4 MB.</span></span> <span data-ttu-id="94812-201">L'operazione di scaricamento o hsync() viene quindi eseguita solo quando la dimensione del buffer è uguale a questo valore.</span><span class="sxs-lookup"><span data-stu-id="94812-201">A flushing or hsync() is then performed only when the buffer size is the at this value.</span></span> <span data-ttu-id="94812-202">Il driver Data Lake Store nel ruolo di lavoro della macchina virtuale esegue automaticamente il buffering, a meno che non si esegua in modo esplicito hsync().</span><span class="sxs-lookup"><span data-stu-id="94812-202">The Data Lake Store driver on the worker VM automatically does this buffering, unless you explicitly perform an hsync().</span></span>

<span data-ttu-id="94812-203">Il bolt Data Lake Store di Storm predefinito ha un parametro dei criteri di sincronizzazione delle dimensioni (fileBufferSize) che può essere usato per ottimizzare questo parametro.</span><span class="sxs-lookup"><span data-stu-id="94812-203">The default Data Lake Store Storm bolt has a size sync policy parameter (fileBufferSize) that can be used to tune this parameter.</span></span>

<span data-ttu-id="94812-204">Nelle topologie intensive I/O, è consigliabile che ogni thread bolt scriva in un proprio file e impostare un criterio di rotazione del file (fileRotationSize).</span><span class="sxs-lookup"><span data-stu-id="94812-204">In I/O-intensive topologies, it's a good idea to have each bolt thread write to its own file, and to set a file rotation policy (fileRotationSize).</span></span> <span data-ttu-id="94812-205">Quando il file raggiunge una determinata dimensione, il flusso viene allineato automaticamente e viene scritto su un nuovo file.</span><span class="sxs-lookup"><span data-stu-id="94812-205">When the file reaches a certain size, the stream is automatically flushed and a new file is written to.</span></span> <span data-ttu-id="94812-206">La dimensione del file consigliata per la rotazione è 1 GB.</span><span class="sxs-lookup"><span data-stu-id="94812-206">The recommended file size for rotation is 1 GB.</span></span>

### <a name="handle-tuple-data"></a><span data-ttu-id="94812-207">Gestire i dati delle tuple</span><span class="sxs-lookup"><span data-stu-id="94812-207">Handle tuple data</span></span>

<span data-ttu-id="94812-208">In Storm lo spout trattiene la tupla fino a quando non viene esplicitamente riconosciuta dal bolt.</span><span class="sxs-lookup"><span data-stu-id="94812-208">In Storm, a spout holds on to a tuple until it is explicitly acknowledged by the bolt.</span></span> <span data-ttu-id="94812-209">Se una tupla è stata letta dal bolt, ma non è ancora stata riconosciuta, lo spout potrebbe non essere permanente nel back-end di Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="94812-209">If a tuple has been read by the bolt but has not been acknowledged yet, the spout might not have persisted into Data Lake Store back end.</span></span> <span data-ttu-id="94812-210">Dopo l'acknowledgment di una tupla, la persistenza dello spout può essere garantita dal bolt e lo spout può quindi eliminare i dati di origine da qualsiasi origine vengano letti.</span><span class="sxs-lookup"><span data-stu-id="94812-210">After a tuple is acknowledged, the spout can be guaranteed persistence by the bolt, and can then delete the source data from whatever source it is reading from.</span></span>  

<span data-ttu-id="94812-211">Per prestazioni ottimali in Data Lake Store, 4 MB del buffer del bolt devono essere disponibili per i dati delle tuple.</span><span class="sxs-lookup"><span data-stu-id="94812-211">For best performance on Data Lake Store, have the bolt buffer 4 MB of tuple data.</span></span> <span data-ttu-id="94812-212">Scrivere quindi nel back-end di Data Lake Store con un'unica operazione di scrittura da 4 MB.</span><span class="sxs-lookup"><span data-stu-id="94812-212">Then write to the Data Lake Store back end as one 4-MB write.</span></span> <span data-ttu-id="94812-213">Dopo aver scritto correttamente i dati nell'archivio, chiamando hflush(), il bolt può riconoscere i dati nello spout.</span><span class="sxs-lookup"><span data-stu-id="94812-213">After the data has been successfully written to the store (by calling hflush()), the bolt can acknowledge the data back to the spout.</span></span> <span data-ttu-id="94812-214">Il bolt di esempio qui fornito si comporta in questo modo.</span><span class="sxs-lookup"><span data-stu-id="94812-214">This is what the example bolt supplied here does.</span></span> <span data-ttu-id="94812-215">È accettabile anche trattenere un numero maggiore di tuple prima che venga chiamato hflush() e le tuple vengano riconosciute.</span><span class="sxs-lookup"><span data-stu-id="94812-215">It is also acceptable to hold a larger number of tuples before the hflush() call is made and the tuples acknowledged.</span></span> <span data-ttu-id="94812-216">In questo modo, tuttavia, aumenta il numero di tuple in esecuzione che lo spout deve contenere e quindi aumenta la quantità di memoria necessaria per JVM.</span><span class="sxs-lookup"><span data-stu-id="94812-216">However, this increases the number of tuples in flight that the spout needs to hold, and therefore increases the amount of memory required per JVM.</span></span>

> [!NOTE]
<span data-ttu-id="94812-217">Per altre cause non strettamente correlate alle prestazioni, è possibile che le applicazioni presentino un requisito di frequenza più elevata per l'acknowledgment delle tuple (in caso di dimensioni dei dati inferiori a 4 MB).</span><span class="sxs-lookup"><span data-stu-id="94812-217">Applications might have a requirement to acknowledge tuples more frequently (at data sizes less than 4 MB) for other non-performance reasons.</span></span> <span data-ttu-id="94812-218">Questo potrebbe tuttavia influire sulla velocità effettiva di I/O nel back-end di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="94812-218">However, that might affect the I/O throughput to the storage back end.</span></span> <span data-ttu-id="94812-219">Considerare con attenzione questo compromesso in relazione alle prestazioni di I/O del bolt.</span><span class="sxs-lookup"><span data-stu-id="94812-219">Carefully weigh this tradeoff against the bolt’s I/O performance.</span></span>

<span data-ttu-id="94812-220">Se la velocità in ingresso delle tuple non è elevata e quindi il riempimento del buffer da 4 MB richiede molto tempo, considerare la possibilità di risolvere il problema in questo modo:</span><span class="sxs-lookup"><span data-stu-id="94812-220">If the incoming rate of tuples is not high, so the 4-MB buffer takes a long time to fill, consider mitigating this by:</span></span>
* <span data-ttu-id="94812-221">Riducendo il numero di bolt, per poter avere un numero minore di buffer da riempire.</span><span class="sxs-lookup"><span data-stu-id="94812-221">Reducing the number of bolts, so there are fewer buffers to fill.</span></span>
* <span data-ttu-id="94812-222">Con un criterio basato sul tempo o sul conteggio, in cui hflush() viene attivato ogni x scaricamenti oppure ogni y millisecondi e le tuple accumulate fino a quel momento vengono riconosciute.</span><span class="sxs-lookup"><span data-stu-id="94812-222">Having a time-based or count-based policy, where an hflush() is triggered every x flushes or every y milliseconds, and the tuples accumulated so far are acknowledged back.</span></span>

<span data-ttu-id="94812-223">Si noti che in questo caso la velocità effettiva è inferiore, ma con una bassa frequenza di eventi, comunque, la velocità effettiva massima non è l'obiettivo principale.</span><span class="sxs-lookup"><span data-stu-id="94812-223">Note that the throughput in this case is lower, but with a slow rate of events, maximum throughput is not the biggest objective anyway.</span></span> <span data-ttu-id="94812-224">Queste mitigazioni consentono di ridurre il tempo totale impiegato da una tupla per il flusso fino alla risorsa di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="94812-224">These mitigations help you reduce the total time that it takes for a tuple to flow through to the store.</span></span> <span data-ttu-id="94812-225">Questo potrebbe essere importante se è necessaria una pipeline in tempo reale anche con una frequenza di eventi bassa.</span><span class="sxs-lookup"><span data-stu-id="94812-225">This might matter if you want a real-time pipeline even with a low event rate.</span></span> <span data-ttu-id="94812-226">Si noti anche che, se la frequenza di tuple in ingresso è bassa, è consigliabile modificare il parametro topology.message.timeout_secs, in modo che non si verifichi il timeout delle tuple durante l'elaborazione o il buffering.</span><span class="sxs-lookup"><span data-stu-id="94812-226">Also note that if your incoming tuple rate is low, you should adjust the topology.message.timeout_secs parameter, so the tuples don’t time out while they are getting buffered or processed.</span></span>

## <a name="monitor-your-topology-in-storm"></a><span data-ttu-id="94812-227">Monitorare la topologia in Storm</span><span class="sxs-lookup"><span data-stu-id="94812-227">Monitor your topology in Storm</span></span>  
<span data-ttu-id="94812-228">Quando la topologia è in esecuzione, è possibile monitorarla nell'interfaccia utente di Storm.</span><span class="sxs-lookup"><span data-stu-id="94812-228">While your topology is running, you can monitor it in the Storm user interface.</span></span> <span data-ttu-id="94812-229">Ecco i parametri principali da esaminare:</span><span class="sxs-lookup"><span data-stu-id="94812-229">Here are the main parameters to look at:</span></span>

* <span data-ttu-id="94812-230">**Total process execution latency** (Latenza totale di esecuzione del processo).</span><span class="sxs-lookup"><span data-stu-id="94812-230">**Total process execution latency.**</span></span> <span data-ttu-id="94812-231">Tempo medio che la tupla impiega per essere emessa dallo spout, elaborata dal bolt e riconosciuta.</span><span class="sxs-lookup"><span data-stu-id="94812-231">This is the average time one tuple takes to be emitted by the spout, processed by the bolt, and acknowledged.</span></span>

* <span data-ttu-id="94812-232">**Total bolt process latency** (Latenza totale del processo dei bolt).</span><span class="sxs-lookup"><span data-stu-id="94812-232">**Total bolt process latency.**</span></span> <span data-ttu-id="94812-233">Tempo medio impiegato dalla tupla per ricevere un riconoscimento nel bolt.</span><span class="sxs-lookup"><span data-stu-id="94812-233">This is the average time spent by the tuple at the bolt until it receives an acknowledgement.</span></span>

* <span data-ttu-id="94812-234">**Total bolt execute latency** (Latenza totale di esecuzione dei bolt).</span><span class="sxs-lookup"><span data-stu-id="94812-234">**Total bolt execute latency.**</span></span> <span data-ttu-id="94812-235">Tempo medio speso dal bolt nel metodo Execute.</span><span class="sxs-lookup"><span data-stu-id="94812-235">This is the average time spent by the bolt in the execute method.</span></span>

* <span data-ttu-id="94812-236">**Number of failures** (Numero di errori).</span><span class="sxs-lookup"><span data-stu-id="94812-236">**Number of failures.**</span></span> <span data-ttu-id="94812-237">Numero di tuple la cui elaborazione non è stata completata prima del timeout.</span><span class="sxs-lookup"><span data-stu-id="94812-237">This refers to the number of tuples that failed to be fully processed before they timed out.</span></span>

* <span data-ttu-id="94812-238">**Capacity** (Capacità).</span><span class="sxs-lookup"><span data-stu-id="94812-238">**Capacity.**</span></span> <span data-ttu-id="94812-239">Misura del carico di lavoro del sistema.</span><span class="sxs-lookup"><span data-stu-id="94812-239">This is a measure of how busy your system is.</span></span> <span data-ttu-id="94812-240">Se questo numero è 1, i bolt stanno lavorando al massimo della velocità.</span><span class="sxs-lookup"><span data-stu-id="94812-240">If this number is 1, your bolts are working as fast as they can.</span></span> <span data-ttu-id="94812-241">Se è minore di 1, aumentare il parallelismo.</span><span class="sxs-lookup"><span data-stu-id="94812-241">If it is less than 1, increase the parallelism.</span></span> <span data-ttu-id="94812-242">Se è maggiore di 1, ridurre il parallelismo.</span><span class="sxs-lookup"><span data-stu-id="94812-242">If it is greater than 1, reduce the parallelism.</span></span>

## <a name="troubleshoot-common-problems"></a><span data-ttu-id="94812-243">Risolvere i problemi comuni</span><span class="sxs-lookup"><span data-stu-id="94812-243">Troubleshoot common problems</span></span>
<span data-ttu-id="94812-244">Ecco alcuni scenari comuni per la risoluzione dei problemi.</span><span class="sxs-lookup"><span data-stu-id="94812-244">Here are a few common troubleshooting scenarios.</span></span>
* <span data-ttu-id="94812-245">**È in corso il timeout di diverse tuple.**</span><span class="sxs-lookup"><span data-stu-id="94812-245">**Many tuples are timing out.**</span></span> <span data-ttu-id="94812-246">Esaminare ogni nodo della topologia per trovare il collo di bottiglia.</span><span class="sxs-lookup"><span data-stu-id="94812-246">Look at each node in the topology to determine where the bottleneck is.</span></span> <span data-ttu-id="94812-247">La causa più comune è che i bolt non riescono a rimanere aggiornati con gli spout,</span><span class="sxs-lookup"><span data-stu-id="94812-247">The most common reason for this is that the bolts are not able to keep up with the spouts.</span></span> <span data-ttu-id="94812-248">di conseguenza le tuple bloccano i buffer interni mentre sono in attesa di essere elaborate.</span><span class="sxs-lookup"><span data-stu-id="94812-248">This leads to tuples clogging the internal buffers while waiting to be processed.</span></span> <span data-ttu-id="94812-249">Considerare l'aumento del valore di timeout o la riduzione dello spout massimo in sospeso.</span><span class="sxs-lookup"><span data-stu-id="94812-249">Consider increasing the timeout value or decreasing the max spout pending.</span></span>

* <span data-ttu-id="94812-250">**La latenza di esecuzione dei processi totale è elevata, ma la latenza dei processi bolt è bassa.**</span><span class="sxs-lookup"><span data-stu-id="94812-250">**There is a high total process execution latency, but a low bolt process latency.**</span></span> <span data-ttu-id="94812-251">In questo caso è possibile che le tuple non siano riconosciute in modo sufficientemente veloce.</span><span class="sxs-lookup"><span data-stu-id="94812-251">In this case, it is possible that the tuples are not being acknowledged fast enough.</span></span> <span data-ttu-id="94812-252">Verificare che sia presente un numero sufficiente di elementi di acknowledgment.</span><span class="sxs-lookup"><span data-stu-id="94812-252">Check that there are a sufficient number of acknowledgers.</span></span> <span data-ttu-id="94812-253">Un'altra possibilità è che rimangano in attesa nella coda per troppo tempo prima che i bolt inizino la loro elaborazione.</span><span class="sxs-lookup"><span data-stu-id="94812-253">Another possibility is that they are waiting in the queue for too long before the bolts start processing them.</span></span> <span data-ttu-id="94812-254">Ridurre lo spout massimo in sospeso.</span><span class="sxs-lookup"><span data-stu-id="94812-254">Decrease the max spout pending.</span></span>

* <span data-ttu-id="94812-255">**La latenza di esecuzione dei bolt è elevata.**</span><span class="sxs-lookup"><span data-stu-id="94812-255">**There is a high bolt execute latency.**</span></span> <span data-ttu-id="94812-256">Indica che il metodo execute() del bolt impiega troppo tempo.</span><span class="sxs-lookup"><span data-stu-id="94812-256">This means that the execute() method of your bolt is taking too long.</span></span> <span data-ttu-id="94812-257">Ottimizzare il codice o esaminare le dimensioni della scrittura e il comportamento di scaricamento.</span><span class="sxs-lookup"><span data-stu-id="94812-257">Optimize the code, or look at write sizes and flush behavior.</span></span>

### <a name="data-lake-store-throttling"></a><span data-ttu-id="94812-258">Limitazione di Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="94812-258">Data Lake Store throttling</span></span>
<span data-ttu-id="94812-259">Se si raggiungono i limiti di larghezza di banda di Data Lake Store, è possibile che le attività abbiano esito negativo.</span><span class="sxs-lookup"><span data-stu-id="94812-259">If you hit the limits of bandwidth provided by Data Lake Store, you might see task failures.</span></span> <span data-ttu-id="94812-260">Cercare errori di limitazione nei log delle attività.</span><span class="sxs-lookup"><span data-stu-id="94812-260">Check task logs for throttling errors.</span></span> <span data-ttu-id="94812-261">È possibile ridurre il parallelismo aumentando la dimensione del contenitore.</span><span class="sxs-lookup"><span data-stu-id="94812-261">You can decrease the parallelism by increasing container size.</span></span>    

<span data-ttu-id="94812-262">Per verificare la presenza di limitazioni, abilitare la registrazione di debug sul lato client:</span><span class="sxs-lookup"><span data-stu-id="94812-262">To check if you are getting throttled, enable the debug logging on the client side:</span></span>

1. <span data-ttu-id="94812-263">In **Ambari** > **Storm** > **Config** (Configurazione)  > **Advanced storm-worker-log4j** (Storm-worker-log4j avanzato), sostituire **&lt;root level="info"&gt;** con **&lt;root level="debug"&gt;**.</span><span class="sxs-lookup"><span data-stu-id="94812-263">In **Ambari** > **Storm** > **Config** > **Advanced storm-worker-log4j**, change **&lt;root level="info"&gt;** to **&lt;root level=”debug”&gt;**.</span></span> <span data-ttu-id="94812-264">Riavviare tutti i nodi o servizi per rendere effettiva la nuova configurazione.</span><span class="sxs-lookup"><span data-stu-id="94812-264">Restart all the nodes/service for the configuration to take effect.</span></span>
2. <span data-ttu-id="94812-265">Monitorare i log della topologia Storm sui nodi di lavoro (in /var/log/storm/worker-artifacts/&lt;NomeTopologia&gt;/&lt;porta&gt;/worker.log) per le eccezioni alle limitazioni di Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="94812-265">Monitor the Storm topology logs on worker nodes (under /var/log/storm/worker-artifacts/&lt;TopologyName&gt;/&lt;port&gt;/worker.log) for Data Lake Store throttling exceptions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="94812-266">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="94812-266">Next steps</span></span>
<span data-ttu-id="94812-267">L'ottimizzazione aggiuntiva delle prestazioni di Storm è reperibile in questo [blog](https://blogs.msdn.microsoft.com/shanyu/2015/05/14/performance-tuning-for-hdinsight-storm-and-microsoft-azure-eventhubs/).</span><span class="sxs-lookup"><span data-stu-id="94812-267">Additional performance tuning for Storm can be referenced in [this blog](https://blogs.msdn.microsoft.com/shanyu/2015/05/14/performance-tuning-for-hdinsight-storm-and-microsoft-azure-eventhubs/).</span></span>

<span data-ttu-id="94812-268">Per un esempio aggiuntivo da eseguire, vedere [questo in GitHub](https://github.com/hdinsight/storm-performance-automation).</span><span class="sxs-lookup"><span data-stu-id="94812-268">For an additional example to run, see [this one on GitHub](https://github.com/hdinsight/storm-performance-automation).</span></span>
