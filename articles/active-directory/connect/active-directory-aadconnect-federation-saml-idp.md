---
title: "Azure AD Connect: Usare un provider di identità SAML 2.0 per l'accesso Single Sign On | Microsoft Docs"
description: Questo argomento descrive l'uso di un IdP conforme a SAML 2.0 per l'accesso Single Sign-On.
services: active-directory
author: billmath
manager: femila
ms.custom: it-pro
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/13/2017
ms.author: billmath
ms.openlocfilehash: f9653dc44fb284a9b3c1988f623c33f27ae148cc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
#  <a name="use-a-saml-20-identity-provider-idp-for-single-sign-on"></a><span data-ttu-id="2914e-103">Usare un provider di identità (IdP) SAML 2.0 per l'accesso Single Sign-On</span><span class="sxs-lookup"><span data-stu-id="2914e-103">Use a SAML 2.0 Identity Provider (IdP) for Single Sign On</span></span>

<span data-ttu-id="2914e-104">Questo argomento contiene informazioni sull'utilizzo di un SAML 2.0 profilo SP-Lite basato su Provider di identità come hello preferito la servizio Token di sicurezza (STS) / provider di identità.</span><span class="sxs-lookup"><span data-stu-id="2914e-104">This topic contains information on using a SAML 2.0 compliant SP-Lite profile based Identity Provider as hello preferred Security Token Service (STS) / identity provider.</span></span> <span data-ttu-id="2914e-105">Si tratta di un'opzione utile quando si hanno già una directory di utenti e un archivio di password locali a cui è possibile accedere con SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="2914e-105">This is useful where you already have a user directory and password store on-premises that can be accessed using SAML 2.0.</span></span> <span data-ttu-id="2914e-106">La directory utenti esistente è utilizzabile per sign-on tooOffice 365 e altre risorse protette AD Azure.</span><span class="sxs-lookup"><span data-stu-id="2914e-106">This existing user directory can be used for sign-on tooOffice 365 and other Azure AD-secured resources.</span></span> <span data-ttu-id="2914e-107">Hello SP-Lite di SAML 2.0 profilo si basa sull'hello ampiamente utilizzato tooprovide standard di identità federato Security asserzione Markup Language (SAML) sign-on e il framework di scambio degli attributi.</span><span class="sxs-lookup"><span data-stu-id="2914e-107">hello SAML 2.0 SP-Lite profile is based on hello widely used Security Assertion Markup Language (SAML) federated identity standard tooprovide a sign-on and attribute exchange framework.</span></span>

>[!NOTE]
><span data-ttu-id="2914e-108">Per un elenco di parti 3rd Idps che sono stati testati per l'utilizzo con Azure AD vedere hello [elenco di compatibilità di federazione di Azure AD](active-directory-aadconnect-federation-compatibility.md)</span><span class="sxs-lookup"><span data-stu-id="2914e-108">For a list of 3rd party Idps that have been tested for use with Azure AD see hello [Azure AD federation compatibility list](active-directory-aadconnect-federation-compatibility.md)</span></span>

<span data-ttu-id="2914e-109">Microsoft supporta questa esperienza sign-on come integrazione hello di un servizio cloud Microsoft, ad esempio Office 365, con la correttamente configurato di SAML 2.0 profilo basato su provider di identità.</span><span class="sxs-lookup"><span data-stu-id="2914e-109">Microsoft supports this sign-on experience as hello integration of a Microsoft cloud service, such as Office 365, with your properly configured SAML 2.0 profile based IdP.</span></span> <span data-ttu-id="2914e-110">Provider di identità SAML 2.0 sono prodotti di terze parti e pertanto Microsoft non fornisce alcun supporto per la distribuzione di hello, configurazione, essi relative procedure consigliate di risoluzione dei problemi.</span><span class="sxs-lookup"><span data-stu-id="2914e-110">SAML 2.0 identity providers are third-party products and therefore Microsoft does not provide support for hello deployment, configuration, troubleshooting best practices regarding them.</span></span> <span data-ttu-id="2914e-111">Una volta configurato correttamente, integrazione hello con hello SAML 2.0 i provider di identità è possibile verificare la corretta configurazione utilizzando hello strumento Analizzatore di connettività Microsoft descritto in dettaglio più avanti.</span><span class="sxs-lookup"><span data-stu-id="2914e-111">Once properly configured, hello integration with hello SAML 2.0 identity provider can be tested for proper configuration by using hello Microsoft Connectivity Analyzer Tool which is described in more detail below.</span></span> <span data-ttu-id="2914e-112">Per ulteriori informazioni sui provider di identità basato sul profilo SP-Lite di SAML 2.0, rivolgersi organizzazione hello cui è stato fornito.</span><span class="sxs-lookup"><span data-stu-id="2914e-112">For more information about your SAML 2.0 SP-Lite profile based identity provider, ask hello organization that supplied it.</span></span>

>[!IMPORTANT]
><span data-ttu-id="2914e-113">In questo scenario di accesso con i provider di identità SAML 2.0 è disponibile solo un set limitato di client, tra cui:</span><span class="sxs-lookup"><span data-stu-id="2914e-113">Only a limited set of clients are available in this sign-on scenario with SAML 2.0 identity providers, this includes:</span></span>

>- <span data-ttu-id="2914e-114">Client basati sul Web, ad esempio Outlook Web Access e SharePoint Online</span><span class="sxs-lookup"><span data-stu-id="2914e-114">Web-based clients such as Outlook Web Access and SharePoint Online</span></span>
- <span data-ttu-id="2914e-115">Client di posta elettronica che utilizzano l'autenticazione di base e un metodo di accesso Exchange supportato come IMAP, POP, Active Sync, MAPI, e così via (Buongiorno protocollo Client avanzato punto finale è obbligatorio toobe distribuito), tra cui:</span><span class="sxs-lookup"><span data-stu-id="2914e-115">Email-rich clients that use basic authentication and a supported Exchange access method such as IMAP, POP, Active Sync, MAPI, etc. (hello Enhanced Client Protocol end point is required toobe deployed), including:</span></span>
    - <span data-ttu-id="2914e-116">Microsoft Outlook 2010/Outlook 2013/Outlook 2016, Apple iPhone (diverse versioni di iOS)</span><span class="sxs-lookup"><span data-stu-id="2914e-116">Microsoft Outlook 2010/Outlook 2013/Outlook 2016, Apple iPhone (various iOS versions)</span></span>
    - <span data-ttu-id="2914e-117">Diversi dispositivi Google Android</span><span class="sxs-lookup"><span data-stu-id="2914e-117">Various Google Android Devices</span></span>
    - <span data-ttu-id="2914e-118">Windows Phone 7, Windows Phone 7.8 e Windows Phone 8.0</span><span class="sxs-lookup"><span data-stu-id="2914e-118">Windows Phone 7, Windows Phone 7.8, and Windows Phone 8.0</span></span>
    - <span data-ttu-id="2914e-119">Client di posta elettronica di Windows 8 e Windows 8.1</span><span class="sxs-lookup"><span data-stu-id="2914e-119">Windows 8 Mail Client and Windows 8.1 Mail Client</span></span>
    - <span data-ttu-id="2914e-120">Client di posta elettronica di Windows 10</span><span class="sxs-lookup"><span data-stu-id="2914e-120">Windows 10 Mail Client</span></span>

<span data-ttu-id="2914e-121">Tutti gli altri client non sono disponibili in questo scenario di accesso con il provider di identità SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="2914e-121">All other clients are not available in this sign-on scenario with your SAML 2.0 Identity Provider.</span></span> <span data-ttu-id="2914e-122">Ad esempio, il client desktop Lync 2010 hello non è in grado di toologin in servizio hello con il Provider di identità SAML 2.0 configurato per single sign-on.</span><span class="sxs-lookup"><span data-stu-id="2914e-122">For example, hello Lync 2010 desktop client is not able toologin into hello service with your SAML 2.0 Identity Provider configured for single sign-on.</span></span>

## <a name="azure-ad-saml-20-protocol-requirements"></a><span data-ttu-id="2914e-123">Requisiti del protocollo SAML 2.0 in Azure AD</span><span class="sxs-lookup"><span data-stu-id="2914e-123">Azure AD SAML 2.0 protocol requirements</span></span>
<span data-ttu-id="2914e-124">In questo argomento contiene informazioni dettagliate sui requisiti di protocollo hello e alla formattazione dei messaggi che il provider di identità SAML 2.0 deve implementare toofederate con Azure AD tooenable sign-on tooone o altri servizi cloud Microsoft (ad esempio Office 365).</span><span class="sxs-lookup"><span data-stu-id="2914e-124">This topic contains detailed requirements on hello protocol and message formatting that your SAML 2.0 identity provider must implement toofederate with Azure AD tooenable sign-on tooone or more Microsoft cloud services (such as Office 365).</span></span> <span data-ttu-id="2914e-125">Hello SAML 2.0 relying party (SP-STS) per un servizio cloud Microsoft in questo scenario è Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2914e-125">hello SAML 2.0 relying party (SP-STS) for a Microsoft cloud service used in this scenario is Azure AD.</span></span>

<span data-ttu-id="2914e-126">È consigliabile verificare i messaggi di output del provider di identità essere simile toohello fornito tracce di esempio come possibili di SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="2914e-126">It is recommended that you ensure your SAML 2.0 identity provider output messages be as similar toohello provided sample traces as possible.</span></span> <span data-ttu-id="2914e-127">Dove possibile, inoltre, utilizzare i valori di attributo specifici dai metadati di Azure AD hello fornito.</span><span class="sxs-lookup"><span data-stu-id="2914e-127">Also, use specific attribute values from hello supplied Azure AD metadata where possible.</span></span> <span data-ttu-id="2914e-128">Quando si è soddisfatti dei messaggi di output, è possibile testare hello analizzatore connettività Microsoft come descritto di seguito.</span><span class="sxs-lookup"><span data-stu-id="2914e-128">Once you are happy with your output messages, you can test with hello Microsoft Connectivity Analyzer as described below.</span></span>

<span data-ttu-id="2914e-129">metadati Hello Azure AD possono essere scaricati dal seguente URL: [https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml](http://https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml).</span><span class="sxs-lookup"><span data-stu-id="2914e-129">hello Azure AD metadata can be downloaded from this URL: [https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml](http://https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml).</span></span>
<span data-ttu-id="2914e-130">Per i clienti in Cina utilizzando hello istanza Cina specifici di Office 365, hello seguenti endpoint di federazione deve essere utilizzato: [https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml](https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml).</span><span class="sxs-lookup"><span data-stu-id="2914e-130">For customers in China using hello China-specific instance of Office 365, hello following federation endpoint should be used: [https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml](https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml).</span></span>

## <a name="saml-protocol-requirements"></a><span data-ttu-id="2914e-131">Requisiti del protocollo SAML</span><span class="sxs-lookup"><span data-stu-id="2914e-131">SAML protocol requirements</span></span>
<span data-ttu-id="2914e-132">Dettagli questa sezione come coppie di messaggi di richiesta e risposta hello vengono raggruppati nel toohelp ordine si tooformat i messaggi correttamente.</span><span class="sxs-lookup"><span data-stu-id="2914e-132">This section details how hello request and response message pairs are put together in order toohelp you tooformat your messages correctly.</span></span>

<span data-ttu-id="2914e-133">Azure AD può essere configurato toowork con provider di identità che utilizzano il profilo SP-Lite di SAML 2.0 di hello con alcuni requisiti specifici, come indicato di seguito.</span><span class="sxs-lookup"><span data-stu-id="2914e-133">Azure AD can be configured toowork with identity providers that use hello SAML 2.0 SP Lite profile with some specific requirements as listed below.</span></span> <span data-ttu-id="2914e-134">Utilizza hello messaggi SAML di esempio di richiesta e risposta con test automatizzati e manuali, è possibile utilizzare tooachieve interoperabilità con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2914e-134">Using hello sample SAML request and response messages along with automated and manual testing, you can work tooachieve interoperability with Azure AD.</span></span>

## <a name="signature-block-requirements"></a><span data-ttu-id="2914e-135">Requisiti del blocco di firma</span><span class="sxs-lookup"><span data-stu-id="2914e-135">Signature block requirements</span></span>
<span data-ttu-id="2914e-136">All'interno di hello risposta SAML nodo di messaggio hello firma contiene informazioni sulla firma digitale di hello per il messaggio hello stesso.</span><span class="sxs-lookup"><span data-stu-id="2914e-136">Within hello SAML Response message hello Signature node contains information about hello digital signature for hello message itself.</span></span> <span data-ttu-id="2914e-137">blocco della firma Hello sono hello seguenti requisiti:</span><span class="sxs-lookup"><span data-stu-id="2914e-137">hello signature block has hello following requirements:</span></span>

1. <span data-ttu-id="2914e-138">Hello nodo di asserzione deve essere firmato.</span><span class="sxs-lookup"><span data-stu-id="2914e-138">hello assertion node itself must be signed</span></span>
2.  <span data-ttu-id="2914e-139">algoritmo Hello RSA-sha1 deve essere utilizzato come DigestMethod hello.</span><span class="sxs-lookup"><span data-stu-id="2914e-139">hello RSA-sha1 algorithm must be used as hello DigestMethod.</span></span> <span data-ttu-id="2914e-140">Altri algoritmi di firma digitale non sono accettati.</span><span class="sxs-lookup"><span data-stu-id="2914e-140">Other digital signature algorithms are not accepted.</span></span>
   `<ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/>`
3.  <span data-ttu-id="2914e-141">È anche possibile firmare il documento XML hello.</span><span class="sxs-lookup"><span data-stu-id="2914e-141">You may also sign hello XML document.</span></span> 
4.  <span data-ttu-id="2914e-142">Algoritmo di trasformazione Hello deve corrispondere ai valori hello nel seguente esempio hello:`<ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
       <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>`</span><span class="sxs-lookup"><span data-stu-id="2914e-142">hello Transform Algorithm must match hello values in hello following sample:    `<ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
       <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>`</span></span>
9.  <span data-ttu-id="2914e-143">Algoritmo SignatureMethod Hello deve corrispondere hello seguente esempio:`<ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/>`</span><span class="sxs-lookup"><span data-stu-id="2914e-143">hello SignatureMethod Algorithm must match hello following sample:   `<ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/>`</span></span>

## <a name="supported-bindings"></a><span data-ttu-id="2914e-144">Binding supportati</span><span class="sxs-lookup"><span data-stu-id="2914e-144">Supported bindings</span></span>
<span data-ttu-id="2914e-145">Le associazioni sono trasporto hello correlati che sono necessari i parametri di comunicazione.</span><span class="sxs-lookup"><span data-stu-id="2914e-145">Bindings are hello transport related communications parameters that are required.</span></span> <span data-ttu-id="2914e-146">Hello seguenti requisiti si applica le associazioni toohello</span><span class="sxs-lookup"><span data-stu-id="2914e-146">hello following requirements apply toohello bindings</span></span>

1. <span data-ttu-id="2914e-147">HTTPS è richiesto hello trasporto.</span><span class="sxs-lookup"><span data-stu-id="2914e-147">HTTPS is hello required transport.</span></span>
2.  <span data-ttu-id="2914e-148">Azure AD richiede HTTP POST per l'invio dei token durante l'accesso</span><span class="sxs-lookup"><span data-stu-id="2914e-148">Azure AD will require HTTP POST for token submission during logon</span></span>
3.  <span data-ttu-id="2914e-149">Azure AD userà HTTP POST per hello autenticazione richiesta toohello provider identità e REDIRECT per provider di identità toohello messaggio hello disconnessione.</span><span class="sxs-lookup"><span data-stu-id="2914e-149">Azure AD will use HTTP POST for hello authentication request toohello identity provider and REDIRECT for hello Logoff message toohello identity provider.</span></span>

## <a name="required-attributes"></a><span data-ttu-id="2914e-150">Attributi richiesti</span><span class="sxs-lookup"><span data-stu-id="2914e-150">Required attributes</span></span>
<span data-ttu-id="2914e-151">Questa tabella sono riportati i requisiti per gli attributi specifici nel messaggio hello SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="2914e-151">This table shows requirements for specific attributes in hello SAML 2.0 message.</span></span>
 
|<span data-ttu-id="2914e-152">Attributo</span><span class="sxs-lookup"><span data-stu-id="2914e-152">Attribute</span></span>|<span data-ttu-id="2914e-153">Descrizione</span><span class="sxs-lookup"><span data-stu-id="2914e-153">Description</span></span>|
| ----- | ----- |
|<span data-ttu-id="2914e-154">NameID</span><span class="sxs-lookup"><span data-stu-id="2914e-154">NameID</span></span>|<span data-ttu-id="2914e-155">il valore di Hello di questa asserzione deve essere hello stesso immutableid hello Azure AD dell'utente.</span><span class="sxs-lookup"><span data-stu-id="2914e-155">hello value of this assertion must be hello same as hello Azure AD user’s ImmutableID.</span></span> <span data-ttu-id="2914e-156">Può trattarsi di too64 caratteri alfanumerici.</span><span class="sxs-lookup"><span data-stu-id="2914e-156">It can be up too64 alpha numeric characters.</span></span> <span data-ttu-id="2914e-157">Qualsiasi carattere non compatibile con HTML deve essere codificato. Ad esempio, il carattere "+" viene visualizzato come ".2B".</span><span class="sxs-lookup"><span data-stu-id="2914e-157">Any non HTML safe characters must be encoded, for example a “+” character is shown as “.2B”.</span></span>|
|<span data-ttu-id="2914e-158">IDPEmail</span><span class="sxs-lookup"><span data-stu-id="2914e-158">IDPEmail</span></span>|<span data-ttu-id="2914e-159">Hello del nome dell'entità utente (UPN) è elencato in hello SAML risposta come un elemento con hello Nome IDPEmail questo è hello UserPrincipalName (UPN) dell'utente in Azure AD/Office 365.</span><span class="sxs-lookup"><span data-stu-id="2914e-159">hello User Principal Name (UPN) is listed in hello SAML response as an element with hello name IDPEmail This is hello user’s UserPrincipalName (UPN) in Azure AD/Office 365.</span></span> <span data-ttu-id="2914e-160">Hello UPN è nel formato di indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="2914e-160">hello UPN is in email address format.</span></span> <span data-ttu-id="2914e-161">Valore UPN in Office 365 (Azure Active Directory).</span><span class="sxs-lookup"><span data-stu-id="2914e-161">UPN value in Windows Office 365 (Azure Active Directory).</span></span>|
|<span data-ttu-id="2914e-162">Issuer</span><span class="sxs-lookup"><span data-stu-id="2914e-162">Issuer</span></span>|<span data-ttu-id="2914e-163">Questo è necessario toobe un URI del provider di identità hello.</span><span class="sxs-lookup"><span data-stu-id="2914e-163">This is required toobe a URI of hello identity provider.</span></span> <span data-ttu-id="2914e-164">Non è consigliabile riusare hello dell'autorità di certificazione da messaggi di esempio hello.</span><span class="sxs-lookup"><span data-stu-id="2914e-164">You should not reuse hello Issuer from hello sample messages.</span></span> <span data-ttu-id="2914e-165">Se si hanno più domini di primo livello nel hello tenant di Azure AD che dell'autorità di certificazione deve corrispondere hello specificato impostazione URI configurata per ogni dominio.</span><span class="sxs-lookup"><span data-stu-id="2914e-165">If you have multiple top-level domains in your Azure AD tenants hello Issuer must match hello specified URI setting configured per domain.</span></span>|

>[!IMPORTANT]
><span data-ttu-id="2914e-166">Azure AD attualmente supporta hello seguente URI NameID-Format per SAML 2.0:urn:oasis:names:tc:SAML:2.0:nameid-formato: persistente.</span><span class="sxs-lookup"><span data-stu-id="2914e-166">Azure AD currently supports hello following NameID Format URI for SAML 2.0:urn:oasis:names:tc:SAML:2.0:nameid-format:persistent.</span></span>

## <a name="sample-saml-request-and-response-messages"></a><span data-ttu-id="2914e-167">Messaggi di richiesta e di risposta SAML di esempio</span><span class="sxs-lookup"><span data-stu-id="2914e-167">Sample SAML request and response messages</span></span>
<span data-ttu-id="2914e-168">Una coppia di messaggi di richiesta e risposta viene visualizzata per lo scambio di messaggi di accesso hello.</span><span class="sxs-lookup"><span data-stu-id="2914e-168">A request and response message pair is shown for hello sign-on message exchange.</span></span>
<span data-ttu-id="2914e-169">Si tratta di un messaggio di richiesta di esempio che viene inviato dal provider di identità SAML 2.0 di Azure AD tooa esempio.</span><span class="sxs-lookup"><span data-stu-id="2914e-169">This is a sample request message that is sent from Azure AD tooa sample SAML 2.0 identity provider.</span></span> <span data-ttu-id="2914e-170">provider di identità SAML 2.0 di esempio Hello è che Active Directory Federation Services (ADFS) configurato protocollo SAML-P toouse.</span><span class="sxs-lookup"><span data-stu-id="2914e-170">hello sample SAML 2.0 identity provider is Active Directory Federation Services (AD FS) configured toouse SAML-P protocol.</span></span> <span data-ttu-id="2914e-171">È stato anche completato un test di interoperabilità con altri provider di identità SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="2914e-171">Interoperability testing has also been completed with other SAML 2.0 identity providers.</span></span>

    `<samlp:AuthnRequest xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol" xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion" ID="_7171b0b2-19f2-4ba2-8f94-24b5e56b7f1e" IssueInstant="2014-01-30T16:18:35Z" Version="2.0" AssertionConsumerServiceIndex="0" >
    <saml:Issuer>urn:federation:MicrosoftOnline</saml:Issuer>
    <samlp:NameIDPolicy Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent"/>
    </samlp:AuthnRequest>`

<span data-ttu-id="2914e-172">Si tratta di un messaggio di risposta di esempio che viene inviato da hello esempio SAML 2.0 identità provider tooAzure AD / Office 365.</span><span class="sxs-lookup"><span data-stu-id="2914e-172">This is a sample response message that is sent from hello sample SAML 2.0 compliant identity provider tooAzure AD / Office 365.</span></span>

    `<samlp:Response ID="_592c022f-e85e-4d23-b55b-9141c95cd2a5" Version="2.0" IssueInstant="2014-01-31T15:36:31.357Z" Destination="https://login.microsoftonline.com/login.srf" Consent="urn:oasis:names:tc:SAML:2.0:consent:unspecified" InResponseTo="_049917a6-1183-42fd-a190-1d2cbaf9b144" xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol">
    <Issuer xmlns="urn:oasis:names:tc:SAML:2.0:assertion">http://WS2012R2-0.contoso.com/adfs/services/trust</Issuer>
    <samlp:Status>
    <samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success" />
    </samlp:Status>
    <Assertion ID="_7e3c1bcd-f180-4f78-83e1-7680920793aa" IssueInstant="2014-01-31T15:36:31.279Z" Version="2.0" xmlns="urn:oasis:names:tc:SAML:2.0:assertion">
    <Issuer>http://WS2012R2-0.contoso.com/adfs/services/trust</Issuer>
    <ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
      <ds:SignedInfo>
        <ds:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#" />
        <ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1" />
        <ds:Reference URI="#_7e3c1bcd-f180-4f78-83e1-7680920793aa">
          <ds:Transforms>
            <ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature" />
            <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#" />
          </ds:Transforms>
          <ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1" />
          <ds:DigestValue>CBn/5YqbheaJP425c0pHva9PhNY=</ds:DigestValue>
        </ds:Reference>
      </ds:SignedInfo>
      <ds:SignatureValue>TciWMyHW2ZODrh/2xrvp5ggmcHBFEd9vrp6DYXp+hZWJzmXMmzwmwS8KNRJKy8H7XqBsdELA1Msqi8I3TmWdnoIRfM/ZAyUppo8suMu6Zw+boE32hoQRnX9EWN/f0vH6zA/YKTzrjca6JQ8gAV1ErwvRWDpyMcwdYCiWALv9ScbkAcebOE1s1JctZ5RBXggdZWrYi72X+I4i6WgyZcIGai/rZ4v2otoWAEHS0y1yh1qT7NDPpl/McDaTGkNU6C+8VfjD78DrUXEcAfKvPgKlKrOMZnD1lCGsViimGY+LSuIdY45MLmyaa5UT4KWph6dA==</ds:SignatureValue>
      <KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#">
        <ds:X509Data>
          <ds:X509Certificate>MIIC7jCCAdagAwIBAgIQRrjsbFPaXIlOG3GTv50fkjANBgkqhkiG9w0BAQsFADAzMTEwLwYDVQQDEyhBREZTIFNpZ25pbmcgLSBXUzIwMTJSMi0wLnN3aW5mb3JtZXIuY29tMB4XDTE0MDEyMDE1MTY0MFoXDTE1MDEyMDE1MTY0MFowMzExMC8GA1UEAxMoQURGUyBTaWduaW5nIC0gV1MyMDEyUjItMC5zd2luZm9ybWVyLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKe+rLVmXy1QwCwZwqgbbp1/+3ZWxd9T/jV0hpLIIWr+LCOHqq8n8beJvlivgLmDJo8f+EITnAxWcsJUvVai/35AhHCUq9tc9sqMp5PWtabAEMb2AU72/QlX/72D2/NbGQq1BWYbqUpgpCZ2nSgvlWDHlCiUo//UGsvfox01kjTFlmqQInsJVfRxF5AcCAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAi8c6C4zaTEc7aQiUgvnGQgCbMZbhUXXLGRpjvFLKaQzkwa9eq7WLJibcSNyGXBa/SfT5wJgsm3TPKgSehGAOTirhcqHheZyvBObAScY7GOT+u9pVYp6raFrc7ez3c+CGHeV/tNvy1hJNs12FYH4X+ZCNFIT9tprieR25NCdi5SWUbPZL0tVzJsHc1y92b2M2FxqRDohxQgJvyJOpcg2mSBzZZIkvDg7gfPSUXHVS1MQs0RHSbwq/XdQocUUhl9/e/YWCbNNxlM84BxFsBUok1dH/gzBySx+Fc8zYi7cOq9yaBT3RLT6cGmFGVYZJW4FyhPZOCLVNsLlnPQcX3dDg9A==</ds:X509Certificate>
        </ds:X509Data>
      </KeyInfo>
    </ds:Signature>
    <Subject>
      <NameID Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent">ABCDEG1234567890</NameID>
      <SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:bearer">
        <SubjectConfirmationData InResponseTo="_049917a6-1183-42fd-a190-1d2cbaf9b144" NotOnOrAfter="2014-01-31T15:41:31.357Z" Recipient="https://login.microsoftonline.com/login.srf" />
      </SubjectConfirmation>
    </Subject>
    <Conditions NotBefore="2014-01-31T15:36:31.263Z" NotOnOrAfter="2014-01-31T16:36:31.263Z">
      <AudienceRestriction>
        <Audience>urn:federation:MicrosoftOnline</Audience>
      </AudienceRestriction>
    </Conditions>
    <AttributeStatement>
      <Attribute Name="IDPEmail">
        <AttributeValue>administrator@contoso.com</AttributeValue>
      </Attribute>
    </AttributeStatement>
    <AuthnStatement AuthnInstant="2014-01-31T15:36:30.200Z" SessionIndex="_7e3c1bcd-f180-4f78-83e1-7680920793aa">
      <AuthnContext>
        <AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</AuthnContextClassRef>
      </AuthnContext>
    </AuthnStatement>
    </Assertion>
    </samlp:Response>`

## <a name="configure-your-saml-20-compliant-identity-provider"></a><span data-ttu-id="2914e-173">Configurare il provider di identità conforme a SAML 2.0</span><span class="sxs-lookup"><span data-stu-id="2914e-173">Configure your SAML 2.0 compliant identity provider</span></span>
<span data-ttu-id="2914e-174">In questo argomento fornisce linee guida su come tooconfigure il toofederate di provider di identità SAML 2.0 con Azure AD tooenable accesso single sign-on tooone o più cloud di Microsoft services (ad esempio Office 365) mediante il protocollo hello SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="2914e-174">This topic contains guidelines on how tooconfigure your SAML 2.0 identity provider toofederate with Azure AD tooenable single sign-on access tooone or more Microsoft cloud services (such as Office 365) using hello SAML 2.0 protocol.</span></span> <span data-ttu-id="2914e-175">Hello SAML 2.0 relying party per un servizio cloud Microsoft in questo scenario è Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2914e-175">hello SAML 2.0 relying party for a Microsoft cloud service used in this scenario is Azure AD.</span></span>

## <a name="add-azure-ad-metadata"></a><span data-ttu-id="2914e-176">Aggiungere i metadati di Azure AD</span><span class="sxs-lookup"><span data-stu-id="2914e-176">Add Azure AD metadata</span></span>
<span data-ttu-id="2914e-177">Il provider di identità SAML 2.0 deve tooinformation tooadhere sulla relying party di hello Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2914e-177">Your SAML 2.0 identity provider needs tooadhere tooinformation about hello Azure AD relying party.</span></span> <span data-ttu-id="2914e-178">Azure AD pubblica i metadati in https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml.</span><span class="sxs-lookup"><span data-stu-id="2914e-178">Azure AD publishes metadata at https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml.</span></span>

<span data-ttu-id="2914e-179">È consigliabile importare sempre i metadati di hello Azure AD più recenti quando si configura il provider di identità SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="2914e-179">It is recommended that you always import hello latest Azure AD metadata when configuring your SAML 2.0 identity provider.</span></span> <span data-ttu-id="2914e-180">Si noti che Azure AD non legge i metadati dal provider di identità hello.</span><span class="sxs-lookup"><span data-stu-id="2914e-180">Note that Azure AD does not read metadata from hello identity provider.</span></span>

## <a name="add-azure-ad-as-a-relying-party"></a><span data-ttu-id="2914e-181">Aggiungere Azure AD come relying party</span><span class="sxs-lookup"><span data-stu-id="2914e-181">Add Azure AD as a relying party</span></span>
<span data-ttu-id="2914e-182">È necessario tooenable comunicazione tra il provider di identità SAML 2.0 e Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2914e-182">You have tooenable communication between your SAML 2.0 identity provider and Azure AD.</span></span> <span data-ttu-id="2914e-183">Questa configurazione sono dipende dal provider di identità specifico, è consigliabile consultare toodocumentation per tale.</span><span class="sxs-lookup"><span data-stu-id="2914e-183">This configuration will be dependent on your specific identity provider and you should refer toodocumentation for it.</span></span> <span data-ttu-id="2914e-184">In genere è necessario impostare hello relying party ID toohello uguale al valore entityID hello dai metadati hello Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2914e-184">You would typically set hello relying party ID toohello same as hello entityID from hello Azure AD metadata.</span></span>

>[!NOTE]
><span data-ttu-id="2914e-185">Verificare che hello orologio del server di provider di identità SAML 2.0 origine ora precisa tooan sincronizzato.</span><span class="sxs-lookup"><span data-stu-id="2914e-185">Verify hello clock on your SAML 2.0 identity provider server is synchronized tooan accurate time source.</span></span> <span data-ttu-id="2914e-186">Ora non è corretta può causare toofail gli accessi federati.</span><span class="sxs-lookup"><span data-stu-id="2914e-186">An inaccurate clock time can cause federated logins toofail.</span></span>

## <a name="install-windows-powershell-for-sign-on-with-saml-20-identity-provider"></a><span data-ttu-id="2914e-187">Installare Windows PowerShell per l'accesso con il provider di identità SAML 2.0</span><span class="sxs-lookup"><span data-stu-id="2914e-187">Install Windows PowerShell for sign-on with SAML 2.0 identity provider</span></span>
<span data-ttu-id="2914e-188">Dopo aver configurato il provider di identità SAML 2.0 per l'utilizzo con sign-on AD Azure, passaggio successivo hello è toodownload e hello Installa modulo di Azure Active Directory per Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="2914e-188">After you have configured your SAML 2.0 identity provider for use with Azure AD sign-on, hello next step is toodownload and install hello Azure Active Directory Module for Windows PowerShell.</span></span> <span data-ttu-id="2914e-189">Una volta installato, si utilizzerà tooconfigure questi cmdlet i domini di Azure AD come domini federati.</span><span class="sxs-lookup"><span data-stu-id="2914e-189">Once installed, you will use these cmdlets tooconfigure your Azure AD domains as federated domains.</span></span>

<span data-ttu-id="2914e-190">Hello modulo di Azure Active Directory per Windows PowerShell è un download per la gestione dei dati dell'organizzazione in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2914e-190">hello Azure Active Directory Module for Windows PowerShell is a download for managing your organizations data in Azure AD.</span></span> <span data-ttu-id="2914e-191">Questo modulo installa un set di cmdlet tooWindows PowerShell; si esegue tali tooset i cmdlet di accesso single sign-on tooAzure Active Directory e a sua volta i servizi sottoscritti cloud tooall di hello.</span><span class="sxs-lookup"><span data-stu-id="2914e-191">This module installs a set of cmdlets tooWindows PowerShell; you run those cmdlets tooset up single sign-on access tooAzure AD and in turn tooall of hello cloud services you are subscribed to.</span></span> <span data-ttu-id="2914e-192">Per istruzioni su come toodownload e installare hello cmdlet, vedere [http://technet.microsoft.com/library/jj151815.aspx](http://technet.microsoft.com/library/jj151815.aspx)</span><span class="sxs-lookup"><span data-stu-id="2914e-192">For instructions about how toodownload and install hello cmdlets, see [http://technet.microsoft.com/library/jj151815.aspx](http://technet.microsoft.com/library/jj151815.aspx)</span></span>

## <a name="set-up-a-trust-between-your-saml-identity-provider-and-azure-ad"></a><span data-ttu-id="2914e-193">Impostare una relazione di trust tra il provider di identità SAML e Azure AD</span><span class="sxs-lookup"><span data-stu-id="2914e-193">Set up a trust between your SAML identity provider and Azure AD</span></span>
<span data-ttu-id="2914e-194">Prima di configurare la federazione in un dominio di Azure AD, è necessario che sia configurato un dominio personalizzato.</span><span class="sxs-lookup"><span data-stu-id="2914e-194">Before configuring federation on an Azure AD domain, it must have a custom domain configured.</span></span> <span data-ttu-id="2914e-195">È possibile attuare la federazione dominio predefinito hello fornito da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2914e-195">You cannot federate hello default domain that is provided by Microsoft.</span></span> <span data-ttu-id="2914e-196">dominio predefinito Hello Microsoft termina con "onmicrosoft.com".</span><span class="sxs-lookup"><span data-stu-id="2914e-196">hello default domain from Microsoft ends with “onmicrosoft.com”.</span></span>
<span data-ttu-id="2914e-197">È eseguire una serie di cmdlet in tooadd interfaccia della riga di comando di PowerShell di Windows hello o convertire domini per single sign-on.</span><span class="sxs-lookup"><span data-stu-id="2914e-197">You will run a series of cmdlets in hello Windows PowerShell command-line interface tooadd or convert domains for single sign-on.</span></span>

<span data-ttu-id="2914e-198">Ogni dominio di Azure Active Directory che si desidera toofederate utilizzando il provider di identità SAML 2.0 deve essere aggiunto come dominio single sign-on o convertito toobe un dominio single sign-on da dominio standard.</span><span class="sxs-lookup"><span data-stu-id="2914e-198">Each Azure Active Directory domain that you want toofederate using your SAML 2.0 identity provider must either be added as a single sign-on domain or converted toobe a single sign-on domain from a standard domain.</span></span> <span data-ttu-id="2914e-199">Aggiungendo o convertendo un dominio si imposta una relazione di trust tra il provider di identità SAML 2.0 e Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2914e-199">Adding or converting a domain sets up a trust between your SAML 2.0 identity provider and Azure AD.</span></span>

<span data-ttu-id="2914e-200">Hello procedura riportata di seguito viene illustrata la conversione di un dominio standard tooa dominio federato esistente utilizzando SP-Lite di SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="2914e-200">hello following procedure walks you through converting an existing standard domain tooa federated domain using SAML 2.0 SP-Lite.</span></span> <span data-ttu-id="2914e-201">Si noti che il dominio può verificarsi un'interruzione che influisce sugli utenti too2 ore dopo l'esecuzione di questo passaggio.</span><span class="sxs-lookup"><span data-stu-id="2914e-201">Note that your domain may experience an outage that impacts users up too2 hours after you take this step.</span></span>

## <a name="configuring-a-domain-in-your-azure-ad-directory-for-federation"></a><span data-ttu-id="2914e-202">Configurazione di un dominio nella directory di Azure AD per la federazione</span><span class="sxs-lookup"><span data-stu-id="2914e-202">Configuring a domain in your Azure AD Directory for federation</span></span>


1. <span data-ttu-id="2914e-203">La connessione di Azure Active Directory come amministratore tenant tooyour: Connect-MsolService.</span><span class="sxs-lookup"><span data-stu-id="2914e-203">Connect tooyour Azure AD Directory as a tenant administrator: Connect-MsolService .</span></span>
2.  <span data-ttu-id="2914e-204">Configurare la federazione toouse desiderata del dominio Office 365 con SAML 2.0:`$dom = "contoso.com" $BrandName - "Sample SAML 2.0 IDP" $LogOnUrl = "https://WS2012R2-0.contoso.com/passiveLogon" $LogOffUrl = "https://WS2012R2-0.contoso.com/passiveLogOff" $ecpUrl = "https://WS2012R2-0.contoso.com/PAOS" $MyURI = "urn:uri:MySamlp2IDP" $MySigningCert = @" MIIC7jCCAdagAwIBAgIQRrjsbFPaXIlOG3GTv50fkjANBgkqhkiG9w0BAQsFADAzMTEwLwYDVQQDEyh BREZTIFNpZ25pbmcgLSBXUzIwMTJSMi0wLnN3aW5mb3JtZXIuY29tMB4XDTE0MDEyMDE1MTY0MFoXDT E1MDEyMDE1MTY0MFowMzExMC8GA1UEAxMoQURGUyBTaWduaW5nIC0gV1MyMDEyUjItMC5zd2luZm9yb WVyLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKe+rLVmXy1QwCwZwqgbbp1/kupQ VcjKuKLitVDbssFyqbDTjP7WRjlVMWAHBI3kgNT7oE362Gf2WMJFf1b0HcrsgLin7daRXpq4Qi6OA57 sW1YFMj3sqyuTP0eZV3S4+ZbDVob6amsZIdIwxaLP9Zfywg2bLsGnVldB0+XKedZwDbCLCVg+3ZWxd9 T/jV0hpLIIWr+LCOHqq8n8beJvlivgLmDJo8f+EITnAxWcsJUvVai/35AhHCUq9tc9sqMp5PWtabAEM b2AU72/QlX/72D2/NbGQq1BWYbqUpgpCZ2nSgvlWDHlCiUo//UGsvfox01kjTFlmqQInsJVfRxF5AcC AwEAATANBgkqhkiG9w0BAQsFAAOCAQEAi8c6C4zaTEc7aQiUgvnGQgCbMZbhUXXLGRpjvFLKaQzkwa9 eq7WLJibcSNyGXBa/SfT5wJgsm3TPKgSehGAOTirhcqHheZyvBObAScY7GOT+u9pVYp6raFrc7ez3c+ CGHeV/tNvy1hJNs12FYH4X+ZCNFIT9tprieR25NCdi5SWUbPZL0tVzJsHc1y92b2M2FxqRDohxQgJvy JOpcg2mSBzZZIkvDg7gfPSUXHVS1MQs0RHSbwq/XdQocUUhl9/e/YWCbNNxlM84BxFsBUok1dH/gzBy Sx+Fc8zYi7cOq9yaBT3RLT6cGmFGVYZJW4FyhPZOCLVNsLlnPQcX3dDg9A==" "@ $uri = "http://WS2012R2-0.contoso.com/adfs/services/trust" $Protocol = "SAMLP" Set-MsolDomainAuthentication -DomainName $dom -FederationBrandName $dom -Authentication Federated -PassiveLogOnUri $MyURI -ActiveLogOnUri $ecpUrl -SigningCertificate $MySigningCert -IssuerUri $uri -LogOffUri $url -PreferredAuthenticationProtocol $Protocol`</span><span class="sxs-lookup"><span data-stu-id="2914e-204">Configure your desired Office 365 domain toouse federation with SAML 2.0: `$dom = "contoso.com" $BrandName - "Sample SAML 2.0 IDP" $LogOnUrl = "https://WS2012R2-0.contoso.com/passiveLogon" $LogOffUrl = "https://WS2012R2-0.contoso.com/passiveLogOff" $ecpUrl = "https://WS2012R2-0.contoso.com/PAOS" $MyURI = "urn:uri:MySamlp2IDP" $MySigningCert = @" MIIC7jCCAdagAwIBAgIQRrjsbFPaXIlOG3GTv50fkjANBgkqhkiG9w0BAQsFADAzMTEwLwYDVQQDEyh BREZTIFNpZ25pbmcgLSBXUzIwMTJSMi0wLnN3aW5mb3JtZXIuY29tMB4XDTE0MDEyMDE1MTY0MFoXDT E1MDEyMDE1MTY0MFowMzExMC8GA1UEAxMoQURGUyBTaWduaW5nIC0gV1MyMDEyUjItMC5zd2luZm9yb WVyLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKe+rLVmXy1QwCwZwqgbbp1/kupQ VcjKuKLitVDbssFyqbDTjP7WRjlVMWAHBI3kgNT7oE362Gf2WMJFf1b0HcrsgLin7daRXpq4Qi6OA57 sW1YFMj3sqyuTP0eZV3S4+ZbDVob6amsZIdIwxaLP9Zfywg2bLsGnVldB0+XKedZwDbCLCVg+3ZWxd9 T/jV0hpLIIWr+LCOHqq8n8beJvlivgLmDJo8f+EITnAxWcsJUvVai/35AhHCUq9tc9sqMp5PWtabAEM b2AU72/QlX/72D2/NbGQq1BWYbqUpgpCZ2nSgvlWDHlCiUo//UGsvfox01kjTFlmqQInsJVfRxF5AcC AwEAATANBgkqhkiG9w0BAQsFAAOCAQEAi8c6C4zaTEc7aQiUgvnGQgCbMZbhUXXLGRpjvFLKaQzkwa9 eq7WLJibcSNyGXBa/SfT5wJgsm3TPKgSehGAOTirhcqHheZyvBObAScY7GOT+u9pVYp6raFrc7ez3c+ CGHeV/tNvy1hJNs12FYH4X+ZCNFIT9tprieR25NCdi5SWUbPZL0tVzJsHc1y92b2M2FxqRDohxQgJvy JOpcg2mSBzZZIkvDg7gfPSUXHVS1MQs0RHSbwq/XdQocUUhl9/e/YWCbNNxlM84BxFsBUok1dH/gzBy Sx+Fc8zYi7cOq9yaBT3RLT6cGmFGVYZJW4FyhPZOCLVNsLlnPQcX3dDg9A==" "@ $uri = "http://WS2012R2-0.contoso.com/adfs/services/trust" $Protocol = "SAMLP" Set-MsolDomainAuthentication -DomainName $dom -FederationBrandName $dom -Authentication Federated -PassiveLogOnUri $MyURI -ActiveLogOnUri $ecpUrl -SigningCertificate $MySigningCert -IssuerUri $uri -LogOffUri $url -PreferredAuthenticationProtocol $Protocol`</span></span> 

3.  <span data-ttu-id="2914e-205">È possibile ottenere hello stringa con codificata base64 del certificato dal file di metadati di provider di identità di firma.</span><span class="sxs-lookup"><span data-stu-id="2914e-205">You can obtain hello signing certificate base64 encoded string from your IDP metadata file.</span></span> <span data-ttu-id="2914e-206">Di seguito è illustrato un esempio di questo percorso, che tuttavia potrebbe essere leggermente diverso, in base all'implementazione.</span><span class="sxs-lookup"><span data-stu-id="2914e-206">An example of this location has been provided but may differ slightly based on your implementation.</span></span>

    `<IDPSSODescriptor protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"> <KeyDescriptor use="signing"> <KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#"> <X509Data> <X509Certificate>MIIC5jCCAc6gAwIBAgIQLnaxUPzay6ZJsC8HVv/QfTANBgkqhkiG9w0BAQsFADAvMS0wKwYDVQQDEyRBREZTIFNpZ25pbmcgLSBmcy50ZWNobGFiY2VudHJhbC5vcmcwHhcNMTMxMTA0MTgxMzMyWhcNMTQxMTA0MTgxMzMyWjAvMS0wKwYDVQQDEyRBREZTIFNpZ25pbmcgLSBmcy50ZWNobGFiY2VudHJhbC5vcmcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCwMdVLTr5YTSRp+ccbSpuuFeXMfABD9mVCi2wtkRwC30TIyPdORz642MkurdxdPCWjwgJ0HW6TvXwcO9afH3OC5V//wEGDoNcI8PV4enCzTYFe/h//w51uqyv48Fbb3lEXs+aVl8155OAj2sO9IX64OJWKey82GQWK3g7LfhWWpp17j5bKpSd9DBH5pvrV+Q1ESU3mx71TEOvikHGCZYitEPywNeVMLRKrevdWI3FAhFjcCSO6nWDiMqCqiTDYOURXIcHVYTSof1YotkJ4tG6mP5Kpjzd4VQvnR7Pjb47nhIYG6iZ3mR1F85Ns9+hBWukQWNN2hcD/uGdPXhpdMVpBAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAK7h7jF7wPzhZ1dPl4e+XMAr8I7TNbhgEU3+oxKyW/IioQbvZVw1mYVCbGq9Rsw4KE06eSMybqHln3w5EeBbLS0MEkApqHY+p68iRpguqa+W7UHKXXQVgPMCpqxMFKonX6VlSQOR64FgpBme2uG+LJ8reTgypEKspQIN0WvtPWmiq4zAwBp08hAacgv868c0MM4WbOYU0rzMIR6Q+ceGVRImlCwZ5b7XKp4mJZ9hlaRjeuyVrDuzBkzROSurX1OXoci08yJvhbtiBJLf3uPOJHrhjKRwIt2TnzS9ElgFZlJiDIA26Athe73n43CT0af2IG6yC7e6sK4L3NEXJrwwUZk=</X509Certificate> </X509Data> </KeyInfo> </KeyDescriptor>` 

<span data-ttu-id="2914e-207">Per altre informazioni su "Set-MsolDomainAuthentication", vedere: [http://technet.microsoft.com/library/dn194112.aspx](http://technet.microsoft.com/library/dn194112.aspx).</span><span class="sxs-lookup"><span data-stu-id="2914e-207">For more information about “Set-MsolDomainAuthentication”, see: [http://technet.microsoft.com/library/dn194112.aspx](http://technet.microsoft.com/library/dn194112.aspx).</span></span>

>[!NOTE]
><span data-ttu-id="2914e-208">È necessario eseguire "$ecpUrl = “https://WS2012R2-0.contoso.com/PAOS" solo se si configura un'estensione ECP per il provider di identità.</span><span class="sxs-lookup"><span data-stu-id="2914e-208">You must run use “$ecpUrl = “https://WS2012R2-0.contoso.com/PAOS“” only if you set up an ECP extension for your identity provider.</span></span> <span data-ttu-id="2914e-209">I client di Exchange Online, ad eccezione di Outlook Web Application (OWA), usano un endpoint attivo basato su POST.</span><span class="sxs-lookup"><span data-stu-id="2914e-209">Exchange Online clients, excluding Outlook Web Application (OWA), rely on a POST based active end point.</span></span> <span data-ttu-id="2914e-210">Se il servizio token di sicurezza di SAML 2.0 implementa corrispondente implementazione ECP di tooShibboleth simile un punto finale attivo un punto finale attivo è possibile per questi toointeract rich client con hello servizio Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="2914e-210">If your SAML 2.0 STS implements an active end point similar tooShibboleth’s ECP implementation of an active end point it may be possible for these rich clients toointeract with hello Exchange Online service.</span></span>

<span data-ttu-id="2914e-211">Dopo aver configurato la federazione è possibile passare indietro troppo "non federata" o "gestito", tuttavia questa modifica richiede tootwo ore toocomplete e richiede l'assegnazione di nuove password casuali per cloud basato su utente tooeach Accedi.</span><span class="sxs-lookup"><span data-stu-id="2914e-211">Once federation has been configured you can switch back too“non-federated” (or “managed”), however this change takes up tootwo hours toocomplete and it requires assigning new random passwords for cloud based sign-in tooeach user.</span></span> <span data-ttu-id="2914e-212">Passare troppo "gestito" potrebbe essere necessaria in alcuni scenari tooreset un errore nelle impostazioni.</span><span class="sxs-lookup"><span data-stu-id="2914e-212">Switching back too“managed” may be required in some scenarios tooreset an error in your settings.</span></span> <span data-ttu-id="2914e-213">Per altre informazioni sulla conversione del dominio, vedere: [http://msdn.microsoft.com/library/windowsazure/dn194122.aspx](http://msdn.microsoft.com/library/windowsazure/dn194122.aspx).</span><span class="sxs-lookup"><span data-stu-id="2914e-213">For more information on Domain conversion see: [http://msdn.microsoft.com/library/windowsazure/dn194122.aspx](http://msdn.microsoft.com/library/windowsazure/dn194122.aspx).</span></span>

## <a name="provision-user-principals-tooazure-ad--office-365"></a><span data-ttu-id="2914e-214">Eseguire il provisioning utente entità tooAzure AD / Office 365</span><span class="sxs-lookup"><span data-stu-id="2914e-214">Provision user principals tooAzure AD / Office 365</span></span>
<span data-ttu-id="2914e-215">Prima di poter autenticare il tooOffice utenti 365 è necessario eseguire il provisioning di Azure AD con entità corrispondenti asserzione toohello in hello SAML 2.0 attestazione utente.</span><span class="sxs-lookup"><span data-stu-id="2914e-215">Before you can authenticate your users tooOffice 365 you must provision Azure AD with user principals that correspond toohello assertion in hello SAML 2.0 claim.</span></span> <span data-ttu-id="2914e-216">Se queste entità utente non sono note in anticipo tooAzure AD quindi non possono essere utilizzati per l'accesso federato.</span><span class="sxs-lookup"><span data-stu-id="2914e-216">If these user principals are not known tooAzure AD in advance then they cannot be used for federated sign-in.</span></span> <span data-ttu-id="2914e-217">Azure AD Connect o Windows PowerShell può essere utilizzato tooprovision utente entità.</span><span class="sxs-lookup"><span data-stu-id="2914e-217">Either Azure AD Connect or Windows PowerShell can be used tooprovision user principals.</span></span>

<span data-ttu-id="2914e-218">Azure AD Connect può essere utilizzato tooprovision entità tooyour domini in Azure Active Directory da hello Active Directory locale.</span><span class="sxs-lookup"><span data-stu-id="2914e-218">Azure AD Connect can be used tooprovision principals tooyour domains in your Azure AD Directory from hello on-premises Active Directory.</span></span> <span data-ttu-id="2914e-219">Per informazioni più dettagliate, vedere [Integrare le directory locali con Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="2914e-219">For more detailed information, see [Integrate your on-premises directories with Azure Active Directory](active-directory-aadconnect.md).</span></span>

<span data-ttu-id="2914e-220">Windows PowerShell può essere anche usato tooautomate aggiunta di nuovi utenti tooAzure AD e toosynchronize le modifiche dalla directory locale hello.</span><span class="sxs-lookup"><span data-stu-id="2914e-220">Windows PowerShell can also be used tooautomate adding new users tooAzure AD and toosynchronize changes from hello on-premises directory.</span></span> <span data-ttu-id="2914e-221">hello toouse cmdlet di Windows PowerShell, è necessario scaricare hello [moduli di Azure Active Directory](https://docs.microsoft.com/powershell/azure/install-adv2?view=azureadps-2.0).</span><span class="sxs-lookup"><span data-stu-id="2914e-221">toouse hello Windows PowerShell cmdlets you must download hello [Azure Active Directory Modules](https://docs.microsoft.com/powershell/azure/install-adv2?view=azureadps-2.0).</span></span>

<span data-ttu-id="2914e-222">Questa procedura viene illustrato come tooadd tooAzure un singolo utente AD.</span><span class="sxs-lookup"><span data-stu-id="2914e-222">This procedure shows how tooadd a single user tooAzure AD.</span></span>


1. <span data-ttu-id="2914e-223">La connessione di Azure Active Directory come amministratore tenant tooyour: Connect-MsolService.</span><span class="sxs-lookup"><span data-stu-id="2914e-223">Connect tooyour Azure AD Directory as a tenant administrator: Connect-MsolService.</span></span>
2.  <span data-ttu-id="2914e-224">Creare una nuova entità utente: ` New-MsolUser
        -UserPrincipalName elwoodf1@contoso.com
        -ImmutableId ABCDEFG1234567890
        -DisplayName "Elwood Folk"
        -FirstName Elwood 
        -LastName Folk 
        -AlternateEmailAddresses "Elwood.Folk@contoso.com" 
        -LicenseAssignment "samlp2test:ENTERPRISEPACK" 
        -UsageLocation "US" `</span><span class="sxs-lookup"><span data-stu-id="2914e-224">Create a new user principal: ` New-MsolUser
        -UserPrincipalName elwoodf1@contoso.com
    -ImmutableId ABCDEFG1234567890
    -DisplayName "Elwood Folk"
    -FirstName Elwood 
    -LastName Folk 
    -AlternateEmailAddresses "Elwood.Folk@contoso.com" 
    -LicenseAssignment "samlp2test:ENTERPRISEPACK" 
    -UsageLocation "US" `</span></span> 

<span data-ttu-id="2914e-225">Per altre informazioni su "New-MsolUser", vedere [http://technet.microsoft.com/library/dn194096.aspx](http://technet.microsoft.com/library/dn194096.aspx)</span><span class="sxs-lookup"><span data-stu-id="2914e-225">For more information about “New-MsolUser” check out, [http://technet.microsoft.com/library/dn194096.aspx](http://technet.microsoft.com/library/dn194096.aspx)</span></span>

>[!NOTE]
><span data-ttu-id="2914e-226">Hello "UserPrinciplName" valore deve corrispondere il valore hello che verrà inviato per "IDPEmail" nell'attestazione SAML 2.0 e hello "ImmutableID" valore deve corrispondere il valore di hello inviato l'asserzione "NameID".</span><span class="sxs-lookup"><span data-stu-id="2914e-226">hello “UserPrinciplName” value must match hello value that you will send for “IDPEmail” in your SAML 2.0 claim and hello “ImmutableID” value must match hello value sent in your “NameID” assertion.</span></span>

## <a name="verify-single-sign-on-with-your-saml-20-idp"></a><span data-ttu-id="2914e-227">Verificare l'accesso Single Sign-On con l'IdP SAML 2.0</span><span class="sxs-lookup"><span data-stu-id="2914e-227">Verify single sign-on with your SAML 2.0 IDP</span></span>
<span data-ttu-id="2914e-228">Come amministratore di hello, prima di verificare e gestire single sign-on (anche noto federazione delle identità), esaminare le informazioni di hello ed eseguire i passaggi di hello in hello tooset gli articoli di single sign-on con il provider di identità basato sul SP-Lite di SAML 2.0 seguenti:</span><span class="sxs-lookup"><span data-stu-id="2914e-228">As hello administrator, before you verify and manage single sign-on (also called identity federation), review hello information and perform hello steps in hello following articles tooset up single sign-on with your SAML 2.0 SP-Lite based identity provider:</span></span>


1.  <span data-ttu-id="2914e-229">Si è rivisti hello requisiti del protocollo SAML 2.0 per Azure AD</span><span class="sxs-lookup"><span data-stu-id="2914e-229">You have reviewed hello Azure AD SAML 2.0 Protocol Requirements</span></span>
2.  <span data-ttu-id="2914e-230">Il provider di identità SAML 2.0 è stato configurato</span><span class="sxs-lookup"><span data-stu-id="2914e-230">You have configured your SAML 2.0 identity provider</span></span>
3.  <span data-ttu-id="2914e-231">Installare Windows PowerShell per l'accesso Single Sign-On con il provider di identità SAML 2.0</span><span class="sxs-lookup"><span data-stu-id="2914e-231">Install Windows PowerShell for single sign-on with SAML 2.0 identity provider</span></span>
4.  <span data-ttu-id="2914e-232">Impostare una relazione di trust tra il provider di identità SAML 2.0 e Azure AD</span><span class="sxs-lookup"><span data-stu-id="2914e-232">Set up a trust between SAML 2.0 identity provider and Azure AD</span></span>
5.  <span data-ttu-id="2914e-233">Effettuare il provisioning di un test nota utente principale tooAzure Active Directory (Office 365) mediante Windows PowerShell o Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="2914e-233">Provisioned a known test user principal tooAzure Active Directory (Office 365) either through Windows PowerShell or Azure AD Connect.</span></span>
6.  <span data-ttu-id="2914e-234">Configurare la sincronizzazione della directory usando [Azure AD Connect](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="2914e-234">Configure directory synchronization using [Azure AD Connect](active-directory-aadconnect.md).</span></span>

<span data-ttu-id="2914e-235">Dopo avere configurato l'accesso Single Sign-On con il provider di identità basato su SP-Lite SAML 2.0, è necessario verificare che funzioni correttamente.</span><span class="sxs-lookup"><span data-stu-id="2914e-235">After setting up single sign-on with your SAML 2.0 SP-Lite based identity Provider, you should verify that it is working correctly.</span></span>

>[!NOTE]
><span data-ttu-id="2914e-236">Se la conversione di un dominio, invece di aggiunta di uno, potrebbe richiedere fino a too24 ore tooset di single sign-on.</span><span class="sxs-lookup"><span data-stu-id="2914e-236">If you converted a domain, rather than adding one, it may take up too24 hours tooset up single sign-on.</span></span>
<span data-ttu-id="2914e-237">Prima di verificare l'accesso Single Sign-On, completare la configurazione della sincronizzazione di Active Directory, sincronizzare le directory e attivare gli utenti sincronizzati.</span><span class="sxs-lookup"><span data-stu-id="2914e-237">Before you verify single sign-on, you should finish setting up Active Directory synchronization, synchronize your directories, and activate your synced users.</span></span>

### <a name="use-hello-tool-tooverify-that-single-sign-on-has-been-set-up-correctly"></a><span data-ttu-id="2914e-238">Utilizzare hello strumento tooverify che l'accesso single sign-on è stato configurato correttamente</span><span class="sxs-lookup"><span data-stu-id="2914e-238">Use hello tool tooverify that single sign-on has been set up correctly</span></span>
<span data-ttu-id="2914e-239">tooverify che single sign-on sia stato configurato correttamente, è possibile eseguire hello seguendo procedure tooconfirm che si è in grado di toosign nel servizio cloud toohello con le credenziali aziendali.</span><span class="sxs-lookup"><span data-stu-id="2914e-239">tooverify that single sign-on has been set up correctly, you can perform hello following procedure tooconfirm that you are able toosign in toohello cloud service with your corporate credentials.</span></span>

<span data-ttu-id="2914e-240">Microsoft ha fornito uno strumento che è possibile utilizzare tootest il SAML 2.0 basato su provider di identità.</span><span class="sxs-lookup"><span data-stu-id="2914e-240">Microsoft has provided a tool that you can use tootest your SAML 2.0 based identity provider.</span></span> <span data-ttu-id="2914e-241">Prima di eseguire hello testare lo strumento è necessario aver configurato un toofederate tenant di Azure AD con il provider di identità.</span><span class="sxs-lookup"><span data-stu-id="2914e-241">Before running hello test tool you must have configured an Azure AD tenant toofederate with your identity provider.</span></span>

>[!NOTE]
><span data-ttu-id="2914e-242">Hello analizzatore connettività richiede Internet Explorer 10 o versioni successive.</span><span class="sxs-lookup"><span data-stu-id="2914e-242">hello Connectivity Analyzer requires Internet Explorer 10 or later.</span></span>



1. <span data-ttu-id="2914e-243">Download hello analizzatore di connettività, [https://testconnectivity.microsoft.com/?tabid=Client](https://testconnectivity.microsoft.com/?tabid=Client).</span><span class="sxs-lookup"><span data-stu-id="2914e-243">Download hello Connectivity Analyzer from, [https://testconnectivity.microsoft.com/?tabid=Client](https://testconnectivity.microsoft.com/?tabid=Client).</span></span>
2.  <span data-ttu-id="2914e-244">Fare clic su Installa toobegin download e installazione dello strumento hello.</span><span class="sxs-lookup"><span data-stu-id="2914e-244">Click Install Now toobegin downloading and installing hello tool.</span></span>
3.  <span data-ttu-id="2914e-245">Selezionare "I can't set up federation with Office 365, Azure, or other services that use Azure Active Directory" (Impossibile configurare la federazione con Office 365, Azure o altri servizi che usano Azure Active Directory).</span><span class="sxs-lookup"><span data-stu-id="2914e-245">Select “I can’t set up federation with Office 365, Azure, or other services that use Azure Active Directory”.</span></span>
4.  <span data-ttu-id="2914e-246">Una volta hello strumento viene scaricato e in esecuzione, si noterà finestra diagnostica della connettività hello.</span><span class="sxs-lookup"><span data-stu-id="2914e-246">Once hello tool is downloaded and running, you will see hello Connectivity Diagnostics window.</span></span> <span data-ttu-id="2914e-247">strumento Hello passerà attraverso la connessione della federazione di test.</span><span class="sxs-lookup"><span data-stu-id="2914e-247">hello tool will step you through testing your federation connection.</span></span>
5.  <span data-ttu-id="2914e-248">Hello analizzatore connettività verrà aperto il provider di identità SAML 2.0 per è toologon, immettere le credenziali di hello per testare dell'entità utente di hello: ![SAML](media/active-directory-aadconnect-federation-saml-idp/saml1.png)</span><span class="sxs-lookup"><span data-stu-id="2914e-248">hello Connectivity Analyzer will open your SAML 2.0 IDP for you toologon, enter hello credentials for hello user principal you are testing: ![SAML](media/active-directory-aadconnect-federation-saml-idp/saml1.png)</span></span>
6.  <span data-ttu-id="2914e-249">Hello federazione prova nella finestra di accesso che è necessario immettere un nome account e password per tenant di Azure AD hello toobe configurato federata con il provider di identità SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="2914e-249">At hello Federation test sign-in window you should enter an account name and password for hello Azure AD tenant that is configured toobe federated with your SAML 2.0 identity provider.</span></span> <span data-ttu-id="2914e-250">strumento Hello tenterà toosign aggiuntivo utilizzando queste credenziali e i risultati dettagliati dei test eseguiti durante il tentativo di accesso hello verranno forniti come output.</span><span class="sxs-lookup"><span data-stu-id="2914e-250">hello tool will attempt toosign-in using those credentials and detailed results of tests performed during hello sign-in attempt will be provided as output.</span></span>
<span data-ttu-id="2914e-251">![SAML](media/active-directory-aadconnect-federation-saml-idp/saml2.png)</span><span class="sxs-lookup"><span data-stu-id="2914e-251">![SAML](media/active-directory-aadconnect-federation-saml-idp/saml2.png)</span></span>
7. <span data-ttu-id="2914e-252">Questa finestra mostra il risultato di un test non riuscito.</span><span class="sxs-lookup"><span data-stu-id="2914e-252">This window shows a failed result of testing.</span></span> <span data-ttu-id="2914e-253">Facendo clic su Controlla i risultati dettagliati verranno visualizzate informazioni sui risultati di hello per ogni test eseguito.</span><span class="sxs-lookup"><span data-stu-id="2914e-253">Clicking on Review detailed results will show information about hello results for each test that was performed.</span></span> <span data-ttu-id="2914e-254">È inoltre possibile salvare toodisk risultati hello in ordine tooshare li.</span><span class="sxs-lookup"><span data-stu-id="2914e-254">You can also save hello results toodisk in order tooshare them.</span></span>
 
>[!NOTE]
><span data-ttu-id="2914e-255">Hello analizzatore connettività inoltre verifica la federazione attiva con hello WS *-i protocolli di base ed ECP/PAOS.</span><span class="sxs-lookup"><span data-stu-id="2914e-255">hello Connectivity analyzer also tests Active Federation using hello WS*-based and ECP/PAOS protocols.</span></span> <span data-ttu-id="2914e-256">Se non si usano questi è possibile ignorare hello il seguente errore: test hello flusso di accesso Active utilizzando l'endpoint di federazione attivo del provider di identità.</span><span class="sxs-lookup"><span data-stu-id="2914e-256">If you are not using these you can disregard hello following error: Testing hello Active sign-in flow using your identity provider’s Active federation endpoint.</span></span>

### <a name="manually-verify-that-single-sign-on-has-been-set-up-correctly"></a><span data-ttu-id="2914e-257">Verificare manualmente la corretta configurazione di Single Sign-On</span><span class="sxs-lookup"><span data-stu-id="2914e-257">Manually verify that single sign-on has been set up correctly</span></span>
<span data-ttu-id="2914e-258">Verifica manuale comporta i passaggi aggiuntivi che è possibile eseguire tooensure che il Provider di identità SAML 2.0 funzioni correttamente in molti scenari.</span><span class="sxs-lookup"><span data-stu-id="2914e-258">Manual verification provides additional steps that you can take tooensure that your SAML 2.0 identity Provider is working properly in many scenarios.</span></span>
<span data-ttu-id="2914e-259">tooverify che l'accesso single sign-on è stato configurato correttamente, completare hello seguenti passaggi:</span><span class="sxs-lookup"><span data-stu-id="2914e-259">tooverify that single sign-on has been set up correctly, complete hello following steps:</span></span>


1. <span data-ttu-id="2914e-260">In un computer aggiunto al dominio, accedere nel servizio cloud tooyour utilizzando hello stesso nome utilizzato per le credenziali aziendali di accesso.</span><span class="sxs-lookup"><span data-stu-id="2914e-260">On a domain-joined computer, sign in tooyour cloud service using hello same logon name that you use for your corporate credentials.</span></span>
2.  <span data-ttu-id="2914e-261">Fare clic nella casella password hello.</span><span class="sxs-lookup"><span data-stu-id="2914e-261">Click inside hello password box.</span></span> <span data-ttu-id="2914e-262">Se l'accesso single sign-on è impostato, hello password casella sarà ombreggiata e verrà visualizzato hello seguente messaggio: "sono ora necessari toosign in a <your company>."</span><span class="sxs-lookup"><span data-stu-id="2914e-262">If single sign-on is set up, hello password box will be shaded, and you will see hello following message: “You are now required toosign in at <your company>.”</span></span>
3.  <span data-ttu-id="2914e-263">Fare clic su hello Accedi a <your company> collegamento.</span><span class="sxs-lookup"><span data-stu-id="2914e-263">Click hello Sign in at <your company> link.</span></span> <span data-ttu-id="2914e-264">Se si è in grado di toosign in, quindi accesso single sign-on è stato impostato.</span><span class="sxs-lookup"><span data-stu-id="2914e-264">If you are able toosign in, then single sign-on has been set up.</span></span>

## <a name="next-steps"></a><span data-ttu-id="2914e-265">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="2914e-265">Next Steps</span></span>


- [<span data-ttu-id="2914e-266">Gestione e personalizzazione di Active Directory Federation Services con Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="2914e-266">Active Directory Federation Services management and customization with Azure AD Connect</span></span>](active-directory-aadconnect-federation-management.md)
- [<span data-ttu-id="2914e-267">Elenco di compatibilità di federazione di Azure AD</span><span class="sxs-lookup"><span data-stu-id="2914e-267">Azure AD federation compatibility list</span></span>](active-directory-aadconnect-federation-compatibility.md)
- [<span data-ttu-id="2914e-268">Installazione personalizzata di Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="2914e-268">Azure AD Connect Custom Installation</span></span>](active-directory-aadconnect-get-started-custom.md)
