---
title: Considerazioni sulla rete per un ambiente del servizio app di Azure
description: Viene spiegato il traffico di rete dell'ambiente del servizio app e come impostare gruppi di sicurezza di rete (NSG) e route definite dall'utente (UDR) con l'ambiente del servizio app
services: app-service
documentationcenter: na
author: ccompy
manager: stefsch
ms.assetid: 955a4d84-94ca-418d-aa79-b57a5eb8cb85
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/08/2017
ms.author: ccompy
ms.openlocfilehash: 3be0d7a202ff53f5532fd7169a50a04cfaf88832
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/29/2017
---
# <a name="networking-considerations-for-an-app-service-environment"></a><span data-ttu-id="49a2d-103">Considerazioni sulla rete per un ambiente del servizio app</span><span class="sxs-lookup"><span data-stu-id="49a2d-103">Networking considerations for an App Service environment</span></span> #

## <a name="overview"></a><span data-ttu-id="49a2d-104">Panoramica</span><span class="sxs-lookup"><span data-stu-id="49a2d-104">Overview</span></span> ##

 <span data-ttu-id="49a2d-105">L'[ambiente del servizio app di Azure][Intro] è una distribuzione di Servizio app di Azure in una subnet nella rete virtuale di Azure (VNet).</span><span class="sxs-lookup"><span data-stu-id="49a2d-105">Azure [App Service Environment][Intro] is a deployment of Azure App Service into a subnet in your Azure virtual network (VNet).</span></span> <span data-ttu-id="49a2d-106">È possibile distribuire un ambiente del servizio app in due modi:</span><span class="sxs-lookup"><span data-stu-id="49a2d-106">There are two deployment types for an App Service environment (ASE):</span></span>

- <span data-ttu-id="49a2d-107">**Ambiente del servizio app esterno**: espone le app ospitate dall'ambiente del servizio app su un indirizzo IP accessibile da Internet.</span><span class="sxs-lookup"><span data-stu-id="49a2d-107">**External ASE**: Exposes the ASE-hosted apps on an internet-accessible IP address.</span></span> <span data-ttu-id="49a2d-108">Per altre informazioni, vedere [Create an External ASE][MakeExternalASE] (Creare un ambiente del servizio app esterno).</span><span class="sxs-lookup"><span data-stu-id="49a2d-108">For more information, see [Create an External ASE][MakeExternalASE].</span></span>
- <span data-ttu-id="49a2d-109">**Ambiente del servizio app con bilanciamento del carico interno**: espone le app ospitate dall'ambiente del servizio app su un indirizzo IP all'interno della VNet.</span><span class="sxs-lookup"><span data-stu-id="49a2d-109">**ILB ASE**: Exposes the ASE-hosted apps on an IP address inside your VNet.</span></span> <span data-ttu-id="49a2d-110">L'endpoint interno è un servizio di bilanciamento del carico interno (ILB, Internal Load Balancer) ed è per questo motivo che si usa la definizione "ambiente del servizio app con bilanciamento del carico interno".</span><span class="sxs-lookup"><span data-stu-id="49a2d-110">The internal endpoint is an internal load balancer (ILB), which is why it's called an ILB ASE.</span></span> <span data-ttu-id="49a2d-111">Per altre informazioni, vedere [Create and use an ILB ASE][MakeILBASE] (Creare e usare un ambiente del servizio app ILB).</span><span class="sxs-lookup"><span data-stu-id="49a2d-111">For more information, see [Create and use an ILB ASE][MakeILBASE].</span></span>

<span data-ttu-id="49a2d-112">Esistono ora due versioni dell'ambiente del servizio app: ASEv1 e ASEv2.</span><span class="sxs-lookup"><span data-stu-id="49a2d-112">There are now two versions of App Service Environment: ASEv1 and ASEv2.</span></span> <span data-ttu-id="49a2d-113">Per informazioni sulla versione ASEv1, vedere [Introduzione all'ambiente del servizio app][ASEv1Intro].</span><span class="sxs-lookup"><span data-stu-id="49a2d-113">For information on ASEv1, see [Introduction to App Service Environment v1][ASEv1Intro].</span></span> <span data-ttu-id="49a2d-114">Un ambiente ASEv1 può essere distribuito in una rete virtuale classica o di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="49a2d-114">ASEv1 can be deployed in a classic or Resource Manager VNet.</span></span> <span data-ttu-id="49a2d-115">Un ambiente ASEv2 può essere distribuito solo in una rete virtuale di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="49a2d-115">ASEv2 can only be deployed into a Resource Manager VNet.</span></span>

<span data-ttu-id="49a2d-116">Tutte le chiamate da un ambiente del servizio app indirizzate a Internet lasciano la rete virtuale tramite un indirizzo VIP assegnato per l'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-116">All calls from an ASE that go to the internet leave the VNet through a VIP assigned for the ASE.</span></span> <span data-ttu-id="49a2d-117">L'indirizzo IP pubblico di questo indirizzo VIP è quindi l'indirizzo IP di origine per tutte le chiamate dall'ambiente del servizio app indirizzate a Internet.</span><span class="sxs-lookup"><span data-stu-id="49a2d-117">The public IP of this VIP is then the source IP for all calls from the ASE that go to the internet.</span></span> <span data-ttu-id="49a2d-118">Se le app nell'ambiente del servizio app effettuano chiamate a risorse nella rete virtuale o tramite una VPN, l'IP di origine sarà uno degli indirizzi IP nella subnet usata dall'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-118">If the apps in your ASE make calls to resources in your VNet or across a VPN, the source IP is one of the IPs in the subnet used by your ASE.</span></span> <span data-ttu-id="49a2d-119">Dato che l'ambiente del servizio app è all'interno della rete virtuale, consente anche di accedere alle risorse all'interno della rete virtuale senza ulteriori configurazioni.</span><span class="sxs-lookup"><span data-stu-id="49a2d-119">Because the ASE is within the VNet, it can also access resources within the VNet without any additional configuration.</span></span> <span data-ttu-id="49a2d-120">Se la rete virtuale è connessa alla rete locale, le app nell'ambiente del servizio app hanno accesso anche alle relative risorse.</span><span class="sxs-lookup"><span data-stu-id="49a2d-120">If the VNet is connected to your on-premises network, apps in your ASE also have access to resources there.</span></span> <span data-ttu-id="49a2d-121">Non è necessario configurare ulteriormente l'ambiente del servizio app o l'app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-121">You don't need to configure the ASE or your app any further.</span></span>

![Ambiente del servizio app esterno][1] 

<span data-ttu-id="49a2d-123">Se si dispone di un ambiente del servizio app esterno, il VIP pubblico è anche l'endpoint in cui si risolvono le app dell'ambiente del servizio app per:</span><span class="sxs-lookup"><span data-stu-id="49a2d-123">If you have an External ASE, the public VIP is also the endpoint that your ASE apps resolve to for:</span></span>

* <span data-ttu-id="49a2d-124">HTTP/S.</span><span class="sxs-lookup"><span data-stu-id="49a2d-124">HTTP/S.</span></span> 
* <span data-ttu-id="49a2d-125">FTP/S.</span><span class="sxs-lookup"><span data-stu-id="49a2d-125">FTP/S.</span></span> 
* <span data-ttu-id="49a2d-126">Distribuzione Web.</span><span class="sxs-lookup"><span data-stu-id="49a2d-126">Web deployment.</span></span>
* <span data-ttu-id="49a2d-127">Debug remoto.</span><span class="sxs-lookup"><span data-stu-id="49a2d-127">Remote debugging.</span></span>

![Ambiente del servizio app con bilanciamento del carico interno][2]

<span data-ttu-id="49a2d-129">Se è disponibile un ambiente del servizio app con bilanciamento del carico interno, l'indirizzo IP del servizio di bilanciamento del carico interno è l'endpoint per HTTP/S, FTP/S, la distribuzione Web e il debug remoto.</span><span class="sxs-lookup"><span data-stu-id="49a2d-129">If you have an ILB ASE, the IP address of the ILB is the endpoint for HTTP/S, FTP/S, web deployment, and remote debugging.</span></span>

<span data-ttu-id="49a2d-130">Le porte di accesso alle app normali sono:</span><span class="sxs-lookup"><span data-stu-id="49a2d-130">The normal app access ports are:</span></span>

| <span data-ttu-id="49a2d-131">Uso</span><span class="sxs-lookup"><span data-stu-id="49a2d-131">Use</span></span> | <span data-ttu-id="49a2d-132">Da</span><span class="sxs-lookup"><span data-stu-id="49a2d-132">From</span></span> | <span data-ttu-id="49a2d-133">A</span><span class="sxs-lookup"><span data-stu-id="49a2d-133">To</span></span> |
|----------|---------|-------------|
|  <span data-ttu-id="49a2d-134">HTTP/HTTPS</span><span class="sxs-lookup"><span data-stu-id="49a2d-134">HTTP/HTTPS</span></span>  | <span data-ttu-id="49a2d-135">Configurabile dall'utente</span><span class="sxs-lookup"><span data-stu-id="49a2d-135">User configurable</span></span> |  <span data-ttu-id="49a2d-136">80, 443</span><span class="sxs-lookup"><span data-stu-id="49a2d-136">80, 443</span></span> |
|  <span data-ttu-id="49a2d-137">FTP/FTPS</span><span class="sxs-lookup"><span data-stu-id="49a2d-137">FTP/FTPS</span></span>    | <span data-ttu-id="49a2d-138">Configurabile dall'utente</span><span class="sxs-lookup"><span data-stu-id="49a2d-138">User configurable</span></span> |  <span data-ttu-id="49a2d-139">21, 990, 10001-10020</span><span class="sxs-lookup"><span data-stu-id="49a2d-139">21, 990, 10001-10020</span></span> |
|  <span data-ttu-id="49a2d-140">Debug remoto in Visual Studio</span><span class="sxs-lookup"><span data-stu-id="49a2d-140">Visual Studio remote debugging</span></span>  |  <span data-ttu-id="49a2d-141">Configurabile dall'utente</span><span class="sxs-lookup"><span data-stu-id="49a2d-141">User configurable</span></span> |  <span data-ttu-id="49a2d-142">4016, 4018, 4020, 4022</span><span class="sxs-lookup"><span data-stu-id="49a2d-142">4016, 4018, 4020, 4022</span></span> |

<span data-ttu-id="49a2d-143">Ciò vale se si usa un ambiente del servizio app esterno o con bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="49a2d-143">This is true if you're on an External ASE or on an ILB ASE.</span></span> <span data-ttu-id="49a2d-144">Se si è su un ambiente del servizio app esterno, tali porte possono essere raggiunte sul VIP pubblico.</span><span class="sxs-lookup"><span data-stu-id="49a2d-144">If you're on an External ASE, you hit those ports on the public VIP.</span></span> <span data-ttu-id="49a2d-145">Se si è su un ambiente del servizio app con bilanciamento del carico interno, tali porte possono essere raggiunte sul servizio di bilanciamento del carico interno.</span><span class="sxs-lookup"><span data-stu-id="49a2d-145">If you're on an ILB ASE, you hit those ports on the ILB.</span></span> <span data-ttu-id="49a2d-146">Il blocco della porta 443 ha un possibile impatto su alcune funzionalità esposte nel portale.</span><span class="sxs-lookup"><span data-stu-id="49a2d-146">If you lock down port 443, there can be an effect on some features exposed in the portal.</span></span> <span data-ttu-id="49a2d-147">Per altre informazioni, vedere [Dipendenze per il portale](#portaldep).</span><span class="sxs-lookup"><span data-stu-id="49a2d-147">For more information, see [Portal dependencies](#portaldep).</span></span>

## <a name="ase-dependencies"></a><span data-ttu-id="49a2d-148">Dipendenze dell'ambiente del servizio app</span><span class="sxs-lookup"><span data-stu-id="49a2d-148">ASE dependencies</span></span> ##

<span data-ttu-id="49a2d-149">Una dipendenza per l'accesso in ingresso dell'ambiente del servizio app è:</span><span class="sxs-lookup"><span data-stu-id="49a2d-149">An ASE inbound access dependency is:</span></span>

| <span data-ttu-id="49a2d-150">Uso</span><span class="sxs-lookup"><span data-stu-id="49a2d-150">Use</span></span> | <span data-ttu-id="49a2d-151">Da</span><span class="sxs-lookup"><span data-stu-id="49a2d-151">From</span></span> | <span data-ttu-id="49a2d-152">A</span><span class="sxs-lookup"><span data-stu-id="49a2d-152">To</span></span> |
|-----|------|----|
| <span data-ttu-id="49a2d-153">gestione</span><span class="sxs-lookup"><span data-stu-id="49a2d-153">Management</span></span> | <span data-ttu-id="49a2d-154">Indirizzi di gestione del servizio app</span><span class="sxs-lookup"><span data-stu-id="49a2d-154">App Service management addresses</span></span> | <span data-ttu-id="49a2d-155">Subnet dell'ambiente del servizio app: 454, 455</span><span class="sxs-lookup"><span data-stu-id="49a2d-155">ASE subnet: 454, 455</span></span> |
|  <span data-ttu-id="49a2d-156">Comunicazione interna dell'ambiente del servizio app</span><span class="sxs-lookup"><span data-stu-id="49a2d-156">ASE internal communication</span></span> | <span data-ttu-id="49a2d-157">Subnet dell'ambiente del servizio app: tutte le porte</span><span class="sxs-lookup"><span data-stu-id="49a2d-157">ASE subnet: All ports</span></span> | <span data-ttu-id="49a2d-158">Subnet dell'ambiente del servizio app: tutte le porte</span><span class="sxs-lookup"><span data-stu-id="49a2d-158">ASE subnet: All ports</span></span>
|  <span data-ttu-id="49a2d-159">Consenti bilanciamento del carico di Azure in ingresso</span><span class="sxs-lookup"><span data-stu-id="49a2d-159">Allow Azure load balancer inbound</span></span> | <span data-ttu-id="49a2d-160">Servizio di bilanciamento del carico di Azure</span><span class="sxs-lookup"><span data-stu-id="49a2d-160">Azure load balancer</span></span> | <span data-ttu-id="49a2d-161">Subnet dell'ambiente del servizio app: tutte le porte</span><span class="sxs-lookup"><span data-stu-id="49a2d-161">ASE subnet: All ports</span></span>
|  <span data-ttu-id="49a2d-162">Indirizzi IP assegnati alle app</span><span class="sxs-lookup"><span data-stu-id="49a2d-162">App assigned IP addresses</span></span> | <span data-ttu-id="49a2d-163">Indirizzi assegnati alle app</span><span class="sxs-lookup"><span data-stu-id="49a2d-163">App assigned addresses</span></span> | <span data-ttu-id="49a2d-164">Subnet dell'ambiente del servizio app: tutte le porte</span><span class="sxs-lookup"><span data-stu-id="49a2d-164">ASE subnet: All ports</span></span>

<span data-ttu-id="49a2d-165">Il traffico in ingresso fornisce comandi e controllo dell'ambiente del servizio app oltre al monitoraggio del sistema.</span><span class="sxs-lookup"><span data-stu-id="49a2d-165">The inbound traffic provides command and control of the ASE in addition to system monitoring.</span></span> <span data-ttu-id="49a2d-166">Gli IP di origine per il traffico sono indicati nel documento [Indirizzi di gestione dell'Ambiente del servizio app][ASEManagement].</span><span class="sxs-lookup"><span data-stu-id="49a2d-166">The source IPs for this traffic are listed in the [ASE Management addresses][ASEManagement] document.</span></span> <span data-ttu-id="49a2d-167">La configurazione della sicurezza di rete deve consentire l'accesso da tutti gli indirizzi IP sulle porte 454 e 455.</span><span class="sxs-lookup"><span data-stu-id="49a2d-167">The network security configuration needs to allow access from all IPs on ports 454 and 455.</span></span>

<span data-ttu-id="49a2d-168">All'interno della subnet dell'ambiente del servizio app ci sono molte porte usate per la comunicazioni dei componenti interni e che possono cambiare.</span><span class="sxs-lookup"><span data-stu-id="49a2d-168">Within the ASE subnet there are many ports used for internal component communication and they can change.</span></span>  <span data-ttu-id="49a2d-169">Per questo motivo, è necessario che a tutte le porte nella subnet dell'ambiente del servizio app sia possibile accedere dalla subnet dell'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-169">This requires all of the ports in the ASE subnet to be accessible from the ASE subnet.</span></span> 

<span data-ttu-id="49a2d-170">Per le comunicazioni tra Azure Load Balancer e la subnet dell'ambiente del servizio app, le porte minime che devono essere aperte sono le porte 454, 455 e 16001.</span><span class="sxs-lookup"><span data-stu-id="49a2d-170">For the communication between the Azure load balancer and the ASE subnet the minimum ports that need to be open are 454, 455 and 16001.</span></span> <span data-ttu-id="49a2d-171">La porta 16001 viene usata per mantenere attivo il traffico tra il servizio di bilanciamento del carico e l'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-171">The 16001 port is used for keep alive traffic between the load balancer and the ASE.</span></span> <span data-ttu-id="49a2d-172">Se si usa un ambiente del servizio app ILB, è possibile limitare il traffico alle porte 454, 455 e 16001.</span><span class="sxs-lookup"><span data-stu-id="49a2d-172">If you are using an ILB ASE then you can lock traffic down to just the 454, 455, 16001 ports.</span></span>  <span data-ttu-id="49a2d-173">Se si usa un ambiente del servizio app esterno, è necessario prendere in considerazione le normali porte di accesso delle app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-173">If you are using an External ASE then you need to take into account the normal app access ports.</span></span>  <span data-ttu-id="49a2d-174">Se si usano indirizzi assegnati alle app, è necessario aprire tutte le porte.</span><span class="sxs-lookup"><span data-stu-id="49a2d-174">If you are using app assigned addresses you need to open it to all ports.</span></span>  <span data-ttu-id="49a2d-175">Quando un indirizzo è assegnato a un'app specifica, il servizio di bilanciamento del carico usa porte non conosciute in anticipo per inviare il traffico HTTP e HTTPS all'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-175">When an address is assigned to a specific app, then the load balancer will use ports that are not known of in advance to send HTTP and HTTPS traffic to the ASE.</span></span>

<span data-ttu-id="49a2d-176">Se si usano indirizzi IP assegnati alle app, è necessario consentire il traffico dagli indirizzi IP assegnati alle app alla subnet dell'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-176">If you are using app assigned IP addresses you need to allow traffic from the IPs assigned to your apps to the ASE subnet.</span></span>

<span data-ttu-id="49a2d-177">Per l'accesso in uscita, un ambiente del servizio app dipende da più sistemi esterni.</span><span class="sxs-lookup"><span data-stu-id="49a2d-177">For outbound access, an ASE depends on multiple external systems.</span></span> <span data-ttu-id="49a2d-178">Tali dipendenze di sistema sono definite con nomi DNS e non corrispondono a un set fisso di indirizzi IP.</span><span class="sxs-lookup"><span data-stu-id="49a2d-178">Those system dependencies are defined with DNS names and don't map to a fixed set of IP addresses.</span></span> <span data-ttu-id="49a2d-179">Per questo, l'ambiente del servizio app richiede l'accesso in uscita dalla subnet dell'ambiente del servizio app a tutti gli indirizzi IP esterni su un'ampia gamma di porte.</span><span class="sxs-lookup"><span data-stu-id="49a2d-179">Thus, the ASE requires outbound access from the ASE subnet to all external IPs across a variety of ports.</span></span> <span data-ttu-id="49a2d-180">Per un ambiente del servizio app esistono le seguenti dipendenze in uscita:</span><span class="sxs-lookup"><span data-stu-id="49a2d-180">An ASE has the following outbound dependencies:</span></span>

| <span data-ttu-id="49a2d-181">Uso</span><span class="sxs-lookup"><span data-stu-id="49a2d-181">Use</span></span> | <span data-ttu-id="49a2d-182">Da</span><span class="sxs-lookup"><span data-stu-id="49a2d-182">From</span></span> | <span data-ttu-id="49a2d-183">A</span><span class="sxs-lookup"><span data-stu-id="49a2d-183">To</span></span> |
|-----|------|----|
| <span data-ttu-id="49a2d-184">Archiviazione di Azure</span><span class="sxs-lookup"><span data-stu-id="49a2d-184">Azure Storage</span></span> | <span data-ttu-id="49a2d-185">Subnet dell'ambiente del servizio app</span><span class="sxs-lookup"><span data-stu-id="49a2d-185">ASE subnet</span></span> | <span data-ttu-id="49a2d-186">table.core.windows.net, blob.core.windows.net, queue.core.windows.net, file.core.windows.net: 80, 443, 445 (445 necessaria solo per ASEv1.)</span><span class="sxs-lookup"><span data-stu-id="49a2d-186">table.core.windows.net, blob.core.windows.net, queue.core.windows.net, file.core.windows.net: 80, 443, 445 (445 is only needed for ASEv1.)</span></span> |
| <span data-ttu-id="49a2d-187">Database SQL di Azure</span><span class="sxs-lookup"><span data-stu-id="49a2d-187">Azure SQL Database</span></span> | <span data-ttu-id="49a2d-188">Subnet dell'ambiente del servizio app</span><span class="sxs-lookup"><span data-stu-id="49a2d-188">ASE subnet</span></span> | <span data-ttu-id="49a2d-189">database.windows.net: 1433, 11000-11999, 14000-14999 (per altre informazioni, vedere [Porte successive alla 1433 per ADO.NET 4.5](../../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md))</span><span class="sxs-lookup"><span data-stu-id="49a2d-189">database.windows.net: 1433, 11000-11999, 14000-14999 (For more information, see [SQL Database V12 port usage](../../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md).)</span></span>|
| <span data-ttu-id="49a2d-190">Gestione di Azure</span><span class="sxs-lookup"><span data-stu-id="49a2d-190">Azure management</span></span> | <span data-ttu-id="49a2d-191">Subnet dell'ambiente del servizio app</span><span class="sxs-lookup"><span data-stu-id="49a2d-191">ASE subnet</span></span> | <span data-ttu-id="49a2d-192">management.core.windows.net, management.azure.com: 443</span><span class="sxs-lookup"><span data-stu-id="49a2d-192">management.core.windows.net, management.azure.com: 443</span></span> 
| <span data-ttu-id="49a2d-193">Verifica dei certificati SSL</span><span class="sxs-lookup"><span data-stu-id="49a2d-193">SSL certificate verification</span></span> |  <span data-ttu-id="49a2d-194">Subnet dell'ambiente del servizio app</span><span class="sxs-lookup"><span data-stu-id="49a2d-194">ASE subnet</span></span>            |  <span data-ttu-id="49a2d-195">ocsp.msocsp.com, mscrl.microsoft.com, crl.microsoft.com: 443</span><span class="sxs-lookup"><span data-stu-id="49a2d-195">ocsp.msocsp.com, mscrl.microsoft.com, crl.microsoft.com: 443</span></span>
| <span data-ttu-id="49a2d-196">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="49a2d-196">Azure Active Directory</span></span>        | <span data-ttu-id="49a2d-197">Subnet dell'ambiente del servizio app</span><span class="sxs-lookup"><span data-stu-id="49a2d-197">ASE subnet</span></span>            |  <span data-ttu-id="49a2d-198">Internet: 443</span><span class="sxs-lookup"><span data-stu-id="49a2d-198">Internet: 443</span></span>
| <span data-ttu-id="49a2d-199">Gestione del servizio app</span><span class="sxs-lookup"><span data-stu-id="49a2d-199">App Service management</span></span>        | <span data-ttu-id="49a2d-200">Subnet dell'ambiente del servizio app</span><span class="sxs-lookup"><span data-stu-id="49a2d-200">ASE subnet</span></span>            |  <span data-ttu-id="49a2d-201">Internet: 443</span><span class="sxs-lookup"><span data-stu-id="49a2d-201">Internet: 443</span></span>
| <span data-ttu-id="49a2d-202">DNS di Azure</span><span class="sxs-lookup"><span data-stu-id="49a2d-202">Azure DNS</span></span>                     | <span data-ttu-id="49a2d-203">Subnet dell'ambiente del servizio app</span><span class="sxs-lookup"><span data-stu-id="49a2d-203">ASE subnet</span></span>            |  <span data-ttu-id="49a2d-204">Internet: 53</span><span class="sxs-lookup"><span data-stu-id="49a2d-204">Internet: 53</span></span>
| <span data-ttu-id="49a2d-205">Comunicazione interna dell'ambiente del servizio app</span><span class="sxs-lookup"><span data-stu-id="49a2d-205">ASE internal communication</span></span>    | <span data-ttu-id="49a2d-206">Subnet dell'ambiente del servizio app: tutte le porte</span><span class="sxs-lookup"><span data-stu-id="49a2d-206">ASE subnet: All ports</span></span> |  <span data-ttu-id="49a2d-207">Subnet dell'ambiente del servizio app: tutte le porte</span><span class="sxs-lookup"><span data-stu-id="49a2d-207">ASE subnet: All ports</span></span>

<span data-ttu-id="49a2d-208">L'ambiente del servizio app smette di funzionare se perde l'accesso a queste dipendenze.</span><span class="sxs-lookup"><span data-stu-id="49a2d-208">If the ASE loses access to these dependencies, it stops working.</span></span> <span data-ttu-id="49a2d-209">Se questa condizione si prolunga nel tempo, l'ambiente del servizio app viene sospeso.</span><span class="sxs-lookup"><span data-stu-id="49a2d-209">When that happens long enough, the ASE is suspended.</span></span>

### <a name="customer-dns"></a><span data-ttu-id="49a2d-210">DNS del cliente</span><span class="sxs-lookup"><span data-stu-id="49a2d-210">Customer DNS</span></span> ###

<span data-ttu-id="49a2d-211">Se la rete virtuale è configurata con un server DNS definito dal cliente, i carichi di lavoro tenant lo useranno.</span><span class="sxs-lookup"><span data-stu-id="49a2d-211">If the VNet is configured with a customer-defined DNS server, the tenant workloads use it.</span></span> <span data-ttu-id="49a2d-212">L'ambiente del servizio app deve comunque comunicare con DNS di Azure per scopi di gestione.</span><span class="sxs-lookup"><span data-stu-id="49a2d-212">The ASE still needs to communicate with Azure DNS for management purposes.</span></span> 

<span data-ttu-id="49a2d-213">Se la rete virtuale è configurata con un DNS del cliente sull'altra estremità di una VPN, il server DNS deve essere raggiungibile dalla subnet che contiene l'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-213">If the VNet is configured with a customer DNS on the other side of a VPN, the DNS server must be reachable from the subnet that contains the ASE.</span></span>

<a name="portaldep"></a>

## <a name="portal-dependencies"></a><span data-ttu-id="49a2d-214">Dipendenze per il portale</span><span class="sxs-lookup"><span data-stu-id="49a2d-214">Portal dependencies</span></span> ##

<span data-ttu-id="49a2d-215">Oltre alle dipendenze funzionali per un ambiente del servizio app, esistono alcune altre dipendenze correlate all'esperienza del portale.</span><span class="sxs-lookup"><span data-stu-id="49a2d-215">In addition to the ASE functional dependencies, there are a few extra items related to the portal experience.</span></span> <span data-ttu-id="49a2d-216">Alcune delle funzionalità nel portale di Azure dipendono dall'accesso diretto al _sito di Gestione controllo servizi_.</span><span class="sxs-lookup"><span data-stu-id="49a2d-216">Some of the capabilities in the Azure portal depend on direct access to _SCM site_.</span></span> <span data-ttu-id="49a2d-217">Per ogni app nel Servizio app di Azure esistono due URL.</span><span class="sxs-lookup"><span data-stu-id="49a2d-217">For every app in Azure App Service, there are two URLs.</span></span> <span data-ttu-id="49a2d-218">Il primo URL consente l'accesso all'app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-218">The first URL is to access your app.</span></span> <span data-ttu-id="49a2d-219">Il secondo URL consente l'accesso al sito di Gestione controllo servizi, chiamato anche _console di Kudu_.</span><span class="sxs-lookup"><span data-stu-id="49a2d-219">The second URL is to access the SCM site, which is also called the _Kudu console_.</span></span> <span data-ttu-id="49a2d-220">Le funzionalità che usano il sito di Gestione controllo servizi includono:</span><span class="sxs-lookup"><span data-stu-id="49a2d-220">Features that use the SCM site include:</span></span>

-   <span data-ttu-id="49a2d-221">Processi Web</span><span class="sxs-lookup"><span data-stu-id="49a2d-221">Web jobs</span></span>
-   <span data-ttu-id="49a2d-222">Funzioni</span><span class="sxs-lookup"><span data-stu-id="49a2d-222">Functions</span></span>
-   <span data-ttu-id="49a2d-223">Streaming dei log</span><span class="sxs-lookup"><span data-stu-id="49a2d-223">Log streaming</span></span>
-   <span data-ttu-id="49a2d-224">Kudu</span><span class="sxs-lookup"><span data-stu-id="49a2d-224">Kudu</span></span>
-   <span data-ttu-id="49a2d-225">Estensioni</span><span class="sxs-lookup"><span data-stu-id="49a2d-225">Extensions</span></span>
-   <span data-ttu-id="49a2d-226">Esplora processi</span><span class="sxs-lookup"><span data-stu-id="49a2d-226">Process Explorer</span></span>
-   <span data-ttu-id="49a2d-227">Console</span><span class="sxs-lookup"><span data-stu-id="49a2d-227">Console</span></span>

<span data-ttu-id="49a2d-228">Quando si usa un ambiente del servizio app con bilanciamento del carico interno, il sito di Gestione controllo servizi non è accessibile dall'esterno della rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="49a2d-228">When you use an ILB ASE, the SCM site isn't internet accessible from outside the VNet.</span></span> <span data-ttu-id="49a2d-229">Quando l'app è ospitata in un ambiente del servizio app con bilanciamento del carico interno, non sarà possibile usare alcune funzionalità dal portale.</span><span class="sxs-lookup"><span data-stu-id="49a2d-229">When your app is hosted on an ILB ASE, some capabilities will not work from the portal.</span></span>  

<span data-ttu-id="49a2d-230">Molte delle funzionalità che dipendono dal sito di Gestione controllo servizi sono anche disponibili direttamente nella console di Kudu.</span><span class="sxs-lookup"><span data-stu-id="49a2d-230">Many of those capabilities that depend upon the SCM site are also available directly in the Kudu console.</span></span> <span data-ttu-id="49a2d-231">È possibile connettersi direttamente anziché tramite il portale.</span><span class="sxs-lookup"><span data-stu-id="49a2d-231">You can connect to it directly rather than by using the portal.</span></span> <span data-ttu-id="49a2d-232">Se l'app è ospitata in un ambiente del servizio app con bilanciamento del carico interno, usare le credenziali di pubblicazione per accedere.</span><span class="sxs-lookup"><span data-stu-id="49a2d-232">If your app is hosted in an ILB ASE, use your publishing credentials to sign in.</span></span> <span data-ttu-id="49a2d-233">L'URL per accedere al sito di Gestione controllo servizi di un'app ospitata in un ambiente del servizio app ILB ha il formato seguente:</span><span class="sxs-lookup"><span data-stu-id="49a2d-233">The URL to access the SCM site of an app hosted in an ILB ASE has the following format:</span></span> 

```
<appname>.scm.<domain name the ILB ASE was created with> 
```

<span data-ttu-id="49a2d-234">Se l'ambiente del servizio app con bilanciamento del carico interno è il nome di dominio *contoso.net* e il nome dell'app è *testapp*, l'app viene raggiunta in *testapp.contoso.net*.</span><span class="sxs-lookup"><span data-stu-id="49a2d-234">If your ILB ASE is the domain name *contoso.net* and your app name is *testapp*, the app is reached at *testapp.contoso.net*.</span></span> <span data-ttu-id="49a2d-235">Il sito di Gestione controllo servizi abbinato viene raggiunto in *testapp.scm.contoso.net*.</span><span class="sxs-lookup"><span data-stu-id="49a2d-235">The SCM site that goes with it is reached at *testapp.scm.contoso.net*.</span></span>

### <a name="functions-and-web-jobs"></a><span data-ttu-id="49a2d-236">Funzioni e processi Web</span><span class="sxs-lookup"><span data-stu-id="49a2d-236">Functions and Web jobs</span></span> ###

<span data-ttu-id="49a2d-237">Le funzioni e i processi Web dipendono dal sito di Gestione controllo servizi, ma il relativo uso nel portale è supportato, anche se le app sono presenti in un ambiente del servizio app con bilanciamento del carico interno, purché il browser possa raggiungere il sito di Gestione controllo servizi.</span><span class="sxs-lookup"><span data-stu-id="49a2d-237">Both Functions and Web jobs depend on the SCM site but are supported for use in the portal, even if your apps are in an ILB ASE, so long as your browser can reach the SCM site.</span></span>  <span data-ttu-id="49a2d-238">Se si usa un certificato autofirmato con l'ambiente del servizio app con bilanciamento del carico interno, è necessario impostare il browser in modo da considerare attendibile il certificato.</span><span class="sxs-lookup"><span data-stu-id="49a2d-238">If you are using a self-signed certificate with your ILB ASE, you will need to enable your browser to trust that certificate.</span></span>  <span data-ttu-id="49a2d-239">A tale scopo, per IE ed Edge, è necessario che il certificato si trovi nell'archivio Attendibilità del computer.</span><span class="sxs-lookup"><span data-stu-id="49a2d-239">For IE and Edge that means the certificate has to be in the computer trust store.</span></span>  <span data-ttu-id="49a2d-240">Se si usa Chrome, ciò implica che il certificato sia stato accettato nel browser in precedenza, presumibilmente accedendo direttamente al sito di Gestione controllo servizi.</span><span class="sxs-lookup"><span data-stu-id="49a2d-240">If you are using Chrome then that means you accepted the certificate in the browser earlier by presumably hitting the scm site directly.</span></span>  <span data-ttu-id="49a2d-241">La soluzione migliore consiste nell'usare un certificato commerciale incluso nella catena di certificati del browser.</span><span class="sxs-lookup"><span data-stu-id="49a2d-241">The best solution is to use a commercial certificate that is in the browser chain of trust.</span></span>  

## <a name="ase-ip-addresses"></a><span data-ttu-id="49a2d-242">Indirizzi IP dell'ambiente del servizio app</span><span class="sxs-lookup"><span data-stu-id="49a2d-242">ASE IP addresses</span></span> ##

<span data-ttu-id="49a2d-243">Un ambiente del servizio app ha alcuni indirizzi IP di cui tenere conto.</span><span class="sxs-lookup"><span data-stu-id="49a2d-243">An ASE has a few IP addresses to be aware of.</span></span> <span data-ttu-id="49a2d-244">Sono:</span><span class="sxs-lookup"><span data-stu-id="49a2d-244">They are:</span></span>

- <span data-ttu-id="49a2d-245">**Indirizzo IP in ingresso pubblico**: usato per il traffico di app in un ambiente del servizio app esterno e per il traffico di gestione sia per un ambiente del servizio app esterno che con bilanciamento del carico interno.</span><span class="sxs-lookup"><span data-stu-id="49a2d-245">**Public inbound IP address**: Used for app traffic in an External ASE, and management traffic in both an External ASE and an ILB ASE.</span></span>
- <span data-ttu-id="49a2d-246">**IP pubblico in uscita**: usato come indirizzo IP di origine per le connessioni in uscita dall'ambiente del servizio app che lasciano la rete virtuale e non vengono indirizzate su una VPN.</span><span class="sxs-lookup"><span data-stu-id="49a2d-246">**Outbound public IP**: Used as the "from" IP for outbound connections from the ASE that leave the VNet, which aren't routed down a VPN.</span></span>
- <span data-ttu-id="49a2d-247">**Indirizzo IP con bilanciamento del carico interno**: se si usa un ambiente del servizio app con bilanciamento del carico interno.</span><span class="sxs-lookup"><span data-stu-id="49a2d-247">**ILB IP address**: If you use an ILB ASE.</span></span>
- <span data-ttu-id="49a2d-248">**Indirizzi SSL basati su IP assegnati alle app**: possibili solo con un ambiente del servizio app esterno e quando è configurato SSL basato su IP.</span><span class="sxs-lookup"><span data-stu-id="49a2d-248">**App-assigned IP-based SSL addresses**: Only possible with an External ASE and when IP-based SSL is configured.</span></span>

<span data-ttu-id="49a2d-249">Tutti questi indirizzi IP sono facilmente visibili in un ambiente ASEv2 nel portale di Azure dall'interfaccia utente dell'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-249">All these IP addresses are easily visible in an ASEv2 in the Azure portal from the ASE UI.</span></span> <span data-ttu-id="49a2d-250">Con un ambiente del servizio app con bilanciamento del carico interno viene elencato l'indirizzo IP per il servizio di bilanciamento del carico interno.</span><span class="sxs-lookup"><span data-stu-id="49a2d-250">If you have an ILB ASE, the IP for the ILB is listed.</span></span>

![Indirizzi IP][3]

### <a name="app-assigned-ip-addresses"></a><span data-ttu-id="49a2d-252">Indirizzi IP assegnati alle app</span><span class="sxs-lookup"><span data-stu-id="49a2d-252">App-assigned IP addresses</span></span> ###

<span data-ttu-id="49a2d-253">Con un ambiente del servizio app esterno è possibile assegnare gli indirizzi IP alle singole app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-253">With an External ASE, you can assign IP addresses to individual apps.</span></span> <span data-ttu-id="49a2d-254">Ciò non è possibile con un ambiente del servizio app con bilanciamento del carico interno.</span><span class="sxs-lookup"><span data-stu-id="49a2d-254">You can't do that with an ILB ASE.</span></span> <span data-ttu-id="49a2d-255">Per altre informazioni su come configurare l'app in modo che abbia un indirizzo IP proprio, vedere [Associare un certificato SSL personalizzato esistente ad app Web di Azure](../../app-service-web/app-service-web-tutorial-custom-ssl.md).</span><span class="sxs-lookup"><span data-stu-id="49a2d-255">For more information on how to configure your app to have its own IP address, see [Bind an existing custom SSL certificate to Azure web apps](../../app-service-web/app-service-web-tutorial-custom-ssl.md).</span></span>

<span data-ttu-id="49a2d-256">Quando a un'app viene assegnato un indirizzo SSL basato su IP proprio, l'ambiente del servizio app riserva due porta da mappare a tale indirizzo IP.</span><span class="sxs-lookup"><span data-stu-id="49a2d-256">When an app has its own IP-based SSL address, the ASE reserves two ports to map to that IP address.</span></span> <span data-ttu-id="49a2d-257">Una porta è destinata al traffico HTTP e l'altra al traffico HTTPS.</span><span class="sxs-lookup"><span data-stu-id="49a2d-257">One port is for HTTP traffic, and the other port is for HTTPS.</span></span> <span data-ttu-id="49a2d-258">Tali porte sono elencate nell'interfaccia utente dell'ambiente del servizio app nella sezione degli indirizzi IP.</span><span class="sxs-lookup"><span data-stu-id="49a2d-258">Those ports are listed in the ASE UI in the IP addresses section.</span></span> <span data-ttu-id="49a2d-259">Il traffico deve essere in grado di raggiungere tali porte dall'indirizzo VIP o le app saranno inaccessibili.</span><span class="sxs-lookup"><span data-stu-id="49a2d-259">Traffic must be able to reach those ports from the VIP or the apps are inaccessible.</span></span> <span data-ttu-id="49a2d-260">Questo requisito è importante da ricordare quando si configurano gruppi di sicurezza di rete (NSG).</span><span class="sxs-lookup"><span data-stu-id="49a2d-260">This requirement is important to remember when you configure Network Security Groups (NSGs).</span></span>

## <a name="network-security-groups"></a><span data-ttu-id="49a2d-261">Gruppi di sicurezza di rete</span><span class="sxs-lookup"><span data-stu-id="49a2d-261">Network Security Groups</span></span> ##

<span data-ttu-id="49a2d-262">I [gruppi di sicurezza di rete][NSGs] consentono di controllare l'accesso alla rete all'interno di una rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="49a2d-262">[Network Security Groups][NSGs] provide the ability to control network access within a VNet.</span></span> <span data-ttu-id="49a2d-263">Quando si usa il portale, esiste una regola implicita con la priorità più bassa che nega tutto.</span><span class="sxs-lookup"><span data-stu-id="49a2d-263">When you use the portal, there's an implicit deny rule at the lowest priority to deny everything.</span></span> <span data-ttu-id="49a2d-264">Quello che è necessario creare sono le regole di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="49a2d-264">What you build are your allow rules.</span></span>

<span data-ttu-id="49a2d-265">In un ambiente del servizio app non si ha accesso alle macchine virtuali usate per ospitare l'ambiente del servizio app stesso.</span><span class="sxs-lookup"><span data-stu-id="49a2d-265">In an ASE, you don't have access to the VMs used to host the ASE itself.</span></span> <span data-ttu-id="49a2d-266">Tali macchine virtuali si trovano in una sottoscrizione gestita da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="49a2d-266">They're in a Microsoft-managed subscription.</span></span> <span data-ttu-id="49a2d-267">Se si vuole limitare l'accesso alle app nell'ambiente del servizio app, impostare gruppi di sicurezza di rete nella subnet dell'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-267">If you want to restrict access to the apps on the ASE, set NSGs on the ASE subnet.</span></span> <span data-ttu-id="49a2d-268">In questo caso, prestare particolare attenzione alle dipendenze dell'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-268">In doing so, pay careful attention to the ASE dependencies.</span></span> <span data-ttu-id="49a2d-269">In caso di blocco delle dipendenze, l'ambiente del servizio app smette di funzionare.</span><span class="sxs-lookup"><span data-stu-id="49a2d-269">If you block any dependencies, the ASE stops working.</span></span>

<span data-ttu-id="49a2d-270">I gruppi di sicurezza di rete possono essere configurati tramite il portale di Azure o PowerShell.</span><span class="sxs-lookup"><span data-stu-id="49a2d-270">NSGs can be configured through the Azure portal or via PowerShell.</span></span> <span data-ttu-id="49a2d-271">Le informazioni riportate di seguito si riferiscono al portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="49a2d-271">The information here shows the Azure portal.</span></span> <span data-ttu-id="49a2d-272">I gruppi di sicurezza di rete vengono creati e gestiti nel portale come risorsa di primo livello in **Rete**.</span><span class="sxs-lookup"><span data-stu-id="49a2d-272">You create and manage NSGs in the portal as a top-level resource under **Networking**.</span></span>

<span data-ttu-id="49a2d-273">Tenendo conto dei requisiti in ingresso e in uscita, i gruppi di sicurezza di rete dovrebbero avere un aspetto simile a quelli illustrati in questo esempio.</span><span class="sxs-lookup"><span data-stu-id="49a2d-273">When the inbound and outbound requirements are taken into account, the NSGs should look similar to the NSGs shown in this example.</span></span> <span data-ttu-id="49a2d-274">L'intervallo di indirizzi della rete virtuale è _192.168.250.0/16_ e la subnet dell'ambiente del servizio app è inclusa in _192.168.251.128/25_.</span><span class="sxs-lookup"><span data-stu-id="49a2d-274">The VNet address range is _192.168.250.0/16_, and the subnet that the ASE is in is _192.168.251.128/25_.</span></span>

<span data-ttu-id="49a2d-275">I primi due requisiti in ingresso per il funzionamento dell'ambiente del servizio app sono riportati all'inizio dell'elenco in questo esempio.</span><span class="sxs-lookup"><span data-stu-id="49a2d-275">The first two inbound requirements for the ASE to function are shown at the top of the list in this example.</span></span> <span data-ttu-id="49a2d-276">e consentono la gestione dell'ambiente del servizio app oltre a consentire all'ambiente del servizio app di comunicare con se stesso.</span><span class="sxs-lookup"><span data-stu-id="49a2d-276">They enable ASE management and allow the ASE to communicate with itself.</span></span> <span data-ttu-id="49a2d-277">Le altre voci sono tutte configurabili a livello di tenant e consentono di regolare l'accesso alle applicazioni ospitate dall'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-277">The other entries are all tenant configurable and can govern network access to the ASE-hosted applications.</span></span> 

![Regole di sicurezza in ingresso][4]

<span data-ttu-id="49a2d-279">Una regola predefinita consente agli indirizzi IP di comunicare con la subnet dell'ambiente del servizio app nella rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="49a2d-279">A default rule enables the IPs in the VNet to talk to the ASE subnet.</span></span> <span data-ttu-id="49a2d-280">Un'altra regola predefinita consente al bilanciamento del carico, noto anche come VIP pubblico, di comunicare con l'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-280">Another default rule enables the load balancer, also known as the public VIP, to communicate with the ASE.</span></span> <span data-ttu-id="49a2d-281">Per visualizzare le regole predefinite selezionare **Regole predefinite** accanto all'icona **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="49a2d-281">To see the default rules, select **Default rules** next to the **Add** icon.</span></span> <span data-ttu-id="49a2d-282">Aggiungendo una regola per negare tutto il resto dopo le regole dei gruppi di sicurezza di rete visualizzate, si impedisce il traffico tra l'indirizzo VIP e l'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-282">If you put a deny everything else rule after the NSG rules shown, you prevent traffic between the VIP and the ASE.</span></span> <span data-ttu-id="49a2d-283">Per impedire il traffico proveniente da all'interno della rete virtuale, aggiungere una regola personalizzata per consentire connessioni in entrata.</span><span class="sxs-lookup"><span data-stu-id="49a2d-283">To prevent traffic coming from inside the VNet, add your own rule to allow inbound.</span></span> <span data-ttu-id="49a2d-284">Usare un'origine uguale ad AzureLoadBalancer con una destinazione **qualsiasi** e un intervallo di porte di **\***.</span><span class="sxs-lookup"><span data-stu-id="49a2d-284">Use a source equal to AzureLoadBalancer with a destination of **Any** and a port range of **\***.</span></span> <span data-ttu-id="49a2d-285">Dato che la regola del gruppo di sicurezza di rete viene applicata solo alla subnet dell'ambiente del servizio app, non è necessario impostare una destinazione specifica.</span><span class="sxs-lookup"><span data-stu-id="49a2d-285">Because the NSG rule is applied to the ASE subnet, you don't need to be specific in the destination.</span></span>

<span data-ttu-id="49a2d-286">Se è stato assegnato un indirizzo IP all'app, accertarsi di mantenere le porte aperte.</span><span class="sxs-lookup"><span data-stu-id="49a2d-286">If you assigned an IP address to your app, make sure you keep the ports open.</span></span> <span data-ttu-id="49a2d-287">Per visualizzare le porte selezionare **Ambiente del servizio app** > **Indirizzi IP**.</span><span class="sxs-lookup"><span data-stu-id="49a2d-287">To see the ports, select **App Service Environment** > **IP addresses**.</span></span>  

<span data-ttu-id="49a2d-288">Tutti gli elementi visualizzati nelle regole in uscita seguenti sono necessari, tranne per l'ultimo elemento.</span><span class="sxs-lookup"><span data-stu-id="49a2d-288">All the items shown in the following outbound rules are needed, except for the last item.</span></span> <span data-ttu-id="49a2d-289">Queste voci consentono l'accesso alla rete alle dipendenze dell'ambiente del servizio app presentate più indietro in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="49a2d-289">They enable network access to the ASE dependencies that were noted earlier in this article.</span></span> <span data-ttu-id="49a2d-290">Se si bloccano una o più di queste voci, l'ambiente del servizio app smette di funzionare.</span><span class="sxs-lookup"><span data-stu-id="49a2d-290">If you block any of them, your ASE stops working.</span></span> <span data-ttu-id="49a2d-291">L'ultima voce nell'elenco consente all'ambiente del servizio app di comunicare con altre risorse nella rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="49a2d-291">The last item in the list enables your ASE to communicate with other resources in your VNet.</span></span>

![Regole di sicurezza in uscita][5]

<span data-ttu-id="49a2d-293">Dopo aver definito i gruppi di sicurezza di rete, assegnarli alla subnet in cui è incluso l'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-293">After your NSGs are defined, assign them to the subnet that your ASE is on.</span></span> <span data-ttu-id="49a2d-294">Se non si ricorda la rete virtuale o la subnet dell'ambiente del servizio app, è possibile visualizzarla dal portale di gestione dell'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-294">If you don’t remember the ASE VNet or subnet, you can see it from the ASE management portal.</span></span> <span data-ttu-id="49a2d-295">Per assegnare il gruppo di sicurezza di rete alla subnet, passare all'interfaccia utente della subnet e selezionare il gruppo di sicurezza di rete.</span><span class="sxs-lookup"><span data-stu-id="49a2d-295">To assign the NSG to your subnet, go to the subnet UI and select the NSG.</span></span>

## <a name="routes"></a><span data-ttu-id="49a2d-296">Route</span><span class="sxs-lookup"><span data-stu-id="49a2d-296">Routes</span></span> ##

<span data-ttu-id="49a2d-297">Le route diventano problematiche più di frequente quando si configura la rete virtuale con Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="49a2d-297">Routes become problematic most commonly when you configure your VNet with Azure ExpressRoute.</span></span> <span data-ttu-id="49a2d-298">Esistono tre tipi di route in una rete virtuale:</span><span class="sxs-lookup"><span data-stu-id="49a2d-298">There are three types of routes in a VNet:</span></span>

-   <span data-ttu-id="49a2d-299">Route di sistema</span><span class="sxs-lookup"><span data-stu-id="49a2d-299">System routes</span></span>
-   <span data-ttu-id="49a2d-300">Route BGP</span><span class="sxs-lookup"><span data-stu-id="49a2d-300">BGP routes</span></span>
-   <span data-ttu-id="49a2d-301">Route definite dall'utente</span><span class="sxs-lookup"><span data-stu-id="49a2d-301">User-defined routes (UDRs)</span></span>

<span data-ttu-id="49a2d-302">Le route BGP sono prioritarie rispetto alle route di sistema.</span><span class="sxs-lookup"><span data-stu-id="49a2d-302">BGP routes override system routes.</span></span> <span data-ttu-id="49a2d-303">Le route definite dall'utente sono prioritarie rispetto alle route BGP.</span><span class="sxs-lookup"><span data-stu-id="49a2d-303">UDRs override BGP routes.</span></span> <span data-ttu-id="49a2d-304">Per altre informazioni sulle route nelle reti virtuali di Azure, vedere [Panoramica delle route definite dall'utente][UDRs].</span><span class="sxs-lookup"><span data-stu-id="49a2d-304">For more information about routes in Azure virtual networks, see [User-defined routes overview][UDRs].</span></span>

<span data-ttu-id="49a2d-305">Il database SQL di Azure che l'ambiente del servizio app usa per gestire il sistema è dotato di un firewall.</span><span class="sxs-lookup"><span data-stu-id="49a2d-305">The Azure SQL database that the ASE uses to manage the system has a firewall.</span></span> <span data-ttu-id="49a2d-306">Richiede che le comunicazioni provengano dall'indirizzo VIP pubblico dell'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-306">It requires communication to originate from the ASE public VIP.</span></span> <span data-ttu-id="49a2d-307">Le connessioni al database SQL dall'ambiente del servizio app verranno negate se vengono inviate alla connessione ExpressRoute e a un altro indirizzo IP.</span><span class="sxs-lookup"><span data-stu-id="49a2d-307">Connections to the SQL database from the ASE will be denied if they are sent down the ExpressRoute connection and out another IP address.</span></span>

<span data-ttu-id="49a2d-308">Se le risposte alle richieste di gestione in ingresso vengono inviate a ExpressRoute, l'indirizzo di risposta è diverso da quello di destinazione originale.</span><span class="sxs-lookup"><span data-stu-id="49a2d-308">If replies to incoming management requests are sent down the ExpressRoute, the reply address is different than the original destination.</span></span> <span data-ttu-id="49a2d-309">Questa mancata corrispondenza interrompe la comunicazione TCP.</span><span class="sxs-lookup"><span data-stu-id="49a2d-309">This mismatch breaks the TCP communication.</span></span>

<span data-ttu-id="49a2d-310">Per il corretto funzionamento dell'ambiente del servizio app quando la rete virtuale è configurata con ExpressRoute, la cosa più semplice da fare è:</span><span class="sxs-lookup"><span data-stu-id="49a2d-310">For your ASE to work while your VNet is configured with an ExpressRoute, the easiest thing to do is:</span></span>

-   <span data-ttu-id="49a2d-311">Configurare ExpressRoute in modo che annunci _0.0.0.0/0_.</span><span class="sxs-lookup"><span data-stu-id="49a2d-311">Configure ExpressRoute to advertise _0.0.0.0/0_.</span></span> <span data-ttu-id="49a2d-312">Per impostazione predefinita, tutto il traffico locale in uscita viene forzato.</span><span class="sxs-lookup"><span data-stu-id="49a2d-312">By default, it force tunnels all outbound traffic on-premises.</span></span>
-   <span data-ttu-id="49a2d-313">Creare una route definita dall'utente.</span><span class="sxs-lookup"><span data-stu-id="49a2d-313">Create a UDR.</span></span> <span data-ttu-id="49a2d-314">Applicarla alla subnet contenente l'ambiente del servizio app, con un prefisso dell'indirizzo _0.0.0.0/0_ e tipo di hop successivo _Internet_.</span><span class="sxs-lookup"><span data-stu-id="49a2d-314">Apply it to the subnet that contains the ASE with an address prefix of _0.0.0.0/0_ and a next hop type of _Internet_.</span></span>

<span data-ttu-id="49a2d-315">Se si apportano queste due modifiche, il traffico destinato a Internet, proveniente dalla subnet dell'ambiente del servizio app, non verrà forzato verso ExpressRoute e l'ambiente del servizio app potrà funzionare.</span><span class="sxs-lookup"><span data-stu-id="49a2d-315">If you make these two changes, internet-destined traffic that originates from the ASE subnet isn't forced down the ExpressRoute and the ASE works.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="49a2d-316">Le route definite in una route definita dall'utente devono essere sufficientemente specifiche per avere la precedenza su qualsiasi route annunciata dalla configurazione di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="49a2d-316">The routes defined in a UDR must be specific enough to take precedence over any routes advertised by the ExpressRoute configuration.</span></span> <span data-ttu-id="49a2d-317">Nell'esempio precedente viene usato l'intervallo di indirizzi ampio 0.0.0.0/0.</span><span class="sxs-lookup"><span data-stu-id="49a2d-317">The preceding example uses the broad 0.0.0.0/0 address range.</span></span> <span data-ttu-id="49a2d-318">Può essere accidentalmente sostituito dagli annunci di route che usano intervalli di indirizzi più specifici.</span><span class="sxs-lookup"><span data-stu-id="49a2d-318">It can potentially be accidentally overridden by route advertisements that use more specific address ranges.</span></span>
>
> <span data-ttu-id="49a2d-319">Gli ambienti del servizio app non sono supportati con le configurazioni di ExpressRoute con annuncio incrociato di route dal percorso di peering pubblico al percorso di peering privato.</span><span class="sxs-lookup"><span data-stu-id="49a2d-319">ASEs aren't supported with ExpressRoute configurations that cross-advertise routes from the public-peering path to the private-peering path.</span></span> <span data-ttu-id="49a2d-320">Le configurazioni di ExpressRoute con peering pubblico configurato riceveranno gli annunci di route da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="49a2d-320">ExpressRoute configurations with public peering configured receive route advertisements from Microsoft.</span></span> <span data-ttu-id="49a2d-321">Gli annunci contengono un ampio set di intervalli di indirizzi IP di Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="49a2d-321">The advertisements contain a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="49a2d-322">In caso di annuncio incrociato di questi intervalli di indirizzi nel percorso di peering privato, tutti i pacchetti di rete in uscita dalla subnet dell'ambiente del servizio app verranno sottoposti a tunneling forzato verso un'infrastruttura di rete locale del cliente.</span><span class="sxs-lookup"><span data-stu-id="49a2d-322">If the address ranges are cross-advertised on the private-peering path, all outbound network packets from the ASE's subnet are force tunneled to a customer's on-premises network infrastructure.</span></span> <span data-ttu-id="49a2d-323">Questo flusso di rete non è attualmente supportato con ambienti del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-323">This network flow is currently not supported with ASEs.</span></span> <span data-ttu-id="49a2d-324">Una soluzione a questo problema consiste nell'interrompere l'annuncio incrociato di route dal percorso di peering pubblico al percorso di peering privato.</span><span class="sxs-lookup"><span data-stu-id="49a2d-324">One solution to this problem is to stop cross-advertising routes from the public-peering path to the private-peering path.</span></span>

<span data-ttu-id="49a2d-325">Per creare una route definita dall'utente, seguire questi passaggi:</span><span class="sxs-lookup"><span data-stu-id="49a2d-325">To create a UDR, follow these steps:</span></span>

1. <span data-ttu-id="49a2d-326">Accedere al portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="49a2d-326">Go to the Azure portal.</span></span> <span data-ttu-id="49a2d-327">Selezionare **Rete** > **Tabelle route**.</span><span class="sxs-lookup"><span data-stu-id="49a2d-327">Select **Networking** > **Route Tables**.</span></span>

2. <span data-ttu-id="49a2d-328">Creare una nuova tabella route nella stessa area della rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="49a2d-328">Create a new route table in the same region as your VNet.</span></span>

3. <span data-ttu-id="49a2d-329">Dall'interfaccia utente per le tabelle route selezionare **Route** > **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="49a2d-329">From within your route table UI, select **Routes** > **Add**.</span></span>

4. <span data-ttu-id="49a2d-330">Impostare **Tipo hop successivo** su **Internet** e **Prefisso indirizzo** su **0.0.0.0/0**.</span><span class="sxs-lookup"><span data-stu-id="49a2d-330">Set the **Next hop type** to **Internet** and the **Address prefix** to **0.0.0.0/0**.</span></span> <span data-ttu-id="49a2d-331">Selezionare **Salva**.</span><span class="sxs-lookup"><span data-stu-id="49a2d-331">Select **Save**.</span></span>

    <span data-ttu-id="49a2d-332">Verrà visualizzata una schermata simile alla seguente:</span><span class="sxs-lookup"><span data-stu-id="49a2d-332">You then see something like the following:</span></span>

    ![Route funzionali][6]

5. <span data-ttu-id="49a2d-334">Dopo aver creato la nuova tabella di route, passare alla subnet contenente l'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-334">After you create the new route table, go to the subnet that contains your ASE.</span></span> <span data-ttu-id="49a2d-335">Selezionare la tabella di route nell'elenco del portale.</span><span class="sxs-lookup"><span data-stu-id="49a2d-335">Select your route table from the list in the portal.</span></span> <span data-ttu-id="49a2d-336">Dopo aver salvato la modifica, dovrebbero essere visibili i gruppi di sicurezza di rete e le route associati alla subnet.</span><span class="sxs-lookup"><span data-stu-id="49a2d-336">After you save the change, you should then see the NSGs and routes noted with your subnet.</span></span>

    ![Gruppi di sicurezza di rete e route][7]

### <a name="deploy-into-existing-azure-virtual-networks-that-are-integrated-with-expressroute"></a><span data-ttu-id="49a2d-338">Distribuzione nelle reti virtuali di Azure esistenti integrate con ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="49a2d-338">Deploy into existing Azure virtual networks that are integrated with ExpressRoute</span></span> ###

<span data-ttu-id="49a2d-339">Per distribuire l'ambiente del servizio app in una rete virtuale integrata con ExpressRoute, preconfigurare la subnet in cui si desidera distribuire l'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-339">To deploy your ASE into a VNet that's integrated with ExpressRoute, preconfigure the subnet where you want the ASE deployed.</span></span> <span data-ttu-id="49a2d-340">Quindi, usare un modello di Resource Manager per distribuirla.</span><span class="sxs-lookup"><span data-stu-id="49a2d-340">Then use a Resource Manager template to deploy it.</span></span> <span data-ttu-id="49a2d-341">Per creare un ambiente del servizio app in una rete virtuale per cui è già configurato ExpressRoute:</span><span class="sxs-lookup"><span data-stu-id="49a2d-341">To create an ASE in a VNet that already has ExpressRoute configured:</span></span>

- <span data-ttu-id="49a2d-342">Creare una subnet per ospitare l'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-342">Create a subnet to host the ASE.</span></span>

    > [!NOTE]
    > <span data-ttu-id="49a2d-343">La subnet non può contenere altro oltre all'ambiente del servizio app.</span><span class="sxs-lookup"><span data-stu-id="49a2d-343">Nothing else can be in the subnet but the ASE.</span></span> <span data-ttu-id="49a2d-344">Assicurarsi di scegliere uno spazio di indirizzi che consente la crescita futura.</span><span class="sxs-lookup"><span data-stu-id="49a2d-344">Be sure to choose an address space that allows for future growth.</span></span> <span data-ttu-id="49a2d-345">Non è possibile modificare questa impostazione in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="49a2d-345">You can't change this setting later.</span></span> <span data-ttu-id="49a2d-346">È consigliabile una dimensione pari a `/25` con 128 indirizzi.</span><span class="sxs-lookup"><span data-stu-id="49a2d-346">We recommend a size of `/25` with 128 addresses.</span></span>

- <span data-ttu-id="49a2d-347">Creare route definite dall'utente (per esempio tabelle di route) come descritto in precedenza e impostarle sulla subnet.</span><span class="sxs-lookup"><span data-stu-id="49a2d-347">Create UDRs (for example, route tables) as described earlier, and set that on the subnet.</span></span>
- <span data-ttu-id="49a2d-348">Creare l'ambiente del servizio app usando un modello di Resource Manager come descritto in [Come creare un ambiente del servizio app usando modelli di Azure Resource Manager][MakeASEfromTemplate].</span><span class="sxs-lookup"><span data-stu-id="49a2d-348">Create the ASE by using a Resource Manager template as described in [Create an ASE by using a Resource Manager template][MakeASEfromTemplate].</span></span>

<!--Image references-->
[1]: ./media/network_considerations_with_an_app_service_environment/networkase-overflow.png
[2]: ./media/network_considerations_with_an_app_service_environment/networkase-overflow2.png
[3]: ./media/network_considerations_with_an_app_service_environment/networkase-ipaddresses.png
[4]: ./media/network_considerations_with_an_app_service_environment/networkase-inboundnsg.png
[5]: ./media/network_considerations_with_an_app_service_environment/networkase-outboundnsg.png
[6]: ./media/network_considerations_with_an_app_service_environment/networkase-udr.png
[7]: ./media/network_considerations_with_an_app_service_environment/networkase-subnet.png

<!--Links-->
[Intro]: ./intro.md
[MakeExternalASE]: ./create-external-ase.md
[MakeASEfromTemplate]: ./create-from-template.md
[MakeILBASE]: ./create-ilb-ase.md
[ASENetwork]: ./network-info.md
[ASEReadme]: ./readme.md
[UsingASE]: ./using-an-ase.md
[UDRs]: ../../virtual-network/virtual-networks-udr-overview.md
[NSGs]: ../../virtual-network/virtual-networks-nsg.md
[ConfigureASEv1]: ../../app-service-web/app-service-web-configure-an-app-service-environment.md
[ASEv1Intro]: ../../app-service-web/app-service-app-service-environment-intro.md
[webapps]: ../../app-service-web/app-service-web-overview.md
[mobileapps]: ../../app-service-mobile/app-service-mobile-value-prop.md
[APIapps]: ../../app-service-api/app-service-api-apps-why-best-platform.md
[Functions]: ../../azure-functions/index.yml
[Pricing]: http://azure.microsoft.com/pricing/details/app-service/
[ARMOverview]: ../../azure-resource-manager/resource-group-overview.md
[ConfigureSSL]: ../../app-service-web/web-sites-purchase-ssl-web-site.md
[Kudu]: http://azure.microsoft.com/resources/videos/super-secret-kudu-debug-console-for-azure-web-sites/
[AppDeploy]: ../../app-service-web/web-sites-deploy.md
[ASEWAF]: ../../app-service-web/app-service-app-service-environment-web-application-firewall.md
[AppGW]: ../../application-gateway/application-gateway-web-application-firewall-overview.md
[ASEManagement]: ./management-addresses.md
