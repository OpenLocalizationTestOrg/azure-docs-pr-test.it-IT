---
title: aaaHow toouse gestione API di Azure con le reti virtuali
description: Informazioni su come toosetup una connessione tooa virtuale in Gestione API di Azure e accesso web di servizi di rete attraverso di esso.
services: api-management
documentationcenter: 
author: antonba
manager: erikre
editor: 
ms.assetid: 64b58f7b-ca22-47dc-89c0-f6bb0af27a48
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/15/2016
ms.author: apimpm
ms.openlocfilehash: 426b3974e4fed7daffdb0c3f02381edbc326dc28
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="how-toouse-azure-api-management-with-virtual-networks"></a><span data-ttu-id="1fe89-103">Come toouse gestione API di Azure con le reti virtuali</span><span class="sxs-lookup"><span data-stu-id="1fe89-103">How toouse Azure API Management with virtual networks</span></span>
<span data-ttu-id="1fe89-104">Reti virtuali di Azure (Vnet) consentono di tooplace delle risorse di Azure in una rete routeable internet non è possibile controllare l'accesso a.</span><span class="sxs-lookup"><span data-stu-id="1fe89-104">Azure Virtual Networks (VNETs) allow you tooplace any of your Azure resources in a non-internet routeable network that you control access to.</span></span> <span data-ttu-id="1fe89-105">Queste reti possono quindi essere reti locali connesse tooyour con varie tecnologie VPN.</span><span class="sxs-lookup"><span data-stu-id="1fe89-105">These networks can then be connected tooyour on-premises networks using various VPN technologies.</span></span> <span data-ttu-id="1fe89-106">informazioni sulle reti virtuali di Azure dispone di informazioni hello qui toolearn: [Panoramica di rete virtuale di Azure](../virtual-network/virtual-networks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="1fe89-106">toolearn more about Azure Virtual Networks start with hello information here: [Azure Virtual Network Overview](../virtual-network/virtual-networks-overview.md).</span></span>

<span data-ttu-id="1fe89-107">Gestione API di Azure possono essere distribuiti all'interno di hello rete virtuale (VNET), in modo che possa accedere a servizi di back-end in rete hello.</span><span class="sxs-lookup"><span data-stu-id="1fe89-107">Azure API Management can be deployed inside hello virtual network (VNET), so it can access backend services within hello network.</span></span> <span data-ttu-id="1fe89-108">salve portale per sviluppatori e il gateway API, può essere accessibile da Internet hello o solo all'interno di rete virtuale hello toobe configurato.</span><span class="sxs-lookup"><span data-stu-id="1fe89-108">hello developer portal and API gateway, can be configured toobe accessible either from hello Internet or only within hello virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="1fe89-109">Gestione API di Azure supporta le reti virtuali classiche e Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="1fe89-109">Azure API Management supports both classic and Azure Resource Manager VNets.</span></span>
>
>

## <span data-ttu-id="1fe89-110"><a name="enable-vpn"></a>Attivare la connessione VNET</span><span class="sxs-lookup"><span data-stu-id="1fe89-110"><a name="enable-vpn"> </a>Enable VNET connection</span></span>
> [!NOTE]
> <span data-ttu-id="1fe89-111">Connettività di rete virtuale è disponibile in hello **Premium** e **Developer** livelli.</span><span class="sxs-lookup"><span data-stu-id="1fe89-111">VNET connectivity is available in hello **Premium** and **Developer** tiers.</span></span> <span data-ttu-id="1fe89-112">tooswitch tra i livelli di hello, aprire il servizio Gestione API in hello portale di Azure e quindi hello **scala e prezzi** scheda. In hello **tariffario** sezione, selezionare il livello di Premium o lo sviluppatore hello e fare clic su Salva.</span><span class="sxs-lookup"><span data-stu-id="1fe89-112">tooswitch between hello tiers, open your API Management service in hello Azure portal and then open hello **Scale and pricing** tab. Under hello **Pricing tier** section, select hello Premium or Developer tier and click Save.</span></span>
>

<span data-ttu-id="1fe89-113">connettività tra reti VIRTUALI tooenable, aprire il servizio Gestione API nel portale di Azure hello e hello **rete virtuale** pagina.</span><span class="sxs-lookup"><span data-stu-id="1fe89-113">tooenable VNET connectivity, open your API Management service in hello Azure portal and open hello **Virtual network** page.</span></span>

![Menu della rete virtuale di Gestione API][api-management-using-vnet-menu]

<span data-ttu-id="1fe89-115">Selezionare il tipo di accesso di hello desiderato:</span><span class="sxs-lookup"><span data-stu-id="1fe89-115">Select hello desired access type:</span></span>

* <span data-ttu-id="1fe89-116">**Esterno**: sono accessibili dal portale di gestione API hello gateway e developer hello pubblica internet tramite un servizio di bilanciamento del carico esterno.</span><span class="sxs-lookup"><span data-stu-id="1fe89-116">**External**: hello API Management gateway and developer portal are accessible from hello public internet via an external load balancer.</span></span> <span data-ttu-id="1fe89-117">gateway Hello possono accedere alle risorse in rete virtuale hello.</span><span class="sxs-lookup"><span data-stu-id="1fe89-117">hello gateway can access resources within hello virtual network.</span></span>

![Peering pubblico][api-management-vnet-public]

* <span data-ttu-id="1fe89-119">**Interno**: portale di gestione API hello gateway e developer sono accessibili solo dall'interno di rete virtuale di hello tramite un servizio di bilanciamento del carico interno.</span><span class="sxs-lookup"><span data-stu-id="1fe89-119">**Internal**: hello API Management gateway and developer portal are accessible only from within hello virtual network via an internal load balancer.</span></span> <span data-ttu-id="1fe89-120">gateway Hello possono accedere alle risorse in rete virtuale hello.</span><span class="sxs-lookup"><span data-stu-id="1fe89-120">hello gateway can access resources within hello virtual network.</span></span>

![Peering privato][api-management-vnet-private]

<span data-ttu-id="1fe89-122">Verrà ora visualizzato un elenco di tutte le aree in cui viene eseguito il provisioning del servizio Gestione API.</span><span class="sxs-lookup"><span data-stu-id="1fe89-122">You will now see a list of all regions where your API Management service is provisioned.</span></span> <span data-ttu-id="1fe89-123">Selezionare una VNET e una subnet per ogni area.</span><span class="sxs-lookup"><span data-stu-id="1fe89-123">Select a VNET and subnet for every region.</span></span> <span data-ttu-id="1fe89-124">Hello elenco viene popolato con classica e reti virtuali di gestione delle risorse disponibili nelle sottoscrizioni di Azure che sono il programma di installazione nell'area di hello che si sta configurando.</span><span class="sxs-lookup"><span data-stu-id="1fe89-124">hello list is populated with both classic and Resource Manager virtual networks available in your Azure subscriptions that are setup in hello region you are configuring.</span></span>

> [!NOTE]
> <span data-ttu-id="1fe89-125">**Endpoint del servizio** in hello diagramma include Gateway o Proxy, portale di pubblicazione, portale per sviluppatori, GIT e hello diretto dell'Endpoint di gestione.</span><span class="sxs-lookup"><span data-stu-id="1fe89-125">**Service Endpoint** in hello above diagram includes Gateway/Proxy, Publisher Portal, Developer Portal, GIT, and hello Direct Management Endpoint.</span></span>
> <span data-ttu-id="1fe89-126">**Gestione Endpoint** in hello diagramma è endpoint hello ospitato nella configurazione di toomanage hello servizio tramite il portale di Azure e Powershell.</span><span class="sxs-lookup"><span data-stu-id="1fe89-126">**Management Endpoint** in hello above diagram is hello endpoint hosted on hello service toomanage configuration via Azure portal and Powershell.</span></span>
> <span data-ttu-id="1fe89-127">Inoltre, si noti che, anche se il diagramma hello Mostra gli indirizzi IP per gli endpoint diversi, il servizio Gestione API **solo** risponde alla relativa i nomi host configurato.</span><span class="sxs-lookup"><span data-stu-id="1fe89-127">Also, note, that, even though, hello diagram shows IP Addresses for its various endpoints, API Management service **only** responds on its configured Hostnames.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="1fe89-128">Quando si distribuisce un tooa di istanza VNET Gestione risorse di gestione API di Azure, servizio di hello deve essere in una subnet dedicata che non contiene altre risorse, ad eccezione delle istanze di gestione API di Azure.</span><span class="sxs-lookup"><span data-stu-id="1fe89-128">When deploying an Azure API Management instance tooa Resource Manager VNET, hello service must be in a dedicated subnet that contains no other resources except for Azure API Management instances.</span></span> <span data-ttu-id="1fe89-129">Se viene effettuato un tentativo di toodeploy un tooa di istanza di gestione API di Azure subnet VNET Gestione risorse che contiene altre risorse, distribuzione hello avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="1fe89-129">If an attempt is made toodeploy an Azure API Management instance tooa Resource Manager VNET subnet that contains other resources, hello deployment will fail.</span></span>
>
>

![Selezionare una VPN][api-management-setup-vpn-select]

<span data-ttu-id="1fe89-131">Fare clic su **salvare** in alto hello hello.</span><span class="sxs-lookup"><span data-stu-id="1fe89-131">Click **Save** at hello top of hello screen.</span></span>

> [!NOTE]
> <span data-ttu-id="1fe89-132">Hello indirizzo VIP dell'istanza di gestione API hello verrà modificato ogni volta rete virtuale è abilitato o disabilitato.</span><span class="sxs-lookup"><span data-stu-id="1fe89-132">hello VIP address of hello API Management instance will change each time VNET is enabled or disabled.</span></span>  
> <span data-ttu-id="1fe89-133">indirizzo VIP Hello viene modificata quando Gestione API viene spostato dalla **esterno** troppo**interno** o viceversa</span><span class="sxs-lookup"><span data-stu-id="1fe89-133">hello VIP address will also change when API Management is moved from **External** too**Internal** or vice-versa</span></span>
>


> [!IMPORTANT]
> <span data-ttu-id="1fe89-134">Se si rimuove gestione API da una rete virtuale o modifica hello uno che in cui viene distribuito, hello tra reti VIRTUALI usate in precedenza possono rimanere bloccati per le ore too4.</span><span class="sxs-lookup"><span data-stu-id="1fe89-134">If you remove API Management from a VNET or change hello one it is deployed in, hello previously used VNET can remain locked for up too4 hours.</span></span> <span data-ttu-id="1fe89-135">Durante questo periodo verrà non hello toodelete possibili tra reti VIRTUALI o distribuire un nuovo tooit di risorse.</span><span class="sxs-lookup"><span data-stu-id="1fe89-135">During this period it will not be possible toodelete hello VNET or deploy a new resource tooit.</span></span>

## <span data-ttu-id="1fe89-136"><a name="enable-vnet-powershell"></a>Abilitare la connessione della rete virtuale usando i cmdlet di PowerShell</span><span class="sxs-lookup"><span data-stu-id="1fe89-136"><a name="enable-vnet-powershell"> </a>Enable VNET connection using PowerShell cmdlets</span></span>
<span data-ttu-id="1fe89-137">È inoltre possibile abilitare la connettività di rete virtuale utilizzando i cmdlet di PowerShell hello</span><span class="sxs-lookup"><span data-stu-id="1fe89-137">You can also enable VNET connectivity using hello PowerShell cmdlets</span></span>

* <span data-ttu-id="1fe89-138">**Creare un servizio di gestione API all'interno di una rete virtuale**: utilizzare i cmdlet di hello [New AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate un servizio di gestione API di Azure all'interno di una rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="1fe89-138">**Create an API Management service inside a VNET**: Use hello cmdlet [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate an Azure API Management service inside a VNET.</span></span>

* <span data-ttu-id="1fe89-139">**Distribuire un servizio di gestione API esistente all'interno di una rete virtuale**: utilizzare i cmdlet di hello [aggiornamento AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove un servizio di gestione API di Azure esistente all'interno di una rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="1fe89-139">**Deploy an existing API Management service inside a VNET**: Use hello cmdlet [Update-AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove an existing Azure API Management service inside a Virtual Network.</span></span>

## <span data-ttu-id="1fe89-140"><a name="connect-vnet"></a>Connettersi tooa del servizio web ospitato all'interno di una rete virtuale</span><span class="sxs-lookup"><span data-stu-id="1fe89-140"><a name="connect-vnet"> </a>Connect tooa web service hosted within a virtual Network</span></span>
<span data-ttu-id="1fe89-141">Dopo aver connesso toohello rete virtuale del servizio Gestione API, l'accesso ai servizi back-end in esso contenuti è alcuna differenza rispetto all'accesso ai servizi pubblici.</span><span class="sxs-lookup"><span data-stu-id="1fe89-141">After your API Management service is connected toohello VNET, accessing backend services within it is no different than accessing public services.</span></span> <span data-ttu-id="1fe89-142">Digitare l'indirizzo IP locale hello o al nome di host di hello (se un server DNS è configurato per la rete virtuale hello) del servizio web in hello **URL servizio Web** campo quando si crea una nuova API o la modifica di uno esistente.</span><span class="sxs-lookup"><span data-stu-id="1fe89-142">Just type in hello local IP address or hello host name (if a DNS server is configured for hello VNET) of your web service into hello **Web service URL** field when creating a new API or editing an existing one.</span></span>

![Aggiungere un'API dalla VPN][api-management-setup-vpn-add-api]

## <span data-ttu-id="1fe89-144"><a name="network-configuration-issues"> </a>Problemi comuni di configurazione di rete</span><span class="sxs-lookup"><span data-stu-id="1fe89-144"><a name="network-configuration-issues"> </a>Common Network Configuration Issues</span></span>
<span data-ttu-id="1fe89-145">Di seguito è riportato un elenco di problemi di configurazione comuni che possono verificarsi durante la distribuzione del servizio Gestione API in una rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="1fe89-145">Following is a list of common misconfiguration issues that can occur while deploying API Management service into a Virtual Network.</span></span>

* <span data-ttu-id="1fe89-146">**Installazione del server DNS personalizzato**: hello servizio Gestione API dipende da diversi servizi di Azure.</span><span class="sxs-lookup"><span data-stu-id="1fe89-146">**Custom DNS server setup**: hello API Management service depends on several Azure services.</span></span> <span data-ttu-id="1fe89-147">Quando l'API di gestione è ospitato in una rete virtuale con un server DNS personalizzato, è necessario che i nomi host hello tooresolve di tali servizi Azure.</span><span class="sxs-lookup"><span data-stu-id="1fe89-147">When API Management is hosted in a VNET with a custom DNS server, it needs tooresolve hello hostnames of those Azure services.</span></span> <span data-ttu-id="1fe89-148">Vedere [queste](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) informazioni aggiuntive sulla configurazione del DNS personalizzato.</span><span class="sxs-lookup"><span data-stu-id="1fe89-148">Please follow [this](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) guidance on custom DNS setup.</span></span> <span data-ttu-id="1fe89-149">Vedere tabella porte hello riportata di seguito e altri requisiti di rete per riferimento.</span><span class="sxs-lookup"><span data-stu-id="1fe89-149">See hello ports table below and other network requirements for reference.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="1fe89-150">È consigliabile, se si utilizza un server DNS personalizzato per la rete virtuale hello, configurare che **prima** distribuzione di un servizio di gestione API al suo interno.</span><span class="sxs-lookup"><span data-stu-id="1fe89-150">It is recommended that, if you are using a Custom DNS Server(s) for hello VNET, you set that up **before** deploying an API Management service into it.</span></span> <span data-ttu-id="1fe89-151">In caso contrario è necessario troppo aggiornare il servizio di gestione API hello ogni volta che si modifica il server DNS hello (s) eseguendo hello [applicare operazioni di configurazione di rete](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span><span class="sxs-lookup"><span data-stu-id="1fe89-151">Otherwise you need too update hello API Management service each time you change hello DNS Servers(s) by running hello [Apply Network Configuration Operation](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span></span>

* <span data-ttu-id="1fe89-152">**Porte richieste per l'API di gestione**: il traffico in ingresso e in uscita in hello Subnet in cui viene distribuito l'API di gestione può essere controllato utilizzando [Network Security Group][Network Security Group].</span><span class="sxs-lookup"><span data-stu-id="1fe89-152">**Ports required for API Management**: Inbound and Outbound traffic into hello Subnet in which API Management is deployed can be controlled using [Network Security Group][Network Security Group].</span></span> <span data-ttu-id="1fe89-153">Se una qualsiasi di queste porte non è disponibile, Gestione API potrebbe non funzionare correttamente e potrebbe diventare inaccessibile.</span><span class="sxs-lookup"><span data-stu-id="1fe89-153">If any of these ports are unavailable, API Management may not operate properly and may become inaccessible.</span></span> <span data-ttu-id="1fe89-154">Il blocco di una o più di tali porte è un problema di configurazione comune nell'uso di Gestione API in una rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="1fe89-154">Having one or more of these ports blocked is another common misconfiguration issue when using API Management with a VNET.</span></span>

<span data-ttu-id="1fe89-155">Quando un'istanza del servizio Gestione API è ospitata in una rete virtuale, vengono utilizzate porte hello in hello nella tabella seguente.</span><span class="sxs-lookup"><span data-stu-id="1fe89-155">When an API Management service instance is hosted in a VNET, hello ports in hello following table are used.</span></span>

| <span data-ttu-id="1fe89-156">Porte di origine/destinazione</span><span class="sxs-lookup"><span data-stu-id="1fe89-156">Source / Destination Port(s)</span></span> | <span data-ttu-id="1fe89-157">Direzione</span><span class="sxs-lookup"><span data-stu-id="1fe89-157">Direction</span></span> | <span data-ttu-id="1fe89-158">Protocollo di trasporto</span><span class="sxs-lookup"><span data-stu-id="1fe89-158">Transport protocol</span></span> | <span data-ttu-id="1fe89-159">Scopo</span><span class="sxs-lookup"><span data-stu-id="1fe89-159">Purpose</span></span> | <span data-ttu-id="1fe89-160">Origine/Destinazione</span><span class="sxs-lookup"><span data-stu-id="1fe89-160">Source / Destination</span></span> | <span data-ttu-id="1fe89-161">Tipo di accesso</span><span class="sxs-lookup"><span data-stu-id="1fe89-161">Access type</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="1fe89-162">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="1fe89-162">* / 80, 443</span></span> |<span data-ttu-id="1fe89-163">In ingresso</span><span class="sxs-lookup"><span data-stu-id="1fe89-163">Inbound</span></span> |<span data-ttu-id="1fe89-164">TCP</span><span class="sxs-lookup"><span data-stu-id="1fe89-164">TCP</span></span> |<span data-ttu-id="1fe89-165">TooAPI di comunicazione client Management</span><span class="sxs-lookup"><span data-stu-id="1fe89-165">Client communication tooAPI Management</span></span> |<span data-ttu-id="1fe89-166">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="1fe89-166">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="1fe89-167">Esterno</span><span class="sxs-lookup"><span data-stu-id="1fe89-167">External</span></span> |
| <span data-ttu-id="1fe89-168">*/3443</span><span class="sxs-lookup"><span data-stu-id="1fe89-168">* / 3443</span></span> |<span data-ttu-id="1fe89-169">In ingresso</span><span class="sxs-lookup"><span data-stu-id="1fe89-169">Inbound</span></span> |<span data-ttu-id="1fe89-170">TCP</span><span class="sxs-lookup"><span data-stu-id="1fe89-170">TCP</span></span> |<span data-ttu-id="1fe89-171">Endpoint di gestione per il portale di Azure e PowerShell</span><span class="sxs-lookup"><span data-stu-id="1fe89-171">Management endpoint for Azure portal and Powershell</span></span> |<span data-ttu-id="1fe89-172">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="1fe89-172">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="1fe89-173">Esterno e interno</span><span class="sxs-lookup"><span data-stu-id="1fe89-173">External & Internal</span></span> |
| <span data-ttu-id="1fe89-174">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="1fe89-174">* / 80, 443</span></span> |<span data-ttu-id="1fe89-175">In uscita</span><span class="sxs-lookup"><span data-stu-id="1fe89-175">Outbound</span></span> |<span data-ttu-id="1fe89-176">TCP</span><span class="sxs-lookup"><span data-stu-id="1fe89-176">TCP</span></span> |<span data-ttu-id="1fe89-177">Dipendenza da Archiviazione di Azure e dal bus di servizio di Azure</span><span class="sxs-lookup"><span data-stu-id="1fe89-177">Dependency on Azure Storage and Azure Service Bus</span></span> |<span data-ttu-id="1fe89-178">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="1fe89-178">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="1fe89-179">Esterno e interno</span><span class="sxs-lookup"><span data-stu-id="1fe89-179">External & Internal</span></span> |
| <span data-ttu-id="1fe89-180">* / 1433</span><span class="sxs-lookup"><span data-stu-id="1fe89-180">* / 1433</span></span> |<span data-ttu-id="1fe89-181">In uscita</span><span class="sxs-lookup"><span data-stu-id="1fe89-181">Outbound</span></span> |<span data-ttu-id="1fe89-182">TCP</span><span class="sxs-lookup"><span data-stu-id="1fe89-182">TCP</span></span> |<span data-ttu-id="1fe89-183">Dipendenza da SQL di Azure</span><span class="sxs-lookup"><span data-stu-id="1fe89-183">Dependency on Azure SQL</span></span> |<span data-ttu-id="1fe89-184">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="1fe89-184">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="1fe89-185">Esterno e interno</span><span class="sxs-lookup"><span data-stu-id="1fe89-185">External & Internal</span></span> |
| <span data-ttu-id="1fe89-186">* / 11000 - 11999</span><span class="sxs-lookup"><span data-stu-id="1fe89-186">* / 11000 - 11999</span></span> |<span data-ttu-id="1fe89-187">In uscita</span><span class="sxs-lookup"><span data-stu-id="1fe89-187">Outbound</span></span> |<span data-ttu-id="1fe89-188">TCP</span><span class="sxs-lookup"><span data-stu-id="1fe89-188">TCP</span></span> |<span data-ttu-id="1fe89-189">Dipendenza da Azure SQL V12</span><span class="sxs-lookup"><span data-stu-id="1fe89-189">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="1fe89-190">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="1fe89-190">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="1fe89-191">Esterno e interno</span><span class="sxs-lookup"><span data-stu-id="1fe89-191">External & Internal</span></span> |
| <span data-ttu-id="1fe89-192">* / 14000 - 14999</span><span class="sxs-lookup"><span data-stu-id="1fe89-192">* / 14000 - 14999</span></span> |<span data-ttu-id="1fe89-193">In uscita</span><span class="sxs-lookup"><span data-stu-id="1fe89-193">Outbound</span></span> |<span data-ttu-id="1fe89-194">TCP</span><span class="sxs-lookup"><span data-stu-id="1fe89-194">TCP</span></span> |<span data-ttu-id="1fe89-195">Dipendenza da Azure SQL V12</span><span class="sxs-lookup"><span data-stu-id="1fe89-195">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="1fe89-196">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="1fe89-196">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="1fe89-197">Esterno e interno</span><span class="sxs-lookup"><span data-stu-id="1fe89-197">External & Internal</span></span> |
| <span data-ttu-id="1fe89-198">* / 5671</span><span class="sxs-lookup"><span data-stu-id="1fe89-198">* / 5671</span></span> |<span data-ttu-id="1fe89-199">In uscita</span><span class="sxs-lookup"><span data-stu-id="1fe89-199">Outbound</span></span> |<span data-ttu-id="1fe89-200">AMQP</span><span class="sxs-lookup"><span data-stu-id="1fe89-200">AMQP</span></span> |<span data-ttu-id="1fe89-201">Dipendenze per i criteri di Hub tooEvent Log e agente di monitoraggio</span><span class="sxs-lookup"><span data-stu-id="1fe89-201">Dependency for Log tooEvent Hub policy and monitoring agent</span></span> |<span data-ttu-id="1fe89-202">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="1fe89-202">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="1fe89-203">Esterno e interno</span><span class="sxs-lookup"><span data-stu-id="1fe89-203">External & Internal</span></span> |
| <span data-ttu-id="1fe89-204">6381 - 6383/6381 - 6383</span><span class="sxs-lookup"><span data-stu-id="1fe89-204">6381 - 6383 / 6381 - 6383</span></span> |<span data-ttu-id="1fe89-205">In ingresso e in uscita</span><span class="sxs-lookup"><span data-stu-id="1fe89-205">Inbound & Outbound</span></span> |<span data-ttu-id="1fe89-206">UDP</span><span class="sxs-lookup"><span data-stu-id="1fe89-206">UDP</span></span> |<span data-ttu-id="1fe89-207">Dipendenza dalla cache Redis</span><span class="sxs-lookup"><span data-stu-id="1fe89-207">Dependency on Redis Cache</span></span> |<span data-ttu-id="1fe89-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="1fe89-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="1fe89-209">Esterno e interno</span><span class="sxs-lookup"><span data-stu-id="1fe89-209">External & Internal</span></span> |-
| <span data-ttu-id="1fe89-210">* / 445</span><span class="sxs-lookup"><span data-stu-id="1fe89-210">* / 445</span></span> |<span data-ttu-id="1fe89-211">In uscita</span><span class="sxs-lookup"><span data-stu-id="1fe89-211">Outbound</span></span> |<span data-ttu-id="1fe89-212">TCP</span><span class="sxs-lookup"><span data-stu-id="1fe89-212">TCP</span></span> |<span data-ttu-id="1fe89-213">Dipendenza dalla condivisione file di Azure per GIT</span><span class="sxs-lookup"><span data-stu-id="1fe89-213">Dependency on Azure File Share for GIT</span></span> |<span data-ttu-id="1fe89-214">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="1fe89-214">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="1fe89-215">Esterno e interno</span><span class="sxs-lookup"><span data-stu-id="1fe89-215">External & Internal</span></span> |
| <span data-ttu-id="1fe89-216">* / *</span><span class="sxs-lookup"><span data-stu-id="1fe89-216">* / *</span></span> | <span data-ttu-id="1fe89-217">In ingresso</span><span class="sxs-lookup"><span data-stu-id="1fe89-217">Inbound</span></span> |<span data-ttu-id="1fe89-218">TCP</span><span class="sxs-lookup"><span data-stu-id="1fe89-218">TCP</span></span> |<span data-ttu-id="1fe89-219">Bilanciamento del carico di infrastruttura di Azure</span><span class="sxs-lookup"><span data-stu-id="1fe89-219">Azure Infrastructure Load Balancer</span></span> | <span data-ttu-id="1fe89-220">VIRTUAL_NETWORK/AZURE_LOADBALANCER</span><span class="sxs-lookup"><span data-stu-id="1fe89-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="1fe89-221">Esterno e interno</span><span class="sxs-lookup"><span data-stu-id="1fe89-221">External & Internal</span></span> |

* <span data-ttu-id="1fe89-222">**La funzionalità SSL**: certificato SSL tooenable catena servizio Gestione API hello compilazione e la convalida deve tooocsp.msocsp.com di connettività di rete in uscita, mscrl.microsoft.com e crl.microsoft.com. Questa dipendenza non è necessaria se qualsiasi certificato caricato tooAPI Management contenga radice toohello autorità di certificazione di hello catena completa.</span><span class="sxs-lookup"><span data-stu-id="1fe89-222">**SSL functionality**: tooenable SSL certificate chain building and validation hello API Management service needs Outbound network connectivity tooocsp.msocsp.com, mscrl.microsoft.com and crl.microsoft.com. This dependency is not required, if any certificate you upload tooAPI Management contain hello full chain toohello CA root.</span></span>

* <span data-ttu-id="1fe89-223">**Accesso a DNS**: l'accesso in uscita sulla porta 53 è necessario per la comunicazione con i server DNS.</span><span class="sxs-lookup"><span data-stu-id="1fe89-223">**DNS Access**: Outbound access on port 53 is required for communication with DNS servers.</span></span> <span data-ttu-id="1fe89-224">Se un server DNS personalizzato esiste in hello altra entità finale di un gateway VPN, server DNS hello deve essere raggiungibile dalla subnet hello gestione API di hosting.</span><span class="sxs-lookup"><span data-stu-id="1fe89-224">If a custom DNS server exists on hello other end of a VPN gateway, hello DNS server must be reachable from hello subnet hosting API Management.</span></span>

* <span data-ttu-id="1fe89-225">**Monitoraggio dell'integrità e le metriche**: in uscita connettività tooAzure monitoraggio gli endpoint di rete, quale risolto in hello seguenti domini: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="1fe89-225">**Metrics and Health Monitoring**: Outbound network connectivity tooAzure Monitoring endpoints, which resolve under hello following domains: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span></span>

* <span data-ttu-id="1fe89-226">**Express Route installazione**: una configurazione personalizzata comune è toodefine i propri route predefinita (0.0.0.0/0) impone in uscita Internet traffico tooinstead flusso locale.</span><span class="sxs-lookup"><span data-stu-id="1fe89-226">**Express Route Setup**: A common customer configuration is toodefine their own default route (0.0.0.0/0) which forces outbound Internet traffic tooinstead flow on-premises.</span></span> <span data-ttu-id="1fe89-227">Questo flusso di traffico indubbiamente a interruzioni di connettività con gestione API di Azure perché il traffico in uscita hello è bloccato in locale o NAT certificati tooan Impossibile riconoscere gli indirizzi che non funzionano con vari endpoint di Azure.</span><span class="sxs-lookup"><span data-stu-id="1fe89-227">This traffic flow invariably breaks connectivity with Azure API Management because hello outbound traffic is either blocked on-premises, or NAT'd tooan unrecognizable set of addresses that no longer work with various Azure endpoints.</span></span> <span data-ttu-id="1fe89-228">soluzione hello è route definite dall'utente toodefine (più) ([UDRs][UDRs]) nella subnet hello contenente hello gestione API di Azure.</span><span class="sxs-lookup"><span data-stu-id="1fe89-228">hello solution is toodefine one (or more) user-defined routes ([UDRs][UDRs]) on hello subnet that contains hello Azure API Management.</span></span> <span data-ttu-id="1fe89-229">Un UDR definisce le route di subnet specifiche che verranno utilizzato il valore anziché route predefinita hello.</span><span class="sxs-lookup"><span data-stu-id="1fe89-229">A UDR defines subnet-specific routes that will be honored instead of hello default route.</span></span>
  <span data-ttu-id="1fe89-230">Se possibile, è consigliabile hello toouse seguente configurazione:</span><span class="sxs-lookup"><span data-stu-id="1fe89-230">If possible, it is recommended toouse hello following configuration:</span></span>
 * <span data-ttu-id="1fe89-231">configurazione di ExpressRoute Hello annuncia 0.0.0.0/0 e per impostazione predefinita force tunnel tutto il traffico in uscita in locale.</span><span class="sxs-lookup"><span data-stu-id="1fe89-231">hello ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
 * <span data-ttu-id="1fe89-232">Hello UDR applicato toohello subnet contenente hello gestione API di Azure definisce 0.0.0.0/0 con un tipo di hop successivo di Internet.</span><span class="sxs-lookup"><span data-stu-id="1fe89-232">hello UDR applied toohello subnet containing hello Azure API Management defines 0.0.0.0/0 with a next hop type of Internet.</span></span>
 <span data-ttu-id="1fe89-233">Hello effetto combinato di questi passaggi è che il livello di subnet hello UDR ha la precedenza su hello garantendo l'accesso a Internet in uscita da hello gestione API di Azure, tunneling forzato ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="1fe89-233">hello combined effect of these steps is that hello subnet level UDR takes precedence over hello ExpressRoute forced tunneling, thus ensuring outbound Internet access from hello Azure API Management.</span></span>

>[!WARNING]  
><span data-ttu-id="1fe89-234">Gestione API di Azure non è supportato con ExpressRoute configurazioni che **in modo non corretto tra-annunciare le route da hello peering percorso toohello privata percorso di peering pubblico**.</span><span class="sxs-lookup"><span data-stu-id="1fe89-234">Azure API Management is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from hello public peering path toohello private peering path**.</span></span> <span data-ttu-id="1fe89-235">Le configurazioni di ExpressRoute che dispongono di peering pubblico configurato, riceveranno gli annunci di route da Microsoft per un elevato numero di intervalli di indirizzi IP di Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="1fe89-235">ExpressRoute configurations that have public peering configured, will receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="1fe89-236">Se questi intervalli di indirizzi in modo non corretto tra annunciati nel percorso di peering privato hello, risultato finale hello è che tutti i pacchetti di rete in uscita dalla subnet dell'istanza di hello gestione API di Azure sono di rete locale del cliente in modo errato il tunneling forzato tooa infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="1fe89-236">If these address ranges are incorrectly cross-advertised on hello private peering path, hello end result is that all outbound network packets from hello Azure API Management instance's subnet are incorrectly force-tunneled tooa customer's on-premises network infrastructure.</span></span> <span data-ttu-id="1fe89-237">Questo flusso di rete interromperà il servizio Gestione API di Azure.</span><span class="sxs-lookup"><span data-stu-id="1fe89-237">This network flow breaks Azure API Management.</span></span> <span data-ttu-id="1fe89-238">problema di toothis soluzione hello è toostop le route tra annunci hello peering percorso toohello privata percorso di peering pubblico.</span><span class="sxs-lookup"><span data-stu-id="1fe89-238">hello solution toothis problem is toostop cross-advertising routes from hello public peering path toohello private peering path.</span></span>


## <span data-ttu-id="1fe89-239"><a name="troubleshooting"> </a>Risoluzione dei problemi</span><span class="sxs-lookup"><span data-stu-id="1fe89-239"><a name="troubleshooting"> </a>Troubleshooting</span></span>
<span data-ttu-id="1fe89-240">Quando si effettua rete tooyour modifiche, fare riferimento troppo[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate se hello servizio Gestione API non ha perso l'accesso tooany di hello risorse critiche che dipende.</span><span class="sxs-lookup"><span data-stu-id="1fe89-240">When making changes tooyour network, refer too[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate if hello API Management service has not lost access tooany of hello critical resources which it depends upon.</span></span> <span data-ttu-id="1fe89-241">stato della connettività Hello deve essere aggiornato ogni 15 minuti.</span><span class="sxs-lookup"><span data-stu-id="1fe89-241">hello connectivity status should be updated every 15 minutes.</span></span>

## <span data-ttu-id="1fe89-242"><a name="limitations"></a>Limitazioni</span><span class="sxs-lookup"><span data-stu-id="1fe89-242"><a name="limitations"> </a>Limitations</span></span>
* <span data-ttu-id="1fe89-243">Una subnet contenente le istanze di Gestione API non può contenere altri tipi di risorse di Azure.</span><span class="sxs-lookup"><span data-stu-id="1fe89-243">A subnet containing API Management instances cannot contain any other Azure resource types.</span></span>
* <span data-ttu-id="1fe89-244">subnet Hello e hello API Gestione servizio deve essere in hello stessa sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="1fe89-244">hello subnet and hello API Management service must be in hello same subscription.</span></span>
* <span data-ttu-id="1fe89-245">Una subnet contenente le istanze di gestione API non può essere spostata da una sottoscrizione all'altra.</span><span class="sxs-lookup"><span data-stu-id="1fe89-245">A subnet containing API Management instances cannot be moved across subscriptions.</span></span>
* <span data-ttu-id="1fe89-246">Quando si utilizza una rete virtuale interna, solo un indirizzo IP interno saranno disponibile indicato l'intervallo di hello [RFC 1918](https://tools.ietf.org/html/rfc1918), non può essere fornito un indirizzo IP pubblico.</span><span class="sxs-lookup"><span data-stu-id="1fe89-246">When using an internal virtual network, only an internal IP address will be available from hello range stated in [RFC 1918](https://tools.ietf.org/html/rfc1918), a public IP address cannot be provided.</span></span>
* <span data-ttu-id="1fe89-247">Per le distribuzioni di gestione API di più aree, con le reti virtuali interne configurate, gli utenti sono responsabili per la gestione dei propri come possiedono hello DNS di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="1fe89-247">For multi-region API Management deployments, with Internal virtual networks configured, users are responsible for managing their own load balancing as they own hello DNS.</span></span>


## <span data-ttu-id="1fe89-248"><a name="related-content"></a>Contenuti correlati</span><span class="sxs-lookup"><span data-stu-id="1fe89-248"><a name="related-content"> </a>Related content</span></span>
* [<span data-ttu-id="1fe89-249">Connessione toobackend una rete virtuale tramite il Vpn Gateway</span><span class="sxs-lookup"><span data-stu-id="1fe89-249">Connecting a Virtual Network toobackend using Vpn Gateway</span></span>](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti)
* [<span data-ttu-id="1fe89-250">Connessione di una rete virtuale da modelli di distribuzione differenti</span><span class="sxs-lookup"><span data-stu-id="1fe89-250">Connecting a Virtual Network from different deployment models</span></span>](../vpn-gateway/vpn-gateway-connect-different-deployment-models-powershell.md)
* [<span data-ttu-id="1fe89-251">Modalità toouse hello tootrace API controllo chiama in Gestione API di Azure</span><span class="sxs-lookup"><span data-stu-id="1fe89-251">How toouse hello API Inspector tootrace calls in Azure API Management</span></span>](api-management-howto-api-inspector.md)

[api-management-using-vnet-menu]: ./media/api-management-using-with-vnet/api-management-menu-vnet.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-type.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-select.png
[api-management-setup-vpn-add-api]: ./media/api-management-using-with-vnet/api-management-using-vnet-add-api.png
[api-management-vnet-private]: ./media/api-management-using-with-vnet/api-management-vnet-private.png
[api-management-vnet-public]: ./media/api-management-using-with-vnet/api-management-vnet-public.png

[Enable VPN connections]: #enable-vpn
[Connect tooa web service behind VPN]: #connect-vpn
[Related content]: #related-content

[UDRs]: ../virtual-network/virtual-networks-udr-overview.md
[Network Security Group]: ../virtual-network/virtual-networks-nsg.md
