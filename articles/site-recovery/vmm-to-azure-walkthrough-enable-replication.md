---
title: Abilitare la replica in Azure per le macchine virtuali Hyper-V nei cloud VMM con Azure Site Recovery | Microsoft Docs
description: Questo articolo descrive come abilitare la replica in Azure per macchine virtuali Hyper-V nei cloud VMM con il servizio Azure Site Recovery
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 89a2c4fc-7e03-4a86-a2c0-52831ccebc1a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/23/2017
ms.author: raynew
ms.openlocfilehash: 96a817e43a830e836f2faa4603fc88ed9c0b1828
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/29/2017
---
# <a name="step-11-enable-replication-to-azure-for-hyper-v-vms-in-vmm-clouds"></a><span data-ttu-id="027b2-103">Passaggio 11: Abilitare la replica in Azure per le macchine virtuali Hyper-V nei cloud VMM</span><span class="sxs-lookup"><span data-stu-id="027b2-103">Step 11: Enable replication to Azure for Hyper-V VMs in VMM clouds</span></span>

<span data-ttu-id="027b2-104">Dopo avere impostato i criteri di replica, usare le istruzioni disponibili in questo articolo per abilitare la replica delle macchine virtuali Hyper-V locali gestite in cloud System Center Virtual Machine Manager (VMM) in Azure tramite il servizio [Azure Site Recovery](site-recovery-overview.md) nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="027b2-104">After you've set up a replication policy, use this article to enable replication for on-premises Hyper-V virtual machines (VMs) managed in System Center Virtual Machine Manager (VMM) clouds), to Azure, using the [Azure Site Recovery](site-recovery-overview.md) service in the Azure portal.</span></span>

<span data-ttu-id="027b2-105">Inserire commenti e domande nella parte inferiore di questo articolo oppure nel [forum sui servizi di ripristino di Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="027b2-105">Post comments and questions at the bottom of this article, or on the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="before-you-start"></a><span data-ttu-id="027b2-106">Prima di iniziare</span><span class="sxs-lookup"><span data-stu-id="027b2-106">Before you start</span></span>

<span data-ttu-id="027b2-107">Assicurarsi che l'account Azure includa le [autorizzazioni](site-recovery-role-based-linked-access-control.md#permissions-required-to-enable-replication-for-new-virtual-machines) corrette per la creazione di macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="027b2-107">Make sure your Azure account has the correct [permissions](site-recovery-role-based-linked-access-control.md#permissions-required-to-enable-replication-for-new-virtual-machines)to create Azure VMs.</span></span> <span data-ttu-id="027b2-108">[Altre informazioni](../active-directory/role-based-access-built-in-roles.md) sul controllo degli accessi in base al ruolo di Azure.</span><span class="sxs-lookup"><span data-stu-id="027b2-108">[Learn more](../active-directory/role-based-access-built-in-roles.md) about Azure role-based access control.</span></span>

## <a name="exclude-disks-from-replication"></a><span data-ttu-id="027b2-109">Escludere dischi dalla replica</span><span class="sxs-lookup"><span data-stu-id="027b2-109">Exclude disks from replication</span></span>

<span data-ttu-id="027b2-110">Per impostazione predefinita, vengono replicati tutti i dischi in un computer.</span><span class="sxs-lookup"><span data-stu-id="027b2-110">By default all disks on a machine are replicated.</span></span> <span data-ttu-id="027b2-111">È possibile escludere dischi dalla replica.</span><span class="sxs-lookup"><span data-stu-id="027b2-111">You can exclude disks from replication.</span></span> <span data-ttu-id="027b2-112">Ad esempio, è possibile evitare di replicare i dischi con dati temporanei o dati che vengono aggiornati ogni volta che un computer o un'applicazione viene riavviata, come pagefile.sys o tempdb di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="027b2-112">For example you might not want to replicate disks with temporary data, or data that's refreshed each time a machine or application restarts (for example pagefile.sys or SQL Server tempdb).</span></span> [<span data-ttu-id="027b2-113">Altre informazioni</span><span class="sxs-lookup"><span data-stu-id="027b2-113">Learn more</span></span>](site-recovery-exclude-disk.md)

## <a name="replicate-vms"></a><span data-ttu-id="027b2-114">Replicare le VM</span><span class="sxs-lookup"><span data-stu-id="027b2-114">Replicate VMs</span></span>

<span data-ttu-id="027b2-115">Abilitare la replica per le macchine virtuali nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="027b2-115">Enable replication for VMs as follows:</span></span>  

1. <span data-ttu-id="027b2-116">Fare clic su **Passaggio 2: Eseguire la replica dell'applicazione** > **Origine**.</span><span class="sxs-lookup"><span data-stu-id="027b2-116">Click **Step 2: Replicate application** > **Source**.</span></span> <span data-ttu-id="027b2-117">Dopo avere abilitato la replica per la prima volta, è necessario fare clic su **+Replica** nell'insieme di credenziali per abilitare la replica per altre macchine.</span><span class="sxs-lookup"><span data-stu-id="027b2-117">After you've enabled replication for the first time, click **+Replicate** in the vault to enable replication for additional machines.</span></span>

    ![Abilitare la replica](./media/vmm-to-azure-walkthrough-enable-replication/enable-replication1.png)
2. <span data-ttu-id="027b2-119">Nel pannello **Origine** selezionare il cloud e il server VMM in cui si trovano gli host Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="027b2-119">In the **Source** blade, select the VMM server, and the cloud in which the Hyper-V hosts are located.</span></span> <span data-ttu-id="027b2-120">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="027b2-120">Then click **OK**.</span></span>

    ![Abilitare la replica](./media/vmm-to-azure-walkthrough-enable-replication/enable-replication-source.png)
3. <span data-ttu-id="027b2-122">In **Destinazione** selezionare la sottoscrizione, il modello di distribuzione da usare dopo il failover e l'account di archiviazione usato per i dati replicati.</span><span class="sxs-lookup"><span data-stu-id="027b2-122">In **Target**, select the subscription, post-failover deployment model, and the storage account you're using for replicated data.</span></span>

    ![Abilitare la replica](./media/vmm-to-azure-walkthrough-enable-replication/enable-replication-target.png)
4. <span data-ttu-id="027b2-124">Selezionare l'account di archiviazione da usare.</span><span class="sxs-lookup"><span data-stu-id="027b2-124">Select the storage account you want to use.</span></span> <span data-ttu-id="027b2-125">Per usare un account di archiviazione diverso da quelli disponibili, è possibile [crearne uno](#set-up-an-azure-storage-account).</span><span class="sxs-lookup"><span data-stu-id="027b2-125">If you want to use a different storage account than those you have, you can [create one](#set-up-an-azure-storage-account).</span></span> <span data-ttu-id="027b2-126">Se si usa un account di archiviazione Premium per i dati replicati, è necessario selezionare un account di archiviazione Standard aggiuntivo per l'archiviazione dei log di replica in cui vengono acquisite le modifiche in corso ai dati locali. Per creare un account di archiviazione usando il modello di Resource Manager, fare clic su **Crea nuovo**.</span><span class="sxs-lookup"><span data-stu-id="027b2-126">If you’re using a premium storage account for replicated data, you need to select  an additional standard storage account to store replication logs that capture ongoing changes to on-premises data.To create a storage account using the Resource Manager model click **Create new**.</span></span> <span data-ttu-id="027b2-127">Per creare un account di archiviazione con il modello di distribuzione classica, usare il [portale di Azure](../storage/common/storage-create-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="027b2-127">If you want to create a storage account using the classic model, do that [in the Azure portal](../storage/common/storage-create-storage-account.md).</span></span> <span data-ttu-id="027b2-128">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="027b2-128">Then click **OK**.</span></span>
5. <span data-ttu-id="027b2-129">Selezionare la rete di Azure e la subnet a cui dovranno connettersi le VM di Azure create dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="027b2-129">Select the Azure network and subnet to which Azure VMs will connect, when they're created after failover.</span></span> <span data-ttu-id="027b2-130">Scegliere **Configurare ora per le macchine virtuali selezionate** per applicare le impostazioni di rete a tutti i computer selezionati per la protezione.</span><span class="sxs-lookup"><span data-stu-id="027b2-130">Select **Configure now for selected machines**, to apply the network setting to all machines you select for protection.</span></span> <span data-ttu-id="027b2-131">Scegliere **Configurare in seguito** per selezionare la rete di Azure per ogni computer.</span><span class="sxs-lookup"><span data-stu-id="027b2-131">Select **Configure later**, to select the Azure network per machine.</span></span> <span data-ttu-id="027b2-132">Se si vuole usare una rete diversa da quelle disponibili, è possibile [crearne una](#set-up-an-azure-network).</span><span class="sxs-lookup"><span data-stu-id="027b2-132">If you want to use a different network from those you have, you can [create one](#set-up-an-azure-network).</span></span> <span data-ttu-id="027b2-133">Per creare una rete con il modello di distribuzione di Resource Manager, fare clic su **Crea nuovo**.</span><span class="sxs-lookup"><span data-stu-id="027b2-133">To create a network using the Resource Manager model click **Create new**.</span></span> <span data-ttu-id="027b2-134">Per creare una rete con il modello di distribuzione classica, usare il [portale di Azure](../virtual-network/virtual-networks-create-vnet-classic-pportal.md).</span><span class="sxs-lookup"><span data-stu-id="027b2-134">If you want to create a network using the classic model, do that [in the Azure portal](../virtual-network/virtual-networks-create-vnet-classic-pportal.md).</span></span> <span data-ttu-id="027b2-135">Selezionare una subnet, se applicabile.</span><span class="sxs-lookup"><span data-stu-id="027b2-135">Select a subnet if applicable.</span></span> <span data-ttu-id="027b2-136">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="027b2-136">Then click **OK**.</span></span>
6. <span data-ttu-id="027b2-137">In **Macchine virtuali** > **Seleziona macchine virtuali** fare clic per selezionare tutte le macchine virtuali da replicare.</span><span class="sxs-lookup"><span data-stu-id="027b2-137">In **Virtual Machines** > **Select virtual machines**, click and select each machine you want to replicate.</span></span> <span data-ttu-id="027b2-138">È possibile selezionare solo i computer per cui è possibile abilitare la replica.</span><span class="sxs-lookup"><span data-stu-id="027b2-138">You can only select machines for which replication can be enabled.</span></span> <span data-ttu-id="027b2-139">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="027b2-139">Then click **OK**.</span></span>

    ![Abilitare la replica](./media/vmm-to-azure-walkthrough-enable-replication/enable-replication5.png)

7. <span data-ttu-id="027b2-141">In **Proprietà** > **Configura proprietà**selezionare il sistema operativo per le VM selezionate e il disco del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="027b2-141">In **Properties** > **Configure properties**, select the operating system for the selected VMs, and the OS disk.</span></span>

    - <span data-ttu-id="027b2-142">Verificare che il nome della VM di Azure (nome di destinazione) sia conforme ai [requisiti per le macchine virtuali di Azure](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).</span><span class="sxs-lookup"><span data-stu-id="027b2-142">Verify that the Azure VM name (target name) complies with [Azure virtual machine requirements](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).</span></span>   
    - <span data-ttu-id="027b2-143">Per impostazione predefinita, tutti i dischi della VM sono selezionati per la replica. È tuttavia possibile cancellarli per escluderli,</span><span class="sxs-lookup"><span data-stu-id="027b2-143">By default all the disks of the VM are selected for replication, but you can clear disks to exclude them.</span></span>

        - <span data-ttu-id="027b2-144">ad esempio per ridurre la larghezza di banda di replica.</span><span class="sxs-lookup"><span data-stu-id="027b2-144">You might want to exclude disks to reduce replication bandwidth.</span></span> <span data-ttu-id="027b2-145">È possibile evitare, ad esempio, di replicare i dischi con dati temporanei o dati che vengono aggiornati ad ogni riavvio di un computer o di un'applicazione, come pagefile.sys o tempdb di Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="027b2-145">For example, you might not want to replicate disks with temporary data, or data that's refreshed each time a machine or apps restarts (such as pagefile.sys or Microsoft SQL Server tempdb).</span></span> <span data-ttu-id="027b2-146">Per escludere un disco dalla replica, è sufficiente selezionarlo.</span><span class="sxs-lookup"><span data-stu-id="027b2-146">You can exclude the disk from replication by unselecting the disk.</span></span>
        - <span data-ttu-id="027b2-147">Solo i dischi di base possono essere esclusi dalla replica.</span><span class="sxs-lookup"><span data-stu-id="027b2-147">Only basic disks can be exclude.</span></span> <span data-ttu-id="027b2-148">Non è possibile escludere dischi del sistema operativo</span><span class="sxs-lookup"><span data-stu-id="027b2-148">You can't exclude OS disks.</span></span>
        - <span data-ttu-id="027b2-149">e non è consigliabile escludere dischi dinamici.</span><span class="sxs-lookup"><span data-stu-id="027b2-149">We recommend that you don't exclude dynamic disks.</span></span> <span data-ttu-id="027b2-150">Site Recovery non può determinare se un disco rigido virtuale all'interno della macchina virtuale guest è di base o dinamico.</span><span class="sxs-lookup"><span data-stu-id="027b2-150">Site Recovery can't identify whether a virtual hard disk inside a guest VM is basic or dynamic.</span></span> <span data-ttu-id="027b2-151">Se non sono esclusi tutti i volumi dinamici dipendenti, in caso di failover della VM il disco dinamico protetto risulterà guasto e non sarà possibile accedere ai dati presenti su tale disco.</span><span class="sxs-lookup"><span data-stu-id="027b2-151">If all dependent dynamic volume disks aren't excluded, the protected dynamic disk will show as a failed disk when the VM fails over, and the data on that disk won't be accessible.</span></span>
        - <span data-ttu-id="027b2-152">Dopo aver abilitato la replica, non è più possibile aggiungere o rimuovere dischi da replicare.</span><span class="sxs-lookup"><span data-stu-id="027b2-152">After replication is enabled, you can't add or remove disks for replication.</span></span> <span data-ttu-id="027b2-153">Se si desidera aggiungere o escludere un disco, è necessario disabilitare la protezione della macchina virtuale e riabilitarla al termine dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="027b2-153">If you want to add or exclude a disk, you need to disable protection for the VM, and then re-enable it.</span></span>
        - <span data-ttu-id="027b2-154">Per i dischi creati manualmente in Azure non viene eseguito il failback.</span><span class="sxs-lookup"><span data-stu-id="027b2-154">Disks you create manually in Azure aren't failed back.</span></span> <span data-ttu-id="027b2-155">Ad esempio, se si esegue il failover di tre dischi e se ne creano due direttamente in Azure, verrà eseguito il failback da Azure a Hyper-V soltanto dei tre dischi.</span><span class="sxs-lookup"><span data-stu-id="027b2-155">For example, if you fail over three disks, and create two directly in Azure VM, only the three disks which were failed over will be failed back from Azure to Hyper-V.</span></span> <span data-ttu-id="027b2-156">Non è possibile includere nel failback o nella replica inversa da Hyper-V ad Azure i dischi creati manualmente.</span><span class="sxs-lookup"><span data-stu-id="027b2-156">You can't include disks created manually in failback, or in reverse replication from Hyper-V to Azure.</span></span>
        - <span data-ttu-id="027b2-157">Se si esclude un disco necessario per il funzionamento di un'applicazione, dopo il failover in Azure è necessario crearlo manualmente in Azure per consentire l'esecuzione dell'applicazione replicata.</span><span class="sxs-lookup"><span data-stu-id="027b2-157">If you exclude a disk that's needed for an application to operate, after failover to Azure you need to create it manually in Azure, so that the replicated application can run.</span></span> <span data-ttu-id="027b2-158">È possibile in alternativa integrare Automazione di Azure in un piano di ripristino per creare il disco durante il failover del computer.</span><span class="sxs-lookup"><span data-stu-id="027b2-158">Alternatively, you could integrate Azure automation into a recovery plan, to create the disk during failover of the machine.</span></span>

    <span data-ttu-id="027b2-159">Fare clic su **OK** per salvare le modifiche.</span><span class="sxs-lookup"><span data-stu-id="027b2-159">Click **OK** to save changes.</span></span> <span data-ttu-id="027b2-160">È possibile impostare proprietà aggiuntive in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="027b2-160">You can set additional properties later.</span></span>

    ![Abilitare la replica](./media/vmm-to-azure-walkthrough-enable-replication/enable-replication6-with-exclude-disk.png)

8. <span data-ttu-id="027b2-162">In **Impostazioni della replica** > **Configurare le impostazioni di replica** selezionare i criteri di replica da applicare per le VM protette.</span><span class="sxs-lookup"><span data-stu-id="027b2-162">In **Replication settings** > **Configure replication settings**, select the replication policy you want to apply for the protected VMs.</span></span> <span data-ttu-id="027b2-163">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="027b2-163">Then click **OK**.</span></span> <span data-ttu-id="027b2-164">È possibile modificare i criteri di replica in **Criteri di replica** > nome del criterio > **Modifica impostazioni**.</span><span class="sxs-lookup"><span data-stu-id="027b2-164">You can modify the replication policy in **Replication policies** > policy name > **Edit Settings**.</span></span> <span data-ttu-id="027b2-165">Le modifiche applicate vengono usate per i computer di cui è già in corso la replica e per i nuovi computer.</span><span class="sxs-lookup"><span data-stu-id="027b2-165">Changes you apply are used for machines that are already replicating, and new machines.</span></span>

   ![Abilitare la replica](./media/vmm-to-azure-walkthrough-enable-replication/enable-replication7.png)

<span data-ttu-id="027b2-167">È possibile tenere traccia dello stato del processo **Abilita protezione** in **Processi** > **Site Recovery jobs** (Processi di Site Recovery).</span><span class="sxs-lookup"><span data-stu-id="027b2-167">You can track progress of the **Enable Protection** job in **Jobs** > **Site Recovery jobs**.</span></span> <span data-ttu-id="027b2-168">Dopo l'esecuzione del processo **Finalizza protezione** la macchina virtuale è pronta per il failover.</span><span class="sxs-lookup"><span data-stu-id="027b2-168">After the **Finalize Protection** job runs, the machine is ready for failover.</span></span>



## <a name="next-steps"></a><span data-ttu-id="027b2-169">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="027b2-169">Next steps</span></span>

<span data-ttu-id="027b2-170">Andare al [Passaggio 12: Eseguire un failover di test](vmm-to-azure-walkthrough-test-failover.md)</span><span class="sxs-lookup"><span data-stu-id="027b2-170">Go to [Step 12: Run a test failover](vmm-to-azure-walkthrough-test-failover.md)</span></span>
