---
title: "aaaConfigure Azure MFA Server per la disponibilità elevata | Documenti Microsoft"
description: "Distribuire più istanze del server Microsoft Azure Multi-Factor Authentication in configurazioni che offrono disponibilità elevata."
services: multi-factor-authentication
keywords: Azure MFA,
documentationcenter: 
author: MicrosoftGuyJFlo
manager: femila
ms.assetid: 
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/23/2017
ms.author: joflore
ms.reviewer: alexwe
ms.custom: it-pro
ms.openlocfilehash: 8c6b1921c734c7a7273e443b3591fbbb15cd5e6c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="configure-azure-multi-factor-authentication-server-for-high-availability"></a><span data-ttu-id="6bea1-104">Configurare il server Azure MFA per la disponibilità elevata</span><span class="sxs-lookup"><span data-stu-id="6bea1-104">Configure Azure Multi-Factor Authentication Server for high availability</span></span>

<span data-ttu-id="6bea1-105">tooachieve a disponibilità elevata con la distribuzione di Azure MFA Server, è necessario toodeploy più server di autenticazione a più fattori.</span><span class="sxs-lookup"><span data-stu-id="6bea1-105">tooachieve high-availability with your Azure Server MFA deployment, you need toodeploy multiple MFA servers.</span></span> <span data-ttu-id="6bea1-106">In questa sezione vengono fornite informazioni su tooachieve una progettazione con bilanciamento del carico le destinazioni di disponibilità elevata nella distribuzione di Azure MFS Server.</span><span class="sxs-lookup"><span data-stu-id="6bea1-106">This section provides information on a load-balanced design tooachieve your high availability targets in you Azure MFS Server deployment.</span></span>

## <a name="mfa-server-overview"></a><span data-ttu-id="6bea1-107">Panoramica del server MFA</span><span class="sxs-lookup"><span data-stu-id="6bea1-107">MFA Server overview</span></span>

<span data-ttu-id="6bea1-108">come illustrato nel seguente diagramma hello Hello architettura del servizio Azure MFA Server è costituito da diversi componenti:</span><span class="sxs-lookup"><span data-stu-id="6bea1-108">hello Azure MFA Server service architecture comprises several components as shown in hello following diagram:</span></span>

 ![Architettura del server MFA](./media/mfa-server-high-availability/mfa-ha-architecture.png)

<span data-ttu-id="6bea1-110">Un Server di autenticazione a più fattori è un Server di Windows a cui è installato software di hello Azure multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="6bea1-110">An MFA Server is a Windows Server that has hello Azure Multi-Factor Authentication software installed.</span></span> <span data-ttu-id="6bea1-111">istanza del Server di autenticazione a più fattori Hello deve essere attivato da hello del servizio di autenticazione a più fattori in Azure toofunction.</span><span class="sxs-lookup"><span data-stu-id="6bea1-111">hello MFA Server instance must be activated by hello MFA Service in Azure toofunction.</span></span> <span data-ttu-id="6bea1-112">È possibile installare più di un server MFA locale.</span><span class="sxs-lookup"><span data-stu-id="6bea1-112">More than one MFA Server can be installed on-premises.</span></span>

<span data-ttu-id="6bea1-113">primo Server di autenticazione a più fattori che è installato è Hello hello Server master di autenticazione a più fattori per l'attivazione da hello servizio di autenticazione a più fattori di Azure per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="6bea1-113">hello first MFA Server that is installed is hello master MFA Server upon activation by hello Azure MFA Service by default.</span></span> <span data-ttu-id="6bea1-114">server MFA master Hello è una copia del database PhoneFactor.pfdata hello scrivibile.</span><span class="sxs-lookup"><span data-stu-id="6bea1-114">hello master MFA server has a writeable copy of hello PhoneFactor.pfdata database.</span></span> <span data-ttu-id="6bea1-115">Le installazioni successive delle istanze del server MFA sono note con il nome di slave.</span><span class="sxs-lookup"><span data-stu-id="6bea1-115">Subsequent installations of instances of MFA Server are known as slaves.</span></span> <span data-ttu-id="6bea1-116">server secondari di autenticazione a più fattori Hello dispongono di una copia replicata di sola lettura del database PhoneFactor.pfdata hello.</span><span class="sxs-lookup"><span data-stu-id="6bea1-116">hello MFA slaves have a replicated read-only copy of hello PhoneFactor.pfdata database.</span></span> <span data-ttu-id="6bea1-117">I server MFA replicano le informazioni mediante Remote Procedure Call (RPC).</span><span class="sxs-lookup"><span data-stu-id="6bea1-117">MFA servers replicate information using Remote Procedure Call (RPC).</span></span> <span data-ttu-id="6bea1-118">Tutti i server, autenticazione a più fattori collettivamente possono essere aggiunti a un dominio o autonomo tooreplicate informazioni.</span><span class="sxs-lookup"><span data-stu-id="6bea1-118">All MFA Severs must collectively either be domain joined or standalone tooreplicate information.</span></span>

<span data-ttu-id="6bea1-119">Schema di autenticazione a più fattori sia slave MFA server comunicano con hello del servizio di autenticazione a più fattori quando è necessaria l'autenticazione a due fattori.</span><span class="sxs-lookup"><span data-stu-id="6bea1-119">Both MFA master and slave MFA Servers communicate with hello MFA Service when two-factor authentication is required.</span></span> <span data-ttu-id="6bea1-120">Ad esempio, quando un utente tenta l'applicazione di tooan accesso toogain che richiede l'autenticazione a due fattori, utente hello prima essere autenticati da un provider di identità, ad esempio Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="6bea1-120">For example, when a user attempts toogain access tooan application that requires two-factor authentication, hello user will first be authenticated by an identity provider, such as Active Directory (AD).</span></span>

<span data-ttu-id="6bea1-121">Dopo l'autenticazione con Active Directory, hello Server MFA comunicherà con il servizio di autenticazione a più fattori hello.</span><span class="sxs-lookup"><span data-stu-id="6bea1-121">After successful authentication with AD, hello MFA Server will communicate with hello MFA Service.</span></span> <span data-ttu-id="6bea1-122">Hello MFA Server è in attesa di notifiche da tooallow servizio di autenticazione a più fattori hello o negare un'applicazione hello utente accesso toohello.</span><span class="sxs-lookup"><span data-stu-id="6bea1-122">hello MFA Server waits for notification from hello MFA Service tooallow or deny hello user access toohello application.</span></span>

<span data-ttu-id="6bea1-123">Se il server master di autenticazione a più fattori hello è offline, le autenticazioni possono comunque essere elaborate, ma non è possibile elaborare le operazioni che richiedono modifiche toohello MFA database.</span><span class="sxs-lookup"><span data-stu-id="6bea1-123">If hello MFA master server goes offline, authentications can still be processed, but operations that require changes toohello MFA database cannot be processed.</span></span> <span data-ttu-id="6bea1-124">(Alcuni esempi: hello aggiunta di utenti self-service modifiche PIN e la modifica delle informazioni utente)</span><span class="sxs-lookup"><span data-stu-id="6bea1-124">(Examples include: hello addition of users, self-service PIN changes, and changing user information)</span></span>

## <a name="deployment"></a><span data-ttu-id="6bea1-125">Distribuzione</span><span class="sxs-lookup"><span data-stu-id="6bea1-125">Deployment</span></span>

<span data-ttu-id="6bea1-126">Prendere in considerazione hello seguenti punti importanti per il bilanciamento del carico di Azure MFA Server e i componenti correlati.</span><span class="sxs-lookup"><span data-stu-id="6bea1-126">Consider hello following important points for load balancing Azure MFA Server and its related components.</span></span>

* <span data-ttu-id="6bea1-127">**Usando la disponibilità elevata di RADIUS standard tooachieve**.</span><span class="sxs-lookup"><span data-stu-id="6bea1-127">**Using RADIUS standard tooachieve high availability**.</span></span> <span data-ttu-id="6bea1-128">Se si usano server Azure MFA come server RADIUS, è possibile configurare un server MFA come destinazione di autenticazione RADIUS primaria e altri server Azure MFA come destinazioni di autenticazione secondarie.</span><span class="sxs-lookup"><span data-stu-id="6bea1-128">If you are using Azure MFA Servers as RADIUS servers, you can potentially configure one MFA Server as a primary RADIUS authentication target and other Azure MFA Servers as secondary authentication targets.</span></span> <span data-ttu-id="6bea1-129">Tuttavia, disponibilità elevata di tooachieve questo metodo potrebbe non essere pratica perché è necessario attendere un toooccur periodo di timeout quando l'autenticazione ha esito negativo nella destinazione di autenticazione principale hello prima che possa essere autenticato con l'autenticazione secondaria hello destinazione.</span><span class="sxs-lookup"><span data-stu-id="6bea1-129">However, this method tooachieve high availability may not be practical because you must wait for a time-out period toooccur when authentication fails on hello primary authentication target before you can be authenticated against hello secondary authentication target.</span></span> <span data-ttu-id="6bea1-130">È più efficiente tooload saldo hello traffico RADIUS tra client RADIUS hello e server RADIUS hello (in questo caso, hello Azure MFA server funge da server RADIUS) in modo che è possibile configurare client RADIUS hello con un singolo URL che puntano a.</span><span class="sxs-lookup"><span data-stu-id="6bea1-130">It is more efficient tooload balance hello RADIUS traffic between hello RADIUS client and hello RADIUS Servers (in this case, hello Azure MFA Servers acting as RADIUS servers) so that you can configure hello RADIUS clients with a single URL that they can point to.</span></span>
* <span data-ttu-id="6bea1-131">**È necessario toomanually alzare di livello server secondari MFA**.</span><span class="sxs-lookup"><span data-stu-id="6bea1-131">**Need toomanually promote MFA slaves**.</span></span> <span data-ttu-id="6bea1-132">Se il server Azure MFA master di hello è offline, hello Azure MFA server secondari continuano tooprocess le richieste di autenticazione a più fattori.</span><span class="sxs-lookup"><span data-stu-id="6bea1-132">If hello master Azure MFA server goes offline, hello secondary Azure MFA Servers continue tooprocess MFA requests.</span></span> <span data-ttu-id="6bea1-133">Tuttavia, fino a quando non è disponibile un server master di autenticazione a più fattori, gli amministratori non possono aggiungere utenti o modificare le impostazioni di autenticazione a più fattori e gli utenti non possono apportare modifiche tramite il portale utenti hello.</span><span class="sxs-lookup"><span data-stu-id="6bea1-133">However, until a master MFA server is available, admins can not add users or modify MFA settings, and users can not make changes using hello user portal.</span></span> <span data-ttu-id="6bea1-134">La promozione di un ruolo di master toohello slave dell'autenticazione a più fattori è sempre un processo manuale.</span><span class="sxs-lookup"><span data-stu-id="6bea1-134">Promoting an MFA slave toohello master role is always a manual process.</span></span>
* <span data-ttu-id="6bea1-135">**Separabilità dei componenti**.</span><span class="sxs-lookup"><span data-stu-id="6bea1-135">**Separability of components**.</span></span> <span data-ttu-id="6bea1-136">Hello Azure MFA Server è costituito da diversi componenti che possono essere installati hello stessa istanza del Server di Windows o in istanze diverse.</span><span class="sxs-lookup"><span data-stu-id="6bea1-136">hello Azure MFA Server comprises several components that can be installed on hello same Windows Server instance or on different instances.</span></span> <span data-ttu-id="6bea1-137">Questi componenti includono hello portale per gli utenti e servizio Web App Mobile adattatore ADFS hello (agente).</span><span class="sxs-lookup"><span data-stu-id="6bea1-137">These components include hello User Portal, Mobile App Web Service, and hello ADFS adapter (agent).</span></span> <span data-ttu-id="6bea1-138">Questo separability rende possibili toouse hello Proxy applicazione Web toopublish hello portale per gli utenti e Server Web di App Mobile dalla rete perimetrale hello.</span><span class="sxs-lookup"><span data-stu-id="6bea1-138">This separability makes it possible toouse hello Web Application Proxy toopublish hello User Portal and Mobile App Web Server from hello perimeter network.</span></span> <span data-ttu-id="6bea1-139">Questo tipo di configurazione aggiunge toohello sicurezza complessiva di progettazione, come illustrato nel seguente diagramma hello.</span><span class="sxs-lookup"><span data-stu-id="6bea1-139">Such a configuration adds toohello overall security of your design, as shown in hello following diagram.</span></span> <span data-ttu-id="6bea1-140">Hello portale per gli utenti autenticazione a più fattori e il Server Web di App mobili possono essere distribuiti anche in configurazioni con bilanciamento del carico a disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="6bea1-140">hello MFA User Portal and Mobile App Web Server may also be deployed in HA load-balanced configurations.</span></span>

   ![Server MFA con una rete perimetrale](./media/mfa-server-high-availability/mfasecurity.png)

* <span data-ttu-id="6bea1-142">**Password monouso (OTP) con SMS (noto anche come unidirezionale SMS) richiede l'utilizzo di hello di sessioni permanenti se il traffico con bilanciamento del carico**.</span><span class="sxs-lookup"><span data-stu-id="6bea1-142">**One-time password (OTP) over SMS (aka one-way SMS) requires hello use of sticky sessions if traffic is load-balanced**.</span></span> <span data-ttu-id="6bea1-143">SMS unidirezionali è un'opzione di autenticazione che fa sì che gli utenti di hello hello Server MFA toosend un messaggio di testo contenente un OTP.</span><span class="sxs-lookup"><span data-stu-id="6bea1-143">One-way SMS is an authentication option that causes hello MFA Server toosend hello users a text message containing an OTP.</span></span> <span data-ttu-id="6bea1-144">Hello immessi hello OTP in un hello toocomplete finestra prompt dei comandi richiesta di autenticazione a più fattori.</span><span class="sxs-lookup"><span data-stu-id="6bea1-144">hello user enters hello OTP in a prompt window toocomplete hello MFA challenge.</span></span> <span data-ttu-id="6bea1-145">Se il server di autenticazione a più fattori di Azure di bilanciamento del carico, hello stesso server che ha gestito la richiesta di autenticazione iniziale hello deve essere hello server che riceve il messaggio OTP hello da utente hello. Se un altro Server di autenticazione a più fattori riceve hello risposta OTP, la richiesta di autenticazione hello ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="6bea1-145">If you load balance Azure MFA Servers, hello same server that served hello initial authentication request must be hello server that receives hello OTP message from hello user; if another MFA Server receives hello OTP reply, hello authentication challenge fails.</span></span> <span data-ttu-id="6bea1-146">Per ulteriori informazioni, vedere [Password per una tramite SMS aggiunti tooAzure Server MFA](https://blogs.technet.microsoft.com/enterprisemobility/2015/03/02/one-time-password-over-sms-added-to-azure-mfa-server).</span><span class="sxs-lookup"><span data-stu-id="6bea1-146">For more information, see [One Time Password over SMS Added tooAzure MFA Server](https://blogs.technet.microsoft.com/enterprisemobility/2015/03/02/one-time-password-over-sms-added-to-azure-mfa-server).</span></span>
* <span data-ttu-id="6bea1-147">**Distribuzioni di bilanciamento del carico di hello portale per gli utenti e servizio Web App Mobile richiedano le sessioni permanenti**.</span><span class="sxs-lookup"><span data-stu-id="6bea1-147">**Load-Balanced deployments of hello User Portal and Mobile App Web Service require sticky sessions**.</span></span> <span data-ttu-id="6bea1-148">In caso di bilanciamento del carico hello portale per gli utenti autenticazione a più fattori e hello servizio Web App Mobile, ogni sessione deve toostay su hello nello stesso server.</span><span class="sxs-lookup"><span data-stu-id="6bea1-148">If you are load-balancing hello MFA User Portal and hello Mobile App Web Service, each session needs toostay on hello same server.</span></span>

## <a name="high-availability-deployment"></a><span data-ttu-id="6bea1-149">Distribuzione a disponibilità elevata</span><span class="sxs-lookup"><span data-stu-id="6bea1-149">High-availability deployment</span></span>

<span data-ttu-id="6bea1-150">Hello seguente è illustrata un'implementazione completa di bilanciamento del carico a disponibilità elevata di Azure MFA e i relativi componenti, insieme ad FS per riferimento.</span><span class="sxs-lookup"><span data-stu-id="6bea1-150">hello following diagram shows a complete HA load-balanced implementation of Azure MFA and its components, along with ADFS for reference.</span></span>

 ![Implementazione a disponibilità elevata del server Azure MFA](./media/mfa-server-high-availability/mfa-ha-deployment.png)

<span data-ttu-id="6bea1-152">Si noti hello seguenti elementi per area hello conseguentemente numerato di hello precedente diagramma.</span><span class="sxs-lookup"><span data-stu-id="6bea1-152">Note hello following items for hello correspondingly numbered area of hello preceding diagram.</span></span>

1. <span data-ttu-id="6bea1-153">sono due server di autenticazione a più fattori di Azure (MFA1 e MFA2) Hello carico bilanciato (mfaapp.contoso.com) e sono toouse configurato un database di PhoneFactor.pfdata hello tooreplicate (4443) porta statica.</span><span class="sxs-lookup"><span data-stu-id="6bea1-153">hello two Azure MFA Servers (MFA1 and MFA2) are load balanced (mfaapp.contoso.com) and are configured toouse a static port (4443) tooreplicate hello PhoneFactor.pfdata database.</span></span> <span data-ttu-id="6bea1-154">Hello Web Service SDK sia installato in ogni di comunicazione di hello Server MFA tooenable sulla porta TCP 443 con i server ADFS hello.</span><span class="sxs-lookup"><span data-stu-id="6bea1-154">hello Web Service SDK is installed on each of hello MFA Server tooenable communication over TCP port 443 with hello ADFS servers.</span></span> <span data-ttu-id="6bea1-155">i server di autenticazione a più fattori Hello vengono distribuiti in una configurazione con bilanciamento del carico senza stata.</span><span class="sxs-lookup"><span data-stu-id="6bea1-155">hello MFA servers are deployed in a stateless load-balanced configuration.</span></span> <span data-ttu-id="6bea1-156">Tuttavia, se si desidera toouse OTP SMS, è necessario utilizzare il bilanciamento del carico con stato.</span><span class="sxs-lookup"><span data-stu-id="6bea1-156">However, if you wanted toouse OTP over SMS, you must use stateful load balancing.</span></span>
   <span data-ttu-id="6bea1-157">![Server Azure MFA - Elevata disponibilità del server app](./media/mfa-server-high-availability/mfaapp.png)</span><span class="sxs-lookup"><span data-stu-id="6bea1-157">![Azure MFA Server - App server HA](./media/mfa-server-high-availability/mfaapp.png)</span></span>

   > [!NOTE]
   > <span data-ttu-id="6bea1-158">Poiché RPC utilizza porte dinamiche, è consigliabile non tooopen firewall backup toohello intervallo di porte dinamiche RPC può comportare l'utilizzo.</span><span class="sxs-lookup"><span data-stu-id="6bea1-158">Because RPC uses dynamic ports, it is not recommended tooopen firewalls up toohello range of dynamic ports that RPC can potentially use.</span></span> <span data-ttu-id="6bea1-159">Se si dispone di un firewall **tra** server di applicazioni di autenticazione a più fattori, è necessario configurare l'hello Server MFA toocommunicate di su una porta statica per hello il traffico di replica tra server master e secondari e aprire la porta nel firewall.</span><span class="sxs-lookup"><span data-stu-id="6bea1-159">If you have a firewall **between** your MFA application servers, you should configure hello MFA Server toocommunicate on a static port for hello replication traffic between slave and master servers and open that port on your firewall.</span></span> <span data-ttu-id="6bea1-160">È possibile forzare la porta statica hello mediante la creazione di un valore del Registro di sistema DWORD in ```HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Positive Networks\PhoneFactor``` chiamato ```Pfsvc_ncan_ip_tcp_port``` e impostare il valore di hello tooan porta statica.</span><span class="sxs-lookup"><span data-stu-id="6bea1-160">You can force hello static port by creating a DWORD registry value at ```HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Positive Networks\PhoneFactor``` called ```Pfsvc_ncan_ip_tcp_port``` and setting hello value tooan available static port.</span></span> <span data-ttu-id="6bea1-161">Le connessioni sono sempre avviate dal master toohello di hello slave server MFA, la porta statica hello è necessaria solo per master hello, ma poiché è possibile alzare di livello un master di hello toobe slave in qualsiasi momento, è necessario impostare la porta statica hello in tutti i server di autenticazione a più fattori.</span><span class="sxs-lookup"><span data-stu-id="6bea1-161">Connections are always initiated by hello slave MFA Servers toohello master, hello static port is only required on hello master, but since you can promote a slave toobe hello master at any time, you should set hello static port on all MFA Servers.</span></span>

2. <span data-ttu-id="6bea1-162">server di App per dispositivi mobili/MFA del portale utente Hello due (MAS1-accesso-autenticazione a più fattori e autenticazione a più fattori-UP-MAS2) sono il bilanciamento del carico un **stateful** configurazione (mfa.contoso.com).</span><span class="sxs-lookup"><span data-stu-id="6bea1-162">hello two User Portal/MFA Mobile App servers (MFA-UP-MAS1 and MFA-UP-MAS2) are load balanced in a **stateful** configuration (mfa.contoso.com).</span></span> <span data-ttu-id="6bea1-163">Tenere presente che le sessioni permanenti sono un requisito necessario per il bilanciamento del carico hello portale autenticazione a più fattori per gli utenti e servizio App per dispositivi mobili.</span><span class="sxs-lookup"><span data-stu-id="6bea1-163">Recall that sticky sessions are a requirement for load balancing hello MFA User Portal and Mobile App Service.</span></span>
   <span data-ttu-id="6bea1-164">![Server Azure MFA - Disponibilità elevata per il portale per gli utenti e per il servizio per app per dispositivi mobili](./media/mfa-server-high-availability/mfaportal.png)</span><span class="sxs-lookup"><span data-stu-id="6bea1-164">![Azure MFA Server - User Portal and Mobile App Service HA](./media/mfa-server-high-availability/mfaportal.png)</span></span>
3. <span data-ttu-id="6bea1-165">farm di Server ADFS Hello è bilanciamento del carico e pubblicato toohello Internet tramite proxy ADFS con bilanciamento del carico nella rete perimetrale hello.</span><span class="sxs-lookup"><span data-stu-id="6bea1-165">hello ADFS Server farm is load balanced and published toohello Internet through load-balanced ADFS proxies in hello perimeter network.</span></span> <span data-ttu-id="6bea1-166">Ogni Server ADFS utilizza hello ADFS agente toocommunicate con hello Azure MFA server tramite un URL di singolo con bilanciamento del carico (mfaapp.contoso.com) sulla porta TCP 443.</span><span class="sxs-lookup"><span data-stu-id="6bea1-166">Each ADFS Server uses hello ADFS agent toocommunicate with hello Azure MFA Servers using a single load-balanced URL (mfaapp.contoso.com) over TCP port 443.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6bea1-167">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="6bea1-167">Next steps</span></span>

* [<span data-ttu-id="6bea1-168">Installare e configurare il server Azure MFA</span><span class="sxs-lookup"><span data-stu-id="6bea1-168">Install and configure Azure MFA Server</span></span>](multi-factor-authentication-get-started-server.md)
