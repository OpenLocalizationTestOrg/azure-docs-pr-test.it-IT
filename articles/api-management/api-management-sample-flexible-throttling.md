---
title: richiesta aaaAdvanced la limitazione delle richieste a gestione API di Azure
description: Informazioni su come toocreate e applicare una quota flessibile e a gestione API di Azure i criteri di limitazione della frequenza.
services: api-management
documentationcenter: 
author: darrelmiller
manager: erikre
editor: 
ms.assetid: fc813a65-7793-4c17-8bb9-e387838193ae
ms.service: api-management
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 12/15/2016
ms.author: apimpm
ms.openlocfilehash: ac87f83118a37bd587fddf044e5c2d6fc2af9031
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="advanced-request-throttling-with-azure-api-management"></a><span data-ttu-id="bb2ef-103">Limitazione avanzata delle richieste con Gestione API di Azure</span><span class="sxs-lookup"><span data-stu-id="bb2ef-103">Advanced request throttling with Azure API Management</span></span>
<span data-ttu-id="bb2ef-104">La toothrottle in grado di richieste in ingresso è un ruolo fondamentale di gestione API di Azure.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-104">Being able toothrottle incoming requests is a key role of Azure API Management.</span></span> <span data-ttu-id="bb2ef-105">Consente di gestione API tramite controllo frequenza hello di richieste o hello Totale richieste/dati trasferiti, API provider tooprotect le rispettive API da evitare eventuali abusi e creare il valore per diversi livelli di API del prodotto.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-105">Either by controlling hello rate of requests or hello total requests/data transferred, API Management allows API providers tooprotect their APIs from abuse and create value for different API product tiers.</span></span>

## <a name="product-based-throttling"></a><span data-ttu-id="bb2ef-106">Limitazione basata sul prodotto</span><span class="sxs-lookup"><span data-stu-id="bb2ef-106">Product based throttling</span></span>
<span data-ttu-id="bb2ef-107">stato limitato toobeing con ambito tooa particolare sottoscrizione al prodotto (essenzialmente una chiave), definito in hello portale di gestione API pubblicazione toodate, frequenza di hello le funzionalità di limitazione.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-107">toodate, hello rate throttling capabilities have been limited toobeing scoped tooa particular Product subscription (essentially a key), defined in hello API Management publisher portal.</span></span> <span data-ttu-id="bb2ef-108">Ciò è utile per i limiti di hello API provider tooapply agli sviluppatori di hello che hanno effettuato l'iscrizione toouse API, tuttavia, non serve, ad esempio, in cui la limitazione delle richieste di singoli utenti finali di hello API.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-108">This is useful for hello API provider tooapply limits on hello developers who have signed up toouse their API, however, it does not help, for example, in throttling individual end-users of hello API.</span></span> <span data-ttu-id="bb2ef-109">È possibile che per singolo utente di tooconsume di applicazione per gli sviluppatori di hello hello intera quota e quindi impedire altri clienti dello sviluppatore hello toouse in grado di un'applicazione hello.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-109">It is possible that for single user of hello developer's application tooconsume hello entire quota and then prevent other customers of hello developer from being able toouse hello application.</span></span> <span data-ttu-id="bb2ef-110">Inoltre, alcuni clienti che potrebbero generare un numero elevato di richieste possono limitare l'accesso toooccasional gli utenti.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-110">Also, several customers who might generate a high volume of requests may limit access toooccasional users.</span></span>

## <a name="custom-key-based-throttling"></a><span data-ttu-id="bb2ef-111">Limitazione basata su chiave personalizzata</span><span class="sxs-lookup"><span data-stu-id="bb2ef-111">Custom key based throttling</span></span>
<span data-ttu-id="bb2ef-112">nuovo Hello [frequenza limite dalla chiave](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) e [quota dalla chiave](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) criteri forniscono un controllo di tootraffic soluzione notevolmente più flessibile.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-112">hello new [rate-limit-by-key](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) and [quota-by-key](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) policies provide a significantly more flexible solution tootraffic control.</span></span> <span data-ttu-id="bb2ef-113">I nuovi criteri consentono di toodefine espressioni tooidentify hello chiavi saranno tootrack utilizzato traffico utilizzo.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-113">These new policies allow you toodefine expressions tooidentify hello keys that will be used tootrack traffic usage.</span></span> <span data-ttu-id="bb2ef-114">Hello funzionamento di questo è illustrato il modo più semplice con un esempio.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-114">hello way this works is easiest illustrated with an example.</span></span> 

## <a name="ip-address-throttling"></a><span data-ttu-id="bb2ef-115">Limitazione dell'indirizzo IP</span><span class="sxs-lookup"><span data-stu-id="bb2ef-115">IP Address throttling</span></span>
<span data-ttu-id="bb2ef-116">i criteri seguenti Hello limitare un singolo client IP indirizzo tooonly 10 chiama ogni minuto, con un totale di 1.000.000 chiamate e 10.000 kilobyte di larghezza di banda al mese.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-116">hello following policies restrict a single client IP address tooonly 10 calls every minute, with a total of 1,000,000 calls and 10,000 kilobytes of bandwidth per month.</span></span> 

```xml
<rate-limit-by-key  calls="10"
          renewal-period="60"
          counter-key="@(context.Request.IpAddress)" />

<quota-by-key calls="1000000"
          bandwidth="10000"
          renewal-period="2629800"
          counter-key="@(context.Request.IpAddress)" />
```

<span data-ttu-id="bb2ef-117">Se tutti i client su Internet hello usato un indirizzo IP univoco, potrebbe trattarsi di un metodo efficace per limitare l'utilizzo dall'utente.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-117">If all clients on hello Internet used a unique IP address, this might be an effective way of limiting usage by user.</span></span> <span data-ttu-id="bb2ef-118">Tuttavia, è molto probabile che più utenti saranno la condivisione di un singolo indirizzo IP pubblico a causa di toothem accesso hello Internet tramite un dispositivo NAT.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-118">However, it is quite likely that multiple users will sharing a single public IP address due toothem accessing hello Internet via a NAT device.</span></span> <span data-ttu-id="bb2ef-119">Nonostante ciò, per le API che consentono di hello accesso non autenticato `IpAddress` potrebbe essere migliore hello.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-119">Despite this, for APIs that allow unauthenticated access hello `IpAddress` might be hello best option.</span></span>

## <a name="user-identity-throttling"></a><span data-ttu-id="bb2ef-120">Limitazione dell'identità utente</span><span class="sxs-lookup"><span data-stu-id="bb2ef-120">User identity throttling</span></span>
<span data-ttu-id="bb2ef-121">Se un utente finale viene autenticato, può essere generata una chiave per la limitazione delle richieste in base alle informazioni che identificano in modo univoco l'utente.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-121">If an end user is authenticated then a throttling key can be generated based on information that uniquely identifies an that user.</span></span>

```xml
<rate-limit-by-key calls="10"
    renewal-period="60"
    counter-key="@(context.Request.Headers.GetValueOrDefault("Authorization","").AsJwt()?.Subject)" />
```

<span data-ttu-id="bb2ef-122">In questo esempio estrarre l'intestazione di autorizzazione hello, convertirlo troppo`JWT` oggetto utilizza soggetto hello dell'utente di hello tooidentify token hello e utilizzarlo come chiave di limitazione della frequenza hello.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-122">In this example we extract hello Authorization header, convert it too`JWT` object and use hello subject of hello token tooidentify hello user and use that as hello rate limiting key.</span></span> <span data-ttu-id="bb2ef-123">Se l'identità utente hello è archiviato in hello `JWT` come uno degli altri hello quindi attestazioni che valore può essere utilizzato al suo posto.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-123">If hello user identity is stored in hello `JWT` as one of hello other claims then that value could be used in its place.</span></span>

## <a name="combined-policies"></a><span data-ttu-id="bb2ef-124">Criteri combinati</span><span class="sxs-lookup"><span data-stu-id="bb2ef-124">Combined policies</span></span>
<span data-ttu-id="bb2ef-125">Sebbene hello limitazione nuovi criteri di fornisce un maggiore controllo rispetto hello esistente i criteri di limitazione, è la combinazione di entrambe le funzionalità di valore.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-125">Although hello new throttling policies provide more control than hello existing throttling policies, there is still value combining both capabilities.</span></span> <span data-ttu-id="bb2ef-126">La limitazione delle richieste dal codice product key di sottoscrizione ([frequenza delle chiamate limite sottoscrizione](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRate) e [Set quota di utilizzo mediante sottoscrizione](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuota)) è un ottimo modo tooenable monetizing di un'API tramite l'addebito in base ai livelli di utilizzo.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-126">Throttling by product subscription key ([Limit call rate by subscription](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRate) and [Set usage quota by subscription](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuota)) is a great way tooenable monetizing of an API by charging based on usage levels.</span></span> <span data-ttu-id="bb2ef-127">Hello controllo con granularità maggiore di essere in grado di toothrottle dall'utente è complementare e impedisce il comportamento di un utente di compromettere l'esperienza di hello di un altro.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-127">hello finer grained control of being able toothrottle by user is complementary and prevents one user's behavior from degrading hello experience of another.</span></span> 

## <a name="client-driven-throttling"></a><span data-ttu-id="bb2ef-128">Limitazione basata su client</span><span class="sxs-lookup"><span data-stu-id="bb2ef-128">Client driven throttling</span></span>
<span data-ttu-id="bb2ef-129">Quando la limitazione delle richieste chiave hello viene definita con un [espressione di criteri](https://msdn.microsoft.com/library/azure/dn910913.aspx), viene utilizzato il provider hello API che sceglie la limitazione delle richieste di hello ha come ambito.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-129">When hello throttling key is defined using a [policy expression](https://msdn.microsoft.com/library/azure/dn910913.aspx), then it is hello API provider that is choosing how hello throttling is scoped.</span></span> <span data-ttu-id="bb2ef-130">Tuttavia, è consigliabile uno sviluppatore toocontrol sono giudizio limitare i propri clienti.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-130">However, a developer might want toocontrol how they rate limit their own customers.</span></span> <span data-ttu-id="bb2ef-131">È possibile abilitare dal provider di API hello introducendo client applicazione toocommunicate hello chiave toohello dello sviluppatore un'intestazione personalizzata tooallow hello API.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-131">This could be enabled by hello API provider by introducing a custom header tooallow hello developer's client application toocommunicate hello key toohello API.</span></span>

```xml
<rate-limit-by-key calls="100"
          renewal-period="60"
          counter-key="@(request.Headers.GetValueOrDefault("Rate-Key",""))"/>
```

<span data-ttu-id="bb2ef-132">In questo modo toochoose di applicazione client per gli sviluppatori di hello la modalità di limitazione chiave della frequenza toocreate hello.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-132">This enables hello developer's client application toochoose how they want toocreate hello rate limiting key.</span></span> <span data-ttu-id="bb2ef-133">Un po' di ingegno uno sviluppatore di client di creare i propri livelli di velocità da set di chiavi toousers di allocazione e la rotazione di utilizzo della chiave di hello.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-133">With a little bit of ingenuity a client developer could create their own rate tiers by allocating sets of keys toousers and rotating hello key usage.</span></span>

## <a name="summary"></a><span data-ttu-id="bb2ef-134">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="bb2ef-134">Summary</span></span>
<span data-ttu-id="bb2ef-135">Gestione API di Azure fornisce frequenza offerta limitazione tooboth proteggere e aggiungere valore tooyour API servizio.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-135">Azure API Management provides rate and quote throttling tooboth protect and add value tooyour API service.</span></span> <span data-ttu-id="bb2ef-136">Hello limitazione nuovi criteri con le regole di ambito personalizzati consentono di che è maggiore controllo sulla tooenable tali criteri con granularità le applicazioni di clienti toobuild ancora migliore.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-136">hello new throttling policies with custom scoping rules allow you finer grained control over those policies tooenable your customers toobuild even better applications.</span></span> <span data-ttu-id="bb2ef-137">esempi di Hello in questo articolo illustrano l'utilizzo di hello di questi nuovi criteri per limitare le chiavi con indirizzi IP client, l'identità utente e valori del client generato tasso di produzione.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-137">hello examples in this article demonstrate hello use of these new policies by manufacturing rate limiting keys with client IP addresses, user identity, and client generated values.</span></span> <span data-ttu-id="bb2ef-138">Tuttavia, esistono molte altre parti di messaggio hello che potrebbero essere utilizzati come agente utente, i frammenti del percorso URL, dimensione del messaggio.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-138">However, there are many other parts of hello message that could be used such as user agent, URL path fragments, message size.</span></span>

## <a name="next-steps"></a><span data-ttu-id="bb2ef-139">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="bb2ef-139">Next steps</span></span>
<span data-ttu-id="bb2ef-140">Per commenti e suggerimenti nel thread di Disqus hello per questo argomento.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-140">Please give us your feedback in hello Disqus thread for this topic.</span></span> <span data-ttu-id="bb2ef-141">Sarebbe ideale toohear su altri potenziali valori di chiave che sono stati una scelta negli scenari di logica.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-141">It would be great toohear about other potential key values that have been a logical choice in your scenarios.</span></span>

## <a name="watch-a-video-overview-of-these-policies"></a><span data-ttu-id="bb2ef-142">Video contenente una panoramica di questi criteri</span><span class="sxs-lookup"><span data-stu-id="bb2ef-142">Watch a video overview of these policies</span></span>
<span data-ttu-id="bb2ef-143">Per ulteriori informazioni su hello [frequenza limite dalla chiave](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) e [quota dalla chiave](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) criteri descritti in questo articolo, guardare hello video seguenti.</span><span class="sxs-lookup"><span data-stu-id="bb2ef-143">For more information on hello [rate-limit-by-key](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) and [quota-by-key](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) policies covered in this article, please watch hello following video.</span></span>

> [!VIDEO https://channel9.msdn.com/Blogs/AzureApiMgmt/Advanced-Request-Throttling-with-Azure-API-Management/player]
> 
> 

