---
title: 'Ottimizzare il routing in ExpressRoute: Azure | Microsoft Docs'
description: "Questa pagina fornisce informazioni dettagliate su come toooptimize routing quando si dispone di più ExpressRoute circuiti che la connessione tra Microsoft e la rete aziendale."
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: ebcfb638f67a9ac78c3e476668bfd0bb0ffb9985
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="optimize-expressroute-routing"></a><span data-ttu-id="81746-103">Ottimizzare il routing in ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="81746-103">Optimize ExpressRoute Routing</span></span>
<span data-ttu-id="81746-104">Quando si dispone di più circuiti ExpressRoute, è necessario più di un percorso tooconnect tooMicrosoft.</span><span class="sxs-lookup"><span data-stu-id="81746-104">When you have multiple ExpressRoute circuits, you have more than one path tooconnect tooMicrosoft.</span></span> <span data-ttu-id="81746-105">Di conseguenza, il routing non ottimali può verificarsi -, ovvero il traffico potrebbe richiedere un tooreach percorso più lungo, Microsoft e Microsoft tooyour network.</span><span class="sxs-lookup"><span data-stu-id="81746-105">As a result, suboptimal routing may happen - that is, your traffic may take a longer path tooreach Microsoft, and Microsoft tooyour network.</span></span> <span data-ttu-id="81746-106">Hello più hello percorso di rete, una latenza maggiore hello hello.</span><span class="sxs-lookup"><span data-stu-id="81746-106">hello longer hello network path, hello higher hello latency.</span></span> <span data-ttu-id="81746-107">che ha un impatto diretto sull'esperienza utente e sulle prestazioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="81746-107">Latency has direct impact on application performance and user experience.</span></span> <span data-ttu-id="81746-108">In questo articolo verrà spiegare il problema e spiegare come toooptimize ciclo tramite hello tecnologie standard di routine.</span><span class="sxs-lookup"><span data-stu-id="81746-108">This article will illustrate this problem and explain how toooptimize routing using hello standard routing technologies.</span></span>

## <a name="suboptimal-routing-from-customer-toomicrosoft"></a><span data-ttu-id="81746-109">Non ottimali routing dal cliente tooMicrosoft</span><span class="sxs-lookup"><span data-stu-id="81746-109">Suboptimal routing from customer tooMicrosoft</span></span>
<span data-ttu-id="81746-110">Esaminiamo un Chiudi problema di routing hello da un esempio.</span><span class="sxs-lookup"><span data-stu-id="81746-110">Let's take a close look at hello routing problem by an example.</span></span> <span data-ttu-id="81746-111">Si supponga di che disporre di due uffici hello Stati Uniti, uno a Los Angeles e uno di New York.</span><span class="sxs-lookup"><span data-stu-id="81746-111">Imagine you have two offices in hello US, one in Los Angeles and one in New York.</span></span> <span data-ttu-id="81746-112">Gli uffici sono connessi tramite una rete WAN (Wide Area Network), che può essere la propria rete backbone o la VPN IP del provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="81746-112">Your offices are connected on a Wide Area Network (WAN), which can be either your own backbone network or your service provider's IP VPN.</span></span> <span data-ttu-id="81746-113">Si dispone di due circuiti ExpressRoute, uno negli Stati Uniti occidentali e uno negli Stati Uniti orientali, anche connessi hello WAN.</span><span class="sxs-lookup"><span data-stu-id="81746-113">You have two ExpressRoute circuits, one in US West and one in US East, that are also connected on hello WAN.</span></span> <span data-ttu-id="81746-114">Ovviamente, si dispone di rete di due percorsi tooconnect toohello Microsoft.</span><span class="sxs-lookup"><span data-stu-id="81746-114">Obviously, you have two paths tooconnect toohello Microsoft network.</span></span> <span data-ttu-id="81746-115">Si supponga ora di avere una distribuzione di Azure, ad esempio il servizio app di Azure, negli Stati Uniti occidentali e negli Stati Uniti orientali.</span><span class="sxs-lookup"><span data-stu-id="81746-115">Now imagine you have Azure deployment (for example, Azure App Service) in both US West and US East.</span></span> <span data-ttu-id="81746-116">L'intenzione è tooconnect dagli utenti nel Los Angeles tooAzure Stati Uniti occidentali e gli utenti in New York tooAzure Stati Uniti orientali, perché l'amministratore del servizio annuncia che agli utenti di ogni accesso office hello nelle vicinanze di servizi di Azure per un'esperienza ottimale.</span><span class="sxs-lookup"><span data-stu-id="81746-116">Your intention is tooconnect your users in Los Angeles tooAzure US West and your users in New York tooAzure US East because your service admin advertises that users in each office access hello nearby Azure services for optimal experiences.</span></span> <span data-ttu-id="81746-117">Sfortunatamente, il piano di hello avviene anche per gli utenti di costa orientale hello ma non per gli utenti di hello costa occidentale.</span><span class="sxs-lookup"><span data-stu-id="81746-117">Unfortunately, hello plan works out well for hello east coast users but not for hello west coast users.</span></span> <span data-ttu-id="81746-118">causa Hello del problema di hello è seguente hello.</span><span class="sxs-lookup"><span data-stu-id="81746-118">hello cause of hello problem is hello following.</span></span> <span data-ttu-id="81746-119">Su ogni circuito ExpressRoute, si identificano tooyou prefisso hello in Azure Stati Uniti orientali (23.100.0.0/16) sia il prefisso hello in Azure Stati Uniti occidentali (13.100.0.0/16).</span><span class="sxs-lookup"><span data-stu-id="81746-119">On each ExpressRoute circuit, we advertise tooyou both hello prefix in Azure US East (23.100.0.0/16) and hello prefix in Azure US West (13.100.0.0/16).</span></span> <span data-ttu-id="81746-120">Se non si conosce il prefisso dal quale area, non si è in grado di tootreat, in modo diverso.</span><span class="sxs-lookup"><span data-stu-id="81746-120">If you don't know which prefix is from which region, you are not able tootreat it differently.</span></span> <span data-ttu-id="81746-121">La rete WAN sembrare entrambi i prefissi hello sono orientale tooUS più vicino di Stati Uniti occidentali e quindi indirizzare entrambi toohello agli utenti di office circuito ExpressRoute negli Stati Uniti orientali.</span><span class="sxs-lookup"><span data-stu-id="81746-121">Your WAN network may think both of hello prefixes are closer tooUS East than US West and therefore route both office users toohello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="81746-122">Fine hello, sarà necessario numerosi utenti scontenti hello Los Angeles office.</span><span class="sxs-lookup"><span data-stu-id="81746-122">In hello end, you will have many unhappy users in hello Los Angeles office.</span></span>

![Problema di ExpressRoute caso 1 - non ottimale routing dal cliente tooMicrosoft](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a><span data-ttu-id="81746-124">Soluzione: usare BGP Community</span><span class="sxs-lookup"><span data-stu-id="81746-124">Solution: use BGP Communities</span></span>
<span data-ttu-id="81746-125">toooptimize routing per entrambi gli utenti di office, è necessario tooknow il prefisso è dall'Azure Stati Uniti occidentali e da Azure Stati Uniti orientali.</span><span class="sxs-lookup"><span data-stu-id="81746-125">toooptimize routing for both office users, you need tooknow which prefix is from Azure US West and which from Azure US East.</span></span> <span data-ttu-id="81746-126">Queste informazioni vengono codificate con i [valori di BGP Community](expressroute-routing.md).</span><span class="sxs-lookup"><span data-stu-id="81746-126">We encode this information by using [BGP Community values](expressroute-routing.md).</span></span> <span data-ttu-id="81746-127">È stato assegnato un tooeach di valore univoco di Community BGP regione di Azure, ad esempio "12076:51004" per gli Stati Uniti orientali, "12076:51006" per gli Stati Uniti occidentali.</span><span class="sxs-lookup"><span data-stu-id="81746-127">We've assigned a unique BGP Community value tooeach Azure region, e.g. "12076:51004" for US East, "12076:51006" for US West.</span></span> <span data-ttu-id="81746-128">Dopo aver appreso da quale area di Azure proviene ogni prefisso, si può scegliere il circuito ExpressRoute da configurare come preferito.</span><span class="sxs-lookup"><span data-stu-id="81746-128">Now that you know which prefix is from which Azure region, you can configure which ExpressRoute circuit should be preferred.</span></span> <span data-ttu-id="81746-129">Poiché si usa informazioni di routing di hello BGP tooexchange, è possibile utilizzare tooinfluence di preferenza locale BGP routing.</span><span class="sxs-lookup"><span data-stu-id="81746-129">Because we use hello BGP tooexchange routing info, you can use BGP's Local Preference tooinfluence routing.</span></span> <span data-ttu-id="81746-130">In questo esempio, è possibile assegnare una versione successiva locale preferenza valore too13.100.0.0/16 negli Stati Uniti occidentali rispetto negli Stati Uniti orientali e, in modo analogo, una versione successiva locale preferenza valore too23.100.0.0/16 negli Stati Uniti orientali negli Stati Uniti occidentali.</span><span class="sxs-lookup"><span data-stu-id="81746-130">In our example, you can assign a higher local preference value too13.100.0.0/16 in US West than in US East, and similarly, a higher local preference value too23.100.0.0/16 in US East than in US West.</span></span> <span data-ttu-id="81746-131">Questa configurazione garantisce che, quando entrambi i percorsi tooMicrosoft sono disponibili, gli utenti a Los Angeles avrà il circuito ExpressRoute hello in Stati Uniti occidentali tooconnect tooAzure Stati Uniti occidentali mentre gli utenti di New York accettano hello ExpressRoute in Stati Uniti orientali tooAzure Stati Uniti orientali .</span><span class="sxs-lookup"><span data-stu-id="81746-131">This configuration will make sure that, when both paths tooMicrosoft are available, your users in Los Angeles will take hello ExpressRoute circuit in US West tooconnect tooAzure US West whereas your users in New York take hello ExpressRoute in US East tooAzure US East.</span></span> <span data-ttu-id="81746-132">Il routing è ottimizzato su entrambi i lati.</span><span class="sxs-lookup"><span data-stu-id="81746-132">Routing is optimized on both sides.</span></span> 

![Soluzione caso 1 ExpressRoute: usare BGP Community](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> <span data-ttu-id="81746-134">Hello stessa tecnica, preferenza locale, può essere applicato toorouting dal cliente tooAzure rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="81746-134">hello same technique, using Local Preference, can be applied toorouting from customer tooAzure Virtual Network.</span></span> <span data-ttu-id="81746-135">Non è contrassegnare i prefissi di toohello valore BGP Community annunciati dalla rete di Azure tooyour.</span><span class="sxs-lookup"><span data-stu-id="81746-135">We don't tag BGP Community value toohello prefixes advertised from Azure tooyour network.</span></span> <span data-ttu-id="81746-136">Tuttavia, poiché si sa quali la distribuzione di rete virtuale Chiudi toowhich dell'ufficio, è possibile configurare i router conseguenza tooanother circuito ExpressRoute di una tooprefer.</span><span class="sxs-lookup"><span data-stu-id="81746-136">However, since you know which of your Virtual Network deployment is close toowhich of your office, you can configure your routers accordingly tooprefer one ExpressRoute circuit tooanother.</span></span>
>
>

## <a name="suboptimal-routing-from-microsoft-toocustomer"></a><span data-ttu-id="81746-137">Routing di Microsoft toocustomer ottimale</span><span class="sxs-lookup"><span data-stu-id="81746-137">Suboptimal routing from Microsoft toocustomer</span></span>
<span data-ttu-id="81746-138">Di seguito è riportato un altro esempio in cui le connessioni da Microsoft richiedono un tooreach percorso più lungo della rete.</span><span class="sxs-lookup"><span data-stu-id="81746-138">Here is another example where connections from Microsoft take a longer path tooreach your network.</span></span> <span data-ttu-id="81746-139">In questo caso, si usano i server di Exchange in locale ed Exchange Online in un [ambiente ibrido](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="81746-139">In this case, you use on-premises Exchange servers and Exchange Online in a [hybrid environment](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span></span> <span data-ttu-id="81746-140">Uffici sono connesso tooa WAN.</span><span class="sxs-lookup"><span data-stu-id="81746-140">Your offices are connected tooa WAN.</span></span> <span data-ttu-id="81746-141">Annunciare prefissi hello dei server locali in entrambi i tooMicrosoft uffici attraverso i circuiti ExpressRoute hello due.</span><span class="sxs-lookup"><span data-stu-id="81746-141">You advertise hello prefixes of your on-premises servers in both of your offices tooMicrosoft through hello two ExpressRoute circuits.</span></span> <span data-ttu-id="81746-142">Exchange Online verrà avviata connessioni toohello ai server locali in casi come la migrazione delle cassette postali.</span><span class="sxs-lookup"><span data-stu-id="81746-142">Exchange Online will initiate connections toohello on-premises servers in cases such as mailbox migration.</span></span> <span data-ttu-id="81746-143">Sfortunatamente, hello connessione tooyour di Los Angeles è indirizzato toohello circuito ExpressRoute negli Stati Uniti orientali prima dell'attraversamento costa occidentale di hello intero toohello indietro continent.</span><span class="sxs-lookup"><span data-stu-id="81746-143">Unfortunately, hello connection tooyour Los Angeles office is routed toohello ExpressRoute circuit in US East before traversing hello entire continent back toohello west coast.</span></span> <span data-ttu-id="81746-144">causa del problema hello Hello è simile toohello un primo.</span><span class="sxs-lookup"><span data-stu-id="81746-144">hello cause of hello problem is similar toohello first one.</span></span> <span data-ttu-id="81746-145">Senza un hint, rete Microsoft hello non è possibile indicare il prefisso del cliente è orientale tooUS Chiudi e quello che è chiudere tooUS occidentale.</span><span class="sxs-lookup"><span data-stu-id="81746-145">Without any hint, hello Microsoft network can't tell which customer prefix is close tooUS East and which one is close tooUS West.</span></span> <span data-ttu-id="81746-146">Si verifica toopick office tooyour del percorso non valido di hello Los Angeles.</span><span class="sxs-lookup"><span data-stu-id="81746-146">It happens toopick hello wrong path tooyour office in Los Angeles.</span></span>

![ExpressRoute caso 2: routing di Microsoft toocustomer ottimale](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a><span data-ttu-id="81746-148">Soluzione: anteporre AS PATH</span><span class="sxs-lookup"><span data-stu-id="81746-148">Solution: use AS PATH prepending</span></span>
<span data-ttu-id="81746-149">Esistono due problema toohello di soluzioni.</span><span class="sxs-lookup"><span data-stu-id="81746-149">There are two solutions toohello problem.</span></span> <span data-ttu-id="81746-150">Hello prima uno consiste semplicemente annunciare il prefisso locale per l'ufficio di Los Angeles, 177.2.0.0/31, nel circuito ExpressRoute hello negli Stati Uniti occidentali e locale del prefisso per l'ufficio di New York, 177.2.0.2/31, nel circuito ExpressRoute hello negli Stati Uniti orientali.</span><span class="sxs-lookup"><span data-stu-id="81746-150">hello first one is that you simply advertise your on-premises prefix for your Los Angeles office, 177.2.0.0/31, on hello ExpressRoute circuit in US West and your on-premises prefix for your New York office, 177.2.0.2/31, on hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="81746-151">Di conseguenza, vi è solo un percorso per Microsoft tooconnect tooeach ufficio.</span><span class="sxs-lookup"><span data-stu-id="81746-151">As a result, there is only one path for Microsoft tooconnect tooeach of your offices.</span></span> <span data-ttu-id="81746-152">Non esistono ambiguità e il routing risulta ottimizzato.</span><span class="sxs-lookup"><span data-stu-id="81746-152">There is no ambiguity and routing is optimized.</span></span> <span data-ttu-id="81746-153">Con questa struttura, è necessario toothink sulla strategia di failover.</span><span class="sxs-lookup"><span data-stu-id="81746-153">With this design, you need toothink about your failover strategy.</span></span> <span data-ttu-id="81746-154">In hello evento che hello tooMicrosoft percorso tramite ExpressRoute è interrotto, è necessario assicurarsi che Exchange Online possono comunque connettersi server locali tooyour toomake.</span><span class="sxs-lookup"><span data-stu-id="81746-154">In hello event that hello path tooMicrosoft via ExpressRoute is broken, you need toomake sure that Exchange Online can still connect tooyour on-premises servers.</span></span> 

<span data-ttu-id="81746-155">seconda soluzione hello è che si continua tooadvertise entrambi i prefissi hello in due circuiti ExpressRoute e inoltre si fornisce un hint di individuare quale prefisso è toowhich Chiudi uno ufficio.</span><span class="sxs-lookup"><span data-stu-id="81746-155">hello second solution is that you continue tooadvertise both of hello prefixes on both ExpressRoute circuits, and in addition you give us a hint of which prefix is close toowhich one of your offices.</span></span> <span data-ttu-id="81746-156">Poiché un sostegno anteponendo percorso AS BGP, è possibile configurare hello come percorso per il routing di tooinfluence il prefisso.</span><span class="sxs-lookup"><span data-stu-id="81746-156">Because we support BGP AS Path prepending, you can configure hello AS Path for your prefix tooinfluence routing.</span></span> <span data-ttu-id="81746-157">In questo esempio, è possibile prolungare hello percorso AS per 172.2.0.0/31 negli Stati Uniti orientali, in modo che si preferisce circuito ExpressRoute di hello negli Stati Uniti occidentali per il traffico destinato per il prefisso (come la rete verrà ritenuto prefisso toothis di hello percorso più breve in occidentale hello).</span><span class="sxs-lookup"><span data-stu-id="81746-157">In this example, you can lengthen hello AS PATH for 172.2.0.0/31 in US East so that we will prefer hello ExpressRoute circuit in US West for traffic destined for this prefix (as our network will think hello path toothis prefix is shorter in hello west).</span></span> <span data-ttu-id="81746-158">Analogamente è possibile prolungare hello percorso AS per 172.2.0.2/31 negli Stati Uniti occidentali, in modo che verrà preferiamo circuito ExpressRoute hello negli Stati Uniti orientali.</span><span class="sxs-lookup"><span data-stu-id="81746-158">Similarly you can lengthen hello AS PATH for 172.2.0.2/31 in US West so that we'll prefer hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="81746-159">Il routing è ottimizzato per entrambi gli uffici.</span><span class="sxs-lookup"><span data-stu-id="81746-159">Routing is optimized for both offices.</span></span> <span data-ttu-id="81746-160">Con questa progettazione, se un circuito ExpressRoute viene interrotto, Exchange Online può comunque raggiungere il cliente tramite un altro circuito ExpressRoute e la rete WAN.</span><span class="sxs-lookup"><span data-stu-id="81746-160">With this design, if one ExpressRoute circuit is broken, Exchange Online can still reach you via another ExpressRoute circuit and your WAN.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="81746-161">Si rimuove private i numeri di hello come percorso per i prefissi hello ricevuti nel Peering Microsoft.</span><span class="sxs-lookup"><span data-stu-id="81746-161">We remove private AS numbers in hello AS PATH for hello prefixes received on Microsoft Peering.</span></span> <span data-ttu-id="81746-162">È necessario tooappend pubblica come numeri in hello percorso AS tooinfluence routing per il Peering Microsoft.</span><span class="sxs-lookup"><span data-stu-id="81746-162">You need tooappend public AS numbers in hello AS PATH tooinfluence routing for Microsoft Peering.</span></span>
> 
> 

![Soluzione caso 2 ExpressRoute: anteporre AS PATH](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> <span data-ttu-id="81746-164">Negli esempi di hello forniti di seguito sono per Microsoft e di peering pubblico, è supportato hello stesse funzionalità per il peering privato hello.</span><span class="sxs-lookup"><span data-stu-id="81746-164">While hello examples given here are for Microsoft and Public peerings, we do support hello same capabilities for hello Private peering.</span></span> <span data-ttu-id="81746-165">Inoltre, hello percorso AS anteponendo funziona all'interno di un singolo circuito ExpressRoute, selezione hello tooinfluence dei percorsi di hello primario e secondario.</span><span class="sxs-lookup"><span data-stu-id="81746-165">Also, hello AS Path prepending works within one single ExpressRoute circuit, tooinfluence hello selection of hello primary and secondary paths.</span></span>
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a><span data-ttu-id="81746-166">Routing non ottimale tra reti virtuali</span><span class="sxs-lookup"><span data-stu-id="81746-166">Suboptimal routing between virtual networks</span></span>
<span data-ttu-id="81746-167">Con ExpressRoute, è possibile abilitare la rete virtuale tooVirtual rete (che è noto anche come "Reti virtuali") collegando il circuito ExpressRoute tooan la comunicazione.</span><span class="sxs-lookup"><span data-stu-id="81746-167">With ExpressRoute, you can enable Virtual Network tooVirtual Network (which is also known as "VNet") communication by linking them tooan ExpressRoute circuit.</span></span> <span data-ttu-id="81746-168">Quando vengono collegati circuiti ExpressRoute toomultiple, routing non ottimali può verificarsi tra reti virtuali hello.</span><span class="sxs-lookup"><span data-stu-id="81746-168">When you link them toomultiple ExpressRoute circuits, suboptimal routing can happen between hello VNets.</span></span> <span data-ttu-id="81746-169">Si consideri ad esempio</span><span class="sxs-lookup"><span data-stu-id="81746-169">Let's consider an example.</span></span> <span data-ttu-id="81746-170">di avere due circuiti ExpressRoute, uno negli Stati Uniti occidentali e uno negli Stati Uniti orientali.</span><span class="sxs-lookup"><span data-stu-id="81746-170">You have two ExpressRoute circuits, one in US West and one in US East.</span></span> <span data-ttu-id="81746-171">In ogni area sono presenti due reti virtuali,</span><span class="sxs-lookup"><span data-stu-id="81746-171">In each region, you have two VNets.</span></span> <span data-ttu-id="81746-172">I server web vengono distribuiti in una rete virtuale e server applicazioni in hello altri.</span><span class="sxs-lookup"><span data-stu-id="81746-172">Your web servers are deployed in one VNet and application servers in hello other.</span></span> <span data-ttu-id="81746-173">Per garantire la ridondanza, si collega hello due reti virtuali in ogni area tooboth hello locale il circuito ExpressRoute e hello remoto circuito ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="81746-173">For redundancy, you link hello two VNets in each region tooboth hello local ExpressRoute circuit and hello remote ExpressRoute circuit.</span></span> <span data-ttu-id="81746-174">Come può essere illustrato di seguito, da ogni rete virtuale sono presenti due percorsi toohello altra rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="81746-174">As can be seen below, from each VNet there are two paths toohello other VNet.</span></span> <span data-ttu-id="81746-175">le reti virtuali Hello non conoscono il circuito ExpressRoute locale e quello remoto.</span><span class="sxs-lookup"><span data-stu-id="81746-175">hello VNets don't know which ExpressRoute circuit is local and which one is remote.</span></span> <span data-ttu-id="81746-176">Di conseguenza come avviene il traffico tra reti della rete virtuale tooload saldo routing uguale-Cost Multi Path ECMP (), alcuni flussi di traffico richiederà percorso più lungo di hello e vengono instradati al circuito ExpressRoute remoto hello.</span><span class="sxs-lookup"><span data-stu-id="81746-176">Consequently as they do Equal-Cost-Multi-Path (ECMP) routing tooload-balance inter-VNet traffic, some traffic flows will take hello longer path and get routed at hello remote ExpressRoute circuit.</span></span>

![Caso 3 ExpressRoute: routing non ottimale tra reti virtuali](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-toolocal-connection"></a><span data-ttu-id="81746-178">Soluzione: assegnare una connessione di toolocal peso elevata</span><span class="sxs-lookup"><span data-stu-id="81746-178">Solution: assign a high weight toolocal connection</span></span>
<span data-ttu-id="81746-179">soluzione hello è semplice.</span><span class="sxs-lookup"><span data-stu-id="81746-179">hello solution is simple.</span></span> <span data-ttu-id="81746-180">Poiché si conosce la posizione circuiti di reti virtuali e hello hello, è possibile fornire il percorso di ogni rete virtuale deve utilizzare.</span><span class="sxs-lookup"><span data-stu-id="81746-180">Since you know where hello VNets and hello circuits are, you can tell us which path each VNet should prefer.</span></span> <span data-ttu-id="81746-181">In modo specifico per questo esempio, si assegna una maggiore peso toohello connessione locale di connessione remota toohello (vedere l'esempio di configurazione hello [qui](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span><span class="sxs-lookup"><span data-stu-id="81746-181">Specifically for this example, you assign a higher weight toohello local connection than toohello remote connection (see hello configuration example [here](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span></span> <span data-ttu-id="81746-182">Quando una rete virtuale riceve prefisso hello di hello altre reti virtuali in più connessioni preferiranno connessione hello con hello massimo peso toosend il traffico destinato a tale prefisso.</span><span class="sxs-lookup"><span data-stu-id="81746-182">When a VNet receives hello prefix of hello other VNet on multiple connections it will prefer hello connection with hello highest weight toosend traffic destined for that prefix.</span></span>

![Soluzione ExpressRoute caso 3: assegnare un peso elevata toolocal connessione](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> <span data-ttu-id="81746-184">È anche possibile influenzare routing dalla rete locale tooyour di rete virtuale, se si dispone di più circuiti ExpressRoute, configurando il peso di hello di una connessione anziché applicare percorso AS anteponendo, una tecnica descritta in hello secondo scenario precedente.</span><span class="sxs-lookup"><span data-stu-id="81746-184">You can also influence routing from VNet tooyour on-premises network, if you have multiple ExpressRoute circuits, by configuring hello weight of a connection instead of applying AS PATH prepending, a technique described in hello second scenario above.</span></span> <span data-ttu-id="81746-185">Per ogni prefisso, verranno sempre esaminati peso connessione hello prima hello lunghezza del percorso AS quando si decide come toosend traffico.</span><span class="sxs-lookup"><span data-stu-id="81746-185">For each prefix, we will always look at hello connection weight before hello AS Path length when deciding how toosend traffic.</span></span>
>
>
