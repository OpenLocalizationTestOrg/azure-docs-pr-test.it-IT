---
title: "Monitorare le prestazioni di più database SQL di Azure in un'app SaaS multi-tenant | Microsoft Docs"
description: Monitorare e gestire le prestazioni di database e pool nell'app SaaS Wingtip del database SQL di Azure
keywords: esercitazione database SQL
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/26/2017
ms.author: sstein
ms.openlocfilehash: 42f727aa40e744916b1a8adf634c10d55880bef0
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/03/2017
---
# <a name="monitor-performance-of-the-wingtip-saas-application"></a><span data-ttu-id="e7efd-104">Monitorare le prestazioni dell'applicazione SaaS Wingtip</span><span class="sxs-lookup"><span data-stu-id="e7efd-104">Monitor performance of the Wingtip SaaS application</span></span>

<span data-ttu-id="e7efd-105">In questa esercitazione vengono illustrati diversi scenari di gestione delle prestazioni chiave usati nelle applicazioni SaaS.</span><span class="sxs-lookup"><span data-stu-id="e7efd-105">In this tutorial, several key performance management scenarios used in SaaS applications are explored.</span></span> <span data-ttu-id="e7efd-106">Usando un generatore di carico per simulare l'attività in tutti i database tenant, vengono illustrate le funzionalità di monitoraggio e avviso predefinite del database SQL e dei pool elastici.</span><span class="sxs-lookup"><span data-stu-id="e7efd-106">Using a load generator to simulate activity across all tenant databases, the built-in monitoring and alerting features of SQL Database and elastic pools are demonstrated.</span></span>

<span data-ttu-id="e7efd-107">L'app SaaS Wingtip usa un modello di dati a tenant singolo, in cui ogni sede di eventi (tenant) ha un database proprio.</span><span class="sxs-lookup"><span data-stu-id="e7efd-107">The Wingtip SaaS app uses a single-tenant data model, where each venue (tenant) has their own database.</span></span> <span data-ttu-id="e7efd-108">Come molte applicazioni SaaS, il modello di carico di lavoro tenant previsto è imprevedibile e sporadico.</span><span class="sxs-lookup"><span data-stu-id="e7efd-108">Like many SaaS applications, the anticipated tenant workload pattern is unpredictable and sporadic.</span></span> <span data-ttu-id="e7efd-109">In altre parole, le vendite di biglietti possono verificarsi in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="e7efd-109">In other words, ticket sales may occur at any time.</span></span> <span data-ttu-id="e7efd-110">Per sfruttare i vantaggi di questo modello di utilizzo tipico dei database, i database tenant sono distribuiti in pool di database elastici.</span><span class="sxs-lookup"><span data-stu-id="e7efd-110">To take advantage of this typical database usage pattern, tenant databases are deployed into elastic database pools.</span></span> <span data-ttu-id="e7efd-111">I pool elastici consentono di ottimizzare il costo di una soluzione condividendo le risorse tra molti database.</span><span class="sxs-lookup"><span data-stu-id="e7efd-111">Elastic pools optimize the cost of a solution by sharing resources across many databases.</span></span> <span data-ttu-id="e7efd-112">Con questo tipo di modello, è importante monitorare l'utilizzo dei database e delle risorse del pool per assicurarsi che i carichi siano bilanciati in modo ragionevole tra i pool.</span><span class="sxs-lookup"><span data-stu-id="e7efd-112">With this type of pattern, it's important to monitor database and pool resource usage to ensure that loads are reasonably balanced across pools.</span></span> <span data-ttu-id="e7efd-113">È anche necessario assicurarsi che i singoli database dispongano delle risorse appropriate e che i pool non si avvicinino ai limiti di [eDTU](sql-database-what-is-a-dtu.md).</span><span class="sxs-lookup"><span data-stu-id="e7efd-113">You also need to ensure that individual databases have adequate resources, and that pools are not hitting their [eDTU](sql-database-what-is-a-dtu.md) limits.</span></span> <span data-ttu-id="e7efd-114">Questa esercitazione illustra alcuni modi per monitorare e gestire i database e i pool, nonché come adottare misure correttive in risposta a variazioni del carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="e7efd-114">This tutorial explores ways to monitor and manage databases and pools, and how to take corrective action in response to variations in workload.</span></span>

<span data-ttu-id="e7efd-115">In questa esercitazione si apprenderà come:</span><span class="sxs-lookup"><span data-stu-id="e7efd-115">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="e7efd-116">Simulare l'utilizzo nei database tenant tramite l'esecuzione di un generatore di carico specificato</span><span class="sxs-lookup"><span data-stu-id="e7efd-116">Simulate usage on the tenant databases by running a provided load generator</span></span>
> * <span data-ttu-id="e7efd-117">Monitorare la risposta dei database tenant a un aumento del carico di lavoro</span><span class="sxs-lookup"><span data-stu-id="e7efd-117">Monitor the tenant databases as they respond to the increase in load</span></span>
> * <span data-ttu-id="e7efd-118">Potenziare il pool elastico in risposta al carico maggiore per i database</span><span class="sxs-lookup"><span data-stu-id="e7efd-118">Scale up the Elastic pool in response to the increased database load</span></span>
> * <span data-ttu-id="e7efd-119">Eseguire il provisioning di un secondo pool elastico per bilanciare il carico delle attività dei database</span><span class="sxs-lookup"><span data-stu-id="e7efd-119">Provision a second Elastic pool to load balance database activity</span></span>


<span data-ttu-id="e7efd-120">Per completare questa esercitazione, verificare che siano soddisfatti i prerequisiti seguenti:</span><span class="sxs-lookup"><span data-stu-id="e7efd-120">To complete this tutorial, make sure the following prerequisites are completed:</span></span>

* <span data-ttu-id="e7efd-121">L'app SaaS Wingtip viene distribuita.</span><span class="sxs-lookup"><span data-stu-id="e7efd-121">The Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="e7efd-122">Per distribuire in meno di cinque minuti, vedere [Distribuire ed esplorare l'applicazione SaaS Wingtip](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="e7efd-122">To deploy in less than five minutes, see [Deploy and explore the Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="e7efd-123">Azure PowerShell è installato.</span><span class="sxs-lookup"><span data-stu-id="e7efd-123">Azure PowerShell is installed.</span></span> <span data-ttu-id="e7efd-124">Per informazioni dettagliate, vedere [Introduzione ad Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="e7efd-124">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-to-saas-performance-management-patterns"></a><span data-ttu-id="e7efd-125">Introduzione ai modelli di gestione delle prestazioni SaaS</span><span class="sxs-lookup"><span data-stu-id="e7efd-125">Introduction to SaaS performance management patterns</span></span>

<span data-ttu-id="e7efd-126">La gestione delle prestazioni dei database comprende la compilazione e l'analisi dei dati sulle prestazioni, quindi l'adozione delle misure appropriate adattando i parametri in modo da mantenere tempi di risposta accettabili per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="e7efd-126">Managing database performance consists of compiling and analyzing performance data, and then reacting to this data by adjusting parameters to maintain an acceptable response time for your application.</span></span> <span data-ttu-id="e7efd-127">Quando si ospitano più tenant, i pool di database elastici rappresentano una soluzione conveniente per fornire e gestire le risorse per un gruppo di database con carichi di lavoro imprevedibili.</span><span class="sxs-lookup"><span data-stu-id="e7efd-127">When hosting multiple tenants, Elastic database pools are a cost-effective way to provide and manage resources for a group of databases with unpredictable workloads.</span></span> <span data-ttu-id="e7efd-128">Con determinati modelli di carico di lavoro, anche solo due database S3 possono trarre vantaggio dalla gestione in un pool.</span><span class="sxs-lookup"><span data-stu-id="e7efd-128">With certain workload patterns, as few as two S3 databases can benefit from being managed in a pool.</span></span>

![diagramma](./media/sql-database-saas-tutorial-performance-monitoring/app-diagram.png)

<span data-ttu-id="e7efd-130">I pool e i database nei pool devono essere monitorati per assicurarsi che rimangano entro intervalli di prestazioni accettabili.</span><span class="sxs-lookup"><span data-stu-id="e7efd-130">Pools, and the databases in pools, should be monitored to ensure they stay within acceptable ranges of performance.</span></span> <span data-ttu-id="e7efd-131">Ottimizzare la configurazione del pool per soddisfare le esigenze del carico di lavoro aggregato di tutti i database, assicurandosi che le unità eDTU del pool siano appropriate per il carico di lavoro complessivo.</span><span class="sxs-lookup"><span data-stu-id="e7efd-131">Tune the pool configuration to meet the needs of the aggregate workload of all databases, ensuring that the pool eDTUs are appropriate for the overall workload.</span></span> <span data-ttu-id="e7efd-132">Impostare il minimo e il massimo per le unità eDTU per ogni database su valori appropriati per i requisiti specifici di ogni applicazione.</span><span class="sxs-lookup"><span data-stu-id="e7efd-132">Adjust the per-database min and per-database max eDTU values to appropriate values for your specific application requirements.</span></span>

### <a name="performance-management-strategies"></a><span data-ttu-id="e7efd-133">Strategie per la gestione delle prestazioni</span><span class="sxs-lookup"><span data-stu-id="e7efd-133">Performance management strategies</span></span>

* <span data-ttu-id="e7efd-134">Per evitare di dover monitorare manualmente le prestazioni, è consigliabile **impostare l'attivazione di avvisi quando i database o i pool escono dai normali intervalli**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-134">To avoid having to manually monitor performance, it’s most effective to **set alerts that trigger when databases or pools stray out of normal ranges**.</span></span>
* <span data-ttu-id="e7efd-135">Per rispondere alle fluttuazioni a breve termine del livello di prestazioni aggregate di un pool, è possibile **scegliere un livello superiore o inferiore di eDTU per il pool**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-135">To respond to short-term fluctuations in the aggregate performance level of a pool, the **pool eDTU level can be scaled up or down**.</span></span> <span data-ttu-id="e7efd-136">Se la fluttuazione si verifica a intervalli regolari o prevedibili, **è possibile pianificare il ridimensionamento automatico del pool**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-136">If this fluctuation occurs on a regular or predictable basis, **scaling the pool can be scheduled to occur automatically**.</span></span> <span data-ttu-id="e7efd-137">Ad esempio, ridurre il numero di eDTU quando il carico di lavoro è notoriamente leggero, ad esempio durante la notte o nei fine settimana.</span><span class="sxs-lookup"><span data-stu-id="e7efd-137">For example, scale down when you know your workload is light, maybe overnight, or during weekends.</span></span>
* <span data-ttu-id="e7efd-138">Per rispondere a fluttuazioni a lungo termine o a modifiche del numero di database, **è possibile spostare singoli database in altri pool**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-138">To respond to longer-term fluctuations, or changes in the number of databases, **individual databases can be moved into other pools**.</span></span>
* <span data-ttu-id="e7efd-139">Per rispondere ad aumenti a breve termine del carico per *singoli* database, **è possibile rimuovere singoli database da un pool e assegnare loro un livello di prestazioni singolo**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-139">To respond to short term increases in *individual* database load **individual databases can be taken out of a pool and assigned an individual performance level**.</span></span> <span data-ttu-id="e7efd-140">Quando il carico si riduce di nuovo, il database può essere reinserito nel pool.</span><span class="sxs-lookup"><span data-stu-id="e7efd-140">Once the load is reduced, the database can then be returned to the pool.</span></span> <span data-ttu-id="e7efd-141">Quando questo tipo di comportamento è noto in anticipo, i database possono essere spostati preventivamente per assicurarsi che abbiano sempre le risorse necessarie ed evitare effetti sugli altri database nel pool.</span><span class="sxs-lookup"><span data-stu-id="e7efd-141">When this is known in advance, databases can be moved pre-emptively to ensure the database always has the resources it needs, and to avoid impact on other databases in the pool.</span></span> <span data-ttu-id="e7efd-142">Se si tratta di un requisito prevedibile, come nel caso di un picco di vendite di biglietti per un evento di grande richiamo, questo comportamento di gestione può essere integrato nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="e7efd-142">If this requirement is predictable, such as a venue experiencing a rush of ticket sales for a popular event, then this management behavior can be integrated into the application.</span></span>

<span data-ttu-id="e7efd-143">Il [portale di Azure](https://portal.azure.com) include funzionalità di monitoraggio e avviso predefinite per la maggior parte delle risorse.</span><span class="sxs-lookup"><span data-stu-id="e7efd-143">The [Azure portal](https://portal.azure.com) provides built-in monitoring and alerting on most resources.</span></span> <span data-ttu-id="e7efd-144">Per il database SQL, il monitoraggio e gli avvisi sono disponibili per database e pool.</span><span class="sxs-lookup"><span data-stu-id="e7efd-144">For SQL Database, monitoring and alerting is available on databases and pools.</span></span> <span data-ttu-id="e7efd-145">Le funzionalità di monitoraggio e avviso predefinite sono specifiche delle risorse, quindi è comodo usarle per un numero limitato di risorse, mentre non sono altrettanto utili quando si usano molte risorse.</span><span class="sxs-lookup"><span data-stu-id="e7efd-145">This built-in monitoring and alerting is resource-specific, so it's convenient to use for small numbers of resources, but is not very convenient when working with many resources.</span></span>

<span data-ttu-id="e7efd-146">Per gli scenari con volumi elevati in cui si lavora con molte risorse, si può usare [Log Analytics (OMS)](sql-database-saas-tutorial-log-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="e7efd-146">For high-volume scenarios where you're working with many reources, [Log Analytics (OMS)](sql-database-saas-tutorial-log-analytics.md) can be used.</span></span> <span data-ttu-id="e7efd-147">Si tratta di un servizio di Azure separato che fornisce funzionalità di analisi per log di diagnostica e dati di telemetria raccolti in un'area di lavoro di Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="e7efd-147">This is a separate Azure service that provides analytics over emitted diagnostic logs and telemetry gathered in a log analytics workspace.</span></span> <span data-ttu-id="e7efd-148">Log Analytics consente di raccogliere dati di telemetria da molti servizi e supporta l'esecuzione di query e l'impostazione di avvisi.</span><span class="sxs-lookup"><span data-stu-id="e7efd-148">Log Analytics can collect telemetry from many services and be used to query and set alerts.</span></span>

## <a name="get-the-wingtip-application-source-code-and-scripts"></a><span data-ttu-id="e7efd-149">Ottenere il codice sorgente e gli script dell'applicazione Wingtip</span><span class="sxs-lookup"><span data-stu-id="e7efd-149">Get the Wingtip application source code and scripts</span></span>

<span data-ttu-id="e7efd-150">Gli script dell'app SaaS Wingtip e il codice sorgente dell'applicazione sono disponibili nel repository GitHub [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS).</span><span class="sxs-lookup"><span data-stu-id="e7efd-150">The Wingtip SaaS scripts and application source code are available in the [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="e7efd-151">[Procedura per scaricare gli script dell'app SaaS Wingtip](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="e7efd-151">[Steps to download the Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="provision-additional-tenants"></a><span data-ttu-id="e7efd-152">Eseguire il provisioning di altri tenant</span><span class="sxs-lookup"><span data-stu-id="e7efd-152">Provision additional tenants</span></span>

<span data-ttu-id="e7efd-153">Anche se i pool possono essere una soluzione conveniente anche con solo due database S3, con l'aumentare del numero di database inseriti nel pool migliora anche il risparmio consentito dalla ripartizione dei costi.</span><span class="sxs-lookup"><span data-stu-id="e7efd-153">While pools can be cost-effective with just two S3 databases, the more databases that are in the pool the more cost-effective the averaging effect becomes.</span></span> <span data-ttu-id="e7efd-154">Per comprendere meglio il funzionamento della gestione e del monitoraggio delle prestazioni su larga scala, per questa esercitazione è necessario distribuire almeno 20 database.</span><span class="sxs-lookup"><span data-stu-id="e7efd-154">For a good understanding of how performance monitoring and management works at scale, this tutorial requires you have at least 20 databases deployed.</span></span>

<span data-ttu-id="e7efd-155">Se è già stato effettuato il provisioning di un batch di tenant in un'esercitazione precedente, saltare la sezione [Simulare l'utilizzo in tutti i database tenant](#simulate-usage-on-all-tenant-databases).</span><span class="sxs-lookup"><span data-stu-id="e7efd-155">If you already provisioned a batch of tenants in a prior tutorial, skip to the [Simulate usage on all tenant databases](#simulate-usage-on-all-tenant-databases) section.</span></span>

1. <span data-ttu-id="e7efd-156">Aprire …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in *PowerShell ISE*.</span><span class="sxs-lookup"><span data-stu-id="e7efd-156">Open …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in the *PowerShell ISE*.</span></span> <span data-ttu-id="e7efd-157">Mantenere lo script aperto durante l'esecuzione dei vari scenari presentati in questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="e7efd-157">Keep this script open as you'll run several scenarios during this tutorial.</span></span>
1. <span data-ttu-id="e7efd-158">Impostare **$DemoScenario** = **1**, **Effettuare il provisioning di un batch di tenant**</span><span class="sxs-lookup"><span data-stu-id="e7efd-158">Set **$DemoScenario** = **1**, **Provision a batch of tenants**</span></span>
1. <span data-ttu-id="e7efd-159">Premere **F5** per eseguire lo script.</span><span class="sxs-lookup"><span data-stu-id="e7efd-159">Press **F5** to run the script.</span></span>

<span data-ttu-id="e7efd-160">Lo script distribuirà 17 tenant in meno di cinque minuti.</span><span class="sxs-lookup"><span data-stu-id="e7efd-160">The script will deploy 17 tenants in less than five minutes.</span></span>

<span data-ttu-id="e7efd-161">Lo script *New-TenantBatch* usa un set annidato o collegato di modelli di [Resource Manager](../azure-resource-manager/index.md) che creano un batch di tenant, che copia per impostazione predefinita il database **basetenantdb** nel server di catalogo per creare i nuovi database tenant, quindi li registra nel catalogo e infine li inizializza con il nome del tenant e il tipo di sede.</span><span class="sxs-lookup"><span data-stu-id="e7efd-161">The *New-TenantBatch* script uses a nested or linked set of [Resource Manager](../azure-resource-manager/index.md) templates that create a batch of tenants, which by default copies the database **basetenantdb** on the catalog server to create the new tenant databases, then registers these in the catalog, and finally initializes them with the tenant name and venue type.</span></span> <span data-ttu-id="e7efd-162">Questo comportamento è coerente con il modo in cui l'app effettua il provisioning di un nuovo tenant.</span><span class="sxs-lookup"><span data-stu-id="e7efd-162">This is consistent with the way the app provisions a new tenant.</span></span> <span data-ttu-id="e7efd-163">Tutte le modifiche apportate a *basetenantdb* vengono applicate agli eventuali nuovi tenant di cui viene effettuato il provisioning in seguito.</span><span class="sxs-lookup"><span data-stu-id="e7efd-163">Any changes made to *basetenantdb* are applied to any new tenants provisioned thereafter.</span></span> <span data-ttu-id="e7efd-164">Vedere l'[esercitazione sulla gestione dello schema](sql-database-saas-tutorial-schema-management.md) per informazioni su come apportare modifiche allo schema di database tenant *esistenti*, incluso il database *basetenantdb*.</span><span class="sxs-lookup"><span data-stu-id="e7efd-164">See the [Schema Management tutorial](sql-database-saas-tutorial-schema-management.md) to see how to make schema changes to *existing* tenant databases (including the *basetenantdb* database).</span></span>

## <a name="simulate-usage-on-all-tenant-databases"></a><span data-ttu-id="e7efd-165">Simulare l'utilizzo in tutti i database tenant</span><span class="sxs-lookup"><span data-stu-id="e7efd-165">Simulate usage on all tenant databases</span></span>

<span data-ttu-id="e7efd-166">È disponibile lo script *Demo-PerformanceMonitoringAndManagement.ps1* che simula un carico di lavoro eseguito su tutti i database tenant.</span><span class="sxs-lookup"><span data-stu-id="e7efd-166">The *Demo-PerformanceMonitoringAndManagement.ps1* script is provided that simulates a workload running against all tenant databases.</span></span> <span data-ttu-id="e7efd-167">Il carico viene generato usando uno degli scenari di caricamento disponibili:</span><span class="sxs-lookup"><span data-stu-id="e7efd-167">The load is generated using one of the available load scenarios:</span></span>

| <span data-ttu-id="e7efd-168">Demo</span><span class="sxs-lookup"><span data-stu-id="e7efd-168">Demo</span></span> | <span data-ttu-id="e7efd-169">Scenario</span><span class="sxs-lookup"><span data-stu-id="e7efd-169">Scenario</span></span> |
|:--|:--|
| <span data-ttu-id="e7efd-170">2</span><span class="sxs-lookup"><span data-stu-id="e7efd-170">2</span></span> | <span data-ttu-id="e7efd-171">Generare un carico di intensità normale (circa 40 DTU)</span><span class="sxs-lookup"><span data-stu-id="e7efd-171">Generate normal intensity load (approx. 40 DTU)</span></span> |
| <span data-ttu-id="e7efd-172">3</span><span class="sxs-lookup"><span data-stu-id="e7efd-172">3</span></span> | <span data-ttu-id="e7efd-173">Generare un carico con picchi più lunghi e più frequenti per ogni database</span><span class="sxs-lookup"><span data-stu-id="e7efd-173">Generate load with longer and more frequent bursts per database</span></span>|
| <span data-ttu-id="e7efd-174">4</span><span class="sxs-lookup"><span data-stu-id="e7efd-174">4</span></span> | <span data-ttu-id="e7efd-175">Generare un carico con picchi DTU maggiori per ogni database (circa 80 DTU)</span><span class="sxs-lookup"><span data-stu-id="e7efd-175">Generate load with higher DTU bursts per database (approx. 80 DTU)</span></span>|
| <span data-ttu-id="e7efd-176">5</span><span class="sxs-lookup"><span data-stu-id="e7efd-176">5</span></span> | <span data-ttu-id="e7efd-177">Generare un carico normale e un carico elevato in un singolo tenant (circa 95 DTU)</span><span class="sxs-lookup"><span data-stu-id="e7efd-177">Generate a normal load plus a high load on a single tenant (approx. 95 DTU)</span></span>|
| <span data-ttu-id="e7efd-178">6</span><span class="sxs-lookup"><span data-stu-id="e7efd-178">6</span></span> | <span data-ttu-id="e7efd-179">Generare un carico non bilanciato su più pool</span><span class="sxs-lookup"><span data-stu-id="e7efd-179">Generate unbalanced load across multiple pools</span></span>|

<span data-ttu-id="e7efd-180">Il generatore di carico applica un carico di solo CPU *sintetico* a ogni database tenant.</span><span class="sxs-lookup"><span data-stu-id="e7efd-180">The load generator applies a *synthetic* CPU-only load to every tenant database.</span></span> <span data-ttu-id="e7efd-181">Il generatore avvia un processo per ogni database tenant, che chiama periodicamente una stored procedure che genera il carico.</span><span class="sxs-lookup"><span data-stu-id="e7efd-181">The generator starts a job for each tenant database, which calls a stored procedure periodically that generates the load.</span></span> <span data-ttu-id="e7efd-182">I livelli di carico (espressi in eDTU), la durata e gli intervalli sono diversi per i vari database, in modo da simulare un'attività imprevedibile dei tenant.</span><span class="sxs-lookup"><span data-stu-id="e7efd-182">The load levels (in eDTUs), duration, and intervals are varied across all databases, simulating unpredictable tenant activity.</span></span>

1. <span data-ttu-id="e7efd-183">Aprire …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in *PowerShell ISE*.</span><span class="sxs-lookup"><span data-stu-id="e7efd-183">Open …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in the *PowerShell ISE*.</span></span> <span data-ttu-id="e7efd-184">Mantenere lo script aperto durante l'esecuzione dei vari scenari presentati in questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="e7efd-184">Keep this script open as you'll run several scenarios during this tutorial.</span></span>
1. <span data-ttu-id="e7efd-185">Impostare **$DemoScenario** = **2**, *Generare un carico di intensità normale*.</span><span class="sxs-lookup"><span data-stu-id="e7efd-185">Set **$DemoScenario** = **2**, *Generate normal intensity load*.</span></span>
1. <span data-ttu-id="e7efd-186">Premere **F5** per applicare un carico a tutti i database tenant.</span><span class="sxs-lookup"><span data-stu-id="e7efd-186">Press **F5** to apply a load to all your tenant databases.</span></span>

<span data-ttu-id="e7efd-187">Wingtip è un'app SaaS e i carichi di lavoro per le app SaaS reali sono in genere sporadici e imprevedibili.</span><span class="sxs-lookup"><span data-stu-id="e7efd-187">Wingtip is a SaaS app, and the real-world load on a SaaS app is typically sporadic and unpredictable.</span></span> <span data-ttu-id="e7efd-188">Per simulare questa situazione, il generatore produce un carico casuale distribuito tra tutti i tenant.</span><span class="sxs-lookup"><span data-stu-id="e7efd-188">To simulate this, the load generator produces a randomized load distributed across all tenants.</span></span> <span data-ttu-id="e7efd-189">Servono alcuni minuti perché emerga il modello di carico, quindi eseguire il generatore di carico per 3-5 minuti prima di provare a monitorare il carico come descritto nelle sezioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="e7efd-189">Several minutes are needed for the load pattern to emerge, so run the load generator for 3-5 minutes before attempting to monitor the load in the following sections.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e7efd-190">Il generatore di carico esegue una serie di processi nella sessione di PowerShell locale.</span><span class="sxs-lookup"><span data-stu-id="e7efd-190">The load generator is running as a series of jobs in your local PowerShell session.</span></span> <span data-ttu-id="e7efd-191">Mantenere aperta la scheda *Demo-PerformanceMonitoringAndManagement.ps1*.</span><span class="sxs-lookup"><span data-stu-id="e7efd-191">Keep the *Demo-PerformanceMonitoringAndManagement.ps1* tab open!</span></span> <span data-ttu-id="e7efd-192">Se si chiude la scheda o si sospende il computer, il generatore di carico si arresta.</span><span class="sxs-lookup"><span data-stu-id="e7efd-192">If you close the tab, or suspend your machine, the load generator stops.</span></span> <span data-ttu-id="e7efd-193">Il generatore di carico rimane in uno stato di *chiamata del processo* in cui genera il carico in tutti i nuovi tenant di cui viene effettuato il provisioning dopo l'avvio del generatore.</span><span class="sxs-lookup"><span data-stu-id="e7efd-193">The load generator remains in a *job-invoking* state where it generates load on any new tenants that are provisioned after the generator is started.</span></span> <span data-ttu-id="e7efd-194">Usare *CTRL+C* per arrestare la chiamata di nuovi processi e chiudere lo script.</span><span class="sxs-lookup"><span data-stu-id="e7efd-194">Use *Ctrl-C* to stop invoking new jobs and exit the script.</span></span> <span data-ttu-id="e7efd-195">L'esecuzione del generatore di carico continuerà, ma solo nei tenant esistenti.</span><span class="sxs-lookup"><span data-stu-id="e7efd-195">The load generator will continue to run, but only on existing tenants.</span></span>

## <a name="monitor-resource-usage-using-the-azure-portal"></a><span data-ttu-id="e7efd-196">Monitorare l'utilizzo delle risorse usando il portale di Azure</span><span class="sxs-lookup"><span data-stu-id="e7efd-196">Monitor resource usage using the Azure portal</span></span>

<span data-ttu-id="e7efd-197">Per monitorare l'utilizzo delle risorse risultante dal carico applicato, aprire il portale per il pool che contiene i database tenant:</span><span class="sxs-lookup"><span data-stu-id="e7efd-197">To monitor the resource usage that results from the load being applied, open the portal to the pool containing the tenant databases:</span></span>

1. <span data-ttu-id="e7efd-198">Aprire il [portale di Azure](https://portal.azure.com) e passare al server *tenants1-&lt;UTENTE&gt;*.</span><span class="sxs-lookup"><span data-stu-id="e7efd-198">Open the [Azure portal](https://portal.azure.com) and browse to the *tenants1-&lt;USER&gt;* server.</span></span>
1. <span data-ttu-id="e7efd-199">Scorrere verso il basso e individuare i pool elastici, quindi fare clic su **Pool1**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-199">Scroll down and locate elastic pools and click **Pool1**.</span></span> <span data-ttu-id="e7efd-200">Questo pool contiene tutti i database tenant creati finora.</span><span class="sxs-lookup"><span data-stu-id="e7efd-200">This pool contains all the tenant databases created so far.</span></span>

<span data-ttu-id="e7efd-201">Osservare i grafici **Monitoraggio pool elastico** e **Monitoraggio database elastico**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-201">Observe the **Elastic pool monitoring** and **Elastic database monitoring** charts.</span></span>

<span data-ttu-id="e7efd-202">L'utilizzo delle risorse del pool è l'utilizzo aggregato di tutti i database nel pool.</span><span class="sxs-lookup"><span data-stu-id="e7efd-202">The pool's resource utilization is the aggregate database utilization for all databases in the pool.</span></span> <span data-ttu-id="e7efd-203">Il grafico relativo ai database mostra i cinque database principali:</span><span class="sxs-lookup"><span data-stu-id="e7efd-203">The database chart shows the five hottest databases:</span></span>

![](./media/sql-database-saas-tutorial-performance-monitoring/pool1.png)

<span data-ttu-id="e7efd-204">Dato che il pool include altri database oltre ai primi cinque, l'utilizzo del pool mostra un livello di attività non rappresentato nel grafico per i primi cinque database.</span><span class="sxs-lookup"><span data-stu-id="e7efd-204">Because there are additional databases in the pool beyond the top five, the pool utilization shows activity that is not reflected in the top five databases chart.</span></span> <span data-ttu-id="e7efd-205">Per altri dettagli, fare clic su **Utilizzo risorse database**:</span><span class="sxs-lookup"><span data-stu-id="e7efd-205">For additional details, click **Database Resource Utilization**:</span></span>

![](./media/sql-database-saas-tutorial-performance-monitoring/database-utilization.png)


## <a name="set-performance-alerts-on-the-pool"></a><span data-ttu-id="e7efd-206">Impostare avvisi sulle prestazioni per il pool</span><span class="sxs-lookup"><span data-stu-id="e7efd-206">Set performance alerts on the pool</span></span>

<span data-ttu-id="e7efd-207">Impostare un avviso per il pool da attivare quando l'utilizzo è \>75%, come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="e7efd-207">Set an alert on the pool that triggers on \>75% utilization as follows:</span></span>

1. <span data-ttu-id="e7efd-208">Aprire *Pool1* (nel server *tenants1-\<utente\>*) nel [portale di Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="e7efd-208">Open *Pool1* (on the *tenants1-\<user\>* server) in the [Azure portal](https://portal.azure.com).</span></span>
1. <span data-ttu-id="e7efd-209">Fare clic su **Regole di avviso** e quindi fare clic su **+ Aggiungi avviso**:</span><span class="sxs-lookup"><span data-stu-id="e7efd-209">Click **Alert Rules**, and then click **+ Add alert**:</span></span>

   ![aggiungere un avviso](media/sql-database-saas-tutorial-performance-monitoring/add-alert.png)

1. <span data-ttu-id="e7efd-211">Specificare un nome, ad esempio **DTU elevate**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-211">Provide a name, such as **High DTU**,</span></span>
1. <span data-ttu-id="e7efd-212">Impostare i valori seguenti:</span><span class="sxs-lookup"><span data-stu-id="e7efd-212">Set the following values:</span></span>
   * <span data-ttu-id="e7efd-213">**Metrica = Percentuale eDTU**</span><span class="sxs-lookup"><span data-stu-id="e7efd-213">**Metric = eDTU percentage**</span></span>
   * <span data-ttu-id="e7efd-214">**Condizione = maggiore di** .</span><span class="sxs-lookup"><span data-stu-id="e7efd-214">**Condition = greater than**.</span></span>
   * <span data-ttu-id="e7efd-215">**Soglia = 75**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-215">**Threshold = 75**.</span></span>
   * <span data-ttu-id="e7efd-216">**Periodo = Negli ultimi 30 minuti**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-216">**Period = Over the last 30 minutes**.</span></span>
1. <span data-ttu-id="e7efd-217">Aggiungere un indirizzo e-mail alla casella *Indirizzi di posta elettronica aggiuntivi dell'amministratore* e fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-217">Add an email address to the *Additional administrator email(s)* box and click **OK**.</span></span>

   ![impostare l'avviso](media/sql-database-saas-tutorial-performance-monitoring/alert-rule.png)


## <a name="scale-up-a-busy-pool"></a><span data-ttu-id="e7efd-219">Potenziare un pool con carico eccessivo</span><span class="sxs-lookup"><span data-stu-id="e7efd-219">Scale up a busy pool</span></span>

<span data-ttu-id="e7efd-220">Se il livello di carico aggregato per un pool aumenta fino a superarne la capacità massima e raggiunge il 100% di utilizzo delle unità eDTU, ciò ha effetti sulle prestazioni dei database con potenziale rallentamento dei tempi di risposta alle query per tutti i database nel pool.</span><span class="sxs-lookup"><span data-stu-id="e7efd-220">If the aggregate load level increases on a pool to the point that it maxes out the pool and reaches 100% eDTU usage, then individual database performance is affected, potentially slowing query response times for all databases in the pool.</span></span>

<span data-ttu-id="e7efd-221">**Come soluzione a breve termine**, valutare la possibilità di aumentare le prestazioni del pool per fornire risorse aggiuntive oppure di rimuovere database dal pool, spostandoli in altri pool o fuori dal pool in un livello di servizio autonomo.</span><span class="sxs-lookup"><span data-stu-id="e7efd-221">**Short term**, consider scaling up the pool to provide additional resources, or removing databases from the pool (moving them to other pools, or out of the pool to a stand-alone service tier).</span></span>

<span data-ttu-id="e7efd-222">**Nel lungo termine**, prendere in considerazione l'ottimizzazione delle query o dell'utilizzo degli indici per migliorare le prestazioni dei database.</span><span class="sxs-lookup"><span data-stu-id="e7efd-222">**Longer term**, consider optimizing queries or index usage to improve database performance.</span></span> <span data-ttu-id="e7efd-223">A seconda di quanto un'applicazione è sensibile agli effetti dei problemi di prestazioni, è buona norma potenziare un pool prima di raggiungere il 100% di utilizzo delle eDTU.</span><span class="sxs-lookup"><span data-stu-id="e7efd-223">Depending on the application's sensitivity to performance issues its best practice to scale a pool up before it reaches 100% eDTU usage.</span></span> <span data-ttu-id="e7efd-224">Usare un avviso per ricevere segnalazioni con il dovuto anticipo.</span><span class="sxs-lookup"><span data-stu-id="e7efd-224">Use an alert to warn you in advance.</span></span>

<span data-ttu-id="e7efd-225">È possibile simulare le condizioni di carico eccessivo per un pool aumentando il carico prodotto dal generatore di carico.</span><span class="sxs-lookup"><span data-stu-id="e7efd-225">You can simulate a busy pool by increasing the load produced by the generator.</span></span> <span data-ttu-id="e7efd-226">Creando picchi più frequenti e di lunga durata per i database si aumenta il carico aggregato del pool senza modificare i requisiti dei singoli database.</span><span class="sxs-lookup"><span data-stu-id="e7efd-226">Causing the databases to burst more frequently, and for longer, increasing the aggregate load on the pool without changing the requirements of the individual databases.</span></span> <span data-ttu-id="e7efd-227">È facile aumentare le prestazioni del pool nel portale o da PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e7efd-227">Scaling up the pool is easily done in the portal or from PowerShell.</span></span> <span data-ttu-id="e7efd-228">In questo esercizio viene usato il portale.</span><span class="sxs-lookup"><span data-stu-id="e7efd-228">This exercise uses the portal.</span></span>

1. <span data-ttu-id="e7efd-229">Impostare *$DemoScenario* = **3**, _Generare un carico con picchi più lunghi e più frequenti per ogni database_ per aumentare l'intensità del carico aggregato del pool senza modificare il carico di picco necessario per ogni database.</span><span class="sxs-lookup"><span data-stu-id="e7efd-229">Set *$DemoScenario* = **3**, _Generate load with longer and more frequent bursts per database_ to increase the intensity of the aggregate load on the pool without changing the peak load required by each database.</span></span>
1. <span data-ttu-id="e7efd-230">Premere **F5** per applicare un carico a tutti i database tenant.</span><span class="sxs-lookup"><span data-stu-id="e7efd-230">Press **F5** to apply a load to all your tenant databases.</span></span>

1. <span data-ttu-id="e7efd-231">Passare a **Pool1** nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="e7efd-231">Go to **Pool1** in the Azure portal.</span></span>

<span data-ttu-id="e7efd-232">Monitorare il maggiore utilizzo di eDTU del pool nel grafico superiore.</span><span class="sxs-lookup"><span data-stu-id="e7efd-232">Monitor the increased pool eDTU usage on the upper chart.</span></span> <span data-ttu-id="e7efd-233">Sono necessari alcuni minuti prima di vedere gli effetti del nuovo carico di lavoro maggiore, ma presto il pool dovrebbe raggiungere il massimo utilizzo e, dato che il nuovo modello di carico è costante, si verificherà presto un sovraccarico del pool.</span><span class="sxs-lookup"><span data-stu-id="e7efd-233">It takes a few minutes for the new higher load to kick in, but you should quickly see the pool start to hit max utilization, and as the load steadies into the new pattern, it rapidly overloads the pool.</span></span>

1. <span data-ttu-id="e7efd-234">Per aumentare le prestazioni del pool, fare clic su **Configura pool** nella parte superiore della pagina **Pool1**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-234">To scale up the pool, click **Configure pool** at the top of the **Pool1** page.</span></span>
1. <span data-ttu-id="e7efd-235">Impostare **eDTU pool** su **100**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-235">Adjust the **Pool eDTU** setting to **100**.</span></span> <span data-ttu-id="e7efd-236">La modifica del numero di eDTU del pool non cambia le impostazioni per i singoli database, che è ancora pari a un massimo di 50 eDTU per database.</span><span class="sxs-lookup"><span data-stu-id="e7efd-236">Changing the pool eDTU does not change the per-database settings (which is still 50 eDTU max per database).</span></span> <span data-ttu-id="e7efd-237">Le impostazioni per i singoli database sono visibili sul lato destro della pagina **Configura pool**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-237">You can see the per-database settings on the right side of the **Configure pool** page.</span></span>
1. <span data-ttu-id="e7efd-238">Fare clic su **Salva** per inviare la richiesta di ridimensionamento del pool.</span><span class="sxs-lookup"><span data-stu-id="e7efd-238">Click **Save** to submit the request to scale the pool.</span></span>

<span data-ttu-id="e7efd-239">Tornare a **Pool1** > **Panoramica** per visualizzare i grafici di monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="e7efd-239">Go back to **Pool1** > **Overview** to view the monitoring charts.</span></span> <span data-ttu-id="e7efd-240">Monitorare l'effetto dell'assegnazione di altre risorse al pool, anche se, con pochi database e un carico casuale, non sempre è facile notare conseguenze lampanti finché non si prolunga l'esecuzione per un periodo minimo.</span><span class="sxs-lookup"><span data-stu-id="e7efd-240">Monitor the effect of providing the pool with more resources (although with few databases and a randomized load it’s not always easy to see conclusively until you run for some time).</span></span> <span data-ttu-id="e7efd-241">Mentre si analizzano i grafici tenere che presente che il valore 100% nel grafico superiore rappresenta ora 100 eDTU, mentre 100% nel grafico inferiore corrisponde ancora a 50 eDTU perché il numero massimo di eDTU per database è ancora 50.</span><span class="sxs-lookup"><span data-stu-id="e7efd-241">While you are looking at the charts bear in mind that 100% on the upper chart now represents 100 eDTUs, while on the lower chart 100% is still 50 eDTUs as the per-database max is still 50 eDTUs.</span></span>

<span data-ttu-id="e7efd-242">I database rimango online e pienamente disponibili durante l'intero processo.</span><span class="sxs-lookup"><span data-stu-id="e7efd-242">Databases remain online and fully available throughout the process.</span></span> <span data-ttu-id="e7efd-243">All'ultimo momento, quando ogni database è pronto per essere abilitato con il nuovo numero di eDTU del pool, le eventuali connessioni attive vengono interrotte.</span><span class="sxs-lookup"><span data-stu-id="e7efd-243">At the last moment as each database is ready to be enabled with the new pool eDTU, any active connections are broken.</span></span> <span data-ttu-id="e7efd-244">Il codice delle applicazioni dovrebbe sempre essere scritto in modo da prevedere tentativi di riattivazione delle connessioni interrotte, quindi l'applicazione si riconnetterà al database nel pool potenziato.</span><span class="sxs-lookup"><span data-stu-id="e7efd-244">Application code should always be written to retry dropped connections, and so will reconnect to the database in the scaled-up pool.</span></span>

## <a name="load-balance-between-pools"></a><span data-ttu-id="e7efd-245">Bilanciare il carico tra i pool</span><span class="sxs-lookup"><span data-stu-id="e7efd-245">Load balance between pools</span></span>

<span data-ttu-id="e7efd-246">In alternativa al potenziamento del pool, è possibile creare un secondo pool e spostare database in questo pool per bilanciare il carico tra i due.</span><span class="sxs-lookup"><span data-stu-id="e7efd-246">As an alternative to scaling up the pool, create a second pool and move databases into it to balance the load between the two pools.</span></span> <span data-ttu-id="e7efd-247">A questo scopo, il nuovo pool deve essere creato nello stesso server del primo.</span><span class="sxs-lookup"><span data-stu-id="e7efd-247">To do this the new pool must be created on the same server as the first.</span></span>

1. <span data-ttu-id="e7efd-248">Nel [portale di Azure](https://portal.azure.com) aprire il server **tenants1-&lt;UTENTE&gt;**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-248">In the [Azure portal](https://portal.azure.com), open the **tenants1-&lt;USER&gt;** server.</span></span>
1. <span data-ttu-id="e7efd-249">Fare clic su **+ Nuovo pool** per creare un pool nel server corrente.</span><span class="sxs-lookup"><span data-stu-id="e7efd-249">Click **+ New pool** to create a pool on the current server.</span></span>
1. <span data-ttu-id="e7efd-250">Nel modello **Pool di database elastici**:</span><span class="sxs-lookup"><span data-stu-id="e7efd-250">On the **Elastic database pool** template:</span></span>

    1. <span data-ttu-id="e7efd-251">Impostare **Nome** su *Pool2*.</span><span class="sxs-lookup"><span data-stu-id="e7efd-251">Set **Name** to *Pool2*.</span></span>
    1. <span data-ttu-id="e7efd-252">Lasciare il piano tariffario **Pool Standard**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-252">Leave the pricing tier as **Standard Pool**.</span></span>
    1. <span data-ttu-id="e7efd-253">Fare clic su **Configura pool**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-253">Click **Configure pool**,</span></span>
    1. <span data-ttu-id="e7efd-254">Impostare **eDTU pool** su *50 eDTU*.</span><span class="sxs-lookup"><span data-stu-id="e7efd-254">Set **Pool eDTU** to *50 eDTU*.</span></span>
    1. <span data-ttu-id="e7efd-255">Fare clic su **Aggiungi database** per visualizzare un elenco di database nel server che possono essere aggiunti a *Pool2*.</span><span class="sxs-lookup"><span data-stu-id="e7efd-255">Click **Add databases** to see a list of databases on the server that can be added to *Pool2*.</span></span>
    1. <span data-ttu-id="e7efd-256">Selezionare 10 database per spostarli nel nuovo pool e quindi fare clic su **Seleziona**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-256">Select any 10 databases to move these to the new pool, and then click **Select**.</span></span> <span data-ttu-id="e7efd-257">Se si è eseguito il generatore di carico, al servizio è già noto che il profilo delle prestazioni richiede un pool di dimensioni superiori alle 50 eDTU predefinite e viene suggerito di iniziare con un'impostazione di 100 eDTU.</span><span class="sxs-lookup"><span data-stu-id="e7efd-257">If you've been running the load generator, the service already knows that your performance profile requires a larger pool than the default 50 eDTU size and recommends starting with a 100 eDTU setting.</span></span>

    ![Suggerimento](media/sql-database-saas-tutorial-performance-monitoring/configure-pool.png)

    1. <span data-ttu-id="e7efd-259">Per questa esercitazione, lasciare l'impostazione predefinita di 50 eDTU e fare di nuovo clic su **Seleziona**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-259">For this tutorial, leave the default at 50 eDTUs, and click **Select** again.</span></span>
    1. <span data-ttu-id="e7efd-260">Fare clic su **OK** per creare il nuovo pool e spostarvi i database selezionati.</span><span class="sxs-lookup"><span data-stu-id="e7efd-260">Select **OK** to create the new pool and to move the selected databases into it.</span></span>

<span data-ttu-id="e7efd-261">La creazione del pool e lo spostamento dei database richiedono alcuni minuti.</span><span class="sxs-lookup"><span data-stu-id="e7efd-261">Creating the pool and moving the databases takes a few minutes.</span></span> <span data-ttu-id="e7efd-262">Quando i database vengono spostati, rimangono online e completamente accessibili fino all'ultimo momento, quando viene chiusa qualsiasi connessione aperta.</span><span class="sxs-lookup"><span data-stu-id="e7efd-262">As databases are moved they remain online and fully accessible until the very last moment, at which point any open connections are closed.</span></span> <span data-ttu-id="e7efd-263">Purché esista una logica per i tentativi, i client si connetteranno quindi al database nel nuovo pool.</span><span class="sxs-lookup"><span data-stu-id="e7efd-263">As long as you have some retry logic, clients will then connect to the database in the new pool.</span></span>

<span data-ttu-id="e7efd-264">Passare a **Pool2** (nel server *tenants1*) per aprire il pool e monitorarne le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="e7efd-264">Browse to **Pool2** (on the *tenants1* server) to open the pool and monitor its performance.</span></span> <span data-ttu-id="e7efd-265">Se non viene visualizzato, attendere il completamento del provisioning del nuovo pool.</span><span class="sxs-lookup"><span data-stu-id="e7efd-265">If you don't see it, wait for provisioning of the new pool to complete.</span></span>

<span data-ttu-id="e7efd-266">Si nota ora una riduzione dell'utilizzo delle risorse di *Pool1* e un carico simile per *Pool2*.</span><span class="sxs-lookup"><span data-stu-id="e7efd-266">You now see that resource usage on *Pool1* has dropped and that *Pool2* is now similarly loaded.</span></span>

## <a name="manage-performance-of-a-single-database"></a><span data-ttu-id="e7efd-267">Gestire le prestazioni di un database singolo</span><span class="sxs-lookup"><span data-stu-id="e7efd-267">Manage performance of a single database</span></span>

<span data-ttu-id="e7efd-268">Se un singolo database in un pool è sottoposto a un carico elevato prolungato, a seconda della configurazione del pool, potrebbe tendenzialmente usare in modo predominante molte delle risorse nel pool con effetti sugli altri database.</span><span class="sxs-lookup"><span data-stu-id="e7efd-268">If a single database in a pool experiences a sustained high load, depending on the pool configuration, it may tend to dominate the resources in the pool and impact other databases.</span></span> <span data-ttu-id="e7efd-269">Se è probabile che questo tipo di attività continui per un certo tempo, è possibile spostare temporaneamente il database fuori dal pool.</span><span class="sxs-lookup"><span data-stu-id="e7efd-269">If the activity is likely to continue for some time, the database can be temporarily moved out of the pool.</span></span> <span data-ttu-id="e7efd-270">In questo modo il database può avere a disposizione le risorse aggiuntive necessarie ed essere isolato dagli altri database.</span><span class="sxs-lookup"><span data-stu-id="e7efd-270">This allows the database to have the extra resources it needs, and isolates it from the other databases.</span></span>

<span data-ttu-id="e7efd-271">Questo esercizio simula l'effetto di un carico elevato per Contoso Concert Hall in concomitanza con l'inizio della vendita dei biglietti per un concerto di grande richiamo.</span><span class="sxs-lookup"><span data-stu-id="e7efd-271">This exercise simulates the effect of Contoso Concert Hall experiencing a high load when tickets go on sale for a popular concert.</span></span>

1. <span data-ttu-id="e7efd-272">Aprire lo script …\\*Demo-PerformanceMonitoringAndManagement.ps1*.</span><span class="sxs-lookup"><span data-stu-id="e7efd-272">Open the …\\*Demo-PerformanceMonitoringAndManagement.ps1* script.</span></span>
1. <span data-ttu-id="e7efd-273">Impostare **$DemoScenario = 5, Generare un carico normale e un carico elevato in un singolo tenant (circa 95 DTU).**</span><span class="sxs-lookup"><span data-stu-id="e7efd-273">Set **$DemoScenario = 5, Generate a normal load plus a high load on a single tenant (approx. 95 DTU).**</span></span>
1. <span data-ttu-id="e7efd-274">Impostare **$SingleTenantDatabaseName = contosoconcerthall**</span><span class="sxs-lookup"><span data-stu-id="e7efd-274">Set **$SingleTenantDatabaseName = contosoconcerthall**</span></span>
1. <span data-ttu-id="e7efd-275">Eseguire lo script con **F5**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-275">Execute the script using **F5**.</span></span>


1. <span data-ttu-id="e7efd-276">Nel [portale di Azure](https://portal.azure.com) aprire **Pool1**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-276">In the [Azure portal](https://portal.azure.com) open **Pool1**.</span></span>
1. <span data-ttu-id="e7efd-277">Esaminare il grafico **Monitoraggio pool elastico** e cercare il maggiore utilizzo di eDTU del pool.</span><span class="sxs-lookup"><span data-stu-id="e7efd-277">Inspect the **Elastic pool monitoring** chart and look for the increased pool eDTU usage.</span></span> <span data-ttu-id="e7efd-278">Dopo un paio di minuti, il carico elevato dovrebbe iniziare a comparire e il pool dovrebbe raggiungere velocemente l'utilizzo al 100%.</span><span class="sxs-lookup"><span data-stu-id="e7efd-278">After a minute or two, the higher load should start to kick in, and you should quickly see that the pool hits 100% utilization.</span></span>
1. <span data-ttu-id="e7efd-279">Esaminare i dati in **Monitoraggio database elastico** che mostrano i database più attivi nell'ultima ora.</span><span class="sxs-lookup"><span data-stu-id="e7efd-279">Inspect the **Elastic database monitoring** display which shows the hottest databases in the past hour.</span></span> <span data-ttu-id="e7efd-280">Il database *contosoconcerthall* dovrebbe essere presto visualizzato come uno dei cinque database più attivi.</span><span class="sxs-lookup"><span data-stu-id="e7efd-280">The *contosoconcerthall* database should soon appear as one of the five hottest databases.</span></span>
1. <span data-ttu-id="e7efd-281">**Fare clic sul** **grafico** Monitoraggio database elastico. Viene aperta la pagina **Utilizzo risorse database** in cui è possibile monitorare i singoli database.</span><span class="sxs-lookup"><span data-stu-id="e7efd-281">**Click on the Elastic database monitoring** **chart** and it opens the **Database Resource Utilization** page where you can monitor any of the databases.</span></span> <span data-ttu-id="e7efd-282">Ciò consente di isolare i dati per il database *contosoconcerthall*.</span><span class="sxs-lookup"><span data-stu-id="e7efd-282">This lets you isolate the display for the *contosoconcerthall* database.</span></span>
1. <span data-ttu-id="e7efd-283">Nell'elenco di database fare clic su **contosoconcerthall**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-283">From the list of databases, click **contosoconcerthall**.</span></span>
1. <span data-ttu-id="e7efd-284">Fare clic su **Piano tariffario (piano DTU)** per aprire la pagina **Configura prestazioni** in cui è possibile impostare un livello di prestazioni autonomo per il database.</span><span class="sxs-lookup"><span data-stu-id="e7efd-284">Click **Pricing Tier (scale DTUs)** to open the **Configure performance** page where you can set a stand-alone performance level for the database.</span></span>
1. <span data-ttu-id="e7efd-285">Fare clic sulla scheda **Standard** per aprire le opzioni di scalabilità nel livello Standard.</span><span class="sxs-lookup"><span data-stu-id="e7efd-285">Click on the **Standard** tab to open the scale options in the Standard tier.</span></span>
1. <span data-ttu-id="e7efd-286">Scorrere il **dispositivo di scorrimento DTU** verso destra per selezionare **100 DTU**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-286">Slide the **DTU slider** to right to select **100** DTUs.</span></span> <span data-ttu-id="e7efd-287">Si noti che questa impostazione corrisponde all'obiettivo di servizio, **S3**.</span><span class="sxs-lookup"><span data-stu-id="e7efd-287">Note this corresponds to the service objective, **S3**.</span></span>
1. <span data-ttu-id="e7efd-288">Fare clic su **Applica** per spostare il database fuori dal pool e impostarlo come database *S3 Standard*.</span><span class="sxs-lookup"><span data-stu-id="e7efd-288">Click **Apply** to move the database out of the pool and make it a *Standard S3* database.</span></span>
1. <span data-ttu-id="e7efd-289">Dopo aver completato il ridimensionamento, monitorare l'effetto sul database contosoconcerthall e su Pool1 nei pannelli del pool elastico e del database.</span><span class="sxs-lookup"><span data-stu-id="e7efd-289">Once scaling is complete, monitor the effect on the contosoconcerthall database and Pool1 on the elastic pool and database blades.</span></span>

<span data-ttu-id="e7efd-290">Quando il carico elevato per il database contosoconcerthall diminuisce, è necessario reinserirlo tempestivamente nel pool per ridurre i costi.</span><span class="sxs-lookup"><span data-stu-id="e7efd-290">Once the high load on the contosoconcerthall database subsides you should promptly return it to the pool to reduce its cost.</span></span> <span data-ttu-id="e7efd-291">Se non è chiaro quando ciò accade, è possibile impostare un avviso nel database che verrà attivato quando l'utilizzo di DTU scende sotto il massimo consentito per ogni database nel pool.</span><span class="sxs-lookup"><span data-stu-id="e7efd-291">If it’s unclear when that will happen you could set an alert on the database that will trigger when its DTU usage drops below the per-database max on the pool.</span></span> <span data-ttu-id="e7efd-292">Lo spostamento di un database in un pool è descritto nell'esercizio 5.</span><span class="sxs-lookup"><span data-stu-id="e7efd-292">Moving a database into a pool is described in exercise 5.</span></span>

## <a name="other-performance-management-patterns"></a><span data-ttu-id="e7efd-293">Altri modelli di gestione delle prestazioni</span><span class="sxs-lookup"><span data-stu-id="e7efd-293">Other Performance Management Patterns</span></span>

<span data-ttu-id="e7efd-294">**Scalabilità preventiva** Nell'esercizio precedente è stato illustrato come ridimensionare un database isolato quando si conosce il database su cui intervenire.</span><span class="sxs-lookup"><span data-stu-id="e7efd-294">**Pre-emptive scaling** In the exercise above where you explored how to scale an isolated database, you knew which database to look for.</span></span> <span data-ttu-id="e7efd-295">Se il responsabile della gestione di Contoso Concert Hall avesse informato Wingtips dell'imminente vendita di biglietti, sarebbe stato possibile rimuovere preventivamente il database dal pool.</span><span class="sxs-lookup"><span data-stu-id="e7efd-295">If the management of Contoso Concert Hall had informed Wingtips of the impending ticket sale, the database could have been moved out of the pool pre-emptively.</span></span> <span data-ttu-id="e7efd-296">In caso contrario, sarebbe stato probabilmente necessario un avviso per il pool o il database per ricevere una segnalazione della situazione.</span><span class="sxs-lookup"><span data-stu-id="e7efd-296">Otherwise, it would likely have required an alert on the pool or the database to spot what was happening.</span></span> <span data-ttu-id="e7efd-297">È meglio evitare di venire a conoscenza di un problema di questo tipo quando gli altri tenant nel pool si lamentano del calo di prestazioni.</span><span class="sxs-lookup"><span data-stu-id="e7efd-297">You wouldn’t want to learn about this from the other tenants in the pool complaining of degraded performance.</span></span> <span data-ttu-id="e7efd-298">Se il tenant può prevedere il tempo per cui saranno necessarie risorse aggiuntive, inoltre, è possibile configurare un runbook di Automazione di Azure per spostare il database fuori dal pool e reinserirlo in base a una pianificazione definita.</span><span class="sxs-lookup"><span data-stu-id="e7efd-298">And if the tenant can predict how long they will need additional resources you can set up an Azure Automation runbook to move the database out of the pool and then back in again on a defined schedule.</span></span>

<span data-ttu-id="e7efd-299">**Scalabilità self-service dei tenant** Dato che la scalabilità richiede attività facilmente richiamabili tramite l'API di gestione, è possibile integrare in modo semplice funzioni di scalabilità dei database tenant nell'applicazione che interagisce con i tenant e offrirle come funzionalità del servizio SaaS.</span><span class="sxs-lookup"><span data-stu-id="e7efd-299">**Tenant self-service scaling** Because scaling is a task easily called via the management API, you can easily build the ability to scale tenant databases into your tenant-facing application, and offer it as a feature of your SaaS service.</span></span> <span data-ttu-id="e7efd-300">Ad esempio, fare in modo che i tenant possano amministrare in autonomia l'aumento o la riduzione delle prestazioni, eventualmente collegando anche queste operazioni in modo diretto alla fatturazione.</span><span class="sxs-lookup"><span data-stu-id="e7efd-300">For example, let tenants self-administer scaling up and down, perhaps linked directly to their billing!</span></span>

<span data-ttu-id="e7efd-301">**Aumento e riduzione delle prestazioni per un pool con una pianificazione in base ai modelli di utilizzo**</span><span class="sxs-lookup"><span data-stu-id="e7efd-301">**Scaling a pool up and down on a schedule to match usage patterns**</span></span>

<span data-ttu-id="e7efd-302">Se l'utilizzo aggregato dei tenant segue modelli prevedibili, è possibile usare Automazione di Azure per aumentare e ridurre le prestazioni di un pool con una pianificazione.</span><span class="sxs-lookup"><span data-stu-id="e7efd-302">Where aggregate tenant usage follows predictable usage patterns, you can use Azure Automation to scale a pool up and down on a schedule.</span></span> <span data-ttu-id="e7efd-303">Ad esempio, ridurre le prestazioni dopo le 18 e aumentarle di nuovo prima delle 6 nei giorni della settimana in cui è noto che si verifica un calo delle risorse richieste.</span><span class="sxs-lookup"><span data-stu-id="e7efd-303">For example, scale a pool down after 6pm and up again before 6am on weekdays when you know there is a drop in resource requirements.</span></span>



## <a name="next-steps"></a><span data-ttu-id="e7efd-304">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="e7efd-304">Next steps</span></span>

<span data-ttu-id="e7efd-305">In questa esercitazione si apprenderà come:</span><span class="sxs-lookup"><span data-stu-id="e7efd-305">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="e7efd-306">Simulare l'utilizzo nei database tenant tramite l'esecuzione di un generatore di carico specificato</span><span class="sxs-lookup"><span data-stu-id="e7efd-306">Simulate usage on the tenant databases by running a provided load generator</span></span>
> * <span data-ttu-id="e7efd-307">Monitorare la risposta dei database tenant a un aumento del carico di lavoro</span><span class="sxs-lookup"><span data-stu-id="e7efd-307">Monitor the tenant databases as they respond to the increase in load</span></span>
> * <span data-ttu-id="e7efd-308">Potenziare il pool elastico in risposta al carico maggiore per i database</span><span class="sxs-lookup"><span data-stu-id="e7efd-308">Scale up the Elastic pool in response to the increased database load</span></span>
> * <span data-ttu-id="e7efd-309">Eseguire il provisioning di un secondo pool elastico per bilanciare il carico delle attività dei database</span><span class="sxs-lookup"><span data-stu-id="e7efd-309">Provision a second Elastic pool to load balance the database activity</span></span>

[<span data-ttu-id="e7efd-310">Esercitazione sul ripristino di un tenant singolo</span><span class="sxs-lookup"><span data-stu-id="e7efd-310">Restore a single tenant tutorial</span></span>](sql-database-saas-tutorial-restore-single-tenant.md)


## <a name="additional-resources"></a><span data-ttu-id="e7efd-311">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="e7efd-311">Additional resources</span></span>

* <span data-ttu-id="e7efd-312">Altre [esercitazioni basate sulla distribuzione dell'applicazione SaaS Wingtip](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="e7efd-312">Additional [tutorials that build upon the Wingtip SaaS application deployment](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="e7efd-313">Pool elastici SQL</span><span class="sxs-lookup"><span data-stu-id="e7efd-313">SQL Elastic pools</span></span>](sql-database-elastic-pool.md)
* [<span data-ttu-id="e7efd-314">Automazione di Azure</span><span class="sxs-lookup"><span data-stu-id="e7efd-314">Azure automation</span></span>](../automation/automation-intro.md)
* <span data-ttu-id="e7efd-315">[Log Analytics](sql-database-saas-tutorial-log-analytics.md) - Esercitazione sulla configurazione e l'uso di Log Analytics</span><span class="sxs-lookup"><span data-stu-id="e7efd-315">[Log Analytics](sql-database-saas-tutorial-log-analytics.md) - Setting up and using Log Analytics tutorial</span></span>
