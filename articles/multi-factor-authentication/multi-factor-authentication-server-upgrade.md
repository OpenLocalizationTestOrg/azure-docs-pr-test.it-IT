---
title: "aggiornamento del Server di autenticazione a più fattori aaaAzure | Documenti Microsoft"
description: "I passaggi e la versione più recente di indicazioni tooupgrade hello del Server Azure multi-Factor Authentication tooa."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 50bb8ac3-5559-4d8b-a96a-799a74978b14
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: aaa8d400e0e5f1c6be3a6d22cde6dd893ef4d546
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="upgrade-toohello-latest-azure-multi-factor-authentication-server"></a><span data-ttu-id="e413e-103">Toohello l'aggiornamento più recente Server Azure multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="e413e-103">Upgrade toohello latest Azure Multi-Factor Authentication Server</span></span>

<span data-ttu-id="e413e-104">Questo articolo illustra hello processo di aggiornamento di versione 6.0 Server Azure multi-Factor Authentication (MFA) o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="e413e-104">This article walks you through hello process of upgrading Azure Multi-Factor Authentication (MFA) Server v6.0 or higher.</span></span> <span data-ttu-id="e413e-105">Se occorre una versione precedente dell'agente PhoneFactor hello tooupgrade, fare riferimento troppo[hello aggiornamento agente PhoneFactor tooAzure Server multi-Factor Authentication](multi-factor-authentication-get-started-server-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="e413e-105">If you need tooupgrade an old version of hello PhoneFactor Agent, refer too[Upgrade hello PhoneFactor Agent tooAzure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server-upgrade.md).</span></span>

<span data-ttu-id="e413e-106">Se si esegue l'aggiornamento da v6. x o toov7.x precedenti o successive, tutti i componenti modificare da too.NET 2.0 di .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="e413e-106">If you're upgrading from v6.x or older toov7.x or newer, all components change from .NET 2.0 too.NET 4.5.</span></span> <span data-ttu-id="e413e-107">Inoltre per tutti i componenti è necessario l'aggiornamento di Microsoft Visual C++ 2015 1 o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="e413e-107">All components also require Microsoft Visual C++ 2015 Redistributable Update 1 or higher.</span></span> <span data-ttu-id="e413e-108">programma di installazione del Server di autenticazione a più fattori Hello installa entrambe le versioni x86 e x64 di hello di questi componenti se non sono già installati.</span><span class="sxs-lookup"><span data-stu-id="e413e-108">hello MFA Server installer installs both hello x86 and x64 versions of these components if they aren't already installed.</span></span> <span data-ttu-id="e413e-109">Se hello portale per gli utenti e servizio Web App Mobile eseguite su server separati, è necessario tooinstall i pacchetti prima di aggiornare tali componenti.</span><span class="sxs-lookup"><span data-stu-id="e413e-109">If hello User Portal and Mobile App Web Service run on separate servers, you need tooinstall those packages before upgrading those components.</span></span> <span data-ttu-id="e413e-110">È possibile cercare aggiornamenti di Microsoft Visual C++ 2015 Redistributable più recenti hello sulla hello [Microsoft Download Center](https://www.microsoft.com/en-us/download/).</span><span class="sxs-lookup"><span data-stu-id="e413e-110">You can search for hello latest Microsoft Visual C++ 2015 Redistributable update on hello [Microsoft Download Center](https://www.microsoft.com/en-us/download/).</span></span> 

## <a name="install-hello-latest-version-of-azure-mfa-server"></a><span data-ttu-id="e413e-111">Installare una versione più recente di hello del Server di autenticazione a più fattori di Azure</span><span class="sxs-lookup"><span data-stu-id="e413e-111">Install hello latest version of Azure MFA Server</span></span>

1. <span data-ttu-id="e413e-112">Utilizzare le istruzioni hello [Download hello del Server Azure multi-Factor Authentication](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) tooget hello più recente di hello Azure MFA Server.</span><span class="sxs-lookup"><span data-stu-id="e413e-112">Use hello instructions in [Download hello Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) tooget hello latest version of hello Azure MFA Server.</span></span>
2. <span data-ttu-id="e413e-113">Eseguire un backup del file di dati di Server di autenticazione a più fattori hello che si trova in c:\Programmi\Microsoft multi-Factor Authentication Server\Data\PhoneFactor.pfdata (percorso di installazione predefinito hello presupponendo) sul Server master autenticazione a più fattori.</span><span class="sxs-lookup"><span data-stu-id="e413e-113">Make a backup of hello MFA Server data file located at C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (assuming hello default install location) on your master MFA Server.</span></span>
3. <span data-ttu-id="e413e-114">Se si eseguono più server per la disponibilità elevata, è possibile modificare i sistemi client hello che eseguono l'autenticazione Server MFA toohello in modo che arrestino l'invio di traffico toohello server che esegue l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="e413e-114">If you run multiple servers for high availability, change hello client systems that authenticate toohello MFA Server so that they stop sending traffic toohello servers that are upgrading.</span></span> <span data-ttu-id="e413e-115">Se si utilizza un bilanciamento del carico, rimuovere un Server di autenticazione a più fattori dal servizio di bilanciamento del carico hello hello aggiornamento e quindi aggiungere il server di hello in farm hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-115">If you use a load balancer, remove a MFA Server from hello load balancer, do hello upgrade, and then add hello server back into hello farm.</span></span>
4. <span data-ttu-id="e413e-116">Eseguire di nuovo programma di installazione hello in ogni Server di autenticazione a più fattori.</span><span class="sxs-lookup"><span data-stu-id="e413e-116">Run hello new installer on each MFA Server.</span></span> <span data-ttu-id="e413e-117">Aggiornare i server subordinati prima perché essi possono leggere hello vecchio file di dati replicati dal master hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-117">Upgrade subordinate servers first because they can read hello old data file being replicated by hello master.</span></span> 

  <span data-ttu-id="e413e-118">Non è necessario toouninstall Server MFA corrente prima dell'installazione guidata di hello in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="e413e-118">You do not need toouninstall your current MFA Server before running hello installer.</span></span> <span data-ttu-id="e413e-119">programma di installazione di Hello esegue un aggiornamento sul posto.</span><span class="sxs-lookup"><span data-stu-id="e413e-119">hello installer performs an in-place upgrade.</span></span> <span data-ttu-id="e413e-120">Hello percorso di installazione viene prelevato dal Registro di sistema di hello dall'installazione precedente di hello, per consentire un'installazione in hello stesso percorso (ad esempio, c:\Programmi\Microsoft multi-Factor Authentication Server).</span><span class="sxs-lookup"><span data-stu-id="e413e-120">hello installation path is picked up from hello registry from hello previous installation, so it installs in hello same location (for example, C:\Program Files\Multi-Factor Authentication Server).</span></span> 
  
5. <span data-ttu-id="e413e-121">Se si tooinstall richiesto Microsoft Visual C++ 2015 update Redistributable package, accettare il messaggio hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-121">If you're prompted tooinstall a Microsoft Visual C++ 2015 Redistributable update package, accept hello prompt.</span></span> <span data-ttu-id="e413e-122">Entrambe le versioni x86 e x64 di hello del pacchetto di hello vengono installate.</span><span class="sxs-lookup"><span data-stu-id="e413e-122">Both hello x86 and x64 versions of hello package are installed.</span></span>
5. <span data-ttu-id="e413e-123">Se si utilizza hello SDK servizio Web, verrà chiesto tooinstall hello nuovo SDK servizi Web.</span><span class="sxs-lookup"><span data-stu-id="e413e-123">If you use hello Web Service SDK, you are prompted tooinstall hello new Web Service SDK.</span></span> <span data-ttu-id="e413e-124">Quando si installa hello nuovo SDK servizi Web, verificare che il nome della directory virtuale hello corrisponde la directory virtuale hello installato in precedenza (ad esempio, MultiFactorAuthWebServiceSdk).</span><span class="sxs-lookup"><span data-stu-id="e413e-124">When you install hello new Web Service SDK, make sure that hello virtual directory name matches hello previously installed virtual directory (for example, MultiFactorAuthWebServiceSdk).</span></span>
6. <span data-ttu-id="e413e-125">Ripetere i passaggi di hello in tutti i server subordinati.</span><span class="sxs-lookup"><span data-stu-id="e413e-125">Repeat hello steps on all subordinate servers.</span></span> <span data-ttu-id="e413e-126">Alzare di livello uno dei hello subalterni toobe hello nuovo master, quindi hello aggiornamento vecchio server master.</span><span class="sxs-lookup"><span data-stu-id="e413e-126">Promote one of hello subordinates toobe hello new master, then upgrade hello old master server.</span></span> 

## <a name="upgrade-hello-user-portal"></a><span data-ttu-id="e413e-127">Aggiornamento hello portale per gli utenti</span><span class="sxs-lookup"><span data-stu-id="e413e-127">Upgrade hello User Portal</span></span>

1. <span data-ttu-id="e413e-128">Eseguire il backup di hello file Web. config nella directory virtuale di hello di hello il percorso di installazione portale per gli utenti (ad esempio C:\inetpub\wwwroot\MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="e413e-128">Make a backup of hello web.config file that is in hello virtual directory of hello User Portal installation location (for example, C:\inetpub\wwwroot\MultiFactorAuth).</span></span> <span data-ttu-id="e413e-129">Se il tema predefinito toohello eventuali modifiche, eseguire il backup della cartella nonché di hello App_Themes\Default.</span><span class="sxs-lookup"><span data-stu-id="e413e-129">If any changes were made toohello default theme, make a backup of hello App_Themes\Default folder as well.</span></span> <span data-ttu-id="e413e-130">È preferibile toocreate una copia della cartella predefinita hello e creare un nuovo tema di tema predefinito di toochange hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-130">It is better toocreate a copy of hello Default folder and create a new theme than toochange hello Default theme.</span></span>
2. <span data-ttu-id="e413e-131">Se viene eseguito il portale per gli utenti hello hello nello stesso server come hello altri componenti Server di autenticazione a più fattori, hello installazione del Server di autenticazione a più fattori richiede tooupdate hello portale per gli utenti.</span><span class="sxs-lookup"><span data-stu-id="e413e-131">If hello User Portal runs on hello same server as hello other MFA Server components, hello MFA Server installation prompts you tooupdate hello User Portal.</span></span> <span data-ttu-id="e413e-132">Accettare il prompt hello e installare l'aggiornamento del portale utente hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-132">Accept hello prompt and install hello User Portal update.</span></span> <span data-ttu-id="e413e-133">Controllare che il nome della directory virtuale hello corrisponde la directory virtuale hello installato in precedenza (ad esempio, MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="e413e-133">Check that hello virtual directory name matches hello previously installed virtual directory (for example, MultiFactorAuth).</span></span>
3. <span data-ttu-id="e413e-134">Se hello portale per gli utenti si trova in un server, copia del file MultiFactorAuthenticationUserPortalSetup64.msi hello da hello installare percorso di uno dei server di autenticazione a più fattori hello e inserirla nel server web del portale utenti hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-134">If hello User Portal is on its own server, copy hello MultiFactorAuthenticationUserPortalSetup64.msi file from hello install location of one of hello MFA Servers and put it onto hello User Portal web server.</span></span> <span data-ttu-id="e413e-135">Eseguire l'installazione guidata di hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-135">Run hello installer.</span></span> 

  <span data-ttu-id="e413e-136">Se si verifica un errore indicante, "Microsoft Visual C++ 2015 Redistributable Update 1 o versione successiva è obbligatorio," scaricare e installare il pacchetto di aggiornamento più recente di hello da hello [Microsoft Download Center](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="e413e-136">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install hello latest update package from hello [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="e413e-137">Installare entrambe le versioni x86 e x64 di hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-137">Install both hello x86 and x64 versions.</span></span>

4. <span data-ttu-id="e413e-138">Dopo l'aggiornamento di hello portale per gli utenti è installato software, confrontare il backup di Web. config hello che nel passaggio 1 con nuovo file Web. config di hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-138">After hello updated User Portal software is installed, compare hello web.config backup you made in step 1 with hello new web.config file.</span></span> <span data-ttu-id="e413e-139">Se è presente alcun attributo di nuovo in Web. config nuovo hello, copiare i file Web. config di backup in hello toooverwrite di directory virtuale hello uno nuovo.</span><span class="sxs-lookup"><span data-stu-id="e413e-139">If no new attributes exist in hello new web.config, copy your backup web.config into hello virtual directory toooverwrite hello new one.</span></span> <span data-ttu-id="e413e-140">Un'altra opzione è toocopy/Incolla hello appSettings valori e hello URL dal file di backup hello in Web. config nuovo hello SDK del servizio Web.</span><span class="sxs-lookup"><span data-stu-id="e413e-140">Another option is toocopy/paste hello appSettings values and hello Web Service SDK URL from hello backup file into hello new web.config.</span></span>

<span data-ttu-id="e413e-141">Se si dispone di hello portale per gli utenti in più server, ripetere l'installazione di hello in tutte.</span><span class="sxs-lookup"><span data-stu-id="e413e-141">If you have hello User Portal on multiple servers, repeat hello installation on all of them.</span></span> 


## <a name="upgrade-hello-mobile-app-web-service"></a><span data-ttu-id="e413e-142">Aggiornamento hello servizio Web App Mobile</span><span class="sxs-lookup"><span data-stu-id="e413e-142">Upgrade hello Mobile App Web Service</span></span>

1. <span data-ttu-id="e413e-143">Eseguire il backup di hello file Web. config nella directory virtuale di hello di hello percorso di installazione di servizio Web App Mobile (ad esempio, C:\inetpub\wwwroot\app o C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span><span class="sxs-lookup"><span data-stu-id="e413e-143">Make a backup of hello web.config file that is in hello virtual directory of hello Mobile App Web Service installation location (for example, C:\inetpub\wwwroot\app or C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span></span>
2. <span data-ttu-id="e413e-144">Copia del file MultiFactorAuthenticationMobileAppWebServiceSetup64.msi hello da hello installare percorso del server di autenticazione a più fattori hello e inserirlo nel server web di registrazione App Mobile hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-144">Copy hello MultiFactorAuthenticationMobileAppWebServiceSetup64.msi file from hello install location of hello MFA Servers and put it onto hello Mobile App registration web server.</span></span>
3. <span data-ttu-id="e413e-145">Eseguire l'installazione guidata di hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-145">Run hello installer.</span></span> 

  <span data-ttu-id="e413e-146">Se si verifica un errore che informa che è richiesto Microsoft Visual C++ 2015 Redistributable Update 1 o versione successiva, scaricare e installare il pacchetto di aggiornamento più recente di hello da hello [Microsoft Download Center](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="e413e-146">If an error occurs stating that Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required, download and install hello latest update package from hello [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="e413e-147">Installare entrambe le versioni x86 e x64 di hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-147">Install both hello x86 and x64 versions.</span></span>

4. <span data-ttu-id="e413e-148">Dopo aver installato il software di servizio Web App Mobile hello aggiornato, confrontare hello. config che è stato eseguito il backup nel passaggio 1 con il nuovo file di Web. config hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-148">After hello updated Mobile App Web Service software installs, compare hello web.config file that was backed up in step 1 with hello new web.config file.</span></span> <span data-ttu-id="e413e-149">Se è presente alcun attributo di nuovo in Web. config nuovo hello, è possibile copiare i file Web. config salvato alla directory virtuale hello e sovrascrivere hello uno nuovo.</span><span class="sxs-lookup"><span data-stu-id="e413e-149">If no new attributes exist in hello new web.config, you can copy your saved web.config back into hello virtual directory and overwrite hello new one.</span></span> <span data-ttu-id="e413e-150">Un'altra opzione è toocopy/Incolla hello appSettings valori e hello URL dal file di backup hello in Web. config nuovo hello SDK del servizio Web.</span><span class="sxs-lookup"><span data-stu-id="e413e-150">Another option is toocopy/paste hello appSettings values and hello Web Service SDK URL from hello backup file into hello new web.config.</span></span>

<span data-ttu-id="e413e-151">Se si dispone di hello servizio Web App Mobile su più server, ripetere l'installazione di hello in tutte.</span><span class="sxs-lookup"><span data-stu-id="e413e-151">If you have hello Mobile App Web Service on multiple servers, repeat hello installation on all of them.</span></span> 

## <a name="upgrade-hello-ad-fs-adapters"></a><span data-ttu-id="e413e-152">Aggiornamento hello AD FS schede</span><span class="sxs-lookup"><span data-stu-id="e413e-152">Upgrade hello AD FS Adapters</span></span>


### <a name="if-mfa-runs-on-different-servers-than-ad-fs"></a><span data-ttu-id="e413e-153">Se MFA viene eseguito su server diversi da AD FS</span><span class="sxs-lookup"><span data-stu-id="e413e-153">If MFA runs on different servers than AD FS</span></span>

<span data-ttu-id="e413e-154">Queste istruzioni sono valide solo se si esegue il server Multi-Factor Authentication indipendentemente dai server AD FS.</span><span class="sxs-lookup"><span data-stu-id="e413e-154">These instructions only apply if you run Multi-Factor Authentication Server separately from your AD FS servers.</span></span> <span data-ttu-id="e413e-155">Se entrambi i servizi eseguiti hello stessi server, ignorare questa sezione e passare toohello passaggi di installazione.</span><span class="sxs-lookup"><span data-stu-id="e413e-155">If both services run on hello same servers, skip this section and go toohello installation steps.</span></span> 

1. <span data-ttu-id="e413e-156">Salvare una copia del file Multifactorauthenticationadfsadapter config hello che è stata registrata in AD FS o esportare la configurazione di hello utilizzando il comando PowerShell seguente hello: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path tooconfig file]`.</span><span class="sxs-lookup"><span data-stu-id="e413e-156">Save a copy of hello MultiFactorAuthenticationAdfsAdapter.config file that was registered in AD FS, or export hello configuration using hello following PowerShell command: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path tooconfig file]`.</span></span> <span data-ttu-id="e413e-157">nome dell'adapter Hello è "WindowsAzureMultiFactorAuthentication" o "AzureMfaServerAuthentication" a seconda della versione di hello installata in precedenza.</span><span class="sxs-lookup"><span data-stu-id="e413e-157">hello adapter name is either "WindowsAzureMultiFactorAuthentication" or "AzureMfaServerAuthentication" depending on hello version previously installed.</span></span>
2. <span data-ttu-id="e413e-158">Copiare i seguenti file da server di hello Server MFA installazione percorso toohello AD FS hello:</span><span class="sxs-lookup"><span data-stu-id="e413e-158">Copy hello following files from hello MFA Server installation location toohello AD FS servers:</span></span>

  - <span data-ttu-id="e413e-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="e413e-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
  - <span data-ttu-id="e413e-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="e413e-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="e413e-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="e413e-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="e413e-162">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="e413e-162">MultiFactorAuthenticationAdfsAdapter.config</span></span>

3. <span data-ttu-id="e413e-163">Modifica di script hello Register-multifactorauthenticationadfsadapter.ps1 aggiungendo `-ConfigurationFilePath [path]` toohello fine hello `Register-AdfsAuthenticationProvider` comando.</span><span class="sxs-lookup"><span data-stu-id="e413e-163">Edit hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding `-ConfigurationFilePath [path]` toohello end of hello `Register-AdfsAuthenticationProvider` command.</span></span> <span data-ttu-id="e413e-164">Sostituire *[percorso]* con percorso completo di hello toohello multifactorauthenticationadfsadapter. config file o file di configurazione hello esportati nel passaggio precedente hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-164">Replace *[path]* with hello full path toohello MultiFactorAuthenticationAdfsAdapter.config file or hello configuration file exported in hello previous step.</span></span> 

  <span data-ttu-id="e413e-165">Verificare gli attributi di hello in hello nuovo Multifactorauthenticationadfsadapter toosee se corrispondono ai file di configurazione precedente hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-165">Check hello attributes in hello new MultiFactorAuthenticationAdfsAdapter.config toosee if they match hello old config file.</span></span> <span data-ttu-id="e413e-166">Se tutti gli attributi sono stati aggiunti o rimossi in una nuova versione di hello, copiare i valori di attributo hello da hello precedente configurazione file toohello uno nuovo o modificare hello precedente toomatch file di configurazione.</span><span class="sxs-lookup"><span data-stu-id="e413e-166">If any attributes were added or removed in hello new version, copy hello attribute values from hello old configuration file toohello new one or modify hello old configuration file toomatch.</span></span>

### <a name="install-new-ad-fs-adapters"></a><span data-ttu-id="e413e-167">Installare le nuove schede AD FS</span><span class="sxs-lookup"><span data-stu-id="e413e-167">Install new AD FS adapters</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="e413e-168">Gli utenti non saranno tooperform richiesto in due passaggi di verifica durante i passaggi 3-8 di questa sezione.</span><span class="sxs-lookup"><span data-stu-id="e413e-168">Your users will not be required tooperform two-step verification during steps 3-8 of this section.</span></span> <span data-ttu-id="e413e-169">Se si dispone di AD FS configurato in più cluster, è possibile rimuovere, aggiornamento e ripristino della farm in modo indipendente da ogni cluster in hello hello i tempi di inattività tooavoid altri cluster.</span><span class="sxs-lookup"><span data-stu-id="e413e-169">If you have AD FS configured in multiple clusters, you can remove, upgrade, and restore each cluster in hello farm independently of hello other clusters tooavoid downtime.</span></span>

1. <span data-ttu-id="e413e-170">Rimuovere alcuni server AD FS dalla farm di hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-170">Remove some AD FS servers from hello farm.</span></span> <span data-ttu-id="e413e-171">Aggiornare questi server durante hello che ad altri utenti sono ancora in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="e413e-171">Update these servers while hello others are still running.</span></span>
2. <span data-ttu-id="e413e-172">Installare la nuova scheda ADFS di hello in ogni server rimosso dalla farm di hello AD FS.</span><span class="sxs-lookup"><span data-stu-id="e413e-172">Install hello new AD FS adapter on each server removed from hello AD FS farm.</span></span> <span data-ttu-id="e413e-173">Se hello MFA Server è installato in ogni server ADFS, è possibile aggiornare tramite il Server di autenticazione a più fattori salve UX.</span><span class="sxs-lookup"><span data-stu-id="e413e-173">If hello MFA Server is installed on each AD FS server, you can update through hello MFA Server admin UX.</span></span> <span data-ttu-id="e413e-174">Altrimenti fare l'aggiornamento eseguendo MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span><span class="sxs-lookup"><span data-stu-id="e413e-174">Otherwise, update by running MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span></span> 

  <span data-ttu-id="e413e-175">Se si verifica un errore indicante, "Microsoft Visual C++ 2015 Redistributable Update 1 o versione successiva è obbligatorio," scaricare e installare il pacchetto di aggiornamento più recente di hello da hello [Microsoft Download Center](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="e413e-175">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install hello latest update package from hello [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="e413e-176">Installare entrambe le versioni x86 e x64 di hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-176">Install both hello x86 and x64 versions.</span></span>

3. <span data-ttu-id="e413e-177">Andare troppo**ADFS** > **criteri di autenticazione** > **Modifica criteri di autenticazione a più fattori globale**.</span><span class="sxs-lookup"><span data-stu-id="e413e-177">Go too**AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="e413e-178">Deselezionare **WindowsAzureMultiFactorAuthentication** o **AzureMFAServerAuthentication** (a seconda della versione di hello attualmente installata).</span><span class="sxs-lookup"><span data-stu-id="e413e-178">Uncheck **WindowsAzureMultiFactorAuthentication** or **AzureMFAServerAuthentication** (depending on hello current version installed).</span></span> 

  <span data-ttu-id="e413e-179">Dopo avere completato questo passaggio, la verifica in due passaggi tramite il server MFA non sarà disponibile in questo cluster AD FS fino al completamento del passaggio 8.</span><span class="sxs-lookup"><span data-stu-id="e413e-179">Once this step is complete, two-step verification through MFA Server is not available in this AD FS cluster until you complete step 8.</span></span>

4. <span data-ttu-id="e413e-180">Versione meno recente hello di annullare la registrazione della scheda ADFS hello Active Directory eseguendo uno script di PowerShell di Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-180">Unregister hello older version of hello AD FS adapter by running hello Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="e413e-181">Verificare che hello *-nome* parametro ("WindowsAzureMultiFactorAuthentication" o "AzureMFAServerAuthentication") corrisponde a nome hello che è stato visualizzato nel passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="e413e-181">Ensure that hello *-Name* parameter (either “WindowsAzureMultiFactorAuthentication” or "AzureMFAServerAuthentication") matches hello name that was displayed in step 3.</span></span> <span data-ttu-id="e413e-182">Poiché è presente una configurazione centrale, si applica tooall server nel cluster di hello stesso AD FS.</span><span class="sxs-lookup"><span data-stu-id="e413e-182">This applies tooall servers in hello same AD FS cluster since there is a central configuration.</span></span>
5. <span data-ttu-id="e413e-183">Registrare la nuova scheda ADFS di hello eseguendo uno script di PowerShell Register-multifactorauthenticationadfsadapter.ps1 hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-183">Register hello new AD FS adapter by running hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="e413e-184">Poiché è presente una configurazione centrale, si applica tooall server nel cluster di hello stesso AD FS.</span><span class="sxs-lookup"><span data-stu-id="e413e-184">This applies tooall servers in hello same AD FS cluster since there is a central configuration.</span></span>
6. <span data-ttu-id="e413e-185">Hello riavvio del servizio AD FS in ogni server rimosso dal hello farm AD FS.</span><span class="sxs-lookup"><span data-stu-id="e413e-185">Restart hello AD FS service on each server removed from hello AD FS farm.</span></span>
7. <span data-ttu-id="e413e-186">Aggiungere server hello aggiornato eseguire il backup di farm di toohello AD FS e Rimuovi hello altri server dalla farm hello.</span><span class="sxs-lookup"><span data-stu-id="e413e-186">Add hello updated servers back toohello AD FS farm and remove hello other servers from hello farm.</span></span>
8. <span data-ttu-id="e413e-187">Andare troppo**ADFS** > **criteri di autenticazione** > **Modifica criteri di autenticazione a più fattori globale**.</span><span class="sxs-lookup"><span data-stu-id="e413e-187">Go too**AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="e413e-188">Controllare **AzureMfaServerAuthentication**.</span><span class="sxs-lookup"><span data-stu-id="e413e-188">Check **AzureMfaServerAuthentication**.</span></span>
9. <span data-ttu-id="e413e-189">Ripetere il passaggio 2 tooupdate: server hello rimosso dalla farm di hello AD FS e riavviare il servizio ADFS hello AD in tali server.</span><span class="sxs-lookup"><span data-stu-id="e413e-189">Repeat step 2 tooupdate hello servers now removed from hello AD FS farm and restart hello AD FS service on those servers.</span></span>
10. <span data-ttu-id="e413e-190">Aggiungere i server alla farm hello AD FS.</span><span class="sxs-lookup"><span data-stu-id="e413e-190">Add those servers back into hello AD FS farm.</span></span>

## <a name="next-steps"></a><span data-ttu-id="e413e-191">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="e413e-191">Next steps</span></span>

- <span data-ttu-id="e413e-192">Consultare gli esempi di [Scenari avanzati con Azure Multi-Factor Authentication e VPN di terze parti](multi-factor-authentication-advanced-vpn-configurations.md)</span><span class="sxs-lookup"><span data-stu-id="e413e-192">Get examples of [Advanced scenarios with Azure Multi-Factor Authentication and third-party VPNs](multi-factor-authentication-advanced-vpn-configurations.md)</span></span>

- [<span data-ttu-id="e413e-193">Sincronizzazione del server MFA con Windows Server Active Directory</span><span class="sxs-lookup"><span data-stu-id="e413e-193">Synchronize MFA Server with Windows Server Active Directory</span></span>](multi-factor-authentication-get-started-server-dirint.md)

- <span data-ttu-id="e413e-194">[Configurare l'autenticazione di Windows](multi-factor-authentication-get-started-server-windows.md) per le applicazioni</span><span class="sxs-lookup"><span data-stu-id="e413e-194">[Configure Windows Authentication](multi-factor-authentication-get-started-server-windows.md) for your applications</span></span>
