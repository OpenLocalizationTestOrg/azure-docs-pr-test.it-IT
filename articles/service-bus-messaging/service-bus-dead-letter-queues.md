---
title: Code dei messaggi non recapitabili del bus di servizio | Documentazione Microsoft
description: Panoramica delle code dei messaggi non recapitabili del bus di servizio Azure
services: service-bus-messaging
documentationcenter: .net
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 68b2aa38-dba7-491a-9c26-0289bc15d397
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/17/2017
ms.author: clemensv;sethm
ms.openlocfilehash: c16bcf30ab96f79e59404a41852e4cd227e28b08
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="overview-of-service-bus-dead-letter-queues"></a><span data-ttu-id="a5c58-103">Panoramica delle code dei messaggi non recapitabili del bus di servizio</span><span class="sxs-lookup"><span data-stu-id="a5c58-103">Overview of Service Bus dead-letter queues</span></span>

<span data-ttu-id="a5c58-104">Le code del bus di servizio e le sottoscrizioni dell'argomento includono una coda secondaria chiamata *coda di messaggi non recapitabili* (DLQ, Dead-Letter Queue).</span><span class="sxs-lookup"><span data-stu-id="a5c58-104">Service Bus queues and topic subscriptions provide a secondary sub-queue, called a *dead-letter queue* (DLQ).</span></span> <span data-ttu-id="a5c58-105">Non è necessario creare in modo esplicito la coda dei messaggi non recapitabili, che, tra l'altro, non può essere eliminata né altrimenti gestita indipendentemente dall'entità principale.</span><span class="sxs-lookup"><span data-stu-id="a5c58-105">The dead-letter queue does not need to be explicitly created and cannot be deleted or otherwise managed independent of the main entity.</span></span>

<span data-ttu-id="a5c58-106">Questo articolo descrive le code dei messaggi non recapitabili nel bus di servizio di Azure.</span><span class="sxs-lookup"><span data-stu-id="a5c58-106">This article discusses dead-letter queues in Azure Service Bus.</span></span> <span data-ttu-id="a5c58-107">L'[esempio relativo alle code di messaggi non recapitabili](https://github.com/Azure/azure-service-bus/tree/master/samples/DotNet/Microsoft.ServiceBus.Messaging/DeadletterQueue) su GitHub descrive in dettaglio questo aspetto.</span><span class="sxs-lookup"><span data-stu-id="a5c58-107">Much of the discussion is illustrated by the [Dead-Letter Queues sample](https://github.com/Azure/azure-service-bus/tree/master/samples/DotNet/Microsoft.ServiceBus.Messaging/DeadletterQueue) on GitHub.</span></span>
 
## <a name="the-dead-letter-queue"></a><span data-ttu-id="a5c58-108">Coda di messaggi non recapitabili</span><span class="sxs-lookup"><span data-stu-id="a5c58-108">The dead-letter queue</span></span>

<span data-ttu-id="a5c58-109">Lo scopo della coda dei messaggi non recapitabili è conservare i messaggi che non possono essere recapitati ai ricevitori o che non possono essere elaborati.</span><span class="sxs-lookup"><span data-stu-id="a5c58-109">The purpose of the dead-letter queue is to hold messages that cannot be delivered to any receiver, or messages that could not be processed.</span></span> <span data-ttu-id="a5c58-110">I messaggi possono essere rimossi dalla coda e verificati.</span><span class="sxs-lookup"><span data-stu-id="a5c58-110">Messages can then be removed from the DLQ and inspected.</span></span> <span data-ttu-id="a5c58-111">Con l'aiuto di un operatore, un'applicazione potrebbe correggere i problemi e inviare nuovamente il messaggio, registrare la notizia che si è verificato un errore e intraprendere azioni correttive.</span><span class="sxs-lookup"><span data-stu-id="a5c58-111">An application might, with help of an operator, correct issues and resubmit the message, log the fact that there was an error, and take corrective action.</span></span> 

<span data-ttu-id="a5c58-112">Dal punto di vista di API e protocolli, la coda DLQ è molto simile a qualsiasi altra coda, ad eccezione del fatto che i messaggi possono essere inviati ad essa solo tramite il movimento messaggi non recapitabili dell'entità padre.</span><span class="sxs-lookup"><span data-stu-id="a5c58-112">From an API and protocol perspective, the DLQ is mostly similar to any other queue, except that messages can only be submitted via the dead-letter gesture of the parent entity.</span></span> <span data-ttu-id="a5c58-113">Inoltre, il parametro time-to-live non viene rispettato e non è possibile impostare come non recapitabile un messaggio di una coda DLQ.</span><span class="sxs-lookup"><span data-stu-id="a5c58-113">In addition, time-to-live is not observed, and you can't dead-letter a message from a DLQ.</span></span> <span data-ttu-id="a5c58-114">La coda dei messaggi non recapitabili supporta completamente il recapito con blocco di visualizzazione e le operazioni transazionali.</span><span class="sxs-lookup"><span data-stu-id="a5c58-114">The dead-letter queue fully supports peek-lock delivery and transactional operations.</span></span>

<span data-ttu-id="a5c58-115">Si noti che non è prevista alcuna pulizia automatica della coda.</span><span class="sxs-lookup"><span data-stu-id="a5c58-115">Note that there is no automatic cleanup of the DLQ.</span></span> <span data-ttu-id="a5c58-116">I messaggi rimangono nella coda fino a quando non vengono esplicitamente recuperati e non si chiama il metodo [Complete()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_CompleteAsync) sul messaggio non recapitabile.</span><span class="sxs-lookup"><span data-stu-id="a5c58-116">Messages remain in the DLQ until you explicitly retrieve them from the DLQ and call [Complete()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_CompleteAsync) on the dead-letter message.</span></span>

## <a name="moving-messages-to-the-dlq"></a><span data-ttu-id="a5c58-117">Spostare messaggi nella coda DLQ</span><span class="sxs-lookup"><span data-stu-id="a5c58-117">Moving messages to the DLQ</span></span>

<span data-ttu-id="a5c58-118">Nel bus di servizio sono presenti diverse attività che comportano l'inserimento di messaggi nella coda DLQ dall'interno del motore di messaggistica stesso.</span><span class="sxs-lookup"><span data-stu-id="a5c58-118">There are several activities in Service Bus that cause messages to get pushed to the DLQ from within the messaging engine itself.</span></span> <span data-ttu-id="a5c58-119">Un'applicazione può anche spostare in modo esplicito i messaggi nella coda dei messaggi non recapitabili.</span><span class="sxs-lookup"><span data-stu-id="a5c58-119">An application can also explicitly move messages to the DLQ.</span></span> 

<span data-ttu-id="a5c58-120">Quando un messaggio viene spostato dal broker, vengono aggiunte al messaggio due proprietà, `DeadLetterReason` e `DeadLetterErrorDescription`, nel momento in cui il broker chiama la sua versione interna del metodo [DeadLetter](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_DeadLetter_System_String_System_String_) sul messaggio.</span><span class="sxs-lookup"><span data-stu-id="a5c58-120">As the message gets moved by the broker, two properties are added to the message as the broker calls its internal version of the [DeadLetter](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_DeadLetter_System_String_System_String_) method on the message: `DeadLetterReason` and `DeadLetterErrorDescription`.</span></span>

<span data-ttu-id="a5c58-121">Le applicazioni possono definire i propri codici per la proprietà `DeadLetterReason`, ma il sistema imposta i valori seguenti.</span><span class="sxs-lookup"><span data-stu-id="a5c58-121">Applications can define their own codes for the `DeadLetterReason` property, but the system sets the following values.</span></span>

| <span data-ttu-id="a5c58-122">Condizione</span><span class="sxs-lookup"><span data-stu-id="a5c58-122">Condition</span></span> | <span data-ttu-id="a5c58-123">DeadLetterReason</span><span class="sxs-lookup"><span data-stu-id="a5c58-123">DeadLetterReason</span></span> | <span data-ttu-id="a5c58-124">DeadLetterErrorDescription</span><span class="sxs-lookup"><span data-stu-id="a5c58-124">DeadLetterErrorDescription</span></span> |
| --- | --- | --- |
| <span data-ttu-id="a5c58-125">Sempre</span><span class="sxs-lookup"><span data-stu-id="a5c58-125">Always</span></span> |<span data-ttu-id="a5c58-126">HeaderSizeExceeded</span><span class="sxs-lookup"><span data-stu-id="a5c58-126">HeaderSizeExceeded</span></span> |<span data-ttu-id="a5c58-127">È stata superata la dimensione del flusso.</span><span class="sxs-lookup"><span data-stu-id="a5c58-127">The size quota for this stream has been exceeded.</span></span> |
| <span data-ttu-id="a5c58-128">!TopicDescription.</span><span class="sxs-lookup"><span data-stu-id="a5c58-128">!TopicDescription.</span></span><br /><span data-ttu-id="a5c58-129">EnableFilteringMessagesBeforePublishing e SubscriptionDescription.</span><span class="sxs-lookup"><span data-stu-id="a5c58-129">EnableFilteringMessagesBeforePublishing and SubscriptionDescription.</span></span><br /><span data-ttu-id="a5c58-130">EnableDeadLetteringOnFilterEvaluationExceptions</span><span class="sxs-lookup"><span data-stu-id="a5c58-130">EnableDeadLetteringOnFilterEvaluationExceptions</span></span> |<span data-ttu-id="a5c58-131">exception.GetType().Name</span><span class="sxs-lookup"><span data-stu-id="a5c58-131">exception.GetType().Name</span></span> |<span data-ttu-id="a5c58-132">exception.Message</span><span class="sxs-lookup"><span data-stu-id="a5c58-132">exception.Message</span></span> |
| <span data-ttu-id="a5c58-133">EnableDeadLetteringOnMessageExpiration</span><span class="sxs-lookup"><span data-stu-id="a5c58-133">EnableDeadLetteringOnMessageExpiration</span></span> |<span data-ttu-id="a5c58-134">TTLExpiredException</span><span class="sxs-lookup"><span data-stu-id="a5c58-134">TTLExpiredException</span></span> |<span data-ttu-id="a5c58-135">Il messaggio è scaduto ed è stato configurato come non recapitabile.</span><span class="sxs-lookup"><span data-stu-id="a5c58-135">The message expired and was dead lettered.</span></span> |
| <span data-ttu-id="a5c58-136">SubscriptionDescription.RequiresSession</span><span class="sxs-lookup"><span data-stu-id="a5c58-136">SubscriptionDescription.RequiresSession</span></span> |<span data-ttu-id="a5c58-137">L'ID sessione ha valore null.</span><span class="sxs-lookup"><span data-stu-id="a5c58-137">Session id is null.</span></span> |<span data-ttu-id="a5c58-138">L'entità attivata dalla sessione non consente il recapito di un messaggio il cui identificatore di sessione è null.</span><span class="sxs-lookup"><span data-stu-id="a5c58-138">Session enabled entity doesn't allow a message whose session identifier is null.</span></span> |
| <span data-ttu-id="a5c58-139">!dead letter queue</span><span class="sxs-lookup"><span data-stu-id="a5c58-139">!dead letter queue</span></span> |<span data-ttu-id="a5c58-140">MaxTransferHopCountExceeded</span><span class="sxs-lookup"><span data-stu-id="a5c58-140">MaxTransferHopCountExceeded</span></span> |<span data-ttu-id="a5c58-141">Null</span><span class="sxs-lookup"><span data-stu-id="a5c58-141">Null</span></span> |
| <span data-ttu-id="a5c58-142">Configurazione esplicita di messaggio non recapitabile da parte dell'applicazione </span><span class="sxs-lookup"><span data-stu-id="a5c58-142">Application explicit dead lettering</span></span> |<span data-ttu-id="a5c58-143">Specificato dall'applicazione</span><span class="sxs-lookup"><span data-stu-id="a5c58-143">Specified by application</span></span> |<span data-ttu-id="a5c58-144">Specificato dall'applicazione</span><span class="sxs-lookup"><span data-stu-id="a5c58-144">Specified by application</span></span> |

## <a name="exceeding-maxdeliverycount"></a><span data-ttu-id="a5c58-145">Superamento di MaxDeliveryCount</span><span class="sxs-lookup"><span data-stu-id="a5c58-145">Exceeding MaxDeliveryCount</span></span>
<span data-ttu-id="a5c58-146">Le code e le sottoscrizioni hanno ognuna una proprietà [QueueDescription.MaxDeliveryCount](/dotnet/api/microsoft.servicebus.messaging.queuedescription#Microsoft_ServiceBus_Messaging_QueueDescription_MaxDeliveryCount) e [SubscriptionDescription.MaxDeliveryCount](/dotnet/api/microsoft.servicebus.messaging.subscriptiondescription#Microsoft_ServiceBus_Messaging_SubscriptionDescription_MaxDeliveryCount). Il valore predefinito è 10.</span><span class="sxs-lookup"><span data-stu-id="a5c58-146">Queues and subscriptions each have a [QueueDescription.MaxDeliveryCount](/dotnet/api/microsoft.servicebus.messaging.queuedescription#Microsoft_ServiceBus_Messaging_QueueDescription_MaxDeliveryCount) and [SubscriptionDescription.MaxDeliveryCount](/dotnet/api/microsoft.servicebus.messaging.subscriptiondescription#Microsoft_ServiceBus_Messaging_SubscriptionDescription_MaxDeliveryCount) property respectively; the default value is 10.</span></span> <span data-ttu-id="a5c58-147">Ogni volta che un messaggio viene recapitato in un blocco ([ReceiveMode.PeekLock](/dotnet/api/microsoft.servicebus.messaging.receivemode)) ma viene abbandonato in modo esplicito oppure il blocco è scaduto, il valore [BrokeredMessage.DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_DeliveryCount) del messaggio viene incrementato.</span><span class="sxs-lookup"><span data-stu-id="a5c58-147">Whenever a message has been delivered under a lock ([ReceiveMode.PeekLock](/dotnet/api/microsoft.servicebus.messaging.receivemode)), but has been either explicitly abandoned or the lock has expired, the message's [BrokeredMessage.DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_DeliveryCount) is incremented.</span></span> <span data-ttu-id="a5c58-148">Quando il valore [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_DeliveryCount) supera [MaxDeliveryCount](/dotnet/api/microsoft.servicebus.messaging.queuedescription#Microsoft_ServiceBus_Messaging_QueueDescription_MaxDeliveryCount), il messaggio viene spostato nella coda DLQ con il codice motivo `MaxDeliveryCountExceeded`.</span><span class="sxs-lookup"><span data-stu-id="a5c58-148">When [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_DeliveryCount) exceeds [MaxDeliveryCount](/dotnet/api/microsoft.servicebus.messaging.queuedescription#Microsoft_ServiceBus_Messaging_QueueDescription_MaxDeliveryCount), the message is moved to the DLQ, specifying the `MaxDeliveryCountExceeded` reason code.</span></span>

<span data-ttu-id="a5c58-149">Non è possibile disattivare questo comportamento, ma è possibile impostare [MaxDeliveryCount](/dotnet/api/microsoft.servicebus.messaging.queuedescription#Microsoft_ServiceBus_Messaging_QueueDescription_MaxDeliveryCount) su un numero molto elevato.</span><span class="sxs-lookup"><span data-stu-id="a5c58-149">This behavior cannot be disabled, but you can set [MaxDeliveryCount](/dotnet/api/microsoft.servicebus.messaging.queuedescription#Microsoft_ServiceBus_Messaging_QueueDescription_MaxDeliveryCount) to a very large number.</span></span>

## <a name="exceeding-timetolive"></a><span data-ttu-id="a5c58-150">Superamento di TimeToLive</span><span class="sxs-lookup"><span data-stu-id="a5c58-150">Exceeding TimeToLive</span></span>
<span data-ttu-id="a5c58-151">Quando la proprietà [QueueDescription.EnableDeadLetteringOnMessageExpiration](/dotnet/api/microsoft.servicebus.messaging.queuedescription#Microsoft_ServiceBus_Messaging_QueueDescription_EnableDeadLetteringOnMessageExpiration) o [SubscriptionDescription.EnableDeadLetteringOnMessageExpiration](/dotnet/api/microsoft.servicebus.messaging.subscriptiondescription#Microsoft_ServiceBus_Messaging_SubscriptionDescription_EnableDeadLetteringOnMessageExpiration) viene impostata su **true** (il valore predefinito è **false**), tutti i messaggi in scadenza vengono spostati nella coda DLQ con il codice motivo `TTLExpiredException`.</span><span class="sxs-lookup"><span data-stu-id="a5c58-151">When the [QueueDescription.EnableDeadLetteringOnMessageExpiration](/dotnet/api/microsoft.servicebus.messaging.queuedescription#Microsoft_ServiceBus_Messaging_QueueDescription_EnableDeadLetteringOnMessageExpiration) or [SubscriptionDescription.EnableDeadLetteringOnMessageExpiration](/dotnet/api/microsoft.servicebus.messaging.subscriptiondescription#Microsoft_ServiceBus_Messaging_SubscriptionDescription_EnableDeadLetteringOnMessageExpiration) property is set to **true** (the default is **false**), all expiring messages are moved to the DLQ, specifying the  `TTLExpiredException` reason code.</span></span>

<span data-ttu-id="a5c58-152">Si noti che i messaggi scaduti vengono ripuliti e quindi spostati nella coda di messaggi non recapitabili solo quando esiste almeno un ricevitore attivo che effettua il pull della sottoscrizione o della coda principale. Tale comportamento è predefinito.</span><span class="sxs-lookup"><span data-stu-id="a5c58-152">Note that expired messages are only purged and therefore moved to the DLQ when there is at least one active receiver pulling on the main queue or subscription; that behavior is by design.</span></span>

## <a name="errors-while-processing-subscription-rules"></a><span data-ttu-id="a5c58-153">Errori durante l'elaborazione di regole di sottoscrizione</span><span class="sxs-lookup"><span data-stu-id="a5c58-153">Errors while processing subscription rules</span></span>
<span data-ttu-id="a5c58-154">Quando la proprietà [SubscriptionDescription.EnableDeadLetteringOnFilterEvaluationExceptions](/dotnet/api/microsoft.servicebus.messaging.subscriptiondescription#Microsoft_ServiceBus_Messaging_SubscriptionDescription_EnableDeadLetteringOnFilterEvaluationExceptions) di una sottoscrizione è abilitata, qualsiasi errore si verifichi durante l'esecuzione di una regola di filtro SQL di una sottoscrizione viene acquisito nella coda DLQ con il messaggio che indica l'errore.</span><span class="sxs-lookup"><span data-stu-id="a5c58-154">When the [SubscriptionDescription.EnableDeadLetteringOnFilterEvaluationExceptions](/dotnet/api/microsoft.servicebus.messaging.subscriptiondescription#Microsoft_ServiceBus_Messaging_SubscriptionDescription_EnableDeadLetteringOnFilterEvaluationExceptions) property is enabled for a subscription, any errors that occur while a subscription's SQL filter rule executes are captured in the DLQ along with the offending message.</span></span>

## <a name="application-level-dead-lettering"></a><span data-ttu-id="a5c58-155">Definizione di messaggi non recapitabili a livello di applicazione</span><span class="sxs-lookup"><span data-stu-id="a5c58-155">Application-level dead-lettering</span></span>
<span data-ttu-id="a5c58-156">Oltre alle funzionalità di definizione dei messaggi non recapitabili del sistema, le applicazioni possono usare la coda DLQ per rifiutare esplicitamente i messaggi inaccettabili.</span><span class="sxs-lookup"><span data-stu-id="a5c58-156">In addition to the system-provided dead-lettering features, applications can use the DLQ to explicitly reject unacceptable messages.</span></span> <span data-ttu-id="a5c58-157">Ciò può riguardare i messaggi che non possono essere elaborati correttamente a causa diversi problemi del sistema, i messaggi contenenti payload in formato non valido o che non superino il processo di autenticazione quando viene utilizzato un schema di sicurezza a livello di messaggio.</span><span class="sxs-lookup"><span data-stu-id="a5c58-157">This may include messages that cannot be properly processed due to any sort of system issue, messages that hold malformed payloads, or messages that fail authentication when some message-level security scheme is used.</span></span>

## <a name="dead-lettering-in-forwardto-or-sendvia-scenarios"></a><span data-ttu-id="a5c58-158">Messaggi non recapitabili negli scenari ForwardTo o SendVia</span><span class="sxs-lookup"><span data-stu-id="a5c58-158">Dead-lettering in ForwardTo or SendVia scenarios</span></span>

<span data-ttu-id="a5c58-159">I messaggi verranno inviati nella coda dei messaggi non recapitabili di trasferimento nelle condizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="a5c58-159">Messages will be sent to the transfer dead-letter queue under the following conditions:</span></span>

- <span data-ttu-id="a5c58-160">Un messaggio passa attraverso più di 3 code o argomenti che sono [concatenati](service-bus-auto-forwarding.md).</span><span class="sxs-lookup"><span data-stu-id="a5c58-160">A message passes through more than 3 queues or topics that are [chained together](service-bus-auto-forwarding.md).</span></span>
- <span data-ttu-id="a5c58-161">L'argomento o la coda di destinazione è disattivato o eliminato.</span><span class="sxs-lookup"><span data-stu-id="a5c58-161">The destination queue or topic is disabled or deleted.</span></span>
- <span data-ttu-id="a5c58-162">L'argomento o la coda di destinazione supera le dimensioni massime dell'entità.</span><span class="sxs-lookup"><span data-stu-id="a5c58-162">The destination queue or topic exceeds the maximum entity size.</span></span>

<span data-ttu-id="a5c58-163">Per recuperare questi messaggi non recapitabili, è possibile creare un destinatario usando il metodo di utilità [FormatTransferDeadletterPath](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_FormatTransferDeadLetterPath_System_String_).</span><span class="sxs-lookup"><span data-stu-id="a5c58-163">To retrieve these dead-lettered messages, you can create a receiver using the [FormatTransferDeadletterPath](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_FormatTransferDeadLetterPath_System_String_) utility method.</span></span>

## <a name="example"></a><span data-ttu-id="a5c58-164">Esempio</span><span class="sxs-lookup"><span data-stu-id="a5c58-164">Example</span></span>
<span data-ttu-id="a5c58-165">Il frammento di codice seguente crea un ricevitore del messaggio.</span><span class="sxs-lookup"><span data-stu-id="a5c58-165">The following code snippet creates a message receiver.</span></span> <span data-ttu-id="a5c58-166">Nel ciclo di ricezione della coda principale, il codice recupera il messaggio con [Receive(TimeSpan.Zero)](/dotnet/api/microsoft.servicebus.messaging.messagereceiver#Microsoft_ServiceBus_Messaging_MessageReceiver_Receive_System_TimeSpan_), che richiede al broker di restituire immediatamente i messaggi disponibili o di restituire nessun risultato.</span><span class="sxs-lookup"><span data-stu-id="a5c58-166">In the receive loop for the main queue, the code retrieves the message with [Receive(TimeSpan.Zero)](/dotnet/api/microsoft.servicebus.messaging.messagereceiver#Microsoft_ServiceBus_Messaging_MessageReceiver_Receive_System_TimeSpan_), which asks the broker to instantly return any message readily available, or to return with no result.</span></span> <span data-ttu-id="a5c58-167">Se riceve un messaggio, il codice lo abbandona immediatamente, incrementando `DeliveryCount`.</span><span class="sxs-lookup"><span data-stu-id="a5c58-167">If the code receives a message, it immediately abandons it, which increments the  `DeliveryCount`.</span></span> <span data-ttu-id="a5c58-168">Dopo che il sistema ha spostato il messaggio alla coda DLQ, la coda principale rimane vuota e il ciclo viene interrotto, perché [ReceiveAsync](/dotnet/api/microsoft.servicebus.messaging.messagereceiver#Microsoft_ServiceBus_Messaging_MessageReceiver_ReceiveAsync_System_TimeSpan_) restituisce **null**.</span><span class="sxs-lookup"><span data-stu-id="a5c58-168">Once the system moves the message to the DLQ, the main queue is empty and the loop exits, as [ReceiveAsync](/dotnet/api/microsoft.servicebus.messaging.messagereceiver#Microsoft_ServiceBus_Messaging_MessageReceiver_ReceiveAsync_System_TimeSpan_) returns **null**.</span></span>

```csharp
var receiver = await receiverFactory.CreateMessageReceiverAsync(queueName, ReceiveMode.PeekLock);
while(true)
{
    var msg = await receiver.ReceiveAsync(TimeSpan.Zero);
    if (msg != null)
    {
        Console.WriteLine("Picked up message; DeliveryCount {0}", msg.DeliveryCount);
        await msg.AbandonAsync();
    }
    else
    {
        break;
    }
}
```

## <a name="next-steps"></a><span data-ttu-id="a5c58-169">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="a5c58-169">Next steps</span></span>
<span data-ttu-id="a5c58-170">Per altre informazioni sulle code del bus di servizio, vedere gli articoli seguenti:</span><span class="sxs-lookup"><span data-stu-id="a5c58-170">See the following articles for more information about Service Bus queues:</span></span>

* [<span data-ttu-id="a5c58-171">Introduzione alle code del bus di servizio</span><span class="sxs-lookup"><span data-stu-id="a5c58-171">Get started with Service Bus queues</span></span>](service-bus-dotnet-get-started-with-queues.md)
* [<span data-ttu-id="a5c58-172">Analogie e differenze tra le code di Azure e le code del bus di servizio</span><span class="sxs-lookup"><span data-stu-id="a5c58-172">Azure Queues and Service Bus queues compared</span></span>](service-bus-azure-and-service-bus-queues-compared-contrasted.md)

