---
title: Pianificare l'infrastruttura di backup delle VM in Azure | Documentazione Microsoft
description: Considerazioni importanti sulla pianificazione del backup di macchine virtuali in Azure
services: backup
documentationcenter: 
author: markgalioto
manager: carmonm
editor: 
keywords: backup di vm, backup di macchine virtuali
ms.assetid: 19d2cf82-1f60-43e1-b089-9238042887a9
ms.service: backup
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 7/18/2017
ms.author: markgal;trinadhk
ms.openlocfilehash: 0c930c7413b24a811707c3a1ff3d7d70585bc528
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/29/2017
---
# <a name="plan-your-vm-backup-infrastructure-in-azure"></a><span data-ttu-id="f1c89-104">Pianificare l'infrastruttura di backup delle VM in Azure</span><span class="sxs-lookup"><span data-stu-id="f1c89-104">Plan your VM backup infrastructure in Azure</span></span>
<span data-ttu-id="f1c89-105">Questo articolo fornisce suggerimenti relativi alle prestazioni e alle risorse per semplificare la pianificazione dell'infrastruttura di backup delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="f1c89-105">This article provides performance and resource suggestions to help you plan your VM backup infrastructure.</span></span> <span data-ttu-id="f1c89-106">Definisce anche gli elementi fondamentali del servizio Backup. Questi aspetti possono essere essenziali per determinare l'architettura, la pianificazione della capacità e la pianificazione generale.</span><span class="sxs-lookup"><span data-stu-id="f1c89-106">It also defines key aspects of the Backup service; these aspects can be critical in determining your architecture, capacity planning, and scheduling.</span></span> <span data-ttu-id="f1c89-107">Se è stato [preparato l'ambiente](backup-azure-vms-prepare.md), la pianificazione è il passaggio successivo prima di iniziare a [eseguire il backup delle VM](backup-azure-vms.md).</span><span class="sxs-lookup"><span data-stu-id="f1c89-107">If you've [prepared your environment](backup-azure-vms-prepare.md), planning is the next step before you begin [to back up VMs](backup-azure-vms.md).</span></span> <span data-ttu-id="f1c89-108">Per altre informazioni sulle macchine virtuali di Azure, vedere [Macchine virtuali - Documentazione](https://azure.microsoft.com/documentation/services/virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="f1c89-108">If you need more information about Azure virtual machines, see the [Virtual Machines documentation](https://azure.microsoft.com/documentation/services/virtual-machines/).</span></span>

## <a name="how-does-azure-back-up-virtual-machines"></a><span data-ttu-id="f1c89-109">In che modo Azure esegue il backup delle macchine virtuali?</span><span class="sxs-lookup"><span data-stu-id="f1c89-109">How does Azure back up virtual machines?</span></span>
<span data-ttu-id="f1c89-110">Quando il servizio Backup di Azure avvia un processo di backup all'ora pianificata, richiede all'estensione per il backup di acquisire uno snapshot temporizzato.</span><span class="sxs-lookup"><span data-stu-id="f1c89-110">When the Azure Backup service initiates a backup job at the scheduled time, it triggers the backup extension to take a point-in-time snapshot.</span></span> <span data-ttu-id="f1c89-111">Il servizio Backup di Azure usa l'estensione _VMSnapshot_ in Windows e l'estensione _VMSnapshotLinux_ in Linux.</span><span class="sxs-lookup"><span data-stu-id="f1c89-111">The Azure Backup service uses the _VMSnapshot_ extension in Windows, and the _VMSnapshotLinux_ extension in Linux.</span></span> <span data-ttu-id="f1c89-112">L'estensione viene installata all primo backup delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="f1c89-112">The extension is installed during the first VM backup.</span></span> <span data-ttu-id="f1c89-113">Per installare l'estensione, è necessario che la macchina virtuale sia in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="f1c89-113">To install the extension, the VM must be running.</span></span> <span data-ttu-id="f1c89-114">Se la macchina virtuale non è in esecuzione, il servizio Backup crea uno snapshot dell'archivio sottostante (poiché non si verifica alcuna scrittura di applicazione durante l'arresto della macchina virtuale).</span><span class="sxs-lookup"><span data-stu-id="f1c89-114">If the VM is not running, the Backup service takes a snapshot of the underlying storage (since no application writes occur while the VM is stopped).</span></span>

<span data-ttu-id="f1c89-115">Quando crea uno snapshot delle macchine virtuali di Windows, il servizio Backup si coordina con il servizio Copia Shadow del volume (VSS) per ottenere uno snapshot coerente dei dischi delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="f1c89-115">When taking a snapshot of Windows VMs, the Backup service coordinates with the Volume Shadow Copy Service (VSS) to get a consistent snapshot of the virtual machine's disks.</span></span> <span data-ttu-id="f1c89-116">Se si esegue il backup di macchine virtuali Linux, è possibile scrivere i propri script personalizzati per assicurare la coerenza quando si crea uno snapshot delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="f1c89-116">If you're backing up Linux VMs, you can write your own custom scripts to ensure consistency when taking a VM snapshot.</span></span> <span data-ttu-id="f1c89-117">Dettagli su come richiamare gli script sono forniti più avanti in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="f1c89-117">Details on invoking these scripts are provided later in this article.</span></span>

<span data-ttu-id="f1c89-118">Dopo che il servizio Backup di Azure crea lo snapshot, i data vengono trasferiti nell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="f1c89-118">Once the Azure Backup service takes the snapshot, the data is transferred to the vault.</span></span> <span data-ttu-id="f1c89-119">Per offrire la massima efficienza, il servizio identifica e trasferisce solo i blocchi di dati che sono stati modificati dall'ultimo backup.</span><span class="sxs-lookup"><span data-stu-id="f1c89-119">To maximize efficiency, the service identifies and transfers only the blocks of data that have changed since the previous backup.</span></span>

![Architettura del backup delle macchine virtuali di Azure](./media/backup-azure-vms-introduction/vmbackup-architecture.png)

<span data-ttu-id="f1c89-121">Quando il trasferimento dei dati è completato, lo snapshot viene rimosso e viene creato un punto di ripristino.</span><span class="sxs-lookup"><span data-stu-id="f1c89-121">When the data transfer is complete, the snapshot is removed and a recovery point is created.</span></span>

> [!NOTE]
> 1. <span data-ttu-id="f1c89-122">Durante il processo di backup, il servizio Backup di Azure non include il disco temporaneo collegato alla macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="f1c89-122">During the backup process, Azure Backup doesn't include the temporary disk attached to the virtual machine.</span></span> <span data-ttu-id="f1c89-123">Per altre informazioni, vedere il blog sull'[archiviazione temporanea](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="f1c89-123">For more information, see the blog on [temporary storage](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/).</span></span>
> 2. <span data-ttu-id="f1c89-124">Poiché il servizio Backup di Azure crea uno snapshot a livello di archiviazione e lo trasferisce nell'insieme di credenziali, non modificare le chiavi dell'account di archiviazione fino al termine del processo di backup.</span><span class="sxs-lookup"><span data-stu-id="f1c89-124">Since Azure Backup takes a storage-level snapshot and transfers that snapshot to vault, do not change the storage account keys until the backup job finishes.</span></span>
> 3. <span data-ttu-id="f1c89-125">Per le VM Premium, lo snapshot deve essere copiato nell'account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="f1c89-125">For premium VMs, we copy the snapshot to storage account.</span></span> <span data-ttu-id="f1c89-126">Si procede in questo modo per assicurarsi che il servizio di Backup di Azure ottenga IOPS sufficienti per il trasferimento dei dati nell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="f1c89-126">This is to make sure that Azure Backup service gets sufficient IOPS for transferring data to vault.</span></span> <span data-ttu-id="f1c89-127">Questa copia aggiuntiva della risorsa di archiviazione viene addebitata in base alla dimensione allocata della VM.</span><span class="sxs-lookup"><span data-stu-id="f1c89-127">This additional copy of storage is charged as per the VM allocated size.</span></span> 
>

### <a name="data-consistency"></a><span data-ttu-id="f1c89-128">Coerenza dei dati</span><span class="sxs-lookup"><span data-stu-id="f1c89-128">Data consistency</span></span>
<span data-ttu-id="f1c89-129">Le operazioni di backup e ripristino dei dati aziendali critici sono ulteriormente complicate dal fatto che il backup di tali dati deve essere eseguito mentre le applicazioni che generano i dati sono in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="f1c89-129">Backing up and restoring business critical data is complicated by the fact that business critical data must be backed up while the applications that produce the data are running.</span></span> <span data-ttu-id="f1c89-130">Per risolvere questo problema, Backup di Azure supporta i backup coerenti con l'applicazione per le macchine virtuali di Windows e di Linux</span><span class="sxs-lookup"><span data-stu-id="f1c89-130">To address this, Azure Backup supports application-consistent backups for both Windows and Linux VMs</span></span>
#### <a name="windows-vm"></a><span data-ttu-id="f1c89-131">Macchina virtuale Windows</span><span class="sxs-lookup"><span data-stu-id="f1c89-131">Windows VM</span></span>
<span data-ttu-id="f1c89-132">Backup di Azure esegue backup VSS completi nelle macchine virtuali di Windows (altre informazioni su [backup VSS completi](http://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx)).</span><span class="sxs-lookup"><span data-stu-id="f1c89-132">Azure Backup takes VSS full backups on Windows VMs (read more about [VSS full backup](http://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx)).</span></span> <span data-ttu-id="f1c89-133">Per abilitare i backup VSS di copia è necessario impostare la chiave di registro seguente nella macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="f1c89-133">To enable VSS copy backups, the following registry key needs to be set on the VM.</span></span>

```
[HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\BCDRAGENT]
"USEVSSCOPYBACKUP"="TRUE"
```

#### <a name="linux-vms"></a><span data-ttu-id="f1c89-134">Macchine virtuali di Linux</span><span class="sxs-lookup"><span data-stu-id="f1c89-134">Linux VMs</span></span>
<span data-ttu-id="f1c89-135">Backup di Azure fornisce un framework di scripting.</span><span class="sxs-lookup"><span data-stu-id="f1c89-135">Azure Backup provides a scripting framework.</span></span> <span data-ttu-id="f1c89-136">Per assicurare la coerenza con l'applicazione quando si esegue il backup di macchine virtuali Linux, creare script di pre-backup e di post-backup personalizzati che controllino il flusso e l'ambiente di backup.</span><span class="sxs-lookup"><span data-stu-id="f1c89-136">To ensure application consistency when backing up Linux VMs, create custom pre-scripts and post-scripts that control the backup workflow and environment.</span></span> <span data-ttu-id="f1c89-137">Backup di Azure richiama lo script di pre-backup prima di creare lo snapshot della macchina virtuale e richiama lo script di post-backup al termine del processo di snapshot.</span><span class="sxs-lookup"><span data-stu-id="f1c89-137">Azure Backup invokes the pre-script before taking the VM snapshot and invokes the post-script once the VM snapshot job completes.</span></span> <span data-ttu-id="f1c89-138">Per altri dettagli, vedere l'articolo relativo a [backup di macchine con coerenza delle applicazioni usando script di pre-backup e di post-backup](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span><span class="sxs-lookup"><span data-stu-id="f1c89-138">For more details, see [application consistent VM backups using pre-script and post-script](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span></span>
> [!NOTE]
> <span data-ttu-id="f1c89-139">Backup di Azure richiama solo script di pre-backup e di post-backup scritti dal cliente.</span><span class="sxs-lookup"><span data-stu-id="f1c89-139">Azure Backup only invokes the customer-written pre- and post-scripts.</span></span> <span data-ttu-id="f1c89-140">Se script di pre-backup e di post-backup vengono eseguiti correttamente, Azure Backup contrassegna il punto di ripristino come coerente con l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f1c89-140">If the pre-script and post-scripts execute successfully, Azure Backup marks the recovery point as application consistent.</span></span> <span data-ttu-id="f1c89-141">Tuttavia, il cliente è responsabile della coerenza con l'applicazione quando usa script personalizzati.</span><span class="sxs-lookup"><span data-stu-id="f1c89-141">However, the customer is ultimately responsible for the application consistency when using custom scripts.</span></span>
>


<span data-ttu-id="f1c89-142">Questa tabella illustra i tipi di coerenza e le condizioni in cui si verificano durante le procedure di backup e ripristino delle macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="f1c89-142">This table explains the types of consistency and the conditions that they occur under during Azure VM backup and restore procedures.</span></span>

| <span data-ttu-id="f1c89-143">Coerenza</span><span class="sxs-lookup"><span data-stu-id="f1c89-143">Consistency</span></span> | <span data-ttu-id="f1c89-144">Basato su VSS</span><span class="sxs-lookup"><span data-stu-id="f1c89-144">VSS-based</span></span> | <span data-ttu-id="f1c89-145">Spiegazione e dettagli</span><span class="sxs-lookup"><span data-stu-id="f1c89-145">Explanation and details</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f1c89-146">Coerenza con l'applicazione</span><span class="sxs-lookup"><span data-stu-id="f1c89-146">Application consistency</span></span> |<span data-ttu-id="f1c89-147">Sì per Windows</span><span class="sxs-lookup"><span data-stu-id="f1c89-147">Yes for Windows</span></span>|<span data-ttu-id="f1c89-148">La coerenza dell'applicazione è ideale per i carichi di lavoro perché garantisce:</span><span class="sxs-lookup"><span data-stu-id="f1c89-148">Application consistency is ideal for workloads as it ensures that:</span></span><ol><li> <span data-ttu-id="f1c89-149">L' *avvio*della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="f1c89-149">The VM *boots up*.</span></span> <li><span data-ttu-id="f1c89-150">L' *assenza di qualsiasi danneggiamento*.</span><span class="sxs-lookup"><span data-stu-id="f1c89-150">There is *no corruption*.</span></span> <li><span data-ttu-id="f1c89-151">L'*assenza di perdite di dati*.</span><span class="sxs-lookup"><span data-stu-id="f1c89-151">There is *no data loss*.</span></span><li> <span data-ttu-id="f1c89-152">La coerenza dei dati con l'applicazione che li usa, grazie all'impiego dell'applicazione al momento del backup tramite il Servizio Copia shadow del volume o lo script di pre-/post-backup.</span><span class="sxs-lookup"><span data-stu-id="f1c89-152">The data is consistent to the application that uses the data, by involving the application at the time of backup--using VSS or pre/post script.</span></span></ol> <li><span data-ttu-id="f1c89-153">*Macchine virtuali Windows*: la maggior parte dei carichi di lavoro di Microsoft ha writer VSS che eseguono azioni specifiche di un carico di lavoro correlate alla coerenza dei dati.</span><span class="sxs-lookup"><span data-stu-id="f1c89-153">*Windows VMs*- Most Microsoft workloads have VSS writers that do workload-specific actions related to data consistency.</span></span> <span data-ttu-id="f1c89-154">Ad esempio, Microsoft SQL Server ha un writer VSS che garantisce l'esecuzione corretta delle operazioni di scrittura nel file di log delle transazioni e nel database.</span><span class="sxs-lookup"><span data-stu-id="f1c89-154">For example, Microsoft SQL Server has a VSS writer that ensures that the writes to the transaction log file and the database are done correctly.</span></span> <span data-ttu-id="f1c89-155">Per i backup delle macchine virtuali Windows di Azure, per creare un punto di ripristino coerente con un'applicazione, l'estensione del backup deve richiamare il flusso di lavoro del VSS e completarlo prima dell'acquisizione dello snapshot della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="f1c89-155">For Azure Windows VM backups, to create an application-consistent recovery point, the backup extension must invoke the VSS workflow and complete it before taking the VM snapshot.</span></span> <span data-ttu-id="f1c89-156">Affinché lo snapshot della macchina virtuale di Azure sia preciso, è necessario completare anche i writer VSS di tutte le applicazioni delle VM di Azure.</span><span class="sxs-lookup"><span data-stu-id="f1c89-156">For the Azure VM snapshot to be accurate, the VSS writers of all Azure VM applications must complete as well.</span></span> <span data-ttu-id="f1c89-157">(apprendere le [nozioni di base di VSS](http://blogs.technet.com/b/josebda/archive/2007/10/10/the-basics-of-the-volume-shadow-copy-service-vss.aspx) e approfondire i dettagli di [funzionamento](https://technet.microsoft.com/library/cc785914%28v=ws.10%29.aspx)).</span><span class="sxs-lookup"><span data-stu-id="f1c89-157">(Learn the [basics of VSS](http://blogs.technet.com/b/josebda/archive/2007/10/10/the-basics-of-the-volume-shadow-copy-service-vss.aspx) and dive deep into the details of [how it works](https://technet.microsoft.com/library/cc785914%28v=ws.10%29.aspx)).</span></span> </li> <li> <span data-ttu-id="f1c89-158">*Macchine virtuali Linux*: i clienti possono eseguire [script di pre-backup e post-backup personalizzati per garantire coerenza con l'applicazione](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span><span class="sxs-lookup"><span data-stu-id="f1c89-158">*Linux VMs*- Customers can execute [custom pre-script and post-script to ensure application consistency](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span></span> </li> |
| <span data-ttu-id="f1c89-159">Coerenza del file system</span><span class="sxs-lookup"><span data-stu-id="f1c89-159">File-system consistency</span></span> |<span data-ttu-id="f1c89-160">Sì, per i computer basati su Windows</span><span class="sxs-lookup"><span data-stu-id="f1c89-160">Yes - for Windows-based computers</span></span> |<span data-ttu-id="f1c89-161">Esistono due scenari in cui il punto di ripristino può essere *coerente con il file system*:</span><span class="sxs-lookup"><span data-stu-id="f1c89-161">There are two scenarios where the recovery point can be *file-system consistent*:</span></span><ul><li><span data-ttu-id="f1c89-162">Backup di macchine virtuali Linux in Azure, senza script di pre-/post-backup o se lo script di pre-/post-backup non è stato eseguito correttamente.</span><span class="sxs-lookup"><span data-stu-id="f1c89-162">Backups of Linux VMs in Azure, without pre-script/post-script or if pre-script/post-script failed.</span></span> <li><span data-ttu-id="f1c89-163">Errore VSS durante il backup di macchine virtuali di Windows in Azure.</span><span class="sxs-lookup"><span data-stu-id="f1c89-163">VSS failure during backup for Windows VMs in Azure.</span></span></li></ul> <span data-ttu-id="f1c89-164">In entrambi i casi la soluzione ottimale è garantire:</span><span class="sxs-lookup"><span data-stu-id="f1c89-164">In both these cases, the best that can be done is to ensure that:</span></span> <ol><li> <span data-ttu-id="f1c89-165">L' *avvio*della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="f1c89-165">The VM *boots up*.</span></span> <li><span data-ttu-id="f1c89-166">L' *assenza di qualsiasi danneggiamento*.</span><span class="sxs-lookup"><span data-stu-id="f1c89-166">There is *no corruption*.</span></span><li><span data-ttu-id="f1c89-167">L'*assenza di perdite di dati*.</span><span class="sxs-lookup"><span data-stu-id="f1c89-167">There is *no data loss*.</span></span></ol> <span data-ttu-id="f1c89-168">Le applicazioni devono implementare il proprio meccanismo di correzione sui dati ripristinati.</span><span class="sxs-lookup"><span data-stu-id="f1c89-168">Applications need to implement their own "fix-up" mechanism on the restored data.</span></span> |
| <span data-ttu-id="f1c89-169">Coerenza dei dati</span><span class="sxs-lookup"><span data-stu-id="f1c89-169">Crash consistency</span></span> |<span data-ttu-id="f1c89-170">No</span><span class="sxs-lookup"><span data-stu-id="f1c89-170">No</span></span> |<span data-ttu-id="f1c89-171">Questa situazione è equivalente a quella di una macchina virtuale che si è arrestata in modo anomalo a causa di un ripristino software o hardware.</span><span class="sxs-lookup"><span data-stu-id="f1c89-171">This situation is equivalent to a virtual machine experiencing a "crash" (through either a soft or hard reset).</span></span> <span data-ttu-id="f1c89-172">La coerenza per arresto anomalo del sistema si verifica in genere quando la macchina virtuale di Azure viene arrestata durante il backup.</span><span class="sxs-lookup"><span data-stu-id="f1c89-172">Crash consistency typically happens when the Azure virtual machine is shut down at the time of backup.</span></span> <span data-ttu-id="f1c89-173">Un punto di ripristino coerente con l'arresto anomalo non offre alcuna garanzia di coerenza dei dati sul supporto di archiviazione, dal punto di vista del sistema operativo o dal punto di vista dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f1c89-173">A crash-consistent recovery point provides no guarantees around the consistency of the data on the storage medium--either from the perspective of the operating system or the application.</span></span> <span data-ttu-id="f1c89-174">Solo i dati già esistenti sul disco al momento del backup vengono acquisiti e sottoposti a backup.</span><span class="sxs-lookup"><span data-stu-id="f1c89-174">Only the data that already exists on the disk at the time of backup is captured and backed up.</span></span> <br/> <br/> <span data-ttu-id="f1c89-175">Anche se non vi sono garanzie, nella maggior parte dei casi il sistema operativo si avvia. Questa operazione è in genere seguita da una procedura di controllo del disco come chkdsk per correggere eventuali errori di danneggiamento del disco.</span><span class="sxs-lookup"><span data-stu-id="f1c89-175">While there are no guarantees, usually, the operating system boots, followed by disk-checking procedure, like chkdsk, to fix any corruption errors.</span></span> <span data-ttu-id="f1c89-176">I dati in memoria o le scritture che non sono state trasferite sul disco andranno persi.</span><span class="sxs-lookup"><span data-stu-id="f1c89-176">Any in-memory data or writes that have not been transferred to the disk are lost.</span></span> <span data-ttu-id="f1c89-177">In genere l'applicazione esegue il proprio meccanismo di verifica nel caso in cui sia necessario effettuare il rollback di dati.</span><span class="sxs-lookup"><span data-stu-id="f1c89-177">The application typically follows with its own verification mechanism in case data rollback needs to be done.</span></span> <br><br><span data-ttu-id="f1c89-178">Ad esempio, se il log delle transazioni contiene voci che non sono presenti nel database, il software del database esegue un rollback fino a quando i dati sono coerenti.</span><span class="sxs-lookup"><span data-stu-id="f1c89-178">As an example, if the transaction log has entries that are not present in the database, then the database software does a rollback until the data is consistent.</span></span> <span data-ttu-id="f1c89-179">Quando i dati sono distribuiti tra più dischi virtuali (ad esempio volumi con spanning), un punto di ripristino coerente con l'arresto anomalo del sistema non fornisce alcuna garanzia della correttezza dei dati.</span><span class="sxs-lookup"><span data-stu-id="f1c89-179">When data is spread across multiple virtual disks (like spanned volumes), a crash-consistent recovery point provides no guarantees for the correctness of the data.</span></span> |

## <a name="performance-and-resource-utilization"></a><span data-ttu-id="f1c89-180">Prestazioni e utilizzo delle risorse</span><span class="sxs-lookup"><span data-stu-id="f1c89-180">Performance and resource utilization</span></span>
<span data-ttu-id="f1c89-181">Analogamente al software distribuito in locale, è necessario pianificare le esigenze di utilizzo di capacità e risorse durante il backup delle macchine virtuali in Azure.</span><span class="sxs-lookup"><span data-stu-id="f1c89-181">Like backup software that is deployed on-premises, you should plan for capacity and resource utilization needs when backing up VMs in Azure.</span></span> <span data-ttu-id="f1c89-182">I [limiti del servizio di archiviazione di Azure](../azure-subscription-service-limits.md#storage-limits) definiscono il modo in cui sono strutturate le distribuzioni delle macchine virtuali per ottenere prestazioni ottimali con il minimo impatto sui carichi di lavoro in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="f1c89-182">The [Azure Storage limits](../azure-subscription-service-limits.md#storage-limits) define how to structure VM deployments to get maximum performance with minimum impact to running workloads.</span></span>

<span data-ttu-id="f1c89-183">Prestare attenzione ai limiti seguenti dell'Archiviazione di Azure durante la pianificazione delle prestazioni del backup:</span><span class="sxs-lookup"><span data-stu-id="f1c89-183">Pay attention to the following Azure Storage limits when planning backup performance:</span></span>

* <span data-ttu-id="f1c89-184">Numero massimo in uscita per account di archiviazione</span><span class="sxs-lookup"><span data-stu-id="f1c89-184">Max egress per storage account</span></span>
* <span data-ttu-id="f1c89-185">Frequenza delle richieste totale per account di archiviazione</span><span class="sxs-lookup"><span data-stu-id="f1c89-185">Total request rate per storage account</span></span>

### <a name="storage-account-limits"></a><span data-ttu-id="f1c89-186">Limiti dell'account di archiviazione</span><span class="sxs-lookup"><span data-stu-id="f1c89-186">Storage account limits</span></span>
<span data-ttu-id="f1c89-187">I dati di backup copiati da un account di archiviazione si sommano alle operazioni di input/output al secondo (IOPS) e alle metriche relative ai dati in uscita (o velocità effettiva) dell'account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="f1c89-187">Backup data copied from a storage account, adds to the input/output operations per second (IOPS) and egress (or throughput) metrics of the storage account.</span></span> <span data-ttu-id="f1c89-188">Al contempo, le macchine virtuali consumano le operazioni di I/O al secondo (IOPS) e velocità effettiva.</span><span class="sxs-lookup"><span data-stu-id="f1c89-188">At the same time, virtual machines are also consuming IOPS and throughput.</span></span> <span data-ttu-id="f1c89-189">L'obiettivo è garantire che il traffico del backup e delle macchine virtuali non superi i limiti previsti per l'account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="f1c89-189">The goal is to ensure Backup and virtual machine traffic don't exceed your storage account limits.</span></span>

### <a name="number-of-disks"></a><span data-ttu-id="f1c89-190">Numero di dischi</span><span class="sxs-lookup"><span data-stu-id="f1c89-190">Number of disks</span></span>
<span data-ttu-id="f1c89-191">Il processo di backup prova a completare un processo di backup il più velocemente possibile,</span><span class="sxs-lookup"><span data-stu-id="f1c89-191">The backup process tries to complete a backup job as quickly as possible.</span></span> <span data-ttu-id="f1c89-192">utilizzando quindi la quantità più elevata possibile di risorse.</span><span class="sxs-lookup"><span data-stu-id="f1c89-192">In doing so, it consumes as many resources as it can.</span></span> <span data-ttu-id="f1c89-193">Tutte le operazioni di I/O sono tuttavia limitate dalla *velocità effettiva da raggiungere per BLOB singolo* che ha un limite di 60 MB al secondo.</span><span class="sxs-lookup"><span data-stu-id="f1c89-193">However, all I/O operations are limited by the *Target Throughput for Single Blob*, which has a limit of 60 MB per second.</span></span> <span data-ttu-id="f1c89-194">Nel tentativo di massimizzare la velocità, il processo di backup prova a eseguire il backup di ciascun disco della macchina virtuale *in parallelo*.</span><span class="sxs-lookup"><span data-stu-id="f1c89-194">In an attempt to maximize its speed, the backup process tries to back up each of the VM's disks *in parallel*.</span></span> <span data-ttu-id="f1c89-195">Se una macchina virtuale contiene quattro dischi, il servizio prova a eseguire il backup di tutti e quattro i dischi in parallelo.</span><span class="sxs-lookup"><span data-stu-id="f1c89-195">If a VM has four disks, the service attempts to back up all four disks in parallel.</span></span> <span data-ttu-id="f1c89-196">Il fattore più importante che determina il traffico di backup di un account di archiviazione è il **numero di dischi** di cui viene eseguito il backup.</span><span class="sxs-lookup"><span data-stu-id="f1c89-196">The **number of disks** being backed up, is the most important factor in determining storage account backup traffic.</span></span>

### <a name="backup-schedule"></a><span data-ttu-id="f1c89-197">Pianificazione dei backup</span><span class="sxs-lookup"><span data-stu-id="f1c89-197">Backup schedule</span></span>
<span data-ttu-id="f1c89-198">Un altro aspetto che influisce sulle prestazioni è la **pianificazione dei backup**.</span><span class="sxs-lookup"><span data-stu-id="f1c89-198">An additional factor that impacts performance is the **backup schedule**.</span></span> <span data-ttu-id="f1c89-199">Se si configurano i criteri in modo che venga eseguito il backup di tutte le macchine virtuali contemporaneamente, è stato pianificato un blocco del traffico.</span><span class="sxs-lookup"><span data-stu-id="f1c89-199">If you configure the policies so all VMs are backed up at the same time, you have scheduled a traffic jam.</span></span> <span data-ttu-id="f1c89-200">Il processo di backup tenta di eseguire il backup di tutti i dischi in parallelo.</span><span class="sxs-lookup"><span data-stu-id="f1c89-200">The backup process attempts to back up all disks in parallel.</span></span> <span data-ttu-id="f1c89-201">Per ridurre il traffico di backup da un account di archiviazione, eseguire il backup delle singole macchine virtuali in diverse ore del giorno, senza sovrapposizioni.</span><span class="sxs-lookup"><span data-stu-id="f1c89-201">To reduce the backup traffic from a storage account, back up different VMs at different time of the day, with no overlap.</span></span>

## <a name="capacity-planning"></a><span data-ttu-id="f1c89-202">Pianificazione della capacità</span><span class="sxs-lookup"><span data-stu-id="f1c89-202">Capacity planning</span></span>
<span data-ttu-id="f1c89-203">Combinando i fattori precedenti, è necessario pianificare le esigenze d'uso dell'account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="f1c89-203">Putting the previous factors together, you need to plan for the storage account usage needs.</span></span> <span data-ttu-id="f1c89-204">Scaricare il [foglio di Excel per la pianificazione della capacità di backup delle macchine virtuali](https://gallery.technet.microsoft.com/Azure-Backup-Storage-a46d7e33) per valutare l'impatto delle scelte relative alla pianificazione dei backup e dei dischi.</span><span class="sxs-lookup"><span data-stu-id="f1c89-204">Download the [VM backup capacity planning Excel spreadsheet](https://gallery.technet.microsoft.com/Azure-Backup-Storage-a46d7e33) to see the impact of your disk and backup schedule choices.</span></span>

### <a name="backup-throughput"></a><span data-ttu-id="f1c89-205">Velocità effettiva del backup</span><span class="sxs-lookup"><span data-stu-id="f1c89-205">Backup throughput</span></span>
<span data-ttu-id="f1c89-206">Per ogni disco di cui si esegue il backup, il servizio Backup di Azure legge i blocchi nel disco e archivia solo i dati modificati (backup incrementale).</span><span class="sxs-lookup"><span data-stu-id="f1c89-206">For each disk being backed up, Azure Backup reads the blocks on the disk and stores only the changed data (incremental backup).</span></span> <span data-ttu-id="f1c89-207">Nella tabella seguente vengono illustrati i valori di velocità effettiva del servizio Backup.</span><span class="sxs-lookup"><span data-stu-id="f1c89-207">The following table shows the average Backup service throughput values.</span></span> <span data-ttu-id="f1c89-208">Usando i dati seguenti è possibile stimare la quantità di tempo necessaria per il backup di un disco con le dimensioni specificate.</span><span class="sxs-lookup"><span data-stu-id="f1c89-208">Using the following data, you can estimate the amount of time needed to back up a disk of a given size.</span></span>

| <span data-ttu-id="f1c89-209">Operazione di backup</span><span class="sxs-lookup"><span data-stu-id="f1c89-209">Backup operation</span></span> | <span data-ttu-id="f1c89-210">Velocità effettiva ottimale</span><span class="sxs-lookup"><span data-stu-id="f1c89-210">Best-case throughput</span></span> |
| --- | --- |
| <span data-ttu-id="f1c89-211">Backup iniziale</span><span class="sxs-lookup"><span data-stu-id="f1c89-211">Initial backup</span></span> |<span data-ttu-id="f1c89-212">160 Mbps</span><span class="sxs-lookup"><span data-stu-id="f1c89-212">160 Mbps</span></span> |
| <span data-ttu-id="f1c89-213">Backup incrementale (ripristino di emergenza)</span><span class="sxs-lookup"><span data-stu-id="f1c89-213">Incremental backup (DR)</span></span> |<span data-ttu-id="f1c89-214">640 Mbps </span><span class="sxs-lookup"><span data-stu-id="f1c89-214">640 Mbps</span></span> <br><br> <span data-ttu-id="f1c89-215">La velocità effettiva si riduce in modo significativo se i dati modificati (per cui è necessario eseguire il backup) sono dispersi sul disco rigido.</span><span class="sxs-lookup"><span data-stu-id="f1c89-215">Throughput drops significantly if the changed data (that needs to be backed up) is dispersed across the disk.</span></span>|

## <a name="total-vm-backup-time"></a><span data-ttu-id="f1c89-216">Tempo totale di backup della macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="f1c89-216">Total VM backup time</span></span>
<span data-ttu-id="f1c89-217">Nonostante la maggior parte del tempo di backup venga impiegata per la lettura e la copia dei dati, altre operazioni influiscono sul tempo totale necessario per il backup di una macchina virtuale:</span><span class="sxs-lookup"><span data-stu-id="f1c89-217">While most of the backup time is spent reading and copying data, other operations contribute to the total time needed to back up a VM:</span></span>

* <span data-ttu-id="f1c89-218">Tempo necessario per l' [installazione o l'aggiornamento dell'estensione per il backup](backup-azure-vms.md).</span><span class="sxs-lookup"><span data-stu-id="f1c89-218">Time needed to [install or update the backup extension](backup-azure-vms.md).</span></span>
* <span data-ttu-id="f1c89-219">Tempo dello snapshot, ovvero il tempo impiegato per attivare uno snapshot.</span><span class="sxs-lookup"><span data-stu-id="f1c89-219">Snapshot time, which is the time taken to trigger a snapshot.</span></span> <span data-ttu-id="f1c89-220">Gli snapshot vengono attivati vicino al momento del backup pianificato.</span><span class="sxs-lookup"><span data-stu-id="f1c89-220">Snapshots are triggered close to the scheduled backup time.</span></span>
* <span data-ttu-id="f1c89-221">Tempo di attesa di coda.</span><span class="sxs-lookup"><span data-stu-id="f1c89-221">Queue wait time.</span></span> <span data-ttu-id="f1c89-222">Poiché il servizio di backup elabora i backup di più clienti, è possibile che la copia dei dati di backup dallo snapshot nell'insieme di credenziali di Backup o di Servizi di ripristino non venga avviata immediatamente.</span><span class="sxs-lookup"><span data-stu-id="f1c89-222">Since the Backup service is processing backups from multiple customers, copying backup data from snapshot to the backup or Recovery Services vault might not start immediately.</span></span> <span data-ttu-id="f1c89-223">Nei periodi di massimo carico, l'attesa può durare al massimo 8 ore a causa del numero di backup in corso di elaborazione.</span><span class="sxs-lookup"><span data-stu-id="f1c89-223">In times of peak load, the wait can stretch up to eight hours due to the number of backups being processed.</span></span> <span data-ttu-id="f1c89-224">Tuttavia, il tempo di backup totale della macchina virtuale sarà inferiore a 24 ore per i criteri di backup giornalieri.</span><span class="sxs-lookup"><span data-stu-id="f1c89-224">However, the total VM backup time is less than 24 hours for daily backup policies.</span></span>
* <span data-ttu-id="f1c89-225">L'ora del trasferimento dati, necessaria al servizio di backup per calcolare le modifiche incrementali da backup e trasferimento precedenti, cambia nell'archiviazione dell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="f1c89-225">Data transfer time, time needed for backup service to compute the incremental changes from previous backup and transfer those changes to vault storage.</span></span>

### <a name="why-am-i-observing-longer12-hours-backup-time"></a><span data-ttu-id="f1c89-226">Perché si registrano tempi di backup superiori alle 12 ore?</span><span class="sxs-lookup"><span data-stu-id="f1c89-226">Why am I observing longer(>12 hours) backup time?</span></span>
<span data-ttu-id="f1c89-227">Il backup è costituito da due fasi: l'acquisizione di snapshot e il trasferimento degli snapshot nell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="f1c89-227">Backup consists of two phases: taking snapshots and transferring the snapshots to the vault.</span></span> <span data-ttu-id="f1c89-228">Il servizio di Backup consente di ottimizzare l'archiviazione.</span><span class="sxs-lookup"><span data-stu-id="f1c89-228">The Backup service optimizes for storage.</span></span> <span data-ttu-id="f1c89-229">Quando si trasferiscono i dati dello snapshot all'insieme di credenziali, il servizio trasferisce solo le modifiche incrementali dello snapshot precedente.</span><span class="sxs-lookup"><span data-stu-id="f1c89-229">When transferring the snapshot data to a vault, the service only transfers incremental changes from the previous snapshot.</span></span>  <span data-ttu-id="f1c89-230">Per determinare le modifiche incrementali, il servizio calcola il checksum dei blocchi.</span><span class="sxs-lookup"><span data-stu-id="f1c89-230">To determine the incremental changes, the service computes the checksum of the blocks.</span></span> <span data-ttu-id="f1c89-231">Se viene modificato un blocco, il blocco viene identificato come blocco da inviare all'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="f1c89-231">If a block is changed, the block is identified as a block to be sent to the vault.</span></span> <span data-ttu-id="f1c89-232">Il servizio penetra ulteriormente in ognuno dei blocchi identificati, alla ricerca di opportunità per ridurre al minimo i dati da trasferire.</span><span class="sxs-lookup"><span data-stu-id="f1c89-232">Then the service drills further into each of the identified blocks, looking for opportunities to minimize the data to transfer.</span></span> <span data-ttu-id="f1c89-233">Dopo aver valutato tutti i blocchi modificati, il servizio unisce le modifiche e le invia all'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="f1c89-233">After evaluating all changed blocks, the service coalesces the changes and sends them to the vault.</span></span> <span data-ttu-id="f1c89-234">In alcune applicazioni legacy, le scritture frammentate e di piccole dimensioni non sono ottimali per l'archiviazione.</span><span class="sxs-lookup"><span data-stu-id="f1c89-234">In some legacy applications, small, fragmented writes are not optimal for storage.</span></span> <span data-ttu-id="f1c89-235">Se lo snapshot contiene molte delle operazioni di scrittura frammentate e di piccole dimensioni, il servizio impiega più tempo nell'elaborazione dei dati scritti dalle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="f1c89-235">If the snapshot contains many small, fragmented writes, the service spends additional time processing the data written by the applications.</span></span> <span data-ttu-id="f1c89-236">Il blocco di scrittura dell'applicazione minimo consigliato da Azure per le applicazioni in esecuzione su una macchina virtuale è pari a 8 KB.</span><span class="sxs-lookup"><span data-stu-id="f1c89-236">The recommended application write block from Azure, for applications running inside the VM, is a minimum of 8 KB.</span></span> <span data-ttu-id="f1c89-237">Se l'applicazione usa un blocco più piccolo degli 8 KB, le prestazioni del backup ne risentono.</span><span class="sxs-lookup"><span data-stu-id="f1c89-237">If your application uses a block of less than 8 KB, backup performance is effected.</span></span> <span data-ttu-id="f1c89-238">Per assistenza sull'ottimizzazione dell'applicazione per migliorare le prestazioni di backup, vedere l'articolo sull'[ottimizzazione delle applicazioni per prestazioni ottimali con Archiviazione di Azure](../storage/common/storage-premium-storage-performance.md).</span><span class="sxs-lookup"><span data-stu-id="f1c89-238">For help with tuning your application to improve backup performance, see [Tuning applications for optimal performance with Azure storage](../storage/common/storage-premium-storage-performance.md).</span></span> <span data-ttu-id="f1c89-239">Sebbene l'articolo sulle prestazioni di backup usi esempi di archiviazione Premium, le linee guida sono applicabili ai dischi di archiviazione Standard.</span><span class="sxs-lookup"><span data-stu-id="f1c89-239">Though the article on backup performance uses Premium storage examples, the guidance is applicable for Standard storage disks.</span></span>

## <a name="total-restore-time"></a><span data-ttu-id="f1c89-240">Tempo totale di ripristino</span><span class="sxs-lookup"><span data-stu-id="f1c89-240">Total restore time</span></span>
<span data-ttu-id="f1c89-241">Un'operazione di ripristino è costituita da due sottoattività principali: la copia dei dati dall'insieme di credenziali all'account di archiviazione scelto del cliente e la creazione della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="f1c89-241">A restore operation consists of two main sub tasks: Copying data back from the vault to the chosen customer storage account, and creating the virtual machine.</span></span> <span data-ttu-id="f1c89-242">La copia dei dati dall'insieme di credenziali dipende dalla posizione in cui vengono archiviati i backup internamente in Azure e dalla posizione in cui è memorizzato l'account di archiviazione del cliente.</span><span class="sxs-lookup"><span data-stu-id="f1c89-242">Copying data back from the vault depends on where the backups are stored internally in Azure, and where the customer storage account is stored.</span></span> <span data-ttu-id="f1c89-243">Il tempo necessario alla copia dipende dalle seguenti attività:</span><span class="sxs-lookup"><span data-stu-id="f1c89-243">Time taken to copy data depends upon:</span></span>
* <span data-ttu-id="f1c89-244">Tempo di attesa in coda: dal momento che il servizio esegue ripristini da più clienti contemporaneamente, le richieste di ripristino vengono messe in coda.</span><span class="sxs-lookup"><span data-stu-id="f1c89-244">Queue wait time - Since the service processes restore jobs from multiple customers at the same time, restore requests are put in a queue.</span></span>
* <span data-ttu-id="f1c89-245">Tempo di copia dei dati: i dati vengono copiati dall'insieme di credenziali nell'account di archiviazione del cliente.</span><span class="sxs-lookup"><span data-stu-id="f1c89-245">Data copy time - Data is copied from the vault to the customer storage account.</span></span> <span data-ttu-id="f1c89-246">I tempi di ripristino dipendono dalle IOPS e dalla velocità effettiva dl servizio Backup di Azure sull'account di archiviazione del cliente selezionato.</span><span class="sxs-lookup"><span data-stu-id="f1c89-246">Restore time depends on IOPS and throughput Azure Backup service gets on the selected customer storage account.</span></span> <span data-ttu-id="f1c89-247">Per ridurre il tempo di copia durante il processo di ripristino, selezionare un account di archiviazione non caricato con altre letture e scritture di applicazione.</span><span class="sxs-lookup"><span data-stu-id="f1c89-247">To reduce the copying time during the restore process, select a storage account not loaded with other application writes and reads.</span></span>

## <a name="best-practices"></a><span data-ttu-id="f1c89-248">Procedure consigliate</span><span class="sxs-lookup"><span data-stu-id="f1c89-248">Best practices</span></span>
<span data-ttu-id="f1c89-249">È consigliabile seguire queste procedure durante la configurazione del backup per le macchine virtuali:</span><span class="sxs-lookup"><span data-stu-id="f1c89-249">We suggest following these practices while configuring backups for virtual machines:</span></span>

* <span data-ttu-id="f1c89-250">Non pianificare il backup di più di 10 macchine virtuali classiche contemporaneamente dallo stesso servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="f1c89-250">Don't schedule more than 10 classic VMs from the same cloud service to back up at the same time.</span></span> <span data-ttu-id="f1c89-251">Se si vuole eseguire il backup di più macchine virtuali dallo stesso servizio cloud, sfalsare di un'ora le ore di inizio dei backup.</span><span class="sxs-lookup"><span data-stu-id="f1c89-251">If you want to back up multiple VMs from same cloud service, stagger the backup start times by an hour.</span></span>
* <span data-ttu-id="f1c89-252">Non pianificare il backup contemporaneo di più di 40 macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="f1c89-252">Do not schedule more than 40 VMs to back up at the same time.</span></span>
* <span data-ttu-id="f1c89-253">Pianificare i backup di macchine Virtuali durante le ore non di punta.</span><span class="sxs-lookup"><span data-stu-id="f1c89-253">Schedule VM backups during non-peak hours.</span></span> <span data-ttu-id="f1c89-254">In questo modo il servizio Backup usa le IOPS per il trasferimento dei dati dall'account di archiviazione del cliente all'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="f1c89-254">This way the Backup service uses IOPS for transferring data from the customer storage account to the vault.</span></span>
* <span data-ttu-id="f1c89-255">Assicurarsi che un criterio faccia riferimento a VM in più account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="f1c89-255">Make sure that a policy is applied on VMs spread across different storage accounts.</span></span> <span data-ttu-id="f1c89-256">È consigliabile non proteggere con la stessa pianificazione di backup più di 20 dischi in totale da un singolo account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="f1c89-256">We suggest no more than 20 total disks from a single storage account be protected by the same backup schedule.</span></span> <span data-ttu-id="f1c89-257">Se un account di archiviazione include più di 20 dischi, suddividere le VM tra più criteri per ottenere i valori di IOPS necessari durante la fase di trasferimento del processo di backup.</span><span class="sxs-lookup"><span data-stu-id="f1c89-257">If you have greater than 20 disks in a storage account, spread those VMs across multiple policies to get the required IOPS during the transfer phase of the backup process.</span></span>
* <span data-ttu-id="f1c89-258">Non ripristinare una macchina virtuale in esecuzione nell'Archiviazione Premium nello stesso account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="f1c89-258">Do not restore a VM running on Premium storage to same storage account.</span></span> <span data-ttu-id="f1c89-259">Se il processo dell'operazione di ripristino coincide con l'operazione di backup, il valore di IOPS disponibile per il backup sarà ridotto.</span><span class="sxs-lookup"><span data-stu-id="f1c89-259">If the restore operation process coincides with the backup operation, it reduces the available IOPS for backup.</span></span>
* <span data-ttu-id="f1c89-260">Per il backup di VM Premium, verificare che l'account di archiviazione che ospita i dischi premium abbia almeno il 50% di spazio disponibile per la gestione temporanea degli snapshot perché il backup sia completato correttamente.</span><span class="sxs-lookup"><span data-stu-id="f1c89-260">For Premium VM backup, ensure that storage account that hosts premium disks has atleast 50% free space for staging snapshot for a successful backup.</span></span> 
* <span data-ttu-id="f1c89-261">Verificare che la versione di python nelle macchine virtuali Linux abilitate per il backup sia la 2.7</span><span class="sxs-lookup"><span data-stu-id="f1c89-261">Make sure that python version on Linux VMs enabled for backup is 2.7</span></span>

## <a name="data-encryption"></a><span data-ttu-id="f1c89-262">Crittografia dei dati</span><span class="sxs-lookup"><span data-stu-id="f1c89-262">Data encryption</span></span>
<span data-ttu-id="f1c89-263">Il Backup di Azure non crittografa i dati come parte del processo di backup.</span><span class="sxs-lookup"><span data-stu-id="f1c89-263">Azure Backup does not encrypt data as a part of the backup process.</span></span> <span data-ttu-id="f1c89-264">È tuttavia possibile crittografare i dati all'interno della macchina virtuale e ed eseguire il backup dei dati protetti facilmente (altre informazioni sul [backup dei dati crittografati](backup-azure-vms-encryption.md)).</span><span class="sxs-lookup"><span data-stu-id="f1c89-264">However, you can encrypt data within the VM and back up the protected data seamlessly (read more about [backup of encrypted data](backup-azure-vms-encryption.md)).</span></span>

## <a name="calculating-the-cost-of-protected-instances"></a><span data-ttu-id="f1c89-265">Calcolo del costo delle istanze protette</span><span class="sxs-lookup"><span data-stu-id="f1c89-265">Calculating the cost of protected instances</span></span>
<span data-ttu-id="f1c89-266">Le macchine virtuali di Azure di cui viene eseguito il backup mediante Backup di Azure sono soggette a [fatturazione sulla base dei prezzi di tale servizio](https://azure.microsoft.com/pricing/details/backup/).</span><span class="sxs-lookup"><span data-stu-id="f1c89-266">Azure virtual machines that are backed up through Azure Backup are subject to [Azure Backup pricing](https://azure.microsoft.com/pricing/details/backup/).</span></span> <span data-ttu-id="f1c89-267">Il calcolo delle istanze protette si basa sulle dimensioni *effettive* della macchina virtuale, ovvero sul totale di tutti i dati presenti nella macchina virtuale con esclusione del "disco risorse".</span><span class="sxs-lookup"><span data-stu-id="f1c89-267">The Protected Instances calculation is based on the *actual* size of the virtual machine, which is the sum of all the data in the virtual machine--excluding the “resource disk.”</span></span>

<span data-ttu-id="f1c89-268">I prezzi del backup di macchine virtuali *non* si basano sulla dimensione massima supportata di ogni disco dati collegato alla macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="f1c89-268">Pricing for backing up VMs is *not* based on the maximum supported size for each data disk attached to the virtual machine.</span></span> <span data-ttu-id="f1c89-269">Si basano viceversa sui dati effettivi archiviati nel disco dati.</span><span class="sxs-lookup"><span data-stu-id="f1c89-269">Pricing is based on the actual data stored in the data disk.</span></span> <span data-ttu-id="f1c89-270">Analogamente, la fattura relativa all'archiviazione dei backup è basata sulla quantità di dati archiviata in Backup di Azure, ovvero sul totale dei dati effettivi presenti in ogni punto di ripristino.</span><span class="sxs-lookup"><span data-stu-id="f1c89-270">Similarly, the backup storage bill is based on the amount of data that is stored in Azure Backup, which is the sum of the actual data in each recovery point.</span></span>

<span data-ttu-id="f1c89-271">Si prenda ad esempio una macchina virtuale di dimensioni A2-Standard dotata di due dischi dati aggiuntivi con capacità massima di 1 TB ciascuno.</span><span class="sxs-lookup"><span data-stu-id="f1c89-271">For example, take an A2 Standard-sized virtual machine that has two additional data disks with a maximum size of 1 TB each.</span></span> <span data-ttu-id="f1c89-272">La tabella seguente indica i dati effettivi archiviati in ciascuno di tali dischi:</span><span class="sxs-lookup"><span data-stu-id="f1c89-272">The following table gives the actual data stored on each of these disks:</span></span>

| <span data-ttu-id="f1c89-273">Tipo di disco</span><span class="sxs-lookup"><span data-stu-id="f1c89-273">Disk type</span></span> | <span data-ttu-id="f1c89-274">Dimensioni massime</span><span class="sxs-lookup"><span data-stu-id="f1c89-274">Max size</span></span> | <span data-ttu-id="f1c89-275">Dati effettivi presenti</span><span class="sxs-lookup"><span data-stu-id="f1c89-275">Actual data present</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f1c89-276">Disco del sistema operativo</span><span class="sxs-lookup"><span data-stu-id="f1c89-276">Operating system disk</span></span> |<span data-ttu-id="f1c89-277">1023 GB</span><span class="sxs-lookup"><span data-stu-id="f1c89-277">1023 GB</span></span> |<span data-ttu-id="f1c89-278">17 GB</span><span class="sxs-lookup"><span data-stu-id="f1c89-278">17 GB</span></span> |
| <span data-ttu-id="f1c89-279">Disco locale/Disco risorse</span><span class="sxs-lookup"><span data-stu-id="f1c89-279">Local disk / Resource disk</span></span> |<span data-ttu-id="f1c89-280">135 GB</span><span class="sxs-lookup"><span data-stu-id="f1c89-280">135 GB</span></span> |<span data-ttu-id="f1c89-281">5 GB (non incluso per il backup)</span><span class="sxs-lookup"><span data-stu-id="f1c89-281">5 GB (not included for backup)</span></span> |
| <span data-ttu-id="f1c89-282">Disco dati 1</span><span class="sxs-lookup"><span data-stu-id="f1c89-282">Data disk 1</span></span> |<span data-ttu-id="f1c89-283">1023 GB</span><span class="sxs-lookup"><span data-stu-id="f1c89-283">1023 GB</span></span> |<span data-ttu-id="f1c89-284">30 GB</span><span class="sxs-lookup"><span data-stu-id="f1c89-284">30 GB</span></span> |
| <span data-ttu-id="f1c89-285">Disco dati 2</span><span class="sxs-lookup"><span data-stu-id="f1c89-285">Data disk 2</span></span> |<span data-ttu-id="f1c89-286">1023 GB</span><span class="sxs-lookup"><span data-stu-id="f1c89-286">1023 GB</span></span> |<span data-ttu-id="f1c89-287">0 GB</span><span class="sxs-lookup"><span data-stu-id="f1c89-287">0 GB</span></span> |

<span data-ttu-id="f1c89-288">In questo caso, le dimensioni *effettive* della macchina virtuale sono 17 GB + 30 GB + 0 GB = 47 GB.</span><span class="sxs-lookup"><span data-stu-id="f1c89-288">The *actual* size of the virtual machine in this case is 17 GB + 30 GB + 0 GB = 47 GB.</span></span> <span data-ttu-id="f1c89-289">La dimensione dell'istanza protetta (47 GB) diventa la base della fattura mensile.</span><span class="sxs-lookup"><span data-stu-id="f1c89-289">This Protected Instance size (47 GB) becomes the basis for the monthly bill.</span></span> <span data-ttu-id="f1c89-290">Con l'aumentare della quantità di dati presente nella macchina virtuale, le dimensioni dell'istanza protetta usata per la fatturazione cambiano di conseguenza.</span><span class="sxs-lookup"><span data-stu-id="f1c89-290">As the amount of data in the virtual machine grows, the Protected Instance size used for billing changes accordingly.</span></span>

<span data-ttu-id="f1c89-291">La fatturazione inizia solo dopo il completamento corretto del primo backup.</span><span class="sxs-lookup"><span data-stu-id="f1c89-291">Billing does not start until the first successful backup completes.</span></span> <span data-ttu-id="f1c89-292">A questo punto inizierà la fatturazione sia per le istanze di archiviazione sia per quelle protette.</span><span class="sxs-lookup"><span data-stu-id="f1c89-292">At this point, the billing for both Storage and Protected Instances begins.</span></span> <span data-ttu-id="f1c89-293">La fatturazione continua fino a quando per la macchina virtuale sono presenti *dati di backup archiviati in un insieme di credenziali* .</span><span class="sxs-lookup"><span data-stu-id="f1c89-293">Billing continues as long as there is *any backup data stored in a vault* for the virtual machine.</span></span> <span data-ttu-id="f1c89-294">Se si interrompe la protezione sulla macchina virtuale ma in un insieme di credenziali continuano a essere presenti dati di backup di tale macchina virtuale, la fatturazione continua.</span><span class="sxs-lookup"><span data-stu-id="f1c89-294">If you stop protection on the virtual machine, but virtual machine backup data exists in a vault, billing continues.</span></span>

<span data-ttu-id="f1c89-295">La fatturazione relativa a una macchina virtuale specifica viene interrotta solo se viene interrotta la protezione *e* vengono eliminati i dati di backup.</span><span class="sxs-lookup"><span data-stu-id="f1c89-295">Billing for a specified virtual machine stops only if the protection is stopped *and* all backup data is deleted.</span></span> <span data-ttu-id="f1c89-296">Quando si interrompe la protezione e non vi sono processi di backup attivi, la dimensione dell'ultimo backup della macchina virtuale completato correttamente diventa la dimensione dell'Istanza protetta utilizzata per la fatturazione mensile.</span><span class="sxs-lookup"><span data-stu-id="f1c89-296">When protection stops and there are no active backup jobs, the size of the last successful VM backup becomes the Protected Instance size used for the monthly bill.</span></span>

## <a name="questions"></a><span data-ttu-id="f1c89-297">Domande?</span><span class="sxs-lookup"><span data-stu-id="f1c89-297">Questions?</span></span>
<span data-ttu-id="f1c89-298">In caso di domande o se si vuole che venga inclusa una funzionalità, è possibile [inviare commenti e suggerimenti](http://aka.ms/azurebackup_feedback).</span><span class="sxs-lookup"><span data-stu-id="f1c89-298">If you have questions, or if there is any feature that you would like to see included, [send us feedback](http://aka.ms/azurebackup_feedback).</span></span>

## <a name="next-steps"></a><span data-ttu-id="f1c89-299">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="f1c89-299">Next steps</span></span>
* [<span data-ttu-id="f1c89-300">Eseguire il backup di macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="f1c89-300">Back up virtual machines</span></span>](backup-azure-vms.md)
* [<span data-ttu-id="f1c89-301">Gestire i backup delle macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="f1c89-301">Manage virtual machine backup</span></span>](backup-azure-manage-vms.md)
* [<span data-ttu-id="f1c89-302">Ripristino di macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="f1c89-302">Restore virtual machines</span></span>](backup-azure-restore-vms.md)
* [<span data-ttu-id="f1c89-303">Risolvere i problemi relativi al backup delle macchine virtuali di Azure</span><span class="sxs-lookup"><span data-stu-id="f1c89-303">Troubleshoot VM backup issues</span></span>](backup-azure-vms-troubleshoot.md)
