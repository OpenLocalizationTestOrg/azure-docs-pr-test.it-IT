---
title: "Testabilità: comunicazione tra servizi | Documentazione Microsoft"
description: Le comunicazioni da servizio a servizio sono un punto di integrazione critico di un'applicazione Infrastruttura di servizi. Questo articolo illustra alcune considerazioni di progettazione e tecniche di test.
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: 017557df-fb59-4e4a-a65d-2732f29255b8
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: c182cc2062ada40029504de5b2b64b021c614ce6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="service-fabric-testability-scenarios-service-communication"></a><span data-ttu-id="3c8aa-104">Scenari di Testabilità di Service Fabric: comunicazione tra servizi</span><span class="sxs-lookup"><span data-stu-id="3c8aa-104">Service Fabric testability scenarios: Service communication</span></span>
<span data-ttu-id="3c8aa-105">Gli stili dell'architettura orientata ai microservizi e ai servizi vengono visualizzati naturalmente in Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-105">Microservices and service-oriented architectural styles surface naturally in Azure Service Fabric.</span></span> <span data-ttu-id="3c8aa-106">In questi tipi di architetture distribuite, le applicazioni di microservizi con componenti sono in genere costituite da più servizi che devono comunicare tra loro.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-106">In these types of distributed architectures, componentized microservice applications are typically composed of multiple services that need to talk to each other.</span></span> <span data-ttu-id="3c8aa-107">Anche nei casi più semplici, in genere si ha almeno un servizio Web senza stato e un servizio di archiviazione dei dati con stato che devono comunicare.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-107">In even the simplest cases, you generally have at least a stateless web service and a stateful data storage service that need to communicate.</span></span>

<span data-ttu-id="3c8aa-108">La comunicazione da servizio a servizio è un punto di integrazione critico di un'applicazione, in quanto ogni servizio espone un'API remota ad altri servizi.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-108">Service-to-service communication is a critical integration point of an application, because each service exposes a remote API to other services.</span></span> <span data-ttu-id="3c8aa-109">L'uso di un set di limiti di API che coinvolgono l'I/O richiede in genere particolare attenzione e diverse operazioni di test e di convalida.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-109">Working with a set of API boundaries that involves I/O generally requires some care, with a good amount of testing and validation.</span></span>

<span data-ttu-id="3c8aa-110">Quando questi limiti di servizio sono raggruppati in un sistema distribuito, è necessario fare numerose considerazioni:</span><span class="sxs-lookup"><span data-stu-id="3c8aa-110">There are numerous considerations to make when these service boundaries are wired together in a distributed system:</span></span>

* <span data-ttu-id="3c8aa-111">*Protocollo di trasporto*.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-111">*Transport protocol*.</span></span> <span data-ttu-id="3c8aa-112">Si userà HTTP per una maggiore interoperabilità o un protocollo binario personalizzato per la velocità effettiva massima?</span><span class="sxs-lookup"><span data-stu-id="3c8aa-112">Will you use HTTP for increased interoperability, or a custom binary protocol for maximum throughput?</span></span>
* <span data-ttu-id="3c8aa-113">*Gestione degli errori*.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-113">*Error handling*.</span></span> <span data-ttu-id="3c8aa-114">Come vengono gestiti gli errori permanenti e temporanei?</span><span class="sxs-lookup"><span data-stu-id="3c8aa-114">How will permanent and transient errors be handled?</span></span> <span data-ttu-id="3c8aa-115">Cosa succede quando un servizio viene spostato in un nodo diverso?</span><span class="sxs-lookup"><span data-stu-id="3c8aa-115">What will happen when a service moves to a different node?</span></span>
* <span data-ttu-id="3c8aa-116">*Timeout e latenza*.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-116">*Timeouts and latency*.</span></span> <span data-ttu-id="3c8aa-117">Nelle applicazioni a più livelli in che modo ogni livello di servizio gestirà la latenza nello stack e all'utente?</span><span class="sxs-lookup"><span data-stu-id="3c8aa-117">In multitiered applications, how will each service layer handle latency through the stack and to the user?</span></span>

<span data-ttu-id="3c8aa-118">Sia che venga usato uno dei componenti integrati di comunicazione tra servizi forniti da Service Fabric, sia che ne venga creato uno personalizzato, testare le interazioni tra i servizi è essenziale per garantire resilienza nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-118">Whether you use one of the built-in service communication components provided by Service Fabric or you build your own, testing the interactions between your services is critical to ensuring resiliency in your application.</span></span>

## <a name="prepare-for-services-to-move"></a><span data-ttu-id="3c8aa-119">Preparare lo spostamento dei servizi</span><span class="sxs-lookup"><span data-stu-id="3c8aa-119">Prepare for services to move</span></span>
<span data-ttu-id="3c8aa-120">Le istanze del servizio possono spostarsi nel tempo.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-120">Service instances may move around over time.</span></span> <span data-ttu-id="3c8aa-121">Ciò vale soprattutto se vengono configurate con la metrica di caricamento per il bilanciamento delle risorse ottimizzato personalizzato.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-121">This is especially true when they are configured with load metrics for custom-tailored optimal resource balancing.</span></span> <span data-ttu-id="3c8aa-122">Service Fabric sposta le istanze del servizio per ottimizzare la disponibilità anche durante aggiornamenti, failover, scalabilità e altre situazioni che si verificano nel corso della durata di un sistema distribuito.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-122">Service Fabric moves your service instances to maximize their availability even during upgrades, failovers, scale-out, and other situations that occur over the lifetime of a distributed system.</span></span>

<span data-ttu-id="3c8aa-123">Dal momento che i servizi si spostano all'interno del cluster, i client e gli altri servizi devono essere preparati a gestire due scenari durante la comunicazione con un servizio:</span><span class="sxs-lookup"><span data-stu-id="3c8aa-123">As services move around in the cluster, your clients and other services should be prepared to handle two scenarios when they talk to a service:</span></span>

* <span data-ttu-id="3c8aa-124">L’istanza del servizio o la replica della partizione si è spostata dall’ultima volta in cui si è stabilita una comunicazione.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-124">The service instance or partition replica has moved since the last time you talked to it.</span></span> <span data-ttu-id="3c8aa-125">Si tratta della parte normale del ciclo di vita di un servizio e deve essere prevista nel corso della durata dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-125">This is a normal part of a service lifecycle, and it should be expected to happen during the lifetime of your application.</span></span>
* <span data-ttu-id="3c8aa-126">L’istanza del servizio o la replica della partizione è in fase di spostamento.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-126">The service instance or partition replica is in the process of moving.</span></span> <span data-ttu-id="3c8aa-127">Sebbene in Infrastruttura di servizi il failover di un servizio da un nodo a un altro si verifichi molto rapidamente, potrebbe esserci un ritardo nella disponibilità se il componente di comunicazione del servizio è lento ad avviarsi.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-127">Although failover of a service from one node to another occurs very quickly in Service Fabric, there may be a delay in availability if the communication component of your service is slow to start.</span></span>

<span data-ttu-id="3c8aa-128">La gestione normale di questi scenari è importante per garantire che il sistema funzioni senza problemi.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-128">Handling these scenarios gracefully is important for a smooth-running system.</span></span> <span data-ttu-id="3c8aa-129">A tale scopo, tenere presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="3c8aa-129">To do so, keep in mind that:</span></span>

* <span data-ttu-id="3c8aa-130">Ogni servizio a cui è possibile connettersi ha un *indirizzo* sul quale è in ascolto, ad esempio HTTP o WebSocket.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-130">Every service that can be connected to has an *address* that it listens on (for example, HTTP or WebSockets).</span></span> <span data-ttu-id="3c8aa-131">Quando un'istanza o una partizione del servizio si sposta, il relativo endpoint dell'indirizzo cambia.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-131">When a service instance or partition moves, its address endpoint changes.</span></span> <span data-ttu-id="3c8aa-132">Si sposta in un altro nodo con un indirizzo IP diverso. Se si utilizzano componenti di comunicazione integrati, questi gestiranno automaticamente la nuova risoluzione degli indirizzi del servizio.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-132">(It moves to a different node with a different IP address.) If you're using the built-in communication components, they will handle re-resolving service addresses for you.</span></span>
* <span data-ttu-id="3c8aa-133">Potrebbe esserci un aumento temporaneo della latenza del servizio quando l'istanza del servizio avvia nuovamente il listener.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-133">There may be a temporary increase in service latency as the service instance starts up its listener again.</span></span> <span data-ttu-id="3c8aa-134">Ciò dipende dalla rapidità con cui il servizio apre il listener dopo lo spostamento dell'istanza del servizio.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-134">This depends on how quickly the service opens the listener after the service instance is moved.</span></span>
* <span data-ttu-id="3c8aa-135">Tutte le connessioni esistenti devono essere chiuse e riaperte dopo l'apertura del servizio in un nuovo nodo.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-135">Any existing connections need to be closed and reopened after the service opens on a new node.</span></span> <span data-ttu-id="3c8aa-136">Un arresto o un riavvio normale del nodo consente di attendere che le connessioni esistenti siano arrestate normalmente.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-136">A graceful node shutdown or restart allows time for existing connections to be shut down gracefully.</span></span>

### <a name="test-it-move-service-instances"></a><span data-ttu-id="3c8aa-137">Test: spostare istanze del servizio</span><span class="sxs-lookup"><span data-stu-id="3c8aa-137">Test it: Move service instances</span></span>
<span data-ttu-id="3c8aa-138">Grazie agli strumenti di testabilità di Service Fabric, è possibile creare uno scenario di test per testare queste situazioni in modi diversi:</span><span class="sxs-lookup"><span data-stu-id="3c8aa-138">By using Service Fabric's testability tools, you can author a test scenario to test these situations in different ways:</span></span>

1. <span data-ttu-id="3c8aa-139">Spostare la replica primaria di un servizio con stato.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-139">Move a stateful service's primary replica.</span></span>
   
    <span data-ttu-id="3c8aa-140">La replica primaria di una partizione del servizio con stato può essere spostata per diversi motivi.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-140">The primary replica of a stateful service partition can be moved for any number of reasons.</span></span> <span data-ttu-id="3c8aa-141">Utilizzare questa procedura per la replica primaria di una partizione specifica, per osservare in che modo reagiscono i servizi allo spostamento in modo molto controllato.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-141">Use this to target the primary replica of a specific partition to see how your services react to the move in a very controlled manner.</span></span>
   
    ```powershell
   
    PS > Move-ServiceFabricPrimaryReplica -PartitionId 6faa4ffa-521a-44e9-8351-dfca0f7e0466 -ServiceName fabric:/MyApplication/MyService
   
    ```
2. <span data-ttu-id="3c8aa-142">Arrestare un nodo.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-142">Stop a node.</span></span>
   
    <span data-ttu-id="3c8aa-143">Quando un nodo viene arrestato, Service Fabric sposta tutte le istanze o le partizioni del servizio che erano presenti in quel nodo in uno degli altri nodi disponibili nel cluster.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-143">When a node is stopped, Service Fabric moves all of the service instances or partitions that were on that node to one of the other available nodes in the cluster.</span></span> <span data-ttu-id="3c8aa-144">Usare questa procedura per testare una situazione in cui un nodo viene perso dal cluster e tutte le repliche e le istanze del servizio in tale nodo devono essere spostate.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-144">Use this to test a situation where a node is lost from your cluster and all of the service instances and replicas on that node have to move.</span></span>
   
    <span data-ttu-id="3c8aa-145">È possibile arrestare un nodo tramite il cmdlet di PowerShell **Stop-ServiceFabricNode** :</span><span class="sxs-lookup"><span data-stu-id="3c8aa-145">You can stop a node by using the PowerShell **Stop-ServiceFabricNode** cmdlet:</span></span>
   
    ```powershell
   
    PS > Restart-ServiceFabricNode -NodeName Node_1
   
    ```

## <a name="maintain-service-availability"></a><span data-ttu-id="3c8aa-146">Mantenere la disponibilità del servizio</span><span class="sxs-lookup"><span data-stu-id="3c8aa-146">Maintain service availability</span></span>
<span data-ttu-id="3c8aa-147">Service Fabric è una piattaforma progettata per garantire elevata disponibilità dei servizi.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-147">As a platform, Service Fabric is designed to provide high availability of your services.</span></span> <span data-ttu-id="3c8aa-148">In casi estremi, tuttavia, i problemi dell'infrastruttura sottostante possono comunque causare indisponibilità.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-148">But in extreme cases, underlying infrastructure problems can still cause unavailability.</span></span> <span data-ttu-id="3c8aa-149">È importante testare anche questi scenari.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-149">It is important to test for these scenarios, too.</span></span>

<span data-ttu-id="3c8aa-150">I servizi con stato usano un sistema basato su quorum per la replica dello stato per l'elevata disponibilità.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-150">Stateful services use a quorum-based system to replicate state for high availability.</span></span> <span data-ttu-id="3c8aa-151">Ciò significa che per eseguire le operazioni di scrittura deve essere disponibile un quorum di repliche.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-151">This means that a quorum of replicas needs to be available to perform write operations.</span></span> <span data-ttu-id="3c8aa-152">In rari casi, ad esempio nel caso di errore hardware diffuso, potrebbe non essere disponibile un quorum di repliche.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-152">In rare cases, such as a widespread hardware failure, a quorum of replicas may not be available.</span></span> <span data-ttu-id="3c8aa-153">In questi casi non sarà possibile eseguire operazioni di scrittura, ma sarà possibile eseguire operazioni di lettura.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-153">In these cases, you will not be able to perform write operations, but you will still be able to perform read operations.</span></span>

### <a name="test-it-write-operation-unavailability"></a><span data-ttu-id="3c8aa-154">Test: mancata disponibilità delle operazioni di scrittura</span><span class="sxs-lookup"><span data-stu-id="3c8aa-154">Test it: Write operation unavailability</span></span>
<span data-ttu-id="3c8aa-155">Grazie agli strumenti di testabilità di Service Fabric, è possibile inserire come test un errore che provoca la perdita di quorum.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-155">By using the testability tools in Service Fabric, you can inject a fault that induces quorum loss as a test.</span></span> <span data-ttu-id="3c8aa-156">Sebbene si tratti di uno scenario raro, è importante che i client e i servizi che dipendono da un servizio con stato siano preparati a gestire le situazioni in cui non possono eseguire richieste di scrittura al servizio.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-156">Although such a scenario is rare, it is important that clients and services that depend on a stateful service are prepared to handle situations where they cannot make write requests to it.</span></span> <span data-ttu-id="3c8aa-157">È importante anche che il servizio con stato sia a conoscenza di questa possibilità e sia in grado di comunicarla normalmente ai chiamanti.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-157">It is also important that the stateful service itself is aware of this possibility and can gracefully communicate it to callers.</span></span>

<span data-ttu-id="3c8aa-158">La perdita di quorum può essere indotta mediante il cmdlet di PowerShell **Invoke-ServiceFabricPartitionQuorumLoss** :</span><span class="sxs-lookup"><span data-stu-id="3c8aa-158">You can induce quorum loss by using the PowerShell **Invoke-ServiceFabricPartitionQuorumLoss** cmdlet:</span></span>

```powershell

PS > Invoke-ServiceFabricPartitionQuorumLoss -ServiceName fabric:/Myapplication/MyService -QuorumLossMode QuorumReplicas -QuorumLossDurationInSeconds 20

```

<span data-ttu-id="3c8aa-159">In questo esempio `QuorumLossMode` viene impostato su `QuorumReplicas`, per indicare che si vuole causare la perdita di quorum senza interrompere tutte le repliche.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-159">In this example, we set `QuorumLossMode` to `QuorumReplicas` to indicate that we want to induce quorum loss without taking down all replicas.</span></span> <span data-ttu-id="3c8aa-160">In questo modo è comunque possibile eseguire le operazioni di lettura.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-160">This way, read operations are still possible.</span></span> <span data-ttu-id="3c8aa-161">Per testare uno scenario in cui un'intera partizione non è disponibile, è possibile impostare questa opzione su `AllReplicas`.</span><span class="sxs-lookup"><span data-stu-id="3c8aa-161">To test a scenario where an entire partition is unavailable, you can set this switch to `AllReplicas`.</span></span>

## <a name="next-steps"></a><span data-ttu-id="3c8aa-162">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="3c8aa-162">Next steps</span></span>
[<span data-ttu-id="3c8aa-163">Azioni di Testabilità</span><span class="sxs-lookup"><span data-stu-id="3c8aa-163">Learn more about testability actions</span></span>](service-fabric-testability-actions.md)

[<span data-ttu-id="3c8aa-164">Scenari di Testabilità</span><span class="sxs-lookup"><span data-stu-id="3c8aa-164">Learn more about testability scenarios</span></span>](service-fabric-testability-scenarios.md)

