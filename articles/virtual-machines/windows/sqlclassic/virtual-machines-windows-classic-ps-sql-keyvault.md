---
title: insieme di credenziali di chiave con SQL Server in macchine virtuali di Windows in Azure (versione classica) aaaIntegrate | Documenti Microsoft
description: Informazioni su come tooautomate hello configurazione di crittografia di SQL Server per l'utilizzo con l'insieme di credenziali chiave di Azure. Questo argomento viene illustrato come creare di toouse integrazione dell'insieme di credenziali chiave di Azure con le macchine virtuali di SQL Server nel modello di distribuzione classica hello.
services: virtual-machines-windows
documentationcenter: 
author: rothja
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: ab8d41a7-1971-4032-ab71-eb435c455dc1
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 02/17/2017
ms.author: jroth
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 54664875b76dac7271d5a9f00b3f41fdc9c08491
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="configure-azure-key-vault-integration-for-sql-server-on-azure-virtual-machines-classic"></a><span data-ttu-id="f0b20-104">Configurare l'integrazione di Azure Key Vault per SQL Server in macchine virtuali di Azure (distribuzione classica)</span><span class="sxs-lookup"><span data-stu-id="f0b20-104">Configure Azure Key Vault Integration for SQL Server on Azure Virtual Machines (Classic)</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="f0b20-105">Gestione risorse</span><span class="sxs-lookup"><span data-stu-id="f0b20-105">Resource Manager</span></span>](../sql/virtual-machines-windows-ps-sql-keyvault.md)
> * [<span data-ttu-id="f0b20-106">Classico</span><span class="sxs-lookup"><span data-stu-id="f0b20-106">Classic</span></span>](../classic/ps-sql-keyvault.md)
> 
> 

## <a name="overview"></a><span data-ttu-id="f0b20-107">Panoramica</span><span class="sxs-lookup"><span data-stu-id="f0b20-107">Overview</span></span>
<span data-ttu-id="f0b20-108">Esistono più funzionalità di crittografia di SQL Server, ad esempio [Transparent Data Encryption (TDE)](https://msdn.microsoft.com/library/bb934049.aspx), [crittografia a livello di colonna (CLE)](https://msdn.microsoft.com/library/ms173744.aspx) e [crittografia di backup](https://msdn.microsoft.com/library/dn449489.aspx).</span><span class="sxs-lookup"><span data-stu-id="f0b20-108">There are multiple SQL Server encryption features, such as [transparent data encryption (TDE)](https://msdn.microsoft.com/library/bb934049.aspx), [column level encryption (CLE)](https://msdn.microsoft.com/library/ms173744.aspx), and [backup encryption](https://msdn.microsoft.com/library/dn449489.aspx).</span></span> <span data-ttu-id="f0b20-109">I moduli di crittografia occorre toomanage e archiviano le chiavi di crittografia hello che è utilizzare per la crittografia.</span><span class="sxs-lookup"><span data-stu-id="f0b20-109">These forms of encryption require you toomanage and store hello cryptographic keys you use for encryption.</span></span> <span data-ttu-id="f0b20-110">Hello servizio insieme di credenziali chiave di Azure (insieme) è progettata tooimprove hello sicurezza e la gestione di queste chiavi in una posizione sicura e altamente disponibile.</span><span class="sxs-lookup"><span data-stu-id="f0b20-110">hello Azure Key Vault (AKV) service is designed tooimprove hello security and management of these keys in a secure and highly available location.</span></span> <span data-ttu-id="f0b20-111">Hello [SQL Server Connector](http://www.microsoft.com/download/details.aspx?id=45344) consente di SQL Server toouse queste chiavi dall'insieme di credenziali chiave di Azure.</span><span class="sxs-lookup"><span data-stu-id="f0b20-111">hello [SQL Server Connector](http://www.microsoft.com/download/details.aspx?id=45344) enables SQL Server toouse these keys from Azure Key Vault.</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="f0b20-112">Azure offre due diversi modelli di distribuzione per creare e usare le risorse: [Gestione risorse e la distribuzione classica](../../../azure-resource-manager/resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="f0b20-112">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../azure-resource-manager/resource-manager-deployment-model.md).</span></span> <span data-ttu-id="f0b20-113">In questo articolo viene illustrato l'utilizzo del modello di distribuzione classica hello.</span><span class="sxs-lookup"><span data-stu-id="f0b20-113">This article covers using hello Classic deployment model.</span></span> <span data-ttu-id="f0b20-114">Si consiglia di utilizzano il modello di gestione risorse hello più nuove distribuzioni.</span><span class="sxs-lookup"><span data-stu-id="f0b20-114">Microsoft recommends that most new deployments use hello Resource Manager model.</span></span>

<span data-ttu-id="f0b20-115">Se si esegue SQL Server con il computer locale, esistono [è possibile attenersi alla procedura tooaccess insieme credenziali chiavi Azure dal computer di SQL Server on-premise](https://msdn.microsoft.com/library/dn198405.aspx).</span><span class="sxs-lookup"><span data-stu-id="f0b20-115">If you are running SQL Server with on-premises machines, there are [steps you can follow tooaccess Azure Key Vault from your on-premises SQL Server machine](https://msdn.microsoft.com/library/dn198405.aspx).</span></span> <span data-ttu-id="f0b20-116">Ma per SQL Server in macchine virtuali di Azure, è possibile risparmiare tempo utilizzando hello *integrazione dell'insieme di credenziali chiave di Azure* funzionalità.</span><span class="sxs-lookup"><span data-stu-id="f0b20-116">But for SQL Server in Azure VMs, you can save time by using hello *Azure Key Vault Integration* feature.</span></span> <span data-ttu-id="f0b20-117">Con alcuni tooenable i cmdlet di Azure PowerShell è possibile automatizzare questa funzionalità, hello credenziali delle chiavi di configurazione necessarie per tooaccess una VM SQL.</span><span class="sxs-lookup"><span data-stu-id="f0b20-117">With a few Azure PowerShell cmdlets tooenable this feature, you can automate hello configuration necessary for a SQL VM tooaccess your key vault.</span></span>

<span data-ttu-id="f0b20-118">Quando questa funzionalità è abilitata, automaticamente installa hello connettore SQL Server, configura hello EKM provider tooaccess insieme credenziali chiavi Azure e crea hello credenziali tooallow si tooaccess l'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="f0b20-118">When this feature is enabled, it automatically installs hello SQL Server Connector, configures hello EKM provider tooaccess Azure Key Vault, and creates hello credential tooallow you tooaccess your vault.</span></span> <span data-ttu-id="f0b20-119">Se è stato esaminato passaggi hello hello indicato in precedenza documentazione locale, è possibile vedere che questa funzionalità consente di automatizzare i passaggi 2 e 3.</span><span class="sxs-lookup"><span data-stu-id="f0b20-119">If you looked at hello steps in hello previously mentioned on-premises documentation, you can see that this feature automates steps 2 and 3.</span></span> <span data-ttu-id="f0b20-120">Hello è comunque necessario toodo manualmente è chiavi e l'insieme di credenziali chiave hello toocreate.</span><span class="sxs-lookup"><span data-stu-id="f0b20-120">hello only thing you would still need toodo manually is toocreate hello key vault and keys.</span></span> <span data-ttu-id="f0b20-121">Da qui, hello intero il programma di installazione della VM SQL è automatizzato.</span><span class="sxs-lookup"><span data-stu-id="f0b20-121">From there, hello entire setup of your SQL VM is automated.</span></span> <span data-ttu-id="f0b20-122">Quando questa funzionalità viene completato il programma di installazione, è possibile eseguire toobegin istruzioni T-SQL la crittografia del database o backup in modo analogo.</span><span class="sxs-lookup"><span data-stu-id="f0b20-122">Once this feature has completed this setup, you can execute T-SQL statements toobegin encrypting your databases or backups as you normally would.</span></span>

[!INCLUDE [AKV Integration Prepare](../../../../includes/virtual-machines-sql-server-akv-prepare.md)]

## <a name="configure-akv-integration"></a><span data-ttu-id="f0b20-123">Configurare l'integrazione di AKV</span><span class="sxs-lookup"><span data-stu-id="f0b20-123">Configure AKV Integration</span></span>
<span data-ttu-id="f0b20-124">Utilizzare PowerShell tooconfigure integrazione dell'insieme di credenziali chiave di Azure.</span><span class="sxs-lookup"><span data-stu-id="f0b20-124">Use PowerShell tooconfigure Azure Key Vault Integration.</span></span> <span data-ttu-id="f0b20-125">Hello le sezioni seguenti fornisce una panoramica dei parametri di hello necessarie e quindi un esempio di script di PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f0b20-125">hello following sections provide an overview of hello required parameters and then a sample PowerShell script.</span></span>

### <a name="install-hello-sql-server-iaas-extension"></a><span data-ttu-id="f0b20-126">Installare l'estensione di SQL Server IaaS hello</span><span class="sxs-lookup"><span data-stu-id="f0b20-126">Install hello SQL Server IaaS Extension</span></span>
<span data-ttu-id="f0b20-127">Prima di tutto, [installare estensione di SQL Server IaaS hello](../classic/sql-server-agent-extension.md).</span><span class="sxs-lookup"><span data-stu-id="f0b20-127">First, [install hello SQL Server IaaS Extension](../classic/sql-server-agent-extension.md).</span></span>

### <a name="understand-hello-input-parameters"></a><span data-ttu-id="f0b20-128">Comprendere i parametri di input hello</span><span class="sxs-lookup"><span data-stu-id="f0b20-128">Understand hello input parameters</span></span>
<span data-ttu-id="f0b20-129">Hello seguente tabella elenca hello parametri necessari script di PowerShell toorun hello nella sezione successiva hello.</span><span class="sxs-lookup"><span data-stu-id="f0b20-129">hello following table lists hello parameters required toorun hello PowerShell script in hello next section.</span></span>

| <span data-ttu-id="f0b20-130">.</span><span class="sxs-lookup"><span data-stu-id="f0b20-130">Parameter</span></span> | <span data-ttu-id="f0b20-131">Descrizione</span><span class="sxs-lookup"><span data-stu-id="f0b20-131">Description</span></span> | <span data-ttu-id="f0b20-132">Esempio</span><span class="sxs-lookup"><span data-stu-id="f0b20-132">Example</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f0b20-133">**$akvURL**</span><span class="sxs-lookup"><span data-stu-id="f0b20-133">**$akvURL**</span></span> |<span data-ttu-id="f0b20-134">**URL dell'insieme di credenziali chiave Hello**</span><span class="sxs-lookup"><span data-stu-id="f0b20-134">**hello key vault URL**</span></span> |<span data-ttu-id="f0b20-135">"https://contosokeyvault.vault.azure.net/"</span><span class="sxs-lookup"><span data-stu-id="f0b20-135">"https://contosokeyvault.vault.azure.net/"</span></span> |
| <span data-ttu-id="f0b20-136">**$spName**</span><span class="sxs-lookup"><span data-stu-id="f0b20-136">**$spName**</span></span> |<span data-ttu-id="f0b20-137">**Nome entità servizio**</span><span class="sxs-lookup"><span data-stu-id="f0b20-137">**Service Principal name**</span></span> |<span data-ttu-id="f0b20-138">"fde2b411-33d5-4e11-af04eb07b669ccf2"</span><span class="sxs-lookup"><span data-stu-id="f0b20-138">"fde2b411-33d5-4e11-af04eb07b669ccf2"</span></span> |
| <span data-ttu-id="f0b20-139">**$spSecret**</span><span class="sxs-lookup"><span data-stu-id="f0b20-139">**$spSecret**</span></span> |<span data-ttu-id="f0b20-140">**Segreto entità servizio**</span><span class="sxs-lookup"><span data-stu-id="f0b20-140">**Service Principal secret**</span></span> |<span data-ttu-id="f0b20-141">"9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM="</span><span class="sxs-lookup"><span data-stu-id="f0b20-141">"9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM="</span></span> |
| <span data-ttu-id="f0b20-142">**$credName**</span><span class="sxs-lookup"><span data-stu-id="f0b20-142">**$credName**</span></span> |<span data-ttu-id="f0b20-143">**Nome delle credenziali**: integrazione AKV crea una credenziale all'interno di SQL Server, consentendo di hello VM toohave accesso toohello chiave dell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="f0b20-143">**Credential name**: AKV Integration creates a credential within SQL Server, allowing hello VM toohave access toohello key vault.</span></span> <span data-ttu-id="f0b20-144">Scegliere un nome per la credenziale.</span><span class="sxs-lookup"><span data-stu-id="f0b20-144">Choose a name for this credential.</span></span> |<span data-ttu-id="f0b20-145">"mycred1"</span><span class="sxs-lookup"><span data-stu-id="f0b20-145">"mycred1"</span></span> |
| <span data-ttu-id="f0b20-146">**$vmName**</span><span class="sxs-lookup"><span data-stu-id="f0b20-146">**$vmName**</span></span> |<span data-ttu-id="f0b20-147">**Nome della macchina virtuale**: nome hello di una VM SQL creato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="f0b20-147">**Virtual machine name**: hello name of a previously created SQL VM.</span></span> |<span data-ttu-id="f0b20-148">"myvmname"</span><span class="sxs-lookup"><span data-stu-id="f0b20-148">"myvmname"</span></span> |
| <span data-ttu-id="f0b20-149">**$serviceName**</span><span class="sxs-lookup"><span data-stu-id="f0b20-149">**$serviceName**</span></span> |<span data-ttu-id="f0b20-150">**Nome del servizio**: nome del servizio Cloud hello associato hello SQL VM.</span><span class="sxs-lookup"><span data-stu-id="f0b20-150">**Service name**: hello Cloud Service name that is associated with hello SQL VM.</span></span> |<span data-ttu-id="f0b20-151">"mycloudservicename"</span><span class="sxs-lookup"><span data-stu-id="f0b20-151">"mycloudservicename"</span></span> |

### <a name="enable-akv-integration-with-powershell"></a><span data-ttu-id="f0b20-152">Abilitare l'integrazione di AKV con PowerShell</span><span class="sxs-lookup"><span data-stu-id="f0b20-152">Enable AKV Integration with PowerShell</span></span>
<span data-ttu-id="f0b20-153">Hello **New AzureVMSqlServerKeyVaultCredentialConfig** cmdlet crea un oggetto di configurazione per la funzionalità di integrazione dell'insieme di credenziali chiave di Azure hello.</span><span class="sxs-lookup"><span data-stu-id="f0b20-153">hello **New-AzureVMSqlServerKeyVaultCredentialConfig** cmdlet creates a configuration object for hello Azure Key Vault Integration feature.</span></span> <span data-ttu-id="f0b20-154">Hello **Set AzureVMSqlServerExtension** consente di configurare l'integrazione con hello **KeyVaultCredentialSettings** parametro.</span><span class="sxs-lookup"><span data-stu-id="f0b20-154">hello **Set-AzureVMSqlServerExtension** configures this integration with hello **KeyVaultCredentialSettings** parameter.</span></span> <span data-ttu-id="f0b20-155">Hello seguente procedura mostra come toouse questi comandi.</span><span class="sxs-lookup"><span data-stu-id="f0b20-155">hello following steps show how toouse these commands.</span></span>

1. <span data-ttu-id="f0b20-156">In Azure PowerShell, configurare i parametri di input hello con i valori specifici come descritto nelle sezioni precedenti di hello di questo argomento.</span><span class="sxs-lookup"><span data-stu-id="f0b20-156">In Azure PowerShell, first configure hello input parameters with your specific values as described in hello previous sections of this topic.</span></span> <span data-ttu-id="f0b20-157">Hello lo script seguente è riportato un esempio.</span><span class="sxs-lookup"><span data-stu-id="f0b20-157">hello following script is an example.</span></span>
   
        $akvURL = "https://contosokeyvault.vault.azure.net/"
        $spName = "fde2b411-33d5-4e11-af04eb07b669ccf2"
        $spSecret = "9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM="
        $credName = "mycred1"
        $vmName = "myvmname"
        $serviceName = "mycloudservicename"
2. <span data-ttu-id="f0b20-158">Quindi seguito hello utilizzare script tooconfigure e abilita l'integrazione di insieme.</span><span class="sxs-lookup"><span data-stu-id="f0b20-158">Then use hello following script tooconfigure and enable AKV Integration.</span></span>
   
        $secureakv =  $spSecret | ConvertTo-SecureString -AsPlainText -Force
        $akvs = New-AzureVMSqlServerKeyVaultCredentialConfig -Enable -CredentialName $credname -AzureKeyVaultUrl $akvURL -ServicePrincipalName $spName -ServicePrincipalSecret $secureakv
        Get-AzureVM -ServiceName $serviceName -Name $vmName | Set-AzureVMSqlServerExtension -KeyVaultCredentialSettings $akvs | Update-AzureVM

<span data-ttu-id="f0b20-159">Hello estensione SQL IaaS Agent aggiornerà hello VM SQL con questa nuova configurazione.</span><span class="sxs-lookup"><span data-stu-id="f0b20-159">hello SQL IaaS Agent Extension will update hello SQL VM with this new configuration.</span></span>

[!INCLUDE [AKV Integration Next Steps](../../../../includes/virtual-machines-sql-server-akv-next-steps.md)]

