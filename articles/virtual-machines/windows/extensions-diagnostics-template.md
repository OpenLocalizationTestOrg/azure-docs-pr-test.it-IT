---
title: aaaAdd tooan di monitoraggio e diagnostica macchina virtuale di Azure | Documenti Microsoft
description: Utilizzare un toocreate modello di gestione risorse di Azure una nuova macchina virtuale Windows con estensione diagnostica di Azure.
services: virtual-machines-windows
documentationcenter: 
author: sbtron
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 8cde8fe7-977b-43d2-be74-ad46dc946058
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 05/31/2017
ms.author: saurabh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: d8a831421a0f9d38c09d51cf8c2e6dff913c77ff
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="use-monitoring-and-diagnostics-with-a-windows-vm-and-azure-resource-manager-templates"></a><span data-ttu-id="423f8-103">Usare monitoraggio e diagnostica con una macchina virtuale Windows e modelli di Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="423f8-103">Use monitoring and diagnostics with a Windows VM and Azure Resource Manager templates</span></span>
<span data-ttu-id="423f8-104">Hello estensione diagnostica di Azure fornisce il monitoraggio di hello e funzionalità di diagnostica in un Windows basato su macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="423f8-104">hello Azure Diagnostics Extension provides hello monitoring and diagnostics capabilities on a Windows based Azure virtual machine.</span></span> <span data-ttu-id="423f8-105">È possibile abilitare queste funzionalità nella macchina virtuale hello includendo l'estensione hello come parte del modello di gestione risorse di azure hello.</span><span class="sxs-lookup"><span data-stu-id="423f8-105">You can enable these capabilities on hello virtual machine by including hello extension as part of hello azure resource manager template.</span></span> <span data-ttu-id="423f8-106">Per altre informazioni sull'inclusione di un'estensione come parte di un modello di macchina virtuale, vedere [Creazione di modelli di Gestione risorse di Azure con le estensioni di macchina virtuale](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) .</span><span class="sxs-lookup"><span data-stu-id="423f8-106">See [Authoring Azure Resource Manager Templates with VM Extensions](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) for more information on including any extension as part of a virtual machine template.</span></span> <span data-ttu-id="423f8-107">Questo articolo descrive come è possibile aggiungere il modello di macchina virtuale windows hello diagnostica Azure estensione tooa.</span><span class="sxs-lookup"><span data-stu-id="423f8-107">This article describes how you can add hello Azure Diagnostics extension tooa windows virtual machine template.</span></span>  

## <a name="add-hello-azure-diagnostics-extension-toohello-vm-resource-definition"></a><span data-ttu-id="423f8-108">Aggiungere la definizione di risorsa VM hello diagnostica Azure estensione toohello</span><span class="sxs-lookup"><span data-stu-id="423f8-108">Add hello Azure Diagnostics extension toohello VM resource definition</span></span>
<span data-ttu-id="423f8-109">estensione di diagnostica tooenable hello nella macchina virtuale Windows è necessario estensione hello tooadd come una risorsa di macchina virtuale in hello il modello di gestione di risorse.</span><span class="sxs-lookup"><span data-stu-id="423f8-109">tooenable hello diagnostics extension on a Windows Virtual Machine you need tooadd hello extension as a VM resource in hello Resource manager template.</span></span>

<span data-ttu-id="423f8-110">Per un semplice gestore di risorse basato su macchina virtuale aggiunta hello estensione configurazione toohello *risorse* matrice hello macchina virtuale:</span><span class="sxs-lookup"><span data-stu-id="423f8-110">For a simple Resource Manager based Virtual Machine add hello extension configuration toohello *resources* array for hello Virtual Machine:</span></span> 

    "resources": [
                {
                    "name": "Microsoft.Insights.VMDiagnosticsSettings",
                    "type": "extensions",
                    "location": "[resourceGroup().location]",
                    "apiVersion": "2015-06-15",
                    "dependsOn": [
                        "[concat('Microsoft.Compute/virtualMachines/', variables('vmName'))]"
                    ],
                    "tags": {
                        "displayName": "AzureDiagnostics"
                    },
                    "properties": {
                        "publisher": "Microsoft.Azure.Diagnostics",
                        "type": "IaaSDiagnostics",
                        "typeHandlerVersion": "1.5",
                        "autoUpgradeMinorVersion": true,
                        "settings": {
                            "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), variables('vmName'), variables('wadcfgxend')))]",
                            "storageAccount": "[parameters('existingdiagnosticsStorageAccountName')]"
                        },
                        "protectedSettings": {
                            "storageAccountName": "[parameters('existingdiagnosticsStorageAccountName')]",
                            "storageAccountKey": "[listkeys(variables('accountid'), '2015-05-01-preview').key1]",
                            "storageAccountEndPoint": "https://core.windows.net"
                        }
                    }
                }
            ]


<span data-ttu-id="423f8-111">Un'altra convenzione comune viene aggiunta una configurazione estensione hello al nodo di risorse hello radice del modello di hello anziché definirla in nodo risorse della macchina virtuale hello.</span><span class="sxs-lookup"><span data-stu-id="423f8-111">Another common convention is add hello extension configuration at hello root resources node of hello template instead of defining it under hello virtual machine's resources node.</span></span> <span data-ttu-id="423f8-112">Con questo approccio è necessario tooexplicitly specificare una relazione gerarchica tra estensione hello e macchina virtuale hello con hello *nome* e *tipo* valori.</span><span class="sxs-lookup"><span data-stu-id="423f8-112">With this approach you have tooexplicitly specify a hierarchical relation between hello extension and hello virtual machine with hello *name* and *type* values.</span></span> <span data-ttu-id="423f8-113">ad esempio:</span><span class="sxs-lookup"><span data-stu-id="423f8-113">For example:</span></span> 

    "name": "[concat(variables('vmName'),'Microsoft.Insights.VMDiagnosticsSettings')]",
    "type": "Microsoft.Compute/virtualMachines/extensions",

<span data-ttu-id="423f8-114">estensione Hello è sempre associata a una macchina virtuale hello, è possibile sia direttamente definire direttamente nel nodo risorse della macchina virtuale hello o definirlo a livello di base hello e utilizzare hello tooassociate gerarchica convenzione di denominazione con hello virtuale macchina.</span><span class="sxs-lookup"><span data-stu-id="423f8-114">hello extension is always associated with hello virtual machine, you can either directly define it under hello virtual machine's resource node directly or define it at hello base level and use hello hierarchical naming convention tooassociate it with hello virtual machine.</span></span>

<span data-ttu-id="423f8-115">Per le estensioni di set di scalabilità di macchine virtuali hello configurazione viene specificata in hello *extensionProfile* proprietà di hello *VirtualMachineProfile*.</span><span class="sxs-lookup"><span data-stu-id="423f8-115">For Virtual Machine Scale Sets hello extensions configuration is specified in hello *extensionProfile* property of hello *VirtualMachineProfile*.</span></span>

<span data-ttu-id="423f8-116">Hello *publisher* proprietà con valore hello **Microsoft.Azure.Diagnostics** hello e *tipo* proprietà con valore hello **IaaSDiagnostics** identificare in modo univoco l'estensione di diagnostica Azure hello.</span><span class="sxs-lookup"><span data-stu-id="423f8-116">hello *publisher* property with hello value of **Microsoft.Azure.Diagnostics** and hello *type* property with hello value of **IaaSDiagnostics** uniquely identify hello Azure Diagnostics extension.</span></span>

<span data-ttu-id="423f8-117">valore di hello Hello *nome* proprietà può essere utilizzato toorefer toohello estensione nel gruppo di risorse hello.</span><span class="sxs-lookup"><span data-stu-id="423f8-117">hello value of hello *name* property can be used toorefer toohello extension in hello resource group.</span></span> <span data-ttu-id="423f8-118">Impostarlo in modo specifico troppo**Microsoft.Insights.VMDiagnosticsSettings** consentirà di toobe facilmente identificato da hello garantire portale Azure che hello monitoraggio grafici visualizzati correttamente in hello portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="423f8-118">Setting it specifically too**Microsoft.Insights.VMDiagnosticsSettings** will enable it toobe easily identified by hello Azure portal ensuring that hello monitoring charts show up correctly in hello Azure portal.</span></span>

<span data-ttu-id="423f8-119">Hello *typeHandlerVersion* specifica versione di hello dell'estensione hello desideri toouse.</span><span class="sxs-lookup"><span data-stu-id="423f8-119">hello *typeHandlerVersion* specifies hello version of hello extension you would like toouse.</span></span> <span data-ttu-id="423f8-120">Impostazione *autoUpgradeMinorVersion* la versione secondaria troppo**true** assicura che si otterranno versione secondaria più recente di hello di estensione hello è disponibile.</span><span class="sxs-lookup"><span data-stu-id="423f8-120">Setting *autoUpgradeMinorVersion* minor version too**true** ensures that you will get hello latest Minor version of hello extension that is available.</span></span> <span data-ttu-id="423f8-121">È consigliabile impostare sempre *autoUpgradeMinorVersion* tooalways essere **true** in modo che sia sempre possibile ottenere toouse hello più recente disponibile estensione di diagnostica con tutti i bug e le nuove funzionalità di hello correzioni.</span><span class="sxs-lookup"><span data-stu-id="423f8-121">It is highly recommended that you always set *autoUpgradeMinorVersion* tooalways be **true** so that you always get toouse hello latest available diagnostics extension with all hello new features and bug fixes.</span></span> 

<span data-ttu-id="423f8-122">Hello *impostazioni* elemento contiene una proprietà di configurazione per l'estensione hello che può essere impostato e leggere da estensione hello (talvolta definito tooas pubblica configurazione).</span><span class="sxs-lookup"><span data-stu-id="423f8-122">hello *settings* element contains configurations properties for hello extension that can be set and read back from hello extension (sometimes referred tooas public configuration).</span></span> <span data-ttu-id="423f8-123">Hello *xmlcfg* proprietà contiene una configurazione basata su xml per i registri di diagnostica hello, i contatori delle prestazioni e così via che verranno raccolte dall'agente di diagnostica hello.</span><span class="sxs-lookup"><span data-stu-id="423f8-123">hello *xmlcfg* property contains xml based configuration for hello diagnostics logs, performance counters etc that will be collected by hello diagnostics agent.</span></span> <span data-ttu-id="423f8-124">Vedere [dello Schema di configurazione di diagnostica](https://msdn.microsoft.com/library/azure/dn782207.aspx) per ulteriori informazioni sullo schema xml hello stesso.</span><span class="sxs-lookup"><span data-stu-id="423f8-124">See [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for more information about hello xml schema itself.</span></span> <span data-ttu-id="423f8-125">Una pratica comune è toostore hello effettivo xml di configurazione come una variabile nel modello di gestione risorse di Azure hello e quindi concatenate e base64 codificarli valore hello tooset per *xmlcfg*.</span><span class="sxs-lookup"><span data-stu-id="423f8-125">A common practice is toostore hello actual xml configuration as a variable in hello Azure Resource Manager template and then concatenate and base64 encode them tooset hello value for *xmlcfg*.</span></span> <span data-ttu-id="423f8-126">Vedere la sezione hello [variabili di configurazione di diagnostica](#diagnostics-configuration-variables) toounderstand ulteriori informazioni sulla modalità toostore hello xml nelle variabili.</span><span class="sxs-lookup"><span data-stu-id="423f8-126">See hello section on [diagnostics configuration variables](#diagnostics-configuration-variables) toounderstand more about how toostore hello xml in variables.</span></span> <span data-ttu-id="423f8-127">Hello *storageAccount* proprietà specifica il nome di hello hello storage account toowhich dei dati di diagnostica verrà trasferito.</span><span class="sxs-lookup"><span data-stu-id="423f8-127">hello *storageAccount* property specifies hello name of hello storage account toowhich diagnostics data will be transferred.</span></span> 

<span data-ttu-id="423f8-128">proprietà Hello *protectedSettings* (configurazione privata tooas talvolta definito) può essere impostata ma non è possibile leggere nuovamente dopo l'impostazione.</span><span class="sxs-lookup"><span data-stu-id="423f8-128">hello properties in *protectedSettings* (sometimes referred tooas private configuration) can be set but cannot be read back after being set.</span></span> <span data-ttu-id="423f8-129">Hello natura di sola scrittura di *protectedSettings* risulta utile per l'archiviazione di segreti come chiave dell'account di archiviazione hello in cui verranno scritti i dati di diagnostica hello.</span><span class="sxs-lookup"><span data-stu-id="423f8-129">hello write-only nature of *protectedSettings* makes it useful for storing secrets like hello storage account key where hello diagnostics data will be written.</span></span>    

## <a name="specifying-diagnostics-storage-account-as-parameters"></a><span data-ttu-id="423f8-130">Specificare l'account di archiviazione di diagnostica come parametro</span><span class="sxs-lookup"><span data-stu-id="423f8-130">Specifying diagnostics storage account as parameters</span></span>
<span data-ttu-id="423f8-131">Hello diagnostica estensione json frammento di codice precedente presuppone che i due parametri *existingdiagnosticsStorageAccountName* e *existingdiagnosticsStorageResourceGroup* diagnostica hello toospecify account di archiviazione in cui verranno archiviati i dati di diagnostica.</span><span class="sxs-lookup"><span data-stu-id="423f8-131">hello diagnostics extension json snippet above assumes two parameters *existingdiagnosticsStorageAccountName* and *existingdiagnosticsStorageResourceGroup* toospecify hello diagnostics storage account where diagnostics data will be stored.</span></span> <span data-ttu-id="423f8-132">Specifica account di archiviazione di diagnostica hello come parametro, account di archiviazione di diagnostica hello toochange semplice tra ambienti diversi, ad esempio è toouse un account di archiviazione di diagnostica diversi per i test e uno per il distribuzione di produzione.</span><span class="sxs-lookup"><span data-stu-id="423f8-132">Specifying hello diagnostics storage account as a parameter makes it easy toochange hello diagnostics storage account across different environments e.g. you may want toouse a different diagnostics storage account for testing and a different one for your production deployment.</span></span>  

        "existingdiagnosticsStorageAccountName": {
            "type": "string",
            "metadata": {
        "description": "hello name of an existing storage account toowhich diagnostics data will be transfered."
            }        
        },
        "existingdiagnosticsStorageResourceGroup": {
            "type": "string",
            "metadata": {
        "description": "hello resource group for hello storage account specified in existingdiagnosticsStorageAccountName"
              }
        }

<span data-ttu-id="423f8-133">Si tratta di best practice toospecify un account di archiviazione di diagnostica in un gruppo di risorse diverso rispetto a gruppo di risorse hello per la macchina virtuale hello.</span><span class="sxs-lookup"><span data-stu-id="423f8-133">It is best practice toospecify a diagnostics storage account in a different resource group than hello resource group for hello virtual machine.</span></span> <span data-ttu-id="423f8-134">Un gruppo di risorse può essere considerato come un'unità di distribuzione con il proprio ciclo di vita toobe, una macchina virtuale può essere distribuita e ridistribuita come nuovi aggiornamenti di configurazioni vengono apportati tooit ma è opportuno archiviare i dati di diagnostica hello in hello toocontinue stesso account di archiviazione in tali distribuzioni di macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="423f8-134">A resource group can be considered toobe a deployment unit with its own lifetime, a virtual machine can be deployed and redeployed as new configurations updates are made it tooit but you may want toocontinue storing hello diagnostics data in hello same storage account across those virtual machine deployments.</span></span> <span data-ttu-id="423f8-135">Con l'account di archiviazione hello in una risorsa diversa Abilita hello archiviazione account tooaccept di dati da varie distribuzioni di macchine virtuali, rendendo semplice tootroubleshoot problemi tra hello diverse versioni.</span><span class="sxs-lookup"><span data-stu-id="423f8-135">Having hello storage account in a different resource enables hello storage account tooaccept data from various virtual machine deployments making it easy tootroubleshoot issues across hello various versions.</span></span>

> [!NOTE]
> <span data-ttu-id="423f8-136">Se si crea un modello di macchina virtuale windows da Visual Studio potrebbe essere impostato l'account di archiviazione predefinito hello toouse hello stesso account di archiviazione in cui viene caricato hello VHD della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="423f8-136">If you create a windows virtual machine template from Visual Studio hello default storage account might be set toouse hello same storage account where hello virtual machine VHD is uploaded.</span></span> <span data-ttu-id="423f8-137">Si tratta di toosimplify la configurazione iniziale di VM hello.</span><span class="sxs-lookup"><span data-stu-id="423f8-137">This is toosimplify initial setup of hello VM.</span></span> <span data-ttu-id="423f8-138">È quindi consigliabile valutare nuovamente hello modello toouse un account di archiviazione diversi che può essere passato come parametro.</span><span class="sxs-lookup"><span data-stu-id="423f8-138">You should re-factor hello template toouse a different storage account that can be passed in as a parameter.</span></span> 
> 
> 

## <a name="diagnostics-configuration-variables"></a><span data-ttu-id="423f8-139">variabili di configurazione diagnostica</span><span class="sxs-lookup"><span data-stu-id="423f8-139">Diagnostics configuration variables</span></span>
<span data-ttu-id="423f8-140">Hello diagnostica estensione frammento di codice json precedente definisce un *accountid* toosimplify variabile recupero chiave dell'account di archiviazione per l'archiviazione di diagnostica hello hello:</span><span class="sxs-lookup"><span data-stu-id="423f8-140">hello diagnostics extension json snippet above defines an *accountid* variable toosimplify getting hello storage account key for hello diagnostics storage:</span></span>   

    "accountid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/',parameters('existingdiagnosticsStorageResourceGroup'), '/providers/','Microsoft.Storage/storageAccounts/', parameters('existingdiagnosticsStorageAccountName'))]"


<span data-ttu-id="423f8-141">Hello *xmlcfg* proprietà per l'estensione diagnostica hello è definito usando più variabili che vengono concatenate.</span><span class="sxs-lookup"><span data-stu-id="423f8-141">hello *xmlcfg* property for hello diagnostics extension is defined using multiple variables that are concatenated together.</span></span> <span data-ttu-id="423f8-142">valori Hello di queste variabili sono in xml, pertanto è necessario toobe escape correttamente quando si impostano le variabili di hello json.</span><span class="sxs-lookup"><span data-stu-id="423f8-142">hello values of these variables are in xml so they need toobe escaped correctly when setting hello json variables.</span></span>

<span data-ttu-id="423f8-143">di seguito Hello sono file xml di configurazione diagnostica hello che raccoglie i contatori delle prestazioni a livello di sistema standard insieme alcuni registri eventi di windows e i registri infrastruttura diagnostica.</span><span class="sxs-lookup"><span data-stu-id="423f8-143">hello following describes hello diagnostics configuration xml that collects standard system level performance counters along with some windows event logs and diagnostics infrastructure logs.</span></span> <span data-ttu-id="423f8-144">È stato sequenza di escape e formattato correttamente in modo che hello configurazione possibile direttamente incollare nella sezione variabili hello del modello.</span><span class="sxs-lookup"><span data-stu-id="423f8-144">It has been escaped and formatted correctly so that hello configuration can directly be pasted into hello variables section of your template.</span></span> <span data-ttu-id="423f8-145">Vedere hello [dello Schema di configurazione di diagnostica](https://msdn.microsoft.com/library/azure/dn782207.aspx) per un esempio più risorse umano leggibile di hello configurazione xml.</span><span class="sxs-lookup"><span data-stu-id="423f8-145">See hello [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for a more human readable example of hello configuration xml.</span></span>

        "wadlogs": "<WadCfg> <DiagnosticMonitorConfiguration overallQuotaInMB=\"4096\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\"> <DiagnosticInfrastructureLogs scheduledTransferLogLevelFilter=\"Error\"/> <WindowsEventLog scheduledTransferPeriod=\"PT1M\" > <DataSource name=\"Application!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"Security!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"System!*[System[(Level = 1 or Level = 2)]]\" /></WindowsEventLog>",
        "wadperfcounters1": "<PerformanceCounters scheduledTransferPeriod=\"PT1M\"><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU utilization\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Privileged Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU privileged time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% User Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU user time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor Information(_Total)\\Processor Frequency\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"CPU frequency\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\System\\Processes\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Processes\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Thread Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Threads\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Handle Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Handles\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\% Committed Bytes In Use\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Memory usage\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Available Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory available\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Committed Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory committed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Commit Limit\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory commit limit\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active time\" locale=\"en-us\"/></PerformanceCounterConfiguration>",
        "wadperfcounters2": "<PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Read Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active read time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Write Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active write time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Transfers/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Reads/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk read operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Writes/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk write operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Read Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk read speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Write Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk write speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\LogicalDisk(_Total)\\% Free Space\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk free space (percentage)\" locale=\"en-us\"/></PerformanceCounterConfiguration></PerformanceCounters>",
        "wadcfgxstart": "[concat(variables('wadlogs'), variables('wadperfcounters1'), variables('wadperfcounters2'), '<Metrics resourceId=\"')]",
        "wadmetricsresourceid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name , '/providers/', 'Microsoft.Compute/virtualMachines/')]",
        "wadcfgxend": "\"><MetricAggregation scheduledTransferPeriod=\"PT1H\"/><MetricAggregation scheduledTransferPeriod=\"PT1M\"/></Metrics></DiagnosticMonitorConfiguration></WadCfg>"

<span data-ttu-id="423f8-146">nodo xml di definizione Hello metriche in hello di sopra di configurazione è un elemento di configurazione importanti poiché consente di definire come i contatori delle prestazioni di hello definite in precedenza nel codice xml hello *PerformanceCounter* nodo verrà aggregato e archiviati.</span><span class="sxs-lookup"><span data-stu-id="423f8-146">hello Metrics definition xml node in hello above configuration is an important configuration element as it defines how hello performance counters defined earlier in hello xml in *PerformanceCounter* node will be aggregated and stored.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="423f8-147">Queste metriche unità hello avvisi nel portale di Azure hello e grafici di monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="423f8-147">These metrics drive hello monitoring charts and alerts in hello Azure portal.</span></span>  <span data-ttu-id="423f8-148">Hello **metriche** nodo con hello *resourceID* e **MetricAggregation** deve essere incluso nella configurazione della diagnostica hello per la macchina virtuale, se si desidera toosee hello VM dati di monitoraggio di hello portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="423f8-148">hello **Metrics** node with hello *resourceID* and **MetricAggregation** must be included in hello diagnostics configuration for your VM if you want toosee hello VM monitoring data in hello Azure portal.</span></span> 
> 
> 

<span data-ttu-id="423f8-149">Hello Ecco un esempio di codice xml di hello per le definizioni delle metriche:</span><span class="sxs-lookup"><span data-stu-id="423f8-149">hello following is an example of hello xml for metrics definitions:</span></span> 

        <Metrics resourceId="/subscriptions/subscription().subscriptionId/resourceGroups/resourceGroup().name/providers/Microsoft.Compute/virtualMachines/vmName">
            <MetricAggregation scheduledTransferPeriod="PT1H"/>
            <MetricAggregation scheduledTransferPeriod="PT1M"/>
        </Metrics>

<span data-ttu-id="423f8-150">Hello *resourceID* hello di macchina virtuale nella sottoscrizione che identifica in modo univoco.</span><span class="sxs-lookup"><span data-stu-id="423f8-150">hello *resourceID* attribute uniquely identifies hello virtual machine in your subscription.</span></span> <span data-ttu-id="423f8-151">Assicurarsi che toouse hello subscription() e resourceGroup() funziona in modo che hello modello aggiorna automaticamente i valori in base hello sottoscrizione e della risorsa gruppo di che distribuzione.</span><span class="sxs-lookup"><span data-stu-id="423f8-151">Make sure toouse hello subscription() and resourceGroup() functions so that hello template automatically updates those values based on hello subscription and resource group you are deploying to.</span></span>

<span data-ttu-id="423f8-152">Se si siano creando più macchine virtuali in un ciclo, si disporrà di hello toopopulate *resourceID* valore con un toocorrectly funzione copyIndex() distinguere ogni singole macchine Virtuali.</span><span class="sxs-lookup"><span data-stu-id="423f8-152">If you are creating multiple Virtual Machines in a loop then you will have toopopulate hello *resourceID* value with an copyIndex() function toocorrectly differentiate each individual VM.</span></span> <span data-ttu-id="423f8-153">Hello *xmlCfg* valore può essere aggiornato toosupport questo come segue:</span><span class="sxs-lookup"><span data-stu-id="423f8-153">hello *xmlCfg* value can be updated toosupport this as follows:</span></span>  

    "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), concat(parameters('vmNamePrefix'), copyindex()), variables('wadcfgxend')))]", 

<span data-ttu-id="423f8-154">Hello MetricAggregation valore *PT1H* e *PT1M* indicano un'aggregazione di più di un minuto e un'aggregazione di un'ora.</span><span class="sxs-lookup"><span data-stu-id="423f8-154">hello MetricAggregation value of *PT1H* and *PT1M* signify an aggregation over a minute and an aggregation over an hour.</span></span>

## <a name="wadmetrics-tables-in-storage"></a><span data-ttu-id="423f8-155">Tabelle WADMetrics nell'archiviazione</span><span class="sxs-lookup"><span data-stu-id="423f8-155">WADMetrics tables in storage</span></span>
<span data-ttu-id="423f8-156">configurazione della metrica Hello precedente genera tabelle nell'account di archiviazione di diagnostica con hello segue le convenzioni di denominazione:</span><span class="sxs-lookup"><span data-stu-id="423f8-156">hello Metrics configuration above will generate tables in your diagnostics storage account with hello following naming conventions:</span></span>

* <span data-ttu-id="423f8-157">**WADMetrics** : prefisso standard per tutte le tabelle WADMetrics</span><span class="sxs-lookup"><span data-stu-id="423f8-157">**WADMetrics** : Standard prefix for all WADMetrics tables</span></span>
* <span data-ttu-id="423f8-158">**PT1H** o **PT1M** : indica che la tabella hello contiene dati aggregati in 1 ora o 1 minuto</span><span class="sxs-lookup"><span data-stu-id="423f8-158">**PT1H** or **PT1M** : Signifies that hello table contains aggregate data over 1 hour or 1 minute</span></span>
* <span data-ttu-id="423f8-159">**P10D** : indica la tabella hello conterrà i dati di 10 giorni da quando la tabella hello iniziato a raccogliere i dati</span><span class="sxs-lookup"><span data-stu-id="423f8-159">**P10D** : Signifies hello table will contain data for 10 days from when hello table started collecting data</span></span>
* <span data-ttu-id="423f8-160">**V2S** : costante di tipo stringa.</span><span class="sxs-lookup"><span data-stu-id="423f8-160">**V2S** : String constant</span></span>
* <span data-ttu-id="423f8-161">**aaaammgg** : hello data di inizio in cui hello tabella la raccolta dei dati</span><span class="sxs-lookup"><span data-stu-id="423f8-161">**yyyymmdd** : hello date at which hello table started collecting data</span></span>

<span data-ttu-id="423f8-162">Esempio: *WADMetricsPT1HP10DV2S20151108* includerà i dati aggregati delle metriche per un periodo pari a un'ora per 10 giorni a partire dall'11 nov 2015</span><span class="sxs-lookup"><span data-stu-id="423f8-162">Example: *WADMetricsPT1HP10DV2S20151108* will contain metrics data aggregated over an hour for 10 days starting on 11-Nov-2015</span></span>    

<span data-ttu-id="423f8-163">Ogni tabella WADMetrics conterrà hello seguenti colonne:</span><span class="sxs-lookup"><span data-stu-id="423f8-163">Each WADMetrics table will contain hello following columns:</span></span>

* <span data-ttu-id="423f8-164">**PartitionKey**: partitionkey hello viene creato in base a hello *resourceID* toouniquely valore identificare risorse VM hello.</span><span class="sxs-lookup"><span data-stu-id="423f8-164">**PartitionKey**: hello partitionkey is constructed based on hello *resourceID* value toouniquely identify hello VM resource.</span></span> <span data-ttu-id="423f8-165">ad esempio: 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span><span class="sxs-lookup"><span data-stu-id="423f8-165">for e.g. : 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span></span>  
* <span data-ttu-id="423f8-166">**RowKey** : formato hello segue <Descending time tick>:<Performance Counter Name>.</span><span class="sxs-lookup"><span data-stu-id="423f8-166">**RowKey** : Follows hello format <Descending time tick>:<Performance Counter Name>.</span></span> <span data-ttu-id="423f8-167">Hello decrescente calcolo segni di graduazione time è cicli di tempo massimo meno tempo hello di inizio di hello del periodo di aggregazione hello.</span><span class="sxs-lookup"><span data-stu-id="423f8-167">hello descending time tick calculation is max time ticks minus hello time of hello beginning of hello aggregation period.</span></span> <span data-ttu-id="423f8-168">Ad esempio,</span><span class="sxs-lookup"><span data-stu-id="423f8-168">E.g.</span></span> <span data-ttu-id="423f8-169">Se il periodo di campionamento hello avviato nel novembre-10/2015 e 00:00Hrs UTC quindi hello calcolo: Ticks - (DateTime(2015,11,10,0,0,0,DateTimeKind.Utc) nuovo. Segni di graduazione).</span><span class="sxs-lookup"><span data-stu-id="423f8-169">if hello sample period started on 10-Nov-2015 and 00:00Hrs UTC then hello calculation would be: DateTime.MaxValue.Ticks - (new DateTime(2015,11,10,0,0,0,DateTimeKind.Utc).Ticks).</span></span> <span data-ttu-id="423f8-170">Ad esempio per hello memoria byte disponibili chiave contatori delle prestazioni hello riga avrà un aspetto: 2519551871999999999__:005CMemory:005CAvailable:0020 byte</span><span class="sxs-lookup"><span data-stu-id="423f8-170">For hello memory available bytes performance counter hello row key will look like: 2519551871999999999__:005CMemory:005CAvailable:0020Bytes</span></span>
* <span data-ttu-id="423f8-171">**CounterName** : nome hello hello del contatore delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="423f8-171">**CounterName** : Is hello name of hello performance counter.</span></span> <span data-ttu-id="423f8-172">Questo corrisponde hello *counterSpecifier* definito nel file di configurazione xml hello.</span><span class="sxs-lookup"><span data-stu-id="423f8-172">This matches hello *counterSpecifier* defined in hello xml config.</span></span>
* <span data-ttu-id="423f8-173">**Massimo** : hello valore massimo del contatore delle prestazioni hello periodo aggregazione hello.</span><span class="sxs-lookup"><span data-stu-id="423f8-173">**Maximum** : hello maximum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="423f8-174">**Minimo** : hello valore minimo del contatore delle prestazioni hello periodo aggregazione hello.</span><span class="sxs-lookup"><span data-stu-id="423f8-174">**Minimum** : hello minimum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="423f8-175">**Totale** : somma hello di tutti i valori del contatore delle prestazioni hello indicato per il periodo di aggregazione hello.</span><span class="sxs-lookup"><span data-stu-id="423f8-175">**Total** : hello sum of all values of hello performance counter reported over hello aggregation period.</span></span>
* <span data-ttu-id="423f8-176">**Conteggio** : numero totale di hello di valori segnalati per contatore delle prestazioni hello.</span><span class="sxs-lookup"><span data-stu-id="423f8-176">**Count** : hello total number of values reported for hello performance counter.</span></span>
* <span data-ttu-id="423f8-177">**Media** : hello valore Media (totale) hello del contatore delle prestazioni per il periodo di aggregazione hello.</span><span class="sxs-lookup"><span data-stu-id="423f8-177">**Average** : hello average (total/count) value of hello performance counter over hello aggregation period.</span></span>

## <a name="next-steps"></a><span data-ttu-id="423f8-178">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="423f8-178">Next Steps</span></span>
* <span data-ttu-id="423f8-179">Per un modello di esempio completo di macchina virtuale Windows con estensione Diagnostica, vedere [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span><span class="sxs-lookup"><span data-stu-id="423f8-179">For a complete sample template of a Windows virtual machine with diagnostics extension see [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span></span>   
* <span data-ttu-id="423f8-180">Distribuire hello resource manager modello tramite [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) o [riga di comando di Azure](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="423f8-180">Deploy hello resource manager template using [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) or [Azure Command Line](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="423f8-181">Altre informazioni sulla [Creazione di modelli di Gestione risorse di Azure](../../resource-group-authoring-templates.md)</span><span class="sxs-lookup"><span data-stu-id="423f8-181">Learn more about [authoring Azure Resource Manager templates](../../resource-group-authoring-templates.md)</span></span>

