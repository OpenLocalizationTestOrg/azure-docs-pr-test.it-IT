---
title: Creare applicazioni che usano argomenti e sottoscrizioni del bus di servizio di Azure | Documentazione Microsoft
description: "Introduzione alle funzionalità di pubblicazione/sottoscrizione offerte dagli argomenti e dalle sottoscrizioni del bus di servizio."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: a48fc9b0-b7b0-464e-8187-a517bf8b4eb4
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/07/2017
ms.author: sethm
ms.openlocfilehash: eb01120ce9578f716e5381c107faa93f0b36e358
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/18/2017
---
# <a name="create-applications-that-use-service-bus-topics-and-subscriptions"></a><span data-ttu-id="37aa2-103">Creare applicazioni che usano argomenti e sottoscrizioni del bus di servizio</span><span class="sxs-lookup"><span data-stu-id="37aa2-103">Create applications that use Service Bus topics and subscriptions</span></span>
<span data-ttu-id="37aa2-104">Il bus di servizio di Azure supporta un set di tecnologie middleware orientate ai messaggi e basate sul cloud, incluso l'accodamento dei messaggi affidabile e la messaggistica di pubblicazione e sottoscrizione permanente.</span><span class="sxs-lookup"><span data-stu-id="37aa2-104">Azure Service Bus supports a set of cloud-based, message-oriented middleware technologies including reliable message queuing and durable publish/subscribe messaging.</span></span> <span data-ttu-id="37aa2-105">Questo articolo si basa sulle informazioni presentate in [Creare applicazioni che usano code del bus di servizio](service-bus-create-queues.md) e include un'introduzione alle funzionalità di pubblicazione/sottoscrizione offerte da argomenti del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="37aa2-105">This article builds on the information provided in [Create applications that use Service Bus queues](service-bus-create-queues.md) and offers an introduction to the publish/subscribe capabilities offered by Service Bus topics.</span></span>

## <a name="evolving-retail-scenario"></a><span data-ttu-id="37aa2-106">Scenario di vendita al dettaglio in evoluzione</span><span class="sxs-lookup"><span data-stu-id="37aa2-106">Evolving retail scenario</span></span>
<span data-ttu-id="37aa2-107">Questo articolo usa lo scenario di vendita al dettaglio incluso in [Creare applicazioni che usano le code del bus di servizio](service-bus-create-queues.md).</span><span class="sxs-lookup"><span data-stu-id="37aa2-107">This article continues the retail scenario used in [Create applications that use Service Bus queues](service-bus-create-queues.md).</span></span> <span data-ttu-id="37aa2-108">Richiamare i dati di vendita da singoli terminali di punto di vendita (POS) devono essere indirizzati a un sistema di gestione dell’inventario che utilizza i dati per determinare quando è necessario un nuovo approvvigionamento.</span><span class="sxs-lookup"><span data-stu-id="37aa2-108">Recall that sales data from individual Point of Sale (POS) terminals must be routed to an inventory management system which uses that data to determine when stock has to be replenished.</span></span> <span data-ttu-id="37aa2-109">Ogni terminale POS segnala i dati di vendita tramite l'invio di messaggi alla coda **DataCollectionQueue** dove rimangono fino a quando non vengono ricevuti dal sistema di gestione dell'inventario, come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="37aa2-109">Each POS terminal reports its sales data by sending messages to the **DataCollectionQueue** queue, where they remain until they are received by the inventory management system, as shown here:</span></span>

![Bus di servizio 1](./media/service-bus-create-topics-subscriptions/IC657161.gif)

<span data-ttu-id="37aa2-111">Per sviluppare questo scenario, è stato aggiunto un nuovo requisito al sistema: il proprietario dell'archivio vuole essere in grado di monitorare le prestazioni dell'archivio in tempo reale.</span><span class="sxs-lookup"><span data-stu-id="37aa2-111">To evolve this scenario, a new requirement has been added to the system: the store owner wants to be able to monitor how the store is performing in real time.</span></span>

<span data-ttu-id="37aa2-112">Per soddisfare questo requisito, il sistema deve "disattivare" il flusso di dati di vendita.</span><span class="sxs-lookup"><span data-stu-id="37aa2-112">To address this requirement, the system must "tap" off the sales data stream.</span></span> <span data-ttu-id="37aa2-113">Vogliamo ancora che ogni messaggio inviato dai terminali POS vengano inviati al sistema di gestione del magazzino come prima, ma si desidera un'altra copia di ogni messaggio che è possibile utilizzare per presentare la visualizzazione dashboard al proprietario del negozio.</span><span class="sxs-lookup"><span data-stu-id="37aa2-113">We still want each message sent by the POS terminals to be sent to the inventory management system as before, but we want another copy of each message that we can use to present the dashboard view to the store owner.</span></span>

<span data-ttu-id="37aa2-114">In qualsiasi situazione come questa, in cui si richiede che ogni messaggio venga letto da più parti, è possibile usare gli *argomenti* del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="37aa2-114">In any situation such as this, in which you require each message to be consumed by multiple parties, you can use Service Bus *topics*.</span></span> <span data-ttu-id="37aa2-115">Gli argomenti forniscono un modello di pubblicazione/sottoscrizione, in cui ogni messaggio pubblicato viene reso disponibile a una o più sottoscrizioni registrate con l'argomento.</span><span class="sxs-lookup"><span data-stu-id="37aa2-115">Topics provide a publish/subscribe pattern in which each published message is made available to one or more subscriptions registered with the topic.</span></span> <span data-ttu-id="37aa2-116">Al contrario, con le code ogni messaggio viene ricevuto da un singolo consumer.</span><span class="sxs-lookup"><span data-stu-id="37aa2-116">In contrast, with queues each message is received by a single consumer.</span></span>

<span data-ttu-id="37aa2-117">I messaggi vengono inviati a un argomento nello stesso modo in cui vengono trasmessi a una coda.</span><span class="sxs-lookup"><span data-stu-id="37aa2-117">Messages are sent to a topic in the same way as they are sent to a queue.</span></span> <span data-ttu-id="37aa2-118">Tuttavia, i messaggi non vengono ricevuti dall'argomento direttamente, ma dalle sottoscrizioni.</span><span class="sxs-lookup"><span data-stu-id="37aa2-118">However, messages are not received from the topic directly; they are received from subscriptions.</span></span> <span data-ttu-id="37aa2-119">È possibile pensare alla sottoscrizione a un argomento come a una coda virtuale che riceve copie dei messaggi che sono stati inviati all'argomento.</span><span class="sxs-lookup"><span data-stu-id="37aa2-119">You can think of a subscription to a topic as a virtual queue that receives copies of the messages that are sent to that topic.</span></span> <span data-ttu-id="37aa2-120">La procedura di ricezione dei messaggi da parte di una sottoscrizione è la stessa usata per la ricezione da parte di una coda.</span><span class="sxs-lookup"><span data-stu-id="37aa2-120">Messages are received from a subscription the same way as they are received from a queue.</span></span>

<span data-ttu-id="37aa2-121">Tornando allo scenario di vendita al dettaglio, la coda viene sostituita da un argomento e viene aggiunta una sottoscrizione che verrà usata dal componente del sistema di gestione del magazzino.</span><span class="sxs-lookup"><span data-stu-id="37aa2-121">Going back to the retail scenario, the queue is replaced by a topic, and a subscription is added, which the inventory management system component can use.</span></span> <span data-ttu-id="37aa2-122">Il sistema ora l'aspetto seguente:</span><span class="sxs-lookup"><span data-stu-id="37aa2-122">The system now appears as follows:</span></span>

![Bus di servizio 2](./media/service-bus-create-topics-subscriptions/IC657165.gif)

<span data-ttu-id="37aa2-124">La configurazione qui si comporta in modo identico alla precedente progettazione basata su coda.</span><span class="sxs-lookup"><span data-stu-id="37aa2-124">The configuration here performs identically to the previous queue-based design.</span></span> <span data-ttu-id="37aa2-125">Ovvero i messaggi inviati all'argomento vengono instradati alla sottoscrizione **Inventory** e letti dal **sistema di gestione del magazzino**.</span><span class="sxs-lookup"><span data-stu-id="37aa2-125">That is, messages sent to the topic are routed to the **Inventory** subscription, from which the **Inventory Management System** consumes them.</span></span>

<span data-ttu-id="37aa2-126">Per supportare il dashboard di gestione, viene creata una seconda sottoscrizione nell'argomento, come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="37aa2-126">In order to support the management dashboard, we create a second subscription on the topic, as shown here:</span></span>

![Bus di servizio 3](./media/service-bus-create-topics-subscriptions/IC657166.gif)

<span data-ttu-id="37aa2-128">Con questa configurazione, ogni messaggio da terminali POS viene reso disponibile a entrambe le sottoscrizioni **Dashboard** e **Inventory**.</span><span class="sxs-lookup"><span data-stu-id="37aa2-128">With this configuration, each message from the POS terminals is made available to both the **Dashboard** and **Inventory** subscriptions.</span></span>

## <a name="show-me-the-code"></a><span data-ttu-id="37aa2-129">Mostra il codice</span><span class="sxs-lookup"><span data-stu-id="37aa2-129">Show me the code</span></span>
<span data-ttu-id="37aa2-130">L'articolo [Creare applicazioni che usano le code del bus di servizio](service-bus-create-queues.md) descrive come registrare un account di Azure e creare uno spazio dei nomi del servizio.</span><span class="sxs-lookup"><span data-stu-id="37aa2-130">The article [Create applications that use Service Bus queues](service-bus-create-queues.md) describes how to sign up for an Azure account and create a service namespace.</span></span> <span data-ttu-id="37aa2-131">Il modo più semplice per fare riferimento alle dipendenze del bus di servizio è di installare il [pacchetto Nuget](https://www.nuget.org/packages/WindowsAzure.ServiceBus/) del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="37aa2-131">The easiest way to reference Service Bus dependencies is to install the Service Bus [Nuget package](https://www.nuget.org/packages/WindowsAzure.ServiceBus/).</span></span> <span data-ttu-id="37aa2-132">È possibile trovare le librerie del bus di servizio anche come parte di Azure SDK.</span><span class="sxs-lookup"><span data-stu-id="37aa2-132">You can also find the Service Bus libraries as part of the Azure SDK.</span></span> <span data-ttu-id="37aa2-133">Il download è disponibile nella [pagina di download di Azure SDK](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="37aa2-133">The download is available at the [Azure SDK download page](https://azure.microsoft.com/downloads/).</span></span>

### <a name="create-the-topic-and-subscriptions"></a><span data-ttu-id="37aa2-134">Creare l'argomento e le sottoscrizioni</span><span class="sxs-lookup"><span data-stu-id="37aa2-134">Create the topic and subscriptions</span></span>
<span data-ttu-id="37aa2-135">Le operazioni di gestione per entità di messaggistica (code e argomenti di pubblicazione/sottoscrizione) del bus di servizio vengono eseguite tramite la classe [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager).</span><span class="sxs-lookup"><span data-stu-id="37aa2-135">Management operations for Service Bus messaging entities (queues and publish/subscribe topics) are performed via the [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class.</span></span> <span data-ttu-id="37aa2-136">Sono necessarie le credenziali appropriate per creare un'istanza **NamespaceManager** per un determinato spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="37aa2-136">Appropriate credentials are required in order to create a **NamespaceManager** instance for a particular namespace.</span></span> <span data-ttu-id="37aa2-137">Il bus di servizio usa un modello di sicurezza basato su [SAS (Shared Access Signature, Firma di accesso condiviso)](service-bus-sas.md).</span><span class="sxs-lookup"><span data-stu-id="37aa2-137">Service Bus uses a [Shared Access Signature (SAS)](service-bus-sas.md) based security model.</span></span> <span data-ttu-id="37aa2-138">La classe [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#microsoft_servicebus_tokenprovider) rappresenta un provider di token di sicurezza con metodi factory incorporati che restituiscono alcuni provider di token noti.</span><span class="sxs-lookup"><span data-stu-id="37aa2-138">The [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#microsoft_servicebus_tokenprovider) class represents a security token provider with built-in factory methods returning some well-known token providers.</span></span> <span data-ttu-id="37aa2-139">Per memorizzare le credenziali SAS, verrà usato un metodo [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_).</span><span class="sxs-lookup"><span data-stu-id="37aa2-139">We’ll use a [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) method to hold the SAS credentials.</span></span> <span data-ttu-id="37aa2-140">L'istanza [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) viene costruita con l'indirizzo di base dello spazio dei nomi del bus di servizio e con il provider di token.</span><span class="sxs-lookup"><span data-stu-id="37aa2-140">The [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) instance is then constructed with the base address of the Service Bus namespace and the token provider.</span></span>

<span data-ttu-id="37aa2-141">La classe [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) offre i metodi per creare, enumerare ed eliminare entità di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="37aa2-141">The [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class provides methods to create, enumerate and delete messaging entities.</span></span> <span data-ttu-id="37aa2-142">Il codice riportato di seguito visualizza come l'istanza **NamespaceManager** viene creata e usata per definire l'argomento **DataCollectionTopic**.</span><span class="sxs-lookup"><span data-stu-id="37aa2-142">The code that is shown here shows how the **NamespaceManager** instance is created and used to create the **DataCollectionTopic** topic.</span></span>

```csharp
Uri uri = ServiceBusEnvironment.CreateServiceUri("sb", "test-blog", string.Empty);
string name = "RootManageSharedAccessKey";
string key = "abcdefghijklmopqrstuvwxyz";

TokenProvider tokenProvider = TokenProvider.CreateSharedAccessSignatureTokenProvider(name, key);
NamespaceManager namespaceManager = new NamespaceManager(uri, tokenProvider);

namespaceManager.CreateTopic("DataCollectionTopic");
```

<span data-ttu-id="37aa2-143">Si noti che sono disponibili overload del metodo [CreateTopic](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateTopic_System_String_) che consentono di impostare le proprietà dell'argomento.</span><span class="sxs-lookup"><span data-stu-id="37aa2-143">Note that there are overloads of the [CreateTopic](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateTopic_System_String_) method that enable you to set properties of the topic.</span></span> <span data-ttu-id="37aa2-144">Ad esempio, è possibile impostare il valore di durata (TTL) predefinito per i messaggi inviati all'argomento.</span><span class="sxs-lookup"><span data-stu-id="37aa2-144">For example, you can set the default time-to-live (TTL) value for messages sent to the topic.</span></span> <span data-ttu-id="37aa2-145">Aggiungere successivamente le sottoscrizioni **Inventory** e **Dashboard**.</span><span class="sxs-lookup"><span data-stu-id="37aa2-145">Next, add the **Inventory** and **Dashboard** subscriptions.</span></span>

```csharp
namespaceManager.CreateSubscription("DataCollectionTopic", "Inventory");
namespaceManager.CreateSubscription("DataCollectionTopic", "Dashboard");
```

### <a name="send-messages-to-the-topic"></a><span data-ttu-id="37aa2-146">Inviare messaggi all'argomento</span><span class="sxs-lookup"><span data-stu-id="37aa2-146">Send messages to the topic</span></span>
<span data-ttu-id="37aa2-147">Per le operazioni di runtime su entità del bus di servizio, ad esempio l'invio e la ricezione di messaggi, un'applicazione deve prima creare un oggetto [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#microsoft_servicebus_messaging_messagingfactory).</span><span class="sxs-lookup"><span data-stu-id="37aa2-147">For run-time operations on Service Bus entities; for example, sending and receiving messages, an application must first create a [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#microsoft_servicebus_messaging_messagingfactory) object.</span></span> <span data-ttu-id="37aa2-148">Simile alla classe [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager), l'istanza **MessagingFactory** viene creata a partire dall'indirizzo di base dello spazio dei nomi del servizio e dal provider di token.</span><span class="sxs-lookup"><span data-stu-id="37aa2-148">Similar to the [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class, the **MessagingFactory** instance is created from the base address of the service namespace and the token provider.</span></span>

```
MessagingFactory factory = MessagingFactory.Create(uri, tokenProvider);
```

<span data-ttu-id="37aa2-149">I messaggi inviati e ricevuti dagli argomenti del bus di servizio sono istanze della classe [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage).</span><span class="sxs-lookup"><span data-stu-id="37aa2-149">Messages sent to and received from Service Bus topics, are instances of the [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) class.</span></span> <span data-ttu-id="37aa2-150">Questa classe consiste di un insieme di proprietà standard, (ad esempio, [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.label?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) e [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.timetolive?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), di un dizionario usato per mantenere le proprietà dell'applicazione e di un corpo di dati arbitrari dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="37aa2-150">This class consists of a set of standard properties (such as [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.label?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) and [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.timetolive?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), a dictionary that is used to hold application properties, and a body of arbitrary application data.</span></span> <span data-ttu-id="37aa2-151">Un'applicazione può impostare il corpo passando qualsiasi oggetto serializzabile (nell'esempio seguente passa un oggetto **SalesData** che rappresenta i dati di vendita dal terminale POS), che userà [DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) per serializzare l'oggetto.</span><span class="sxs-lookup"><span data-stu-id="37aa2-151">An application can set the body by passing in any serializable object (the following example passes in a **SalesData** object that represents the sales data from the POS terminal), which will use the [DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) to serialize the object.</span></span> <span data-ttu-id="37aa2-152">In alternativa, può essere specificato un oggetto [Flusso](https://msdn.microsoft.com/library/system.io.stream.aspx).</span><span class="sxs-lookup"><span data-stu-id="37aa2-152">Alternatively, a [Stream](https://msdn.microsoft.com/library/system.io.stream.aspx) object can be provided.</span></span>

```csharp
BrokeredMessage bm = new BrokeredMessage(salesData);
bm.Label = "SalesReport";
bm.Properties["StoreName"] = "Redmond";
bm.Properties["MachineID"] = "POS_1";
```

<span data-ttu-id="37aa2-153">Il modo più semplice per inviare messaggi all'argomento consiste nell'usare [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) per creare un oggetto [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) direttamente dall'istanza di [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory):</span><span class="sxs-lookup"><span data-stu-id="37aa2-153">The easiest way to send messages to the topic is to use [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) to create a [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) object directly from the [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instance:</span></span>

```csharp
MessageSender sender = factory.CreateMessageSender("DataCollectionTopic");
sender.Send(bm);
```

### <a name="receive-messages-from-a-subscription"></a><span data-ttu-id="37aa2-154">Ricevere messaggi da una sottoscrizione</span><span class="sxs-lookup"><span data-stu-id="37aa2-154">Receive messages from a subscription</span></span>
<span data-ttu-id="37aa2-155">Similmente a quanto accade con l'uso delle code, per ricevere messaggi da una sottoscrizione, è possibile usare un oggetto [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) che si crea direttamente da [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) tramite [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span><span class="sxs-lookup"><span data-stu-id="37aa2-155">Similar to using queues, to receive messages from a subscription you can use a [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) object which you create directly from the [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) using [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span></span> <span data-ttu-id="37aa2-156">È possibile usare una delle due diverse modalità di ricezione, **ReceiveAndDelete** e **PeekLock**, come illustrato in [Creare applicazioni che usano le code del bus di servizio](service-bus-create-queues.md).</span><span class="sxs-lookup"><span data-stu-id="37aa2-156">You can use one of the two different receive modes (**ReceiveAndDelete** and **PeekLock**), as discussed in [Create applications that use Service Bus queues](service-bus-create-queues.md).</span></span>

<span data-ttu-id="37aa2-157">Si noti che, quando si crea un oggetto **MessageReceiver** per le sottoscrizioni, il parametro *entityPath* segue il formato `topicPath/subscriptions/subscriptionName`.</span><span class="sxs-lookup"><span data-stu-id="37aa2-157">Note that when you create a **MessageReceiver** for subscriptions, the *entityPath* parameter is of the form `topicPath/subscriptions/subscriptionName`.</span></span> <span data-ttu-id="37aa2-158">Per creare quindi un oggetto **MessageReceiver** per la sottoscrizione **Inventory** dell'argomento **DataCollectionTopic**, *entityPath* deve essere impostato su `DataCollectionTopic/subscriptions/Inventory`.</span><span class="sxs-lookup"><span data-stu-id="37aa2-158">Therefore, to create a **MessageReceiver** for the **Inventory** subscription of the **DataCollectionTopic** topic, *entityPath* must be set to `DataCollectionTopic/subscriptions/Inventory`.</span></span> <span data-ttu-id="37aa2-159">Il codice viene visualizzato come segue:</span><span class="sxs-lookup"><span data-stu-id="37aa2-159">The code appears as follows:</span></span>

```csharp
MessageReceiver receiver = factory.CreateMessageReceiver("DataCollectionTopic/subscriptions/Inventory");
BrokeredMessage receivedMessage = receiver.Receive();
try
{
    ProcessMessage(receivedMessage);
    receivedMessage.Complete();
}
catch (Exception e)
{
    receivedMessage.Abandon();
}
```

## <a name="subscription-filters"></a><span data-ttu-id="37aa2-160">Filtri di sottoscrizione</span><span class="sxs-lookup"><span data-stu-id="37aa2-160">Subscription filters</span></span>
<span data-ttu-id="37aa2-161">Finora, in questo scenario tutti i messaggi inviati all'argomento sono resi disponibili per tutte le sottoscrizioni registrate.</span><span class="sxs-lookup"><span data-stu-id="37aa2-161">So far, in this scenario all messages sent to the topic are made available to all registered subscriptions.</span></span> <span data-ttu-id="37aa2-162">La frase chiave è "reso disponibile."</span><span class="sxs-lookup"><span data-stu-id="37aa2-162">The key phrase here is "made available."</span></span> <span data-ttu-id="37aa2-163">Mentre nelle sottoscrizioni del bus di servizio tutti i messaggi vengono inviati all'argomento, l'utente può copiare solo un subset di tali messaggi nella coda virtuale delle sottoscrizioni.</span><span class="sxs-lookup"><span data-stu-id="37aa2-163">While Service Bus subscriptions see all messages sent to the topic, you can copy only a subset of those messages to the virtual subscription queue.</span></span> <span data-ttu-id="37aa2-164">Questa operazione viene eseguita usando i *filtri* della sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="37aa2-164">This is performed using subscription *filters*.</span></span> <span data-ttu-id="37aa2-165">Quando si crea una sottoscrizione, è possibile definire un'espressione di filtro sotto forma di predicato di stile SQL92 che usa le proprietà del messaggio, ovvero le proprietà di sistema, ad esempio [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label), e le proprietà dell'applicazione, ad esempio **StoreName** nell'esempio precedente.</span><span class="sxs-lookup"><span data-stu-id="37aa2-165">When you create a subscription, you can supply a filter expression in the form of a SQL92 style predicate that operates over the properties of the message, both the system properties (for example, [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label)) and the application properties, such as **StoreName** in the previous example.</span></span>

<span data-ttu-id="37aa2-166">Nell’evoluzione dello scenario per illustrare questo concetto, un secondo archivio deve essere aggiunto a questo scenario di vendita al dettaglio.</span><span class="sxs-lookup"><span data-stu-id="37aa2-166">Evolving the scenario to illustrate this, a second store is to be added to our retail scenario.</span></span> <span data-ttu-id="37aa2-167">I dati di vendita da tutti i terminali POS da entrambi gli archivi devono essere instradati al sistema di gestione centralizzato dell'inventario, ma un gestore dell'archivio che utilizza lo strumento dashboard è solo interessato sulle prestazioni di tale archivio.</span><span class="sxs-lookup"><span data-stu-id="37aa2-167">Sales data from all of the POS terminals from both stores still have to be routed to the centralized inventory management system, but a store manager using the dashboard tool is only interested in the performance of that store.</span></span> <span data-ttu-id="37aa2-168">È possibile usare i filtri della sottoscrizione per ottenere questo risultato.</span><span class="sxs-lookup"><span data-stu-id="37aa2-168">You can use subscription filtering to achieve this.</span></span> <span data-ttu-id="37aa2-169">Si noti che quando i terminali POS pubblicano messaggi, impostano anche la proprietà di applicazione **StoreName** nel messaggio.</span><span class="sxs-lookup"><span data-stu-id="37aa2-169">Note that when the POS terminals publish messages, they set the **StoreName** application property on the message.</span></span> <span data-ttu-id="37aa2-170">Ad esempio, in due archivi denominati **Redmond** e **Seattle**, i terminali POS dell'archivio di Redmond contrassegnano i messaggi di dati di vendita con uno **StoreName** uguale a **Redmond**, mentre i terminali POS dell'archivio di Seattle usano uno **StoreName** uguale a **Seattle**.</span><span class="sxs-lookup"><span data-stu-id="37aa2-170">Given two stores, for example **Redmond** and **Seattle**, the POS terminals in the Redmond store stamp their sales data messages with a **StoreName** equal to **Redmond**, whereas the Seattle store POS terminals use a **StoreName** equal to **Seattle**.</span></span> <span data-ttu-id="37aa2-171">Il gestore dell'archivio di Redmond desidera solo visualizzare i dati dai propri terminali POS.</span><span class="sxs-lookup"><span data-stu-id="37aa2-171">The store manager of the Redmond store only wants to see data from its POS terminals.</span></span> <span data-ttu-id="37aa2-172">Il sistema viene visualizzato come segue:</span><span class="sxs-lookup"><span data-stu-id="37aa2-172">The system appears as follows:</span></span>

![Servizio Bus4](./media/service-bus-create-topics-subscriptions/IC657167.gif)

<span data-ttu-id="37aa2-174">Per configurare questo routing, si crea la sottoscrizione **Dashboard** come segue:</span><span class="sxs-lookup"><span data-stu-id="37aa2-174">To set up this routing, you create the **Dashboard** subscription as follows:</span></span>

```csharp
SqlFilter dashboardFilter = new SqlFilter("StoreName = 'Redmond'");
namespaceManager.CreateSubscription("DataCollectionTopic", "Dashboard", dashboardFilter);
```

<span data-ttu-id="37aa2-175">Con questo [filtro della sottoscrizione](/dotnet/api/microsoft.servicebus.messaging.sqlfilter), solo i messaggi con la proprietà **StoreName** impostata su **Redmond** vengono copiati nella coda virtuale per la sottoscrizione **Dashboard**.</span><span class="sxs-lookup"><span data-stu-id="37aa2-175">With this [subscription filter](/dotnet/api/microsoft.servicebus.messaging.sqlfilter), only messages that have the **StoreName** property set to **Redmond** will be copied to the virtual queue for the **Dashboard** subscription.</span></span> <span data-ttu-id="37aa2-176">Tuttavia, i filtri della sottoscrizione presentano molti altri vantaggi.</span><span class="sxs-lookup"><span data-stu-id="37aa2-176">There is much more to subscription filtering, however.</span></span> <span data-ttu-id="37aa2-177">Le applicazioni possono avere più regole di filtro per ogni sottoscrizione oltre alla possibilità di modificare le proprietà di un messaggio quando passa alla coda virtuale di una sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="37aa2-177">Applications can have multiple filter rules per subscription in addition to the ability to modify the properties of a message as it passes to a subscription's virtual queue.</span></span>

## <a name="summary"></a><span data-ttu-id="37aa2-178">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="37aa2-178">Summary</span></span>
<span data-ttu-id="37aa2-179">Tutti i motivi per usare l'accodamento descritti in [Creare applicazioni che usano code del bus di servizio](service-bus-create-queues.md) sono validi anche per gli argomenti, in particolare:</span><span class="sxs-lookup"><span data-stu-id="37aa2-179">All of the reasons to use queuing described in [Create applications that use Service Bus queues](service-bus-create-queues.md) also apply to topics, specifically:</span></span>

* <span data-ttu-id="37aa2-180">Disaccoppiamento temporale - producer e consumer del messaggio non devono necessariamente essere online contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="37aa2-180">Temporal decoupling – message producers and consumers do not have to be online at the same time.</span></span>
* <span data-ttu-id="37aa2-181">Livellamento del carico: i picchi di carico vengono livellati dall'argomento consentendo l'utilizzo di applicazioni di cui effettuare il provisioning per il carico medio invece che per il picco di carico.</span><span class="sxs-lookup"><span data-stu-id="37aa2-181">Load leveling – peaks in load are smoothed out by the topic enabling consuming applications to be provisioned for average load instead of peak load.</span></span>
* <span data-ttu-id="37aa2-182">Bilanciamento del carico: come con una coda, è possibile avere più consumer concorrenti in ascolto su una singola sottoscrizione, con ogni messaggio passato a uno solo dei consumer, ottenendo così il bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="37aa2-182">Load balancing – similar to a queue, you can have multiple competing consumers listening on a single subscription, with each message handed off to only one of the consumers, thereby balancing load.</span></span>
* <span data-ttu-id="37aa2-183">Regime di controllo libero: è possibile evolvere la rete di messaggistica senza influire sugli endpoint esistenti, ad esempio, aggiungendo sottoscrizioni o modificando i filtri per un argomento per consentire nuovi consumer.</span><span class="sxs-lookup"><span data-stu-id="37aa2-183">Loose coupling – you can evolve the messaging network without affecting existing endpoints; for example, adding subscriptions or changing filters to a topic to allow for new consumers.</span></span>

## <a name="next-steps"></a><span data-ttu-id="37aa2-184">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="37aa2-184">Next steps</span></span>

<span data-ttu-id="37aa2-185">Vedere [Creare applicazioni che usano le code del bus di servizio](service-bus-create-queues.md) per informazioni su come usare le code nello scenario di vendita al dettaglio POS.</span><span class="sxs-lookup"><span data-stu-id="37aa2-185">See [Create applications that use Service Bus queues](service-bus-create-queues.md) for information about how to use queues in the POS retail scenario.</span></span>

