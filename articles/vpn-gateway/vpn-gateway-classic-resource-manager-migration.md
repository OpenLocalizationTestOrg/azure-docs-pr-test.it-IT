---
title: Migrazione dal modello classico al modello Resource Manager con gateway VPN| Microsoft Docs
description: Questa pagina fornisce una panoramica della migrazione dal modello classico al modello Resource Manager con Gateway VPN.
documentationcenter: na
services: vpn-gateway
author: amsriva
manager: rossort
editor: amsriva
ms.assetid: caa8eb19-825a-4031-8b49-18fbf3ebc04e
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/02/2017
ms.author: amsriva
ms.openlocfilehash: 1164fc24355657af22b6befaad74685ebbc2b5cb
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="vpn-gateway-classic-to-resource-manager-migration"></a><span data-ttu-id="a1c68-103">Migrazione dal modello classico al modello Resource Manager con gateway VPN</span><span class="sxs-lookup"><span data-stu-id="a1c68-103">VPN Gateway classic to Resource Manager migration</span></span>
<span data-ttu-id="a1c68-104">I gateway VPN possono ora essere migrati dal modello di distribuzione classica a quello Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="a1c68-104">VPN Gateways can now be migrated from classic to Resource Manager deployment model.</span></span> <span data-ttu-id="a1c68-105">Altre informazioni su [funzionalità e vantaggi di Azure Resource Manager](../azure-resource-manager/resource-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="a1c68-105">You can read more about Azure Resource Manager [features and benefits](../azure-resource-manager/resource-group-overview.md).</span></span> <span data-ttu-id="a1c68-106">Questo articolo descrive in dettaglio come eseguire la migrazione da distribuzioni classiche al modello più recente basato su Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="a1c68-106">In this article, we  detail how to migrate from classic deployments to newer Resource Manager based model.</span></span> 

<span data-ttu-id="a1c68-107">I gateway VPN vengono migrati come parte della migrazione della rete virtuale dal modello classico a quello Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="a1c68-107">VPN Gateways are migrated as part of VNet migration from classic to Resource Manager.</span></span> <span data-ttu-id="a1c68-108">Viene eseguita la migrazione di una rete virtuale alla volta.</span><span class="sxs-lookup"><span data-stu-id="a1c68-108">This migration is done one VNet at a time.</span></span> <span data-ttu-id="a1c68-109">Non esiste alcun requisito aggiuntivo in termini di strumenti o prerequisiti alla migrazione.</span><span class="sxs-lookup"><span data-stu-id="a1c68-109">There is no additional requirement in terms of tools or prerequisites to migration.</span></span> <span data-ttu-id="a1c68-110">I passaggi di migrazione sono identici alla migrazione di rete virtuale esistente e sono documentati nella [pagina sulla migrazione delle risorse IaaS](../virtual-machines/windows/migration-classic-resource-manager-ps.md).</span><span class="sxs-lookup"><span data-stu-id="a1c68-110">Migration steps are identical to existing VNet migration and are documented at [IaaS resources migration page](../virtual-machines/windows/migration-classic-resource-manager-ps.md).</span></span> <span data-ttu-id="a1c68-111">La migrazione non comporta un tempo di inattività del percorso di dati e quindi i carichi di lavoro esistenti continueranno a funzionare senza perdita della connettività locale durante la migrazione.</span><span class="sxs-lookup"><span data-stu-id="a1c68-111">There is no data path downtime during migration and thus existing workloads would continue to function without loss of on-premises connectivity during migration.</span></span> <span data-ttu-id="a1c68-112">L'indirizzo IP pubblico associato al gateway VPN non cambia durante il processo di migrazione.</span><span class="sxs-lookup"><span data-stu-id="a1c68-112">The public IP address associated with the VPN gateway does not change during the migration process.</span></span> <span data-ttu-id="a1c68-113">Non è quindi necessario riconfigurare il router locale dopo il completamento della migrazione.</span><span class="sxs-lookup"><span data-stu-id="a1c68-113">This implies that you will not need to reconfigure your on-premises router once the migration is completed.</span></span>  

<span data-ttu-id="a1c68-114">Il modello Resource Manager è diverso dal modello classico ed è composto da gateway di rete virtuale, gateway di rete locale e risorse di connessione.</span><span class="sxs-lookup"><span data-stu-id="a1c68-114">The model in Resource Manager is different from classic model and is composed of virtual network gateways, local network gateways and connection resources.</span></span> <span data-ttu-id="a1c68-115">Questi rappresentano il gateway VPN stesso, il sito locale che rappresenta rispettivamente lo spazio di indirizzi locale e la connettività tra i due elementi.</span><span class="sxs-lookup"><span data-stu-id="a1c68-115">These represent the VPN gateway itself, the local-site representing on premises address space and connectivity between the two respectively.</span></span> <span data-ttu-id="a1c68-116">Dopo il completamento della migrazione, i gateway non saranno disponibili nel modello classico e tutte le operazioni di gestione nei gateway di rete virtuale, nei gateway di rete locale e gli oggetti di connessione devono essere eseguite usando il modello Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="a1c68-116">Once migration is completed your gateways would not be available in classic model and all management operations on virtual network gateways, local network gateways, and connection objects must be performed using Resource Manager model.</span></span>

## <a name="supported-scenarios"></a><span data-ttu-id="a1c68-117">Scenari supportati</span><span class="sxs-lookup"><span data-stu-id="a1c68-117">Supported scenarios</span></span>
<span data-ttu-id="a1c68-118">La migrazione dal modello classico a quello Resource Manager supporta gli scenari di connettività VPN più comuni.</span><span class="sxs-lookup"><span data-stu-id="a1c68-118">Most common VPN connectivity scenarios are covered by classic to Resource Manager migration.</span></span> <span data-ttu-id="a1c68-119">Gli scenari supportati includono:</span><span class="sxs-lookup"><span data-stu-id="a1c68-119">The supported scenarios include -</span></span>

* <span data-ttu-id="a1c68-120">Connettività da punto a sito</span><span class="sxs-lookup"><span data-stu-id="a1c68-120">Point to site connectivity</span></span>
* <span data-ttu-id="a1c68-121">Connettività da sito a sito con il gateway VPN connesso a una posizione locale</span><span class="sxs-lookup"><span data-stu-id="a1c68-121">Site to site connectivity with VPN Gateway connected to on premises location</span></span>
* <span data-ttu-id="a1c68-122">Connettività da rete virtuale a rete virtuale tra due reti virtuali usando i gateway VPN</span><span class="sxs-lookup"><span data-stu-id="a1c68-122">VNet to VNet connectivity between two VNets using VPN gateways</span></span>
* <span data-ttu-id="a1c68-123">Più reti virtuali connesse alla stessa posizione locale</span><span class="sxs-lookup"><span data-stu-id="a1c68-123">Multiple VNets connected to same on premises location</span></span>
* <span data-ttu-id="a1c68-124">Connessione multisito</span><span class="sxs-lookup"><span data-stu-id="a1c68-124">Multi-site connectivity</span></span>
* <span data-ttu-id="a1c68-125">Reti virtuali abilitate per il tunneling forzato</span><span class="sxs-lookup"><span data-stu-id="a1c68-125">Forced tunneling enabled VNets</span></span>

<span data-ttu-id="a1c68-126">Gli scenari non supportati includono:</span><span class="sxs-lookup"><span data-stu-id="a1c68-126">Scenarios which are not supported include -</span></span>  

* <span data-ttu-id="a1c68-127">La rete virtuale con il gateway ExpressRoute e Gateway VPN al momento non è supportata.</span><span class="sxs-lookup"><span data-stu-id="a1c68-127">VNet with both ExpressRoute Gateway and VPN Gateway is not currently supported.</span></span>
* <span data-ttu-id="a1c68-128">Scenari di transito in cui le estensioni di VM sono connesse ai server locali.</span><span class="sxs-lookup"><span data-stu-id="a1c68-128">Transit scenarios where VM extensions are connected to on-premises servers.</span></span> <span data-ttu-id="a1c68-129">Le limitazioni relative alla connettività VPN di transito sono descritte di seguito.</span><span class="sxs-lookup"><span data-stu-id="a1c68-129">Transit VPN connectivity limitations are detailed below.</span></span>

> [!NOTE]
> <span data-ttu-id="a1c68-130">La convalida CIDR nel modello Resource Manager è più rigida rispetto a quella nel modello classico.</span><span class="sxs-lookup"><span data-stu-id="a1c68-130">CIDR validation in Resource Manager model is more strict than the one in classic model.</span></span> <span data-ttu-id="a1c68-131">Prima di eseguire la migrazione verificare che gli intervalli di indirizzi classici specificati siano conformi al formato CIDR valido prima di iniziare la migrazione.</span><span class="sxs-lookup"><span data-stu-id="a1c68-131">Before migrating ensure that classic address ranges given conform to valid CIDR format before beginning the migration.</span></span> <span data-ttu-id="a1c68-132">È possibile convalidare CIDR usando qualsiasi validator CIDR comune.</span><span class="sxs-lookup"><span data-stu-id="a1c68-132">CIDR can be validated using any common CIDR validators.</span></span> <span data-ttu-id="a1c68-133">La rete virtuale o i siti locali con intervalli CIDR non validi durante la migrazione generano uno stato di errore.</span><span class="sxs-lookup"><span data-stu-id="a1c68-133">VNet or local sites with invalid CIDR ranges when migrated would result in failed state.</span></span>
> 
> 

## <a name="vnet-to-vnet-connectivity-migration"></a><span data-ttu-id="a1c68-134">Migrazione della connettività da rete virtuale a rete virtuale</span><span class="sxs-lookup"><span data-stu-id="a1c68-134">VNet to VNet connectivity migration</span></span>
<span data-ttu-id="a1c68-135">La connettività da rete virtuale a rete virtuale in modalità classica è stata ottenuta creando una rappresentazione nel sito locale della rete virtuale connessa.</span><span class="sxs-lookup"><span data-stu-id="a1c68-135">VNet to VNet connectivity in classic was achieved by creating a local site representation of the connected VNet.</span></span> <span data-ttu-id="a1c68-136">È stato richiesto ai clienti di creare due siti locali che rappresentano le due reti virtuali da collegare.</span><span class="sxs-lookup"><span data-stu-id="a1c68-136">Customers were required to create two local sites which represented the two VNets which needed to be connected together.</span></span> <span data-ttu-id="a1c68-137">Sono stati quindi connessi alle reti virtuali corrispondenti usando il tunnel IPsec per stabilire la connettività tra le due reti virtuali.</span><span class="sxs-lookup"><span data-stu-id="a1c68-137">These were then connected to the corresponding VNets using IPsec tunnel to establish connectivity between the two VNets.</span></span> <span data-ttu-id="a1c68-138">Questo modello presenta problemi di gestibilità poiché le modifiche all'intervallo di indirizzi in una rete virtuale devono essere gestite anche nella rappresentazione del sito locale corrispondente.</span><span class="sxs-lookup"><span data-stu-id="a1c68-138">This model has manageability challenges since any address range changes in one VNet must also be maintained in the corresponding local site representation.</span></span> <span data-ttu-id="a1c68-139">Nel modello Resource Manager questa soluzione non è più necessaria.</span><span class="sxs-lookup"><span data-stu-id="a1c68-139">In Resource Manager model this workaround is no longer needed.</span></span> <span data-ttu-id="a1c68-140">La connessione tra le due reti virtuali può essere ottenuta direttamente usando il tipo di connessione "Vnet2Vnet" nella risorsa di connessione.</span><span class="sxs-lookup"><span data-stu-id="a1c68-140">The connection between the two VNets can be directly achieved using 'Vnet2Vnet' connection type in Connection resource.</span></span> 

![Screenshot della migrazione da rete virtuale a rete virtuale.](./media/vpn-gateway-migration/migration1.png)

<span data-ttu-id="a1c68-142">Durante la migrazione della rete virtuale viene rilevato che l'entità connessa al gateway VPN della rete di virtuale corrente è un'altra rete virtuale; assicurarsi che al termine della migrazione di entrambe le reti virtuali, i due siti locali che rappresentano l'altra rete virtuale non siano più visualizzati.</span><span class="sxs-lookup"><span data-stu-id="a1c68-142">During VNet migration we detect that the connected entity to current VNet's VPN gateway is another VNet and ensure that once migration of both VNets is completed, you would no longer see two local sites representing the other VNet.</span></span> <span data-ttu-id="a1c68-143">Il modello classico di due gateway VPN, due siti locali e due connessioni tra loro viene trasformato nel modello Resource Manager con due gateway VPN e due connessioni di tipo Vnet2Vnet.</span><span class="sxs-lookup"><span data-stu-id="a1c68-143">The classic model of two VPN gateways, two local sites and two connections between them is transformed to Resource Manager model with two VPN gateways and two connections of type Vnet2Vnet.</span></span>

## <a name="transit-vpn-connectivity"></a><span data-ttu-id="a1c68-144">Connettività VPN di transito</span><span class="sxs-lookup"><span data-stu-id="a1c68-144">Transit VPN connectivity</span></span>
<span data-ttu-id="a1c68-145">È possibile configurare i gateway VPN in una topologia in modo da ottenere la connettività locale per una rete virtuale tramite la connessione a un'altra rete virtuale che è connessa direttamente alle risorse locali.</span><span class="sxs-lookup"><span data-stu-id="a1c68-145">You can configure VPN gateways in a topology such that on-premises connectivity for a VNet is achieved by connecting to another VNet that is directly connected to on-premises.</span></span> <span data-ttu-id="a1c68-146">Si tratta di connettività VPN di transito in cui le istanze nella prima rete virtuale vengono connesse alle risorse locali tramite il transito al gateway VPN nella rete virtuale connessa, che è connessa direttamente alle risorse locali.</span><span class="sxs-lookup"><span data-stu-id="a1c68-146">This is transit VPN connectivity where instances in first VNet are connected to on-premises resources via transit to the VPN gateway in connected VNet that is directly connected to on-premises.</span></span> <span data-ttu-id="a1c68-147">Per ottenere questa configurazione nel modello di distribuzione classica, è necessario creare un sito locale che dispone di prefissi aggregati che rappresentano sia la rete virtuale connessa sia lo spazio di indirizzi locali.</span><span class="sxs-lookup"><span data-stu-id="a1c68-147">To achieve this configuration in classic deployment model, you would need to create a local site which has aggregated prefixes representing both the connected VNet and on-premises address space.</span></span> <span data-ttu-id="a1c68-148">Questo sito locale di rappresentazione viene quindi connesso alla rete virtuale per ottenere la connettività di transito.</span><span class="sxs-lookup"><span data-stu-id="a1c68-148">This representational local site is then connected to the VNet to achieve transit connectivity.</span></span> <span data-ttu-id="a1c68-149">Anche il modello classico presenta problemi di gestibilità simili poiché qualsiasi modifica all'intervallo di indirizzi locali deve essere gestita anche nel sito locale che rappresenta l'aggregazione di rete virtuale e risorse locali.</span><span class="sxs-lookup"><span data-stu-id="a1c68-149">This classic model also has similar manageability challenges since any change in on-premises address range must also be maintained on the local site representing the aggregate of VNet and on-premises.</span></span> <span data-ttu-id="a1c68-150">L'introduzione del supporto del protocollo BGP nei gateway supportati da Resource Manager semplifica la gestibilità poiché i gateway connessi possono apprendere le route da locale senza modificare manualmente i prefissi.</span><span class="sxs-lookup"><span data-stu-id="a1c68-150">Introduction of BGP support in Resource Manager supported gateways simplifies manageability since the connected gateways can learn routes from on premises without manual modification to prefixes.</span></span>

![Screenshot dello scenario di routing di transito.](./media/vpn-gateway-migration/migration2.png)

<span data-ttu-id="a1c68-152">Poiché la connettività da rete virtuale a rete virtuale viene trasformata senza richiedere siti locali, lo scenario di transito perde la connettività locale per la rete virtuale connessa indirettamente alle risorse locali.</span><span class="sxs-lookup"><span data-stu-id="a1c68-152">Since we transform VNet to VNet connectivity without requiring local sites, the transit scenario loses on-premises connectivity for VNet that is indirectly connected to on-premises.</span></span> <span data-ttu-id="a1c68-153">Al termine della migrazione, la perdita di connettività può essere attenuata procedendo nei due modi seguenti:</span><span class="sxs-lookup"><span data-stu-id="a1c68-153">The loss of connectivity can be mitigated in the following two ways, after migration is completed -</span></span> 

* <span data-ttu-id="a1c68-154">Abilitare il protocollo BGP sui gateway VPN connessi tra loro e alle risorse locali.</span><span class="sxs-lookup"><span data-stu-id="a1c68-154">Enable BGP on VPN gateways that are connected together and to on-premises.</span></span> <span data-ttu-id="a1c68-155">L'abilitazione del protocollo BGP ripristina la connettività senza apportare altre modifiche di configurazione poiché le route vengono apprese e annunciate tra i gateway di rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="a1c68-155">Enabling BGP restores connectivity without any other configuration change since routes are learned and advertised between VNet gateways.</span></span> <span data-ttu-id="a1c68-156">Si noti che l'opzione BGP è disponibile solo per le unità SKU standard e versioni successive.</span><span class="sxs-lookup"><span data-stu-id="a1c68-156">Note that BGP option is only available on Standard and higher SKUs.</span></span>
* <span data-ttu-id="a1c68-157">Stabilire una connessione esplicita dalla rete virtuale interessata al gateway di rete locale che rappresenta la posizione locale.</span><span class="sxs-lookup"><span data-stu-id="a1c68-157">Establish an explicit connection from affected VNet to the local network gateway representing on-premises location.</span></span> <span data-ttu-id="a1c68-158">Per creare e configurare il tunnel IPsec, potrebbe essere necessario anche modificare la configurazione del router locale.</span><span class="sxs-lookup"><span data-stu-id="a1c68-158">This would also require changing configuration on the on-premises router to create and configure the IPsec tunnel.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a1c68-159">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="a1c68-159">Next steps</span></span>
<span data-ttu-id="a1c68-160">Dopo le informazioni sul supporto della migrazione di gateway VPN, leggere [Migrazione di risorse IaaS supportata dalla piattaforma dal modello classico a quello di Resource Manager](../virtual-machines/windows/migration-classic-resource-manager-ps.md) per iniziare.</span><span class="sxs-lookup"><span data-stu-id="a1c68-160">After learning about VPN gateway migration support, go to [platform-supported migration of IaaS resources from classic to Resource Manager](../virtual-machines/windows/migration-classic-resource-manager-ps.md) to get started.</span></span>

