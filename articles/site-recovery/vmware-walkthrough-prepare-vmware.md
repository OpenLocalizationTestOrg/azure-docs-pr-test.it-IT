---
title: Preparare le risorse VMware locali per la replica in Azure con Azure Site Recovery | Microsoft Docs
description: Riepilogo dei passaggi necessari per replicare in Archiviazione di Azure i carichi di lavoro in esecuzione in VM VMware
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 6aba0e89-ad7c-467e-9db2-cfb3bfe4c7d6
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: raynew
ms.openlocfilehash: 3e1c589030210c2eae1ad9c02811775d9d6365d4
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/18/2017
---
# <a name="step-6-prepare-on-premises-vmware-replication-to-azure"></a><span data-ttu-id="2a769-103">Passaggio 6: Preparare la replica dell'ambiente VMware locale in Azure</span><span class="sxs-lookup"><span data-stu-id="2a769-103">Step 6: Prepare on-premises VMware replication to Azure</span></span>

<span data-ttu-id="2a769-104">Usare le istruzioni riportate in questo articolo per preparare i server VMware locali per l'interazione con Azure Site Recovery e le VM VMware per l'installazione del servizio Mobility.</span><span class="sxs-lookup"><span data-stu-id="2a769-104">Use the instructions in this article to prepare on-premises VMware servers to interact with Azure Site Recovery, and prepare VMWare VMs for installation of the Mobility service.</span></span> <span data-ttu-id="2a769-105">L'agente del servizio Mobility deve essere installato in tutte le VM locali di cui si vuole eseguire la replica in Azure.</span><span class="sxs-lookup"><span data-stu-id="2a769-105">The Mobility service agent must be installed on all on-premises VMs that you want to replicate to Azure.</span></span>

## <a name="prepare-for-automatic-discovery"></a><span data-ttu-id="2a769-106">Eseguire la preparazione per l'individuazione automatica</span><span class="sxs-lookup"><span data-stu-id="2a769-106">Prepare for automatic discovery</span></span>

<span data-ttu-id="2a769-107">Site Recovery individua automaticamente le macchine virtuali eseguite in host vSphere ESXi (con o senza server vCenter).</span><span class="sxs-lookup"><span data-stu-id="2a769-107">Site Recovery automatically discovers VMs running on vSphere ESXi hosts (with or without a vCenter server).</span></span> <span data-ttu-id="2a769-108">Per eseguire l'individuazione automatica, Site Recovery richiede un account per accedere agli host e ai server:</span><span class="sxs-lookup"><span data-stu-id="2a769-108">For automatic discovery, Site Recovery needs an account to access hosts and servers:</span></span>

1. <span data-ttu-id="2a769-109">Per usare un account dedicato, creare un ruolo a livello di vCenter con le autorizzazioni descritte nella tabella seguente.</span><span class="sxs-lookup"><span data-stu-id="2a769-109">To use a dedicated account, create a role (at the vCenter level, with the permissions described in the table below.</span></span> <span data-ttu-id="2a769-110">Assegnare un nome all'account, ad esempio **Azure_Site_Recovery**.</span><span class="sxs-lookup"><span data-stu-id="2a769-110">Give it a name such as **Azure_Site_Recovery**.</span></span>
2. <span data-ttu-id="2a769-111">Creare quindi un utente nell'host vSphere o nel server vCenter e assegnare il ruolo all'utente.</span><span class="sxs-lookup"><span data-stu-id="2a769-111">Then, create a user on the vSphere host/vCenter server, and assign the role to the user.</span></span> <span data-ttu-id="2a769-112">Questo account utente viene specificato durante la distribuzione di Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="2a769-112">You specify this user account during Site Recovery deployment.</span></span>


### <a name="vmware-account-permissions"></a><span data-ttu-id="2a769-113">Autorizzazioni dell'account VMware</span><span class="sxs-lookup"><span data-stu-id="2a769-113">VMware account permissions</span></span>

<span data-ttu-id="2a769-114">Site Recovery deve avere accesso a VMware per l'individuazione automatica delle VM da parte del server di elaborazione e per il failover e il failback delle VM.</span><span class="sxs-lookup"><span data-stu-id="2a769-114">Site Recovery needs access to VMware for the process server to automatically discover VMs, and for failover and failback of VMs.</span></span>

- <span data-ttu-id="2a769-115">**Migrazione**: se si vuole eseguire solo la migrazione di VM VMware in Azure, senza failback, è possibile usare un account VMware con un ruolo di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="2a769-115">**Migrate**: If you only want to migrate VMware VMs to Azure, without ever failing them back, you can use a VMware account with a read-only role.</span></span> <span data-ttu-id="2a769-116">Un ruolo di questo tipo può eseguire il failover, ma non arrestare i computer di origine protetti.</span><span class="sxs-lookup"><span data-stu-id="2a769-116">Such a role can run failover, but can't shut down protected source machines.</span></span> <span data-ttu-id="2a769-117">Ciò non è necessario per la migrazione.</span><span class="sxs-lookup"><span data-stu-id="2a769-117">This isn't necessary for migration.</span></span>
- <span data-ttu-id="2a769-118">**Replica/ripristino**: se si vuole distribuire una replica completa (replica, failover e failback), l'account deve poter eseguire operazioni come la creazione e la rimozione di dischi, l'accensione di VM e così via.</span><span class="sxs-lookup"><span data-stu-id="2a769-118">**Replicate/Recover**: If you want to deploy full replication (replicate, failover, failback) the account must be able to run operations such as creating and removing disks, powering on VMs etc.</span></span>
- <span data-ttu-id="2a769-119">**Individuazione automatica**: è necessario almeno un account di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="2a769-119">**Automatic discovery**: At least a read-only account is required.</span></span>


<span data-ttu-id="2a769-120">**Attività**</span><span class="sxs-lookup"><span data-stu-id="2a769-120">**Task**</span></span> | <span data-ttu-id="2a769-121">**Account/ruolo necessario**</span><span class="sxs-lookup"><span data-stu-id="2a769-121">**Required account/role**</span></span> | <span data-ttu-id="2a769-122">**Autorizzazioni**</span><span class="sxs-lookup"><span data-stu-id="2a769-122">**Permissions**</span></span> | <span data-ttu-id="2a769-123">**Dettagli**</span><span class="sxs-lookup"><span data-stu-id="2a769-123">**Details**</span></span>
--- | --- | --- | ---
<span data-ttu-id="2a769-124">**Individuazione automatica delle VM VMware da parte del server di elaborazione**</span><span class="sxs-lookup"><span data-stu-id="2a769-124">**Process server automatically discovers VMware VMs**</span></span> | <span data-ttu-id="2a769-125">È necessario almeno un utente di sola lettura</span><span class="sxs-lookup"><span data-stu-id="2a769-125">You need at least a read-only user</span></span> | <span data-ttu-id="2a769-126">Data Center object (Oggetto data center)–> Propagate to Child Object (Propaga a oggetto figlio), role=Read-only (ruolo=Sola lettura)</span><span class="sxs-lookup"><span data-stu-id="2a769-126">Data Center object –> Propagate to Child Object, role=Read-only</span></span> | <span data-ttu-id="2a769-127">L'utente viene assegnato a livello di data center e ha accesso a tutti gli oggetti nel data center.</span><span class="sxs-lookup"><span data-stu-id="2a769-127">User assigned at datacenter level, and has access to all the objects in the datacenter.</span></span><br/><br/> <span data-ttu-id="2a769-128">Per limitare l'accesso, assegnare il ruolo **No access** (Nessun accesso) con **Propagate to child object** (Propaga a oggetto figlio) agli oggetti figlio (host vSphere, archivi dati, VM e reti).</span><span class="sxs-lookup"><span data-stu-id="2a769-128">To restrict access, assign the **No access** role with the **Propagate to child** object, to the child objects (vSphere hosts, datastores, VMs and networks).</span></span>
<span data-ttu-id="2a769-129">**Failover**</span><span class="sxs-lookup"><span data-stu-id="2a769-129">**Failover**</span></span> | <span data-ttu-id="2a769-130">È necessario almeno un utente di sola lettura</span><span class="sxs-lookup"><span data-stu-id="2a769-130">You need at least a read-only user</span></span> | <span data-ttu-id="2a769-131">Data Center object (Oggetto data center)–> Propagate to Child Object (Propaga a oggetto figlio), role=Read-only (ruolo=Sola lettura)</span><span class="sxs-lookup"><span data-stu-id="2a769-131">Data Center object –> Propagate to Child Object, role=Read-only</span></span> | <span data-ttu-id="2a769-132">L'utente viene assegnato a livello di data center e ha accesso a tutti gli oggetti nel data center.</span><span class="sxs-lookup"><span data-stu-id="2a769-132">User assigned at datacenter level, and has access to all the objects in the datacenter.</span></span><br/><br/> <span data-ttu-id="2a769-133">Per limitare l'accesso, assegnare il ruolo **No access** (Nessun accesso) con **Propagate to child object** (Propaga a oggetto figlio) agli oggetti figlio (host vSphere, archivi dati, VM e reti).</span><span class="sxs-lookup"><span data-stu-id="2a769-133">To restrict access, assign the **No access** role with the **Propagate to child** object to the child objects (vSphere hosts, datastores, VMs and networks).</span></span><br/><br/> <span data-ttu-id="2a769-134">È utile ai fini della migrazione, ma non per la replica completa, il failover e il failback.</span><span class="sxs-lookup"><span data-stu-id="2a769-134">Useful for migration purposes, but not full replication, failover, failback.</span></span>
<span data-ttu-id="2a769-135">**Failover e failback**</span><span class="sxs-lookup"><span data-stu-id="2a769-135">**Failover and failback**</span></span> | <span data-ttu-id="2a769-136">Suggeriamo di creare un ruolo (Azure_Site_Recovery) con le necessarie autorizzazioni e poi assegnare il ruolo a un utente o gruppo VMware</span><span class="sxs-lookup"><span data-stu-id="2a769-136">We suggest you create a role (Azure_Site_Recovery) with the required permissions, and then assign the role to a VMware user or group</span></span> | <span data-ttu-id="2a769-137">Data Center object (Oggetto data center) –> Propagate to Child Object (Propaga a oggetto figlio), role=Azure_Site_Recovery (ruolo=Azure_Site_Recovery)</span><span class="sxs-lookup"><span data-stu-id="2a769-137">Data Center object –> Propagate to Child Object, role=Azure_Site_Recovery</span></span><br/><br/> <span data-ttu-id="2a769-138">Datastore (Archivio dati) -> Allocate space (Alloca spazio), Browse datastore (Sfoglia archivio dati), Low level file operations (Operazioni file di livello basso), Remove file (Rimuovi file), Update virtual machine files (Aggiorna file macchina virtuale)</span><span class="sxs-lookup"><span data-stu-id="2a769-138">Datastore -> Allocate space, browse datastore, low-level file operations, remove file, update virtual machine files</span></span><br/><br/> <span data-ttu-id="2a769-139">Network (Rete) -> Network assign (Assegnazione rete)</span><span class="sxs-lookup"><span data-stu-id="2a769-139">Network -> Network assign</span></span><br/><br/> <span data-ttu-id="2a769-140">Risorsa -> Assegnare VM al pool di risorse, migrare la VM spenta, migrare la VM accesa</span><span class="sxs-lookup"><span data-stu-id="2a769-140">Resource -> Assign VM to resource pool, migrate powered off VM, migrate powered on VM</span></span><br/><br/> <span data-ttu-id="2a769-141">Tasks (Attività) -> Create task (Crea attività), Update task (Aggiorna attività)</span><span class="sxs-lookup"><span data-stu-id="2a769-141">Tasks -> Create task, update task</span></span><br/><br/> <span data-ttu-id="2a769-142">Virtual machine (Macchina virtuale) -> Configuration (Configurazione)</span><span class="sxs-lookup"><span data-stu-id="2a769-142">Virtual machine -> Configuration</span></span><br/><br/> <span data-ttu-id="2a769-143">Virtual machine (Macchina virtuale) -> Interact (Interagisci) -> Answer question (Rispondi alla domanda), Device connection (Connessione dispositivo), Configure CD media (Configura supporto CD), Configure floppy media (Configura supporto floppy), Power off (Spegni), Power on (Accendi), VMware tools install (Installazione strumenti VMware)</span><span class="sxs-lookup"><span data-stu-id="2a769-143">Virtual machine -> Interact -> answer question, device connection, configure CD media, configure floppy media, power off, power on, VMware tools install</span></span><br/><br/> <span data-ttu-id="2a769-144">Virtual machine (Macchina virtuale) -> Inventory (Inventario) -> Create (Crea), Register (Registra), Unregister (Annulla registrazione)</span><span class="sxs-lookup"><span data-stu-id="2a769-144">Virtual machine -> Inventory -> Create, register, unregister</span></span><br/><br/> <span data-ttu-id="2a769-145">Virtual machine (Macchina virtuale) -> Provisioning -> Allow virtual machine download (Consenti download macchina virtuale), Allow virtual machine files upload (Consenti upload file macchina virtuale)</span><span class="sxs-lookup"><span data-stu-id="2a769-145">Virtual machine -> Provisioning -> Allow virtual machine download, allow virtual machine files upload</span></span><br/><br/> <span data-ttu-id="2a769-146">Macchina virtuale -> Snapshots -> Remove snapshots</span><span class="sxs-lookup"><span data-stu-id="2a769-146">Virtual machine -> Snapshots -> Remove snapshots</span></span> | <span data-ttu-id="2a769-147">L'utente viene assegnato a livello di data center e ha accesso a tutti gli oggetti nel data center.</span><span class="sxs-lookup"><span data-stu-id="2a769-147">User assigned at datacenter level, and has access to all the objects in the datacenter.</span></span><br/><br/> <span data-ttu-id="2a769-148">Per limitare l'accesso, assegnare il ruolo **No access** (Nessun accesso) con **Propagate to child object** (Propaga a oggetto figlio) agli oggetti figlio (host vSphere, archivi dati, VM e reti).</span><span class="sxs-lookup"><span data-stu-id="2a769-148">To restrict access, assign the **No access** role with the **Propagate to child** object, to the child objects (vSphere hosts, datastores, VMs and networks).</span></span>


## <a name="prepare-for-push-installation-of-the-mobility-service"></a><span data-ttu-id="2a769-149">Eseguire la preparazione per l'installazione push del servizio Mobility</span><span class="sxs-lookup"><span data-stu-id="2a769-149">Prepare for push installation of the Mobility service</span></span>

<span data-ttu-id="2a769-150">Il servizio Mobility deve essere installato in tutte le VM da replicare.</span><span class="sxs-lookup"><span data-stu-id="2a769-150">The Mobility service must be installed on all VMs you want to replicate.</span></span> <span data-ttu-id="2a769-151">Ci sono diversi modi per installare il servizio, tra cui installazione manuale, installazione push dal server di elaborazione di Site Recovery e installazione con metodi come System Center Configuration Manager.</span><span class="sxs-lookup"><span data-stu-id="2a769-151">There are a number of ways to install the service, including manual installation, push installation from the Site Recovery process server, and installation using methods such as System Center Configuration Manager.</span></span>

<span data-ttu-id="2a769-152">Se si vuole usare l'installazione push, è necessario preparare un account che Site Recovery possa usare per accedere alla VM.</span><span class="sxs-lookup"><span data-stu-id="2a769-152">If you want to use push installation, you need to prepare an account that Site Recovery can use to access the VM.</span></span>

- <span data-ttu-id="2a769-153">È possibile usare un account di dominio o locale</span><span class="sxs-lookup"><span data-stu-id="2a769-153">You can use a domain or local account</span></span>
- <span data-ttu-id="2a769-154">Per Windows, se non si usa un account di dominio è necessario disabilitare il Controllo dell'accesso utente remoto nel computer locale.</span><span class="sxs-lookup"><span data-stu-id="2a769-154">For Windows, if you're not using a domain account, you need to disable Remote User Access control on the local machine.</span></span> <span data-ttu-id="2a769-155">A questo scopo, aggiungere la voce DWORD **LocalAccountTokenFilterPolicy** con un valore di 1 nel Registro di sistema in **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System**.</span><span class="sxs-lookup"><span data-stu-id="2a769-155">To do this, in the register under **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System**, add the DWORD entry **LocalAccountTokenFilterPolicy**, with a value of 1.</span></span>
- <span data-ttu-id="2a769-156">Per aggiungere la voce del Registro di sistema per Windows da un'interfaccia della riga di comando, digitare:       ``REG ADD HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1.``</span><span class="sxs-lookup"><span data-stu-id="2a769-156">If you want to add the registry entry for Windows from a CLI, type:       ``REG ADD HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1.``</span></span>
- <span data-ttu-id="2a769-157">Per Linux, l'account deve essere radice nel server Linux di origine.</span><span class="sxs-lookup"><span data-stu-id="2a769-157">For Linux, the account should be root on the source Linux server.</span></span>



## <a name="next-steps"></a><span data-ttu-id="2a769-158">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="2a769-158">Next steps</span></span>

<span data-ttu-id="2a769-159">Andare a [Passaggio 7: Creare un insieme di credenziali](vmware-walkthrough-create-vault.md)</span><span class="sxs-lookup"><span data-stu-id="2a769-159">Go to [Step 7: Create a vault](vmware-walkthrough-create-vault.md)</span></span>
