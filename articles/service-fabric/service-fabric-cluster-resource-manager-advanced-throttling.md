---
title: Limitazione in Cluster Resource Manager di Service Fabric | Microsoft Docs
description: Informazioni sulla configurazione delle limitazioni messe a disposizione da Cluster Resource Manager di Service Fabric.
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 4a44678b-a5aa-4d30-958f-dc4332ebfb63
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 1be0beaf2e199a9c384187efd80b33c7dab5e87c
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/18/2017
---
# <a name="throttling-the-service-fabric-cluster-resource-manager"></a><span data-ttu-id="00203-103">Limitazione del Cluster Resource Manager di Service Fabric</span><span class="sxs-lookup"><span data-stu-id="00203-103">Throttling the Service Fabric Cluster Resource Manager</span></span>
<span data-ttu-id="00203-104">Anche se Cluster Resource Manager è stato configurato correttamente, il cluster può essere interrotto.</span><span class="sxs-lookup"><span data-stu-id="00203-104">Even if you’ve configured the Cluster Resource Manager correctly, the cluster can get disrupted.</span></span> <span data-ttu-id="00203-105">Ad esempio potrebbero verificarsi errori simultanei di nodi e di domini di errore. Che cosa succederebbe se ciò si verificasse durante un aggiornamento?</span><span class="sxs-lookup"><span data-stu-id="00203-105">For example, there could be simultaneous node and fault domain failures - what would happen if that occurred during an upgrade?</span></span> <span data-ttu-id="00203-106">Cluster Resource Manager tenta sempre di correggere tutti gli elementi, usando le risorse del cluster nel tentativo di riorganizzare e correggere il cluster.</span><span class="sxs-lookup"><span data-stu-id="00203-106">The Cluster Resource Manager always tries to fix everything, consuming the cluster's resources trying to reorganize and fix the cluster.</span></span> <span data-ttu-id="00203-107">Le limitazioni contribuiscono a creare una barriera in modo che il cluster possa impiegare risorse per stabilizzarsi: vengono ripristinati i nodi, vengono riparate le partizioni di rete e vengono distribuiti i bit corretti.</span><span class="sxs-lookup"><span data-stu-id="00203-107">Throttles help provide a backstop so that the cluster can use resources to stabilize - the nodes come back, the network partitions heal, corrected bits get deployed.</span></span>

<span data-ttu-id="00203-108">Per risolvere questi tipi di situazioni, Cluster Resource Manager di Service Fabric prevede diverse limitazioni.</span><span class="sxs-lookup"><span data-stu-id="00203-108">To help with these sorts of situations, the Service Fabric Cluster Resource Manager includes several throttles.</span></span> <span data-ttu-id="00203-109">Queste limitazioni intervengono tutte in modo piuttosto pesante.</span><span class="sxs-lookup"><span data-stu-id="00203-109">These throttles are all fairly large hammers.</span></span> <span data-ttu-id="00203-110">In genere non devono essere modificate senza una pianificazione e un test accurati.</span><span class="sxs-lookup"><span data-stu-id="00203-110">Generally they shouldn’t be changed without careful planning and testing.</span></span>

<span data-ttu-id="00203-111">Se si modificano le limitazioni di Cluster Resource Manager, è consigliabile ottimizzarle al carico effettivo previsto.</span><span class="sxs-lookup"><span data-stu-id="00203-111">If you change the Cluster Resource Manager's throttles, you should tune them to your expected actual load.</span></span> <span data-ttu-id="00203-112">Potrebbe essere necessario introdurre alcune limitazioni, anche se ciò significa che il cluster impiega più tempo per stabilizzarsi in alcune situazioni.</span><span class="sxs-lookup"><span data-stu-id="00203-112">You may determine you need to have some throttles in place, even if it means the cluster takes longer to stabilize in some situations.</span></span> <span data-ttu-id="00203-113">Il test è obbligatorio per determinare i valori corretti per le limitazioni.</span><span class="sxs-lookup"><span data-stu-id="00203-113">Testing is required to determine the correct values for throttles.</span></span> <span data-ttu-id="00203-114">Le limitazioni devono essere sufficientemente alte in modo da consentire al cluster di rispondere alle modifiche in un intervallo di tempo ragionevole, e sufficientemente basse per impedire effettivamente un eccessivo consumo di risorse.</span><span class="sxs-lookup"><span data-stu-id="00203-114">Throttles need to be high enough to allow the cluster to respond to changes in a reasonable amount of time, and low enough to actually prevent too much resource consumption.</span></span> 

<span data-ttu-id="00203-115">Nella maggior parte dei casi è stato notato che i clienti usano delle limitazioni perché si trovavano già in un ambiente dalle risorse limitate.</span><span class="sxs-lookup"><span data-stu-id="00203-115">Most of the time we’ve seen customers use throttles it has been because they were already in a resource constrained environment.</span></span> <span data-ttu-id="00203-116">Alcuni esempi sono una limitata larghezza di banda per singoli nodi o dischi non in grado di compilare molte repliche con stato in parallelo a causa di limiti di velocità effettiva.</span><span class="sxs-lookup"><span data-stu-id="00203-116">Some examples would be limited network bandwidth for individual nodes, or disks that aren't able to build many stateful replicas in parallel due to throughput limitations.</span></span> <span data-ttu-id="00203-117">Senza limitazioni, le operazioni potrebbero sovraccaricare queste risorse, causando l'esito negativo delle operazione o un loro rallentamento.</span><span class="sxs-lookup"><span data-stu-id="00203-117">Without throttles, operations could overwhelm these resources, causing operations to fail or be slow.</span></span> <span data-ttu-id="00203-118">In queste situazioni i clienti usavano delle limitazioni sapevano che il tempo richiesto al cluster per raggiungere uno stato stabile sarebbe stato maggiore.</span><span class="sxs-lookup"><span data-stu-id="00203-118">In these situations customers used throttles and knew they were extending the amount of time it would take the cluster to reach a stable state.</span></span> <span data-ttu-id="00203-119">I clienti inoltre hanno compreso anche che il livello complessivo di affidabilità era inferiore in presenza di limitazioni.</span><span class="sxs-lookup"><span data-stu-id="00203-119">Customers also understood they could end up running at lower overall reliability while they were throttled.</span></span>


## <a name="configuring-the-throttles"></a><span data-ttu-id="00203-120">Configurazione delle limitazioni</span><span class="sxs-lookup"><span data-stu-id="00203-120">Configuring the throttles</span></span>

<span data-ttu-id="00203-121">Service Fabric ha due meccanismi per la limitazione del numero di spostamenti della replica.</span><span class="sxs-lookup"><span data-stu-id="00203-121">Service Fabric has two mechanisms for throttling the number of replica movements.</span></span> <span data-ttu-id="00203-122">Il meccanismo predefinito che esisteva prima di Service Fabric 5.7 rappresenta la limitazione come un numero assoluto di spostamenti consentito.</span><span class="sxs-lookup"><span data-stu-id="00203-122">The default mechanism that existed before Service Fabric 5.7 represents throttling as an absolute number of moves allowed.</span></span> <span data-ttu-id="00203-123">Non funziona per i cluster di tutte le dimensioni.</span><span class="sxs-lookup"><span data-stu-id="00203-123">This does not work for clusters of all sizes.</span></span> <span data-ttu-id="00203-124">In particolare, per i cluster di grandi dimensioni il valore predefinito può essere troppo piccolo, rallentando notevolmente il bilanciamento del carico anche quando è necessario, mentre non ha alcun impatto nei cluster più piccoli.</span><span class="sxs-lookup"><span data-stu-id="00203-124">In particular, for large clusters the default value can be too small, significantly slowing down balancing even when it is necessary, while having no effect in smaller clusters.</span></span> <span data-ttu-id="00203-125">Il meccanismo precedentemente descritto è stato sostituito dalla limitazione basata sulla percentuale, che offre una scalabilità migliore con i cluster dinamici in cui il numero di servizi e i nodi cambia regolarmente.</span><span class="sxs-lookup"><span data-stu-id="00203-125">This prior mechanism has been superseded by percentage-based throttling, which scales better with dynamic clusters in which the number of services and nodes change regularly.</span></span>

<span data-ttu-id="00203-126">Le limitazioni sono basate su una percentuale del numero di repliche dei cluster.</span><span class="sxs-lookup"><span data-stu-id="00203-126">The throttles are based on a percentage of the number of replicas in the clusters.</span></span> <span data-ttu-id="00203-127">Le limitazioni basate sulla percentuale abilitano l'espressione della regola: "non spostare più del 10% di repliche in un intervallo di 10 minuti", ad esempio.</span><span class="sxs-lookup"><span data-stu-id="00203-127">Percetage based throttles enable expressing the rule: "do not move more than 10% of replicas in a 10 minute interval", for example.</span></span>

<span data-ttu-id="00203-128">Le impostazioni di configurazione per la limitazione basata sulla percentuale sono:</span><span class="sxs-lookup"><span data-stu-id="00203-128">The configuration settings for percentage-based throttling are:</span></span>

  - <span data-ttu-id="00203-129">GlobalMovementThrottleThresholdPercentage: numero massimo di movimenti consentiti nel cluster in qualsiasi momento, espresso come percentuale del numero totale di repliche del cluster.</span><span class="sxs-lookup"><span data-stu-id="00203-129">GlobalMovementThrottleThresholdPercentage - Maximum number of movements allowed in cluster at any time, expressed as percentage of total number of replicas in the cluster.</span></span> <span data-ttu-id="00203-130">Impostarlo su 0 per non avere limiti.</span><span class="sxs-lookup"><span data-stu-id="00203-130">0 indicates no limit.</span></span> <span data-ttu-id="00203-131">Il valore predefinito è 0.</span><span class="sxs-lookup"><span data-stu-id="00203-131">The default value is 0.</span></span> <span data-ttu-id="00203-132">Se vengono specificati sia l'impostazione sia la GlobalMovementThrottleThreshold, viene usato il limite più conservativo.</span><span class="sxs-lookup"><span data-stu-id="00203-132">If both this setting and GlobalMovementThrottleThreshold are specified, then the more conservative limit is used.</span></span>
  - <span data-ttu-id="00203-133">GlobalMovementThrottleThresholdPercentageForPlacement: numero massimo di movimenti consentiti durante la fase di posizionamento, espresso come percentuale del numero totale di repliche del cluster.</span><span class="sxs-lookup"><span data-stu-id="00203-133">GlobalMovementThrottleThresholdPercentageForPlacement - Maximum number of movements allowed during the placement phase, expressed as percentage of total number of replicas in the cluster.</span></span> <span data-ttu-id="00203-134">Impostarlo su 0 per non avere limiti.</span><span class="sxs-lookup"><span data-stu-id="00203-134">0 indicates no limit.</span></span> <span data-ttu-id="00203-135">Il valore predefinito è 0.</span><span class="sxs-lookup"><span data-stu-id="00203-135">The default value is 0.</span></span> <span data-ttu-id="00203-136">Se vengono specificati sia l'impostazione sia la GlobalMovementThrottleThresholdForPlacement, viene usato il limite più conservativo.</span><span class="sxs-lookup"><span data-stu-id="00203-136">If both this setting and GlobalMovementThrottleThresholdForPlacement are specified, then the more conservative limit is used.</span></span>
  - <span data-ttu-id="00203-137">GlobalMovementThrottleThresholdPercentageForBalancing: numero massimo di movimenti consentiti durante la fase di bilanciamento, espresso come percentuale del numero totale di repliche del cluster.</span><span class="sxs-lookup"><span data-stu-id="00203-137">GlobalMovementThrottleThresholdPercentageForBalancing - Maximum number of movements allowed during the balancing phase, expressed as percentage of total number of replicas in the cluster.</span></span> <span data-ttu-id="00203-138">Impostarlo su 0 per non avere limiti.</span><span class="sxs-lookup"><span data-stu-id="00203-138">0 indicates no limit.</span></span> <span data-ttu-id="00203-139">Il valore predefinito è 0.</span><span class="sxs-lookup"><span data-stu-id="00203-139">The default value is 0.</span></span> <span data-ttu-id="00203-140">Se vengono specificati sia l'impostazione sia la GlobalMovementThrottleThresholdPercentageForBalancing, viene usato il limite più conservativo.</span><span class="sxs-lookup"><span data-stu-id="00203-140">If both this setting and GlobalMovementThrottleThresholdForBalancing are specified, then the more conservative limit is used.</span></span>

<span data-ttu-id="00203-141">Quando si specifica la percentuale di limitazione, è necessario specificare 5% come 0,05.</span><span class="sxs-lookup"><span data-stu-id="00203-141">When specifying the throttle percentage, you'd specify 5% as 0.05.</span></span> <span data-ttu-id="00203-142">L'intervallo in cui vengono gestite queste limitazioni è il GlobalMovementThrottleCountingInterval, che è espresso in secondi.</span><span class="sxs-lookup"><span data-stu-id="00203-142">The interval on which these throttles are governed is the GlobalMovementThrottleCountingInterval, which is specified in seconds.</span></span>


``` xml
<Section Name="PlacementAndLoadBalancing">
     <Parameter Name="GlobalMovementThrottleThresholdPercentage" Value="0" />
     <Parameter Name="GlobalMovementThrottleThresholdPercentageForPlacement" Value="0" />
     <Parameter Name="GlobalMovementThrottleThresholdPercentageForBalancing" Value="0" />
     <Parameter Name="GlobalMovementThrottleCountingInterval" Value="600" />
</Section>
```

<span data-ttu-id="00203-143">mediante ClusterConfig.json per le distribuzioni autonome o Template.json per i cluster ospitati in Azure:</span><span class="sxs-lookup"><span data-stu-id="00203-143">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "PlacementAndLoadBalancing",
    "parameters": [
      {
          "name": "GlobalMovementThrottleThresholdPercentage",
          "value": "0.0"
      },
      {
          "name": "GlobalMovementThrottleThresholdPercentageForPlacement",
          "value": "0.0"
      },
      {
          "name": "GlobalMovementThrottleThresholdPercentageForBalancing",
          "value": "0.0"
      },
      {
          "name": "GlobalMovementThrottleCountingInterval",
          "value": "600"
      }
    ]
  }
]
```

### <a name="default-count-based-throttles"></a><span data-ttu-id="00203-144">Limitazioni basate sul conteggio predefinito</span><span class="sxs-lookup"><span data-stu-id="00203-144">Default count based throttles</span></span>
<span data-ttu-id="00203-145">Queste informazioni vengono fornite nel caso in cui si disponga di cluster precedenti o si mantengano queste configurazioni in cluster che sono quindi stati aggiornati.</span><span class="sxs-lookup"><span data-stu-id="00203-145">This information is provided in case you have older clusters or still retain these configurations in clusters that have since been upgraded.</span></span> <span data-ttu-id="00203-146">In generale, è consigliabile che queste ultime vengano sostituite con le limitazioni basate su percentuale descritte in precedenza.</span><span class="sxs-lookup"><span data-stu-id="00203-146">In general, it is recommended that these are replaced with the percentage-based throttles above.</span></span> <span data-ttu-id="00203-147">Poiché la limitazione basata su percentuale è disabilitata per impostazione predefinita, queste limitazioni restano le limitazioni predefinite per un cluster finché non vengono disabilitate e sostituite con le limitazioni basate su percentuale.</span><span class="sxs-lookup"><span data-stu-id="00203-147">Since percentage-based throttling is disabled by default, these throttles remain the default throttles for a cluster until they are disabled and replaced with the percentage-based throttles.</span></span> 

  - <span data-ttu-id="00203-148">GlobalMovementThrottleThreshold: consente di controllare il numero totale di spostamenti nel cluster in un determinato intervallo di tempo.</span><span class="sxs-lookup"><span data-stu-id="00203-148">GlobalMovementThrottleThreshold – this setting controls the total number of movements in the cluster over some time.</span></span> <span data-ttu-id="00203-149">La quantità di tempo viene specificata in secondi come GlobalMovementThrottleCountingInterval.</span><span class="sxs-lookup"><span data-stu-id="00203-149">The amount of time is specified in seconds as the GlobalMovementThrottleCountingInterval.</span></span> <span data-ttu-id="00203-150">Il valore predefinito per la GlobalMovementThrottleThreshold è 1000 e il valore predefinito per il GlobalMovementThrottleCountingInterval è 600.</span><span class="sxs-lookup"><span data-stu-id="00203-150">The default value for the GlobalMovementThrottleThreshold is 1000 and the default value for the GlobalMovementThrottleCountingInterval is 600.</span></span>
  - <span data-ttu-id="00203-151">MovementPerPartitionThrottleThreshold: consente di controllare il numero totale di spostamenti per qualsiasi partizione di servizio in un determinato intervallo di tempo.</span><span class="sxs-lookup"><span data-stu-id="00203-151">MovementPerPartitionThrottleThreshold – this setting controls the total number of movements for any service partition over some time.</span></span> <span data-ttu-id="00203-152">La quantità di tempo viene specificata in secondi come MovementPerPartitionThrottleCountingInterval.</span><span class="sxs-lookup"><span data-stu-id="00203-152">The amount of time is specified in seconds as the MovementPerPartitionThrottleCountingInterval.</span></span> <span data-ttu-id="00203-153">Il valore predefinito per la MovementPerPartitionThrottleThreshold è 50 e il valore predefinito per il MovementPerPartitionThrottleCountingInterval è 600.</span><span class="sxs-lookup"><span data-stu-id="00203-153">The default value for the MovementPerPartitionThrottleThreshold is 50 and the default value for the MovementPerPartitionThrottleCountingInterval is 600.</span></span>

<span data-ttu-id="00203-154">La configurazione di queste limitazioni segue lo stesso modello delle limitazioni basate su percentuale.</span><span class="sxs-lookup"><span data-stu-id="00203-154">The configuration for these throttles follows the same pattern as the percentage-based throttling.</span></span>

## <a name="next-steps"></a><span data-ttu-id="00203-155">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="00203-155">Next steps</span></span>
- <span data-ttu-id="00203-156">Per informazioni sul modo in cui Cluster Resource Manager gestisce e bilancia il carico nel cluster, vedere l'articolo relativo al [bilanciamento del carico](service-fabric-cluster-resource-manager-balancing.md)</span><span class="sxs-lookup"><span data-stu-id="00203-156">To find out about how the Cluster Resource Manager manages and balances load in the cluster, check out the article on [balancing load](service-fabric-cluster-resource-manager-balancing.md)</span></span>
- <span data-ttu-id="00203-157">Cluster Resource Manager dispone di varie opzioni per descrivere il cluster.</span><span class="sxs-lookup"><span data-stu-id="00203-157">The Cluster Resource Manager has many options for describing the cluster.</span></span> <span data-ttu-id="00203-158">Per altre informazioni a riguardo vedere l'articolo [Descrivere un cluster di Service Fabric](service-fabric-cluster-resource-manager-cluster-description.md)</span><span class="sxs-lookup"><span data-stu-id="00203-158">To find out more about them, check out this article on [describing a Service Fabric cluster](service-fabric-cluster-resource-manager-cluster-description.md)</span></span>
