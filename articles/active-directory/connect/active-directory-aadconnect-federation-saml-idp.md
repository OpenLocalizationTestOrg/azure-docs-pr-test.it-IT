---
title: "Azure AD Connect: Usare un provider di identità SAML 2.0 per l'accesso Single Sign On | Microsoft Docs"
description: Questo argomento descrive l'uso di un IdP conforme a SAML 2.0 per l'accesso Single Sign-On.
services: active-directory
author: billmath
manager: femila
ms.custom: it-pro
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/13/2017
ms.author: billmath
ms.openlocfilehash: 048697f87383662506fb851bb3ea510c2cddf043
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/03/2017
---
#  <a name="use-a-saml-20-identity-provider-idp-for-single-sign-on"></a><span data-ttu-id="fc904-103">Usare un provider di identità (IdP) SAML 2.0 per l'accesso Single Sign-On</span><span class="sxs-lookup"><span data-stu-id="fc904-103">Use a SAML 2.0 Identity Provider (IdP) for Single Sign On</span></span>

<span data-ttu-id="fc904-104">Questo argomento contiene informazioni sull'uso di un provider di identità basato sul profilo SP-Lite conforme a SAML 2.0 come servizio token di sicurezza/provider di identità preferito.</span><span class="sxs-lookup"><span data-stu-id="fc904-104">This topic contains information on using a SAML 2.0 compliant SP-Lite profile based Identity Provider as the preferred Security Token Service (STS) / identity provider.</span></span> <span data-ttu-id="fc904-105">Si tratta di un'opzione utile quando si hanno già una directory di utenti e un archivio di password locali a cui è possibile accedere con SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="fc904-105">This is useful where you already have a user directory and password store on-premises that can be accessed using SAML 2.0.</span></span> <span data-ttu-id="fc904-106">La directory di utenti esistente può essere usata per l'accesso a Office 365 e ad altre risorse protette da Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fc904-106">This existing user directory can be used for sign-on to Office 365 and other Azure AD-secured resources.</span></span> <span data-ttu-id="fc904-107">Il profilo SP-Lite SAML 2.0 si basa sul diffuso standard di identità federate Security Assertion Markup Language (SAML) per fornire un framework di accesso e scambio degli attributi.</span><span class="sxs-lookup"><span data-stu-id="fc904-107">The SAML 2.0 SP-Lite profile is based on the widely used Security Assertion Markup Language (SAML) federated identity standard to provide a sign-on and attribute exchange framework.</span></span>

>[!NOTE]
><span data-ttu-id="fc904-108">Per un elenco di IdP di terze parti testati per l'uso con Azure AD, vedere l'[elenco di compatibilità di federazione di Azure AD](active-directory-aadconnect-federation-compatibility.md)</span><span class="sxs-lookup"><span data-stu-id="fc904-108">For a list of 3rd party Idps that have been tested for use with Azure AD see the [Azure AD federation compatibility list](active-directory-aadconnect-federation-compatibility.md)</span></span>

<span data-ttu-id="fc904-109">Microsoft supporta questa esperienza di accesso come integrazione di un servizio cloud Microsoft, ad esempio Office 365, con l'IdP basato sul profilo SAML 2.0 correttamente configurato.</span><span class="sxs-lookup"><span data-stu-id="fc904-109">Microsoft supports this sign-on experience as the integration of a Microsoft cloud service, such as Office 365, with your properly configured SAML 2.0 profile based IdP.</span></span> <span data-ttu-id="fc904-110">Poiché i provider di identità SAML 2.0 sono prodotti di terze parti, Microsoft non fornisce alcun supporto per la distribuzione, la configurazione, la risoluzione dei problemi e le procedure consigliate.</span><span class="sxs-lookup"><span data-stu-id="fc904-110">SAML 2.0 identity providers are third-party products and therefore Microsoft does not provide support for the deployment, configuration, troubleshooting best practices regarding them.</span></span> <span data-ttu-id="fc904-111">Una volta eseguita correttamente la configurazione, è possibile testare la corretta configurazione dell'integrazione con il provider di identità SAML 2.0 usando Microsoft Connectivity Analyzer Tool, descritto in dettaglio più avanti.</span><span class="sxs-lookup"><span data-stu-id="fc904-111">Once properly configured, the integration with the SAML 2.0 identity provider can be tested for proper configuration by using the Microsoft Connectivity Analyzer Tool which is described in more detail below.</span></span> <span data-ttu-id="fc904-112">Per altre informazioni sul provider di identità basato sul profilo SP-Lite SAML 2.0, rivolgersi all'organizzazione da cui è stato fornito.</span><span class="sxs-lookup"><span data-stu-id="fc904-112">For more information about your SAML 2.0 SP-Lite profile based identity provider, ask the organization that supplied it.</span></span>

>[!IMPORTANT]
><span data-ttu-id="fc904-113">In questo scenario di accesso con i provider di identità SAML 2.0 è disponibile solo un set limitato di client, tra cui:</span><span class="sxs-lookup"><span data-stu-id="fc904-113">Only a limited set of clients are available in this sign-on scenario with SAML 2.0 identity providers, this includes:</span></span>

>- <span data-ttu-id="fc904-114">Client basati sul Web, ad esempio Outlook Web Access e SharePoint Online</span><span class="sxs-lookup"><span data-stu-id="fc904-114">Web-based clients such as Outlook Web Access and SharePoint Online</span></span>
- <span data-ttu-id="fc904-115">Rich client di posta elettronica che usano l'autenticazione di base e un metodo di accesso di Exchange supportato come IMAP, POP, Active Sync, MAPI e così via (è necessario che sia distribuito l'endpoint ECP (Enhanced Client Protocol)), tra cui:</span><span class="sxs-lookup"><span data-stu-id="fc904-115">Email-rich clients that use basic authentication and a supported Exchange access method such as IMAP, POP, Active Sync, MAPI, etc. (the Enhanced Client Protocol end point is required to be deployed), including:</span></span>
    - <span data-ttu-id="fc904-116">Microsoft Outlook 2010/Outlook 2013/Outlook 2016, Apple iPhone (diverse versioni di iOS)</span><span class="sxs-lookup"><span data-stu-id="fc904-116">Microsoft Outlook 2010/Outlook 2013/Outlook 2016, Apple iPhone (various iOS versions)</span></span>
    - <span data-ttu-id="fc904-117">Diversi dispositivi Google Android</span><span class="sxs-lookup"><span data-stu-id="fc904-117">Various Google Android Devices</span></span>
    - <span data-ttu-id="fc904-118">Windows Phone 7, Windows Phone 7.8 e Windows Phone 8.0</span><span class="sxs-lookup"><span data-stu-id="fc904-118">Windows Phone 7, Windows Phone 7.8, and Windows Phone 8.0</span></span>
    - <span data-ttu-id="fc904-119">Client di posta elettronica di Windows 8 e Windows 8.1</span><span class="sxs-lookup"><span data-stu-id="fc904-119">Windows 8 Mail Client and Windows 8.1 Mail Client</span></span>
    - <span data-ttu-id="fc904-120">Client di posta elettronica di Windows 10</span><span class="sxs-lookup"><span data-stu-id="fc904-120">Windows 10 Mail Client</span></span>

<span data-ttu-id="fc904-121">Tutti gli altri client non sono disponibili in questo scenario di accesso con il provider di identità SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="fc904-121">All other clients are not available in this sign-on scenario with your SAML 2.0 Identity Provider.</span></span> <span data-ttu-id="fc904-122">Il client desktop Lync 2010 non può ad esempio accedere al servizio con il provider di identità SAML 2.0 configurato per l'accesso Single Sign-On.</span><span class="sxs-lookup"><span data-stu-id="fc904-122">For example, the Lync 2010 desktop client is not able to login into the service with your SAML 2.0 Identity Provider configured for single sign-on.</span></span>

## <a name="azure-ad-saml-20-protocol-requirements"></a><span data-ttu-id="fc904-123">Requisiti del protocollo SAML 2.0 in Azure AD</span><span class="sxs-lookup"><span data-stu-id="fc904-123">Azure AD SAML 2.0 protocol requirements</span></span>
<span data-ttu-id="fc904-124">Questo argomento contiene informazioni dettagliate sui requisiti relativi al protocollo e alla formattazione dei messaggi che il provider di identità SAML 2.0 deve implementare per configurare la federazione con Azure AD e consentire l'accesso a uno o più servizi cloud Microsoft (ad esempio Office 365).</span><span class="sxs-lookup"><span data-stu-id="fc904-124">This topic contains detailed requirements on the protocol and message formatting that your SAML 2.0 identity provider must implement to federate with Azure AD to enable sign-on to one or more Microsoft cloud services (such as Office 365).</span></span> <span data-ttu-id="fc904-125">La relying party SAML 2.0 (SP-STS) per un servizio cloud Microsoft in uso in questo scenario è Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fc904-125">The SAML 2.0 relying party (SP-STS) for a Microsoft cloud service used in this scenario is Azure AD.</span></span>

<span data-ttu-id="fc904-126">È consigliabile verificare che i messaggi di output del provider di identità SAML 2.0 siano il più simili possibile alle tracce di esempio fornite.</span><span class="sxs-lookup"><span data-stu-id="fc904-126">It is recommended that you ensure your SAML 2.0 identity provider output messages be as similar to the provided sample traces as possible.</span></span> <span data-ttu-id="fc904-127">Usare inoltre valori di attributo specifici dei metadati di Azure AD forniti, dove possibile.</span><span class="sxs-lookup"><span data-stu-id="fc904-127">Also, use specific attribute values from the supplied Azure AD metadata where possible.</span></span> <span data-ttu-id="fc904-128">Una volta ottenuti i messaggi di output desiderati, è possibile testarli con Microsoft Connectivity Analyzer, come descritto di seguito.</span><span class="sxs-lookup"><span data-stu-id="fc904-128">Once you are happy with your output messages, you can test with the Microsoft Connectivity Analyzer as described below.</span></span>

<span data-ttu-id="fc904-129">I metadati di Azure AD possono essere scaricati da questo URL: [https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml](http://https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml).</span><span class="sxs-lookup"><span data-stu-id="fc904-129">The Azure AD metadata can be downloaded from this URL: [https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml](http://https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml).</span></span>
<span data-ttu-id="fc904-130">Per i clienti in Cina che usano l'istanza di Office 365 specifica della Cina, è necessario usare l'endpoint di federazione seguente: [https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml](https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml).</span><span class="sxs-lookup"><span data-stu-id="fc904-130">For customers in China using the China-specific instance of Office 365, the following federation endpoint should be used: [https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml](https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml).</span></span>

## <a name="saml-protocol-requirements"></a><span data-ttu-id="fc904-131">Requisiti del protocollo SAML</span><span class="sxs-lookup"><span data-stu-id="fc904-131">SAML protocol requirements</span></span>
<span data-ttu-id="fc904-132">Questa sezione illustra in modo dettagliato come vengono combinate le coppie di messaggi di richiesta e di risposta per consentire la corretta formattazione dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="fc904-132">This section details how the request and response message pairs are put together in order to help you to format your messages correctly.</span></span>

<span data-ttu-id="fc904-133">È possibile configurare Azure AD per il funzionamento con i provider di identità che usano il profilo SP-Lite SAML 2.0 con alcuni requisiti specifici, come indicato di seguito.</span><span class="sxs-lookup"><span data-stu-id="fc904-133">Azure AD can be configured to work with identity providers that use the SAML 2.0 SP Lite profile with some specific requirements as listed below.</span></span> <span data-ttu-id="fc904-134">Usando i messaggi di richiesta e di risposta SAML di esempio insieme ai test automatizzati e manuali, è possibile ottenere l'interoperabilità con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fc904-134">Using the sample SAML request and response messages along with automated and manual testing, you can work to achieve interoperability with Azure AD.</span></span>

## <a name="signature-block-requirements"></a><span data-ttu-id="fc904-135">Requisiti del blocco di firma</span><span class="sxs-lookup"><span data-stu-id="fc904-135">Signature block requirements</span></span>
<span data-ttu-id="fc904-136">Nel messaggio di risposta SAML il nodo Signature contiene informazioni sulla firma digitale del messaggio stesso.</span><span class="sxs-lookup"><span data-stu-id="fc904-136">Within the SAML Response message the Signature node contains information about the digital signature for the message itself.</span></span> <span data-ttu-id="fc904-137">Il blocco di firma ha i requisiti seguenti:</span><span class="sxs-lookup"><span data-stu-id="fc904-137">The signature block has the following requirements:</span></span>

1. <span data-ttu-id="fc904-138">Il nodo di asserzione deve essere firmato</span><span class="sxs-lookup"><span data-stu-id="fc904-138">The assertion node itself must be signed</span></span>
2.  <span data-ttu-id="fc904-139">È necessario usare l'algoritmo RSA-sha1 come DigestMethod.</span><span class="sxs-lookup"><span data-stu-id="fc904-139">The RSA-sha1 algorithm must be used as the DigestMethod.</span></span> <span data-ttu-id="fc904-140">Altri algoritmi di firma digitale non sono accettati.</span><span class="sxs-lookup"><span data-stu-id="fc904-140">Other digital signature algorithms are not accepted.</span></span>
   `<ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/>`
3.  <span data-ttu-id="fc904-141">È anche possibile firmare il documento XML.</span><span class="sxs-lookup"><span data-stu-id="fc904-141">You may also sign the XML document.</span></span> 
4.  <span data-ttu-id="fc904-142">Il valore dell'algoritmo di trasformazione deve corrispondere ai valori nell'esempio seguente: `<ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
       <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>`</span><span class="sxs-lookup"><span data-stu-id="fc904-142">The Transform Algorithm must match the values in the following sample:    `<ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
       <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>`</span></span>
9.  <span data-ttu-id="fc904-143">L'algoritmo SignatureMethod deve corrispondere all'esempio seguente: `<ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/>`</span><span class="sxs-lookup"><span data-stu-id="fc904-143">The SignatureMethod Algorithm must match the following sample:   `<ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/>`</span></span>

## <a name="supported-bindings"></a><span data-ttu-id="fc904-144">Binding supportati</span><span class="sxs-lookup"><span data-stu-id="fc904-144">Supported bindings</span></span>
<span data-ttu-id="fc904-145">I binding sono i parametri di comunicazione correlati al trasporto richiesti.</span><span class="sxs-lookup"><span data-stu-id="fc904-145">Bindings are the transport related communications parameters that are required.</span></span> <span data-ttu-id="fc904-146">Ai binding si applicano i requisiti seguenti</span><span class="sxs-lookup"><span data-stu-id="fc904-146">The following requirements apply to the bindings</span></span>

1. <span data-ttu-id="fc904-147">Il trasporto richiesto è HTTPS.</span><span class="sxs-lookup"><span data-stu-id="fc904-147">HTTPS is the required transport.</span></span>
2.  <span data-ttu-id="fc904-148">Azure AD richiede HTTP POST per l'invio dei token durante l'accesso</span><span class="sxs-lookup"><span data-stu-id="fc904-148">Azure AD will require HTTP POST for token submission during logon</span></span>
3.  <span data-ttu-id="fc904-149">Azure AD usa HTTP POST per la richiesta di autenticazione al provider di identità e REDIRECT per il messaggio di disconnessione al provider di identità.</span><span class="sxs-lookup"><span data-stu-id="fc904-149">Azure AD will use HTTP POST for the authentication request to the identity provider and REDIRECT for the Logoff message to the identity provider.</span></span>

## <a name="required-attributes"></a><span data-ttu-id="fc904-150">Attributi richiesti</span><span class="sxs-lookup"><span data-stu-id="fc904-150">Required attributes</span></span>
<span data-ttu-id="fc904-151">Questa tabella mostra i requisiti per gli attributi specifici nel messaggio SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="fc904-151">This table shows requirements for specific attributes in the SAML 2.0 message.</span></span>
 
|<span data-ttu-id="fc904-152">Attributo</span><span class="sxs-lookup"><span data-stu-id="fc904-152">Attribute</span></span>|<span data-ttu-id="fc904-153">Descrizione</span><span class="sxs-lookup"><span data-stu-id="fc904-153">Description</span></span>|
| ----- | ----- |
|<span data-ttu-id="fc904-154">NameID</span><span class="sxs-lookup"><span data-stu-id="fc904-154">NameID</span></span>|<span data-ttu-id="fc904-155">Il valore di questa asserzione deve corrispondere al valore di ImmutableID dell'utente di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fc904-155">The value of this assertion must be the same as the Azure AD user’s ImmutableID.</span></span> <span data-ttu-id="fc904-156">Può essere composto da un massimo di 64 caratteri alfanumerici.</span><span class="sxs-lookup"><span data-stu-id="fc904-156">It can be up to 64 alpha numeric characters.</span></span> <span data-ttu-id="fc904-157">Qualsiasi carattere non compatibile con HTML deve essere codificato. Ad esempio, il carattere "+" viene visualizzato come ".2B".</span><span class="sxs-lookup"><span data-stu-id="fc904-157">Any non HTML safe characters must be encoded, for example a “+” character is shown as “.2B”.</span></span>|
|<span data-ttu-id="fc904-158">IDPEmail</span><span class="sxs-lookup"><span data-stu-id="fc904-158">IDPEmail</span></span>|<span data-ttu-id="fc904-159">Il nome dell'entità utente (UPN) è indicato nella risposta SAML come elemento denominato IDPEmail. Si tratta dell'oggetto UserPrincipalName (UPN) dell'utente in Azure AD/Office 365.</span><span class="sxs-lookup"><span data-stu-id="fc904-159">The User Principal Name (UPN) is listed in the SAML response as an element with the name IDPEmail This is the user’s UserPrincipalName (UPN) in Azure AD/Office 365.</span></span> <span data-ttu-id="fc904-160">Il nome dell'entità utente è nel formato indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="fc904-160">The UPN is in email address format.</span></span> <span data-ttu-id="fc904-161">Valore UPN in Office 365 (Azure Active Directory).</span><span class="sxs-lookup"><span data-stu-id="fc904-161">UPN value in Windows Office 365 (Azure Active Directory).</span></span>|
|<span data-ttu-id="fc904-162">Issuer</span><span class="sxs-lookup"><span data-stu-id="fc904-162">Issuer</span></span>|<span data-ttu-id="fc904-163">Deve essere un URI del provider di identità.</span><span class="sxs-lookup"><span data-stu-id="fc904-163">This is required to be a URI of the identity provider.</span></span> <span data-ttu-id="fc904-164">Non riutilizzare l'autorità emittente dei messaggi di esempio.</span><span class="sxs-lookup"><span data-stu-id="fc904-164">You should not reuse the Issuer from the sample messages.</span></span> <span data-ttu-id="fc904-165">Se si hanno più domini di primo livello nei tenant di Azure AD, l'autorità emittente deve corrispondere all'impostazione URI specificata configurata per ogni dominio.</span><span class="sxs-lookup"><span data-stu-id="fc904-165">If you have multiple top-level domains in your Azure AD tenants the Issuer must match the specified URI setting configured per domain.</span></span>|

>[!IMPORTANT]
><span data-ttu-id="fc904-166">Azure AD attualmente supporta l'URI di formato di NameID seguente per SAML 2.0: urn:oasis:names:tc:SAML:2.0:nameid-format:persistent.</span><span class="sxs-lookup"><span data-stu-id="fc904-166">Azure AD currently supports the following NameID Format URI for SAML 2.0:urn:oasis:names:tc:SAML:2.0:nameid-format:persistent.</span></span>

## <a name="sample-saml-request-and-response-messages"></a><span data-ttu-id="fc904-167">Messaggi di richiesta e di risposta SAML di esempio</span><span class="sxs-lookup"><span data-stu-id="fc904-167">Sample SAML request and response messages</span></span>
<span data-ttu-id="fc904-168">Per lo scambio di messaggi di accesso viene visualizzata una coppia di messaggi di richiesta e di risposta.</span><span class="sxs-lookup"><span data-stu-id="fc904-168">A request and response message pair is shown for the sign-on message exchange.</span></span>
<span data-ttu-id="fc904-169">Di seguito è illustrato un messaggio di richiesta di esempio inviato da Azure AD a un provider di identità SAML 2.0 di esempio.</span><span class="sxs-lookup"><span data-stu-id="fc904-169">This is a sample request message that is sent from Azure AD to a sample SAML 2.0 identity provider.</span></span> <span data-ttu-id="fc904-170">Il provider di identità SAML 2.0 di esempio è Active Directory Federation Services (AD FS) configurato per l'uso del protocollo SAML-P.</span><span class="sxs-lookup"><span data-stu-id="fc904-170">The sample SAML 2.0 identity provider is Active Directory Federation Services (AD FS) configured to use SAML-P protocol.</span></span> <span data-ttu-id="fc904-171">È stato anche completato un test di interoperabilità con altri provider di identità SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="fc904-171">Interoperability testing has also been completed with other SAML 2.0 identity providers.</span></span>

    `<samlp:AuthnRequest xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol" xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion" ID="_7171b0b2-19f2-4ba2-8f94-24b5e56b7f1e" IssueInstant="2014-01-30T16:18:35Z" Version="2.0" AssertionConsumerServiceIndex="0" >
    <saml:Issuer>urn:federation:MicrosoftOnline</saml:Issuer>
    <samlp:NameIDPolicy Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent"/>
    </samlp:AuthnRequest>`

<span data-ttu-id="fc904-172">Di seguito è illustrato un messaggio di risposta di esempio inviato dal provider di identità di esempio conforme a SAML 2.0 ad Azure AD/Office 365.</span><span class="sxs-lookup"><span data-stu-id="fc904-172">This is a sample response message that is sent from the sample SAML 2.0 compliant identity provider to Azure AD / Office 365.</span></span>

    `<samlp:Response ID="_592c022f-e85e-4d23-b55b-9141c95cd2a5" Version="2.0" IssueInstant="2014-01-31T15:36:31.357Z" Destination="https://login.microsoftonline.com/login.srf" Consent="urn:oasis:names:tc:SAML:2.0:consent:unspecified" InResponseTo="_049917a6-1183-42fd-a190-1d2cbaf9b144" xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol">
    <Issuer xmlns="urn:oasis:names:tc:SAML:2.0:assertion">http://WS2012R2-0.contoso.com/adfs/services/trust</Issuer>
    <samlp:Status>
    <samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success" />
    </samlp:Status>
    <Assertion ID="_7e3c1bcd-f180-4f78-83e1-7680920793aa" IssueInstant="2014-01-31T15:36:31.279Z" Version="2.0" xmlns="urn:oasis:names:tc:SAML:2.0:assertion">
    <Issuer>http://WS2012R2-0.contoso.com/adfs/services/trust</Issuer>
    <ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
      <ds:SignedInfo>
        <ds:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#" />
        <ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1" />
        <ds:Reference URI="#_7e3c1bcd-f180-4f78-83e1-7680920793aa">
          <ds:Transforms>
            <ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature" />
            <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#" />
          </ds:Transforms>
          <ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1" />
          <ds:DigestValue>CBn/5YqbheaJP425c0pHva9PhNY=</ds:DigestValue>
        </ds:Reference>
      </ds:SignedInfo>
      <ds:SignatureValue>TciWMyHW2ZODrh/2xrvp5ggmcHBFEd9vrp6DYXp+hZWJzmXMmzwmwS8KNRJKy8H7XqBsdELA1Msqi8I3TmWdnoIRfM/ZAyUppo8suMu6Zw+boE32hoQRnX9EWN/f0vH6zA/YKTzrjca6JQ8gAV1ErwvRWDpyMcwdYCiWALv9ScbkAcebOE1s1JctZ5RBXggdZWrYi72X+I4i6WgyZcIGai/rZ4v2otoWAEHS0y1yh1qT7NDPpl/McDaTGkNU6C+8VfjD78DrUXEcAfKvPgKlKrOMZnD1lCGsViimGY+LSuIdY45MLmyaa5UT4KWph6dA==</ds:SignatureValue>
      <KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#">
        <ds:X509Data>
          <ds:X509Certificate>MIIC7jCCAdagAwIBAgIQRrjsbFPaXIlOG3GTv50fkjANBgkqhkiG9w0BAQsFADAzMTEwLwYDVQQDEyhBREZTIFNpZ25pbmcgLSBXUzIwMTJSMi0wLnN3aW5mb3JtZXIuY29tMB4XDTE0MDEyMDE1MTY0MFoXDTE1MDEyMDE1MTY0MFowMzExMC8GA1UEAxMoQURGUyBTaWduaW5nIC0gV1MyMDEyUjItMC5zd2luZm9ybWVyLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKe+rLVmXy1QwCwZwqgbbp1/+3ZWxd9T/jV0hpLIIWr+LCOHqq8n8beJvlivgLmDJo8f+EITnAxWcsJUvVai/35AhHCUq9tc9sqMp5PWtabAEMb2AU72/QlX/72D2/NbGQq1BWYbqUpgpCZ2nSgvlWDHlCiUo//UGsvfox01kjTFlmqQInsJVfRxF5AcCAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAi8c6C4zaTEc7aQiUgvnGQgCbMZbhUXXLGRpjvFLKaQzkwa9eq7WLJibcSNyGXBa/SfT5wJgsm3TPKgSehGAOTirhcqHheZyvBObAScY7GOT+u9pVYp6raFrc7ez3c+CGHeV/tNvy1hJNs12FYH4X+ZCNFIT9tprieR25NCdi5SWUbPZL0tVzJsHc1y92b2M2FxqRDohxQgJvyJOpcg2mSBzZZIkvDg7gfPSUXHVS1MQs0RHSbwq/XdQocUUhl9/e/YWCbNNxlM84BxFsBUok1dH/gzBySx+Fc8zYi7cOq9yaBT3RLT6cGmFGVYZJW4FyhPZOCLVNsLlnPQcX3dDg9A==</ds:X509Certificate>
        </ds:X509Data>
      </KeyInfo>
    </ds:Signature>
    <Subject>
      <NameID Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent">ABCDEG1234567890</NameID>
      <SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:bearer">
        <SubjectConfirmationData InResponseTo="_049917a6-1183-42fd-a190-1d2cbaf9b144" NotOnOrAfter="2014-01-31T15:41:31.357Z" Recipient="https://login.microsoftonline.com/login.srf" />
      </SubjectConfirmation>
    </Subject>
    <Conditions NotBefore="2014-01-31T15:36:31.263Z" NotOnOrAfter="2014-01-31T16:36:31.263Z">
      <AudienceRestriction>
        <Audience>urn:federation:MicrosoftOnline</Audience>
      </AudienceRestriction>
    </Conditions>
    <AttributeStatement>
      <Attribute Name="IDPEmail">
        <AttributeValue>administrator@contoso.com</AttributeValue>
      </Attribute>
    </AttributeStatement>
    <AuthnStatement AuthnInstant="2014-01-31T15:36:30.200Z" SessionIndex="_7e3c1bcd-f180-4f78-83e1-7680920793aa">
      <AuthnContext>
        <AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</AuthnContextClassRef>
      </AuthnContext>
    </AuthnStatement>
    </Assertion>
    </samlp:Response>`

## <a name="configure-your-saml-20-compliant-identity-provider"></a><span data-ttu-id="fc904-173">Configurare il provider di identità conforme a SAML 2.0</span><span class="sxs-lookup"><span data-stu-id="fc904-173">Configure your SAML 2.0 compliant identity provider</span></span>
<span data-ttu-id="fc904-174">Questo argomento illustra le linee guida su come configurare il provider di identità SAML 2.0 per la federazione con Azure AD, per consentire l'accesso Single Sign-On a uno o più servizi cloud Microsoft (ad esempio Office 365) con il protocollo SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="fc904-174">This topic contains guidelines on how to configure your SAML 2.0 identity provider to federate with Azure AD to enable single sign-on access to one or more Microsoft cloud services (such as Office 365) using the SAML 2.0 protocol.</span></span> <span data-ttu-id="fc904-175">La relying party SAML 2.0 per un servizio cloud Microsoft in uso in questo scenario è Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fc904-175">The SAML 2.0 relying party for a Microsoft cloud service used in this scenario is Azure AD.</span></span>

## <a name="add-azure-ad-metadata"></a><span data-ttu-id="fc904-176">Aggiungere i metadati di Azure AD</span><span class="sxs-lookup"><span data-stu-id="fc904-176">Add Azure AD metadata</span></span>
<span data-ttu-id="fc904-177">Il provider di identità SAML 2.0 deve essere conforme alle informazioni sulla relying party di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fc904-177">Your SAML 2.0 identity provider needs to adhere to information about the Azure AD relying party.</span></span> <span data-ttu-id="fc904-178">Azure AD pubblica i metadati in https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml.</span><span class="sxs-lookup"><span data-stu-id="fc904-178">Azure AD publishes metadata at https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml.</span></span>

<span data-ttu-id="fc904-179">È consigliabile importare sempre i metadati di Azure AD più recenti quando si configura il provider di identità SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="fc904-179">It is recommended that you always import the latest Azure AD metadata when configuring your SAML 2.0 identity provider.</span></span> <span data-ttu-id="fc904-180">Si noti che Azure AD non legge i metadati dal provider di identità.</span><span class="sxs-lookup"><span data-stu-id="fc904-180">Note that Azure AD does not read metadata from the identity provider.</span></span>

## <a name="add-azure-ad-as-a-relying-party"></a><span data-ttu-id="fc904-181">Aggiungere Azure AD come relying party</span><span class="sxs-lookup"><span data-stu-id="fc904-181">Add Azure AD as a relying party</span></span>
<span data-ttu-id="fc904-182">È necessario abilitare la comunicazione tra il provider di identità SAML 2.0 e Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fc904-182">You have to enable communication between your SAML 2.0 identity provider and Azure AD.</span></span> <span data-ttu-id="fc904-183">Questa configurazione dipende dal provider di identità specifico. Vedere la documentazione pertinente.</span><span class="sxs-lookup"><span data-stu-id="fc904-183">This configuration will be dependent on your specific identity provider and you should refer to documentation for it.</span></span> <span data-ttu-id="fc904-184">È in genere necessario impostare l'ID della relying party sullo stesso valore di entityID dei metadati di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fc904-184">You would typically set the relying party ID to the same as the entityID from the Azure AD metadata.</span></span>

>[!NOTE]
><span data-ttu-id="fc904-185">Verificare che l'orologio del server del provider di identità SAML 2.0 sia sincronizzato con un'origine di ora precisa.</span><span class="sxs-lookup"><span data-stu-id="fc904-185">Verify the clock on your SAML 2.0 identity provider server is synchronized to an accurate time source.</span></span> <span data-ttu-id="fc904-186">L'impostazione non corretta dell'ora può comportare un errore degli accessi federati.</span><span class="sxs-lookup"><span data-stu-id="fc904-186">An inaccurate clock time can cause federated logins to fail.</span></span>

## <a name="install-windows-powershell-for-sign-on-with-saml-20-identity-provider"></a><span data-ttu-id="fc904-187">Installare Windows PowerShell per l'accesso con il provider di identità SAML 2.0</span><span class="sxs-lookup"><span data-stu-id="fc904-187">Install Windows PowerShell for sign-on with SAML 2.0 identity provider</span></span>
<span data-ttu-id="fc904-188">Dopo aver configurato il provider di identità SAML 2.0 per l'uso per l'accesso di Azure AD, il passaggio successivo consiste nello scaricare e installare il Modulo di Azure Active Directory per Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="fc904-188">After you have configured your SAML 2.0 identity provider for use with Azure AD sign-on, the next step is to download and install the Azure Active Directory Module for Windows PowerShell.</span></span> <span data-ttu-id="fc904-189">Una volta eseguita l'installazione, usare questi cmdlet per configurare i domini di Azure AD come domini federati.</span><span class="sxs-lookup"><span data-stu-id="fc904-189">Once installed, you will use these cmdlets to configure your Azure AD domains as federated domains.</span></span>

<span data-ttu-id="fc904-190">Il Modulo di Azure Active Directory per Windows PowerShell è una soluzione per la gestione dei dati dell'organizzazione in Azure AD che è possibile scaricare.</span><span class="sxs-lookup"><span data-stu-id="fc904-190">The Azure Active Directory Module for Windows PowerShell is a download for managing your organizations data in Azure AD.</span></span> <span data-ttu-id="fc904-191">Questo modulo installa un set di cmdlet in Windows PowerShell. Eseguire questi cmdlet per impostare l'accesso Single Sign-On ad Azure AD e a tutti i servizi cloud sottoscritti.</span><span class="sxs-lookup"><span data-stu-id="fc904-191">This module installs a set of cmdlets to Windows PowerShell; you run those cmdlets to set up single sign-on access to Azure AD and in turn to all of the cloud services you are subscribed to.</span></span> <span data-ttu-id="fc904-192">Per istruzioni su come scaricare e installare i cmdlet, vedere [http://technet.microsoft.com/library/jj151815.aspx](http://technet.microsoft.com/library/jj151815.aspx)</span><span class="sxs-lookup"><span data-stu-id="fc904-192">For instructions about how to download and install the cmdlets, see [http://technet.microsoft.com/library/jj151815.aspx](http://technet.microsoft.com/library/jj151815.aspx)</span></span>

## <a name="set-up-a-trust-between-your-saml-identity-provider-and-azure-ad"></a><span data-ttu-id="fc904-193">Impostare una relazione di trust tra il provider di identità SAML e Azure AD</span><span class="sxs-lookup"><span data-stu-id="fc904-193">Set up a trust between your SAML identity provider and Azure AD</span></span>
<span data-ttu-id="fc904-194">Prima di configurare la federazione in un dominio di Azure AD, è necessario che sia configurato un dominio personalizzato.</span><span class="sxs-lookup"><span data-stu-id="fc904-194">Before configuring federation on an Azure AD domain, it must have a custom domain configured.</span></span> <span data-ttu-id="fc904-195">Non è possibile configurare la federazione per il dominio predefinito fornito da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="fc904-195">You cannot federate the default domain that is provided by Microsoft.</span></span> <span data-ttu-id="fc904-196">Il dominio predefinito di Microsoft termina con "onmicrosoft.com".</span><span class="sxs-lookup"><span data-stu-id="fc904-196">The default domain from Microsoft ends with “onmicrosoft.com”.</span></span>
<span data-ttu-id="fc904-197">Si eseguirà una serie di cmdlet nell'interfaccia della riga di comando di Windows PowerShell per aggiungere o convertire i domini per l'accesso Single Sign-On.</span><span class="sxs-lookup"><span data-stu-id="fc904-197">You will run a series of cmdlets in the Windows PowerShell command-line interface to add or convert domains for single sign-on.</span></span>

<span data-ttu-id="fc904-198">Ogni dominio di Azure Active Directory per il quale si vuole configurare la federazione usando il provider di identità SAML 2.0 deve essere aggiunto come dominio Single Sign-On o convertito da dominio standard a dominio Single Sign-On.</span><span class="sxs-lookup"><span data-stu-id="fc904-198">Each Azure Active Directory domain that you want to federate using your SAML 2.0 identity provider must either be added as a single sign-on domain or converted to be a single sign-on domain from a standard domain.</span></span> <span data-ttu-id="fc904-199">Aggiungendo o convertendo un dominio si imposta una relazione di trust tra il provider di identità SAML 2.0 e Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fc904-199">Adding or converting a domain sets up a trust between your SAML 2.0 identity provider and Azure AD.</span></span>

<span data-ttu-id="fc904-200">La procedura seguente illustra i passaggi per la conversione di un dominio standard esistente in un dominio federato con SP-Lite SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="fc904-200">The following procedure walks you through converting an existing standard domain to a federated domain using SAML 2.0 SP-Lite.</span></span> <span data-ttu-id="fc904-201">Si noti che dopo l'esecuzione di questo passaggio, potrebbe verificarsi un'interruzione del dominio che potrebbe influire sugli utenti per un periodo di massimo 2 ore.</span><span class="sxs-lookup"><span data-stu-id="fc904-201">Note that your domain may experience an outage that impacts users up to 2 hours after you take this step.</span></span>

## <a name="configuring-a-domain-in-your-azure-ad-directory-for-federation"></a><span data-ttu-id="fc904-202">Configurazione di un dominio nella directory di Azure AD per la federazione</span><span class="sxs-lookup"><span data-stu-id="fc904-202">Configuring a domain in your Azure AD Directory for federation</span></span>


1. <span data-ttu-id="fc904-203">Connettersi alla directory di Azure AD come amministratore tenant: Connect-MsolService.</span><span class="sxs-lookup"><span data-stu-id="fc904-203">Connect to your Azure AD Directory as a tenant administrator: Connect-MsolService .</span></span>
2.  <span data-ttu-id="fc904-204">Configurare il dominio di Office 365 desiderato per l'uso della federazione con SAML 2.0: `$dom = "contoso.com" $BrandName - "Sample SAML 2.0 IDP" $LogOnUrl = "https://WS2012R2-0.contoso.com/passiveLogon" $LogOffUrl = "https://WS2012R2-0.contoso.com/passiveLogOff" $ecpUrl = "https://WS2012R2-0.contoso.com/PAOS" $MyURI = "urn:uri:MySamlp2IDP" $MySigningCert = @" MIIC7jCCAdagAwIBAgIQRrjsbFPaXIlOG3GTv50fkjANBgkqhkiG9w0BAQsFADAzMTEwLwYDVQQDEyh BREZTIFNpZ25pbmcgLSBXUzIwMTJSMi0wLnN3aW5mb3JtZXIuY29tMB4XDTE0MDEyMDE1MTY0MFoXDT E1MDEyMDE1MTY0MFowMzExMC8GA1UEAxMoQURGUyBTaWduaW5nIC0gV1MyMDEyUjItMC5zd2luZm9yb WVyLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKe+rLVmXy1QwCwZwqgbbp1/kupQ VcjKuKLitVDbssFyqbDTjP7WRjlVMWAHBI3kgNT7oE362Gf2WMJFf1b0HcrsgLin7daRXpq4Qi6OA57 sW1YFMj3sqyuTP0eZV3S4+ZbDVob6amsZIdIwxaLP9Zfywg2bLsGnVldB0+XKedZwDbCLCVg+3ZWxd9 T/jV0hpLIIWr+LCOHqq8n8beJvlivgLmDJo8f+EITnAxWcsJUvVai/35AhHCUq9tc9sqMp5PWtabAEM b2AU72/QlX/72D2/NbGQq1BWYbqUpgpCZ2nSgvlWDHlCiUo//UGsvfox01kjTFlmqQInsJVfRxF5AcC AwEAATANBgkqhkiG9w0BAQsFAAOCAQEAi8c6C4zaTEc7aQiUgvnGQgCbMZbhUXXLGRpjvFLKaQzkwa9 eq7WLJibcSNyGXBa/SfT5wJgsm3TPKgSehGAOTirhcqHheZyvBObAScY7GOT+u9pVYp6raFrc7ez3c+ CGHeV/tNvy1hJNs12FYH4X+ZCNFIT9tprieR25NCdi5SWUbPZL0tVzJsHc1y92b2M2FxqRDohxQgJvy JOpcg2mSBzZZIkvDg7gfPSUXHVS1MQs0RHSbwq/XdQocUUhl9/e/YWCbNNxlM84BxFsBUok1dH/gzBy Sx+Fc8zYi7cOq9yaBT3RLT6cGmFGVYZJW4FyhPZOCLVNsLlnPQcX3dDg9A==" "@ $uri = "http://WS2012R2-0.contoso.com/adfs/services/trust" $Protocol = "SAMLP" Set-MsolDomainAuthentication -DomainName $dom -FederationBrandName $dom -Authentication Federated -PassiveLogOnUri $MyURI -ActiveLogOnUri $ecpUrl -SigningCertificate $MySigningCert -IssuerUri $uri -LogOffUri $url -PreferredAuthenticationProtocol $Protocol`</span><span class="sxs-lookup"><span data-stu-id="fc904-204">Configure your desired Office 365 domain to use federation with SAML 2.0: `$dom = "contoso.com" $BrandName - "Sample SAML 2.0 IDP" $LogOnUrl = "https://WS2012R2-0.contoso.com/passiveLogon" $LogOffUrl = "https://WS2012R2-0.contoso.com/passiveLogOff" $ecpUrl = "https://WS2012R2-0.contoso.com/PAOS" $MyURI = "urn:uri:MySamlp2IDP" $MySigningCert = @" MIIC7jCCAdagAwIBAgIQRrjsbFPaXIlOG3GTv50fkjANBgkqhkiG9w0BAQsFADAzMTEwLwYDVQQDEyh BREZTIFNpZ25pbmcgLSBXUzIwMTJSMi0wLnN3aW5mb3JtZXIuY29tMB4XDTE0MDEyMDE1MTY0MFoXDT E1MDEyMDE1MTY0MFowMzExMC8GA1UEAxMoQURGUyBTaWduaW5nIC0gV1MyMDEyUjItMC5zd2luZm9yb WVyLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKe+rLVmXy1QwCwZwqgbbp1/kupQ VcjKuKLitVDbssFyqbDTjP7WRjlVMWAHBI3kgNT7oE362Gf2WMJFf1b0HcrsgLin7daRXpq4Qi6OA57 sW1YFMj3sqyuTP0eZV3S4+ZbDVob6amsZIdIwxaLP9Zfywg2bLsGnVldB0+XKedZwDbCLCVg+3ZWxd9 T/jV0hpLIIWr+LCOHqq8n8beJvlivgLmDJo8f+EITnAxWcsJUvVai/35AhHCUq9tc9sqMp5PWtabAEM b2AU72/QlX/72D2/NbGQq1BWYbqUpgpCZ2nSgvlWDHlCiUo//UGsvfox01kjTFlmqQInsJVfRxF5AcC AwEAATANBgkqhkiG9w0BAQsFAAOCAQEAi8c6C4zaTEc7aQiUgvnGQgCbMZbhUXXLGRpjvFLKaQzkwa9 eq7WLJibcSNyGXBa/SfT5wJgsm3TPKgSehGAOTirhcqHheZyvBObAScY7GOT+u9pVYp6raFrc7ez3c+ CGHeV/tNvy1hJNs12FYH4X+ZCNFIT9tprieR25NCdi5SWUbPZL0tVzJsHc1y92b2M2FxqRDohxQgJvy JOpcg2mSBzZZIkvDg7gfPSUXHVS1MQs0RHSbwq/XdQocUUhl9/e/YWCbNNxlM84BxFsBUok1dH/gzBy Sx+Fc8zYi7cOq9yaBT3RLT6cGmFGVYZJW4FyhPZOCLVNsLlnPQcX3dDg9A==" "@ $uri = "http://WS2012R2-0.contoso.com/adfs/services/trust" $Protocol = "SAMLP" Set-MsolDomainAuthentication -DomainName $dom -FederationBrandName $dom -Authentication Federated -PassiveLogOnUri $MyURI -ActiveLogOnUri $ecpUrl -SigningCertificate $MySigningCert -IssuerUri $uri -LogOffUri $url -PreferredAuthenticationProtocol $Protocol`</span></span> 

3.  <span data-ttu-id="fc904-205">È possibile ottenere la stringa con codifica Base64 del certificato di firma del file di metadati dell'IdP.</span><span class="sxs-lookup"><span data-stu-id="fc904-205">You can obtain the signing certificate base64 encoded string from your IDP metadata file.</span></span> <span data-ttu-id="fc904-206">Di seguito è illustrato un esempio di questo percorso, che tuttavia potrebbe essere leggermente diverso, in base all'implementazione.</span><span class="sxs-lookup"><span data-stu-id="fc904-206">An example of this location has been provided but may differ slightly based on your implementation.</span></span>

    `<IDPSSODescriptor protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"> <KeyDescriptor use="signing"> <KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#"> <X509Data> <X509Certificate>MIIC5jCCAc6gAwIBAgIQLnaxUPzay6ZJsC8HVv/QfTANBgkqhkiG9w0BAQsFADAvMS0wKwYDVQQDEyRBREZTIFNpZ25pbmcgLSBmcy50ZWNobGFiY2VudHJhbC5vcmcwHhcNMTMxMTA0MTgxMzMyWhcNMTQxMTA0MTgxMzMyWjAvMS0wKwYDVQQDEyRBREZTIFNpZ25pbmcgLSBmcy50ZWNobGFiY2VudHJhbC5vcmcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCwMdVLTr5YTSRp+ccbSpuuFeXMfABD9mVCi2wtkRwC30TIyPdORz642MkurdxdPCWjwgJ0HW6TvXwcO9afH3OC5V//wEGDoNcI8PV4enCzTYFe/h//w51uqyv48Fbb3lEXs+aVl8155OAj2sO9IX64OJWKey82GQWK3g7LfhWWpp17j5bKpSd9DBH5pvrV+Q1ESU3mx71TEOvikHGCZYitEPywNeVMLRKrevdWI3FAhFjcCSO6nWDiMqCqiTDYOURXIcHVYTSof1YotkJ4tG6mP5Kpjzd4VQvnR7Pjb47nhIYG6iZ3mR1F85Ns9+hBWukQWNN2hcD/uGdPXhpdMVpBAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAK7h7jF7wPzhZ1dPl4e+XMAr8I7TNbhgEU3+oxKyW/IioQbvZVw1mYVCbGq9Rsw4KE06eSMybqHln3w5EeBbLS0MEkApqHY+p68iRpguqa+W7UHKXXQVgPMCpqxMFKonX6VlSQOR64FgpBme2uG+LJ8reTgypEKspQIN0WvtPWmiq4zAwBp08hAacgv868c0MM4WbOYU0rzMIR6Q+ceGVRImlCwZ5b7XKp4mJZ9hlaRjeuyVrDuzBkzROSurX1OXoci08yJvhbtiBJLf3uPOJHrhjKRwIt2TnzS9ElgFZlJiDIA26Athe73n43CT0af2IG6yC7e6sK4L3NEXJrwwUZk=</X509Certificate> </X509Data> </KeyInfo> </KeyDescriptor>` 

<span data-ttu-id="fc904-207">Per altre informazioni su "Set-MsolDomainAuthentication", vedere: [http://technet.microsoft.com/library/dn194112.aspx](http://technet.microsoft.com/library/dn194112.aspx).</span><span class="sxs-lookup"><span data-stu-id="fc904-207">For more information about “Set-MsolDomainAuthentication”, see: [http://technet.microsoft.com/library/dn194112.aspx](http://technet.microsoft.com/library/dn194112.aspx).</span></span>

>[!NOTE]
><span data-ttu-id="fc904-208">È necessario eseguire "$ecpUrl = “https://WS2012R2-0.contoso.com/PAOS" solo se si configura un'estensione ECP per il provider di identità.</span><span class="sxs-lookup"><span data-stu-id="fc904-208">You must run use “$ecpUrl = “https://WS2012R2-0.contoso.com/PAOS“” only if you set up an ECP extension for your identity provider.</span></span> <span data-ttu-id="fc904-209">I client di Exchange Online, ad eccezione di Outlook Web Application (OWA), usano un endpoint attivo basato su POST.</span><span class="sxs-lookup"><span data-stu-id="fc904-209">Exchange Online clients, excluding Outlook Web Application (OWA), rely on a POST based active end point.</span></span> <span data-ttu-id="fc904-210">Se il servizio token di sicurezza SAML 2.0 implementa un endpoint attivo simile all'implementazione ECP di Shibboleth di un endpoint attivo, potrebbe essere possibile per questi rich client interagire con il servizio Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="fc904-210">If your SAML 2.0 STS implements an active end point similar to Shibboleth’s ECP implementation of an active end point it may be possible for these rich clients to interact with the Exchange Online service.</span></span>

<span data-ttu-id="fc904-211">Dopo aver configurato la federazione, è possibile tornare alla modalità non federata (o gestita), ma questa modifica richiede fino a due ore, oltre che l'assegnazione di nuove password casuali per l'accesso basato su cloud per ogni utente.</span><span class="sxs-lookup"><span data-stu-id="fc904-211">Once federation has been configured you can switch back to “non-federated” (or “managed”), however this change takes up to two hours to complete and it requires assigning new random passwords for cloud based sign-in to each user.</span></span> <span data-ttu-id="fc904-212">La reimpostazione della modalità gestita potrebbe essere necessaria in alcuni scenari per correggere un errore nelle impostazioni.</span><span class="sxs-lookup"><span data-stu-id="fc904-212">Switching back to “managed” may be required in some scenarios to reset an error in your settings.</span></span> <span data-ttu-id="fc904-213">Per altre informazioni sulla conversione del dominio, vedere: [http://msdn.microsoft.com/library/windowsazure/dn194122.aspx](http://msdn.microsoft.com/library/windowsazure/dn194122.aspx).</span><span class="sxs-lookup"><span data-stu-id="fc904-213">For more information on Domain conversion see: [http://msdn.microsoft.com/library/windowsazure/dn194122.aspx](http://msdn.microsoft.com/library/windowsazure/dn194122.aspx).</span></span>

## <a name="provision-user-principals-to-azure-ad--office-365"></a><span data-ttu-id="fc904-214">Effettuare il provisioning di entità utente in Azure AD/Office 365</span><span class="sxs-lookup"><span data-stu-id="fc904-214">Provision user principals to Azure AD / Office 365</span></span>
<span data-ttu-id="fc904-215">Per poter autenticare gli utenti in Office 365, è necessario effettuare il provisioning in Azure AD di entità utente corrispondenti all'asserzione nell'attestazione SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="fc904-215">Before you can authenticate your users to Office 365 you must provision Azure AD with user principals that correspond to the assertion in the SAML 2.0 claim.</span></span> <span data-ttu-id="fc904-216">Se queste entità utente non sono note in anticipo ad Azure AD, non possono essere usate per l'accesso federato.</span><span class="sxs-lookup"><span data-stu-id="fc904-216">If these user principals are not known to Azure AD in advance then they cannot be used for federated sign-in.</span></span> <span data-ttu-id="fc904-217">Per il provisioning delle entità utente è possibile usare Azure AD Connect o Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="fc904-217">Either Azure AD Connect or Windows PowerShell can be used to provision user principals.</span></span>

<span data-ttu-id="fc904-218">Azure AD Connect può essere usato per il provisioning di entità nei domini nella directory di Azure AD dall'istanza locale di Active Directory.</span><span class="sxs-lookup"><span data-stu-id="fc904-218">Azure AD Connect can be used to provision principals to your domains in your Azure AD Directory from the on-premises Active Directory.</span></span> <span data-ttu-id="fc904-219">Per informazioni più dettagliate, vedere [Integrare le directory locali con Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="fc904-219">For more detailed information, see [Integrate your on-premises directories with Azure Active Directory](active-directory-aadconnect.md).</span></span>

<span data-ttu-id="fc904-220">È anche possibile usare Windows PowerShell per automatizzare l'aggiunta di nuovi utenti in Azure AD e per sincronizzare le modifiche dalla directory locale.</span><span class="sxs-lookup"><span data-stu-id="fc904-220">Windows PowerShell can also be used to automate adding new users to Azure AD and to synchronize changes from the on-premises directory.</span></span> <span data-ttu-id="fc904-221">Per usare i cmdlet di Windows PowerShell, è necessario scaricare i [moduli di Azure Active Directory](https://docs.microsoft.com/powershell/azure/install-adv2?view=azureadps-2.0).</span><span class="sxs-lookup"><span data-stu-id="fc904-221">To use the Windows PowerShell cmdlets you must download the [Azure Active Directory Modules](https://docs.microsoft.com/powershell/azure/install-adv2?view=azureadps-2.0).</span></span>

<span data-ttu-id="fc904-222">Questa procedura illustra come aggiungere un singolo utente ad Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fc904-222">This procedure shows how to add a single user to Azure AD.</span></span>


1. <span data-ttu-id="fc904-223">Connettersi alla directory di Azure AD come amministratore tenant: Connect-MsolService.</span><span class="sxs-lookup"><span data-stu-id="fc904-223">Connect to your Azure AD Directory as a tenant administrator: Connect-MsolService.</span></span>
2.  <span data-ttu-id="fc904-224">Creare una nuova entità utente: ` New-MsolUser
        -UserPrincipalName elwoodf1@contoso.com
        -ImmutableId ABCDEFG1234567890
        -DisplayName "Elwood Folk"
        -FirstName Elwood 
        -LastName Folk 
        -AlternateEmailAddresses "Elwood.Folk@contoso.com" 
        -LicenseAssignment "samlp2test:ENTERPRISEPACK" 
        -UsageLocation "US" `</span><span class="sxs-lookup"><span data-stu-id="fc904-224">Create a new user principal: ` New-MsolUser
        -UserPrincipalName elwoodf1@contoso.com
    -ImmutableId ABCDEFG1234567890
    -DisplayName "Elwood Folk"
    -FirstName Elwood 
    -LastName Folk 
    -AlternateEmailAddresses "Elwood.Folk@contoso.com" 
    -LicenseAssignment "samlp2test:ENTERPRISEPACK" 
    -UsageLocation "US" `</span></span> 

<span data-ttu-id="fc904-225">Per altre informazioni su "New-MsolUser", vedere [http://technet.microsoft.com/library/dn194096.aspx](http://technet.microsoft.com/library/dn194096.aspx)</span><span class="sxs-lookup"><span data-stu-id="fc904-225">For more information about “New-MsolUser” check out, [http://technet.microsoft.com/library/dn194096.aspx](http://technet.microsoft.com/library/dn194096.aspx)</span></span>

>[!NOTE]
><span data-ttu-id="fc904-226">Il valore di "UserPrinciplName" deve corrispondere al valore che verrà inviato per "IDPEmail" nell'attestazione SAML 2.0 e il valore di "ImmutableID" deve corrispondere al valore inviato nell'asserzione "NameID".</span><span class="sxs-lookup"><span data-stu-id="fc904-226">The “UserPrinciplName” value must match the value that you will send for “IDPEmail” in your SAML 2.0 claim and the “ImmutableID” value must match the value sent in your “NameID” assertion.</span></span>

## <a name="verify-single-sign-on-with-your-saml-20-idp"></a><span data-ttu-id="fc904-227">Verificare l'accesso Single Sign-On con l'IdP SAML 2.0</span><span class="sxs-lookup"><span data-stu-id="fc904-227">Verify single sign-on with your SAML 2.0 IDP</span></span>
<span data-ttu-id="fc904-228">Prima di verificare e gestire l'accesso Single Sign-On (anche noto come federazione delle identità), l'amministratore deve esaminare le informazioni ed eseguire i passaggi negli articoli seguenti per configurare l'accesso Single Sign-On con il provider di identità basato su SP-Lite SAML 2.0:</span><span class="sxs-lookup"><span data-stu-id="fc904-228">As the administrator, before you verify and manage single sign-on (also called identity federation), review the information and perform the steps in the following articles to set up single sign-on with your SAML 2.0 SP-Lite based identity provider:</span></span>


1.  <span data-ttu-id="fc904-229">I requisiti del protocollo SAML 2.0 in Azure AD sono stati esaminati</span><span class="sxs-lookup"><span data-stu-id="fc904-229">You have reviewed the Azure AD SAML 2.0 Protocol Requirements</span></span>
2.  <span data-ttu-id="fc904-230">Il provider di identità SAML 2.0 è stato configurato</span><span class="sxs-lookup"><span data-stu-id="fc904-230">You have configured your SAML 2.0 identity provider</span></span>
3.  <span data-ttu-id="fc904-231">Installare Windows PowerShell per l'accesso Single Sign-On con il provider di identità SAML 2.0</span><span class="sxs-lookup"><span data-stu-id="fc904-231">Install Windows PowerShell for single sign-on with SAML 2.0 identity provider</span></span>
4.  <span data-ttu-id="fc904-232">Impostare una relazione di trust tra il provider di identità SAML 2.0 e Azure AD</span><span class="sxs-lookup"><span data-stu-id="fc904-232">Set up a trust between SAML 2.0 identity provider and Azure AD</span></span>
5.  <span data-ttu-id="fc904-233">È stato effettuato il provisioning di un'entità utente di test in Azure Active Directory (Office 365) mediante Windows PowerShell o Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="fc904-233">Provisioned a known test user principal to Azure Active Directory (Office 365) either through Windows PowerShell or Azure AD Connect.</span></span>
6.  <span data-ttu-id="fc904-234">Configurare la sincronizzazione della directory usando [Azure AD Connect](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="fc904-234">Configure directory synchronization using [Azure AD Connect](active-directory-aadconnect.md).</span></span>

<span data-ttu-id="fc904-235">Dopo avere configurato l'accesso Single Sign-On con il provider di identità basato su SP-Lite SAML 2.0, è necessario verificare che funzioni correttamente.</span><span class="sxs-lookup"><span data-stu-id="fc904-235">After setting up single sign-on with your SAML 2.0 SP-Lite based identity Provider, you should verify that it is working correctly.</span></span>

>[!NOTE]
><span data-ttu-id="fc904-236">Se è stato convertito un dominio, invece che aggiungerne uno, potrebbero essere necessarie fino a 24 ore per la configurazione di Single Sign-On.</span><span class="sxs-lookup"><span data-stu-id="fc904-236">If you converted a domain, rather than adding one, it may take up to 24 hours to set up single sign-on.</span></span>
<span data-ttu-id="fc904-237">Prima di verificare l'accesso Single Sign-On, completare la configurazione della sincronizzazione di Active Directory, sincronizzare le directory e attivare gli utenti sincronizzati.</span><span class="sxs-lookup"><span data-stu-id="fc904-237">Before you verify single sign-on, you should finish setting up Active Directory synchronization, synchronize your directories, and activate your synced users.</span></span>

### <a name="use-the-tool-to-verify-that-single-sign-on-has-been-set-up-correctly"></a><span data-ttu-id="fc904-238">Usare lo strumento per verificare la corretta configurazione di Single Sign-On</span><span class="sxs-lookup"><span data-stu-id="fc904-238">Use the tool to verify that single sign-on has been set up correctly</span></span>
<span data-ttu-id="fc904-239">Per verificare che l'accesso Single Sign-On sia stato configurato correttamente, è possibile eseguire la procedura seguente per controllare di poter accedere al servizio cloud con le credenziali aziendali.</span><span class="sxs-lookup"><span data-stu-id="fc904-239">To verify that single sign-on has been set up correctly, you can perform the following procedure to confirm that you are able to sign in to the cloud service with your corporate credentials.</span></span>

<span data-ttu-id="fc904-240">Microsoft offre uno strumento che è possibile usare per testare il provider di identità basato su SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="fc904-240">Microsoft has provided a tool that you can use to test your SAML 2.0 based identity provider.</span></span> <span data-ttu-id="fc904-241">Prima di eseguire lo strumento di test, è necessario aver configurato un tenant di Azure AD per la federazione con il provider di identità.</span><span class="sxs-lookup"><span data-stu-id="fc904-241">Before running the test tool you must have configured an Azure AD tenant to federate with your identity provider.</span></span>

>[!NOTE]
><span data-ttu-id="fc904-242">Connectivity Analyzer richiede Internet Explorer 10 o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="fc904-242">The Connectivity Analyzer requires Internet Explorer 10 or later.</span></span>



1. <span data-ttu-id="fc904-243">Scaricare Connectivity Analyzer da [https://testconnectivity.microsoft.com/?tabid=Client](https://testconnectivity.microsoft.com/?tabid=Client).</span><span class="sxs-lookup"><span data-stu-id="fc904-243">Download the Connectivity Analyzer from, [https://testconnectivity.microsoft.com/?tabid=Client](https://testconnectivity.microsoft.com/?tabid=Client).</span></span>
2.  <span data-ttu-id="fc904-244">Fare clic sul pulsante per l'installazione per avviare il download e l'installazione dello strumento.</span><span class="sxs-lookup"><span data-stu-id="fc904-244">Click Install Now to begin downloading and installing the tool.</span></span>
3.  <span data-ttu-id="fc904-245">Selezionare "I can't set up federation with Office 365, Azure, or other services that use Azure Active Directory" (Impossibile configurare la federazione con Office 365, Azure o altri servizi che usano Azure Active Directory).</span><span class="sxs-lookup"><span data-stu-id="fc904-245">Select “I can’t set up federation with Office 365, Azure, or other services that use Azure Active Directory”.</span></span>
4.  <span data-ttu-id="fc904-246">Una volta scaricato ed eseguito lo strumento, verrà visualizzata la finestra di diagnostica della connettività.</span><span class="sxs-lookup"><span data-stu-id="fc904-246">Once the tool is downloaded and running, you will see the Connectivity Diagnostics window.</span></span> <span data-ttu-id="fc904-247">Lo strumento fornisce informazioni dettagliate per testare la connessione della federazione.</span><span class="sxs-lookup"><span data-stu-id="fc904-247">The tool will step you through testing your federation connection.</span></span>
5.  <span data-ttu-id="fc904-248">Connectivity Analyzer apre l'IdP SAML 2.0 per consentire di eseguire l'accesso. Immettere le credenziali per l'entità utente che si sta testando: ![SAML](media/active-directory-aadconnect-federation-saml-idp/saml1.png)</span><span class="sxs-lookup"><span data-stu-id="fc904-248">The Connectivity Analyzer will open your SAML 2.0 IDP for you to logon, enter the credentials for the user principal you are testing: ![SAML](media/active-directory-aadconnect-federation-saml-idp/saml1.png)</span></span>
6.  <span data-ttu-id="fc904-249">Nella finestra di accesso per il test della federazione immettere un nome account e una password per il tenant di Azure AD configurato per la federazione con il provider di identità SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="fc904-249">At the Federation test sign-in window you should enter an account name and password for the Azure AD tenant that is configured to be federated with your SAML 2.0 identity provider.</span></span> <span data-ttu-id="fc904-250">Lo strumento tenterà di accedere usando queste credenziali e fornirà come output informazioni dettagliate sui risultati dei test eseguiti durante il tentativo di accesso.</span><span class="sxs-lookup"><span data-stu-id="fc904-250">The tool will attempt to sign-in using those credentials and detailed results of tests performed during the sign-in attempt will be provided as output.</span></span>
<span data-ttu-id="fc904-251">![SAML](media/active-directory-aadconnect-federation-saml-idp/saml2.png)</span><span class="sxs-lookup"><span data-stu-id="fc904-251">![SAML](media/active-directory-aadconnect-federation-saml-idp/saml2.png)</span></span>
7. <span data-ttu-id="fc904-252">Questa finestra mostra il risultato di un test non riuscito.</span><span class="sxs-lookup"><span data-stu-id="fc904-252">This window shows a failed result of testing.</span></span> <span data-ttu-id="fc904-253">Facendo clic sul collegamento per la visualizzazione dei risultati dettagliati verranno visualizzate le informazioni relative ai risultati di ogni test eseguito.</span><span class="sxs-lookup"><span data-stu-id="fc904-253">Clicking on Review detailed results will show information about the results for each test that was performed.</span></span> <span data-ttu-id="fc904-254">È anche possibile salvare i risultati su disco per condividerli.</span><span class="sxs-lookup"><span data-stu-id="fc904-254">You can also save the results to disk in order to share them.</span></span>
 
>[!NOTE]
><span data-ttu-id="fc904-255">Connectivity Analyzer testa anche la federazione attiva usando i protocolli basati su WS* ed ECP/PAOS.</span><span class="sxs-lookup"><span data-stu-id="fc904-255">The Connectivity analyzer also tests Active Federation using the WS*-based and ECP/PAOS protocols.</span></span> <span data-ttu-id="fc904-256">Se non si usano questi protocolli, è possibile ignorare l'errore relativo al test del flusso di accesso attivo con l'endpoint di federazione attiva del provider di identità.</span><span class="sxs-lookup"><span data-stu-id="fc904-256">If you are not using these you can disregard the following error: Testing the Active sign-in flow using your identity provider’s Active federation endpoint.</span></span>

### <a name="manually-verify-that-single-sign-on-has-been-set-up-correctly"></a><span data-ttu-id="fc904-257">Verificare manualmente la corretta configurazione di Single Sign-On</span><span class="sxs-lookup"><span data-stu-id="fc904-257">Manually verify that single sign-on has been set up correctly</span></span>
<span data-ttu-id="fc904-258">La verifica manuale prevede passaggi aggiuntivi che è possibile eseguire per assicurarsi che il provider di identità SAML 2.0 funzioni correttamente in molti scenari.</span><span class="sxs-lookup"><span data-stu-id="fc904-258">Manual verification provides additional steps that you can take to ensure that your SAML 2.0 identity Provider is working properly in many scenarios.</span></span>
<span data-ttu-id="fc904-259">Per verificare che l'accesso Single Sign-On sia stato configurato correttamente, completare i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="fc904-259">To verify that single sign-on has been set up correctly, complete the following steps:</span></span>


1. <span data-ttu-id="fc904-260">In un computer aggiunto al dominio, accedere al servizio cloud usando lo stesso nome di accesso usato per le credenziali aziendali.</span><span class="sxs-lookup"><span data-stu-id="fc904-260">On a domain-joined computer, sign in to your cloud service using the same logon name that you use for your corporate credentials.</span></span>
2.  <span data-ttu-id="fc904-261">Fare clic all'interno della casella della password.</span><span class="sxs-lookup"><span data-stu-id="fc904-261">Click inside the password box.</span></span> <span data-ttu-id="fc904-262">Se l'accesso Single Sign-On è configurato, la casella della password sarà ombreggiata e verrà visualizzato un messaggio che richiede di accedere a <your company>.</span><span class="sxs-lookup"><span data-stu-id="fc904-262">If single sign-on is set up, the password box will be shaded, and you will see the following message: “You are now required to sign in at <your company>.”</span></span>
3.  <span data-ttu-id="fc904-263">Fare clic sul collegamento per l'accesso a <your company>.</span><span class="sxs-lookup"><span data-stu-id="fc904-263">Click the Sign in at <your company> link.</span></span> <span data-ttu-id="fc904-264">Se è possibile eseguire l'accesso, la configurazione di Single Sign-On è corretta.</span><span class="sxs-lookup"><span data-stu-id="fc904-264">If you are able to sign in, then single sign-on has been set up.</span></span>

## <a name="next-steps"></a><span data-ttu-id="fc904-265">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="fc904-265">Next Steps</span></span>


- [<span data-ttu-id="fc904-266">Gestione e personalizzazione di Active Directory Federation Services con Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="fc904-266">Active Directory Federation Services management and customization with Azure AD Connect</span></span>](active-directory-aadconnect-federation-management.md)
- [<span data-ttu-id="fc904-267">Elenco di compatibilità di federazione di Azure AD</span><span class="sxs-lookup"><span data-stu-id="fc904-267">Azure AD federation compatibility list</span></span>](active-directory-aadconnect-federation-compatibility.md)
- [<span data-ttu-id="fc904-268">Installazione personalizzata di Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="fc904-268">Azure AD Connect Custom Installation</span></span>](active-directory-aadconnect-get-started-custom.md)
