---
title: routing aaaAsymmetric | Documenti Microsoft
description: "In questo articolo illustra i problemi di hello che un cliente potrebbe venire con il routing asimmetrica in una rete con più collegamenti tooa destinazione."
documentationcenter: na
services: expressroute
author: osamazia
manager: carmonm
editor: 
ms.assetid: a754bff9-95c9-44b5-9796-377fc21e8322
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/10/2016
ms.author: osamam
ms.openlocfilehash: 01a16242437a3674dcfe27b074911a829a6c1abd
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="asymmetric-routing-with-multiple-network-paths"></a><span data-ttu-id="c5f7f-103">Routing asimmetrico con più percorsi di rete</span><span class="sxs-lookup"><span data-stu-id="c5f7f-103">Asymmetric routing with multiple network paths</span></span>
<span data-ttu-id="c5f7f-104">Questo articolo illustra il modo in cui il traffico di rete di inoltro e di ritorno può seguire route diverse quando sono disponibili più percorsi tra l'origine e la destinazione di rete.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-104">This article explains how forward and return network traffic might take different routes when multiple paths are available between network source and destination.</span></span>

<span data-ttu-id="c5f7f-105">È importante toounderstand due concetti toounderstand asimmetrica di routing.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-105">It's important toounderstand two concepts toounderstand asymmetric routing.</span></span> <span data-ttu-id="c5f7f-106">Uno è effetto hello di più percorsi di rete.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-106">One is hello effect of multiple network paths.</span></span> <span data-ttu-id="c5f7f-107">altri Hello è come i dispositivi, ad esempio un firewall, mantenere lo stato.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-107">hello other is how devices, like a firewall, keep state.</span></span> <span data-ttu-id="c5f7f-108">Questi tipi di dispositivi sono detti dispositivi con stato.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-108">These types of devices are called stateful devices.</span></span> <span data-ttu-id="c5f7f-109">Una combinazione di questi due fattori crea gli scenari in rete a cui il traffico viene eliminato da un dispositivo con stato perché il dispositivo con stato hello è stato rilevato che il traffico è stato originato con dispositivo hello stesso.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-109">A combination of these two factors creates scenarios in which network traffic is dropped by a stateful device because hello stateful device didn't detect that traffic originated with hello device itself.</span></span>

## <a name="multiple-network-paths"></a><span data-ttu-id="c5f7f-110">Più percorsi di rete</span><span class="sxs-lookup"><span data-stu-id="c5f7f-110">Multiple network paths</span></span>
<span data-ttu-id="c5f7f-111">Quando una rete aziendale ha solo un collegamento toohello, passa a Internet tramite il provider di servizi Internet, tutto il traffico tooand da hello Internet hello stesso percorso.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-111">When an enterprise network has only one link toohello Internet through their Internet service provider, all traffic tooand from hello Internet travels hello same path.</span></span> <span data-ttu-id="c5f7f-112">Spesso le società acquistano più circuiti, come percorsi ridondanti, tooimprove tempo di attività.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-112">Often, companies purchase multiple circuits, as redundant paths, tooimprove network uptime.</span></span> <span data-ttu-id="c5f7f-113">In questo caso, è possibile che il traffico che passa all'esterno delle rete hello, toohello Internet, passa attraverso un collegamento e hello restituiscono il traffico passa attraverso un collegamento diverso.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-113">When this happens, it's possible that traffic that goes outside of hello network, toohello Internet, goes through one link, and hello return traffic goes through a different link.</span></span> <span data-ttu-id="c5f7f-114">Questa approccio viene definito comunemente routing asimmetrico.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-114">This is commonly known as asymmetric routing.</span></span> <span data-ttu-id="c5f7f-115">Nel routing asimmetrica, inversa il traffico di rete un percorso diverso rispetto al flusso originale hello.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-115">In asymmetric routing, reverse network traffic takes a different path from hello original flow.</span></span>

![Rete con più percorsi](./media/expressroute-asymmetric-routing/AsymmetricRouting3.png)

<span data-ttu-id="c5f7f-117">Anche se si verifica principalmente in hello Internet, anche routing asimmetrica applica tooother combinazioni di più percorsi.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-117">Although it primarily occurs on hello Internet, asymmetric routing also applies tooother combinations of multiple paths.</span></span> <span data-ttu-id="c5f7f-118">Si applica, ad esempio, percorso Internet tooan sia un percorso privato che toohello stessa destinazione e i percorsi privati toomultiple che toohello stessa destinazione.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-118">It applies, for example, both tooan Internet path and a private path that go toohello same destination, and toomultiple private paths that go toohello same destination.</span></span>

<span data-ttu-id="c5f7f-119">Ogni router lungo il percorso di hello, dall'origine toodestination, Calcola hello migliore percorso tooreach una destinazione.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-119">Each router along hello way, from source toodestination, computes hello best path tooreach a destination.</span></span> <span data-ttu-id="c5f7f-120">determinazione del router del percorso possibili migliore Hello è basata su due fattori principali:</span><span class="sxs-lookup"><span data-stu-id="c5f7f-120">hello router's determination of best possible path is based on two main factors:</span></span>

* <span data-ttu-id="c5f7f-121">Il routing tra le reti esterne è basato sul protocollo di routing, ovvero il protocollo BGP (Border Gateway Protocol).</span><span class="sxs-lookup"><span data-stu-id="c5f7f-121">Routing between external networks is based on a routing protocol, Border Gateway Protocol (BGP).</span></span> <span data-ttu-id="c5f7f-122">BGP Accetta annunci da altre istanze e li esegue attraverso una serie di passaggi toodetermine hello percorso toohello destinato destinazione migliore.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-122">BGP takes advertisements from neighbors and runs them through a series of steps toodetermine hello best path toohello intended destination.</span></span> <span data-ttu-id="c5f7f-123">Percorso migliore hello archivia nella tabella di routing.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-123">It stores hello best path in its routing table.</span></span>
* <span data-ttu-id="c5f7f-124">lunghezza Hello di una subnet mask associata a una route influisce sui percorsi di routing.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-124">hello length of a subnet mask associated with a route influences routing paths.</span></span> <span data-ttu-id="c5f7f-125">Se un router riceve più annunci per hello stesso indirizzo IP, ma con subnet mask diverse, i router hello preferisce annuncio hello con più subnet mask perché è considerata un percorso più specifico.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-125">If a router receives multiple advertisements for hello same IP address but with different subnet masks, hello router prefers hello advertisement with a longer subnet mask because it's considered a more specific route.</span></span>

## <a name="stateful-devices"></a><span data-ttu-id="c5f7f-126">Dispositivi con stato</span><span class="sxs-lookup"><span data-stu-id="c5f7f-126">Stateful devices</span></span>
<span data-ttu-id="c5f7f-127">Router esaminare hello IP intestazione di un pacchetto per il routing.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-127">Routers look at hello IP header of a packet for routing purposes.</span></span> <span data-ttu-id="c5f7f-128">Alcuni dispositivi esaminare più in dettaglio all'interno di pacchetti hello.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-128">Some devices look even deeper inside hello packet.</span></span> <span data-ttu-id="c5f7f-129">Questi dispositivi esaminano in genere le intestazioni di tipo Layer4, ovvero TCP (Transmission Control Protocol) o UDP (User Datagram Protocol) oppure addirittura di tipo Layer7 (livello dell'applicazione).</span><span class="sxs-lookup"><span data-stu-id="c5f7f-129">Typically, these devices look at Layer4 (Transmission Control Protocol, or TCP; or User Datagram Protocol, or UDP), or even Layer7 (Application Layer) headers.</span></span> <span data-ttu-id="c5f7f-130">Si tratta di dispositivi di sicurezza o di dispositivi di ottimizzazione della larghezza di banda.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-130">These kinds of devices are either security devices or bandwidth-optimization devices.</span></span> 

<span data-ttu-id="c5f7f-131">Un esempio comune di dispositivo con stato è rappresentato dal firewall.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-131">A firewall is a common example of a stateful device.</span></span> <span data-ttu-id="c5f7f-132">Un firewall consente o nega il toopass un pacchetto tramite le relative interfacce in base ai vari campi come protocollo, porta TCP/UDP e intestazioni di URL.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-132">A firewall allows or denies a packet toopass through its interfaces based on various fields such as protocol, TCP/UDP port, and URL headers.</span></span> <span data-ttu-id="c5f7f-133">Questo livello di analisi dei pacchetti inserisce un pesante carico di elaborazione nel dispositivo hello.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-133">This level of packet inspection puts a heavy processing load on hello device.</span></span> <span data-ttu-id="c5f7f-134">prestazioni tooimprove, firewall hello analizza pacchetto prima di hello di un flusso.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-134">tooimprove performance, hello firewall inspects hello first packet of a flow.</span></span> <span data-ttu-id="c5f7f-135">Se è consentito tooproceed pacchetti hello, mantiene le informazioni sul flusso hello nella tabella dello stato.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-135">If it allows hello packet tooproceed, it keeps hello flow information in its state table.</span></span> <span data-ttu-id="c5f7f-136">Sono consentiti tutti i pacchetti successivi toothis correlati flusso basato sulla determinazione iniziale hello.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-136">All subsequent packets related toothis flow are allowed based on hello initial determination.</span></span> <span data-ttu-id="c5f7f-137">Un pacchetto che fa parte di un flusso esistente può arrivare al firewall hello.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-137">A packet that is part of an existing flow might arrive at hello firewall.</span></span> <span data-ttu-id="c5f7f-138">Se firewall hello non ha informazioni di stato precedenti, firewall hello Elimina i pacchetti hello.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-138">If hello firewall has no prior state information about it, hello firewall drops hello packet.</span></span>

## <a name="asymmetric-routing-with-expressroute"></a><span data-ttu-id="c5f7f-139">Routing asimmetrico con ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="c5f7f-139">Asymmetric routing with ExpressRoute</span></span>
<span data-ttu-id="c5f7f-140">Quando ci si connette tooMicrosoft tramite Azure ExpressRoute, le modifiche di rete come segue:</span><span class="sxs-lookup"><span data-stu-id="c5f7f-140">When you connect tooMicrosoft through Azure ExpressRoute, your network changes like this:</span></span>

* <span data-ttu-id="c5f7f-141">Si dispone di più collegamenti tooMicrosoft.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-141">You have multiple links tooMicrosoft.</span></span> <span data-ttu-id="c5f7f-142">Un collegamento è la connessione Internet esistente e altri hello è tramite ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-142">One link is your existing Internet connection, and hello other is via ExpressRoute.</span></span> <span data-ttu-id="c5f7f-143">Alcuni tooMicrosoft traffico potrebbe passare attraverso Internet hello ma tornare tramite ExpressRoute o viceversa.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-143">Some traffic tooMicrosoft might go through hello Internet but come back via ExpressRoute, or vice versa.</span></span>
* <span data-ttu-id="c5f7f-144">Tramite ExpressRoute si ricevono indirizzi IP più specifici.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-144">You receive more specific IP addresses via ExpressRoute.</span></span> <span data-ttu-id="c5f7f-145">In tal caso, per il traffico proveniente da tooMicrosoft la rete per servizi offerti tramite ExpressRoute, router è sempre preferiscono ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-145">So, for traffic from your network tooMicrosoft for services offered via ExpressRoute, routers always prefer ExpressRoute.</span></span>

<span data-ttu-id="c5f7f-146">toounderstand hello effetto queste due modifiche in una rete, si prendano in considerazione alcuni scenari.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-146">toounderstand hello effect these two changes have on a network, let’s consider some scenarios.</span></span> <span data-ttu-id="c5f7f-147">Ad esempio, si dispone di un solo circuito toohello Internet e si utilizzano tutti i servizi Microsoft tramite Internet hello.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-147">As an example, you have only one circuit toohello Internet and you consume all Microsoft services via hello Internet.</span></span> <span data-ttu-id="c5f7f-148">traffico Hello da attraversa di tooMicrosoft e di nuovo la rete hello stesso collegamento Internet e passa attraverso il firewall hello.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-148">hello traffic from your network tooMicrosoft and back traverses hello same Internet link and passes through hello firewall.</span></span> <span data-ttu-id="c5f7f-149">i record di firewall Hello hello flusso come si vede il pacchetto prima di hello e restituisce i pacchetti sono consentiti perché flusso hello esiste nella tabella di stato hello.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-149">hello firewall records hello flow as it sees hello first packet and return packets are allowed because hello flow exists in hello state table.</span></span>

![Routing asimmetrico con ExpressRoute](./media/expressroute-asymmetric-routing/AsymmetricRouting1.png)

<span data-ttu-id="c5f7f-151">A questo punto si abilita ExpressRoute e si utilizzano i servizi offerti da Microsoft tramite ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-151">Then, you turn on ExpressRoute and consume services offered by Microsoft over ExpressRoute.</span></span> <span data-ttu-id="c5f7f-152">Tutti gli altri servizi di Microsoft vengono utilizzati su hello Internet.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-152">All other services from Microsoft are consumed over hello Internet.</span></span> <span data-ttu-id="c5f7f-153">Si distribuisce un firewall separate del bordo che è connesso tooExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-153">You deploy a separate firewall at your edge that is connected tooExpressRoute.</span></span> <span data-ttu-id="c5f7f-154">Microsoft annuncia rete tooyour di prefissi più specifici tramite ExpressRoute per servizi specifici.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-154">Microsoft advertises more specific prefixes tooyour network over ExpressRoute for specific services.</span></span> <span data-ttu-id="c5f7f-155">L'infrastruttura di routing sceglie ExpressRoute come percorso preferito di hello per tali prefissi.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-155">Your routing infrastructure chooses ExpressRoute as hello preferred path for those prefixes.</span></span> <span data-ttu-id="c5f7f-156">Se non si annuncia il tooMicrosoft di indirizzi IP pubblici tramite ExpressRoute, in cui Microsoft comunica con gli indirizzi IP pubblici tramite hello Internet.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-156">If you are not advertising your public IP addresses tooMicrosoft over ExpressRoute, Microsoft communicates with your public IP addresses via hello Internet.</span></span> <span data-ttu-id="c5f7f-157">Inoltrare il traffico da tooMicrosoft la rete utilizza ExpressRoute e inversa il traffico proveniente da Microsoft hello Internet.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-157">Forward traffic from your network tooMicrosoft uses ExpressRoute, and reverse traffic from Microsoft uses hello Internet.</span></span> <span data-ttu-id="c5f7f-158">Quando il firewall hello bordo hello rileva un pacchetto di risposta per un flusso che non viene trovato nella tabella di stato hello, Elimina il traffico di ritorno hello.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-158">When hello firewall at hello edge sees a response packet for a flow that it does not find in hello state table, it drops hello return traffic.</span></span>

<span data-ttu-id="c5f7f-159">Se si sceglie di hello toouse stessa conversione indirizzi di rete (NAT) dal pool per ExpressRoute e per Internet hello, vedrai problemi analoghi con client hello nella rete sugli indirizzi IP privati.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-159">If you choose toouse hello same network address translation (NAT) pool for ExpressRoute and for hello Internet, you'll see similar issues with hello clients in your network on private IP addresses.</span></span> <span data-ttu-id="c5f7f-160">Le richieste per servizi quali Windows Update passare tramite hello Internet perché gli indirizzi IP per questi servizi non vengono annunciati tramite ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-160">Requests for services like Windows Update go via hello Internet because IP addresses for these services are not advertised via ExpressRoute.</span></span> <span data-ttu-id="c5f7f-161">Tuttavia, il traffico di ritorno hello vengono restituiti tramite ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-161">However, hello return traffic comes back via ExpressRoute.</span></span> <span data-ttu-id="c5f7f-162">Se Microsoft riceve un indirizzo IP con hello stesso la subnet mask dall'hello Internet ed ExpressRoute, privilegia ExpressRoute hello Internet.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-162">If Microsoft receives an IP address with hello same subnet mask from hello Internet and ExpressRoute, it prefers ExpressRoute over hello Internet.</span></span> <span data-ttu-id="c5f7f-163">Se un firewall o un altro dispositivo con stato che si trovano i margini della rete e con connessione ExpressRoute non dispone di alcuna informazione sul flusso hello precedente, Elimina i pacchetti hello appartenenti toothat flusso.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-163">If a firewall or another stateful device that is on your network edge and facing ExpressRoute has no prior information about hello flow, it drops hello packets that belong toothat flow.</span></span>

## <a name="asymmetric-routing-solutions"></a><span data-ttu-id="c5f7f-164">Soluzioni per il routing asimmetrico</span><span class="sxs-lookup"><span data-stu-id="c5f7f-164">Asymmetric routing solutions</span></span>
<span data-ttu-id="c5f7f-165">Si dispone di due problema di hello toosolve le principali opzioni di routing asimmetrica.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-165">You have two main options toosolve hello problem of asymmetric routing.</span></span> <span data-ttu-id="c5f7f-166">Uno è tramite il routing e hello altri prevede l'uso di origine basato su NAT (SNAT).</span><span class="sxs-lookup"><span data-stu-id="c5f7f-166">One is through routing, and hello other is by using source-based NAT (SNAT).</span></span>

### <a name="routing"></a><span data-ttu-id="c5f7f-167">Routing.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-167">Routing</span></span>
<span data-ttu-id="c5f7f-168">Verificare che gli indirizzi IP pubblici siano collegamenti tooappropriate annunciato wide area network (WAN).</span><span class="sxs-lookup"><span data-stu-id="c5f7f-168">Ensure that your public IP addresses are advertised tooappropriate wide area network (WAN) links.</span></span> <span data-ttu-id="c5f7f-169">Ad esempio, se si desidera toouse hello Internet per il traffico di autenticazione ed ExpressRoute per il traffico di posta elettronica, non deve annunciare gli indirizzi IP pubblici di Active Directory Federation Services (ADFS) tramite ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-169">For example, if you want toouse hello Internet for authentication traffic and ExpressRoute for your mail traffic, you should not advertise your Active Directory Federation Services (AD FS) public IP addresses over ExpressRoute.</span></span> <span data-ttu-id="c5f7f-170">Analogamente, assicurarsi che non tooexpose un locale gli indirizzi tooIP di server AD FS hello router riceve tramite ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-170">Similarly, be sure not tooexpose an on-premises AD FS server tooIP addresses that hello router receives over ExpressRoute.</span></span> <span data-ttu-id="c5f7f-171">Le route ricevute tramite ExpressRoute sono più specifiche in modo che siano percorso preferito di hello ExpressRoute per tooMicrosoft il traffico di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-171">Routes received over ExpressRoute are more specific so they make ExpressRoute hello preferred path for authentication traffic tooMicrosoft.</span></span> <span data-ttu-id="c5f7f-172">dando luogo al routing asimmetrico.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-172">This causes asymmetric routing.</span></span>

<span data-ttu-id="c5f7f-173">Se si desidera toouse ExpressRoute per l'autenticazione, assicurarsi che si desidera annunciare gli indirizzi IP pubblici di ADFS tramite ExpressRoute senza NAT.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-173">If you want toouse ExpressRoute for authentication, make sure that you are advertising AD FS public IP addresses over ExpressRoute without NAT.</span></span> <span data-ttu-id="c5f7f-174">In questo modo, il traffico che proviene da Microsoft e passa tooan locale server AD FS passa tramite ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-174">This way, traffic that originates from Microsoft and goes tooan on-premises AD FS server goes over ExpressRoute.</span></span> <span data-ttu-id="c5f7f-175">Traffico di ritorno tooMicrosoft cliente Usa ExpressRoute perché è route preferito hello su hello Internet.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-175">Return traffic from customer tooMicrosoft uses ExpressRoute because it's hello preferred route over hello Internet.</span></span>

### <a name="source-based-nat"></a><span data-ttu-id="c5f7f-176">Source NAT</span><span class="sxs-lookup"><span data-stu-id="c5f7f-176">Source-based NAT</span></span>
<span data-ttu-id="c5f7f-177">È possibile risolvere i problemi del routing asimmetrico anche tramite SNAT.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-177">Another way of solving asymmetric routing issues is by using SNAT.</span></span> <span data-ttu-id="c5f7f-178">Ad esempio, non sono annunciate hello indirizzo IP di un server Simple Mail Transfer Protocol (SMTP) locale tramite ExpressRoute intendi hello toouse Internet per questo tipo di comunicazione.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-178">For example, you have not advertised hello public IP address of an on-premises Simple Mail Transfer Protocol (SMTP) server over ExpressRoute because you intend toouse hello Internet for this type of communication.</span></span> <span data-ttu-id="c5f7f-179">Una richiesta che ha origine da Microsoft e quindi passa tooyour locale server SMTP attraversa hello Internet.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-179">A request that originates with Microsoft and then goes tooyour on-premises SMTP server traverses hello Internet.</span></span> <span data-ttu-id="c5f7f-180">Si SNAT hello indirizzo IP di ingresso richiesta tooan interno.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-180">You SNAT hello incoming request tooan internal IP address.</span></span> <span data-ttu-id="c5f7f-181">Inversa dal server SMTP hello del traffico toohello firewall periferico (che si utilizza per NAT) anziché tramite ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-181">Reverse traffic from hello SMTP server goes toohello edge firewall (which you use for NAT) instead of through ExpressRoute.</span></span> <span data-ttu-id="c5f7f-182">il traffico di ritorno Hello torna tramite hello Internet.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-182">hello return traffic goes back via hello Internet.</span></span>

![Configurazione della rete con Source NAT](./media/expressroute-asymmetric-routing/AsymmetricRouting2.png)

## <a name="asymmetric-routing-detection"></a><span data-ttu-id="c5f7f-184">Rilevamento del routing asimmetrico</span><span class="sxs-lookup"><span data-stu-id="c5f7f-184">Asymmetric routing detection</span></span>
<span data-ttu-id="c5f7f-185">Traceroute è hello migliore modo toomake che il traffico di rete che attraversa percorso hello previsto.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-185">Traceroute is hello best way toomake sure that your network traffic is traversing hello expected path.</span></span> <span data-ttu-id="c5f7f-186">Se si prevede che il traffico dal percorso del locale SMTP server tooMicrosoft tootake hello Internet, hello previsto traceroute è da hello SMTP server tooOffice 365.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-186">If you expect traffic from your on-premises SMTP server tooMicrosoft tootake hello Internet path, hello expected traceroute is from hello SMTP server tooOffice 365.</span></span> <span data-ttu-id="c5f7f-187">risultato Hello convalida che il traffico in uscita effettivamente da rete verso Internet hello e non per ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c5f7f-187">hello result validates that traffic is indeed leaving your network toward hello Internet and not toward ExpressRoute.</span></span>

