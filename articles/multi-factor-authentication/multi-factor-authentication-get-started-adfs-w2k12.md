---
title: Server con AD FS in Windows Server aaaMFA | Documenti Microsoft
description: "Questo articolo descrive la modalità di avvio tooget con Azure multi-Factor Authentication e ADFS in Windows Server 2012 R2 e 2016."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: 57208068-1e55-45b6-840f-fdcd13723074
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 03/29/2017
ms.author: kgremban
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 656785abcc63a020add765a86670b488a3b84b51
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="configure-azure-multi-factor-authentication-server-toowork-with-ad-fs-in-windows-server"></a><span data-ttu-id="edd28-103">Configurare il Server Azure multi-Factor Authentication toowork con AD FS in Windows Server</span><span class="sxs-lookup"><span data-stu-id="edd28-103">Configure Azure Multi-Factor Authentication Server toowork with AD FS in Windows Server</span></span>
<span data-ttu-id="edd28-104">Se si utilizza Active Directory Federation Services (ADFS) e si desidera che le risorse cloud o locale toosecure, è possibile configurare il Server Azure multi-Factor Authentication toowork con AD FS.</span><span class="sxs-lookup"><span data-stu-id="edd28-104">If you use Active Directory Federation Services (AD FS) and want toosecure cloud or on-premises resources, you can configure Azure Multi-Factor Authentication Server toowork with AD FS.</span></span> <span data-ttu-id="edd28-105">Questa configurazione attiva la verifica in due passaggi per gli endpoint di alto valore.</span><span class="sxs-lookup"><span data-stu-id="edd28-105">This configuration triggers two-step verification for high-value endpoints.</span></span>

<span data-ttu-id="edd28-106">Questo articolo illustra l'uso del server Azure Multi-Factor Authentication con AD FS in Windows Server 2012 R2 o Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="edd28-106">In this article, we discuss using Azure Multi-Factor Authentication Server with AD FS in Windows Server 2012 R2 or Windows Server 2016.</span></span> <span data-ttu-id="edd28-107">Per ulteriori informazioni, consultare le informazioni su troppo[proteggere le risorse cloud e locali tramite il Server Azure multi-Factor Authentication con AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span><span class="sxs-lookup"><span data-stu-id="edd28-107">For more information, read about how too[secure cloud and on-premises resources by using Azure Multi-Factor Authentication Server with AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span></span>

## <a name="secure-windows-server-ad-fs-with-azure-multi-factor-authentication-server"></a><span data-ttu-id="edd28-108">Proteggere AD FS per Windows Server con il server Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="edd28-108">Secure Windows Server AD FS with Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="edd28-109">Quando si installa il Server Azure multi-Factor Authentication, è necessario hello le opzioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="edd28-109">When you install Azure Multi-Factor Authentication Server, you have hello following options:</span></span>

* <span data-ttu-id="edd28-110">Installare il Server Azure multi-Factor Authentication in hello locale nello stesso server AD FS</span><span class="sxs-lookup"><span data-stu-id="edd28-110">Install Azure Multi-Factor Authentication Server locally on hello same server as AD FS</span></span>
* <span data-ttu-id="edd28-111">Installare adapter Azure multi-Factor Authentication hello in hello server ADFS locale e quindi installare Server multi-Factor Authentication in un computer diverso</span><span class="sxs-lookup"><span data-stu-id="edd28-111">Install hello Azure Multi-Factor Authentication adapter locally on hello AD FS server, and then install Multi-Factor Authentication Server on a different computer</span></span>

<span data-ttu-id="edd28-112">Prima di iniziare, tenere hello le seguenti informazioni:</span><span class="sxs-lookup"><span data-stu-id="edd28-112">Before you begin, be aware of hello following information:</span></span>

* <span data-ttu-id="edd28-113">Non è necessario tooinstall Server Azure multi-Factor Authentication nel server ADFS.</span><span class="sxs-lookup"><span data-stu-id="edd28-113">You are not required tooinstall Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="edd28-114">Tuttavia, è necessario installare l'adapter multi-Factor Authentication hello per ADFS in un Windows Server 2012 R2 o Windows Server 2016 che esegue AD FS.</span><span class="sxs-lookup"><span data-stu-id="edd28-114">However, you must install hello Multi-Factor Authentication adapter for AD FS on a Windows Server 2012 R2 or Windows Server 2016 that is running AD FS.</span></span> <span data-ttu-id="edd28-115">Se si tratta di una versione supportata e si installa scheda ADFS hello separatamente nel server federativo ADFS, è possibile installare server hello in un computer diverso.</span><span class="sxs-lookup"><span data-stu-id="edd28-115">You can install hello server on a different computer if it is a supported version and you install hello AD FS adapter separately on your AD FS federation server.</span></span> <span data-ttu-id="edd28-116">Vedere hello seguendo procedure toolearn come tooinstall hello scheda separatamente.</span><span class="sxs-lookup"><span data-stu-id="edd28-116">See hello following procedures toolearn how tooinstall hello adapter separately.</span></span>
* <span data-ttu-id="edd28-117">Se l'organizzazione utilizza messaggio di testo o i metodi di verifica app per dispositivi mobili, le stringhe di hello definite nelle impostazioni società contengono un segnaposto, <$*application_name*$>.</span><span class="sxs-lookup"><span data-stu-id="edd28-117">If your organization is using text message or mobile app verification methods, hello strings defined in Company Settings contain a placeholder, <$*application_name*$>.</span></span> <span data-ttu-id="edd28-118">Nel server MFA 7.1 è possibile specificare il nome di un'applicazione per sostituire questo segnaposto.</span><span class="sxs-lookup"><span data-stu-id="edd28-118">In MFA Server v7.1, you can provide an application name that replaces this placeholder.</span></span> <span data-ttu-id="edd28-119">Nella versione 7.0 o precedenti, il segnaposto non viene sostituito automaticamente quando si utilizza l'adapter di hello AD FS.</span><span class="sxs-lookup"><span data-stu-id="edd28-119">In v7.0 or older, this placeholder is not automatically replaced when you use hello AD FS adapter.</span></span> <span data-ttu-id="edd28-120">Rimuovere segnaposto hello da stringhe appropriate hello per le versioni precedenti, quando si protegge ADFS.</span><span class="sxs-lookup"><span data-stu-id="edd28-120">For those older versions, remove hello placeholder from hello appropriate strings when you secure AD FS.</span></span>
* <span data-ttu-id="edd28-121">Hello che l'account utilizzato toosign in deve avere gruppi di sicurezza toocreate diritti utente nel servizio Active Directory.</span><span class="sxs-lookup"><span data-stu-id="edd28-121">hello account that you use toosign in must have user rights toocreate security groups in your Active Directory service.</span></span>
* <span data-ttu-id="edd28-122">installazione guidata di ADFS di multi-Factor Authentication Hello adapter crea un gruppo di sicurezza denominato PhoneFactor Admins nella propria istanza di Active Directory.</span><span class="sxs-lookup"><span data-stu-id="edd28-122">hello Multi-Factor Authentication AD FS adapter installation wizard creates a security group called PhoneFactor Admins in your instance of Active Directory.</span></span> <span data-ttu-id="edd28-123">Viene quindi aggiunto l'account del servizio ADFS hello del gruppo toothis servizio federativo.</span><span class="sxs-lookup"><span data-stu-id="edd28-123">It then adds hello AD FS service account of your federation service toothis group.</span></span> <span data-ttu-id="edd28-124">Verificare nel controller di dominio che hello effettiva creazione del gruppo PhoneFactor Admins e che l'account del servizio hello AD FS è un membro di questo gruppo.</span><span class="sxs-lookup"><span data-stu-id="edd28-124">Verify on your domain controller that hello PhoneFactor Admins group is indeed created and that hello AD FS service account is a member of this group.</span></span> <span data-ttu-id="edd28-125">Se necessario, aggiungere manualmente toohello account di servizio AD FS hello gruppo PhoneFactor Admins nel controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="edd28-125">If necessary, manually add hello AD FS service account toohello PhoneFactor Admins group on your domain controller.</span></span>
* <span data-ttu-id="edd28-126">Per informazioni sull'installazione hello Web Service SDK con il portale utenti hello, conoscenza [distribuzione portale per gli utenti hello per il Server Azure multi-Factor Authentication.](multi-factor-authentication-get-started-portal.md)</span><span class="sxs-lookup"><span data-stu-id="edd28-126">For information about installing hello Web Service SDK with hello user portal, read about [deploying hello user portal for Azure Multi-Factor Authentication Server.](multi-factor-authentication-get-started-portal.md)</span></span>

### <a name="install-azure-multi-factor-authentication-server-locally-on-hello-ad-fs-server"></a><span data-ttu-id="edd28-127">Installare il Server Azure multi-Factor Authentication in locale nel server AD FS hello</span><span class="sxs-lookup"><span data-stu-id="edd28-127">Install Azure Multi-Factor Authentication Server locally on hello AD FS server</span></span>
1. <span data-ttu-id="edd28-128">Scaricare e installare il server Azure Multi-Factor Authentication nel server ADFS.</span><span class="sxs-lookup"><span data-stu-id="edd28-128">Download and install Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="edd28-129">Per informazioni sull'installazione, vedere [Introduzione al server Azure Multi-Factor Authentication](multi-factor-authentication-get-started-server.md).</span><span class="sxs-lookup"><span data-stu-id="edd28-129">For installation information, read about [getting started with Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span></span>
2. <span data-ttu-id="edd28-130">Nella console di gestione di hello del Server Azure multi-Factor Authentication, fare clic su hello **ADFS** icona.</span><span class="sxs-lookup"><span data-stu-id="edd28-130">In hello Azure Multi-Factor Authentication Server management console, click hello **AD FS** icon.</span></span> <span data-ttu-id="edd28-131">Selezionare le opzioni di hello **Consenti registrazione utente** e **consentire agli utenti il metodo tooselect**.</span><span class="sxs-lookup"><span data-stu-id="edd28-131">Select hello options **Allow user enrollment** and **Allow users tooselect method**.</span></span>
3. <span data-ttu-id="edd28-132">Selezionare eventuali opzioni aggiuntive che si desidera toospecify per l'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="edd28-132">Select any additional options you'd like toospecify for your organization.</span></span>
4. <span data-ttu-id="edd28-133">Fare clic su **Installa scheda ADFS**.</span><span class="sxs-lookup"><span data-stu-id="edd28-133">Click **Install AD FS Adapter**.</span></span>
   
   <span data-ttu-id="edd28-134"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span><span class="sxs-lookup"><span data-stu-id="edd28-134"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span></span>

5. <span data-ttu-id="edd28-135">Se viene visualizzata la finestra di Active Directory hello, significa che due elementi.</span><span class="sxs-lookup"><span data-stu-id="edd28-135">If hello Active Directory window is displayed, that means two things.</span></span> <span data-ttu-id="edd28-136">Il computer è tooa aggiunti a un dominio e configurazione di Active Directory hello per proteggere la comunicazione tra l'adattatore ADFS hello Active Directory e il servizio multi-Factor Authentication hello è incompleta.</span><span class="sxs-lookup"><span data-stu-id="edd28-136">Your computer is joined tooa domain, and hello Active Directory configuration for securing communication between hello AD FS adapter and hello Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="edd28-137">Fare clic su **Avanti** tooautomatically completare la configurazione o selezionare hello **Ignora configurazione automatica di Active Directory e configurare le impostazioni manualmente** casella di controllo.</span><span class="sxs-lookup"><span data-stu-id="edd28-137">Click **Next** tooautomatically complete this configuration, or select hello **Skip automatic Active Directory configuration and configure settings manually** check box.</span></span> <span data-ttu-id="edd28-138">Fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="edd28-138">Click **Next**.</span></span>
6. <span data-ttu-id="edd28-139">Se windows Local Group hello è visualizzato, significa che due elementi.</span><span class="sxs-lookup"><span data-stu-id="edd28-139">If hello Local Group windows is displayed, that means two things.</span></span> <span data-ttu-id="edd28-140">Il computer non è unita in join tooa dominio e configurazione gruppo locale di hello per proteggere la comunicazione tra l'adattatore ADFS hello Active Directory e il servizio multi-Factor Authentication hello è incompleta.</span><span class="sxs-lookup"><span data-stu-id="edd28-140">Your computer is not joined tooa domain, and hello local group configuration for securing communication between hello AD FS adapter and hello Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="edd28-141">Fare clic su **Avanti** tooautomatically completare la configurazione o selezionare hello **Ignora configurazione automatica di gruppo locale e configurare le impostazioni manualmente** casella di controllo.</span><span class="sxs-lookup"><span data-stu-id="edd28-141">Click **Next** tooautomatically complete this configuration, or select hello **Skip automatic Local Group configuration and configure settings manually** check box.</span></span> <span data-ttu-id="edd28-142">Fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="edd28-142">Click **Next**.</span></span>
7. <span data-ttu-id="edd28-143">Hello installazione guidata fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="edd28-143">In hello installation wizard, click **Next**.</span></span> <span data-ttu-id="edd28-144">Azure multi-Factor Authentication Server Crea gruppo PhoneFactor Admins hello e aggiunge toohello account di servizio AD FS hello gruppo PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="edd28-144">Azure Multi-Factor Authentication Server creates hello PhoneFactor Admins group and adds hello AD FS service account toohello PhoneFactor Admins group.</span></span>
   <span data-ttu-id="edd28-145"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span><span class="sxs-lookup"><span data-stu-id="edd28-145"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span></span>
8. <span data-ttu-id="edd28-146">In hello **Avvia programma di installazione** pagina, fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="edd28-146">On hello **Launch Installer** page, click **Next**.</span></span>
9. <span data-ttu-id="edd28-147">Nel programma di installazione scheda ADFS di multi-Factor Authentication hello, fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="edd28-147">In hello Multi-Factor Authentication AD FS adapter installer, click **Next**.</span></span>
10. <span data-ttu-id="edd28-148">Fare clic su **Chiudi** termine installazione hello.</span><span class="sxs-lookup"><span data-stu-id="edd28-148">Click **Close** when hello installation is finished.</span></span>
11. <span data-ttu-id="edd28-149">Quando l'adapter hello è stato installato, è necessario registrarlo con AD FS.</span><span class="sxs-lookup"><span data-stu-id="edd28-149">When hello adapter has been installed, you must register it with AD FS.</span></span> <span data-ttu-id="edd28-150">Aprire Windows PowerShell ed eseguire hello comando seguente:</span><span class="sxs-lookup"><span data-stu-id="edd28-150">Open Windows PowerShell and run hello following command:</span></span><br><span data-ttu-id="edd28-151">
    `C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
    <center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span><span class="sxs-lookup"><span data-stu-id="edd28-151">
`C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
<center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span></span>
12. <span data-ttu-id="edd28-152">toouse la scheda appena registrata, modifica i criteri di autenticazione globali hello in ADFS.</span><span class="sxs-lookup"><span data-stu-id="edd28-152">toouse your newly registered adapter, edit hello global authentication policy in AD FS.</span></span> <span data-ttu-id="edd28-153">Nella console di gestione di hello AD ADFS, passare toohello **criteri di autenticazione** nodo.</span><span class="sxs-lookup"><span data-stu-id="edd28-153">In hello AD FS management console, go toohello **Authentication Policies** node.</span></span> <span data-ttu-id="edd28-154">In hello **multi-factor Authentication** fare clic su hello **modifica** collegamento successivo toohello **impostazioni globali** sezione.</span><span class="sxs-lookup"><span data-stu-id="edd28-154">In hello **Multi-factor Authentication** section, click hello **Edit** link next toohello **Global Settings** section.</span></span> <span data-ttu-id="edd28-155">In hello **Modifica criteri di autenticazione globali** selezionare **multi-Factor Authentication** come metodo di autenticazione aggiuntivo e quindi fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="edd28-155">In hello **Edit Global Authentication Policy** window, select **Multi-Factor Authentication** as an additional authentication method, and then click **OK**.</span></span> <span data-ttu-id="edd28-156">Hello scheda viene registrata come WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="edd28-156">hello adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="edd28-157">Riavviare il servizio ADFS hello Active Directory per effetto di tootake registrazione hello.</span><span class="sxs-lookup"><span data-stu-id="edd28-157">Restart hello AD FS service for hello registration tootake effect.</span></span>

<span data-ttu-id="edd28-158"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span><span class="sxs-lookup"><span data-stu-id="edd28-158"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span></span>

<span data-ttu-id="edd28-159">A questo punto, multi-Factor Authentication Server è configurato toobe un toouse di provider di autenticazione aggiuntivi con AD FS.</span><span class="sxs-lookup"><span data-stu-id="edd28-159">At this point, Multi-Factor Authentication Server is set up toobe an additional authentication provider toouse with AD FS.</span></span>

## <a name="install-a-standalone-instance-of-hello-ad-fs-adapter-by-using-hello-web-service-sdk"></a><span data-ttu-id="edd28-160">Installare un'istanza autonoma di adapter hello ADFS utilizzando hello Web Service SDK</span><span class="sxs-lookup"><span data-stu-id="edd28-160">Install a standalone instance of hello AD FS adapter by using hello Web Service SDK</span></span>
1. <span data-ttu-id="edd28-161">Installare hello SDK servizio Web nel server di hello che esegue Server multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="edd28-161">Install hello Web Service SDK on hello server that is running Multi-Factor Authentication Server.</span></span>
2. <span data-ttu-id="edd28-162">Esempio hello copia i file dalla \programmi\multi-factor hello-server di toohello directory Server Factor Authentication su cui si prevede di adapter di tooinstall hello AD FS:</span><span class="sxs-lookup"><span data-stu-id="edd28-162">Copy hello following files from hello \Program Files\Multi-Factor Authentication Server directory toohello server on which you plan tooinstall hello AD FS adapter:</span></span>
   * <span data-ttu-id="edd28-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="edd28-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
   * <span data-ttu-id="edd28-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="edd28-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="edd28-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="edd28-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="edd28-166">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="edd28-166">MultiFactorAuthenticationAdfsAdapter.config</span></span>
3. <span data-ttu-id="edd28-167">Eseguire i file di installazione di hello i file MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span><span class="sxs-lookup"><span data-stu-id="edd28-167">Run hello MultiFactorAuthenticationAdfsAdapterSetup64.msi installation file.</span></span>
4. <span data-ttu-id="edd28-168">Nel programma di installazione scheda ADFS di multi-Factor Authentication hello, fare clic su **Avanti** installazione hello toostart.</span><span class="sxs-lookup"><span data-stu-id="edd28-168">In hello Multi-Factor Authentication AD FS adapter installer, click **Next** toostart hello installation.</span></span>
5. <span data-ttu-id="edd28-169">Fare clic su **Chiudi** termine installazione hello.</span><span class="sxs-lookup"><span data-stu-id="edd28-169">Click **Close** when hello installation is finished.</span></span>

## <a name="edit-hello-multifactorauthenticationadfsadapterconfig-file"></a><span data-ttu-id="edd28-170">Modifica file Multifactorauthenticationadfsadapter config hello</span><span class="sxs-lookup"><span data-stu-id="edd28-170">Edit hello MultiFactorAuthenticationAdfsAdapter.config file</span></span>
<span data-ttu-id="edd28-171">Seguire questi file multifactorauthenticationadfsadapter. config di passaggi tooedit hello:</span><span class="sxs-lookup"><span data-stu-id="edd28-171">Follow these steps tooedit hello MultiFactorAuthenticationAdfsAdapter.config file:</span></span>

1. <span data-ttu-id="edd28-172">Set hello **UseWebServiceSdk** nodo troppo**true**.</span><span class="sxs-lookup"><span data-stu-id="edd28-172">Set hello **UseWebServiceSdk** node too**true**.</span></span>  
2. <span data-ttu-id="edd28-173">Impostare il valore di hello per **WebServiceSdkUrl** toohello URL di hello multi-Factor Authentication Web Service SDK.</span><span class="sxs-lookup"><span data-stu-id="edd28-173">Set hello value for **WebServiceSdkUrl** toohello URL of hello Multi-Factor Authentication Web Service SDK.</span></span> <span data-ttu-id="edd28-174">Ad esempio: *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, dove *certificatename* hello nome del certificato.</span><span class="sxs-lookup"><span data-stu-id="edd28-174">For example:  *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, Where *certificatename* is hello name of your certificate.</span></span>  
3. <span data-ttu-id="edd28-175">Modifica di script hello Register-multifactorauthenticationadfsadapter.ps1 aggiungendo *- ConfigurationFilePath &lt;percorso&gt;*  toohello fine hello `Register-AdfsAuthenticationProvider` comando, in cui  *&lt;percorso&gt;*  hello percorso completo toohello multifactorauthenticationadfsadapter. config file.</span><span class="sxs-lookup"><span data-stu-id="edd28-175">Edit hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding *-ConfigurationFilePath &lt;path&gt;* toohello end of hello `Register-AdfsAuthenticationProvider` command, where *&lt;path&gt;* is hello full path toohello MultiFactorAuthenticationAdfsAdapter.config file.</span></span>

### <a name="configure-hello-web-service-sdk-with-a-username-and-password"></a><span data-ttu-id="edd28-176">Configurare hello Web Service SDK con un nome utente e password</span><span class="sxs-lookup"><span data-stu-id="edd28-176">Configure hello Web Service SDK with a username and password</span></span>
<span data-ttu-id="edd28-177">Sono disponibili due opzioni per la configurazione di hello SDK servizio Web.</span><span class="sxs-lookup"><span data-stu-id="edd28-177">There are two options for configuring hello Web Service SDK.</span></span> <span data-ttu-id="edd28-178">con un nome utente e una password per primo è Hello, hello in secondo luogo è con un certificato client.</span><span class="sxs-lookup"><span data-stu-id="edd28-178">hello first is with a username and password, hello second is with a client certificate.</span></span> <span data-ttu-id="edd28-179">Seguire questi passaggi per la prima opzione hello o ignorare per hello secondo.</span><span class="sxs-lookup"><span data-stu-id="edd28-179">Follow these steps for hello first option, or skip ahead for hello second.</span></span>  

1. <span data-ttu-id="edd28-180">Impostare il valore di hello per **WebServiceSdkUsername** tooan account che è un membro del gruppo di sicurezza PhoneFactor Admins hello.</span><span class="sxs-lookup"><span data-stu-id="edd28-180">Set hello value for **WebServiceSdkUsername** tooan account that is a member of hello PhoneFactor Admins security group.</span></span> <span data-ttu-id="edd28-181">Hello utilizzare &lt;dominio&gt;&#92;&lt; nome utente&gt; formato.</span><span class="sxs-lookup"><span data-stu-id="edd28-181">Use hello &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
2. <span data-ttu-id="edd28-182">Impostare il valore di hello per **webservicesdkpassword sulla** toohello password dell'account appropriata.</span><span class="sxs-lookup"><span data-stu-id="edd28-182">Set hello value for **WebServiceSdkPassword** toohello appropriate account password.</span></span>

### <a name="configure-hello-web-service-sdk-with-a-client-certificate"></a><span data-ttu-id="edd28-183">Configurare hello Web Service SDK con un certificato client</span><span class="sxs-lookup"><span data-stu-id="edd28-183">Configure hello Web Service SDK with a client certificate</span></span>
<span data-ttu-id="edd28-184">Se non si desidera toouse un nome utente e una password, seguire questi hello di passaggi tooconfigure Web Service SDK con un certificato client.</span><span class="sxs-lookup"><span data-stu-id="edd28-184">If you don't want toouse a username and password, follow these steps tooconfigure hello Web Service SDK with a client certificate.</span></span>

1. <span data-ttu-id="edd28-185">Ottenere un certificato client da un'autorità di certificazione per il server hello hello Web Service SDK in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="edd28-185">Obtain a client certificate from a certificate authority for hello server that is running hello Web Service SDK.</span></span> <span data-ttu-id="edd28-186">Informazioni su come troppo[ottenere i certificati client](https://technet.microsoft.com/library/cc770328.aspx).</span><span class="sxs-lookup"><span data-stu-id="edd28-186">Learn how too[obtain client certificates](https://technet.microsoft.com/library/cc770328.aspx).</span></span>  
2. <span data-ttu-id="edd28-187">Importazione hello archivio certificati client toohello computer locale dei certificati personali nel server di hello hello Web Service SDK in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="edd28-187">Import hello client certificate toohello local computer personal certificate store on hello server that is running hello Web Service SDK.</span></span> <span data-ttu-id="edd28-188">Verificare che certificato pubblico dell'autorità di certificazione che hello sia nell'archivio certificati di certificati radice attendibili.</span><span class="sxs-lookup"><span data-stu-id="edd28-188">Make sure that hello certificate authority's public certificate is in Trusted Root Certificates certificate store.</span></span>  
3. <span data-ttu-id="edd28-189">Esportare le chiavi pubbliche e private di hello hello client tooa pfx del file di certificato.</span><span class="sxs-lookup"><span data-stu-id="edd28-189">Export hello public and private keys of hello client certificate tooa .pfx file.</span></span>  
4. <span data-ttu-id="edd28-190">Esportare la chiave pubblica di hello nel file con estensione cer tooa in formato Base64.</span><span class="sxs-lookup"><span data-stu-id="edd28-190">Export hello public key in Base64 format tooa .cer file.</span></span>  
5. <span data-ttu-id="edd28-191">In Server Manager, verificare che la funzionalità di autenticazione Mapping certificati Client hello \Web Server\Security\IIS Server Web (IIS) sia installato.</span><span class="sxs-lookup"><span data-stu-id="edd28-191">In Server Manager, verify that hello Web Server (IIS)\Web Server\Security\IIS Client Certificate Mapping Authentication feature is installed.</span></span> <span data-ttu-id="edd28-192">Se non è installato, selezionare **Aggiungi ruoli e funzionalità** tooadd questa funzionalità.</span><span class="sxs-lookup"><span data-stu-id="edd28-192">If it is not installed, select **Add Roles and Features** tooadd this feature.</span></span>  
6. <span data-ttu-id="edd28-193">In Gestione IIS, fare doppio clic su **Editor di configurazione** nel sito Web di hello contenente le directory virtuali di hello SDK servizio Web.</span><span class="sxs-lookup"><span data-stu-id="edd28-193">In IIS Manager, double-click **Configuration Editor** in hello website that contains hello Web Service SDK virtual directory.</span></span> <span data-ttu-id="edd28-194">Sito Web di hello tooselect importanti, non una directory virtuale hello è.</span><span class="sxs-lookup"><span data-stu-id="edd28-194">It is important tooselect hello website, not hello virtual directory.</span></span>  
7. <span data-ttu-id="edd28-195">Passare toohello **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** sezione.</span><span class="sxs-lookup"><span data-stu-id="edd28-195">Go toohello **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** section.</span></span>  
8. <span data-ttu-id="edd28-196">Impostare enabled troppo**true**.</span><span class="sxs-lookup"><span data-stu-id="edd28-196">Set enabled too**true**.</span></span>  
9. <span data-ttu-id="edd28-197">Impostare oneToOneCertificateMappingsEnabled troppo**true**.</span><span class="sxs-lookup"><span data-stu-id="edd28-197">Set oneToOneCertificateMappingsEnabled too**true**.</span></span>  
10. <span data-ttu-id="edd28-198">Fare clic su hello **...**  pulsante toooneToOneMappings avanti e quindi fare clic su hello **Aggiungi** collegamento.</span><span class="sxs-lookup"><span data-stu-id="edd28-198">Click hello **...** button next toooneToOneMappings, and then click hello **Add** link.</span></span>  
11. <span data-ttu-id="edd28-199">Aprire file con estensione cer Base64 hello esportato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="edd28-199">Open hello Base64 .cer file you exported earlier.</span></span> <span data-ttu-id="edd28-200">Rimuovere *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----* e tutte le interruzioni di riga.</span><span class="sxs-lookup"><span data-stu-id="edd28-200">Remove *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----*, and any line breaks.</span></span> <span data-ttu-id="edd28-201">Copiare la stringa risultante hello.</span><span class="sxs-lookup"><span data-stu-id="edd28-201">Copy hello resulting string.</span></span>  
12. <span data-ttu-id="edd28-202">Set certificato toohello stringa copiata nel passaggio precedente hello.</span><span class="sxs-lookup"><span data-stu-id="edd28-202">Set certificate toohello string copied in hello preceding step.</span></span>  
13. <span data-ttu-id="edd28-203">Impostare enabled troppo**true**.</span><span class="sxs-lookup"><span data-stu-id="edd28-203">Set enabled too**true**.</span></span>  
14. <span data-ttu-id="edd28-204">Impostare userName tooan account è un membro del gruppo di sicurezza PhoneFactor Admins hello.</span><span class="sxs-lookup"><span data-stu-id="edd28-204">Set userName tooan account that is a member of hello PhoneFactor Admins security group.</span></span> <span data-ttu-id="edd28-205">Hello utilizzare &lt;dominio&gt;&#92;&lt; nome utente&gt; formato.</span><span class="sxs-lookup"><span data-stu-id="edd28-205">Use hello &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
15. <span data-ttu-id="edd28-206">Impostare la password di hello password toohello account appropriato e quindi chiudere l'Editor di configurazione.</span><span class="sxs-lookup"><span data-stu-id="edd28-206">Set hello password toohello appropriate account password, and then close Configuration Editor.</span></span>  
16. <span data-ttu-id="edd28-207">Fare clic su hello **applica** collegamento.</span><span class="sxs-lookup"><span data-stu-id="edd28-207">Click hello **Apply** link.</span></span>  
17. <span data-ttu-id="edd28-208">Nella directory virtuale Web Service SDK hello, fare doppio clic su **autenticazione**.</span><span class="sxs-lookup"><span data-stu-id="edd28-208">In hello Web Service SDK virtual directory, double-click **Authentication**.</span></span>  
18. <span data-ttu-id="edd28-209">Verificare che la rappresentazione ASP.NET e l'autenticazione di base impostata troppo**abilitato**, e che tutti gli altri elementi siano impostate troppo**disabilitato**.</span><span class="sxs-lookup"><span data-stu-id="edd28-209">Verify that ASP.NET Impersonation and Basic Authentication are set too**Enabled**, and that all other items are set too**Disabled**.</span></span>  
19. <span data-ttu-id="edd28-210">Nella directory virtuale Web Service SDK hello, fare doppio clic su **impostazioni SSL**.</span><span class="sxs-lookup"><span data-stu-id="edd28-210">In hello Web Service SDK virtual directory, double-click **SSL Settings**.</span></span>  
20. <span data-ttu-id="edd28-211">Impostare certificati Client troppo**Accept**, quindi fare clic su **applica**.</span><span class="sxs-lookup"><span data-stu-id="edd28-211">Set Client Certificates too**Accept**, and then click **Apply**.</span></span>  
21. <span data-ttu-id="edd28-212">Copiare file con estensione pfx hello esportato precedenti toohello server che esegue hello scheda ADFS.</span><span class="sxs-lookup"><span data-stu-id="edd28-212">Copy hello .pfx file you exported earlier toohello server that is running hello AD FS adapter.</span></span>  
22. <span data-ttu-id="edd28-213">Importare l'archivio certificati personali di hello. pfx file toohello computer locale.</span><span class="sxs-lookup"><span data-stu-id="edd28-213">Import hello .pfx file toohello local computer personal certificate store.</span></span>  
23. <span data-ttu-id="edd28-214">Mouse e scegliere **Gestisci chiavi Private**e quindi concedere l'accesso in lettura toohello account usato toosign nel servizio di toohello AD ADFS.</span><span class="sxs-lookup"><span data-stu-id="edd28-214">Right-click and select **Manage Private Keys**, and then grant read access toohello account you used toosign in toohello AD FS service.</span></span>  
24. <span data-ttu-id="edd28-215">Aprire hello certificato e copia hello identificazione personale del client da hello **dettagli** scheda.</span><span class="sxs-lookup"><span data-stu-id="edd28-215">Open hello client certificate and copy hello thumbprint from hello **Details** tab.</span></span>  
25. <span data-ttu-id="edd28-216">Nel file multifactorauthenticationadfsadapter. config hello impostare **WebServiceSdkCertificateThumbprint** toohello stringa copiata nel passaggio precedente hello.</span><span class="sxs-lookup"><span data-stu-id="edd28-216">In hello MultiFactorAuthenticationAdfsAdapter.config file, set **WebServiceSdkCertificateThumbprint** toohello string copied in hello previous step.</span></span>  

<span data-ttu-id="edd28-217">Infine, tooregister hello adapter, eseguire \programmi\multi-factor hello-Factor Authentication Server\register-multifactorauthenticationadfsadapter.ps1 script di PowerShell.</span><span class="sxs-lookup"><span data-stu-id="edd28-217">Finally, tooregister hello adapter, run hello \Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1 script in PowerShell.</span></span> <span data-ttu-id="edd28-218">Hello scheda viene registrata come WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="edd28-218">hello adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="edd28-219">Riavviare il servizio ADFS hello Active Directory per effetto di tootake registrazione hello.</span><span class="sxs-lookup"><span data-stu-id="edd28-219">Restart hello AD FS service for hello registration tootake effect.</span></span>

## <a name="secure-azure-ad-resources-using-ad-fs"></a><span data-ttu-id="edd28-220">Proteggere le risorse Azure AD con ADFS</span><span class="sxs-lookup"><span data-stu-id="edd28-220">Secure Azure AD resources using AD FS</span></span>
<span data-ttu-id="edd28-221">toosecure la risorsa cloud, impostare una regola attestazioni, in modo che Active Directory Federation Services genera hello multipleauthn attestazione quando un utente esegue la verifica completata.</span><span class="sxs-lookup"><span data-stu-id="edd28-221">toosecure your cloud resource, set up a claims rule so that Active Directory Federation Services emits hello multipleauthn claim when a user performs two-step verification successfully.</span></span> <span data-ttu-id="edd28-222">Questa attestazione viene passata in tooAzure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="edd28-222">This claim is passed on tooAzure AD.</span></span> <span data-ttu-id="edd28-223">Seguire questa procedura toowalk passaggi hello:</span><span class="sxs-lookup"><span data-stu-id="edd28-223">Follow this procedure toowalk through hello steps:</span></span>

1. <span data-ttu-id="edd28-224">Aprire il componente di gestione di ADFS.</span><span class="sxs-lookup"><span data-stu-id="edd28-224">Open AD FS Management.</span></span>
2. <span data-ttu-id="edd28-225">A sinistra di hello, selezionare **Relying Party Trusts**.</span><span class="sxs-lookup"><span data-stu-id="edd28-225">On hello left, select **Relying Party Trusts**.</span></span>
3. <span data-ttu-id="edd28-226">Fare clic con il pulsante destro del mouse su **Piattaforma delle identità di Microsoft Office 365** e selezionare **Modifica regole attestazione...**</span><span class="sxs-lookup"><span data-stu-id="edd28-226">Right-click on **Microsoft Office 365 Identity Platform** and select **Edit Claim Rules…**</span></span>

   ![Cloud](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip1.png)

4. <span data-ttu-id="edd28-228">In Regole di trasformazione rilascio fare clic su **Aggiungi regola**.</span><span class="sxs-lookup"><span data-stu-id="edd28-228">On Issuance Transform Rules, click **Add Rule.**</span></span>

   ![Cloud](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip2.png)

5. <span data-ttu-id="edd28-230">In aggiunta guidata regole attestazione trasformare hello, selezionare **Pass Through or Filter an Incoming Claim** hello elenco a discesa e fare clic su **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="edd28-230">On hello Add Transform Claim Rule Wizard, select **Pass Through or Filter an Incoming Claim** from hello drop-down and click **Next**.</span></span>

   ![Cloud](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip3.png)

6. <span data-ttu-id="edd28-232">Assegnare un nome alla regola.</span><span class="sxs-lookup"><span data-stu-id="edd28-232">Give your rule a name.</span></span>
7. <span data-ttu-id="edd28-233">Selezionare **riferimenti dei metodi di autenticazione** come hello in arrivo tipo di attestazione.</span><span class="sxs-lookup"><span data-stu-id="edd28-233">Select **Authentication Methods References** as hello Incoming claim type.</span></span>
8. <span data-ttu-id="edd28-234">Selezionare **Pass-through di tutti i valori attestazione**.</span><span class="sxs-lookup"><span data-stu-id="edd28-234">Select **Pass through all claim values**.</span></span>
    <span data-ttu-id="edd28-235">![Aggiunta guidata regole attestazione di trasformazione](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span><span class="sxs-lookup"><span data-stu-id="edd28-235">![Add Transform Claim Rule Wizard](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span></span>
9. <span data-ttu-id="edd28-236">Fare clic su **Finish**.</span><span class="sxs-lookup"><span data-stu-id="edd28-236">Click **Finish**.</span></span> <span data-ttu-id="edd28-237">Chiudere la console di gestione di ADFS hello Active Directory.</span><span class="sxs-lookup"><span data-stu-id="edd28-237">Close hello AD FS Management console.</span></span>

## <a name="related-topics"></a><span data-ttu-id="edd28-238">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="edd28-238">Related topics</span></span>
<span data-ttu-id="edd28-239">Per la risoluzione dei problemi, vedere hello [domande frequenti di Azure multi-Factor Authentication](multi-factor-authentication-faq.md)</span><span class="sxs-lookup"><span data-stu-id="edd28-239">For troubleshooting help, see hello [Azure Multi-Factor Authentication FAQs](multi-factor-authentication-faq.md)</span></span>
