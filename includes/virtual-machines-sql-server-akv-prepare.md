## <a name="prepare-for-akv-integration"></a><span data-ttu-id="a9139-101">Preparare l'integrazione di AKV</span><span class="sxs-lookup"><span data-stu-id="a9139-101">Prepare for AKV Integration</span></span>
<span data-ttu-id="a9139-102">toouse tooconfigure di integrazione dell'insieme di credenziali chiave di Azure la macchina virtuale di SQL Server, esistono diversi prerequisiti:</span><span class="sxs-lookup"><span data-stu-id="a9139-102">toouse Azure Key Vault Integration tooconfigure your SQL Server VM, there are several prerequisites:</span></span> 

1. [<span data-ttu-id="a9139-103">Installare Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="a9139-103">Install Azure Powershell</span></span>](#install-azure-powershell)
2. [<span data-ttu-id="a9139-104">Creare un'istanza di Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="a9139-104">Create an Azure Active Directory</span></span>](#create-an-azure-active-directory)
3. [<span data-ttu-id="a9139-105">Creare un insieme di credenziali delle chiavi</span><span class="sxs-lookup"><span data-stu-id="a9139-105">Create a key vault</span></span>](#create-a-key-vault)

<span data-ttu-id="a9139-106">Hello nelle sezioni seguenti vengono descritti i prerequisiti e le informazioni di hello necessarie i cmdlet di PowerShell toocollect toolater eseguire hello.</span><span class="sxs-lookup"><span data-stu-id="a9139-106">hello following sections describe these prerequisites and hello information you need toocollect toolater run hello PowerShell cmdlets.</span></span>

### <a name="install-azure-powershell"></a><span data-ttu-id="a9139-107">Installare Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="a9139-107">Install Azure PowerShell</span></span>
<span data-ttu-id="a9139-108">Assicurarsi di aver installato hello Azure PowerShell SDK più recente.</span><span class="sxs-lookup"><span data-stu-id="a9139-108">Make sure you have installed hello latest Azure PowerShell SDK.</span></span> <span data-ttu-id="a9139-109">Per ulteriori informazioni, vedere [come tooinstall e configurare Azure PowerShell](/powershell/azureps-cmdlets-docs).</span><span class="sxs-lookup"><span data-stu-id="a9139-109">For more information, see [How tooinstall and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span></span>

### <a name="create-an-azure-active-directory"></a><span data-ttu-id="a9139-110">Creare un'istanza di Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="a9139-110">Create an Azure Active Directory</span></span>
<span data-ttu-id="a9139-111">È innanzitutto necessario toohave un [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) nella sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="a9139-111">First, you need toohave an [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) in your subscription.</span></span> <span data-ttu-id="a9139-112">Tra i molti vantaggi, in questo modo toogrant autorizzazione tooyour chiave dell'insieme di credenziali per alcuni utenti e applicazioni.</span><span class="sxs-lookup"><span data-stu-id="a9139-112">Among many benefits, this allows you toogrant permission tooyour key vault for certain users and applications.</span></span>

<span data-ttu-id="a9139-113">Successivamente, registrare un'applicazione con AAD.</span><span class="sxs-lookup"><span data-stu-id="a9139-113">Next, register an application with AAD.</span></span> <span data-ttu-id="a9139-114">Questa query fornirà un account dell'entità servizio che ha accesso tooyour insieme di credenziali chiave che sarà necessario la macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="a9139-114">This will give you a Service Principal account that has access tooyour key vault which your VM will need.</span></span> <span data-ttu-id="a9139-115">Nell'articolo insieme credenziali chiavi Azure hello, è possibile trovare questi passaggi in hello [registrare un'applicazione con Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) sezione, oppure è possibile vedere i passaggi di hello con nelle schermate hello **ottenere un'identità per un'applicazione hello sezione** di [questo post di blog](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span><span class="sxs-lookup"><span data-stu-id="a9139-115">In hello Azure Key Vault article, you can find these steps in hello [Register an application with Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) section, or you can see hello steps with screen shots in hello **Get an identity for hello application section** of [this blog post](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span></span> <span data-ttu-id="a9139-116">Prima di completare questi passaggi, si noti che è necessario hello toocollect le seguenti informazioni durante la registrazione che è necessario in seguito quando si abilita l'integrazione dell'insieme di credenziali chiave di Azure nella VM SQL.</span><span class="sxs-lookup"><span data-stu-id="a9139-116">Before completing these steps, note that you need toocollect hello following information during this registration that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

* <span data-ttu-id="a9139-117">Dopo l'aggiunta di un'applicazione hello, trovare hello **ID CLIENT** su hello **configura** scheda.   ![ID client di Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span><span class="sxs-lookup"><span data-stu-id="a9139-117">After hello application is added, find hello **CLIENT ID**  on hello **CONFIGURE** tab.   ![Azure Active Directory Client ID](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span></span>
  
    <span data-ttu-id="a9139-118">ID client Hello viene assegnato successive toohello **$spName** parametro (Service Principal name) in hello PowerShell script tooenable integrazione dell'insieme di credenziali chiave di Azure.</span><span class="sxs-lookup"><span data-stu-id="a9139-118">hello client ID is assigned later toohello **$spName** (Service Principal name) parameter in hello PowerShell script tooenable Azure Key Vault Integration.</span></span> 
* <span data-ttu-id="a9139-119">Inoltre, durante questa procedura quando si crea la chiave, copiare la hello chiave privata per la chiave come illustrato nella seguente schermata hello.</span><span class="sxs-lookup"><span data-stu-id="a9139-119">Also, during these steps when you create your key, copy hello secret for your key as is shown in hello following screenshot.</span></span> <span data-ttu-id="a9139-120">Questa chiave segreta viene assegnato successive toohello **$spSecret** parametro (entità servizio secret) nello script di PowerShell hello.</span><span class="sxs-lookup"><span data-stu-id="a9139-120">This key secret is assigned later toohello **$spSecret** (Service Principal secret) parameter in hello PowerShell script.</span></span>  
    <span data-ttu-id="a9139-121">![Segreto di Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span><span class="sxs-lookup"><span data-stu-id="a9139-121">![Azure Active Directory Secret](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span></span>
* <span data-ttu-id="a9139-122">È necessario autorizzare il nuovo ID toohave messaggi hello del client dopo le autorizzazioni di accesso: **crittografare**, **decrittografare**, **wrapKey**, **unwrapKey**, **sign**, e **verificare**.</span><span class="sxs-lookup"><span data-stu-id="a9139-122">You must authorize this new client ID toohave hello following access permissions: **encrypt**, **decrypt**, **wrapKey**, **unwrapKey**, **sign**, and **verify**.</span></span> <span data-ttu-id="a9139-123">Questa operazione viene eseguita con hello [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span><span class="sxs-lookup"><span data-stu-id="a9139-123">This is done with hello [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span></span> <span data-ttu-id="a9139-124">Per ulteriori informazioni vedere [Authorize hello applicazione toouse hello chiave o il segreto](../articles/key-vault/key-vault-get-started.md#authorize).</span><span class="sxs-lookup"><span data-stu-id="a9139-124">For more information see [Authorize hello application toouse hello key or secret](../articles/key-vault/key-vault-get-started.md#authorize).</span></span>

### <a name="create-a-key-vault"></a><span data-ttu-id="a9139-125">Creare un insieme di credenziali delle chiavi</span><span class="sxs-lookup"><span data-stu-id="a9139-125">Create a key vault</span></span>
<span data-ttu-id="a9139-126">In ordine toouse insieme credenziali chiavi Azure toostore hello chiavi da utilizzare per la crittografia nella macchina virtuale, è necessario l'insieme di credenziali chiave di accesso tooa.</span><span class="sxs-lookup"><span data-stu-id="a9139-126">In order toouse Azure Key Vault toostore hello keys you will use for encryption in your VM, you need access tooa key vault.</span></span> <span data-ttu-id="a9139-127">Se non è già impostata la chiave dell'insieme di credenziali, crearne una seguendo i passaggi hello hello [introduzione insieme credenziali chiavi Azure](../articles/key-vault/key-vault-get-started.md) argomento.</span><span class="sxs-lookup"><span data-stu-id="a9139-127">If you have not already set up your key vault, create one by following hello steps in hello [Getting Started with Azure Key Vault](../articles/key-vault/key-vault-get-started.md) topic.</span></span> <span data-ttu-id="a9139-128">Prima di completare questi passaggi, si noti che alcune informazioni necessarie toocollect durante questo set di backup che sono necessario in seguito quando si abilita l'integrazione dell'insieme di credenziali chiave di Azure nella VM SQL.</span><span class="sxs-lookup"><span data-stu-id="a9139-128">Before completing these steps, note that there is some information you need toocollect during this set up that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

<span data-ttu-id="a9139-129">Quando si ottengono toohello creare un passaggio di insieme di credenziali delle chiavi, hello nota restituito **vaultUri** proprietà, che è l'URL dell'insieme di credenziali chiave hello.</span><span class="sxs-lookup"><span data-stu-id="a9139-129">When you get toohello Create a key vault step, note hello returned **vaultUri** property, which is hello key vault URL.</span></span> <span data-ttu-id="a9139-130">Nell'esempio hello fornita in questo passaggio, illustrato di seguito, nome dell'insieme di credenziali chiave hello è ContosoKeyVault, pertanto URL dell'insieme di credenziali chiave hello sarebbe https://contosokeyvault.vault.azure.net/.</span><span class="sxs-lookup"><span data-stu-id="a9139-130">In hello example provided in that step, shown below, hello key vault name is ContosoKeyVault, therefore hello key vault URL would be https://contosokeyvault.vault.azure.net/.</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVault' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia'

<span data-ttu-id="a9139-131">URL dell'insieme di credenziali chiave Hello viene assegnato successive toohello **$akvURL** parametro hello PowerShell script tooenable integrazione dell'insieme di credenziali chiave di Azure.</span><span class="sxs-lookup"><span data-stu-id="a9139-131">hello key vault URL is assigned later toohello **$akvURL** parameter in hello PowerShell script tooenable Azure Key Vault Integration.</span></span>

