---
title: Procedure consigliate per ottimizzare le prestazioni tramite il bus di servizio di Azure| Microsoft Docs
description: Descrive come usare il bus di servizio per ottimizzare le prestazioni durante gli scambi di messaggi negoziati.
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: e756c15d-31fc-45c0-8df4-0bca0da10bb2
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/10/2017
ms.author: sethm
ms.openlocfilehash: e6a0e480f7748f12f5e566cf4059b5b2c4242c09
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="best-practices-for-performance-improvements-using-service-bus-messaging"></a><span data-ttu-id="73b1e-103">Procedure consigliate per il miglioramento delle prestazioni tramite la messaggistica del bus di servizio</span><span class="sxs-lookup"><span data-stu-id="73b1e-103">Best Practices for performance improvements using Service Bus Messaging</span></span>

<span data-ttu-id="73b1e-104">Questo articolo descrive come usare la [messaggistica del bus di servizio di Azure](https://azure.microsoft.com/services/service-bus/) per ottimizzare le prestazioni durante lo scambio di messaggi negoziati.</span><span class="sxs-lookup"><span data-stu-id="73b1e-104">This article describes how to use [Azure Service Bus messaging](https://azure.microsoft.com/services/service-bus/) to optimize performance when exchanging brokered messages.</span></span> <span data-ttu-id="73b1e-105">La prima parte di questo argomento descrive i vari meccanismi disponibili per aumentare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="73b1e-105">The first part of this topic describes the different mechanisms that are offered to help increase performance.</span></span> <span data-ttu-id="73b1e-106">La seconda parte fornisce invece indicazioni su come usare il bus di servizio per garantire le prestazioni ottimali in uno scenario specifico.</span><span class="sxs-lookup"><span data-stu-id="73b1e-106">The second part provides guidance on how to use Service Bus in a way that can offer the best performance in a given scenario.</span></span>

<span data-ttu-id="73b1e-107">In questo argomento il termine "client" fa riferimento a qualsiasi entità che accede al bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-107">Throughout this topic, the term "client" refers to any entity that accesses Service Bus.</span></span> <span data-ttu-id="73b1e-108">Un client può assumere il ruolo di mittente o di ricevitore.</span><span class="sxs-lookup"><span data-stu-id="73b1e-108">A client can take the role of a sender or a receiver.</span></span> <span data-ttu-id="73b1e-109">Il termine "mittente" viene usato per un client di coda o argomento del bus di servizio che invia messaggi a una coda o a un argomento del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-109">The term "sender" is used for a Service Bus queue or topic client that sends messages to a Service Bus queue or topic.</span></span> <span data-ttu-id="73b1e-110">Il termine "ricevitore" fa riferimento a un client di coda o sottoscrizione del bus di servizio che riceve messaggi da una coda o da una sottoscrizione del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-110">The term "receiver" refers to a Service Bus queue or subscription client that receives messages from a Service Bus queue or subscription.</span></span>

<span data-ttu-id="73b1e-111">Queste sezioni presentano numerosi concetti usati dal bus di servizio per migliorare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="73b1e-111">These sections introduce several concepts that Service Bus uses to help boost performance.</span></span>

## <a name="protocols"></a><span data-ttu-id="73b1e-112">Protocolli</span><span class="sxs-lookup"><span data-stu-id="73b1e-112">Protocols</span></span>
<span data-ttu-id="73b1e-113">Il bus di servizio consente ai client di inviare e ricevere messaggi tramite uno dei tre protocolli:</span><span class="sxs-lookup"><span data-stu-id="73b1e-113">Service Bus enables clients to send and receive messages via one of three protocols:</span></span>

1. <span data-ttu-id="73b1e-114">Advanced Message Queuing Protocol (AMQP)</span><span class="sxs-lookup"><span data-stu-id="73b1e-114">Advanced Message Queuing Protocol (AMQP)</span></span>
2. <span data-ttu-id="73b1e-115">Service Bus Messaging Protocol (SBMP)</span><span class="sxs-lookup"><span data-stu-id="73b1e-115">Service Bus Messaging Protocol (SBMP)</span></span>
3. <span data-ttu-id="73b1e-116">http</span><span class="sxs-lookup"><span data-stu-id="73b1e-116">HTTP</span></span>

<span data-ttu-id="73b1e-117">AMQP e SBMP sono più efficienti, poiché mantengono la connessione al bus di servizio finché la factory di messaggistica esista.</span><span class="sxs-lookup"><span data-stu-id="73b1e-117">AMQP and SBMP are more efficient, because they maintain the connection to Service Bus as long as the messaging factory exists.</span></span> <span data-ttu-id="73b1e-118">Implementa anche le operazioni di invio in batch e prelettura.</span><span class="sxs-lookup"><span data-stu-id="73b1e-118">It also implements batching and prefetching.</span></span> <span data-ttu-id="73b1e-119">Se non è indicato in modo esplicito, tutti i contenuti di questo argomento presuppongono l'uso di AMQP o SBMP.</span><span class="sxs-lookup"><span data-stu-id="73b1e-119">Unless explicitly mentioned, all content in this topic assumes the use of AMQP or SBMP.</span></span>

## <a name="reusing-factories-and-clients"></a><span data-ttu-id="73b1e-120">Riutilizzo di factory e client</span><span class="sxs-lookup"><span data-stu-id="73b1e-120">Reusing factories and clients</span></span>
<span data-ttu-id="73b1e-121">Gli oggetti client del bus di servizio, ad esempio [QueueClient][QueueClient] o [MessageSender][MessageSender], vengono creati tramite un oggetto [MessagingFactory][MessagingFactory] che offre anche la gestione interna delle connessioni.</span><span class="sxs-lookup"><span data-stu-id="73b1e-121">Service Bus client objects, such as [QueueClient][QueueClient] or [MessageSender][MessageSender], are created through a [MessagingFactory][MessagingFactory] object, which also provides internal management of connections.</span></span> <span data-ttu-id="73b1e-122">È consigliabile non chiudere le factory di messaggistica o i client di coda, argomento e sottoscrizione dopo aver inviato un messaggio e crearli di nuovo per l'invio del messaggio successivo.</span><span class="sxs-lookup"><span data-stu-id="73b1e-122">You should not close messaging factories or queue, topic, and subscription clients after you send a message, and then re-create them when you send the next message.</span></span> <span data-ttu-id="73b1e-123">Quando si chiude una factory di messaggistica viene eliminata la connessione al servizio Bus di servizio e viene stabilita una nuova connessione quando si crea di nuovo la factory.</span><span class="sxs-lookup"><span data-stu-id="73b1e-123">Closing a messaging factory deletes the connection to the Service Bus service, and a new connection is established when recreating the factory.</span></span> <span data-ttu-id="73b1e-124">Stabilire una nuova connessione è un'operazione costosa che si può evitare riutilizzando la stessa factory e gli stessi oggetti client per più operazioni.</span><span class="sxs-lookup"><span data-stu-id="73b1e-124">Establishing a connection is an expensive operation that you can avoid by re-using the same factory and client objects for multiple operations.</span></span> <span data-ttu-id="73b1e-125">È possibile usare l'oggetto [QueueClient][QueueClient] per inviare messaggi da più thread e operazioni asincrone simultanee.</span><span class="sxs-lookup"><span data-stu-id="73b1e-125">You can safely use the [QueueClient][QueueClient] object for sending messages from concurrent asynchronous operations and multiple threads.</span></span> 

## <a name="concurrent-operations"></a><span data-ttu-id="73b1e-126">Operazioni simultanee</span><span class="sxs-lookup"><span data-stu-id="73b1e-126">Concurrent operations</span></span>
<span data-ttu-id="73b1e-127">L'esecuzione di un'operazione (invio, ricezione, eliminazione e così via) richiede tempo.</span><span class="sxs-lookup"><span data-stu-id="73b1e-127">Performing an operation (send, receive, delete, etc.) takes some time.</span></span> <span data-ttu-id="73b1e-128">Questa volta include l'elaborazione dell'operazione dal servizio Bus di servizio oltre alla latenza della richiesta e risposta.</span><span class="sxs-lookup"><span data-stu-id="73b1e-128">This time includes the processing of the operation by the Service Bus service in addition to the latency of the request and the reply.</span></span> <span data-ttu-id="73b1e-129">Per aumentare il numero di operazioni per volta, è necessario eseguire le operazioni contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="73b1e-129">To increase the number of operations per time, operations must execute concurrently.</span></span> <span data-ttu-id="73b1e-130">È possibile farlo in diversi modi:</span><span class="sxs-lookup"><span data-stu-id="73b1e-130">You can do this in several different ways:</span></span>

* <span data-ttu-id="73b1e-131">**Operazioni asincrone**: il client pianifica le operazioni eseguendo operazioni asincrone.</span><span class="sxs-lookup"><span data-stu-id="73b1e-131">**Asynchronous operations**: the client schedules operations by performing asynchronous operations.</span></span> <span data-ttu-id="73b1e-132">La richiesta successiva viene avviata prima del completamento della richiesta precedente.</span><span class="sxs-lookup"><span data-stu-id="73b1e-132">The next request is started before the previous request is completed.</span></span> <span data-ttu-id="73b1e-133">Ecco un esempio di operazione di invio in modalità asincrona:</span><span class="sxs-lookup"><span data-stu-id="73b1e-133">The following is an example of an asynchronous send operation:</span></span>
  
 ```csharp
  BrokeredMessage m1 = new BrokeredMessage(body);
  BrokeredMessage m2 = new BrokeredMessage(body);
  
  Task send1 = queueClient.SendAsync(m1).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #1");
    });
  Task send2 = queueClient.SendAsync(m2).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #2");
    });
  Task.WaitAll(send1, send2);
  Console.WriteLine("All messages sent");
  ```
  
  <span data-ttu-id="73b1e-134">Ecco un esempio di operazione di ricezione in modalità asincrona:</span><span class="sxs-lookup"><span data-stu-id="73b1e-134">This is an example of an asynchronous receive operation:</span></span>
  
  ```csharp
  Task receive1 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  Task receive2 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  
  Task.WaitAll(receive1, receive2);
  Console.WriteLine("All messages received");
  
  async void ProcessReceivedMessage(Task<BrokeredMessage> t)
  {
    BrokeredMessage m = t.Result;
    Console.WriteLine("{0} received", m.Label);
    await m.CompleteAsync();
    Console.WriteLine("{0} complete", m.Label);
  }
  ```
* <span data-ttu-id="73b1e-135">**Più factory**: tutti i client, mittenti e ricevitori, creati dalla stessa factory condividono la stessa connessione TCP.</span><span class="sxs-lookup"><span data-stu-id="73b1e-135">**Multiple factories**: all clients (senders in addition to receivers) that are created by the same factory share one TCP connection.</span></span> <span data-ttu-id="73b1e-136">La velocità effettiva massima dei messaggi è limitata dal numero di operazioni che possono usare questa connessione TCP.</span><span class="sxs-lookup"><span data-stu-id="73b1e-136">The maximum message throughput is limited by the number of operations that can go through this TCP connection.</span></span> <span data-ttu-id="73b1e-137">La velocità effettiva che si può ottenere con una singola factory varia in modo significativo a seconda dei tempi di round trip TCP e delle dimensioni dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="73b1e-137">The throughput that can be obtained with a single factory varies greatly with TCP round-trip times and message size.</span></span> <span data-ttu-id="73b1e-138">Per ottenere una velocità effettiva più elevata, è consigliare usare più factory di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="73b1e-138">To obtain higher throughput rates, you should use multiple messaging factories.</span></span>

## <a name="receive-mode"></a><span data-ttu-id="73b1e-139">Modalità di ricezione</span><span class="sxs-lookup"><span data-stu-id="73b1e-139">Receive mode</span></span>
<span data-ttu-id="73b1e-140">Quando si crea un client di coda o sottoscrizione, è possibile specificare una modalità di ricezione: *PeekLock* o *ReceiveAndDelete*.</span><span class="sxs-lookup"><span data-stu-id="73b1e-140">When creating a queue or subscription client, you can specify a receive mode: *Peek-lock* or *Receive and Delete*.</span></span> <span data-ttu-id="73b1e-141">La modalità di ricezione predefinita è [PeekLock][PeekLock].</span><span class="sxs-lookup"><span data-stu-id="73b1e-141">The default receive mode is [PeekLock][PeekLock].</span></span> <span data-ttu-id="73b1e-142">Quando si opera in questa modalità, il client invia una richiesta per la ricezione di un messaggio dal bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-142">When operating in this mode, the client sends a request to receive a message from Service Bus.</span></span> <span data-ttu-id="73b1e-143">Una volta che il client ha ricevuto il messaggio, invia una richiesta per il completamento del messaggio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-143">After the client has received the message, it sends a request to complete the message.</span></span>

<span data-ttu-id="73b1e-144">Quando la modalità di ricezione è impostata su [ReceiveAndDelete][ReceiveAndDelete], entrambi i passaggi vengono combinati in una singola richiesta.</span><span class="sxs-lookup"><span data-stu-id="73b1e-144">When setting the receive mode to [ReceiveAndDelete][ReceiveAndDelete], both steps are combined in a single request.</span></span> <span data-ttu-id="73b1e-145">Questo permette di ridurre il numero complessivo di operazioni e di migliorare la velocità effettiva dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="73b1e-145">This reduces the overall number of operations, and can improve the overall message throughput.</span></span> <span data-ttu-id="73b1e-146">Questo miglioramento delle prestazioni tuttavia comporta il rischio di perdere alcuni messaggi.</span><span class="sxs-lookup"><span data-stu-id="73b1e-146">This performance gain comes at the risk of losing messages.</span></span>

<span data-ttu-id="73b1e-147">Il bus di servizio non supporta le transazioni per le operazioni receive-and-delete.</span><span class="sxs-lookup"><span data-stu-id="73b1e-147">Service Bus does not support transactions for receive-and-delete operations.</span></span> <span data-ttu-id="73b1e-148">La semantica peek-lock (blocco di visualizzazione) è anche necessaria per qualsiasi scenario in cui il client vuole posticipare l'invio di un messaggio o inserirlo nella [coda dei messaggi non recapitabili](service-bus-dead-letter-queues.md).</span><span class="sxs-lookup"><span data-stu-id="73b1e-148">In addition, peek-lock semantics are required for any scenarios in which the client wants to defer or [dead-letter](service-bus-dead-letter-queues.md) a message.</span></span>

## <a name="client-side-batching"></a><span data-ttu-id="73b1e-149">Invio in batch sul lato client</span><span class="sxs-lookup"><span data-stu-id="73b1e-149">Client-side batching</span></span>
<span data-ttu-id="73b1e-150">L'invio in batch sul lato client consente a un client di coda o argomento di ritardare l'invio di un messaggio per un determinato periodo di tempo.</span><span class="sxs-lookup"><span data-stu-id="73b1e-150">Client-side batching enables a queue or topic client to delay the sending of a message for a certain period of time.</span></span> <span data-ttu-id="73b1e-151">Se il client invia messaggi aggiuntivi durante questo periodo di tempo, trasmette i messaggi in un singolo batch.</span><span class="sxs-lookup"><span data-stu-id="73b1e-151">If the client sends additional messages during this time period, it transmits the messages in a single batch.</span></span> <span data-ttu-id="73b1e-152">L'invio in batch sul lato client prevede anche che il client di coda o la sottoscrizione invii in batch più richieste di tipo **Complete** in una singola richiesta.</span><span class="sxs-lookup"><span data-stu-id="73b1e-152">Client-side batching also causes a queue or subscription client to batch multiple **Complete** requests into a single request.</span></span> <span data-ttu-id="73b1e-153">L'invio in batch è disponibile solo per le operazioni asincrone **Send** e **Complete**.</span><span class="sxs-lookup"><span data-stu-id="73b1e-153">Batching is only available for asynchronous **Send** and **Complete** operations.</span></span> <span data-ttu-id="73b1e-154">Le operazioni sincrone vengono immediatamente inviate al servizio Bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-154">Synchronous operations are immediately sent to the Service Bus service.</span></span> <span data-ttu-id="73b1e-155">L'invio in batch non si verifica per le operazioni di anteprima (peek) o ricezione né tra più client.</span><span class="sxs-lookup"><span data-stu-id="73b1e-155">Batching does not occur for peek or receive operations, nor does batching occur across clients.</span></span>

<span data-ttu-id="73b1e-156">Per impostazione predefinita, i client usano un intervallo di invio in batch di 20 ms.</span><span class="sxs-lookup"><span data-stu-id="73b1e-156">By default, a client uses a batch interval of 20ms.</span></span> <span data-ttu-id="73b1e-157">È possibile modificare l'intervallo di invio in batch impostando la proprietà [BatchFlushInterval][BatchFlushInterval] prima di creare la factory di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="73b1e-157">You can change the batch interval by setting the [BatchFlushInterval][BatchFlushInterval] property before creating the messaging factory.</span></span> <span data-ttu-id="73b1e-158">Questa impostazione interessa tutti i client creati da questa factory.</span><span class="sxs-lookup"><span data-stu-id="73b1e-158">This setting affects all clients that are created by this factory.</span></span>

<span data-ttu-id="73b1e-159">Per disabilitare l'invio in batch, impostare la proprietà [BatchFlushInterval][BatchFlushInterval] su **TimeSpan.Zero**.</span><span class="sxs-lookup"><span data-stu-id="73b1e-159">To disable batching, set the [BatchFlushInterval][BatchFlushInterval] property to **TimeSpan.Zero**.</span></span> <span data-ttu-id="73b1e-160">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="73b1e-160">For example:</span></span>

```csharp
MessagingFactorySettings mfs = new MessagingFactorySettings();
mfs.TokenProvider = tokenProvider;
mfs.NetMessagingTransportSettings.BatchFlushInterval = TimeSpan.FromSeconds(0.05);
MessagingFactory messagingFactory = MessagingFactory.Create(namespaceUri, mfs);
```

<span data-ttu-id="73b1e-161">L'invio in batch non influisce sul numero di operazioni di messaggistica fatturabili ed è disponibile solo per il protocollo client del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-161">Batching does not affect the number of billable messaging operations, and is available only for the Service Bus client protocol.</span></span> <span data-ttu-id="73b1e-162">Il protocollo HTTP non supporta l'invio in batch.</span><span class="sxs-lookup"><span data-stu-id="73b1e-162">The HTTP protocol does not support batching.</span></span>

## <a name="batching-store-access"></a><span data-ttu-id="73b1e-163">Invio in batch per l'accesso all'archivio</span><span class="sxs-lookup"><span data-stu-id="73b1e-163">Batching store access</span></span>
<span data-ttu-id="73b1e-164">Per aumentare la velocità effettiva di una coda, un argomento o una sottoscrizione, il bus di servizio invia in batch più messaggi quando esegue la scrittura nel proprio archivio interno.</span><span class="sxs-lookup"><span data-stu-id="73b1e-164">To increase the throughput of a queue, topic, or subscription, Service Bus batches multiple messages when it writes to its internal store.</span></span> <span data-ttu-id="73b1e-165">Se abilitata in una coda o in un argomento, la scrittura di messaggi nell'archivio verrà eseguita in batch.</span><span class="sxs-lookup"><span data-stu-id="73b1e-165">If enabled on a queue or topic, writing messages into the store will be batched.</span></span> <span data-ttu-id="73b1e-166">Se abilitata in una coda o in una sottoscrizione, l'eliminazione di messaggi dall'archivio verrà eseguita in batch.</span><span class="sxs-lookup"><span data-stu-id="73b1e-166">If enabled on a queue or subscription, deleting messages from the store will be batched.</span></span> <span data-ttu-id="73b1e-167">Se l'accesso in batch all'archivio è abilitato per un'entità, il bus di servizio ritarda l'operazione di scrittura nell'archivio relativa all'entità per un massimo di 20 ms.</span><span class="sxs-lookup"><span data-stu-id="73b1e-167">If batched store access is enabled for an entity, Service Bus delays a store write operation regarding that entity by up to 20ms.</span></span> <span data-ttu-id="73b1e-168">Le operazioni di scrittura aggiuntive che si verificano durante questo intervallo vengono aggiunte al batch.</span><span class="sxs-lookup"><span data-stu-id="73b1e-168">Additional store operations that occur during this interval are added to the batch.</span></span> <span data-ttu-id="73b1e-169">L'accesso in batch all'archivio influisce solo sulle operazioni **Send** e **Complete** e non sulle operazioni di ricezione.</span><span class="sxs-lookup"><span data-stu-id="73b1e-169">Batched store access only affects **Send** and **Complete** operations; receive operations are not affected.</span></span> <span data-ttu-id="73b1e-170">L'accesso in batch all'archivio è una proprietà di un'entità.</span><span class="sxs-lookup"><span data-stu-id="73b1e-170">Batched store access is a property on an entity.</span></span> <span data-ttu-id="73b1e-171">L'invio in batch si verifica per tutte le entità per cui è abilitato l'accesso in batch all'archivio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-171">Batching occurs across all entities that enable batched store access.</span></span>

<span data-ttu-id="73b1e-172">Quando si crea una nuova coda, un nuovo argomento o una nuova sottoscrizione, l'accesso in batch all'archivio è abilitato per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="73b1e-172">When creating a new queue, topic or subscription, batched store access is enabled by default.</span></span> <span data-ttu-id="73b1e-173">Per disabilitare l'accesso in batch all'archivio, impostare la proprietà [EnableBatchedOperations][EnableBatchedOperations] su **false** prima di creare l'entità.</span><span class="sxs-lookup"><span data-stu-id="73b1e-173">To disable batched store access, set the [EnableBatchedOperations][EnableBatchedOperations] property to **false** before creating the entity.</span></span> <span data-ttu-id="73b1e-174">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="73b1e-174">For example:</span></span>

```csharp
QueueDescription qd = new QueueDescription();
qd.EnableBatchedOperations = false;
Queue q = namespaceManager.CreateQueue(qd);
```

<span data-ttu-id="73b1e-175">L'accesso in batch all'archivio non influisce sul numero di operazioni di messaggistica fatturabili ed è una proprietà di una coda, di un argomento o di una sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="73b1e-175">Batched store access does not affect the number of billable messaging operations, and is a property of a queue, topic, or subscription.</span></span> <span data-ttu-id="73b1e-176">È indipendente dalla modalità di ricezione e dal protocollo usato tra un client e il servizio Bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-176">It is independent of the receive mode and the protocol that is used between a client and the Service Bus service.</span></span>

## <a name="prefetching"></a><span data-ttu-id="73b1e-177">Prelettura</span><span class="sxs-lookup"><span data-stu-id="73b1e-177">Prefetching</span></span>
<span data-ttu-id="73b1e-178">La prelettura consente al client di coda o sottoscrizione di caricare messaggi aggiuntivi dal servizio durante l'esecuzione di un'operazione di ricezione.</span><span class="sxs-lookup"><span data-stu-id="73b1e-178">Prefetching enables the queue or subscription client to load additional messages from the service when it performs a receive operation.</span></span> <span data-ttu-id="73b1e-179">Il client archivia i messaggi in una cache locale.</span><span class="sxs-lookup"><span data-stu-id="73b1e-179">The client stores these messages in a local cache.</span></span> <span data-ttu-id="73b1e-180">Le dimensioni della cache sono determinate dalle proprietà [QueueClient.PrefetchCount][QueueClient.PrefetchCount] o [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount].</span><span class="sxs-lookup"><span data-stu-id="73b1e-180">The size of the cache is determined by the [QueueClient.PrefetchCount][QueueClient.PrefetchCount] or [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] properties.</span></span> <span data-ttu-id="73b1e-181">Ogni client che abilita la prelettura mantiene la propria cache.</span><span class="sxs-lookup"><span data-stu-id="73b1e-181">Each client that enables prefetching maintains its own cache.</span></span> <span data-ttu-id="73b1e-182">La cache non è condivisa tra i client.</span><span class="sxs-lookup"><span data-stu-id="73b1e-182">A cache is not shared across clients.</span></span> <span data-ttu-id="73b1e-183">Se il client avvia un'operazione di ricezione e la relativa cache è vuota, il servizio trasmette un batch di messaggi.</span><span class="sxs-lookup"><span data-stu-id="73b1e-183">If the client initiates a receive operation and its cache is empty, the service transmits a batch of messages.</span></span> <span data-ttu-id="73b1e-184">Le dimensioni del batch corrispondono alle dimensioni della cache o a 256 KB, a seconda del valore minore.</span><span class="sxs-lookup"><span data-stu-id="73b1e-184">The size of the batch equals the size of the cache or 256 KB, whichever is smaller.</span></span> <span data-ttu-id="73b1e-185">Se il client avvia un'operazione di ricezione e la cache contiene un messaggio, il messaggio viene recuperato dalla cache.</span><span class="sxs-lookup"><span data-stu-id="73b1e-185">If the client initiates a receive operation and the cache contains a message, the message is taken from the cache.</span></span>

<span data-ttu-id="73b1e-186">Quando un messaggio viene sottoposto a prelettura, il servizio lo blocca.</span><span class="sxs-lookup"><span data-stu-id="73b1e-186">When a message is prefetched, the service locks the prefetched message.</span></span> <span data-ttu-id="73b1e-187">In questo modo, il messaggio non potrà essere ricevuto da un ricevitore diverso.</span><span class="sxs-lookup"><span data-stu-id="73b1e-187">By doing this, the prefetched message cannot be received by a different receiver.</span></span> <span data-ttu-id="73b1e-188">Se il ricevitore non può completare il messaggio prima della scadenza del blocco, il messaggio diventa disponibile per altri ricevitori.</span><span class="sxs-lookup"><span data-stu-id="73b1e-188">If the receiver cannot complete the message before the lock expires, the message becomes available to other receivers.</span></span> <span data-ttu-id="73b1e-189">La copia del messaggio sottoposta a prelettura resta nella cache.</span><span class="sxs-lookup"><span data-stu-id="73b1e-189">The prefetched copy of the message remains in the cache.</span></span> <span data-ttu-id="73b1e-190">Il ricevitore che usa la copia scaduta memorizzata nella cache riceve un'eccezione quando prova a completare il messaggio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-190">The receiver that consumes the expired cached copy will receive an exception when it tries to complete that message.</span></span> <span data-ttu-id="73b1e-191">Per impostazione predefinita, il blocco del messaggio scade dopo 60 secondi.</span><span class="sxs-lookup"><span data-stu-id="73b1e-191">By default, the message lock expires after 60 seconds.</span></span> <span data-ttu-id="73b1e-192">Questo valore può essere esteso a 5 minuti.</span><span class="sxs-lookup"><span data-stu-id="73b1e-192">This value can be extended to 5 minutes.</span></span> <span data-ttu-id="73b1e-193">Per evitare che vengano usati messaggi scaduti, la dimensione della cache dovrebbe essere sempre inferiore al numero di messaggi che possono essere usati da un client nell'intervallo di timeout del blocco.</span><span class="sxs-lookup"><span data-stu-id="73b1e-193">To prevent the consumption of expired messages, the cache size should always be smaller than the number of messages that can be consumed by a client within the lock time-out interval.</span></span>

<span data-ttu-id="73b1e-194">Se si usa l'impostazione predefinita di 60 secondi per la scadenza del blocco, è consigliabile impostare [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] su un valore pari a 20 volte la velocità massima di elaborazione di tutti i ricevitori della factory.</span><span class="sxs-lookup"><span data-stu-id="73b1e-194">When using the default lock expiration of 60 seconds, a good value for [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] is 20 times the maximum processing rates of all receivers of the factory.</span></span> <span data-ttu-id="73b1e-195">Ad esempio, una factory crea tre ricevitori e ogni ricevitore può elaborare al massimo 10 messaggi al secondo.</span><span class="sxs-lookup"><span data-stu-id="73b1e-195">For example, a factory creates 3 receivers, and each receiver can process up to 10 messages per second.</span></span> <span data-ttu-id="73b1e-196">Il conteggio prelettura non deve superare 20 X 3 X 10 = 600.</span><span class="sxs-lookup"><span data-stu-id="73b1e-196">The prefetch count should not exceed 20 X 3 X 10 = 600.</span></span> <span data-ttu-id="73b1e-197">Per impostazione predefinita, la proprietà [QueueClient.PrefetchCount][QueueClient.PrefetchCount] è impostata su 0, a indicare che non vengono recuperati altri messaggi dal servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-197">By default, [QueueClient.PrefetchCount][QueueClient.PrefetchCount] is set to 0, which means that no additional messages are fetched from the service.</span></span>

<span data-ttu-id="73b1e-198">La prelettura dei messaggi comporta un aumento della velocità effettiva globale per una coda o una sottoscrizione perché riduce il numero complessivo di operazioni sui messaggi, o round trip.</span><span class="sxs-lookup"><span data-stu-id="73b1e-198">Prefetching messages increases the overall throughput for a queue or subscription because it reduces the overall number of message operations, or round trips.</span></span> <span data-ttu-id="73b1e-199">Il recupero del primo messaggio tuttavia richiede più tempo (a causa della dimensione del messaggio aumentata).</span><span class="sxs-lookup"><span data-stu-id="73b1e-199">Fetching the first message, however, will take longer (due to the increased message size).</span></span> <span data-ttu-id="73b1e-200">La ricezione di messaggi sottoposti a prelettura sarà più rapida perché questi messaggi sono stati già scaricati dal client.</span><span class="sxs-lookup"><span data-stu-id="73b1e-200">Receiving prefetched messages will be faster because these messages have already been downloaded by the client.</span></span>

<span data-ttu-id="73b1e-201">La proprietà di durata (TTL) di un messaggio viene controllata dal server nel momento in cui invia il messaggio al client.</span><span class="sxs-lookup"><span data-stu-id="73b1e-201">The time-to-live (TTL) property of a message is checked by the server at the time the server sends the message to the client.</span></span> <span data-ttu-id="73b1e-202">Il client non controlla la proprietà di durata (TTL) del messaggio al momento della ricezione.</span><span class="sxs-lookup"><span data-stu-id="73b1e-202">The client does not check the message’s TTL property when the message is received.</span></span> <span data-ttu-id="73b1e-203">Il messaggio può essere ricevuto anche se la relativa durata (TTL) scade durante la memorizzazione nella cache da parte del client.</span><span class="sxs-lookup"><span data-stu-id="73b1e-203">Instead, the message can be received even if the message’s TTL has passed while the message was cached by the client.</span></span>

<span data-ttu-id="73b1e-204">La prelettura non influisce sul numero di operazioni di messaggistica fatturabili ed è disponibile solo per il protocollo client del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-204">Prefetching does not affect the number of billable messaging operations, and is available only for the Service Bus client protocol.</span></span> <span data-ttu-id="73b1e-205">Il protocollo HTTP non supporta la prelettura.</span><span class="sxs-lookup"><span data-stu-id="73b1e-205">The HTTP protocol does not support prefetching.</span></span> <span data-ttu-id="73b1e-206">Questa funzionalità è disponibile per le operazioni di ricezione sincrone e asincrone.</span><span class="sxs-lookup"><span data-stu-id="73b1e-206">Prefetching is available for both synchronous and asynchronous receive operations.</span></span>

## <a name="express-queues-and-topics"></a><span data-ttu-id="73b1e-207">Code e argomenti rapidi</span><span class="sxs-lookup"><span data-stu-id="73b1e-207">Express queues and topics</span></span>

<span data-ttu-id="73b1e-208">Le entità express consentono scenari che prevedono velocità effettiva elevata e latenza minima e sono supportate solo nel livello di messaggistica Standard.</span><span class="sxs-lookup"><span data-stu-id="73b1e-208">Express entities enable high throughput and reduced latency scenarios, and are supported only in the Standard messaging tier.</span></span> <span data-ttu-id="73b1e-209">Le entità create negli [spazi dei nomi Premium](service-bus-premium-messaging.md) non supportano l'opzione express.</span><span class="sxs-lookup"><span data-stu-id="73b1e-209">Entities created in [Premium namespaces](service-bus-premium-messaging.md) do not support the express option.</span></span> <span data-ttu-id="73b1e-210">Quando si usano le entità rapide, un messaggio inviato a una coda o a un argomento non viene archiviato immediatamente nell'archivio di messaggistica,</span><span class="sxs-lookup"><span data-stu-id="73b1e-210">With express entities, if a message is sent to a queue or topic, the message is not immediately stored in the messaging store.</span></span> <span data-ttu-id="73b1e-211">ma viene memorizzato nella cache in memoria.</span><span class="sxs-lookup"><span data-stu-id="73b1e-211">Instead, it is cached in memory.</span></span> <span data-ttu-id="73b1e-212">Se un messaggio resta nella coda per più di alcuni secondi, viene automaticamente scritto in un'archiviazione stabile, proteggendolo così da eventuali perdite a causa di un'interruzione.</span><span class="sxs-lookup"><span data-stu-id="73b1e-212">If a message remains in the queue for more than a few seconds, it is automatically written to stable storage, thus protecting it against loss due to an outage.</span></span> <span data-ttu-id="73b1e-213">La scrittura di un messaggio in una cache consente di incrementare la velocità effettiva e di ridurre la latenza, perché al momento dell'invio del messaggio non si verificano tentativi di accesso all'archiviazione stabile.</span><span class="sxs-lookup"><span data-stu-id="73b1e-213">Writing the message into a memory cache increases throughput and reduces latency because there is no access to stable storage at the time the message is sent.</span></span> <span data-ttu-id="73b1e-214">I messaggi usati nell'arco di pochi secondi non vengono inseriti nell'archivio di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="73b1e-214">Messages that are consumed within a few seconds are not written to the messaging store.</span></span> <span data-ttu-id="73b1e-215">L'esempio seguente illustra la creazione di un argomento rapido.</span><span class="sxs-lookup"><span data-stu-id="73b1e-215">The following example creates an express topic.</span></span>

```csharp
TopicDescription td = new TopicDescription(TopicName);
td.EnableExpress = true;
namespaceManager.CreateTopic(td);
```

<span data-ttu-id="73b1e-216">Se un messaggio contenente informazioni critiche che non devono andare perdute viene inviato a un'entità espressa, il mittente può forzare il bus di servizio perché mantenga subito e in modo permanente il messaggio nell'archivio stabile impostando la proprietà [ForcePersistence][ForcePersistence] su **true**.</span><span class="sxs-lookup"><span data-stu-id="73b1e-216">If a message containing critical information that must not be lost is sent to an express entity, the sender can force Service Bus to immediately persist the message to stable storage by setting the [ForcePersistence][ForcePersistence] property to **true**.</span></span>

> [!NOTE]
> <span data-ttu-id="73b1e-217">Le entità express non supportano le transazioni.</span><span class="sxs-lookup"><span data-stu-id="73b1e-217">Express entities do not support transactions.</span></span>

## <a name="use-of-partitioned-queues-or-topics"></a><span data-ttu-id="73b1e-218">Uso di code o argomenti partizionati</span><span class="sxs-lookup"><span data-stu-id="73b1e-218">Use of partitioned queues or topics</span></span>
<span data-ttu-id="73b1e-219">Internamente, il bus di servizio usa lo stesso nodo e lo stesso archivio di messaggistica per elaborare e archiviare tutti i messaggi per un'entità di messaggistica (coda o argomento).</span><span class="sxs-lookup"><span data-stu-id="73b1e-219">Internally, Service Bus uses the same node and messaging store to process and store all messages for a messaging entity (queue or topic).</span></span> <span data-ttu-id="73b1e-220">Una coda o un argomento partizionato, al contrario, viene distribuito tra più nodi e archivi di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="73b1e-220">A partitioned queue or topic, on the other hand, is distributed across multiple nodes and messaging stores.</span></span> <span data-ttu-id="73b1e-221">Le code e gli argomenti partizionati non solo registrano una velocità effettiva superiore rispetto a quella delle code e degli argomenti normali, ma presentano anche una maggiore disponibilità.</span><span class="sxs-lookup"><span data-stu-id="73b1e-221">Partitioned queues and topics not only yield a higher throughput than regular queues and topics, they also exhibit superior availability.</span></span> <span data-ttu-id="73b1e-222">Per creare un'entità partizionata, impostare la proprietà [EnablePartitioning][EnablePartitioning] su **true**, come illustrato nell'esempio seguente.</span><span class="sxs-lookup"><span data-stu-id="73b1e-222">To create a partitioned entity, set the [EnablePartitioning][EnablePartitioning] property to **true**, as shown in the following example.</span></span> <span data-ttu-id="73b1e-223">Per altre informazioni sulle entità partizionate, vedere le [entità di messaggistica partizionate][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="73b1e-223">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

```csharp
// Create partitioned queue.
QueueDescription qd = new QueueDescription(QueueName);
qd.EnablePartitioning = true;
namespaceManager.CreateQueue(qd);
```

## <a name="use-of-multiple-queues"></a><span data-ttu-id="73b1e-224">Uso di più code</span><span class="sxs-lookup"><span data-stu-id="73b1e-224">Use of multiple queues</span></span>

<span data-ttu-id="73b1e-225">Se non è possibile usare una coda o un argomento partizionato o se il carico previsto non può essere gestito da una singola coda o argomento partizionato, è necessario usare più entità di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="73b1e-225">If it is not possible to use a partitioned queue or topic, or the expected load cannot be handled by a single partitioned queue or topic, you must use multiple messaging entities.</span></span> <span data-ttu-id="73b1e-226">Se si usano più entità, è consigliabile creare un client dedicato per ogni entità invece di usare lo stesso client per tutte.</span><span class="sxs-lookup"><span data-stu-id="73b1e-226">When using multiple entities, create a dedicated client for each entity, instead of using the same client for all entities.</span></span>

## <a name="development-and-testing-features"></a><span data-ttu-id="73b1e-227">Funzionalità di sviluppo e test</span><span class="sxs-lookup"><span data-stu-id="73b1e-227">Development and testing features</span></span>

<span data-ttu-id="73b1e-228">Il bus di servizio presenta una funzionalità che viene usata in particolare per lo sviluppo e che **non deve mai essere usata nelle configurazioni di produzione**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span><span class="sxs-lookup"><span data-stu-id="73b1e-228">Service Bus has one feature that is used specifically for development which **should never be used in production configurations**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span></span>

<span data-ttu-id="73b1e-229">Quando vengono aggiunti nuovi filtri o nuove regole all'argomento, è possibile usare [TopicDescription.EnableFilteringMessagesBeforePublishing][] per verificare che la nuova espressione di filtro funzioni come previsto.</span><span class="sxs-lookup"><span data-stu-id="73b1e-229">When new rules or filters are added to the topic, you can use [TopicDescription.EnableFilteringMessagesBeforePublishing][] to verify that the new filter expression is working as expected.</span></span>

## <a name="scenarios"></a><span data-ttu-id="73b1e-230">Scenari</span><span class="sxs-lookup"><span data-stu-id="73b1e-230">Scenarios</span></span>
<span data-ttu-id="73b1e-231">Le sezioni seguenti descrivono scenari di messaggistica tipici e indicano le impostazioni preferibili del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-231">The following sections describe typical messaging scenarios and outline the preferred Service Bus settings.</span></span> <span data-ttu-id="73b1e-232">La velocità effettiva è classificata come bassa (minore di 1 messaggio al secondo), moderata (maggiore o uguale a 1 messaggio al secondo ma minore di 100 messaggi al secondo) ed elevata (maggiore o uguale a 100 messaggi al secondo).</span><span class="sxs-lookup"><span data-stu-id="73b1e-232">Throughput rates are classified as small (less than 1 message/second), moderate (1 message/second or greater but less than 100 messages/second) and high (100 messages/second or greater).</span></span> <span data-ttu-id="73b1e-233">Il numero di client è classificato come basso (minore o uguale a 5), moderato (maggiore di 5 ma minore o uguale a 20) ed elevato (maggiore di 20).</span><span class="sxs-lookup"><span data-stu-id="73b1e-233">The number of clients are classified as small (5 or fewer), moderate (more than 5 but less than or equal to 20), and large (more than 20).</span></span>

### <a name="high-throughput-queue"></a><span data-ttu-id="73b1e-234">Coda ad alta velocità effettiva</span><span class="sxs-lookup"><span data-stu-id="73b1e-234">High-throughput queue</span></span>
<span data-ttu-id="73b1e-235">Obiettivo: aumentare la velocità effettiva di una singola coda.</span><span class="sxs-lookup"><span data-stu-id="73b1e-235">Goal: Maximize the throughput of a single queue.</span></span> <span data-ttu-id="73b1e-236">Il numero di mittenti e ricevitori è limitato.</span><span class="sxs-lookup"><span data-stu-id="73b1e-236">The number of senders and receivers is small.</span></span>

* <span data-ttu-id="73b1e-237">Usare una coda partizionata per migliorare prestazioni e disponibilità.</span><span class="sxs-lookup"><span data-stu-id="73b1e-237">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="73b1e-238">Per aumentare la velocità di invio globale nella coda, usare più factory di messaggistica per la creazione di mittenti.</span><span class="sxs-lookup"><span data-stu-id="73b1e-238">To increase the overall send rate into the queue, use multiple message factories to create senders.</span></span> <span data-ttu-id="73b1e-239">Per ogni mittente usare operazioni asincrone o più thread.</span><span class="sxs-lookup"><span data-stu-id="73b1e-239">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="73b1e-240">Per aumentare la velocità di ricezione globale dalla coda, usare più factory di messaggistica per la creazione di ricevitori.</span><span class="sxs-lookup"><span data-stu-id="73b1e-240">To increase the overall receive rate from the queue, use multiple message factories to create receivers.</span></span>
* <span data-ttu-id="73b1e-241">Usare operazioni asincrone per sfruttare i vantaggi dell'invio in batch sul lato client.</span><span class="sxs-lookup"><span data-stu-id="73b1e-241">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="73b1e-242">Impostare l'intervallo di invio in batch su 50 ms per ridurre il numero di trasmissioni tramite il protocollo client del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-242">Set the batching interval to 50ms to reduce the number of Service Bus client protocol transmissions.</span></span> <span data-ttu-id="73b1e-243">Se vengono usati più mittenti, aumentare l'intervallo di invio in batch impostandolo su 100 ms.</span><span class="sxs-lookup"><span data-stu-id="73b1e-243">If multiple senders are used, increase the batching interval to 100ms.</span></span>
* <span data-ttu-id="73b1e-244">Lasciare abilitato l'accesso in batch all'archivio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-244">Leave batched store access enabled.</span></span> <span data-ttu-id="73b1e-245">In questo modo si aumenta la velocità complessiva per la scrittura dei messaggi nella coda.</span><span class="sxs-lookup"><span data-stu-id="73b1e-245">This increases the overall rate at which messages can be written into the queue.</span></span>
* <span data-ttu-id="73b1e-246">Impostare il conteggio prelettura su un valore pari a 20 volte la velocità di elaborazione massima di tutti i ricevitori di una factory.</span><span class="sxs-lookup"><span data-stu-id="73b1e-246">Set the prefetch count to 20 times the maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="73b1e-247">Questo valore riduce il numero di trasmissioni tramite il protocollo client del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-247">This reduces the number of Service Bus client protocol transmissions.</span></span>

### <a name="multiple-high-throughput-queues"></a><span data-ttu-id="73b1e-248">Code multiple ad alta velocità effettiva</span><span class="sxs-lookup"><span data-stu-id="73b1e-248">Multiple high-throughput queues</span></span>
<span data-ttu-id="73b1e-249">Obiettivo: aumentare la velocità effettiva complessiva di più code.</span><span class="sxs-lookup"><span data-stu-id="73b1e-249">Goal: Maximize overall throughput of multiple queues.</span></span> <span data-ttu-id="73b1e-250">La velocità effettiva di una singola coda è moderata o elevata.</span><span class="sxs-lookup"><span data-stu-id="73b1e-250">The throughput of an individual queue is moderate or high.</span></span>

<span data-ttu-id="73b1e-251">Per ottenere la velocità effettiva massima su più code, usare le impostazioni descritte per aumentare la velocità effettiva di una singola coda.</span><span class="sxs-lookup"><span data-stu-id="73b1e-251">To obtain maximum throughput across multiple queues, use the settings outlined to maximize the throughput of a single queue.</span></span> <span data-ttu-id="73b1e-252">Usare inoltre factory diverse per creare client che inviano o ricevono da code diverse.</span><span class="sxs-lookup"><span data-stu-id="73b1e-252">In addition, use different factories to create clients that send or receive from different queues.</span></span>

### <a name="low-latency-queue"></a><span data-ttu-id="73b1e-253">Coda a bassa latenza</span><span class="sxs-lookup"><span data-stu-id="73b1e-253">Low latency queue</span></span>
<span data-ttu-id="73b1e-254">Obiettivo: ridurre la latenza end-to-end di una coda o di un argomento.</span><span class="sxs-lookup"><span data-stu-id="73b1e-254">Goal: Minimize end-to-end latency of a queue or topic.</span></span> <span data-ttu-id="73b1e-255">Il numero di mittenti e ricevitori è limitato.</span><span class="sxs-lookup"><span data-stu-id="73b1e-255">The number of senders and receivers is small.</span></span> <span data-ttu-id="73b1e-256">La velocità effettiva della coda è ridotta o moderata.</span><span class="sxs-lookup"><span data-stu-id="73b1e-256">The throughput of the queue is small or moderate.</span></span>

* <span data-ttu-id="73b1e-257">Usare una coda partizionata migliorare la disponibilità.</span><span class="sxs-lookup"><span data-stu-id="73b1e-257">Use a partitioned queue for improved availability.</span></span>
* <span data-ttu-id="73b1e-258">Disabilitare l'invio in batch sul lato client.</span><span class="sxs-lookup"><span data-stu-id="73b1e-258">Disable client-side batching.</span></span> <span data-ttu-id="73b1e-259">Il client invia immediatamente un messaggio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-259">The client immediately sends a message.</span></span>
* <span data-ttu-id="73b1e-260">Disabilitare l'accesso in batch all'archivio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-260">Disable batched store access.</span></span> <span data-ttu-id="73b1e-261">Il servizio scrive immediatamente il messaggio nell'archivio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-261">The service immediately writes the message to the store.</span></span>
* <span data-ttu-id="73b1e-262">Se si usa un singolo client, impostare il conteggio prelettura su un valore pari a 20 volte la velocità di elaborazione del ricevitore.</span><span class="sxs-lookup"><span data-stu-id="73b1e-262">If using a single client, set the prefetch count to 20 times the processing rate of the receiver.</span></span> <span data-ttu-id="73b1e-263">Se più messaggi arrivano nella coda allo stesso tempo, il protocollo client del bus di servizio li trasmette tutti contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="73b1e-263">If multiple messages arrive at the queue at the same time, the Service Bus client protocol transmits them all at the same time.</span></span> <span data-ttu-id="73b1e-264">Quando il client riceve il messaggio successivo, questo è già presente nella cache locale.</span><span class="sxs-lookup"><span data-stu-id="73b1e-264">When the client receives the next message, that message is already in the local cache.</span></span> <span data-ttu-id="73b1e-265">La cache deve essere di dimensioni ridotte.</span><span class="sxs-lookup"><span data-stu-id="73b1e-265">The cache should be small.</span></span>
* <span data-ttu-id="73b1e-266">Se si usano più client, impostare il conteggio prelettura su 0.</span><span class="sxs-lookup"><span data-stu-id="73b1e-266">If using multiple clients, set the prefetch count to 0.</span></span> <span data-ttu-id="73b1e-267">In questo modo, il secondo client può ricevere il secondo messaggio mentre il primo client sta ancora elaborando il primo messaggio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-267">By doing this, the second client can receive the second message while the first client is still processing the first message.</span></span>

### <a name="queue-with-a-large-number-of-senders"></a><span data-ttu-id="73b1e-268">Coda con un numero elevato di mittenti</span><span class="sxs-lookup"><span data-stu-id="73b1e-268">Queue with a large number of senders</span></span>
<span data-ttu-id="73b1e-269">Obiettivo: aumentare la velocità effettiva di una coda o di un argomento con un numero elevato di mittenti.</span><span class="sxs-lookup"><span data-stu-id="73b1e-269">Goal: Maximize throughput of a queue or topic with a large number of senders.</span></span> <span data-ttu-id="73b1e-270">Ogni mittente invia messaggi con una velocità moderata.</span><span class="sxs-lookup"><span data-stu-id="73b1e-270">Each sender sends messages with a moderate rate.</span></span> <span data-ttu-id="73b1e-271">Il numero di ricevitori è limitato.</span><span class="sxs-lookup"><span data-stu-id="73b1e-271">The number of receivers is small.</span></span>

<span data-ttu-id="73b1e-272">Il bus di servizio consente un massimo di 1000 connessioni simultanee a un'entità di messaggistica (o 5000 con AMQP).</span><span class="sxs-lookup"><span data-stu-id="73b1e-272">Service Bus enables up to 1000 concurrent connections to a messaging entity (or 5000 using AMQP).</span></span> <span data-ttu-id="73b1e-273">Questo limite viene applicato a livello di spazio dei nomi e le code, le sottoscrizioni o gli argomenti sono limitati in base al numero massimo di connessioni simultanee per spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="73b1e-273">This limit is enforced at the namespace level, and queues/topics/subscriptions are capped by the limit of concurrent connections per namespace.</span></span> <span data-ttu-id="73b1e-274">Per le code, questo numero è condiviso tra mittenti e ricevitori.</span><span class="sxs-lookup"><span data-stu-id="73b1e-274">For queues, this number is shared between senders and receivers.</span></span> <span data-ttu-id="73b1e-275">Se sono necessarie tutte e 1000 le connessioni per i mittenti, è consigliabile sostituire la coda con un argomento e una singola sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="73b1e-275">If all 1000 connections are required for senders, you should replace the queue with a topic and a single subscription.</span></span> <span data-ttu-id="73b1e-276">Un argomento accetta fino a 1000 connessioni simultanee dai mittenti, mentre la sottoscrizione accetta altre 1000 connessioni simultanee dai ricevitori.</span><span class="sxs-lookup"><span data-stu-id="73b1e-276">A topic accepts up to 1000 concurrent connections from senders, whereas the subscription accepts an additional 1000 concurrent connections from receivers.</span></span> <span data-ttu-id="73b1e-277">Se sono necessari più di 1000 mittenti simultanei, i mittenti devono inviare i messaggi al protocollo del bus di servizio tramite HTTP.</span><span class="sxs-lookup"><span data-stu-id="73b1e-277">If more than 1000 concurrent senders are required, the senders should send messages to the Service Bus protocol via HTTP.</span></span>

<span data-ttu-id="73b1e-278">Per ottimizzare la velocità effettiva, eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="73b1e-278">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="73b1e-279">Usare una coda partizionata per migliorare prestazioni e disponibilità.</span><span class="sxs-lookup"><span data-stu-id="73b1e-279">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="73b1e-280">Se ogni mittente si trova in un processo diverso, usare solo una singola factory per processo.</span><span class="sxs-lookup"><span data-stu-id="73b1e-280">If each sender resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="73b1e-281">Usare operazioni asincrone per sfruttare i vantaggi dell'invio in batch sul lato client.</span><span class="sxs-lookup"><span data-stu-id="73b1e-281">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="73b1e-282">Usare l'intervallo di invio in batch predefinito di 20 ms per ridurre il numero di trasmissioni tramite il protocollo client del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-282">Use the default batching interval of 20ms to reduce the number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="73b1e-283">Lasciare abilitato l'accesso in batch all'archivio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-283">Leave batched store access enabled.</span></span> <span data-ttu-id="73b1e-284">In questo modo si aumenta la velocità complessiva per la scrittura dei messaggi nella coda o nell'argomento.</span><span class="sxs-lookup"><span data-stu-id="73b1e-284">This increases the overall rate at which messages can be written into the queue or topic.</span></span>
* <span data-ttu-id="73b1e-285">Impostare il conteggio prelettura su un valore pari a 20 volte la velocità di elaborazione massima di tutti i ricevitori di una factory.</span><span class="sxs-lookup"><span data-stu-id="73b1e-285">Set the prefetch count to 20 times the maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="73b1e-286">Questo valore riduce il numero di trasmissioni tramite il protocollo client del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-286">This reduces the number of Service Bus client protocol transmissions.</span></span>

### <a name="queue-with-a-large-number-of-receivers"></a><span data-ttu-id="73b1e-287">Coda con un numero elevato di ricevitori</span><span class="sxs-lookup"><span data-stu-id="73b1e-287">Queue with a large number of receivers</span></span>
<span data-ttu-id="73b1e-288">Obiettivo: aumentare la velocità di ricezione di una coda o di una sottoscrizione con un numero elevato di ricevitori.</span><span class="sxs-lookup"><span data-stu-id="73b1e-288">Goal: Maximize the receive rate of a queue or subscription with a large number of receivers.</span></span> <span data-ttu-id="73b1e-289">Ogni ricevitore riceve messaggi a una velocità moderata.</span><span class="sxs-lookup"><span data-stu-id="73b1e-289">Each receiver receives messages at a moderate rate.</span></span> <span data-ttu-id="73b1e-290">Il numero di mittenti è limitato.</span><span class="sxs-lookup"><span data-stu-id="73b1e-290">The number of senders is small.</span></span>

<span data-ttu-id="73b1e-291">Il bus di servizio consente un massimo di 1000 connessioni simultanee a un'entità.</span><span class="sxs-lookup"><span data-stu-id="73b1e-291">Service Bus enables up to 1000 concurrent connections to an entity.</span></span> <span data-ttu-id="73b1e-292">Se una coda richiede più di 1000 ricevitori, è consigliabile sostituirla con un argomento e più sottoscrizioni.</span><span class="sxs-lookup"><span data-stu-id="73b1e-292">If a queue requires more than 1000 receivers, you should replace the queue with a topic and multiple subscriptions.</span></span> <span data-ttu-id="73b1e-293">Ogni sottoscrizione può supportare fino a 1000 connessioni simultanee.</span><span class="sxs-lookup"><span data-stu-id="73b1e-293">Each subscription can support up to 1000 concurrent connections.</span></span> <span data-ttu-id="73b1e-294">In alternativa, i ricevitori possono accedere alla coda tramite il protocollo HTTP.</span><span class="sxs-lookup"><span data-stu-id="73b1e-294">Alternatively, receivers can access the queue via the HTTP protocol.</span></span>

<span data-ttu-id="73b1e-295">Per ottimizzare la velocità effettiva, eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="73b1e-295">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="73b1e-296">Usare una coda partizionata per migliorare prestazioni e disponibilità.</span><span class="sxs-lookup"><span data-stu-id="73b1e-296">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="73b1e-297">Se ogni ricevitore si trova in un processo diverso, usare solo una singola factory per processo.</span><span class="sxs-lookup"><span data-stu-id="73b1e-297">If each receiver resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="73b1e-298">I ricevitori possono usare operazioni sincrone o asincrone.</span><span class="sxs-lookup"><span data-stu-id="73b1e-298">Receivers can use synchronous or asynchronous operations.</span></span> <span data-ttu-id="73b1e-299">Considerata la velocità di ricezione moderata di un singolo ricevitore, l'invio in batch sul lato client di una richiesta Complete non influisce sulla velocità effettiva del ricevitore.</span><span class="sxs-lookup"><span data-stu-id="73b1e-299">Given the moderate receive rate of an individual receiver, client-side batching of a Complete request does not affect receiver throughput.</span></span>
* <span data-ttu-id="73b1e-300">Lasciare abilitato l'accesso in batch all'archivio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-300">Leave batched store access enabled.</span></span> <span data-ttu-id="73b1e-301">In questo modo si riduce il carico complessivo dell'entità.</span><span class="sxs-lookup"><span data-stu-id="73b1e-301">This reduces the overall load of the entity.</span></span> <span data-ttu-id="73b1e-302">Si riduce anche la velocità globale per la scrittura dei messaggi nella coda o nell'argomento.</span><span class="sxs-lookup"><span data-stu-id="73b1e-302">It also reduces the overall rate at which messages can be written into the queue or topic.</span></span>
* <span data-ttu-id="73b1e-303">Impostare il conteggio prelettura su un valore ridotto, ad esempio PrefetchCount = 10.</span><span class="sxs-lookup"><span data-stu-id="73b1e-303">Set the prefetch count to a small value (for example, PrefetchCount = 10).</span></span> <span data-ttu-id="73b1e-304">In questo modo si evita che i ricevitori rimangano inattivi mentre per altri è presente un numero elevato di messaggi memorizzati nella cache.</span><span class="sxs-lookup"><span data-stu-id="73b1e-304">This prevents receivers from being idle while other receivers have large numbers of messages cached.</span></span>

### <a name="topic-with-a-small-number-of-subscriptions"></a><span data-ttu-id="73b1e-305">Argomento con un numero limitato di sottoscrizioni</span><span class="sxs-lookup"><span data-stu-id="73b1e-305">Topic with a small number of subscriptions</span></span>
<span data-ttu-id="73b1e-306">Obiettivo: aumentare la velocità effettiva di un argomento con un numero limitato di sottoscrizioni.</span><span class="sxs-lookup"><span data-stu-id="73b1e-306">Goal: Maximize the throughput of a topic with a small number of subscriptions.</span></span> <span data-ttu-id="73b1e-307">Poiché un messaggio viene ricevuto da molte sottoscrizioni, la velocità di ricezione combinata su tutte le sottoscrizioni è superiore alla velocità di invio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-307">A message is received by many subscriptions, which means the combined receive rate over all subscriptions is larger than the send rate.</span></span> <span data-ttu-id="73b1e-308">Il numero di mittenti è limitato.</span><span class="sxs-lookup"><span data-stu-id="73b1e-308">The number of senders is small.</span></span> <span data-ttu-id="73b1e-309">Il numero di ricevitori per sottoscrizione è limitato.</span><span class="sxs-lookup"><span data-stu-id="73b1e-309">The number of receivers per subscription is small.</span></span>

<span data-ttu-id="73b1e-310">Per ottimizzare la velocità effettiva, eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="73b1e-310">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="73b1e-311">Usare un argomento partizionato per migliorare prestazioni e disponibilità.</span><span class="sxs-lookup"><span data-stu-id="73b1e-311">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="73b1e-312">Per aumentare la velocità di invio globale nell'argomento, usare più factory di messaggistica per la creazione di mittenti.</span><span class="sxs-lookup"><span data-stu-id="73b1e-312">To increase the overall send rate into the topic, use multiple message factories to create senders.</span></span> <span data-ttu-id="73b1e-313">Per ogni mittente usare operazioni asincrone o più thread.</span><span class="sxs-lookup"><span data-stu-id="73b1e-313">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="73b1e-314">Per aumentare la velocità di ricezione globale di una sottoscrizione, usare più factory di messaggistica per la creazione di ricevitori.</span><span class="sxs-lookup"><span data-stu-id="73b1e-314">To increase the overall receive rate from a subscription, use multiple message factories to create receivers.</span></span> <span data-ttu-id="73b1e-315">Per ogni ricevitore usare operazioni asincrone o più thread.</span><span class="sxs-lookup"><span data-stu-id="73b1e-315">For each receiver, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="73b1e-316">Usare operazioni asincrone per sfruttare i vantaggi dell'invio in batch sul lato client.</span><span class="sxs-lookup"><span data-stu-id="73b1e-316">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="73b1e-317">Usare l'intervallo di invio in batch predefinito di 20 ms per ridurre il numero di trasmissioni tramite il protocollo client del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-317">Use the default batching interval of 20ms to reduce the number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="73b1e-318">Lasciare abilitato l'accesso in batch all'archivio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-318">Leave batched store access enabled.</span></span> <span data-ttu-id="73b1e-319">In questo modo si aumenta la velocità globale per la scrittura dei messaggi nell'argomento.</span><span class="sxs-lookup"><span data-stu-id="73b1e-319">This increases the overall rate at which messages can be written into the topic.</span></span>
* <span data-ttu-id="73b1e-320">Impostare il conteggio prelettura su un valore pari a 20 volte la velocità di elaborazione massima di tutti i ricevitori di una factory.</span><span class="sxs-lookup"><span data-stu-id="73b1e-320">Set the prefetch count to 20 times the maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="73b1e-321">Questo valore riduce il numero di trasmissioni tramite il protocollo client del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-321">This reduces the number of Service Bus client protocol transmissions.</span></span>

### <a name="topic-with-a-large-number-of-subscriptions"></a><span data-ttu-id="73b1e-322">Argomento con un numero elevato di sottoscrizioni</span><span class="sxs-lookup"><span data-stu-id="73b1e-322">Topic with a large number of subscriptions</span></span>
<span data-ttu-id="73b1e-323">Obiettivo: aumentare la velocità effettiva di un argomento con un numero elevato di sottoscrizioni.</span><span class="sxs-lookup"><span data-stu-id="73b1e-323">Goal: Maximize the throughput of a topic with a large number of subscriptions.</span></span> <span data-ttu-id="73b1e-324">Poiché un messaggio viene ricevuto da molte sottoscrizioni, la velocità di ricezione combinata su tutte le sottoscrizioni è superiore rispetto alla velocità di invio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-324">A message is received by many subscriptions, which means the combined receive rate over all subscriptions is much larger than the send rate.</span></span> <span data-ttu-id="73b1e-325">Il numero di mittenti è limitato.</span><span class="sxs-lookup"><span data-stu-id="73b1e-325">The number of senders is small.</span></span> <span data-ttu-id="73b1e-326">Il numero di ricevitori per sottoscrizione è limitato.</span><span class="sxs-lookup"><span data-stu-id="73b1e-326">The number of receivers per subscription is small.</span></span>

<span data-ttu-id="73b1e-327">Gli argomenti con un numero elevato di sottoscrizioni in genere espongono una velocità effettiva globale ridotta se tutti i messaggi vengono instradati a tutte le sottoscrizioni.</span><span class="sxs-lookup"><span data-stu-id="73b1e-327">Topics with a large number of subscriptions typically expose a low overall throughput if all messages are routed to all subscriptions.</span></span> <span data-ttu-id="73b1e-328">Questo dipende dal fatto che ogni messaggio viene ricevuto più volte e che tutti i messaggi contenuti in un argomento e tutte le relative sottoscrizioni vengono salvati nello stesso archivio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-328">This is caused by the fact that each message is received many times, and all messages that are contained in a topic and all its subscriptions are stored in the same store.</span></span> <span data-ttu-id="73b1e-329">Si presuppone che il numero di mittenti e il numero di ricevitori per sottoscrizione sia ridotto.</span><span class="sxs-lookup"><span data-stu-id="73b1e-329">It is assumed that the number of senders and number of receivers per subscription is small.</span></span> <span data-ttu-id="73b1e-330">Il bus di servizio supporta fino a 2.000 sottoscrizioni per argomento.</span><span class="sxs-lookup"><span data-stu-id="73b1e-330">Service Bus supports up to 2,000 subscriptions per topic.</span></span>

<span data-ttu-id="73b1e-331">Per ottimizzare la velocità effettiva, eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="73b1e-331">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="73b1e-332">Usare un argomento partizionato per migliorare prestazioni e disponibilità.</span><span class="sxs-lookup"><span data-stu-id="73b1e-332">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="73b1e-333">Usare operazioni asincrone per sfruttare i vantaggi dell'invio in batch sul lato client.</span><span class="sxs-lookup"><span data-stu-id="73b1e-333">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="73b1e-334">Usare l'intervallo di invio in batch predefinito di 20 ms per ridurre il numero di trasmissioni tramite il protocollo client del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-334">Use the default batching interval of 20ms to reduce the number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="73b1e-335">Lasciare abilitato l'accesso in batch all'archivio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-335">Leave batched store access enabled.</span></span> <span data-ttu-id="73b1e-336">In questo modo si aumenta la velocità globale per la scrittura dei messaggi nell'argomento.</span><span class="sxs-lookup"><span data-stu-id="73b1e-336">This increases the overall rate at which messages can be written into the topic.</span></span>
* <span data-ttu-id="73b1e-337">Impostare il conteggio prelettura su un valore pari a 20 volte la velocità di ricezione prevista in secondi.</span><span class="sxs-lookup"><span data-stu-id="73b1e-337">Set the prefetch count to 20 times the expected receive rate in seconds.</span></span> <span data-ttu-id="73b1e-338">Questo valore riduce il numero di trasmissioni tramite il protocollo client del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="73b1e-338">This reduces the number of Service Bus client protocol transmissions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="73b1e-339">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="73b1e-339">Next steps</span></span>
<span data-ttu-id="73b1e-340">Per altre informazioni sull'ottimizzazione delle prestazioni del bus di servizio, vedere le [entità di messaggistica partizionate][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="73b1e-340">To learn more about optimizing Service Bus performance, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[MessageSender]: /dotnet/api/microsoft.servicebus.messaging.messagesender
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[PeekLock]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[ReceiveAndDelete]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[BatchFlushInterval]: /dotnet/api/microsoft.servicebus.messaging.netmessagingtransportsettings.batchflushinterval#Microsoft_ServiceBus_Messaging_NetMessagingTransportSettings_BatchFlushInterval
[EnableBatchedOperations]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablebatchedoperations#Microsoft_ServiceBus_Messaging_QueueDescription_EnableBatchedOperations
[QueueClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.queueclient.prefetchcount#Microsoft_ServiceBus_Messaging_QueueClient_PrefetchCount
[SubscriptionClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.subscriptionclient.prefetchcount#Microsoft_ServiceBus_Messaging_SubscriptionClient_PrefetchCount
[ForcePersistence]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence#Microsoft_ServiceBus_Messaging_BrokeredMessage_ForcePersistence
[EnablePartitioning]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablepartitioning#Microsoft_ServiceBus_Messaging_QueueDescription_EnablePartitioning
[Partitioned messaging entities]: service-bus-partitioning.md
<span data-ttu-id="73b1e-341">[TopicDescription.EnableFilteringMessagesBeforePublishing]: /dotnet/api/microsoft.servicebus.messaging.topicdescription.enablefilteringmessagesbeforepublishing#Microsoft_ServiceBus_Messaging_TopicDescription_EnableFilteringMessagesBeforePublishing</span><span class="sxs-lookup"><span data-stu-id="73b1e-341">[TopicDescription.EnableFilteringMessagesBeforePublishing]: /dotnet/api/microsoft.servicebus.messaging.topicdescription.enablefilteringmessagesbeforepublishing#Microsoft_ServiceBus_Messaging_TopicDescription_EnableFilteringMessagesBeforePublishing</span></span>
