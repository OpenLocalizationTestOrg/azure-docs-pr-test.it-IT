---
title: Spazi dei nomi abbinati del bus di servizio di Azure | Documentazione Microsoft
description: Dettagli di implementazione e costi relativi allo spazio dei nomi associato
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 2440c8d3-ed2e-47e0-93cf-ab7fbb855d2e
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/25/2017
ms.author: sethm
ms.openlocfilehash: a200ea7937b9f5296c743928a9408897adfba428
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="paired-namespace-implementation-details-and-cost-implications"></a><span data-ttu-id="b1bcb-103">Dettagli di implementazione e implicazioni in termini di costi relativi allo spazio dei nomi associato</span><span class="sxs-lookup"><span data-stu-id="b1bcb-103">Paired namespace implementation details and cost implications</span></span>
<span data-ttu-id="b1bcb-104">Il metodo [PairNamespaceAsync][PairNamespaceAsync], mediante un'istanza di [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions], esegue attività visibili per conto dell'utente.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-104">The [PairNamespaceAsync][PairNamespaceAsync] method, using a [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance, performs visible tasks on your behalf.</span></span> <span data-ttu-id="b1bcb-105">Poiché l'uso di questa funzionalità comporta considerazioni in termini di costi, è utile comprendere le attività eseguite in modo da prevederne il comportamento.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-105">Because there are cost considerations when using the feature, it is useful to understand those tasks so that you expect the behavior when it happens.</span></span> <span data-ttu-id="b1bcb-106">L'API attiva automaticamente il comportamento seguente per conto dell'utente:</span><span class="sxs-lookup"><span data-stu-id="b1bcb-106">The API engages the following automatic behavior on your behalf:</span></span>

* <span data-ttu-id="b1bcb-107">Creazione di code di backlog.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-107">Creation of backlog queues.</span></span>
* <span data-ttu-id="b1bcb-108">Creazione di un oggetto [MessageSender][MessageSender] che comunica con code o argomenti.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-108">Creation of a [MessageSender][MessageSender] object that talks to queues or topics.</span></span>
* <span data-ttu-id="b1bcb-109">Invio di messaggi ping a un'entità di messaggistica che diventa non disponibile, nel tentativo di rilevare il momento in cui questa diventa nuovamente disponibile.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-109">When a messaging entity becomes unavailable, sends ping messages to the entity in an attempt to detect when that entity becomes available again.</span></span>
* <span data-ttu-id="b1bcb-110">Creazione facoltativa di un set di message pump che spostano i messaggi dalle code di backlog a quelle primarie.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-110">Optionally creates of a set of “message pumps” that move messages from the backlog queues to the primary queues.</span></span>
* <span data-ttu-id="b1bcb-111">Coordinamento di eventi di chiusura o errore delle istanze di [MessagingFactory][MessagingFactory] primarie e secondarie.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-111">Coordinates closing/faulting of the primary and secondary [MessagingFactory][MessagingFactory] instances.</span></span>

<span data-ttu-id="b1bcb-112">A livello generale, la funzionalità opera in questo modo: quando l'entità primaria è integra, non si verificano modifiche del comportamento.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-112">At a high level, the feature works as follows: when the primary entity is healthy, no behavior changes occur.</span></span> <span data-ttu-id="b1bcb-113">Quando la durata di [FailoverInterval][FailoverInterval] scade e l'entità primaria non rileva invii riusciti dopo un'eccezione di tipo [MessagingException][MessagingException] o [TimeoutException][TimeoutException] non temporanea, si verifica quanto segue:</span><span class="sxs-lookup"><span data-stu-id="b1bcb-113">When the [FailoverInterval][FailoverInterval] duration elapses, and the primary entity sees no successful sends after a non-transient [MessagingException][MessagingException] or a [TimeoutException][TimeoutException], the following behavior occurs:</span></span>

1. <span data-ttu-id="b1bcb-114">Le operazioni di invio all'entità primaria vengono disabilitate e il sistema effettua il ping dell'entità primaria finché i ping non vengono recapitati correttamente.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-114">Send operations to the primary entity are disabled and the system pings the primary entity until pings can be successfully delivered.</span></span>
2. <span data-ttu-id="b1bcb-115">Viene selezionata una coda di backlog casuale.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-115">A random backlog queue is selected.</span></span>
3. <span data-ttu-id="b1bcb-116">Gli oggetti [BrokeredMessage][BrokeredMessage] vengono instradati alla coda di backlog scelta.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-116">[BrokeredMessage][BrokeredMessage] objects are routed to the chosen backlog queue.</span></span>
4. <span data-ttu-id="b1bcb-117">Se un'operazione di invio alla coda di backlog scelta non riesce, la coda viene estratta dalla rotazione e viene selezionata una nuova coda.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-117">If a send operation to the chosen backlog queue fails, that queue is pulled from the rotation and a new queue is selected.</span></span> <span data-ttu-id="b1bcb-118">L'errore viene comunicato a tutti i mittenti nell'istanza di [MessagingFactory][MessagingFactory].</span><span class="sxs-lookup"><span data-stu-id="b1bcb-118">All senders on the [MessagingFactory][MessagingFactory] instance learn of the failure.</span></span>

<span data-ttu-id="b1bcb-119">Le figure seguenti illustrano la sequenza.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-119">The following figures depict the sequence.</span></span> <span data-ttu-id="b1bcb-120">Prima di tutto il mittente invia i messaggi.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-120">First, the sender sends messages.</span></span>

![Spazi dei nomi associati][0]

<span data-ttu-id="b1bcb-122">Dal momento in cui si verifica l'errore di invio alla coda primaria, il mittente inizia a inviare i messaggi a una coda di backlog scelta casualmente.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-122">Upon failure to send to the primary queue, the sender begins sending messages to a randomly chosen backlog queue.</span></span> <span data-ttu-id="b1bcb-123">Contemporaneamente avvia un'attività di ping.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-123">Simultaneously, it starts a ping task.</span></span>

![Spazi dei nomi associati][1]

<span data-ttu-id="b1bcb-125">A questo punto i messaggi si trovano ancora nella coda secondaria e non sono stati recapitati a quella primaria.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-125">At this point the messages are still in the secondary queue and have not been delivered to the primary queue.</span></span> <span data-ttu-id="b1bcb-126">Quando la coda primaria sarà di nuovo integra, è necessario che il sifone venga eseguito da almeno un processo.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-126">Once the primary queue is healthy again, at least one process should be running the syphon.</span></span> <span data-ttu-id="b1bcb-127">Il sifone recapita i messaggi dalle varie code di backlog alle entità di destinazione appropriate, ad esempio code e argomenti.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-127">The syphon delivers the messages from all the various backlog queues to the proper destination entities (queues and topics).</span></span>

![Spazi dei nomi associati][2]

<span data-ttu-id="b1bcb-129">Nelle sezioni successive di questo argomento verranno illustrati i dettagli specifici del funzionamento di questi componenti.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-129">The remainder of this topic discusses the specific details of how these pieces work.</span></span>

## <a name="creation-of-backlog-queues"></a><span data-ttu-id="b1bcb-130">Creazione di code di backlog</span><span class="sxs-lookup"><span data-stu-id="b1bcb-130">Creation of backlog queues</span></span>
<span data-ttu-id="b1bcb-131">L'oggetto [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] passato al metodo [PairNamespaceAsync][PairNamespaceAsync] indica il numero di code di backlog da usare.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-131">The [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] object passed to the [PairNamespaceAsync][PairNamespaceAsync] method indicates the number of backlog queues you want to use.</span></span> <span data-ttu-id="b1bcb-132">Ogni coda di backlog viene quindi creata con le proprietà seguenti impostate in modo esplicito. Tutti gli altri valori vengono impostati in base all'oggetto [QueueDescription predefinito][QueueDescription]:</span><span class="sxs-lookup"><span data-stu-id="b1bcb-132">Each backlog queue is then created with the following properties explicitly set (all other values are set to the [QueueDescription][QueueDescription] defaults):</span></span>

| <span data-ttu-id="b1bcb-133">Path</span><span class="sxs-lookup"><span data-stu-id="b1bcb-133">Path</span></span> | <span data-ttu-id="b1bcb-134">[spazio dei nomi primario]/x-servicebus-transfer/[indice] dove [indice] è un valore espresso in [0, BacklogQueueCount]</span><span class="sxs-lookup"><span data-stu-id="b1bcb-134">[primary namespace]/x-servicebus-transfer/[index] where [index] is a value in [0, BacklogQueueCount)</span></span> |
| --- | --- |
| <span data-ttu-id="b1bcb-135">MaxSizeInMegabytes</span><span class="sxs-lookup"><span data-stu-id="b1bcb-135">MaxSizeInMegabytes</span></span> |<span data-ttu-id="b1bcb-136">5120</span><span class="sxs-lookup"><span data-stu-id="b1bcb-136">5120</span></span> |
| <span data-ttu-id="b1bcb-137">MaxDeliveryCount</span><span class="sxs-lookup"><span data-stu-id="b1bcb-137">MaxDeliveryCount</span></span> |<span data-ttu-id="b1bcb-138">int.MaxValue</span><span class="sxs-lookup"><span data-stu-id="b1bcb-138">int.MaxValue</span></span> |
| <span data-ttu-id="b1bcb-139">DefaultMessageTimeToLive</span><span class="sxs-lookup"><span data-stu-id="b1bcb-139">DefaultMessageTimeToLive</span></span> |<span data-ttu-id="b1bcb-140">TimeSpan.MaxValue</span><span class="sxs-lookup"><span data-stu-id="b1bcb-140">TimeSpan.MaxValue</span></span> |
| <span data-ttu-id="b1bcb-141">AutoDeleteOnIdle</span><span class="sxs-lookup"><span data-stu-id="b1bcb-141">AutoDeleteOnIdle</span></span> |<span data-ttu-id="b1bcb-142">TimeSpan.MaxValue</span><span class="sxs-lookup"><span data-stu-id="b1bcb-142">TimeSpan.MaxValue</span></span> |
| <span data-ttu-id="b1bcb-143">LockDuration</span><span class="sxs-lookup"><span data-stu-id="b1bcb-143">LockDuration</span></span> |<span data-ttu-id="b1bcb-144">1 minuto</span><span class="sxs-lookup"><span data-stu-id="b1bcb-144">1 minute</span></span> |
| <span data-ttu-id="b1bcb-145">EnableDeadLetteringOnMessageExpiration</span><span class="sxs-lookup"><span data-stu-id="b1bcb-145">EnableDeadLetteringOnMessageExpiration</span></span> |<span data-ttu-id="b1bcb-146">true</span><span class="sxs-lookup"><span data-stu-id="b1bcb-146">true</span></span> |
| <span data-ttu-id="b1bcb-147">EnableBatchedOperations</span><span class="sxs-lookup"><span data-stu-id="b1bcb-147">EnableBatchedOperations</span></span> |<span data-ttu-id="b1bcb-148">true</span><span class="sxs-lookup"><span data-stu-id="b1bcb-148">true</span></span> |

<span data-ttu-id="b1bcb-149">Ad esempio, la prima coda di backlog creata per lo spazio dei nomi **contoso** è denominata `contoso/x-servicebus-transfer/0`.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-149">For example, the first backlog queue created for namespace **contoso** is named `contoso/x-servicebus-transfer/0`.</span></span>

<span data-ttu-id="b1bcb-150">Quando si creano le code, il codice verifica prima di tutto se una coda esiste.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-150">When creating the queues, the code first checks to see if such a queue exists.</span></span> <span data-ttu-id="b1bcb-151">In caso contrario, la coda viene creata.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-151">If the queue does not exist, then the queue is created.</span></span> <span data-ttu-id="b1bcb-152">Il codice non esegue la pulizia di code di backlog "aggiuntive".</span><span class="sxs-lookup"><span data-stu-id="b1bcb-152">The code does not clean up "extra" backlog queues.</span></span> <span data-ttu-id="b1bcb-153">In particolare, se per l'applicazione con lo spazio dei nomi primario **contoso** sono necessarie cinque code di backlog, ma esiste già una coda con percorso `contoso/x-servicebus-transfer/7`, la coda aggiuntiva risulta presente, ma non viene usata.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-153">Specifically, if the application with the primary namespace **contoso** requests five backlog queues but a backlog queue with the path `contoso/x-servicebus-transfer/7` exists, that extra backlog queue is still present but is not used.</span></span> <span data-ttu-id="b1bcb-154">Il sistema consente in modo esplicito la presenza di code di backlog aggiuntive che tuttavia non vengono usate.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-154">The system explicitly allows extra backlog queues to exist that would not be used.</span></span> <span data-ttu-id="b1bcb-155">Come proprietario dello spazio dei nomi, l'utente è responsabile della pulizia di eventuali code di backlog inutilizzate o indesiderate.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-155">As the namespace owner, you are responsible for cleaning up any unused/unwanted backlog queues.</span></span> <span data-ttu-id="b1bcb-156">Questa decisione è dovuta al fatto che il bus di servizio non è in grado di riconoscere lo scopo dell'esistenza di tutte le code nello spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-156">The reason for this decision is that Service Bus cannot know what purposes exist for all the queues in your namespace.</span></span> <span data-ttu-id="b1bcb-157">Se esiste già anche una coda con il nome specificato, ma non soddisfa quanto definito in precedenza per l'oggetto [QueueDescription][QueueDescription], la modifica del comportamento predefinito dipende esclusivamente dai motivi definiti dall'utente.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-157">Furthermore, if a queue exists with the given name but does not meet the assumed [QueueDescription][QueueDescription], then your reasons are your own for changing the default behavior.</span></span> <span data-ttu-id="b1bcb-158">Non vengono fornite garanzie riguardo alle modifiche apportate alle code di backlog dal codice dell'utente.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-158">No guarantees are made for modifications to the backlog queues by your code.</span></span> <span data-ttu-id="b1bcb-159">Verificare quindi con attenzione le modifiche apportate.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-159">Make sure to test your changes thoroughly.</span></span>

## <a name="custom-messagesender"></a><span data-ttu-id="b1bcb-160">MessageSender personalizzato</span><span class="sxs-lookup"><span data-stu-id="b1bcb-160">Custom MessageSender</span></span>
<span data-ttu-id="b1bcb-161">Quando vengono inviati, tutti i messaggi passano attraverso un oggetto [MessageSender][MessageSender] interno, che ha un comportamento normale quando tutto funziona correttamente, ma che esegue il reindirizzamento alle code di backlog in caso di errori.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-161">When sending, all messages go through an internal [MessageSender][MessageSender] object that behaves normally when everything works, and redirects to the backlog queues when things "break."</span></span> <span data-ttu-id="b1bcb-162">Se viene rilevato un errore non temporaneo, viene avviato un timer.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-162">Upon receiving a non-transient failure, a timer starts.</span></span> <span data-ttu-id="b1bcb-163">Dopo un periodo definito in [TimeSpan][TimeSpan] corrispondente al valore della proprietà [FailoverInterval][FailoverInterval], durante il quale non viene eseguito l'invio di messaggi, viene avviata la procedura di failover.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-163">After a [TimeSpan][TimeSpan] period consisting of the [FailoverInterval][FailoverInterval] property value during which no successful messages are sent, the failover is engaged.</span></span> <span data-ttu-id="b1bcb-164">A questo punto, per ogni entità si verifica quanto segue:</span><span class="sxs-lookup"><span data-stu-id="b1bcb-164">At this point, the following things happen for each entity:</span></span>

* <span data-ttu-id="b1bcb-165">Viene eseguita un'attività ping per ogni [PingPrimaryInterval][PingPrimaryInterval], per verificare se l'entità è disponibile.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-165">A ping task executes every [PingPrimaryInterval][PingPrimaryInterval] to check if the entity is available.</span></span> <span data-ttu-id="b1bcb-166">Se questa attività riesce, tutto il codice client che usa l'entità inizia immediatamente a inviare nuovi messaggi allo spazio dei nomi primario.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-166">Once this task succeeds, all client code that uses the entity immediately starts sending new messages to the primary namespace.</span></span>
* <span data-ttu-id="b1bcb-167">Le richieste successive di invio alla stessa entità da qualsiasi altro mittente avranno come risultato l'invio di un oggetto [BrokeredMessage][BrokeredMessage] che dovrà essere modificato per entrare nella coda di backlog.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-167">Future requests to send to that same entity from any other senders will result in the [BrokeredMessage][BrokeredMessage] being sent to be modified to sit in the backlog queue.</span></span> <span data-ttu-id="b1bcb-168">La modifica comporta la rimozione di alcune proprietà dall'oggetto [BrokeredMessage][BrokeredMessage] e la relativa archiviazione in un'altra area.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-168">The modification removes some properties from the [BrokeredMessage][BrokeredMessage] object and stores them elsewhere.</span></span> <span data-ttu-id="b1bcb-169">Le proprietà seguenti vengono eliminate e aggiunte con un nuovo alias, per consentire al bus di servizio e all'SDK di elaborare i messaggi in modo uniforme:</span><span class="sxs-lookup"><span data-stu-id="b1bcb-169">The following properties are cleared and added under a new alias, allowing Service Bus and the SDK to process messages uniformly:</span></span>

| <span data-ttu-id="b1bcb-170">Nome proprietà precedente</span><span class="sxs-lookup"><span data-stu-id="b1bcb-170">Old Property Name</span></span> | <span data-ttu-id="b1bcb-171">Nuovo nome proprietà</span><span class="sxs-lookup"><span data-stu-id="b1bcb-171">New Property Name</span></span> |
| --- | --- |
| <span data-ttu-id="b1bcb-172">SessionId</span><span class="sxs-lookup"><span data-stu-id="b1bcb-172">SessionId</span></span> |<span data-ttu-id="b1bcb-173">x-ms-sessionid</span><span class="sxs-lookup"><span data-stu-id="b1bcb-173">x-ms-sessionid</span></span> |
| <span data-ttu-id="b1bcb-174">TimeToLive</span><span class="sxs-lookup"><span data-stu-id="b1bcb-174">TimeToLive</span></span> |<span data-ttu-id="b1bcb-175">x-ms-timetolive</span><span class="sxs-lookup"><span data-stu-id="b1bcb-175">x-ms-timetolive</span></span> |
| <span data-ttu-id="b1bcb-176">ScheduledEnqueueTimeUtc</span><span class="sxs-lookup"><span data-stu-id="b1bcb-176">ScheduledEnqueueTimeUtc</span></span> |<span data-ttu-id="b1bcb-177">x-ms-path</span><span class="sxs-lookup"><span data-stu-id="b1bcb-177">x-ms-path</span></span> |

<span data-ttu-id="b1bcb-178">Il percorso di destinazione originale viene archiviato anche nel messaggio come proprietà x-ms-path.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-178">The original destination path is also stored within the message as a property named x-ms-path.</span></span> <span data-ttu-id="b1bcb-179">Questa progettazione consente la coesistenza in un'unica coda di backlog di messaggi appartenenti a più entità.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-179">This design allows messages for many entities to coexist in a single backlog queue.</span></span> <span data-ttu-id="b1bcb-180">Le proprietà vengono ritrasferite dal sifone.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-180">The properties are translated back by the syphon.</span></span>

<span data-ttu-id="b1bcb-181">Per l'oggetto [MessageSender][MessageSender] possono verificarsi problemi quando i messaggi raggiungono il limite di 256 KB e viene avviato il failover.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-181">The custom [MessageSender][MessageSender] object can encounter issues when messages approach the 256-KB limit and failover is engaged.</span></span> <span data-ttu-id="b1bcb-182">L'oggetto [MessageSender][MessageSender] personalizzato archivia nelle code di backlog i messaggi per tutte le code e tutti gli argomenti.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-182">The custom [MessageSender][MessageSender] object stores messages for all queues and topics together in the backlog queues.</span></span> <span data-ttu-id="b1bcb-183">Questo oggetto unisce i messaggi provenienti da numerose code primarie nelle code di backlog.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-183">This object mixes messages from many primaries together within the backlog queues.</span></span> <span data-ttu-id="b1bcb-184">Per gestire il bilanciamento del carico tra più client che non hanno relazioni tra loro, l'SDK sceglie casualmente una coda di backlog per ogni oggetto [QueueClient][QueueClient] o [TopicClient][TopicClient] creato nel codice.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-184">To handle load balancing among many clients that do not know each other, the SDK randomly picks one backlog queue for each [QueueClient][QueueClient] or [TopicClient][TopicClient] you create in code.</span></span>

## <a name="pings"></a><span data-ttu-id="b1bcb-185">Ping</span><span class="sxs-lookup"><span data-stu-id="b1bcb-185">Pings</span></span>
<span data-ttu-id="b1bcb-186">Un messaggio ping è un oggetto [BrokeredMessage][BrokeredMessage] vuoto con la proprietà [ContentType][ContentType] impostata su application/vnd.ms-servicebus-ping e un valore [TimeToLive][TimeToLive] di 1 secondo.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-186">A ping message is an empty [BrokeredMessage][BrokeredMessage] with its [ContentType][ContentType] property set to application/vnd.ms-servicebus-ping and a [TimeToLive][TimeToLive] value of 1 second.</span></span> <span data-ttu-id="b1bcb-187">Questo ping presenta una caratteristica particolare nel bus di servizio. Il server non recapita mai un ping quando un chiamante qualsiasi richiede un oggetto [BrokeredMessage][BrokeredMessage].</span><span class="sxs-lookup"><span data-stu-id="b1bcb-187">This ping has one special characteristic in Service Bus: the server never delivers a ping when any caller requests a [BrokeredMessage][BrokeredMessage].</span></span> <span data-ttu-id="b1bcb-188">Di conseguenza, non sarà mai necessario comprendere come ricevere e ignorare questi messaggi.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-188">Thus, you never have to learn how to receive and ignore these messages.</span></span> <span data-ttu-id="b1bcb-189">A ogni entità, argomento o coda univoca, per istanza di [MessagingFactory][MessagingFactory] e per client che risulta non disponibile viene inviato un ping.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-189">Each entity (unique queue or topic) per [MessagingFactory][MessagingFactory] instance per client will be pinged when they are considered to be unavailable.</span></span> <span data-ttu-id="b1bcb-190">Per impostazione predefinita, ciò accade una volta al minuto.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-190">By default, this happens once per minute.</span></span> <span data-ttu-id="b1bcb-191">I messaggi ping sono considerati come normali messaggi del bus di servizio e possono comportare l'addebito di costi in base alla larghezza di banda e al numero di messaggi.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-191">Ping messages are considered to be regular Service Bus messages, and can result in charges for bandwidth and messages.</span></span> <span data-ttu-id="b1bcb-192">Non appena i client rilevano che il sistema è disponibile, l'invio di messaggi viene arrestato.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-192">As soon as the clients detect that the system is available, the messages stop.</span></span>

## <a name="the-syphon"></a><span data-ttu-id="b1bcb-193">Sifone</span><span class="sxs-lookup"><span data-stu-id="b1bcb-193">The syphon</span></span>
<span data-ttu-id="b1bcb-194">Almeno un programma eseguibile nell'applicazione deve eseguire attivamente il sifone,</span><span class="sxs-lookup"><span data-stu-id="b1bcb-194">At least one executable program in the application should be actively running the syphon.</span></span> <span data-ttu-id="b1bcb-195">che avvia un'operazione di ricezione mediante polling prolungato della durata di 15 minuti.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-195">The syphon performs a long poll receive that lasts 15 minutes.</span></span> <span data-ttu-id="b1bcb-196">Quando tutte le entità sono disponibili e sono presenti dieci code di backlog, l'applicazione che ospita il sifone chiama l'operazione di ricezione 40 volte all'ora, 960 volte al giorno e 28800 volte in 30 giorni.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-196">When all entities are available and you have 10 backlog queues, the application that hosts the syphon calls the receive operation 40 times per hour, 960 times per day, and 28800 times in 30 days.</span></span> <span data-ttu-id="b1bcb-197">Quando il sifone sposta attivamente i messaggi dalla coda di backlog a quella primaria, per ciascun messaggio vengono applicati i costi riportati di seguito (costi standard relativi alle dimensioni del messaggio e all'impiego delle larghezza di banda nelle varie fasi):</span><span class="sxs-lookup"><span data-stu-id="b1bcb-197">When the syphon is actively moving messages from the backlog to the primary queue, each message experiences the following charges (standard charges for message size and bandwidth apply in all stages):</span></span>

1. <span data-ttu-id="b1bcb-198">Invio alla coda di backlog.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-198">Send to the backlog.</span></span>
2. <span data-ttu-id="b1bcb-199">Ricezione dalla coda di backlog.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-199">Receive from the backlog.</span></span>
3. <span data-ttu-id="b1bcb-200">Invio alla coda primaria.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-200">Send to the primary.</span></span>
4. <span data-ttu-id="b1bcb-201">Ricezione dalla coda primaria.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-201">Receive from the primary.</span></span>

## <a name="closefault-behavior"></a><span data-ttu-id="b1bcb-202">Comportamento di chiusura o errore</span><span class="sxs-lookup"><span data-stu-id="b1bcb-202">Close/fault behavior</span></span>
<span data-ttu-id="b1bcb-203">In un'applicazione che ospita il sifone, non appena l'oggetto [MessagingFactory][MessagingFactory] primario o secondario restituisce un errore o viene chiuso, senza che l'oggetto correlato restituisca un errore o venga chiuso, e non appena questo stato viene rilevato, il sifone si attiva automaticamente.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-203">Within an application that hosts the syphon, once the primary or secondary [MessagingFactory][MessagingFactory] faults or is closed without its partner also being faulted/closed and the syphon detects this state, the syphon acts.</span></span> <span data-ttu-id="b1bcb-204">Se l'oggetto [MessagingFactory][MessagingFactory] correlato al primo non viene chiuso entro 5 secondi, il sifone restituisce un errore per l'oggetto [MessagingFactory][MessagingFactory] ancora aperto.</span><span class="sxs-lookup"><span data-stu-id="b1bcb-204">If the other [MessagingFactory][MessagingFactory] is not closed within 5 seconds, the syphon will fault the still open [MessagingFactory][MessagingFactory].</span></span>

## <a name="next-steps"></a><span data-ttu-id="b1bcb-205">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="b1bcb-205">Next steps</span></span>
<span data-ttu-id="b1bcb-206">Per informazioni dettagliate sulla messaggistica asincrona del bus di servizio, vedere [Modelli di messaggistica asincrona e disponibilità elevata][Asynchronous messaging patterns and high availability].</span><span class="sxs-lookup"><span data-stu-id="b1bcb-206">See [Asynchronous messaging patterns and high availability][Asynchronous messaging patterns and high availability] for a detailed discussion of Service Bus asynchronous messaging.</span></span> 

[PairNamespaceAsync]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_PairNamespaceAsync_Microsoft_ServiceBus_Messaging_PairedNamespaceOptions_
[SendAvailabilityPairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions
[MessageSender]: /dotnet/api/microsoft.servicebus.messaging.messagesender
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[FailoverInterval]: /dotnet/api/microsoft.servicebus.messaging.pairednamespaceoptions#Microsoft_ServiceBus_Messaging_PairedNamespaceOptions_FailoverInterval
[MessagingException]: /dotnet/api/microsoft.servicebus.messaging.messagingexception
[TimeoutException]: https://msdn.microsoft.com/library/azure/system.timeoutexception.aspx
[BrokeredMessage]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage
[QueueDescription]: /dotnet/api/microsoft.servicebus.messaging.queuedescription
[TimeSpan]: https://msdn.microsoft.com/library/azure/system.timespan.aspx
[PingPrimaryInterval]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_PingPrimaryInterval
[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[TopicClient]: /dotnet/api/microsoft.servicebus.messaging.topicclient
[ContentType]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_ContentType
[TimeToLive]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive
[Asynchronous messaging patterns and high availability]: service-bus-async-messaging.md
[0]: ./media/service-bus-paired-namespaces/IC673405.png
[1]: ./media/service-bus-paired-namespaces/IC673406.png
[2]: ./media/service-bus-paired-namespaces/IC673407.png
