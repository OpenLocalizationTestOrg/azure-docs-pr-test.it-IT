---
title: backup di Azure HANA aaaSAP basato su snapshot di archiviazione | Documenti Microsoft
description: "Esistono due possibilità principali per il backup di SAP HANA su macchine virtuali di Azure e questo articolo descrive il backup di SAP HANA basato su snapshot di archiviazione"
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 32bb80f5a928a2cf63699bfe4f4cf5bbad81e6fe
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="sap-hana-backup-based-on-storage-snapshots"></a><span data-ttu-id="bb186-103">Backup di SAP HANA basato su snapshot di archiviazione</span><span class="sxs-lookup"><span data-stu-id="bb186-103">SAP HANA backup based on storage snapshots</span></span>

## <a name="introduction"></a><span data-ttu-id="bb186-104">Introduzione</span><span class="sxs-lookup"><span data-stu-id="bb186-104">Introduction</span></span>

<span data-ttu-id="bb186-105">Questo articolo fa parte di una serie di tre articoli correlati dedicati al backup di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="bb186-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="bb186-106">[Guida al backup per SAP HANA in macchine virtuali di Azure](sap-hana-backup-guide.md) fornisce una panoramica e informazioni sulle attività iniziali e [SAP HANA Azure Backup a livello di file](sap-hana-backup-file-level.md) copre hello opzione di backup basato su file.</span><span class="sxs-lookup"><span data-stu-id="bb186-106">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) covers hello file-based backup option.</span></span>

<span data-ttu-id="bb186-107">Quando si utilizza una funzionalità di backup di macchine Virtuali per un sistema a istanza singola all-in-one demo, uno consigliabile eseguire un backup della macchina virtuale anziché gestire backup HANA hello livello del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="bb186-107">When using a VM backup feature for a single-instance all-in-one demo system, one should consider doing a VM backup instead of managing HANA backups at hello OS level.</span></span> <span data-ttu-id="bb186-108">In alternativa, è tootake blob di Azure degli snapshot toocreate copie dei singoli dischi virtuali, che sono macchina virtuale tooa collegato e mantenere i file di dati HANA hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-108">An alternative is tootake Azure blob snapshots toocreate copies of individual virtual disks, which are attached tooa virtual machine, and keep hello HANA data files.</span></span> <span data-ttu-id="bb186-109">Ma un punto critico è coerenza app durante la creazione di uno snapshot di backup o il disco di macchina virtuale mentre hello sistema sia attivo e in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="bb186-109">But a critical point is app consistency when creating a VM backup or disk snapshot while hello system is up and running.</span></span> <span data-ttu-id="bb186-110">Vedere _la coerenza dei dati SAP HANA quando l'esecuzione di snapshot di archiviazione_ nell'articolo correlato hello [Guida di Backup per SAP HANA in macchine virtuali di Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="bb186-110">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span> <span data-ttu-id="bb186-111">SAP HANA dispone di una funzionalità che supporta questi tipi di snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="bb186-111">SAP HANA has a feature that supports these kinds of storage snapshots.</span></span>

## <a name="sap-hana-snapshots"></a><span data-ttu-id="bb186-112">Snapshot di SAP HANA</span><span class="sxs-lookup"><span data-stu-id="bb186-112">SAP HANA snapshots</span></span>

<span data-ttu-id="bb186-113">SAP HANA dispone di una funzionalità che supporta la creazione di uno snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="bb186-113">There is a feature in SAP HANA that supports taking a storage snapshot.</span></span> <span data-ttu-id="bb186-114">Tuttavia, a partire dal 2016 dicembre, vi è una restrizione sistemi toosingle contenitore.</span><span class="sxs-lookup"><span data-stu-id="bb186-114">However, as of December 2016, there is a restriction toosingle-container systems.</span></span> <span data-ttu-id="bb186-115">Le configurazioni con contenitore multi-tenant non supportano questo tipo di snapshot del database (vedere [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) (Creare uno snapshot di archiviazione (SAP HANA Studio))).</span><span class="sxs-lookup"><span data-stu-id="bb186-115">Multitenant container configurations do not support this kind of database snapshot (see [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span></span>

<span data-ttu-id="bb186-116">Il funzionamento è il seguente:</span><span class="sxs-lookup"><span data-stu-id="bb186-116">It works as follows:</span></span>

- <span data-ttu-id="bb186-117">Preparare per uno snapshot di archiviazione avviando snapshot SAP HANA hello</span><span class="sxs-lookup"><span data-stu-id="bb186-117">Prepare for a storage snapshot by initiating hello SAP HANA snapshot</span></span>
- <span data-ttu-id="bb186-118">Eseguire snapshot archiviazione hello (blob, ad esempio snapshot di Azure)</span><span class="sxs-lookup"><span data-stu-id="bb186-118">Run hello storage snapshot (Azure blob snapshot, for example)</span></span>
- <span data-ttu-id="bb186-119">Confermare di snapshot di SAP HANA hello</span><span class="sxs-lookup"><span data-stu-id="bb186-119">Confirm hello SAP HANA snapshot</span></span>

![La schermata mostra che è possibile creare uno snapshot dei dati di SAP HANA tramite un'istruzione SQL](media/sap-hana-backup-storage-snapshots/image011.png)

<span data-ttu-id="bb186-121">La schermata mostra che è possibile creare uno snapshot dei dati di SAP HANA tramite un'istruzione SQL.</span><span class="sxs-lookup"><span data-stu-id="bb186-121">This screenshot shows that an SAP HANA data snapshot can be created via a SQL statement.</span></span>

![snapshot quindi Hello viene inoltre visualizzato nel catalogo di backup hello in Studio di SAP HANA](media/sap-hana-backup-storage-snapshots/image012.png)

<span data-ttu-id="bb186-123">Hello snapshot quindi viene visualizzato anche nel catalogo di backup hello in Studio di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="bb186-123">hello snapshot then also appears in hello backup catalog in SAP HANA Studio.</span></span>

![Sul disco, snapshot hello viene visualizzato nella directory dei dati SAP HANA hello](media/sap-hana-backup-storage-snapshots/image013.png)

<span data-ttu-id="bb186-125">Sul disco, snapshot hello viene visualizzato nella directory dei dati SAP HANA hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-125">On disk, hello snapshot shows up in hello SAP HANA data directory.</span></span>

<span data-ttu-id="bb186-126">Uno contiene tooensure che coerenza del file system hello è garantita anche prima dell'esecuzione di snapshot di archiviazione hello mentre si trova in modalità di preparazione snapshot hello SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="bb186-126">One has tooensure that hello file system consistency is also guaranteed before running hello storage snapshot while SAP HANA is in hello snapshot preparation mode.</span></span> <span data-ttu-id="bb186-127">Vedere _la coerenza dei dati SAP HANA quando l'esecuzione di snapshot di archiviazione_ nell'articolo correlato hello [Guida di Backup per SAP HANA in macchine virtuali di Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="bb186-127">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

<span data-ttu-id="bb186-128">Al termine dello snapshot di archiviazione hello, si tratta di snapshot di SAP HANA hello tooconfirm critici.</span><span class="sxs-lookup"><span data-stu-id="bb186-128">Once hello storage snapshot is done, it is critical tooconfirm hello SAP HANA snapshot.</span></span> <span data-ttu-id="bb186-129">È presente un corrispondente toorun istruzione SQL: BACKUP SNAPSHOT Chiudi dei dati (vedere [la istruzione BACKUP dati Chiudi SNAPSHOT (Backup e ripristino)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="bb186-129">There is a corresponding SQL statement toorun: BACKUP DATA CLOSE SNAPSHOT (see [BACKUP DATA CLOSE SNAPSHOT Statement (Backup and Recovery)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="bb186-130">Confermare snapshot HANA hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-130">Confirm hello HANA snapshot.</span></span> <span data-ttu-id="bb186-131">Scadenza troppo&quot;Copy-on-Write&quot; SAP HANA potrebbe richiedere ulteriore spazio su disco in snapshot-modalità preparazione, e non è possibile toostart nuovi backup fino a quando non viene confermato snapshot SAP HANA hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-131">Due too&quot;Copy-on-Write,&quot; SAP HANA might require additional disk space in snapshot-prepare mode, and it is not possible toostart new backups until hello SAP HANA snapshot is confirmed.</span></span>

## <a name="hana-vm-backup-via-azure-backup-service"></a><span data-ttu-id="bb186-132">Backup di VM HANA tramite il servizio Backup di Azure</span><span class="sxs-lookup"><span data-stu-id="bb186-132">HANA VM backup via Azure Backup service</span></span>

<span data-ttu-id="bb186-133">A partire dal 2016 dicembre, l'agente di backup hello di hello servizio Azure Backup non è disponibile per le macchine virtuali Linux.</span><span class="sxs-lookup"><span data-stu-id="bb186-133">As of December 2016, hello backup agent of hello Azure Backup service is not available for Linux VMs.</span></span> <span data-ttu-id="bb186-134">utilizzo di toomake di backup di Azure a livello di file o directory hello, uno si copiano i file di backup di SAP HANA tooa macchina virtuale di Windows e quindi utilizzare l'agente di backup hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-134">toomake use of Azure backup on hello file/directory level, one would copy SAP HANA backup files tooa Windows VM and then use hello backup agent.</span></span> <span data-ttu-id="bb186-135">In caso contrario, un backup completo solo VM Linux è possibile tramite servizio di Backup di Azure hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-135">Otherwise, only a full Linux VM backup is possible via hello Azure Backup service.</span></span> <span data-ttu-id="bb186-136">Vedere [Panoramica di hello funzionalità in Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) toofind altre.</span><span class="sxs-lookup"><span data-stu-id="bb186-136">See [Overview of hello features in Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) toofind out more.</span></span>

<span data-ttu-id="bb186-137">Hello servizio Backup di Azure offre un'opzione tooback e ripristinare una macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="bb186-137">hello Azure Backup service offers an option tooback up and restore a VM.</span></span> <span data-ttu-id="bb186-138">Ulteriori informazioni su questo servizio e il relativo funzionamento sono reperibile nell'articolo hello [pianificare l'infrastruttura di backup di VM in Azure](../../../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="bb186-138">More information about this service and how it works can be found in hello article [Plan your VM backup infrastructure in Azure](../../../backup/backup-azure-vms-introduction.md).</span></span>

<span data-ttu-id="bb186-139">Esistono due importanti considerazioni in base toothat articolo:</span><span class="sxs-lookup"><span data-stu-id="bb186-139">There are two important considerations according toothat article:</span></span>

<span data-ttu-id="bb186-140">_&quot;Per le macchine virtuali Linux, solo i backup coerenti con i file sono possibili, poiché non dispone di un tooVSS equivalente piattaforma Linux.&quot;_</span><span class="sxs-lookup"><span data-stu-id="bb186-140">_&quot;For Linux virtual machines, only file-consistent backups are possible, since Linux does not have an equivalent platform tooVSS.&quot;_</span></span>

<span data-ttu-id="bb186-141">_&quot;Le applicazioni devono tooimplement i propri &quot;correzione&quot; meccanismo hello il ripristino dei dati.&quot;_</span><span class="sxs-lookup"><span data-stu-id="bb186-141">_&quot;Applications need tooimplement their own &quot;fix-up&quot; mechanism on hello restored data.&quot;_</span></span>

<span data-ttu-id="bb186-142">Pertanto, uno ha toomake assicurarsi SAP HANA in uno stato coerente su disco quando viene avviato il backup di hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-142">Therefore, one has toomake sure SAP HANA is in a consistent state on disk when hello backup starts.</span></span> <span data-ttu-id="bb186-143">Vedere _snapshot SAP HANA_ descritto in precedenza in documento hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-143">See _SAP HANA snapshots_ described earlier in hello document.</span></span> <span data-ttu-id="bb186-144">Ma esiste un problema potenziale quando SAP HANA si trova in questa modalità di preparazione dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="bb186-144">But there is a potential issue when SAP HANA stays in this snapshot preparation mode.</span></span> <span data-ttu-id="bb186-145">Per altre informazioni, vedere [Create a Storage Snapshot - SAP HANA Studio](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) (Creare uno snapshot di archiviazione - SAP HANA Studio).</span><span class="sxs-lookup"><span data-stu-id="bb186-145">See [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) for more information.</span></span>

<span data-ttu-id="bb186-146">L'articolo afferma quanto segue:</span><span class="sxs-lookup"><span data-stu-id="bb186-146">That article states:</span></span>

<span data-ttu-id="bb186-147">_&quot;È consigliabile tooconfirm o abbandonare uno snapshot di archiviazione appena possibile dopo che è stato creato. Mentre snapshot di archiviazione hello viene preparato o hello creato, i dati pertinenti a snapshot sono bloccati. Mentre i dati relativi a snapshot hello rimangono bloccati, è possibile apportare modifiche nel database di hello. Tali modifiche non genererà hello bloccata toobe relativi snapshot di dati modificati. Al contrario, le modifiche di hello vengono scritte toopositions nell'area dati hello separati da snapshot archiviazione hello. Le modifiche vengono scritte anche toohello log. Tuttavia, hello più hello snapshot di dati rilevanti vengono mantenuti bloccata, hello hello ulteriori può raggiungere il volume di dati.&quot;_</span><span class="sxs-lookup"><span data-stu-id="bb186-147">_&quot;It is strongly recommended tooconfirm or abandon a storage snapshot as soon as possible after it has been created. While hello storage snapshot is being prepared or created, hello snapshot-relevant data is frozen. While hello snapshot-relevant data remains frozen, changes can still be made in hello database. Such changes will not cause hello frozen snapshot-relevant data toobe changed. Instead, hello changes are written toopositions in hello data area that are separate from hello storage snapshot. Changes are also written toohello log. However, hello longer hello snapshot-relevant data is kept frozen, hello more hello data volume can grow.&quot;_</span></span>

<span data-ttu-id="bb186-148">Backup di Azure si occupa di coerenza del file system hello tramite estensioni VM di Azure.</span><span class="sxs-lookup"><span data-stu-id="bb186-148">Azure Backup takes care of hello file system consistency via Azure VM extensions.</span></span> <span data-ttu-id="bb186-149">Queste estensioni non sono disponibili in modalità autonoma e funzionano solo in combinazione con il servizio Backup di Azure.</span><span class="sxs-lookup"><span data-stu-id="bb186-149">These extensions are not available standalone, and work only in combination with Azure Backup service.</span></span> <span data-ttu-id="bb186-150">Tuttavia, è comunque toomanage un requisito della coerenza un'app di SAP HANA snapshot tooguarantee.</span><span class="sxs-lookup"><span data-stu-id="bb186-150">Nevertheless, it is still a requirement toomanage an SAP HANA snapshot tooguarantee app consistency.</span></span>

<span data-ttu-id="bb186-151">Backup di Azure presenta due fasi principali:</span><span class="sxs-lookup"><span data-stu-id="bb186-151">Azure Backup has two major phases:</span></span>

- <span data-ttu-id="bb186-152">Creare lo snapshot</span><span class="sxs-lookup"><span data-stu-id="bb186-152">Take Snapshot</span></span>
- <span data-ttu-id="bb186-153">Trasferimento dati toovault</span><span class="sxs-lookup"><span data-stu-id="bb186-153">Transfer data toovault</span></span>

<span data-ttu-id="bb186-154">Pertanto, una possibile confermare la snapshot SAP HANA hello dopo il completamento della fase di esecuzione di uno snapshot del servizio Azure Backup hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-154">So one could confirm hello SAP HANA snapshot once hello Azure Backup service phase of taking a snapshot is completed.</span></span> <span data-ttu-id="bb186-155">Potrebbe richiedere diversi minuti toosee in hello portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="bb186-155">It might take several minutes toosee in hello Azure portal.</span></span>

![In questa figura mostra parte dell'elenco di hello processo di backup di un servizio di Backup di Azure](media/sap-hana-backup-storage-snapshots/image014.png)

<span data-ttu-id="bb186-157">Questa figura mostra parte dell'elenco di hello processo di backup di un servizio di Backup di Azure, che è stato utilizzato tooback di test HANA hello macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="bb186-157">This figure shows part of hello backup job list of an Azure Backup service, which was used tooback up hello HANA test VM.</span></span>

![i dettagli dei processi tooshow hello, fare clic su processo di backup hello in hello portale di Azure](media/sap-hana-backup-storage-snapshots/image015.png)

<span data-ttu-id="bb186-159">i dettagli dei processi tooshow hello, fare clic su processo di backup nel portale di Azure hello hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-159">tooshow hello job details, click hello backup job in hello Azure portal.</span></span> <span data-ttu-id="bb186-160">In questo caso, si può osservare hello due fasi.</span><span class="sxs-lookup"><span data-stu-id="bb186-160">Here, one can see hello two phases.</span></span> <span data-ttu-id="bb186-161">Potrebbe richiedere alcuni minuti finché non viene visualizzato fase snapshot hello come completata.</span><span class="sxs-lookup"><span data-stu-id="bb186-161">It might take a few minutes until it shows hello snapshot phase as completed.</span></span> <span data-ttu-id="bb186-162">La maggior parte del tempo di hello viene impiegata in fase di trasferimento dei dati hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-162">Most of hello time is spent in hello data transfer phase.</span></span>

## <a name="hana-vm-backup-automation-via-azure-backup-service"></a><span data-ttu-id="bb186-163">Automazione del backup di VM HANA tramite il servizio Backup di Azure</span><span class="sxs-lookup"><span data-stu-id="bb186-163">HANA VM backup automation via Azure Backup service</span></span>

<span data-ttu-id="bb186-164">Uno stato confermare snapshot SAP HANA hello manualmente dopo il completamento della fase hello Azure Backup snapshot, come descritto in precedenza, ma è utile tooconsider automazione perché un amministratore non può monitorare elenco processo di backup hello hello portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="bb186-164">One could manually confirm hello SAP HANA snapshot once hello Azure Backup snapshot phase is completed, as described earlier, but it is helpful tooconsider automation because an admin might not monitor hello backup job list in hello Azure portal.</span></span>

<span data-ttu-id="bb186-165">Di seguito è riportata una spiegazione di come si potrebbe fare questo mediante i cmdlet di Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="bb186-165">Here is an explanation how it could be accomplished via Azure PowerShell cmdlets.</span></span>

![Un servizio di Azure Backup è stato creato con hello Nome hana-backup-insieme di credenziali](media/sap-hana-backup-storage-snapshots/image016.png)

<span data-ttu-id="bb186-167">Un servizio di Azure Backup è stato creato con il nome di hello &quot;hana-backup-insieme di credenziali.&quot; hello comando PS **AzureRmRecoveryServicesVault di Get-nome archivio di backup hana** recupera hello oggetto corrispondente.</span><span class="sxs-lookup"><span data-stu-id="bb186-167">An Azure Backup service was created with hello name &quot;hana-backup-vault.&quot; hello PS command **Get-AzureRmRecoveryServicesVault -Name hana-backup-vault** retrieves hello corresponding object.</span></span> <span data-ttu-id="bb186-168">Questo oggetto è utilizzato tooset hello backup contesto come mostrato nella figura che segue hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-168">This object is then used tooset hello backup context as seen on hello next figure.</span></span>

![È possibile verificare hello processo di backup attualmente in corso](media/sap-hana-backup-storage-snapshots/image017.png)

<span data-ttu-id="bb186-170">Dopo il contesto corretto hello impostazione, uno può controllare hello processo di backup attualmente in corso e quindi cercare i dettagli del processo.</span><span class="sxs-lookup"><span data-stu-id="bb186-170">After setting hello correct context, one can check for hello backup job currently in progress, and then look for its job details.</span></span> <span data-ttu-id="bb186-171">elenco delle sottoattività Hello Mostra se fase snapshot hello di hello Azure processo di backup è già stata completata:</span><span class="sxs-lookup"><span data-stu-id="bb186-171">hello subtask list shows if hello snapshot phase of hello Azure backup job is already completed:</span></span>

```
$ars = Get-AzureRmRecoveryServicesVault -Name hana-backup-vault
Set-AzureRmRecoveryServicesVaultContext -Vault $ars
$jid = Get-AzureRmRecoveryServicesBackupJob -Status InProgress | select -ExpandProperty jobid
Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
```

![Valore di polling hello in un ciclo fino a quando non diventa tooCompleted](media/sap-hana-backup-storage-snapshots/image018.png)

<span data-ttu-id="bb186-173">Una volta i dettagli dei processi hello vengono archiviati in una variabile, è sufficiente PS sintassi tooget toohello primo elemento della matrice e recuperare il valore di stato hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-173">Once hello job details are stored in a variable, it is simply PS syntax tooget toohello first array entry and retrieve hello status value.</span></span> <span data-ttu-id="bb186-174">script di automazione toocomplete hello, valore hello sondaggio in un ciclo fino a quando diventa troppo&quot;completato.&quot;</span><span class="sxs-lookup"><span data-stu-id="bb186-174">toocomplete hello automation script, poll hello value in a loop until it turns too&quot;Completed.&quot;</span></span>

```
$st = Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
$st[0] | select -ExpandProperty status
```

## <a name="hana-license-key-and-vm-restore-via-azure-backup-service"></a><span data-ttu-id="bb186-175">Chiave di licenza di HANA e ripristino di VM mediante il servizio Backup di Azure</span><span class="sxs-lookup"><span data-stu-id="bb186-175">HANA license key and VM restore via Azure Backup service</span></span>

<span data-ttu-id="bb186-176">Hello servizio Azure Backup è progettata toocreate una nuova macchina virtuale durante il ripristino.</span><span class="sxs-lookup"><span data-stu-id="bb186-176">hello Azure Backup service is designed toocreate a new VM during restore.</span></span> <span data-ttu-id="bb186-177">Non vi è alcun piano attualmente toodo un &quot;sul posto&quot; ripristino di una macchina virtuale di Azure esistente.</span><span class="sxs-lookup"><span data-stu-id="bb186-177">There is no plan right now toodo an &quot;in-place&quot; restore of an existing Azure VM.</span></span>

![Nella figura viene illustrata l'opzione di ripristino hello di hello servizio di Azure nel portale di Azure hello](media/sap-hana-backup-storage-snapshots/image019.png)

<span data-ttu-id="bb186-179">Questa figura mostra l'opzione di ripristino hello di hello servizio di Azure nel portale di Azure hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-179">This figure shows hello restore option of hello Azure service in hello Azure portal.</span></span> <span data-ttu-id="bb186-180">È possibile scegliere tra la creazione di una macchina virtuale durante il ripristino o ripristino dei dischi hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-180">One can choose between creating a VM during restore or restoring hello disks.</span></span> <span data-ttu-id="bb186-181">Dopo aver ripristinato i dischi di hello, è comunque necessario toocreate una nuova macchina virtuale su di esso.</span><span class="sxs-lookup"><span data-stu-id="bb186-181">After restoring hello disks, it is still necessary toocreate a new VM on top of it.</span></span> <span data-ttu-id="bb186-182">Ogni volta che in cui viene creata una nuova macchina virtuale in Azure hello VM ID univoco cambia (vedere [accesso e con ID univoco di Azure VM](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span><span class="sxs-lookup"><span data-stu-id="bb186-182">Whenever a new VM gets created on Azure hello unique VM ID changes (see [Accessing and Using Azure VM Unique ID](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span></span>

![Questa figura mostra hello ID univoco di macchina virtuale di Azure prima e dopo il ripristino di hello mediante il servizio di Backup di Azure](media/sap-hana-backup-storage-snapshots/image020.png)

<span data-ttu-id="bb186-184">Questa figura mostra l'ID univoco di macchina virtuale di Azure hello prima e dopo il ripristino di hello mediante il servizio di Backup di Azure.</span><span class="sxs-lookup"><span data-stu-id="bb186-184">This figure shows hello Azure VM unique ID before and after hello restore via Azure Backup service.</span></span> <span data-ttu-id="bb186-185">tasto hardware SAP Hello, che viene utilizzato per la gestione delle licenze SAP, Usa questo ID univoco di macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="bb186-185">hello SAP hardware key, which is used for SAP licensing, is using this unique VM ID.</span></span> <span data-ttu-id="bb186-186">Di conseguenza, una nuova licenza SAP ha toobe installato dopo un ripristino della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="bb186-186">As a consequence, a new SAP license has toobe installed after a VM restore.</span></span>

<span data-ttu-id="bb186-187">Una nuova funzionalità Backup di Azure è stata presentata durante la creazione di hello di questa Guida al backup in modalità di anteprima.</span><span class="sxs-lookup"><span data-stu-id="bb186-187">A new Azure Backup feature was presented in preview mode during hello creation of this backup guide.</span></span> <span data-ttu-id="bb186-188">Consente un ripristino di file livello in base a snapshot VM hello che è stato eseguito per hello VM backup.</span><span class="sxs-lookup"><span data-stu-id="bb186-188">It allows a file level restore based on hello VM snapshot that was taken for hello VM backup.</span></span> <span data-ttu-id="bb186-189">Questo modo si evita di hello necessità toodeploy una nuova macchina virtuale, pertanto rimane ID macchina virtuale univoci hello hello stesso e nessun nuovo codice di licenza di SAP HANA è obbligatorio.</span><span class="sxs-lookup"><span data-stu-id="bb186-189">This avoids hello need toodeploy a new VM, and therefore hello unique VM ID stays hello same and no new SAP HANA license key is required.</span></span> <span data-ttu-id="bb186-190">Altre informazioni su questa funzionalità saranno fornite dopo un completo test.</span><span class="sxs-lookup"><span data-stu-id="bb186-190">More documentation on this feature will be provided after it is fully tested.</span></span>

<span data-ttu-id="bb186-191">Backup di Azure verrà infine consentire il backup di singoli dischi virtuali Azure, più file e le directory all'interno di hello macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="bb186-191">Azure Backup will eventually allow backup of individual Azure virtual disks, plus files and directories from inside hello VM.</span></span> <span data-ttu-id="bb186-192">Dei vantaggi principale di Backup di Azure è la gestione di tutti i backup di hello, salvataggio cliente hello dalla presenza di toodo è.</span><span class="sxs-lookup"><span data-stu-id="bb186-192">A major advantage of Azure Backup is its management of all hello backups, saving hello customer from having toodo it.</span></span> <span data-ttu-id="bb186-193">Se necessario, un ripristino del Backup di Azure selezionerà il toouse backup corretto hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-193">If a restore becomes necessary, Azure Backup will select hello correct backup toouse.</span></span>

## <a name="sap-hana-vm-backup-via-manual-disk-snapshot"></a><span data-ttu-id="bb186-194">Backup di VM SAP HANA mediante snapshot manuali dei dischi</span><span class="sxs-lookup"><span data-stu-id="bb186-194">SAP HANA VM backup via manual disk snapshot</span></span>

<span data-ttu-id="bb186-195">Anziché servizio di Backup di Azure hello, uno è stato possibile configurare una singola soluzione di backup mediante la creazione di snapshot di blob di dischi rigidi virtuali di Azure manualmente tramite PowerShell.</span><span class="sxs-lookup"><span data-stu-id="bb186-195">Instead of using hello Azure Backup service, one could configure an individual backup solution by creating blob snapshots of Azure VHDs manually via PowerShell.</span></span> <span data-ttu-id="bb186-196">Vedere [utilizzando gli snapshot di blob con PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) per una descrizione dei passaggi di hello.</span><span class="sxs-lookup"><span data-stu-id="bb186-196">See [Using blob snapshots with PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) for a description of hello steps.</span></span>

<span data-ttu-id="bb186-197">Offre una maggiore flessibilità ma non consente di risolvere i problemi di hello illustrati in precedenza in questo documento:</span><span class="sxs-lookup"><span data-stu-id="bb186-197">It provides more flexibility but does not resolve hello issues explained earlier in this document:</span></span>

- <span data-ttu-id="bb186-198">È comunque necessario assicurarsi che SAP HANA sia in uno stato coerente</span><span class="sxs-lookup"><span data-stu-id="bb186-198">One still must make sure that SAP HANA is in a consistent state</span></span>
- <span data-ttu-id="bb186-199">disco del sistema operativo Hello non può essere sovrascritto, anche se esiste hello deallocata a causa di un errore indicante che un lease.</span><span class="sxs-lookup"><span data-stu-id="bb186-199">hello OS disk cannot be overwritten even if hello VM is deallocated because of an error stating that a lease exists.</span></span> <span data-ttu-id="bb186-200">Funziona solo dopo l'eliminazione di hello VM, che potrebbe causare tooa nuovo univoco ID macchina virtuale e hello necessità tooinstall una nuova licenza SAP.</span><span class="sxs-lookup"><span data-stu-id="bb186-200">It only works after deleting hello VM, which would lead tooa new unique VM ID and hello need tooinstall a new SAP license.</span></span>

![È possibile toorestore solo hello dischi di dati di una macchina virtuale di Azure](media/sap-hana-backup-storage-snapshots/image021.png)

<span data-ttu-id="bb186-202">È possibile toorestore solo hello dischi di dati di una macchina virtuale di Azure, come evitare il problema hello di ottenere un nuovo ID univoco di macchina virtuale e, pertanto invalidati licenza SAP hello:</span><span class="sxs-lookup"><span data-stu-id="bb186-202">It is possible toorestore only hello data disks of an Azure VM, avoiding hello problem of getting a new unique VM ID and, therefore, invalidated hello SAP license:</span></span>

- <span data-ttu-id="bb186-203">Per il test di hello, due dischi di dati di Azure sono stato collegato tooa VM e RAID software è stato definito questi</span><span class="sxs-lookup"><span data-stu-id="bb186-203">For hello test, two Azure data disks were attached tooa VM and software RAID was defined on top of them</span></span> 
- <span data-ttu-id="bb186-204">La coerenza di SAP HANA è stata verificata mediante la funzionalità di snapshot di SAP HANA</span><span class="sxs-lookup"><span data-stu-id="bb186-204">It was confirmed that SAP HANA was in a consistent state by SAP HANA snapshot feature</span></span>
- <span data-ttu-id="bb186-205">Blocco del file system (vedere _la coerenza dei dati SAP HANA quando l'esecuzione di snapshot di archiviazione_ nell'articolo correlato hello [Guida di Backup per SAP HANA in macchine virtuali di Azure](sap-hana-backup-guide.md))</span><span class="sxs-lookup"><span data-stu-id="bb186-205">File system freeze (see _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md))</span></span>
- <span data-ttu-id="bb186-206">Sono stati eseguiti snapshot BLOB da entrambi i dischi dati</span><span class="sxs-lookup"><span data-stu-id="bb186-206">Blob snapshots were taken from both data disks</span></span>
- <span data-ttu-id="bb186-207">Sblocco del file system</span><span class="sxs-lookup"><span data-stu-id="bb186-207">File system unfreeze</span></span>
- <span data-ttu-id="bb186-208">Conferma dello snapshot SAP HANA</span><span class="sxs-lookup"><span data-stu-id="bb186-208">SAP HANA snapshot confirmation</span></span>
- <span data-ttu-id="bb186-209">i dischi dati hello toorestore, hello VM è stato chiuso e scollegato da entrambi i dischi</span><span class="sxs-lookup"><span data-stu-id="bb186-209">toorestore hello data disks, hello VM was shut down and both disks detached</span></span>
- <span data-ttu-id="bb186-210">Dopo la disconnessione dischi hello, che sono stati sovrascritti con snapshot di blob precedente hello</span><span class="sxs-lookup"><span data-stu-id="bb186-210">After detaching hello disks, they were overwritten with hello former blob snapshots</span></span>
- <span data-ttu-id="bb186-211">Quindi sono stati collegati dischi virtuali hello ripristinato nuovamente toohello VM</span><span class="sxs-lookup"><span data-stu-id="bb186-211">Then hello restored virtual disks were attached again toohello VM</span></span>
- <span data-ttu-id="bb186-212">Dopo la durata di snapshot inizia hello VM, tutto il software di hello RAID funzionava correttamente e che è stato reimpostato toohello blob</span><span class="sxs-lookup"><span data-stu-id="bb186-212">After starting hello VM, everything on hello software RAID worked fine and was set back toohello blob snapshot time</span></span>
- <span data-ttu-id="bb186-213">HANA è stato reimpostato snapshot HANA toohello</span><span class="sxs-lookup"><span data-stu-id="bb186-213">HANA was set back toohello HANA snapshot</span></span>

<span data-ttu-id="bb186-214">Se è stato possibile tooshut verso il basso SAP HANA prima degli snapshot blob hello, procedura hello sarebbe meno complessa.</span><span class="sxs-lookup"><span data-stu-id="bb186-214">If it was possible tooshut down SAP HANA before hello blob snapshots, hello procedure would be less complex.</span></span> <span data-ttu-id="bb186-215">Uno stato in questo caso, ignorare snapshot HANA hello e, se nient'altro sta succedendo nel sistema hello, anche ignorare hello file sistema blocca.</span><span class="sxs-lookup"><span data-stu-id="bb186-215">In that case, one could skip hello HANA snapshot and, if nothing else is going on in hello system, also skip hello file system freeze.</span></span> <span data-ttu-id="bb186-216">Complessità aggiuntiva viene immagine hello quando è necessario toodo snapshot mentre tutto ciò che è online.</span><span class="sxs-lookup"><span data-stu-id="bb186-216">Added complexity comes into hello picture when it is necessary toodo snapshots while everything is online.</span></span> <span data-ttu-id="bb186-217">Vedere _la coerenza dei dati SAP HANA quando l'esecuzione di snapshot di archiviazione_ nell'articolo correlato hello [Guida di Backup per SAP HANA in macchine virtuali di Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="bb186-217">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="bb186-218">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="bb186-218">Next steps</span></span>
* <span data-ttu-id="bb186-219">La [Guida del backup di SAP HANA in Macchine virtuali di Azure](sap-hana-backup-guide.md) offre una panoramica e informazioni introduttive.</span><span class="sxs-lookup"><span data-stu-id="bb186-219">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="bb186-220">[Backup di SAP HANA in base al livello di file](sap-hana-backup-file-level.md) copre hello opzione di backup basato su file.</span><span class="sxs-lookup"><span data-stu-id="bb186-220">[SAP HANA backup based on file level](sap-hana-backup-file-level.md) covers hello file-based backup option.</span></span>
* <span data-ttu-id="bb186-221">toolearn tooestablish la disponibilità elevata e piano di ripristino di emergenza di SAP HANA in Azure (istanze di grandi dimensioni), vedere [SAP HANA (istanze di grandi dimensioni) ad alto disponibilità e ripristino di emergenza in Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="bb186-221">toolearn how tooestablish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>
