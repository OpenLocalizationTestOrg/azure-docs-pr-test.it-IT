---
title: Descrizione del cluster di Cluster Resource Manager | Microsoft Docs
description: "Descrizione di un cluster di Service Fabric specificando i domini di errore, i domini di aggiornamento, le proprietà del nodo e le capacità del nodo per Cluster Resource Manager."
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 55f8ab37-9399-4c9a-9e6c-d2d859de6766
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: e517eda4d3ff7ad81998003688c3cca78f76e179
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/29/2017
---
# <a name="describing-a-service-fabric-cluster"></a><span data-ttu-id="fd6ba-103">Descrizione di un cluster di Service Fabric</span><span class="sxs-lookup"><span data-stu-id="fd6ba-103">Describing a service fabric cluster</span></span>
<span data-ttu-id="fd6ba-104">Cluster Resource Manager di Service Fabric fornisce alcuni meccanismi per descrivere un cluster.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-104">The Service Fabric Cluster Resource Manager provides several mechanisms for describing a cluster.</span></span> <span data-ttu-id="fd6ba-105">Durante la fase di esecuzione, Cluster Resource Manager usa queste informazioni per assicurare la disponibilità elevata dei servizi in esecuzione sul cluster.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-105">During runtime, the Cluster Resource Manager uses this information to ensure high availability of the services running in the cluster.</span></span> <span data-ttu-id="fd6ba-106">Applicando queste regole importanti, tenta anche di ottimizzare il consumo di risorse all'interno del cluster.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-106">While enforcing these important rules, it also attempts to optimize the resource consumption within the cluster.</span></span>

## <a name="key-concepts"></a><span data-ttu-id="fd6ba-107">Concetti chiave</span><span class="sxs-lookup"><span data-stu-id="fd6ba-107">Key concepts</span></span>
<span data-ttu-id="fd6ba-108">Cluster Resource Manager supporta diverse funzionalità che descrivono un cluster:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-108">The Cluster Resource Manager supports several features that describe a cluster:</span></span>

* <span data-ttu-id="fd6ba-109">Domini di errore</span><span class="sxs-lookup"><span data-stu-id="fd6ba-109">Fault Domains</span></span>
* <span data-ttu-id="fd6ba-110">Domini di aggiornamento</span><span class="sxs-lookup"><span data-stu-id="fd6ba-110">Upgrade Domains</span></span>
* <span data-ttu-id="fd6ba-111">Proprietà del nodo</span><span class="sxs-lookup"><span data-stu-id="fd6ba-111">Node Properties</span></span>
* <span data-ttu-id="fd6ba-112">Capacità del nodo</span><span class="sxs-lookup"><span data-stu-id="fd6ba-112">Node Capacities</span></span>

## <a name="fault-domains"></a><span data-ttu-id="fd6ba-113">Domini di errore</span><span class="sxs-lookup"><span data-stu-id="fd6ba-113">Fault domains</span></span>
<span data-ttu-id="fd6ba-114">Un dominio di errore è un'area di errore coordinato.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-114">A Fault Domain is any area of coordinated failure.</span></span> <span data-ttu-id="fd6ba-115">Un singolo computer è un dominio di errore, in quanto il computer si può arrestare da solo per vari motivi, da interruzioni dell'alimentazione a errori delle unità o firmware NIC non valido.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-115">A single machine is a Fault Domain (since it can fail on its own for various reasons, from power supply failures to drive failures to bad NIC firmware).</span></span> <span data-ttu-id="fd6ba-116">I computer connessi allo stesso commutatore Ethernet si trovano nello stesso dominio di errore, analogamente ai computer che condividono una singola fonte di alimentazione o si trovano nella stessa posizione.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-116">Machines connected to the same Ethernet switch are in the same Fault Domain, as are machines sharing a single source of power or in a single location.</span></span> <span data-ttu-id="fd6ba-117">Poiché è naturale che gli errori hardware si sovrappongano, i domini di errore sono intrinsecamente gerarchici e sono rappresentati come URI in Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-117">Since it's natural for hardware faults to overlap, Fault Domains are inherently hierarchal and are represented as URIs in Service Fabric.</span></span>

<span data-ttu-id="fd6ba-118">È importante che i domini di errore siano impostati correttamente poiché Service Fabric usa queste informazioni per posizionare in modo sicuro i servizi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-118">It is important that Fault Domains are set up correctly since Service Fabric uses this information to safely place services.</span></span> <span data-ttu-id="fd6ba-119">Service Fabric non posiziona i servizi in modo che la perdita di un dominio di errore (a causa dell'errore di qualche componente) causi l'interruzione di un servizio.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-119">Service Fabric doesn't want to place services such that the loss of a Fault Domain (caused by the failure of some component) causes a service to go down.</span></span> <span data-ttu-id="fd6ba-120">Service Fabric, nell'ambiente di Azure, usa le informazioni del dominio di errore fornite dall'ambiente per configurare in modo corretto i nodi nel cluster per conto dell'utente.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-120">In the Azure environment Service Fabric uses the Fault Domain information provided by the environment to correctly configure the nodes in the cluster on your behalf.</span></span> <span data-ttu-id="fd6ba-121">Nella versione autonoma di Service Fabric, i domini di errore vengono definiti al momento della configurazione del cluster</span><span class="sxs-lookup"><span data-stu-id="fd6ba-121">For Service Fabric Standalone, Fault Domains are defined at the time that the cluster is set up</span></span> 

> [!WARNING]
> <span data-ttu-id="fd6ba-122">È importante che le informazioni sul dominio di errore fornite a Service Fabric siano accurate.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-122">It is important that the Fault Domain information provided to Service Fabric is accurate.</span></span> <span data-ttu-id="fd6ba-123">Si supponga, ad esempio, che i nodi del cluster di Service Fabric siano in esecuzione all'interno di dieci macchine virtuali, a loro volta in esecuzione su cinque host fisici.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-123">For example, let's say that your Service Fabric cluster's nodes are running inside 10 virtual machines, running on five physical hosts.</span></span> <span data-ttu-id="fd6ba-124">In questo caso, anche se sono presenti dieci macchine virtuali, sono presenti solo cinque domini di errore diversi (livello superiore).</span><span class="sxs-lookup"><span data-stu-id="fd6ba-124">In this case, even though there are 10 virtual machines, there's only 5 different (top level) fault domains.</span></span> <span data-ttu-id="fd6ba-125">La condivisione dello stesso host fisico comporta per le macchine virtuali anche la condivisione dello stesso dominio di errore radice, poiché sulle macchine virtuali si verifica un errore coordinato se sul relativo host fisico si verifica un errore,</span><span class="sxs-lookup"><span data-stu-id="fd6ba-125">Sharing the same physical host causes VMs to share the same root fault domain, since the VMs experience coordinated failure if their physical host fails.</span></span>  
>
> <span data-ttu-id="fd6ba-126">poiché Service Fabric non prevede il cambiamento del dominio di errore di un nodo.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-126">Since Service Fabric expects the Fault Domain of a node not to change.</span></span> <span data-ttu-id="fd6ba-127">Altri meccanismi per garantire una disponibilità elevata delle macchine virtuali, come illustrato nell'articolo relativo alle [Macchine virtuali a disponibilità elevata](https://technet.microsoft.com/en-us/library/cc967323.aspx), adottano la migrazione trasparente delle macchine virtuali da un host a un altro.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-127">Other mechanisms of ensuring high availability of the VMs, such as [HA-VMs](https://technet.microsoft.com/en-us/library/cc967323.aspx), use transparent migration of VMs from one host to another.</span></span> <span data-ttu-id="fd6ba-128">Questi meccanismi non riconfigurano né notificano il codice in esecuzione all'interno della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-128">These mechanisms do not reconfigure or notify the running code inside the VM.</span></span> <span data-ttu-id="fd6ba-129">Di conseguenza, **non sono supportati** come ambienti per l'esecuzione dei cluster di Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-129">As such, they are **not supported** as environments for running Service Fabric clusters.</span></span> <span data-ttu-id="fd6ba-130">Service Fabric deve essere l'unica tecnologia di disponibilità elevata in uso.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-130">Service Fabric should be the only high-availability technology employed.</span></span> <span data-ttu-id="fd6ba-131">Non sono necessari meccanismi quali la migrazione in tempo reale della macchina virtuale, SAN, o altri.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-131">Mechanisms like live VM migration, SANs, or others are not necessary.</span></span> <span data-ttu-id="fd6ba-132">Se usati insieme a Service Fabric, questi meccanismi _riducono_ la disponibilità e l'affidabilità dell'applicazione, poiché introducono complessità aggiuntive, aggiungono origini centralizzate di errore e usano strategie di disponibilità e affidabilità che possono entrare in conflitto con quelle presenti in Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-132">If used in conjunction with Service Fabric, these mechanisms _reduce_ application availability and reliability because they introduce additional complexity, add centralized sources of failure, and utilize reliability and availability strategies that conflict with those in Service Fabric.</span></span> 
>
>

<span data-ttu-id="fd6ba-133">Nella figura seguente tutte le entità che contribuiscono ai domini di errore sono colorate e sono elencati tutti i diversi domini di errore risultanti.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-133">In the graphic below we color all the entities that contribute to Fault Domains and list all the different Fault Domains that result.</span></span> <span data-ttu-id="fd6ba-134">In questo esempio sono presenti data center ("DC"), rack ("R") e pannelli ("B").</span><span class="sxs-lookup"><span data-stu-id="fd6ba-134">In this example, we have datacenters ("DC"), racks ("R"), and blades ("B").</span></span> <span data-ttu-id="fd6ba-135">Se ogni pannello include più macchine virtuali, è possibile che la gerarchia del dominio di errore includa un altro livello.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-135">Conceivably, if each blade holds more than one virtual machine, there could be another layer in the Fault Domain hierarchy.</span></span>

<span data-ttu-id="fd6ba-136"><center>
![Nodi organizzati tramite domini di errore][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="fd6ba-136"><center>
![Nodes organized via Fault Domains][Image1]
</center></span></span>

<span data-ttu-id="fd6ba-137">Durante la fase di esecuzione, Cluster Resource Manager di Service Fabric prende in considerazione i domini di errore del cluster e pianifica i layout.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-137">During runtime, the Service Fabric Cluster Resource Manager considers the Fault Domains in the cluster and plans layouts.</span></span> <span data-ttu-id="fd6ba-138">Vengono distribuite le repliche con stato o le istanze senza stato per un determinato servizio in modo che si trovino in domini di errore diversi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-138">The stateful replicas or stateless instances for a given service are distributed so they are in separate Fault Domains.</span></span> <span data-ttu-id="fd6ba-139">La distribuzione del servizio tra domini di errore assicura che la disponibilità del servizio non sia compromessa se si verifica un errore in un dominio di errore a qualsiasi livello della gerarchia.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-139">Distributing the service across fault domains ensures the availability of the service is not compromised when a Fault Domain fails at any level of the hierarchy.</span></span>

<span data-ttu-id="fd6ba-140">Cluster Resource Manager di Service Fabric non si cura del numero di livelli presenti nella gerarchia del dominio di errore.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-140">Service Fabric’s Cluster Resource Manager doesn’t care how many layers there are in the Fault Domain hierarchy.</span></span> <span data-ttu-id="fd6ba-141">Tenta invece di garantire che la perdita di una parte della gerarchia non incida sui servizi che vi vengono eseguiti.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-141">However, it tries to ensure that the loss of any one portion of the hierarchy doesn’t impact services running in it.</span></span> 

<span data-ttu-id="fd6ba-142">È preferibile che sia presente lo stesso numero di nodi a ogni livello di profondità della gerarchia del dominio di errore.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-142">It is best if there are the same number of nodes at each level of depth in the Fault Domain hierarchy.</span></span> <span data-ttu-id="fd6ba-143">Se l'albero dei domini di errore nel cluster è sbilanciato, è più difficile per Cluster Resource Manager determinare la migliore allocazione dei servizi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-143">If the “tree” of Fault Domains is unbalanced in your cluster, it makes it harder for the Cluster Resource Manager to figure out the best allocation of services.</span></span> <span data-ttu-id="fd6ba-144">Layout sbilanciati dei domini di errore comportano che la perdita di alcuni domini possa incidere maggiormente sulla disponibilità del cluster rispetto ad altri.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-144">Imbalanced Fault Domains layouts mean that the loss of some domains impact the availability of services more than other domains.</span></span> <span data-ttu-id="fd6ba-145">Di conseguenza Cluster Resource Manager si trova a dover scegliere fra due obiettivi: usare i computer del dominio più dotato posizionando i servizi in essi o posizionare i servizi in altri domini, così che la perdita di un dominio non causi problemi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-145">As a result, the Cluster Resource Manager is torn between two goals: It wants to use the machines in that “heavy” domain by placing services on them, and it wants to place services in other domains so that the loss of a domain doesn’t cause problems.</span></span> 

<span data-ttu-id="fd6ba-146">Come appaiono i domini sbilanciati?</span><span class="sxs-lookup"><span data-stu-id="fd6ba-146">What do imbalanced domains look like?</span></span> <span data-ttu-id="fd6ba-147">La figura seguente illustra due diversi layout per un cluster.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-147">In the diagram below, we show two different cluster layouts.</span></span> <span data-ttu-id="fd6ba-148">Nel primo esempio i nodi sono distribuiti uniformemente tra i domini di errore.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-148">In the first example, the nodes are distributed evenly across the Fault Domains.</span></span> <span data-ttu-id="fd6ba-149">Nel secondo esempio, un dominio di errore presenta molti più nodi degli altri.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-149">In the second example, one Fault Domain has many more nodes than the other Fault Domains.</span></span> 

<span data-ttu-id="fd6ba-150"><center>
![Due layout diversi per i cluster][Image2]
</center></span><span class="sxs-lookup"><span data-stu-id="fd6ba-150"><center>
![Two different cluster layouts][Image2]
</center></span></span>

<span data-ttu-id="fd6ba-151">In Azure la scelta di quale dominio di errore deve contenere un nodo viene gestita automaticamente.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-151">In Azure, the choice of which Fault Domain contains a node is managed for you.</span></span> <span data-ttu-id="fd6ba-152">Tuttavia, a seconda del numero di nodi di cui si esegue il provisioning, si possono comunque ottenere domini di errore con più nodi di altri.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-152">However, depending on the number of nodes that you provision you can still end up with Fault Domains with more nodes in them than others.</span></span> <span data-ttu-id="fd6ba-153">Si immagini ad esempio di avere cinque domini di errore nel cluster e di eseguire il provisioning di sette nodi per un determinato NodeType.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-153">For example, say you have five Fault Domains in the cluster but provision seven nodes for a given NodeType.</span></span> <span data-ttu-id="fd6ba-154">In questo caso i primi due domini di errore avranno più nodi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-154">In this case, the first two Fault Domains end up with more nodes.</span></span> <span data-ttu-id="fd6ba-155">Se si continua a distribuire altri NodeType con solo un paio di istanze, il problema peggiora.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-155">If you continue to deploy more NodeTypes with only a couple instances, the problem gets worse.</span></span> <span data-ttu-id="fd6ba-156">Per questo motivo è consigliabile che il numero di nodi in ogni NodeType sia multiplo del numero di domini di errore.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-156">For this reason it's recommended that the number of nodes in each node type is a multiple of the number of Fault Domains.</span></span>

## <a name="upgrade-domains"></a><span data-ttu-id="fd6ba-157">Domini di aggiornamento</span><span class="sxs-lookup"><span data-stu-id="fd6ba-157">Upgrade domains</span></span>
<span data-ttu-id="fd6ba-158">I domini di aggiornamento sono un'altra funzionalità che aiuta Cluster Resource Manager di Service Fabric a comprendere il layout del cluster.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-158">Upgrade Domains are another feature that helps the Service Fabric Cluster Resource Manager understand the layout of the cluster.</span></span> <span data-ttu-id="fd6ba-159">I domini di aggiornamento definiscono set di nodi che vengono aggiornati contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-159">Upgrade Domains define sets of nodes that are upgraded at the same time.</span></span> <span data-ttu-id="fd6ba-160">I domini di aggiornamento aiutano Cluster Resource Manager a comprendere e orchestrare le operazioni di gestione come gli aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-160">Upgrade Domains help the Cluster Resource Manager understand and orchestrate management operations like upgrades.</span></span>

<span data-ttu-id="fd6ba-161">I domini di aggiornamento sono molto simili ai domini di errore, ma con un paio di differenze essenziali.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-161">Upgrade Domains are a lot like Fault Domains, but with a couple key differences.</span></span> <span data-ttu-id="fd6ba-162">Innanzitutto, i domini di errore vengono definiti da aree di errori hardware coordinati.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-162">First, areas of coordinated hardware failures define Fault Domains.</span></span> <span data-ttu-id="fd6ba-163">I domini di aggiornamento invece vengono definiti dai criteri.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-163">Upgrade Domains, on the other hand, are defined by policy.</span></span> <span data-ttu-id="fd6ba-164">È possibile deciderne il numero desiderato, in quanto la decisione non viene presa dall'ambiente.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-164">You get to decide how many you want, rather than it being dictated by the environment.</span></span> <span data-ttu-id="fd6ba-165">È possibile disporre dello stesso numero di domini di aggiornamento e di nodi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-165">You could have as many Upgrade Domains as you do nodes.</span></span> <span data-ttu-id="fd6ba-166">Un'altra differenza tra i domini di errore e i domini di aggiornamento è che questi ultimi non sono gerarchici.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-166">Another difference between Fault Domains and Upgrade Domains is that Upgrade Domains are not hierarchical.</span></span> <span data-ttu-id="fd6ba-167">Sono invece più simili a un semplice tag.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-167">Instead, they are more like a simple tag.</span></span> 

<span data-ttu-id="fd6ba-168">Il diagramma seguente mostra tre domini di aggiornamento distribuiti su tre domini di errore.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-168">The following diagram shows three Upgrade Domains are striped across three Fault Domains.</span></span> <span data-ttu-id="fd6ba-169">Illustra anche una sola posizione possibile per tre repliche diverse di un servizio con stato, dove ciascuna finisce in diversi domini di errore e di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-169">It also shows one possible placement for three different replicas of a stateful service, where each ends up in different Fault and Upgrade Domains.</span></span> <span data-ttu-id="fd6ba-170">Questo posizionamento consente la perdita di un dominio di errore mentre è in corso un aggiornamento del servizio, mantenendo comunque una copia del codice e dei dati.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-170">This placement allows the loss of a Fault Domain while in the middle of a service upgrade and still have one copy of the code and data.</span></span>  

<span data-ttu-id="fd6ba-171"><center>
![Posizionamento con domini di errore e di aggiornamento][Image3]
</center></span><span class="sxs-lookup"><span data-stu-id="fd6ba-171"><center>
![Placement With Fault and Upgrade Domains][Image3]
</center></span></span>

<span data-ttu-id="fd6ba-172">L'uso di un numero elevato di domini di aggiornamento presenta vantaggi e svantaggi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-172">There are pros and cons to having large numbers of Upgrade Domains.</span></span> <span data-ttu-id="fd6ba-173">Se si hanno numerosi domini di aggiornamento, ogni passaggio dell'aggiornamento è più dettagliato e quindi influisce su un numero minore di nodi o servizi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-173">More Upgrade Domains means each step of the upgrade is more granular and therefore affects a smaller number of nodes or services.</span></span> <span data-ttu-id="fd6ba-174">Questo si traduce nella necessità di spostare meno servizi contemporaneamente nonché in una minore varianza del sistema.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-174">As a result, fewer services have to move at a time, introducing less churn into the system.</span></span> <span data-ttu-id="fd6ba-175">Anche l'affidabilità tende a migliorare, poiché una parte minore del servizio è interessata da eventuali problemi introdotti durante l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-175">This tends to improve reliability, since less of the service is impacted by any issue introduced during the upgrade.</span></span> <span data-ttu-id="fd6ba-176">La presenza di più domini di aggiornamento significa anche che è richiesto meno buffer disponibile negli altri nodi per gestire l'impatto dell'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-176">More Upgrade Domains also means that you need less available buffer on other nodes to handle the impact of the upgrade.</span></span> <span data-ttu-id="fd6ba-177">Ad esempio, se si dispone di cinque domini di aggiornamento, i nodi di ciascuno gestiscono circa il 20% del traffico.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-177">For example, if you have five Upgrade Domains, the nodes in each are handling roughly 20% of your traffic.</span></span> <span data-ttu-id="fd6ba-178">Se è necessario bloccare il dominio di aggiornamento per un aggiornamento, il suo carico deve essere in genere trasferito altrove.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-178">If you need to take down that Upgrade Domain for an upgrade, that load usually needs to go somewhere.</span></span> <span data-ttu-id="fd6ba-179">Poiché sono presenti quattro domini di aggiornamento rimanenti, ognuno deve disporre di spazio per circa il 5% del traffico totale.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-179">Since you have four remaining Upgrade Domains, each must have room for about 5% of the total traffic.</span></span> <span data-ttu-id="fd6ba-180">Più domini di aggiornamento implicano la necessità di meno buffer nei nodi del cluster.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-180">More Upgrade Domains means you need less buffer on the nodes in the cluster.</span></span> <span data-ttu-id="fd6ba-181">Si consideri, ad esempio, di disporre invece di dieci domini di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-181">For example, consider if you had 10 Upgrade Domains instead.</span></span> <span data-ttu-id="fd6ba-182">In questo caso ogni dominio di aggiornamento dovrebbe gestire solo circa il 10% del traffico totale.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-182">In that case, each UD would only be handling about 10% of the total traffic.</span></span> <span data-ttu-id="fd6ba-183">Quando un aggiornamento passa per il cluster, ogni dominio deve avere spazio solo per circa l'1,1% del traffico totale.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-183">When an upgrade steps through the cluster, each domain would only need to have room for about 1.1% of the total traffic.</span></span> <span data-ttu-id="fd6ba-184">Un maggior numero di domini di aggiornamento in genere consente un maggiore uso dei nodi, poiché è necessaria una capacità di riserva minore.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-184">More Upgrade Domains generally allow you to run your nodes at higher utilization, since you need less reserved capacity.</span></span> <span data-ttu-id="fd6ba-185">Lo stesso vale per i domini di errore.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-185">The same is true for Fault Domains.</span></span>  

<span data-ttu-id="fd6ba-186">Lo svantaggio di avere molti domini di aggiornamento è che gli aggiornamenti tendono a richiedere più tempo.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-186">The downside of having many Upgrade Domains is that upgrades tend to take longer.</span></span> <span data-ttu-id="fd6ba-187">Service Fabric attende per un breve periodo dopo il completamento di un aggiornamento ed esegue i controlli prima di avviare l'aggiornamento successivo.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-187">Service Fabric waits a short period of time after an Upgrade Domain is completed and performs checks before starting to upgrade the next one.</span></span> <span data-ttu-id="fd6ba-188">Questi ritardi consentono di rilevare i problemi introdotti in seguito all'aggiornamento prima che l'aggiornamento continui.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-188">These delays enable detecting issues introduced by the upgrade before the upgrade proceeds.</span></span> <span data-ttu-id="fd6ba-189">Questo compromesso è accettabile perché evita che modifiche non valide abbiano un impatto eccessivo sul servizio in un determinato momento.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-189">The tradeoff is acceptable because it prevents bad changes from affecting too much of the service at a time.</span></span>

<span data-ttu-id="fd6ba-190">Anche l'uso di un numero troppo ridotto di domini di aggiornamento ha effetti collaterali negativi: mentre ogni singolo dominio di aggiornamento è inattivo e in fase di aggiornamento, una parte elevata della capacità complessiva non risulta disponibile.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-190">Too few Upgrade Domains has many negative side effects – while each individual Upgrade Domain is down and being upgraded a large portion of your overall capacity is unavailable.</span></span> <span data-ttu-id="fd6ba-191">Ad esempio, se sono presenti solo tre domini di aggiornamento, 1/3 circa della capacità complessiva del servizio o del cluster non sarà disponibile in un determinato momento.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-191">For example, if you only have three Upgrade Domains you are taking down about 1/3 of your overall service or cluster capacity at a time.</span></span> <span data-ttu-id="fd6ba-192">Avere una parte così grande del servizio inattiva contemporaneamente non è auspicabile poiché è necessario disporre di capacità sufficiente nel resto del cluster per gestire il carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-192">Having so much of your service down at once isn’t desirable since you have to have enough capacity in the rest of your cluster to handle the workload.</span></span> <span data-ttu-id="fd6ba-193">Gestire quel buffer significa che durante il normale funzionamento i nodi avranno minor carico di quanto dovuto.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-193">Maintaining that buffer means that during normal operation those nodes are less loaded than they would be otherwise.</span></span> <span data-ttu-id="fd6ba-194">Questo approccio implica un aumento del costo di esecuzione del servizio.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-194">This increases the cost of running your service.</span></span>

<span data-ttu-id="fd6ba-195">Non è previsto alcun limite effettivo per il numero totale di domini di errore o di aggiornamento in un ambiente e non sono previsti vincoli per le relative sovrapposizioni.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-195">There’s no real limit to the total number of fault or Upgrade Domains in an environment, or constraints on how they overlap.</span></span> <span data-ttu-id="fd6ba-196">Ciò premesso, sono disponibili vari modelli comuni:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-196">That said, there are several common patterns:</span></span>

- <span data-ttu-id="fd6ba-197">Corrispondenza 1:1 fra domini di errore e domini di aggiornamento</span><span class="sxs-lookup"><span data-stu-id="fd6ba-197">Fault Domains and Upgrade Domains mapped 1:1</span></span>
- <span data-ttu-id="fd6ba-198">Un dominio di aggiornamento per nodo (istanza del sistema operativo fisico o virtuale)</span><span class="sxs-lookup"><span data-stu-id="fd6ba-198">One Upgrade Domain per Node (physical or virtual OS instance)</span></span>
- <span data-ttu-id="fd6ba-199">Un modello con "striping" o a "matrice" in cui i domini di errore e i domini di aggiornamento formano una matrice e i computer sono disposti lungo le diagonali</span><span class="sxs-lookup"><span data-stu-id="fd6ba-199">A “striped” or “matrix” model where the Fault Domains and Upgrade Domains form a matrix with machines usually running down the diagonals</span></span>

<span data-ttu-id="fd6ba-200"><center>
![Layout dei domini di errore e di aggiornamento][Image4]
</center></span><span class="sxs-lookup"><span data-stu-id="fd6ba-200"><center>
![Fault and Upgrade Domain Layouts][Image4]
</center></span></span>

<span data-ttu-id="fd6ba-201">Non esiste un layout ottimale, ogni layout presenta vantaggi e svantaggi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-201">There’s no best answer which layout to choose, each has some pros and cons.</span></span> <span data-ttu-id="fd6ba-202">Ad esempio, il modello di tipo 1FD:1UD è semplice da configurare.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-202">For example, the 1FD:1UD model is simple to set up.</span></span> <span data-ttu-id="fd6ba-203">Il modello con un dominio di aggiornamento per nodo è probabilmente quello più noto.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-203">The 1 Upgrade Domain per Node model is most like what people are used to.</span></span> <span data-ttu-id="fd6ba-204">Durante l'aggiornamento, ogni nodo viene aggiornato in modo indipendente.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-204">During upgrades each node is updated independently.</span></span> <span data-ttu-id="fd6ba-205">È simile alla modalità con la quale un piccolo gruppo di computer veniva aggiornato manualmente in passato.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-205">This is similar to how small sets of machines were upgraded manually in the past.</span></span> 

<span data-ttu-id="fd6ba-206">Il modello più comune è basato sulla matrice FD/UD, in cui i domini di errore e i domini di aggiornamento formano una tabella e i nodi vengono posizionati a partire dalla diagonale.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-206">The most common model is the FD/UD matrix, where the FDs and UDs form a table and nodes are placed starting along the diagonal.</span></span> <span data-ttu-id="fd6ba-207">È il modello usato per impostazione predefinita nei cluster di Service Fabric in Azure.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-207">This is the model used by default in Service Fabric clusters in Azure.</span></span> <span data-ttu-id="fd6ba-208">Per i cluster con molti nodi, il risultato è simile al complesso modello di matrice precedente.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-208">For clusters with many nodes everything ends up looking like the dense matrix pattern above.</span></span>

## <a name="fault-and-upgrade-domain-constraints-and-resulting-behavior"></a><span data-ttu-id="fd6ba-209">Vincoli del dominio di errore e di aggiornamento e comportamento risultante</span><span class="sxs-lookup"><span data-stu-id="fd6ba-209">Fault and Upgrade Domain constraints and resulting behavior</span></span>
<span data-ttu-id="fd6ba-210">Cluster Resource Manager considera come un vincolo il desiderio di mantenere un servizio bilanciato tra domini di errore e di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-210">The Cluster Resource Manager treats the desire to keep a service balanced across fault and Upgrade Domains as a constraint.</span></span> <span data-ttu-id="fd6ba-211">È possibile trovare altre informazioni sui vincoli [in questo articolo](service-fabric-cluster-resource-manager-management-integration.md).</span><span class="sxs-lookup"><span data-stu-id="fd6ba-211">You can find out more about constraints in [this article](service-fabric-cluster-resource-manager-management-integration.md).</span></span> <span data-ttu-id="fd6ba-212">I vincoli di dominio di errore e di aggiornamento stabiliscono: "Per una data partizione di servizio non deve esistere una differenza *maggiore di uno* nel numero di oggetti servizio (istanze di servizio senza stato o repliche con stato) tra due domini".</span><span class="sxs-lookup"><span data-stu-id="fd6ba-212">The Fault and Upgrade Domain constraints state: "For a given service partition there should never be a difference *greater than one* in the number of service objects (stateless service instances or stateful service replicas) between two domains."</span></span> <span data-ttu-id="fd6ba-213">Ciò impedisce determinati spostamenti o disposizioni che violano il vincolo.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-213">This prevents certain moves or arrangements that violate this constraint.</span></span>

<span data-ttu-id="fd6ba-214">Esaminiamo un esempio.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-214">Let's look at one example.</span></span> <span data-ttu-id="fd6ba-215">Si supponga di avere un cluster con sei nodi, configurato con cinque domini di errore e cinque domini di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-215">Let's say that we have a cluster with six nodes, configured with five Fault Domains and five Upgrade Domains.</span></span>

|  | <span data-ttu-id="fd6ba-216">FD0</span><span class="sxs-lookup"><span data-stu-id="fd6ba-216">FD0</span></span> | <span data-ttu-id="fd6ba-217">FD1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-217">FD1</span></span> | <span data-ttu-id="fd6ba-218">FD2</span><span class="sxs-lookup"><span data-stu-id="fd6ba-218">FD2</span></span> | <span data-ttu-id="fd6ba-219">FD3</span><span class="sxs-lookup"><span data-stu-id="fd6ba-219">FD3</span></span> | <span data-ttu-id="fd6ba-220">FD4</span><span class="sxs-lookup"><span data-stu-id="fd6ba-220">FD4</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="fd6ba-221">**UD0**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-221">**UD0**</span></span> |<span data-ttu-id="fd6ba-222">N1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-222">N1</span></span> | | | | |
| <span data-ttu-id="fd6ba-223">**UD1**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-223">**UD1**</span></span> |<span data-ttu-id="fd6ba-224">N6</span><span class="sxs-lookup"><span data-stu-id="fd6ba-224">N6</span></span> |<span data-ttu-id="fd6ba-225">N2</span><span class="sxs-lookup"><span data-stu-id="fd6ba-225">N2</span></span> | | | |
| <span data-ttu-id="fd6ba-226">**UD2**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-226">**UD2**</span></span> | | |<span data-ttu-id="fd6ba-227">N3</span><span class="sxs-lookup"><span data-stu-id="fd6ba-227">N3</span></span> | | |
| <span data-ttu-id="fd6ba-228">**UD3**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-228">**UD3**</span></span> | | | |<span data-ttu-id="fd6ba-229">N4</span><span class="sxs-lookup"><span data-stu-id="fd6ba-229">N4</span></span> | |
| <span data-ttu-id="fd6ba-230">**UD4**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-230">**UD4**</span></span> | | | | |<span data-ttu-id="fd6ba-231">N5</span><span class="sxs-lookup"><span data-stu-id="fd6ba-231">N5</span></span> |

<span data-ttu-id="fd6ba-232">Si supponga ora di creare un servizio con TargetReplicaSetSize (oppure, per un servizio senza stato InstanceCount) pari a cinque.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-232">Now let's say that we create a service with a TargetReplicaSetSize (or, for a stateless service an InstanceCount) of five.</span></span> <span data-ttu-id="fd6ba-233">Le repliche avvengono in N1 N5.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-233">The replicas land on N1-N5.</span></span> <span data-ttu-id="fd6ba-234">N6 non verrà mai usato indipendentemente dal numero di servizi simili creati.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-234">In fact, N6 is never used no matter how many services like this you create.</span></span> <span data-ttu-id="fd6ba-235">Ma perché?</span><span class="sxs-lookup"><span data-stu-id="fd6ba-235">But why?</span></span> <span data-ttu-id="fd6ba-236">Esaminiamo la differenza tra il layout corrente e ciò che accadrebbe se si scegliesse N6.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-236">Let's look at the difference between the current layout and what would happen if N6 is chosen.</span></span>

<span data-ttu-id="fd6ba-237">Ecco il layout ottenuto e il numero totale di repliche per ogni dominio di errore e di aggiornamento:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-237">Here's the layout we got and the total number of replicas per Fault and Upgrade Domain:</span></span>

|  | <span data-ttu-id="fd6ba-238">FD0</span><span class="sxs-lookup"><span data-stu-id="fd6ba-238">FD0</span></span> | <span data-ttu-id="fd6ba-239">FD1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-239">FD1</span></span> | <span data-ttu-id="fd6ba-240">FD2</span><span class="sxs-lookup"><span data-stu-id="fd6ba-240">FD2</span></span> | <span data-ttu-id="fd6ba-241">FD3</span><span class="sxs-lookup"><span data-stu-id="fd6ba-241">FD3</span></span> | <span data-ttu-id="fd6ba-242">FD4</span><span class="sxs-lookup"><span data-stu-id="fd6ba-242">FD4</span></span> | <span data-ttu-id="fd6ba-243">UDTotal</span><span class="sxs-lookup"><span data-stu-id="fd6ba-243">UDTotal</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="fd6ba-244">**UD0**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-244">**UD0**</span></span> |<span data-ttu-id="fd6ba-245">R1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-245">R1</span></span> | | | | |<span data-ttu-id="fd6ba-246">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-246">1</span></span> |
| <span data-ttu-id="fd6ba-247">**UD1**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-247">**UD1**</span></span> | |<span data-ttu-id="fd6ba-248">R2</span><span class="sxs-lookup"><span data-stu-id="fd6ba-248">R2</span></span> | | | |<span data-ttu-id="fd6ba-249">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-249">1</span></span> |
| <span data-ttu-id="fd6ba-250">**UD2**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-250">**UD2**</span></span> | | |<span data-ttu-id="fd6ba-251">R3</span><span class="sxs-lookup"><span data-stu-id="fd6ba-251">R3</span></span> | | |<span data-ttu-id="fd6ba-252">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-252">1</span></span> |
| <span data-ttu-id="fd6ba-253">**UD3**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-253">**UD3**</span></span> | | | |<span data-ttu-id="fd6ba-254">R4</span><span class="sxs-lookup"><span data-stu-id="fd6ba-254">R4</span></span> | |<span data-ttu-id="fd6ba-255">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-255">1</span></span> |
| <span data-ttu-id="fd6ba-256">**UD4**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-256">**UD4**</span></span> | | | | |<span data-ttu-id="fd6ba-257">R5</span><span class="sxs-lookup"><span data-stu-id="fd6ba-257">R5</span></span> |<span data-ttu-id="fd6ba-258">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-258">1</span></span> |
| <span data-ttu-id="fd6ba-259">**FDTotal**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-259">**FDTotal**</span></span> |<span data-ttu-id="fd6ba-260">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-260">1</span></span> |<span data-ttu-id="fd6ba-261">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-261">1</span></span> |<span data-ttu-id="fd6ba-262">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-262">1</span></span> |<span data-ttu-id="fd6ba-263">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-263">1</span></span> |<span data-ttu-id="fd6ba-264">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-264">1</span></span> |- |

<span data-ttu-id="fd6ba-265">Questo layout è equilibrato in termini di nodi per dominio di errore e dominio di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-265">This layout is balanced in terms of nodes per Fault Domain and Upgrade Domain.</span></span> <span data-ttu-id="fd6ba-266">È anche bilanciato in termini di numero di repliche per dominio di errore e dominio di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-266">It is also balanced in terms of the number of replicas per Fault and Upgrade Domain.</span></span> <span data-ttu-id="fd6ba-267">Ogni dominio ha lo stesso numero di nodi e lo stesso numero di repliche.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-267">Each domain has the same number of nodes and the same number of replicas.</span></span>

<span data-ttu-id="fd6ba-268">A questo punto vediamo cosa accadrebbe se usassimo N6 invece di N2.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-268">Now, let's look at what would happen if we'd used N6 instead of N2.</span></span> <span data-ttu-id="fd6ba-269">Come sarebbero state distribuite le repliche?</span><span class="sxs-lookup"><span data-stu-id="fd6ba-269">How would the replicas be distributed then?</span></span>

|  | <span data-ttu-id="fd6ba-270">FD0</span><span class="sxs-lookup"><span data-stu-id="fd6ba-270">FD0</span></span> | <span data-ttu-id="fd6ba-271">FD1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-271">FD1</span></span> | <span data-ttu-id="fd6ba-272">FD2</span><span class="sxs-lookup"><span data-stu-id="fd6ba-272">FD2</span></span> | <span data-ttu-id="fd6ba-273">FD3</span><span class="sxs-lookup"><span data-stu-id="fd6ba-273">FD3</span></span> | <span data-ttu-id="fd6ba-274">FD4</span><span class="sxs-lookup"><span data-stu-id="fd6ba-274">FD4</span></span> | <span data-ttu-id="fd6ba-275">UDTotal</span><span class="sxs-lookup"><span data-stu-id="fd6ba-275">UDTotal</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="fd6ba-276">**UD0**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-276">**UD0**</span></span> |<span data-ttu-id="fd6ba-277">R1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-277">R1</span></span> | | | | |<span data-ttu-id="fd6ba-278">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-278">1</span></span> |
| <span data-ttu-id="fd6ba-279">**UD1**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-279">**UD1**</span></span> |<span data-ttu-id="fd6ba-280">R5</span><span class="sxs-lookup"><span data-stu-id="fd6ba-280">R5</span></span> | | | | |<span data-ttu-id="fd6ba-281">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-281">1</span></span> |
| <span data-ttu-id="fd6ba-282">**UD2**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-282">**UD2**</span></span> | | |<span data-ttu-id="fd6ba-283">R2</span><span class="sxs-lookup"><span data-stu-id="fd6ba-283">R2</span></span> | | |<span data-ttu-id="fd6ba-284">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-284">1</span></span> |
| <span data-ttu-id="fd6ba-285">**UD3**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-285">**UD3**</span></span> | | | |<span data-ttu-id="fd6ba-286">R3</span><span class="sxs-lookup"><span data-stu-id="fd6ba-286">R3</span></span> | |<span data-ttu-id="fd6ba-287">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-287">1</span></span> |
| <span data-ttu-id="fd6ba-288">**UD4**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-288">**UD4**</span></span> | | | | |<span data-ttu-id="fd6ba-289">R4</span><span class="sxs-lookup"><span data-stu-id="fd6ba-289">R4</span></span> |<span data-ttu-id="fd6ba-290">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-290">1</span></span> |
| <span data-ttu-id="fd6ba-291">**FDTotal**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-291">**FDTotal**</span></span> |<span data-ttu-id="fd6ba-292">2</span><span class="sxs-lookup"><span data-stu-id="fd6ba-292">2</span></span> |<span data-ttu-id="fd6ba-293">0</span><span class="sxs-lookup"><span data-stu-id="fd6ba-293">0</span></span> |<span data-ttu-id="fd6ba-294">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-294">1</span></span> |<span data-ttu-id="fd6ba-295">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-295">1</span></span> |<span data-ttu-id="fd6ba-296">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-296">1</span></span> |- |

<span data-ttu-id="fd6ba-297">Questo layout viola la definizione del vincolo di dominio di errore.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-297">This layout violates our definition for the Fault Domain constraint.</span></span> <span data-ttu-id="fd6ba-298">FD0 ha due repliche, mentre FD1 ne ha zero, perciò la differenza tra FD0 e FD1 è due.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-298">FD0 has two replicas, while FD1 has zero, making the difference between FD0 and FD1 a total of two.</span></span> <span data-ttu-id="fd6ba-299">Cluster Resource Manager non consente questa disposizione.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-299">The Cluster Resource Manager does not allow this arrangement.</span></span> <span data-ttu-id="fd6ba-300">Allo stesso modo, se si scegliesse N2 e N6 (anziché N1 e N2) si otterrebbe:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-300">Similarly if we picked N2 and N6 (instead of N1 and N2) we'd get:</span></span>

|  | <span data-ttu-id="fd6ba-301">FD0</span><span class="sxs-lookup"><span data-stu-id="fd6ba-301">FD0</span></span> | <span data-ttu-id="fd6ba-302">FD1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-302">FD1</span></span> | <span data-ttu-id="fd6ba-303">FD2</span><span class="sxs-lookup"><span data-stu-id="fd6ba-303">FD2</span></span> | <span data-ttu-id="fd6ba-304">FD3</span><span class="sxs-lookup"><span data-stu-id="fd6ba-304">FD3</span></span> | <span data-ttu-id="fd6ba-305">FD4</span><span class="sxs-lookup"><span data-stu-id="fd6ba-305">FD4</span></span> | <span data-ttu-id="fd6ba-306">UDTotal</span><span class="sxs-lookup"><span data-stu-id="fd6ba-306">UDTotal</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="fd6ba-307">**UD0**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-307">**UD0**</span></span> | | | | | |<span data-ttu-id="fd6ba-308">0</span><span class="sxs-lookup"><span data-stu-id="fd6ba-308">0</span></span> |
| <span data-ttu-id="fd6ba-309">**UD1**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-309">**UD1**</span></span> |<span data-ttu-id="fd6ba-310">R5</span><span class="sxs-lookup"><span data-stu-id="fd6ba-310">R5</span></span> |<span data-ttu-id="fd6ba-311">R1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-311">R1</span></span> | | | |<span data-ttu-id="fd6ba-312">2</span><span class="sxs-lookup"><span data-stu-id="fd6ba-312">2</span></span> |
| <span data-ttu-id="fd6ba-313">**UD2**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-313">**UD2**</span></span> | | |<span data-ttu-id="fd6ba-314">R2</span><span class="sxs-lookup"><span data-stu-id="fd6ba-314">R2</span></span> | | |<span data-ttu-id="fd6ba-315">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-315">1</span></span> |
| <span data-ttu-id="fd6ba-316">**UD3**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-316">**UD3**</span></span> | | | |<span data-ttu-id="fd6ba-317">R3</span><span class="sxs-lookup"><span data-stu-id="fd6ba-317">R3</span></span> | |<span data-ttu-id="fd6ba-318">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-318">1</span></span> |
| <span data-ttu-id="fd6ba-319">**UD4**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-319">**UD4**</span></span> | | | | |<span data-ttu-id="fd6ba-320">R4</span><span class="sxs-lookup"><span data-stu-id="fd6ba-320">R4</span></span> |<span data-ttu-id="fd6ba-321">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-321">1</span></span> |
| <span data-ttu-id="fd6ba-322">**FDTotal**</span><span class="sxs-lookup"><span data-stu-id="fd6ba-322">**FDTotal**</span></span> |<span data-ttu-id="fd6ba-323">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-323">1</span></span> |<span data-ttu-id="fd6ba-324">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-324">1</span></span> |<span data-ttu-id="fd6ba-325">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-325">1</span></span> |<span data-ttu-id="fd6ba-326">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-326">1</span></span> |<span data-ttu-id="fd6ba-327">1</span><span class="sxs-lookup"><span data-stu-id="fd6ba-327">1</span></span> |- |

<span data-ttu-id="fd6ba-328">Questo layout è bilanciato in termini di domini di errore.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-328">This layout is balanced in terms of Fault Domains.</span></span> <span data-ttu-id="fd6ba-329">Viola tuttavia il vincolo del dominio di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-329">However, now it's violating the Upgrade Domain constraint.</span></span> <span data-ttu-id="fd6ba-330">Ciò avviene perché UD0 ha zero repliche mentre UD1 ne ha due.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-330">This is because UD0 has zero replicas while UD1 has two.</span></span> <span data-ttu-id="fd6ba-331">Questo layout inoltre non è valido e non verrà scelto da Cluster Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-331">Therefore, this layout is also invalid and won't be picked by the Cluster Resource Manager.</span></span> 

## <a name="configuring-fault-and-upgrade-domains"></a><span data-ttu-id="fd6ba-332">Configurazione dei domini di errore e di aggiornamento</span><span class="sxs-lookup"><span data-stu-id="fd6ba-332">Configuring fault and Upgrade Domains</span></span>
<span data-ttu-id="fd6ba-333">La definizione dei domini di errore e dei domini di aggiornamento viene eseguita automaticamente nelle distribuzioni di Service Fabric ospitate in Azure.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-333">Defining Fault Domains and Upgrade Domains is done automatically in Azure hosted Service Fabric deployments.</span></span> <span data-ttu-id="fd6ba-334">Service Fabric recupera semplicemente le informazioni sull'ambiente da Azure e le usa.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-334">Service Fabric picks up and uses the environment information from Azure.</span></span>

<span data-ttu-id="fd6ba-335">Se si sta creando il proprio cluster o si desidera seguire una particolare topologia, è possibile specificare manualmente le informazioni sul dominio di errore e sul dominio di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-335">If you’re creating your own cluster (or want to run a particular topology in development), you can provide the Fault Domain and Upgrade Domain information yourself.</span></span> <span data-ttu-id="fd6ba-336">In questo esempio definiamo un cluster di sviluppo locale con nove nodi che si estende su tre "data center" (ognuno con tre rack).</span><span class="sxs-lookup"><span data-stu-id="fd6ba-336">In this example, we define a nine node local development cluster that spans three “datacenters” (each with three racks).</span></span> <span data-ttu-id="fd6ba-337">Il cluster ha anche tre domini di aggiornamento distribuiti sui tre data center.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-337">This cluster also has three Upgrade Domains striped across those three datacenters.</span></span> <span data-ttu-id="fd6ba-338">Di seguito viene riportato un esempio di configurazione:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-338">An example of the configuration is below:</span></span> 

<span data-ttu-id="fd6ba-339">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="fd6ba-339">ClusterManifest.xml</span></span>

```xml
  <Infrastructure>
    <!-- IsScaleMin indicates that this cluster runs on one-box /one single server -->
    <WindowsServer IsScaleMin="true">
      <NodeList>
        <Node NodeName="Node01" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType01" FaultDomain="fd:/DC01/Rack01" UpgradeDomain="UpgradeDomain1" IsSeedNode="true" />
        <Node NodeName="Node02" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType02" FaultDomain="fd:/DC01/Rack02" UpgradeDomain="UpgradeDomain2" IsSeedNode="true" />
        <Node NodeName="Node03" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType03" FaultDomain="fd:/DC01/Rack03" UpgradeDomain="UpgradeDomain3" IsSeedNode="true" />
        <Node NodeName="Node04" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType04" FaultDomain="fd:/DC02/Rack01" UpgradeDomain="UpgradeDomain1" IsSeedNode="true" />
        <Node NodeName="Node05" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType05" FaultDomain="fd:/DC02/Rack02" UpgradeDomain="UpgradeDomain2" IsSeedNode="true" />
        <Node NodeName="Node06" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType06" FaultDomain="fd:/DC02/Rack03" UpgradeDomain="UpgradeDomain3" IsSeedNode="true" />
        <Node NodeName="Node07" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType07" FaultDomain="fd:/DC03/Rack01" UpgradeDomain="UpgradeDomain1" IsSeedNode="true" />
        <Node NodeName="Node08" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType08" FaultDomain="fd:/DC03/Rack02" UpgradeDomain="UpgradeDomain2" IsSeedNode="true" />
        <Node NodeName="Node09" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType09" FaultDomain="fd:/DC03/Rack03" UpgradeDomain="UpgradeDomain3" IsSeedNode="true" />
      </NodeList>
    </WindowsServer>
  </Infrastructure>
```

<span data-ttu-id="fd6ba-340">mediante ClusterConfig.json per le distribuzioni autonome</span><span class="sxs-lookup"><span data-stu-id="fd6ba-340">via ClusterConfig.json for Standalone deployments</span></span>

```json
"nodes": [
  {
    "nodeName": "vm1",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc1/r0",
    "upgradeDomain": "UD1"
  },
  {
    "nodeName": "vm2",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc1/r0",
    "upgradeDomain": "UD2"
  },
  {
    "nodeName": "vm3",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc1/r0",
    "upgradeDomain": "UD3"
  },
  {
    "nodeName": "vm4",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc2/r0",
    "upgradeDomain": "UD1"
  },
  {
    "nodeName": "vm5",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc2/r0",
    "upgradeDomain": "UD2"
  },
  {
    "nodeName": "vm6",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc2/r0",
    "upgradeDomain": "UD3"
  },
  {
    "nodeName": "vm7",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc3/r0",
    "upgradeDomain": "UD1"
  },
  {
    "nodeName": "vm8",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc3/r0",
    "upgradeDomain": "UD2"
  },
  {
    "nodeName": "vm9",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc3/r0",
    "upgradeDomain": "UD3"
  }
],
```

> [!NOTE]
> <span data-ttu-id="fd6ba-341">Quando si definiscono i cluster con Azure Resource Manager, Azure assegna i domini di errore e i domini di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-341">When defining clusters via Azure Resource Manager, Fault Domains and Upgrade Domains are assigned by Azure.</span></span> <span data-ttu-id="fd6ba-342">Pertanto, la definizione dei tipi di nodo e dei set di scalabilità delle macchine virtuali nel modello di Azure Resource Manager non include informazioni sul dominio di aggiornamento o sul dominio di errore.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-342">Therefore, the definition of your Node Types and Virtual Machine Scale Sets in your Azure Resource Manager template does not include Fault Domain or Upgrade Domain information.</span></span>
>

## <a name="node-properties-and-placement-constraints"></a><span data-ttu-id="fd6ba-343">Proprietà dei nodi e vincoli di posizionamento</span><span class="sxs-lookup"><span data-stu-id="fd6ba-343">Node properties and placement constraints</span></span>
<span data-ttu-id="fd6ba-344">Nella maggior parte dei casi, si vuole assicurare che determinati carichi di lavoro vengano eseguiti solo su determinati tipi di nodi nel cluster.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-344">Sometimes (in fact, most of the time) you’re going to want to ensure that certain workloads run only on certain types of nodes in the cluster.</span></span> <span data-ttu-id="fd6ba-345">Ad esempio, è possibile che alcuni carichi di lavoro richiedano GPU o SSD, mentre altri no.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-345">For example, some workload may require GPUs or SSDs while others may not.</span></span> <span data-ttu-id="fd6ba-346">Un ottimo esempio di uso dell'hardware per carichi di lavoro specifici è dato da quasi tutte le architettura a più livelli.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-346">A great example of targeting hardware to particular workloads is almost every n-tier architecture out there.</span></span> <span data-ttu-id="fd6ba-347">Alcuni computer fungono da lato front-end o API dell'applicazione e pertanto sono probabilmente esposti al client o a Internet.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-347">Certain machines serve as the front end or API serving side of the application and are exposed to the clients or the internet.</span></span> <span data-ttu-id="fd6ba-348">Altri computer, spesso con risorse hardware diverse, gestiscono il lavoro dei livelli di calcolo o archiviazione.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-348">Different machines, often with different hardware resources, handle the work of the compute or storage layers.</span></span> <span data-ttu-id="fd6ba-349">In genere _non_ sono esposti direttamente a Internet o ai client.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-349">These are usually _not_ directly exposed to clients or the internet.</span></span> <span data-ttu-id="fd6ba-350">Service Fabric prevede alcune situazioni in cui determinati carichi di lavoro dovranno essere eseguiti in configurazioni hardware specifiche,</span><span class="sxs-lookup"><span data-stu-id="fd6ba-350">Service Fabric expects that there are cases where particular workloads need to run on particular hardware configurations.</span></span> <span data-ttu-id="fd6ba-351">ad esempio:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-351">For example:</span></span>

* <span data-ttu-id="fd6ba-352">Un'applicazione esistente con n livelli è stata "elevata e spostata" in un ambiente Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-352">an existing n-tier application has been “lifted and shifted” into a Service Fabric environment</span></span>
* <span data-ttu-id="fd6ba-353">Un carico di lavoro deve essere eseguito su hardware specifico per finalità di prestazioni, scalabilità o isolamento di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-353">a workload wants to run on specific hardware for performance, scale, or security isolation reasons</span></span>
* <span data-ttu-id="fd6ba-354">Un carico di lavoro deve essere isolato da altri carichi di lavoro per motivi relativi ai criteri o all'uso delle risorse</span><span class="sxs-lookup"><span data-stu-id="fd6ba-354">A workload should be isolated from other workloads for policy or resource consumption reasons</span></span>

<span data-ttu-id="fd6ba-355">Per supportare questi tipi di configurazione, Service Fabric dispone di tag estremamente efficienti applicabili ai nodi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-355">To support these sorts of configurations, Service Fabric has a first class notion of tags that can be applied to nodes.</span></span> <span data-ttu-id="fd6ba-356">Questi tag vengono chiamati **proprietà del nodo**.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-356">These tags are called **node properties**.</span></span> <span data-ttu-id="fd6ba-357">I **vincoli di posizionamento** sono le istruzioni collegate ai singoli servizi che selezionano una o più proprietà del nodo.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-357">**Placement constraints** are the statements attached to individual services that select for one or more node properties.</span></span> <span data-ttu-id="fd6ba-358">Definiscono la posizione in cui i servizi devono essere eseguiti.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-358">Placement constraints define where services should run.</span></span> <span data-ttu-id="fd6ba-359">Il set di vincoli è estendibile: si può usare qualsiasi coppia chiave/valore.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-359">The set of constraints is extensible - any key/value pair can work.</span></span> 

<span data-ttu-id="fd6ba-360"><center>
![Layout di cluster con carichi di lavoro diversi][Image5]
</center></span><span class="sxs-lookup"><span data-stu-id="fd6ba-360"><center>
![Cluster Layout Different Workloads][Image5]
</center></span></span>

### <a name="built-in-node-properties"></a><span data-ttu-id="fd6ba-361">Proprietà predefinite del nodo</span><span class="sxs-lookup"><span data-stu-id="fd6ba-361">Built in node properties</span></span>
<span data-ttu-id="fd6ba-362">Service Fabric definisce alcune proprietà predefinite dei nodi che possono essere successivamente usate automaticamente, senza alcun intervento da parte dell'utente.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-362">Service Fabric defines some default node properties that can be used automatically without the user having to define them.</span></span> <span data-ttu-id="fd6ba-363">Le proprietà predefinite specificate a livello di ogni nodo sono **NodeType** e **NodeName**.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-363">The default properties defined at each node are the **NodeType** and the **NodeName**.</span></span> <span data-ttu-id="fd6ba-364">Ad esempio è possibile scrivere un vincolo di posizionamento come `"(NodeType == NodeType03)"`.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-364">So for example you could write a placement constraint as `"(NodeType == NodeType03)"`.</span></span> <span data-ttu-id="fd6ba-365">NodeType è una delle proprietà più usate.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-365">Generally we have found NodeType to be one of the most commonly used properties.</span></span> <span data-ttu-id="fd6ba-366">È utile poiché ha una corrispondenza di 1:1 con un tipo di computer.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-366">It is useful since it corresponds 1:1 with a type of a machine.</span></span> <span data-ttu-id="fd6ba-367">Ogni tipo di computer corrisponde a un tipo di carico di lavoro in un'applicazione tradizionale a più livelli.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-367">Each type of machine corresponds to a type of workload in a traditional n-tier application.</span></span>

<span data-ttu-id="fd6ba-368"><center>
![Vincoli di posizionamento e proprietà dei nodi][Image6]
</center></span><span class="sxs-lookup"><span data-stu-id="fd6ba-368"><center>
![Placement Constraints and Node Properties][Image6]
</center></span></span>

## <a name="placement-constraint-and-node-property-syntax"></a><span data-ttu-id="fd6ba-369">Vincoli di posizionamento e sintassi delle proprietà dei nodi</span><span class="sxs-lookup"><span data-stu-id="fd6ba-369">Placement Constraint and Node Property Syntax</span></span> 
<span data-ttu-id="fd6ba-370">Il valore specificato nella proprietà del nodo può essere una stringa, un valore booleano o un valore lungo firmato.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-370">The value specified in the node property can be a string, bool, or signed long.</span></span> <span data-ttu-id="fd6ba-371">L'istruzione a livello di servizio è chiamata *vincolo* di posizionamento in quanto vincola la posizione in cui il servizio può essere eseguito nel cluster.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-371">The statement at the service is called a placement *constraint* since it constrains where the service can run in the cluster.</span></span> <span data-ttu-id="fd6ba-372">Il vincolo può essere qualsiasi istruzione booleana che opera sulle diverse proprietà dei nodi nel cluster.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-372">The constraint can be any Boolean statement that operates on the different node properties in the cluster.</span></span> <span data-ttu-id="fd6ba-373">I selettori validi in queste istruzioni booleane sono:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-373">The valid selectors in these boolean statements are:</span></span>

1) <span data-ttu-id="fd6ba-374">controlli condizionali per la creazione di istruzioni specifiche</span><span class="sxs-lookup"><span data-stu-id="fd6ba-374">conditional checks for creating particular statements</span></span>

| <span data-ttu-id="fd6ba-375">Istruzione</span><span class="sxs-lookup"><span data-stu-id="fd6ba-375">Statement</span></span> | <span data-ttu-id="fd6ba-376">Sintassi</span><span class="sxs-lookup"><span data-stu-id="fd6ba-376">Syntax</span></span> |
| --- |:---:|
| <span data-ttu-id="fd6ba-377">"uguale a"</span><span class="sxs-lookup"><span data-stu-id="fd6ba-377">"equal to"</span></span> | <span data-ttu-id="fd6ba-378">"=="</span><span class="sxs-lookup"><span data-stu-id="fd6ba-378">"=="</span></span> |
| <span data-ttu-id="fd6ba-379">"diverso da"</span><span class="sxs-lookup"><span data-stu-id="fd6ba-379">"not equal to"</span></span> | <span data-ttu-id="fd6ba-380">"!="</span><span class="sxs-lookup"><span data-stu-id="fd6ba-380">"!="</span></span> |
| <span data-ttu-id="fd6ba-381">"maggiore di"</span><span class="sxs-lookup"><span data-stu-id="fd6ba-381">"greater than"</span></span> | <span data-ttu-id="fd6ba-382">">"</span><span class="sxs-lookup"><span data-stu-id="fd6ba-382">">"</span></span> |
| <span data-ttu-id="fd6ba-383">"maggiore o uguale a"</span><span class="sxs-lookup"><span data-stu-id="fd6ba-383">"greater than or equal to"</span></span> | <span data-ttu-id="fd6ba-384">">="</span><span class="sxs-lookup"><span data-stu-id="fd6ba-384">">="</span></span> |
| <span data-ttu-id="fd6ba-385">"minore di"</span><span class="sxs-lookup"><span data-stu-id="fd6ba-385">"less than"</span></span> | <span data-ttu-id="fd6ba-386">"<"</span><span class="sxs-lookup"><span data-stu-id="fd6ba-386">"<"</span></span> |
| <span data-ttu-id="fd6ba-387">"minore o uguale a"</span><span class="sxs-lookup"><span data-stu-id="fd6ba-387">"less than or equal to"</span></span> | <span data-ttu-id="fd6ba-388">"<="</span><span class="sxs-lookup"><span data-stu-id="fd6ba-388">"<="</span></span> |

2) <span data-ttu-id="fd6ba-389">istruzioni booleane per il raggruppamento e le operazioni logiche</span><span class="sxs-lookup"><span data-stu-id="fd6ba-389">boolean statements for grouping and logical operations</span></span>

| <span data-ttu-id="fd6ba-390">Istruzione</span><span class="sxs-lookup"><span data-stu-id="fd6ba-390">Statement</span></span> | <span data-ttu-id="fd6ba-391">Sintassi</span><span class="sxs-lookup"><span data-stu-id="fd6ba-391">Syntax</span></span> |
| --- |:---:|
| <span data-ttu-id="fd6ba-392">"and"</span><span class="sxs-lookup"><span data-stu-id="fd6ba-392">"and"</span></span> | <span data-ttu-id="fd6ba-393">"&&"</span><span class="sxs-lookup"><span data-stu-id="fd6ba-393">"&&"</span></span> |
| <span data-ttu-id="fd6ba-394">"or"</span><span class="sxs-lookup"><span data-stu-id="fd6ba-394">"or"</span></span> | <span data-ttu-id="fd6ba-395">"&#124;&#124;"</span><span class="sxs-lookup"><span data-stu-id="fd6ba-395">"&#124;&#124;"</span></span> |
| <span data-ttu-id="fd6ba-396">"not"</span><span class="sxs-lookup"><span data-stu-id="fd6ba-396">"not"</span></span> | <span data-ttu-id="fd6ba-397">"!"</span><span class="sxs-lookup"><span data-stu-id="fd6ba-397">"!"</span></span> |
| <span data-ttu-id="fd6ba-398">"raggruppamento come singola istruzione"</span><span class="sxs-lookup"><span data-stu-id="fd6ba-398">"group as single statement"</span></span> | <span data-ttu-id="fd6ba-399">"()"</span><span class="sxs-lookup"><span data-stu-id="fd6ba-399">"()"</span></span> |

<span data-ttu-id="fd6ba-400">Di seguito sono riportati alcuni esempi di semplici istruzioni di vincolo.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-400">Here are some examples of basic constraint statements.</span></span>

  * `"Value >= 5"`
  * `"NodeColor != green"`
  * `"((OneProperty < 100) || ((AnotherProperty == false) && (OneProperty >= 100)))"`

<span data-ttu-id="fd6ba-401">È possibile posizionare il servizio solo sui nodi in cui l'istruzione del vincolo di posizionamento generale restituisce "True".</span><span class="sxs-lookup"><span data-stu-id="fd6ba-401">Only nodes where the overall placement constraint statement evaluates to “True” can have the service placed on it.</span></span> <span data-ttu-id="fd6ba-402">I nodi per i quali sono state definite proprietà non corrispondono ad alcun vincolo di posizionamento che contiene proprietà.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-402">Nodes that do not have a property defined do not match any placement constraint containing that property.</span></span>

<span data-ttu-id="fd6ba-403">Si supponga che siano state definite le proprietà seguenti per un tipo di nodo specifico:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-403">Let’s say that the following node properties were defined for a given node type:</span></span>

<span data-ttu-id="fd6ba-404">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="fd6ba-404">ClusterManifest.xml</span></span>

```xml
    <NodeType Name="NodeType01">
      <PlacementProperties>
        <Property Name="HasSSD" Value="true"/>
        <Property Name="NodeColor" Value="green"/>
        <Property Name="SomeProperty" Value="5"/>
      </PlacementProperties>
    </NodeType>
```

<span data-ttu-id="fd6ba-405">mediante ClusterConfig.json per le distribuzioni autonome o Template.json per cluster ospitati in Azure.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-405">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters.</span></span> 

> [!NOTE]
> <span data-ttu-id="fd6ba-406">Nel modello di Azure Resource Manager il tipo di nodo è in genere con parametri,</span><span class="sxs-lookup"><span data-stu-id="fd6ba-406">In your Azure Resource Manager template the node type is usually parameterized.</span></span> <span data-ttu-id="fd6ba-407">e più simile a "[parameters('vmNodeType1Name')]" che non a "NodeType01".</span><span class="sxs-lookup"><span data-stu-id="fd6ba-407">It would look like "[parameters('vmNodeType1Name')]" rather than "NodeType01".</span></span>
>

```json
"nodeTypes": [
    {
        "name": "NodeType01",
        "placementProperties": {
            "HasSSD": "true",
            "NodeColor": "green",
            "SomeProperty": "5"
        },
    }
],
```

<span data-ttu-id="fd6ba-408">È possibile creare *vincoli* di posizionamento del servizio per un servizio in modo analogo al seguente:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-408">You can create service placement *constraints* for a service like as follows:</span></span>

<span data-ttu-id="fd6ba-409">C#</span><span class="sxs-lookup"><span data-stu-id="fd6ba-409">C#</span></span>

```csharp
FabricClient fabricClient = new FabricClient();
StatefulServiceDescription serviceDescription = new StatefulServiceDescription();
serviceDescription.PlacementConstraints = "(HasSSD == true && SomeProperty >= 4)";
// add other required servicedescription fields
//...
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

<span data-ttu-id="fd6ba-410">Powershell:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-410">Powershell:</span></span>

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceType -Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton -PlacementConstraint "HasSSD == true && SomeProperty >= 4"
```

<span data-ttu-id="fd6ba-411">Se tutti i nodi NodeType01 sono validi, è anche possibile selezionare un tipo di nodo con vincolo "(NodeType == NodeType01)".</span><span class="sxs-lookup"><span data-stu-id="fd6ba-411">If all nodes of NodeType01 are valid, you can also select that node type with the constraint "(NodeType == NodeType01)".</span></span>

<span data-ttu-id="fd6ba-412">Uno dei vantaggi dei vincoli di posizionamento di un servizio consiste nel fatto che possono essere aggiornati in modo dinamico durante la fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-412">One of the cool things about a service’s placement constraints is that they can be updated dynamically during runtime.</span></span> <span data-ttu-id="fd6ba-413">Se necessario, è quindi possibile spostare un servizio nel cluster, aggiungere e rimuovere requisiti e così via. Service Fabric assicura che il servizio sia sempre attivo e disponibile, anche durante l'applicazione di questi tipi di modifiche.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-413">So if you need to, you can move a service around in the cluster, add and remove requirements, etc. Service Fabric takes care of ensuring that the service stays up and available even when these types of changes are made.</span></span>

<span data-ttu-id="fd6ba-414">C#:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-414">C#:</span></span>

```csharp
StatefulServiceUpdateDescription updateDescription = new StatefulServiceUpdateDescription();
updateDescription.PlacementConstraints = "NodeType == NodeType01";
await fabricClient.ServiceManager.UpdateServiceAsync(new Uri("fabric:/app/service"), updateDescription);
```

<span data-ttu-id="fd6ba-415">Powershell:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-415">Powershell:</span></span>

```posh
Update-ServiceFabricService -Stateful -ServiceName $serviceName -PlacementConstraints "NodeType == NodeType01"
```

<span data-ttu-id="fd6ba-416">I vincoli di posizionamento vengono specificati per ogni istanza del servizio denominata in modo differente.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-416">Placement constraints are specified for every different named service instance.</span></span> <span data-ttu-id="fd6ba-417">Gli aggiornamenti sostituiscono (sovrascrivono) sempre quanto specificato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-417">Updates always take the place of (overwrite) what was previously specified.</span></span>

<span data-ttu-id="fd6ba-418">La definizione del cluster definisce le proprietà in un nodo.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-418">The cluster definition defines the properties on a node.</span></span> <span data-ttu-id="fd6ba-419">Per modificare le proprietà di un nodo è necessario un aggiornamento della configurazione del cluster.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-419">Changing a node's properties requires a cluster configuration upgrade.</span></span> <span data-ttu-id="fd6ba-420">L'aggiornamento delle proprietà di un nodo richiede che ogni nodo in questione venga riavviato per segnalare le nuove proprietà.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-420">Upgrading a node's properties requires each affected node to restart to report its new properties.</span></span> <span data-ttu-id="fd6ba-421">Questi aggiornamenti in sequenza sono gestiti da Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-421">These rolling upgrades are managed by Service Fabric.</span></span>

## <a name="describing-and-managing-cluster-resources"></a><span data-ttu-id="fd6ba-422">Descrizione e gestione delle risorse del cluster</span><span class="sxs-lookup"><span data-stu-id="fd6ba-422">Describing and Managing Cluster Resources</span></span>
<span data-ttu-id="fd6ba-423">Uno dei processi più importanti di un agente di orchestrazione consiste nel semplificare la gestione dell'utilizzo delle risorse del cluster.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-423">One of the most important jobs of any orchestrator is to help manage resource consumption in the cluster.</span></span> <span data-ttu-id="fd6ba-424">Gestione delle risorse del cluster può avere significati diversi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-424">Managing cluster resources can mean a couple of different things.</span></span> <span data-ttu-id="fd6ba-425">Innanzitutto, è necessario verificare che i computer non siano sovraccarichi,</span><span class="sxs-lookup"><span data-stu-id="fd6ba-425">First, there's ensuring that machines are not overloaded.</span></span> <span data-ttu-id="fd6ba-426">ovvero che non eseguano più servizi di quanti ne possano gestire.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-426">This means making sure that machines aren't running more services than they can handle.</span></span> <span data-ttu-id="fd6ba-427">In secondo luogo, il bilanciamento e l'ottimizzazione sono di fondamentale importanza per l'esecuzione efficiente dei servizi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-427">Second, there's balancing and optimization which is critical to running services efficiently.</span></span> <span data-ttu-id="fd6ba-428">Un'offerta di servizi conveniente o esigente in termini di prestazioni non può permettere un eccessivo sbilanciamento di utilizzo dei nodi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-428">Cost effective or performance sensitive service offerings can't allow some nodes to be hot while others are cold.</span></span> <span data-ttu-id="fd6ba-429">I nodi più usati si contendono le risorse offrendo prestazioni scarse mentre i nodi poco usati sono uno spreco di risorse e costi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-429">Hot nodes lead to resource contention and poor performance, and cold nodes represent wasted resources and increased costs.</span></span> 

<span data-ttu-id="fd6ba-430">Service Fabric rappresenta le risorse come `Metrics`.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-430">Service Fabric represents resources as `Metrics`.</span></span> <span data-ttu-id="fd6ba-431">Per metrica si intende qualsiasi risorsa logica o fisica che deve essere descritta per Service Fabric,</span><span class="sxs-lookup"><span data-stu-id="fd6ba-431">Metrics are any logical or physical resource that you want to describe to Service Fabric.</span></span> <span data-ttu-id="fd6ba-432">ad esempio "WorkQueueDepth" o "MemoryInMb".</span><span class="sxs-lookup"><span data-stu-id="fd6ba-432">Examples of metrics are things like “WorkQueueDepth” or “MemoryInMb”.</span></span> <span data-ttu-id="fd6ba-433">Per informazioni sulle risorse fisiche che Service Fabric può gestire sui nodi, vedere [governance delle risorse](service-fabric-resource-governance.md).</span><span class="sxs-lookup"><span data-stu-id="fd6ba-433">For information about the physical resources that Service Fabric can govern on nodes, see [resource governance](service-fabric-resource-governance.md).</span></span> <span data-ttu-id="fd6ba-434">Per informazioni sulla configurazione di metriche personalizzate e sul loro utilizzo, vedere [questo articolo](service-fabric-cluster-resource-manager-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="fd6ba-434">For information on configuring custom metrics and their uses, see [this article](service-fabric-cluster-resource-manager-metrics.md)</span></span>

<span data-ttu-id="fd6ba-435">Le metriche sono diverse dai vincoli di posizionamento e dalle proprietà del nodo.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-435">Metrics are different from placements constraints and node properties.</span></span> <span data-ttu-id="fd6ba-436">Le proprietà dei nodi sono descrittori statici dei nodi stessi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-436">Node properties are static descriptors of the nodes themselves.</span></span> <span data-ttu-id="fd6ba-437">Le metriche descrivono le risorse di cui dispongono i nodi e che vengono consumate dai servizi quando vengono eseguiti in un nodo.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-437">Metrics describe resources that nodes have and that services consume when they are run on a node.</span></span> <span data-ttu-id="fd6ba-438">Una proprietà del nodo potrebbe essere "HasSSD" e potrebbe essere impostata su true o false.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-438">A node property could be "HasSSD" and could be set to true or false.</span></span> <span data-ttu-id="fd6ba-439">La quantità di spazio disponibile su tale unità SSD (e la quantità usata dai servizi) può essere una metrica come "DriveSpaceInMb".</span><span class="sxs-lookup"><span data-stu-id="fd6ba-439">The amount of space available on that SSD and how much is consumed by services would be a metric like “DriveSpaceInMb”.</span></span> 

<span data-ttu-id="fd6ba-440">È importante notare che, come per i vincoli di posizionamento e le proprietà del nodo, Cluster Resource Manager di Service Fabric non sa cosa significano i nomi delle metriche.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-440">It is important to note that just like for placement constraints and node properties, the Service Fabric Cluster Resource Manager doesn't understand what the names of the metrics mean.</span></span> <span data-ttu-id="fd6ba-441">I nomi delle metriche sono semplicemente stringhe.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-441">Metric names are just strings.</span></span> <span data-ttu-id="fd6ba-442">È consigliabile dichiarare l'unità come parte del nome della metrica creato quando potrebbe essere ambigua.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-442">It is a good practice to declare units as a part of the metric names that you create when it could be ambiguous.</span></span>

## <a name="capacity"></a><span data-ttu-id="fd6ba-443">Capacity</span><span class="sxs-lookup"><span data-stu-id="fd6ba-443">Capacity</span></span>
<span data-ttu-id="fd6ba-444">Se si disattiva completamente il *bilanciamento*di tutte le risorse, Cluster Resource Manager di Service Fabric tenta comunque di assicurare che nessun nodo superi la propria capacità consentita.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-444">If you turned off all resource *balancing*, Service Fabric’s Cluster Resource Manager would still ensure that no node ended up over its capacity.</span></span> <span data-ttu-id="fd6ba-445">Gestire i sovraccarichi di capacità è possibile, a meno che il cluster non sia pieno o il carico di lavoro sia maggiore rispetto a qualsiasi altro nodo.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-445">Managing capacity overruns is possible unless the cluster is too full or the workload is larger than any node.</span></span> <span data-ttu-id="fd6ba-446">La capacità è un altro *vincolo* usato da Cluster Resource Manager per conoscere la quantità di una risorsa posseduta da un nodo.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-446">Capacity is another *constraint* that the Cluster Resource Manager uses to understand how much of a resource a node has.</span></span> <span data-ttu-id="fd6ba-447">La capacità rimanente verrà registrata anche per il cluster nel suo complesso.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-447">Remaining capacity is also tracked for the cluster as a whole.</span></span> <span data-ttu-id="fd6ba-448">Sia la capacità che l'utilizzo a livello di servizio sono espressi in termini di metriche.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-448">Both the capacity and the consumption at the service level are expressed in terms of metrics.</span></span> <span data-ttu-id="fd6ba-449">Ad esempio la metrica potrebbe essere "ClientConnections" e un determinato nodo potrebbe avere una capacità "ClientConnections" di 32768.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-449">So for example, the metric might be "ClientConnections" and a given Node may have a capacity for "ClientConnections" of 32768.</span></span> <span data-ttu-id="fd6ba-450">Gli altri nodi possono avere altri limiti. Alcuni servizi in esecuzione nel nodo possono dichiarare che esso consumi al momento 32256 della metrica "ClientConnections".</span><span class="sxs-lookup"><span data-stu-id="fd6ba-450">Other nodes can have other limits Some service running on that node can say it is currently consuming 32256 of the metric "ClientConnections".</span></span>

<span data-ttu-id="fd6ba-451">In fase di esecuzione, Cluster Resource Manager tiene traccia delle capacità rimanenti nel cluster e nei nodi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-451">During runtime, the Cluster Resource Manager tracks remaining capacity in the cluster and on nodes.</span></span> <span data-ttu-id="fd6ba-452">A tal fine, sottrae quanto usato da ciascun servizio dalla capacità del nodo in cui esso viene eseguito.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-452">In order to track capacity the Cluster Resource Manager subtracts each service's usage from node's capacity where the service runs.</span></span> <span data-ttu-id="fd6ba-453">Queste informazioni consentono a Cluster Resource Manager di Service Fabric di individuare la posizione ottimale per l'inserimento o lo spostamento di repliche, in modo che i nodi non superino le rispettive capacità.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-453">With this information, the Service Fabric Cluster Resource Manager can figure out where to place or move replicas so that nodes don’t go over capacity.</span></span>

<span data-ttu-id="fd6ba-454"><center>
![Nodi e capacità del cluster][Image7]
</center></span><span class="sxs-lookup"><span data-stu-id="fd6ba-454"><center>
![Cluster nodes and capacity][Image7]
</center></span></span>

<span data-ttu-id="fd6ba-455">C#:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-455">C#:</span></span>

```csharp
StatefulServiceDescription serviceDescription = new StatefulServiceDescription();
ServiceLoadMetricDescription metric = new ServiceLoadMetricDescription();
metric.Name = "ClientConnections";
metric.PrimaryDefaultLoad = 1024;
metric.SecondaryDefaultLoad = 0;
metric.Weight = ServiceLoadMetricWeight.High;
serviceDescription.Metrics.Add(metric);
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

<span data-ttu-id="fd6ba-456">Powershell:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-456">Powershell:</span></span>

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceTypeName –Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton –Metric @("ClientConnections,High,1024,0)
```

<span data-ttu-id="fd6ba-457">È possibile vedere le capacità definite nel manifesto del cluster:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-457">You can see capacities defined in the cluster manifest:</span></span>

<span data-ttu-id="fd6ba-458">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="fd6ba-458">ClusterManifest.xml</span></span>

```xml
    <NodeType Name="NodeType03">
      <Capacities>
        <Capacity Name="ClientConnections" Value="65536"/>
      </Capacities>
    </NodeType>
```

<span data-ttu-id="fd6ba-459">mediante ClusterConfig.json per le distribuzioni autonome o Template.json per cluster ospitati in Azure.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-459">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters.</span></span> 

```json
"nodeTypes": [
    {
        "name": "NodeType03",
        "capacities": {
            "ClientConnections": "65536",
        }
    }
],
```

<span data-ttu-id="fd6ba-460">In genere il carico di un servizio cambia in modo dinamico.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-460">Commonly a service’s load changes dynamically.</span></span> <span data-ttu-id="fd6ba-461">Si supponga che il carico di una replica di "ClientConnections" sia stato modificato da 1024 a 2048, ma il nodo in cui era in esecuzione in quel momento avesse solo una disponibilità residua della metrica pari a 512.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-461">Say that a replica's load of "ClientConnections" changed from 1024 to 2048, but the node it was running on then only had 512 capacity remaining for that metric.</span></span> <span data-ttu-id="fd6ba-462">Ora il posizionamento della replica o dell'istanza non è valido, poiché in quel nodo non c'è spazio sufficiente.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-462">Now that replica or instance's placement is invalid, since there's not enough room on that node.</span></span> <span data-ttu-id="fd6ba-463">Cluster Resource Manager deve intervenire e riportare il nodo sotto il valore di capacità massimo.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-463">The Cluster Resource Manager has to kick in and get the node back below capacity.</span></span> <span data-ttu-id="fd6ba-464">A tal fine, deve spostare una o più repliche o istanze da quel nodo ad altri nodi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-464">It reduces load on the node that is over capacity by moving one or more of the replicas or instances from that node to other nodes.</span></span> <span data-ttu-id="fd6ba-465">Quando sposta le repliche, Cluster Resource Manager tenta di ridurre al minimo il costo di tali spostamenti.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-465">When moving replicas, the Cluster Resource Manager tries to minimize the cost of those movements.</span></span> <span data-ttu-id="fd6ba-466">I costi degli spostamenti vengono approfonditi in [questo articolo](service-fabric-cluster-resource-manager-movement-cost.md). Altre informazioni sulle strategie e le regole di ribilanciamento di Cluster Resource Manager sono disponibili [qui](service-fabric-cluster-resource-manager-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="fd6ba-466">Movement cost is discussed in [this article](service-fabric-cluster-resource-manager-movement-cost.md) and more about the Cluster Resource Manager's rebalancing strategies and rules is described [here](service-fabric-cluster-resource-manager-metrics.md).</span></span>

## <a name="cluster-capacity"></a><span data-ttu-id="fd6ba-467">Capacità del cluster</span><span class="sxs-lookup"><span data-stu-id="fd6ba-467">Cluster capacity</span></span>
<span data-ttu-id="fd6ba-468">In che modo Cluster Resource Manager di Service Fabric impedisce il caricamento eccessivo del cluster nel suo complesso?</span><span class="sxs-lookup"><span data-stu-id="fd6ba-468">So how does the Service Fabric Cluster Resource Manager keep the overall cluster from being too full?</span></span> <span data-ttu-id="fd6ba-469">Con il carico dinamico non è possibile intervenire in modo netto.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-469">Well, with dynamic load there’s not a lot it can do.</span></span> <span data-ttu-id="fd6ba-470">I servizi possono subire picchi di carico indipendentemente dalle azioni eseguite da Cluster Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-470">Services can have their load spike independently of actions taken by the Cluster Resource Manager.</span></span> <span data-ttu-id="fd6ba-471">Di conseguenza un cluster che dispone di molta capacità oggi può non essere abbastanza potente domani se l'utilizzo aumenta.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-471">As a result, your cluster with plenty of headroom today may be underpowered when you become famous tomorrow.</span></span> <span data-ttu-id="fd6ba-472">Detto ciò, sono stati integrati alcuni controlli per evitare problemi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-472">That said, there are some controls that are baked in to prevent problems.</span></span> <span data-ttu-id="fd6ba-473">È prima di tutto possibile impedire la creazione di nuovi carichi di lavoro che riempirebbero il cluster.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-473">The first thing we can do is prevent the creation of new workloads that would cause the cluster to become full.</span></span>

<span data-ttu-id="fd6ba-474">Si supponga di creare un servizio senza stato al quale è associato un carico.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-474">Say that you create a stateless service and it has some load associated with it.</span></span> <span data-ttu-id="fd6ba-475">Si immagini che il servizio monitori la metrica "DiskSpaceInMb".</span><span class="sxs-lookup"><span data-stu-id="fd6ba-475">Let’s say that the service cares about the "DiskSpaceInMb" metric.</span></span> <span data-ttu-id="fd6ba-476">Si supponga anche che consumerà cinque unità di "DiskSpaceInMb" per ogni istanza del servizio.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-476">Let's also say that it is going to consume five units of "DiskSpaceInMb" for every instance of the service.</span></span> <span data-ttu-id="fd6ba-477">Si vogliono creare tre istanze del servizio.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-477">You want to create three instances of the service.</span></span> <span data-ttu-id="fd6ba-478">L'installazione è riuscita.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-478">Great!</span></span> <span data-ttu-id="fd6ba-479">È quindi necessario che 15 unità di "DiskSpaceInMb" siano presenti nel cluster per consentire la mera creazione di queste istanze del servizio.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-479">So that means that we need 15 units of "DiskSpaceInMb" to be present in the cluster in order for us to even be able to create these service instances.</span></span> <span data-ttu-id="fd6ba-480">Cluster Resource Manager calcola continuamente la capacità e il consumo di ogni metrica e può pertanto determinare la capacità residua nel cluster.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-480">The Cluster Resource Manager continually calculates the capacity and consumption of each metric so it can determine the remaining capacity in the cluster.</span></span> <span data-ttu-id="fd6ba-481">Se non c'è spazio sufficiente, Cluster Resource Manager rifiuta la chiamata di creazione del servizio.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-481">If there isn't enough space, the Cluster Resource Manager rejects the create service call.</span></span>

<span data-ttu-id="fd6ba-482">Poiché l'unico requisito è che ci siano 15 unità disponibili, questo spazio può essere allocato in molti modi diversi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-482">Since the requirement is only that there be 15 units available, this space could be allocated many different ways.</span></span> <span data-ttu-id="fd6ba-483">Ad esempio potrebbe esserci un'unità di capacità rimanente in 15 nodi diversi oppure tre unità di capacità rimanenti in cinque nodi diversi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-483">For example, there could be one remaining unit of capacity on 15 different nodes, or three remaining units of capacity on five different nodes.</span></span> <span data-ttu-id="fd6ba-484">Se Cluster Resource Manager è in grado di sistemare le cose in modo che ci siano cinque unità disponibili in tre nodi, alla fine posizionerà il servizio.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-484">If the Cluster Resource Manager can rearrange things so there's five units available on three nodes, it places the service.</span></span> <span data-ttu-id="fd6ba-485">In genere la riorganizzazione del cluster è possibile, a meno che il cluster non sia quasi pieno o che, per qualsiasi motivo, non sia possibile consolidare i servizi esistenti.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-485">Rearranging the cluster is usually possible unless the cluster is almost full or the existing services can't be consolidated for some reason.</span></span>

## <a name="buffered-capacity"></a><span data-ttu-id="fd6ba-486">Capacità in buffering</span><span class="sxs-lookup"><span data-stu-id="fd6ba-486">Buffered Capacity</span></span>
<span data-ttu-id="fd6ba-487">La capacità in buffering è un'altra funzionalità di Cluster Resource Manager,</span><span class="sxs-lookup"><span data-stu-id="fd6ba-487">Buffered capacity is another feature of the Cluster Resource Manager.</span></span> <span data-ttu-id="fd6ba-488">che consente di riservare parti della capacità complessiva del nodo.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-488">It allows reservation of some portion of the overall node capacity.</span></span> <span data-ttu-id="fd6ba-489">Questo buffer di capacità viene usato solo per posizionare i servizi durante gli aggiornamenti e gli errori del nodo.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-489">This capacity buffer is only used to place services during upgrades and node failures.</span></span> <span data-ttu-id="fd6ba-490">La capacità in buffering è specificata a livello globale per ogni metrica e per tutti i nodi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-490">Buffered Capacity is specified globally per metric for all nodes.</span></span> <span data-ttu-id="fd6ba-491">Il valore scelto per la capacità di riserva è una funzione del numero di domini di errore e di aggiornamento presenti nel cluster.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-491">The value you pick for the reserved capacity is a function of the number of Fault and Upgrade Domains you have in the cluster.</span></span> <span data-ttu-id="fd6ba-492">Quando è presente un numero maggiore di domini di errore e di aggiornamento è possibile scegliere un valore inferiore per il buffer di capacità.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-492">More Fault and Upgrade Domains means that you can pick a lower number for your buffered capacity.</span></span> <span data-ttu-id="fd6ba-493">Se si dispone di molti domini, ci si può aspettare la mancata disponibilità di porzioni inferiori del cluster durante gli aggiornamenti e gli errori.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-493">If you have more domains, you can expect smaller amounts of your cluster to be unavailable during upgrades and failures.</span></span> <span data-ttu-id="fd6ba-494">Specificare capacità in buffering risulta utile solo se è stata specificata anche la capacità del nodo per una metrica.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-494">Specifying Buffered Capacity only makes sense if you have also specified the node capacity for a metric.</span></span>

<span data-ttu-id="fd6ba-495">Di seguito è riportato un esempio di come specificare la capacità di memorizzazione nel buffer:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-495">Here's an example of how to specify buffered capacity:</span></span>

<span data-ttu-id="fd6ba-496">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="fd6ba-496">ClusterManifest.xml</span></span>

```xml
        <Section Name="NodeBufferPercentage">
            <Parameter Name="SomeMetric" Value="0.15" />
            <Parameter Name="SomeOtherMetric" Value="0.20" />
        </Section>
```

<span data-ttu-id="fd6ba-497">mediante ClusterConfig.json per le distribuzioni autonome o Template.json per i cluster ospitati in Azure:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-497">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "NodeBufferPercentage",
    "parameters": [
      {
          "name": "SomeMetric",
          "value": "0.15"
      },
      {
          "name": "SomeOtherMetric",
          "value": "0.20"
      }
    ]
  }
]
```

<span data-ttu-id="fd6ba-498">La creazione di nuovi servizi non riesce quando il cluster esaurisce il buffer di capacità per una metrica.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-498">The creation of new services fails when the cluster is out of buffered capacity for a metric.</span></span> <span data-ttu-id="fd6ba-499">Impedire la creazione di nuovi servizi per conservare il buffer garantisce che gli errori e gli aggiornamenti non causino il superamento della capacità dei nodi.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-499">Preventing the creation of new services to preserve the buffer ensures that upgrades and failures don’t cause nodes to go over capacity.</span></span> <span data-ttu-id="fd6ba-500">Il buffer di capacità è un'opzione facoltativa ma consigliata per tutti i cluster che definiscono una capacità per una metrica.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-500">Buffered capacity is optional but is recommended in any cluster that defines a capacity for a metric.</span></span>

<span data-ttu-id="fd6ba-501">Cluster Resource Manager espone le informazioni sul carico seguenti.</span><span class="sxs-lookup"><span data-stu-id="fd6ba-501">The Cluster Resource Manager exposes this load information.</span></span> <span data-ttu-id="fd6ba-502">Per ogni metrica, le informazioni includono:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-502">For each metric, this information includes:</span></span> 
  - <span data-ttu-id="fd6ba-503">impostazioni della capacità di buffering</span><span class="sxs-lookup"><span data-stu-id="fd6ba-503">the buffered capacity settings</span></span>
  - <span data-ttu-id="fd6ba-504">capacità totale</span><span class="sxs-lookup"><span data-stu-id="fd6ba-504">the total capacity</span></span>
  - <span data-ttu-id="fd6ba-505">consumo corrente</span><span class="sxs-lookup"><span data-stu-id="fd6ba-505">the current consumption</span></span>
  - <span data-ttu-id="fd6ba-506">se ogni metrica può essere considerata bilanciata oppure no</span><span class="sxs-lookup"><span data-stu-id="fd6ba-506">whether each metric is considered balanced or not</span></span>
  - <span data-ttu-id="fd6ba-507">statistiche relative alla deviazione standard</span><span class="sxs-lookup"><span data-stu-id="fd6ba-507">statistics about the standard deviation</span></span>
  - <span data-ttu-id="fd6ba-508">nodi con più e meno carico</span><span class="sxs-lookup"><span data-stu-id="fd6ba-508">the nodes which have the most and least load</span></span>  
  
<span data-ttu-id="fd6ba-509">Di seguito un esempio dell'output:</span><span class="sxs-lookup"><span data-stu-id="fd6ba-509">Below we see an example of that output:</span></span>

```posh
PS C:\Users\user> Get-ServiceFabricClusterLoadInformation
LastBalancingStartTimeUtc : 9/1/2016 12:54:59 AM
LastBalancingEndTimeUtc   : 9/1/2016 12:54:59 AM
LoadMetricInformation     :
                            LoadMetricName        : Metric1
                            IsBalancedBefore      : False
                            IsBalancedAfter       : False
                            DeviationBefore       : 0.192450089729875
                            DeviationAfter        : 0.192450089729875
                            BalancingThreshold    : 1
                            Action                : NoActionNeeded
                            ActivityThreshold     : 0
                            ClusterCapacity       : 189
                            ClusterLoad           : 45
                            ClusterRemainingCapacity : 144
                            NodeBufferPercentage  : 10
                            ClusterBufferedCapacity : 170
                            ClusterRemainingBufferedCapacity : 125
                            ClusterCapacityViolation : False
                            MinNodeLoadValue      : 0
                            MinNodeLoadNodeId     : 3ea71e8e01f4b0999b121abcbf27d74d
                            MaxNodeLoadValue      : 15
                            MaxNodeLoadNodeId     : 2cc648b6770be1bc9824fa995d5b68b1
```

## <a name="next-steps"></a><span data-ttu-id="fd6ba-510">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="fd6ba-510">Next steps</span></span>
* <span data-ttu-id="fd6ba-511">Per informazioni sull'architettura e sul flusso di informazioni in Cluster Resource Manager, vedere [questo articolo](service-fabric-cluster-resource-manager-architecture.md)</span><span class="sxs-lookup"><span data-stu-id="fd6ba-511">For information on the architecture and information flow within the Cluster Resource Manager, check out [this article ](service-fabric-cluster-resource-manager-architecture.md)</span></span>
* <span data-ttu-id="fd6ba-512">Definire la metrica di deframmentazione rappresenta un modo per consolidare il carico sui nodi anziché distribuirlo. Per informazioni su come configurare la deframmentazione, vedere [questo articolo](service-fabric-cluster-resource-manager-defragmentation-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="fd6ba-512">Defining Defragmentation Metrics is one way to consolidate load on nodes instead of spreading it out. To learn how to configure defragmentation, refer to [this article](service-fabric-cluster-resource-manager-defragmentation-metrics.md)</span></span>
* <span data-ttu-id="fd6ba-513">Partire dall'inizio e vedere l' [introduzione a Cluster Resource Manager di Service Fabric](service-fabric-cluster-resource-manager-introduction.md)</span><span class="sxs-lookup"><span data-stu-id="fd6ba-513">Start from the beginning and [get an Introduction to the Service Fabric Cluster Resource Manager](service-fabric-cluster-resource-manager-introduction.md)</span></span>
* <span data-ttu-id="fd6ba-514">Per informazioni sul modo in cui Cluster Resource Manager gestisce e bilancia il carico nel cluster, vedere l'articolo relativo al [bilanciamento del carico](service-fabric-cluster-resource-manager-balancing.md)</span><span class="sxs-lookup"><span data-stu-id="fd6ba-514">To find out about how the Cluster Resource Manager manages and balances load in the cluster, check out the article on [balancing load](service-fabric-cluster-resource-manager-balancing.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-fault-domains.png
[Image2]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-uneven-fault-domain-layout.png
[Image3]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-fault-and-upgrade-domains-with-placement.png
[Image4]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-fault-and-upgrade-domain-layout-strategies.png
[Image5]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-layout-different-workloads.png
[Image6]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-placement-constraints-node-properties.png
[Image7]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-nodes-and-capacity.png
