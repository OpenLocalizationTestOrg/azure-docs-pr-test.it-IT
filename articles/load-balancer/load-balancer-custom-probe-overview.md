---
title: monitoraggio dello stato e probe personalizzati di bilanciamento del aaaLoad | Documenti Microsoft
description: Informazioni su come toouse personalizzata viene eseguita la ricerca per le istanze di bilanciamento del carico di Azure toomonitor bilanciamento del carico
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/24/2016
ms.author: kumud
ms.openlocfilehash: 3dfcfcd2d5cffa58b160cb38d63acffbd997d452
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="understand-load-balancer-probes"></a><span data-ttu-id="fc856-103">Informazioni sui probe di bilanciamento del carico</span><span class="sxs-lookup"><span data-stu-id="fc856-103">Understand load balancer probes</span></span>

<span data-ttu-id="fc856-104">Bilanciamento del carico di Azure offre l'integrità di hello funzionalità toomonitor hello istanze del server tramite probe.</span><span class="sxs-lookup"><span data-stu-id="fc856-104">Azure Load Balancer offers hello capability toomonitor hello health of server instances by using probes.</span></span> <span data-ttu-id="fc856-105">Quando un probe ha esito negativo toorespond, bilanciamento del carico interrompe l'invio di nuova istanza di tipo non integro toohello connessioni.</span><span class="sxs-lookup"><span data-stu-id="fc856-105">When a probe fails toorespond, Load Balancer stops sending new connections toohello unhealthy instance.</span></span> <span data-ttu-id="fc856-106">le connessioni esistenti Hello non sono interessate e le nuove connessioni vengono inviate toohealthy istanze.</span><span class="sxs-lookup"><span data-stu-id="fc856-106">hello existing connections are not affected, and new connections are sent toohealthy instances.</span></span>

<span data-ttu-id="fc856-107">I ruoli del servizio cloud, ovvero i ruoli di lavoro e i ruoli Web, usano un agente guest per il monitoraggio probe.</span><span class="sxs-lookup"><span data-stu-id="fc856-107">Cloud service roles (worker roles and web roles) use a guest agent for probe monitoring.</span></span> <span data-ttu-id="fc856-108">I probe TCP o HTTP personalizzati devono essere configurati quando si usano macchine virtuali monitorate tramite il servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="fc856-108">TCP or HTTP custom probes must be configured when you use virtual machines behind Load Balancer.</span></span>

## <a name="understand-probe-count-and-timeout"></a><span data-ttu-id="fc856-109">Informazioni su conteggio e timeout dei probe</span><span class="sxs-lookup"><span data-stu-id="fc856-109">Understand probe count and timeout</span></span>

<span data-ttu-id="fc856-110">Il comportamento dei probe dipende dagli elementi seguenti:</span><span class="sxs-lookup"><span data-stu-id="fc856-110">Probe behavior depends on:</span></span>

* <span data-ttu-id="fc856-111">numero di Hello di probe ha esito positivo che consentono a un'istanza toobe etichettato come attività.</span><span class="sxs-lookup"><span data-stu-id="fc856-111">hello number of successful probes that allow an instance toobe labeled as up.</span></span>
* <span data-ttu-id="fc856-112">numero di Hello di probe non riusciti che causano toobe un'istanza denominata come inattivi.</span><span class="sxs-lookup"><span data-stu-id="fc856-112">hello number of failed probes that cause an instance toobe labeled as down.</span></span>

<span data-ttu-id="fc856-113">valore di timeout e la frequenza di Hello impostato in SuccessFailCount determinare se un'istanza è confermata toobe in esecuzione o non è in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="fc856-113">hello timeout and frequency value set in  SuccessFailCount determine whether an instance is confirmed toobe running or not running.</span></span> <span data-ttu-id="fc856-114">Nel portale di Azure hello, timeout di hello è impostato tootwo volte hello valore di frequenza hello.</span><span class="sxs-lookup"><span data-stu-id="fc856-114">In hello Azure portal, hello timeout is set tootwo times hello value of hello frequency.</span></span>

<span data-ttu-id="fc856-115">configurazione di probe Hello di tutte le istanze con bilanciamento del carico per un endpoint (ovvero, un set con bilanciamento del carico) deve essere hello stesso.</span><span class="sxs-lookup"><span data-stu-id="fc856-115">hello probe configuration of all load-balanced instances for an endpoint (that is, a load-balanced set) must be hello same.</span></span> <span data-ttu-id="fc856-116">Questo significa che non è possibile avere una configurazione di probe diverso per ogni istanza del ruolo o una macchina virtuale in hello stesso ospitato il servizio per una combinazione di endpoint in questione.</span><span class="sxs-lookup"><span data-stu-id="fc856-116">This means you cannot have a different probe configuration for each role instance or virtual machine in hello same hosted service for a particular endpoint combination.</span></span> <span data-ttu-id="fc856-117">Ad esempio, ogni istanza deve avere porte locali e i timeout identici.</span><span class="sxs-lookup"><span data-stu-id="fc856-117">For example, each instance must have identical local ports and timeouts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="fc856-118">Un probe di bilanciamento del carico Usa indirizzo IP hello 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="fc856-118">A Load Balancer probe uses hello IP address 168.63.129.16.</span></span> <span data-ttu-id="fc856-119">Questo indirizzo IP pubblico facilita le risorse di piattaforma toointernal di comunicazione per hello bring-your-proprietari-IP uno scenario di rete virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="fc856-119">This public IP address facilitates communication toointernal platform resources for hello bring-your-own-IP Azure Virtual Network scenario.</span></span> <span data-ttu-id="fc856-120">Hello virtuale indirizzo IP pubblico 168.63.129.16 viene utilizzata in tutte le aree e non cambia.</span><span class="sxs-lookup"><span data-stu-id="fc856-120">hello virtual public IP address 168.63.129.16 is used in all regions and will not change.</span></span> <span data-ttu-id="fc856-121">È consigliabile consentire questo indirizzo IP in tutti i criteri firewall locali.</span><span class="sxs-lookup"><span data-stu-id="fc856-121">We recommend that you allow this IP address in any local firewall policies.</span></span> <span data-ttu-id="fc856-122">Non deve essere considerato un rischio per la sicurezza perché un messaggio da tale indirizzo di origine può solo hello interno piattaforma Azure.</span><span class="sxs-lookup"><span data-stu-id="fc856-122">It should not be considered a security risk because only hello internal Azure platform can source a message from that address.</span></span> <span data-ttu-id="fc856-123">Se non si eseguire questa operazione, sarà presente un comportamento imprevisto in un'ampia gamma di scenari, ad esempio la configurazione di hello stesso intervallo di indirizzi IP di 168.63.129.16 e con gli indirizzi IP di duplicati.</span><span class="sxs-lookup"><span data-stu-id="fc856-123">If you do not do this, there will be unexpected behavior in a variety of scenarios like configuring hello same IP address range of 168.63.129.16 and having duplicated IP addresses.</span></span>

## <a name="learn-about-hello-types-of-probes"></a><span data-ttu-id="fc856-124">Informazioni sui tipi di hello di probe</span><span class="sxs-lookup"><span data-stu-id="fc856-124">Learn about hello types of probes</span></span>

### <a name="guest-agent-probe"></a><span data-ttu-id="fc856-125">Probe dell'agente guest</span><span class="sxs-lookup"><span data-stu-id="fc856-125">Guest agent probe</span></span>

<span data-ttu-id="fc856-126">Questo probe è disponibile solo per i servizi cloud di Azure.</span><span class="sxs-lookup"><span data-stu-id="fc856-126">This probe is available for Azure Cloud Services only.</span></span> <span data-ttu-id="fc856-127">Bilanciamento del carico Usa l'agente guest hello hello macchina virtuale, quindi è in ascolto e risponde con una risposta HTTP 200 OK solo quando hello istanza è nello stato Ready hello (ovvero, non in un altro stato, ad esempio disponibilità, il riciclo o arresto).</span><span class="sxs-lookup"><span data-stu-id="fc856-127">Load Balancer utilizes hello guest agent inside hello virtual machine, and then listens and responds with an HTTP 200 OK response only when hello instance is in hello Ready state (that is, not in another state such as Busy, Recycling, or Stopping).</span></span>

<span data-ttu-id="fc856-128">Per ulteriori informazioni, vedere [configurazione hello file di definizione servizio (csdef) per le ricerche di integrità](https://msdn.microsoft.com/library/azure/ee758710.aspx) o [Introduzione alla creazione di un bilanciamento del carico con connessione Internet per i servizi cloud](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span><span class="sxs-lookup"><span data-stu-id="fc856-128">For more information, see [Configuring hello service definition file (csdef) for health probes](https://msdn.microsoft.com/library/azure/ee758710.aspx) or [Get started creating an Internet-facing load balancer for cloud services](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span></span>

### <a name="what-makes-a-guest-agent-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="fc856-129">Perché un probe dell'agente guest contrassegna un'istanza come non integra</span><span class="sxs-lookup"><span data-stu-id="fc856-129">What makes a guest agent probe mark an instance as unhealthy?</span></span>

<span data-ttu-id="fc856-130">Se l'agente guest hello non riesce toorespond HTTP 200 OK, segni di bilanciamento carico di hello hello istanza e arresta l'istanza toothat il traffico di invio.</span><span class="sxs-lookup"><span data-stu-id="fc856-130">If hello guest agent fails toorespond with HTTP 200 OK, hello load balancer marks hello instance as unresponsive and stops sending traffic toothat instance.</span></span> <span data-ttu-id="fc856-131">servizio di bilanciamento del carico Hello continua istanza hello tooping.</span><span class="sxs-lookup"><span data-stu-id="fc856-131">hello load balancer continues tooping hello instance.</span></span> <span data-ttu-id="fc856-132">Se l'agente guest hello risponde con un HTTP 200, bilanciamento del carico hello invia nuovamente istanza toothat di traffico.</span><span class="sxs-lookup"><span data-stu-id="fc856-132">If hello guest agent responds with an HTTP 200, hello load balancer sends traffic toothat instance again.</span></span>

<span data-ttu-id="fc856-133">Quando si utilizza un ruolo web, in genere codice del sito Web hello viene eseguito in w3wp.exe, non è monitorato da hello infrastruttura di Azure né dall'agente guest.</span><span class="sxs-lookup"><span data-stu-id="fc856-133">When you use a web role, hello website code typically runs in w3wp.exe, which is not monitored by hello Azure fabric or guest agent.</span></span> <span data-ttu-id="fc856-134">Ciò significa che gli errori in w3wp.exe (ad esempio, le risposte HTTP 500) non saranno segnalate toohello l'agente guest e bilanciamento del carico hello non avranno istanza dalla rotazione.</span><span class="sxs-lookup"><span data-stu-id="fc856-134">This means that failures in w3wp.exe (for example, HTTP 500 responses) will not be reported toohello guest agent, and hello load balancer will not take that instance out of rotation.</span></span>

### <a name="http-custom-probe"></a><span data-ttu-id="fc856-135">Probe HTTP personalizzato</span><span class="sxs-lookup"><span data-stu-id="fc856-135">HTTP custom probe</span></span>

<span data-ttu-id="fc856-136">probe di bilanciamento del carico HTTP personalizzato Hello sostituzioni hello guest agente probe predefinito, il che significa che è possibile creare la propria integrità hello toodetermine di logica personalizzata hello istanza del ruolo.</span><span class="sxs-lookup"><span data-stu-id="fc856-136">hello custom HTTP Load Balancer probe overrides hello default guest agent probe, which means that you can create your own custom logic toodetermine hello health of hello role instance.</span></span> <span data-ttu-id="fc856-137">servizio di bilanciamento del carico Hello le ricerche dell'endpoint ogni 15 secondi, per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="fc856-137">hello load balancer probes your endpoint every 15 seconds, by default.</span></span> <span data-ttu-id="fc856-138">istanza di Hello viene considerato toobe nella rotazione di bilanciamento del carico hello se il servizio risponde con un HTTP 200 entro il periodo di timeout hello (31 secondi per impostazione predefinita).</span><span class="sxs-lookup"><span data-stu-id="fc856-138">hello instance is considered toobe in hello load balancer rotation if it responds with an HTTP 200 within hello timeout period (31 seconds by default).</span></span>

<span data-ttu-id="fc856-139">Questo può essere utile se si desidera tooimplement proprie istanze tooremove logica dalla rotazione del bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="fc856-139">This can be useful if you want tooimplement your own logic tooremove instances from load balancer rotation.</span></span> <span data-ttu-id="fc856-140">Ad esempio, è possibile decidere tooremove un'istanza se è superiore al 90% della CPU e restituisce uno stato non-200.</span><span class="sxs-lookup"><span data-stu-id="fc856-140">For example, you could decide tooremove an instance if it is above 90% CPU and returns a non-200 status.</span></span> <span data-ttu-id="fc856-141">Se si dispone di ruoli web che utilizzano w3wp.exe, ciò significa anche viene visualizzato automaticamente il monitoraggio del sito Web, poiché gli errori nel codice del sito Web verranno restituito un probe di bilanciamento del carico toohello stato non-200.</span><span class="sxs-lookup"><span data-stu-id="fc856-141">If you have web roles that use w3wp.exe, this also means you get automatic monitoring of your website, because failures in your website code will return a non-200 status toohello load balancer probe.</span></span>

> [!NOTE]
> <span data-ttu-id="fc856-142">probe personalizzato di Hello HTTP supporta solo i protocolli HTTP e percorsi relativi.</span><span class="sxs-lookup"><span data-stu-id="fc856-142">hello HTTP custom probe supports relative paths and HTTP protocol only.</span></span> <span data-ttu-id="fc856-143">HTTPS non è supportato.</span><span class="sxs-lookup"><span data-stu-id="fc856-143">HTTPS is not supported.</span></span>

### <a name="what-makes-an-http-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="fc856-144">Perché un probe HTTP personalizzato contrassegna un'istanza come non integra</span><span class="sxs-lookup"><span data-stu-id="fc856-144">What makes an HTTP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="fc856-145">Hello applicazione HTTP restituisce un codice di risposta HTTP diversi da 200 (ad esempio, 403, 404 o 500).</span><span class="sxs-lookup"><span data-stu-id="fc856-145">hello HTTP application returns an HTTP response code other than 200 (for example, 403, 404, or 500).</span></span> <span data-ttu-id="fc856-146">Si tratta di un riconoscimento positivo hello applicazione istanza deve essere messo fuori servizio sin da subito.</span><span class="sxs-lookup"><span data-stu-id="fc856-146">This is a positive acknowledgment that hello application instance should be taken out of service right away.</span></span>
* <span data-ttu-id="fc856-147">server HTTP Hello non risponde affatto dopo il periodo di timeout di hello.</span><span class="sxs-lookup"><span data-stu-id="fc856-147">hello HTTP server does not respond at all after hello timeout period.</span></span> <span data-ttu-id="fc856-148">A seconda di hello valore di timeout è impostato, ciò potrebbe indicare che più probe richiede go senza risposta prima di probe hello viene contrassegnato come non in esecuzione (vale a dire prima SuccessFailCount probe vengono inviati).</span><span class="sxs-lookup"><span data-stu-id="fc856-148">Depending on hello timeout value that is set, this might mean that multiple probe requests go unanswered before hello probe gets marked as not running (that is, before SuccessFailCount probes are sent).</span></span>
* <span data-ttu-id="fc856-149">server Hello chiude la connessione hello tramite una reimpostazione TCP.</span><span class="sxs-lookup"><span data-stu-id="fc856-149">hello server closes hello connection via a TCP reset.</span></span>

### <a name="tcp-custom-probe"></a><span data-ttu-id="fc856-150">Probe TCP personalizzato</span><span class="sxs-lookup"><span data-stu-id="fc856-150">TCP custom probe</span></span>

<span data-ttu-id="fc856-151">Probe TCP avviano una connessione mediante l'esecuzione di un handshake a tre vie con porta hello definito.</span><span class="sxs-lookup"><span data-stu-id="fc856-151">TCP probes initiate a connection by performing a three-way handshake with hello defined port.</span></span>

### <a name="what-makes-a-tcp-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="fc856-152">Perché un probe TCP personalizzato contrassegna un'istanza come non integra</span><span class="sxs-lookup"><span data-stu-id="fc856-152">What makes a TCP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="fc856-153">Hello TCP server non risponde affatto dopo il periodo di timeout di hello.</span><span class="sxs-lookup"><span data-stu-id="fc856-153">hello TCP server does not respond at all after hello timeout period.</span></span> <span data-ttu-id="fc856-154">Quando i probe hello viene contrassegnata come non in esecuzione dipende dal numero di hello del probe non richiede che sono stato configurato toogo senza risposta prima di contrassegnare probe hello come non in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="fc856-154">When hello probe is marked as not running depends on hello number of failed probe requests that were configured toogo unanswered before marking hello probe as not running.</span></span>
* <span data-ttu-id="fc856-155">probe Hello riceve un TCP ripristinare le impostazioni nell'istanza del ruolo hello.</span><span class="sxs-lookup"><span data-stu-id="fc856-155">hello probe receives a TCP reset from hello role instance.</span></span>

<span data-ttu-id="fc856-156">Per altre informazioni sulla configurazione di un probe di integrità HTTP o di un probe TCP, vedere [Introduzione alla creazione di un servizio di bilanciamento del carico per Internet in Gestione risorse con PowerShell](load-balancer-get-started-internet-arm-ps.md).</span><span class="sxs-lookup"><span data-stu-id="fc856-156">For more information about configuring an HTTP health probe or a TCP probe, see [Get started creating an Internet-facing load balancer in Resource Manager using PowerShell](load-balancer-get-started-internet-arm-ps.md).</span></span>

## <a name="add-healthy-instances-back-into-load-balancer-rotation"></a><span data-ttu-id="fc856-157">Aggiungere di nuovo le istanze integre alla rotazione del servizio di bilanciamento del carico</span><span class="sxs-lookup"><span data-stu-id="fc856-157">Add healthy instances back into load balancer rotation</span></span>

<span data-ttu-id="fc856-158">Probe TCP e HTTP sono considerati integro e contrassegnare l'istanza del ruolo hello come integro quando:</span><span class="sxs-lookup"><span data-stu-id="fc856-158">TCP and HTTP probes are considered healthy and mark hello role instance as healthy when:</span></span>

* <span data-ttu-id="fc856-159">servizio di bilanciamento del carico Hello Ottiene un probe positivo hello prima ora hello che avvia macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="fc856-159">hello load balancer gets a positive probe hello first time hello VM boots.</span></span>
* <span data-ttu-id="fc856-160">numero di Hello SuccessFailCount (descritto in precedenza) definisce il valore di hello di probe ha esito positivo di istanza del ruolo obbligatorio toomark hello come integro.</span><span class="sxs-lookup"><span data-stu-id="fc856-160">hello number SuccessFailCount (described earlier) defines hello value of successful probes that are required toomark hello role instance as healthy.</span></span> <span data-ttu-id="fc856-161">Se un'istanza del ruolo è stato rimosso, il numero di hello di esito positivo, successivi probe deve essere uguale o superare il valore di hello SuccessFailCount toomark hello istanza del ruolo in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="fc856-161">If a role instance was removed, hello number of successful, successive probes must equal or exceed hello value of SuccessFailCount toomark hello role instance as running.</span></span>

> [!NOTE]
> <span data-ttu-id="fc856-162">Se sta fluttuando. potete integrità hello di un'istanza del ruolo, servizio di bilanciamento del carico hello attende più prima di inserire l'istanza del ruolo hello in stato integro hello.</span><span class="sxs-lookup"><span data-stu-id="fc856-162">If hello health of a role instance is fluctuating, hello load balancer waits longer before putting hello role instance back in hello healthy state.</span></span> <span data-ttu-id="fc856-163">Questa operazione viene eseguita tramite criteri tooprotect hello infrastruttura di utenti e hello.</span><span class="sxs-lookup"><span data-stu-id="fc856-163">This is done via policy tooprotect hello user and hello infrastructure.</span></span>

## <a name="use-log-analytics-for-load-balancer"></a><span data-ttu-id="fc856-164">Usare Analisi dei log per il servizio di bilanciamento del carico</span><span class="sxs-lookup"><span data-stu-id="fc856-164">Use log analytics for Load Balancer</span></span>

<span data-ttu-id="fc856-165">È possibile utilizzare [log analitica per il bilanciamento del carico](load-balancer-monitor-log.md) toocheck hello probe integrità dello stato e un probe numero.</span><span class="sxs-lookup"><span data-stu-id="fc856-165">You can use [log analytics for Load Balancer](load-balancer-monitor-log.md) toocheck on hello probe health status and probe count.</span></span> <span data-ttu-id="fc856-166">Consente la registrazione con Power BI o Azure Operational Insights statistiche tooprovide sullo stato di integrità di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="fc856-166">Logging can be used with Power BI or Azure Operational Insights tooprovide statistics about Load Balancer health status.</span></span>
