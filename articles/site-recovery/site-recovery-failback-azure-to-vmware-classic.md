---
title: Eseguire il failback di una macchina virtuale VMware da Azure nel portale classico | Documentazione Microsoft
description: Informazioni sul failback nel sito locale dopo il failover dei server fisici e delle macchine virtuali VMware in Azure.
services: site-recovery
documentationcenter: 
author: ruturaj
manager: mkjain
editor: 
ms.assetid: 7ca86e21-7a5d-45ab-8f4b-e42da90f199a
ms.service: site-recovery
ms.devlang: na
ms.tgt_pltfrm: na
ms.topic: article
ms.workload: storage-backup-recovery
ms.date: 06/05/2017
ms.author: ruturajd
ms.openlocfilehash: 82d5eb7fd13b1e9700a3e9bc2d30775e9c129749
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/03/2017
---
# <a name="fail-back-vmware-virtual-machines-and-physical-servers-to-the-on-premises-site-classic-portal"></a><span data-ttu-id="35a24-103">Eseguire il failback di server fisici e macchine virtuali VMware nel sito locale (portale classico)</span><span class="sxs-lookup"><span data-stu-id="35a24-103">Fail back VMware virtual machines and physical servers to the on-premises site (classic portal)</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="35a24-104">portale di Azure</span><span class="sxs-lookup"><span data-stu-id="35a24-104">Azure Portal</span></span>](site-recovery-failback-azure-to-vmware.md)
> * [<span data-ttu-id="35a24-105">Portale di Azure classico</span><span class="sxs-lookup"><span data-stu-id="35a24-105">Azure Classic Portal</span></span>](site-recovery-failback-azure-to-vmware-classic.md)
> * [<span data-ttu-id="35a24-106">Portale di Azure classico (legacy)</span><span class="sxs-lookup"><span data-stu-id="35a24-106">Azure Classic Portal (Legacy)</span></span>](site-recovery-failback-azure-to-vmware-classic-legacy.md)
>
>

<span data-ttu-id="35a24-107">Questo articolo descrive come eseguire il failback di macchine virtuali di Azure da Azure al sito locale.</span><span class="sxs-lookup"><span data-stu-id="35a24-107">This articles describes how to fail back Azure virtual machines from Azure to the on-premises site.</span></span> <span data-ttu-id="35a24-108">Seguire le istruzioni riportate in questo articolo per eseguire il failback delle macchine virtuali VMware o dei server fisici Windows/Linux dopo aver eseguito il failover dal sito locale in Azure seguendo questa [esercitazione](site-recovery-vmware-to-azure-classic.md).</span><span class="sxs-lookup"><span data-stu-id="35a24-108">Follow the instructions in this article when you're ready to fail back your VMware virtual machines or Windows/Linux physical servers after they've failed over from the on-premises site to Azure using this [tutorial](site-recovery-vmware-to-azure-classic.md).</span></span>

## <a name="overview"></a><span data-ttu-id="35a24-109">Overview</span><span class="sxs-lookup"><span data-stu-id="35a24-109">Overview</span></span>
<span data-ttu-id="35a24-110">Questo diagramma illustra l'architettura di failback per questo scenario.</span><span class="sxs-lookup"><span data-stu-id="35a24-110">This diagram shows the failback architecture for this scenario.</span></span>

<span data-ttu-id="35a24-111">Usare questa architettura quando il server di elaborazione è locale e si usa ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="35a24-111">Use this architecture when the process server is on-premises and you are using an ExpressRoute.</span></span>

![](./media/site-recovery-failback-azure-to-vmware-classic/architecture.png)

<span data-ttu-id="35a24-112">Usare questa architettura quando il server di elaborazione è in Azure e si dispone di una rete VPN o di una connessione ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="35a24-112">Use this architecture when the process server is on Azure and you have either a VPN or an ExpressRoute connection.</span></span>

![](./media/site-recovery-failback-azure-to-vmware-classic/architecture2.png)

<span data-ttu-id="35a24-113">Per vedere l'elenco completo delle porte e il diagramma che illustra l'architettura di failback, fare riferimento all'immagine sotto</span><span class="sxs-lookup"><span data-stu-id="35a24-113">To see the complete list of ports and the failback architechture diagram refer to the image below</span></span>

![](./media/site-recovery-failback-azure-to-vmware-classic/Failover-Failback.png)

<span data-ttu-id="35a24-114">Funzionamento del failback:</span><span class="sxs-lookup"><span data-stu-id="35a24-114">Here’s how failback works:</span></span>

* <span data-ttu-id="35a24-115">Dopo aver eseguito il failover in Azure, eseguire il failback nel sito locale procedendo come segue:</span><span class="sxs-lookup"><span data-stu-id="35a24-115">After you’ve failed over to Azure, you fail back to your on-premises site in a few stages:</span></span>
  * <span data-ttu-id="35a24-116">**Fase 1**: abilitare la riprotezione delle VM di Azure in modo che inizino la replica nelle macchine virtuali di VMware in esecuzione nel sito locale.</span><span class="sxs-lookup"><span data-stu-id="35a24-116">**Stage 1**: You reprotect the Azure VMs so that they start replicating back to VMware VMs running in your on-premises site.</span></span> <span data-ttu-id="35a24-117">Abilitando la riprotezione le macchine virtuali vengono spostate in un gruppo di protezione di failback creato automaticamente al momento della creazione del gruppo di protezione di failover originario.</span><span class="sxs-lookup"><span data-stu-id="35a24-117">Enabling reprotection moves the VM into a failback protection group that was created automatically when you originally created the failover protection group.</span></span> <span data-ttu-id="35a24-118">Se il gruppo di protezione di failover è stato aggiunto a un piano di ripristino, anche il gruppo di protezione di failback è stato aggiunto automaticamente al piano.</span><span class="sxs-lookup"><span data-stu-id="35a24-118">If you added your failover protection group to a recovery plan then the failback protection group was also automatically added to the plan.</span></span>  <span data-ttu-id="35a24-119">Durante la riprotezione viene specificato come pianificare il failback.</span><span class="sxs-lookup"><span data-stu-id="35a24-119">During reprotect you specify how to plan to fail back.</span></span>
  * <span data-ttu-id="35a24-120">**Fase 2**: dopo la replica delle VM di Azure nel sito locale, eseguire un failover per il failback da Azure.</span><span class="sxs-lookup"><span data-stu-id="35a24-120">**Stage 2**: After your Azure VMs are replicating to your on-premises site, you run a fail over to fail back from Azure.</span></span>
  * <span data-ttu-id="35a24-121">**Fase 3**: dopo aver eseguito il failback dei dati, abilitare la riprotezione delle macchine virtuali locali in cui è stato eseguito il failback, in modo che inizino la replica in Azure.</span><span class="sxs-lookup"><span data-stu-id="35a24-121">**Stage 3**: After your data has failed back, you reprotect the on-premises VMs that you failed back to, so that they start replicating to Azure.</span></span>


  [!VIDEO https://channel9.msdn.com/Blogs/Azure/Enhanced-VMware-to-Azure-Failback/player]

### <a name="failback-to-the-original-or-alternate-location"></a><span data-ttu-id="35a24-122">Eseguire il failback nella posizione originaria o in una posizione alternativa</span><span class="sxs-lookup"><span data-stu-id="35a24-122">Failback to the original or alternate location</span></span>
<span data-ttu-id="35a24-123">Se è stato eseguito il failover di una macchina virtuale VMware è possibile eseguire il failback nella stessa macchina virtuale di origine, se è ancora presente in locale.</span><span class="sxs-lookup"><span data-stu-id="35a24-123">If you failed over a VMware VM you can fail back to the same source VM if it still exists on-premises.</span></span> <span data-ttu-id="35a24-124">In questo scenario viene eseguito il failback delle sole modifiche differenziali.</span><span class="sxs-lookup"><span data-stu-id="35a24-124">In this scenario only the delta changes will be failed back.</span></span> <span data-ttu-id="35a24-125">Si noti che:</span><span class="sxs-lookup"><span data-stu-id="35a24-125">Note that:</span></span>

* <span data-ttu-id="35a24-126">Se è stato eseguito il failover di server fisici, il failback viene sempre eseguito in una nuova macchina virtuale VMware.</span><span class="sxs-lookup"><span data-stu-id="35a24-126">If you failed over physical servers then failback is always to a new VMware VM.</span></span>
  * <span data-ttu-id="35a24-127">Prima di eseguire il failback di una computer fisico, ricordare che</span><span class="sxs-lookup"><span data-stu-id="35a24-127">Before failing back a Physical machine note that</span></span>
  * <span data-ttu-id="35a24-128">Un computer fisico protetto viene restituito come macchina virtuale dopo aver effettuato il failover da Azure in VMware.</span><span class="sxs-lookup"><span data-stu-id="35a24-128">Physical machine protected will come back as a Virtual machine when failed over back from Azure to VMware</span></span>
  * <span data-ttu-id="35a24-129">È necessario individuare almeno un server di destinazione master e gli host ESX/ESXi necessari per il failback.</span><span class="sxs-lookup"><span data-stu-id="35a24-129">Ensure that you discover atleast one Master Target sever along with the necessary ESX/ESXi hosts to which you need to failback.</span></span>
* <span data-ttu-id="35a24-130">Se si esegue il failback nella macchina virtuale originaria è necessario quanto segue:</span><span class="sxs-lookup"><span data-stu-id="35a24-130">If you fail back to the original VM the following is required:</span></span>

  * <span data-ttu-id="35a24-131">Se la macchina virtuale è gestita da un server vCenter, l'host ESX della destinazione master deve avere accesso all'archivio dati delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="35a24-131">If the VM is managed by a vCenter server then the Master Target's ESX host should have access to the VMs datastore.</span></span>
  * <span data-ttu-id="35a24-132">Se la VM si trova in un host ESX ma non è gestita da vCenter, il relativo disco rigido deve trovarsi in un archivio dati accessibile da parte dell'host della destinazione master.</span><span class="sxs-lookup"><span data-stu-id="35a24-132">If the VM is on an ESX host but is not managed by vCenter then the hard disk of the VM must be in a datastore accessible by the MT's host.</span></span>
  * <span data-ttu-id="35a24-133">Se la macchina virtuale si trova in un host ESX e non usa vCenter, è necessario completare l'individuazione dell'host ESX della destinazione master prima di abilitare la riprotezione.</span><span class="sxs-lookup"><span data-stu-id="35a24-133">If your VM is on an ESX host and doesn't use vCenter then you should complete discovery of the ESX host of the MT before you reprotect.</span></span> <span data-ttu-id="35a24-134">Questa opzione è valida anche per il failback di server fisici.</span><span class="sxs-lookup"><span data-stu-id="35a24-134">This applies if you're failing back physical servers too.</span></span>
  * <span data-ttu-id="35a24-135">Se è presente una macchina virtuale locale, è anche possibile eliminarla prima di eseguire il failback.</span><span class="sxs-lookup"><span data-stu-id="35a24-135">Another option (if the on-premises VM exists) is to delete it before you do a failback.</span></span> <span data-ttu-id="35a24-136">Il failback crea quindi una nuova macchina virtuale nello stesso host dell'host ESX di destinazione master.</span><span class="sxs-lookup"><span data-stu-id="35a24-136">Then failback will then create a new VM on the same host as the master target ESX host.</span></span>
* <span data-ttu-id="35a24-137">Quando si esegue il failback in una posizione alternativa i dati vengono ripristinati nello stesso archivio dati e nello stesso host ESX usati dal server di destinazione master locale.</span><span class="sxs-lookup"><span data-stu-id="35a24-137">When you failback to an alternate location the data will be recovered to the same datastore and the same ESX host as that used by the on-premises master target server.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="35a24-138">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="35a24-138">Prerequisites</span></span>
* <span data-ttu-id="35a24-139">Per eseguire il failback di server fisici e macchine virtuali VMware, è necessario un ambiente VMware.</span><span class="sxs-lookup"><span data-stu-id="35a24-139">You'll need a VMware environment in order to fail back VMware VMs and physical servers.</span></span> <span data-ttu-id="35a24-140">Il failback in un server fisico non è supportato.</span><span class="sxs-lookup"><span data-stu-id="35a24-140">Failing back to a physical server isn’t supported.</span></span>
* <span data-ttu-id="35a24-141">Per eseguire il failback è necessaria una rete di Azure creata al momento dell'impostazione iniziale della protezione.</span><span class="sxs-lookup"><span data-stu-id="35a24-141">In order to fail back you should have created an Azure network when you initially set up protection.</span></span> <span data-ttu-id="35a24-142">Il failback richiede una connessione VPN o ExpressRoute dalla rete di Azure in cui si trovano le macchine virtuali di Azure al sito locale.</span><span class="sxs-lookup"><span data-stu-id="35a24-142">Failback needs a VPN or ExpressRoute connection from the Azure network in which the Azure VMs are located to the on-premises site.</span></span>
* <span data-ttu-id="35a24-143">Se le macchine virtuali in cui si vuole eseguire il failback sono gestite da un server vCenter, assicurarsi di avere le autorizzazioni necessarie per l'individuazione di macchine virtuali nei server vCenter.</span><span class="sxs-lookup"><span data-stu-id="35a24-143">If the VMs you want to fail back to are managed by a vCenter server you'll need to make sure you have the required permissions for discovery of VMs on vCenter servers.</span></span> <span data-ttu-id="35a24-144">[Altre informazioni](site-recovery-vmware-to-azure-classic.md).</span><span class="sxs-lookup"><span data-stu-id="35a24-144">[Read more](site-recovery-vmware-to-azure-classic.md).</span></span>
* <span data-ttu-id="35a24-145">Se in una macchina virtuale sono presenti snapshot la riprotezione avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="35a24-145">If snapshots are present on a VM then reprotection will fail.</span></span> <span data-ttu-id="35a24-146">È possibile eliminare gli snapshot o i dischi.</span><span class="sxs-lookup"><span data-stu-id="35a24-146">You can delete the snapshots or the disks.</span></span>
* <span data-ttu-id="35a24-147">Prima di eseguire il failback è necessario creare alcuni componenti:</span><span class="sxs-lookup"><span data-stu-id="35a24-147">Before you fail back you’ll need to create a number of components:</span></span>
  * <span data-ttu-id="35a24-148">**Creare un server di elaborazione in Azure**.</span><span class="sxs-lookup"><span data-stu-id="35a24-148">**Create a process server in Azure**.</span></span> <span data-ttu-id="35a24-149">Si tratta di una macchina virtuale di Azure che è necessario creare e lasciare in esecuzione durante il failback.</span><span class="sxs-lookup"><span data-stu-id="35a24-149">This is an Azure VM that you’ll need to create and keep running during failback.</span></span> <span data-ttu-id="35a24-150">È possibile eliminare la macchina al termine del failback.</span><span class="sxs-lookup"><span data-stu-id="35a24-150">You can delete the machine after failback is complete.</span></span>
  * <span data-ttu-id="35a24-151">**Creare un server di destinazione master**: il server di destinazione master invia e riceve i dati di failback.</span><span class="sxs-lookup"><span data-stu-id="35a24-151">**Create a master target server**: The master target server sends and receives failback data.</span></span> <span data-ttu-id="35a24-152">Nel server di gestione creato in locale è installato un server di destinazione master per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="35a24-152">The management server you created on-premises has a master target server installed by default.</span></span> <span data-ttu-id="35a24-153">Tuttavia, a seconda del volume di traffico sottoposto a failback, potrebbe essere necessario creare un server di destinazione master separato per il failback.</span><span class="sxs-lookup"><span data-stu-id="35a24-153">However, depending on the volume of failed back traffic you might need to create a separate master target server for failback.</span></span>
  * <span data-ttu-id="35a24-154">Per creare un server di destinazione master aggiuntivo in esecuzione su Linux, è necessario configurare la macchina virtuale Linux prima di installare il server di destinazione master, come descritto di seguito.</span><span class="sxs-lookup"><span data-stu-id="35a24-154">if you want to create an additional master target server running on Linux, you’ll need to set up the Linux VM before you install the master target server, as described below.</span></span>
* <span data-ttu-id="35a24-155">Quando si esegue un failback, è necessario un server di configurazione locale.</span><span class="sxs-lookup"><span data-stu-id="35a24-155">Configuration server is required on-premises when you do a failback.</span></span> <span data-ttu-id="35a24-156">Durante il failback, la macchina virtuale deve esistere nel database del server di configurazione, altrimenti il failback non avrà esito positivo.</span><span class="sxs-lookup"><span data-stu-id="35a24-156">During failback, the virtual machine must exist in the Configuration server database, failing which failback wont be successful.</span></span> <span data-ttu-id="35a24-157">Assicurarsi pertanto di pianificare backup regolari del server.</span><span class="sxs-lookup"><span data-stu-id="35a24-157">Hence ensure that you take regular scheduled backup of your server.</span></span> <span data-ttu-id="35a24-158">In caso di emergenza, è necessario ripristinare il server con lo stesso indirizzo IP in modo che il failback funzioni.</span><span class="sxs-lookup"><span data-stu-id="35a24-158">In case of a disaster, you will need to restore it with the same IP address so that failback will work.</span></span>

## <a name="set-up-the-process-server-in-azure"></a><span data-ttu-id="35a24-159">Configurare il server di elaborazione in Azure</span><span class="sxs-lookup"><span data-stu-id="35a24-159">Set up the process server in Azure</span></span>
<span data-ttu-id="35a24-160">È necessario installare un server di elaborazione in Azure per permettere alle macchine virtuali di Azure di rinviare i dati al server di destinazione master locale.</span><span class="sxs-lookup"><span data-stu-id="35a24-160">You need to install a process server in Azure so that the Azure VMs can send the data back to on-premises master target server.</span></span>

1. <span data-ttu-id="35a24-161">Nel portale di Site Recovery selezionare **Server di configurazione** per aggiungere un nuovo server di elaborazione.</span><span class="sxs-lookup"><span data-stu-id="35a24-161">In the Site Recovery portal >  **Configuration Servers** select to add a new process server.</span></span>

   ![](./media/site-recovery-failback-azure-to-vmware-classic/ps1.png)
2. <span data-ttu-id="35a24-162">Specificare un nome per il server di elaborazione e immettere un nome e una password per connettersi alla macchina virtuale di Azure come amministratore.</span><span class="sxs-lookup"><span data-stu-id="35a24-162">Specify a process server name, and enter a name and password you'll use to connect to the Azure VM as an administrator.</span></span> <span data-ttu-id="35a24-163">In **Server di configurazione** selezionare il server di gestione locale e specificare la rete di Azure in cui distribuire il server di elaborazione.</span><span class="sxs-lookup"><span data-stu-id="35a24-163">In **Configuration Server** select the on-premises management server, and specify the Azure network in which the process server should be deployed.</span></span> <span data-ttu-id="35a24-164">La rete deve essere quella in cui si trovano le macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="35a24-164">This should be the network in which the Azure VMs are located.</span></span> <span data-ttu-id="35a24-165">Specificare un indirizzo IP univoco dalla subnet selezionata e avviare la distribuzione.</span><span class="sxs-lookup"><span data-stu-id="35a24-165">Specify a unique IP address from the select subnet and begin deployment.</span></span>

   ![](./media/site-recovery-failback-azure-to-vmware-classic/ps2.png)

   <span data-ttu-id="35a24-166">Verrà attivato un processo di distribuzione del server di elaborazione.</span><span class="sxs-lookup"><span data-stu-id="35a24-166">A job to deploy the process server will be triggered</span></span>

   ![](./media/site-recovery-failback-azure-to-vmware-classic/ps3.png)

   <span data-ttu-id="35a24-167">Dopo che il server di elaborazione è stato distribuito in Azure, è possibile accedere al server usando le credenziali specificate.</span><span class="sxs-lookup"><span data-stu-id="35a24-167">After the process server is deployed in Azure you can log onto it using the credentials you specified.</span></span> <span data-ttu-id="35a24-168">Al primo accesso viene visualizzata la finestra di dialogo del server di elaborazione.</span><span class="sxs-lookup"><span data-stu-id="35a24-168">The first time you log in the process server dialog will run.</span></span> <span data-ttu-id="35a24-169">Digitare l'indirizzo IP e la passphrase del server di gestione locale.</span><span class="sxs-lookup"><span data-stu-id="35a24-169">Type in the IP address of the on-premises management server and its passphrase.</span></span> <span data-ttu-id="35a24-170">Lasciare la porta 443 come impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="35a24-170">Leave the default port 443 setting.</span></span> <span data-ttu-id="35a24-171">È anche possibile lasciare la porta 9443 come impostazione predefinita per la replica dei dati a meno che questa impostazione non sia stata specificamente modificata durante la configurazione del server di gestione locale.</span><span class="sxs-lookup"><span data-stu-id="35a24-171">You can also leave the default 9443 port for data replication unless you specifically modified this setting when you set up the on-premises management server.</span></span>

   > [!NOTE]
   > <span data-ttu-id="35a24-172">Il server non è visibile nelle **proprietà della macchina virtuale**,</span><span class="sxs-lookup"><span data-stu-id="35a24-172">The server won't be visible under **VM properties**.</span></span> <span data-ttu-id="35a24-173">ma solo nella scheda **Server** del server di gestione in cui è stato registrato.</span><span class="sxs-lookup"><span data-stu-id="35a24-173">It's only visible under the **Servers** tab in the management server to which it's been registered.</span></span> <span data-ttu-id="35a24-174">Possono essere necessari circa 10-15 minuti perché il server di elaborazione venga visualizzato.</span><span class="sxs-lookup"><span data-stu-id="35a24-174">It can take about 10-15 mins for the process server to appear.</span></span>
   >
   >

## <a name="set-up-the-master-target-server-on-premises"></a><span data-ttu-id="35a24-175">Configurare il server di destinazione master in locale</span><span class="sxs-lookup"><span data-stu-id="35a24-175">Set up the master target server on-premises</span></span>
<span data-ttu-id="35a24-176">Il server di destinazione master riceve i dati di failback.</span><span class="sxs-lookup"><span data-stu-id="35a24-176">The master target server receives the failback data.</span></span> <span data-ttu-id="35a24-177">Un server di destinazione master viene installato automaticamente nel server di gestione locale, ma se si esegue il failback di una grande quantità di dati potrebbe essere necessario configurare un server di destinazione master aggiuntivo.</span><span class="sxs-lookup"><span data-stu-id="35a24-177">A master target server is automatically installed on the on-premises management server but if you're failing back a lot of data you might need to set up an additional master target server.</span></span> <span data-ttu-id="35a24-178">Procedere come segue:</span><span class="sxs-lookup"><span data-stu-id="35a24-178">Do this as follows:</span></span>

> [!NOTE]
> <span data-ttu-id="35a24-179">Per installare un server di destinazione master in Linux, seguire le istruzioni riportate nella procedura successiva.</span><span class="sxs-lookup"><span data-stu-id="35a24-179">If you want to install a master target server on Linux, follow the instructions in the next procedure.</span></span>
>
>

1. <span data-ttu-id="35a24-180">Se si installa il server di destinazione master in Windows, aprire la pagina Avvio rapido dalla macchina virtuale in cui si sta installando il server di destinazione master e scaricare il file di installazione per l'installazione guidata unificata di Azure Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="35a24-180">If you're installing the master target server on Windows, open the Quick Start page from the VM on which you're installing the master target server, and download the installation file for the Azure Site Recovery Unified Setup wizard.</span></span>
2. <span data-ttu-id="35a24-181">Eseguire la configurazione, quindi in **Prima di iniziare** selezionare **Add additional process servers to scale out deployment** (Aggiungere server di elaborazione per aumentare le istanze di distribuzione).</span><span class="sxs-lookup"><span data-stu-id="35a24-181">Run setup and in **Before you begin** select **Add additional process servers to scale out deployment**.</span></span>
3. <span data-ttu-id="35a24-182">Completare la procedura guidata come per la [configurazione del server di gestione](site-recovery-vmware-to-azure-classic.md).</span><span class="sxs-lookup"><span data-stu-id="35a24-182">Complete the wizard in the same way you did when you [set up the management server](site-recovery-vmware-to-azure-classic.md).</span></span> <span data-ttu-id="35a24-183">Nella pagina **Dettagli del server di configurazione** specificare l'indirizzo IP del server di destinazione master e una passphrase per accedere alla macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="35a24-183">On the **Configuration Server Details** page, specify the IP address of this master target server, and a passphrase to access the VM.</span></span>

### <a name="set-up-a-linux-vm-as-the-master-target-server"></a><span data-ttu-id="35a24-184">Configurare una macchina virtuale Linux come server di destinazione master</span><span class="sxs-lookup"><span data-stu-id="35a24-184">Set up a Linux VM as the master target server</span></span>
<span data-ttu-id="35a24-185">Per configurare il server di gestione che esegue il server di destinazione master come una macchina virtuale Linux è necessario installare il sistema operativo minimo CentOS 6.6, recuperare gli ID SCSI per ogni disco rigido SCSI, installare alcuni pacchetti aggiuntivi e applicare alcune modifiche personalizzate.</span><span class="sxs-lookup"><span data-stu-id="35a24-185">To set up the management server running the master target server as a Linux VM you'll need to install the Cent)S 6.6 minimal operating system, retrieve the SCSI IDs for each SCSI hard disk, install some additional packages, and apply some custom changes.</span></span>

#### <a name="install-centos-66"></a><span data-ttu-id="35a24-186">Installare CentOS 6.6</span><span class="sxs-lookup"><span data-stu-id="35a24-186">Install CentOS 6.6</span></span>
1. <span data-ttu-id="35a24-187">Installare il sistema operativo minimo CentOS 6.6 nella macchina virtuale del server di gestione.</span><span class="sxs-lookup"><span data-stu-id="35a24-187">Install the CentOS 6.6 minimal operating system on the management server VM.</span></span> <span data-ttu-id="35a24-188">Lasciare l'immagine ISO in un'unità DVD e avviare il sistema.</span><span class="sxs-lookup"><span data-stu-id="35a24-188">Keep the ISO in a DVD drive and boot the system.</span></span> <span data-ttu-id="35a24-189">Ignorare il test dei supporti, selezionare Inglese (Stati Uniti) come lingua, selezionare **Dispositivi di archiviazione di base**, verificare che il disco rigido non contenga dati importanti e fare clic su **Sì**. Tutti i dati verranno rimossi.</span><span class="sxs-lookup"><span data-stu-id="35a24-189">Skip the media testing, select US English at the language, select **Basic Storage Devices**, check that the hard drive doesn’t have any important data and click **Yes**, discard any data.</span></span> <span data-ttu-id="35a24-190">Immettere il nome host del server di gestione e selezionare la scheda di rete del server.</span><span class="sxs-lookup"><span data-stu-id="35a24-190">Enter the host name of the management server and select the server network adapter.</span></span>  <span data-ttu-id="35a24-191">Nella finestra di dialogo **Modifica del sistema** selezionare ** Connetti automaticamente** e aggiungere un indirizzo IP statico, una rete e le impostazioni DNS.</span><span class="sxs-lookup"><span data-stu-id="35a24-191">In the **Editing System** dialog select** Connect automatically** and add a static IP address, network, and DNS settings.</span></span> <span data-ttu-id="35a24-192">Specificare un fuso orario e una password radice per accedere al server di gestione.</span><span class="sxs-lookup"><span data-stu-id="35a24-192">Specify a time zone, and a root password to access the management server.</span></span>
2. <span data-ttu-id="35a24-193">Quando viene richiesto il tipo di installazione, selezionare **Crea layout personalizzato** come partizione.</span><span class="sxs-lookup"><span data-stu-id="35a24-193">When you asked the type of installation you’d like select **Create Custom Layout** as the partition.</span></span> <span data-ttu-id="35a24-194">Dopo aver fatto clic su **Avanti** select **Gratuito** e fare clic su Crea.</span><span class="sxs-lookup"><span data-stu-id="35a24-194">After you click **Next** select **Free** and click Create.</span></span> <span data-ttu-id="35a24-195">Creare **/**, **/var/crash** e **/home partitions** con **FS Type:** **ext4**.</span><span class="sxs-lookup"><span data-stu-id="35a24-195">Create **/**,  **/var/crash** and **/home partitions** with **FS Type:** **ext4**.</span></span> <span data-ttu-id="35a24-196">Creare la partizione di scambio con **FS Type: swap**.</span><span class="sxs-lookup"><span data-stu-id="35a24-196">Create the swap partion as **FS Type: swap**.</span></span>
3. <span data-ttu-id="35a24-197">Se vengono rilevati dispositivi preesistenti viene visualizzato un messaggio di avviso.</span><span class="sxs-lookup"><span data-stu-id="35a24-197">If pre-existing devices are found a warning message will appear.</span></span> <span data-ttu-id="35a24-198">Fare clic su **Formatta** per formattare l'unità con le impostazioni della partizione.</span><span class="sxs-lookup"><span data-stu-id="35a24-198">Click **Format** to format the drive with the partition settings.</span></span> <span data-ttu-id="35a24-199">Fare clic su **Scrivi modifica su disco** per applicare le modifiche della partizione.</span><span class="sxs-lookup"><span data-stu-id="35a24-199">Click **Write change to disk** to apply the partition changes.</span></span>
4. <span data-ttu-id="35a24-200">Selezionare **Installa caricatore di avvio** > **Avanti** per installare il caricatore di avvio nella partizione radice.</span><span class="sxs-lookup"><span data-stu-id="35a24-200">Select **Install boot loader** > **Next** to install the boot loader on the root partition.</span></span>
5. <span data-ttu-id="35a24-201">Al termine dell'installazione, fare clic su **Riavvia**.</span><span class="sxs-lookup"><span data-stu-id="35a24-201">When installation is complete click **Reboot**.</span></span>

#### <a name="retrieve-the-scsi-ids"></a><span data-ttu-id="35a24-202">Recuperare gli ID SCSI</span><span class="sxs-lookup"><span data-stu-id="35a24-202">Retrieve the SCSI IDs</span></span>
1. <span data-ttu-id="35a24-203">Dopo l'installazione, recuperare gli ID SCSI per ogni disco rigido SCSI nella macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="35a24-203">After installation retrieve the SCSI IDs for each SCSI hard disk in the VM.</span></span> <span data-ttu-id="35a24-204">A tale scopo, arrestare la VM del server di gestione nelle proprietà della VM in VMware, fare clic con il pulsante destro del mouse sulla voce della VM > **Modifica impostazioni** > **Opzioni**.</span><span class="sxs-lookup"><span data-stu-id="35a24-204">To do this shut down the management server VM, in the VM properties in VMware right-click the VM entry > **Edit Settings** > **Options**.</span></span>
2. <span data-ttu-id="35a24-205">Selezionare **Avanzate** > **Generale** e fare clic su **Parametri di configurazione**.</span><span class="sxs-lookup"><span data-stu-id="35a24-205">Select **Advanced** > **General item** and click **Configuration Parameters**.</span></span> <span data-ttu-id="35a24-206">Quando il computer è in esecuzione questa opzione è disattivata.</span><span class="sxs-lookup"><span data-stu-id="35a24-206">This option will be de-active when the machine is running.</span></span> <span data-ttu-id="35a24-207">Per attivarla è necessario arrestare il computer.</span><span class="sxs-lookup"><span data-stu-id="35a24-207">To make it active the machine must be shut down.</span></span>
3. <span data-ttu-id="35a24-208">Se la riga **disk.EnableUUID** esiste, verificare che il valore sia impostato su **True**, con distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="35a24-208">If the row **disk.EnableUUID** exists make sure the value is set to **True** (case sensitive).</span></span> <span data-ttu-id="35a24-209">Se il valore è già impostato su True, è possibile annullare e testare il comando SCSI in un sistema operativo guest dopo l'avvio.</span><span class="sxs-lookup"><span data-stu-id="35a24-209">If it already is you can cancel and test the SCSI command inside a guest operating system after it’s booted.</span></span>
4. <span data-ttu-id="35a24-210">Se la riga non esiste, fare clic su **Aggiungi riga** e aggiungerla impostando il valore su **True**.</span><span class="sxs-lookup"><span data-stu-id="35a24-210">If the row doesn’t existing click **Add Row** – and add it with the **True** value.</span></span> <span data-ttu-id="35a24-211">Non usare le virgolette doppie.</span><span class="sxs-lookup"><span data-stu-id="35a24-211">Don’t use double-quotes.</span></span>

#### <a name="install-additional-packages"></a><span data-ttu-id="35a24-212">Installare pacchetti aggiuntivi</span><span class="sxs-lookup"><span data-stu-id="35a24-212">Install additional packages</span></span>
<span data-ttu-id="35a24-213">È necessario scaricare e installare alcuni pacchetti aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="35a24-213">You’ll need to download and install some additional packages.</span></span>

1. <span data-ttu-id="35a24-214">Assicurarsi che il server di destinazione master sia connesso a Internet.</span><span class="sxs-lookup"><span data-stu-id="35a24-214">Make sure the master target server is connected to the internet.</span></span>
2. <span data-ttu-id="35a24-215">Eseguire questo comando per scaricare e installare 15 pacchetti dal repository di CentOS: **# yum install –y xfsprogs perl lsscsi rsync wget kexec-tools**.</span><span class="sxs-lookup"><span data-stu-id="35a24-215">Run this command to download and install 15 packages from the CentOS repository: **# yum install –y xfsprogs perl lsscsi rsync wget kexec-tools**.</span></span>
3. <span data-ttu-id="35a24-216">Se le macchine di origine da proteggere eseguono Linux con il file system Reiser o XFS per il dispositivo di avvio o radice, è necessario scaricare e installare pacchetti aggiuntivi come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="35a24-216">If the source machines you’re protecting are running Linux wit Reiser or XFS file system for the root or boot device, then you should download and install additional packages as follows:</span></span>

   * # <a name="cd-usrlocal"></a><span data-ttu-id="35a24-217">cd /usr/local</span><span class="sxs-lookup"><span data-stu-id="35a24-217">cd /usr/local</span></span>
   * # <a name="wget-httpelrepoorglinuxelrepoel6x8664rpmskmod-reiserfs-00-1el6elrepox8664rpmhttpelrepoorglinuxelrepoel6x8664rpmskmod-reiserfs-00-1el6elrepox8664rpm"></a><span data-ttu-id="35a24-218">wget [http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/kmod-reiserfs-0.0-1.el6.elrepo.x86_64.rpm](http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/kmod-reiserfs-0.0-1.el6.elrepo.x86_64.rpm)</span><span class="sxs-lookup"><span data-stu-id="35a24-218">wget [http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/kmod-reiserfs-0.0-1.el6.elrepo.x86_64.rpm](http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/kmod-reiserfs-0.0-1.el6.elrepo.x86_64.rpm)</span></span>
   * # <a name="wget-httpelrepoorglinuxelrepoel6x8664rpmsreiserfs-utils-3621-1el6elrepox8664rpmhttpelrepoorglinuxelrepoel6x8664rpmsreiserfs-utils-3621-1el6elrepox8664rpm"></a><span data-ttu-id="35a24-219">wget [http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/reiserfs-utils-3.6.21-1.el6.elrepo.x86_64.rpm](http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/reiserfs-utils-3.6.21-1.el6.elrepo.x86_64.rpm)</span><span class="sxs-lookup"><span data-stu-id="35a24-219">wget [http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/reiserfs-utils-3.6.21-1.el6.elrepo.x86_64.rpm](http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/reiserfs-utils-3.6.21-1.el6.elrepo.x86_64.rpm)</span></span>
   * # <a name="rpm-ivh-kmod-reiserfs-00-1el6elrepox8664rpm-reiserfs-utils-3621-1el6elrepox8664rpm"></a><span data-ttu-id="35a24-220">rpm –ivh kmod-reiserfs-0.0-1.el6.elrepo.x86_64.rpm reiserfs-utils-3.6.21-1.el6.elrepo.x86_64.rpm</span><span class="sxs-lookup"><span data-stu-id="35a24-220">rpm –ivh kmod-reiserfs-0.0-1.el6.elrepo.x86_64.rpm reiserfs-utils-3.6.21-1.el6.elrepo.x86_64.rpm</span></span>
   * # <a name="wget-httpmirrorcentosorgcentos66osx8664packagesxfsprogs-311-16el6x8665rpmhttpmirrorcentosorgcentos66osx8664packagesxfsprogs-311-16el6x8665rpm"></a><span data-ttu-id="35a24-221">wget [http://mirror.centos.org/centos/6.6/os/x86_64/Packages/xfsprogs-3.1.1-16.el6.x86_65.rpm](http://mirror.centos.org/centos/6.6/os/x86_64/Packages/xfsprogs-3.1.1-16.el6.x86_65.rpm)</span><span class="sxs-lookup"><span data-stu-id="35a24-221">wget [http://mirror.centos.org/centos/6.6/os/x86_64/Packages/xfsprogs-3.1.1-16.el6.x86_65.rpm](http://mirror.centos.org/centos/6.6/os/x86_64/Packages/xfsprogs-3.1.1-16.el6.x86_65.rpm)</span></span>
   * # <a name="rpm-ivh-xfsprogs-311-16el6x8664rpm"></a><span data-ttu-id="35a24-222">rpm –ivh xfsprogs-3.1.1-16.el6.x86_64.rpm</span><span class="sxs-lookup"><span data-stu-id="35a24-222">rpm –ivh xfsprogs-3.1.1-16.el6.x86_64.rpm</span></span>

#### <a name="apply-custom-changes"></a><span data-ttu-id="35a24-223">Applicare modifiche personalizzate</span><span class="sxs-lookup"><span data-stu-id="35a24-223">Apply custom changes</span></span>
<span data-ttu-id="35a24-224">Per applicare modifiche personalizzate dopo aver completato i passaggi successivi all'installazione e aver installato i pacchetti, eseguire queste operazioni:</span><span class="sxs-lookup"><span data-stu-id="35a24-224">Do the following to apply custom changes after you’ve complete the post-installation steps and installed the packages:</span></span>

1. <span data-ttu-id="35a24-225">Copiare il file binario di RHEL 6-64 Unified Agent nella macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="35a24-225">Copy the RHEL 6-64 Unified Agent binary to the VM.</span></span> <span data-ttu-id="35a24-226">Eseguire questo comando per decomprimere il file binario: **tar –zxvf <file name>**</span><span class="sxs-lookup"><span data-stu-id="35a24-226">Run this command to untar the binary: **tar –zxvf <file name>**</span></span>
2. <span data-ttu-id="35a24-227">Eseguire questo comando per concedere le autorizzazioni: **#chmod 755 ./ApplyCustomChanges.sh**</span><span class="sxs-lookup"><span data-stu-id="35a24-227">Run this command to give permissions: **# chmod 755 ./ApplyCustomChanges.sh**</span></span>
3. <span data-ttu-id="35a24-228">Eseguire lo script: **# ./ApplyCustomChanges.sh**.</span><span class="sxs-lookup"><span data-stu-id="35a24-228">Run the script: **# ./ApplyCustomChanges.sh**.</span></span> <span data-ttu-id="35a24-229">Eseguire lo script solo una volta.</span><span class="sxs-lookup"><span data-stu-id="35a24-229">You should only run the script once.</span></span> <span data-ttu-id="35a24-230">Riavviare il server dopo l'esecuzione dello script.</span><span class="sxs-lookup"><span data-stu-id="35a24-230">Reboot the server after the script runs successfully.</span></span>

## <a name="run-the-failback"></a><span data-ttu-id="35a24-231">Eseguire il failback</span><span class="sxs-lookup"><span data-stu-id="35a24-231">Run the failback</span></span>
### <a name="reprotect-the-azure-vms"></a><span data-ttu-id="35a24-232">Abilitare la riprotezione delle macchine virtuali di Azure</span><span class="sxs-lookup"><span data-stu-id="35a24-232">Reprotect the Azure VMs</span></span>
1. <span data-ttu-id="35a24-233">Nel portale di Site Recovery > scheda **Computer** selezionare la VM di cui è stato eseguito il failover e fare clic su **Riproteggi**.</span><span class="sxs-lookup"><span data-stu-id="35a24-233">In the Site Recovery  portal > **Machines** tab select the VM that's been failed over and click **Re-Protect**.</span></span>
2. <span data-ttu-id="35a24-234">In **Server di destinazione master** e **Server di elaborazione** selezionare il server di destinazione master locale e il server di elaborazione della VM di Azure.</span><span class="sxs-lookup"><span data-stu-id="35a24-234">In **Master Target Server** and **Process Server** select the on-premises master target server, and the Azure VM process server.</span></span>
3. <span data-ttu-id="35a24-235">Selezionare l'account configurato per la connessione alla macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="35a24-235">Select the account you configured for connecting to the VM.</span></span>
4. <span data-ttu-id="35a24-236">Selezionare la versione del failback del gruppo di protezione.</span><span class="sxs-lookup"><span data-stu-id="35a24-236">Select the failback version of the protection group.</span></span> <span data-ttu-id="35a24-237">Ad esempio, se la macchina virtuale è protetta in PG1, è necessario selezionare PG1_Failback.</span><span class="sxs-lookup"><span data-stu-id="35a24-237">For example if the VM is protected in PG1 then you'll need to select PG1_Failback.</span></span>
5. <span data-ttu-id="35a24-238">Per eseguire il ripristino in un percorso alternativo, selezionare l'unità di conservazione e l'archivio dati configurati per il server di destinazione master.</span><span class="sxs-lookup"><span data-stu-id="35a24-238">If you want to recover to an alternate location, select the retention drive and datastore configured for the master target server.</span></span> <span data-ttu-id="35a24-239">Quando si esegue il failback al sito locale, le macchine virtuali VMware nel piano di protezione di failback usano lo stesso archivio dati del server di destinazione master.</span><span class="sxs-lookup"><span data-stu-id="35a24-239">When you fail back to the on-premises site the VMware VMs in the failback protection plan will use the same datastore as the master target server.</span></span> <span data-ttu-id="35a24-240">Per ripristinare la macchina virtuale di Azure di replica nella stessa macchina virtuale locale, quest'ultima deve già trovarsi nello stesso archivio dati del server di destinazione master.</span><span class="sxs-lookup"><span data-stu-id="35a24-240">If you want to recover the replica Azure VM to the same on-premises VM then the on-premises VM should already be in the same datastore as the master target server.</span></span> <span data-ttu-id="35a24-241">Se non è presente alcuna macchina virtuale in locale, ne viene creata una nuova durante la riprotezione.</span><span class="sxs-lookup"><span data-stu-id="35a24-241">If there's no VM on-premises a new one will be created during reprotection.</span></span>

   ![](./media/site-recovery-failback-azure-to-vmware-classic/failback1.png)
6. <span data-ttu-id="35a24-242">Dopo aver fatto clic su **OK** per avviare la riprotezione, inizia un processo di replica della VM da Azure al sito locale.</span><span class="sxs-lookup"><span data-stu-id="35a24-242">After you click **OK** to begin reprotection a job begins to replicate the VM from Azure to the on-premises site.</span></span> <span data-ttu-id="35a24-243">È possibile monitorare l'avanzamento nella scheda **Processi** .</span><span class="sxs-lookup"><span data-stu-id="35a24-243">You can track the progress on the **Jobs** tab.</span></span>

   ![](./media/site-recovery-failback-azure-to-vmware-classic/failback2.png)

### <a name="run-a-failover-to-the-on-premises-site"></a><span data-ttu-id="35a24-244">Eseguire un failover nel sito locale</span><span class="sxs-lookup"><span data-stu-id="35a24-244">Run a failover to the on-premises site</span></span>
<span data-ttu-id="35a24-245">Dopo la riprotezione la macchina virtuale viene spostata nella versione di failback del relativo gruppo di protezione e viene aggiunta automaticamente all'eventuale piano di ripristino usato per il failover in Azure.</span><span class="sxs-lookup"><span data-stu-id="35a24-245">After reprotection the VM is moved to the failback version of its protection group and is automatically added to the recovery plan you used for the failover to Azure if there is one.</span></span>

1. <span data-ttu-id="35a24-246">Nella pagina **Piani di ripristino** selezionare il piano di ripristino che contiene il gruppo di failback e fare clic su **Failover** > **Failover non pianificato**.</span><span class="sxs-lookup"><span data-stu-id="35a24-246">In the **Recovery Plans** page select the recovery plan containing the failback group and click **Failover** > **Unplanned Failover**.</span></span>
2. <span data-ttu-id="35a24-247">In **Conferma failover** verificare la direzione del failover (Azure) e selezionare il punto di ripristino da usare per il failover. Usare il più recente.</span><span class="sxs-lookup"><span data-stu-id="35a24-247">In **Confirm Failover** verify the failover direction (to Azure) and select the recovery point you want to use for the failover (latest).</span></span> <span data-ttu-id="35a24-248">Se nella configurazione delle proprietà della replica sono state abilitate **più VM**, è possibile ripristinare fino all'ultimo punto di ripristino coerente con l'app o l'arresto anomalo del sistema.</span><span class="sxs-lookup"><span data-stu-id="35a24-248">If you enabled **Multi-VM** when you configured replication properties you can recover to the latest app or crash-consistent recovery point.</span></span> <span data-ttu-id="35a24-249">Fare clic sul segno di spunta per avviare il failover.</span><span class="sxs-lookup"><span data-stu-id="35a24-249">Click the check mark to start the failover.</span></span>
3. <span data-ttu-id="35a24-250">Durante il failover, Site Recovery arresta le macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="35a24-250">During failover Site Recovery will shut down the Azure VMs.</span></span> <span data-ttu-id="35a24-251">Assicurarsi che il failback sia stato completato e quindi verificare che le macchine virtuali di Azure siano state arrestate come previsto.</span><span class="sxs-lookup"><span data-stu-id="35a24-251">After you check that failback has completed as expected you can you can check that the Azure VMs have been shut down as expected.</span></span>

### <a name="reprotect-the--on-premises-site"></a><span data-ttu-id="35a24-252">Riproteggere il sito locale</span><span class="sxs-lookup"><span data-stu-id="35a24-252">Reprotect the  on-premises site</span></span>
<span data-ttu-id="35a24-253">Al termine del failback i dati si trovano nuovamente nel sito locale, ma non sono protetti.</span><span class="sxs-lookup"><span data-stu-id="35a24-253">After failback completes your data will be back on the on-premises site, but won’t be protected.</span></span> <span data-ttu-id="35a24-254">Per avviare nuovamente la replica in Azure, eseguire queste operazioni:</span><span class="sxs-lookup"><span data-stu-id="35a24-254">To start replicating to Azure again do the following:</span></span>

1. <span data-ttu-id="35a24-255">Nel portale di Site Recovery > scheda **Computer** selezionare le VM di cui è stato eseguito il failback e fare clic su **Riproteggi**.</span><span class="sxs-lookup"><span data-stu-id="35a24-255">In the Site Recovery portal > **Machines** tab select the VMs that have failed back and click **Re-Protect**.</span></span>
2. <span data-ttu-id="35a24-256">Dopo aver verificato il funzionamento della replica di Azure, in Azure è possibile eliminare le macchine virtuali di Azure (attualmente non in esecuzione) di cui è stato eseguito il failback.</span><span class="sxs-lookup"><span data-stu-id="35a24-256">After you verify that replication to Azure is working as expected, in Azure you can delete the Azure VMs (currently not running) that were failed back.</span></span>

### <a name="common-issues-in-failback"></a><span data-ttu-id="35a24-257">Problemi comuni di failback</span><span class="sxs-lookup"><span data-stu-id="35a24-257">Common Issues in failback</span></span>
1. <span data-ttu-id="35a24-258">Se si esegue l'individuazione di vCenter con utente di sola lettura e la protezione delle macchine virtuali, il processo funziona e il failover viene eseguito.</span><span class="sxs-lookup"><span data-stu-id="35a24-258">If you perform Read-Only User vCenter discovery and protect virtual machines, it succeeds and failover works.</span></span> <span data-ttu-id="35a24-259">Al momento della riprotezione, si verificherà un errore poiché non è stato possibile individuare gli archivi dati.</span><span class="sxs-lookup"><span data-stu-id="35a24-259">At the time of Reprotect, it will fail since the datastores cannot be discovered.</span></span> <span data-ttu-id="35a24-260">Non verranno quindi visualizzati gli archivi dati elencati durante la riprotezione.</span><span class="sxs-lookup"><span data-stu-id="35a24-260">As a symptom you will not see the datastores listed while re-protecting.</span></span> <span data-ttu-id="35a24-261">Per risolvere questo problema, è possibile aggiornare le credenziali di vCenter usando un account appropriato che abbia le autorizzazioni, quindi ripetere il processo.</span><span class="sxs-lookup"><span data-stu-id="35a24-261">To resolve this, you can update the vCenter credential with appropriate account that has permissions and retry the job.</span></span> [<span data-ttu-id="35a24-262">Altre informazioni</span><span class="sxs-lookup"><span data-stu-id="35a24-262">Read more</span></span>](site-recovery-vmware-to-azure-classic.md)
2. <span data-ttu-id="35a24-263">Quando si esegue il failback di una macchina virtuale Linux e l'esecuzione è locale, si noti che il pacchetto di gestione reti viene disinstallato dal computer.</span><span class="sxs-lookup"><span data-stu-id="35a24-263">When you failback a Linux VM and run it on-prem, you will see that the Network Manager package is uninstalled from the machine.</span></span> <span data-ttu-id="35a24-264">Quando la macchina virtuale viene infatti ripristinata in Azure, il pacchetto di gestione reti viene rimosso.</span><span class="sxs-lookup"><span data-stu-id="35a24-264">This is because when the VM is recovered in Azure, the Network Manager package is removed.</span></span>
3. <span data-ttu-id="35a24-265">Se per la configurazione di una macchina virtuale viene usato un indirizzo IP statico e viene effettuato il failover in Azure, l'indirizzo IP viene acquisito tramite DHCP.</span><span class="sxs-lookup"><span data-stu-id="35a24-265">When a VM is configured with Static IP address and is failed over to Azure, the IP address is acquired via DHCP.</span></span> <span data-ttu-id="35a24-266">Quando il failover viene effettuato di nuovo in locale, la macchina virtuale continua a usare il protocollo DHCP per acquisire l'indirizzo IP.</span><span class="sxs-lookup"><span data-stu-id="35a24-266">When you fail over back to On-prem, the VM continues to use DHCP to acquire the IP address.</span></span> <span data-ttu-id="35a24-267">Se necessario, accedere manualmente al computer e impostare l'indirizzo IP nell'indirizzo statico.</span><span class="sxs-lookup"><span data-stu-id="35a24-267">You will need to manually login into the machine and set the IP address back to Static address if required.</span></span>
4. <span data-ttu-id="35a24-268">Se si usa l'edizione gratuita di ESXi 5.5 o di vSphere 6 Hypervisor, sarà possibile effettuare il failover, ma non eseguire il failback.</span><span class="sxs-lookup"><span data-stu-id="35a24-268">If you are using either ESXi 5.5 free edition or vSphere 6 Hypervisor free edition, failover would succeed, but failback will not succeed.</span></span> <span data-ttu-id="35a24-269">Sarà necessario scegliere l'aggiornamento alla licenza di valutazione per abilitare il failback.</span><span class="sxs-lookup"><span data-stu-id="35a24-269">You will ned to upgrade to either Evaluation License to enable failback.</span></span>

## <a name="failing-back-with-expressroute"></a><span data-ttu-id="35a24-270">Eseguire il failback con ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="35a24-270">Failing back with ExpressRoute</span></span>
<span data-ttu-id="35a24-271">È possibile eseguire il failback usando una connessione VPN o Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="35a24-271">You can fail back over a VPN connection or Azure ExpressRoute.</span></span> <span data-ttu-id="35a24-272">Per usare ExpressRoute occorre tenere presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="35a24-272">If you want to use ExpressRoute note the following:</span></span>

* <span data-ttu-id="35a24-273">ExpressRoute deve essere configurato nella rete virtuale di Azure in cui viene eseguito il failover dei computer di origine e in cui si trovano le macchine virtuali di Azure dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="35a24-273">ExpressRoute should be set up on the Azure virtual network to which source machines fail over, and in which Azure VMs are located after the failover occurs.</span></span>
* <span data-ttu-id="35a24-274">I dati vengono replicati in un account di archiviazione di Azure in un endpoint pubblico.</span><span class="sxs-lookup"><span data-stu-id="35a24-274">Data is replicated to an Azure storage account on a public endpoint.</span></span> <span data-ttu-id="35a24-275">È necessario configurare il peering pubblico in ExpressRoute specificando il data center di destinazione per consentire l'uso di ExpressRoute da parte della replica di Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="35a24-275">You should set up public peering in ExpressRoute with the target data center for Site Recovery replication to use ExpressRoute.</span></span>
