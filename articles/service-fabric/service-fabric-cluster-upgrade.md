---
title: un cluster di Azure Service Fabric aaaUpgrade | Documenti Microsoft
description: "Aggiornare il codice di Service Fabric hello e/o di configurazione che esegue un cluster di Service Fabric, inclusa l'impostazione di modalità di aggiornamento del cluster, aggiornamento dei certificati, aggiunta di porte di applicazione, questa patch del sistema operativo, e così via. Cosa può aspettarsi quando vengono eseguiti gli aggiornamenti di hello?"
services: service-fabric
documentationcenter: .net
author: ChackDan
manager: timlt
editor: 
ms.assetid: 15190ace-31ed-491f-a54b-b5ff61e718db
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 8/10/2017
ms.author: chackdan
ms.openlocfilehash: 94ac3833ec0810f79de06ecb50f254028fa90408
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="upgrade-an-azure-service-fabric-cluster"></a><span data-ttu-id="9c355-104">Aggiornare un cluster di Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="9c355-104">Upgrade an Azure Service Fabric cluster</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="9c355-105">Cluster di Azure</span><span class="sxs-lookup"><span data-stu-id="9c355-105">Azure Cluster</span></span>](service-fabric-cluster-upgrade.md)
> * [<span data-ttu-id="9c355-106">Cluster autonomo</span><span class="sxs-lookup"><span data-stu-id="9c355-106">Standalone Cluster</span></span>](service-fabric-cluster-upgrade-windows-server.md)
> 
> 

<span data-ttu-id="9c355-107">Per qualsiasi sistema moderna, progettazione aggiornabilità è successo a lungo termine di tooachieving chiave del prodotto.</span><span class="sxs-lookup"><span data-stu-id="9c355-107">For any modern system, designing for upgradability is key tooachieving long-term success of your product.</span></span> <span data-ttu-id="9c355-108">Un cluster di Azure Service Fabric è una risorsa di proprietà dell'utente parzialmente gestita da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="9c355-108">An Azure Service Fabric cluster is a resource that you own, but is partly managed by Microsoft.</span></span> <span data-ttu-id="9c355-109">Questo articolo descrive ciò che viene gestito automaticamente e ciò che è possibile configurare manualmente.</span><span class="sxs-lookup"><span data-stu-id="9c355-109">This article describes what is managed automatically and what you can configure yourself.</span></span>

## <a name="controlling-hello-fabric-version-that-runs-on-your-cluster"></a><span data-ttu-id="9c355-110">Controllo della versione di fabric hello che esegue il cluster</span><span class="sxs-lookup"><span data-stu-id="9c355-110">Controlling hello fabric version that runs on your Cluster</span></span>
<span data-ttu-id="9c355-111">È possibile impostare l'infrastruttura di cluster tooreceive automatica gli aggiornamenti rilasciati da Microsoft o è possibile selezionare una versione supportata dell'infrastruttura desiderato toobe il cluster.</span><span class="sxs-lookup"><span data-stu-id="9c355-111">You can set your cluster tooreceive automatic fabric upgrades as they are released by Microsoft or you can select a supported fabric version you want your cluster toobe on.</span></span>

<span data-ttu-id="9c355-112">A tale scopo, configurazione del cluster "upgradeMode" hello impostazione nel portale di hello o tramite Gestione risorse in fase di creazione di hello o in seguito a un cluster in tempo reale</span><span class="sxs-lookup"><span data-stu-id="9c355-112">You do this by setting hello "upgradeMode" cluster configuration on hello portal or using Resource Manager at hello time of creation or later on a live cluster</span></span> 

> [!NOTE]
> <span data-ttu-id="9c355-113">Verificare che tookeep il cluster che esegue una versione supportata dell'infrastruttura sempre.</span><span class="sxs-lookup"><span data-stu-id="9c355-113">Make sure tookeep your cluster running a supported fabric version always.</span></span> <span data-ttu-id="9c355-114">Come e quando è annunciare il rilascio di hello di una nuova versione dell'infrastruttura di servizio, la versione precedente di hello è contrassegnata per la fine del supporto dopo un minimo di 60 giorni dalla data.</span><span class="sxs-lookup"><span data-stu-id="9c355-114">As and when we announce hello release of a new version of service fabric, hello previous version is marked for end of support after a minimum of 60 days from that date.</span></span> <span data-ttu-id="9c355-115">Hello nuove versioni hello vengono annunciate [sul blog del team di infrastruttura servizio hello](https://blogs.msdn.microsoft.com/azureservicefabric/).</span><span class="sxs-lookup"><span data-stu-id="9c355-115">hello  hello new releases are announced [on hello service fabric team blog](https://blogs.msdn.microsoft.com/azureservicefabric/).</span></span> <span data-ttu-id="9c355-116">nuova versione di Hello è quindi disponibile toochoose.</span><span class="sxs-lookup"><span data-stu-id="9c355-116">hello new release is available toochoose then.</span></span> 
> 
> 

<span data-ttu-id="9c355-117">14 giorni precedenti toohello scadenza della versione di hello nel cluster è in esecuzione, viene generato un evento di integrità che inserisce il cluster in uno stato di integrità di avviso.</span><span class="sxs-lookup"><span data-stu-id="9c355-117">14 days prior toohello expiry of hello release your cluster is running, a health event is generated that puts your cluster into a warning health state.</span></span> <span data-ttu-id="9c355-118">cluster di Hello rimane in uno stato di avviso fino a quando non si esegue l'aggiornamento di versione di fabric supportati tooa.</span><span class="sxs-lookup"><span data-stu-id="9c355-118">hello cluster remains in a warning state until you upgrade tooa supported fabric version.</span></span>

### <a name="setting-hello-upgrade-mode-via-portal"></a><span data-ttu-id="9c355-119">Impostazione della modalità di aggiornamento hello tramite portale</span><span class="sxs-lookup"><span data-stu-id="9c355-119">Setting hello upgrade mode via portal</span></span>
<span data-ttu-id="9c355-120">Quando si crea il cluster hello, è possibile impostare hello cluster tooautomatic o manuale.</span><span class="sxs-lookup"><span data-stu-id="9c355-120">You can set hello cluster tooautomatic or manual when you are creating hello cluster.</span></span>

![Creazione - Modalità manuale][Create_Manualmode]

<span data-ttu-id="9c355-122">È possibile impostare hello cluster tooautomatic o manuale quando in un cluster in tempo reale, utilizzando hello gestire l'esperienza.</span><span class="sxs-lookup"><span data-stu-id="9c355-122">You can set hello cluster tooautomatic or manual when on a live cluster, using hello manage experience.</span></span> 

#### <a name="upgrading-tooa-new-version-on-a-cluster-that-is-set-toomanual-mode-via-portal"></a><span data-ttu-id="9c355-123">L'aggiornamento di tooa nuova versione in un cluster che è impostato la modalità tooManual tramite portale.</span><span class="sxs-lookup"><span data-stu-id="9c355-123">Upgrading tooa new version on a cluster that is set tooManual mode via portal.</span></span>
<span data-ttu-id="9c355-124">nuova versione tooa tooupgrade, toodo è sufficiente selezionare la versione disponibile hello dall'elenco a discesa hello e salvare.</span><span class="sxs-lookup"><span data-stu-id="9c355-124">tooupgrade tooa new version, all you need toodo is select hello available version from hello dropdown and save.</span></span> <span data-ttu-id="9c355-125">aggiornamento di Fabric Hello Ottiene avviata automaticamente.</span><span class="sxs-lookup"><span data-stu-id="9c355-125">hello Fabric upgrade gets kicked off automatically.</span></span> <span data-ttu-id="9c355-126">Hello criteri di integrità del cluster (una combinazione di integrità del nodo e l'integrità di hello tutti hello applicazioni in esecuzione nel cluster hello) siano rispettati aggiornamento hello tooduring.</span><span class="sxs-lookup"><span data-stu-id="9c355-126">hello cluster health policies (a combination of node health and hello health all hello applications running in hello cluster) are adhered tooduring hello upgrade.</span></span>

<span data-ttu-id="9c355-127">Se non vengono soddisfatti i criteri di integrità del cluster di hello, viene eseguito il rollback di aggiornamento hello.</span><span class="sxs-lookup"><span data-stu-id="9c355-127">If hello cluster health policies are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="9c355-128">Scorrere verso il basso tooread questo documento altre su come tooset tali criteri di integrità personalizzato.</span><span class="sxs-lookup"><span data-stu-id="9c355-128">Scroll down this document tooread more on how tooset those custom health policies.</span></span> 

<span data-ttu-id="9c355-129">Dopo aver risolto i problemi di hello che ha comportato il rollback di hello, necessari, l'aggiornamento di hello tooinitiate nuovamente, hello seguente stessi passaggi come prima.</span><span class="sxs-lookup"><span data-stu-id="9c355-129">Once you have fixed hello issues that resulted in hello rollback, you need tooinitiate hello upgrade again, by following hello same steps as before.</span></span>

![Gestione - Modalità automatica][Manage_Automaticmode]

### <a name="setting-hello-upgrade-mode-via-a-resource-manager-template"></a><span data-ttu-id="9c355-131">Impostazione della modalità di aggiornamento hello tramite un modello di gestione risorse</span><span class="sxs-lookup"><span data-stu-id="9c355-131">Setting hello upgrade mode via a Resource Manager template</span></span>
<span data-ttu-id="9c355-132">Aggiungere hello definizione di risorsa Microsoft.ServiceFabric/clusters toohello "upgradeMode" configurazione e set hello "clusterCodeVersion" tooone di hello supportate versioni dell'infrastruttura, come illustrato di seguito e quindi distribuire il modello di hello.</span><span class="sxs-lookup"><span data-stu-id="9c355-132">Add hello "upgradeMode" configuration toohello Microsoft.ServiceFabric/clusters resource definition and set hello "clusterCodeVersion" tooone of hello supported fabric versions as shown below and then deploy hello template.</span></span> <span data-ttu-id="9c355-133">i valori validi di Hello per "upgradeMode" sono "Manuale" o "Automatico"</span><span class="sxs-lookup"><span data-stu-id="9c355-133">hello valid values for "upgradeMode" are "Manual" or "Automatic"</span></span>

![Modalità di aggiornamento tramite Azure Resource Manager][ARMUpgradeMode]

#### <a name="upgrading-tooa-new-version-on-a-cluster-that-is-set-toomanual-mode-via-a-resource-manager-template"></a><span data-ttu-id="9c355-135">L'aggiornamento di tooa nuova versione in un cluster che è impostato la modalità tooManual tramite un modello di gestione risorse.</span><span class="sxs-lookup"><span data-stu-id="9c355-135">Upgrading tooa new version on a cluster that is set tooManual mode via a Resource Manager template.</span></span>
<span data-ttu-id="9c355-136">Quando il cluster di hello è in modalità manuale, tooupgrade tooa nuova versione, modificare una versione supportata di tooa clusterCodeVersion"hello" e distribuirlo.</span><span class="sxs-lookup"><span data-stu-id="9c355-136">When hello cluster is in Manual mode, tooupgrade tooa new version, change hello "clusterCodeVersion" tooa supported version and deploy it.</span></span> <span data-ttu-id="9c355-137">distribuzione di Hello del modello di hello, viene attivata di aggiornamento di Fabric hello Ottiene avviata automaticamente.</span><span class="sxs-lookup"><span data-stu-id="9c355-137">hello deployment of hello template, kicks of hello Fabric upgrade gets kicked off automatically.</span></span> <span data-ttu-id="9c355-138">Hello criteri di integrità del cluster (una combinazione di integrità del nodo e l'integrità di hello tutti hello applicazioni in esecuzione nel cluster hello) siano rispettati aggiornamento hello tooduring.</span><span class="sxs-lookup"><span data-stu-id="9c355-138">hello cluster health policies (a combination of node health and hello health all hello applications running in hello cluster) are adhered tooduring hello upgrade.</span></span>

<span data-ttu-id="9c355-139">Se non vengono soddisfatti i criteri di integrità del cluster di hello, viene eseguito il rollback di aggiornamento hello.</span><span class="sxs-lookup"><span data-stu-id="9c355-139">If hello cluster health policies are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="9c355-140">Scorrere verso il basso tooread questo documento altre su come tooset tali criteri di integrità personalizzato.</span><span class="sxs-lookup"><span data-stu-id="9c355-140">Scroll down this document tooread more on how tooset those custom health policies.</span></span> 

<span data-ttu-id="9c355-141">Dopo aver risolto i problemi di hello che ha comportato il rollback di hello, necessari, l'aggiornamento di hello tooinitiate nuovamente, hello seguente stessi passaggi come prima.</span><span class="sxs-lookup"><span data-stu-id="9c355-141">Once you have fixed hello issues that resulted in hello rollback, you need tooinitiate hello upgrade again, by following hello same steps as before.</span></span>

### <a name="get-list-of-all-available-version-for-all-environments-for-a-given-subscription"></a><span data-ttu-id="9c355-142">Ottenere l'elenco di tutte le versioni disponibili per tutti gli ambienti per una determinata sottoscrizione</span><span class="sxs-lookup"><span data-stu-id="9c355-142">Get list of all available version for all environments for a given subscription</span></span>
<span data-ttu-id="9c355-143">Eseguire hello comando seguente ed è necessario ottenere un toothis simili di output.</span><span class="sxs-lookup"><span data-stu-id="9c355-143">Run hello following command, and you should get an output similar toothis.</span></span>

<span data-ttu-id="9c355-144">"supportExpiryUtc" indica la scadenza di una determinata versione.</span><span class="sxs-lookup"><span data-stu-id="9c355-144">"supportExpiryUtc" tells your when a given release is expiring or has expired.</span></span> <span data-ttu-id="9c355-145">Hello versione più recente non hanno una data valida: è il valore "9999-12-31T23:59:59.9999999", che significa che la data di scadenza hello non è ancora impostata.</span><span class="sxs-lookup"><span data-stu-id="9c355-145">hello latest release does not have a valid date - it has a value of "9999-12-31T23:59:59.9999999", which just means that hello expiry date is not yet set.</span></span>

```REST
GET https://<endpoint>/subscriptions/{{subscriptionId}}/providers/Microsoft.ServiceFabric/locations/{{location}}/clusterVersions?api-version=2016-09-01

Example: https://management.azure.com/subscriptions/1857f442-3bce-4b96-ad95-627f76437a67/providers/Microsoft.ServiceFabric/locations/eastus/clusterVersions?api-version=2016-09-01

Output:
{
                  "value": [
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/5.0.1427.9490",
                      "name": "5.0.1427.9490",
                      "type": "Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "5.0.1427.9490",
                        "supportExpiryUtc": "2016-11-26T23:59:59.9999999",
                        "environment": "Windows"
                      }
                    },
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/4.0.1427.9490",
                      "name": "5.1.1427.9490",
                      "type": " Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "5.1.1427.9490",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Windows"
                      }
                    },
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/4.4.1427.9490",
                      "name": "4.4.1427.9490",
                      "type": " Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "4.4.1427.9490",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Linux"
                      }
                    }
                  ]
                }


```

## <a name="fabric-upgrade-behavior-when-hello-cluster-upgrade-mode-is-automatic"></a><span data-ttu-id="9c355-146">Comportamento dell'aggiornamento dell'infrastruttura quando la modalità di aggiornamento del cluster hello è automatico</span><span class="sxs-lookup"><span data-stu-id="9c355-146">Fabric upgrade behavior when hello cluster Upgrade Mode is Automatic</span></span>
<span data-ttu-id="9c355-147">Microsoft gestisce il codice di fabric hello e la configurazione che viene eseguito in un cluster di Azure.</span><span class="sxs-lookup"><span data-stu-id="9c355-147">Microsoft maintains hello fabric code and configuration that runs in an Azure cluster.</span></span> <span data-ttu-id="9c355-148">Software toohello gli aggiornamenti automatici di monitorato eseguita in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="9c355-148">We perform automatic monitored upgrades toohello software on an as-needed basis.</span></span> <span data-ttu-id="9c355-149">Gli aggiornamenti possono interessare il codice, la configurazione o entrambi.</span><span class="sxs-lookup"><span data-stu-id="9c355-149">These upgrades could be code, configuration, or both.</span></span> <span data-ttu-id="9c355-150">Assicurarsi che l'applicazione non subisce alcun impatto o un impatto minimo a causa di aggiornamenti toothese toomake, eseguita aggiornamenti hello in hello seguenti fasi:</span><span class="sxs-lookup"><span data-stu-id="9c355-150">toomake sure that your application suffers no impact or minimal impact due toothese upgrades, we perform hello upgrades in hello following phases:</span></span>

### <a name="phase-1-an-upgrade-is-performed-by-using-all-cluster-health-policies"></a><span data-ttu-id="9c355-151">Fase 1: Un aggiornamento viene eseguito usando tutti i criteri di integrità del cluster</span><span class="sxs-lookup"><span data-stu-id="9c355-151">Phase 1: An upgrade is performed by using all cluster health policies</span></span>
<span data-ttu-id="9c355-152">Durante questa fase, gli aggiornamenti di hello procedere a un dominio di aggiornamento in un momento e le applicazioni di hello che erano in esecuzione nel cluster hello continuano toorun senza alcun tempo di inattività.</span><span class="sxs-lookup"><span data-stu-id="9c355-152">During this phase, hello upgrades proceed one upgrade domain at a time, and hello applications that were running in hello cluster continue toorun without any downtime.</span></span> <span data-ttu-id="9c355-153">Hello criteri di integrità del cluster (una combinazione di integrità del nodo e l'integrità di hello tutti hello applicazioni in esecuzione nel cluster hello) siano rispettati aggiornamento hello tooduring.</span><span class="sxs-lookup"><span data-stu-id="9c355-153">hello cluster health policies (a combination of node health and hello health all hello applications running in hello cluster) are adhered tooduring hello upgrade.</span></span>

<span data-ttu-id="9c355-154">Se non vengono soddisfatti i criteri di integrità del cluster di hello, viene eseguito il rollback di aggiornamento hello.</span><span class="sxs-lookup"><span data-stu-id="9c355-154">If hello cluster health policies are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="9c355-155">Quindi toohello proprietario della sottoscrizione hello viene inviato un messaggio.</span><span class="sxs-lookup"><span data-stu-id="9c355-155">Then an email is sent toohello owner of hello subscription.</span></span> <span data-ttu-id="9c355-156">messaggio di posta elettronica Hello contiene hello le seguenti informazioni:</span><span class="sxs-lookup"><span data-stu-id="9c355-156">hello email contains hello following information:</span></span>

* <span data-ttu-id="9c355-157">Notifica che è stato nuovamente tooroll un aggiornamento del cluster.</span><span class="sxs-lookup"><span data-stu-id="9c355-157">Notification that we had tooroll back a cluster upgrade.</span></span>
* <span data-ttu-id="9c355-158">Eventuali azioni correttive suggerite.</span><span class="sxs-lookup"><span data-stu-id="9c355-158">Suggested remedial actions, if any.</span></span>
* <span data-ttu-id="9c355-159">numero di Hello di giorni (n) fino a quando non viene eseguita la fase 2.</span><span class="sxs-lookup"><span data-stu-id="9c355-159">hello number of days (n) until we execute Phase 2.</span></span>

<span data-ttu-id="9c355-160">Si tenta di hello tooexecute che stesso aggiornare alcune altre volte in caso di eventuali aggiornamenti non riuscita per motivi di infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="9c355-160">We try tooexecute hello same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="9c355-161">Dopo aver hello n giorni dal messaggio di posta elettronica hello data hello è stato inviato, procedere tooPhase 2.</span><span class="sxs-lookup"><span data-stu-id="9c355-161">After hello n days from hello date hello email was sent, we proceed tooPhase 2.</span></span>

<span data-ttu-id="9c355-162">Se vengono soddisfatti i criteri di integrità del cluster di hello, l'aggiornamento di hello è considerata riuscita e contrassegnata come completata.</span><span class="sxs-lookup"><span data-stu-id="9c355-162">If hello cluster health policies are met, hello upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="9c355-163">Ciò può verificarsi durante l'aggiornamento iniziale hello o una qualsiasi delle repliche aggiornamento hello in questa fase.</span><span class="sxs-lookup"><span data-stu-id="9c355-163">This can happen during hello initial upgrade or any of hello upgrade reruns in this phase.</span></span> <span data-ttu-id="9c355-164">Non viene inviato alcun messaggio di posta elettronica di conferma in caso di esecuzione riuscita.</span><span class="sxs-lookup"><span data-stu-id="9c355-164">There is no email confirmation of a successful run.</span></span> <span data-ttu-id="9c355-165">Si tratta di tooavoid invio si troppi messaggi di posta elettronica, la ricezione di un messaggio di posta elettronica dovrebbero essere considerate come toonormal un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="9c355-165">This is tooavoid sending you too many emails--receiving an email should be seen as an exception toonormal.</span></span> <span data-ttu-id="9c355-166">È probabile che la maggior parte delle toosucceed gli aggiornamenti di hello cluster senza conseguenze per la disponibilità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9c355-166">We expect most of hello cluster upgrades toosucceed without impacting your application availability.</span></span>

### <a name="phase-2-an-upgrade-is-performed-by-using-default-health-policies-only"></a><span data-ttu-id="9c355-167">Fase 2: Un aggiornamento viene eseguito usando solo i criteri di integrità predefiniti</span><span class="sxs-lookup"><span data-stu-id="9c355-167">Phase 2: An upgrade is performed by using default health policies only</span></span>
<span data-ttu-id="9c355-168">criteri di integrità Hello in questa fase vengono impostati in modo che il numero di hello di applicazioni che sono stati integro all'inizio di hello dell'aggiornamento di hello rimane uguale per hello durata del processo di aggiornamento hello hello.</span><span class="sxs-lookup"><span data-stu-id="9c355-168">hello health policies in this phase are set in such a way that hello number of applications that were healthy at hello beginning of hello upgrade remains hello same for hello duration of hello upgrade process.</span></span> <span data-ttu-id="9c355-169">Fase 1, gli aggiornamenti di hello fase 2 procedere a un dominio di aggiornamento in un momento e le applicazioni di hello che erano in esecuzione nel cluster hello continuano toorun senza alcun tempo di inattività.</span><span class="sxs-lookup"><span data-stu-id="9c355-169">As in Phase 1, hello Phase 2 upgrades proceed one upgrade domain at a time, and hello applications that were running in hello cluster continue toorun without any downtime.</span></span> <span data-ttu-id="9c355-170">criteri di integrità del cluster Hello (una combinazione di integrità del nodo e l'integrità di hello che tutti hello applicazioni in esecuzione nel cluster hello) sono rispettate toofor hello durata dell'aggiornamento hello.</span><span class="sxs-lookup"><span data-stu-id="9c355-170">hello cluster health policies (a combination of node health and hello health all hello applications running in hello cluster) are adhered toofor hello duration of hello upgrade.</span></span>

<span data-ttu-id="9c355-171">Se i criteri di integrità del cluster hello attive non vengono soddisfatte, viene eseguito il rollback di aggiornamento hello.</span><span class="sxs-lookup"><span data-stu-id="9c355-171">If hello cluster health policies in effect are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="9c355-172">Quindi toohello proprietario della sottoscrizione hello viene inviato un messaggio.</span><span class="sxs-lookup"><span data-stu-id="9c355-172">Then an email is sent toohello owner of hello subscription.</span></span> <span data-ttu-id="9c355-173">messaggio di posta elettronica Hello contiene hello le seguenti informazioni:</span><span class="sxs-lookup"><span data-stu-id="9c355-173">hello email contains hello following information:</span></span>

* <span data-ttu-id="9c355-174">Notifica che è stato nuovamente tooroll un aggiornamento del cluster.</span><span class="sxs-lookup"><span data-stu-id="9c355-174">Notification that we had tooroll back a cluster upgrade.</span></span>
* <span data-ttu-id="9c355-175">Eventuali azioni correttive suggerite.</span><span class="sxs-lookup"><span data-stu-id="9c355-175">Suggested remedial actions, if any.</span></span>
* <span data-ttu-id="9c355-176">numero di Hello di giorni (n) fino a quando non viene eseguita una fase 3.</span><span class="sxs-lookup"><span data-stu-id="9c355-176">hello number of days (n) until we execute Phase 3.</span></span>

<span data-ttu-id="9c355-177">Si tenta di hello tooexecute che stesso aggiornare alcune altre volte in caso di eventuali aggiornamenti non riuscita per motivi di infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="9c355-177">We try tooexecute hello same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="9c355-178">Viene inviato un messaggio di sollecito alcuni giorni prima della scadenza degli n giorni.</span><span class="sxs-lookup"><span data-stu-id="9c355-178">A reminder email is sent a couple of days before n days are up.</span></span> <span data-ttu-id="9c355-179">Dopo aver hello n giorni dal messaggio di posta elettronica hello data hello è stato inviato, procedere tooPhase 3.</span><span class="sxs-lookup"><span data-stu-id="9c355-179">After hello n days from hello date hello email was sent, we proceed tooPhase 3.</span></span> <span data-ttu-id="9c355-180">messaggi di posta elettronica Hello che ti abbiamo inviato nella fase 2 devono essere prese gravemente ed è necessario eseguire le azioni correttive.</span><span class="sxs-lookup"><span data-stu-id="9c355-180">hello emails we send you in Phase 2 must be taken seriously and remedial actions must be taken.</span></span>

<span data-ttu-id="9c355-181">Se vengono soddisfatti i criteri di integrità del cluster di hello, l'aggiornamento di hello è considerata riuscita e contrassegnata come completata.</span><span class="sxs-lookup"><span data-stu-id="9c355-181">If hello cluster health policies are met, hello upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="9c355-182">Ciò può verificarsi durante l'aggiornamento iniziale hello o una qualsiasi delle repliche aggiornamento hello in questa fase.</span><span class="sxs-lookup"><span data-stu-id="9c355-182">This can happen during hello initial upgrade or any of hello upgrade reruns in this phase.</span></span> <span data-ttu-id="9c355-183">Non viene inviato alcun messaggio di posta elettronica di conferma in caso di esecuzione riuscita.</span><span class="sxs-lookup"><span data-stu-id="9c355-183">There is no email confirmation of a successful run.</span></span>

### <a name="phase-3-an-upgrade-is-performed-by-using-aggressive-health-policies"></a><span data-ttu-id="9c355-184">Fase 3: Un aggiornamento viene eseguito usando criteri di integrità aggressivi</span><span class="sxs-lookup"><span data-stu-id="9c355-184">Phase 3: An upgrade is performed by using aggressive health policies</span></span>
<span data-ttu-id="9c355-185">Questi criteri di integrità in questa fase sono pensati per il completamento dell'aggiornamento hello anziché hello dello stato di hello applicazioni.</span><span class="sxs-lookup"><span data-stu-id="9c355-185">These health policies in this phase are geared towards completion of hello upgrade rather than hello health of hello applications.</span></span> <span data-ttu-id="9c355-186">In questa fase verranno completati pochi aggiornamenti del cluster.</span><span class="sxs-lookup"><span data-stu-id="9c355-186">Very few cluster upgrades end up in this phase.</span></span> <span data-ttu-id="9c355-187">Se il cluster Ottiene toothis fase, è probabile che l'applicazione diventa non integro e/o perdere la disponibilità.</span><span class="sxs-lookup"><span data-stu-id="9c355-187">If your cluster gets toothis phase, there is a good chance that your application becomes unhealthy and/or lose availability.</span></span>

<span data-ttu-id="9c355-188">Toohello simile ad altre due fasi, gli aggiornamenti di fase 3 procedere un dominio di aggiornamento alla volta.</span><span class="sxs-lookup"><span data-stu-id="9c355-188">Similar toohello other two phases, Phase 3 upgrades proceed one upgrade domain at a time.</span></span>

<span data-ttu-id="9c355-189">Se non vengono soddisfatti i criteri di integrità del cluster di hello, viene eseguito il rollback di aggiornamento hello.</span><span class="sxs-lookup"><span data-stu-id="9c355-189">If hello cluster health policies are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="9c355-190">Si tenta di hello tooexecute che stesso aggiornare alcune altre volte in caso di eventuali aggiornamenti non riuscita per motivi di infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="9c355-190">We try tooexecute hello same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="9c355-191">Successivamente, cluster hello è bloccata, in modo che non riceveranno più supporto e/o gli aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="9c355-191">After that, hello cluster is pinned, so that it will no longer receive support and/or upgrades.</span></span>

<span data-ttu-id="9c355-192">Proprietario della sottoscrizione toohello, insieme a operazioni correttive hello viene inviato un messaggio con queste informazioni.</span><span class="sxs-lookup"><span data-stu-id="9c355-192">An email with this information is sent toohello subscription owner, along with hello remedial actions.</span></span> <span data-ttu-id="9c355-193">Non Prevediamo tooget qualsiasi cluster in uno stato in fase 3 non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="9c355-193">We do not expect any clusters tooget into a state where Phase 3 has failed.</span></span>

<span data-ttu-id="9c355-194">Se vengono soddisfatti i criteri di integrità del cluster di hello, l'aggiornamento di hello è considerata riuscita e contrassegnata come completata.</span><span class="sxs-lookup"><span data-stu-id="9c355-194">If hello cluster health policies are met, hello upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="9c355-195">Ciò può verificarsi durante l'aggiornamento iniziale hello o una qualsiasi delle repliche aggiornamento hello in questa fase.</span><span class="sxs-lookup"><span data-stu-id="9c355-195">This can happen during hello initial upgrade or any of hello upgrade reruns in this phase.</span></span> <span data-ttu-id="9c355-196">Non viene inviato alcun messaggio di posta elettronica di conferma in caso di esecuzione riuscita.</span><span class="sxs-lookup"><span data-stu-id="9c355-196">There is no email confirmation of a successful run.</span></span>

## <a name="cluster-configurations-that-you-control"></a><span data-ttu-id="9c355-197">Configurazioni del cluster controllate manualmente</span><span class="sxs-lookup"><span data-stu-id="9c355-197">Cluster configurations that you control</span></span>
<span data-ttu-id="9c355-198">Modalità di aggiornamento cluster hello tooset possibilità di toohello inoltre, ecco le configurazioni di hello che è possibile modificare in un cluster in tempo reale.</span><span class="sxs-lookup"><span data-stu-id="9c355-198">In addition toohello ability tooset hello cluster upgrade mode, Here are hello configurations that you can change on a live cluster.</span></span>

### <a name="certificates"></a><span data-ttu-id="9c355-199">Certificati</span><span class="sxs-lookup"><span data-stu-id="9c355-199">Certificates</span></span>
<span data-ttu-id="9c355-200">È possibile aggiungere o eliminare i certificati per cluster hello e client tramite il portale di hello facilmente.</span><span class="sxs-lookup"><span data-stu-id="9c355-200">You can add new or delete certificates for hello cluster and client via hello portal easily.</span></span> <span data-ttu-id="9c355-201">Fare riferimento troppo[questo documento per istruzioni dettagliate](service-fabric-cluster-security-update-certs-azure.md)</span><span class="sxs-lookup"><span data-stu-id="9c355-201">Refer too[this document for detailed instructions](service-fabric-cluster-security-update-certs-azure.md)</span></span>

![Schermata che mostra identificazioni personali del certificato nel portale di Azure hello.][CertificateUpgrade]

### <a name="application-ports"></a><span data-ttu-id="9c355-203">Porte dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="9c355-203">Application ports</span></span>
<span data-ttu-id="9c355-204">È possibile modificare le porte applicazione modificando le proprietà delle risorse di bilanciamento del carico hello associati al tipo di nodo hello.</span><span class="sxs-lookup"><span data-stu-id="9c355-204">You can change application ports by changing hello Load Balancer resource properties that are associated with hello node type.</span></span> <span data-ttu-id="9c355-205">È possibile utilizzare il portale di hello oppure è possibile utilizzare Gestione risorse di PowerShell direttamente.</span><span class="sxs-lookup"><span data-stu-id="9c355-205">You can use hello portal, or you can use Resource Manager PowerShell directly.</span></span>

<span data-ttu-id="9c355-206">hello tooopen una nuova porta in tutte le macchine virtuali in un tipo di nodo seguenti:</span><span class="sxs-lookup"><span data-stu-id="9c355-206">tooopen a new port on all VMs in a node type, do hello following:</span></span>

1. <span data-ttu-id="9c355-207">Aggiungere un nuovo bilanciamento del carico appropriato toohello probe.</span><span class="sxs-lookup"><span data-stu-id="9c355-207">Add a new probe toohello appropriate load balancer.</span></span>
   
    <span data-ttu-id="9c355-208">Se il cluster è stata distribuita tramite il portale di hello, servizi di bilanciamento del carico hello sono denominati "LB-nome del gruppo di risorse hello-NodeTypename", uno per ogni tipo di nodo.</span><span class="sxs-lookup"><span data-stu-id="9c355-208">If you deployed your cluster by using hello portal, hello load balancers are named "LB-name of hello Resource group-NodeTypename", one for each node type.</span></span> <span data-ttu-id="9c355-209">Poiché i nomi del bilanciamento del carico di hello sono univoci solo all'interno di un gruppo di risorse, è consigliabile se la ricerca in un gruppo di risorse specifico.</span><span class="sxs-lookup"><span data-stu-id="9c355-209">Since hello load balancer names are unique only within a resource group, it is best if you search for them under a specific resource group.</span></span>
   
    ![Schermata che mostra l'aggiunta di un tooa probe bilanciamento del carico nel portale di hello.][AddingProbes]
2. <span data-ttu-id="9c355-211">Aggiungere un nuovo servizio di bilanciamento del carico toohello regola.</span><span class="sxs-lookup"><span data-stu-id="9c355-211">Add a new rule toohello load balancer.</span></span>
   
    <span data-ttu-id="9c355-212">Aggiungere un nuovo toohello regola stesso il bilanciamento del carico tramite probe hello creato nel passaggio precedente hello.</span><span class="sxs-lookup"><span data-stu-id="9c355-212">Add a new rule toohello same load balancer by using hello probe that you created in hello previous step.</span></span>
   
    ![Aggiunta di un nuovo servizio di bilanciamento del carico tooa regola nel portale di hello.][AddingLBRules]

### <a name="placement-properties"></a><span data-ttu-id="9c355-214">Proprietà di posizionamento</span><span class="sxs-lookup"><span data-stu-id="9c355-214">Placement properties</span></span>
<span data-ttu-id="9c355-215">Per ognuno dei tipi di nodo hello, è possibile aggiungere proprietà di posizionamento personalizzati che si desidera toouse nelle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="9c355-215">For each of hello node types, you can add custom placement properties that you want toouse in your applications.</span></span> <span data-ttu-id="9c355-216">NodeType è una proprietà predefinita che è possibile usare senza aggiungerla in modo esplicito.</span><span class="sxs-lookup"><span data-stu-id="9c355-216">NodeType is a default property that you can use without adding it explicitly.</span></span>

> [!NOTE]
> <span data-ttu-id="9c355-217">Per informazioni dettagliate sull'uso di hello di vincoli di posizionamento, proprietà del nodo, e come toodefine, vedere toohello sezione "Vincoli di posizionamento e proprietà del nodo" nel documento di servizio di gestione delle risorse Cluster dell'infrastruttura hello in [che descrive il Cluster ](service-fabric-cluster-resource-manager-cluster-description.md).</span><span class="sxs-lookup"><span data-stu-id="9c355-217">For details on hello use of placement constraints, node properties, and how toodefine them, refer toohello section "Placement Constraints and Node Properties" in hello Service Fabric Cluster Resource Manager Document on [Describing Your Cluster](service-fabric-cluster-resource-manager-cluster-description.md).</span></span>
> 
> 

### <a name="capacity-metrics"></a><span data-ttu-id="9c355-218">Metriche della capacità</span><span class="sxs-lookup"><span data-stu-id="9c355-218">Capacity metrics</span></span>
<span data-ttu-id="9c355-219">Per ognuno dei tipi di nodo hello, è possibile aggiungere le metriche di capacità personalizzato che si desidera toouse del carico tooreport applicazioni.</span><span class="sxs-lookup"><span data-stu-id="9c355-219">For each of hello node types, you can add custom capacity metrics that you want toouse in your applications tooreport load.</span></span> <span data-ttu-id="9c355-220">Per informazioni dettagliate sull'uso di hello del carico tooreport metriche di capacità, vedere toohello documenti di servizio di gestione delle risorse Cluster dell'infrastruttura su [che descrive il Cluster](service-fabric-cluster-resource-manager-cluster-description.md) e [metriche e carico](service-fabric-cluster-resource-manager-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="9c355-220">For details on hello use of capacity metrics tooreport load, refer toohello Service Fabric Cluster Resource Manager Documents on [Describing Your Cluster](service-fabric-cluster-resource-manager-cluster-description.md) and [Metrics and Load](service-fabric-cluster-resource-manager-metrics.md).</span></span>

### <a name="fabric-upgrade-settings---health-polices"></a><span data-ttu-id="9c355-221">Impostazioni di aggiornamento di Fabric: criteri di integrità</span><span class="sxs-lookup"><span data-stu-id="9c355-221">Fabric upgrade settings - Health polices</span></span>
<span data-ttu-id="9c355-222">È possibile specificare criteri di integrità personalizzati per l'aggiornamento di Fabric.</span><span class="sxs-lookup"><span data-stu-id="9c355-222">You can specify custom health polices for fabric upgrade.</span></span> <span data-ttu-id="9c355-223">Se è stata impostata la tooAutomatic cluster gli aggiornamenti dell'infrastruttura, questi criteri otterranno applicato toohello fase 1 di aggiornamento automatico dell'infrastruttura hello.</span><span class="sxs-lookup"><span data-stu-id="9c355-223">If you have set your cluster tooAutomatic fabric upgrades, then these policies get applied toohello Phase-1 of hello automatic fabric upgrades.</span></span>
<span data-ttu-id="9c355-224">Se è stato impostato il cluster per l'infrastruttura manuale degli aggiornamenti, quindi questi criteri vengono applicati a ogni volta che si seleziona una nuova versione di hello sistema tookick disattivare l'aggiornamento dell'infrastruttura di hello del cluster di trigger.</span><span class="sxs-lookup"><span data-stu-id="9c355-224">If you have set your cluster for Manual fabric upgrades, then these policies get applied each time you select a new version triggering hello system tookick off hello fabric upgrade in your cluster.</span></span> <span data-ttu-id="9c355-225">Se si esegue l'override criteri hello, vengono utilizzati i valori predefiniti di hello.</span><span class="sxs-lookup"><span data-stu-id="9c355-225">If you do not override hello policies, hello defaults are used.</span></span>

<span data-ttu-id="9c355-226">È possibile specificare i criteri di integrità personalizzato hello o rivedere le impostazioni correnti di hello nel Pannello di "aggiornamento di fabric" hello, selezionando le impostazioni di aggiornamento avanzata hello.</span><span class="sxs-lookup"><span data-stu-id="9c355-226">You can specify hello custom health policies or review hello current settings under hello "fabric upgrade" blade, by selecting hello advanced upgrade settings.</span></span> <span data-ttu-id="9c355-227">Esaminare hello seguendo come immagine.</span><span class="sxs-lookup"><span data-stu-id="9c355-227">Review hello following picture on how to.</span></span> 

![Gestire criteri di integrità personalizzati][HealthPolices]

### <a name="customize-fabric-settings-for-your-cluster"></a><span data-ttu-id="9c355-229">Personalizzare le impostazioni di Fabric per il cluster</span><span class="sxs-lookup"><span data-stu-id="9c355-229">Customize Fabric settings for your cluster</span></span>
<span data-ttu-id="9c355-230">Fare riferimento troppo[le impostazioni dell'infrastruttura di cluster di infrastruttura del servizio](service-fabric-cluster-fabric-settings.md) su cosa e come è possibile personalizzare.</span><span class="sxs-lookup"><span data-stu-id="9c355-230">Refer too[service fabric cluster fabric settings](service-fabric-cluster-fabric-settings.md) on what and how you can customize them.</span></span>

### <a name="os-patches-on-hello-vms-that-make-up-hello-cluster"></a><span data-ttu-id="9c355-231">Patch del sistema operativo su macchine virtuali che costituiscono il cluster hello hello</span><span class="sxs-lookup"><span data-stu-id="9c355-231">OS patches on hello VMs that make up hello cluster</span></span>
<span data-ttu-id="9c355-232">Fare riferimento troppo[applicazione di Patch orchestrazione](service-fabric-patch-orchestration-application.md) che può essere distribuito in modo orchestrato, mantenendo servizi hello disponibili tutto il tempo hello le patch tooinstall cluster da Windows Update.</span><span class="sxs-lookup"><span data-stu-id="9c355-232">Refer too[Patch Orchestration Application](service-fabric-patch-orchestration-application.md) which can be deployed on your cluster tooinstall patches from Windows Update in an orchestrated manner, keeping hello services available all hello time.</span></span> 

### <a name="os-upgrades-on-hello-vms-that-make-up-hello-cluster"></a><span data-ttu-id="9c355-233">Aggiornamenti del sistema operativo su macchine virtuali che costituiscono il cluster hello hello</span><span class="sxs-lookup"><span data-stu-id="9c355-233">OS upgrades on hello VMs that make up hello cluster</span></span>
<span data-ttu-id="9c355-234">Se è necessario aggiornare l'immagine del sistema operativo hello in hello di macchine virtuali del cluster di hello, è necessario utilizzare una macchina virtuale alla volta.</span><span class="sxs-lookup"><span data-stu-id="9c355-234">If you must upgrade hello OS image on hello virtual machines of hello cluster, you must do it one VM at a time.</span></span> <span data-ttu-id="9c355-235">L'esecuzione dell'aggiornamento è un'operazione manuale, non è attualmente disponibile alcun tipo di automazione.</span><span class="sxs-lookup"><span data-stu-id="9c355-235">You are responsible for this upgrade--there is currently no automation for this.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9c355-236">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="9c355-236">Next steps</span></span>
* <span data-ttu-id="9c355-237">Informazioni su come toocustomize alcune hello [le impostazioni dell'infrastruttura di cluster di infrastruttura del servizio](service-fabric-cluster-fabric-settings.md)</span><span class="sxs-lookup"><span data-stu-id="9c355-237">Learn how toocustomize some of hello [service fabric cluster fabric settings](service-fabric-cluster-fabric-settings.md)</span></span>
* <span data-ttu-id="9c355-238">Informazioni su come troppo[aumentare e ridurre il cluster](service-fabric-cluster-scale-up-down.md)</span><span class="sxs-lookup"><span data-stu-id="9c355-238">Learn how too[scale your cluster in and out](service-fabric-cluster-scale-up-down.md)</span></span>
* <span data-ttu-id="9c355-239">Informazioni su come eseguire [aggiornamenti dell'applicazione](service-fabric-application-upgrade.md)</span><span class="sxs-lookup"><span data-stu-id="9c355-239">Learn about [application upgrades](service-fabric-application-upgrade.md)</span></span>

<!--Image references-->
[CertificateUpgrade]: ./media/service-fabric-cluster-upgrade/CertificateUpgrade2.png
[AddingProbes]: ./media/service-fabric-cluster-upgrade/addingProbes2.PNG
[AddingLBRules]: ./media/service-fabric-cluster-upgrade/addingLBRules.png
[HealthPolices]: ./media/service-fabric-cluster-upgrade/Manage_AutomodeWadvSettings.PNG
[ARMUpgradeMode]: ./media/service-fabric-cluster-upgrade/ARMUpgradeMode.PNG
[Create_Manualmode]: ./media/service-fabric-cluster-upgrade/Create_Manualmode.PNG
[Manage_Automaticmode]: ./media/service-fabric-cluster-upgrade/Manage_Automaticmode.PNG
