---
title: Specifica di inserimento aaaAzure Media Services live MP4 frammentato | Documenti Microsoft
description: "Questa specifica viene descritto il protocollo hello e il formato per frammentato basato su MP4 live streaming inserimento per servizi multimediali di Azure. È possibile utilizzare gli eventi in tempo reale di servizi multimediali di Azure toostream e trasmettere i contenuti in tempo reale mediante Azure come piattaforma di cloud hello. Questo documento contiene anche le procedure consigliate per creare meccanismi di inserimento live solidi e altamente ridondanti."
services: media-services
documentationcenter: 
author: cenkdin
manager: cfowler
editor: 
ms.assetid: 43fac263-a5ea-44af-8dd5-cc88e423b4de
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/29/2017
ms.author: cenkd;juliako
ms.openlocfilehash: 0c191f8d6c5a595621feaba0e571fb984b666f34
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="azure-media-services-fragmented-mp4-live-ingest-specification"></a><span data-ttu-id="29bfa-105">Specifica per l'inserimento live di un flusso MP4 frammentato con Servizi multimediali di Azure</span><span class="sxs-lookup"><span data-stu-id="29bfa-105">Azure Media Services fragmented MP4 live ingest specification</span></span>
<span data-ttu-id="29bfa-106">Questa specifica viene descritto il protocollo hello e il formato per frammentato basato su MP4 live streaming inserimento per servizi multimediali di Azure.</span><span class="sxs-lookup"><span data-stu-id="29bfa-106">This specification describes hello protocol and format for fragmented MP4-based live streaming ingestion for Azure Media Services.</span></span> <span data-ttu-id="29bfa-107">Servizi multimediali fornisce un servizio di streaming in tempo reale che i clienti possono utilizzare gli eventi in tempo reale toostream e trasmettere i contenuti in tempo reale mediante Azure come piattaforma di cloud hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-107">Media Services provides a live streaming service that customers can use toostream live events and broadcast content in real time by using Azure as hello cloud platform.</span></span> <span data-ttu-id="29bfa-108">Questo documento contiene anche le procedure consigliate per creare meccanismi di inserimento live solidi e altamente ridondanti.</span><span class="sxs-lookup"><span data-stu-id="29bfa-108">This document also discusses best practices for building highly redundant and robust live ingest mechanisms.</span></span>

## <a name="1-conformance-notation"></a><span data-ttu-id="29bfa-109">1. Nota di conformità</span><span class="sxs-lookup"><span data-stu-id="29bfa-109">1. Conformance notation</span></span>
<span data-ttu-id="29bfa-110">Hello parole chiave "deve", "non deve," "Obbligatorio", "SHALL", "non dovrà," "Opportuno", "Non dovrebbe," "Consigliati", "Potrebbe" e "Facoltativo" in questo documento vengono interpretati come se fossero descritti in RFC2119 toobe.</span><span class="sxs-lookup"><span data-stu-id="29bfa-110">hello key words "MUST," "MUST NOT," "REQUIRED," "SHALL," "SHALL NOT," "SHOULD," "SHOULD NOT," "RECOMMENDED," "MAY," and "OPTIONAL" in this document are toobe interpreted as they are described in RFC 2119.</span></span>

## <a name="2-service-diagram"></a><span data-ttu-id="29bfa-111">2. Diagramma del servizio</span><span class="sxs-lookup"><span data-stu-id="29bfa-111">2. Service diagram</span></span>
<span data-ttu-id="29bfa-112">Hello seguente diagramma illustra architettura di alto livello hello di hello servizio in servizi multimediali di streaming in tempo reale:</span><span class="sxs-lookup"><span data-stu-id="29bfa-112">hello following diagram shows hello high-level architecture of hello live streaming service in Media Services:</span></span>

1. <span data-ttu-id="29bfa-113">Un codificatore live inserisce toochannels feed in tempo reale che vengono creati e il provisioning tramite hello Azure Media Services SDK.</span><span class="sxs-lookup"><span data-stu-id="29bfa-113">A live encoder pushes live feeds toochannels that are created and provisioned via hello Azure Media Services SDK.</span></span>
2. <span data-ttu-id="29bfa-114">Cloud di canali, programmi e gli endpoint di streaming handle di servizi multimediali hello tutti live streaming di funzionalità, tra cui inserimento, formattazione, DVR, sicurezza, scalabilità e ridondanza.</span><span class="sxs-lookup"><span data-stu-id="29bfa-114">Channels, programs, and streaming endpoints in Media Services handle all hello live streaming functionalities, including ingest, formatting, cloud DVR, security, scalability, and redundancy.</span></span>
3. <span data-ttu-id="29bfa-115">Facoltativamente, i clienti possono scegliere toodeploy un livello di rete CDN Azure tra endpoint e l'endpoint client hello flusso hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-115">Optionally, customers can choose toodeploy an Azure Content Delivery Network layer between hello streaming endpoint and hello client endpoints.</span></span>
4. <span data-ttu-id="29bfa-116">Flusso di endpoint client da hello endpoint di streaming con protocolli di Streaming adattivo HTTP.</span><span class="sxs-lookup"><span data-stu-id="29bfa-116">Client endpoints stream from hello streaming endpoint by using HTTP Adaptive Streaming protocols.</span></span> <span data-ttu-id="29bfa-117">Alcuni esempi includono Microsoft Smooth Streaming, flusso adattivo dinamico su HTTP (DASH o MPEG-DASH) e Apple HTTP Live Streaming (HLS).</span><span class="sxs-lookup"><span data-stu-id="29bfa-117">Examples include Microsoft Smooth Streaming, Dynamic Adaptive Streaming over HTTP (DASH, or MPEG-DASH), and Apple HTTP Live Streaming (HLS).</span></span>

![Flusso di inserimento][image1]

## <a name="3-bitstream-format--iso-14496-12-fragmented-mp4"></a><span data-ttu-id="29bfa-119">3. Formato del flusso di bit: MP4 frammentato ISO 14496-12</span><span class="sxs-lookup"><span data-stu-id="29bfa-119">3. Bitstream format – ISO 14496-12 fragmented MP4</span></span>
<span data-ttu-id="29bfa-120">Hello formato wire per lo streaming live inserimento descritti in questo documento è basato su [ISO-14496-12].</span><span class="sxs-lookup"><span data-stu-id="29bfa-120">hello wire format for live streaming ingest discussed in this document is based on [ISO-14496-12].</span></span> <span data-ttu-id="29bfa-121">Per una spiegazione dettagliata del formato MP4 frammentato e delle estensioni disponibili per i file video on demand e l'inserimento di streaming live, vedere [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="29bfa-121">For a detailed explanation of fragmented MP4 format and extensions both for video-on-demand files and live streaming ingestion, see [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span></span>

### <a name="live-ingest-format-definitions"></a><span data-ttu-id="29bfa-122">Definizioni del formato di inserimento live</span><span class="sxs-lookup"><span data-stu-id="29bfa-122">Live ingest format definitions</span></span>
<span data-ttu-id="29bfa-123">Hello elenco seguente descrive il formato speciale definizioni che si applicano toolive di inserimento in servizi multimediali di Azure:</span><span class="sxs-lookup"><span data-stu-id="29bfa-123">hello following list describes special format definitions that apply toolive ingest into Azure Media Services:</span></span>

1. <span data-ttu-id="29bfa-124">Hello **ftyp**, **Live Server manifesto casella**, e **moov** caselle devono essere inviate con ogni richiesta (HTTP POST).</span><span class="sxs-lookup"><span data-stu-id="29bfa-124">hello **ftyp**, **Live Server Manifest Box**, and **moov** boxes MUST be sent with each request (HTTP POST).</span></span> <span data-ttu-id="29bfa-125">Queste finestre devono essere inviate all'inizio di hello del flusso di hello e ogni volta che il codificatore hello deve riconnettersi tooresume flusso di inserimento.</span><span class="sxs-lookup"><span data-stu-id="29bfa-125">These boxes MUST be sent at hello beginning of hello stream and any time hello encoder must reconnect tooresume stream ingest.</span></span> <span data-ttu-id="29bfa-126">Per altre informazioni, vedere la sezione 6 di [1].</span><span class="sxs-lookup"><span data-stu-id="29bfa-126">For more information, see Section 6 in [1].</span></span>
2. <span data-ttu-id="29bfa-127">La sezione 3.3.2 di [1] definisce una casella facoltativa chiamata **StreamManifestBox** per l'inserimento live.</span><span class="sxs-lookup"><span data-stu-id="29bfa-127">Section 3.3.2 in [1] defines an optional box called **StreamManifestBox** for live ingest.</span></span> <span data-ttu-id="29bfa-128">A causa di logica di routing toohello di bilanciamento del carico di Azure hello, tramite questa casella è deprecata.</span><span class="sxs-lookup"><span data-stu-id="29bfa-128">Due toohello routing logic of hello Azure load balancer, using this box is deprecated.</span></span> <span data-ttu-id="29bfa-129">casella Hello non devono essere presente durante l'inserimento in servizi multimediali.</span><span class="sxs-lookup"><span data-stu-id="29bfa-129">hello box SHOULD NOT be present when ingesting into Media Services.</span></span> <span data-ttu-id="29bfa-130">Se la casella è presente, Servizi multimediali la ignora automaticamente.</span><span class="sxs-lookup"><span data-stu-id="29bfa-130">If this box is present, Media Services silently ignores it.</span></span>
3. <span data-ttu-id="29bfa-131">Hello **TrackFragmentExtendedHeaderBox** casella definito in 3.2.3.2 [1] deve essere presente per ogni frammento.</span><span class="sxs-lookup"><span data-stu-id="29bfa-131">hello **TrackFragmentExtendedHeaderBox** box defined in 3.2.3.2 in [1] MUST be present for each fragment.</span></span>
4. <span data-ttu-id="29bfa-132">La versione 2 di hello **TrackFragmentExtendedHeaderBox** casella deve essere utilizzato toogenerate i segmenti che dispongono di un URL identico in più Data Center.</span><span class="sxs-lookup"><span data-stu-id="29bfa-132">Version 2 of hello **TrackFragmentExtendedHeaderBox** box SHOULD be used toogenerate media segments that have identical URLs in multiple datacenters.</span></span> <span data-ttu-id="29bfa-133">campo indice di frammento Hello è obbligatorio per il failover tra Data Center di formati di streaming basata sull'indice, ad esempio Apple HLS e MPEG-DASH basata sull'indice.</span><span class="sxs-lookup"><span data-stu-id="29bfa-133">hello fragment index field is REQUIRED for cross-datacenter failover of index-based streaming formats such as Apple HLS and index-based MPEG-DASH.</span></span> <span data-ttu-id="29bfa-134">il failover tra Data Center tooenable, indice frammento hello deve essere sincronizzati tra più codificatori e incrementato di 1 per ogni frammento di supporti successivo, anche attraverso il riavvio di codificatore o errori.</span><span class="sxs-lookup"><span data-stu-id="29bfa-134">tooenable cross-datacenter failover, hello fragment index MUST be synced across multiple encoders and be increased by 1 for each successive media fragment, even across encoder restarts or failures.</span></span>
5. <span data-ttu-id="29bfa-135">Sezione 3.3.6 [1] definisce una casella denominata **MovieFragmentRandomAccessBox** (**mfra**) che possono essere inviati alla fine di hello del canale di toohello (fine del flusso) di fine del flusso di inserimento in tempo reale tooindicate.</span><span class="sxs-lookup"><span data-stu-id="29bfa-135">Section 3.3.6 in [1] defines a box called **MovieFragmentRandomAccessBox** (**mfra**) that MAY be sent at hello end of live ingestion tooindicate end-of-stream (EOS) toohello channel.</span></span> <span data-ttu-id="29bfa-136">Scadenza toohello inserimento della logica di servizi multimediali, usando un sovraccarico di tensione è deprecato e hello **mfra** casella per l'inserimento in tempo reale non deve essere inviata.</span><span class="sxs-lookup"><span data-stu-id="29bfa-136">Due toohello ingest logic of Media Services, using EOS is deprecated, and hello **mfra** box for live ingestion SHOULD NOT be sent.</span></span> <span data-ttu-id="29bfa-137">Se viene inviata, Servizi multimediali la ignora automaticamente.</span><span class="sxs-lookup"><span data-stu-id="29bfa-137">If sent, Media Services silently ignores it.</span></span> <span data-ttu-id="29bfa-138">punto di inserimento stato hello tooreset di hello, si consiglia di utilizzare [canale reimpostato](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span><span class="sxs-lookup"><span data-stu-id="29bfa-138">tooreset hello state of hello ingest point, we recommend that you use [Channel Reset](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span></span> <span data-ttu-id="29bfa-139">È inoltre consigliabile utilizzare [programma](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) tooend una presentazione e il flusso.</span><span class="sxs-lookup"><span data-stu-id="29bfa-139">We also recommend that you use [Program Stop](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) tooend a presentation and stream.</span></span>
6. <span data-ttu-id="29bfa-140">durata frammento MP4 Hello deve essere costante, pari a hello tooreduce hello client manifesti.</span><span class="sxs-lookup"><span data-stu-id="29bfa-140">hello MP4 fragment duration SHOULD be constant, tooreduce hello size of hello client manifests.</span></span> <span data-ttu-id="29bfa-141">Una costante durata frammento MP4 migliora anche l'euristica di download di client tramite l'utilizzo di hello del tag di ripetizione.</span><span class="sxs-lookup"><span data-stu-id="29bfa-141">A constant MP4 fragment duration also improves client download heuristics through hello use of repeat tags.</span></span> <span data-ttu-id="29bfa-142">durata Hello fluttuazione toocompensate per le frequenze di frame non integer.</span><span class="sxs-lookup"><span data-stu-id="29bfa-142">hello duration MAY fluctuate toocompensate for non-integer frame rates.</span></span>
7. <span data-ttu-id="29bfa-143">durata frammento MP4 Hello deve essere compreso tra circa 2 e 6 secondi.</span><span class="sxs-lookup"><span data-stu-id="29bfa-143">hello MP4 fragment duration SHOULD be between approximately 2 and 6 seconds.</span></span>
8. <span data-ttu-id="29bfa-144">I timestamp e gli indici (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` e `fragment_index`) del frammento MP4 dovrebbero (SHOULD) arrivare in ordine crescente.</span><span class="sxs-lookup"><span data-stu-id="29bfa-144">MP4 fragment timestamps and indexes (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` and `fragment_index`) SHOULD arrive in increasing order.</span></span> <span data-ttu-id="29bfa-145">Anche se Servizi multimediali è frammenti tooduplicate resilienti, frammenti tooreorder possibilità in base della sequenza temporale supporti toohello è limitata.</span><span class="sxs-lookup"><span data-stu-id="29bfa-145">Although Media Services is resilient tooduplicate fragments, it has limited ability tooreorder fragments according toohello media timeline.</span></span>

## <a name="4-protocol-format--http"></a><span data-ttu-id="29bfa-146">4. Formato del protocollo: HTTP</span><span class="sxs-lookup"><span data-stu-id="29bfa-146">4. Protocol format – HTTP</span></span>
<span data-ttu-id="29bfa-147">ISO frammentato basato su file MP4 in tempo reale di inserimento per servizi multimediali Usa un lunga HTTP POST richiesta tootransmit con codificata supporti dati standard che viene creato un pacchetto nel servizio di toohello formato MP4 frammentato.</span><span class="sxs-lookup"><span data-stu-id="29bfa-147">ISO fragmented MP4-based live ingest for Media Services uses a standard long-running HTTP POST request tootransmit encoded media data that is packaged in fragmented MP4 format toohello service.</span></span> <span data-ttu-id="29bfa-148">Ogni POST HTTP invia completa frammentato bitstream MP4 ("stream"), a partire dall'inizio di hello con caselle di intestazione (**ftyp**, **Live Server manifesto casella**, e **moov** caselle) e continuare con una sequenza di frammenti (**moof** e **mdat** caselle).</span><span class="sxs-lookup"><span data-stu-id="29bfa-148">Each HTTP POST sends a complete fragmented MP4 bitstream ("stream"), starting from hello beginning with header boxes (**ftyp**, **Live Server Manifest Box**, and **moov** boxes), and continuing with a sequence of fragments (**moof** and **mdat** boxes).</span></span> <span data-ttu-id="29bfa-149">Per la sintassi dell'URL per una richiesta HTTP POST hello, vedere la sezione in 9.2 [1].</span><span class="sxs-lookup"><span data-stu-id="29bfa-149">For URL syntax for hello HTTP POST request, see section 9.2 in [1].</span></span> <span data-ttu-id="29bfa-150">Un esempio di hello URL POST è:</span><span class="sxs-lookup"><span data-stu-id="29bfa-150">An example of hello POST URL is:</span></span> 

    http://customer.channel.mediaservices.windows.net/ingest.isml/streams(720p)

### <a name="requirements"></a><span data-ttu-id="29bfa-151">Requisiti</span><span class="sxs-lookup"><span data-stu-id="29bfa-151">Requirements</span></span>
<span data-ttu-id="29bfa-152">Di seguito sono hello informazioni dettagliate sui requisiti:</span><span class="sxs-lookup"><span data-stu-id="29bfa-152">Here are hello detailed requirements:</span></span>

1. <span data-ttu-id="29bfa-153">Hello codificatore deve iniziare hello broadcast inviando una richiesta HTTP POST con un oggetto vuoto "body" (lunghezza zero contenuto) utilizzando hello stesso URL di inserimento.</span><span class="sxs-lookup"><span data-stu-id="29bfa-153">hello encoder SHOULD start hello broadcast by sending an HTTP POST request with an empty “body” (zero content length) by using hello same ingestion URL.</span></span> <span data-ttu-id="29bfa-154">Questo può aiutare codificatore hello rilevare rapidamente se l'endpoint di inserimento in tempo reale hello sia valido e se non esiste alcuna autenticazione o altre condizioni necessarie.</span><span class="sxs-lookup"><span data-stu-id="29bfa-154">This can help hello encoder quickly detect whether hello live ingestion endpoint is valid, and if there are any authentication or other conditions required.</span></span> <span data-ttu-id="29bfa-155">Per ogni protocollo HTTP, server hello non può restituire una risposta HTTP fino a quando non hello intera richiesta, incluso il corpo POST hello, viene ricevuto.</span><span class="sxs-lookup"><span data-stu-id="29bfa-155">Per HTTP protocol, hello server can't send back an HTTP response until hello entire request, including hello POST body, is received.</span></span> <span data-ttu-id="29bfa-156">Natura lunga hello di un evento in tempo reale, senza questo passaggio, il codificatore hello potrebbe non essere toodetect in grado di qualsiasi errore finché non viene completata l'invio di tutti i dati di hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-156">Given hello long-running nature of a live event, without this step, hello encoder might not be able toodetect any error until it finishes sending all hello data.</span></span>
2. <span data-ttu-id="29bfa-157">codificatore Hello deve gestire eventuali errori o richieste di autenticazione a causa di (1).</span><span class="sxs-lookup"><span data-stu-id="29bfa-157">hello encoder MUST handle any errors or authentication challenges because of (1).</span></span> <span data-ttu-id="29bfa-158">Se in (1) è stata restituita una risposta 200, continua.</span><span class="sxs-lookup"><span data-stu-id="29bfa-158">If (1) succeeds with a 200 response, continue.</span></span>
3. <span data-ttu-id="29bfa-159">codificatore Hello deve iniziare una nuova richiesta HTTP POST con il flusso di file MP4 frammentato hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-159">hello encoder MUST start a new HTTP POST request with hello fragmented MP4 stream.</span></span> <span data-ttu-id="29bfa-160">payload Hello deve iniziare con caselle dell'intestazione hello, seguite da frammenti.</span><span class="sxs-lookup"><span data-stu-id="29bfa-160">hello payload MUST start with hello header boxes, followed by fragments.</span></span> <span data-ttu-id="29bfa-161">Si noti che hello **ftyp**, **Live Server manifesto casella**, e **moov** caselle (nell'ordine indicato) devono essere inviate con ogni richiesta, anche se è necessario riconnettere codificatore hello perché hello richiesta precedente è stata interrotta fine toohello precedente del flusso di hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-161">Note that hello **ftyp**, **Live Server Manifest Box**, and **moov** boxes (in this order) MUST be sent with each request, even if hello encoder must reconnect because hello previous request was terminated prior toohello end of hello stream.</span></span> 
4. <span data-ttu-id="29bfa-162">codificatore Hello deve utilizzare la codifica per il caricamento di trasferimento chunked, perché è Impossibile toopredict hello intera lunghezza del contenuto di hello in tempo reale di eventi.</span><span class="sxs-lookup"><span data-stu-id="29bfa-162">hello encoder MUST use chunked transfer encoding for uploading, because it’s impossible toopredict hello entire content length of hello live event.</span></span>
5. <span data-ttu-id="29bfa-163">Quando l'evento hello è stata completata, dopo l'ultimo frammento hello, invio codificatore hello deve terminare correttamente la sequenza dei messaggi (la maggior parte degli stack di client HTTP gestirla automaticamente) di codifica di trasferimento chunked hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-163">When hello event is over, after sending hello last fragment, hello encoder MUST gracefully end hello chunked transfer encoding message sequence (most HTTP client stacks handle it automatically).</span></span> <span data-ttu-id="29bfa-164">codificatore Hello deve attendere per il codice di risposta finale di hello servizio tooreturn hello e quindi terminare la connessione hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-164">hello encoder MUST wait for hello service tooreturn hello final response code, and then terminate hello connection.</span></span> 
6. <span data-ttu-id="29bfa-165">codificatore Hello non deve utilizzare hello `Events()` sostantivo come descritto in 9.2 in [1] per l'inserimento in tempo reale in servizi multimediali.</span><span class="sxs-lookup"><span data-stu-id="29bfa-165">hello encoder MUST NOT use hello `Events()` noun as described in 9.2 in [1] for live ingestion into Media Services.</span></span>
7. <span data-ttu-id="29bfa-166">Se una richiesta HTTP POST hello termina o volte out con un elemento end toohello precedente errore TCP di flusso hello, hello codificatore deve rilasciare una nuova richiesta POST con una nuova connessione e seguire hello requisiti precedenti.</span><span class="sxs-lookup"><span data-stu-id="29bfa-166">If hello HTTP POST request terminates or times out with a TCP error prior toohello end of hello stream, hello encoder MUST issue a new POST request by using a new connection, and follow hello preceding requirements.</span></span> <span data-ttu-id="29bfa-167">Inoltre, hello codificatore deve rinviare hello due frammenti MP4 precedenti per ogni traccia nel flusso hello e riprendere senza introdurre una discontinuità nella sequenza temporale dei supporti hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-167">Additionally, hello encoder MUST resend hello previous two MP4 fragments for each track in hello stream, and resume without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="29bfa-168">Inviare di nuovo i frammenti MP4 ultime due per ogni traccia hello non assicura che sia presente alcuna perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="29bfa-168">Resending hello last two MP4 fragments for each track ensures that there is no data loss.</span></span> <span data-ttu-id="29bfa-169">In altre parole, se un flusso contiene una audio sia una traccia video e hello corrente POST richiesta ha esito negativo, è necessario riconnettere codificatore hello e reinvia hello ultime due frammenti per traccia audio hello, che in precedenza sono stati inviati correttamente, e hello ultime due frammenti per Hello traccia video, che sono stati precedentemente inviato correttamente, tooensure che non vi è alcuna perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="29bfa-169">In other words, if a stream contains both an audio and a video track, and hello current POST request fails, hello encoder must reconnect and resend hello last two fragments for hello audio track, which were previously successfully sent, and hello last two fragments for hello video track, which were previously successfully sent, tooensure that there is no data loss.</span></span> <span data-ttu-id="29bfa-170">codificatore Hello mantenga un buffer di frammenti di supporti, inviare nuovamente quando si riconnette "Avanti".</span><span class="sxs-lookup"><span data-stu-id="29bfa-170">hello encoder MUST maintain a “forward” buffer of media fragments, which it resends when it reconnects.</span></span>

## <a name="5-timescale"></a><span data-ttu-id="29bfa-171">5. Scala cronologica</span><span class="sxs-lookup"><span data-stu-id="29bfa-171">5. Timescale</span></span>
<span data-ttu-id="29bfa-172">[[MS-SSTR] ](https://msdn.microsoft.com/library/ff469518.aspx) descrive l'uso di hello della scala cronologica per **SmoothStreamingMedia** (sezione 2.2.2.1), **StreamElement** (sezione 2.2.2.3), **StreamFragmentElement**(Sezione 2.2.2.6) e **LiveSMIL** (sezione 2.2.7.3.1).</span><span class="sxs-lookup"><span data-stu-id="29bfa-172">[[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx) describes hello usage of timescale for **SmoothStreamingMedia** (Section 2.2.2.1), **StreamElement** (Section 2.2.2.3), **StreamFragmentElement** (Section 2.2.2.6), and **LiveSMIL** (Section 2.2.7.3.1).</span></span> <span data-ttu-id="29bfa-173">Se il valore di scala cronologica hello non è presente, il valore predefinito hello utilizzato è 10.000.000 (10 MHz).</span><span class="sxs-lookup"><span data-stu-id="29bfa-173">If hello timescale value is not present, hello default value used is 10,000,000 (10 MHz).</span></span> <span data-ttu-id="29bfa-174">Sebbene hello specifica del formato Smooth Streaming non blocca l'utilizzo di altri valori della scala cronologica, la maggior parte delle implementazioni del codificatore predefinito questo valore (10 MHz) toogenerate Smooth Streaming di inserimento dati.</span><span class="sxs-lookup"><span data-stu-id="29bfa-174">Although hello Smooth Streaming format specification doesn’t block usage of other timescale values, most encoder implementations use this default value (10 MHz) toogenerate Smooth Streaming ingest data.</span></span> <span data-ttu-id="29bfa-175">Scadenza toohello [Azure Media creazione dinamica dei pacchetti](media-services-dynamic-packaging-overview.md) funzionalità, è consigliabile utilizzare una scala cronologica 90 KHz per flussi video e 44,1 KHz o KHz 48.1 per i flussi audio.</span><span class="sxs-lookup"><span data-stu-id="29bfa-175">Due toohello [Azure Media Dynamic Packaging](media-services-dynamic-packaging-overview.md) feature, we recommend that you use a 90-KHz timescale for video streams and 44.1 KHz or 48.1 KHz for audio streams.</span></span> <span data-ttu-id="29bfa-176">Se vengono utilizzati valori di scala cronologica diversi per i flussi diversi, della scala cronologica di hello a livello di flusso deve essere inviata.</span><span class="sxs-lookup"><span data-stu-id="29bfa-176">If different timescale values are used for different streams, hello stream-level timescale MUST be sent.</span></span> <span data-ttu-id="29bfa-177">Per altre informazioni, vedere [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="29bfa-177">For more information, see [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span></span>     

## <a name="6-definition-of-stream"></a><span data-ttu-id="29bfa-178">6. Definizione di "flusso"</span><span class="sxs-lookup"><span data-stu-id="29bfa-178">6. Definition of “stream”</span></span>
<span data-ttu-id="29bfa-179">Flusso è hello unità di base dell'operazione di inserimento in tempo reale per la composizione di presentazioni in tempo reale, la gestione di scenari di ridondanza e failover del flusso.</span><span class="sxs-lookup"><span data-stu-id="29bfa-179">Stream is hello basic unit of operation in live ingestion for composing live presentations, handling streaming failover, and redundancy scenarios.</span></span> <span data-ttu-id="29bfa-180">Il flusso è definito come un flusso di bit MP4 frammentato univoco che può contenere una singola traccia o più tracce.</span><span class="sxs-lookup"><span data-stu-id="29bfa-180">Stream is defined as one unique, fragmented MP4 bitstream that might contain a single track or multiple tracks.</span></span> <span data-ttu-id="29bfa-181">Una presentazione live completo può contenere uno o più flussi, a seconda della configurazione di hello di codificatori di hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-181">A full live presentation might contain one or more streams, depending on hello configuration of hello live encoders.</span></span> <span data-ttu-id="29bfa-182">Hello seguenti esempi illustrano varie opzioni di utilizzo di flussi toocompose una presentazione completa in tempo reale.</span><span class="sxs-lookup"><span data-stu-id="29bfa-182">hello following examples illustrate various options of using streams toocompose a full live presentation.</span></span>

<span data-ttu-id="29bfa-183">**Esempio:**</span><span class="sxs-lookup"><span data-stu-id="29bfa-183">**Example:**</span></span> 

<span data-ttu-id="29bfa-184">Un cliente desidera toocreate una presentazione di streaming in tempo reale che include hello velocità in bit audio/video seguente:</span><span class="sxs-lookup"><span data-stu-id="29bfa-184">A customer wants toocreate a live streaming presentation that includes hello following audio/video bitrates:</span></span>

<span data-ttu-id="29bfa-185">Video: 3000 kbps, 1500 kbps, 750 kbps</span><span class="sxs-lookup"><span data-stu-id="29bfa-185">Video – 3000 kbps, 1500 kbps, 750 kbps</span></span>

<span data-ttu-id="29bfa-186">Audio: 128 kbps</span><span class="sxs-lookup"><span data-stu-id="29bfa-186">Audio – 128 kbps</span></span>

### <a name="option-1-all-tracks-in-one-stream"></a><span data-ttu-id="29bfa-187">Opzione 1: tutte le tracce in un flusso</span><span class="sxs-lookup"><span data-stu-id="29bfa-187">Option 1: All tracks in one stream</span></span>
<span data-ttu-id="29bfa-188">In questo caso, un unico codificatore genera tutte le tracce audio/video e le aggrega in un flusso di bit MP4 frammentato.</span><span class="sxs-lookup"><span data-stu-id="29bfa-188">In this option, a single encoder generates all audio/video tracks, and then bundles them into one fragmented MP4 bitstream.</span></span> <span data-ttu-id="29bfa-189">Hello fmp4 bitstream viene quindi inviato tramite una singola connessione HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="29bfa-189">hello fragmented MP4 bitstream is then sent via a single HTTP POST connection.</span></span> <span data-ttu-id="29bfa-190">In questo esempio è presente un solo flusso per la presentazione live.</span><span class="sxs-lookup"><span data-stu-id="29bfa-190">In this example, there is only one stream for this live presentation.</span></span>

![Flussi - Una traccia][image2]

### <a name="option-2-each-track-in-a-separate-stream"></a><span data-ttu-id="29bfa-192">Opzione 2: ogni traccia in un flusso separato</span><span class="sxs-lookup"><span data-stu-id="29bfa-192">Option 2: Each track in a separate stream</span></span>
<span data-ttu-id="29bfa-193">In questo caso, hello codificatore inserisce una traccia in bitstream ogni frammento MP4 e successivamente invia tutti i flussi di hello tramite connessioni HTTP separate.</span><span class="sxs-lookup"><span data-stu-id="29bfa-193">In this option, hello encoder puts one track into each fragment MP4 bitstream, and then posts all of hello streams over separate HTTP connections.</span></span> <span data-ttu-id="29bfa-194">Questa operazione può essere eseguita con uno o più codificatori.</span><span class="sxs-lookup"><span data-stu-id="29bfa-194">This can be done with one encoder or with multiple encoders.</span></span> <span data-ttu-id="29bfa-195">inserimento in tempo reale Hello vede la presentazione in tempo reale come composto da quattro flussi.</span><span class="sxs-lookup"><span data-stu-id="29bfa-195">hello live ingestion sees this live presentation as composed of four streams.</span></span>

![Flussi - Tracce separate][image3]

### <a name="option-3-bundle-audio-track-with-hello-lowest-bitrate-video-track-into-one-stream"></a><span data-ttu-id="29bfa-197">Opzione 3: Aggregare traccia audio con traccia hello più bassa velocità in bit video in un flusso</span><span class="sxs-lookup"><span data-stu-id="29bfa-197">Option 3: Bundle audio track with hello lowest bitrate video track into one stream</span></span>
<span data-ttu-id="29bfa-198">In questo caso, il cliente di hello sceglie di tenere traccia audio hello toobundle con traccia video di hello più bassa velocità in bit in un frammento MP4 bitstream e lasciare hello altre due tracce video come flussi separati.</span><span class="sxs-lookup"><span data-stu-id="29bfa-198">In this option, hello customer chooses toobundle hello audio track with hello lowest-bitrate video track in one fragment MP4 bitstream, and leave hello other two video tracks as separate streams.</span></span> 

![Flussi - Tracce audio e video][image4]

### <a name="summary"></a><span data-ttu-id="29bfa-200">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="29bfa-200">Summary</span></span>
<span data-ttu-id="29bfa-201">Questo non è un elenco completo di tutte le possibili opzioni di inserimento applicabili all'esempio.</span><span class="sxs-lookup"><span data-stu-id="29bfa-201">This is not an exhaustive list of all possible ingestion options for this example.</span></span> <span data-ttu-id="29bfa-202">In realtà, qualsiasi forma di raggruppamento di tracce in flussi è supportata dal processo di inserimento live.</span><span class="sxs-lookup"><span data-stu-id="29bfa-202">As a matter of fact, any grouping of tracks into streams is supported by live ingestion.</span></span> <span data-ttu-id="29bfa-203">Clienti e fornitori di codificatori possono scegliere le proprie implementazioni in base alla complessità di progettazione, alla capacità del codificatore e a considerazioni sui livelli di ridondanza e failover.</span><span class="sxs-lookup"><span data-stu-id="29bfa-203">Customers and encoder vendors can choose their own implementations based on engineering complexity, encoder capacity, and redundancy and failover considerations.</span></span> <span data-ttu-id="29bfa-204">Tuttavia, nella maggior parte dei casi, è solo una traccia audio per la presentazione live intera hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-204">However, in most cases, there is only one audio track for hello entire live presentation.</span></span> <span data-ttu-id="29bfa-205">In tal caso, è importante tooensure hello healthiness di hello inserimento flusso che contiene la traccia audio hello. Questa considerazione spesso comporta l'inserimento di traccia audio hello nel flusso (ad esempio l'opzione 2) o viene aggiunta con traccia video di hello più bassa velocità in bit (come opzione 3).</span><span class="sxs-lookup"><span data-stu-id="29bfa-205">So, it’s important tooensure hello healthiness of hello ingest stream that contains hello audio track. This consideration often results in putting hello audio track in its own stream (as in Option 2) or bundling it with hello lowest-bitrate video track (as in Option 3).</span></span> <span data-ttu-id="29bfa-206">Inoltre, per una migliore ridondanza e tolleranza di errore, l'invio di hello stessa traccia audio in due diversi flussi (opzione 2 con tracce audio ridondanti) o aggregazione traccia audio di hello con almeno due delle tracce di hello più bassa velocità in bit video (opzione 3 con l'audio nell'inclusi in almeno due flussi video) è fortemente consigliato in tempo reale per acquisire in servizi multimediali.</span><span class="sxs-lookup"><span data-stu-id="29bfa-206">Also, for better redundancy and fault tolerance, sending hello same audio track in two different streams (Option 2 with redundant audio tracks) or bundling hello audio track with at least two of hello lowest-bitrate video tracks (Option 3 with audio bundled in at least two video streams) is highly recommended for live ingest into Media Services.</span></span>

## <a name="7-service-failover"></a><span data-ttu-id="29bfa-207">7. Failover del servizio</span><span class="sxs-lookup"><span data-stu-id="29bfa-207">7. Service failover</span></span>
<span data-ttu-id="29bfa-208">Specificato natura hello di streaming in tempo reale, supporto del failover buona è fondamentale per garantire la disponibilità del servizio hello hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-208">Given hello nature of live streaming, good failover support is critical for ensuring hello availability of hello service.</span></span> <span data-ttu-id="29bfa-209">Servizi multimediali è progettato toohandle vari tipi di errori, inclusi errori di rete, errori del server e problemi di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="29bfa-209">Media Services is designed toohandle various types of failures, including network errors, server errors, and storage issues.</span></span> <span data-ttu-id="29bfa-210">Quando utilizzato in combinazione con la logica di failover appropriata dal lato codificatore live hello, i clienti possono ottenere un servizio di streaming in tempo reale altamente affidabile dal cloud hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-210">When used in conjunction with proper failover logic from hello live encoder side, customers can achieve a highly reliable live streaming service from hello cloud.</span></span>

<span data-ttu-id="29bfa-211">Questa sezione descrive gli scenari di failover del servizio.</span><span class="sxs-lookup"><span data-stu-id="29bfa-211">In this section, we discuss service failover scenarios.</span></span> <span data-ttu-id="29bfa-212">In questo caso, l'errore hello avviene in un punto qualsiasi all'interno del servizio di hello e manifesta un errore di rete.</span><span class="sxs-lookup"><span data-stu-id="29bfa-212">In this case, hello failure happens somewhere within hello service, and it manifests itself as a network error.</span></span> <span data-ttu-id="29bfa-213">Ecco alcune indicazioni per l'implementazione del codificatore hello per il failover del servizio di gestione:</span><span class="sxs-lookup"><span data-stu-id="29bfa-213">Here are some recommendations for hello encoder implementation for handling service failover:</span></span>

1. <span data-ttu-id="29bfa-214">Utilizzare un timeout di 10 secondi per stabilire una connessione TCP hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-214">Use a 10-second timeout for establishing hello TCP connection.</span></span> <span data-ttu-id="29bfa-215">Se una connessione di hello tooestablish tentativo richiede più di 10 secondi, interrompere l'operazione di hello e riprovare.</span><span class="sxs-lookup"><span data-stu-id="29bfa-215">If an attempt tooestablish hello connection takes longer than 10 seconds, abort hello operation and try again.</span></span> 
2. <span data-ttu-id="29bfa-216">Utilizzare un timeout breve per l'invio di blocchi di messaggio di richiesta HTTP hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-216">Use a short timeout for sending hello HTTP request message chunks.</span></span> <span data-ttu-id="29bfa-217">Se la durata frammento MP4 di hello destinazione N secondi, utilizzare un timeout di invio tra N e 2 N secondi. ad esempio, se la durata di frammento MP4 hello è di 6 secondi, utilizzare un timeout di 6 secondi too12.</span><span class="sxs-lookup"><span data-stu-id="29bfa-217">If hello target MP4 fragment duration is N seconds, use a send timeout between N and 2 N seconds; for example, if hello MP4 fragment duration is 6 seconds, use a timeout of 6 too12 seconds.</span></span> <span data-ttu-id="29bfa-218">Se si verifica un timeout, la reimpostazione della connessione di hello, aprire una nuova connessione e resume flusso inserimento sulla nuova connessione hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-218">If a timeout occurs, reset hello connection, open a new connection, and resume stream ingest on hello new connection.</span></span> 
3. <span data-ttu-id="29bfa-219">Mantenere un buffer in sequenza con hello ultime due frammenti per ogni traccia sono stati inviati correttamente e completamente toohello servizio.</span><span class="sxs-lookup"><span data-stu-id="29bfa-219">Maintain a rolling buffer that has hello last two fragments for each track that were successfully and completely sent toohello service.</span></span>  <span data-ttu-id="29bfa-220">Se la richiesta HTTP POST hello per un flusso viene terminata o si verifica il timeout fine toohello precedente del flusso di hello, aprire una nuova connessione e iniziare un'altra richiesta HTTP POST, inviare nuovamente le intestazioni di flusso hello, inviare nuovamente hello ultime due frammenti per ogni traccia e riprendere il flusso di hello senza Consente di introdurre una discontinuità nella sequenza temporale dei supporti hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-220">If hello HTTP POST request for a stream is terminated or times out prior toohello end of hello stream, open a new connection and begin another HTTP POST request, resend hello stream headers, resend hello last two fragments for each track, and resume hello stream without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="29bfa-221">Ciò riduce hello possibilità di perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="29bfa-221">This reduces hello chance of data loss.</span></span>
4. <span data-ttu-id="29bfa-222">È consigliabile tale codificatore hello non limitare il numero di hello di tentativi tooestablish una connessione o riprendere il flusso dopo che si verifica un errore TCP.</span><span class="sxs-lookup"><span data-stu-id="29bfa-222">We recommend that hello encoder does NOT limit hello number of retries tooestablish a connection or resume streaming after a TCP error occurs.</span></span>
5. <span data-ttu-id="29bfa-223">Dopo un errore TCP:</span><span class="sxs-lookup"><span data-stu-id="29bfa-223">After a TCP error:</span></span>
  
    <span data-ttu-id="29bfa-224">a.</span><span class="sxs-lookup"><span data-stu-id="29bfa-224">a.</span></span> <span data-ttu-id="29bfa-225">la connessione corrente Hello deve essere chiusi e deve essere creata una nuova connessione per una nuova richiesta HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="29bfa-225">hello current connection MUST be closed, and a new connection MUST be created for a new HTTP POST request.</span></span>

    <span data-ttu-id="29bfa-226">b.</span><span class="sxs-lookup"><span data-stu-id="29bfa-226">b.</span></span> <span data-ttu-id="29bfa-227">nuovo HTTP POST URL deve essere Hello hello stesso hello URL POST iniziale.</span><span class="sxs-lookup"><span data-stu-id="29bfa-227">hello new HTTP POST URL MUST be hello same as hello initial POST URL.</span></span>
  
    <span data-ttu-id="29bfa-228">c.</span><span class="sxs-lookup"><span data-stu-id="29bfa-228">c.</span></span> <span data-ttu-id="29bfa-229">Hello nuovo HTTP POST deve includere le intestazioni di flusso (**ftyp**, **Live Server manifesto casella**, e **moov** caselle) che sono identiche toohello intestazioni flusso hello iniziale POST.</span><span class="sxs-lookup"><span data-stu-id="29bfa-229">hello new HTTP POST MUST include stream headers (**ftyp**, **Live Server Manifest Box**, and **moov** boxes) that are identical toohello stream headers in hello initial POST.</span></span>
  
    <span data-ttu-id="29bfa-230">d.</span><span class="sxs-lookup"><span data-stu-id="29bfa-230">d.</span></span> <span data-ttu-id="29bfa-231">ultimi due frammenti di hello inviati per ogni traccia devono essere reinviati e streaming deve riprendere senza introdurre una discontinuità nella sequenza temporale dei supporti hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-231">hello last two fragments sent for each track must be resent, and streaming must resume without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="29bfa-232">timestamp frammento MP4 Hello deve aumentare in modo continuo, anche tra le richieste HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="29bfa-232">hello MP4 fragment timestamps must increase continuously, even across HTTP POST requests.</span></span>
6. <span data-ttu-id="29bfa-233">codificatore Hello deve terminare una richiesta HTTP POST hello se dati non viene inviati a una velocità in relazione alla durata di frammento MP4 hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-233">hello encoder SHOULD terminate hello HTTP POST request if data is not being sent at a rate commensurate with hello MP4 fragment duration.</span></span>  <span data-ttu-id="29bfa-234">Una richiesta POST HTTP che non inviano i dati può impedire servizi multimediali di rapidamente la disconnessione dal codificatore hello nell'evento hello di un aggiornamento del servizio.</span><span class="sxs-lookup"><span data-stu-id="29bfa-234">An HTTP POST request that does not send data can prevent Media Services from quickly disconnecting from hello encoder in hello event of a service update.</span></span> <span data-ttu-id="29bfa-235">Per questo motivo, hello HTTP POST per sparse tracce (segnale dell'annuncio) devono essere breve durate, chiusura come frammento di tipo sparse hello viene inviato.</span><span class="sxs-lookup"><span data-stu-id="29bfa-235">For this reason, hello HTTP POST for sparse (ad signal) tracks SHOULD be short-lived, terminating as soon as hello sparse fragment is sent.</span></span>

## <a name="8-encoder-failover"></a><span data-ttu-id="29bfa-236">8. Failover del codificatore</span><span class="sxs-lookup"><span data-stu-id="29bfa-236">8. Encoder failover</span></span>
<span data-ttu-id="29bfa-237">Failover del codificatore è hello secondo scenario di failover che deve toobe indirizzato per il recapito di streaming in tempo reale end-to-end.</span><span class="sxs-lookup"><span data-stu-id="29bfa-237">Encoder failover is hello second type of failover scenario that needs toobe addressed for end-to-end live streaming delivery.</span></span> <span data-ttu-id="29bfa-238">In questo scenario, la condizione di errore hello viene eseguita sul lato di codificatore hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-238">In this scenario, hello error condition occurs on hello encoder side.</span></span> 

![Failover del codificatore][image5]

<span data-ttu-id="29bfa-240">Quando si verifica il failover del codificatore, si applica Hello seguendo le aspettative dei clienti dall'endpoint di inserimento in tempo reale hello:</span><span class="sxs-lookup"><span data-stu-id="29bfa-240">hello following expectations apply from hello live ingestion endpoint when encoder failover happens:</span></span>

1. <span data-ttu-id="29bfa-241">Una nuova istanza del codificatore deve essere creata toocontinue streaming, come illustrato nel diagramma hello (flusso di 3000k video, con linea tratteggiata).</span><span class="sxs-lookup"><span data-stu-id="29bfa-241">A new encoder instance SHOULD be created toocontinue streaming, as illustrated in hello diagram (Stream for 3000k video, with dashed line).</span></span>
2. <span data-ttu-id="29bfa-242">nuovo codificatore Hello deve utilizzare hello stesso richiede l'URL per HTTP POST come hello Impossibile istanza.</span><span class="sxs-lookup"><span data-stu-id="29bfa-242">hello new encoder MUST use hello same URL for HTTP POST requests as hello failed instance.</span></span>
3. <span data-ttu-id="29bfa-243">Hello richiesta POST del nuovo codificatore deve includere hello stesso frammentata caselle dell'intestazione MP4 come hello istanza non riuscita.</span><span class="sxs-lookup"><span data-stu-id="29bfa-243">hello new encoder’s POST request MUST include hello same fragmented MP4 header boxes as hello failed instance.</span></span>
4. <span data-ttu-id="29bfa-244">nuovo codificatore Hello deve essere sincronizzati correttamente con tutti gli altri codificatori in esecuzione per stessa presentazione live toogenerate hello sincronizzati gli esempi di audio e video con i limiti di frammento allineati.</span><span class="sxs-lookup"><span data-stu-id="29bfa-244">hello new encoder MUST be properly synced with all other running encoders for hello same live presentation toogenerate synced audio/video samples with aligned fragment boundaries.</span></span>
5. <span data-ttu-id="29bfa-245">nuovo flusso di Hello devono essere semanticamente equivalente con flusso precedente hello e intercambiabili a livello di intestazione e di frammento hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-245">hello new stream MUST be semantically equivalent with hello previous stream, and interchangeable at hello header and fragment levels.</span></span>
6. <span data-ttu-id="29bfa-246">nuovo codificatore Hello deve provare toominimize perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="29bfa-246">hello new encoder SHOULD try toominimize data loss.</span></span> <span data-ttu-id="29bfa-247">Hello `fragment_absolute_time` e `fragment_index` del supporto necessario aumentare i frammenti dal punto di hello punto in cui è stato interrotto il codificatore hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-247">hello `fragment_absolute_time` and `fragment_index` of media fragments SHOULD increase from hello point where hello encoder last stopped.</span></span> <span data-ttu-id="29bfa-248">Hello `fragment_absolute_time` e `fragment_index` devono aumentare in modo continuo, ma è ammessa toointroduce discontinuità, se necessario.</span><span class="sxs-lookup"><span data-stu-id="29bfa-248">hello `fragment_absolute_time` and `fragment_index` SHOULD increase in a continuous manner, but it is permissible toointroduce a discontinuity, if necessary.</span></span> <span data-ttu-id="29bfa-249">Servizi multimediali Ignora frammenti che ha già ricevuto ed elaborato, pertanto è migliore tooerr sul lato di hello di inviare di nuovo i frammenti di toointroduce discontinuità nella sequenza temporale dei supporti hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-249">Media Services ignores fragments that it has already received and processed, so it's better tooerr on hello side of resending fragments than toointroduce discontinuities in hello media timeline.</span></span> 

## <a name="9-encoder-redundancy"></a><span data-ttu-id="29bfa-250">9. Ridondanza del codificatore</span><span class="sxs-lookup"><span data-stu-id="29bfa-250">9. Encoder redundancy</span></span>
<span data-ttu-id="29bfa-251">Per alcuni eventi live critici per che anche una maggiore disponibilità e qualità di esperienza, è consigliabile usare codificatori ridondanti attivo-attivo tooachieve di failover senza perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="29bfa-251">For certain critical live events that demand even higher availability and quality of experience, we recommended that you use active-active redundant encoders tooachieve seamless failover with no data loss.</span></span>

![Ridondanza del codificatore][image6]

<span data-ttu-id="29bfa-253">Come illustrato nella figura seguente, due gruppi di codificatori push contemporaneamente due copie di ogni flusso nel servizio di hello in tempo reale.</span><span class="sxs-lookup"><span data-stu-id="29bfa-253">As illustrated in this diagram, two groups of encoders push two copies of each stream simultaneously into hello live service.</span></span> <span data-ttu-id="29bfa-254">Questa configurazione è supportata perché Servizi multimediali è in grado di escludere i frammenti duplicati in base all'ID flusso e al timestamp del frammento.</span><span class="sxs-lookup"><span data-stu-id="29bfa-254">This setup is supported because Media Services can filter out duplicate fragments based on stream ID and fragment timestamp.</span></span> <span data-ttu-id="29bfa-255">Hello risulta flusso in tempo reale e archiviazione è una singola copia di tutti i flussi di hello è hello aggregazione possibili migliore da due origini hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-255">hello resulting live stream and archive is a single copy of all hello streams that is hello best possible aggregation from hello two sources.</span></span> <span data-ttu-id="29bfa-256">Ad esempio, in un ipotetico caso estremo, purché vi sia un codificatore (hello toobe identico a quello non deve) in esecuzione in qualsiasi punto nel tempo per ogni flusso, hello risultante flusso live dal servizio hello è continua senza perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="29bfa-256">For example, in a hypothetical extreme case, as long as there is one encoder (it doesn’t have toobe hello same one) running at any given point in time for each stream, hello resulting live stream from hello service is continuous without data loss.</span></span> 

<span data-ttu-id="29bfa-257">requisiti di Hello per questo scenario sono quasi uguali hello come requisiti hello in caso di "Failover codificatore" hello, con l'eccezione hello secondo set di codificatori di hello in esecuzione in hello stesso tempo come hello codificatori primari.</span><span class="sxs-lookup"><span data-stu-id="29bfa-257">hello requirements for this scenario are almost hello same as hello requirements in hello "Encoder failover" case, with hello exception that hello second set of encoders are running at hello same time as hello primary encoders.</span></span>

## <a name="10-service-redundancy"></a><span data-ttu-id="29bfa-258">10. Ridondanza del servizio</span><span class="sxs-lookup"><span data-stu-id="29bfa-258">10. Service redundancy</span></span>
<span data-ttu-id="29bfa-259">Per la distribuzione globale altamente ridondante, talvolta è necessario disporre di calamità toohandle backup tra più aree.</span><span class="sxs-lookup"><span data-stu-id="29bfa-259">For highly redundant global distribution, sometimes you must have cross-region backup toohandle regional disasters.</span></span> <span data-ttu-id="29bfa-260">Espansione sulla topologia "Ridondanza codificatore" hello, clienti possono scegliere toohave distribuzione di un servizio ridondante in un'area diversa è connesso con secondo set di hello dei codificatori.</span><span class="sxs-lookup"><span data-stu-id="29bfa-260">Expanding on hello “Encoder redundancy” topology, customers can choose toohave a redundant service deployment in a different region that's connected with hello second set of encoders.</span></span> <span data-ttu-id="29bfa-261">Possono funzionare anche i clienti con un toodeploy provider Content Delivery Network una gestione traffico globale davanti traffico del servizio distribuzioni tooseamlessly route client hello due.</span><span class="sxs-lookup"><span data-stu-id="29bfa-261">Customers also can work with a Content Delivery Network provider toodeploy a Global Traffic Manager in front of hello two service deployments tooseamlessly route client traffic.</span></span> <span data-ttu-id="29bfa-262">requisiti Hello codificatori hello sono uguali a quelli hello case "Ridondanza codificatore" hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-262">hello requirements for hello encoders are hello same as hello “Encoder redundancy” case.</span></span> <span data-ttu-id="29bfa-263">Hello solo eccezione è che secondo set di hello di codificatori esigenze toobe puntata tooa diversa in tempo reale endpoint di inserimento.</span><span class="sxs-lookup"><span data-stu-id="29bfa-263">hello only exception is that hello second set of encoders needs toobe pointed tooa different live ingest endpoint.</span></span> <span data-ttu-id="29bfa-264">Hello diagramma seguente viene illustrato il programma di installazione:</span><span class="sxs-lookup"><span data-stu-id="29bfa-264">hello following diagram shows this setup:</span></span>

![Ridondanza del servizio][image7]

## <a name="11-special-types-of-ingestion-formats"></a><span data-ttu-id="29bfa-266">11. Tipi speciali di formati di inserimento</span><span class="sxs-lookup"><span data-stu-id="29bfa-266">11. Special types of ingestion formats</span></span>
<span data-ttu-id="29bfa-267">In questa sezione vengono illustrati tipi speciali di formati di inserimento in tempo reale toohandle progettato di scenari specifici.</span><span class="sxs-lookup"><span data-stu-id="29bfa-267">This section discusses special types of live ingestion formats that are designed toohandle specific scenarios.</span></span>

### <a name="sparse-track"></a><span data-ttu-id="29bfa-268">Traccia di tipo sparse</span><span class="sxs-lookup"><span data-stu-id="29bfa-268">Sparse track</span></span>
<span data-ttu-id="29bfa-269">Quando una presentazione live streaming con un'esperienza rich client, spesso è necessario tootransmit sincronizzati ora eventi o segnala in banda con i dati di supporto principale hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-269">When delivering a live streaming presentation with a rich client experience, often it's necessary tootransmit time-synced events or signals in-band with hello main media data.</span></span> <span data-ttu-id="29bfa-270">Un esempio di questo scenario è l'inserimento dinamico di annunci live.</span><span class="sxs-lookup"><span data-stu-id="29bfa-270">An example of this is dynamic live ad insertion.</span></span> <span data-ttu-id="29bfa-271">La segnalazione per questo tipo di eventi è diversa dal normale streaming di flussi audio/video a causa della particolare natura di tipo sparse.</span><span class="sxs-lookup"><span data-stu-id="29bfa-271">This type of event signaling is different from regular audio/video streaming because of its sparse nature.</span></span> <span data-ttu-id="29bfa-272">In altre parole, hello segnalazione dei dati in genere non si verifica in modo continuo e intervallo hello può essere toopredict disco rigido.</span><span class="sxs-lookup"><span data-stu-id="29bfa-272">In other words, hello signaling data usually does not happen continuously, and hello interval can be hard toopredict.</span></span> <span data-ttu-id="29bfa-273">il concetto di Hello di tracce di tipo sparse è stato progettato tooingest e dati di segnalazione di trasmissione in banda.</span><span class="sxs-lookup"><span data-stu-id="29bfa-273">hello concept of sparse track was designed tooingest and broadcast in-band signaling data.</span></span>

<span data-ttu-id="29bfa-274">Hello passaggi seguenti sono un'implementazione consigliata per l'inserimento di tracce di tipo sparse:</span><span class="sxs-lookup"><span data-stu-id="29bfa-274">hello following steps are a recommended implementation for ingesting sparse track:</span></span>

1. <span data-ttu-id="29bfa-275">Creare un flusso di bit MP4 frammentato separato contenente solo le tracce di tipo sparse, senza tracce audio/video.</span><span class="sxs-lookup"><span data-stu-id="29bfa-275">Create a separate fragmented MP4 bitstream that contains only sparse tracks, without audio/video tracks.</span></span>
2. <span data-ttu-id="29bfa-276">In hello **Live Server manifesto casella** come definito nella sezione 6 [1], utilizzare hello *parentTrackName* nome del parametro toospecify hello della traccia di hello padre. Per altre informazioni, vedere la sezione 4.2.1.2.1.2 di [1].</span><span class="sxs-lookup"><span data-stu-id="29bfa-276">In hello **Live Server Manifest Box** as defined in Section 6 in [1], use hello *parentTrackName* parameter toospecify hello name of hello parent track. For more information, see section 4.2.1.2.1.2 in [1].</span></span>
3. <span data-ttu-id="29bfa-277">In hello **Live Server manifesto casella**, **manifestOutput** deve essere impostato troppo**true**.</span><span class="sxs-lookup"><span data-stu-id="29bfa-277">In hello **Live Server Manifest Box**, **manifestOutput** MUST be set too**true**.</span></span>
4. <span data-ttu-id="29bfa-278">Natura hello sparse di hello segnalazione dell'evento, è consigliabile seguente hello:</span><span class="sxs-lookup"><span data-stu-id="29bfa-278">Given hello sparse nature of hello signaling event, we recommended hello following:</span></span>
   
    <span data-ttu-id="29bfa-279">a.</span><span class="sxs-lookup"><span data-stu-id="29bfa-279">a.</span></span> <span data-ttu-id="29bfa-280">Inizio hello dell'evento in tempo reale di hello, finestre di intestazione iniziali hello codificatore hello invia toohello servizio, che consente di tenere traccia di tipo sparse hello servizio tooregister hello nel manifesto client hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-280">At hello beginning of hello live event, hello encoder sends hello initial header boxes toohello service, which allows hello service tooregister hello sparse track in hello client manifest.</span></span>
   
    <span data-ttu-id="29bfa-281">b.</span><span class="sxs-lookup"><span data-stu-id="29bfa-281">b.</span></span> <span data-ttu-id="29bfa-282">codificatore Hello deve terminare una richiesta HTTP POST hello quando i dati non inviati.</span><span class="sxs-lookup"><span data-stu-id="29bfa-282">hello encoder SHOULD terminate hello HTTP POST request when data is not being sent.</span></span> <span data-ttu-id="29bfa-283">Un POST HTTP con esecuzione prolungata che non inviano i dati può impedire il rapidamente la disconnessione dal codificatore hello nell'evento hello di un riavvio del servizio, update o da server di servizi multimediali.</span><span class="sxs-lookup"><span data-stu-id="29bfa-283">A long-running HTTP POST that does not send data can prevent Media Services from quickly disconnecting from hello encoder in hello event of a service update or server reboot.</span></span> <span data-ttu-id="29bfa-284">In questi casi, server dei contenuti multimediali hello è temporaneamente bloccato in un'operazione di ricezione sul socket hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-284">In these cases, hello media server is temporarily blocked in a receive operation on hello socket.</span></span>
   
    <span data-ttu-id="29bfa-285">c.</span><span class="sxs-lookup"><span data-stu-id="29bfa-285">c.</span></span> <span data-ttu-id="29bfa-286">Durante la fase di hello quando la segnalazione di dati non è disponibile, il codificatore hello deve chiudere una richiesta HTTP POST hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-286">During hello time when signaling data is not available, hello encoder SHOULD close hello HTTP POST request.</span></span> <span data-ttu-id="29bfa-287">Quando richiesta POST hello è attivo, il codificatore hello deve inviare dati.</span><span class="sxs-lookup"><span data-stu-id="29bfa-287">While hello POST request is active, hello encoder SHOULD send data.</span></span>

    <span data-ttu-id="29bfa-288">d.</span><span class="sxs-lookup"><span data-stu-id="29bfa-288">d.</span></span> <span data-ttu-id="29bfa-289">Quando si inviano i frammenti di tipo sparse, il codificatore hello possibile impostare un'intestazione content-length esplicita, se disponibile.</span><span class="sxs-lookup"><span data-stu-id="29bfa-289">When sending sparse fragments, hello encoder can set an explicit content-length header, if it’s available.</span></span>

    <span data-ttu-id="29bfa-290">e.</span><span class="sxs-lookup"><span data-stu-id="29bfa-290">e.</span></span> <span data-ttu-id="29bfa-291">Quando si inviano i frammenti di tipo sparse con una nuova connessione, il codificatore hello dovrebbe iniziare l'invio dalle finestre di intestazione hello aggiungendo nuovi frammenti di hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-291">When sending sparse fragments with a new connection, hello encoder SHOULD start sending from hello header boxes, followed by hello new fragments.</span></span> <span data-ttu-id="29bfa-292">Questo è per i casi in cui failover avviene intermedio e connessione di tipo sparse nuovo hello viene stabilita tooa nuovo server non rilevati tracce di tipo sparse hello prima.</span><span class="sxs-lookup"><span data-stu-id="29bfa-292">This is for cases in which failover happens in-between, and hello new sparse connection is being established tooa new server that has not seen hello sparse track before.</span></span>

    <span data-ttu-id="29bfa-293">f.</span><span class="sxs-lookup"><span data-stu-id="29bfa-293">f.</span></span> <span data-ttu-id="29bfa-294">frammento di tracce di tipo sparse Hello diventa disponibile toohello client quando hello corrispondente padre traccia frammento che ha un valore uguale o maggiore di timestamp viene effettuata client toohello disponibili.</span><span class="sxs-lookup"><span data-stu-id="29bfa-294">hello sparse track fragment becomes available toohello client when hello corresponding parent track fragment that has an equal or larger timestamp value is made available toohello client.</span></span> <span data-ttu-id="29bfa-295">Ad esempio, se il frammento di tipo sparse hello ha un timestamp di t = 1000, è previsto che dopo client hello vede timestamp 1000 di frammento "video" (presupponendo che il nome di tenere traccia del padre hello è "video") o versioni successive, è possibile scaricare hello frammento sparse t = 1000.</span><span class="sxs-lookup"><span data-stu-id="29bfa-295">For example, if hello sparse fragment has a timestamp of t=1000, it is expected that after hello client sees "video" (assuming hello parent track name is "video") fragment timestamp 1000 or beyond, it can download hello sparse fragment t=1000.</span></span> <span data-ttu-id="29bfa-296">Si noti che segnale effettivo hello può essere utilizzate per un'altra posizione nella sequenza temporale di presentazione hello per lo scopo designato.</span><span class="sxs-lookup"><span data-stu-id="29bfa-296">Note that hello actual signal could be used for a different position in hello presentation timeline for its designated purpose.</span></span> <span data-ttu-id="29bfa-297">In questo esempio di possibili che hello frammento di tipo sparse di t = 1000 ha un payload XML, che è possibile inserire un annuncio in una posizione che è di pochi secondi in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="29bfa-297">In this example, it’s possible that hello sparse fragment of t=1000 has an XML payload, which is for inserting an ad in a position that’s a few seconds later.</span></span>

    <span data-ttu-id="29bfa-298">g.</span><span class="sxs-lookup"><span data-stu-id="29bfa-298">g.</span></span> <span data-ttu-id="29bfa-299">payload Hello di frammenti di tracce di tipo sparse possono essere in formati diversi (ad esempio XML, testo o binario), a seconda dello scenario di hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-299">hello payload of sparse track fragments can be in different formats (such as XML, text, or binary), depending on hello scenario.</span></span>

### <a name="redundant-audio-track"></a><span data-ttu-id="29bfa-300">Traccia audio ridondante</span><span class="sxs-lookup"><span data-stu-id="29bfa-300">Redundant audio track</span></span>
<span data-ttu-id="29bfa-301">HTTP adattivo streaming uno scenario tipico (ad esempio, Smooth Streaming o trattino), è spesso solo una traccia audio nell'intera presentazione hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-301">In a typical HTTP adaptive streaming scenario (for example, Smooth Streaming or DASH), often, there's only one audio track in hello entire presentation.</span></span> <span data-ttu-id="29bfa-302">A differenza delle tracce video, che dispongono di più livelli di qualità per hello toochoose di client da in condizioni di errore, la traccia audio hello può essere un singolo punto di errore se hello inserimento del flusso di hello che contiene la traccia audio hello viene interrotta.</span><span class="sxs-lookup"><span data-stu-id="29bfa-302">Unlike video tracks, which have multiple quality levels for hello client toochoose from in error conditions, hello audio track can be a single point of failure if hello ingestion of hello stream that contains hello audio track is broken.</span></span> 

<span data-ttu-id="29bfa-303">Questo problema, servizi multimediali supporta toosolve live inserimento delle tracce audio ridondanti.</span><span class="sxs-lookup"><span data-stu-id="29bfa-303">toosolve this problem, Media Services supports live ingestion of redundant audio tracks.</span></span> <span data-ttu-id="29bfa-304">l'idea Hello è tale hello stessa traccia audio può essere inviato più volte in diversi flussi.</span><span class="sxs-lookup"><span data-stu-id="29bfa-304">hello idea is that hello same audio track can be sent multiple times in different streams.</span></span> <span data-ttu-id="29bfa-305">Sebbene hello servizio solo registri traccia audio hello una volta nel manifesto client hello, è possibile utilizzare ridondanti tracce audio come backup per il recupero dei frammenti audio se traccia audio principale hello presenta problemi.</span><span class="sxs-lookup"><span data-stu-id="29bfa-305">Although hello service only registers hello audio track once in hello client manifest, it can use redundant audio tracks as backups for retrieving audio fragments if hello primary audio track has issues.</span></span> <span data-ttu-id="29bfa-306">tracce audio tooingest ridondante, il codificatore hello deve:</span><span class="sxs-lookup"><span data-stu-id="29bfa-306">tooingest redundant audio tracks, hello encoder needs to:</span></span>

1. <span data-ttu-id="29bfa-307">Creare più frammento MP4 bitstreams hello traccia audio stesso.</span><span class="sxs-lookup"><span data-stu-id="29bfa-307">Create hello same audio track in multiple fragment MP4 bitstreams.</span></span> <span data-ttu-id="29bfa-308">tracce audio ridondanti Hello devono essere semanticamente equivalenti, con hello stesso frammento timestamp e intercambiabile al livello di frammento e intestazione hello.</span><span class="sxs-lookup"><span data-stu-id="29bfa-308">hello redundant audio tracks MUST be semantically equivalent, with hello same fragment timestamps, and be interchangeable at hello header and fragment levels.</span></span>
2. <span data-ttu-id="29bfa-309">Verificare la voce "audio" hello in hello Live Server manifesto (sezione 6 [1]) è hello stesso per le tracce audio tutti ridondanti.</span><span class="sxs-lookup"><span data-stu-id="29bfa-309">Ensure that hello “audio” entry in hello Live Server Manifest (Section 6 in [1]) is hello same for all redundant audio tracks.</span></span>

<span data-ttu-id="29bfa-310">Hello dopo l'implementazione è consigliata per le tracce audio ridondanti:</span><span class="sxs-lookup"><span data-stu-id="29bfa-310">hello following implementation is recommended for redundant audio tracks:</span></span>

1. <span data-ttu-id="29bfa-311">Inviare ogni singola traccia audio in un flusso separato.</span><span class="sxs-lookup"><span data-stu-id="29bfa-311">Send each unique audio track in a stream by itself.</span></span> <span data-ttu-id="29bfa-312">È inoltre possibile inviare un flusso ridondante per ciascuno di questi flussi di traccia audio, in cui secondo flusso hello differisce da hello prima solo per identificatore hello in hello URL POST HTTP: {protocollo} :// {indirizzo del server} / {path}/Streams({identifier}) punto di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="29bfa-312">Also, send a redundant stream for each of these audio track streams, where hello second stream differs from hello first only by hello identifier in hello HTTP POST URL: {protocol}://{server address}/{publishing point path}/Streams({identifier}).</span></span>
2. <span data-ttu-id="29bfa-313">Utilizzare flussi distinti toosend hello due più basso video velocità in bit.</span><span class="sxs-lookup"><span data-stu-id="29bfa-313">Use separate streams toosend hello two lowest video bitrates.</span></span> <span data-ttu-id="29bfa-314">Ciascuno di questi flussi dovrebbe (SHOULD) inoltre contenere una copia di ogni singola traccia audio. Se, ad esempio, sono supportate più lingue, i flussi dovrebbero (SHOULD) contenere tracce audio per ogni lingua.</span><span class="sxs-lookup"><span data-stu-id="29bfa-314">Each of these streams SHOULD also contain a copy of each unique audio track. For example, when multiple languages are supported, these streams SHOULD contain audio tracks for each language.</span></span>
3. <span data-ttu-id="29bfa-315">Utilizzare tooencode istanze server distinti (codificatore) e invia i flussi di ridondanza hello indicati (1) e (2).</span><span class="sxs-lookup"><span data-stu-id="29bfa-315">Use separate server (encoder) instances tooencode and send hello redundant streams mentioned in (1) and (2).</span></span> 

## <a name="media-services-learning-paths"></a><span data-ttu-id="29bfa-316">Percorsi di apprendimento di Servizi multimediali</span><span class="sxs-lookup"><span data-stu-id="29bfa-316">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="29bfa-317">Fornire commenti e suggerimenti</span><span class="sxs-lookup"><span data-stu-id="29bfa-317">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

[image1]: ./media/media-services-fmp4-live-ingest-overview/media-services-image1.png
[image2]: ./media/media-services-fmp4-live-ingest-overview/media-services-image2.png
[image3]: ./media/media-services-fmp4-live-ingest-overview/media-services-image3.png
[image4]: ./media/media-services-fmp4-live-ingest-overview/media-services-image4.png
[image5]: ./media/media-services-fmp4-live-ingest-overview/media-services-image5.png
[image6]: ./media/media-services-fmp4-live-ingest-overview/media-services-image6.png
[image7]: ./media/media-services-fmp4-live-ingest-overview/media-services-image7.png
