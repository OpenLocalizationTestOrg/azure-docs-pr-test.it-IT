---
title: "ripristino di emergenza e disponibilità aaaHigh di SAP HANA in Azure (istanze di grandi dimensioni) | Documenti Microsoft"
description: "Implementare la disponibilità elevata e pianificare il ripristino di emergenza di SAP HANA in Azure (istanze di grandi dimensioni)."
services: virtual-machines-linux
documentationcenter: 
author: RicksterCDN
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 12/01/2016
ms.author: rclaus
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 0c0967f54cf29bbb275eb7cda9d36608488add9e
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="sap-hana-large-instances-high-availability-and-disaster-recovery-on-azure"></a><span data-ttu-id="c1818-103">Disponibilità elevata e ripristino di emergenza di SAP HANA (istanze di grandi dimensioni) in Azure</span><span class="sxs-lookup"><span data-stu-id="c1818-103">SAP HANA (large instances) high availability and disaster recovery on Azure</span></span> 

<span data-ttu-id="c1818-104">La disponibilità elevata e il ripristino di emergenza sono aspetti importanti per l'esecuzione di uno o più server SAP HANA di importanza critica in Azure (istanze di grandi dimensioni).</span><span class="sxs-lookup"><span data-stu-id="c1818-104">High availability and disaster recovery are important aspects of running your mission-critical SAP HANA on Azure (large instances) servers.</span></span> <span data-ttu-id="c1818-105">È importante toowork con SAP, l'integratore di sistema, o Microsoft tooproperly architect e implementare hello strategia destra elevata-disponibilità/ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="c1818-105">It's important toowork with SAP, your system integrator, or Microsoft tooproperly architect and implement hello right high-availability/disaster-recovery strategy.</span></span> <span data-ttu-id="c1818-106">È inoltre importante tooconsider obiettivo del punto di ripristino hello e obiettivo tempo di ripristino, che sono tooyour specifico ambiente.</span><span class="sxs-lookup"><span data-stu-id="c1818-106">It is also important tooconsider hello recovery point objective and recovery time objective, which are specific tooyour environment.</span></span>

## <a name="high-availability"></a><span data-ttu-id="c1818-107">Disponibilità elevata</span><span class="sxs-lookup"><span data-stu-id="c1818-107">High availability</span></span>

<span data-ttu-id="c1818-108">Microsoft supporta metodi di disponibilità elevata di SAP HANA "out della casella hello," che includono:</span><span class="sxs-lookup"><span data-stu-id="c1818-108">Microsoft supports SAP HANA high-availability methods "out of hello box," which include:</span></span>

- <span data-ttu-id="c1818-109">**Replica di archiviazione:** hello tooreplicate possibilità di sistema di archiviazione percorso di tutti i dati tooanother (all'interno, o separatamente, hello stesso Data Center).</span><span class="sxs-lookup"><span data-stu-id="c1818-109">**Storage replication:** hello storage system's ability tooreplicate all data tooanother location (within, or separate from, hello same datacenter).</span></span> <span data-ttu-id="c1818-110">SAP HANA funziona in modo indipendente da questo metodo.</span><span class="sxs-lookup"><span data-stu-id="c1818-110">SAP HANA operates independently of this method.</span></span>
- <span data-ttu-id="c1818-111">**Replica DFS HANA:** hello replica di tutti i dati nel sistema SAP HANA di SAP HANA tooa distinto.</span><span class="sxs-lookup"><span data-stu-id="c1818-111">**HANA system replication:** hello replication of all data in SAP HANA tooa separate SAP HANA system.</span></span> <span data-ttu-id="c1818-112">obiettivo tempo di ripristino Hello è ridotta a icona tramite la replica dei dati a intervalli regolari.</span><span class="sxs-lookup"><span data-stu-id="c1818-112">hello recovery time objective is minimized through data replication at regular intervals.</span></span> <span data-ttu-id="c1818-113">SAP HANA supporta le modalità in memoria e sincrone sincrone, asincrone (consigliata solo per SAP HANA tutti i sistemi all'interno di hello stesso Data Center o meno di 100 KM distanza).</span><span class="sxs-lookup"><span data-stu-id="c1818-113">SAP HANA supports asynchronous, synchronous in-memory, and synchronous modes (recommended only for SAP HANA systems that are within hello same datacenter or less than 100 KM apart).</span></span> <span data-ttu-id="c1818-114">Nella struttura corrente di hello di indicatori di grandi dimensioni istanza HANA, replica DFS HANA è utilizzabile per la disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="c1818-114">In hello current design of HANA large-instance stamps, HANA system replication can be used for high availability only.</span></span>
- <span data-ttu-id="c1818-115">**Host con failover automatico:** un toouse soluzione-recupero da errori locali come una replica toosystem alternativo.</span><span class="sxs-lookup"><span data-stu-id="c1818-115">**Host auto-failover:** A local fault-recovery solution toouse as an alternative toosystem replication.</span></span> <span data-ttu-id="c1818-116">Quando il nodo principale hello diventa non disponibile, uno o più nodi di SAP HANA standby sono configurati in modalità di scalabilità orizzontale e SAP HANA automaticamente eseguito il failover tooanother nodo.</span><span class="sxs-lookup"><span data-stu-id="c1818-116">When hello master node becomes unavailable, one or more standby SAP HANA nodes are configured in scale-out mode and SAP HANA automatically fails over tooanother node.</span></span>

<span data-ttu-id="c1818-117">Per ulteriori informazioni sulla disponibilità elevata di SAP HANA, vedere le seguenti informazioni SAP hello:</span><span class="sxs-lookup"><span data-stu-id="c1818-117">For more information on SAP HANA high availability, see hello following SAP information:</span></span>

- <span data-ttu-id="c1818-118">[SAP HANA High-Availability Whitepaper](http://go.sap.com/documents/2016/05/f8e5eeba-737c-0010-82c7-eda71af511fa.html) (White paper sulla disponibilità elevata di SAP HANA)</span><span class="sxs-lookup"><span data-stu-id="c1818-118">[SAP HANA High-Availability Whitepaper](http://go.sap.com/documents/2016/05/f8e5eeba-737c-0010-82c7-eda71af511fa.html)</span></span>
- <span data-ttu-id="c1818-119">[SAP HANA Administration Guide](http://help.sap.com/hana/SAP_HANA_Administration_Guide_en.pdf) (Guida all'amministrazione di SAP HANA)</span><span class="sxs-lookup"><span data-stu-id="c1818-119">[SAP HANA Administration Guide](http://help.sap.com/hana/SAP_HANA_Administration_Guide_en.pdf)</span></span>
- <span data-ttu-id="c1818-120">[SAP Academy Video on SAP HANA System Replication](http://scn.sap.com/community/hana-in-memory/blog/2015/05/19/sap-hana-system-replication) (Video della SAP Academy sulla replica di sistema di SAP HANA)</span><span class="sxs-lookup"><span data-stu-id="c1818-120">[SAP Academy Video on SAP HANA System Replication](http://scn.sap.com/community/hana-in-memory/blog/2015/05/19/sap-hana-system-replication)</span></span>
- <span data-ttu-id="c1818-121">[SAP Support Note #1999880 - FAQ on SAP HANA System Replication](https://bcs.wdf.sap.corp/sap/support/notes/1999880) (Nota di supporto SAP 1999880 - Domande frequenti sulla replica di sistema di SAP HANA)</span><span class="sxs-lookup"><span data-stu-id="c1818-121">[SAP Support Note #1999880 – FAQ on SAP HANA System Replication](https://bcs.wdf.sap.corp/sap/support/notes/1999880)</span></span>
- <span data-ttu-id="c1818-122">[SAP Support Note #2165547 - SAP HANA Backup and Restore within SAP HANA System Replication Environment](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3231363535343726) (Nota di supporto SAP 2165547 - Backup e ripristino di SAP HANA nell'ambiente di replica di sistema di SAP HANA)</span><span class="sxs-lookup"><span data-stu-id="c1818-122">[SAP Support Note #2165547 – SAP HANA Backup and Restore within SAP HANA System Replication Environment](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3231363535343726)</span></span>
- <span data-ttu-id="c1818-123">[SAP Support Note #1984882 - Using SAP HANA System Replication for Hardware Exchange with Minimum/Zero Downtime](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3139383438383226) (Nota di supporto SAP 1984882 - Uso della replica di sistema di SAP HANA per la sostituzione di hardware con tempo di inattività minimo o nullo)</span><span class="sxs-lookup"><span data-stu-id="c1818-123">[SAP Support Note #1984882 – Using SAP HANA System Replication for Hardware Exchange with Minimum/Zero Downtime](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3139383438383226)</span></span>

## <a name="disaster-recovery"></a><span data-ttu-id="c1818-124">Ripristino di emergenza</span><span class="sxs-lookup"><span data-stu-id="c1818-124">Disaster recovery</span></span>

<span data-ttu-id="c1818-125">SAP HANA in Azure (istanze di grandi dimensioni) è disponibile in due aree di Azure all'interno di un'area geopolitica.</span><span class="sxs-lookup"><span data-stu-id="c1818-125">SAP HANA on Azure (large instances) is offered in two Azure regions in a geopolitical region.</span></span> <span data-ttu-id="c1818-126">Tra indicatori di grandi dimensioni istanza due di hello di due aree diverse è una connettività di rete diretto per la replica dei dati durante il ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="c1818-126">Between hello two large-instance stamps of two different regions is a direct network connectivity for replicating data during disaster recovery.</span></span> <span data-ttu-id="c1818-127">replica Hello dei dati di hello è basato l'infrastruttura di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="c1818-127">hello replication of hello data is storage-infrastructure based.</span></span> <span data-ttu-id="c1818-128">la replica di Hello non viene eseguita per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="c1818-128">hello replication is not done by default.</span></span> <span data-ttu-id="c1818-129">Viene eseguito per le configurazioni del cliente hello ordinati il ripristino di emergenza hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-129">It is done for hello customer configurations that ordered hello disaster recovery.</span></span> <span data-ttu-id="c1818-130">Nella finestra di progettazione corrente hello, replica DFS HANA non utilizzabile per il ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="c1818-130">In hello current design, HANA system replication can't be used for disaster recovery.</span></span>

<span data-ttu-id="c1818-131">Tuttavia, il vantaggio di tootake hello ripristino di emergenza, è necessario toostart toodesign hello rete connettività toohello due diverse aree di Azure.</span><span class="sxs-lookup"><span data-stu-id="c1818-131">However, tootake advantage of hello disaster recovery, you need toostart toodesign hello network connectivity toohello two different Azure regions.</span></span> <span data-ttu-id="c1818-132">toodo in tal caso, non è presente una connessione del circuito ExpressRoute di Azure locale l'area principale di Azure e un'altra connessione circuito dall'area di ripristino di emergenza tooyour locale.</span><span class="sxs-lookup"><span data-stu-id="c1818-132">toodo so, you need an Azure ExpressRoute circuit connection from on-premises in your main Azure region and another circuit connection from on-premises tooyour disaster-recovery region.</span></span> <span data-ttu-id="c1818-133">Questa misura consente di gestire le situazioni in cui si verifica un problema all'interno di un'intera area di Azure, inclusa la posizione di un router MSEE (Microsoft Enterprise Edge).</span><span class="sxs-lookup"><span data-stu-id="c1818-133">This measure would cover a situation in which a complete Azure region, including a Microsoft enterprise edge router (MSEE) location, has an issue.</span></span>

<span data-ttu-id="c1818-134">Come seconda misura, è possibile connettere tutte le reti virtuali di Azure che si connettono tooSAP HANA in Azure (istanze di grandi dimensioni) in uno dei hello aree tooboth di tali circuiti ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c1818-134">As a second measure, you can connect all Azure virtual networks that connect tooSAP HANA on Azure (large instances) in one of hello regions tooboth of those ExpressRoute circuits.</span></span> <span data-ttu-id="c1818-135">Questa misura consente di risolvere un caso in cui solo una delle posizioni MSEE hello che si connette il percorso locale con Azure va fuori servizio.</span><span class="sxs-lookup"><span data-stu-id="c1818-135">This measure addresses a case where only one of hello MSEE locations that connects your on-premises location with Azure goes off duty.</span></span>

<span data-ttu-id="c1818-136">Hello figura seguente viene illustrata la configurazione ottimale di hello per il ripristino di emergenza:</span><span class="sxs-lookup"><span data-stu-id="c1818-136">hello following figure shows hello optimal configuration for disaster recovery:</span></span>

![Configurazione ottimale per il ripristino di emergenza](./media/hana-overview-high-availability-disaster-recovery/image1-optimal-configuration.png)

<span data-ttu-id="c1818-138">Hello caso ottimale per una configurazione di ripristino di emergenza di rete hello è toohave due circuiti ExpressRoute da on-premise toohello due diverse aree di Azure.</span><span class="sxs-lookup"><span data-stu-id="c1818-138">hello optimal case for a disaster-recovery configuration of hello network is toohave two ExpressRoute circuits from on-premises toohello two different Azure regions.</span></span> <span data-ttu-id="c1818-139">Un circuito passa tooregion #1 in esecuzione un'istanza di produzione.</span><span class="sxs-lookup"><span data-stu-id="c1818-139">One circuit goes tooregion #1, running a production instance.</span></span> <span data-ttu-id="c1818-140">circuito ExpressRoute secondo Hello passa tooregion #2, alcune istanze HANA non di produzione in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="c1818-140">hello second ExpressRoute circuit goes tooregion #2, running some non-production HANA instances.</span></span> <span data-ttu-id="c1818-141">(Questo è importante se un'intera regione di Azure, tra cui hello MSEE e indicatore di grandi dimensioni-istanza, viene disattivato griglia hello).</span><span class="sxs-lookup"><span data-stu-id="c1818-141">(This is important if an entire Azure region, including hello MSEE and large-instance stamp, goes off hello grid.)</span></span>

<span data-ttu-id="c1818-142">Come seconda misura, hello diverse reti virtuali è connessa toohello circuiti ExpressRoute diversi che sono connessi tooSAP HANA in Azure (istanze di grandi dimensioni).</span><span class="sxs-lookup"><span data-stu-id="c1818-142">As a second measure, hello various virtual networks are connected toohello various ExpressRoute circuits that are connected tooSAP HANA on Azure (large instances).</span></span> <span data-ttu-id="c1818-143">È possibile ignorare percorso hello in cui un MSEE ha esito negativo oppure è possibile ridurre l'obiettivo del punto di ripristino hello per il ripristino di emergenza, come illustrato più avanti.</span><span class="sxs-lookup"><span data-stu-id="c1818-143">You can bypass hello location where an MSEE is failing, or you can lower hello recovery point objective for disaster recovery, as we discuss later.</span></span>

<span data-ttu-id="c1818-144">Hello requisiti successivi per l'installazione di ripristino di emergenza sono:</span><span class="sxs-lookup"><span data-stu-id="c1818-144">hello next requirements for a disaster-recovery setup are:</span></span>

- <span data-ttu-id="c1818-145">È necessario ordinare SAP HANA per gli SKU di Azure (istanze di grandi dimensioni) di hello stesso dimensioni di SKU di produzione e di distribuirli nell'area di ripristino di emergenza hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-145">You must order SAP HANA on Azure (large instances) SKUs of hello same size as your production SKUs and deploy them in hello disaster-recovery region.</span></span> <span data-ttu-id="c1818-146">Queste istanze possono essere utilizzati toorun test, sandbox o QA HANA istanze.</span><span class="sxs-lookup"><span data-stu-id="c1818-146">These instances can be used toorun test, sandbox, or QA HANA instances.</span></span>
- <span data-ttu-id="c1818-147">È necessario ordinare un profilo di ripristino di emergenza per ciascuna del SAP HANA per gli SKU di Azure (istanze di grandi dimensioni) che si desidera toorecover nel sito di ripristino di emergenza hello, se necessario.</span><span class="sxs-lookup"><span data-stu-id="c1818-147">You must order a disaster-recovery profile for each of your SAP HANA on Azure (large instances) SKUs that you want toorecover in hello disaster-recovery site, if necessary.</span></span> <span data-ttu-id="c1818-148">Questa azione comporta l'allocazione toohello di volumi di archiviazione, che sono di replica di archiviazione hello dalla propria area di produzione nell'area di ripristino di emergenza hello hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-148">This action leads toohello allocation of storage volumes, which are hello target of hello storage replication from your production region into hello disaster-recovery region.</span></span>

<span data-ttu-id="c1818-149">Una volta soddisfatti hello precedenti requisiti, è la replica di archiviazione di responsabilità toostart hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-149">After you meet hello preceding requirements, it is your responsibility toostart hello storage replication.</span></span> <span data-ttu-id="c1818-150">In un'infrastruttura di archiviazione hello utilizzata per SAP HANA in Azure (istanze di grandi dimensioni), base hello della replica di archiviazione è snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="c1818-150">In hello storage infrastructure used for SAP HANA on Azure (large instances), hello basis of storage replication is storage snapshots.</span></span> <span data-ttu-id="c1818-151">replica di ripristino di emergenza hello toostart, è necessario tooperform:</span><span class="sxs-lookup"><span data-stu-id="c1818-151">toostart hello disaster-recovery replication, you need tooperform:</span></span>

- <span data-ttu-id="c1818-152">Uno snapshot del LUN di avvio, come descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="c1818-152">A snapshot of your boot LUN, as described earlier.</span></span>
- <span data-ttu-id="c1818-153">Uno snapshot dei volumi correlati a HANA, come descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="c1818-153">A snapshot of your HANA-related volumes, as described earlier.</span></span>

<span data-ttu-id="c1818-154">Dopo aver eseguito questi snapshot, una replica iniziale dei volumi hello viene effettuato il seeding hello in volumi in cui sono associati al profilo di ripristino di emergenza nell'area di ripristino di emergenza hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-154">After you execute these snapshots, an initial replica of hello volumes is seeded on hello volumes that are associated with your disaster-recovery profile in hello disaster-recovery region.</span></span>

<span data-ttu-id="c1818-155">Successivamente, in cui ogni ora viene utilizzato con snapshot di archiviazione più recente di hello delta hello tooreplicate che sviluppano su volumi di archiviazione hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-155">Subsequently, hello most recent storage snapshot is used every hour tooreplicate hello deltas that develop on hello storage volumes.</span></span>

<span data-ttu-id="c1818-156">obiettivo del punto di ripristino Hello che è possibile ottenere con questa configurazione è di 60 minuti too90.</span><span class="sxs-lookup"><span data-stu-id="c1818-156">hello recovery point objective that's achieved with this configuration is from 60 too90 minutes.</span></span> <span data-ttu-id="c1818-157">un ripristino migliore tooachieve obiettivo del punto in caso di ripristino di emergenza hello, copia hello HANA backup log delle transazioni da SAP HANA in Azure (istanze di grandi dimensioni) toohello altre aree di Azure.</span><span class="sxs-lookup"><span data-stu-id="c1818-157">tooachieve a better recovery point objective in hello disaster-recovery case, copy hello HANA transaction log backups from SAP HANA on Azure (large instances) toohello other Azure region.</span></span> <span data-ttu-id="c1818-158">tooachieve questo obiettivo del punto di ripristino, hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="c1818-158">tooachieve this recovery point objective, do hello following:</span></span>

1. <span data-ttu-id="c1818-159">Eseguire il backup delle transazioni HANA hello accedere come spesso possibile troppo/hana / / backup del log.</span><span class="sxs-lookup"><span data-stu-id="c1818-159">Back up hello HANA transaction log as frequently as possible too/hana/log/backup.</span></span>
2. <span data-ttu-id="c1818-160">Copiare i backup del log delle transazioni hello quando sono finiti tooan macchina virtuale di Azure (VM), ovvero in una rete virtuale connessa toohello SAP HANA nel server di Azure (istanze di grandi dimensioni).</span><span class="sxs-lookup"><span data-stu-id="c1818-160">Copy hello transaction log backups when they are finished tooan Azure virtual machine (VM), which is in a virtual network that's connected toohello SAP HANA on Azure (large instances) server.</span></span>
3. <span data-ttu-id="c1818-161">Dalla macchina virtuale, copiare hello backup tooa macchina virtuale che risiede in una rete virtuale nell'area di ripristino di emergenza hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-161">From that VM, copy hello backup tooa VM that's in a virtual network in hello disaster-recovery region.</span></span>
4. <span data-ttu-id="c1818-162">Mantenere i backup del log di transazione hello in tale area nel hello VM.</span><span class="sxs-lookup"><span data-stu-id="c1818-162">Keep hello transaction log backups in that region in hello VM.</span></span>

<span data-ttu-id="c1818-163">In caso di emergenza, dopo aver distribuito il profilo di ripristino di emergenza hello in un server effettivo, copiare i backup del log delle transazioni hello hello VM toohello SAP HANA in Azure (istanze di grandi dimensioni) è ora server primario di hello nell'area di ripristino di emergenza hello, e ripristinare tali backup.</span><span class="sxs-lookup"><span data-stu-id="c1818-163">In case of disaster, after hello disaster-recovery profile has been deployed on an actual server, copy hello transaction log backups from hello VM toohello SAP HANA on Azure (large instances) that is now hello primary server in hello disaster-recovery region, and restore those backups.</span></span> <span data-ttu-id="c1818-164">Il ripristino è possibile perché lo stato di hello di HANA su dischi di ripristino di emergenza hello è quello di uno snapshot HANA.</span><span class="sxs-lookup"><span data-stu-id="c1818-164">This recovery is possible because hello state of HANA on hello disaster-recovery disks is that of a HANA snapshot.</span></span> <span data-ttu-id="c1818-165">Si tratta di punto di offset hello per ulteriori operazioni di ripristino di backup del log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="c1818-165">This is hello offset point for further restorations of transaction log backups.</span></span>

## <a name="backup-and-restore"></a><span data-ttu-id="c1818-166">Backup e ripristino</span><span class="sxs-lookup"><span data-stu-id="c1818-166">Backup and restore</span></span>

<span data-ttu-id="c1818-167">Uno dei database toooperating aspetti più importanti di hello consiste nel garantire database hello può essere protetti da vari eventi irreversibili.</span><span class="sxs-lookup"><span data-stu-id="c1818-167">One of hello most important aspects toooperating databases is making sure hello database can be protected from various catastrophic events.</span></span> <span data-ttu-id="c1818-168">Questi eventi possono essere causati da niente da errori dell'utente toosimple calamità naturali.</span><span class="sxs-lookup"><span data-stu-id="c1818-168">These events can be caused by anything from natural disasters toosimple user errors.</span></span>

<span data-ttu-id="c1818-169">Backup di database, con toorestore possibilità hello è tooany punto nel tempo (ad esempio prima che un utente eliminato i dati critici), consente il ripristino stato di tooa più vicino possibile toohello presentava prima che si è verificato interruzioni hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-169">Backing up a database, with hello ability toorestore it tooany point in time (such as before somebody deleted critical data), allows restoration tooa state that is as close as possible toohello way it was before hello disruption occurred.</span></span>

<span data-ttu-id="c1818-170">Per ottenere risultati ottimali, è necessario eseguire due tipi di backup:</span><span class="sxs-lookup"><span data-stu-id="c1818-170">Two types of backups must be performed for best results:</span></span>

- <span data-ttu-id="c1818-171">Backup del database</span><span class="sxs-lookup"><span data-stu-id="c1818-171">Database backups</span></span>
- <span data-ttu-id="c1818-172">Backup dei log delle transazioni</span><span class="sxs-lookup"><span data-stu-id="c1818-172">Transaction log backups</span></span>

<span data-ttu-id="c1818-173">Inoltre toofull il backup del database eseguito a livello di applicazione, è possibile anche più accurato eseguendo il backup con snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="c1818-173">In addition toofull database backups performed at an application-level, you can be even more thorough by performing backups with storage snapshots.</span></span> <span data-ttu-id="c1818-174">Esecuzione di backup del log è anche importante per il ripristino di database hello (tooempty hello log delle transazioni già eseguito il commit e).</span><span class="sxs-lookup"><span data-stu-id="c1818-174">Performing log backups is also important for restoring hello database (and tooempty hello logs from already committed transactions).</span></span>

<span data-ttu-id="c1818-175">SAP HANA in Azure (istanze di grandi dimensioni) offre due opzioni di backup e ripristino:</span><span class="sxs-lookup"><span data-stu-id="c1818-175">SAP HANA on Azure (large instances) offers two backup and restore options:</span></span>

- <span data-ttu-id="c1818-176">Eseguire il backup e il ripristino manualmente.</span><span class="sxs-lookup"><span data-stu-id="c1818-176">Do it yourself (DIY).</span></span> <span data-ttu-id="c1818-177">Dopo avere calcolato tooensure spazio su disco sufficiente, eseguire backup completi di database e del log tramite i metodi di backup su disco (toothose dischi).</span><span class="sxs-lookup"><span data-stu-id="c1818-177">After you calculate tooensure enough disk space, perform full database and log backups by using disk backup methods (toothose disks).</span></span> <span data-ttu-id="c1818-178">Nel corso del tempo, hello backup vengono copiati tooan account di archiviazione di Azure (dopo aver configurato un server di file basati su Azure con archiviazione virtualmente illimitata) o usare un insieme di credenziali di Azure Backup o archiviazione di Azure ignoto.</span><span class="sxs-lookup"><span data-stu-id="c1818-178">Over time, hello backups are copied tooan Azure storage account (after you set up an Azure-based file server with virtually unlimited storage), or use an Azure Backup vault or Azure cold storage.</span></span> <span data-ttu-id="c1818-179">Un'altra opzione è toouse uno strumento di protezione dati di terze parti, ad esempio Commvault, i backup di hello toostore dopo che sono copiati tooa account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="c1818-179">Another option is toouse a third-party data protection tool, such as Commvault, toostore hello backups after they are copied tooa storage account.</span></span> <span data-ttu-id="c1818-180">Hello DIY opzione di backup può essere necessario per i dati che devono essere archiviati per periodi più lunghi per scopi di controllo di conformità e toobe.</span><span class="sxs-lookup"><span data-stu-id="c1818-180">hello DIY backup option might also be necessary for data that needs toobe stored for longer periods for compliancy and auditing purposes.</span></span>
- <span data-ttu-id="c1818-181">Utilizzare hello di backup e ripristino delle funzionalità che hello infrastruttura sottostante di SAP HANA in Azure (istanze di grandi dimensioni) fornisce.</span><span class="sxs-lookup"><span data-stu-id="c1818-181">Use hello backup and restore functionality that hello underlying infrastructure of SAP HANA on Azure (large instances) provides.</span></span> <span data-ttu-id="c1818-182">Questa opzione soddisfa hello necessario per i backup e rende backup manuali quasi obsoleta (eccetto in cui sono necessari per motivi di conformità i backup di dati).</span><span class="sxs-lookup"><span data-stu-id="c1818-182">This option fulfills hello need for backups, and it makes manual backups nearly obsolete (except where data backups are required for compliance purposes).</span></span> <span data-ttu-id="c1818-183">rest Hello di indirizzi di questa sezione hello backup e ripristino delle funzionalità offerte con HANA (istanze di grandi dimensioni).</span><span class="sxs-lookup"><span data-stu-id="c1818-183">hello rest of this section addresses hello backup and restore functionality that's offered with HANA (large instances).</span></span>

> [!NOTE]
> <span data-ttu-id="c1818-184">tecnologia di snapshot Hello utilizzata dall'infrastruttura sottostante di hello di HANA (istanze di grandi dimensioni) presenta una dipendenza per gli snapshot di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="c1818-184">hello snapshot technology that is used by hello underlying infrastructure of HANA (large instances) has a dependency on SAP HANA snapshots.</span></span> <span data-ttu-id="c1818-185">Gli snapshot di SAP HANA non funzionano in combinazione con i contenitori di database multi-tenant SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="c1818-185">SAP HANA snapshots do not work in conjunction with SAP HANA Multitenant Database Containers.</span></span> <span data-ttu-id="c1818-186">Di conseguenza, questo metodo di backup non può essere utilizzato toodeploy SAP HANA Multitenant Database contenitori.</span><span class="sxs-lookup"><span data-stu-id="c1818-186">As a result, this method of backup cannot be used toodeploy SAP HANA Multitenant Database Containers.</span></span>

### <a name="using-storage-snapshots-of-sap-hana-on-azure-large-instances"></a><span data-ttu-id="c1818-187">Uso degli snapshot di archiviazione di SAP HANA in Azure (istanze di grandi dimensioni)</span><span class="sxs-lookup"><span data-stu-id="c1818-187">Using storage snapshots of SAP HANA on Azure (large instances)</span></span>

<span data-ttu-id="c1818-188">infrastruttura di archiviazione Hello sottostante SAP HANA in Azure (istanze di grandi dimensioni) supporta la nozione di hello di uno snapshot di archiviazione dei volumi.</span><span class="sxs-lookup"><span data-stu-id="c1818-188">hello storage infrastructure underlying SAP HANA on Azure (large instances) supports hello notion of a storage snapshot of volumes.</span></span> <span data-ttu-id="c1818-189">Backup e ripristino di un determinato volume sono supportate con hello seguenti considerazioni:</span><span class="sxs-lookup"><span data-stu-id="c1818-189">Both backup and restoration of a particular volume are supported, with hello following considerations:</span></span>

- <span data-ttu-id="c1818-190">In alternativa ai backup del database, vengono creati regolarmente snapshot di archiviazione dei volumi.</span><span class="sxs-lookup"><span data-stu-id="c1818-190">Instead of database backups, storage volume snapshots are taken on a frequent basis.</span></span>
- <span data-ttu-id="c1818-191">snapshot di archiviazione Hello avvia uno snapshot di SAP HANA prima dell'esecuzione di snapshot di archiviazione hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-191">hello storage snapshot initiates an SAP HANA snapshot before it executes hello storage snapshot.</span></span> <span data-ttu-id="c1818-192">Lo snapshot di SAP HANA è il punto di installazione hello per ripristini di log finale dopo il ripristino dello snapshot di archiviazione hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-192">This SAP HANA snapshot is hello setup point for eventual log restorations after recovery of hello storage snapshot.</span></span>
- <span data-ttu-id="c1818-193">A un punto in cui viene eseguito correttamente snapshot archiviazione hello hello snapshot di SAP HANA hello viene eliminato.</span><span class="sxs-lookup"><span data-stu-id="c1818-193">At hello point where hello storage snapshot is executed successfully, hello SAP HANA snapshot is deleted.</span></span>
- <span data-ttu-id="c1818-194">Backup del log vengono creati di frequente e archiviati nel volume di backup di log hello o in Azure.</span><span class="sxs-lookup"><span data-stu-id="c1818-194">Log backups are taken frequently and stored in hello log backup volume or in Azure.</span></span>
- <span data-ttu-id="c1818-195">Se è necessario ripristinare il database di hello tooa determinato punto nel tempo, viene effettuata una richiesta tooMicrosoft supporto tecnico di Azure (interruzione produzione) o SAP HANA in Gestione servizi di Azure toorestore tooa alcuni snapshot di archiviazione (ad esempio, un pianificato ripristino di un sistema sandbox tooits lo stato originale).</span><span class="sxs-lookup"><span data-stu-id="c1818-195">If hello database must be restored tooa certain point in time, a request is made tooMicrosoft Azure Support (production outage) or SAP HANA on Azure Service Management toorestore tooa certain storage snapshot (for example, a planned restoration of a sandbox system tooits original state).</span></span>
- <span data-ttu-id="c1818-196">snapshot di SAP HANA Hello che è incluso nello snapshot di archiviazione hello è un punto di offset per l'applicazione di backup del log che sono state eseguite e archiviato dopo hello archiviazione dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="c1818-196">hello SAP HANA snapshot that's included in hello storage snapshot is an offset point for applying log backups that have been executed and stored after hello storage snapshot was taken.</span></span>
- <span data-ttu-id="c1818-197">Questi backup del log toorestore hello database back-tooa determinato punto nel tempo.</span><span class="sxs-lookup"><span data-stu-id="c1818-197">These log backups are taken toorestore hello database back tooa certain point in time.</span></span>

<span data-ttu-id="c1818-198">Backup hello specificando\_nome crea uno snapshot di hello seguenti volumi:</span><span class="sxs-lookup"><span data-stu-id="c1818-198">Specifying hello backup\_name creates a snapshot of hello following volumes:</span></span>

- <span data-ttu-id="c1818-199">hana/data</span><span class="sxs-lookup"><span data-stu-id="c1818-199">hana/data</span></span>
- <span data-ttu-id="c1818-200">hana/log</span><span class="sxs-lookup"><span data-stu-id="c1818-200">hana/log</span></span>
- <span data-ttu-id="c1818-201">hana/log\_backup (montato come backup in hana/log)</span><span class="sxs-lookup"><span data-stu-id="c1818-201">hana/log\_backup (mounted as backup into hana/log)</span></span>
- <span data-ttu-id="c1818-202">hana/shared</span><span class="sxs-lookup"><span data-stu-id="c1818-202">hana/shared</span></span>

### <a name="storage-snapshot-considerations"></a><span data-ttu-id="c1818-203">Considerazioni sugli snapshot di archiviazione</span><span class="sxs-lookup"><span data-stu-id="c1818-203">Storage snapshot considerations</span></span>

>[!NOTE]
><span data-ttu-id="c1818-204">Gli snapshot di archiviazione _non_ vengono forniti gratuitamente perché richiedono l'allocazione di spazio di archiviazione aggiuntivo.</span><span class="sxs-lookup"><span data-stu-id="c1818-204">Storage snapshots are _not_ provided free of charge, because additional storage space must be allocated.</span></span>

<span data-ttu-id="c1818-205">meccanismo specifico di Hello di snapshot di archiviazione per SAP HANA in Azure (istanze di grandi dimensioni) include:</span><span class="sxs-lookup"><span data-stu-id="c1818-205">hello specific mechanics of storage snapshots for SAP HANA on Azure (large instances) include:</span></span>

- <span data-ttu-id="c1818-206">Uno snapshot di archiviazione specifico (in hello momento quando questa viene eliminata) utilizza molto spazio di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="c1818-206">A specific storage snapshot (at hello point in time when it is taken) consumes very little storage.</span></span>
- <span data-ttu-id="c1818-207">Modifiche del contenuto dei dati e il contenuto di hello nei dati di SAP HANA cambiano i file nel volume di archiviazione hello, snapshot hello deve toostore hello originale bloccare i contenuti.</span><span class="sxs-lookup"><span data-stu-id="c1818-207">As data content changes and hello content in SAP HANA data files change on hello storage volume, hello snapshot needs toostore hello original block content.</span></span>
- <span data-ttu-id="c1818-208">snapshot di archiviazione Hello aumenta le dimensioni.</span><span class="sxs-lookup"><span data-stu-id="c1818-208">hello storage snapshot increases in size.</span></span> <span data-ttu-id="c1818-209">snapshot hello più Hello esiste, hello maggiore hello archiviazione snapshot diventa.</span><span class="sxs-lookup"><span data-stu-id="c1818-209">hello longer hello snapshot exists, hello larger hello storage snapshot becomes.</span></span>
- <span data-ttu-id="c1818-210">Hello altre modifiche apportate toohello volume del database SAP HANA nel corso della durata hello di uno snapshot di archiviazione, diventa hello maggiore hello sull'utilizzo di spazio di snapshot di archiviazione hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-210">hello more changes made toohello SAP HANA database volume over hello lifetime of a storage snapshot, hello larger hello space consumption of hello storage snapshot becomes.</span></span>

<span data-ttu-id="c1818-211">SAP HANA in Azure (istanze di grandi dimensioni) viene fornito con le dimensioni di un volume fisso per il volume di dati e di log di SAP HANA hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-211">SAP HANA on Azure (large instances) comes with fixed volume sizes for hello SAP HANA data and log volume.</span></span> <span data-ttu-id="c1818-212">Esecuzione di snapshot dei volumi mostro nello spazio nel volume, pertanto gli snapshot di archiviazione responsabilità tooschedule (all'interno di hello SAP HANA sul processo di Azure [istanze di grandi dimensioni]).</span><span class="sxs-lookup"><span data-stu-id="c1818-212">Performing snapshots of those volumes eats into your volume space, so it is your responsibility tooschedule storage snapshots (within hello SAP HANA on Azure [large instances] process).</span></span>

<span data-ttu-id="c1818-213">Hello nelle sezioni seguenti vengono forniscono informazioni per l'esecuzione di questi snapshot, inclusi i consigli generali:</span><span class="sxs-lookup"><span data-stu-id="c1818-213">hello following sections provide information for performing these snapshots, including general recommendations:</span></span>

- <span data-ttu-id="c1818-214">Se l'hardware hello in grado di sostenere 255 snapshot per ogni volume, si consiglia di restare ben di sotto di questo numero.</span><span class="sxs-lookup"><span data-stu-id="c1818-214">Though hello hardware can sustain 255 snapshots per volume, we highly recommend that you stay well below this number.</span></span>
- <span data-ttu-id="c1818-215">Prima di eseguire snapshot di archiviazione, monitorare e tenere traccia dello spazio libero.</span><span class="sxs-lookup"><span data-stu-id="c1818-215">Before you perform storage snapshots, monitor and keep track of free space.</span></span>
- <span data-ttu-id="c1818-216">Numero inferiore di hello di snapshot di archiviazione in base allo spazio libero.</span><span class="sxs-lookup"><span data-stu-id="c1818-216">Lower hello number of storage snapshots based on free space.</span></span> <span data-ttu-id="c1818-217">Potrebbe essere necessario numero hello toolower di snapshot da mantenere oppure potrebbe essere necessario volumi hello tooextend.</span><span class="sxs-lookup"><span data-stu-id="c1818-217">You might need toolower hello number of snapshots that you keep, or you might need tooextend hello volumes.</span></span> <span data-ttu-id="c1818-218">È possibile ordinare ulteriore spazio di archiviazione in unità di 1 TB.</span><span class="sxs-lookup"><span data-stu-id="c1818-218">(You can order additional storage in 1-TB units.)</span></span>
- <span data-ttu-id="c1818-219">Durante determinate attività, come lo spostamento di dati in SAP HANA con strumenti di migrazione del sistema (R3load o la funzionalità per il ripristino di backup di database SAP HANA), è consigliabile non creare snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="c1818-219">During activities such as moving data into SAP HANA with system migration tools (with R3load, or by restoring SAP HANA databases from backups), we highly recommended that you not perform any storage snapshots.</span></span> <span data-ttu-id="c1818-220">(Se viene eseguita la migrazione di un sistema in un nuovo sistema SAP HANA, gli snapshot di archiviazione non è necessario eseguire toobe.)</span><span class="sxs-lookup"><span data-stu-id="c1818-220">(If a system migration is being done on a new SAP HANA system, storage snapshots would not need toobe performed.)</span></span>
- <span data-ttu-id="c1818-221">Durante una riorganizzazione più estesa delle tabelle di SAP HANA, evitare di creare snapshot di archiviazione, se possibile.</span><span class="sxs-lookup"><span data-stu-id="c1818-221">During larger reorganizations of SAP HANA tables, storage snapshots should be avoided if possible.</span></span>
- <span data-ttu-id="c1818-222">Gli snapshot di archiviazione sono una funzionalità di ripristino di emergenza hello tooengaging dei prerequisiti di SAP HANA in Azure (istanze di grandi dimensioni).</span><span class="sxs-lookup"><span data-stu-id="c1818-222">Storage snapshots are a prerequisite tooengaging hello disaster-recovery capabilities of SAP HANA on Azure (large instances).</span></span>

### <a name="setting-up-storage-snapshots"></a><span data-ttu-id="c1818-223">Configurazione degli snapshot di archiviazione</span><span class="sxs-lookup"><span data-stu-id="c1818-223">Setting up storage snapshots</span></span>

1. <span data-ttu-id="c1818-224">Assicurarsi che Perl sia installato nel sistema operativo Linux di hello server hello HANA (istanze di grandi dimensioni).</span><span class="sxs-lookup"><span data-stu-id="c1818-224">Make sure that Perl is installed in hello Linux operating system on hello HANA (large instances) server.</span></span>
2. <span data-ttu-id="c1818-225">Modificare/e così via ssh/ssh\_riga hello di configurazione tooadd _Mac hmac-sha1_.</span><span class="sxs-lookup"><span data-stu-id="c1818-225">Modify /etc/ssh/ssh\_config tooadd hello line _MACs hmac-sha1_.</span></span>
3. <span data-ttu-id="c1818-226">Creare un account utente per il backup di SAP HANA sul nodo principale di hello per ogni istanza di SAP HANA che eseguono (se applicabile).</span><span class="sxs-lookup"><span data-stu-id="c1818-226">Create an SAP HANA backup user account on hello master node for each SAP HANA instance you are running (if applicable).</span></span>
4. <span data-ttu-id="c1818-227">il client di SAP HANA HDB Hello deve essere installato in tutti i server (istanze di grandi dimensioni) di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="c1818-227">hello SAP HANA HDB client must be installed on all SAP HANA (large instances) servers.</span></span>
5. <span data-ttu-id="c1818-228">Server hello prima SAP HANA (istanze di grandi dimensioni) di ogni area, una chiave pubblica è necessario creare hello tooaccess sottostante l'infrastruttura di archiviazione che controlla la creazione di snapshot.</span><span class="sxs-lookup"><span data-stu-id="c1818-228">On hello first SAP HANA (large instances) server of each region, a public key must be created tooaccess hello underlying storage infrastructure that controls snapshot creation.</span></span>
6. <span data-ttu-id="c1818-229">Copiare script hello azure\_hana\_backup.pl dal percorso toohello /script di **hdbsql** di installazione di SAP HANA hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-229">Copy hello script azure\_hana\_backup.pl from /scripts toohello location of **hdbsql** of hello SAP HANA installation.</span></span>
7. <span data-ttu-id="c1818-230">Hello copia HANABackupDetails.txt file toohello /script stesso percorso come hello script Perl.</span><span class="sxs-lookup"><span data-stu-id="c1818-230">Copy hello HANABackupDetails.txt file from /scripts toohello same location as hello Perl script.</span></span>
8. <span data-ttu-id="c1818-231">Modificare il file HANABackupDetails.txt hello necessarie per le specifiche del cliente appropriato hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-231">Modify hello HANABackupDetails.txt file as necessary for hello appropriate customer specifications.</span></span>

### <a name="step-1-install-sap-hana-hdbclient"></a><span data-ttu-id="c1818-232">Passaggio 1: Installare il client HBD di SAP HANA</span><span class="sxs-lookup"><span data-stu-id="c1818-232">Step 1: Install SAP HANA HDBClient</span></span>

<span data-ttu-id="c1818-233">Hello Linux installato in SAP HANA in Azure (istanze di grandi dimensioni) include cartelle hello e script di snapshot di archiviazione di SAP HANA tooexecute necessario per scopi di backup e ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="c1818-233">hello Linux installed on SAP HANA on Azure (large instances) includes hello folders and scripts necessary tooexecute SAP HANA storage snapshots for backup and disaster-recovery purposes.</span></span> <span data-ttu-id="c1818-234">Tuttavia, è il tooinstall responsabilità SAP HANA HDBclient durante l'installazione di SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="c1818-234">However, it is your responsibility tooinstall SAP HANA HDBclient while you are installing SAP HANA.</span></span> <span data-ttu-id="c1818-235">(Microsoft installa hello HDBclient né SAP HANA).</span><span class="sxs-lookup"><span data-stu-id="c1818-235">(Microsoft installs neither hello HDBclient nor SAP HANA.)</span></span>

### <a name="step-2-change-etcsshsshconfig"></a><span data-ttu-id="c1818-236">Passaggio 2: Modificare /etc/ssh/ssh\_config</span><span class="sxs-lookup"><span data-stu-id="c1818-236">Step 2: Change /etc/ssh/ssh\_config</span></span>

<span data-ttu-id="c1818-237">Modificare /etc/ssh/ssh\_config aggiungendo la riga _MACs hmac-sha1_ come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="c1818-237">Change /etc/ssh/ssh\_config by adding _MACs hmac-sha1_ line as shown here:</span></span>
```
#   RhostsRSAAuthentication no
#   RSAAuthentication yes
#   PasswordAuthentication yes
#   HostbasedAuthentication no
#   GSSAPIAuthentication no
#   GSSAPIDelegateCredentials no
#   GSSAPIKeyExchange no
#   GSSAPITrustDNS no
#   BatchMode no
#   CheckHostIP yes
#   AddressFamily any
#   ConnectTimeout 0
#   StrictHostKeyChecking ask
#   IdentityFile ~/.ssh/identity
#   IdentityFile ~/.ssh/id_rsa
#   IdentityFile ~/.ssh/id_dsa
#   Port 22
Protocol 2
#   Cipher 3des
#   Ciphers aes128-ctr,aes192-ctr,aes256-ctr,arcfour256,arcfour128,aes128-cbc,3des-cbc
#   MACs hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160
MACs hmac-sha1
#   EscapeChar ~
#   Tunnel no
#   TunnelDevice any:any
#   PermitLocalCommand no
#   VisualHostKey no
#   ProxyCommand ssh -q -W %h:%p gateway.example.com
```

### <a name="step-3-create-a-public-key"></a><span data-ttu-id="c1818-238">Passaggio 3: Creare una chiave pubblica</span><span class="sxs-lookup"><span data-stu-id="c1818-238">Step 3: Create a public key</span></span>

<span data-ttu-id="c1818-239">In hello prima SAP HANA nel server di Azure (istanze di grandi dimensioni) in ogni area di Azure, creare un'infrastruttura di archiviazione hello tooaccess toobe di chiave pubblica utilizzata in modo che è possibile creare snapshot.</span><span class="sxs-lookup"><span data-stu-id="c1818-239">On hello first SAP HANA on Azure (large instances) server in each Azure region, create a public key toobe used tooaccess hello storage infrastructure so that you can create snapshots.</span></span> <span data-ttu-id="c1818-240">la chiave pubblica di Hello garantisce che una password non è necessario toosign nel servizio di archiviazione toohello e che le credenziali di password non vengono mantenute.</span><span class="sxs-lookup"><span data-stu-id="c1818-240">hello public key ensures that a password is not required toosign in toohello storage and that password credentials are not maintained.</span></span> <span data-ttu-id="c1818-241">In Linux nel server di hello SAP HANA (istanze di grandi dimensioni), eseguire hello chiave pubblica hello toogenerate di comando seguente:</span><span class="sxs-lookup"><span data-stu-id="c1818-241">In Linux on hello SAP HANA (large instances) server, execute hello following command toogenerate hello public key:</span></span>
```
  ssh-keygen –t dsa –b 1024
```
<span data-ttu-id="c1818-242">nuova posizione Hello è _/root/.ssh/id\_dsa.pub.</span><span class="sxs-lookup"><span data-stu-id="c1818-242">hello new location is _/root/.ssh/id\_dsa.pub.</span></span> <span data-ttu-id="c1818-243">Non immettere una passphrase effettiva, altrimenti sarà necessario tooenter hello passphrase ogni volta che accedi.</span><span class="sxs-lookup"><span data-stu-id="c1818-243">Do not enter an actual passphrase, or else you will be required tooenter hello passphrase each time you sign in.</span></span> <span data-ttu-id="c1818-244">In alternativa, premere **invio** due volte tooremove hello immettere passphrase requisito per l'accesso.</span><span class="sxs-lookup"><span data-stu-id="c1818-244">Instead, press **Enter** twice tooremove hello enter passphrase requirement for signing in.</span></span>

<span data-ttu-id="c1818-245">Verificare che la chiave pubblica hello è stato corretto come previsto modificando too/root/.ssh/ cartelle e quindi eseguendo hello toomake **ls** comando.</span><span class="sxs-lookup"><span data-stu-id="c1818-245">Check toomake sure that hello public key was corrected as expected by changing folders too/root/.ssh/ and then executing hello **ls** command.</span></span> <span data-ttu-id="c1818-246">Se hello chiave è presente, è possibile copiarlo eseguendo hello comando seguente:</span><span class="sxs-lookup"><span data-stu-id="c1818-246">If hello key is present, you can copy it by running hello following command:</span></span>

![La chiave pubblica viene copiata eseguendo questo comando](./media/hana-overview-high-availability-disaster-recovery/image2-public-key.png)

<span data-ttu-id="c1818-248">A questo punto, contattare SAP HANA sulla gestione dei servizi di Azure e fornire hello chiave.</span><span class="sxs-lookup"><span data-stu-id="c1818-248">At this point, contact SAP HANA on Azure Service Management and provide hello key.</span></span> <span data-ttu-id="c1818-249">addetto al servizio Hello utilizza hello tooregister di chiave pubblica in hello sottostante l'infrastruttura di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="c1818-249">hello service representative uses hello public key tooregister it in hello underlying storage infrastructure.</span></span>

### <a name="step-4-create-an-sap-hana-user-account"></a><span data-ttu-id="c1818-250">Passaggio 4: Creare un account utente SAP HANA</span><span class="sxs-lookup"><span data-stu-id="c1818-250">Step 4: Create an SAP HANA user account</span></span>

<span data-ttu-id="c1818-251">In SAP HANA Studio creare un account utente SAP HANA a scopo di backup.</span><span class="sxs-lookup"><span data-stu-id="c1818-251">Create an SAP HANA user account within SAP HANA Studio for backup purposes.</span></span> <span data-ttu-id="c1818-252">Questo account deve disporre di hello seguenti privilegi: _Backup Admin_ e _lettura catalogo_.</span><span class="sxs-lookup"><span data-stu-id="c1818-252">This account must have hello following privileges: _Backup Admin_ and _Catalog Read_.</span></span> <span data-ttu-id="c1818-253">In questo esempio, il nome utente hello SCADMIN viene creato.</span><span class="sxs-lookup"><span data-stu-id="c1818-253">In this example, hello username SCADMIN is created.</span></span>

![Creazione di un utente in HANA Studio](./media/hana-overview-high-availability-disaster-recovery/image3-creating-user.png)

### <a name="step-5-authorize-hello-sap-hana-user-account"></a><span data-ttu-id="c1818-255">Passaggio 5: Autorizzare l'account utente di SAP HANA hello</span><span class="sxs-lookup"><span data-stu-id="c1818-255">Step 5: Authorize hello SAP HANA user account</span></span>

<span data-ttu-id="c1818-256">Autorizzare l'account utente di SAP HANA hello (toobe usati da script hello senza richiedere l'autorizzazione ogni volta che viene eseguito uno script hello).</span><span class="sxs-lookup"><span data-stu-id="c1818-256">Authorize hello SAP HANA user account (toobe used by hello scripts without requiring authorization every time hello script is run).</span></span> <span data-ttu-id="c1818-257">comando SAP HANA Hello `hdbuserstore` consente di creare una chiave utente SAP HANA, che viene archiviata in uno o più nodi di SAP HANA hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-257">hello SAP HANA command `hdbuserstore` allows hello creation of an SAP HANA user key, which is stored on one or more SAP HANA nodes.</span></span> <span data-ttu-id="c1818-258">chiave utente Hello consente inoltre di hello utente tooaccess SAP HANA senza password toomanage da all'interno di hello scripting processo che si parlerà più avanti.</span><span class="sxs-lookup"><span data-stu-id="c1818-258">hello user key also allows hello user tooaccess SAP HANA without having toomanage passwords from within hello scripting process that's discussed later.</span></span>

>[!IMPORTANT]
><span data-ttu-id="c1818-259">Esecuzione hello il seguente comando come `_root_`.</span><span class="sxs-lookup"><span data-stu-id="c1818-259">Run hello following command as `_root_`.</span></span> <span data-ttu-id="c1818-260">In caso contrario, script hello non può funzionare correttamente.</span><span class="sxs-lookup"><span data-stu-id="c1818-260">Otherwise, hello script cannot work properly.</span></span>

<span data-ttu-id="c1818-261">Immettere hello `hdbuserstore` comando come segue:</span><span class="sxs-lookup"><span data-stu-id="c1818-261">Enter hello `hdbuserstore` command as follows:</span></span>

![Immettere il comando di hdbuserstore hello](./media/hana-overview-high-availability-disaster-recovery/image4-hdbuserstore-command.png)

<span data-ttu-id="c1818-263">Nel seguente esempio, in cui utente hello è SCADMIN01 e il nome host hello è lhanad01, hello hello è:</span><span class="sxs-lookup"><span data-stu-id="c1818-263">In hello following example, where hello user is SCADMIN01 and hello hostname is lhanad01, hello command is:</span></span>
```
hdbuserstore set SCADMIN01 lhanad01:30115 <backup username> <password>
```
<span data-ttu-id="c1818-264">Gestire tutti gli script da un singolo server per le istanze HANA con scalabilità orizzontale.</span><span class="sxs-lookup"><span data-stu-id="c1818-264">Manage all scripting from a single server for scale-out HANA instances.</span></span> <span data-ttu-id="c1818-265">In questo esempio hello chiave SAP HANA che scadmin01 deve essere modificata per ogni host in modo che rifletta l'host di hello chiave toohello correlati.</span><span class="sxs-lookup"><span data-stu-id="c1818-265">In this example, hello SAP HANA key SCADMIN01 must be altered for each host in a way that reflects hello host that is related toohello key.</span></span> <span data-ttu-id="c1818-266">Vale a dire, account di SAP HANA backup hello è modificato con numero di istanza hello di hello HANA DB, **lhanad**.</span><span class="sxs-lookup"><span data-stu-id="c1818-266">That is, hello SAP HANA backup account is amended with hello instance number of hello HANA DB, **lhanad**.</span></span> <span data-ttu-id="c1818-267">chiave Hello deve avere privilegi amministrativi nell'host di hello a che viene assegnato, e utente di backup di hello per scalabilità orizzontale deve disporre di istanze SAP HANA tooall diritti di accesso.</span><span class="sxs-lookup"><span data-stu-id="c1818-267">hello key must have administrative privileges on hello host it is assigned to, and hello backup user for scale-out must have access rights tooall SAP HANA instances.</span></span>
```
hdbuserstore set SCADMIN01 lhanad:30015 SCADMIN <password>
hdbuserstore set SCADMIN02 lhanad:30115 SCADMIN <password>
hdbuserstore set SCADMIN03 lhanad:30215 SCADMIN <password>
```

### <a name="step-6-copy-items-from-hello-scripts-folder"></a><span data-ttu-id="c1818-268">Passaggio 6: Copiare gli elementi dalla cartella /script hello</span><span class="sxs-lookup"><span data-stu-id="c1818-268">Step 6: Copy items from hello /scripts folder</span></span>

<span data-ttu-id="c1818-269">Esempio hello copia gli elementi da hello/script directory di lavoro toohello cartella (incluso nell'immagine gold hello dell'installazione di hello) per **hdbsql**.</span><span class="sxs-lookup"><span data-stu-id="c1818-269">Copy hello following items from hello /scripts folder (included on hello gold image of hello installation) toohello working directory for **hdbsql**.</span></span> <span data-ttu-id="c1818-270">Per le installazioni correnti di HANA, la directory è /hana/shared/D01/exe/linuxx86\_64/hdb.</span><span class="sxs-lookup"><span data-stu-id="c1818-270">For current HANA installations, this directory is /hana/shared/D01/exe/linuxx86\_64/hdb.</span></span>
```
azure\_hana\_backup.pl
testHANAConnection.pl
testStorageSnapshotConnection.pl
removeTestStorageSnapshot.pl
HANABackupCustomerDetails.txt
```
<span data-ttu-id="c1818-271">Copiare i seguenti elementi se sono in esecuzione di scalabilità orizzontale hello o OLAP:</span><span class="sxs-lookup"><span data-stu-id="c1818-271">Copy hello following items if they are running scale-out or OLAP:</span></span>
```
azure\_hana\_backup\_bw.pl
testHANAConnectionBW.pl
testStorageSnapshotConnectionBW.pl
removeTestStorageSnapshotBW.pl
HANABackupCustomerDetailsBW.txt
```
<span data-ttu-id="c1818-272">file HANABackupCustomerDetails.txt Hello è modificabile come indicato di seguito per una distribuzione con scalabilità verticale.</span><span class="sxs-lookup"><span data-stu-id="c1818-272">hello HANABackupCustomerDetails.txt file is modifiable as follows for a scale-up deployment.</span></span> <span data-ttu-id="c1818-273">Si tratta di file di configurazione e controllo hello per hello dello script eseguito snapshot di archiviazione hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-273">It is hello control and configuration file for hello script that runs hello storage snapshots.</span></span> <span data-ttu-id="c1818-274">Si dovrebbe avere ricevuto hello _nome del Backup di archiviazione_ e _l'indirizzo IP di archiviazione_ da SAP HANA sulla gestione dei servizi di Azure quando le istanze sono state distribuite.</span><span class="sxs-lookup"><span data-stu-id="c1818-274">You should have received hello _Storage Backup Name_ and _Storage IP Address_ from SAP HANA on Azure Service Management when your instances were deployed.</span></span> <span data-ttu-id="c1818-275">Non è possibile modificare la sequenza di hello, ordinamento o la spaziatura delle variabili di hello o hello script non viene eseguita correttamente.</span><span class="sxs-lookup"><span data-stu-id="c1818-275">You cannot modify hello sequence, ordering, or spacing of any of hello variables, or hello script does not run properly.</span></span>

<span data-ttu-id="c1818-276">Per una distribuzione con scalabilità verticale, i file di configurazione hello deve essere simile:</span><span class="sxs-lookup"><span data-stu-id="c1818-276">For a scale-up deployment, hello configuration file would look like:</span></span>
```
#Provided by Microsoft Service Management
Storage Backup Name: lhanad01backup
Storage IP Address: 10.250.20.21
#Created by customer using hdbuserstore
HANA Backup Name: SCADMIND01
```
<span data-ttu-id="c1818-277">Per una configurazione con scalabilità orizzontale, file di HANABackupCustomerDetailsBW.txt hello deve essere simile:</span><span class="sxs-lookup"><span data-stu-id="c1818-277">For a scale-out configuration, hello HANABackupCustomerDetailsBW.txt file would look like:</span></span>
```
#Provided by Microsoft Service Management
Storage Backup Name: lhanad01backup
Storage IP Address: 10.250.20.21
#Node IP addresses, instance numbers, and HANA backup name
#provided by customer.  HANA backup name created using
#hdbuserstore utility.
Node 1 IP Address: 10.254.15.21
Node 1 HANA instance number: 01
Node 1 HANA Backup Name: SCADMIN01
Node 2 IP Address: 10.254.15.22
Node 2 HANA instance number: 02
Node 2 HANA Backup Name: SCADMIN02
Node 3 IP Address: 10.254.15.23
Node 3 HANA instance number: 03
Node 3 HANA Backup Name: SCADMIN03
Node 4 IP Address: 10.254.15.24
Node 4 HANA instance number: 04
Node 4 HANA Backup Name: SCADMIN04
Node 5 IP Address: 10.254.15.25
Node 5 HANA instance number: 05
Node 5 HANA Backup Name: SCADMIN05
Node 6 IP Address: 10.254.15.26
Node 6 HANA instance number: 06
Node 6 HANA Backup Name: SCADMIN06
Node 7 IP Address: 10.254.15.27
Node 7 HANA instance number: 07
Node 7 HANA Backup Name: SCADMIN07
Node 8 IP Address: 10.254.15.28
Node 8 HANA instance number: 08
Node 8 HANA Backup Name: SCADMIN08
```
>[!NOTE]
><span data-ttu-id="c1818-278">Attualmente, solo il nodo 1 dettagli vengono utilizzati in script hello effettivo HANA archiviazione dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="c1818-278">Currently, only Node 1 details are used in hello actual HANA storage snapshot script.</span></span> <span data-ttu-id="c1818-279">È consigliabile testare tooor di accesso da tutti i nodi HANA in modo che, se il nodo di backup master di hello dovesse cambia, aver già verificato che un altro nodo può richiedere al suo posto modificando i dettagli di hello nel nodo 1.</span><span class="sxs-lookup"><span data-stu-id="c1818-279">We recommend that you test access tooor from all HANA nodes so that, if hello master backup node ever changes, you have already ensured that any other node can take its place by modifying hello details in Node 1.</span></span>

<span data-ttu-id="c1818-280">toocheck per le configurazioni di hello corretto nel file di configurazione hello o istanze HANA toohello connettività appropriato, eseguire uno dei seguenti script hello:</span><span class="sxs-lookup"><span data-stu-id="c1818-280">toocheck for hello correct configurations in hello configuration file or proper connectivity toohello HANA instances, run either of hello following scripts:</span></span>
- <span data-ttu-id="c1818-281">Per una configurazione con scalabilità verticale (indipendente dal carico di lavoro SAP):</span><span class="sxs-lookup"><span data-stu-id="c1818-281">For a scale-up configuration (independent on SAP workload):</span></span>

 ```
testHANAConnection.pl
```
- <span data-ttu-id="c1818-282">Per una configurazioni con scalabilità orizzontale:</span><span class="sxs-lookup"><span data-stu-id="c1818-282">For a scale-out configuration:</span></span>

 ```
testHANAConnectionBW.pl
```

<span data-ttu-id="c1818-283">Assicurarsi di che quell'istanza HANA master hello dispone di server di accesso richiesto tooall HANA.</span><span class="sxs-lookup"><span data-stu-id="c1818-283">Ensure that hello master HANA instance has access tooall required HANA servers.</span></span> <span data-ttu-id="c1818-284">Sono disponibili non sono presenti script toohello parametri, ma è necessario completare hello appropriato HANABackupCustomerDetails HANABackupCustomerDetailsBW file per hello script toorun correttamente.</span><span class="sxs-lookup"><span data-stu-id="c1818-284">There are no parameters toohello script, but you must complete hello appropriate HANABackupCustomerDetails/ HANABackupCustomerDetailsBW file for hello script toorun properly.</span></span> <span data-ttu-id="c1818-285">Poiché vengono restituiti codici di errore solo hello shell comandi, non è possibile per hello script tooerror controllare ogni istanza.</span><span class="sxs-lookup"><span data-stu-id="c1818-285">Because only hello shell command error codes are returned, it is not possible for hello script tooerror-check every instance.</span></span> <span data-ttu-id="c1818-286">Anche in questo caso, script hello fornire alcuni commenti utili per si toodouble un controllo.</span><span class="sxs-lookup"><span data-stu-id="c1818-286">Even so, hello script does provide some helpful comments for you toodouble-check.</span></span>

<span data-ttu-id="c1818-287">script di hello toorun:</span><span class="sxs-lookup"><span data-stu-id="c1818-287">toorun hello script:</span></span>
```
 ./testHANAConnection.pl
```
 <span data-ttu-id="c1818-288">Se lo script hello Ottiene correttamente la stato hello dell'istanza HANA hello, viene visualizzato un messaggio che connessione HANA hello ha avuto esito positivo.</span><span class="sxs-lookup"><span data-stu-id="c1818-288">If hello script successfully obtains hello status of hello HANA instance, it displays a message that hello HANA connection was successful.</span></span>

<span data-ttu-id="c1818-289">È disponibile anche un secondo tipo di script è possibile utilizzare toosign possibilità toocheck hello HANA istanza del server master in archiviazione toohello.</span><span class="sxs-lookup"><span data-stu-id="c1818-289">Additionally, there is a second type of script you can use toocheck hello master HANA instance server's ability toosign in toohello storage.</span></span> <span data-ttu-id="c1818-290">Prima di eseguire azure hello\_hana\_backup (\_bw) PL script, è necessario eseguire script successivo hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-290">Before you execute hello azure\_hana\_backup(\_bw).pl script, you must execute hello next script.</span></span> <span data-ttu-id="c1818-291">Se un volume contiene Nessuno snapshot, è Impossibile toodetermine volume hello è semplicemente vuoto o non esiste un ssh hello tooobtain errore dettagli dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="c1818-291">If a volume contains no snapshots, it is impossible toodetermine whether hello volume is simply empty or there is an ssh failure tooobtain hello snapshot details.</span></span> <span data-ttu-id="c1818-292">Per questo motivo, script hello esegue due passaggi:</span><span class="sxs-lookup"><span data-stu-id="c1818-292">For this reason, hello script executes two steps:</span></span>

- <span data-ttu-id="c1818-293">Verifica che tale console archiviazione hello è accessibile.</span><span class="sxs-lookup"><span data-stu-id="c1818-293">It verifies that hello storage console is accessible.</span></span>
- <span data-ttu-id="c1818-294">Crea uno snapshot di test, o fittizio, per ogni volume di ogni istanza HANA.</span><span class="sxs-lookup"><span data-stu-id="c1818-294">It creates a test, or dummy, snapshot for each volume by HANA instance.</span></span>

<span data-ttu-id="c1818-295">Per questo motivo, l'istanza HANA hello è incluso come argomento.</span><span class="sxs-lookup"><span data-stu-id="c1818-295">For this reason, hello HANA instance is included as an argument.</span></span> <span data-ttu-id="c1818-296">Nuovamente, non è possibile tooprovide errori per la connessione di archiviazione hello, ma vengono forniti alcuni script hello suggerimenti se hello esecuzione ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="c1818-296">Again, it is not possible tooprovide error checking for hello storage connection, but hello script provides helpful hints if hello execution fails.</span></span>

<span data-ttu-id="c1818-297">Hello script viene eseguito come:</span><span class="sxs-lookup"><span data-stu-id="c1818-297">hello script is run as:</span></span>
```
 ./testStorageSnapshotConnection.pl <hana instance>
```
<span data-ttu-id="c1818-298">Oppure viene eseguito nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="c1818-298">Or it is run as:</span></span>
```
./testStorageSnapshotConnectionBW.pl <hana instance>
```
<span data-ttu-id="c1818-299">script di Hello Visualizza anche un messaggio che si è in grado di toosign in modo appropriato tenant archiviazione tooyour distribuito, è organizzato in base a numeri di hello unità logica (LUN) che vengono utilizzati dalle istanze del server hello che si è proprietari.</span><span class="sxs-lookup"><span data-stu-id="c1818-299">hello script also displays a message that you are able toosign in appropriately tooyour deployed storage tenant, which is organized around hello logical unit numbers (LUNs) that are used by hello server instances you own.</span></span>

<span data-ttu-id="c1818-300">Prima di eseguire hello prima archiviazione basata su snapshot backup, eseguire hello Avanti script toomake tale configurazione hello sia corretto.</span><span class="sxs-lookup"><span data-stu-id="c1818-300">Before you execute hello first storage snapshot-based backups, run hello next scripts toomake sure that hello configuration is correct.</span></span>

<span data-ttu-id="c1818-301">Dopo aver eseguito questi script, è possibile eliminare gli snapshot hello eseguendo:</span><span class="sxs-lookup"><span data-stu-id="c1818-301">After running these scripts, you can delete hello snapshots by executing:</span></span>
```
./removeTestStorageSnapshot.pl <hana instance>
```
<span data-ttu-id="c1818-302">Or</span><span class="sxs-lookup"><span data-stu-id="c1818-302">Or</span></span>
```
./removeTestStorageSnapshot.pl <hana instance>
```

### <a name="step-7-perform-on-demand-snapshots"></a><span data-ttu-id="c1818-303">Passaggio 7: Eseguire snapshot su richiesta</span><span class="sxs-lookup"><span data-stu-id="c1818-303">Step 7: Perform on-demand snapshots</span></span>

<span data-ttu-id="c1818-304">Eseguire snapshot su richiesta (e pianificare snapshot regolari utilizzando cron) come descritto di seguito.</span><span class="sxs-lookup"><span data-stu-id="c1818-304">Perform on-demand snapshots (as well as schedule regular snapshots by using cron) as described here.</span></span>

<span data-ttu-id="c1818-305">Per le configurazioni con scalabilità verticale, eseguire lo script seguente hello:</span><span class="sxs-lookup"><span data-stu-id="c1818-305">For scale-up configurations, execute hello following script:</span></span>
```
./azure_hana_backup.pl lhanad01 customer 20
```
<span data-ttu-id="c1818-306">Per le configurazioni di scalabilità orizzontale, eseguire lo script seguente hello:</span><span class="sxs-lookup"><span data-stu-id="c1818-306">For scale-out configurations, execute hello following script:</span></span>
```
./azure_hana_backup_bw.pl lhanad01 customer 20
```
<span data-ttu-id="c1818-307">script di scalabilità orizzontale Hello esegue alcune ulteriori toomake verifica che tutti i server HANA accessibili e tutte le istanze HANA appropriato lo stato restituiscono dell'istanza di hello prima di procedere con la creazione di snapshot di SAP HANA o archiviazione.</span><span class="sxs-lookup"><span data-stu-id="c1818-307">hello scale-out script does some additional checking toomake sure that all HANA servers can be accessed, and all HANA instances return appropriate status of hello instance before proceeding with creating SAP HANA or storage snapshots.</span></span>

<span data-ttu-id="c1818-308">Hello gli argomenti seguenti è necessario:</span><span class="sxs-lookup"><span data-stu-id="c1818-308">hello following arguments are required:</span></span>

- <span data-ttu-id="c1818-309">backup che richiedono istanza HANA Hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-309">hello HANA instance requiring backup.</span></span>
- <span data-ttu-id="c1818-310">prefisso di snapshot Hello per snapshot di archiviazione hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-310">hello snapshot prefix for hello storage snapshot.</span></span>
- <span data-ttu-id="c1818-311">numero di Hello di snapshot toobe conservati per prefisso specifico hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-311">hello number of snapshots toobe kept for hello specific prefix.</span></span>

```
./azure_hana_backup.pl lhanad01 customer 20
```

<span data-ttu-id="c1818-312">l'esecuzione di Hello dello script hello Crea snapshot di archiviazione hello in questi tre fasi distinte:</span><span class="sxs-lookup"><span data-stu-id="c1818-312">hello execution of hello script creates hello storage snapshot in these three distinct phases:</span></span>

- <span data-ttu-id="c1818-313">Eseguire uno snapshot HANA.</span><span class="sxs-lookup"><span data-stu-id="c1818-313">Execute a HANA snapshot.</span></span>
- <span data-ttu-id="c1818-314">Eseguire uno snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="c1818-314">Execute a storage snapshot.</span></span>
- <span data-ttu-id="c1818-315">Rimuovere snapshot HANA hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-315">Remove hello HANA snapshot.</span></span>

<span data-ttu-id="c1818-316">Eseguire script hello effettuando una chiamata da hello HDB cartella eseguibile che è stato copiato.</span><span class="sxs-lookup"><span data-stu-id="c1818-316">Execute hello script by calling it from hello HDB executable folder that it was copied to.</span></span> <span data-ttu-id="c1818-317">Si esegue il backup almeno hello in seguito volumi, ma anche esegue il backup di qualsiasi volume con nome di istanza SAP HANA esplicito hello nel nome del volume hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-317">It backs up at least hello following volumes, but it also backs up any volume that has hello explicit SAP HANA instance name in hello volume name.</span></span>
```
hana_data_<hana instance>_prod_t020_vol
hana_log_<hana instance>_prod_t020_vol
hana_log_backup_<hana instance>_prod_t020_vol
hana_shared_<hana instance>_prod_t020_vol
```
<span data-ttu-id="c1818-318">periodo di memorizzazione Hello rigorosamente viene amministrato, con il numero di hello di snapshot inviato come parametro quando si esegue uno script di hello (ad esempio, 20, illustrato in precedenza).</span><span class="sxs-lookup"><span data-stu-id="c1818-318">hello retention period is strictly administered, with hello number of snapshots submitted as a parameter when you execute hello script (such as 20, shown previously).</span></span> <span data-ttu-id="c1818-319">Pertanto, hello tempo è una funzione del periodo di hello hello e esecuzione il numero di snapshot nella chiamata di hello dello script hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-319">So hello amount of time is a function of hello period of execution and hello number of snapshots in hello call of hello script.</span></span> <span data-ttu-id="c1818-320">Se hello numero di snapshot vengono conservati hello di supera vengono denominate come un parametro nella chiamata di hello dello script hello, hello lo snapshot meno recente di archiviazione di questa etichetta (in questo caso precedente, _personalizzato_) viene eliminato prima che sia un nuovo snapshot eseguito.</span><span class="sxs-lookup"><span data-stu-id="c1818-320">If hello number of snapshots that are kept exceeds hello number that are named as a parameter in hello call of hello script, hello oldest storage snapshot of this label (in our previous case, _custom_) is deleted before a new snapshot is executed.</span></span> <span data-ttu-id="c1818-321">Ciò significa che il numero di hello che è possibile assegnare come ultimo parametro della chiamata di hello hello è il numero di hello è possibile utilizzare toocontrol hello numero di snapshot.</span><span class="sxs-lookup"><span data-stu-id="c1818-321">This means hello number you give as hello last parameter of hello call is hello number you can use toocontrol hello number of snapshots.</span></span>

>[!NOTE]
><span data-ttu-id="c1818-322">Non appena si modifica l'etichetta di hello, hello inizia il conteggio nuovamente.</span><span class="sxs-lookup"><span data-stu-id="c1818-322">As soon as you change hello label, hello counting starts again.</span></span>

<span data-ttu-id="c1818-323">È necessario tooinclude hello HANA nome dell'istanza che viene fornita da SAP HANA sulla gestione dei servizi di Azure come argomento, se creano snapshot in ambienti a più nodi.</span><span class="sxs-lookup"><span data-stu-id="c1818-323">You need tooinclude hello HANA instance name that's provided by SAP HANA on Azure Service Management as an argument if they are creating snapshots in multi-node environments.</span></span> <span data-ttu-id="c1818-324">In ambienti a nodo singolo, è sufficiente nome hello di hello SAP HANA nell'unità di Azure (istanze di grandi dimensioni), ma è comunque consigliabile nome dell'istanza HANA hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-324">In single-node environments, hello name of hello SAP HANA on Azure (large instances) unit is sufficient, but hello HANA instance name is still recommended.</span></span>

<span data-ttu-id="c1818-325">Inoltre, è possibile eseguire il backup volumes\LUNs avvio utilizzando hello stesso script.</span><span class="sxs-lookup"><span data-stu-id="c1818-325">Additionally, you can back up boot volumes\LUNs by using hello same script.</span></span> <span data-ttu-id="c1818-326">È necessario eseguire il backup del volume di avvio almeno una volta quando si esegue HANA per la prima volta, anche se è consigliabile pianificare backup settimanali o nelle ore notturne per tale volume tramite cron.</span><span class="sxs-lookup"><span data-stu-id="c1818-326">You must back up your boot volume at least once when you first run HANA, although we recommend a weekly or nightly backup schedule for booting in cron.</span></span> <span data-ttu-id="c1818-327">Invece di aggiungere il nome di un'istanza di SAP HANA, inserire _avvio_ come hello argomento nello script hello come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="c1818-327">Rather than add an SAP HANA instance name, insert _boot_ as hello argument into hello script as follows:</span></span>
```
./azure_hana_backup boot customer 20
```
<span data-ttu-id="c1818-328">Hello stesso criterio di conservazione è offerta toohello anche il volume di avvio.</span><span class="sxs-lookup"><span data-stu-id="c1818-328">hello same retention policy is afforded toohello boot volume as well.</span></span> <span data-ttu-id="c1818-329">Utilizzare snapshot su richiesta, come descritto in precedenza, per casi speciali, ad esempio durante un aggiornamento di pacchetto (EHP) SAP funzionalità avanzata, o quando è necessario toocreate uno snapshot di archiviazione distinti.</span><span class="sxs-lookup"><span data-stu-id="c1818-329">Use on-demand snapshots, as described previously, for special cases only, such as during an SAP enhancement package (EHP) upgrade, or when you need toocreate a distinct storage snapshot.</span></span>

<span data-ttu-id="c1818-330">Si consiglia di snapshot di archiviazione tooperform pianificata utilizzando cron e si consiglia di utilizzare hello stesso script per tutti i backup e alle esigenze di ripristino di emergenza (modifica hello script input toomatch hello vari ha richiesto tempi di backup).</span><span class="sxs-lookup"><span data-stu-id="c1818-330">We encourage you tooperform scheduled storage snapshots using cron, and we recommend that you use hello same script for all backups and disaster-recovery needs (modifying hello script inputs toomatch hello various requested backup times).</span></span> <span data-ttu-id="c1818-331">Gli snapshot sono tutti pianificati in modo diverso in cron, in base alla frequenza di esecuzione: oraria, ogni 12 ore, giornaliera o settimanale.</span><span class="sxs-lookup"><span data-stu-id="c1818-331">These are all scheduled differently in cron depending on their execution time: hourly, 12-hour, daily, or weekly.</span></span> <span data-ttu-id="c1818-332">pianificazione cron Hello è progettato toocreate snapshot di archiviazione che corrispondono a hello illustrata in precedenza memorizzazione l'assegnazione di etichette per il backup fuori sede a lungo termine.</span><span class="sxs-lookup"><span data-stu-id="c1818-332">hello cron schedule is designed toocreate storage snapshots that match hello previously discussed retention labeling for long-term off-site backup.</span></span> <span data-ttu-id="c1818-333">script di Hello include comandi tooback includere tutti i volumi di produzione, a seconda della relativa frequenza di richiesta (file di dati e di log vengono eseguito il backup ogni ora, mentre il volume di avvio hello viene eseguito il backup giornaliero).</span><span class="sxs-lookup"><span data-stu-id="c1818-333">hello script includes commands tooback up all production volumes, depending on their requested frequency (data and log files are backed up hourly, whereas hello boot volume is backed up daily).</span></span>

<span data-ttu-id="c1818-334">le voci di Hello in hello cron script seguente eseguito ogni ora hello decimo minuto, ogni 12 ore hello decimo minuto e ogni giorno hello decimo minuto.</span><span class="sxs-lookup"><span data-stu-id="c1818-334">hello entries in hello following cron script run every hour at hello tenth minute, every 12 hours at hello tenth minute, and daily at hello tenth minute.</span></span> <span data-ttu-id="c1818-335">cron Hello i processi vengono creati in modo che un solo snapshot di archiviazione di SAP HANA ha luogo durante qualsiasi ora specifica, in modo che hello orari e giornalieri i backup non vengono eseguiti in hello che la stessa ora (12:10 AM).</span><span class="sxs-lookup"><span data-stu-id="c1818-335">hello cron jobs are created in such a way that only one SAP HANA storage snapshot takes place during any particular hour, so that hello hourly and daily backups do not occur at hello same time (12:10 AM).</span></span> <span data-ttu-id="c1818-336">toohelp ottimizzare la creazione dello snapshot e la replica, SAP HANA sulla gestione dei servizi di Azure fornisce hello i backup di tempo per toorun è consigliato.</span><span class="sxs-lookup"><span data-stu-id="c1818-336">toohelp optimize your snapshot creation and replication, SAP HANA on Azure Service Management provides hello recommended time for you toorun your backups.</span></span>

<span data-ttu-id="c1818-337">Hello predefinito cron /etc/crontab di pianificazione è il seguente:</span><span class="sxs-lookup"><span data-stu-id="c1818-337">hello default cron scheduling in /etc/crontab is as follows:</span></span>
```
10 1-11,13-23 * * * ./azure_hana_backup.pl lhanad01 hourly 66
10 12 * * *  ./azure_hana_backup.pl lhanad01 12hour 14
```
<span data-ttu-id="c1818-338">Nelle istruzioni di cron precedente hello, volumi HANA hello (senza il volume di avvio) ottenere snapshot con etichetta hello ogni ora.</span><span class="sxs-lookup"><span data-stu-id="c1818-338">In hello previous cron instructions, hello HANA volumes (without boot volume) get an hourly snapshot with hello label.</span></span> <span data-ttu-id="c1818-339">Di questi snapshot, ne vengono mantenuti 66.</span><span class="sxs-lookup"><span data-stu-id="c1818-339">Of these snapshots, 66 are retained.</span></span> <span data-ttu-id="c1818-340">Inoltre, vengono mantenuti 14 snapshot con etichetta di hello 12 ore.</span><span class="sxs-lookup"><span data-stu-id="c1818-340">Additionally, 14 snapshots with hello 12-hour label are retained.</span></span> <span data-ttu-id="c1818-341">Si possono avere snapshot orari per tre giorni, oltre a snapshot ogni 12 ore per altri quattro giorni, ovvero un'intera settimana di snapshot.</span><span class="sxs-lookup"><span data-stu-id="c1818-341">You potentially get hourly snapshots for three days, plus 12-hour snapshots for another four days, which gives you an entire week of snapshots.</span></span>

<span data-ttu-id="c1818-342">Pianificazione all'interno di cron può risultare difficile, perché solo uno script deve essere eseguito in qualsiasi momento specifico, a meno che non vengono scaglionati in script hello da alcuni minuti.</span><span class="sxs-lookup"><span data-stu-id="c1818-342">Scheduling within cron can be tricky, because only one script should be executed at any particular time, unless hello scripts are staggered by several minutes.</span></span> <span data-ttu-id="c1818-343">Se si desidera i backup giornalieri per la conservazione a lungo termine, un snapshot viene mantenuto insieme a uno snapshot di 12 ore (con un conteggio di conservazione di ogni sette) o snapshot oraria hello è tootake sfalsate 10 minuti in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="c1818-343">If you want daily backups for long-term retention, either a daily snapshot is kept along with a 12-hour snapshot (with a retention count of seven each), or hello hourly snapshot is staggered tootake place 10 minutes later.</span></span> <span data-ttu-id="c1818-344">Un solo snapshot viene mantenuto nel volume di produzione hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-344">Only one daily snapshot is kept in hello production volume.</span></span>
```
10 1-11,13-23 * * * ./azure_hana_backup.pl lhanad01 hourly 66
10 12 * * *  ./azure_hana_backup.pl lhanad01 12hour 7
10 0 * * * ./azure_hana_backup.pl lhanad01 daily 7
```
<span data-ttu-id="c1818-345">le frequenze di Hello elencate di seguito sono riportati esempi di solo.</span><span class="sxs-lookup"><span data-stu-id="c1818-345">hello frequencies listed here are only examples.</span></span> <span data-ttu-id="c1818-346">tooderive il numero ottimale di snapshot, utilizzare hello seguenti criteri:</span><span class="sxs-lookup"><span data-stu-id="c1818-346">tooderive your optimum number of snapshots, use hello following criteria:</span></span>

- <span data-ttu-id="c1818-347">Requisiti dell'obiettivo tempo di ripristino per il ripristino temporizzato.</span><span class="sxs-lookup"><span data-stu-id="c1818-347">Requirements in recovery time objective for point-in-time recovery.</span></span>
- <span data-ttu-id="c1818-348">Utilizzo dello spazio.</span><span class="sxs-lookup"><span data-stu-id="c1818-348">Space usage.</span></span>
- <span data-ttu-id="c1818-349">Requisiti dell'obiettivo punto di ripristino e dell'obiettivo tempo di ripristino per un ripristino di emergenza potenziale.</span><span class="sxs-lookup"><span data-stu-id="c1818-349">Requirements in recovery point objective and recovery time objective for potential disaster recovery.</span></span>
- <span data-ttu-id="c1818-350">Eventuale esecuzione di backup completi del database HANA sui dischi.</span><span class="sxs-lookup"><span data-stu-id="c1818-350">Eventual execution of HANA full database backups against disks.</span></span> <span data-ttu-id="c1818-351">Ogni volta che un backup completo del database su dischi, o _backint_ l'interfaccia, viene eseguita, hello l'esecuzione di snapshot di archiviazione non riesce.</span><span class="sxs-lookup"><span data-stu-id="c1818-351">Whenever a full database backup against disks, or _backint_ interface, is performed, hello execution of storage snapshots fails.</span></span> <span data-ttu-id="c1818-352">Se si prevede di backup completi del database tooexecute nella parte superiore di snapshot di archiviazione, assicurarsi che l'esecuzione di hello di snapshot di archiviazione è disabilitato durante l'operazione.</span><span class="sxs-lookup"><span data-stu-id="c1818-352">If you plan tooexecute full database backups on top of storage snapshots, make sure that hello execution of storage snapshots is disabled during this time.</span></span>

>[!IMPORTANT]
> <span data-ttu-id="c1818-353">utilizzo di Hello di snapshot di archiviazione per i backup di SAP HANA è valido solo quando vengono eseguiti gli snapshot hello in combinazione con i backup del log SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="c1818-353">hello use of storage snapshots for SAP HANA backups is valid only when hello snapshots are performed in conjunction with SAP HANA log backups.</span></span> <span data-ttu-id="c1818-354">Questi log backup necessario toobe toocover in grado di hello periodi di tempo tra gli snapshot di archiviazione hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-354">These log backups need toobe able toocover hello time periods between hello storage snapshots.</span></span> <span data-ttu-id="c1818-355">Se è stato impostato un toousers impegno di un punto nel tempo di ripristino di 30 giorni, è necessario hello segue:</span><span class="sxs-lookup"><span data-stu-id="c1818-355">If you've set a commitment toousers of a point-in-time recovery of 30 days, you need hello following:</span></span>

- <span data-ttu-id="c1818-356">Possibilità tooaccess uno snapshot di archiviazione di 30 giorni precedenti.</span><span class="sxs-lookup"><span data-stu-id="c1818-356">Ability tooaccess a storage snapshot that is 30 days old.</span></span>
- <span data-ttu-id="c1818-357">Backup di log contigui su hello ultimi 30 giorni.</span><span class="sxs-lookup"><span data-stu-id="c1818-357">Contiguous log backups over hello last 30 days.</span></span>

<span data-ttu-id="c1818-358">Intervallo di hello di backup del log, creare uno snapshot del volume di backup del log hello anche.</span><span class="sxs-lookup"><span data-stu-id="c1818-358">In hello range of log backups, create a snapshot of hello backup log volume as well.</span></span> <span data-ttu-id="c1818-359">Tuttavia, essere tooperform che backup regolari dei log in modo che sia possibile:</span><span class="sxs-lookup"><span data-stu-id="c1818-359">However, be sure tooperform regular log backups so that you can:</span></span>

- <span data-ttu-id="c1818-360">Sono dei backup del log contigui hello necessari i ripristini temporizzati in tooperform.</span><span class="sxs-lookup"><span data-stu-id="c1818-360">Have hello contiguous log backups needed tooperform point-in-time recoveries.</span></span>
- <span data-ttu-id="c1818-361">Impedire l'esaurimento dello spazio volume di log di SAP HANA hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-361">Prevent hello SAP HANA log volume from running out of space.</span></span>

<span data-ttu-id="c1818-362">Uno degli ultimi passaggi hello è tooschedule registri di backup SAP HANA in SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="c1818-362">One of hello last steps is tooschedule SAP HANA backup logs in SAP HANA Studio.</span></span> <span data-ttu-id="c1818-363">destinazione backup del log di SAP HANA di Hello è hana hello appositamente creato o di log\_volume di backup con il punto di montaggio hello del /hana/log/backups.</span><span class="sxs-lookup"><span data-stu-id="c1818-363">hello SAP HANA backup log target destination is hello specially created hana/log\_backups volume with hello mount point of /hana/log/backups.</span></span>

![Pianificare i log di backup di SAP HANA in SAP HANA Studio](./media/hana-overview-high-availability-disaster-recovery/image5-schedule-backup.png)

<span data-ttu-id="c1818-365">È possibile scegliere backup con una frequenza maggiore di ogni 15 minuti.</span><span class="sxs-lookup"><span data-stu-id="c1818-365">You can choose backups that are more frequent than every 15 minutes.</span></span> <span data-ttu-id="c1818-366">Alcuni utenti eseguono il backup dei log ogni minuto, ma è sconsigliato impostare una frequenza _superiore_ a 15 minuti.</span><span class="sxs-lookup"><span data-stu-id="c1818-366">Some users even perform log backups every minute, although we do not recommend going _over_ 15 minutes.</span></span>

<span data-ttu-id="c1818-367">passaggio finale Hello è tooperform basato su file di backup (dopo l'installazione iniziale di hello di SAP HANA) toocreate una singola voce di backup che deve essere presente nel catalogo di backup hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-367">hello final step is tooperform a file-based backup (after hello initial installation of SAP HANA) toocreate a single backup entry that must exist within hello backup catalog.</span></span> <span data-ttu-id="c1818-368">In caso contrario SAP HANA non può avviare i backup del log specificato.</span><span class="sxs-lookup"><span data-stu-id="c1818-368">Otherwise SAP HANA cannot initiate your specified log backups.</span></span>

![Immettere un toocreate backup basati su file un singolo backup](./media/hana-overview-high-availability-disaster-recovery/image6-make-backup.png)

### <a name="monitoring-hello-number-and-size-of-snapshots-on-hello-disk-volume"></a><span data-ttu-id="c1818-370">Monitoraggio numero hello e le dimensioni degli snapshot sul volume disco hello</span><span class="sxs-lookup"><span data-stu-id="c1818-370">Monitoring hello number and size of snapshots on hello disk volume</span></span>

<span data-ttu-id="c1818-371">In un volume di archiviazione specifico, è possibile monitorare il numero di hello di snapshot e l'utilizzo dell'archiviazione hello di snapshot.</span><span class="sxs-lookup"><span data-stu-id="c1818-371">On a particular storage volume, you can monitor hello number of snapshots and hello storage consumption of snapshots.</span></span> <span data-ttu-id="c1818-372">Hello `ls` non mostra il comando file o directory snapshot hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-372">hello `ls` command doesn't show hello snapshot directory or files.</span></span> <span data-ttu-id="c1818-373">Tuttavia, hello comando del sistema operativo Linux `du` avviene, hello seguenti comandi:</span><span class="sxs-lookup"><span data-stu-id="c1818-373">However, hello Linux OS command `du` does, with hello following commands:</span></span>

- <span data-ttu-id="c1818-374">`du –sh .snapshot`fornisce un totale di tutti gli snapshot all'interno di directory snapshot hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-374">`du –sh .snapshot` provides a total of all snapshots within hello snapshot directory.</span></span>
- <span data-ttu-id="c1818-375">`du –sh --max-depth=1`Elenca tutti gli snapshot vengono salvati nella cartella .snapshot hello e le dimensioni di hello di ogni snapshot.</span><span class="sxs-lookup"><span data-stu-id="c1818-375">`du –sh --max-depth=1` lists all snapshots that are saved in hello .snapshot folder and hello size of each snapshot.</span></span>
- <span data-ttu-id="c1818-376">`du –hc`fornisce dimensioni totali di hello utilizzata da tutti gli snapshot.</span><span class="sxs-lookup"><span data-stu-id="c1818-376">`du –hc` provides hello total size used by all snapshots.</span></span>

<span data-ttu-id="c1818-377">Utilizzare questi comandi toomake assicurarsi che gli snapshot hello vengono eseguiti e archiviati non utilizzano tutti gli archivi di hello nei volumi di hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-377">Use these commands toomake sure that hello snapshots that are taken and stored are not consuming all hello storage on hello volumes.</span></span>

### <a name="reducing-hello-number-of-snapshots-on-a-server"></a><span data-ttu-id="c1818-378">Riducendo il numero di hello di snapshot in un server</span><span class="sxs-lookup"><span data-stu-id="c1818-378">Reducing hello number of snapshots on a server</span></span>

<span data-ttu-id="c1818-379">Come spiegato in precedenza, è possibile ridurre il numero di hello di alcune etichette di snapshot archiviati.</span><span class="sxs-lookup"><span data-stu-id="c1818-379">As explained earlier, you can reduce hello number of certain labels of snapshots that you store.</span></span> <span data-ttu-id="c1818-380">Hello ultimi due parametri di hello comando tooinitiate uno snapshot sono un numero di etichetta e hello di snapshot di cui si desidera tooretain.</span><span class="sxs-lookup"><span data-stu-id="c1818-380">hello last two parameters of hello command tooinitiate a snapshot are a label and hello number of snapshots you want tooretain.</span></span>
```
./azure_hana_backup.pl lhanad01 customer 20
```
<span data-ttu-id="c1818-381">Nell'esempio precedente hello etichetta snapshot hello è _cliente_ e hello numero di snapshot con toobe questa etichetta mantenuti è _20_.</span><span class="sxs-lookup"><span data-stu-id="c1818-381">In hello previous example, hello snapshot label is _customer_ and hello number of snapshots with this label toobe retained is _20_.</span></span> <span data-ttu-id="c1818-382">Quando si risponde toodisk sull'utilizzo di spazio, è possibile che si desideri numero hello tooreduce di snapshot archiviato.</span><span class="sxs-lookup"><span data-stu-id="c1818-382">As you respond toodisk space consumption, you might want tooreduce hello number of stored snapshots.</span></span> <span data-ttu-id="c1818-383">Consente di Hello numero hello tooreduce di snapshot è script hello toorun con hello ultimo parametro set too5:</span><span class="sxs-lookup"><span data-stu-id="c1818-383">hello easy way tooreduce hello number of snapshots is toorun hello script with hello last parameter set too5:</span></span>
```
./azure_hana_backup.pl lhanad01 customer 5
```
<span data-ttu-id="c1818-384">Come risultato di esecuzione dello script hello con questa impostazione, il numero di hello di snapshot, tra cui hello nuova risorsa di archiviazione dello snapshot, è _5_.</span><span class="sxs-lookup"><span data-stu-id="c1818-384">As a result of running hello script with this setting, hello number of snapshots, including hello new storage snapshot, is _5_.</span></span>

 >[!NOTE]
 > <span data-ttu-id="c1818-385">Questo script consente di ridurre il numero di hello di snapshot solo se allo snapshot precedente più recente di hello è più di un'ora precedente.</span><span class="sxs-lookup"><span data-stu-id="c1818-385">This script reduces hello number of snapshots only if hello most recent previous snapshot is more than one hour old.</span></span> <span data-ttu-id="c1818-386">script Hello non elimina gli snapshot sono meno di un'ora fa.</span><span class="sxs-lookup"><span data-stu-id="c1818-386">hello script does not delete snapshots that are less than one hour old.</span></span>

<span data-ttu-id="c1818-387">Queste restrizioni sono una funzionalità opzionale di ripristino di emergenza correlate toohello offerte.</span><span class="sxs-lookup"><span data-stu-id="c1818-387">These restrictions are related toohello optional disaster-recovery functionality offered.</span></span>

<span data-ttu-id="c1818-388">Se non si desidera più toomaintain un set di snapshot con tale prefisso, è possibile eseguire lo script hello con _0_ come hello memorizzazione numero tooremove tutti gli snapshot corrispondente tale prefisso.</span><span class="sxs-lookup"><span data-stu-id="c1818-388">If you no longer want toomaintain a set of snapshots with that prefix, you can execute hello script with _0_ as hello retention number tooremove all snapshots matching that prefix.</span></span> <span data-ttu-id="c1818-389">La rimozione di tutti gli snapshot possono tuttavia influire sulla funzionalità hello del ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="c1818-389">However, removing all snapshots can affect hello capabilities of disaster recovery.</span></span>

### <a name="recovering-toohello-most-recent-hana-snapshot"></a><span data-ttu-id="c1818-390">Ripristino di snapshot HANA più recente toohello</span><span class="sxs-lookup"><span data-stu-id="c1818-390">Recovering toohello most recent HANA snapshot</span></span>

<span data-ttu-id="c1818-391">In caso di hello che si verifichi un scenario di produzione verso il basso, il processo di hello di ripristino da uno snapshot di archiviazione può essere avviato come un evento imprevisto di clienti con SAP HANA sulla gestione dei servizi di Azure.</span><span class="sxs-lookup"><span data-stu-id="c1818-391">In hello event that you experience a production-down scenario, hello process of recovering from a storage snapshot can be initiated as a customer incident with SAP HANA on Azure Service Management.</span></span> <span data-ttu-id="c1818-392">Un scenario di questo tipo imprevisto potrebbe essere una questione di urgenza elevati se i dati sono stati eliminati in produzione hello e sistema solo modo dati hello tooretrieve database di produzione toorestore hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-392">Such an unexpected scenario might be a high-urgency matter if data was deleted in a production system and hello only way tooretrieve hello data is toorestore hello production database.</span></span>

<span data-ttu-id="c1818-393">In hello invece un punto nel tempo di ripristino potrebbe essere bassa urgenza e pianificato per i giorni in anticipo.</span><span class="sxs-lookup"><span data-stu-id="c1818-393">On hello other hand, a point-in-time recovery could be low urgency and planned for days in advance.</span></span> <span data-ttu-id="c1818-394">È possibile pianificare questo ripristino con il team di gestione dei servizi SAP HANA in Azure anziché segnalare un problema ad alta priorità.</span><span class="sxs-lookup"><span data-stu-id="c1818-394">You can plan this recovery with SAP HANA on Azure Service Management instead of raising a high-priority issue.</span></span> <span data-ttu-id="c1818-395">Ad esempio, potrebbe essere pianificazione tootry un aggiornamento del software SAP hello applicando un nuovo pacchetto di funzionalità avanzata ed è quindi necessario eseguire il toorevert tooa snapshot che rappresenta lo stato di hello prima dell'aggiornamento hello EHP.</span><span class="sxs-lookup"><span data-stu-id="c1818-395">For example, you might be planning tootry an upgrade of hello SAP software by applying a new enhancement package, and you then need toorevert back tooa snapshot that represents hello state before hello EHP upgrade.</span></span>

<span data-ttu-id="c1818-396">Prima di eseguire la richiesta di hello, è necessario toodo alcune attività di preparazione.</span><span class="sxs-lookup"><span data-stu-id="c1818-396">Before you issue hello request, you need toodo some preparation.</span></span> <span data-ttu-id="c1818-397">SAP HANA team di gestione del servizio Azure può gestire la richiesta di hello e fornire volumi hello ripristinato.</span><span class="sxs-lookup"><span data-stu-id="c1818-397">SAP HANA on Azure Service Management team can then handle hello request and provide hello restored volumes.</span></span> <span data-ttu-id="c1818-398">In seguito, è tooyou toorestore hello HANA database basato su snapshot hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-398">Afterward, it is up tooyou toorestore hello HANA database based on hello snapshots.</span></span> <span data-ttu-id="c1818-399">Ecco come tooprepare per hello richiesta:</span><span class="sxs-lookup"><span data-stu-id="c1818-399">Here is how tooprepare for hello request:</span></span>

>[!NOTE]
><span data-ttu-id="c1818-400">L'interfaccia utente potrebbe variare da hello seguente schermate, a seconda di hello versione SAP HANA in uso.</span><span class="sxs-lookup"><span data-stu-id="c1818-400">Your user interface might vary from hello following screenshots, depending on hello SAP HANA release you are using.</span></span>

1. <span data-ttu-id="c1818-401">Decidere quali toorestore snapshot.</span><span class="sxs-lookup"><span data-stu-id="c1818-401">Decide which snapshot toorestore.</span></span> <span data-ttu-id="c1818-402">A meno che non viene richiesto, in caso contrario, verrebbe ripristinato solo il volume di dati/hana hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-402">Only hello hana/data volume would be restored unless you are instructed otherwise.</span></span>

2. <span data-ttu-id="c1818-403">Arrestare l'istanza HANA hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-403">Shut down hello HANA instance.</span></span>

 ![Arrestare l'istanza di hello HANA](./media/hana-overview-high-availability-disaster-recovery/image7-shutdown-hana.png)

3. <span data-ttu-id="c1818-405">Smontare i volumi di dati hello in ogni nodo del database HANA.</span><span class="sxs-lookup"><span data-stu-id="c1818-405">Unmount hello data volumes on each HANA database node.</span></span> <span data-ttu-id="c1818-406">ripristino di Hello dello snapshot hello ha esito negativo se i volumi di dati hello non vengono smontati.</span><span class="sxs-lookup"><span data-stu-id="c1818-406">hello restoration of hello snapshot fails if hello data volumes are not unmounted.</span></span>

 ![Smontare i volumi di dati hello in ogni nodo del database HANA](./media/hana-overview-high-availability-disaster-recovery/image8-unmount-data-volumes.png)

4. <span data-ttu-id="c1818-408">Aprire un ripristino di supporto tecnico di Azure richiesta tooinstruct hello di uno snapshot specifico.</span><span class="sxs-lookup"><span data-stu-id="c1818-408">Open an Azure support request tooinstruct hello restoration of a specific snapshot.</span></span>

 - <span data-ttu-id="c1818-409">Durante il ripristino di hello: SAP HANA sulla gestione dei servizi di Azure potrebbe richiedere di tooattend tooensure una conferenza telefonica che nessun dato è sentirsi persi.</span><span class="sxs-lookup"><span data-stu-id="c1818-409">During hello restoration: SAP HANA on Azure Service Management might ask you tooattend a conference call tooensure that no data is getting lost.</span></span>

 - <span data-ttu-id="c1818-410">Dopo il ripristino di hello: SAP HANA sulla gestione dei servizi Azure informa l'utente quando il ripristino di snapshot di archiviazione hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-410">After hello restoration: SAP HANA on Azure Service Management notifies you when hello storage snapshot has been restored.</span></span>

5. <span data-ttu-id="c1818-411">Una volta completato il processo di ripristino hello, reinstallare tutti i volumi di dati.</span><span class="sxs-lookup"><span data-stu-id="c1818-411">After hello restoration process is complete, remount all data volumes.</span></span>

 ![Montare nuovamente tutti i volumi di dati](./media/hana-overview-high-availability-disaster-recovery/image9-remount-data-volumes.png)

6. <span data-ttu-id="c1818-413">Selezionare le opzioni di ripristino in SAP HANA Studio, se vengono automaticamente viene visualizzata quando si riconnette tooHANA database tramite SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="c1818-413">Select recovery options within SAP HANA Studio, if they do not automatically come up when you reconnect tooHANA DB through SAP HANA Studio.</span></span> <span data-ttu-id="c1818-414">Hello esempio seguente viene illustrato un ripristino toohello ultimo HANA snapshot.</span><span class="sxs-lookup"><span data-stu-id="c1818-414">hello following example shows a restoration toohello last HANA snapshot.</span></span> <span data-ttu-id="c1818-415">Uno snapshot di archiviazione incorpora uno snapshot HANA e se si desidera ripristinare toohello snapshot di archiviazione più recente, dovrebbe essere snapshot HANA più recente di hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-415">A storage snapshot embeds one HANA snapshot, and if you are restoring toohello most recent storage snapshot, it should be hello most recent HANA snapshot.</span></span> <span data-ttu-id="c1818-416">(Se si desidera ripristinare gli snapshot di archiviazione tooolder, è necessario toolocate hello HANA basato su hello ora hello archiviazione snapshot dello snapshot.)</span><span class="sxs-lookup"><span data-stu-id="c1818-416">(If you are restoring tooolder storage snapshots, you need toolocate hello HANA snapshot based on hello time hello storage snapshot was taken.)</span></span>

 ![Selezionare le opzioni di ripristino in SAP HANA Studio](./media/hana-overview-high-availability-disaster-recovery/image10-recover-options-a.png)

7. <span data-ttu-id="c1818-418">Selezionare **Ripristina hello tooa dati specifici backup o archiviazione di snapshot del database**.</span><span class="sxs-lookup"><span data-stu-id="c1818-418">Select **Recover hello database tooa specific data backup or storage snapshot**.</span></span>

 ![finestra "Specifica del tipo di ripristino" Hello](./media/hana-overview-high-availability-disaster-recovery/image11-recover-options-b.png)

8. <span data-ttu-id="c1818-420">Scegliere **Specify backup without catalog** (Specifica il backup senza catalogo).</span><span class="sxs-lookup"><span data-stu-id="c1818-420">Select **Specify backup without catalog**.</span></span>

 ![finestra "Specifica del percorso di Backup" Hello](./media/hana-overview-high-availability-disaster-recovery/image12-recover-options-c.png)

9. <span data-ttu-id="c1818-422">In hello **tipo destinazione** elenco, selezionare **Snapshot**.</span><span class="sxs-lookup"><span data-stu-id="c1818-422">In hello **Destination Type** list, select **Snapshot**.</span></span>

 ![finestra "Specificare hello Backup tooRecover" Hello](./media/hana-overview-high-availability-disaster-recovery/image13-recover-options-d.png)

10. <span data-ttu-id="c1818-424">Fare clic su **fine** toostart il processo di ripristino hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-424">Click **Finish** toostart hello recovery process.</span></span>

 ![Fare clic su "Fine" processo di ripristino hello toostart](./media/hana-overview-high-availability-disaster-recovery/image14-recover-options-e.png)

11. <span data-ttu-id="c1818-426">database HANA Hello viene ripristinato e recuperato snapshot HANA toohello che è incluso nello snapshot di archiviazione hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-426">hello HANA database is restored and recovered toohello HANA snapshot that's included in hello storage snapshot.</span></span>

 ![Database HANA è snapshot HANA toohello ripristinato e recuperato](./media/hana-overview-high-availability-disaster-recovery/image15-recover-options-f.png)

### <a name="recovering-toohello-most-recent-state"></a><span data-ttu-id="c1818-428">Ripristino dello stato più recente di toohello</span><span class="sxs-lookup"><span data-stu-id="c1818-428">Recovering toohello most recent state</span></span>

<span data-ttu-id="c1818-429">Hello seguente processo Ripristina snapshot HANA hello è incluso nello snapshot di archiviazione hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-429">hello following process restores hello HANA snapshot that is included in hello storage snapshot.</span></span> <span data-ttu-id="c1818-430">Quindi, viene ripristinato hello transaction log backup toohello stato più recente del database hello prima del ripristino di snapshot di archiviazione hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-430">It then restores hello transaction log backups toohello most recent state of hello database before restoring hello storage snapshot.</span></span>

>[!IMPORTANT]
><span data-ttu-id="c1818-431">Prima di procedere assicurarsi di avere una catena contigua e completa di backup dei log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="c1818-431">Before you proceed, make sure that you have a complete and contiguous chain of transaction log backups.</span></span> <span data-ttu-id="c1818-432">Senza questi backup, è possibile ripristinare lo stato corrente di hello del database hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-432">Without these backups, you cannot restore hello current state of hello database.</span></span>

1. <span data-ttu-id="c1818-433">Completare i passaggi 1-6 di hello precedenti procedura in "Recovering toohello snapshot più recente HANA."</span><span class="sxs-lookup"><span data-stu-id="c1818-433">Complete steps 1-6 of hello preceding procedure in "Recovering toohello most recent HANA snapshot."</span></span>

2. <span data-ttu-id="c1818-434">Selezionare **ripristinare lo stato più recente di hello database tooits**.</span><span class="sxs-lookup"><span data-stu-id="c1818-434">Select **Recover hello database tooits most recent state**.</span></span>

 ![Selezionare "Ripristina allo stato più recente di hello database tooits"](./media/hana-overview-high-availability-disaster-recovery/image16-recover-database-a.png)

3. <span data-ttu-id="c1818-436">Specificare il percorso di hello hello più recente HANA di backup del log.</span><span class="sxs-lookup"><span data-stu-id="c1818-436">Specify hello location of hello most recent HANA log backups.</span></span> <span data-ttu-id="c1818-437">percorso Hello deve toocontain tutti i backup di log delle transazioni HANA dallo stato più recente toohello hello HANA snapshot.</span><span class="sxs-lookup"><span data-stu-id="c1818-437">hello location needs toocontain all HANA transaction log backups from hello HANA snapshot toohello most recent state.</span></span>

 ![Specificare il percorso di hello hello più recente HANA di backup del log](./media/hana-overview-high-availability-disaster-recovery/image17-recover-database-b.png)

4. <span data-ttu-id="c1818-439">Selezionare un backup come base dalla quale database hello toorecover.</span><span class="sxs-lookup"><span data-stu-id="c1818-439">Select a backup as a base from which toorecover hello database.</span></span> <span data-ttu-id="c1818-440">In questo esempio, si tratta di snapshot HANA hello incluse nello snapshot di archiviazione hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-440">In our example, this is hello HANA snapshot that was included in hello storage snapshot.</span></span> <span data-ttu-id="c1818-441">(Un solo snapshot è elencato nella seguente schermata hello.)</span><span class="sxs-lookup"><span data-stu-id="c1818-441">(Only one snapshot is listed in hello following screenshot.)</span></span>

 ![Selezionare un backup come base dalla quale database hello toorecover](./media/hana-overview-high-availability-disaster-recovery/image18-recover-database-c.png)

5. <span data-ttu-id="c1818-443">Crittografato hello **i backup differenziali di utilizzare** casella di controllo se non esistono delta tra hello snapshot HANA hello e allo stato più recente di hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-443">Clear hello **Use Delta Backups** check box if deltas do not exist between hello time of hello HANA snapshot and hello most recent state.</span></span>

 ![Casella di controllo "Utilizzare i backup differenziali" crittografato hello se è presente alcun delta](./media/hana-overview-high-availability-disaster-recovery/image19-recover-database-d.png)

6. <span data-ttu-id="c1818-445">Nella schermata di riepilogo hello, fare clic su **fine** toostart procedura di ripristino hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-445">On hello summary screen, click **Finish** toostart hello restoration procedure.</span></span>

 ![Fare clic su "Fine" nella schermata di riepilogo hello](./media/hana-overview-high-availability-disaster-recovery/image20-recover-database-e.png)

### <a name="recovering-tooanother-point-in-time"></a><span data-ttu-id="c1818-447">Recupero tooanother punto nel tempo</span><span class="sxs-lookup"><span data-stu-id="c1818-447">Recovering tooanother point in time</span></span>
<span data-ttu-id="c1818-448">toorecover tooa punto nel tempo che intercorre tra snapshot HANA hello (incluso nello snapshot di archiviazione hello) e quella successiva alla hello HANA snapshot in fase di punto di ripristino, hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="c1818-448">toorecover tooa point in time between hello HANA snapshot (included in hello storage snapshot) and one that is later than hello HANA snapshot point-in-time recovery, do hello following:</span></span>

1. <span data-ttu-id="c1818-449">Assicurarsi di disporre di tutti i backup del log delle transazioni da hello HANA snapshot toohello ora in cui che si desidera toorecover.</span><span class="sxs-lookup"><span data-stu-id="c1818-449">Make sure that you have all transaction log backups from hello HANA snapshot toohello time you want toorecover.</span></span>
2. <span data-ttu-id="c1818-450">Iniziare la procedura hello in "Recovering toohello allo stato più recente."</span><span class="sxs-lookup"><span data-stu-id="c1818-450">Begin hello procedure under "Recovering toohello most recent state."</span></span>
3. <span data-ttu-id="c1818-451">Nel passaggio 2 della procedura hello hello **Selezione tipo di ripristino** selezionare **seguente toohello database hello di ripristino temporizzato**, specificare hello punto nel tempo e quindi completare i passaggi 3-6.</span><span class="sxs-lookup"><span data-stu-id="c1818-451">In step 2 of hello procedure, in hello **Specify Recovery Type** window, select **Recover hello database toohello following point in time**, specify hello point in time, and then complete steps 3-6.</span></span>

## <a name="monitoring-hello-execution-of-snapshots"></a><span data-ttu-id="c1818-452">Monitoraggio esecuzione hello di snapshot</span><span class="sxs-lookup"><span data-stu-id="c1818-452">Monitoring hello execution of snapshots</span></span>

<span data-ttu-id="c1818-453">È necessario l'esecuzione di hello toomonitor di snapshot di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="c1818-453">You need toomonitor hello execution of storage snapshots.</span></span> <span data-ttu-id="c1818-454">script di Hello che viene eseguito uno snapshot di archiviazione scrive file di output tooa e infine la salva toohello stesso percorso script Perl hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-454">hello script that executes a storage snapshot writes output tooa file and then saves it toohello same location as hello Perl scripts.</span></span> <span data-ttu-id="c1818-455">Viene creato un file separato per ogni snapshot.</span><span class="sxs-lookup"><span data-stu-id="c1818-455">A separate file is written for each snapshot.</span></span> <span data-ttu-id="c1818-456">output di Hello di ogni file mostra chiaramente hello diverse fasi che esegue script snapshot hello:</span><span class="sxs-lookup"><span data-stu-id="c1818-456">hello output of each file clearly shows hello various phases that hello snapshot script executes:</span></span>

- <span data-ttu-id="c1818-457">Ricerca di volumi hello necessarie toocreate uno snapshot</span><span class="sxs-lookup"><span data-stu-id="c1818-457">Finding hello volumes that need toocreate a snapshot</span></span>
- <span data-ttu-id="c1818-458">Ricerca di snapshot hello creati da questi volumi</span><span class="sxs-lookup"><span data-stu-id="c1818-458">Finding hello snapshots taken from these volumes</span></span>
- <span data-ttu-id="c1818-459">L'eliminazione di eventuale esistente snapshot toomatch hello numero di snapshot specificato</span><span class="sxs-lookup"><span data-stu-id="c1818-459">Deleting eventual existing snapshots toomatch hello number of snapshots you specified</span></span>
- <span data-ttu-id="c1818-460">Creazione di uno snapshot HANA</span><span class="sxs-lookup"><span data-stu-id="c1818-460">Creating a HANA snapshot</span></span>
- <span data-ttu-id="c1818-461">Creazione di snapshot di archiviazione hello rispetto ai volumi hello</span><span class="sxs-lookup"><span data-stu-id="c1818-461">Creating hello storage snapshot over hello volumes</span></span>
- <span data-ttu-id="c1818-462">L'eliminazione di snapshot HANA hello</span><span class="sxs-lookup"><span data-stu-id="c1818-462">Deleting hello HANA snapshot</span></span>
- <span data-ttu-id="c1818-463">La ridenominazione più recente di hello snapshot troppo**,0**</span><span class="sxs-lookup"><span data-stu-id="c1818-463">Renaming hello most recent snapshot too**.0**</span></span>

<span data-ttu-id="c1818-464">parte più importante di Hello dello script hello è la seguente:</span><span class="sxs-lookup"><span data-stu-id="c1818-464">hello most important part of hello script is this:</span></span>
```
**********************Creating HANA snapshot**********************
Creating hello HANA snapshot with command: "./hdbsql -n localhost -i 01 -U SCADMIN01 "backup data create snapshot"" ...
HANA snapshot created successfully.
**********************Creating Storage snapshot**********************
Taking snapshot hourly.recent for hana_data_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for hana_log_backup_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for hana_log_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for hana_shared_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for sapmnt_lhanad01_t020_vol ...
Snapshot created successfully.
**********************Deleting HANA snapshot**********************
Deleting hello HANA snapshot with command: "./hdbsql -n localhost -i 01 -U SCADMIN01 "backup data drop snapshot"" ...
HANA snapshot deletion successfully.
```
<span data-ttu-id="c1818-465">Da questo esempio è possibile vedere come i record di script hello hello creazione dello snapshot HANA hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-465">You can see from this sample how hello script records hello creation of hello HANA snapshot.</span></span> <span data-ttu-id="c1818-466">In caso di scalabilità orizzontale hello, questo processo viene avviato sul nodo principale hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-466">In hello scale-out case, this process is initiated on hello master node.</span></span> <span data-ttu-id="c1818-467">nodo principale Hello Avvia Creazione sincrona di hello di snapshot hello in ognuno dei nodi di lavoro hello.</span><span class="sxs-lookup"><span data-stu-id="c1818-467">hello master node initiates hello synchronous creation of hello snapshots on each of hello worker nodes.</span></span> <span data-ttu-id="c1818-468">Quindi hello archiviazione dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="c1818-468">Then hello storage snapshot is taken.</span></span> <span data-ttu-id="c1818-469">Dopo l'esecuzione corretta di hello di snapshot di archiviazione hello, snapshot HANA hello viene eliminato.</span><span class="sxs-lookup"><span data-stu-id="c1818-469">After hello successful execution of hello storage snapshots, hello HANA snapshot is deleted.</span></span>
