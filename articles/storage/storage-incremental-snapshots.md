---
title: aaaUse snapshot incrementali per il backup e ripristino di dischi di macchina virtuale di Azure non gestiti | Documenti Microsoft
description: Creare una soluzione personalizzata per il backup e il ripristino dei dischi di macchine virtuali di Azure tramite snapshot incrementali.
services: storage
documentationcenter: na
author: aungoo-msft
manager: tadb
editor: tysonn
ms.assetid: 3524b987-bd65-4e35-83e7-fbc2136643e5
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/23/2017
ms.author: aungoo
ms.openlocfilehash: 6d3e6d78e953f77a1028ac35dcde1ef046dbc3bb
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="back-up-azure-unmanaged-vm-disks-with-incremental-snapshots"></a><span data-ttu-id="e7529-103">Eseguire il backup dei dischi di VM non gestiti con snapshot incrementali</span><span class="sxs-lookup"><span data-stu-id="e7529-103">Back up Azure unmanaged VM disks with incremental snapshots</span></span>
## <a name="overview"></a><span data-ttu-id="e7529-104">Panoramica</span><span class="sxs-lookup"><span data-stu-id="e7529-104">Overview</span></span>
<span data-ttu-id="e7529-105">Archiviazione di Azure fornisce funzionalità di hello tootake snapshot di BLOB.</span><span class="sxs-lookup"><span data-stu-id="e7529-105">Azure Storage provides hello capability tootake snapshots of blobs.</span></span> <span data-ttu-id="e7529-106">Gli snapshot acquisiscono lo stato di blob hello a questo punto nel tempo.</span><span class="sxs-lookup"><span data-stu-id="e7529-106">Snapshots capture hello blob state at that point in time.</span></span> <span data-ttu-id="e7529-107">In questo articolo verrà descritto uno scenario che spiega come mantenere backup dei dischi delle macchine virtuali utilizzando gli snapshot.</span><span class="sxs-lookup"><span data-stu-id="e7529-107">In this article, we will describe a scenario of how you can maintain backups of virtual machine disks using snapshots.</span></span> <span data-ttu-id="e7529-108">È possibile utilizzare questo metodo quando si sceglie di non toouse Azure Backup e ripristino nel servizio e desideri toocreate una strategia di backup personalizzata per i dischi di macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="e7529-108">You can use this methodology when you choose not toouse Azure Backup and Recovery Service, and wish toocreate a custom backup strategy for your virtual machine disks.</span></span>

<span data-ttu-id="e7529-109">I dischi delle macchine virtuali di Azure vengono archiviati come BLOB di pagine in Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="e7529-109">Azure virtual machine disks are stored as page blobs in Azure Storage.</span></span> <span data-ttu-id="e7529-110">Poiché stiamo parlando strategia di backup per i dischi di macchina virtuale in questo articolo, è possibile che si farà riferimento toosnapshots nel contesto di hello del BLOB di pagine.</span><span class="sxs-lookup"><span data-stu-id="e7529-110">Since we are talking about backup strategy for virtual machine disks in this article, we will be referring toosnapshots in hello context of page blobs.</span></span> <span data-ttu-id="e7529-111">toolearn più informazioni sugli snapshot, fare riferimento troppo[creazione di uno Snapshot di un Blob](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span><span class="sxs-lookup"><span data-stu-id="e7529-111">toolearn more about snapshots, refer too[Creating a Snapshot of a Blob](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

## <a name="what-is-a-snapshot"></a><span data-ttu-id="e7529-112">Che cos'è uno snapshot?</span><span class="sxs-lookup"><span data-stu-id="e7529-112">What is a snapshot?</span></span>
<span data-ttu-id="e7529-113">Uno snapshot di BLOB è una versione di sola lettura di un BLOB acquisito in un determinato momento.</span><span class="sxs-lookup"><span data-stu-id="e7529-113">A blob snapshot is a read-only version of a blob that is captured at a point in time.</span></span> <span data-ttu-id="e7529-114">Una volta creato uno snapshot, è possibile leggerlo, copiarlo o eliminarlo, ma non modificarlo.</span><span class="sxs-lookup"><span data-stu-id="e7529-114">Once a snapshot has been created, it can be read, copied, or deleted, but not modified.</span></span> <span data-ttu-id="e7529-115">Gli snapshot forniscono un modo tooback backup di un blob così come viene visualizzato in un momento.</span><span class="sxs-lookup"><span data-stu-id="e7529-115">Snapshots provide a way tooback up a blob as it appears at a moment in time.</span></span> <span data-ttu-id="e7529-116">Fino ad REST versione 2015-04-05 era gli snapshot di hello possibilità toocopy completo.</span><span class="sxs-lookup"><span data-stu-id="e7529-116">Until REST version 2015-04-05 you had hello ability toocopy full snapshots.</span></span> <span data-ttu-id="e7529-117">Con REST versione 2015-07-08 hello e versioni successive, è inoltre possibile copiare gli snapshot incrementali.</span><span class="sxs-lookup"><span data-stu-id="e7529-117">With hello REST version 2015-07-08 and above, you can also copy incremental snapshots.</span></span>

## <a name="full-snapshot-copy"></a><span data-ttu-id="e7529-118">Copia di snapshot completi</span><span class="sxs-lookup"><span data-stu-id="e7529-118">Full snapshot copy</span></span>
<span data-ttu-id="e7529-119">Gli snapshot possono essere copiati tooanother account di archiviazione da un backup tookeep blob del blob di base hello.</span><span class="sxs-lookup"><span data-stu-id="e7529-119">Snapshots can be copied tooanother storage account as a blob tookeep backups of hello base blob.</span></span> <span data-ttu-id="e7529-120">È inoltre possibile copiare uno snapshot sul relativo blob di base, che è simile a ripristino hello blob tooan versione precedente.</span><span class="sxs-lookup"><span data-stu-id="e7529-120">You can also copy a snapshot over its base blob, which is like restoring hello blob tooan earlier version.</span></span> <span data-ttu-id="e7529-121">Quando uno snapshot viene copiato da un tooanother di account di archiviazione, occupano hello stesso spazio come blob di pagine base hello.</span><span class="sxs-lookup"><span data-stu-id="e7529-121">When a snapshot is copied from one storage account tooanother, it will occupy hello same space as hello base page blob.</span></span> <span data-ttu-id="e7529-122">Copia l'intero snapshot da un tooanother di account di archiviazione, pertanto sarà lenta e utilizzerà anche molto spazio nell'account di archiviazione di destinazione hello.</span><span class="sxs-lookup"><span data-stu-id="e7529-122">Therefore, copying whole snapshots from one storage account tooanother will be slow and will also consume lot of space in hello target storage account.</span></span>

> [!NOTE]
> <span data-ttu-id="e7529-123">Se si copia una destinazione di tooanother hello blob di base, snapshot hello del blob di hello non vengono copiati insieme.</span><span class="sxs-lookup"><span data-stu-id="e7529-123">If you copy hello base blob tooanother destination, hello snapshots of hello blob are not copied along with it.</span></span> <span data-ttu-id="e7529-124">Analogamente, se si sovrascrive un blob di base con una copia, gli snapshot associati al blob di base hello non sono interessati e rimangono invariati con il nome di blob di base.</span><span class="sxs-lookup"><span data-stu-id="e7529-124">Similarly, if you overwrite a base blob with a copy, snapshots associated with hello base blob are not affected and stay intact under base blob name.</span></span>
> 
> 

### <a name="back-up-disks-using-snapshots"></a><span data-ttu-id="e7529-125">Backup di dischi mediante snapshot</span><span class="sxs-lookup"><span data-stu-id="e7529-125">Back up disks using snapshots</span></span>
<span data-ttu-id="e7529-126">Come una strategia di backup per i dischi di macchina virtuale, è possibile eseguire periodicamente snapshot del blob di pagina o disco hello e copiarli usando strumenti come account di archiviazione di tooanother [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) operazione o [AzCopy](storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="e7529-126">As a backup strategy for your virtual machine disks, you can take periodic snapshots of hello disk or page blob, and copy them tooanother storage account using tools like [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) operation or [AzCopy](storage-use-azcopy.md).</span></span> <span data-ttu-id="e7529-127">È possibile copiare un blob di pagine di destinazione tooa di snapshot con un nome diverso.</span><span class="sxs-lookup"><span data-stu-id="e7529-127">You can copy a snapshot tooa destination page blob with a different name.</span></span> <span data-ttu-id="e7529-128">blob di pagina di destinazione risultante Hello è un blob di pagine modificabili e non è uno snapshot.</span><span class="sxs-lookup"><span data-stu-id="e7529-128">hello resulting destination page blob is a writeable page blob and not a snapshot.</span></span> <span data-ttu-id="e7529-129">Più avanti in questo articolo si descrivono i backup tootake passaggi dei dischi di macchina virtuale utilizzando gli snapshot.</span><span class="sxs-lookup"><span data-stu-id="e7529-129">Later in this article we will describe steps tootake backups of virtual machine disks using snapshots.</span></span>

### <a name="restore-disks-using-snapshots"></a><span data-ttu-id="e7529-130">Ripristino di dischi mediante snapshot</span><span class="sxs-lookup"><span data-stu-id="e7529-130">Restore disks using snapshots</span></span>
<span data-ttu-id="e7529-131">Quando è ora toorestore stabile versione disco precedente tooa acquisita in uno degli snapshot di backup hello, è possibile copiare uno snapshot sul blob di pagine di base hello.</span><span class="sxs-lookup"><span data-stu-id="e7529-131">When it is time toorestore your disk tooa previous stable version captured in one of hello backup snapshots, you can copy a snapshot over hello base page blob.</span></span> <span data-ttu-id="e7529-132">Dopo aver snapshot hello blob di pagine di base toohello innalzate di livello, hello snapshot viene mantenuto, ma la relativa origine viene sovrascritta con una copia che può essere letta e scritta.</span><span class="sxs-lookup"><span data-stu-id="e7529-132">After hello snapshot is promoted toohello base page blob, hello snapshot remains, but its source is overwritten with a copy that can be both read and written.</span></span> <span data-ttu-id="e7529-133">Più avanti in questo articolo si descrivono passaggi toorestore una versione precedente del disco da relativi snapshot.</span><span class="sxs-lookup"><span data-stu-id="e7529-133">Later in this article we will describe steps toorestore a previous version of your disk from its snapshot.</span></span>

### <a name="implementing-full-snapshot-copy"></a><span data-ttu-id="e7529-134">Implementazione di una copia di snapshot completo</span><span class="sxs-lookup"><span data-stu-id="e7529-134">Implementing full snapshot copy</span></span>
<span data-ttu-id="e7529-135">È possibile implementare una copia completa procedendo come indicato di seguito hello,</span><span class="sxs-lookup"><span data-stu-id="e7529-135">You can implement a full snapshot copy by doing hello following,</span></span>

* <span data-ttu-id="e7529-136">Innanzitutto, creare uno snapshot del blob di base hello utilizzando hello [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) operazione.</span><span class="sxs-lookup"><span data-stu-id="e7529-136">First, take a snapshot of hello base blob using hello [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) operation.</span></span>
* <span data-ttu-id="e7529-137">Quindi, copia hello snapshot tooa destinazione account di archiviazione con [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span><span class="sxs-lookup"><span data-stu-id="e7529-137">Then, copy hello snapshot tooa target storage account using [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span></span>
* <span data-ttu-id="e7529-138">Ripetere questo processo toomaintain copie di backup il blob di base.</span><span class="sxs-lookup"><span data-stu-id="e7529-138">Repeat this process toomaintain backup copies of your base blob.</span></span>

## <a name="incremental-snapshot-copy"></a><span data-ttu-id="e7529-139">Copia di snapshot incrementale</span><span class="sxs-lookup"><span data-stu-id="e7529-139">Incremental snapshot copy</span></span>
<span data-ttu-id="e7529-140">nuova funzionalità di Hello in [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) API fornisce una quantità tooback modo migliore snapshot hello del BLOB di pagine o dischi.</span><span class="sxs-lookup"><span data-stu-id="e7529-140">hello new feature in [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) API provides a much better way tooback up hello snapshots of your page blobs or disks.</span></span> <span data-ttu-id="e7529-141">Hello API restituisce l'elenco di hello delle modifiche tra i blob di base hello e gli snapshot hello.</span><span class="sxs-lookup"><span data-stu-id="e7529-141">hello API returns hello list of changes between hello base blob and hello snapshots.</span></span> <span data-ttu-id="e7529-142">In questo modo si riduce la quantità hello spazio di archiviazione utilizzato nell'account di backup hello.</span><span class="sxs-lookup"><span data-stu-id="e7529-142">This reduces hello amount of storage space used on hello backup account.</span></span> <span data-ttu-id="e7529-143">Hello API supporta i BLOB di pagine in archiviazione Premium, nonché di archiviazione Standard.</span><span class="sxs-lookup"><span data-stu-id="e7529-143">hello API supports page blobs on Premium Storage as well as Standard Storage.</span></span> <span data-ttu-id="e7529-144">Utilizzando questa API, è possibile compilare soluzioni di backup più veloci ed efficienti per le VM di Azure.</span><span class="sxs-lookup"><span data-stu-id="e7529-144">Using this API, you can now build faster and efficient backup solutions for Azure VMs.</span></span> <span data-ttu-id="e7529-145">Questo sarà disponibile con la versione REST hello 2015-07-08 e versioni successive.</span><span class="sxs-lookup"><span data-stu-id="e7529-145">This will be available with hello REST version 2015-07-08 and higher.</span></span>

<span data-ttu-id="e7529-146">Toocopy uno storage account tooanother hello differenza tra, consente la copia dello Snapshot incrementale</span><span class="sxs-lookup"><span data-stu-id="e7529-146">Incremental Snapshot Copy allows you toocopy from one storage account tooanother hello difference between,</span></span>

* <span data-ttu-id="e7529-147">BLOB di base e relativo snapshot O</span><span class="sxs-lookup"><span data-stu-id="e7529-147">Base blob and its Snapshot OR</span></span>
* <span data-ttu-id="e7529-148">Le due snapshot di blob di base hello</span><span class="sxs-lookup"><span data-stu-id="e7529-148">Any two snapshots of hello base blob</span></span>

<span data-ttu-id="e7529-149">Condizione hello seguenti condizioni è soddisfatte,</span><span class="sxs-lookup"><span data-stu-id="e7529-149">Provided hello following conditions are met,</span></span>

* <span data-ttu-id="e7529-150">Hello blob è stato creato in gen-02-2016 o versioni successive.</span><span class="sxs-lookup"><span data-stu-id="e7529-150">hello blob was created on Jan-1-2016 or later.</span></span>
* <span data-ttu-id="e7529-151">blob di Hello non è stato sovrascritto con [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) o [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) tra due snapshot.</span><span class="sxs-lookup"><span data-stu-id="e7529-151">hello blob was not overwritten with [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) or [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) between two snapshots.</span></span>

<span data-ttu-id="e7529-152">**Nota**: questa funzionalità è disponibile per i BLOB di pagine di Azure Standard e Premium.</span><span class="sxs-lookup"><span data-stu-id="e7529-152">**Note**: This feature is available for Premium and Standard Azure Page Blobs.</span></span>

<span data-ttu-id="e7529-153">Caso di una strategia di backup personalizzata che usa gli snapshot, la copia snapshot hello da uno tooanother di account di archiviazione può essere molto lenta e richiede una maggiore quantità di spazio di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="e7529-153">When you have a custom backup strategy that uses snapshots, copying hello snapshots from one storage account tooanother can be very slow and consumes a lot of storage space.</span></span> <span data-ttu-id="e7529-154">Invece di copiare account di archiviazione di backup tooa intero snapshot hello, è possibile scrivere i blob di pagine di backup di snapshot consecutive tooa di differenza hello.</span><span class="sxs-lookup"><span data-stu-id="e7529-154">Instead of copying hello entire snapshot tooa backup storage account, you can write hello difference between consecutive snapshots tooa backup page blob.</span></span> <span data-ttu-id="e7529-155">In questo modo, backup toostore toocopy e spazio hello ora risulta notevolmente ridotto.</span><span class="sxs-lookup"><span data-stu-id="e7529-155">This way, hello time toocopy and space toostore backups is substantially reduced.</span></span>

### <a name="implementing-incremental-snapshot-copy"></a><span data-ttu-id="e7529-156">Implementazione di una copia di snapshot incrementale</span><span class="sxs-lookup"><span data-stu-id="e7529-156">Implementing Incremental Snapshot Copy</span></span>
<span data-ttu-id="e7529-157">È possibile implementare la copia dello snapshot incrementale eseguendo hello seguenti,</span><span class="sxs-lookup"><span data-stu-id="e7529-157">You can implement incremental snapshot copy by doing hello following,</span></span>

* <span data-ttu-id="e7529-158">Creare uno snapshot dell'utilizzo di blob di base hello [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx).</span><span class="sxs-lookup"><span data-stu-id="e7529-158">Take a snapshot of hello base blob using [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx).</span></span>
* <span data-ttu-id="e7529-159">Copia hello snapshot toohello destinazione backup account di archiviazione con [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span><span class="sxs-lookup"><span data-stu-id="e7529-159">Copy hello snapshot toohello target backup storage account using [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span></span> <span data-ttu-id="e7529-160">Questo sarà il blob di pagine di backup di hello.</span><span class="sxs-lookup"><span data-stu-id="e7529-160">This will be hello backup page blob.</span></span> <span data-ttu-id="e7529-161">Creare uno snapshot di questo BLOB di pagine di backup e archiviarlo in un account di backup.</span><span class="sxs-lookup"><span data-stu-id="e7529-161">Take a snapshot of this backup page blob and store in backup account.</span></span>
* <span data-ttu-id="e7529-162">Creare un altro snapshot del blob di base hello utilizzando Snapshot Blob.</span><span class="sxs-lookup"><span data-stu-id="e7529-162">Take another snapshot of hello base blob using Snapshot Blob.</span></span>
* <span data-ttu-id="e7529-163">Ottenere la differenza hello tra primo e il secondo snapshot dell'utilizzo di blob di base [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx).</span><span class="sxs-lookup"><span data-stu-id="e7529-163">Get hello difference between first and second snapshots of base blob using  [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx).</span></span> <span data-ttu-id="e7529-164">Utilizzare il nuovo parametro di hello **prevsnapshot** toospecify hello hello snapshot di differenza hello tooget con valore DateTime.</span><span class="sxs-lookup"><span data-stu-id="e7529-164">Use hello new parameter **prevsnapshot** toospecify hello DateTime value of hello snapshot you want tooget hello difference with.</span></span> <span data-ttu-id="e7529-165">Quando questo parametro è presente, hello risposta REST include solo le pagine hello che sono state modificate tra snapshot di destinazione e allo snapshot precedente, incluse le pagine non crittografate.</span><span class="sxs-lookup"><span data-stu-id="e7529-165">When this parameter is present, hello REST response will include only hello pages that were changed between target snapshot and previous snapshot including clear pages.</span></span>
* <span data-ttu-id="e7529-166">Utilizzare [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) tooapply questi blob di pagine backup toohello di modifiche.</span><span class="sxs-lookup"><span data-stu-id="e7529-166">Use [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) tooapply these changes toohello backup page blob.</span></span>
* <span data-ttu-id="e7529-167">Infine, creare uno snapshot del blob di pagine backup hello e archiviarla nell'account di archiviazione di backup hello.</span><span class="sxs-lookup"><span data-stu-id="e7529-167">Finally, take a snapshot of hello backup page blob and store it in hello backup storage account.</span></span>

<span data-ttu-id="e7529-168">Nella sezione successiva hello, si descrive in dettaglio come è possibile gestire i backup di dischi tramite la copia dello Snapshot incrementale</span><span class="sxs-lookup"><span data-stu-id="e7529-168">In hello next section, we will describe in more detail how you can maintain backups of disks using Incremental Snapshot Copy</span></span>

## <a name="scenario"></a><span data-ttu-id="e7529-169">Scenario</span><span class="sxs-lookup"><span data-stu-id="e7529-169">Scenario</span></span>
<span data-ttu-id="e7529-170">In questa sezione verrà descritto uno scenario che comporta una strategia di backup personalizzata per i dischi di macchine virtuali utilizzando gli snapshot.</span><span class="sxs-lookup"><span data-stu-id="e7529-170">In this section we will describe a scenario that involves a custom backup strategy for virtual machine disks using snapshots.</span></span>

<span data-ttu-id="e7529-171">Si consideri una VM Azure serie DS a cui è collegato un disco P30 di Archiviazione Premium.</span><span class="sxs-lookup"><span data-stu-id="e7529-171">Consider a DS-series Azure VM with a premium storage P30 disk attached.</span></span> <span data-ttu-id="e7529-172">disco Hello P30 chiamato *mypremiumdisk* viene archiviato in un account di archiviazione premium denominato *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="e7529-172">hello P30 disk called *mypremiumdisk* is stored in a premium storage account called *mypremiumaccount*.</span></span> <span data-ttu-id="e7529-173">Un account di archiviazione standard denominato *mybackupstdaccount* verrà utilizzato per archiviare i backup hello del *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="e7529-173">A standard storage account called *mybackupstdaccount* will be used for storing hello backup of *mypremiumdisk*.</span></span> <span data-ttu-id="e7529-174">Desideriamo tookeep uno snapshot di *mypremiumdisk* ogni 12 ore.</span><span class="sxs-lookup"><span data-stu-id="e7529-174">We would like tookeep a snapshot of *mypremiumdisk* every 12 hours.</span></span>

<span data-ttu-id="e7529-175">toolearn sulla creazione di account di archiviazione e dischi, fare riferimento troppo[gli account di archiviazione di Azure su](storage-create-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="e7529-175">toolearn about creating storage account and disks, refer too[About Azure storage accounts](storage-create-storage-account.md).</span></span>

<span data-ttu-id="e7529-176">toolearn sul backup di macchine virtuali di Azure, fare riferimento troppo[i backup di macchina virtuale di Azure prevede](../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="e7529-176">toolearn about backing up Azure VMs, refer too[Plan Azure VM backups](../backup/backup-azure-vms-introduction.md).</span></span>

## <a name="steps-toomaintain-backups-of-a-disk-using-incremental-snapshots"></a><span data-ttu-id="e7529-177">Backup toomaintain passaggi di un disco con snapshot incrementali</span><span class="sxs-lookup"><span data-stu-id="e7529-177">Steps toomaintain backups of a disk using incremental snapshots</span></span>
<span data-ttu-id="e7529-178">Hello passaggi descritti di seguito verranno istantanee di *mypremiumdisk* e gestire i backup hello in *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="e7529-178">hello steps described below will take snapshots of *mypremiumdisk* and maintain hello backups in *mybackupstdaccount*.</span></span> <span data-ttu-id="e7529-179">Hello backup sarà un blob di pagine standard chiamato *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="e7529-179">hello backup will be a standard page blob called *mybackupstdpageblob*.</span></span> <span data-ttu-id="e7529-180">Hello blob di pagine backup rifletterà sempre hello stesso stato come ultimo hello dei *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="e7529-180">hello backup page blob will always reflect hello same state as hello last snapshot of *mypremiumdisk*.</span></span>

1. <span data-ttu-id="e7529-181">Innanzitutto, creare blob di pagine backup hello per il disco di archiviazione premium.</span><span class="sxs-lookup"><span data-stu-id="e7529-181">First, create hello backup page blob for your premium storage disk.</span></span> <span data-ttu-id="e7529-182">toodo, creare uno snapshot di *mypremiumdisk* chiamato *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="e7529-182">toodo this, take a snapshot of *mypremiumdisk* called *mypremiumdisk_ss1*.</span></span>
2. <span data-ttu-id="e7529-183">Copiare questo toomybackupstdaccount snapshot come blob di pagine chiamato *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="e7529-183">Copy this snapshot toomybackupstdaccount as a page blob called *mybackupstdpageblob*.</span></span>
3. <span data-ttu-id="e7529-184">Creare uno snapshot di *mybackupstdpageblob* denominato *mybackupstdpageblob_ss1* usando [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) e archiviarlo in *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="e7529-184">Take a snapshot of *mybackupstdpageblob* called *mybackupstdpageblob_ss1*, using [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) and store it in *mybackupstdaccount*.</span></span>
4. <span data-ttu-id="e7529-185">Durante la finestra di backup hello, creare un altro snapshot di *mypremiumdisk*, ad esempio *mypremiumdisk_ss2*e archiviarlo nella *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="e7529-185">During hello backup window, create another snapshot of *mypremiumdisk*, say *mypremiumdisk_ss2*, and store it in *mypremiumaccount*.</span></span>
5. <span data-ttu-id="e7529-186">Ottenere le modifiche incrementali hello tra gli snapshot hello due, *mypremiumdisk_ss2* e *mypremiumdisk_ss1*tramite [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) su  *mypremiumdisk_ss2* con **prevsnapshot** parametro impostato timestamp toohello di *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="e7529-186">Get hello incremental changes between hello two snapshots, *mypremiumdisk_ss2* and *mypremiumdisk_ss1*, using [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) on *mypremiumdisk_ss2* with **prevsnapshot** parameter set toohello timestamp of *mypremiumdisk_ss1*.</span></span> <span data-ttu-id="e7529-187">Scrittura di blob di pagina backup toohello queste modifiche incrementali *mybackupstdpageblob* in *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="e7529-187">Write these incremental changes toohello backup page blob *mybackupstdpageblob* in *mybackupstdaccount*.</span></span> <span data-ttu-id="e7529-188">Se sono presenti intervalli eliminati le modifiche incrementali hello, deve essere cancellati dal blob di pagine di backup di hello.</span><span class="sxs-lookup"><span data-stu-id="e7529-188">If there are deleted ranges in hello incremental changes, they must be cleared from hello backup page blob.</span></span> <span data-ttu-id="e7529-189">Utilizzare [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) blob di pagine di backup di toowrite modifiche incrementali toohello.</span><span class="sxs-lookup"><span data-stu-id="e7529-189">Use [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) toowrite incremental changes toohello backup page blob.</span></span>
6. <span data-ttu-id="e7529-190">Creare uno snapshot del blob di pagine backup hello *mybackupstdpageblob*, denominato *mybackupstdpageblob_ss2*.</span><span class="sxs-lookup"><span data-stu-id="e7529-190">Take a snapshot of hello backup page blob *mybackupstdpageblob*, called *mybackupstdpageblob_ss2*.</span></span> <span data-ttu-id="e7529-191">Eliminare lo snapshot precedente hello *mypremiumdisk_ss1* dall'account di archiviazione premium.</span><span class="sxs-lookup"><span data-stu-id="e7529-191">Delete hello previous snapshot *mypremiumdisk_ss1* from premium storage account.</span></span>
7. <span data-ttu-id="e7529-192">Ripetere i passaggi da 4 a 6 per ogni finestra di backup.</span><span class="sxs-lookup"><span data-stu-id="e7529-192">Repeat steps 4-6 every backup window.</span></span> <span data-ttu-id="e7529-193">In questo modo, è possibile gestire i backup di *mypremiumdisk* in un account di Archiviazione Standard.</span><span class="sxs-lookup"><span data-stu-id="e7529-193">In this way, you can maintain backups of *mypremiumdisk* in a standard storage account.</span></span>

![Eseguire il backup dei dischi con snapshot incrementali](./media/storage-incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-toorestore-a-disk-from-snapshots"></a><span data-ttu-id="e7529-195">Passaggi toorestore un disco da snapshot</span><span class="sxs-lookup"><span data-stu-id="e7529-195">Steps toorestore a disk from snapshots</span></span>
<span data-ttu-id="e7529-196">Hello passaggi descritti di seguito verranno ripristinati disco premium, *mypremiumdisk* tooan snapshot in precedenza dall'account di archiviazione di backup hello *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="e7529-196">hello steps described below will restore premium disk, *mypremiumdisk* tooan earlier snapshot from hello backup storage account *mybackupstdaccount*.</span></span>

1. <span data-ttu-id="e7529-197">Identificare hello momento che si desidera toorestore hello premium disco.</span><span class="sxs-lookup"><span data-stu-id="e7529-197">Identify hello point in time you wish toorestore hello premium disk to.</span></span> <span data-ttu-id="e7529-198">Si supponga che è snapshot *mybackupstdpageblob_ss2*, che viene archiviato nell'account di archiviazione di backup hello *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="e7529-198">Let's say that is snapshot *mybackupstdpageblob_ss2*, which is stored in hello backup storage account *mybackupstdaccount*.</span></span>
2. <span data-ttu-id="e7529-199">In mybackupstdaccount, alzare di livello snapshot hello *mybackupstdpageblob_ss2* come blob di pagine di base backup nuovo hello *mybackupstdpageblobrestored*.</span><span class="sxs-lookup"><span data-stu-id="e7529-199">In mybackupstdaccount, promote hello snapshot *mybackupstdpageblob_ss2* as hello new backup base page blob *mybackupstdpageblobrestored*.</span></span>
3. <span data-ttu-id="e7529-200">Creare uno snapshot di questo BLOB di pagine di backup ripristinato, denominato *mybackupstdpageblobrestored_ss1*.</span><span class="sxs-lookup"><span data-stu-id="e7529-200">Take a snapshot of this restored backup page blob, called *mybackupstdpageblobrestored_ss1*.</span></span>
4. <span data-ttu-id="e7529-201">Blob di pagine di copia hello ripristinato *mybackupstdpageblobrestored* da *mybackupstdaccount* troppo*mypremiumaccount* come disco premium nuovo hello  *mypremiumdiskrestored*.</span><span class="sxs-lookup"><span data-stu-id="e7529-201">Copy hello restored page blob *mybackupstdpageblobrestored* from *mybackupstdaccount* too*mypremiumaccount* as hello new premium disk *mypremiumdiskrestored*.</span></span>
5. <span data-ttu-id="e7529-202">Creare uno snapshot di *mypremiumdiskrestored* denominato *mypremiumdiskrestored_ss1* per le future operazioni di backup incrementale.</span><span class="sxs-lookup"><span data-stu-id="e7529-202">Take a snapshot of *mypremiumdiskrestored*, called *mypremiumdiskrestored_ss1* for making future incremental backups.</span></span>
6. <span data-ttu-id="e7529-203">Punto serie DS hello disco della macchina virtuale ripristinata toohello *mypremiumdiskrestored* e scollegare hello precedente *mypremiumdisk* da hello macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="e7529-203">Point hello DS series VM toohello restored disk *mypremiumdiskrestored* and detach hello old *mypremiumdisk* from hello VM.</span></span>
7. <span data-ttu-id="e7529-204">Avviare il processo di Backup hello descritto nella sezione precedente per il disco di ripristino hello *mypremiumdiskrestored*, utilizzando hello *mybackupstdpageblobrestored* come blob di pagine backup hello.</span><span class="sxs-lookup"><span data-stu-id="e7529-204">Begin hello Backup process described in previous section for hello restored disk *mypremiumdiskrestored*, using hello *mybackupstdpageblobrestored* as hello backup page blob.</span></span>

![Ripristino del disco da snapshot](./media/storage-incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a><span data-ttu-id="e7529-206">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="e7529-206">Next Steps</span></span>
<span data-ttu-id="e7529-207">Ulteriori informazioni sulla creazione di snapshot di un blob e pianificazione dell'infrastruttura di backup di VM usando hello collegamenti seguenti.</span><span class="sxs-lookup"><span data-stu-id="e7529-207">Learn more about creating snapshots of a blob and planning your VM backup infrastructure using hello links below.</span></span>

* [<span data-ttu-id="e7529-208">Creazione di uno snapshot di un BLOB</span><span class="sxs-lookup"><span data-stu-id="e7529-208">Creating a Snapshot of a Blob</span></span>](https://msdn.microsoft.com/library/azure/hh488361.aspx)
* [<span data-ttu-id="e7529-209">Pianificare l'infrastruttura di backup delle VM</span><span class="sxs-lookup"><span data-stu-id="e7529-209">Plan your VM Backup Infrastructure</span></span>](../backup/backup-azure-vms-introduction.md)

