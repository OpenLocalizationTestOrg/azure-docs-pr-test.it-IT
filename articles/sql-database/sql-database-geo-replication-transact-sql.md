---
title: replica geografica aaaConfigure per Database SQL di Azure con Transact-SQL | Documenti Microsoft
description: Configurare la replica geografica per il database SQL di Azure con Transact-SQL
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: d94d89a6-3234-46c5-8279-5eb8daad10ac
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/14/2017
ms.author: carlrab
ms.openlocfilehash: 295b6b12f257dfb15131d5ee28fbe65c6476352d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="configure-active-geo-replication-for-azure-sql-database-with-transact-sql"></a><span data-ttu-id="63381-103">Configurare la replica geografica attiva per il database SQL di Azure con Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="63381-103">Configure active geo-replication for Azure SQL Database with Transact-SQL</span></span>

<span data-ttu-id="63381-104">In questo articolo illustra come tooconfigure replica geografica attiva per un Database di SQL Azure con Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="63381-104">This article shows you how tooconfigure active geo-replication for an Azure SQL Database with Transact-SQL.</span></span>

<span data-ttu-id="63381-105">failover tooinitiate utilizzando Transact-SQL, vedere [avviare un failover pianificato o per il Database di SQL Azure con Transact-SQL](sql-database-geo-replication-failover-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="63381-105">tooinitiate failover using Transact-SQL, see [Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL](sql-database-geo-replication-failover-transact-sql.md).</span></span>

> [!NOTE]
> <span data-ttu-id="63381-106">Quando si utilizza la replica geografica attiva (repliche secondarie leggibili) per il ripristino di emergenza è necessario configurare un gruppo di failover per tutti i database all'interno di un failover automatico e trasparente tooenable dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="63381-106">When you use active geo-replication (readable secondaries) for disaster recovery you should configure a failover group for all databases within an application tooenable automatic and transparent failover.</span></span> <span data-ttu-id="63381-107">Questa funzionalità è in anteprima.</span><span class="sxs-lookup"><span data-stu-id="63381-107">This feature is in preview.</span></span> <span data-ttu-id="63381-108">Per altre informazioni vedere [Panoramica: Replica geografica attiva per il database SQL di Azure](sql-database-geo-replication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="63381-108">For more information see [Auto-failover groups and geo-replication](sql-database-geo-replication-overview.md).</span></span>
> 
> 

<span data-ttu-id="63381-109">replica geografica tooconfigure attiva tramite Transact-SQL, è necessario seguente hello:</span><span class="sxs-lookup"><span data-stu-id="63381-109">tooconfigure active geo-replication using Transact-SQL, you need hello following:</span></span>

* <span data-ttu-id="63381-110">Una sottoscrizione di Azure.</span><span class="sxs-lookup"><span data-stu-id="63381-110">An Azure subscription</span></span>
* <span data-ttu-id="63381-111">Un server logico di Database SQL di Azure <MyLocalServer> e un database SQL <MyDB> -database primario di hello che si desidera tooreplicate</span><span class="sxs-lookup"><span data-stu-id="63381-111">A logical Azure SQL Database server <MyLocalServer> and a SQL database <MyDB> - hello primary database that you want tooreplicate</span></span>
* <span data-ttu-id="63381-112">Uno o più Database SQL di Azure server logici < MySecondaryServer(n) > - hello server logici che fungerà da server partner hello in cui si creerà un database secondario</span><span class="sxs-lookup"><span data-stu-id="63381-112">One or more logical Azure SQL Database servers <MySecondaryServer(n)> - hello logical servers that will be hello partner servers in which you will create secondary databases</span></span>
* <span data-ttu-id="63381-113">Un account di accesso DBManager su hello primario</span><span class="sxs-lookup"><span data-stu-id="63381-113">A login that is DBManager on hello primary</span></span>
* <span data-ttu-id="63381-114">Avere db_ownership del database locale di hello che sia necessario abilitare la replica geografica</span><span class="sxs-lookup"><span data-stu-id="63381-114">Have db_ownership of hello local database that you will geo-replicate</span></span>
* <span data-ttu-id="63381-115">Essere DBManager in toowhich server partner di hello verrà configurata la replica geografica</span><span class="sxs-lookup"><span data-stu-id="63381-115">Be DBManager on hello partner server(s) toowhich you will configure geo-replication</span></span>
* <span data-ttu-id="63381-116">versione più recente Hello di SQL Server Management Studio (SSMS)</span><span class="sxs-lookup"><span data-stu-id="63381-116">hello newest version of SQL Server Management Studio (SSMS)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="63381-117">È consigliabile utilizzare sempre hello versione più recente di Management Studio tooremain sincronizzati con gli aggiornamenti tooMicrosoft Azure e il Database SQL.</span><span class="sxs-lookup"><span data-stu-id="63381-117">It is recommended that you always use hello latest version of Management Studio tooremain synchronized with updates tooMicrosoft Azure and SQL Database.</span></span> <span data-ttu-id="63381-118">[Aggiornare SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="63381-118">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>
> 
> 

## <a name="add-secondary-database"></a><span data-ttu-id="63381-119">Aggiungere un database secondario</span><span class="sxs-lookup"><span data-stu-id="63381-119">Add secondary database</span></span>
<span data-ttu-id="63381-120">È possibile utilizzare hello **ALTER DATABASE** istruzione toocreate un database secondario in un server partner di replica geografica.</span><span class="sxs-lookup"><span data-stu-id="63381-120">You can use hello **ALTER DATABASE** statement toocreate a geo-replicated secondary database on a partner server.</span></span> <span data-ttu-id="63381-121">Eseguire questa istruzione nel database master hello hello server contiene hello database toobe replicati.</span><span class="sxs-lookup"><span data-stu-id="63381-121">You execute this statement on hello master database of hello server containing hello database toobe replicated.</span></span> <span data-ttu-id="63381-122">Hello database di replica geografica (Buongiorno "database primario") sarà necessario hello stesso nome di database hello in corso la replica e che, per impostazione predefinita, dispone di hello stesso livello di servizio come database primario hello.</span><span class="sxs-lookup"><span data-stu-id="63381-122">hello geo-replicated database (hello "primary database") will have hello same name as hello database being replicated and will, by default, have hello same service level as hello primary database.</span></span> <span data-ttu-id="63381-123">Hello database secondario può essere leggibile o non leggibile e può essere un singolo database o in un pool elastico.</span><span class="sxs-lookup"><span data-stu-id="63381-123">hello secondary database can be readable or non-readable, and can be a single database or in an elastic pool.</span></span> <span data-ttu-id="63381-124">Per altre informazioni, vedere [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) e [Livelli di servizio](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="63381-124">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>
<span data-ttu-id="63381-125">Dopo aver creato e sottoposto a seeding, database secondario hello dati verranno avviata la replica in modo asincrono dal database primario hello.</span><span class="sxs-lookup"><span data-stu-id="63381-125">After hello secondary database is created and seeded, data will begin replicating asynchronously from hello primary database.</span></span> <span data-ttu-id="63381-126">Hello riportato di seguito viene descritta la modalità replica geografica tooconfigure utilizzando Management Studio.</span><span class="sxs-lookup"><span data-stu-id="63381-126">hello steps below describe how tooconfigure geo-replication using Management Studio.</span></span> <span data-ttu-id="63381-127">Vengono forniti passaggi toocreate non leggibile e leggibili database secondari, come un singolo database o in un pool elastico.</span><span class="sxs-lookup"><span data-stu-id="63381-127">Steps toocreate non-readable and readable secondaries, either as a single database or in an elastic pool, are provided.</span></span>

> [!NOTE]
> <span data-ttu-id="63381-128">Se è presente un database nel server partner specificato hello con hello stesso nome come hello database primario hello comando avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="63381-128">If a database exists on hello specified partner server with hello same name as hello primary database hello command will fail.</span></span>
> 

### <a name="add-readable-secondary-single-database"></a><span data-ttu-id="63381-129">Aggiungere un database secondario accessibile in lettura (database singolo)</span><span class="sxs-lookup"><span data-stu-id="63381-129">Add readable secondary (single database)</span></span>
<span data-ttu-id="63381-130">Utilizzare hello seguendo i passaggi toocreate un database secondario leggibile come un singolo database.</span><span class="sxs-lookup"><span data-stu-id="63381-130">Use hello following steps toocreate a readable secondary as a single database.</span></span>

1. <span data-ttu-id="63381-131">In Management Studio, connettersi tooyour server logico di Database SQL di Azure.</span><span class="sxs-lookup"><span data-stu-id="63381-131">In Management Studio, connect tooyour Azure SQL Database logical server.</span></span>
2. <span data-ttu-id="63381-132">Aprire hello cartella del database, espandere hello **database di sistema** pulsante destro del mouse nella cartella **master**, quindi fare clic su **nuova Query**.</span><span class="sxs-lookup"><span data-stu-id="63381-132">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="63381-133">Utilizzare la seguente hello **ALTER DATABASE** istruzione toomake un database locale in un database primario-replica geografica con un database secondario leggibile in un server secondario.</span><span class="sxs-lookup"><span data-stu-id="63381-133">Use hello following **ALTER DATABASE** statement toomake a local database into a geo-replication primary with a readable secondary database on a secondary server.</span></span>
   
        ALTER DATABASE <MyDB>
           ADD SECONDARY ON SERVER <MySecondaryServer2> WITH (ALLOW_CONNECTIONS = ALL);
4. <span data-ttu-id="63381-134">Fare clic su **Execute** query hello toorun.</span><span class="sxs-lookup"><span data-stu-id="63381-134">Click **Execute** toorun hello query.</span></span>

### <a name="add-readable-secondary-elastic-pool"></a><span data-ttu-id="63381-135">Aggiungere un database secondario leggibile (pool elastico)</span><span class="sxs-lookup"><span data-stu-id="63381-135">Add readable secondary (elastic pool)</span></span>
<span data-ttu-id="63381-136">Utilizzare i seguenti passaggi toocreate un database secondario leggibile di un pool elastico hello.</span><span class="sxs-lookup"><span data-stu-id="63381-136">Use hello following steps toocreate a readable secondary in an elastic pool.</span></span>

1. <span data-ttu-id="63381-137">In Management Studio, connettersi tooyour server logico di Database SQL di Azure.</span><span class="sxs-lookup"><span data-stu-id="63381-137">In Management Studio, connect tooyour Azure SQL Database logical server.</span></span>
2. <span data-ttu-id="63381-138">Aprire hello cartella del database, espandere hello **database di sistema** pulsante destro del mouse nella cartella **master**, quindi fare clic su **nuova Query**.</span><span class="sxs-lookup"><span data-stu-id="63381-138">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="63381-139">Utilizzare la seguente hello **ALTER DATABASE** istruzione toomake un database locale in un database primario-replica geografica con un database secondario leggibile in un server secondario in un pool elastico.</span><span class="sxs-lookup"><span data-stu-id="63381-139">Use hello following **ALTER DATABASE** statement toomake a local database into a geo-replication primary with a readable secondary database on a secondary server in an elastic pool.</span></span>
   
        ALTER DATABASE <MyDB>
           ADD SECONDARY ON SERVER <MySecondaryServer4> WITH (ALLOW_CONNECTIONS = ALL
           , SERVICE_OBJECTIVE = ELASTIC_POOL (name = MyElasticPool2));
4. <span data-ttu-id="63381-140">Fare clic su **Execute** query hello toorun.</span><span class="sxs-lookup"><span data-stu-id="63381-140">Click **Execute** toorun hello query.</span></span>

## <a name="remove-secondary-database"></a><span data-ttu-id="63381-141">Rimuovere un database secondario</span><span class="sxs-lookup"><span data-stu-id="63381-141">Remove secondary database</span></span>
<span data-ttu-id="63381-142">È possibile utilizzare hello **ALTER DATABASE** istruzione toopermanently terminare la relazione di replica hello tra un database secondario e principale.</span><span class="sxs-lookup"><span data-stu-id="63381-142">You can use hello **ALTER DATABASE** statement toopermanently terminate hello replication partnership between a secondary database and its primary.</span></span> <span data-ttu-id="63381-143">Questa istruzione viene eseguita nel database master di hello in cui hello risiede il database primario.</span><span class="sxs-lookup"><span data-stu-id="63381-143">This statement is executed on hello master database on which hello primary database resides.</span></span> <span data-ttu-id="63381-144">Dopo la terminazione di relazione hello, database secondario hello diventa un database di lettura / scrittura normale.</span><span class="sxs-lookup"><span data-stu-id="63381-144">After hello relationship termination, hello secondary database becomes a regular read-write database.</span></span> <span data-ttu-id="63381-145">Se il database di toosecondary hello connettività è interrotta hello comando ha esito positivo ma hello secondario diventeranno di lettura / scrittura dopo il ripristino della connettività.</span><span class="sxs-lookup"><span data-stu-id="63381-145">If hello connectivity toosecondary database is broken hello command succeeds but hello secondary will become read-write after connectivity is restored.</span></span> <span data-ttu-id="63381-146">Per altre informazioni, vedere [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) e [Livelli di servizio](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="63381-146">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>

<span data-ttu-id="63381-147">Utilizzare hello seguente secondario di replica geografica tooremove passaggi da una relazione di replica geografica.</span><span class="sxs-lookup"><span data-stu-id="63381-147">Use hello following steps tooremove geo-replicated secondary from a geo-replication partnership.</span></span>

1. <span data-ttu-id="63381-148">In Management Studio, connettersi tooyour server logico di Database SQL di Azure.</span><span class="sxs-lookup"><span data-stu-id="63381-148">In Management Studio, connect tooyour Azure SQL Database logical server.</span></span>
2. <span data-ttu-id="63381-149">Aprire hello cartella del database, espandere hello **database di sistema** pulsante destro del mouse nella cartella **master**, quindi fare clic su **nuova Query**.</span><span class="sxs-lookup"><span data-stu-id="63381-149">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="63381-150">Utilizzare la seguente hello **ALTER DATABASE** secondario tooremove replica geografica di istruzione.</span><span class="sxs-lookup"><span data-stu-id="63381-150">Use hello following **ALTER DATABASE** statement tooremove a geo-replicated secondary.</span></span>
   
        ALTER DATABASE <MyDB>
           REMOVE SECONDARY ON SERVER <MySecondaryServer1>;
4. <span data-ttu-id="63381-151">Fare clic su **Execute** query hello toorun.</span><span class="sxs-lookup"><span data-stu-id="63381-151">Click **Execute** toorun hello query.</span></span>

## <a name="monitor-active-geo-replication-configuration-and-health"></a><span data-ttu-id="63381-152">Monitorare l'integrità e la configurazione della replica geografica attiva</span><span class="sxs-lookup"><span data-stu-id="63381-152">Monitor active geo-replication configuration and health</span></span>

<span data-ttu-id="63381-153">Attività di monitoraggio includono il monitoraggio della configurazione di replica geografica hello e monitoraggio dello stato di replica di dati.</span><span class="sxs-lookup"><span data-stu-id="63381-153">Monitoring tasks include monitoring of hello geo-replication configuration and monitoring data replication health.</span></span>  <span data-ttu-id="63381-154">È possibile utilizzare hello **sys.dm_geo_replication_links** vista a gestione dinamica hello database master tooreturn informazioni su tutti i collegamenti di replica esistente per ogni database nel server logico di Database SQL di Azure hello.</span><span class="sxs-lookup"><span data-stu-id="63381-154">You can use hello **sys.dm_geo_replication_links** dynamic management view in hello master database tooreturn information about all exiting replication links for each database on hello Azure SQL Database logical server.</span></span> <span data-ttu-id="63381-155">Questa vista contiene una riga per ogni hello collegamento di replica tra database primario e secondari.</span><span class="sxs-lookup"><span data-stu-id="63381-155">This view contains a row for each of hello replication link between primary and secondary databases.</span></span> <span data-ttu-id="63381-156">È possibile utilizzare hello **sys.dm_replication_link_status** vista a gestione dinamica tooreturn una riga per ogni Database di SQL Azure è attualmente occupato in un collegamento di replica di replica.</span><span class="sxs-lookup"><span data-stu-id="63381-156">You can use hello **sys.dm_replication_link_status** dynamic management view tooreturn a row for each Azure SQL Database that is currently engaged in a replication replication link.</span></span> <span data-ttu-id="63381-157">Sono inclusi il database primario e i database secondari.</span><span class="sxs-lookup"><span data-stu-id="63381-157">This includes both primary and secondary databases.</span></span> <span data-ttu-id="63381-158">Se è presente più di un collegamento di replica continua per un determinato database primario, questa tabella contiene una riga per ognuna delle relazioni hello.</span><span class="sxs-lookup"><span data-stu-id="63381-158">If more than one continuous replication link exists for a given primary database, this table contains a row for each of hello relationships.</span></span> <span data-ttu-id="63381-159">visualizzazione di Hello viene creato in tutti i database, tra cui master logico hello.</span><span class="sxs-lookup"><span data-stu-id="63381-159">hello view is created in all databases, including hello logical master.</span></span> <span data-ttu-id="63381-160">Tuttavia, l'esecuzione di query in questa vista nel database master logico hello restituisce un set vuoto.</span><span class="sxs-lookup"><span data-stu-id="63381-160">However, querying this view in hello logical master returns an empty set.</span></span> <span data-ttu-id="63381-161">È possibile utilizzare hello **Sys.dm operation_status** stato hello tooshow vista a gestione dinamica per tutte le operazioni, incluso lo stato di hello hello dei collegamenti di replica di database.</span><span class="sxs-lookup"><span data-stu-id="63381-161">You can use hello **sys.dm_operation_status** dynamic management view tooshow hello status for all database operations including hello status of hello replication links.</span></span> <span data-ttu-id="63381-162">Per altre informazioni, vedere [sys.geo_replication_links (database SQL di Azure)](https://msdn.microsoft.com/library/mt575501.aspx), [sys.dm_geo_replication_link_status (database SQL di Azure)](https://msdn.microsoft.com/library/mt575504.aspx) e [sys.dm_operation_status (database SQL di Azure)](https://msdn.microsoft.com/library/dn270022.aspx).</span><span class="sxs-lookup"><span data-stu-id="63381-162">For more information, see [sys.geo_replication_links (Azure SQL Database)](https://msdn.microsoft.com/library/mt575501.aspx), [sys.dm_geo_replication_link_status (Azure SQL Database)](https://msdn.microsoft.com/library/mt575504.aspx), and [sys.dm_operation_status (Azure SQL Database)](https://msdn.microsoft.com/library/dn270022.aspx).</span></span>

<span data-ttu-id="63381-163">Utilizzare hello partnership toomonitor una replica geografica attiva i passaggi seguenti.</span><span class="sxs-lookup"><span data-stu-id="63381-163">Use hello following steps toomonitor an active geo-replication partnership.</span></span>

1. <span data-ttu-id="63381-164">In Management Studio, connettersi tooyour server logico di Database SQL di Azure.</span><span class="sxs-lookup"><span data-stu-id="63381-164">In Management Studio, connect tooyour Azure SQL Database logical server.</span></span>
2. <span data-ttu-id="63381-165">Aprire hello cartella del database, espandere hello **database di sistema** pulsante destro del mouse nella cartella **master**, quindi fare clic su **nuova Query**.</span><span class="sxs-lookup"><span data-stu-id="63381-165">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="63381-166">Utilizzare hello seguente istruzione tooshow tutti i database con i collegamenti di replica geografica.</span><span class="sxs-lookup"><span data-stu-id="63381-166">Use hello following statement tooshow all databases with geo-replication links.</span></span>
   
        SELECT database_id, start_date, modify_date, partner_server, partner_database, replication_state_desc, role, secondary_allow_connections_desc FROM sys.geo_replication_links;
4. <span data-ttu-id="63381-167">Fare clic su **Execute** query hello toorun.</span><span class="sxs-lookup"><span data-stu-id="63381-167">Click **Execute** toorun hello query.</span></span>
5. <span data-ttu-id="63381-168">Aprire hello cartella del database, espandere hello **database di sistema** pulsante destro del mouse nella cartella **MyDB**, quindi fare clic su **nuova Query**.</span><span class="sxs-lookup"><span data-stu-id="63381-168">Open hello Databases folder, expand hello **System Databases** folder, right-click on **MyDB**, and then click **New Query**.</span></span>
6. <span data-ttu-id="63381-169">Hello utilizzo dopo la replica di hello tooshow istruzione rimane passo indietro e l'ultimo tempo di replica di database secondari di MyDB.</span><span class="sxs-lookup"><span data-stu-id="63381-169">Use hello following statement tooshow hello replication lags and last replication time of my secondary databases of MyDB.</span></span>
   
        SELECT link_guid, partner_server, last_replication, replication_lag_sec FROM sys.dm_geo_replication_link_status
7. <span data-ttu-id="63381-170">Fare clic su **Execute** query hello toorun.</span><span class="sxs-lookup"><span data-stu-id="63381-170">Click **Execute** toorun hello query.</span></span>
8. <span data-ttu-id="63381-171">Utilizzare hello seguente istruzione tooshow hello più recente operazioni di replica geografica associate al database MyDB.</span><span class="sxs-lookup"><span data-stu-id="63381-171">Use hello following statement tooshow hello most recent geo-replication operations associated with database MyDB.</span></span>
   
        SELECT * FROM sys.dm_operation_status where major_resource_id = 'MyDB'
        ORDER BY start_time DESC
9. <span data-ttu-id="63381-172">Fare clic su **Execute** query hello toorun.</span><span class="sxs-lookup"><span data-stu-id="63381-172">Click **Execute** toorun hello query.</span></span>

## <a name="next-steps"></a><span data-ttu-id="63381-173">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="63381-173">Next steps</span></span>
* <span data-ttu-id="63381-174">toolearn ulteriori informazioni sui gruppi di failover e di replica geografica attiva, vedere - [gruppi di Failover](sql-database-geo-replication-overview.md)</span><span class="sxs-lookup"><span data-stu-id="63381-174">toolearn more about failover groups and active geo-replication, see - [Failover groups](sql-database-geo-replication-overview.md)</span></span>
* <span data-ttu-id="63381-175">Per la panoramica e gli scenari della continuità aziendale, vedere [Continuità aziendale del database SQL di Azure](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="63381-175">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>

