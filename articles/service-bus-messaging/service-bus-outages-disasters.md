---
title: Isolamento delle applicazioni del bus di servizio di Azure da interruzioni ed emergenze del servizio | Documentazione Microsoft
description: "Descrive le tecniche che è possibile usare per proteggere le applicazioni da potenziali interruzioni del bus di servizio."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: tysonn
ms.assetid: fd9fa8ab-f4c4-43f7-974f-c876df1614d4
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/12/2017
ms.author: sethm
ms.openlocfilehash: bc84dbe5c26a834b2cff5f71ba5f541e94ba0b38
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="best-practices-for-insulating-applications-against-service-bus-outages-and-disasters"></a><span data-ttu-id="a434f-103">Procedure consigliate per isolare le applicazioni del bus di servizio da interruzioni ed emergenze del servizio</span><span class="sxs-lookup"><span data-stu-id="a434f-103">Best practices for insulating applications against Service Bus outages and disasters</span></span>
<span data-ttu-id="a434f-104">Le applicazioni criciali devono funzionare in modo continuo, anche in presenza di interruzioni impreviste o situazioni di emergenza.</span><span class="sxs-lookup"><span data-stu-id="a434f-104">Mission-critical applications must operate continuously, even in the presence of unplanned outages or disasters.</span></span> <span data-ttu-id="a434f-105">Questo argomento descrive le tecniche che è possibile usare per proteggere le applicazioni del bus di servizio da una potenziale emergenza o interruzione del servizio.</span><span class="sxs-lookup"><span data-stu-id="a434f-105">This topic describes techniques you can use to protect Service Bus applications against a potential service outage or disaster.</span></span>

<span data-ttu-id="a434f-106">Il termine "interruzione" indica la temporanea indisponibilità del bus di servizio di Azure.</span><span class="sxs-lookup"><span data-stu-id="a434f-106">An outage is defined as the temporary unavailability of Azure Service Bus.</span></span> <span data-ttu-id="a434f-107">Un'interruzione può interessare alcuni componenti del bus di servizio, ad esempio un archivio di messaggistica, o anche l'intero data center.</span><span class="sxs-lookup"><span data-stu-id="a434f-107">The outage can affect some components of Service Bus, such as a messaging store, or even the entire datacenter.</span></span> <span data-ttu-id="a434f-108">Una volta risolto il problema, il bus di servizio torna di nuovo disponibile.</span><span class="sxs-lookup"><span data-stu-id="a434f-108">After the problem has been fixed, Service Bus becomes available again.</span></span> <span data-ttu-id="a434f-109">In genere, un'interruzione non determina la perdita di messaggi o di altri dati.</span><span class="sxs-lookup"><span data-stu-id="a434f-109">Typically, an outage does not cause loss of messages or other data.</span></span> <span data-ttu-id="a434f-110">Un esempio di errore di un componente è la mancata disponibilità di un particolare archivio di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="a434f-110">An example of a component failure is the unavailability of a particular messaging store.</span></span> <span data-ttu-id="a434f-111">Un esempio di interruzione a livello di data center è un'interruzione dell'alimentazione o il guasto di un commutatore di rete.</span><span class="sxs-lookup"><span data-stu-id="a434f-111">An example of a datacenter-wide outage is a power failure of the datacenter, or a faulty datacenter network switch.</span></span> <span data-ttu-id="a434f-112">Un'interruzione può durare da pochi minuti ad alcuni giorni.</span><span class="sxs-lookup"><span data-stu-id="a434f-112">An outage can last from a few minutes to a few days.</span></span>

<span data-ttu-id="a434f-113">Il termine "emergenza" indica la perdita permanente di un'unità di scala del bus di servizio o di un data center.</span><span class="sxs-lookup"><span data-stu-id="a434f-113">A disaster is defined as the permanent loss of a Service Bus scale unit or datacenter.</span></span> <span data-ttu-id="a434f-114">È possibile che il data center non torni di nuovo disponibile.</span><span class="sxs-lookup"><span data-stu-id="a434f-114">The datacenter may or may not become available again.</span></span> <span data-ttu-id="a434f-115">In genere, un'emergenza determina la perdita di alcuni o di tutti i messaggi o di altri dati.</span><span class="sxs-lookup"><span data-stu-id="a434f-115">Typically a disaster causes loss of some or all messages or other data.</span></span> <span data-ttu-id="a434f-116">Un'emergenza può essere causata, ad esempio, da un incendio, un'inondazione o un terremoto.</span><span class="sxs-lookup"><span data-stu-id="a434f-116">Examples of disasters are fire, flooding, or earthquake.</span></span>

## <a name="current-architecture"></a><span data-ttu-id="a434f-117">Architettura corrente</span><span class="sxs-lookup"><span data-stu-id="a434f-117">Current architecture</span></span>
<span data-ttu-id="a434f-118">Il bus di servizio usa più archivi di messaggistica per memorizzare messaggi inviati a code o argomenti.</span><span class="sxs-lookup"><span data-stu-id="a434f-118">Service Bus uses multiple messaging stores to store messages that are sent to queues or topics.</span></span> <span data-ttu-id="a434f-119">Una coda o un argomento non partizionato viene assegnato a un archivio di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="a434f-119">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="a434f-120">Se l'archivio di messaggistica in questione non è disponibile, tutte le operazioni eseguite sulla coda o sull'argomento avranno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="a434f-120">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span>

<span data-ttu-id="a434f-121">Tutte le entità del bus di servizio (code, argomenti, inoltri) risiedono in uno spazio dei nomi di servizio che è affiliato a un data center.</span><span class="sxs-lookup"><span data-stu-id="a434f-121">All Service Bus messaging entities (queues, topics, relays) reside in a service namespace, which is affiliated with a datacenter.</span></span> <span data-ttu-id="a434f-122">Il bus di servizio non abilita la replica geografica automatica dei dati, né consente a uno spazio dei nomi di estendersi su più data center.</span><span class="sxs-lookup"><span data-stu-id="a434f-122">Service Bus does not enable automatic geo-replication of data, nor does it allow a namespace to span multiple datacenters.</span></span>

## <a name="protecting-against-acs-outages"></a><span data-ttu-id="a434f-123">Protezione da interruzioni del servizio di controllo di accesso (ACS)</span><span class="sxs-lookup"><span data-stu-id="a434f-123">Protecting against ACS outages</span></span>
<span data-ttu-id="a434f-124">Se si usano credenziali ACS e il servizio ACS non è disponibile, i client non possono più ottenere i token.</span><span class="sxs-lookup"><span data-stu-id="a434f-124">If you are using ACS credentials, and ACS becomes unavailable, clients can no longer obtain tokens.</span></span> <span data-ttu-id="a434f-125">I client che dispongono di un token nel momento in cui ACS si arresta possono continuare a usare il bus di servizio fino alla scadenza dei token.</span><span class="sxs-lookup"><span data-stu-id="a434f-125">Clients that have a token at the time ACS goes down can continue to use Service Bus until the tokens expire.</span></span> <span data-ttu-id="a434f-126">La durata predefinita dei token è 3 ore.</span><span class="sxs-lookup"><span data-stu-id="a434f-126">The default token lifetime is 3 hours.</span></span>

<span data-ttu-id="a434f-127">Per proteggersi dalle interruzioni del servizio ACS, usare token di firma di accesso condiviso.</span><span class="sxs-lookup"><span data-stu-id="a434f-127">To protect against ACS outages, use Shared Access Signature (SAS) tokens.</span></span> <span data-ttu-id="a434f-128">In questo caso, il client esegue direttamente l'autenticazione con il bus di servizio firmando un token coniato automaticamente con una chiave privata.</span><span class="sxs-lookup"><span data-stu-id="a434f-128">In this case, the client authenticates directly with Service Bus by signing a self-minted token with a secret key.</span></span> <span data-ttu-id="a434f-129">Non sono più necessarie chiamate ad ACS.</span><span class="sxs-lookup"><span data-stu-id="a434f-129">Calls to ACS are no longer required.</span></span> <span data-ttu-id="a434f-130">Per altre informazioni sulla configurazione dei token di firma di accesso condiviso, vedere [Autenticazione e autorizzazione del bus di servizio][Service Bus authentication].</span><span class="sxs-lookup"><span data-stu-id="a434f-130">For more information about SAS tokens, see [Service Bus authentication][Service Bus authentication].</span></span>

## <a name="protecting-queues-and-topics-against-messaging-store-failures"></a><span data-ttu-id="a434f-131">Protezione di code e argomenti da errori degli archivi di messaggistica</span><span class="sxs-lookup"><span data-stu-id="a434f-131">Protecting queues and topics against messaging store failures</span></span>
<span data-ttu-id="a434f-132">Una coda o un argomento non partizionato viene assegnato a un archivio di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="a434f-132">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="a434f-133">Se l'archivio di messaggistica in questione non è disponibile, tutte le operazioni eseguite sulla coda o sull'argomento avranno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="a434f-133">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span> <span data-ttu-id="a434f-134">Una coda partizionata, invece, è costituita da più frammenti,</span><span class="sxs-lookup"><span data-stu-id="a434f-134">A partitioned queue, on the other hand, consists of multiple fragments.</span></span> <span data-ttu-id="a434f-135">ciascuno dei quali memorizzato in un archivio di messaggistica differente.</span><span class="sxs-lookup"><span data-stu-id="a434f-135">Each fragment is stored in a different messaging store.</span></span> <span data-ttu-id="a434f-136">Quando un messaggio viene inviato a una coda o a un argomento partizionato, il bus di servizio assegna il messaggio a uno dei frammenti.</span><span class="sxs-lookup"><span data-stu-id="a434f-136">When a message is sent to a partitioned queue or topic, Service Bus assigns the message to one of the fragments.</span></span> <span data-ttu-id="a434f-137">Se l'archivio di messaggistica corrispondente non è disponibile, il bus di servizio scrive i messaggi in un frammento diverso, se possibile.</span><span class="sxs-lookup"><span data-stu-id="a434f-137">If the corresponding messaging store is unavailable, Service Bus writes the message to a different fragment, if possible.</span></span> <span data-ttu-id="a434f-138">Per altre informazioni sulle entità partizionate, vedere [Code e argomenti partizionati][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="a434f-138">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

## <a name="protecting-against-datacenter-outages-or-disasters"></a><span data-ttu-id="a434f-139">Protezione da interruzioni o emergenze dei data center</span><span class="sxs-lookup"><span data-stu-id="a434f-139">Protecting against datacenter outages or disasters</span></span>
<span data-ttu-id="a434f-140">Per consentire un failover tra due data center, è possibile creare uno spazio dei nomi servizio del bus di servizio in ogni data center.</span><span class="sxs-lookup"><span data-stu-id="a434f-140">To allow for a failover between two datacenters, you can create a Service Bus service namespace in each datacenter.</span></span> <span data-ttu-id="a434f-141">Ad esempio, lo spazio dei nomi servizio del bus di servizio **contosoPrimary.servicebus.windows.net** potrebbe trovarsi nell'area centro-settentrionale degli Stati Uniti, mentre **contosoSecondary.servicebus.windows.net** potrebbe trovarsi in quella centro-meridionale.</span><span class="sxs-lookup"><span data-stu-id="a434f-141">For example, the Service Bus service namespace **contosoPrimary.servicebus.windows.net** might be located in the United States North/Central region, and **contosoSecondary.servicebus.windows.net** might be located in the US South/Central region.</span></span> <span data-ttu-id="a434f-142">Se un'entità di messaggistica del bus di servizio deve rimanere accessibile in caso di interruzione del data center, è possibile creare l'entità in entrambi gli spazi dei nomi.</span><span class="sxs-lookup"><span data-stu-id="a434f-142">If a Service Bus messaging entity must remain accessible in the presence of a datacenter outage, you can create that entity in both namespaces.</span></span>

<span data-ttu-id="a434f-143">Per altre informazioni, vedere la sezione "Errore del bus di servizio in un data center di Azure" in [Modelli di messaggistica asincrona e disponibilità elevata][Asynchronous messaging patterns and high availability].</span><span class="sxs-lookup"><span data-stu-id="a434f-143">For more information, see the "Failure of Service Bus within an Azure datacenter" section in [Asynchronous messaging patterns and high availability][Asynchronous messaging patterns and high availability].</span></span>

## <a name="protecting-relay-endpoints-against-datacenter-outages-or-disasters"></a><span data-ttu-id="a434f-144">Protezione degli endpoint di inoltro da interruzioni o emergenze dei data center</span><span class="sxs-lookup"><span data-stu-id="a434f-144">Protecting relay endpoints against datacenter outages or disasters</span></span>
<span data-ttu-id="a434f-145">La replica geografica degli endpoint di inoltro consente a un servizio che espone un endpoint di inoltro di essere raggiungibile in presenza di interruzioni del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="a434f-145">Geo-replication of relay endpoints allows a service that exposes a relay endpoint to be reachable in the presence of Service Bus outages.</span></span> <span data-ttu-id="a434f-146">Per ottenere la replica geografica, il servizio deve creare due endpoint di inoltro in diverse istanze di spazio dei nomi servizio.</span><span class="sxs-lookup"><span data-stu-id="a434f-146">To achieve geo-replication, the service must create two relay endpoints in different namespaces.</span></span> <span data-ttu-id="a434f-147">Le due istanze di spazio dei nomi servizio devono trovarsi in data center diversi e i due endpoint devono avere nomi differenti.</span><span class="sxs-lookup"><span data-stu-id="a434f-147">The namespaces must reside in different datacenters and the two endpoints must have different names.</span></span> <span data-ttu-id="a434f-148">Ad esempio, un endpoint primario può essere raggiunto in **contosoPrimary.servicebus.windows.net/myPrimaryService**, mentre il corrispettivo endpoint secondario può essere raggiunto in **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span><span class="sxs-lookup"><span data-stu-id="a434f-148">For example, a primary endpoint can be reached under **contosoPrimary.servicebus.windows.net/myPrimaryService**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span></span>

<span data-ttu-id="a434f-149">Il servizio rimane quindi in ascolto su entrambi gli endpoint e un client può richiamare il servizio tramite l'uno o l'altro.</span><span class="sxs-lookup"><span data-stu-id="a434f-149">The service then listens on both endpoints, and a client can invoke the service via either endpoint.</span></span> <span data-ttu-id="a434f-150">Un'applicazione client seleziona casualmente uno degli inoltri come endpoint primario e invia la richiesta all'endpoint attivo.</span><span class="sxs-lookup"><span data-stu-id="a434f-150">A client application randomly picks one of the relays as the primary endpoint, and sends its request to the active endpoint.</span></span> <span data-ttu-id="a434f-151">Se l'operazione ha esito negativo e viene visualizzato un codice di errore, significa che l'endpoint di inoltro non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="a434f-151">If the operation fails with an error code, this failure indicates that the relay endpoint is not available.</span></span> <span data-ttu-id="a434f-152">L'applicazione apre un canale per l'endpoint di backup e invia nuovamente la richiesta.</span><span class="sxs-lookup"><span data-stu-id="a434f-152">The application opens a channel to the backup endpoint and reissues the request.</span></span> <span data-ttu-id="a434f-153">A quel punto, l'endpoint attivo e quello di backup si scambiano i ruoli: l'applicazione client considera l'endpoint attivo precedente come nuovo endpoint di backup e l'endpoint di backup precedente come nuovo endpoint attivo.</span><span class="sxs-lookup"><span data-stu-id="a434f-153">At that point the active and the backup endpoints switch roles: the client application considers the old active endpoint to be the new backup endpoint, and the old backup endpoint to be the new active endpoint.</span></span> <span data-ttu-id="a434f-154">Se entrambe le operazioni di invio hanno esito negativo, i ruoli delle due entità rimangono invariati e viene restituito un errore.</span><span class="sxs-lookup"><span data-stu-id="a434f-154">If both send operations fail, the roles of the two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="a434f-155">L'esempio relativo alla [replica geografica con i messaggi inoltrati del bus di servizio][Geo-replication with Service Bus relayed Messages] illustra come replicare gli inoltri.</span><span class="sxs-lookup"><span data-stu-id="a434f-155">The [Geo-replication with Service Bus relayed messages][Geo-replication with Service Bus relayed Messages] sample demonstrates how to replicate relays.</span></span>

## <a name="protecting-queues-and-topics-against-datacenter-outages-or-disasters"></a><span data-ttu-id="a434f-156">Protezione delle code e degli argomenti da interruzioni o emergenze dei data center</span><span class="sxs-lookup"><span data-stu-id="a434f-156">Protecting queues and topics against datacenter outages or disasters</span></span>
<span data-ttu-id="a434f-157">Per ottenere resilienza in caso di possibili interruzioni dei data center durante l'uso della messaggistica negoziata, il bus di servizio supporta due approcci: replica *attiva* e replica *passiva*.</span><span class="sxs-lookup"><span data-stu-id="a434f-157">To achieve resilience against datacenter outages when using brokered messaging, Service Bus supports two approaches: *active* and *passive* replication.</span></span> <span data-ttu-id="a434f-158">Per ogni approccio, se una coda o un argomento specifico deve rimanere accessibile in presenza di un'interruzione del data center, è possibile creare tale coda o argomento in entrambi gli spazi dei nomi.</span><span class="sxs-lookup"><span data-stu-id="a434f-158">For each approach, if a given queue or topic must remain accessible in the presence of a datacenter outage, you can create it in both namespaces.</span></span> <span data-ttu-id="a434f-159">Entrambe le entità possono avere lo stesso nome.</span><span class="sxs-lookup"><span data-stu-id="a434f-159">Both entities can have the same name.</span></span> <span data-ttu-id="a434f-160">Ad esempio, una coda primaria può essere raggiunta in **contosoPrimary.servicebus.windows.net/myQueue**, mentre la rispettiva coda secondaria può essere raggiunta in **contosoSecondary.servicebus.windows.net/myQueue**.</span><span class="sxs-lookup"><span data-stu-id="a434f-160">For example, a primary queue can be reached under **contosoPrimary.servicebus.windows.net/myQueue**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/myQueue**.</span></span>

<span data-ttu-id="a434f-161">Se l'applicazione non richiede una comunicazione mittente-ricevitore permanente, può implementare una coda permanente sul lato client in modo da impedire la perdita di messaggi e proteggere il mittente da eventuali errori temporanei del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="a434f-161">If the application does not require permanent sender-to-receiver communication, the application can implement a durable client-side queue to prevent message loss and to shield the sender from any transient Service Bus errors.</span></span>

## <a name="active-replication"></a><span data-ttu-id="a434f-162">Replica attiva</span><span class="sxs-lookup"><span data-stu-id="a434f-162">Active replication</span></span>
<span data-ttu-id="a434f-163">La replica attiva usa entità in entrambi gli spazi dei nomi per ogni operazione.</span><span class="sxs-lookup"><span data-stu-id="a434f-163">Active replication uses entities in both namespaces for every operation.</span></span> <span data-ttu-id="a434f-164">Ogni client invia sempre due copie di un messaggio.</span><span class="sxs-lookup"><span data-stu-id="a434f-164">Any client that sends a message sends two copies of the same message.</span></span> <span data-ttu-id="a434f-165">La prima viene inviata all'entità primaria, ad esempio **contosoPrimary.servicebus.windows.net/sales**, la seconda all'entità secondaria, ad esempio **contosoSecondary.servicebus.windows.net/sales**.</span><span class="sxs-lookup"><span data-stu-id="a434f-165">The first copy is sent to the primary entity (for example, **contosoPrimary.servicebus.windows.net/sales**), and the second copy of the message is sent to the secondary entity (for example, **contosoSecondary.servicebus.windows.net/sales**).</span></span>

<span data-ttu-id="a434f-166">Un client riceve messaggi da entrambe le code.</span><span class="sxs-lookup"><span data-stu-id="a434f-166">A client receives messages from both queues.</span></span> <span data-ttu-id="a434f-167">Il ricevitore elabora la prima copia di un messaggio ed elimina la seconda.</span><span class="sxs-lookup"><span data-stu-id="a434f-167">The receiver processes the first copy of a message, and the second copy is suppressed.</span></span> <span data-ttu-id="a434f-168">Per eliminare i messaggi duplicati, il mittente deve contrassegnare ogni messaggio con un identificatore univoco.</span><span class="sxs-lookup"><span data-stu-id="a434f-168">To suppress duplicate messages, the sender must tag each message with a unique identifier.</span></span> <span data-ttu-id="a434f-169">Entrambe le copie del messaggio devono essere contrassegnate con lo stesso identificatore.</span><span class="sxs-lookup"><span data-stu-id="a434f-169">Both copies of the message must be tagged with the same identifier.</span></span> <span data-ttu-id="a434f-170">Per contrassegnare il messaggio, è possibile usare la proprietà [BrokeredMessage.MessageId][BrokeredMessage.MessageId] o [BrokeredMessage.Label][BrokeredMessage.Label] oppure una proprietà personalizzata.</span><span class="sxs-lookup"><span data-stu-id="a434f-170">You can use the [BrokeredMessage.MessageId][BrokeredMessage.MessageId] or [BrokeredMessage.Label][BrokeredMessage.Label] properties, or a custom property to tag the message.</span></span> <span data-ttu-id="a434f-171">Il ricevitore deve mantenere l'elenco dei messaggi già ricevuti.</span><span class="sxs-lookup"><span data-stu-id="a434f-171">The receiver must maintain a list of messages that it has already received.</span></span>

<span data-ttu-id="a434f-172">L'esempio relativo alla [replica geografica con i messaggi negoziati del bus di servizio][Geo-replication with Service Bus Brokered Messages] illustra la modalità di replica attiva delle entità di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="a434f-172">The [Geo-replication with Service Bus Brokered Messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates active replication of messaging entities.</span></span>

> [!NOTE]
> <span data-ttu-id="a434f-173">Nella replica attiva il numero delle operazioni raddoppia. Di conseguenza, questo approccio può comportare costi più elevati.</span><span class="sxs-lookup"><span data-stu-id="a434f-173">The active replication approach doubles the number of operations, therefore this approach can lead to higher cost.</span></span>
> 
> 

## <a name="passive-replication"></a><span data-ttu-id="a434f-174">Replica passiva</span><span class="sxs-lookup"><span data-stu-id="a434f-174">Passive replication</span></span>
<span data-ttu-id="a434f-175">Quando non si verificano errori, nella replica passiva viene usata solo una delle due entità di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="a434f-175">In the fault-free case, passive replication uses only one of the two messaging entities.</span></span> <span data-ttu-id="a434f-176">Un client invia il messaggio all'entità attiva.</span><span class="sxs-lookup"><span data-stu-id="a434f-176">A client sends the message to the active entity.</span></span> <span data-ttu-id="a434f-177">Se l'operazione sull'entità attiva non riesce e viene restituito un codice di errore per segnalare che il data center che ospita l'entità attiva potrebbe non essere disponibile, il client invia una copia del messaggio all'entità di backup.</span><span class="sxs-lookup"><span data-stu-id="a434f-177">If the operation on the active entity fails with an error code that indicates the datacenter that hosts the active entity might be unavailable, the client sends a copy of the message to the backup entity.</span></span> <span data-ttu-id="a434f-178">A quel punto, l'entità attiva e quella di backup si scambiano i ruoli: il client mittente considera l'entità attiva precedente come nuova entità di backup e l'entità di backup precedente come nuova entità attiva.</span><span class="sxs-lookup"><span data-stu-id="a434f-178">At that point the active and the backup entities switch roles: the sending client considers the old active entity to be the new backup entity, and the old backup entity is the new active entity.</span></span> <span data-ttu-id="a434f-179">Se entrambe le operazioni di invio hanno esito negativo, i ruoli delle due entità rimangono invariati e viene restituito un errore.</span><span class="sxs-lookup"><span data-stu-id="a434f-179">If both send operations fail, the roles of the two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="a434f-180">Un client riceve messaggi da entrambe le code.</span><span class="sxs-lookup"><span data-stu-id="a434f-180">A client receives messages from both queues.</span></span> <span data-ttu-id="a434f-181">Poiché potrebbe ricevere due copie dello stesso messaggio, il ricevitore deve eliminare i messaggi duplicati.</span><span class="sxs-lookup"><span data-stu-id="a434f-181">Because there is a chance that the receiver receives two copies of the same message, the receiver must suppress duplicate messages.</span></span> <span data-ttu-id="a434f-182">È possibile eliminare i duplicati nel modo descritto per la replica attiva.</span><span class="sxs-lookup"><span data-stu-id="a434f-182">You can suppress duplicates in the same way as described for active replication.</span></span>

<span data-ttu-id="a434f-183">In genere, la replica passiva è più vantaggiosa di quella attiva perché nella maggior parte dei casi viene eseguita una sola operazione.</span><span class="sxs-lookup"><span data-stu-id="a434f-183">In general, passive replication is more economical than active replication because in most cases only one operation is performed.</span></span> <span data-ttu-id="a434f-184">La latenza, la velocità effettiva e il costo sono identici a quelli di uno scenario non replicato.</span><span class="sxs-lookup"><span data-stu-id="a434f-184">Latency, throughput, and monetary cost are identical to the non-replicated scenario.</span></span>

<span data-ttu-id="a434f-185">Quando si usa la replica passiva, negli scenari seguenti è possibile che i messaggi vengano persi o ricevuti due volte.</span><span class="sxs-lookup"><span data-stu-id="a434f-185">When using passive replication, in the following scenarios messages can be lost or received twice:</span></span>

* <span data-ttu-id="a434f-186">**Ritardo o perdita del messaggio**: si supponga che il mittente abbia inviato con esito positivo un messaggio m1 alla coda primaria e che quindi la coda diventi non disponibile prima della ricezione di m1 da parte del ricevitore.</span><span class="sxs-lookup"><span data-stu-id="a434f-186">**Message delay or loss**: Assume that the sender successfully sent a message m1 to the primary queue, and then the queue becomes unavailable before the receiver receives m1.</span></span> <span data-ttu-id="a434f-187">Il mittente invia un secondo messaggio m2 alla coda secondaria.</span><span class="sxs-lookup"><span data-stu-id="a434f-187">The sender sends a subsequent message m2 to the secondary queue.</span></span> <span data-ttu-id="a434f-188">Se la coda primaria è temporaneamente non disponibile, m1 viene ricevuto solo quando la coda torna nuovamente disponibile.</span><span class="sxs-lookup"><span data-stu-id="a434f-188">If the primary queue is temporarily unavailable, the receiver receives m1 after the queue becomes available again.</span></span> <span data-ttu-id="a434f-189">In caso di emergenza, il destinatario potrebbe non ricevere mai m1.</span><span class="sxs-lookup"><span data-stu-id="a434f-189">In case of a disaster, the receiver may never receive m1.</span></span>
* <span data-ttu-id="a434f-190">**Ricezione di duplicati**: si supponga che il mittente invii un messaggio m alla coda primaria.</span><span class="sxs-lookup"><span data-stu-id="a434f-190">**Duplicate reception**: Assume that the sender sends a message m to the primary queue.</span></span> <span data-ttu-id="a434f-191">Il bus di servizio elabora m ma non riesce a inviare una risposta.</span><span class="sxs-lookup"><span data-stu-id="a434f-191">Service Bus successfully processes m but fails to send a response.</span></span> <span data-ttu-id="a434f-192">Dopo il timeout dell'operazione di invio, il mittente invia una copia identica di m alla coda secondaria.</span><span class="sxs-lookup"><span data-stu-id="a434f-192">After the send operation times out, the sender sends an identical copy of m to the secondary queue.</span></span> <span data-ttu-id="a434f-193">Se la prima copia di m viene ricevuta prima che la coda primaria diventi non disponibile, le due copie di m verranno ricevute quasi contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="a434f-193">If the receiver is able to receive the first copy of m before the primary queue becomes unavailable, the receiver receives both copies of m at approximately the same time.</span></span> <span data-ttu-id="a434f-194">Se invece la prima copia di m non viene ricevuta prima che la coda primaria diventi non disponibile, il ricevitore riceverà inizialmente solo la seconda copia di m. L'altra copia di m verrà ricevuta quando la coda primaria diventerà disponibile.</span><span class="sxs-lookup"><span data-stu-id="a434f-194">If the receiver is not able to receive the first copy of m before the primary queue becomes unavailable, the receiver initially receives only the second copy of m, but then receives a second copy of m when the primary queue becomes available.</span></span>

<span data-ttu-id="a434f-195">L'esempio relativo alla [replica geografica con i messaggi negoziati del bus di servizio][Geo-replication with Service Bus Brokered Messages] illustra la modalità di replica passiva delle entità di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="a434f-195">The [Geo-replication with Service Bus brokered messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates passive replication of messaging entities.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a434f-196">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="a434f-196">Next steps</span></span>
<span data-ttu-id="a434f-197">Per altre informazioni sul ripristino di emergenza, vedere gli articoli seguenti:</span><span class="sxs-lookup"><span data-stu-id="a434f-197">To learn more about disaster recovery, see these articles:</span></span>

* <span data-ttu-id="a434f-198">[Continuità aziendale del database SQL di Azure][Azure SQL Database Business Continuity]</span><span class="sxs-lookup"><span data-stu-id="a434f-198">[Azure SQL Database Business Continuity][Azure SQL Database Business Continuity]</span></span>
* <span data-ttu-id="a434f-199">[Progettazione di applicazioni resilienti per Azure][Azure resiliency technical guidance]</span><span class="sxs-lookup"><span data-stu-id="a434f-199">[Designing resilient applications for Azure][Azure resiliency technical guidance]</span></span>

[Service Bus Authentication]: service-bus-authentication-and-authorization.md
[Partitioned messaging entities]: service-bus-partitioning.md
[Asynchronous messaging patterns and high availability]: service-bus-async-messaging.md#failure-of-service-bus-within-an-azure-datacenter
[Geo-replication with Service Bus Relayed Messages]: http://code.msdn.microsoft.com/Geo-replication-with-16dbfecd
[BrokeredMessage.MessageId]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId
[BrokeredMessage.Label]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label
[Geo-replication with Service Bus Brokered Messages]: http://code.msdn.microsoft.com/Geo-replication-with-f5688664
[Azure SQL Database Business Continuity]: ../sql-database/sql-database-business-continuity.md
[Azure resiliency technical guidance]: /azure/architecture/resiliency
