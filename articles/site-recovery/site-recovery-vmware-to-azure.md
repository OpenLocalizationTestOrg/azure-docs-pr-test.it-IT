---
title: Replicare VM VMware in Azure | Microsoft Docs
description: Riepilogo dei passaggi necessari per replicare in Archiviazione di Azure i carichi di lavoro in esecuzione in VM VMware
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: 
ms.assetid: dab98aa5-9c41-4475-b7dc-2e07ab1cfd18
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/14/2017
ms.author: raynew
ROBOTS: NOINDEX, NOFOLLOW
redirect_url: vmware-walkthrough-overview
ms.openlocfilehash: 8a312f3c1a65b2a9bb91abbfd8b18fb0ec0279b7
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="replicate-vmware-virtual-machines-to-azure-with-site-recovery"></a><span data-ttu-id="bbb26-103">Replicare macchine virtuali VMware in Azure con Site Recovery</span><span class="sxs-lookup"><span data-stu-id="bbb26-103">Replicate VMware virtual machines to Azure with Site Recovery</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="bbb26-104">Portale di Azure</span><span class="sxs-lookup"><span data-stu-id="bbb26-104">Azure portal</span></span>](site-recovery-vmware-to-azure.md)
> * [<span data-ttu-id="bbb26-105">Azure classico</span><span class="sxs-lookup"><span data-stu-id="bbb26-105">Azure classic</span></span>](site-recovery-vmware-to-azure-classic.md)


<span data-ttu-id="bbb26-106">Questo articolo illustra come replicare macchine virtuali VMware locali in Azure usando il servizio [Azure Site Recovery](site-recovery-overview.md) nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="bbb26-106">This article describes how to replicate on-premises VMware virtual machines to Azure, using the [Azure Site Recovery](site-recovery-overview.md) service in the Azure portal.</span></span>

<span data-ttu-id="bbb26-107">Per eseguire la migrazione di macchine virtuali VMware in Azure (solo failover), vedere [questo articolo](site-recovery-migrate-to-azure.md) per altre informazioni.</span><span class="sxs-lookup"><span data-stu-id="bbb26-107">If you want to migrate VMware VMs to Azure (failover only), read [this article](site-recovery-migrate-to-azure.md) to learn more.</span></span>

<span data-ttu-id="bbb26-108">Inserire commenti e domande nella parte inferiore di questo articolo oppure nel [forum sui servizi di ripristino di Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="bbb26-108">Post comments and questions at the bottom of this article, or on the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

## <a name="deployment-steps"></a><span data-ttu-id="bbb26-109">Passaggi di distribuzione</span><span class="sxs-lookup"><span data-stu-id="bbb26-109">Deployment steps</span></span>

<span data-ttu-id="bbb26-110">È necessario eseguire queste operazioni:</span><span class="sxs-lookup"><span data-stu-id="bbb26-110">Here's what you need to do:</span></span>

1. <span data-ttu-id="bbb26-111">Verificare i prerequisiti e le limitazioni.</span><span class="sxs-lookup"><span data-stu-id="bbb26-111">Verify prerequisites and limitations.</span></span>
2. <span data-ttu-id="bbb26-112">Configurare la rete e gli account di archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="bbb26-112">Set up Azure network and storage accounts.</span></span>
3. <span data-ttu-id="bbb26-113">Preparare il computer locale che si vuole distribuire come server di configurazione.</span><span class="sxs-lookup"><span data-stu-id="bbb26-113">Prepare the on-premises machine that you want to deploy as the configuration server.</span></span>
4. <span data-ttu-id="bbb26-114">Preparare gli account VMware da usare per l'individuazione automatica delle VM e, facoltativamente, per l'installazione push del servizio Mobility.</span><span class="sxs-lookup"><span data-stu-id="bbb26-114">Prepare VMware accounts to be used for automatic discovery of VMs, and optionally for push installation of the Mobility service.</span></span>
4. <span data-ttu-id="bbb26-115">Creare un insieme di credenziali dei servizi di ripristino.</span><span class="sxs-lookup"><span data-stu-id="bbb26-115">Create a Recovery Services vault.</span></span> <span data-ttu-id="bbb26-116">L'insieme di credenziali contiene le impostazioni di configurazione e orchestra la replica.</span><span class="sxs-lookup"><span data-stu-id="bbb26-116">The vault contains configuration settings, and orchestrates replication.</span></span>
5. <span data-ttu-id="bbb26-117">Specificare origine, destinazione e impostazioni di replica.</span><span class="sxs-lookup"><span data-stu-id="bbb26-117">Specify source, target, and replication settings.</span></span>
6. <span data-ttu-id="bbb26-118">Distribuire il servizio Mobility nelle VM di cui si vuole eseguire la replica.</span><span class="sxs-lookup"><span data-stu-id="bbb26-118">Deploy the Mobility service on VMs you want to replicate.</span></span>
7. <span data-ttu-id="bbb26-119">Abilitare la replica per le VM.</span><span class="sxs-lookup"><span data-stu-id="bbb26-119">Enable replication for the VMs.</span></span>
7. <span data-ttu-id="bbb26-120">Eseguire un failover di test per verificare che tutti gli elementi funzionino come previsto.</span><span class="sxs-lookup"><span data-stu-id="bbb26-120">Run a test failover to make sure everything's working as expected.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="bbb26-121">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="bbb26-121">Prerequisites</span></span>

<span data-ttu-id="bbb26-122">**Requisiti di supporto**</span><span class="sxs-lookup"><span data-stu-id="bbb26-122">**Support requirement**</span></span> | <span data-ttu-id="bbb26-123">**Dettagli**</span><span class="sxs-lookup"><span data-stu-id="bbb26-123">**Details**</span></span>
--- | ---
<span data-ttu-id="bbb26-124">**Azzurro**</span><span class="sxs-lookup"><span data-stu-id="bbb26-124">**Azure**</span></span> | <span data-ttu-id="bbb26-125">Vedere i [requisiti di Azure](site-recovery-prereq.md#azure-requirements).</span><span class="sxs-lookup"><span data-stu-id="bbb26-125">Learn about [Azure requirements](site-recovery-prereq.md#azure-requirements)</span></span>
<span data-ttu-id="bbb26-126">**Server di configurazione locale**</span><span class="sxs-lookup"><span data-stu-id="bbb26-126">**On-premises configuration server**</span></span> | <span data-ttu-id="bbb26-127">È necessaria una VM VMware che esegue Windows Server 2012 R2 o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="bbb26-127">You need a VMware VM running Windows Server 2012 R2 or later.</span></span> <span data-ttu-id="bbb26-128">Questo server viene configurato durante la distribuzione di Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="bbb26-128">You set up this server during Site Recovery deployment.</span></span><br/><br/> <span data-ttu-id="bbb26-129">Per impostazione predefinita, in questa VM vengono installati anche il server di elaborazione e il server di destinazione master.</span><span class="sxs-lookup"><span data-stu-id="bbb26-129">By default the process server and master target server are also installed on this VM.</span></span> <span data-ttu-id="bbb26-130">Quando si esegue un aumento delle prestazioni, potrebbe essere necessario un server di elaborazione separato, che ha gli stessi requisiti del server di configurazione.</span><span class="sxs-lookup"><span data-stu-id="bbb26-130">When you scale up, you might need a separate process server, and it has the same requirements as the configuration server.</span></span><br/><br/> <span data-ttu-id="bbb26-131">Altre informazioni su questi componenti sono disponibili [qui](site-recovery-set-up-vmware-to-azure.md#configuration-server-minimum-requirements)</span><span class="sxs-lookup"><span data-stu-id="bbb26-131">Learn more about these components [here](site-recovery-set-up-vmware-to-azure.md#configuration-server-minimum-requirements)</span></span>
<span data-ttu-id="bbb26-132">**Server VMware locali**</span><span class="sxs-lookup"><span data-stu-id="bbb26-132">**On-premises VMware servers**</span></span> | <span data-ttu-id="bbb26-133">Uno o più server VMware vSphere, che eseguono la versione 6.0, 5.5 o 5.1 con gli ultimi aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="bbb26-133">One or more VMware vSphere servers, running 6.0, 5.5, 5.1 with latest updates.</span></span> <span data-ttu-id="bbb26-134">I server devono trovarsi nella stessa rete del server di configurazione (o del server di elaborazione separato).</span><span class="sxs-lookup"><span data-stu-id="bbb26-134">Servers should be located in the same network as the configuration server (or separate process server).</span></span><br/><br/> <span data-ttu-id="bbb26-135">È consigliabile usare un server vCenter, che esegue la versione 6.0 o 5.5 con gli ultimi aggiornamenti, per gestire gli host.</span><span class="sxs-lookup"><span data-stu-id="bbb26-135">We recommend a vCenter server to manage hosts, running 6.0 or 5.5 with the latest updates.</span></span> <span data-ttu-id="bbb26-136">Quando si distribuisce la versione 6.0, sono supportate solo le funzionalità disponibili nella versione 5.5.</span><span class="sxs-lookup"><span data-stu-id="bbb26-136">Only features that are available in 5.5 are supported when you deploy version 6.0.</span></span>
<span data-ttu-id="bbb26-137">**VM locali**</span><span class="sxs-lookup"><span data-stu-id="bbb26-137">**On-premises VMs**</span></span> | <span data-ttu-id="bbb26-138">Le VM da replicare devono eseguire un [sistema operativo supportato](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions) ed essere conformi ai [prerequisiti di Azure](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).</span><span class="sxs-lookup"><span data-stu-id="bbb26-138">VMs you want to replicate should be running a [supported operating system](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions), and conform with [Azure prerequisites](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).</span></span> <span data-ttu-id="bbb26-139">Nella VM devono essere in esecuzione gli strumenti VMware.</span><span class="sxs-lookup"><span data-stu-id="bbb26-139">VM should have VMware tools running.</span></span>
<span data-ttu-id="bbb26-140">**URL**</span><span class="sxs-lookup"><span data-stu-id="bbb26-140">**URLs**</span></span> | <span data-ttu-id="bbb26-141">Il server di configurazione deve avere accesso a questi URL:</span><span class="sxs-lookup"><span data-stu-id="bbb26-141">The configuration server needs access to these URLs:</span></span><br/><br/> [!INCLUDE [site-recovery-URLS](../../includes/site-recovery-URLS.md)]<br/><br/> <span data-ttu-id="bbb26-142">Se sono presenti regole del firewall basate sull'indirizzo IP, verificare che consentano la comunicazione con Azure.</span><span class="sxs-lookup"><span data-stu-id="bbb26-142">If you have IP address-based firewall rules, ensure they allow communication to Azure.</span></span><br/></br> <span data-ttu-id="bbb26-143">Consentire gli [intervalli IP del data center di Azure ](https://www.microsoft.com/download/confirmation.aspx?id=41653) e la porta HTTPS (443).</span><span class="sxs-lookup"><span data-stu-id="bbb26-143">Allow the [Azure Datacenter IP Ranges](https://www.microsoft.com/download/confirmation.aspx?id=41653), and the HTTPS (443) port.</span></span><br/></br> <span data-ttu-id="bbb26-144">Consentire gli intervalli di indirizzi IP per l'area di Azure della sottoscrizione e per gli Stati Uniti occidentali (usati per il controllo di accesso e la gestione delle identità).</span><span class="sxs-lookup"><span data-stu-id="bbb26-144">Allow IP address ranges for the Azure region of your subscription, and for West US (used for Access Control and Identity Management).</span></span><br/><br/> <span data-ttu-id="bbb26-145">Consentire questo URL per il download di MySQL: http://cdn.mysql.com/archives/mysql-5.5/mysql-5.5.37-win32.msi.</span><span class="sxs-lookup"><span data-stu-id="bbb26-145">Allow this URL for the MySQL download: http://cdn.mysql.com/archives/mysql-5.5/mysql-5.5.37-win32.msi.</span></span>
<span data-ttu-id="bbb26-146">**Servizio Mobility**</span><span class="sxs-lookup"><span data-stu-id="bbb26-146">**Mobility service**</span></span> | <span data-ttu-id="bbb26-147">Deve essere installato in ogni VM replicata.</span><span class="sxs-lookup"><span data-stu-id="bbb26-147">Installed on every replicated VM.</span></span>




## <a name="limitations"></a><span data-ttu-id="bbb26-148">Limitazioni</span><span class="sxs-lookup"><span data-stu-id="bbb26-148">Limitations</span></span>

<span data-ttu-id="bbb26-149">**Limitazione**</span><span class="sxs-lookup"><span data-stu-id="bbb26-149">**Limitation**</span></span> | <span data-ttu-id="bbb26-150">**Dettagli**</span><span class="sxs-lookup"><span data-stu-id="bbb26-150">**Details**</span></span>
--- | ---
<span data-ttu-id="bbb26-151">**Azure**</span><span class="sxs-lookup"><span data-stu-id="bbb26-151">**Azure**</span></span> | <span data-ttu-id="bbb26-152">Gli account di archiviazione e di rete devono trovarsi nella stessa area dell'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="bbb26-152">Storage and network accounts must be in the same region as the vault</span></span><br/><br/> <span data-ttu-id="bbb26-153">Se si usa un account di archiviazione Premium, è necessario anche un account di archiviazione Standard per archiviare i log di replica.</span><span class="sxs-lookup"><span data-stu-id="bbb26-153">If you use a premium storage account, you also need a standard store account to store replication logs</span></span><br/><br/> <span data-ttu-id="bbb26-154">In India centrale e India meridionale non è possibile eseguire la replica in account Premium.</span><span class="sxs-lookup"><span data-stu-id="bbb26-154">You can't replicate to premium accounts in Central and South India.</span></span>
<span data-ttu-id="bbb26-155">**Server di configurazione locale**</span><span class="sxs-lookup"><span data-stu-id="bbb26-155">**On-premises configuration server**</span></span> | <span data-ttu-id="bbb26-156">Le schede delle VM VMware devono essere di tipo VMXNET3.</span><span class="sxs-lookup"><span data-stu-id="bbb26-156">VMware VM adapter type should be VMXNET3.</span></span> <span data-ttu-id="bbb26-157">In caso contrario, [installare questo aggiornamento](https://kb.vmware.com/selfservice/microsites/search.do?cmd=displayKC&docType=kc&externalId=2110245&sliceId=1&docTypeID=DT_KB_1_1&dialogID=26228401&stateId=1).</span><span class="sxs-lookup"><span data-stu-id="bbb26-157">If it isn't, [install this update](https://kb.vmware.com/selfservice/microsites/search.do?cmd=displayKC&docType=kc&externalId=2110245&sliceId=1&docTypeID=DT_KB_1_1&dialogID=26228401&stateId=1)</span></span><br/><br/> <span data-ttu-id="bbb26-158">Deve essere installato vSphere PowerCLI 6.0.</span><span class="sxs-lookup"><span data-stu-id="bbb26-158">vSphere PowerCLI 6.0 should be installed.</span></span><br/><br> <span data-ttu-id="bbb26-159">Il computer non deve essere un controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="bbb26-159">The machine shouldn't be a domain controller.</span></span> <span data-ttu-id="bbb26-160">Il computer deve avere un indirizzo IP statico.</span><span class="sxs-lookup"><span data-stu-id="bbb26-160">The machine should have a static IP address.</span></span><br/><br/> <span data-ttu-id="bbb26-161">Il nome host può contenere al massimo 15 caratteri e il sistema operativo deve essere in inglese.</span><span class="sxs-lookup"><span data-stu-id="bbb26-161">The host name should be 15 characters or less, and operating system should be in English.</span></span>
<span data-ttu-id="bbb26-162">**VMware**</span><span class="sxs-lookup"><span data-stu-id="bbb26-162">**VMware**</span></span> | <span data-ttu-id="bbb26-163">In vCenter 6.0 sono supportate solo le funzionalità della versione 5.5.</span><span class="sxs-lookup"><span data-stu-id="bbb26-163">Only 5.5 features are supported in vCenter 6.0.</span></span> <span data-ttu-id="bbb26-164">Site Recovery non supporta le nuove funzionalità di vCenter e vSphere 6.0 come cross-vCenter vMotion, Virtual Volumes e Storage DRS.</span><span class="sxs-lookup"><span data-stu-id="bbb26-164">Site Recovery doesn't support new vCenter and vSphere 6.0 features such as cross vCenter vMotion, virtual volumes, and storage DRS.</span></span>
<span data-ttu-id="bbb26-165">**Macchine virtuali**</span><span class="sxs-lookup"><span data-stu-id="bbb26-165">**VMs**</span></span> | <span data-ttu-id="bbb26-166">Verificare le [limitazioni delle VM di Azure](site-recovery-prereq.md#azure-requirements).</span><span class="sxs-lookup"><span data-stu-id="bbb26-166">Verify [Azure VM limitations](site-recovery-prereq.md#azure-requirements)</span></span><br/><br/> <span data-ttu-id="bbb26-167">Non è possibile replicare VM con dischi crittografati o con avvio UEFI/EFI.</span><span class="sxs-lookup"><span data-stu-id="bbb26-167">You can't replicate VMs with encrypted disks, or VMs with UEFI/EFI boot.</span></span><br/><br> <span data-ttu-id="bbb26-168">I cluster di dischi condivisi non sono supportati.</span><span class="sxs-lookup"><span data-stu-id="bbb26-168">Shared disk clusters aren't supported.</span></span> <span data-ttu-id="bbb26-169">Se nella VM di origine è presente un gruppo NIC, questo viene convertito in una singola scheda di interfaccia di rete dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="bbb26-169">If the source VM has NIC teaming, it's converted to a single NIC after failover.</span></span><br/><br/> <span data-ttu-id="bbb26-170">Se nelle VM è presente un disco iSCSI, Site Recovery lo converte in un file VHD dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="bbb26-170">If VMs have an iSCSI disk, Site Recovery converts it to a VHD file after failover.</span></span> <span data-ttu-id="bbb26-171">Se la destinazione iSCSI è raggiungibile dalla VM di Azure, questa vi si connette e saranno visibili sia tale destinazione che il disco rigido virtuale.</span><span class="sxs-lookup"><span data-stu-id="bbb26-171">If the iSCSI target can be reached by the Azure VM, it connects to it, and sees both it and the VHD.</span></span> <span data-ttu-id="bbb26-172">In questo caso, disconnettere la destinazione iSCSI.</span><span class="sxs-lookup"><span data-stu-id="bbb26-172">If this happens, disconnect the iSCSI target.</span></span><br/><br/> <span data-ttu-id="bbb26-173">Se si vuole abilitare la coerenza tra più VM, che consente di ripristinare insieme le VM che eseguono lo stesso carico di lavoro in un punto dati coerente, aprire la porta 20004 sulla VM.</span><span class="sxs-lookup"><span data-stu-id="bbb26-173">If you want to enable multi-VM consistency, which enables VMs running the same workload to be recovered together to a consistent data point, open port 20004 on the VM.</span></span><br/><br/> <span data-ttu-id="bbb26-174">Windows deve essere installato nell'unità C.</span><span class="sxs-lookup"><span data-stu-id="bbb26-174">Windows must be installed on the C drive.</span></span> <span data-ttu-id="bbb26-175">Il disco del sistema operativo deve essere di base e non dinamico.</span><span class="sxs-lookup"><span data-stu-id="bbb26-175">The OS disk should be basic, and not dynamic.</span></span> <span data-ttu-id="bbb26-176">Il disco dati può essere dinamico.</span><span class="sxs-lookup"><span data-stu-id="bbb26-176">The data disk can be dynamic.</span></span><br/><br/> <span data-ttu-id="bbb26-177">I file /etc/hosts di Linux nelle VM devono contenere le voci che eseguono il mapping del nome host locale agli indirizzi IP associati a tutte le schede di rete.</span><span class="sxs-lookup"><span data-stu-id="bbb26-177">Linux /etc/hosts files on VMs should contain entries that map the local host name to IP addresses associated with all network adapters.</span></span> <span data-ttu-id="bbb26-178">Il nome host, i punti di montaggio, i nomi dei dispositivi, i percorsi di sistema e i nomi file (/etc/, /usr) devono essere specificati solo in inglese.</span><span class="sxs-lookup"><span data-stu-id="bbb26-178">The host name, mount points, device name, system paths, and file names (/etc; /usr) should be in English only.</span></span><br/><br/> <span data-ttu-id="bbb26-179">Sono supportati tipi specifici di [archiviazione Linux](site-recovery-support-matrix-to-azure.md#support-for-storage).</span><span class="sxs-lookup"><span data-stu-id="bbb26-179">Specific types of [Linux storage](site-recovery-support-matrix-to-azure.md#support-for-storage) are supported.</span></span><br/><br/><span data-ttu-id="bbb26-180">Creare o impostare **disk.enableUUID=true** nelle impostazioni della VM.</span><span class="sxs-lookup"><span data-stu-id="bbb26-180">Create or set **disk.enableUUID=true** in the VM settings.</span></span> <span data-ttu-id="bbb26-181">In questo modo viene fornito un valore UUID coerente al file VMDK, che viene così installato correttamente, e si garantisce che durante il failback vengano ritrasferite nell'ambiente locale solo le modifiche differenziali, senza replica completa.</span><span class="sxs-lookup"><span data-stu-id="bbb26-181">This provides a consistent UUID to the VMDK, so that it mounts correctly, and ensures that only delta changes are transferred back to on-premises during failback, without full replication.</span></span>

## <a name="set-up-azure"></a><span data-ttu-id="bbb26-182">Configurare Azure</span><span class="sxs-lookup"><span data-stu-id="bbb26-182">Set up Azure</span></span>

1. <span data-ttu-id="bbb26-183">[Configurare una rete di Azure](../virtual-network/virtual-networks-create-vnet-arm-pportal.md).</span><span class="sxs-lookup"><span data-stu-id="bbb26-183">[Set up an Azure network](../virtual-network/virtual-networks-create-vnet-arm-pportal.md).</span></span>
    - <span data-ttu-id="bbb26-184">Le VM di Azure create dopo il failover verranno inserite in questa rete.</span><span class="sxs-lookup"><span data-stu-id="bbb26-184">Azure VMs will be placed in this network when they're created after failover.</span></span>
    - <span data-ttu-id="bbb26-185">È possibile configurare una rete in modalità classica o [Resource Manager](../resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="bbb26-185">You can set up a network in [Resource Manager](../resource-manager-deployment-model.md), or in classic mode.</span></span>

2. <span data-ttu-id="bbb26-186">Configurare un [account di archiviazione di Azure](../storage/storage-create-storage-account.md#create-a-storage-account) per i dati replicati.</span><span class="sxs-lookup"><span data-stu-id="bbb26-186">Set up an [Azure storage account](../storage/storage-create-storage-account.md#create-a-storage-account) for replicated data.</span></span>
    - <span data-ttu-id="bbb26-187">L'account può essere Standard o [Premium](../storage/storage-premium-storage.md).</span><span class="sxs-lookup"><span data-stu-id="bbb26-187">The account can be standard or [premium](../storage/storage-premium-storage.md).</span></span>
    - <span data-ttu-id="bbb26-188">È possibile configurare un account in modalità classica o Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="bbb26-188">You can set up an account in Resource Manager, or in classic mode.</span></span>

3. <span data-ttu-id="bbb26-189">[Preparare un account](#prepare-for-automatic-discovery-and-push-installation) nel server vCenter o negli host vSphere per consentire a Site Recovery di rilevare automaticamente le VM VMware.</span><span class="sxs-lookup"><span data-stu-id="bbb26-189">[Prepare an account](#prepare-for-automatic-discovery-and-push-installation) on the vCenter server or vSphere hosts, so that Site Recovery can automatically detect VMware VMs.</span></span>

## <a name="prepare-the-configuration-server"></a><span data-ttu-id="bbb26-190">Preparare il server di configurazione</span><span class="sxs-lookup"><span data-stu-id="bbb26-190">Prepare the configuration server</span></span>

1. <span data-ttu-id="bbb26-191">Installare Windows Server 2012 R2 o versione successiva in una VM VMware.</span><span class="sxs-lookup"><span data-stu-id="bbb26-191">Install Windows Server 2012 R2 or later, on a VMware VM.</span></span>
2. <span data-ttu-id="bbb26-192">Verificare che la VM abbia accesso agli URL elencati in [Prerequisiti](#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="bbb26-192">Make sure the VM has access to the URLs listed in [prerequisites](#prerequisites).</span></span>
3. <span data-ttu-id="bbb26-193">Installare [VMware vSphere PowerCLI 6.0](https://my.vmware.com/web/vmware/details?productId=491&downloadGroup=PCLI600R1).</span><span class="sxs-lookup"><span data-stu-id="bbb26-193">Install [VMware vSphere PowerCLI 6.0](https://my.vmware.com/web/vmware/details?productId=491&downloadGroup=PCLI600R1).</span></span>


## <a name="prepare-for-automatic-discovery-and-push-installation"></a><span data-ttu-id="bbb26-194">Preparare l'individuazione automatica e l'installazione push</span><span class="sxs-lookup"><span data-stu-id="bbb26-194">Prepare for automatic discovery and push installation</span></span>

- <span data-ttu-id="bbb26-195">**Preparare un account per l'individuazione automatica**: il server di elaborazione di Site Recovery individua automaticamente le VM.</span><span class="sxs-lookup"><span data-stu-id="bbb26-195">**Prepare an account for auto-discovery**: The Site Recovery process server automatically discovers VMs.</span></span> <span data-ttu-id="bbb26-196">A tale scopo, Site Recovery necessita di credenziali che consentano di accedere ai server vCenter e agli host vSphere ESXi.</span><span class="sxs-lookup"><span data-stu-id="bbb26-196">To do this, Site Recovery needs credentials that can access vCenter servers and vSphere ESXi hosts.</span></span>

    1. <span data-ttu-id="bbb26-197">Per usare un account dedicato, creare un ruolo a livello di vCenter con queste [autorizzazioni](#vmware-account-permissions).</span><span class="sxs-lookup"><span data-stu-id="bbb26-197">To use a dedicated account, create a role (at the vCenter level, with these [permissions](#vmware-account-permissions).</span></span> <span data-ttu-id="bbb26-198">Assegnare un nome all'account, ad esempio **Azure_Site_Recovery**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-198">Give it a name such as **Azure_Site_Recovery**.</span></span>
    2. <span data-ttu-id="bbb26-199">Creare quindi un utente nell'host vSphere o nel server vCenter e assegnare il ruolo all'utente.</span><span class="sxs-lookup"><span data-stu-id="bbb26-199">Then, create a user on the vSphere host/vCenter server, and assign the role to the user.</span></span> <span data-ttu-id="bbb26-200">Questo account utente viene specificato durante la distribuzione di Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="bbb26-200">You specify this user account during Site Recovery deployment.</span></span>

- <span data-ttu-id="bbb26-201">**Preparare un account per il push del servizio Mobility**: se si vuole effettuare il push del servizio Mobility alle VM, è necessario un account che possa essere usato dal server di elaborazione per accedere alla VM.</span><span class="sxs-lookup"><span data-stu-id="bbb26-201">**Prepare an account to push the Mobility service**: If you want to push the Mobility service to VMs, you need an account that can be used by the process server to access the VM.</span></span> <span data-ttu-id="bbb26-202">L'account viene usato solo per l'installazione push.</span><span class="sxs-lookup"><span data-stu-id="bbb26-202">The account is only used for the push installation.</span></span> <span data-ttu-id="bbb26-203">È possibile usare un account di dominio o locale:</span><span class="sxs-lookup"><span data-stu-id="bbb26-203">You can use a domain or local account:</span></span>

    - <span data-ttu-id="bbb26-204">Per Windows, se non si usa un account di dominio è necessario disabilitare il Controllo dell'accesso utente remoto nel computer locale.</span><span class="sxs-lookup"><span data-stu-id="bbb26-204">For Windows, if you're not using a domain account, you need to disable Remote User Access control on the local machine.</span></span> <span data-ttu-id="bbb26-205">A questo scopo, aggiungere la voce DWORD **LocalAccountTokenFilterPolicy** con un valore di 1 nel Registro di sistema in **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-205">To do this, in the register under **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System**, add the DWORD entry **LocalAccountTokenFilterPolicy**, with a value of 1.</span></span>
    - <span data-ttu-id="bbb26-206">Se si desidera aggiungere la voce del Registro di sistema per Windows da CLI, digitare:``REG ADD HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1.``</span><span class="sxs-lookup"><span data-stu-id="bbb26-206">If you want to add the registry entry for Windows from a CLI, type:   ``REG ADD HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1.``</span></span>
    - <span data-ttu-id="bbb26-207">Per Linux, l'account deve essere radice nel server Linux di origine.</span><span class="sxs-lookup"><span data-stu-id="bbb26-207">For Linux, the account should be root on the source Linux server.</span></span>

## <a name="create-a-recovery-services-vault"></a><span data-ttu-id="bbb26-208">Creare un insieme di credenziali di Servizi di ripristino</span><span class="sxs-lookup"><span data-stu-id="bbb26-208">Create a Recovery Services vault</span></span>

[!INCLUDE [site-recovery-create-vault](../../includes/site-recovery-create-vault.md)]

## <a name="select-the-protection-goal"></a><span data-ttu-id="bbb26-209">Selezionare l'obiettivo di protezione</span><span class="sxs-lookup"><span data-stu-id="bbb26-209">Select the protection goal</span></span>

<span data-ttu-id="bbb26-210">Selezionare gli elementi da replicare e la posizione in cui eseguire la replica.</span><span class="sxs-lookup"><span data-stu-id="bbb26-210">Select what you want to replicate, and where you want to replicate to.</span></span>

1. <span data-ttu-id="bbb26-211">Fare clic su **Insiemi di credenziali dei servizi di ripristino** e quindi sull'insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="bbb26-211">Click **Recovery Services vaults** > vault.</span></span>
2. <span data-ttu-id="bbb26-212">Nel menu delle risorse fare clic su **Site Recovery** > **Passaggio 1: Preparare l'infrastruttura** > **Obiettivo di protezione**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-212">In the Resource Menu, click **Site Recovery** > **Step 1: Prepare Infrastructure** > **Protection goal**.</span></span>

    ![Scegliere gli obiettivi](./media/site-recovery-vmware-to-azure/choose-goals.png)
3. <span data-ttu-id="bbb26-214">In **Obiettivo di protezione** selezionare **In Azure** > **Sì, con VMware vSphere Hypervisor**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-214">In **Protection goal**, select **To Azure** > **Yes, with VMware vSphere Hypervisor**.</span></span>

    ![Scegliere gli obiettivi](./media/site-recovery-vmware-to-azure/choose-goals2.png)

## <a name="set-up-the-source-environment"></a><span data-ttu-id="bbb26-216">Configurare l'ambiente di origine</span><span class="sxs-lookup"><span data-stu-id="bbb26-216">Set up the source environment</span></span>

<span data-ttu-id="bbb26-217">Configurare il server di configurazione, registrarlo nell'insieme di credenziali e individuare le VM.</span><span class="sxs-lookup"><span data-stu-id="bbb26-217">Set up the configuration server, register it in the vault, and discover VMs.</span></span>

1. <span data-ttu-id="bbb26-218">Fare clic su **Site Recovery** > **Passaggio 1: Preparare l'infrastruttura** > **Origine**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-218">Click **Site Recovery** > **Step 1: Prepare Infrastructure** > **Source**.</span></span>
2. <span data-ttu-id="bbb26-219">Se non è disponibile un server di configurazione, fare clic su **+Server di configurazione**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-219">If you don’t have a configuration server, click **+Configuration server**.</span></span>

    ![Impostare l'origine](./media/site-recovery-vmware-to-azure/set-source1.png)
3. <span data-ttu-id="bbb26-221">In **Aggiungi server** verificare che **Tipo di server** contenga **Server di configurazione**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-221">In **Add Server**, check that **Configuration Server** appears in **Server type**.</span></span>
4. <span data-ttu-id="bbb26-222">Scaricare il file di installazione per l'Installazione unificata di Azure Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="bbb26-222">Download the Site Recovery Unified Setup installation file.</span></span>
5. <span data-ttu-id="bbb26-223">Scaricare la chiave di registrazione dell'insieme di credenziali,</span><span class="sxs-lookup"><span data-stu-id="bbb26-223">Download the vault registration key.</span></span> <span data-ttu-id="bbb26-224">che sarà necessaria quando si esegue l'Installazione unificata.</span><span class="sxs-lookup"><span data-stu-id="bbb26-224">You need this when you run Unified Setup.</span></span> <span data-ttu-id="bbb26-225">La chiave è valida per cinque giorni dal momento in cui viene generata.</span><span class="sxs-lookup"><span data-stu-id="bbb26-225">The key is valid for five days after you generate it.</span></span>

   ![Impostare l'origine](./media/site-recovery-vmware-to-azure/set-source2.png)


## <a name="run-site-recovery-unified-setup"></a><span data-ttu-id="bbb26-227">Eseguire l'Installazione unificata di Site Recovery</span><span class="sxs-lookup"><span data-stu-id="bbb26-227">Run Site Recovery Unified Setup</span></span>

<span data-ttu-id="bbb26-228">Seguire questa procedura prima di iniziare, quindi eseguire l'Installazione unificata per installare il server di configurazione, il server di elaborazione e il server di destinazione master.</span><span class="sxs-lookup"><span data-stu-id="bbb26-228">Do the following before you start, then run Unified Setup to install the configuration server, the process server, and the master target server.</span></span>
    - <span data-ttu-id="bbb26-229">Ottenere una breve panoramica video</span><span class="sxs-lookup"><span data-stu-id="bbb26-229">Get a quick video overview</span></span>

        > [!VIDEO https://channel9.msdn.com/Series/Azure-Site-Recovery/VMware-to-Azure-with-ASR-Video1-Source-Infrastructure-Setup/player]

    - <span data-ttu-id="bbb26-230">Nella VM del server di configurazione verificare che il clock di sistema sia sincronizzato con un [server di riferimento ora](https://technet.microsoft.com/windows-server-docs/identity/ad-ds/get-started/windows-time-service/windows-time-service).</span><span class="sxs-lookup"><span data-stu-id="bbb26-230">On the configuration server VM, make sure that the system clock is synchronized with a [Time Server](https://technet.microsoft.com/windows-server-docs/identity/ad-ds/get-started/windows-time-service/windows-time-service).</span></span> <span data-ttu-id="bbb26-231">Deve corrispondere.</span><span class="sxs-lookup"><span data-stu-id="bbb26-231">It should match.</span></span> <span data-ttu-id="bbb26-232">Se è avanti o indietro di 15 minuti, l'installazione potrebbe avere esito negativo.</span><span class="sxs-lookup"><span data-stu-id="bbb26-232">If it's 15 minutes in front or behind, setup might fail.</span></span>
    - <span data-ttu-id="bbb26-233">Eseguire l'installazione come amministratore locale nella VM del server di configurazione.</span><span class="sxs-lookup"><span data-stu-id="bbb26-233">Run setup as a Local Administrator on the configuration server VM.</span></span>
    - <span data-ttu-id="bbb26-234">Verificare che nella VM sia abilitato TLS 1.0.</span><span class="sxs-lookup"><span data-stu-id="bbb26-234">Make sure TLS 1.0 is enabled on the VM.</span></span>


[!INCLUDE [site-recovery-add-configuration-server](../../includes/site-recovery-add-configuration-server.md)]

> [!NOTE]
> <span data-ttu-id="bbb26-235">Il server di configurazione può essere installato anche [dalla riga di comando](http://aka.ms/installconfigsrv).</span><span class="sxs-lookup"><span data-stu-id="bbb26-235">The configuration server can also be installed [from the command line](http://aka.ms/installconfigsrv).</span></span>



### <a name="add-the-account-for-automatic-discovery"></a><span data-ttu-id="bbb26-236">Aggiungere l'account per l'individuazione automatica</span><span class="sxs-lookup"><span data-stu-id="bbb26-236">Add the account for automatic discovery</span></span>

[!INCLUDE [site-recovery-add-vcenter-account](../../includes/site-recovery-add-vcenter-account.md)]

### <a name="connect-to-vmware-servers"></a><span data-ttu-id="bbb26-237">Connettersi ai server VMware</span><span class="sxs-lookup"><span data-stu-id="bbb26-237">Connect to VMware servers</span></span>

<span data-ttu-id="bbb26-238">Connettersi agli host vSphere ESXi o ai server vCenter per individuare le VM VMware.</span><span class="sxs-lookup"><span data-stu-id="bbb26-238">Connect to vSphere ESXi hosts or vCenter servers, to discover VMware VMs.</span></span>

- <span data-ttu-id="bbb26-239">Se si aggiungono gli host vSphere o il server vCenter con un account senza privilegi di amministratore per il server, per l'account devono essere abilitati i privilegi seguenti:</span><span class="sxs-lookup"><span data-stu-id="bbb26-239">If you add the vCenter server or vSphere hosts with an account without administrator privileges on the server, the account needs these privileges enabled:</span></span>
    - <span data-ttu-id="bbb26-240">Datacenter (Data center), Datastore (Archivio dati), Folder (Cartella), Host, Network (Rete), Resource (Risorsa), Virtual machine (Macchina virtuale) e vSphere Distributed Switch (Switch distribuito vSphere).</span><span class="sxs-lookup"><span data-stu-id="bbb26-240">Datacenter, Datastore, Folder, Host, Network, Resource, Virtual machine, vSphere Distributed Switch.</span></span>
    - <span data-ttu-id="bbb26-241">Per il server vCenter sono necessarie le autorizzazioni Storage views (Viste archiviazione).</span><span class="sxs-lookup"><span data-stu-id="bbb26-241">The vCenter server needs Storage views permissions.</span></span>
- <span data-ttu-id="bbb26-242">Quando si aggiungono server VMware, possono trascorrere 15 minuti o più prima che vengano visualizzati nel portale.</span><span class="sxs-lookup"><span data-stu-id="bbb26-242">When you add VMware servers, it can take 15 minutes or longer for them to appear in the portal.</span></span>
<span data-ttu-id="bbb26-243">Per consentire ad Azure Site Recovery di individuare macchine virtuali in esecuzione nell'ambiente locale, è necessario connettere il server VMware vCenter o gli host vSphere ESXi a Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="bbb26-243">To allow Azure Site Recovery to discover virtual machines running in your on-premises environment, you need to connect your VMware vCenter Server or vSphere ESXi hosts with Site Recovery.</span></span>

<span data-ttu-id="bbb26-244">Selezionare **+vCenter** per avviare la connessione di un server VMware vCenter o di un host VMware vSphere ESXi.</span><span class="sxs-lookup"><span data-stu-id="bbb26-244">Select **+vCenter** to start connecting a VMware vCenter server or a VMware vSphere ESXi host.</span></span>

[!INCLUDE [site-recovery-add-vcenter](../../includes/site-recovery-add-vcenter.md)]

<span data-ttu-id="bbb26-245">Site Recovery si connette ai server VMware usando le impostazioni specificate e individua le VM.</span><span class="sxs-lookup"><span data-stu-id="bbb26-245">Site Recovery connects to VMware servers using the specified settings, and discovers VMs.</span></span>

## <a name="set-up-the-target"></a><span data-ttu-id="bbb26-246">Configurare la destinazione</span><span class="sxs-lookup"><span data-stu-id="bbb26-246">Set up the target</span></span>

<span data-ttu-id="bbb26-247">Prima di configurare l'ambiente di destinazione, verificare di avere [una rete e un account di archiviazione di Azure](#set-up-azure).</span><span class="sxs-lookup"><span data-stu-id="bbb26-247">Before you set up the target environment, check you have an [Azure storage account and network](#set-up-azure)</span></span>

1. <span data-ttu-id="bbb26-248">Fare clic su **Preparare l'infrastruttura** > **Destinazione** e selezionare la sottoscrizione di Azure da usare.</span><span class="sxs-lookup"><span data-stu-id="bbb26-248">Click **Prepare infrastructure** > **Target**, and select the Azure subscription you want to use.</span></span>
2. <span data-ttu-id="bbb26-249">Specificare se per la destinazione deve essere usato il modello di distribuzione classica o Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="bbb26-249">Specify whether your target deployment model is Resource Manager-based, or classic.</span></span>
3. <span data-ttu-id="bbb26-250">Site Recovery verifica la disponibilità di uno o più account di archiviazione di Azure e reti compatibili.</span><span class="sxs-lookup"><span data-stu-id="bbb26-250">Site Recovery checks that you have one or more compatible Azure storage accounts and networks.</span></span>

   ![Destinazione](./media/site-recovery-vmware-to-azure/gs-target.png)
4. <span data-ttu-id="bbb26-252">Se non si è creato un account di archiviazione o una rete, fare clic su **+Account di archiviazione** o **+Rete** per creare una rete o un account Resource Manager inline.</span><span class="sxs-lookup"><span data-stu-id="bbb26-252">If you haven't created a storage account or network, click **+Storage account** or **+Network**, to create a Resource Manager account or network inline.</span></span>

## <a name="set-up-replication-settings"></a><span data-ttu-id="bbb26-253">Configurare le impostazioni di replica</span><span class="sxs-lookup"><span data-stu-id="bbb26-253">Set up replication settings</span></span>

<span data-ttu-id="bbb26-254">Ottenere una rapida panoramica video prima di iniziare:</span><span class="sxs-lookup"><span data-stu-id="bbb26-254">Get a quick video overview before you start:</span></span>
> [!VIDEO https://channel9.msdn.com/Series/Azure-Site-Recovery/VMware-to-Azure-with-ASR-Video2-vCenter-Server-Discovery-and-Replication-Policy/player]

1. <span data-ttu-id="bbb26-255">Per creare nuovi criteri di replica, fare clic su **Infrastruttura di Site Recovery** > **Criteri di replica** > **+Criteri di replica**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-255">To create a new replication policy, click **Site Recovery infrastructure** > **Replication Policies** > **+Replication Policy**.</span></span>
2. <span data-ttu-id="bbb26-256">In **Creare i criteri di replica** specificare un nome per i criteri.</span><span class="sxs-lookup"><span data-stu-id="bbb26-256">In **Create replication policy**, specify a policy name.</span></span>
3. <span data-ttu-id="bbb26-257">In **Soglia RPO**specificare il limite per RPO.</span><span class="sxs-lookup"><span data-stu-id="bbb26-257">In **RPO threshold**, specify the RPO limit.</span></span> <span data-ttu-id="bbb26-258">Questo valore specifica la frequenza con cui vengono creati punti di ripristino dei dati.</span><span class="sxs-lookup"><span data-stu-id="bbb26-258">This value specifies how often data recovery points are created.</span></span> <span data-ttu-id="bbb26-259">Se la replica continua supera questo limite, viene generato un avviso.</span><span class="sxs-lookup"><span data-stu-id="bbb26-259">An alert is generated if continuous replication exceeds this limit.</span></span>
4. <span data-ttu-id="bbb26-260">In **Conservazione del punto di ripristino** specificare la durata in ore dell'intervallo di conservazione per ogni punto di ripristino.</span><span class="sxs-lookup"><span data-stu-id="bbb26-260">In **Recovery point retention**, specify (in hours) how long the retention window is for each recovery point.</span></span> <span data-ttu-id="bbb26-261">Le VM replicate possono essere ripristinate in qualsiasi punto all'interno di un intervallo.</span><span class="sxs-lookup"><span data-stu-id="bbb26-261">Replicated VMs can be recovered to any point in a window.</span></span> <span data-ttu-id="bbb26-262">È supportata la conservazione fino a 24 ore per le macchine replicate in Archiviazione Premium e fino a 72 ore per Archiviazione Standard.</span><span class="sxs-lookup"><span data-stu-id="bbb26-262">Up to 24 hours retention is supported for machines replicated to premium storage, and 72 hours for standard storage.</span></span>
5. <span data-ttu-id="bbb26-263">In **Frequenza snapshot coerenti con l'app**specificare la frequenza, in minuti, per la creazione di punti di ripristino contenenti snapshot coerenti con l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="bbb26-263">In **App-consistent snapshot frequency**, specify how often (in minutes) recovery points containing application-consistent snapshots will be created.</span></span> <span data-ttu-id="bbb26-264">Fare clic su **OK** per creare i criteri.</span><span class="sxs-lookup"><span data-stu-id="bbb26-264">Click **OK** to create the policy.</span></span>

    ![Criteri di replica](./media/site-recovery-vmware-to-azure/gs-replication2.png)
8. <span data-ttu-id="bbb26-266">Quando si creano nuovi criteri, questi vengono associati automaticamente al server di configurazione.</span><span class="sxs-lookup"><span data-stu-id="bbb26-266">When you create a new policy it's automatically associated with the configuration server.</span></span> <span data-ttu-id="bbb26-267">Per impostazione predefinita vengono creati automaticamente criteri corrispondenti per il failback.</span><span class="sxs-lookup"><span data-stu-id="bbb26-267">By default, a matching policy is automatically created for failback.</span></span> <span data-ttu-id="bbb26-268">Se, ad esempio, il criterio di replica è **rep-policy**, il criterio di failback sarà **rep-policy-failback**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-268">For example, if the replication policy is **rep-policy** then the failback policy will be **rep-policy-failback**.</span></span> <span data-ttu-id="bbb26-269">Questi criteri non vengono usati fino a quando non si avvia un failback da Azure.</span><span class="sxs-lookup"><span data-stu-id="bbb26-269">This policy isn't used until you initiate a failback from Azure.</span></span>  



## <a name="plan-capacity"></a><span data-ttu-id="bbb26-270">Pianificare la capacità</span><span class="sxs-lookup"><span data-stu-id="bbb26-270">Plan capacity</span></span>

1. <span data-ttu-id="bbb26-271">Dopo aver configurato l'infrastruttura di base è possibile passare alla pianificazione della capacità e valutare se sono necessarie altre risorse.</span><span class="sxs-lookup"><span data-stu-id="bbb26-271">Now that you have your basic infrastructure set up you can think about capacity planning, and figure out whether you need additional resources.</span></span> <span data-ttu-id="bbb26-272">[Altre informazioni](site-recovery-plan-capacity-vmware.md).</span><span class="sxs-lookup"><span data-stu-id="bbb26-272">[Learn more](site-recovery-plan-capacity-vmware.md).</span></span>
2. <span data-ttu-id="bbb26-273">Dopo aver pianificato la capacità, scegliere **Sì** in **È stata completata la pianificazione della capacità?**</span><span class="sxs-lookup"><span data-stu-id="bbb26-273">When you’re done with capacity planning, select **Yes** in **Have you completed capacity planning?**</span></span>

   ![Pianificazione della capacità](./media/site-recovery-vmware-to-azure/gs-capacity-planning.png)


## <a name="prepare-vms-for-replication"></a><span data-ttu-id="bbb26-275">Preparare le VM per la replica</span><span class="sxs-lookup"><span data-stu-id="bbb26-275">Prepare VMs for replication</span></span>

<span data-ttu-id="bbb26-276">Il servizio Mobility deve essere installato in tutte le VM VMware da replicare.</span><span class="sxs-lookup"><span data-stu-id="bbb26-276">The Mobility service must be installed on all VMware VMs that you want to replicate.</span></span> <span data-ttu-id="bbb26-277">È possibile installare il servizio Mobility in diversi modi:</span><span class="sxs-lookup"><span data-stu-id="bbb26-277">You can install the Mobility service in a number of ways:</span></span>

1. <span data-ttu-id="bbb26-278">Installazione push dal server di elaborazione.</span><span class="sxs-lookup"><span data-stu-id="bbb26-278">Install with a push installation from the process server.</span></span> <span data-ttu-id="bbb26-279">Per usare questo metodo è necessario preparare le VM.</span><span class="sxs-lookup"><span data-stu-id="bbb26-279">You need to prepare VMs to use this method.</span></span>
2. <span data-ttu-id="bbb26-280">Installazione con strumenti di distribuzione come System Center Configuration Manager o Automation DSC per Azure.</span><span class="sxs-lookup"><span data-stu-id="bbb26-280">Install using deployment tools such as System Center Configuration Manager, or Azure automation DSC.</span></span>
3.  <span data-ttu-id="bbb26-281">Installazione manuale.</span><span class="sxs-lookup"><span data-stu-id="bbb26-281">Install manually.</span></span>

[<span data-ttu-id="bbb26-282">Altre informazioni</span><span class="sxs-lookup"><span data-stu-id="bbb26-282">Learn more</span></span>](site-recovery-vmware-to-azure-install-mob-svc.md)


## <a name="enable-replication"></a><span data-ttu-id="bbb26-283">Abilitare la replica</span><span class="sxs-lookup"><span data-stu-id="bbb26-283">Enable replication</span></span>

<span data-ttu-id="bbb26-284">Prima di iniziare:</span><span class="sxs-lookup"><span data-stu-id="bbb26-284">Before you start:</span></span>

- <span data-ttu-id="bbb26-285">L'account utente di Azure deve disporre di determinate [autorizzazioni](site-recovery-role-based-linked-access-control.md#permissions-required-to-enable-replication-for-new-virtual-machines) per abilitare la replica di una nuova macchina virtuale in Azure.</span><span class="sxs-lookup"><span data-stu-id="bbb26-285">Your Azure user account needs to have certain [permissions](site-recovery-role-based-linked-access-control.md#permissions-required-to-enable-replication-for-new-virtual-machines) to enable replication of a new virtual machine to Azure.</span></span>
- <span data-ttu-id="bbb26-286">Quando si aggiungono o si modificano VM, possono trascorrere 15 minuti o più prima che le modifiche diventino effettive e vengano visualizzate nel portale.</span><span class="sxs-lookup"><span data-stu-id="bbb26-286">When you add or modify VMs, it can take up to 15 minutes or longer for changes to take effect, and for them to appear in the portal.</span></span>
- <span data-ttu-id="bbb26-287">È possibile controllare l'ora dell'ultima individuazione di VM in **Server di configurazione** > **Ora ultimo contatto**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-287">You can check the last discovered time for VMs in **Configuration Servers** > **Last Contact At**.</span></span>
- <span data-ttu-id="bbb26-288">Per aggiungere VM senza attendere l'individuazione pianificata, evidenziare il server di configurazione, senza selezionarlo, e fare clic su **Aggiorna**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-288">To add VMs without waiting for the scheduled discovery, highlight the configuration server (don’t click it), and click **Refresh**.</span></span>
- <span data-ttu-id="bbb26-289">Se una VM è pronta per l'installazione push, il server di elaborazione installa automaticamente il servizio Mobility quando si abilita la replica.</span><span class="sxs-lookup"><span data-stu-id="bbb26-289">If a VM is prepared for push installation, the process server automatically installs the Mobility service when you enable replication.</span></span>


### <a name="exclude-disks-from-replication"></a><span data-ttu-id="bbb26-290">Escludere dischi dalla replica</span><span class="sxs-lookup"><span data-stu-id="bbb26-290">Exclude disks from replication</span></span>

<span data-ttu-id="bbb26-291">Per impostazione predefinita, vengono replicati tutti i dischi in un computer.</span><span class="sxs-lookup"><span data-stu-id="bbb26-291">By default all disks on a machine are replicated.</span></span> <span data-ttu-id="bbb26-292">È possibile escludere dischi dalla replica.</span><span class="sxs-lookup"><span data-stu-id="bbb26-292">You can exclude disks from replication.</span></span> <span data-ttu-id="bbb26-293">Ad esempio, è possibile evitare di replicare i dischi con dati temporanei o dati che vengono aggiornati ogni volta che un computer o un'applicazione viene riavviata, come pagefile.sys o tempdb di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="bbb26-293">For example you might not want to replicate disks with temporary data, or data that's refreshed each time a machine or application restarts (for example pagefile.sys or SQL Server tempdb).</span></span>

### <a name="replicate-vms"></a><span data-ttu-id="bbb26-294">Replicare le VM</span><span class="sxs-lookup"><span data-stu-id="bbb26-294">Replicate VMs</span></span>

<span data-ttu-id="bbb26-295">Prima di iniziare, guardare una rapida panoramica video</span><span class="sxs-lookup"><span data-stu-id="bbb26-295">Before you start, watch a quick video overview</span></span>

>[!VIDEO https://channel9.msdn.com/Series/Azure-Site-Recovery/VMware-to-Azure-with-ASR-Video3-Protect-VMware-Virtual-Machines/player]

1. <span data-ttu-id="bbb26-296">Fare clic su **Passaggio 2: Eseguire la replica dell'applicazione** > **Origine**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-296">Click **Step 2: Replicate application** > **Source**.</span></span>
2. <span data-ttu-id="bbb26-297">In **Origine** selezionare il server di configurazione.</span><span class="sxs-lookup"><span data-stu-id="bbb26-297">In **Source**, select the configuration server.</span></span>
3. <span data-ttu-id="bbb26-298">In **Tipo di computer** selezionare **Macchine virtuali**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-298">In **Machine type**, select **Virtual Machines**.</span></span>
4. <span data-ttu-id="bbb26-299">In **vCenter/vSphere Hypervisor** selezionare il server vCenter che gestisce l'host di vSphere oppure selezionare l'host.</span><span class="sxs-lookup"><span data-stu-id="bbb26-299">In **vCenter/vSphere Hypervisor**, select the vCenter server that manages the vSphere host, or select the host.</span></span>
5. <span data-ttu-id="bbb26-300">Selezionare il server di elaborazione.</span><span class="sxs-lookup"><span data-stu-id="bbb26-300">Select the process server.</span></span> <span data-ttu-id="bbb26-301">Se non sono stati creati server di elaborazione aggiuntivi, questo sarà il server di configurazione.</span><span class="sxs-lookup"><span data-stu-id="bbb26-301">If you haven't created any additional process servers this will be the configuration server.</span></span> <span data-ttu-id="bbb26-302">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-302">Then click **OK**.</span></span>

    ![Abilitare la replica](./media/site-recovery-vmware-to-azure/enable-replication2.png)

6. <span data-ttu-id="bbb26-304">In **Destinazione** selezionare la sottoscrizione e il gruppo di risorse in cui si vogliono creare le VM di cui viene effettuato il failover.</span><span class="sxs-lookup"><span data-stu-id="bbb26-304">In **Target**, select the subscription and the resource group in which you want to create the failed over VMs.</span></span> <span data-ttu-id="bbb26-305">Scegliere il modello di distribuzione (classica o Resource Manager) da usare in Azure per le VM di cui viene effettuato il failover.</span><span class="sxs-lookup"><span data-stu-id="bbb26-305">Choose the deployment model that you want to use in Azure (classic or resource management), for the failed over VMs.</span></span>


7. <span data-ttu-id="bbb26-306">Selezionare l'account di archiviazione di Azure da usare per la replica dei dati.</span><span class="sxs-lookup"><span data-stu-id="bbb26-306">Select the Azure storage account you want to use for replicating data.</span></span> <span data-ttu-id="bbb26-307">Se non si vuole usare un account già configurato, è possibile crearne uno nuovo.</span><span class="sxs-lookup"><span data-stu-id="bbb26-307">If you don't want to use an account you've already set up, you can create a new one.</span></span>

8. <span data-ttu-id="bbb26-308">Selezionare la rete di Azure e la subnet a cui dovranno connettersi le VM di Azure create dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="bbb26-308">Select the Azure network and subnet to which Azure VMs will connect, when they're created after failover.</span></span> <span data-ttu-id="bbb26-309">Scegliere **Configurare ora per le macchine virtuali selezionate** per applicare le impostazioni di rete a tutti i computer selezionati per la protezione.</span><span class="sxs-lookup"><span data-stu-id="bbb26-309">Select **Configure now for selected machines**, to apply the network setting to all machines you select for protection.</span></span> <span data-ttu-id="bbb26-310">Scegliere **Configurare in seguito** per selezionare la rete di Azure per ogni computer.</span><span class="sxs-lookup"><span data-stu-id="bbb26-310">Select **Configure later** to select the Azure network per machine.</span></span> <span data-ttu-id="bbb26-311">Se non si vuole usare una rete esistente, è possibile crearne una.</span><span class="sxs-lookup"><span data-stu-id="bbb26-311">If you don't want to use an existing network, you can create one.</span></span>

    ![Abilitare la replica](./media/site-recovery-vmware-to-azure/enable-rep3.png)
9. <span data-ttu-id="bbb26-313">In **Macchine virtuali** > **Seleziona macchine virtuali** fare clic per selezionare tutte le macchine virtuali da replicare.</span><span class="sxs-lookup"><span data-stu-id="bbb26-313">In **Virtual Machines** > **Select virtual machines**, click and select each machine you want to replicate.</span></span> <span data-ttu-id="bbb26-314">È possibile selezionare solo i computer per cui è possibile abilitare la replica.</span><span class="sxs-lookup"><span data-stu-id="bbb26-314">You can only select machines for which replication can be enabled.</span></span> <span data-ttu-id="bbb26-315">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-315">Then click **OK**.</span></span>

    ![Abilitare la replica](./media/site-recovery-vmware-to-azure/enable-replication5.png)
10. <span data-ttu-id="bbb26-317">In **Proprietà** > **Configura proprietà**selezionare l'account che verrà usato dal server di elaborazione per installare automaticamente il servizio Mobility nel computer.</span><span class="sxs-lookup"><span data-stu-id="bbb26-317">In **Properties** > **Configure properties**, select the account that will be used by the process server to automatically install the Mobility service on the machine.</span></span>
11. <span data-ttu-id="bbb26-318">Per impostazione predefinita, vengono replicati tutti i dischi.</span><span class="sxs-lookup"><span data-stu-id="bbb26-318">By default all disks are replicated.</span></span> <span data-ttu-id="bbb26-319">Fare clic su **Tutti i dischi** e deselezionare i dischi da non replicare.</span><span class="sxs-lookup"><span data-stu-id="bbb26-319">Click **All Disks** and clear any disks you don't want to replicate.</span></span> <span data-ttu-id="bbb26-320">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-320">Then click **OK**.</span></span> <span data-ttu-id="bbb26-321">È possibile impostare proprietà aggiuntive delle VM in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="bbb26-321">You can set additional VM properties later.</span></span>

    ![Abilitare la replica](./media/site-recovery-vmware-to-azure/enable-replication6.png)
11. <span data-ttu-id="bbb26-323">In **Impostazioni della replica** > **Configura impostazioni di replica** verificare che siano selezionati i criteri di replica corretti.</span><span class="sxs-lookup"><span data-stu-id="bbb26-323">In **Replication settings** > **Configure replication settings**, verify that the correct replication policy is selected.</span></span> <span data-ttu-id="bbb26-324">Se si modificano i criteri, le modifiche verranno applicate al computer di replica e ai nuovi computer.</span><span class="sxs-lookup"><span data-stu-id="bbb26-324">If you modify a policy, changes will be applied to replicating machine, and to new machines.</span></span>
12. <span data-ttu-id="bbb26-325">Abilitare la **Coerenza tra più VM** per raccogliere le macchine in un gruppo di replica e specificare un nome per il gruppo.</span><span class="sxs-lookup"><span data-stu-id="bbb26-325">Enable **Multi-VM consistency** if you want to gather machines into a replication group, and specify a name for the group.</span></span> <span data-ttu-id="bbb26-326">Fare quindi clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-326">Then click **OK**.</span></span> <span data-ttu-id="bbb26-327">Si noti che:</span><span class="sxs-lookup"><span data-stu-id="bbb26-327">Note that:</span></span>

    * <span data-ttu-id="bbb26-328">I computer in gruppi di replica vengono replicati insieme e hanno punti di ripristino condivisi coerenti con l'arresto anomalo del sistema e coerenti con l'app in caso di failover.</span><span class="sxs-lookup"><span data-stu-id="bbb26-328">Machines in replication groups replicate together, and have shared crash-consistent and app-consistent recovery points when they fail over.</span></span>
    * <span data-ttu-id="bbb26-329">È consigliabile raggruppare le macchine virtuali e i server fisici in modo da rispecchiare i carichi di lavoro.</span><span class="sxs-lookup"><span data-stu-id="bbb26-329">We recommend that you gather VMs and physical servers together so that they mirror your workloads.</span></span> <span data-ttu-id="bbb26-330">L'abilitazione della coerenza tra più VM può influire sulle prestazioni del carico di lavoro e deve essere usata solo se i computer eseguono lo stesso carico di lavoro ed è necessaria la coerenza.</span><span class="sxs-lookup"><span data-stu-id="bbb26-330">Enabling multi-VM consistency can impact workload performance, and should only be used if machines are running the same workload and you need consistency.</span></span>

    ![Abilitare la replica](./media/site-recovery-vmware-to-azure/enable-replication7.png)
13. <span data-ttu-id="bbb26-332">Fare clic su **Abilita la replica**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-332">Click **Enable Replication**.</span></span> <span data-ttu-id="bbb26-333">È possibile tenere traccia dello stato del processo **Abilita protezione** in **Impostazioni** > **Processi** > **Processi di Site Recovery**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-333">You can track progress of the **Enable Protection** job in **Settings** > **Jobs** > **Site Recovery Jobs**.</span></span> <span data-ttu-id="bbb26-334">Dopo l'esecuzione del processo **Finalizza protezione** la macchina virtuale è pronta per il failover.</span><span class="sxs-lookup"><span data-stu-id="bbb26-334">After the **Finalize Protection** job runs the machine is ready for failover.</span></span>

### <a name="view-and-manage-vm-properties"></a><span data-ttu-id="bbb26-335">Visualizzare e gestire le proprietà della macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="bbb26-335">View and manage VM properties</span></span>

<span data-ttu-id="bbb26-336">È consigliabile verificare le proprietà delle VM e apportare tutte le modifiche eventualmente necessarie.</span><span class="sxs-lookup"><span data-stu-id="bbb26-336">We recommend that you verify the VM properties, and make any changes you need to.</span></span>

1. <span data-ttu-id="bbb26-337">Fare clic su **Elementi replicati** e selezionare il computer.</span><span class="sxs-lookup"><span data-stu-id="bbb26-337">Click **Replicated items** >, and select the machine.</span></span> <span data-ttu-id="bbb26-338">Il pannello **Informazioni di base** visualizza informazioni sulle impostazioni e sullo stato dei computer.</span><span class="sxs-lookup"><span data-stu-id="bbb26-338">The **Essentials** blade shows information about machines settings and status.</span></span>
2. <span data-ttu-id="bbb26-339">In **Proprietà** sono disponibili le informazioni su replica e failover per la VM.</span><span class="sxs-lookup"><span data-stu-id="bbb26-339">In **Properties**, you can view replication and failover information for the VM.</span></span>
3. <span data-ttu-id="bbb26-340">In **Calcolo e rete** > **Proprietà di calcolo** è possibile specificare le dimensioni di destinazione e il nome della VM di Azure.</span><span class="sxs-lookup"><span data-stu-id="bbb26-340">In **Compute and Network** > **Compute properties**, you can specify the Azure VM name and target size.</span></span> <span data-ttu-id="bbb26-341">Se necessario, modificare il nome in modo che sia conforme ai [requisiti di Azure](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements) .</span><span class="sxs-lookup"><span data-stu-id="bbb26-341">Modify the name to comply with [Azure requirements](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements) if you need to.</span></span>
4. <span data-ttu-id="bbb26-342">Modificare le impostazioni per la rete, la subnet e l'indirizzo IP di destinazione che verranno assegnati alla VM di Azure.</span><span class="sxs-lookup"><span data-stu-id="bbb26-342">Modify settings for the target network, subnet, and IP address that will be assigned to the Azure VM:</span></span>

   - <span data-ttu-id="bbb26-343">È possibile impostare l'indirizzo IP di destinazione.</span><span class="sxs-lookup"><span data-stu-id="bbb26-343">You can set the target IP address.</span></span>

    - <span data-ttu-id="bbb26-344">Se non si specifica un indirizzo, il computer di cui è stato eseguito il failover usa DHCP.</span><span class="sxs-lookup"><span data-stu-id="bbb26-344">If you don't provide an address, the failed over machine will use DHCP.</span></span>
    - <span data-ttu-id="bbb26-345">Se si imposta un indirizzo che non è disponibile al momento del failover, il failover non riesce.</span><span class="sxs-lookup"><span data-stu-id="bbb26-345">If you set an address that isn't available at failover, failover won't work.</span></span>
    - <span data-ttu-id="bbb26-346">Lo stesso indirizzo IP di destinazione può essere usato per il failover di test, se è disponibile nella rete di failover di test.</span><span class="sxs-lookup"><span data-stu-id="bbb26-346">The same target IP address can be used for test failover, if the address is available in the test failover network.</span></span>

   - <span data-ttu-id="bbb26-347">Il numero di schede di rete dipende dalle dimensioni specificate per la macchina virtuale di destinazione:</span><span class="sxs-lookup"><span data-stu-id="bbb26-347">The number of network adapters is dictated by the size you specify for the target virtual machine:</span></span>

     - <span data-ttu-id="bbb26-348">Se il numero di schede di rete nel computer di origine è minore o uguale al numero di schede consentito per le dimensioni del computer di destinazione, la destinazione avrà lo stesso numero di schede dell'origine.</span><span class="sxs-lookup"><span data-stu-id="bbb26-348">If the number of network adapters on the source machine is the same as, or less than, the number of adapters allowed for the target machine size, then the target will have the same number of adapters as the source.</span></span>
     - <span data-ttu-id="bbb26-349">Se il numero di schede della macchina virtuale di origine supera il numero consentito per le dimensioni della destinazione, verranno usate le dimensioni massime della destinazione.</span><span class="sxs-lookup"><span data-stu-id="bbb26-349">If the number of adapters for the source virtual machine exceeds the number allowed for the target size, then the target size maximum will be used.</span></span>
     - <span data-ttu-id="bbb26-350">Ad esempio, se una macchina di origine ha due schede di rete e le dimensioni della macchina di destinazione ne supportano quattro, la macchina di destinazione avrà due schede.</span><span class="sxs-lookup"><span data-stu-id="bbb26-350">For example, if a source machine has two network adapters and the target machine size supports four, the target machine will have two adapters.</span></span> <span data-ttu-id="bbb26-351">Se la macchina di origine dispone di due schede ma le dimensioni di destinazione supportate ne consentono solo una, la macchina di destinazione avrà una sola scheda.</span><span class="sxs-lookup"><span data-stu-id="bbb26-351">If the source machine has two adapters but the supported target size only supports one then the target machine will have only one adapter.</span></span>     
   - <span data-ttu-id="bbb26-352">Se la macchina virtuale ha più schede di rete, si connetteranno tutte alla stessa rete.</span><span class="sxs-lookup"><span data-stu-id="bbb26-352">If the virtual machine has multiple network adapters they will all connect to the same network.</span></span>
   - <span data-ttu-id="bbb26-353">Se la macchina virtuale ha più schede di rete, la prima nell'elenco diventa la scheda di rete *predefinita* nella macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="bbb26-353">If the virtual machine has multiple network adapters then the first one shown in the list becomes the *Default* network adapter in the Azure virtual machine.</span></span>
4. <span data-ttu-id="bbb26-354">In **Dischi** vengono visualizzati il sistema operativo della VM e i dischi dati che verranno replicati.</span><span class="sxs-lookup"><span data-stu-id="bbb26-354">In **Disks**, you can see the VM operating system, and the data disks that will be replicated.</span></span>

#### <a name="managed-disks"></a><span data-ttu-id="bbb26-355">Dischi gestiti</span><span class="sxs-lookup"><span data-stu-id="bbb26-355">Managed disks</span></span>

<span data-ttu-id="bbb26-356">In **Calcolo e rete** > **Proprietà di calcolo** è possibile impostare l'opzione "Usa dischi gestiti" della macchina virtuale su "Sì" per collegare i dischi gestiti al computer in uso al momento del failover in Azure.</span><span class="sxs-lookup"><span data-stu-id="bbb26-356">In **Compute and Network** > **Compute properties**, you can set "Use managed disks" setting to "Yes" for the VM if you want to attach managed disks to your machine on failover to Azure.</span></span> <span data-ttu-id="bbb26-357">Managed Disks semplifica la gestione dei dischi per le macchine virtuali IaaS di Azure grazie alla gestione degli account di archiviazione associati ai dischi delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="bbb26-357">Managed disks simplifies disk management for Azure IaaS VMs by managing the storage accounts associated with the VM disks.</span></span> <span data-ttu-id="bbb26-358">Altre informazioni su [Managed Disks](https://docs.microsoft.com/en-us/azure/storage/storage-managed-disks-overview)</span><span class="sxs-lookup"><span data-stu-id="bbb26-358">[Learn More about managed disks.](https://docs.microsoft.com/en-us/azure/storage/storage-managed-disks-overview)</span></span>

   - <span data-ttu-id="bbb26-359">I dischi gestiti vengono creati e collegati alla macchina virtuale solo in caso di failover in Azure.</span><span class="sxs-lookup"><span data-stu-id="bbb26-359">Managed disks are created and attached to the virtual machine only on a failover to Azure.</span></span> <span data-ttu-id="bbb26-360">Abilitando la protezione, i dati verranno comunque replicati dai computer locali agli account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="bbb26-360">On enabling protection, data from on-premises machines will continue to replicate to storage accounts.</span></span>  <span data-ttu-id="bbb26-361">È possibile creare dischi gestiti solo per le macchine virtuali distribuite tramite il modello di distribuzione di Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="bbb26-361">Managed disks can be created only for virtual machines deployed using the Resource manager deployment model.</span></span>  

   - <span data-ttu-id="bbb26-362">Quando l'opzione "Usa dischi gestiti" viene impostata su "Sì", nel gruppo di risorse è possibile selezionare solo i set di disponibilità con l'opzione "Usa dischi gestiti" impostata su "Sì".</span><span class="sxs-lookup"><span data-stu-id="bbb26-362">When you set "Use managed disks" to "Yes", only availability sets in the resource group with "Use managed disks" set to "Yes" would be available for selection.</span></span> <span data-ttu-id="bbb26-363">Infatti, le macchine virtuali con dischi gestiti possono solo far parte di set di disponibilità la cui proprietà "Usa dischi gestiti" è impostata su "Sì".</span><span class="sxs-lookup"><span data-stu-id="bbb26-363">This is because virtual machines with managed disks can only be part of availability sets with "Use managed disks" property set to "Yes".</span></span> <span data-ttu-id="bbb26-364">Verificare di creare set di disponibilità con la proprietà "Usa dischi gestiti" impostata in funzione dell'intenzione di usare i dischi gestiti in caso di failover.</span><span class="sxs-lookup"><span data-stu-id="bbb26-364">Make sure that you create availability sets with "Use managed disks" property set based on your intent to use managed disks on failover.</span></span>  <span data-ttu-id="bbb26-365">Allo stesso modo, quando l'opzione "Usa dischi gestiti" è impostata su "No", nel gruppo di risorse è possibile selezionare solo i set di disponibilità con la proprietà "Usa dischi gestiti" impostata su "No".</span><span class="sxs-lookup"><span data-stu-id="bbb26-365">Likewise, when you set "Use managed disks" to "No", only availability sets in the resource group with "Use managed disks" property set to "No" would be available for selection.</span></span> <span data-ttu-id="bbb26-366">[Altre informazioni sui dischi gestiti e i set di disponibilità](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/manage-availability#use-managed-disks-for-vms-in-an-availability-set).</span><span class="sxs-lookup"><span data-stu-id="bbb26-366">[Learn more about managed disks and availability sets](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/manage-availability#use-managed-disks-for-vms-in-an-availability-set).</span></span>

  > [!NOTE]
  > <span data-ttu-id="bbb26-367">Se l'account di archiviazione usato per la replica è stato crittografato con Crittografia del servizio di archiviazione in un qualsiasi momento, la creazione dei dischi gestiti durante il failover non avrà esito positivo.</span><span class="sxs-lookup"><span data-stu-id="bbb26-367">If the storage account used for replication was encrypted with Storage Service Encryption at any point in time, creation of managed disks during failover will fail.</span></span> <span data-ttu-id="bbb26-368">È possibile impostare "Usa dischi gestiti" su "No" e ripetere il failover oppure disabilitare la protezione per la macchina virtuale e proteggerla in un account di archiviazione per il quale non sia attivata la Crittografia del servizio di archiviazione in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="bbb26-368">You can either set "Use managed disks" to "No" and retry failover or disable protection for the virtual machine and protect it to a storage account which did not have Storage service encryption enabled at any point in time.</span></span>
  > <span data-ttu-id="bbb26-369">[Altre informazioni su Crittografia del servizio di archiviazione e dischi gestiti](https://docs.microsoft.com/en-us/azure/storage/storage-managed-disks-overview#managed-disks-and-encryption).</span><span class="sxs-lookup"><span data-stu-id="bbb26-369">[Learn more about Storage service encryption and managed disks](https://docs.microsoft.com/en-us/azure/storage/storage-managed-disks-overview#managed-disks-and-encryption).</span></span>


## <a name="run-a-test-failover"></a><span data-ttu-id="bbb26-370">Eseguire un failover di test</span><span class="sxs-lookup"><span data-stu-id="bbb26-370">Run a test failover</span></span>


<span data-ttu-id="bbb26-371">Dopo aver completato la configurazione, eseguire un failover di test per verificare che tutti gli elementi funzionino come previsto.</span><span class="sxs-lookup"><span data-stu-id="bbb26-371">After you've set everything up, run a test failover to make sure everything's working as expected.</span></span> <span data-ttu-id="bbb26-372">Ottenere una rapida panoramica video prima di iniziare</span><span class="sxs-lookup"><span data-stu-id="bbb26-372">Get a quick video overview before you start</span></span>
>[!VIDEO https://channel9.msdn.com/Series/Azure-Site-Recovery/VMware-to-Azure-with-ASR-Video4-Recovery-Plan-DR-Drill-and-Failover/player]


1. <span data-ttu-id="bbb26-373">Per eseguire il failover di una singola macchina, in **Impostazioni** > **Elementi replicati** fare clic sulla VM > sull'icona  **+Failover di test**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-373">To fail over a single machine, in **Settings** > **Replicated Items**, click the VM > **+Test Failover** icon.</span></span>

    ![Failover di test](./media/site-recovery-vmware-to-azure/TestFailover.png)

1. <span data-ttu-id="bbb26-375">Per eseguire il failover di un piano di ripristino, in **Impostazioni** > **Piani di ripristino** fare clic con il pulsante destro del mouse sul piano e quindi scegliere **Failover di test**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-375">To fail over a recovery plan, in **Settings** > **Recovery Plans**, right-click the plan > **Test Failover**.</span></span> <span data-ttu-id="bbb26-376">Per creare un piano di ripristino, [seguire queste istruzioni](site-recovery-create-recovery-plans.md).</span><span class="sxs-lookup"><span data-stu-id="bbb26-376">To create a recovery plan, [follow these instructions](site-recovery-create-recovery-plans.md).</span></span>  

1. <span data-ttu-id="bbb26-377">In **Failover di test** selezionare la rete di Azure a cui dovranno connettersi le VM di Azure dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="bbb26-377">In **Test Failover**, select the Azure network to which Azure VMs will be connected after failover occurs.</span></span>

1. <span data-ttu-id="bbb26-378">Fare clic su **OK** per iniziare il failover.</span><span class="sxs-lookup"><span data-stu-id="bbb26-378">Click **OK** to begin the failover.</span></span> <span data-ttu-id="bbb26-379">Per tenere traccia dello stato del processo, fare clic sulla VM per visualizzarne le proprietà oppure fare clic sul processo **Failover di test** nel nome dell'insieme di credenziali > **Impostazioni** > **Processi** > **Processi di Site Recovery**.</span><span class="sxs-lookup"><span data-stu-id="bbb26-379">You can track progress by clicking on the VM to open its properties, or on the **Test Failover** job in vault name > **Settings** > **Jobs** > **Site Recovery jobs**.</span></span>

1. <span data-ttu-id="bbb26-380">Al termine del failover sarà possibile visualizzare la macchina virtuale di Azure di replica in **Macchine virtuali** nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="bbb26-380">After the failover completes, you should also be able to see the replica Azure machine appear in the Azure portal > **Virtual Machines**.</span></span> <span data-ttu-id="bbb26-381">Assicurarsi che la macchina virtuale sia delle dimensioni appropriate, che sia connessa alla rete giusta e che sia in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="bbb26-381">You should make sure that the VM is the appropriate size, that it's connected to the appropriate network, and that it's running.</span></span>

1. <span data-ttu-id="bbb26-382">Se sono state [preparate le connessioni dopo il failover](site-recovery-test-failover-to-azure.md#prepare-to-connect-to-azure-vms-after-failover), sarà possibile connettersi alla VM di Azure.</span><span class="sxs-lookup"><span data-stu-id="bbb26-382">If you [prepared for connections after failover](site-recovery-test-failover-to-azure.md#prepare-to-connect-to-azure-vms-after-failover), you should be able to connect to the Azure VM.</span></span>

1. <span data-ttu-id="bbb26-383">Al termine, fare clic su **Cleanup test failover** (Pulizia failover di test) nel piano di ripristino.</span><span class="sxs-lookup"><span data-stu-id="bbb26-383">Once you're done, click on **Cleanup test failover** on the recovery plan.</span></span> <span data-ttu-id="bbb26-384">Fare clic su **Note** per registrare e salvare eventuali osservazioni associate al failover di test.</span><span class="sxs-lookup"><span data-stu-id="bbb26-384">In **Notes**, record and save any observations associated with the test failover.</span></span> <span data-ttu-id="bbb26-385">Verranno eliminate le VM create durante il failover di test.</span><span class="sxs-lookup"><span data-stu-id="bbb26-385">This will delete the VMs that were created during test failover.</span></span>

<span data-ttu-id="bbb26-386">[Altre informazioni](site-recovery-test-failover-to-azure.md) sui failover di test.</span><span class="sxs-lookup"><span data-stu-id="bbb26-386">[Learn more](site-recovery-test-failover-to-azure.md) about test failovers.</span></span>


## <a name="vmware-account-permissions"></a><span data-ttu-id="bbb26-387">Autorizzazioni dell'account VMware</span><span class="sxs-lookup"><span data-stu-id="bbb26-387">VMware account permissions</span></span>

<span data-ttu-id="bbb26-388">Site Recovery deve avere accesso a VMware per l'individuazione automatica delle VM da parte del server di elaborazione e per il failover e il failback delle VM.</span><span class="sxs-lookup"><span data-stu-id="bbb26-388">Site Recovery needs access to VMware for the process server to automatically discover VMs, and for failover and failback of VMs.</span></span>

- <span data-ttu-id="bbb26-389">**Migrazione**: se si vuole eseguire solo la migrazione di VM VMware in Azure, senza failback, è possibile usare un account VMware con un ruolo di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="bbb26-389">**Migrate**: If you only want to migrate VMware VMs to Azure, without ever failing them back, you can use a VMware account with a read-only role.</span></span> <span data-ttu-id="bbb26-390">Un ruolo di questo tipo può eseguire il failover, ma non arrestare i computer di origine protetti.</span><span class="sxs-lookup"><span data-stu-id="bbb26-390">Such a role can run failover, but can't shut down protected source machines.</span></span> <span data-ttu-id="bbb26-391">Ciò non è necessario per la migrazione.</span><span class="sxs-lookup"><span data-stu-id="bbb26-391">This isn't necessary for migration.</span></span>
- <span data-ttu-id="bbb26-392">**Replica/ripristino**: se si vuole distribuire una replica completa (replica, failover e failback), l'account deve poter eseguire operazioni come la creazione e la rimozione di dischi, l'accensione di VM e così via.</span><span class="sxs-lookup"><span data-stu-id="bbb26-392">**Replicate/Recover**: If you want to deploy full replication (replicate, failover, failback) the account must be able to run operations such as creating and removing disks, powering on VMs etc.</span></span>
- <span data-ttu-id="bbb26-393">**Individuazione automatica**: è necessario almeno un account di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="bbb26-393">**Automatic discovery**: At least a read-only account is required.</span></span>


<span data-ttu-id="bbb26-394">**Attività**</span><span class="sxs-lookup"><span data-stu-id="bbb26-394">**Task**</span></span> | <span data-ttu-id="bbb26-395">**Account/ruolo necessario**</span><span class="sxs-lookup"><span data-stu-id="bbb26-395">**Required account/role**</span></span> | <span data-ttu-id="bbb26-396">**Autorizzazioni**</span><span class="sxs-lookup"><span data-stu-id="bbb26-396">**Permissions**</span></span> | <span data-ttu-id="bbb26-397">**Dettagli**</span><span class="sxs-lookup"><span data-stu-id="bbb26-397">**Details**</span></span>
--- | --- | --- | ---
<span data-ttu-id="bbb26-398">**Individuazione automatica delle VM VMware da parte del server di elaborazione**</span><span class="sxs-lookup"><span data-stu-id="bbb26-398">**Process server automatically discovers VMware VMs**</span></span> | <span data-ttu-id="bbb26-399">È necessario almeno un utente di sola lettura</span><span class="sxs-lookup"><span data-stu-id="bbb26-399">You need at least a read-only user</span></span> | <span data-ttu-id="bbb26-400">Data Center object (Oggetto data center)–> Propagate to Child Object (Propaga a oggetto figlio), role=Read-only (ruolo=Sola lettura)</span><span class="sxs-lookup"><span data-stu-id="bbb26-400">Data Center object –> Propagate to Child Object, role=Read-only</span></span> | <span data-ttu-id="bbb26-401">L'utente viene assegnato a livello di data center e ha accesso a tutti gli oggetti nel data center.</span><span class="sxs-lookup"><span data-stu-id="bbb26-401">User assigned at datacenter level, and has access to all the objects in the datacenter.</span></span><br/><br/> <span data-ttu-id="bbb26-402">Per limitare l'accesso, assegnare il ruolo **No access** (Nessun accesso) con **Propagate to child object** (Propaga a oggetto figlio) agli oggetti figlio (host vSphere, archivi dati, VM e reti).</span><span class="sxs-lookup"><span data-stu-id="bbb26-402">To restrict access, assign the **No access** role with the **Propagate to child** object, to the child objects (vSphere hosts, datastores, VMs and networks).</span></span>
<span data-ttu-id="bbb26-403">**Failover**</span><span class="sxs-lookup"><span data-stu-id="bbb26-403">**Failover**</span></span> | <span data-ttu-id="bbb26-404">È necessario almeno un utente di sola lettura</span><span class="sxs-lookup"><span data-stu-id="bbb26-404">You need at least a read-only user</span></span> | <span data-ttu-id="bbb26-405">Data Center object (Oggetto data center)–> Propagate to Child Object (Propaga a oggetto figlio), role=Read-only (ruolo=Sola lettura)</span><span class="sxs-lookup"><span data-stu-id="bbb26-405">Data Center object –> Propagate to Child Object, role=Read-only</span></span> | <span data-ttu-id="bbb26-406">L'utente viene assegnato a livello di data center e ha accesso a tutti gli oggetti nel data center.</span><span class="sxs-lookup"><span data-stu-id="bbb26-406">User assigned at datacenter level, and has access to all the objects in the datacenter.</span></span><br/><br/> <span data-ttu-id="bbb26-407">Per limitare l'accesso, assegnare il ruolo **No access** (Nessun accesso) con **Propagate to child object** (Propaga a oggetto figlio) agli oggetti figlio (host vSphere, archivi dati, VM e reti).</span><span class="sxs-lookup"><span data-stu-id="bbb26-407">To restrict access, assign the **No access** role with the **Propagate to child** object to the child objects (vSphere hosts, datastores, VMs and networks).</span></span><br/><br/> <span data-ttu-id="bbb26-408">È utile ai fini della migrazione, ma non per la replica completa, il failover e il failback.</span><span class="sxs-lookup"><span data-stu-id="bbb26-408">Useful for migration purposes, but not full replication, failover, failback.</span></span>
<span data-ttu-id="bbb26-409">**Failover e failback**</span><span class="sxs-lookup"><span data-stu-id="bbb26-409">**Failover and failback**</span></span> | <span data-ttu-id="bbb26-410">Suggeriamo di creare un ruolo (Azure_Site_Recovery) con le necessarie autorizzazioni e poi assegnare il ruolo a un utente o gruppo VMware</span><span class="sxs-lookup"><span data-stu-id="bbb26-410">We suggest you create a role (Azure_Site_Recovery) with the required permissions, and then assign the role to a VMware user or group</span></span> | <span data-ttu-id="bbb26-411">Data Center object (Oggetto data center) –> Propagate to Child Object (Propaga a oggetto figlio), role=Azure_Site_Recovery (ruolo=Azure_Site_Recovery)</span><span class="sxs-lookup"><span data-stu-id="bbb26-411">Data Center object –> Propagate to Child Object, role=Azure_Site_Recovery</span></span><br/><br/> <span data-ttu-id="bbb26-412">Datastore (Archivio dati) -> Allocate space (Alloca spazio), Browse datastore (Sfoglia archivio dati), Low level file operations (Operazioni file di livello basso), Remove file (Rimuovi file), Update virtual machine files (Aggiorna file macchina virtuale)</span><span class="sxs-lookup"><span data-stu-id="bbb26-412">Datastore -> Allocate space, browse datastore, low-level file operations, remove file, update virtual machine files</span></span><br/><br/> <span data-ttu-id="bbb26-413">Network (Rete) -> Network assign (Assegnazione rete)</span><span class="sxs-lookup"><span data-stu-id="bbb26-413">Network -> Network assign</span></span><br/><br/> <span data-ttu-id="bbb26-414">Risorsa -> Assegnare VM al pool di risorse, migrare la VM spenta, migrare la VM accesa</span><span class="sxs-lookup"><span data-stu-id="bbb26-414">Resource -> Assign VM to resource pool, migrate powered off VM, migrate powered on VM</span></span><br/><br/> <span data-ttu-id="bbb26-415">Tasks (Attività) -> Create task (Crea attività), Update task (Aggiorna attività)</span><span class="sxs-lookup"><span data-stu-id="bbb26-415">Tasks -> Create task, update task</span></span><br/><br/> <span data-ttu-id="bbb26-416">Virtual machine (Macchina virtuale) -> Configuration (Configurazione)</span><span class="sxs-lookup"><span data-stu-id="bbb26-416">Virtual machine -> Configuration</span></span><br/><br/> <span data-ttu-id="bbb26-417">Virtual machine (Macchina virtuale) -> Interact (Interagisci) -> Answer question (Rispondi alla domanda), Device connection (Connessione dispositivo), Configure CD media (Configura supporto CD), Configure floppy media (Configura supporto floppy), Power off (Spegni), Power on (Accendi), VMware tools install (Installazione strumenti VMware)</span><span class="sxs-lookup"><span data-stu-id="bbb26-417">Virtual machine -> Interact -> answer question, device connection, configure CD media, configure floppy media, power off, power on, VMware tools install</span></span><br/><br/> <span data-ttu-id="bbb26-418">Virtual machine (Macchina virtuale) -> Inventory (Inventario) -> Create (Crea), Register (Registra), Unregister (Annulla registrazione)</span><span class="sxs-lookup"><span data-stu-id="bbb26-418">Virtual machine -> Inventory -> Create, register, unregister</span></span><br/><br/> <span data-ttu-id="bbb26-419">Virtual machine (Macchina virtuale) -> Provisioning -> Allow virtual machine download (Consenti download macchina virtuale), Allow virtual machine files upload (Consenti upload file macchina virtuale)</span><span class="sxs-lookup"><span data-stu-id="bbb26-419">Virtual machine -> Provisioning -> Allow virtual machine download, allow virtual machine files upload</span></span><br/><br/> <span data-ttu-id="bbb26-420">Macchina virtuale -> Snapshots -> Remove snapshots</span><span class="sxs-lookup"><span data-stu-id="bbb26-420">Virtual machine -> Snapshots -> Remove snapshots</span></span> | <span data-ttu-id="bbb26-421">L'utente viene assegnato a livello di data center e ha accesso a tutti gli oggetti nel data center.</span><span class="sxs-lookup"><span data-stu-id="bbb26-421">User assigned at datacenter level, and has access to all the objects in the datacenter.</span></span><br/><br/> <span data-ttu-id="bbb26-422">Per limitare l'accesso, assegnare il ruolo **No access** (Nessun accesso) con **Propagate to child object** (Propaga a oggetto figlio) agli oggetti figlio (host vSphere, archivi dati, VM e reti).</span><span class="sxs-lookup"><span data-stu-id="bbb26-422">To restrict access, assign the **No access** role with the **Propagate to child** object, to the child objects (vSphere hosts, datastores, VMs and networks).</span></span>


## <a name="next-steps"></a><span data-ttu-id="bbb26-423">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="bbb26-423">Next steps</span></span>

<span data-ttu-id="bbb26-424">Quando la replica è operativa, se si verifica un'interruzione viene eseguito il failover in Azure e vengono create VM di Azure dai dati replicati.</span><span class="sxs-lookup"><span data-stu-id="bbb26-424">After you get replication up and running, when an outage occurs you fail over to Azure, and Azure VMs are created from the replicated data.</span></span> <span data-ttu-id="bbb26-425">È quindi possibile accedere a carichi di lavoro e app in Azure finché non viene effettuato il failback nella posizione primaria di nuovo operativa.</span><span class="sxs-lookup"><span data-stu-id="bbb26-425">You can then access workloads and apps in Azure, until you fail back to your primary location when it returns to normal operations.</span></span>

- <span data-ttu-id="bbb26-426">[Altre informazioni](site-recovery-failover.md) sui diversi tipi di failover e su come eseguirli.</span><span class="sxs-lookup"><span data-stu-id="bbb26-426">[Learn more](site-recovery-failover.md) about different types of failovers, and how to run them.</span></span>
- <span data-ttu-id="bbb26-427">[Altre informazioni](site-recovery-migrate-to-azure.md#migrate-on-premises-vms-and-physical-servers) per eseguire la migrazione di computer invece della replica e del failback.</span><span class="sxs-lookup"><span data-stu-id="bbb26-427">If you're migrating machines rather than replicating and failing back, [read more](site-recovery-migrate-to-azure.md#migrate-on-premises-vms-and-physical-servers).</span></span>
- <span data-ttu-id="bbb26-428">[Informazioni sul failback](site-recovery-failback-azure-to-vmware.md), per il failback e la replica di macchine virtuali di Azure al sito locale primario.</span><span class="sxs-lookup"><span data-stu-id="bbb26-428">[Read about failback](site-recovery-failback-azure-to-vmware.md), to fail back and replicate Azure VMs back to the primary on-premises site.</span></span>

## <a name="third-party-software-notices-and-information"></a><span data-ttu-id="bbb26-429">Informazioni e comunicazioni sul software di terze parti</span><span class="sxs-lookup"><span data-stu-id="bbb26-429">Third-party software notices and information</span></span>
<span data-ttu-id="bbb26-430">Do Not Translate or Localize</span><span class="sxs-lookup"><span data-stu-id="bbb26-430">Do Not Translate or Localize</span></span>

<span data-ttu-id="bbb26-431">The software and firmware running in the Microsoft product or service is based on or incorporates material from the projects listed below (collectively, “Third Party Code”).</span><span class="sxs-lookup"><span data-stu-id="bbb26-431">The software and firmware running in the Microsoft product or service is based on or incorporates material from the projects listed below (collectively, “Third Party Code”).</span></span>  <span data-ttu-id="bbb26-432">Microsoft is the not original author of the Third Party Code.</span><span class="sxs-lookup"><span data-stu-id="bbb26-432">Microsoft is the not original author of the Third Party Code.</span></span>  <span data-ttu-id="bbb26-433">The original copyright notice and license, under which Microsoft received such Third Party Code, are set forth below.</span><span class="sxs-lookup"><span data-stu-id="bbb26-433">The original copyright notice and license, under which Microsoft received such Third Party Code, are set forth below.</span></span>

<span data-ttu-id="bbb26-434">The information in Section A is regarding Third Party Code components from the projects listed below.</span><span class="sxs-lookup"><span data-stu-id="bbb26-434">The information in Section A is regarding Third Party Code components from the projects listed below.</span></span> <span data-ttu-id="bbb26-435">Such licenses and information are provided for informational purposes only.</span><span class="sxs-lookup"><span data-stu-id="bbb26-435">Such licenses and information are provided for informational purposes only.</span></span>  <span data-ttu-id="bbb26-436">This Third Party Code is being relicensed to you by Microsoft under Microsoft's software licensing terms for the Microsoft product or service.</span><span class="sxs-lookup"><span data-stu-id="bbb26-436">This Third Party Code is being relicensed to you by Microsoft under Microsoft's software licensing terms for the Microsoft product or service.</span></span>  

<span data-ttu-id="bbb26-437">The information in Section B is regarding Third Party Code components that are being made available to you by Microsoft under the original licensing terms.</span><span class="sxs-lookup"><span data-stu-id="bbb26-437">The information in Section B is regarding Third Party Code components that are being made available to you by Microsoft under the original licensing terms.</span></span>

<span data-ttu-id="bbb26-438">The complete file may be found on the [Microsoft Download Center](http://go.microsoft.com/fwlink/?LinkId=529428).</span><span class="sxs-lookup"><span data-stu-id="bbb26-438">The complete file may be found on the [Microsoft Download Center](http://go.microsoft.com/fwlink/?LinkId=529428).</span></span> <span data-ttu-id="bbb26-439">Microsoft reserves all rights not expressly granted herein, whether by implication, estoppel or otherwise.</span><span class="sxs-lookup"><span data-stu-id="bbb26-439">Microsoft reserves all rights not expressly granted herein, whether by implication, estoppel or otherwise.</span></span>
