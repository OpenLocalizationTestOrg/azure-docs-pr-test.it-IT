---
title: Installare un dominio di Active Directory di replica in Azure | Documentazione Microsoft
description: Esercitazione che illustra come installare un controller di dominio da una foresta Active Directory locale in una macchina virtuale di Azure.
services: virtual-network
documentationcenter: 
author: curtand
manager: femila
editor: 
ms.assetid: 8c9ebf1b-289a-4dd6-9567-a946450005c0
ms.service: virtual-network
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/24/2017
ms.author: curtand
ms.custom: oldportal;it-pro;
ms.openlocfilehash: f36a78fb8f8712ae8bb0ed6b5b8b081867198687
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/03/2017
---
# <a name="install-a-replica-active-directory-domain-controller-in-an-azure-virtual-network"></a><span data-ttu-id="4a4dd-103">Installazione di un controller di dominio Active Directory di replica in una rete virtuale di Azure</span><span class="sxs-lookup"><span data-stu-id="4a4dd-103">Install a replica Active Directory domain controller in an Azure virtual network</span></span>
<span data-ttu-id="4a4dd-104">Questo argomento descrive come installare altri controller di dominio (anche noti come controller di dominio di replica) per un dominio Active Directory locale in Macchine virtuali di Azure in una rete virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-104">This topic shows how to install additional domain controllers (also known as replica DCs) for an on-premises Active Directory domain on Azure virtual machines (VMs) in an Azure virtual network.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="4a4dd-105">Microsoft consiglia di gestire Azure AD usando l'[interfaccia di amministrazione di Azure AD](https://aad.portal.azure.com) nel portale di Azure invece di usare il portale di Azure classico citato nel presente articolo.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-105">Microsoft recommends that you manage Azure AD using the [Azure AD admin center](https://aad.portal.azure.com) in the Azure portal instead of using the Azure classic portal referenced in this article.</span></span>

<span data-ttu-id="4a4dd-106">Altri argomenti di interesse:</span><span class="sxs-lookup"><span data-stu-id="4a4dd-106">You might also be interested in these related topics:</span></span>

* <span data-ttu-id="4a4dd-107">È possibile, se lo si desidera, installare una nuova foresta Active Directory in una rete virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-107">You can optionally install a new Active Directory forest on an Azure virtual network.</span></span> <span data-ttu-id="4a4dd-108">Per questa procedura, vedere [Installazione di una nuova foresta Active Directory in una rete virtuale di Azure](active-directory-new-forest-virtual-machine.md).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-108">For those steps, see [Install a new Active Directory forest on an Azure virtual network](active-directory-new-forest-virtual-machine.md).</span></span>
* <span data-ttu-id="4a4dd-109">Per le linee guida concettuali sull'installazione di Servizi di dominio Active Directory in una rete virtuale di Azure, vedere [Linee guida per la distribuzione di Active Directory di Windows Server in macchine virtuali di Azure](https://msdn.microsoft.com/library/azure/jj156090.aspx).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-109">For conceptual guidance about installing Active Directory Domain Services (AD DS) on an Azure virtual network, see [Guidelines for Deploying Windows Server Active Directory on Azure Virtual Machines](https://msdn.microsoft.com/library/azure/jj156090.aspx).</span></span>

## <a name="scenario-diagram"></a><span data-ttu-id="4a4dd-110">Diagramma dello scenario</span><span class="sxs-lookup"><span data-stu-id="4a4dd-110">Scenario diagram</span></span>
<span data-ttu-id="4a4dd-111">In questo scenario gli utenti esterni devono accedere alle applicazioni eseguite nei server aggiunti al dominio.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-111">In this scenario, external users need to access applications that run on domain-joined servers.</span></span> <span data-ttu-id="4a4dd-112">Le macchine virtuali che eseguono i server applicazioni e i controller di dominio di replica vengono installati in una rete virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-112">The VMs that run the application servers and the replica DCs are installed in an Azure virtual network.</span></span> <span data-ttu-id="4a4dd-113">La rete virtuale può essere connessa alla rete locale mediante una connessione [VPN da sito a sito](../vpn-gateway/vpn-gateway-site-to-site-create.md), come mostrato nel diagramma seguente, oppure è possibile usare [ExpressRoute](../expressroute/expressroute-locations-providers.md) per una connessione più veloce.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-113">The virtual network can be connected to the on-premises network by a [site-to-site VPN](../vpn-gateway/vpn-gateway-site-to-site-create.md) connection, as shown in the following diagram, or you can use [ExpressRoute](../expressroute/expressroute-locations-providers.md) for a faster connection.</span></span>

<span data-ttu-id="4a4dd-114">I server dell'applicazione e i controller di dominio vengono distribuiti all'interno di servizi cloud separati per distribuire l'elaborazione del calcolo e all'interno dei [set di disponibilità](../virtual-machines/windows/manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) per una migliore tolleranza di errore.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-114">The application servers and the DCs are deployed within separate cloud services to distribute compute processing and within [availability sets](../virtual-machines/windows/manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) for improved fault tolerance.</span></span>
<span data-ttu-id="4a4dd-115">I controller di dominio eseguono la replica reciproca e con controller di dominio locali usando la replica di Active Directory.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-115">The DCs replicate with each other and with on-premises DCs by using Active Directory replication.</span></span> <span data-ttu-id="4a4dd-116">Non sono necessari strumenti di sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-116">No synchronization tools are needed.</span></span>

![Diagramma di un controller di dominio Active Directory di replica in una rete virtuale di Azure][1]

## <a name="create-an-active-directory-site-for-the-azure-virtual-network"></a><span data-ttu-id="4a4dd-118">Creare un sito di Active Directory per la rete virtuale di Azure</span><span class="sxs-lookup"><span data-stu-id="4a4dd-118">Create an Active Directory site for the Azure virtual network</span></span>
<span data-ttu-id="4a4dd-119">È consigliabile creare in Active Directory un sito che rappresenta l'area di rete corrispondente alla rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-119">It’s a good idea to create a site in Active Directory that represents the network region corresponding to the virtual network.</span></span> <span data-ttu-id="4a4dd-120">Ciò contribuisce a ottimizzare l'autenticazione, la replica e altre operazioni del percorso del controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-120">That helps optimize authentication, replication, and other DC location operations.</span></span> <span data-ttu-id="4a4dd-121">La seguente procedura descrive come creare un sito. Per altre informazioni, vedere [ Aggiunta di un nuovo sito](https://technet.microsoft.com/library/cc781496.aspx).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-121">The following steps explain how to create a site, and for more background, see [Adding a New Site](https://technet.microsoft.com/library/cc781496.aspx).</span></span>

1. <span data-ttu-id="4a4dd-122">Aprire Siti e servizi di Active Directory: **Server Manager** > **Strumenti** > **Siti e servizi di Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-122">Open Active Directory Sites and Services: **Server Manager** > **Tools** > **Active Directory Sites and Services**.</span></span>
2. <span data-ttu-id="4a4dd-123">Creare un sito per rappresentare l'area in cui è stata creata una rete virtuale di Azure: fare clic su **Siti** > **Azione** > **Nuovo sito** > digitare il nome del nuovo sito, ad esempio Azure Stati Uniti occidentali > selezionare un collegamento di sito > **OK**.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-123">Create a site to represent the region where you created an Azure virtual network: click **Sites** > **Action** > **New site** > type the name of the new site, such as Azure US West > select a site link > **OK**.</span></span>
3. <span data-ttu-id="4a4dd-124">Creare una subnet e associarla al nuovo sito: fare doppio clic su **Siti** > fare clic con il pulsante destro del mouse su **Subnet** >  **Nuova subnet** > digitare l'intervallo di indirizzi IP della rete virtuale (ad esempio 10.1.0.0/16 nel diagramma dello scenario) > selezionare il nuovo sito di Azure > **OK**.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-124">Create a subnet and associate with the new site: double-click **Sites** > right-click **Subnets** > **New subnet** > type the IP address range of the virtual network (such as 10.1.0.0/16 in the scenario diagram) > select the new Azure site > **OK**.</span></span>

## <a name="create-an-azure-virtual-network"></a><span data-ttu-id="4a4dd-125">Creare una rete virtuale di Azure</span><span class="sxs-lookup"><span data-stu-id="4a4dd-125">Create an Azure virtual network</span></span>
1. <span data-ttu-id="4a4dd-126">Nel [portale di Azure classico](https://manage.windowsazure.com) fare clic su **Nuovo** > **Servizi di rete** > **Rete virtuale** > **Creazione personalizzata** e usare i valori seguenti per completare la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-126">In the [Azure classic portal](https://manage.windowsazure.com), click **New** > **Network Services** > **Virtual Network** > **Custom Create** and use the following values to complete the wizard.</span></span>

   | <span data-ttu-id="4a4dd-127">Pagina della procedura guidata</span><span class="sxs-lookup"><span data-stu-id="4a4dd-127">On this wizard page…</span></span> | <span data-ttu-id="4a4dd-128">Valori da specificare</span><span class="sxs-lookup"><span data-stu-id="4a4dd-128">Specify these values</span></span> |
   | --- | --- |
   |  <span data-ttu-id="4a4dd-129">**Dettagli della rete virtuale**</span><span class="sxs-lookup"><span data-stu-id="4a4dd-129">**Virtual Network Details**</span></span> |<p><span data-ttu-id="4a4dd-130">Nome: digitare un nome per la rete virtuale, ad esempio WestUSVNet.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-130">Name: Type a name for the virtual network, such as WestUSVNet.</span></span></p><p><span data-ttu-id="4a4dd-131">Area: scegliere l'area più vicina.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-131">Region: Choose the closest region.</span></span></p> |
   |  <span data-ttu-id="4a4dd-132">**Server DNS e connettività VPN**</span><span class="sxs-lookup"><span data-stu-id="4a4dd-132">**DNS and VPN connectivity**</span></span> |<p><span data-ttu-id="4a4dd-133">Server DNS: specificare il nome e l'indirizzo IP di uno o più server DNS locali.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-133">DNS Servers: Specify the name and IP address of one or more on-premises DNS servers.</span></span></p><p><span data-ttu-id="4a4dd-134">Connettività: selezionare **Configura una VPN Site-to-Site**.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-134">Connectivity: Select **Configure a site-to-site VPN**.</span></span></p><p><span data-ttu-id="4a4dd-135">Rete locale: specificare una nuova rete locale.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-135">Local network: Specify a new local network.</span></span></p><p><span data-ttu-id="4a4dd-136">Se si usa ExpressRoute invece di una VPN, vedere [Configurare una connessione ExpressRoute tramite un provider di Exchange](../expressroute/expressroute-locations-providers.md).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-136">If you are using ExpressRoute instead of a VPN, see [Configure an ExpressRoute Connection through an Exchange Provider](../expressroute/expressroute-locations-providers.md).</span></span></p> |
   |  <span data-ttu-id="4a4dd-137">**Connettività da sito a sito**</span><span class="sxs-lookup"><span data-stu-id="4a4dd-137">**Site-to-site connectivity**</span></span> |<p><span data-ttu-id="4a4dd-138">Nome: digitare un nome per la rete locale.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-138">Name: Type a name for the on-premises network.</span></span></p><p><span data-ttu-id="4a4dd-139">Indirizzo IP dispositivo VPN: specificare l'indirizzo IP pubblico del dispositivo che si connetterà alla rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-139">VPN Device IP address: Specify the public IP address of the device that will connect to the virtual network.</span></span> <span data-ttu-id="4a4dd-140">Il dispositivo VPN non può trovarsi dietro un NAT.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-140">The VPN device cannot be located behind a NAT.</span></span></p><p><span data-ttu-id="4a4dd-141">Indirizzo: specificare gli intervalli di indirizzi della rete locale (ad esempio 192.168.0.0/16 nel diagramma dello scenario).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-141">Address: Specify the address ranges for your on-premises network (such as 192.168.0.0/16 in the scenario diagram).</span></span></p> |
   |  <span data-ttu-id="4a4dd-142">**Spazi degli indirizzi della rete virtuale**</span><span class="sxs-lookup"><span data-stu-id="4a4dd-142">**Virtual network address spaces**</span></span> |<p><span data-ttu-id="4a4dd-143">Spazio degli indirizzi: Specificare l'intervallo di indirizzi IP per le macchine virtuali che si desidera eseguire nella rete virtuale di Azure (ad esempio 10.1.0.0/16 nel diagramma dello scenario).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-143">Address Space: Specify the IP address range for VMs that you want to run in the Azure virtual network (such as 10.1.0.0/16 in the scenario diagram).</span></span> <span data-ttu-id="4a4dd-144">Questo intervallo di indirizzi non può sovrapporsi agli intervalli di indirizzi della rete locale.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-144">This address range cannot overlap with the address ranges of the on-premises network.</span></span></p><p><span data-ttu-id="4a4dd-145">Subnet: specificare un nome e un indirizzo per una subnet per i server applicazioni (ad esempio front-end, 10.1.1.0/24) e per i controller di dominio (ad esempio back-end, 10.1.2.0/24).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-145">Subnets: Specify a name and address for a subnet for the application servers (such as Frontend, 10.1.1.0/24) and for the DCs (such as Backend, 10.1.2.0/24).</span></span></p><p><span data-ttu-id="4a4dd-146">Fare clic su **Aggiungi subnet gateway**.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-146">Click **add gateway subnet**.</span></span></p> |
2. <span data-ttu-id="4a4dd-147">Quindi, si configurerà il gateway di rete virtuale per creare una connessione VPN da sito a sito sicura.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-147">Next, you'll configure the virtual network gateway to create a secure site-to-site VPN connection.</span></span> <span data-ttu-id="4a4dd-148">Vedere [Configurare un gateway per la rete virtuale](../vpn-gateway/vpn-gateway-configure-vpn-gateway-mp.md) per informazioni.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-148">See [Configure a Virtual Network Gateway](../vpn-gateway/vpn-gateway-configure-vpn-gateway-mp.md) for the instructions.</span></span>
3. <span data-ttu-id="4a4dd-149">Creare la connessione VPN da sito a sito tra la nuova rete virtuale e un dispositivo VPN locale.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-149">Create the site-to-site VPN connection between the new virtual network and an on-premises VPN device.</span></span> <span data-ttu-id="4a4dd-150">Vedere [Configurare un gateway per la rete virtuale](../vpn-gateway/vpn-gateway-configure-vpn-gateway-mp.md) per informazioni.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-150">See [Configure a Virtual Network Gateway](../vpn-gateway/vpn-gateway-configure-vpn-gateway-mp.md) for the instructions.</span></span>

## <a name="create-azure-vms-for-the-dc-roles"></a><span data-ttu-id="4a4dd-151">Creare macchine virtuali di Azure per i ruoli del controller di dominio</span><span class="sxs-lookup"><span data-stu-id="4a4dd-151">Create Azure VMs for the DC roles</span></span>
<span data-ttu-id="4a4dd-152">Ripetere i passaggi seguenti per creare macchine virtuali per ospitare il ruolo di controller di dominio in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-152">Repeat the following steps to create VMs to host the DC role as needed.</span></span> <span data-ttu-id="4a4dd-153">È consigliabile distribuire almeno due controller di dominio virtuali per fornire ridondanza e tolleranza di errore.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-153">You should deploy at least two virtual DCs to provide fault tolerance and redundancy.</span></span> <span data-ttu-id="4a4dd-154">Se la rete virtuale di Azure include almeno due controller di dominio configurati in modo analogo (vale a dire se sono entrambi cataloghi globali, eseguono server DNS, non contengono alcun ruolo FSMO e così via), posizionare le macchine virtuali che eseguono tali controller di dominio in un gruppo di disponibilità per una tolleranza di errore migliorata.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-154">If the Azure virtual network includes at least two DCs that are similarly configured (that is, they are both GCs, run DNS server, and neither holds any FSMO role, and so on) then place the VMs that run those DCs in an availability set for improved fault tolerance.</span></span>
<span data-ttu-id="4a4dd-155">Per creare le macchine virtuali tramite Windows PowerShell anziché tramite l'interfaccia utente, vedere [Uso di Azure PowerShell per creare e preconfigurare macchine virtuali basate su Windows](../virtual-machines/windows/classic/create-powershell.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-155">To create the VMs by using Windows PowerShell instead of the UI, see [Use Azure PowerShell to create and preconfigure Windows-based Virtual Machines](../virtual-machines/windows/classic/create-powershell.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span></span>

1. <span data-ttu-id="4a4dd-156">Nel [portale di Azure classico](https://manage.windowsazure.com) fare clic su **Nuovo** > **Calcolo** > **Macchina virtuale** > **Da raccolta**.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-156">In the [Azure classic portal](https://manage.windowsazure.com), click **New** > **Compute** > **Virtual Machine** > **From Gallery**.</span></span> <span data-ttu-id="4a4dd-157">Usare i valori nella seguente tabella per completare la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-157">Use the following values to complete the wizard.</span></span> <span data-ttu-id="4a4dd-158">Accettare il valore predefinito per tutte le impostazioni a meno che non venga suggerito o richiesto un altro valore.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-158">Accept the default value for a setting unless another value is suggested or required.</span></span>

   | <span data-ttu-id="4a4dd-159">Pagina della procedura guidata</span><span class="sxs-lookup"><span data-stu-id="4a4dd-159">On this wizard page…</span></span> | <span data-ttu-id="4a4dd-160">Valori da specificare</span><span class="sxs-lookup"><span data-stu-id="4a4dd-160">Specify these values</span></span> |
   | --- | --- |
   |  <span data-ttu-id="4a4dd-161">**Scegli un'immagine**</span><span class="sxs-lookup"><span data-stu-id="4a4dd-161">**Choose an Image**</span></span> |<span data-ttu-id="4a4dd-162">Windows Server 2012 R2 Datacenter</span><span class="sxs-lookup"><span data-stu-id="4a4dd-162">Windows Server 2012 R2 Datacenter</span></span> |
   |  <span data-ttu-id="4a4dd-163">**Configurazione macchina virtuale**</span><span class="sxs-lookup"><span data-stu-id="4a4dd-163">**Virtual Machine Configuration**</span></span> |<p><span data-ttu-id="4a4dd-164">Nome macchina virtuale: digitare un nome con etichetta singola (ad esempio AzureDC1).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-164">Virtual Machine Name: Type a single label name (such as AzureDC1).</span></span></p><p><span data-ttu-id="4a4dd-165">Nuovo nome utente: digitare il nome di un utente.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-165">New User Name: Type the name of a user.</span></span> <span data-ttu-id="4a4dd-166">Questo utente sarà membro del gruppo Administrators locale nella macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-166">This user will be a member of the local Administrators group on the VM.</span></span> <span data-ttu-id="4a4dd-167">Questo nome sarà necessario per accedere alla macchina virtuale per la prima volta.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-167">You will need this name to sign in to the VM for the first time.</span></span> <span data-ttu-id="4a4dd-168">L'account predefinito denominato Administrator non funzionerà.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-168">The built-in account named Administrator will not work.</span></span></p><p><span data-ttu-id="4a4dd-169">Nuova password/conferma: digitare una password</span><span class="sxs-lookup"><span data-stu-id="4a4dd-169">New Password/Confirm: Type a password</span></span></p> |
   |  <span data-ttu-id="4a4dd-170">**Configurazione macchina virtuale**</span><span class="sxs-lookup"><span data-stu-id="4a4dd-170">**Virtual Machine Configuration**</span></span> |<p><span data-ttu-id="4a4dd-171">Servizio cloud: scegliere <b>Crea un nuovo servizio cloud</b> per la prima macchina virtuale e selezionare lo stesso nome di servizio cloud quando si creano più VM che ospiteranno il ruolo di controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-171">Cloud Service: Choose <b>Create a new cloud service</b> for the first VM and select that same cloud service name when you create more VMs that will host the DC role.</span></span></p><p><span data-ttu-id="4a4dd-172">Nome DNS del servizio cloud: specificare un nome globalmente univoco</span><span class="sxs-lookup"><span data-stu-id="4a4dd-172">Cloud Service DNS Name: Specify a globally unique name</span></span></p><p><span data-ttu-id="4a4dd-173">Regione/Gruppo di affinità/Rete virtuale: specificare un nome di rete virtuale (come WestUSVNet).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-173">Region/Affinity Group/Virtual Network: Specify the virtual network name (such as WestUSVNet).</span></span></p><p><span data-ttu-id="4a4dd-174">Account di archiviazione: scegliere <b>Usa un account di archiviazione generato automaticamente</b> per la prima macchina virtuale e quindi selezionare lo stesso nome di account di archiviazione quando si creano più VM che ospiteranno il ruolo di controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-174">Storage Account: Choose <b>Use an automatically generated storage account</b> for the first VM and then select that same storage account name when you create more VMs that will host the DC role.</span></span></p><p><span data-ttu-id="4a4dd-175">Set di disponibilità: scegliere <b>Crea set di disponibilità</b>.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-175">Availability Set: Choose <b>Create an availability set</b>.</span></span></p><p><span data-ttu-id="4a4dd-176">Nome set di disponibilità: digitare un nome per il set di disponibilità impostato quando si crea la prima VM e quindi selezionare lo stesso nome quando si creano più VM.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-176">Availability set name: Type a name for the availability set when you create the first VM and then select that same name when you create more VMs.</span></span></p> |
   |  <span data-ttu-id="4a4dd-177">**Configurazione macchina virtuale**</span><span class="sxs-lookup"><span data-stu-id="4a4dd-177">**Virtual Machine Configuration**</span></span> |<p><span data-ttu-id="4a4dd-178">Selezionare <b>Installa l'agente di macchine virtuali</b> ed eventuali altre estensioni necessarie.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-178">Select <b>Install the VM Agent</b> and any other extensions you need.</span></span></p> |
2. <span data-ttu-id="4a4dd-179">Collegare un disco a ogni macchina virtuale che eseguirà il ruolo del server di controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-179">Attach a disk to each VM that will run the DC server role.</span></span> <span data-ttu-id="4a4dd-180">Il disco aggiuntivo necessario per archiviare il database di Active Directory, log e SYSVOL.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-180">The additional disk is needed to store the AD database, logs, and SYSVOL.</span></span> <span data-ttu-id="4a4dd-181">Specificare le dimensioni per il disco (ad esempio 10 GB) e lasciare l'opzione **Preferenze cache dell'host** impostata su **Nessuna**.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-181">Specify a size for the disk (such as 10 GB) and leave the **Host Cache Preference** set to **None**.</span></span> <span data-ttu-id="4a4dd-182">Per la procedura, vedere [Come collegare un disco dati a una macchina virtuale Windows](../virtual-machines/windows/classic/attach-disk.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-182">For the steps, see [How to Attach a Data Disk to a Windows Virtual Machine](../virtual-machines/windows/classic/attach-disk.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span></span>
3. <span data-ttu-id="4a4dd-183">Dopo avere effettuato la prima connessione alla VM, aprire **Server Manager** > **Servizi file e archiviazione** per creare un volume in questo disco usando NTFS.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-183">After you first sign in to the VM, open **Server Manager** > **File and Storage Services** to create a volume on this disk using NTFS.</span></span>
4. <span data-ttu-id="4a4dd-184">Riservare un indirizzo IP statico per le macchine virtuali che eseguiranno il ruolo di controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-184">Reserve a static IP address for VMs that will run the DC role.</span></span> <span data-ttu-id="4a4dd-185">Per riservare un indirizzo IP statico, scaricare l'Installazione guidata piattaforma Web Microsoft e [installare Azure PowerShell](/powershell/azure/overview) , quindi eseguire il cmdlet Set-AzureStaticVNetIP.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-185">To reserve a static IP address, download the Microsoft Web Platform Installer and [install Azure PowerShell](/powershell/azure/overview) and run the Set-AzureStaticVNetIP cmdlet.</span></span> <span data-ttu-id="4a4dd-186">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="4a4dd-186">For example:</span></span>

    <span data-ttu-id="4a4dd-187">'Get-AzureVM -ServiceName AzureDC1 -Name AzureDC1 | Set-AzureStaticVNetIP -IPAddress 10.0.0.4 | Update-AzureVM</span><span class="sxs-lookup"><span data-stu-id="4a4dd-187">'Get-AzureVM -ServiceName AzureDC1 -Name AzureDC1 | Set-AzureStaticVNetIP -IPAddress 10.0.0.4 | Update-AzureVM</span></span>

<span data-ttu-id="4a4dd-188">Per altre informazioni sull'impostazione di un indirizzo IP statico, vedere [Configurare un indirizzo IP interno statico per una macchina virtuale](../virtual-network/virtual-networks-reserved-private-ip.md).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-188">For more information about setting a static IP address, see [Configure a Static Internal IP Address for a VM](../virtual-network/virtual-networks-reserved-private-ip.md).</span></span>

## <a name="install-ad-ds-on-azure-vms"></a><span data-ttu-id="4a4dd-189">Installare Servizi di dominio Active Directory in macchine virtuali di Azure</span><span class="sxs-lookup"><span data-stu-id="4a4dd-189">Install AD DS on Azure VMs</span></span>
<span data-ttu-id="4a4dd-190">Accedere a una macchina virtuale e verificare che sia disponibile la connettività nella VPN da sito a sito o la connessione ExpressRoute alle risorse sulla rete locale,</span><span class="sxs-lookup"><span data-stu-id="4a4dd-190">Sign in to a VM and verify that you have connectivity across the site-to-site VPN or ExpressRoute connection to resources on your on-premises network.</span></span> <span data-ttu-id="4a4dd-191">quindi installare Servizi di dominio Active Directory nelle macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-191">Then install AD DS on the Azure VMs.</span></span> <span data-ttu-id="4a4dd-192">È possibile usare la stessa procedura che consente di installare un controller di dominio aggiuntivo nella rete locale (interfaccia utente, Windows PowerShell o un file di risposta).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-192">You can use same process that you use to install an additional DC on your on-premises network (UI, Windows PowerShell, or an answer file).</span></span> <span data-ttu-id="4a4dd-193">Durante l'installazione di Servizi di dominio Active Directory, assicurarsi di specificare il nuovo volume per il percorso del database Active Directory, i log e SYSVOL.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-193">As you install AD DS, make sure you specify the new volume for the location of the AD database, logs and SYSVOL.</span></span> <span data-ttu-id="4a4dd-194">Se è necessario un aggiornamento nell'installazione di Active Directory Domain Services, vedere [Installazione di Active Directory Domain Services (Livello 100)](https://technet.microsoft.com/library/hh472162.aspx) o [Installare un Controller di dominio Windows Server 2012 Replica in un dominio esistente (livello 200)](https://technet.microsoft.com/library/jj574134.aspx).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-194">If you need a refresher on AD DS installation, see  [Install Active Directory Domain Services (Level 100)](https://technet.microsoft.com/library/hh472162.aspx) or [Install a Replica Windows Server 2012 Domain Controller in an Existing Domain (Level 200)](https://technet.microsoft.com/library/jj574134.aspx).</span></span>

## <a name="reconfigure-dns-server-for-the-virtual-network"></a><span data-ttu-id="4a4dd-195">Riconfigurare il server DNS per la rete virtuale</span><span class="sxs-lookup"><span data-stu-id="4a4dd-195">Reconfigure DNS server for the virtual network</span></span>
1. <span data-ttu-id="4a4dd-196">Nel [portale di Azure](https://portal.azure.com), all’interno della casella **Ricerca risorse** immettere *Reti virtuali*, quindi fare clic su **Reti virtuali (classico)** tra i risultati della ricerca.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-196">In the [Azure portal](https://portal.azure.com), in the **Search resources** box, enter *Virtual networks*, then click **Virtual networks (classic)** in the search results.</span></span> <span data-ttu-id="4a4dd-197">Fare clic sul nome della rete virtuale e quindi [riconfigurare gli indirizzi IP del server DNS per la rete virtuale](../virtual-network/virtual-network-manage-network.md#dns-servers) allo scopo di usare gli indirizzi IP statici assegnati ai controller di dominio di replica invece degli indirizzi IP di server DNS locali.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-197">Click the name of the virtual network, and then [reconfigure the DNS server IP addresses for your virtual network](../virtual-network/virtual-network-manage-network.md#dns-servers) to use the static IP addresses assigned to the replica DCs instead of the IP addresses of an on-premises DNS servers.</span></span>
2. <span data-ttu-id="4a4dd-198">Per garantire che tutte le macchine virtuali dei controller di dominio di replica sulla rete virtuale siano configurate per usare i server DNS sulla rete virtuale, fare clic su **Macchine virtuali**, fare clic sulla colonna di stato per ogni macchina virtuale e quindi fare clic su **Riavvia**.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-198">To ensure that all the replica DC VMs on the virtual network are configured with to use DNS servers on the virtual network, click **Virtual Machines**, click the status column for each VM, and then click **Restart**.</span></span> <span data-ttu-id="4a4dd-199">Attendere fino a quando la macchina virtuale mostra lo stato **In esecuzione** prima di provare a effettuare l'accesso.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-199">Wait until the VM shows **Running** state before you try to sign into it.</span></span>

## <a name="create-vms-for-application-servers"></a><span data-ttu-id="4a4dd-200">Creare macchine virtuali per server applicazioni</span><span class="sxs-lookup"><span data-stu-id="4a4dd-200">Create VMs for application servers</span></span>
1. <span data-ttu-id="4a4dd-201">Ripetere i seguenti passaggi per creare macchine virtuali che vengano eseguite come server applicazioni.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-201">Repeat the following steps to create VMs to run as application servers.</span></span> <span data-ttu-id="4a4dd-202">Accettare il valore predefinito per tutte le impostazioni a meno che non venga suggerito o richiesto un altro valore.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-202">Accept the default value for a setting unless another value is suggested or required.</span></span>

   | <span data-ttu-id="4a4dd-203">Pagina della procedura guidata</span><span class="sxs-lookup"><span data-stu-id="4a4dd-203">On this wizard page…</span></span> | <span data-ttu-id="4a4dd-204">Valori da specificare</span><span class="sxs-lookup"><span data-stu-id="4a4dd-204">Specify these values</span></span> |
   | --- | --- |
   |  <span data-ttu-id="4a4dd-205">**Scegli un'immagine**</span><span class="sxs-lookup"><span data-stu-id="4a4dd-205">**Choose an Image**</span></span> |<span data-ttu-id="4a4dd-206">Windows Server 2012 R2 Datacenter</span><span class="sxs-lookup"><span data-stu-id="4a4dd-206">Windows Server 2012 R2 Datacenter</span></span> |
   |  <span data-ttu-id="4a4dd-207">**Configurazione macchina virtuale**</span><span class="sxs-lookup"><span data-stu-id="4a4dd-207">**Virtual Machine Configuration**</span></span> |<p><span data-ttu-id="4a4dd-208">Nome macchina virtuale: digitare un nome con etichetta singola (ad esempio AppServer1).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-208">Virtual Machine Name: Type a single label name (such as  AppServer1).</span></span></p><p><span data-ttu-id="4a4dd-209">Nuovo nome utente: digitare il nome di un utente.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-209">New User Name: Type the name of a user.</span></span> <span data-ttu-id="4a4dd-210">Questo utente sarà membro del gruppo Administrators locale nella macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-210">This user will be a member of the local Administrators group on the VM.</span></span> <span data-ttu-id="4a4dd-211">Questo nome sarà necessario per accedere alla macchina virtuale per la prima volta.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-211">You will need this name to sign in to the VM for the first time.</span></span> <span data-ttu-id="4a4dd-212">L'account predefinito denominato Administrator non funzionerà.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-212">The built-in account named Administrator will not work.</span></span></p><p><span data-ttu-id="4a4dd-213">Nuova password/conferma: digitare una password</span><span class="sxs-lookup"><span data-stu-id="4a4dd-213">New Password/Confirm: Type a password</span></span></p> |
   |  <span data-ttu-id="4a4dd-214">**Configurazione macchina virtuale**</span><span class="sxs-lookup"><span data-stu-id="4a4dd-214">**Virtual Machine Configuration**</span></span> |<p><span data-ttu-id="4a4dd-215">Servizio cloud: scegliere **Crea un nuovo servizio cloud** per la prima macchina virtuale e selezionare lo stesso nome di servizio cloud quando si creano più VM che ospiteranno l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-215">Cloud Service: Choose **Create a new cloud service** for the first VM and select that same cloud service name when you create more VMs that will host the application.</span></span></p><p><span data-ttu-id="4a4dd-216">Nome DNS del servizio cloud: specificare un nome globalmente univoco</span><span class="sxs-lookup"><span data-stu-id="4a4dd-216">Cloud Service DNS Name: Specify a globally unique name</span></span></p><p><span data-ttu-id="4a4dd-217">Regione/Gruppo di affinità/Rete virtuale: specificare un nome di rete virtuale (come WestUSVNet).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-217">Region/Affinity Group/Virtual Network: Specify the virtual network name (such as WestUSVNet).</span></span></p><p><span data-ttu-id="4a4dd-218">Account di archiviazione: scegliere **Usa un account di archiviazione generato automaticamente** per la prima macchina virtuale e quindi selezionare lo stesso nome account di archiviazione quando si creano più VM che ospiteranno l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-218">Storage Account: Choose **Use an automatically generated storage account** for the first VM and then select that same storage account name when you create more VMs that will host the application.</span></span></p><p><span data-ttu-id="4a4dd-219">Set di disponibilità: scegliere **Crea set di disponibilità**.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-219">Availability Set: Choose **Create an availability set**.</span></span></p><p><span data-ttu-id="4a4dd-220">Nome set di disponibilità: digitare un nome per il set di disponibilità impostato quando si crea la prima VM e quindi selezionare lo stesso nome quando si creano più VM.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-220">Availability set name: Type a name for the availability set when you create the first VM and then select that same name when you create more VMs.</span></span></p> |
   |  <span data-ttu-id="4a4dd-221">**Configurazione macchina virtuale**</span><span class="sxs-lookup"><span data-stu-id="4a4dd-221">**Virtual Machine Configuration**</span></span> |<p><span data-ttu-id="4a4dd-222">Selezionare <b>Installa l'agente di macchine virtuali</b> ed eventuali altre estensioni necessarie.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-222">Select <b>Install the VM Agent</b> and any other extensions you need.</span></span></p> |
2. <span data-ttu-id="4a4dd-223">Dopo avere eseguito il provisioning di ogni macchina virtuale, accedere e aggiungerla al dominio.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-223">After each VM is provisioned, sign in and join it to the domain.</span></span> <span data-ttu-id="4a4dd-224">In **Server Manager** fare clic su **Server locale** > **GRUPPO DI LAVORO** > **Modifica...**</span><span class="sxs-lookup"><span data-stu-id="4a4dd-224">In **Server Manager**, click **Local Server** > **WORKGROUP** > **Change…**</span></span> <span data-ttu-id="4a4dd-225">e quindi selezionare **Dominio** e digitare il nome del dominio locale.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-225">and then select **Domain** and type the name of your on-premises domain.</span></span> <span data-ttu-id="4a4dd-226">Specificare le credenziali di un utente di dominio e quindi riavviare la macchina virtuale per completare l'aggiunta al dominio.</span><span class="sxs-lookup"><span data-stu-id="4a4dd-226">Provide credentials of a domain user, and then restart the VM to complete the domain join.</span></span>

<span data-ttu-id="4a4dd-227">Per creare le macchine virtuali tramite Windows PowerShell anziché tramite l'interfaccia utente, vedere [Uso di Azure PowerShell per creare e preconfigurare macchine virtuali basate su Windows](../virtual-machines/windows/classic/create-powershell.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-227">To create the VMs by using Windows PowerShell instead of the UI, see [Use Azure PowerShell to create and preconfigure Windows-based Virtual Machines](../virtual-machines/windows/classic/create-powershell.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span></span>

<span data-ttu-id="4a4dd-228">Per altre informazioni su come usare Windows PowerShell, vedere [Iniziare a utilizzare i cmdlet di Azure](/powershell/azure/overview) e [Informazioni di riferimento sui cmdlet di Azure](/powershell/azure/get-started-azureps).</span><span class="sxs-lookup"><span data-stu-id="4a4dd-228">For more information about using Windows PowerShell, see [Get Started with Azure Cmdlets](/powershell/azure/overview) and [Azure Cmdlet Reference](/powershell/azure/get-started-azureps).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="4a4dd-229">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="4a4dd-229">Additional resources</span></span>
* [<span data-ttu-id="4a4dd-230">Linee guida per la distribuzione di Active Directory di Windows Server in macchine virtuali di Azure</span><span class="sxs-lookup"><span data-stu-id="4a4dd-230">Guidelines for Deploying Windows Server Active Directory on Azure Virtual Machines</span></span>](https://msdn.microsoft.com/library/azure/jj156090.aspx)
* [<span data-ttu-id="4a4dd-231">Come caricare i controller di dominio Hyper-V locali in Azure tramite Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="4a4dd-231">How to upload existing on-premises Hyper-V domain controllers to Azure by using Azure PowerShell</span></span>](http://support.microsoft.com/kb/2904015)
* [<span data-ttu-id="4a4dd-232">Installare una nuova foresta Active Directory in una rete virtuale di Azure</span><span class="sxs-lookup"><span data-stu-id="4a4dd-232">Install a new Active Directory forest on an Azure virtual network</span></span>](active-directory-new-forest-virtual-machine.md)
* [<span data-ttu-id="4a4dd-233">Rete virtuale di Azure</span><span class="sxs-lookup"><span data-stu-id="4a4dd-233">Azure Virtual Network</span></span>](../virtual-network/virtual-networks-overview.md)
* [<span data-ttu-id="4a4dd-234">Microsoft Azure IaaS per professionisti IT: (01) Dati fondamentali delle macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="4a4dd-234">Microsoft Azure IT Pro IaaS: (01) Virtual Machine Fundamentals</span></span>](http://channel9.msdn.com/Series/Windows-Azure-IT-Pro-IaaS/01)
* [<span data-ttu-id="4a4dd-235">Microsoft Azure IaaS per professionisti IT: (05) Creazione di reti virtuali e connettività cross-premise</span><span class="sxs-lookup"><span data-stu-id="4a4dd-235">Microsoft Azure IT Pro IaaS: (05) Creating Virtual Networks and Cross-Premises Connectivity</span></span>](http://channel9.msdn.com/Series/Windows-Azure-IT-Pro-IaaS/05)
* [<span data-ttu-id="4a4dd-236">Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="4a4dd-236">Azure PowerShell</span></span>](/powershell/azure/overview)
* [<span data-ttu-id="4a4dd-237">Cmdlet di gestione di Azure</span><span class="sxs-lookup"><span data-stu-id="4a4dd-237">Azure Management Cmdlets</span></span>](/powershell/module/azurerm.compute/#virtual_machines)

<!--Image references-->
[1]: ./media/active-directory-install-replica-active-directory-domain-controller/ReplicaDCsOnAzureVNet.png
