# <a name="get-started-using-azure-stream-analytics-real-time-fraud-detection"></a><span data-ttu-id="a1fa8-101">Introduzione all’uso di Analisi di flusso di Azure: rilevamento di illeciti in tempo reale</span><span class="sxs-lookup"><span data-stu-id="a1fa8-101">Get started using Azure Stream Analytics: Real-time fraud detection</span></span>

<span data-ttu-id="a1fa8-102">Questa esercitazione offre una spiegazione completa sull'uso di Analisi di flusso di Azure.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-102">This tutorial provides an end-to-end illustration of how to use Azure Stream Analytics.</span></span> <span data-ttu-id="a1fa8-103">Si apprenderà come:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-103">You learn how to:</span></span> 

* <span data-ttu-id="a1fa8-104">Introdurre eventi di streaming in un'istanza degli hub eventi di Azure.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-104">Bring streaming events into an instance of Azure Event Hubs.</span></span> <span data-ttu-id="a1fa8-105">In questa esercitazione si userà un'app che simula un flusso di record di metadati di un telefono cellulare.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-105">In this tutorial, you'll use an app that we provide that simulates a stream of mobile-phone metadata records.</span></span>

* <span data-ttu-id="a1fa8-106">Scrivere query di Analisi di flusso simili a SQL per trasformare i dati, aggregando informazioni o cercando modelli.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-106">Write SQL-like Stream Analytics queries to transform data, aggregating information or looking for patterns.</span></span> <span data-ttu-id="a1fa8-107">Viene illustrato come usare una query per esaminare il flusso in ingresso e individuare chiamate potenzialmente fraudolente.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-107">You will see how to use a query to examine the incoming stream and look for calls that might be fraudulent.</span></span>

* <span data-ttu-id="a1fa8-108">Inviare i risultati a un sink di output (archiviazione) che è possibile analizzare per dettagli aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-108">Send the results to an output sink (storage) that you can analyze for additional insights.</span></span> <span data-ttu-id="a1fa8-109">In questo caso i dati della chiamata sospetta verranno inviati ad Archiviazione BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-109">In this case, you'll send the suspicious call data to Azure Blob storage.</span></span>

<span data-ttu-id="a1fa8-110">In questa esercitazione si userà l'esempio di rilevamento delle frodi in tempo reale in base ai dati della chiamata telefonica.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-110">In  this tutorial, we use the example of real-time fraud detection based on phone-call data.</span></span> <span data-ttu-id="a1fa8-111">La tecnica che verrà illustrata è tuttavia applicabile anche ad altri tipi di rilevamenti di frodi, ad esempio quelle relative alle carte di credito o al furto di identità.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-111">But the technique we illustrate is also suited for other types of fraud detection, such as credit card fraud or identity theft.</span></span> 

## <a name="scenario-telecommunications-and-sim-fraud-detection-in-real-time"></a><span data-ttu-id="a1fa8-112">Scenario: telecomunicazioni e rilevamento di illecito relativo alle SIM in tempo reale</span><span class="sxs-lookup"><span data-stu-id="a1fa8-112">Scenario: Telecommunications and SIM fraud detection in real time</span></span>

<span data-ttu-id="a1fa8-113">Un'azienda di telecomunicazioni dispone di un volume di dati elevato relativamente alle chiamate in ingresso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-113">A telecommunications company has a large volume of data for incoming calls.</span></span> <span data-ttu-id="a1fa8-114">L'azienda intende rilevare chiamate fraudolente in tempo reale, in modo da poter inviare una notifica ai clienti o arrestare il servizio per un numero specifico.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-114">The company wants to detect fraudulent calls in real time so that they can notify customers or shut down service for a specific number.</span></span> <span data-ttu-id="a1fa8-115">Un tipo di frode SIM riguarda più chiamate dalla stessa identità, più o meno alla stessa ora, ma in luoghi geograficamente diversi.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-115">One type of SIM fraud involves multiple calls from the same identity around the same time but in geographically different locations.</span></span> <span data-ttu-id="a1fa8-116">Per rilevare questo tipo di frode, l'azienda deve esaminare i record delle chiamate in ingresso e cercare specifici modelli, in questo caso, chiamate più o meno alla stessa ora in paesi diversi.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-116">To detect this type of fraud, the company needs to examine incoming phone records and look for specific patterns—in this case, for calls made around the same time in different countries.</span></span> <span data-ttu-id="a1fa8-117">Qualsiasi record telefonico che rientri in questa categoria viene scritto nell'archiviazione per analisi successive.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-117">Any phone records that fall into this category are written to storage for subsequent analysis.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="a1fa8-118">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="a1fa8-118">Prerequisites</span></span>

<span data-ttu-id="a1fa8-119">In questa esercitazione si simuleranno i dati di una chiamata telefonica usando un'app client che genera metadati di esempio di chiamate.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-119">In this tutorial, you'll simulate phone-call data by using a client app that generates sample phone call metadata.</span></span> <span data-ttu-id="a1fa8-120">Alcuni record prodotti dall'app hanno l'aspetto di chiamate fraudolente.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-120">Some of the records that the app produces look like fraudulent calls.</span></span> 

<span data-ttu-id="a1fa8-121">Prima di iniziare, verificare di disporre degli elementi seguenti:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-121">Before you start, make sure you have the following:</span></span>

* <span data-ttu-id="a1fa8-122">Un account Azure.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-122">An Azure account.</span></span>
* <span data-ttu-id="a1fa8-123">L'app generatore degli eventi di chiamata.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-123">The call-event generator app.</span></span> <span data-ttu-id="a1fa8-124">A tale scopo, scaricare il [file TelcoGenerator.zip](http://download.microsoft.com/download/8/B/D/8BD50991-8D54-4F59-AB83-3354B69C8A7E/TelcoGenerator.zip) dall'Area download Microsoft.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-124">You can get this by downloading the [TelcoGenerator.zip file](http://download.microsoft.com/download/8/B/D/8BD50991-8D54-4F59-AB83-3354B69C8A7E/TelcoGenerator.zip) from the Microsoft Download Center.</span></span> <span data-ttu-id="a1fa8-125">Decomprimere il pacchetto in una cartella nel computer.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-125">Unzip this package into a folder on your computer.</span></span> <span data-ttu-id="a1fa8-126">Per visualizzare il codice sorgente ed eseguire l'app in un debugger, è possibile ottenere il codice sorgente dell'app da [GitHub](https://aka.ms/azure-stream-analytics-telcogenerator).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-126">If you want to see the source code and run the app in a debugger, you can get the app source code from [GitHub](https://aka.ms/azure-stream-analytics-telcogenerator).</span></span> 

    >[!NOTE]
    ><span data-ttu-id="a1fa8-127">Windows potrebbe bloccare il file con estensione zip scaricato.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-127">Windows might block the downloaded .zip file.</span></span> <span data-ttu-id="a1fa8-128">Se non è possibile decomprimerlo, fare clic con il pulsante destro del mouse sul file e scegliere **Proprietà**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-128">If you can't unzip it, right-click the file and select **Properties**.</span></span> <span data-ttu-id="a1fa8-129">Se viene visualizzato il messaggio "Il file proviene da un altro computer. Per facilitare la protezione del computer, potrebbe essere bloccato", selezionare l'opzione **Sblocca** e quindi scegliere **Applica**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-129">If you see the "This file came from another computer and might be blocked to help protect this computer" message, select the **Unblock** option and then click **Apply**.</span></span>

<span data-ttu-id="a1fa8-130">Per esaminare i risultati del processo di Analisi di flusso, è anche necessario uno strumento per la visualizzazione del contenuto di un contenitore di Archiviazione BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-130">If you want to examine the results of the Streaming Analytics job, you also need a tool for viewing the contents of a Azure Blob Storage container.</span></span> <span data-ttu-id="a1fa8-131">Se si usa Visual Studio, è possibile usare [Strumenti di Microsoft Azure per Visual Studio](https://docs.microsoft.com/en-us/azure/vs-azure-tools-storage-resources-server-explorer-browse-manage) o [Visual Studio Cloud Explorer](https://docs.microsoft.com/en-us/azure/vs-azure-tools-resources-managing-with-cloud-explorer).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-131">If you use Visual Studio, you can use [Azure Tools for Visual Studio](https://docs.microsoft.com/en-us/azure/vs-azure-tools-storage-resources-server-explorer-browse-manage) or [Visual Studio Cloud Explorer](https://docs.microsoft.com/en-us/azure/vs-azure-tools-resources-managing-with-cloud-explorer).</span></span> <span data-ttu-id="a1fa8-132">In alternativa, è possibile installare strumenti autonomi come [Azure Storage Explorer](http://storageexplorer.com/) o [Azure Explorer](http://www.cerebrata.com/products/azure-explorer/introduction).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-132">Alternatively, you can install standalone tools like [Azure Storage Explorer](http://storageexplorer.com/) or [Azure Explorer](http://www.cerebrata.com/products/azure-explorer/introduction).</span></span> 

## <a name="create-an-azure-event-hubs-to-ingest-events"></a><span data-ttu-id="a1fa8-133">Creare hub eventi di Azure per inserire eventi</span><span class="sxs-lookup"><span data-stu-id="a1fa8-133">Create an Azure event hubs to ingest events</span></span>

<span data-ttu-id="a1fa8-134">Per analizzare un flusso di dati, *inserirlo* in Azure.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-134">To analyze a data stream, you *ingest* it into Azure.</span></span> <span data-ttu-id="a1fa8-135">Un modo comune per inserire i dati consiste nell'usare gli [hub eventi di Azure](../event-hubs/event-hubs-what-is-event-hubs.md), che consentono di inserire milioni di eventi al secondo e quindi elaborare e archiviare le relative informazioni.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-135">A typical way to ingest data is to use [Azure Event Hubs](../event-hubs/event-hubs-what-is-event-hubs.md), which lets you ingest millions of events per second and then process and store the event information.</span></span> <span data-ttu-id="a1fa8-136">Per questa esercitazione si creerà un hub eventi e quindi l'app generatore degli eventi di chiamata invierà i dati a tale hub.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-136">For this tutorial, you create an event hub and then have the call-event generator app send call data to that event hub.</span></span> <span data-ttu-id="a1fa8-137">Per altre informazioni sugli hub eventi, vedere la [documentazione del bus di servizio di Azure](https://docs.microsoft.com/en-us/azure/service-bus/).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-137">For more about event hubs, see the [Azure Service Bus documentation](https://docs.microsoft.com/en-us/azure/service-bus/).</span></span>

>[!NOTE]
><span data-ttu-id="a1fa8-138">Per una versione più dettagliata di questa procedura, vedere [Creare uno spazio dei nomi di Hub eventi e un hub eventi usando il Portale di Azure](../event-hubs/event-hubs-create.md).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-138">For a more detailed version of this procedure, see [Create an Event Hubs namespace and an event hub using the Azure portal](../event-hubs/event-hubs-create.md).</span></span> 

### <a name="create-a-namespace-and-event-hub"></a><span data-ttu-id="a1fa8-139">Creare uno spazio dei nomi e un hub eventi</span><span class="sxs-lookup"><span data-stu-id="a1fa8-139">Create a namespace and event hub</span></span>
<span data-ttu-id="a1fa8-140">In questa procedura si creerà uno spazio dei nomi di un hub eventi a cui verrà aggiunto un hub.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-140">In this procedure, you first create an event hub namespace, and then you add an event hub to that namepsace.</span></span> <span data-ttu-id="a1fa8-141">Gli spazi dei nomi degli hub eventi consentono di raggruppare in modo logico le istanze dei bus di eventi correlate.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-141">Event hub namespaces are used to logically group related event bus instances.</span></span> 

1. <span data-ttu-id="a1fa8-142">Accedere al portale di Azure e fare clic su **Nuovo** > **Internet delle cose** > **Hub eventi**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-142">Log  into the Azure portal and click **New** > **Internet of Things** > **Event Hub**.</span></span> 

2. <span data-ttu-id="a1fa8-143">Nel pannello **Crea spazio dei nomi** immettere un nome per lo spazio dei nomi, ad esempio `<yourname>-eh-ns-demo`.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-143">In the **Create namespace** blade, enter a namespace name such as `<yourname>-eh-ns-demo`.</span></span> <span data-ttu-id="a1fa8-144">È possibile usare qualsiasi nome per lo spazio dei nomi, a condizione che sia valido per un URL e univoco in Azure.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-144">You can use any name for the namespace, but the name must be valid for a URL and it must be unique across Azure.</span></span> 
    
3. <span data-ttu-id="a1fa8-145">Selezionare una sottoscrizione, creare o scegliere un gruppo di risorse e quindi fare clic su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-145">Select a subscription and create or choose a resource group , then click **Create**.</span></span> 

    ![Creare uno spazio dei nomi dell'hub eventi](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-eventhub-namespace-new-portal.png)
 
4. <span data-ttu-id="a1fa8-147">Al termine della distribuzione, lo spazio dei nomi dell'hub eventi è disponibile nell'elenco delle risorse di Azure.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-147">When the namespace has finished deploying, find the event hub namespace in your list of Azure resources.</span></span> 

5. <span data-ttu-id="a1fa8-148">Scegliere il nuovo spazio dei nomi e, nel relativo pannello, fare clic su  **+&nbsp;Hub eventi**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-148">Click the new namespace, and in the namespace blade, click **+&nbsp;Event Hub**.</span></span> 

    ![<span data-ttu-id="a1fa8-149">Pulsante Aggiungi hub eventi per creare un nuovo hub eventi</span><span class="sxs-lookup"><span data-stu-id="a1fa8-149">The Add Event Hub button for creating a new event hub</span></span> ](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-eventhub-button-new-portal.png)    
 
6. <span data-ttu-id="a1fa8-150">Assegnare il nome `sa-eh-frauddetection-demo` al nuovo hub eventi.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-150">Name the new event hub `sa-eh-frauddetection-demo`.</span></span> <span data-ttu-id="a1fa8-151">È possibile usare un nome diverso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-151">You can use a different name.</span></span> <span data-ttu-id="a1fa8-152">In questo caso, tenerne traccia, poiché sarà necessario in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-152">If you do, make a note of it, because you need the name later.</span></span> <span data-ttu-id="a1fa8-153">Per ora non è necessario impostare altre opzioni per l'hub eventi.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-153">You don't need to set any other options for the event hub right now.</span></span>

    ![Pannello per creare un nuovo hub eventi](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-eventhub-new-portal.png)
    
 
7. <span data-ttu-id="a1fa8-155">Fare clic su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-155">Click **Create**.</span></span>
### <a name="grant-access-to-the-event-hub-and-get-a-connection-string"></a><span data-ttu-id="a1fa8-156">Concedere l'accesso all'hub eventi e ottenere una stringa di connessione</span><span class="sxs-lookup"><span data-stu-id="a1fa8-156">Grant access to the event hub and get a connection string</span></span>

<span data-ttu-id="a1fa8-157">Prima che un processo possa inviare dati a un hub eventi, è necessario che per l'hub siano configurati criteri che consentano l'accesso appropriato.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-157">Before a process can send data to an event hub, the event hub must have a policy that allows appropriate access.</span></span> <span data-ttu-id="a1fa8-158">I criteri di accesso generano una stringa di connessione che include informazioni di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-158">The access policy produces a connection string that includes authorization information.</span></span>

1.  <span data-ttu-id="a1fa8-159">Nel pannello dello spazio dei nomi dell'evento fare clic su **Hub eventi** e quindi sul nome del nuovo hub eventi.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-159">In the event namespace blade, click **Event Hubs** and then click the name of your new event hub.</span></span>

2.  <span data-ttu-id="a1fa8-160">Nel pannello dell'hub eventi fare clic su **Criteri di accesso condiviso** e quindi su **+&nbsp;Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-160">In the event hub blade, click **Shared access policies** and then click **+&nbsp;Add**.</span></span>

    >[!NOTE]
    ><span data-ttu-id="a1fa8-161">Verificare di usare l'hub eventi e non lo spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-161">Make sure you're working with the event hub, not the event hub namespace.</span></span>

3.  <span data-ttu-id="a1fa8-162">Aggiungere criteri denominati `sa-policy-manage-demo` e per **Attestazione** selezionare **Gestisci**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-162">Add a policy named `sa-policy-manage-demo` and for **Claim**, select **Manage**.</span></span>

    ![Pannello per creare nuovi criteri di accesso all'hub eventi](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-shared-access-policy-manage-new-portal.png)
 
4.  <span data-ttu-id="a1fa8-164">Fare clic su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-164">Click **Create**.</span></span>

5.  <span data-ttu-id="a1fa8-165">Dopo aver distribuito i criteri, fare clic nell'elenco dei criteri di accesso condiviso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-165">After the policy has been deployed, click it in the list of shared access policies.</span></span>

6.  <span data-ttu-id="a1fa8-166">Individuare la casella con l'etichetta **CONNECTION STRING-PRIMARY KEY** e fare clic sul pulsante Copia accanto alla stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-166">Find the box labeled **CONNECTION STRING-PRIMARY KEY** and click the copy button next to the connection string.</span></span> 
    
    ![Copia della chiave della stringa di connessione primaria dai criteri di accesso](./media/stream-analytics-real-time-fraud-detection/stream-analytics-shared-access-policy-copy-connection-string-new-portal.png)
 
7.  <span data-ttu-id="a1fa8-168">Incollare la stringa di connessione in un editor di testo.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-168">Paste the connection string into a text editor.</span></span> <span data-ttu-id="a1fa8-169">Sarà necessario usare questa stringa nella sezione successiva, dopo avervi apportato alcune piccole modifiche.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-169">You need this connection string for the next section, after you make some small edits to it.</span></span>

    <span data-ttu-id="a1fa8-170">La stringa di connessione ha un aspetto simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-170">The connection string looks like this:</span></span>

        Endpoint=sb://YOURNAME-eh-ns-demo.servicebus.windows.net/;SharedAccessKeyName=sa-policy-manage-demo;SharedAccessKey=Gw2NFZwU1Di+rxA2T+6hJYAtFExKRXaC2oSQa0ZsPkI=;EntityPath=sa-eh-frauddetection-demo

    <span data-ttu-id="a1fa8-171">Si noti che la stringa di connessione contiene più coppie chiave-valore, separate da punti e virgola: `Endpoint`, `SharedAccessKeyName`, `SharedAccessKey` e `EntityPath`.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-171">Notice that the connection string contains multiple key-value pairs, separated with semicolons: `Endpoint`, `SharedAccessKeyName`, `SharedAccessKey`, and `EntityPath`.</span></span>  

## <a name="configure-and-start-the-event-generator-application"></a><span data-ttu-id="a1fa8-172">Configurare e avviare l'applicazione di generazione di eventi</span><span class="sxs-lookup"><span data-stu-id="a1fa8-172">Configure and start the event generator application</span></span>

<span data-ttu-id="a1fa8-173">Prima di avviare l'app TelcoGenerator, configurarla per l'invio di record delle chiamate all'hub eventi appena creato.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-173">Before you start the TelcoGenerator app, you configure it so that it will send call records to the event hub you just created.</span></span>

### <a name="configure-the-telcogeneratorapp"></a><span data-ttu-id="a1fa8-174">Configurare l'app TelcoGenerator</span><span class="sxs-lookup"><span data-stu-id="a1fa8-174">Configure the TelcoGeneratorapp</span></span>

1.  <span data-ttu-id="a1fa8-175">Nell'editor in cui è stata copiata la stringa di connessione annotare il valore `EntityPath` e quindi rimuovere la coppia `EntityPath` (non dimenticare di rimuovere il punto e virgola che la precede).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-175">In the editor where you copied the connection string, make a note of the `EntityPath` value, and then remove the `EntityPath` pair (don't forget to remove the semicolon that precedes it).</span></span> 

2.  <span data-ttu-id="a1fa8-176">Nella cartella in cui è stato decompresso il file TelcoGenerator.zip aprire il file telcodatagen.exe.config in un editor.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-176">In the folder where you unzipped the TelcoGenerator.zip file, open the telcodatagen.exe.config file in an editor.</span></span> <span data-ttu-id="a1fa8-177">È presente più di un file con estensione config, di conseguenza è necessario assicurarsi di aprire quello giusto.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-177">(There is more than one .config file, so be sure that you open the right one.)</span></span>

3.  <span data-ttu-id="a1fa8-178">Nell'elemento `<appSettings>` procedere come segue:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-178">In the `<appSettings>` element, do this:</span></span>

    * <span data-ttu-id="a1fa8-179">Impostare il valore della chiave `EventHubName` sul nome dell'hub eventi (ovvero il valore del percorso dell'entità).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-179">Set the value of the `EventHubName` key to the event hub name (that is, to the value of the entity path).</span></span>
    * <span data-ttu-id="a1fa8-180">Impostare il valore della chiave `Microsoft.ServiceBus.ConnectionString` sulla stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-180">Set the value of the `Microsoft.ServiceBus.ConnectionString` key to the connection string.</span></span> 

    <span data-ttu-id="a1fa8-181">La sezione `<appSettings>` dovrebbe essere simile all'esempio seguente.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-181">The `<appSettings>` section will look like the following example.</span></span> <span data-ttu-id="a1fa8-182">Per maggiore chiarezza è stato eseguito il wrapping delle righe e alcuni caratteri sono stati rimossi dal token di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-182">(For clarity, we wrapped the lines and removed some characters from the authorization token.)</span></span>

    ![File di configurazione dell'app TelcoGenerator che mostra la stringa di connessione e il nome dell'hub eventi](./media/stream-analytics-real-time-fraud-detection/stream-analytics-telcogenerator-config-file-app-settings.png)
 
4.  <span data-ttu-id="a1fa8-184">Salvare il file.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-184">Save the file.</span></span> 

### <a name="start-the-app"></a><span data-ttu-id="a1fa8-185">Avviare l'app</span><span class="sxs-lookup"><span data-stu-id="a1fa8-185">Start the app</span></span>
1.  <span data-ttu-id="a1fa8-186">Aprire una finestra di comando e passare alla cartella in cui è stata decompressa l'app TelcoGenerator.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-186">Open a command window and change to the folder where the TelcoGenerator app is unzipped.</span></span>
2.  <span data-ttu-id="a1fa8-187">Immettere il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-187">Enter the following command:</span></span>

        telcodatagen.exe 1000 .2 2

    <span data-ttu-id="a1fa8-188">I parametri sono i seguenti:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-188">The parameters are:</span></span> 

    * <span data-ttu-id="a1fa8-189">Numero di CDR all'ora.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-189">Number of CDRs per hour.</span></span> 
    * <span data-ttu-id="a1fa8-190">Probabilità di frode della scheda SIM: frequenza, in percentuale di tutte le chiamate, con cui l'app dovrebbe simulare una chiamata fraudolenta.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-190">SIM Card Fraud Probability: How often, as a percentage of all calls, that the app should simulate a fraudulent call.</span></span> <span data-ttu-id="a1fa8-191">Il valore 0,2 significa che circa il 20% dei record delle chiamate apparirà come fraudolento.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-191">The value .2 means that about 20% of the call records will look fraudulent.</span></span>
    * <span data-ttu-id="a1fa8-192">Durata in ore.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-192">Duration in hours.</span></span> <span data-ttu-id="a1fa8-193">Numero di ore di esecuzione dell'app.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-193">The number of hours that the app should run.</span></span> <span data-ttu-id="a1fa8-194">È anche possibile arrestare l'app in qualsiasi momento premendo CTRL+C nella riga di comando.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-194">You can also stop the app any time by pressing Ctrl+C at the command line.</span></span>

    <span data-ttu-id="a1fa8-195">Dopo alcuni secondi, l'app inizierà a visualizzare i record delle chiamate mentre ne esegue l'invio all'hub eventi.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-195">After a few seconds, the app starts displaying phone call records on the screen as it sends them to the event hub.</span></span>

<span data-ttu-id="a1fa8-196">Di seguito sono riportati alcuni campi chiave che verranno usati in questa applicazione di rilevamento di frodi in tempo reale:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-196">Some of the key fields that you will be using in this real-time fraud detection application are the following:</span></span>

|<span data-ttu-id="a1fa8-197">**Record**</span><span class="sxs-lookup"><span data-stu-id="a1fa8-197">**Record**</span></span>|<span data-ttu-id="a1fa8-198">**Definizione**</span><span class="sxs-lookup"><span data-stu-id="a1fa8-198">**Definition**</span></span>|
|----------|--------------|
|`CallrecTime`|<span data-ttu-id="a1fa8-199">Timestamp dell'ora di inizio della chiamata.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-199">The timestamp for the call start time.</span></span> |
|`SwitchNum`|<span data-ttu-id="a1fa8-200">Commutatore telefonico usato per la connessione della chiamata.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-200">The telephone switch used to connect the call.</span></span> <span data-ttu-id="a1fa8-201">Per questo esempio i commutatori sono stringhe che rappresentano il paese di origine (Stati Uniti, Cina, Regno Unito, Germania o Australia).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-201">For this example, the switches are strings that represent the country of origin (US, China, UK, Germany, or Australia).</span></span> |
|`CallingNum`|<span data-ttu-id="a1fa8-202">Numero di telefono del chiamante.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-202">The phone number of the caller.</span></span> |
|`CallingIMSI`|<span data-ttu-id="a1fa8-203">Codice IMSI (International Mobile Subscriber Identity).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-203">The International Mobile Subscriber Identity (IMSI).</span></span> <span data-ttu-id="a1fa8-204">Si tratta dell'identificatore univoco del chiamante.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-204">This is the Unique identifier of the caller.</span></span> |
|`CalledNum`|<span data-ttu-id="a1fa8-205">Numero di telefono del destinatario della chiamata.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-205">The phone number of the call recipient.</span></span> |
|`CalledIMSI`|<span data-ttu-id="a1fa8-206">Codice IMSI (International Mobile Subscriber Identity).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-206">International Mobile Subscriber Identity (IMSI).</span></span> <span data-ttu-id="a1fa8-207">Si tratta dell'identificatore univoco del destinatario della chiamata.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-207">This is the unique identifier of the call recipient.</span></span> |


## <a name="create-a-stream-analytics-job-to-manage-streaming-data"></a><span data-ttu-id="a1fa8-208">Creare un processo di Analisi di flusso per gestire i dati di streaming</span><span class="sxs-lookup"><span data-stu-id="a1fa8-208">Create a Stream Analytics job to manage streaming data</span></span>

<span data-ttu-id="a1fa8-209">Dopo aver creato un flusso di eventi di chiamata, sarà possibile configurare un processo di Analisi di flusso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-209">Now that you have a stream of call events, you can set up a Stream Analytics job.</span></span> <span data-ttu-id="a1fa8-210">Il processo leggerà i dati dall'hub eventi configurato.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-210">The job will read data from the event hub that you set up.</span></span> 

### <a name="create-the-job"></a><span data-ttu-id="a1fa8-211">Creare il processo</span><span class="sxs-lookup"><span data-stu-id="a1fa8-211">Create the job</span></span> 

1. <span data-ttu-id="a1fa8-212">Nel portale di Azure fare clic su **Nuovo** > **Internet delle cose** > **Processo di Analisi di flusso**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-212">In the Azure portal, click **New** > **Internet of Things** > **Stream Analytics job**.</span></span>

2. <span data-ttu-id="a1fa8-213">Denominare il processo `sa_frauddetection_job_demo`, specificare una sottoscrizione, un gruppo di risorse e un percorso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-213">Name the job `sa_frauddetection_job_demo`, specify a subscription, resource group, and location.</span></span>

    <span data-ttu-id="a1fa8-214">È consigliabile posizionare il processo e l'hub eventi nella stessa area per ottenere prestazioni ottimali ed evitare di pagare il trasferimento dei dati tra aree.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-214">It's a good idea to place the job and the event hub in the same region for best performance and so that you don't pay to transfer data between regions.</span></span>

    ![Creare un nuovo processo di Analisi di flusso](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-sa-job-new-portal.png)

3. <span data-ttu-id="a1fa8-216">Fare clic su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-216">Click **Create**.</span></span>

    <span data-ttu-id="a1fa8-217">Verrà creato il processo e il portale visualizzerà i relativi dettagli.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-217">The job is created and the portal displays job details.</span></span> <span data-ttu-id="a1fa8-218">Il processo non è ancora in esecuzione: è necessario configurarlo prima di poterlo avviare.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-218">Nothing is running yet, though—you have to configure the job before it can be started.</span></span>

### <a name="configure-job-input"></a><span data-ttu-id="a1fa8-219">Configurare l'input del processo</span><span class="sxs-lookup"><span data-stu-id="a1fa8-219">Configure job input</span></span>

1. <span data-ttu-id="a1fa8-220">Nel dashboard o nel pannello **Tutte le risorse** trovare e selezionare il processo di Analisi di flusso `sa_frauddetection_job_demo`.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-220">In the dashboard or the **All resources** blade, find and select the `sa_frauddetection_job_demo` Stream Analytics job.</span></span> 
2. <span data-ttu-id="a1fa8-221">Nella sezione **Topologia processo** del pannello del processo di Analisi di flusso selezionare la casella **Input**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-221">In the **Job Topology** section of the Stream Analytics job blade, click the **Input** box.</span></span>

    ![Casella di input in Topologia nel pannello del processo di Analisi di flusso](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-input-box-new-portal.png)
 
3. <span data-ttu-id="a1fa8-223">Fare clic su **+&nbsp;Aggiungi** e compilare il pannello con questi valori:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-223">Click **+&nbsp;Add** and then fill out the blade with these values:</span></span>

    * <span data-ttu-id="a1fa8-224">**Alias di input**: usare il nome `CallStream`.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-224">**Input alias**: Use the name `CallStream`.</span></span> <span data-ttu-id="a1fa8-225">Se si usa un nome diverso, tenerne traccia, poiché sarà necessario in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-225">If you use a different name, make a note of it because you'll need it later.</span></span>
    * <span data-ttu-id="a1fa8-226">**Tipo di origine**: selezionare **Flusso dati**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-226">**Source type**: Select **Data stream**.</span></span> <span data-ttu-id="a1fa8-227">**Dati di riferimento** si riferisce a dati di ricerca statici, che non verranno usati in questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-227">(**Reference data** refers to static lookup data, which you won't use in this tutorial.)</span></span>
    * <span data-ttu-id="a1fa8-228">**Origine**: selezionare **Hub eventi**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-228">**Source**: Select **Event hub**.</span></span>
    * <span data-ttu-id="a1fa8-229">**Opzioni di importazione**: selezionare **Usa l'hub eventi della sottoscrizione corrente**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-229">**Import option**: Select **Use event hub from current subscription**.</span></span> 
    * <span data-ttu-id="a1fa8-230">**Spazio dei nomi del bus di servizio**: selezionare lo spazio dei nomi dell'hub eventi creato in precedenza (`<yourname>-eh-ns-demo`).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-230">**Service bus namespace**: Select the event hub namespace that you created earlier (`<yourname>-eh-ns-demo`).</span></span>
    * <span data-ttu-id="a1fa8-231">**Hub eventi**: selezionare l'hub eventi creato in precedenza (`sa-eh-frauddetection-demo`).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-231">**Event hub**: Select the event hub that you created earlier (`sa-eh-frauddetection-demo`).</span></span>
    * <span data-ttu-id="a1fa8-232">**Nome criteri hub eventi**: selezionare i criteri di accesso creati in precedenza (`sa-policy-manage-demo`).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-232">**Event hub policy name**: Select the access policy that you created earlier (`sa-policy-manage-demo`).</span></span>

    ![Creare un nuovo input per il processo di Analisi di flusso](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-sa-input-new-portal.png)

4. <span data-ttu-id="a1fa8-234">Fare clic su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-234">Click **Create**.</span></span>

## <a name="create-queries-to-transform-real-time-data"></a><span data-ttu-id="a1fa8-235">Creare query per trasformare i dati in tempo reale</span><span class="sxs-lookup"><span data-stu-id="a1fa8-235">Create queries to transform real-time data</span></span>

<span data-ttu-id="a1fa8-236">A questo punto il processo di Analisi di flusso è configurato per la lettura di un flusso di dati in ingresso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-236">At this point, you have a Stream Analytics job set up to read an incoming data stream.</span></span> <span data-ttu-id="a1fa8-237">Il passaggio successivo consiste nel creare una trasformazione che analizzi i dati in tempo reale.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-237">The next step is to create a transformation that analyzes the data in real time.</span></span> <span data-ttu-id="a1fa8-238">A tale scopo, creare una query.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-238">You do this by creating a query.</span></span> <span data-ttu-id="a1fa8-239">Analisi di flusso supporta un semplice modello di query dichiarative che descrive le trasformazioni per l'elaborazione in tempo reale.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-239">Stream Analytics supports a simple, declarative query model that describes transformations for real-time processing.</span></span> <span data-ttu-id="a1fa8-240">Le query usano un linguaggio simile a SQL che include alcune estensioni specifiche di Analisi di flusso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-240">The queries use a SQL-like language that has some extensions specific to stream analytics.</span></span> 

<span data-ttu-id="a1fa8-241">Una query molto semplice potrebbe semplicemente leggere tutti i dati in ingresso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-241">A very simple query might simply read all the incoming data.</span></span> <span data-ttu-id="a1fa8-242">Tuttavia, spesso si creano query che cercano dati specifici o relazioni nei dati.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-242">However, you often create queries that look for specific data or for relationships in the data.</span></span> <span data-ttu-id="a1fa8-243">In questa sezione dell'esercitazione si creeranno e testeranno varie query per apprendere alcuni modi in cui trasformare un flusso di input per l'analisi.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-243">In this section of the tutorial, you will create and test several queries to learn a few ways in which you can transform an input stream for analysis.</span></span> 

<span data-ttu-id="a1fa8-244">Le query qui create visualizzeranno semplicemente i dati trasformati.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-244">The queries you create here will just display the transformed data to the screen.</span></span> <span data-ttu-id="a1fa8-245">In una sezione successiva si configureranno un sink di output e una query che scrive in tale sink i dati trasformati.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-245">In a later section, you'll configure an output sink and a query that writes the transformed data to that sink.</span></span>

<span data-ttu-id="a1fa8-246">Per altre informazioni sul linguaggio, vedere le [Informazioni di riferimento sul linguaggio di query di Analisi di flusso di Azure](https://msdn.microsoft.com/library/dn834998.aspx).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-246">To learn more about the language, see the [Azure Stream Analytics Query Language Reference](https://msdn.microsoft.com/library/dn834998.aspx).</span></span>

### <a name="get-sample-data-for-testing-queries"></a><span data-ttu-id="a1fa8-247">Ottenere dati di esempio per testare le query</span><span class="sxs-lookup"><span data-stu-id="a1fa8-247">Get sample data for testing queries</span></span>

<span data-ttu-id="a1fa8-248">L'app TelcoGenerator invia i record delle chiamate all'hub eventi e il processo di Analisi di flusso viene configurato per la lettura dall'hub eventi.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-248">The TelcoGenerator app is sending call records to the event hub, and your Stream Analytics job is configured to read from the event hub.</span></span> <span data-ttu-id="a1fa8-249">È possibile usare una query per testare il processo e verificare che esegua correttamente le operazioni di lettura.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-249">You can use a query to test the job to make sure that it's reading correctly.</span></span> <span data-ttu-id="a1fa8-250">Per testare una query nella console di Azure sono necessari dati di esempio.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-250">To  test a query in the Azure console, you need sample data.</span></span> <span data-ttu-id="a1fa8-251">Per questa procedura dettagliata si estrarranno dati di esempio dal flusso in arrivo nell'hub eventi.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-251">For this walkthrough, you'll extract sample data from the stream that's coming into the event hub.</span></span>

1. <span data-ttu-id="a1fa8-252">Verificare che l'app TelcoGenerator sia in esecuzione e generi record delle chiamate.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-252">Make sure that the TelcoGenerator app is running and producing call records.</span></span>
2. <span data-ttu-id="a1fa8-253">Nel portale tornare al pannello del processo di Analisi di flusso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-253">In the portal, return to the Streaming Analytics job blade.</span></span> <span data-ttu-id="a1fa8-254">Se il pannello è stato chiuso, cercare `sa_frauddetection_job_demo` nel pannello **Tutte le risorse**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-254">(If you closed the blade, search for `sa_frauddetection_job_demo` in the **All resources** blade.)</span></span>
3. <span data-ttu-id="a1fa8-255">Fare clic sulla casella **Query**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-255">Click the **Query** box.</span></span> <span data-ttu-id="a1fa8-256">Azure elenca gli input e gli output configurati per il processo e consente di creare una query per trasformare il flusso di input nel momento in cui viene inviato all'output.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-256">Azure lists the inputs and outputs that are configured for the job, and lets you create a query that lets you transform the input stream as it is sent to the output.</span></span>
4. <span data-ttu-id="a1fa8-257">Nel pannello **Query** fare clic sui puntini di sospensione accanto all'input `CallStream` e quindi selezionare **Campiona dati da input**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-257">In the **Query** blade, click the dots next to the `CallStream` input and then select **Sample data from input**.</span></span>

    ![Voci di menu per usare dati di esempio per la voce del processo di Analisi di flusso, con l'opzione "Campiona dati da input" selezionata](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-sample-data-from-input.png)

    <span data-ttu-id="a1fa8-259">Verrà aperto un pannello che consente di specificare la quantità di dati di esempio da ottenere, definita in termini di durata della lettura del flusso di input.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-259">This opens a blade that lets you specify how much sample data to get, defined in terms of how long to read the input stream.</span></span>

5. <span data-ttu-id="a1fa8-260">Impostare **Minuti** su 3 e quindi fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-260">Set **Minutes** to 3 and then click **OK**.</span></span> 
    
    ![Opzioni per il campionamento del flusso di input, con l'opzione "3 minuti" selezionata.](./media/stream-analytics-real-time-fraud-detection/stream-analytics-input-create-sample-data.png)

    <span data-ttu-id="a1fa8-262">Azure campiona i dati dal flusso di input per una durata di tre minuti e invia una notifica quando i dati di esempio sono pronti.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-262">Azure samples 3 minutes' worth of data from the input stream and notifies you when the sample data is ready.</span></span> <span data-ttu-id="a1fa8-263">Questa operazione richiede un breve tempo.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-263">(This takes a short while.)</span></span> 

<span data-ttu-id="a1fa8-264">I dati di esempio vengono archiviati temporaneamente e sono disponibili finché rimane aperta la finestra di query.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-264">The sample data is stored temporarily and is available while you have the query window open.</span></span> <span data-ttu-id="a1fa8-265">Se si chiude la finestra di query, i dati di esempio verranno rimossi e sarà necessario creare un nuovo set di dati.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-265">If you close the query window, the sample data is discarded, and you'll have to create a new set of sample data.</span></span> 

<span data-ttu-id="a1fa8-266">In alternativa, è possibile ottenere un file con estensione json che contiene dati di esempio [da GitHub](https://github.com/Azure/azure-stream-analytics/blob/master/Sample%20Data/telco.json) e quindi caricare il file con estensione json da usare come dati di esempio per l'input `CallStream`.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-266">As an alternative, you can get a .json file that has sample data in it [from GitHub](https://github.com/Azure/azure-stream-analytics/blob/master/Sample%20Data/telco.json), and then upload that .json file to use as sample data for the `CallStream` input .</span></span> 

### <a name="test-using-a-pass-through-query"></a><span data-ttu-id="a1fa8-267">Test mediante una query pass-through</span><span class="sxs-lookup"><span data-stu-id="a1fa8-267">Test using a pass-through query</span></span>

<span data-ttu-id="a1fa8-268">Per archiviare ogni evento, è possibile usare una query pass-through per leggere tutti i campi nel payload dell'evento.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-268">If you want to archive every event, you can use a pass-through query to read all the fields in the payload of the event.</span></span>

1. <span data-ttu-id="a1fa8-269">Nella finestra di query immettere la query seguente:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-269">In the query window, enter this query:</span></span>

        SELECT 
            *
        FROM 
            CallStream

    >[!NOTE]
    ><span data-ttu-id="a1fa8-270">Come con SQL, le parole chiave non effettuano distinzione tra maiuscole e minuscole e gli spazi non sono rilevanti.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-270">As with SQL, keywords are not case sensitive, and whitespace is not significant.</span></span>

    <span data-ttu-id="a1fa8-271">In questa query `CallStream` è l'alias specificato quando è stato creato l'input.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-271">In this query, `CallStream` is the alias that you specified when you created the input.</span></span> <span data-ttu-id="a1fa8-272">In presenza di un alias diverso, usare questo nome.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-272">If you used a different alias, use that name instead.</span></span>

2. <span data-ttu-id="a1fa8-273">Fare clic su **Test**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-273">Click **Test**.</span></span>

    <span data-ttu-id="a1fa8-274">Il processo di Analisi di flusso esegue la query a fronte dei dati di esempio e visualizza l'output nella parte inferiore della finestra,</span><span class="sxs-lookup"><span data-stu-id="a1fa8-274">The Stream Analytics job runs the query against the sample data and displays the output at the bottom of the window.</span></span> <span data-ttu-id="a1fa8-275">a indicare che l'hub eventi e il processo di Analisi di flusso sono configurati correttamente.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-275">This tells you that the event hub and the Streaming Analytics job are configured correctly.</span></span> <span data-ttu-id="a1fa8-276">Come già indicato, in seguito si creerà un sink di output in cui la query potrà scrivere dati.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-276">(As noted, later you'll create an output sink that the query can write data to.)</span></span>

    ![Output del processo di Analisi di flusso con 73 record generati](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-sample-output.png)

    <span data-ttu-id="a1fa8-278">Il numero esatto di record visualizzati dipenderà dal numero di record acquisiti nell'esempio di 3 minuti.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-278">The exact number of records you see will depend on how many records were captured in your 3-minute sample.</span></span>
 
### <a name="reduce-the-number-of-fields-using-a-column-projection"></a><span data-ttu-id="a1fa8-279">Ridurre il numero di campi usando una proiezione di colonna</span><span class="sxs-lookup"><span data-stu-id="a1fa8-279">Reduce the number of fields using a column projection</span></span>

<span data-ttu-id="a1fa8-280">In molti casi, l'analisi non necessita di tutte le colonne dal flusso di input.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-280">In many cases, your analysis doesn't need all the columns from the input stream.</span></span> <span data-ttu-id="a1fa8-281">È possibile usare una query per proiettare un set di campi restituiti ridotto rispetto alla query pass-through.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-281">You can use a query to project a smaller set of returned fields than in the pass-through query.</span></span>

1. <span data-ttu-id="a1fa8-282">Modificare la query nell'editor di codice nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-282">Change the query in the code editor to the following:</span></span>

        SELECT CallRecTime, SwitchNum, CallingIMSI, CallingNum, CalledNum 
        FROM 
            CallStream

2. <span data-ttu-id="a1fa8-283">Fare di nuovo clic su **Test**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-283">Click **Test** again.</span></span> 

    ![Output del processo di Analisi di flusso per la proiezione con 25 record generati](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-sample-output-projection.png)
 
### <a name="count-incoming-calls-by-region-tumbling-window-with-aggregation"></a><span data-ttu-id="a1fa8-285">Numero di chiamate in ingresso per area: finestra a cascata con aggregazione</span><span class="sxs-lookup"><span data-stu-id="a1fa8-285">Count incoming calls by region: Tumbling window with aggregation</span></span>

<span data-ttu-id="a1fa8-286">Si supponga di voler contare il numero di chiamate in ingresso per ogni area.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-286">Suppose you want to count the number of incoming calls per region.</span></span> <span data-ttu-id="a1fa8-287">Nei dati di streaming, se si vuole eseguire funzioni di aggregazione come il conteggio, è necessario segmentare il flusso in unità temporali (poiché il flusso di dati stesso è in effetti infinito).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-287">In streaming data, when you want to perform aggregate functions like counting, you need to segment the stream into temporal units (since the data stream itself is effectively endless).</span></span> <span data-ttu-id="a1fa8-288">A tale scopo, usare una [funzione finestra](stream-analytics-window-functions.md) di Analisi di flusso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-288">You do this using a Streaming Analytics [window function](stream-analytics-window-functions.md).</span></span> <span data-ttu-id="a1fa8-289">Sarà quindi possibile usare i dati all'interno di tale finestra come unità.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-289">You can then work with the data inside that window as a unit.</span></span>

<span data-ttu-id="a1fa8-290">Per questa trasformazione si intende creare una sequenza di finestre temporali che non si sovrappongano. Ogni finestra includerà un set distinto di dati che è possibile raggruppare e aggregare.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-290">For this transformation, you want a sequence of temporal windows that don't overlap—each window will have a discrete set of data that you can group and aggregate.</span></span> <span data-ttu-id="a1fa8-291">A questo tipo di finestra si fa riferimento con la locuzione *finestra a cascata*.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-291">This type of window is referred to as a *Tumbling window* .</span></span> <span data-ttu-id="a1fa8-292">All'interno della finestra a cascata è possibile ottenere un conteggio delle chiamate in ingresso raggruppate per `SwitchNum`, che rappresenta il paese in cui la chiamata ha avuto origine.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-292">Within the Tumbling window, you can get a count of the incoming calls grouped by `SwitchNum`, which represents the country where the call originated.</span></span> 

1. <span data-ttu-id="a1fa8-293">Modificare la query nell'editor di codice nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-293">Change the query in the code editor to the following:</span></span>

        SELECT 
            System.Timestamp as WindowEnd, SwitchNum, COUNT(*) as CallCount 
        FROM
            CallStream TIMESTAMP BY CallRecTime 
        GROUP BY TUMBLINGWINDOW(s, 5), SwitchNum

    <span data-ttu-id="a1fa8-294">Questa query usa la parola chiave `Timestamp By` nella clausola `FROM` per specificare il campo del timestamp nel flusso di input da usare per definire la finestra a cascata.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-294">This query uses the `Timestamp By` keyword in the `FROM` clause to specify which timestamp field in the input stream to use to define the Tumbling window.</span></span> <span data-ttu-id="a1fa8-295">In questo caso la finestra divide i dati in segmenti per il campo `CallRecTime` in ogni record.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-295">In this case, the window divides the data into segments by the `CallRecTime` field in each record.</span></span> <span data-ttu-id="a1fa8-296">Se non è specificato alcun campo, l'operazione di windowing usa l'ora in cui ogni evento arriva all'hub.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-296">(If no field is specified, the windowing operation uses the time that each event arrives at the event hub.</span></span> <span data-ttu-id="a1fa8-297">Vedere la sezione relativa a tempo di arrivo e tempo di applicazione in [Informazioni di riferimento sul linguaggio di query per l'analisi di flusso](https://msdn.microsoft.com/library/azure/dn834998.aspx).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-297">See "Arrival Time Vs Application Time" in [Stream Analytics Query Language Reference](https://msdn.microsoft.com/library/azure/dn834998.aspx).</span></span> 

    <span data-ttu-id="a1fa8-298">La proiezione include `System.Timestamp`, che restituisce un timestamp per la fine di ogni finestra.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-298">The projection includes `System.Timestamp`, which returns a timestamp for the end of each window.</span></span> 

    <span data-ttu-id="a1fa8-299">Per specificare che si intende usare una finestra a cascata, usare la funzione [TUMBLINGWINDOW](https://msdn.microsoft.com/library/dn835055.aspx) nella clausola `GROUP BY `.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-299">To specify that you want to use a Tumbling window, you use the [TUMBLINGWINDOW](https://msdn.microsoft.com/library/dn835055.aspx) function in the `GROUP BY `clause.</span></span> <span data-ttu-id="a1fa8-300">Specificare nella funzione un'unità di tempo (da un microsecondo a un giorno) e una dimensione della finestra (numero di unità).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-300">In the function, you specify a time unit (anywhere from a microsecond to a day) and a window size (how many units).</span></span> <span data-ttu-id="a1fa8-301">In questo esempio la finestra a cascata è costituita da intervalli di 5 secondi, per ottenere un conteggio in base al paese per chiamate ogni 5 secondi.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-301">In this example, the Tumbling window consists of 5-second intervals, so you will get a count by country for every 5 seconds' worth of calls.</span></span>

2. <span data-ttu-id="a1fa8-302">Fare di nuovo clic su **Test**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-302">Click **Test** again.</span></span> <span data-ttu-id="a1fa8-303">Si noti nei risultati che i timestamp in **WindowEnd** sono in incrementi di 5 secondi.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-303">In the results, notice that the timestamps under **WindowEnd** are in 5-second increments.</span></span>

    ![Output del processo di Analisi di flusso per l'aggregazione con 13 record generati](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-sample-output-aggregation.png)
 
### <a name="detect-sim-fraud-using-a-self-join"></a><span data-ttu-id="a1fa8-305">Rilevare una frode SIM mediante self-join</span><span class="sxs-lookup"><span data-stu-id="a1fa8-305">Detect SIM fraud using a self-join</span></span>

<span data-ttu-id="a1fa8-306">Per questo esempio è possibile considerare come uso fraudolento le chiamate che provengono dallo stesso utente ma in posizioni diverse, a 5 secondi l'una dall'altra.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-306">For this example, we can consider fraudulent usage to be calls that originate from the same user but in different locations within 5 seconds of one another.</span></span> <span data-ttu-id="a1fa8-307">Ad esempio, lo stesso utente non può eseguire legittimamente una chiamata dagli Stati Uniti e dall'Australia nello stesso momento.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-307">For example, the same user can't legitimately make a call from the US and Australia at the same time.</span></span> 

<span data-ttu-id="a1fa8-308">Per verificare questi casi, è possibile usare un self-join dei dati di streaming per creare un join del flusso a se stesso in base al valore `CallRecTime`.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-308">To check for these cases, you can use a self-join of the streaming data to join the stream to itself based on the `CallRecTime` value.</span></span> <span data-ttu-id="a1fa8-309">Sarà quindi possibile cercare i record delle chiamate in cui il valore `CallingIMSI` (numero di origine) è lo stesso, ma il valore `SwitchNum` (paese di origine) non coincide.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-309">You can then look for call records where the `CallingIMSI` value (the originating number) is the same, but the `SwitchNum` value (country of origin) is not the same.</span></span>

<span data-ttu-id="a1fa8-310">Quando si usa un join con i dati di streaming, il join deve garantire alcuni limiti per la distanza di separazione delle righe corrispondenti nel tempo.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-310">When you use a join with streaming data, the join must provide some limits on how far the matching rows can be separated in time.</span></span> <span data-ttu-id="a1fa8-311">Come indicato in precedenza, i dati di streaming sono effettivamente infiniti. I limiti di tempo per la relazione sono specificati all'interno della clausola `ON` del join usando la funzione `DATEDIFF`.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-311">(As noted earlier, the streaming data is effectively endless.) The time bounds for the relationship are specified inside the `ON` clause of the join, using the `DATEDIFF` function .</span></span> <span data-ttu-id="a1fa8-312">In questo caso il join è basato su un intervallo di 5 secondi di dati di chiamate.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-312">In this case, the join is based on a 5-second interval of call data .</span></span>

1. <span data-ttu-id="a1fa8-313">Modificare la query nell'editor di codice nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-313">Change the query in the code editor to the following:</span></span> 

        SELECT  System.Timestamp as Time, 
            CS1.CallingIMSI, 
            CS1.CallingNum as CallingNum1, 
            CS2.CallingNum as CallingNum2, 
            CS1.SwitchNum as Switch1, 
            CS2.SwitchNum as Switch2 
        FROM CallStream CS1 TIMESTAMP BY CallRecTime 
            JOIN CallStream CS2 TIMESTAMP BY CallRecTime 
            ON CS1.CallingIMSI = CS2.CallingIMSI 
            AND DATEDIFF(ss, CS1, CS2) BETWEEN 1 AND 5 
        WHERE CS1.SwitchNum != CS2.SwitchNum

    <span data-ttu-id="a1fa8-314">Questa query è simile a un join SQL, ad eccezione della funzione `DATEDIFF` nel join.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-314">This query is like any SQL join except for the `DATEDIFF` function in the join.</span></span> <span data-ttu-id="a1fa8-315">Si tratta di una versione di `DATEDIFF` specifica di Analisi di flusso che deve apparire nella clausola `ON...BETWEEN`.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-315">This is a version of `DATEDIFF` that's specific to Streaming Analytics, and it must appear in the `ON...BETWEEN` clause.</span></span> <span data-ttu-id="a1fa8-316">I parametri sono un'unità di tempo (secondi in questo esempio) e gli alias delle due origini per il join.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-316">The parameters are a time unit (seconds in this example) and the aliases of the two sources for the join.</span></span> <span data-ttu-id="a1fa8-317">Si tratta di una differenza rispetto alla funzione `DATEDIFF` SQL standard.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-317">(This is different from the standard SQL `DATEDIFF` function.)</span></span> 

    <span data-ttu-id="a1fa8-318">La clausola `WHERE` include la condizione che contrassegna la chiamata fraudolenta: i commutatori di origine non sono uguali.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-318">The `WHERE` clause includes the condition that flags the fraudulent call: the originating switches are not the same.</span></span> 

2. <span data-ttu-id="a1fa8-319">Fare di nuovo clic su **Test**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-319">Click **Test** again.</span></span> 

    ![Output del processo di Analisi di flusso per il self-join con 6 record generati](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-sample-output-self-join.png)

3. <span data-ttu-id="a1fa8-321">Fare clic su **Salva**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-321">Click **Save**.</span></span> <span data-ttu-id="a1fa8-322">In questo modo la query di self-join viene salvata nell'ambito del processo di Analisi di flusso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-322">This saves the self-join query as part of the Streaming Analytics job.</span></span> <span data-ttu-id="a1fa8-323">I dati di esempio non vengono salvati.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-323">(It doesn't save the sample data.)</span></span>

    ![Salvare il processo di Analisi di flusso](./media/stream-analytics-real-time-fraud-detection/stream-analytics-query-editor-save-button-new-portal.png)

## <a name="create-an-output-sink-to-store-transformed-data"></a><span data-ttu-id="a1fa8-325">Creare un sink di output per archiviare i dati trasformati</span><span class="sxs-lookup"><span data-stu-id="a1fa8-325">Create an output sink to store transformed data</span></span>

<span data-ttu-id="a1fa8-326">Sono stati definiti un flusso di eventi, un input dell'hub eventi per inserire gli eventi e una query per eseguire una trasformazione nel flusso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-326">You've defined an event stream, an event hub input to ingest events, and a query to perform a transformation over the stream.</span></span> <span data-ttu-id="a1fa8-327">L'ultimo passaggio consiste nel definire un sink di output per il processo, ovvero un percorso in cui scrivere il flusso trasformato.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-327">The last step is to define an output sink for the job—that is, a place to write the transformed stream to.</span></span> 

<span data-ttu-id="a1fa8-328">È possibile usare molte risorse come sink di output: un database di SQL Server, un'archiviazione tabelle, un'archiviazione Data Lake, Power BI e addirittura un altro hub eventi.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-328">You can use many resources as output sinks—a SQL Server database, table storage, Data Lake storage, Power BI, and even another event hub.</span></span> <span data-ttu-id="a1fa8-329">Per questa esercitazione si scriverà il flusso in Archiviazione BLOB di Azure, una scelta tipica per raccogliere informazioni di eventi per l'analisi successiva, in quanto include dati non strutturati.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-329">For this tutorial, you'll write the stream to Azure Blob Storage, which is a typical choice for collecting event information for later analysis, since it accommodates unstructured data .</span></span>

<span data-ttu-id="a1fa8-330">Se esiste già un account di archiviazione BLOB, è possibile usarlo.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-330">If you have an existing blob storage account, you can use that.</span></span> <span data-ttu-id="a1fa8-331">Per questa esercitazione verrà spiegato come creare un nuovo account di archiviazione solo in questo caso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-331">For this tutorial, we'll show you how to create a new storage account just for this tutorial.</span></span>

### <a name="create-an-azure-blob-storage-account"></a><span data-ttu-id="a1fa8-332">Creare un account Archiviazione BLOB di Azure</span><span class="sxs-lookup"><span data-stu-id="a1fa8-332">Create an Azure Blob Storage account</span></span>

1. <span data-ttu-id="a1fa8-333">Nel portale di Azure tornare al pannello del processo di Analisi di flusso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-333">In the Azure portal, return to the Streaming Analytics job blade.</span></span> <span data-ttu-id="a1fa8-334">Se il pannello è stato chiuso, cercare `sa_frauddetection_job_demo` nel pannello **Tutte le risorse**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-334">(If you closed the blade, search for `sa_frauddetection_job_demo` in the **All resources** blade.)</span></span>
2. <span data-ttu-id="a1fa8-335">Nella sezione **Topologia processo** fare clic sulla casella **Output**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-335">In the **Job Topology** section, click the **Output** box.</span></span> 
3. <span data-ttu-id="a1fa8-336">Nel pannello **Output** fare clic su **+&nbsp;Aggiungi** e quindi compilare il pannello con questi valori:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-336">In the **Outputs** blade, click **+&nbsp;Add** and then fill out the blade with these values:</span></span>

    * <span data-ttu-id="a1fa8-337">**Alias di output**: usare il nome `CallStream-FraudulentCalls`.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-337">**Output alias**: Use the name `CallStream-FraudulentCalls`.</span></span> 
    * <span data-ttu-id="a1fa8-338">**Sink**: selezionare **Archivio BLOB**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-338">**Sink**: Select **Blob storage**.</span></span>
    * <span data-ttu-id="a1fa8-339">**Opzioni di importazione**: selezionare **Usa l'archiviazione BLOB della sottoscrizione corrente**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-339">**Import options**: Select **Use blob storage from current subscription**.</span></span>
    * <span data-ttu-id="a1fa8-340">**Account di archiviazione**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-340">**Storage account**.</span></span> <span data-ttu-id="a1fa8-341">Selezionare **Crea un nuovo account di archiviazione**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-341">Select **Create new storage account.**</span></span>
    * <span data-ttu-id="a1fa8-342">**Account di archiviazione** (seconda casella).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-342">**Storage account** (second box).</span></span> <span data-ttu-id="a1fa8-343">Immettere `YOURNAMEsademo`, dove `YOURNAME` rappresenta il nome o un'altra stringa univoca.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-343">Enter `YOURNAMEsademo`, where `YOURNAME` is your name or another unique string.</span></span> <span data-ttu-id="a1fa8-344">Il nome può contenere solo lettere minuscole e numeri e deve essere univoco in Azure.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-344">The name can use only lowercase letters and numbers, and it must be unique across Azure.</span></span> 
    * <span data-ttu-id="a1fa8-345">**Contenitore**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-345">**Container**.</span></span> <span data-ttu-id="a1fa8-346">Immettere `sa-fraudulentcalls-demo`.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-346">Enter `sa-fraudulentcalls-demo`.</span></span>
    <span data-ttu-id="a1fa8-347">Il nome dell'account di archiviazione e il nome del contenitore vengono usati insieme per fornire un URI per l'archiviazione BLOB, in modo simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-347">The storage account name and container name are used together to provide a URI for the blob storage, like this:</span></span> 

    `http://yournamesademo.blob.core.windows.net/sa-fraudulentcalls-demo/...`
    
    ![Pannello "Nuovo output" per il processo di Analisi di flusso](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-output-blob-storage-new-console.png)
    
4. <span data-ttu-id="a1fa8-349">Fare clic su **Crea**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-349">Click **Create**.</span></span> 

    <span data-ttu-id="a1fa8-350">Azure crea l'account di archiviazione e genera automaticamente una chiave.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-350">Azure creates the storage account and generates a key automatically.</span></span> 

5. <span data-ttu-id="a1fa8-351">Chiudere il pannello **Output**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-351">Close the **Outputs** blade.</span></span> 

## <a name="start-the-streaming-analytics-job"></a><span data-ttu-id="a1fa8-352">Avviare il processo di Analisi di flusso</span><span class="sxs-lookup"><span data-stu-id="a1fa8-352">Start the Streaming Analytics job</span></span>

<span data-ttu-id="a1fa8-353">Ora il processo è configurato.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-353">The job is now configured.</span></span> <span data-ttu-id="a1fa8-354">Sono stati specificati un input (l'hub eventi), una trasformazione (la query per individuare le chiamate fraudolente) e un output (archiviazione BLOB).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-354">You've specified an input (the event hub), a transformation (the query to look for fraudulent calls), and an output (blob storage).</span></span> <span data-ttu-id="a1fa8-355">È ora possibile avviare il processo.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-355">You can now start the job.</span></span> 

1. <span data-ttu-id="a1fa8-356">Verificare che l'app TelcoGenerator sia in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-356">Make sure the TelcoGenerator app is running.</span></span>

2. <span data-ttu-id="a1fa8-357">Nel pannello del processo fare clic su **Avvia**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-357">In the job blade, click **Start**.</span></span>

    ![Avviare il processo di analisi di flusso](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-start-output.png)

3. <span data-ttu-id="a1fa8-359">Nel pannello **Avvia processo**, per Ora di inizio dell'output del processo, selezionare **Ora**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-359">In the **Start job** blade, for Job output start time, select **Now**.</span></span> 

4. <span data-ttu-id="a1fa8-360">Fare clic su **Avvia**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-360">Click **Start**.</span></span> 

    ![Pannello "Avvia processo" per il processo di Analisi di flusso](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-start-job-blade.png)

    <span data-ttu-id="a1fa8-362">Azure informa l'utente quando il processo viene avviato e, nel pannello del processo, lo stato viene visualizzato come **In esecuzione**.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-362">Azure notifies you when the job has started, and in the job blade, the status is displayed as **Running**.</span></span>

    ![Stato del processo di Analisi di flusso indicante "In esecuzione"](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-running-status.png)
    

## <a name="examine-the-transformed-data"></a><span data-ttu-id="a1fa8-364">Esaminare i dati trasformati</span><span class="sxs-lookup"><span data-stu-id="a1fa8-364">Examine the transformed data</span></span>

<span data-ttu-id="a1fa8-365">È stato creato un processo di Analisi di flusso completo.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-365">You now have a complete Streaming Analytics job.</span></span> <span data-ttu-id="a1fa8-366">Il processo esamina un flusso di metadati di chiamate telefoniche per individuare le chiamate fraudolente in tempo reale e scrivere informazioni su queste chiamate nell'archiviazione.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-366">The job is examining a stream of phone call metadata, looking for fraudulent phone calls in real time, and writing information about those fraudulent calls to storage.</span></span> 

<span data-ttu-id="a1fa8-367">Per completare questa esercitazione, è consigliabile osservare i dati acquisiti dal processo di Analisi di flusso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-367">To complete this tutorial, you might want to look at the data being captured by the Streaming Analytics job.</span></span> <span data-ttu-id="a1fa8-368">I dati vengono scritti in Archiviazione BLOB di Azure in blocchi (file).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-368">The data is being written to Azure Blog Storage in chunks (files).</span></span> <span data-ttu-id="a1fa8-369">È possibile usare qualsiasi strumento che legga Archiviazione BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-369">You can use any tool that reads Azure Blob Storage.</span></span> <span data-ttu-id="a1fa8-370">Come indicato nella sezione Prerequisiti, è possibile usare le estensioni di Azure in Visual Studio oppure uno strumento come [Azure Storage Explorer](http://storageexplorer.com/) o [Azure Explorer](http://www.cerebrata.com/products/azure-explorer/introduction).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-370">As noted in the Prerequisites section, you can use Azure extensions in Visual Studio, or you can use a tool like [Azure Storage Explorer](http://storageexplorer.com/) or [Azure Explorer](http://www.cerebrata.com/products/azure-explorer/introduction).</span></span> 

<span data-ttu-id="a1fa8-371">Quando si esamina il contenuto di un file nell'archiviazione BLOB, viene visualizzato quanto segue:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-371">When you examine the contents of a file in blob storage, you see something like the following :</span></span>

![Archiviazione BLOB di Azure con output di Analisi di flusso](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-blob-storage-view.png)
 

## <a name="clean-up-resources"></a><span data-ttu-id="a1fa8-373">Pulire le risorse</span><span class="sxs-lookup"><span data-stu-id="a1fa8-373">Clean up resources</span></span>

<span data-ttu-id="a1fa8-374">Sono disponibili altri articoli che approfondiscono lo scenario di rilevamento di frodi e usano le risorse create in questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-374">We have additional articles that continue with the fraud-detection scenario and that use the resources that you've created in this tutorial.</span></span> <span data-ttu-id="a1fa8-375">Per procedere, vedere i suggerimenti in **Passaggi successivi** più avanti.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-375">If you want to continue, see the suggestions under **Next steps** later.</span></span>

<span data-ttu-id="a1fa8-376">Se tuttavia non si desidera proseguire e le risorse create non sono necessarie, è possibile eliminarle per non incorrere in inutili addebiti da parte di Azure.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-376">However, if you're done and you don't need the resources you've created, you can delete them so that you don't incur unnecessary Azure charges.</span></span> <span data-ttu-id="a1fa8-377">In tal caso, è consigliabile procedere nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-377">In that case, we suggest that you do the following:</span></span>

1. <span data-ttu-id="a1fa8-378">Arrestare il processo di Analisi di flusso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-378">Stop the Streaming Analytics job.</span></span> <span data-ttu-id="a1fa8-379">Nel pannello **Processi** fare clic su **Arresta** nella parte superiore.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-379">In the **Jobs** blade, click **Stop** at the top.</span></span>
2. <span data-ttu-id="a1fa8-380">Arrestare l'app TelcoGenerator.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-380">Stop the Telco Generator app.</span></span> <span data-ttu-id="a1fa8-381">Nella finestra di comando in cui è stato avviata l'applicazione premere CTRL+C.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-381">In the command window where you started the app, press Ctrl+C.</span></span>
3. <span data-ttu-id="a1fa8-382">Se è stato creato un nuovo account di archiviazione BLOB solo per questa esercitazione, eliminarlo.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-382">If you created a new blob storage account just for this tutorial, delete it.</span></span> 
4. <span data-ttu-id="a1fa8-383">Eliminare il processo di Analisi di flusso.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-383">Delete the Streaming Analytics job.</span></span>
5. <span data-ttu-id="a1fa8-384">Eliminare l'hub eventi.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-384">Delete the event hub.</span></span>
6. <span data-ttu-id="a1fa8-385">Eliminare lo spazio dei nomi dell'hub eventi.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-385">Delete the event hub namespace.</span></span>

## <a name="get-support"></a><span data-ttu-id="a1fa8-386">Supporto</span><span class="sxs-lookup"><span data-stu-id="a1fa8-386">Get support</span></span>

<span data-ttu-id="a1fa8-387">Per ulteriore assistenza, provare il [Forum di Analisi dei flussi di Azure](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-387">For further assistance, try our [Azure Stream Analytics forum](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics).</span></span>

## <a name="next-steps"></a><span data-ttu-id="a1fa8-388">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="a1fa8-388">Next steps</span></span>

<span data-ttu-id="a1fa8-389">È possibile continuare questa esercitazione con gli articoli seguenti:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-389">You can continue this tutorial with the following articles:</span></span>

* <span data-ttu-id="a1fa8-390">[Analisi di flusso e Power BI: dashboard di analisi in tempo reale per lo streaming dei dati](stream-analytics-power-bi-dashboard.md).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-390">[Stream Analytics and Power BI: A real-time analytics dashboard for streaming data](stream-analytics-power-bi-dashboard.md).</span></span> <span data-ttu-id="a1fa8-391">Questo articolo illustra come inviare l'output di telecomunicazioni del processo di Analisi di flusso a Power BI per l'analisi e la visualizzazione in tempo reale.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-391">This article shows you how to send the TelCo output of the Stream Analytics job to Power BI for real-time visualization and analysis.</span></span>
* <span data-ttu-id="a1fa8-392">[Come archiviare i dati dall'analisi di flusso di Azure nella Cache Redis di Azure utilizzando le funzioni di Azure](stream-analytics-functions-redis.md).</span><span class="sxs-lookup"><span data-stu-id="a1fa8-392">[How to store data from Azure Stream Analytics in an Azure Redis Cache using Azure Functions](stream-analytics-functions-redis.md).</span></span> <span data-ttu-id="a1fa8-393">Questo articolo illustra come usare le funzioni di Azure per scrivere chiamate fraudolente in una cache Redis di Azure tramite una coda del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="a1fa8-393">This article shows how to use Azure Functions to write fraudulent calls to an Azure Redis cache via a Service Bus queue.</span></span>

<span data-ttu-id="a1fa8-394">Per altre informazioni generiche su Analisi di flusso, provare questi articoli:</span><span class="sxs-lookup"><span data-stu-id="a1fa8-394">For more information about Stream Analytics in general, try these articles:</span></span>

* [<span data-ttu-id="a1fa8-395">Introduzione ad Analisi dei flussi di Azure</span><span class="sxs-lookup"><span data-stu-id="a1fa8-395">Introduction to Azure Stream Analytics</span></span>](stream-analytics-introduction.md)
* [<span data-ttu-id="a1fa8-396">Ridimensionare i processi di Analisi dei flussi di Azure</span><span class="sxs-lookup"><span data-stu-id="a1fa8-396">Scale Azure Stream Analytics jobs</span></span>](stream-analytics-scale-jobs.md)
* [<span data-ttu-id="a1fa8-397">Informazioni di riferimento sul linguaggio di query di Analisi dei flussi di Azure</span><span class="sxs-lookup"><span data-stu-id="a1fa8-397">Azure Stream Analytics Query Language Reference</span></span>](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [<span data-ttu-id="a1fa8-398">Informazioni di riferimento sulle API REST di gestione di Analisi di flusso di Azure</span><span class="sxs-lookup"><span data-stu-id="a1fa8-398">Azure Stream Analytics Management REST API Reference</span></span>](https://msdn.microsoft.com/library/azure/dn835031.aspx)
