---
title: aaaGuidelines per la distribuzione di Windows Server Active Directory in macchine virtuali di Azure | Documenti Microsoft
description: "Se è noto come servizi di dominio Active Directory toodeploy e Active Directory Federation Services in locale, ottengono le informazioni sul relativo funzionamento in macchine virtuali di Azure."
services: active-directory
documentationcenter: 
author: femila
manager: femila
editor: 
ms.assetid: 04df4c46-e6b6-4754-960a-57b823d617fa
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 07/26/2017
ms.author: femila
ms.openlocfilehash: 9ad5a5f138a6402cbb656d9160545846051207b6
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="guidelines-for-deploying-windows-server-active-directory-on-azure-virtual-machines"></a><span data-ttu-id="d6422-103">Linee guida per la distribuzione di Active Directory di Windows Server nelle macchine virtuali di Azure</span><span class="sxs-lookup"><span data-stu-id="d6422-103">Guidelines for deploying Windows Server Active Directory on Azure virtual machines</span></span>
<span data-ttu-id="d6422-104">Questo articolo illustra le differenze importanti hello tra Active Directory Federation Services (ADFS) locale e la distribuzione in macchine virtuali di Microsoft Azure e di distribuzione Windows Server Active Directory Domain Services (AD DS).</span><span class="sxs-lookup"><span data-stu-id="d6422-104">This article explains hello important differences between deploying Windows Server Active Directory Domain Services (AD DS) and Active Directory Federation Services (AD FS) on-premises versus deploying them on Microsoft Azure virtual machines.</span></span>

## <a name="scope-and-audience"></a><span data-ttu-id="d6422-105">Ambito e destinatari</span><span class="sxs-lookup"><span data-stu-id="d6422-105">Scope and audience</span></span>
<span data-ttu-id="d6422-106">articolo Hello è destinato a utenti già esperti la distribuzione di Active Directory locale.</span><span class="sxs-lookup"><span data-stu-id="d6422-106">hello article is intended for those already experienced with deploying Active Directory on-premises.</span></span> <span data-ttu-id="d6422-107">Vengono illustrate le differenze di hello tra la distribuzione di Active Directory in Microsoft Azure le macchine virtuali/reti virtuali e le distribuzioni di Active Directory locale tradizionale.</span><span class="sxs-lookup"><span data-stu-id="d6422-107">It covers hello differences between deploying Active Directory on Microsoft Azure virtual machines/Azure virtual networks and traditional on-premises Active Directory deployments.</span></span> <span data-ttu-id="d6422-108">Macchine virtuali di Azure e reti virtuali di Azure fanno parte di un'infrastruttura-as-a-Service (IaaS) offre alle organizzazioni tooleverage le risorse nel cloud hello di elaborazione.</span><span class="sxs-lookup"><span data-stu-id="d6422-108">Azure virtual machines and Azure virtual networks are part of an Infrastructure-as-a-Service (IaaS) offering for organizations tooleverage computing resources in hello cloud.</span></span>

<span data-ttu-id="d6422-109">Per quelle che non si ha familiarità con la distribuzione di Active Directory, vedere hello [Guida alla distribuzione di Active Directory](https://technet.microsoft.com/library/cc753963) o [pianificare la distribuzione di ADFS](https://technet.microsoft.com/library/dn151324.aspx) come appropriato.</span><span class="sxs-lookup"><span data-stu-id="d6422-109">For those that are not familiar with AD deployment, see hello [AD DS Deployment Guide](https://technet.microsoft.com/library/cc753963) or [Plan your AD FS deployment](https://technet.microsoft.com/library/dn151324.aspx) as appropriate.</span></span>

<span data-ttu-id="d6422-110">In questo articolo presuppone che hello familiarità con hello seguenti concetti:</span><span class="sxs-lookup"><span data-stu-id="d6422-110">This article assumes that hello reader is familiar with hello following concepts:</span></span>

* <span data-ttu-id="d6422-111">Distribuzione e gestione di Servizi di dominio Active Directory di Windows Server</span><span class="sxs-lookup"><span data-stu-id="d6422-111">Windows Server AD DS deployment and management</span></span>
* <span data-ttu-id="d6422-112">Distribuzione e la configurazione dell'infrastruttura toosupport un dominio Active Directory di Windows Server Active Directory di DNS</span><span class="sxs-lookup"><span data-stu-id="d6422-112">Deployment and configuration of DNS toosupport a Windows Server AD DS infrastructure</span></span>
* <span data-ttu-id="d6422-113">Distribuzione e gestione di AD FS di Windows Server</span><span class="sxs-lookup"><span data-stu-id="d6422-113">Windows Server AD FS deployment and management</span></span>
* <span data-ttu-id="d6422-114">Distribuzione, configurazione e gestione di applicazioni relying party, ovvero siti e servizi Web, che possono utilizzare token di AD FS di Windows Server</span><span class="sxs-lookup"><span data-stu-id="d6422-114">Deploying, configuring, and managing relying party applications (websites and web services) that can consume Windows Server AD FS tokens</span></span>
* <span data-ttu-id="d6422-115">Concetti generali macchina virtuale, ad esempio come tooconfigure a virtual machine, virtuali, dischi e le reti virtuali</span><span class="sxs-lookup"><span data-stu-id="d6422-115">General virtual machine concepts, such as how tooconfigure a virtual machine, virtual disks, and virtual networks</span></span>

<span data-ttu-id="d6422-116">In questo articolo vengono illustrati requisiti di hello per uno scenario di distribuzione ibrido in cui servizi di dominio di Windows Server Active Directory o AD ADFS vengono distribuiti in parte in locale e in parte in macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-116">This article highlights hello requirements for a hybrid deployment scenario in which Windows Server AD DS or AD FS are partly deployed on-premises and partly deployed on Azure virtual machines.</span></span> <span data-ttu-id="d6422-117">documento Hello innanzitutto descrive le differenze critiche hello tra l'esecuzione di Windows Server di dominio Active Directory e ADFS in macchine virtuali di Azure e locali e aspetti importanti che influiscono sulla progettazione e distribuzione.</span><span class="sxs-lookup"><span data-stu-id="d6422-117">hello document first covers hello critical differences between running Windows Server AD DS and AD FS on Azure virtual machines versus on-premises, and important decision points that affect design and deployment.</span></span> <span data-ttu-id="d6422-118">rest Hello di carta hello illustra le linee guida per ognuno dei punti di decisione hello in modo più dettagliato e come tooapply hello scenari di distribuzione di linee guida toovarious.</span><span class="sxs-lookup"><span data-stu-id="d6422-118">hello rest of hello paper explains guidelines for each of hello decision points in more detail, and how tooapply hello guidelines toovarious deployment scenarios.</span></span>

<span data-ttu-id="d6422-119">In questo articolo non descrive la configurazione hello di [Azure Active Directory](http://azure.microsoft.com/services/active-directory/), che è un servizio basato su REST che fornisce funzionalità di controllo di accesso e gestione di identità per le applicazioni cloud.</span><span class="sxs-lookup"><span data-stu-id="d6422-119">This article does not discuss hello configuration of [Azure Active Directory](http://azure.microsoft.com/services/active-directory/), which is a REST-based service that provides identity management and access control capabilities for cloud applications.</span></span> <span data-ttu-id="d6422-120">Azure Active Directory (Azure AD) e Windows Server Active Directory sono, tuttavia, tooprovide insieme toowork progettato una soluzione di gestione delle identità e accessi per IT ibridi attuali le moderne applicazioni e gli ambienti.</span><span class="sxs-lookup"><span data-stu-id="d6422-120">Azure Active Directory (Azure AD) and Windows Server AD DS are, however, designed toowork together tooprovide an identity and access management solution for today’s hybrid IT environments and modern applications.</span></span> <span data-ttu-id="d6422-121">toohelp comprendere le differenze di hello e le relazioni tra servizi di dominio di Windows Server Active Directory e Azure AD, si consideri il seguente hello:</span><span class="sxs-lookup"><span data-stu-id="d6422-121">toohelp understand hello differences and relationships between Windows Server AD DS and Azure AD, consider hello following:</span></span>

1. <span data-ttu-id="d6422-122">È possibile eseguire servizi di dominio di Windows Server Active Directory nel cloud hello in macchine virtuali di Azure quando si utilizza Azure tooextend Data Center locale nel cloud hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-122">You might run Windows Server AD DS in hello cloud on Azure virtual machines when you are using Azure tooextend your on-premises datacenter into hello cloud.</span></span>
2. <span data-ttu-id="d6422-123">È possibile utilizzare Azure AD toogive applicazioni single sign-on tooSoftware-as-a-Service (SaaS) agli utenti.</span><span class="sxs-lookup"><span data-stu-id="d6422-123">You might use Azure AD toogive your users single sign-on tooSoftware-as-a-Service (SaaS) applications.</span></span> <span data-ttu-id="d6422-124">Questa tecnologia viene usata ad esempio in Microsoft Office 365, nonché in applicazioni eseguite in Azure o in altre piattaforme cloud.</span><span class="sxs-lookup"><span data-stu-id="d6422-124">Microsoft Office 365 uses this technology, for example, and applications running on Azure or other cloud platforms can also use it.</span></span>
3. <span data-ttu-id="d6422-125">È possibile utilizzare Azure AD (il servizio di controllo di accesso) toolet agli utenti di accesso mediante identità di Facebook, Google, Microsoft e altri tooapplications di provider di identità che sono ospitati in locale o cloud hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-125">You might use Azure AD (its Access Control Service) toolet users sign in using identities from Facebook, Google, Microsoft, and other identity providers tooapplications that are hosted in hello cloud or on-premises.</span></span>

<span data-ttu-id="d6422-126">Per altre informazioni su queste differenze, vedere [Nozioni fondamentali sulla gestione delle identità di Azure](fundamentals-identity.md).</span><span class="sxs-lookup"><span data-stu-id="d6422-126">For more information about these differences, see [Azure Identity](fundamentals-identity.md).</span></span>

## <a name="related-resources"></a><span data-ttu-id="d6422-127">Risorse correlate</span><span class="sxs-lookup"><span data-stu-id="d6422-127">Related resources</span></span>
<span data-ttu-id="d6422-128">È possibile scaricare ed eseguire hello [valutazione della macchina virtuale Azure](https://www.microsoft.com/download/details.aspx?id=40898).</span><span class="sxs-lookup"><span data-stu-id="d6422-128">You may download and run hello [Azure Virtual Machine Readiness Assessment](https://www.microsoft.com/download/details.aspx?id=40898).</span></span> <span data-ttu-id="d6422-129">Hello valutazione verrà automaticamente controllare l'ambiente locale e genera un report personalizzato basato su hello materiale sussidiario, vedere toohelp in questo argomento si esegue la migrazione tooAzure ambiente hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-129">hello assessment will automatically inspect your on-premises environment and generate a customized report based on hello guidance found in this topic toohelp you migrate hello environment tooAzure.</span></span>

<span data-ttu-id="d6422-130">È consigliabile esaminare innanzitutto hello esercitazioni, guide e video relativi hello seguenti argomenti:</span><span class="sxs-lookup"><span data-stu-id="d6422-130">We recommend that you also first review hello tutorials, guides, and videos that cover hello following topics:</span></span>

* [<span data-ttu-id="d6422-131">Configurare una rete virtuale nel portale di Azure hello</span><span class="sxs-lookup"><span data-stu-id="d6422-131">Configure a Cloud-Only Virtual Network in hello Azure Portal</span></span>](../virtual-network/virtual-networks-create-vnet-arm-pportal.md)
* [<span data-ttu-id="d6422-132">Configurare una VPN Site-to-Site nel portale di Azure hello</span><span class="sxs-lookup"><span data-stu-id="d6422-132">Configure a Site-to-Site VPN in hello Azure Portal</span></span>](../vpn-gateway/vpn-gateway-site-to-site-create.md)
* [<span data-ttu-id="d6422-133">Installazione di una nuova foresta Active Directory in una rete virtuale di Azure</span><span class="sxs-lookup"><span data-stu-id="d6422-133">Install a new Active Directory forest on an Azure virtual network</span></span>](active-directory-new-forest-virtual-machine.md)
* [<span data-ttu-id="d6422-134">Installare un controller di dominio Active Directory di replica in una rete virtuale di Azure</span><span class="sxs-lookup"><span data-stu-id="d6422-134">Install a replica Active Directory domain controller on Azure</span></span>](active-directory-install-replica-active-directory-domain-controller.md)
* [<span data-ttu-id="d6422-135">Microsoft Azure IaaS per professionisti IT: (01) Dati fondamentali delle macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="d6422-135">Microsoft Azure IT Pro IaaS: (01) Virtual Machine Fundamentals</span></span>](https://channel9.msdn.com/Series/Windows-Azure-IT-Pro-IaaS/01)
* [<span data-ttu-id="d6422-136">Microsoft Azure IaaS per professionisti IT: (05) Creazione di reti virtuali e connettività cross-premise</span><span class="sxs-lookup"><span data-stu-id="d6422-136">Microsoft Azure IT Pro IaaS: (05) Creating Virtual Networks and Cross-Premises Connectivity</span></span>](https://channel9.msdn.com/Series/Windows-Azure-IT-Pro-IaaS/05)

## <a name="introduction"></a><span data-ttu-id="d6422-137">Introduzione</span><span class="sxs-lookup"><span data-stu-id="d6422-137">Introduction</span></span>
<span data-ttu-id="d6422-138">Hello i requisiti essenziali per la distribuzione di Windows Server Active Directory in macchine virtuali di Azure esistono differenze minime dalla distribuzione di macchine virtuali locali (e toosome misura, macchine fisiche).</span><span class="sxs-lookup"><span data-stu-id="d6422-138">hello fundamental requirements for deploying Windows Server Active Directory on Azure virtual machines differ very little from deploying it in on-premises virtual machines (and, toosome extent, physical machines).</span></span> <span data-ttu-id="d6422-139">Ad esempio, in hello case directory di Windows Server Active Directory, se i controller di dominio di hello (DC) distribuiti nelle macchine virtuali di Azure sono repliche in un oggetto esistente locale dominio/foresta aziendale e quindi hello distribuzione di Azure può essere sostanzialmente gestita in hello esattamente come si può gestire qualsiasi altro sito Active Directory di Windows Server aggiuntivo.</span><span class="sxs-lookup"><span data-stu-id="d6422-139">For example, in hello case of Windows Server AD DS, if hello domain controllers (DCs) that you deploy on Azure virtual machines are replicas in an existing on-premises corporate domain/forest, then hello Azure deployment can largely be treated in hello same way as you might treat any other additional Windows Server Active Directory site.</span></span> <span data-ttu-id="d6422-140">Vale a dire subnet devono essere definite in Windows Server Active Directory, un sito creato, subnet hello toothat sito collegato e connesso tooother siti con collegamenti di sito appropriati.</span><span class="sxs-lookup"><span data-stu-id="d6422-140">That is, subnets must be defined in Windows Server AD DS, a site created, hello subnets linked toothat site, and connected tooother sites using appropriate site-links.</span></span> <span data-ttu-id="d6422-141">Vi sono, tuttavia, alcune differenze che sono comuni tooall Azure distribuzioni e altre che variano in base toohello specifico scenario di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="d6422-141">There are, however, some differences that are common tooall Azure deployments and some that vary according toohello specific deployment scenario.</span></span> <span data-ttu-id="d6422-142">Di seguito sono descritte due differenze fondamentali:</span><span class="sxs-lookup"><span data-stu-id="d6422-142">Two fundamental differences are outlined below:</span></span>

### <a name="azure-virtual-machines-may-need-connectivity-toohello-on-premises-corporate-network"></a><span data-ttu-id="d6422-143">Macchine virtuali di Azure potrebbe essere necessario rete aziendale locale toohello di connettività.</span><span class="sxs-lookup"><span data-stu-id="d6422-143">Azure virtual machines may need connectivity toohello on-premises corporate network.</span></span>
<span data-ttu-id="d6422-144">La connessione delle macchine virtuali di Azure tooan indietro locale alla rete aziendale richiede la rete virtuale di Azure, che include un sito a sito o rete privata virtuale (VPN) site-to-point tooseamlessly di componente in grado di connettersi a macchine virtuali di Azure e computer locale.</span><span class="sxs-lookup"><span data-stu-id="d6422-144">Connecting Azure virtual machines back tooan on-premises corporate network requires Azure virtual network, which includes a site-to-site or site-to-point virtual private network (VPN) component able tooseamlessly connect Azure virtual machines and on-premises machines.</span></span> <span data-ttu-id="d6422-145">Questo componente VPN è stato possibile abilitare anche membro di dominio locale, tooaccess computer un dominio di Active Directory di Windows Server i cui controller di dominio sono ospitati esclusivamente in macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-145">This VPN component could also enable on-premises domain member computers tooaccess a Windows Server Active Directory domain whose domain controllers are hosted exclusively on Azure virtual machines.</span></span> <span data-ttu-id="d6422-146">È importante toonote, tuttavia, se hello VPN non riesce, l'autenticazione e altre operazioni che dipendono da Windows Server Active Directory avrà inoltre esito negativo.</span><span class="sxs-lookup"><span data-stu-id="d6422-146">It is important toonote, though, that if hello VPN fails, authentication and other operations that depend on Windows Server Active Directory will also fail.</span></span> <span data-ttu-id="d6422-147">Mentre gli utenti potrebbero essere in grado di toosign utilizzando le credenziali memorizzate nella cache esistente, tutti i peer-to-peer o tentativi di autenticazione client-server per cui i ticket hanno ancora toobe emessi o risultano non aggiornati avranno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="d6422-147">While users may be able toosign in using existing cached credentials, all peer-to-peer or client-to-server authentication attempts for which tickets have yet toobe issued or have become stale will fail.</span></span>

<span data-ttu-id="d6422-148">Vedere [rete virtuale](http://azure.microsoft.com/documentation/services/virtual-network/) per un video dimostrativo e un elenco di esercitazioni dettagliate, tra cui [configurare una VPN Site-to-Site nel portale di Azure hello](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="d6422-148">See [Virtual Network](http://azure.microsoft.com/documentation/services/virtual-network/) for a demonstration video and a list of step-by-step tutorials, including [Configure a Site-to-Site VPN in hello Azure portal](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>

> [!NOTE]
> <span data-ttu-id="d6422-149">È anche possibile distribuire Active Directory di Windows Server in una rete virtuale di Azure senza connettività a una rete locale.</span><span class="sxs-lookup"><span data-stu-id="d6422-149">You can also deploy Windows Server Active Directory on an Azure virtual network that does not have connectivity with an on-premises network.</span></span> <span data-ttu-id="d6422-150">Hello in questo argomento, tuttavia, si presuppone che una rete virtuale di Azure viene utilizzata in quanto fornisce funzionalità che sono essenziali tooWindows Server di indirizzamento IP.</span><span class="sxs-lookup"><span data-stu-id="d6422-150">hello guidelines in this topic, however, assume that an Azure virtual network is used because it provides IP addressing capabilities that are essential tooWindows Server.</span></span>
> 
> 

### <a name="static-ip-addresses-must-be-configured-with-azure-powershell"></a><span data-ttu-id="d6422-151">Gli indirizzi IP statici devono essere configurati con Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="d6422-151">Static IP addresses must be configured with Azure PowerShell.</span></span>
<span data-ttu-id="d6422-152">Gli indirizzi dinamici vengono allocati per impostazione predefinita, ma utilizzano invece tooassign di cmdlet Set-AzureStaticVNetIP hello un indirizzo IP statico.</span><span class="sxs-lookup"><span data-stu-id="d6422-152">Dynamic addresses are allocated by default, but use hello Set-AzureStaticVNetIP cmdlet tooassign a static IP address instead.</span></span> <span data-ttu-id="d6422-153">L'indirizzo IP statico impostato sarà mantenuto durante la correzione del servizio e l'arresto o il riavvio della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="d6422-153">That sets a static IP address that will persist through service healing and VM shutdown/restart.</span></span> <span data-ttu-id="d6422-154">Per altre informazioni, vedere il blog relativo all' [indirizzo IP interno statico per le macchine virtuali](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="d6422-154">For more information, see [Static internal IP address for virtual machines](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/).</span></span>

## <span data-ttu-id="d6422-155"><a name="BKMK_Glossary"></a>Termini e definizioni</span><span class="sxs-lookup"><span data-stu-id="d6422-155"><a name="BKMK_Glossary"></a>Terms and definitions</span></span>
<span data-ttu-id="d6422-156">di seguito Hello è un elenco non esaustivo di termini per varie tecnologie di Azure che verranno fatto riferimento in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="d6422-156">hello following is a non-exhaustive list of terms for various Azure technologies which will be referenced in this article.</span></span>

* <span data-ttu-id="d6422-157">**Macchine virtuali di Azure**: offerta IaaS hello in Azure che consente ai clienti toodeploy macchine virtuali che eseguono praticamente qualsiasi tradizionalmente locale carico di lavoro server.</span><span class="sxs-lookup"><span data-stu-id="d6422-157">**Azure virtual machines**: hello IaaS offering in Azure that allows customers toodeploy VMs running nearly any traditionally on-premises server workload.</span></span>
* <span data-ttu-id="d6422-158">**Rete virtuale di Azure**: hello tootheir un servizio in Azure che consente ai clienti di creare e gestire reti virtuali in Azure e collegarle in modo sicuro di rete su infrastruttura di rete locale tramite una rete privata virtuale (VPN).</span><span class="sxs-lookup"><span data-stu-id="d6422-158">**Azure virtual network**: hello networking service in Azure that lets customers create and manage virtual networks in Azure and securely link them tootheir own on-premises networking infrastructure by using a virtual private network (VPN).</span></span>
* <span data-ttu-id="d6422-159">**Indirizzo IP virtuale**: indirizzo di un indirizzo IP con connessione internet che è non è associato tooa specifico computer o alla rete scheda di interfaccia.</span><span class="sxs-lookup"><span data-stu-id="d6422-159">**Virtual IP address**: An internet-facing IP address that is not bound tooa specific computer or network interface card.</span></span> <span data-ttu-id="d6422-160">Servizi cloud viene assegnato un indirizzo IP virtuale per ricevere il traffico di rete che viene reindirizzato tooan macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-160">Cloud services are assigned a virtual IP address for receiving network traffic which is redirected tooan Azure VM.</span></span> <span data-ttu-id="d6422-161">Un indirizzo IP virtuale è una proprietà di un servizio cloud che può contenere una o più macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="d6422-161">A virtual IP address is a property of a cloud-service which can contain one or more Azure virtual machines.</span></span> <span data-ttu-id="d6422-162">Una rete virtuale di Azure può anche contenere uno o più servizi cloud.</span><span class="sxs-lookup"><span data-stu-id="d6422-162">Also note that an Azure virtual network can contain one or more cloud-services.</span></span> <span data-ttu-id="d6422-163">Gli indirizzi IP virtuali forniscono funzionalità native di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="d6422-163">Virtual IP addresses provide native load-balancing capabilities.</span></span>
* <span data-ttu-id="d6422-164">**Indirizzo IP dinamico**: indirizzo IP hello è solo interno.</span><span class="sxs-lookup"><span data-stu-id="d6422-164">**Dynamic IP address**: This is hello IP address that is internal only.</span></span> <span data-ttu-id="d6422-165">Si deve essere configurato come un indirizzo IP statico (usando il cmdlet Set-AzureStaticVNetIP hello) per le macchine virtuali che ospitano i ruoli del server controller di dominio/DNS hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-165">It should be configured as a static IP address (by using hello Set-AzureStaticVNetIP cmdlet) for VMs that host hello DC/DNS server roles.</span></span>
* <span data-ttu-id="d6422-166">**La correzione del servizio**: hello processo in cui Azure restituisce automaticamente tooa un servizio in esecuzione è stato nuovamente dopo rileva che il servizio hello non è riuscito.</span><span class="sxs-lookup"><span data-stu-id="d6422-166">**Service healing**: hello process in which Azure automatically returns a service tooa running state again after it detects that hello service has failed.</span></span> <span data-ttu-id="d6422-167">Correzione del servizio è uno degli aspetti di hello di Azure che supporta la disponibilità e resilienza.</span><span class="sxs-lookup"><span data-stu-id="d6422-167">Service healing is one of hello aspects of Azure that supports availability and resiliency.</span></span> <span data-ttu-id="d6422-168">Sebbene poco probabile, risultato hello in un servizio intervento di correzione per un controller di dominio in esecuzione in una macchina virtuale è il riavvio non pianificato di tooan simile, ma con pochi effetti collaterali:</span><span class="sxs-lookup"><span data-stu-id="d6422-168">While unlikely, hello result following a service healing incident for a DC running on a VM is similar tooan unplanned reboot, but has a few side-effects:</span></span>
  
  * <span data-ttu-id="d6422-169">scheda di rete virtuale Hello in hello VM verrà modificato</span><span class="sxs-lookup"><span data-stu-id="d6422-169">hello virtual network adapter in hello VM will change</span></span>
  * <span data-ttu-id="d6422-170">indirizzo MAC della scheda di rete virtuale hello Hello verrà modificato</span><span class="sxs-lookup"><span data-stu-id="d6422-170">hello MAC address of hello virtual network adapter will change</span></span>
  * <span data-ttu-id="d6422-171">Hello ID CPU/processore di hello VM verrà modificato</span><span class="sxs-lookup"><span data-stu-id="d6422-171">hello Processor/CPU ID of hello VM will change</span></span>
  * <span data-ttu-id="d6422-172">Hello configurazione IP della scheda di rete virtuale hello non cambierà purché hello VM è la rete virtuale associata tooa e hello indirizzo IP della macchina virtuale è statico.</span><span class="sxs-lookup"><span data-stu-id="d6422-172">hello IP configuration of hello virtual network adapter will not change as long as hello VM is attached tooa virtual network and hello VM’s IP address is static.</span></span>
  
  <span data-ttu-id="d6422-173">Nessuno di questi comportamenti influisce sul Windows Server Active Directory poiché non dipende dall'ID CPU/processore o di indirizzo MAC hello e tutte le distribuzioni di Windows Server Active Directory in Azure sono consigliate toobe eseguire in una rete virtuale di Azure, come illustrato in precedenza .</span><span class="sxs-lookup"><span data-stu-id="d6422-173">None of these behaviors affect Windows Server Active Directory because it has no dependency on hello MAC address or Processor/CPU ID, and all Windows Server Active Directory deployments on Azure are recommended toobe run on an Azure virtual network as outlined above.</span></span>

## <a name="is-it-safe-toovirtualize-windows-server-active-directory-domain-controllers"></a><span data-ttu-id="d6422-174">È sicuro toovirtualize i controller di dominio Active Directory di Windows Server?</span><span class="sxs-lookup"><span data-stu-id="d6422-174">Is it safe toovirtualize Windows Server Active Directory domain controllers?</span></span>
<span data-ttu-id="d6422-175">La distribuzione di controller di dominio Windows Server Active Directory in macchine virtuali di Azure è soggetto toohello stesse linee guida per l'esecuzione di controller di dominio locale in una macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="d6422-175">Deploying Windows Server Active Directory DCs on Azure virtual machines is subject toohello same guidelines as running DCs on-premises in a virtual machine.</span></span> <span data-ttu-id="d6422-176">L'esecuzione di controller di dominio virtualizzati è una procedura sicura, a condizione di seguire le linee guida per il backup e il ripristino dei controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="d6422-176">Running virtualized DCs is a safe practice as long as guidelines for backing up and restoring DCs are followed.</span></span> <span data-ttu-id="d6422-177">Per altre informazioni su vincoli e linee guida per l'esecuzione di controller di dominio virtualizzati, vedere [Esecuzione di controller di dominio in Hyper-V](https://technet.microsoft.com/library/dd363553).</span><span class="sxs-lookup"><span data-stu-id="d6422-177">For more information about constraints and guidelines for running virtualized DCs, see [Running Domain Controllers in Hyper-V](https://technet.microsoft.com/library/dd363553).</span></span>

<span data-ttu-id="d6422-178">Gli hypervisor forniscono o considerano insignificanti tecnologie che possono causare problemi a molti sistemi distribuiti, tra cui Active Directory di Windows Server.</span><span class="sxs-lookup"><span data-stu-id="d6422-178">Hypervisors provide or trivialize technologies that can cause problems for many distributed systems, including Windows Server Active Directory.</span></span> <span data-ttu-id="d6422-179">Ad esempio, in un server fisico, è possibile clonare un disco o utilizzare lo stato di metodi non supportati tooroll hello indietro di un server, incluso l'utilizzo di reti SAN e così via, ma questa operazione in un server fisico è molto più difficile del ripristino di uno snapshot della macchina virtuale in un hypervisor.</span><span class="sxs-lookup"><span data-stu-id="d6422-179">For example, on a physical server, you can clone a disk or use unsupported methods tooroll back hello state of a server, including using SANs and so on, but doing that on a physical server is much harder than restoring a virtual machine snapshot in a hypervisor.</span></span> <span data-ttu-id="d6422-180">Azure offre funzionalità che possono comportare hello stessa condizione indesiderata.</span><span class="sxs-lookup"><span data-stu-id="d6422-180">Azure offers functionality that can result in hello same undesirable condition.</span></span> <span data-ttu-id="d6422-181">Ad esempio, si devono copiare file VHD di controller di dominio anziché eseguire backup regolari perché il loro ripristino può comportare una funzionalità di ripristino dello snapshot di toousing situazione simile.</span><span class="sxs-lookup"><span data-stu-id="d6422-181">For example, you should not copy VHD files of DCs instead of performing regular backups because restoring them can result in a similar situation toousing snapshot restore features.</span></span>

<span data-ttu-id="d6422-182">Tramite questi rollback vengono introducono bolle USN che possono comportare stati divergenti toopermanently tra i controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="d6422-182">Such rollbacks introduce USN bubbles that can lead toopermanently divergent states between DCs.</span></span> <span data-ttu-id="d6422-183">Questa condizione può comportare problemi come i seguenti:</span><span class="sxs-lookup"><span data-stu-id="d6422-183">That can cause issues such as:</span></span>

* <span data-ttu-id="d6422-184">Oggetti residui</span><span class="sxs-lookup"><span data-stu-id="d6422-184">Lingering objects</span></span>
* <span data-ttu-id="d6422-185">Password incoerenti</span><span class="sxs-lookup"><span data-stu-id="d6422-185">Inconsistent passwords</span></span>
* <span data-ttu-id="d6422-186">Valori di attributi incoerenti</span><span class="sxs-lookup"><span data-stu-id="d6422-186">Inconsistent attribute values</span></span>
* <span data-ttu-id="d6422-187">Mancata corrispondenza dello schema se viene eseguito il rollback di master schema hello</span><span class="sxs-lookup"><span data-stu-id="d6422-187">Schema mismatches if hello schema master is rolled back</span></span>

<span data-ttu-id="d6422-188">Per altre informazioni sull'impatto sui controller di dominio, vedere la sezione relativa a [USN e rollback di USN](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv.aspx#usn_and_usn_rollback).</span><span class="sxs-lookup"><span data-stu-id="d6422-188">For more information about how DCs are impacted, see [USN and USN Rollback](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv.aspx#usn_and_usn_rollback).</span></span>

<span data-ttu-id="d6422-189">A partire da Windows Server 2012, [misure di sicurezza aggiuntive vengono compilate nel dominio Active Directory tooAD](https://technet.microsoft.com/library/hh831734.aspx).</span><span class="sxs-lookup"><span data-stu-id="d6422-189">Beginning with Windows Server 2012, [additional safeguards are built in tooAD DS](https://technet.microsoft.com/library/hh831734.aspx).</span></span> <span data-ttu-id="d6422-190">Queste misure di sicurezza aiutano a proteggere i controller di dominio virtualizzati dai suddetti problemi hello, purché piattaforma hypervisor sottostante hello supporta VM-GenerationID.</span><span class="sxs-lookup"><span data-stu-id="d6422-190">These safeguards help protect virtualized domain controllers against hello aforementioned problems, as long as hello underlying hypervisor platform supports VM-GenerationID.</span></span> <span data-ttu-id="d6422-191">Azure supporta VM-GenerationID, ciò significa che i controller di dominio che eseguono Windows Server 2012 o macchine virtuali di Azure in un secondo momento misure di sicurezza aggiuntive di hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-191">Azure supports VM-GenerationID, which means that domain controllers that run Windows Server 2012 or later on Azure virtual machines have hello additional safeguards.</span></span>

> [!NOTE]
> <span data-ttu-id="d6422-192">È necessario arrestare e riavviare una macchina virtuale in esecuzione ruolo controller di dominio hello in Azure nel sistema operativo guest di hello anziché hello **Arresta** opzione hello Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="d6422-192">You should shut down and restart a VM that runs hello domain controller role in Azure within hello guest operating system instead of using hello **Shut Down** option in hello Azure porta.</span></span> <span data-ttu-id="d6422-193">Oggi, l'utilizzo di hello tooshut portale verso il basso di una macchina virtuale comporta hello VM toobe deallocato.</span><span class="sxs-lookup"><span data-stu-id="d6422-193">Today, using hello portal tooshut down a VM causes hello VM toobe deallocated.</span></span> <span data-ttu-id="d6422-194">Una macchina virtuale deallocata ha il vantaggio di hello di non incorrere in addebiti, ma reimposta anche hello VM-GenerationID, questo non è auspicabile per un controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="d6422-194">A deallocated VM has hello advantage of not incurring charges, but it also resets hello VM-GenerationID, which is undesirable for a DC.</span></span> <span data-ttu-id="d6422-195">Quando hello VM-GenerationID viene reimpostato, viene inoltre reimpostato hello invocationID del database di hello AD DS, hello pool di RID viene ignorato e SYSVOL è contrassegnato come non autorevole.</span><span class="sxs-lookup"><span data-stu-id="d6422-195">When hello VM-GenerationID is reset, hello invocationID of hello AD DS database is also reset, hello RID pool is discarded, and SYSVOL is marked as non-authoritative.</span></span> <span data-ttu-id="d6422-196">Per ulteriori informazioni, vedere [tooActive introduzione Directory Domain Services (AD DS) Virtualization](https://technet.microsoft.com/library/hh831734.aspx) e [virtualizzazione sicura di DFSR](http://blogs.technet.com/b/filecab/archive/2013/04/05/safely-virtualizing-dfsr.aspx).</span><span class="sxs-lookup"><span data-stu-id="d6422-196">For more information, see [Introduction tooActive Directory Domain Services (AD DS) Virtualization](https://technet.microsoft.com/library/hh831734.aspx) and [Safely Virtualizing DFSR](http://blogs.technet.com/b/filecab/archive/2013/04/05/safely-virtualizing-dfsr.aspx).</span></span>
> 
> 

## <a name="why-deploy-windows-server-ad-ds-on-azure-virtual-machines"></a><span data-ttu-id="d6422-197">Perché distribuire Servizi di dominio Active Directory di Windows Server in macchine virtuali di Azure</span><span class="sxs-lookup"><span data-stu-id="d6422-197">Why deploy Windows Server AD DS on Azure Virtual Machines?</span></span>
<span data-ttu-id="d6422-198">Molti scenari di distribuzione di Servizi di dominio Active Directory di Windows Server sono particolarmente adatti per la distribuzione come VM in Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-198">Many Windows Server AD DS deployment scenarios are well-suited for deployment as VMs on Azure.</span></span> <span data-ttu-id="d6422-199">Si supponga, ad esempio, che si dispone di una società in Europa in cui è necessario tooauthenticate utenti in una posizione remota in Asia.</span><span class="sxs-lookup"><span data-stu-id="d6422-199">For example, suppose you have a company in Europe that needs tooauthenticate users in a remote location in Asia.</span></span> <span data-ttu-id="d6422-200">Hello aziendale non è in precedenza distribuito Windows Server Active Directory i controller di dominio in Asia a causa dei costi toohello toodeploy e delle competenze limitate toomanage hello server post-distribuzione.</span><span class="sxs-lookup"><span data-stu-id="d6422-200">hello company has not previously deployed Windows Server Active Directory DCs in Asia due toohello cost toodeploy them and limited expertise toomanage hello servers post-deployment.</span></span> <span data-ttu-id="d6422-201">Di conseguenza, le richieste di autenticazione dall'Asia vengono gestite da controller di dominio in Europa con risultati non ottimali.</span><span class="sxs-lookup"><span data-stu-id="d6422-201">As a result, authentication requests from Asia are serviced by DCs in Europe with suboptimal results.</span></span> <span data-ttu-id="d6422-202">In questo caso, è possibile distribuire un controller di dominio in una macchina virtuale che è stato specificato deve essere eseguita all'interno di hello Data Center di Azure in Asia.</span><span class="sxs-lookup"><span data-stu-id="d6422-202">In this case, you can deploy a DC on a VM that you have specified must be run within hello Azure datacenter in Asia.</span></span> <span data-ttu-id="d6422-203">Connessione di rete virtuale di Azure connessa direttamente posizione remota toohello migliorerà le prestazioni di autenticazione di tooan di controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="d6422-203">Attaching that DC tooan Azure virtual network that is connected directly toohello remote location will improve authentication performance.</span></span>

<span data-ttu-id="d6422-204">Azure è inoltre ideale come siti di ripristino di emergenza un sostituto toootherwise emergenza costosi.</span><span class="sxs-lookup"><span data-stu-id="d6422-204">Azure is also well-suited as a substitute toootherwise costly disaster recovery (DR) sites.</span></span> <span data-ttu-id="d6422-205">Hello costo relativamente basso dell'hosting di un numero esiguo di controller di dominio e una singola rete virtuale in Azure rappresenta un'alternativa interessante.</span><span class="sxs-lookup"><span data-stu-id="d6422-205">hello relatively low-cost of hosting a small number of domain controllers and a single virtual network on Azure represents an attractive alternative.</span></span>

<span data-ttu-id="d6422-206">Infine, è opportuno toodeploy un'applicazione di rete in Azure, ad esempio SharePoint, che richiede Windows Server Active Directory, ma non ha dipendenze hello di rete o hello aziendali Windows Server Active Directory locale.</span><span class="sxs-lookup"><span data-stu-id="d6422-206">Finally, you may want toodeploy a network application on Azure, such as SharePoint, that requires Windows Server Active Directory but has no dependency on hello on-premises network or hello corporate Windows Server Active Directory.</span></span> <span data-ttu-id="d6422-207">In questo caso, la distribuzione di una foresta isolata in Azure toomeet hello SharePoint requisiti del server è ottimale.</span><span class="sxs-lookup"><span data-stu-id="d6422-207">In this case, deploying an isolated forest on Azure toomeet hello SharePoint server’s requirements is optimal.</span></span> <span data-ttu-id="d6422-208">Nuovamente, distribuzione di applicazioni di rete che richiedono la connettività toohello on-premise di rete e hello Active Directory aziendale è anche supportata.</span><span class="sxs-lookup"><span data-stu-id="d6422-208">Again, deploying network applications that do require connectivity toohello on-premises network and hello corporate Active Directory is also supported.</span></span>

> [!NOTE]
> <span data-ttu-id="d6422-209">Poiché viene fornita una connessione di livello 3, hello componente VPN che offre connettività tra una rete virtuale di Azure e una rete locale può anche abilitare server membri che eseguono locale tooleverage controller di dominio eseguiti come macchine virtuali di Azure in Azure rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="d6422-209">Since it provides a layer-3 connection, hello VPN component that provides connectivity between an Azure virtual network and an on-premises network can also enable member servers that run on-premises tooleverage DCs that run as Azure virtual machines on Azure virtual network.</span></span> <span data-ttu-id="d6422-210">Ma se hello VPN è disponibile, la comunicazione tra computer locali e i controller di dominio basati su Azure non funzioneranno, con l'autenticazione e vari altri errori.</span><span class="sxs-lookup"><span data-stu-id="d6422-210">But if hello VPN is unavailable, communication between on-premises computers and Azure-based domain controllers will not function, resulting in authentication and various other errors.</span></span>  
> 
> 

## <a name="contrasts-between-deploying-windows-server-active-directory-domain-controllers-on-azure-virtual-machines-versus-on-premises"></a><span data-ttu-id="d6422-211">Differenze tra la distribuzione di controller di dominio Active Directory di Windows Server in macchine virtuali di Azure e in locale</span><span class="sxs-lookup"><span data-stu-id="d6422-211">Contrasts between deploying Windows Server Active Directory domain controllers on Azure Virtual Machines versus on-premises</span></span>
* <span data-ttu-id="d6422-212">Per qualsiasi scenario di distribuzione di Windows Server Active Directory che include più di una singola macchina virtuale, è necessario toouse una rete virtuale di Azure per la coerenza di indirizzi IP.</span><span class="sxs-lookup"><span data-stu-id="d6422-212">For any Windows Server Active Directory deployment scenario that includes more than a single VM, it is necessary toouse an Azure virtual network for IP address consistency.</span></span> <span data-ttu-id="d6422-213">Questa guida presuppone che i controller di dominio siano eseguiti in una rete virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-213">Note that this guide assumes that DCs are running on an Azure virtual network.</span></span>
* <span data-ttu-id="d6422-214">Come per i controller di dominio locali, è consigliabile usare indirizzi IP statici.</span><span class="sxs-lookup"><span data-stu-id="d6422-214">As with on-premises DCs, static IP addresses are recommended.</span></span> <span data-ttu-id="d6422-215">Un indirizzo IP statico può essere configurato solo tramite Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="d6422-215">A static IP address can only be configured by using Azure PowerShell.</span></span> <span data-ttu-id="d6422-216">Per altre informazioni, vedere il blog relativo all' [indirizzo IP interno statico per le macchine virtuali](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/) .</span><span class="sxs-lookup"><span data-stu-id="d6422-216">See [Static internal IP address for VMs](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/) for more details.</span></span> <span data-ttu-id="d6422-217">Se si dispone di sistemi di monitoraggio o altre soluzioni che consentono di controllare per la configurazione degli indirizzi IP statici all'interno del sistema operativo guest di hello, è possibile assegnare hello stesso IP indirizzo toohello rete scheda delle proprietà statiche di hello macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="d6422-217">If you have monitoring systems or other solutions that check for static IP address configuration within hello guest operating system, you can assign hello same static IP address toohello network adapter properties of hello VM.</span></span> <span data-ttu-id="d6422-218">Tuttavia in considerazione che della scheda di rete hello verrà annullata hello VM viene sottoposta a correzione del servizio o se è stato arrestato nel portale di hello e relativo indirizzo viene deallocato.</span><span class="sxs-lookup"><span data-stu-id="d6422-218">But be aware that hello network adapter will be discarded if hello VM undergoes service healing or is shut down in hello portal and has its address deallocated.</span></span> <span data-ttu-id="d6422-219">In tal caso, indirizzo IP statico hello guest hello sarà necessario toobe reimpostare.</span><span class="sxs-lookup"><span data-stu-id="d6422-219">In that case, hello static IP address within hello guest will need toobe reset.</span></span>
* <span data-ttu-id="d6422-220">Distribuzione di macchine virtuali in una rete virtuale non implica (né richiede) rete locale di connettività tooan back; rete virtuale Hello consente semplicemente il possibilità.</span><span class="sxs-lookup"><span data-stu-id="d6422-220">Deploying VMs on a virtual network does not imply (or require) connectivity back tooan on-premises network; hello virtual network merely enables that possibility.</span></span> <span data-ttu-id="d6422-221">È necessario creare una rete virtuale per le comunicazioni private tra Azure e la rete locale.</span><span class="sxs-lookup"><span data-stu-id="d6422-221">You must create a virtual network for private communication between Azure and your on-premises network.</span></span> <span data-ttu-id="d6422-222">È necessario un endpoint VPN nella rete locale hello toodeploy.</span><span class="sxs-lookup"><span data-stu-id="d6422-222">You need toodeploy a VPN endpoint on hello on-premises network.</span></span> <span data-ttu-id="d6422-223">Hello VPN viene aperta dalla rete locale toohello Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-223">hello VPN is opened from Azure toohello on-premises network.</span></span> <span data-ttu-id="d6422-224">Per ulteriori informazioni, vedere [Panoramica di rete virtuale](../virtual-network/virtual-networks-overview.md) e [configurare una VPN Site-to-Site nel portale di Azure hello](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="d6422-224">For more information, see [Virtual Network Overview](../virtual-network/virtual-networks-overview.md) and [Configure a Site-to-Site VPN in hello Azure Portal](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>

> [!NOTE]
> <span data-ttu-id="d6422-225">Un'opzione troppo[creare una VPN point-to-site](../vpn-gateway/vpn-gateway-point-to-site-create.md) è disponibile tooconnect singoli computer basati su Windows direttamente tooan rete virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-225">An option too[create a point-to-site VPN](../vpn-gateway/vpn-gateway-point-to-site-create.md) is available tooconnect individual Windows-based computers directly tooan Azure virtual network.</span></span>
> 
> 

* <span data-ttu-id="d6422-226">Indipendentemente dal fatto che venga creata o meno una rete virtuale, Azure addebita il costo del traffico in uscita ma non di quello in entrata.</span><span class="sxs-lookup"><span data-stu-id="d6422-226">Regardless of whether you create a virtual network or not, Azure charges for egress traffic but not ingress.</span></span> <span data-ttu-id="d6422-227">Le diverse opzioni di progettazione di Active Directory di Windows Server possono influire sulla quantità di traffico in uscita generato da una distribuzione.</span><span class="sxs-lookup"><span data-stu-id="d6422-227">Various Windows Server Active Directory design choices can affect how much egress traffic is generated by a deployment.</span></span> <span data-ttu-id="d6422-228">Ad esempio, la distribuzione di un controller di dominio di sola lettura limita il traffico in uscita perché non viene replicato.</span><span class="sxs-lookup"><span data-stu-id="d6422-228">For example, deploying a read-only domain controller (RODC) limits egress traffic because it does not replicate outbound.</span></span> <span data-ttu-id="d6422-229">Ma decisione hello toodeploy RODC toobe soppesata tooperform necessità hello è necessario scrivere operazioni nel controller di dominio di hello e hello [compatibilità](https://technet.microsoft.com/library/cc755190) che applicazioni e servizi nel sito hello abbiano RODC.</span><span class="sxs-lookup"><span data-stu-id="d6422-229">But hello decision toodeploy an RODC needs toobe weighed against hello need tooperform write operations against hello DC and hello [compatibility](https://technet.microsoft.com/library/cc755190) that applications and services in hello site have with RODCs.</span></span> <span data-ttu-id="d6422-230">Per altre informazioni sugli addebiti per il traffico, vedere [Prezzi di Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="d6422-230">For more information about traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>
* <span data-ttu-id="d6422-231">Mentre il controllo completo sulla quale toouse risorse server per le macchine virtuali in locale, ad esempio RAM, dimensione del disco e così via, in Azure è necessario selezionare da un elenco di dimensioni server preconfigurate.</span><span class="sxs-lookup"><span data-stu-id="d6422-231">While you have complete control over what server resources toouse for VMs on-premises, such as RAM, disk size, and so on, on Azure you must select from a list of preconfigured server sizes.</span></span> <span data-ttu-id="d6422-232">Per un controller di dominio, è necessario un disco dati nel disco del sistema operativo toohello aggiunta nel database di Windows Server Active Directory hello toostore ordine.</span><span class="sxs-lookup"><span data-stu-id="d6422-232">For a DC, a data disk is needed in addition toohello operating system disk in order toostore hello Windows Server Active Directory database.</span></span>

## <a name="can-you-deploy-windows-server-ad-fs-on-azure-virtual-machines"></a><span data-ttu-id="d6422-233">Possibilità di distribuire AD FS di Windows Server in macchine virtuali di Azure</span><span class="sxs-lookup"><span data-stu-id="d6422-233">Can you deploy Windows Server AD FS on Azure virtual machines?</span></span>
<span data-ttu-id="d6422-234">Sì, è possibile distribuire ADFS di Windows Server in macchine virtuali di Azure e hello [procedure consigliate per la distribuzione di ADFS](https://technet.microsoft.com/library/dn151324.aspx) locale si applicano ugualmente distribuzione FS tooAD in Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-234">Yes, you can deploy Windows Server AD FS on Azure virtual machines, and hello [best practices for AD FS deployment](https://technet.microsoft.com/library/dn151324.aspx) on-premises apply equally tooAD FS deployment on Azure.</span></span> <span data-ttu-id="d6422-235">Ma alcune procedure consigliate di hello, ad esempio il bilanciamento del carico e disponibilità elevata, richiedono tecnologie superiori rispetto alle quali offerte da ADFS.</span><span class="sxs-lookup"><span data-stu-id="d6422-235">But some of hello best practices such as load balancing and high availability require technologies beyond what AD FS offers itself.</span></span> <span data-ttu-id="d6422-236">È necessario specificare dall'infrastruttura sottostante hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-236">They must be provided by hello underlying infrastructure.</span></span> <span data-ttu-id="d6422-237">Si esamineranno alcune di queste procedure consigliate e si vedrà come attuarle usando VM di Azure e una rete virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-237">Let’s review some of those best practices and see how they can be achieved by using Azure VMs and an Azure virtual network.</span></span>

1. <span data-ttu-id="d6422-238">**Non esporre mai i server (STS) il servizio token di sicurezza direttamente toohello Internet.**</span><span class="sxs-lookup"><span data-stu-id="d6422-238">**Never expose security token service (STS) servers directly toohello Internet.**</span></span>
   
    <span data-ttu-id="d6422-239">Questo è importante perché hello STS rilascia token di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="d6422-239">This is important because hello STS issues security tokens.</span></span> <span data-ttu-id="d6422-240">Di conseguenza, i server di servizio token di sicurezza, ad esempio i server ADFS devono essere gestiti con hello stesso livello di protezione di un controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="d6422-240">As a result, STS servers such as AD FS servers should be treated with hello same level of protection as a domain controller.</span></span> <span data-ttu-id="d6422-241">Se un servizio token di sicurezza è compromesso, gli utenti malintenzionati hanno hello possibilità tooissue i token di accesso potenzialmente contenenti attestazioni di loro scelta applicazioni di terze parti toorelying e altri server STS nelle organizzazioni trusting.</span><span class="sxs-lookup"><span data-stu-id="d6422-241">If an STS is compromised, malicious users have hello ability tooissue access tokens potentially containing claims of their choosing toorelying party applications and other STS servers in trusting organizations.</span></span>
2. <span data-ttu-id="d6422-242">**Distribuire controller di dominio Active Directory per tutti i domini utente nella stessa rete i server ADFS hello hello.**</span><span class="sxs-lookup"><span data-stu-id="d6422-242">**Deploy Active Directory domain controllers for all user domains in hello same network as hello AD FS servers.**</span></span>
   
    <span data-ttu-id="d6422-243">I server ADFS usano gli utenti tooauthenticate di servizi di dominio Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d6422-243">AD FS servers use Active Directory Domain Services tooauthenticate users.</span></span> <span data-ttu-id="d6422-244">Si consiglia di controller di dominio toodeploy sulla stessa rete come server di hello AD FS hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-244">It is recommended toodeploy domain controllers on hello same network as hello AD FS servers.</span></span> <span data-ttu-id="d6422-245">In questo modo la continuità aziendale nel caso in cui il collegamento hello tra hello rete di Azure e la rete locale viene interrotta e consente di migliorare le prestazioni per gli account di accesso e una latenza più bassa.</span><span class="sxs-lookup"><span data-stu-id="d6422-245">This provides business continuity in case hello link between hello Azure network and your on-premises network is broken, and enables lower latency and increased performance for logins.</span></span>
3. <span data-ttu-id="d6422-246">**Distribuire più nodi ADFS per disponibilità elevata e bilanciamento del carico hello.**</span><span class="sxs-lookup"><span data-stu-id="d6422-246">**Deploy multiple AD FS nodes for high availability and balancing hello load.**</span></span>
   
    <span data-ttu-id="d6422-247">Nella maggior parte dei casi, l'errore hello di un'applicazione abilitata da ADFS è accettabile perché le applicazioni di hello che richiedono i token di sicurezza sono spesso mission-critical.</span><span class="sxs-lookup"><span data-stu-id="d6422-247">In most cases, hello failure of an application that AD FS enables is unacceptable because hello applications that require security tokens are often mission critical.</span></span> <span data-ttu-id="d6422-248">Di conseguenza, e poiché ADFS ora risiede in hello percorso critico tooaccessing ad applicazioni cruciali, servizio di hello AD FS deve essere a disponibilità elevata mediante più proxy AD FS e i server ADFS.</span><span class="sxs-lookup"><span data-stu-id="d6422-248">As a result, and because AD FS now resides in hello critical path tooaccessing mission critical applications, hello AD FS service must be highly available through multiple AD FS proxies and AD FS servers.</span></span> <span data-ttu-id="d6422-249">distribuzione tooachieve delle richieste, servizi di bilanciamento del carico vengono in genere distribuiti davanti ai proxy ADFS hello Active Directory e i server ADFS hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-249">tooachieve distribution of requests, load balancers are typically deployed in front of both hello AD FS Proxies and hello AD FS servers.</span></span>
4. <span data-ttu-id="d6422-250">**Distribuire uno o più nodi Proxy applicazione Web per l'accesso a Internet.**</span><span class="sxs-lookup"><span data-stu-id="d6422-250">**Deploy one or more Web Application Proxy nodes for internet access.**</span></span>
   
    <span data-ttu-id="d6422-251">Quando gli utenti devono tooaccess applicazioni protette dal servizio di hello AD FS, hello AD FS servizio esigenze toobe disponibili hello internet.</span><span class="sxs-lookup"><span data-stu-id="d6422-251">When users need tooaccess applications protected by hello AD FS service, hello AD FS service needs toobe available from hello internet.</span></span> <span data-ttu-id="d6422-252">Questo risultato viene ottenuto tramite la distribuzione del servizio Proxy applicazione Web di hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-252">This is achieved by deploying hello Web Application Proxy service.</span></span> <span data-ttu-id="d6422-253">È consigliabile toodeploy più di un nodo per scopi di hello di disponibilità elevata e bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="d6422-253">It is strongly recommended toodeploy more than one node for hello purposes of high availability and load balancing.</span></span>
5. <span data-ttu-id="d6422-254">**Limitare l'accesso dalle risorse di rete toointernal nodi Proxy applicazione Web hello.**</span><span class="sxs-lookup"><span data-stu-id="d6422-254">**Restrict access from hello Web Application Proxy nodes toointernal network resources.**</span></span>
   
    <span data-ttu-id="d6422-255">gli utenti esterni di tooallow tooaccess AD FS da hello internet, è necessario nodi Proxy applicazione Web toodeploy (o Proxy ADFS nelle versioni precedenti di Windows Server).</span><span class="sxs-lookup"><span data-stu-id="d6422-255">tooallow external users tooaccess AD FS from hello internet, you need toodeploy Web Application Proxy nodes (or AD FS Proxy in earlier versions of Windows Server).</span></span> <span data-ttu-id="d6422-256">Hello proxy applicazione Web, i nodi sono direttamente esposti toohello Internet.</span><span class="sxs-lookup"><span data-stu-id="d6422-256">hello Web Application proxy nodes are directly exposed toohello Internet.</span></span> <span data-ttu-id="d6422-257">Non sono necessari toobe appartenenti a un dominio e sono solo necessario accedere ai server ADFS toohello AD sulla porta TCP 443 e 80.</span><span class="sxs-lookup"><span data-stu-id="d6422-257">They are not required toobe domain-joined and they only need access toohello AD FS servers over TCP ports 443 and 80.</span></span> <span data-ttu-id="d6422-258">È consigliabile che tooall comunicazione altri computer (in particolare i controller di dominio) è bloccato.</span><span class="sxs-lookup"><span data-stu-id="d6422-258">It is strongly recommended that communication tooall other computers (especially domain controllers) is blocked.</span></span>
   
    <span data-ttu-id="d6422-259">Questa configurazione si ottiene in genere in locale per mezzo di una rete perimetrale.</span><span class="sxs-lookup"><span data-stu-id="d6422-259">This is typically achieved on-premises by means of a DMZ.</span></span> <span data-ttu-id="d6422-260">I firewall utilizzano avviene in modalità di traffico toorestrict operazione dalla rete locale di hello DMZ toohello (solo il traffico da hello specificato gli indirizzi IP e su porte è consentito e tutti gli altri il traffico viene bloccato).</span><span class="sxs-lookup"><span data-stu-id="d6422-260">Firewalls use a whitelist mode of operation toorestrict traffic from hello DMZ toohello on-premises network (that is, only traffic from hello specified IP addresses and over specified ports is allowed, and all other traffic is blocked).</span></span>

<span data-ttu-id="d6422-261">Hello diagramma seguente mostra un tradizionale distribuzione di ADFS in locale.</span><span class="sxs-lookup"><span data-stu-id="d6422-261">hello following diagram shows a traditional on-premises AD FS deployment.</span></span>

![Diagramma di una distribuzione tradizionale di Active Directory Federation Services locale](media/active-directory-deploying-ws-ad-guidelines/ADFS_onprem.png)

<span data-ttu-id="d6422-263">Tuttavia, poiché Azure non fornisce funzionalità firewall native complete, è necessario il traffico toorestrict toobe utilizzato altre opzioni.</span><span class="sxs-lookup"><span data-stu-id="d6422-263">However, because Azure does not provide native, full-featured firewall capability, other options need toobe used toorestrict traffic.</span></span> <span data-ttu-id="d6422-264">Hello nella tabella seguente illustra ogni opzione e i relativi vantaggi e svantaggi.</span><span class="sxs-lookup"><span data-stu-id="d6422-264">hello following table shows each option and its advantages and disadvantages.</span></span>

| <span data-ttu-id="d6422-265">Opzione</span><span class="sxs-lookup"><span data-stu-id="d6422-265">Option</span></span> | <span data-ttu-id="d6422-266">Vantaggio</span><span class="sxs-lookup"><span data-stu-id="d6422-266">Advantage</span></span> | <span data-ttu-id="d6422-267">Svantaggio</span><span class="sxs-lookup"><span data-stu-id="d6422-267">Disadvantage</span></span> |
| --- | --- | --- |
| [<span data-ttu-id="d6422-268">ACL di rete di Azure</span><span class="sxs-lookup"><span data-stu-id="d6422-268">Azure network ACLs</span></span>](../virtual-network/virtual-networks-acl.md) |<span data-ttu-id="d6422-269">Configurazione iniziale meno costosa e più semplice.</span><span class="sxs-lookup"><span data-stu-id="d6422-269">Less costly and simpler initial configuration</span></span> |<span data-ttu-id="d6422-270">Configurazione di ACL di rete aggiuntiva necessaria se le nuove macchine virtuali vengono aggiunte toohello distribuzione</span><span class="sxs-lookup"><span data-stu-id="d6422-270">Additional network ACL configuration required if any new VMs are added toohello deployment</span></span> |
| [<span data-ttu-id="d6422-271">Barracuda NG firewall</span><span class="sxs-lookup"><span data-stu-id="d6422-271">Barracuda NG firewall</span></span>](https://www.barracuda.com/products/ngfirewall) |<span data-ttu-id="d6422-272">Modalità operativa di tipo elenco elementi consentiti, non richiede alcuna configurazione di ACL di rete.</span><span class="sxs-lookup"><span data-stu-id="d6422-272">Whitelist mode of operation and it requires no network ACL configuration</span></span> |<span data-ttu-id="d6422-273">Costi e complessità maggiori per la configurazione iniziale.</span><span class="sxs-lookup"><span data-stu-id="d6422-273">Increased cost and complexity for initial setup</span></span> |

<span data-ttu-id="d6422-274">passaggi di alto livello di Hello toodeploy AD FS in questo caso sono come segue:</span><span class="sxs-lookup"><span data-stu-id="d6422-274">hello high-level steps toodeploy AD FS in this case are as follows:</span></span>

1. <span data-ttu-id="d6422-275">Creare una rete virtuale con connettività cross-premise usando una VPN o [ExpressRoute](http://azure.microsoft.com/services/expressroute/).</span><span class="sxs-lookup"><span data-stu-id="d6422-275">Create a virtual network with cross-premises connectivity, using either a VPN or [ExpressRoute](http://azure.microsoft.com/services/expressroute/).</span></span>
2. <span data-ttu-id="d6422-276">Distribuire controller di dominio sulla rete virtuale hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-276">Deploy domain controllers on hello virtual network.</span></span> <span data-ttu-id="d6422-277">Questo passaggio è facoltativo ma consigliato.</span><span class="sxs-lookup"><span data-stu-id="d6422-277">This step is optional but recommended.</span></span>
3. <span data-ttu-id="d6422-278">Distribuire i server ADFS di dominio nella rete virtuale hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-278">Deploy domain-joined AD FS servers on hello virtual network.</span></span>
4. <span data-ttu-id="d6422-279">Creare un [set con bilanciamento del carico interno](http://azure.microsoft.com/blog/internal-load-balancing/) che include i server ADFS hello e si usa un nuovo indirizzo IP privato all'interno di rete virtuale hello (un indirizzo IP dinamico).</span><span class="sxs-lookup"><span data-stu-id="d6422-279">Create an [internal load balanced set](http://azure.microsoft.com/blog/internal-load-balancing/) that includes hello AD FS servers and uses a new private IP address within hello virtual network (a dynamic IP address).</span></span>
   
   1. <span data-ttu-id="d6422-280">Aggiornare DNS toocreate hello FQDN toopoint toohello (dinamico) indirizzo IP privato del set interno con carico bilanciato hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-280">Update DNS toocreate hello FQDN toopoint toohello private (dynamic) IP address of hello internal load balanced set.</span></span>
5. <span data-ttu-id="d6422-281">Creare un servizio cloud (o una rete virtuale separata) per hello nodi Proxy applicazione Web.</span><span class="sxs-lookup"><span data-stu-id="d6422-281">Create a cloud service (or a separate virtual network) for hello Web Application Proxy nodes.</span></span>
6. <span data-ttu-id="d6422-282">Distribuire i nodi Proxy applicazione Web hello nel servizio cloud hello o rete virtuale</span><span class="sxs-lookup"><span data-stu-id="d6422-282">Deploy hello Web Application Proxy nodes in hello cloud service or virtual network</span></span>
   
   1. <span data-ttu-id="d6422-283">Creare un set esterno con carico bilanciato che include nodi Proxy applicazione Web hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-283">Create an external load balanced set that includes hello Web Application Proxy nodes.</span></span>
   2. <span data-ttu-id="d6422-284">Aggiornare hello esterna DNS name (FQDN) toopoint toohello cloud servizio indirizzo IP pubblico (indirizzo IP virtuale hello).</span><span class="sxs-lookup"><span data-stu-id="d6422-284">Update hello external DNS name (FQDN) toopoint toohello cloud service public IP address (hello virtual IP address).</span></span>
   3. <span data-ttu-id="d6422-285">Configurare AD FS proxy toouse hello FQDN che corrisponde a set interno con carico bilanciato toohello per i server di hello AD FS.</span><span class="sxs-lookup"><span data-stu-id="d6422-285">Configure AD FS proxies toouse hello FQDN that corresponds toohello internal load balanced set for hello AD FS servers.</span></span>
   4. <span data-ttu-id="d6422-286">Aggiornare i siti web basati su attestazioni toouse hello FQDN esterno per il provider di attestazioni.</span><span class="sxs-lookup"><span data-stu-id="d6422-286">Update claims-based web sites toouse hello external FQDN for their claims provider.</span></span>
7. <span data-ttu-id="d6422-287">Limitare l'accesso tra computer tooany Proxy applicazione Web nella rete virtuale di hello AD FS.</span><span class="sxs-lookup"><span data-stu-id="d6422-287">Restrict access between Web Application Proxy tooany machine in hello AD FS virtual network.</span></span>

<span data-ttu-id="d6422-288">traffico toorestrict, set di bilanciamento del carico hello servizio di bilanciamento del carico interno di Azure hello deve toobe configurata per solo tooTCP traffico le porte 80 e 443 e tutti gli altri traffico toohello dinamico indirizzo IP interno del set con carico bilanciato hello viene eliminato.</span><span class="sxs-lookup"><span data-stu-id="d6422-288">toorestrict traffic, hello load-balanced set for hello Azure internal load balancer needs toobe configured for only traffic tooTCP ports 80 and 443, and all other traffic toohello internal dynamic IP address of hello load balanced set is dropped.</span></span>

![Diagramma di ACL di rete AD FS con porte TCP 443 e 80 consentite.](media/active-directory-deploying-ws-ad-guidelines/ADFS_ACLs.png)

<span data-ttu-id="d6422-290">Server di traffico toohello AD FS sarebbe consentito solo da hello seguenti origini:</span><span class="sxs-lookup"><span data-stu-id="d6422-290">Traffic toohello AD FS servers would be permitted only by hello following sources:</span></span>

* <span data-ttu-id="d6422-291">servizio di bilanciamento del carico interno di Azure Hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-291">hello Azure internal load balancer.</span></span>
* <span data-ttu-id="d6422-292">indirizzo IP di Hello di amministratore di rete locale hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-292">hello IP address of an administrator on hello on-premises network.</span></span>

> [!WARNING]
> <span data-ttu-id="d6422-293">progettazione di Hello deve impedire ad altre macchine virtuali nella rete virtuale di Azure hello o a tutti i percorsi nella rete locale hello nodi Proxy applicazione Web.</span><span class="sxs-lookup"><span data-stu-id="d6422-293">hello design must prevent Web Application Proxy nodes from reaching any other VMs in hello Azure virtual network or any locations on hello on-premises network.</span></span> <span data-ttu-id="d6422-294">Che può essere effettuata da configurare regole firewall nel dispositivo locale hello per le connessioni Expressroute o il dispositivo VPN hello per le connessioni VPN da sito a sito.</span><span class="sxs-lookup"><span data-stu-id="d6422-294">That can be done by configuring firewall rules in hello on-premises appliance for Express Route connections or hello VPN device for site-to-site VPN connections.</span></span>
> 
> 

<span data-ttu-id="d6422-295">Un'opzione toothis svantaggio è hello necessità tooconfigure hello ACL di rete per più dispositivi, tra cui bilanciamento del carico interno, il server ADFS hello e qualsiasi altro server che vengono aggiunte toohello di rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="d6422-295">A disadvantage toothis option is hello need tooconfigure hello network ACLs for multiple devices, including internal load balancer, hello AD FS servers, and any other servers that get added toohello virtual network.</span></span> <span data-ttu-id="d6422-296">Se un dispositivo viene aggiunto toohello distribuzione senza configurare tooit traffico toorestrict ACL di rete, l'intera distribuzione di hello può essere a rischio.</span><span class="sxs-lookup"><span data-stu-id="d6422-296">If any device is added toohello deployment without configuring network ACLs toorestrict traffic tooit, hello entire deployment can be at risk.</span></span> <span data-ttu-id="d6422-297">Se gli indirizzi IP hello di nodi Proxy applicazione Web hello cambiano, è necessario reimpostare l'ACL di rete hello (ovvero proxy hello deve essere configurato toouse [statico gli indirizzi IP dinamici](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/)).</span><span class="sxs-lookup"><span data-stu-id="d6422-297">If hello IP addresses of hello Web Application Proxy nodes ever change, hello network ACLs must be reset (which means hello proxies should be configured toouse [static dynamic IP addresses](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/)).</span></span>

![AD FS in Azure con ACL di rete.](media/active-directory-deploying-ws-ad-guidelines/ADFS_Azure.png)

<span data-ttu-id="d6422-299">Un'altra opzione consiste hello toouse [Barracuda NG Firewall](https://www.barracuda.com/products/ngfirewall) traffico toocontrol accessorio tra i server proxy ADFS e hello AD FS.</span><span class="sxs-lookup"><span data-stu-id="d6422-299">Another option is toouse hello [Barracuda NG Firewall](https://www.barracuda.com/products/ngfirewall) appliance toocontrol traffic between AD FS proxy servers and hello AD FS servers.</span></span> <span data-ttu-id="d6422-300">Questa opzione è conforme alle procedure consigliate per la sicurezza e la disponibilità elevata e richiede attività di amministrazione minori dopo l'installazione iniziale di hello perché hello Barracuda NG Firewall offre una modalità elenco amministrazione del firewall e può essere installato direttamente in una rete virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-300">This option complies with best practices for security and high availability, and requires less administration after hello initial setup because hello Barracuda NG Firewall appliance provides a whitelist mode of firewall administration and it can be installed directly on an Azure virtual network.</span></span> <span data-ttu-id="d6422-301">Che consente di eliminare ACL di rete tooconfigure hello necessario ogni volta che un nuovo server viene aggiunto toohello distribuzione.</span><span class="sxs-lookup"><span data-stu-id="d6422-301">That eliminates hello need tooconfigure network ACLs any time a new server is added toohello deployment.</span></span> <span data-ttu-id="d6422-302">Questa opzione comporta tuttavia maggiori costi e complessità per la distribuzione iniziale.</span><span class="sxs-lookup"><span data-stu-id="d6422-302">But this option adds initial deployment complexity and cost.</span></span>

<span data-ttu-id="d6422-303">In questo caso, vengono distribuite due reti virtuali invece di una,</span><span class="sxs-lookup"><span data-stu-id="d6422-303">In this case, two virtual networks are deployed instead of one.</span></span> <span data-ttu-id="d6422-304">ad esempio rete virtuale 1 e rete virtuale 2.</span><span class="sxs-lookup"><span data-stu-id="d6422-304">We'll call them VNet1 and VNet2.</span></span> <span data-ttu-id="d6422-305">VNet1 contiene proxy hello e VNet2 contiene ruoli STS hello e hello rete connessione toohello indietro alla rete aziendale.</span><span class="sxs-lookup"><span data-stu-id="d6422-305">VNet1 contains hello proxies and VNet2 contains hello STSs and hello network connection back toohello corporate network.</span></span> <span data-ttu-id="d6422-306">VNet1 è pertanto fisicamente (benché virtualmente) isolata dalla prospettiva di VNet2 e, a sua volta, dalla rete aziendale hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-306">VNet1 is therefore physically (albeit virtually) isolated from VNet2 and, in turn, from hello corporate network.</span></span> <span data-ttu-id="d6422-307">VNet1 è quindi connesso tooVNet2 utilizzando una tecnologia di tunneling speciale nota come trasporto Independent Network Architecture (TINA).</span><span class="sxs-lookup"><span data-stu-id="d6422-307">VNet1 is then connected tooVNet2 using a special tunneling technology known as Transport Independent Network Architecture (TINA).</span></span> <span data-ttu-id="d6422-308">il tunnel TINA Hello è collegato tooeach di reti virtuali di hello utilizzando un dispositivo Barracuda NG firewall, ovvero un dispositivo Barracuda su ciascuna delle reti virtuali hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-308">hello TINA tunnel is attached tooeach of hello virtual networks using a Barracuda NG firewall—one Barracuda on each of hello virtual networks.</span></span>  <span data-ttu-id="d6422-309">Per garantire disponibilità elevata, è consigliabile distribuire due dispositivi barracuda su ogni rete virtuale. uno attivo, hello altro passivo.</span><span class="sxs-lookup"><span data-stu-id="d6422-309">For high-availability, it is recommended that you deploy two Barracudas on each virtual network; one active, hello other passive.</span></span> <span data-ttu-id="d6422-310">Offrono funzionalità firewall complesse che permettono di operazione hello toomimic di una rete Perimetrale locale tradizionale in Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-310">They offer extremely rich firewalling capabilities which allow us toomimic hello operation of a traditional on-premises DMZ in Azure.</span></span>

![AD FS in Azure con firewall.](media/active-directory-deploying-ws-ad-guidelines/ADFS_Azure_firewall.png)

<span data-ttu-id="d6422-312">Per ulteriori informazioni, vedere [ADFS: estendere un toohello applicazione front-end locale in grado di riconoscere attestazioni Internet](#BKMK_CloudOnlyFed).</span><span class="sxs-lookup"><span data-stu-id="d6422-312">For more information, see [AD FS: Extend a claims-aware on-premises front-end application toohello Internet](#BKMK_CloudOnlyFed).</span></span>

### <a name="an-alternative-tooad-fs-deployment-if-hello-goal-is-office-365-sso-alone"></a><span data-ttu-id="d6422-313">Una distribuzione alternativo tooAD ADFS se l'obiettivo di hello è solo SSO di Office 365</span><span class="sxs-lookup"><span data-stu-id="d6422-313">An alternative tooAD FS deployment if hello goal is Office 365 SSO alone</span></span>
<span data-ttu-id="d6422-314">Se l'obiettivo è solo tooenable Accedi per Office 365 è completa di un'altra alternativa toodeploying AD ADFS.</span><span class="sxs-lookup"><span data-stu-id="d6422-314">There is another alternative toodeploying AD FS altogether if your goal is only tooenable sign-in for Office 365.</span></span> <span data-ttu-id="d6422-315">In tal caso, è possibile semplicemente distribuire DirSync con sincronizzazione password in locale e ottenere hello stesso risultato finale con una complessità di distribuzione minima, perché questo approccio non richiede ADFS o Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-315">In that case, you can simply deploy DirSync with password sync on-premises and achieve hello same end-result with minimal deployment complexity because this approach does not require AD FS or Azure.</span></span>

<span data-ttu-id="d6422-316">Hello nella tabella seguente confronta funzionamento dei processi di accesso hello con e senza distribuzione di ADFS.</span><span class="sxs-lookup"><span data-stu-id="d6422-316">hello following table compares how hello sign-in processes work with and without deploying AD FS.</span></span>

| <span data-ttu-id="d6422-317">Single Sign-On in Office 365 con AD FS e DirSync</span><span class="sxs-lookup"><span data-stu-id="d6422-317">Office 365 single sign-on using AD FS and DirSync</span></span> | <span data-ttu-id="d6422-318">Lo stesso Single Sign-On in Office 365 con DirSync e sincronizzazione password</span><span class="sxs-lookup"><span data-stu-id="d6422-318">Office 365 same sign-on using DirSync + Password Sync</span></span> |
| --- | --- |
| <span data-ttu-id="d6422-319">1. hello utente effettua l'accesso alla rete aziendale tooa e viene autenticato tooWindows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d6422-319">1. hello user logs on tooa corporate network, and is authenticated tooWindows Server Active Directory.</span></span> |<span data-ttu-id="d6422-320">1. hello utente effettua l'accesso alla rete aziendale tooa e viene autenticato tooWindows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d6422-320">1. hello user logs on tooa corporate network, and is authenticated tooWindows Server Active Directory.</span></span> |
| <span data-ttu-id="d6422-321">2. utente di hello tenta tooaccess Office 365 (So @contoso.com).</span><span class="sxs-lookup"><span data-stu-id="d6422-321">2. hello user tries tooaccess Office 365 (I am @contoso.com).</span></span> |<span data-ttu-id="d6422-322">2. utente di hello tenta tooaccess Office 365 (So @contoso.com).</span><span class="sxs-lookup"><span data-stu-id="d6422-322">2. hello user tries tooaccess Office 365 (I am @contoso.com).</span></span> |
| <span data-ttu-id="d6422-323">3. Office 365 reindirizza l'utente di hello tooAzure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d6422-323">3. Office 365 redirects hello user tooAzure AD.</span></span> |<span data-ttu-id="d6422-324">3. Office 365 reindirizza l'utente di hello tooAzure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d6422-324">3. Office 365 redirects hello user tooAzure AD.</span></span> |
| <span data-ttu-id="d6422-325">4. Poiché Azure AD non è possibile eseguire l'autenticazione utente hello e rileva l'esistenza di una relazione di trust con ADFS in locale, viene reindirizzato hello utente tooAD ADFS.</span><span class="sxs-lookup"><span data-stu-id="d6422-325">4. Since Azure AD can’t authenticate hello user and understands there is a trust with AD FS on-premises, it redirects hello user tooAD FS.</span></span> |<span data-ttu-id="d6422-326">4. Azure AD non può accettare direttamente i ticket Kerberos e non esiste alcuna relazione di trust, pertanto richiede che l'utente hello immettere le credenziali.</span><span class="sxs-lookup"><span data-stu-id="d6422-326">4. Azure AD can’t accept Kerberos tickets directly and no trust relationship exists so it requests that hello user enter credentials.</span></span> |
| <span data-ttu-id="d6422-327">5. hello utente invia un Kerberos ticket toohello AD STS di ADFS.</span><span class="sxs-lookup"><span data-stu-id="d6422-327">5. hello user sends a Kerberos ticket toohello AD FS STS.</span></span> |<span data-ttu-id="d6422-328">5. hello immessi hello stessa password locale e Azure AD la convalida rispetto al nome utente hello e una password sincronizzata tramite DirSync.</span><span class="sxs-lookup"><span data-stu-id="d6422-328">5. hello user enters hello same on-premises password, and Azure AD validates them against hello user name and password that was synchronized by DirSync.</span></span> |
| <span data-ttu-id="d6422-329">6. ADFS Trasforma hello toohello ticket Kerberos richiesto attestazione/formato di token e reindirizza hello utente tooAzure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d6422-329">6. AD FS transforms hello Kerberos ticket toohello required token format/claims and redirects hello user tooAzure AD.</span></span> |<span data-ttu-id="d6422-330">6. Azure AD reindirizza hello utente tooOffice 365.</span><span class="sxs-lookup"><span data-stu-id="d6422-330">6. Azure AD redirects hello user tooOffice 365.</span></span> |
| <span data-ttu-id="d6422-331">7. autenticazione dell'utente di hello tooAzure AD (si verifica un'ulteriore trasformazione).</span><span class="sxs-lookup"><span data-stu-id="d6422-331">7. hello user authenticates tooAzure AD (another transformation occurs).</span></span> |<span data-ttu-id="d6422-332">7. hello utente possa accedere tooOffice 365 e OWA utilizzando il token di Azure AD hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-332">7. hello user can sign in tooOffice 365 and OWA using hello Azure AD token.</span></span> |
| <span data-ttu-id="d6422-333">8. Azure AD reindirizza hello utente tooOffice 365.</span><span class="sxs-lookup"><span data-stu-id="d6422-333">8. Azure AD redirects hello user tooOffice 365.</span></span> | |
| <span data-ttu-id="d6422-334">9. utente hello viene connesso automaticamente tooOffice 365.</span><span class="sxs-lookup"><span data-stu-id="d6422-334">9. hello user is silently signed on tooOffice 365.</span></span> | |

<span data-ttu-id="d6422-335">In hello Office 365 con DirSync con sincronizzazione delle password (non ADFS), single sign-on viene sostituito dallo "stesso sign-on" dove "stesso" significa che gli utenti devono immettere nuovamente le stesse credenziali locali per l'accesso a Office 365.</span><span class="sxs-lookup"><span data-stu-id="d6422-335">In hello Office 365 with DirSync with password sync scenario (no AD FS), single sign-on is replaced by “same sign-on” where “same” simply means that users must re-enter their same on-premises credentials when accessing Office 365.</span></span> <span data-ttu-id="d6422-336">Si noti che questi dati possono essere memorizzati da toohelp browser dell'utente hello ridurre le richieste successive.</span><span class="sxs-lookup"><span data-stu-id="d6422-336">Note that this data can be remembered by hello user’s browser toohelp reduce subsequent prompts.</span></span>

### <a name="additional-food-for-thought"></a><span data-ttu-id="d6422-337">Altri elementi di riflessione</span><span class="sxs-lookup"><span data-stu-id="d6422-337">Additional food for thought</span></span>
* <span data-ttu-id="d6422-338">Se si distribuisce un proxy AD FS in una macchina virtuale di Azure, server di connettività toohello AD FS.</span><span class="sxs-lookup"><span data-stu-id="d6422-338">If you deploy an AD FS proxy on an Azure virtual machine, connectivity toohello AD FS servers is needed.</span></span> <span data-ttu-id="d6422-339">Se sono locali, è consigliabile utilizzare hello site-to-site VPN connettività fornita da toocommunicate di nodi Proxy applicazione Web di hello rete virtuale tooallow hello con i server ADFS.</span><span class="sxs-lookup"><span data-stu-id="d6422-339">If they are on-premises, it is recommended that you leverage hello site-to-site VPN connectivity provided by hello virtual network tooallow hello Web Application Proxy nodes toocommunicate with their AD FS servers.</span></span>
* <span data-ttu-id="d6422-340">Se si distribuisce un server AD FS su virtuale di Azure del computer, controller di dominio Active Directory Server tooWindows connettività, archivi di attributi e i database di configurazione è necessari e può anche richiedere ExpressRoute o una connessione VPN da sito a sito tra la rete hello Azure virtuale hello e rete locale.</span><span class="sxs-lookup"><span data-stu-id="d6422-340">If you deploy an AD FS server on an Azure virtual machine, connectivity tooWindows Server Active Directory domain controllers, Attribute Stores, and Configuration databases is necessary and may also require an ExpressRoute or a site-to-site VPN connection between hello Azure virtual network and hello on-premises network.</span></span>
* <span data-ttu-id="d6422-341">Gli addebiti vengono applicati traffico tooall da macchine virtuali di Azure (traffico in uscita).</span><span class="sxs-lookup"><span data-stu-id="d6422-341">Charges are applied tooall traffic from Azure virtual machines (egress traffic).</span></span> <span data-ttu-id="d6422-342">Se il costo è un fattore determinante hello, è consigliabile toodeploy nodi di Proxy applicazione Web hello in Azure, lasciando i server ADFS hello in locale.</span><span class="sxs-lookup"><span data-stu-id="d6422-342">If cost is hello driving factor, it is advisable toodeploy hello Web Application Proxy nodes on Azure, leaving hello AD FS servers on-premises.</span></span> <span data-ttu-id="d6422-343">Se i server di hello AD ADFS vengono distribuiti nelle macchine virtuali Azure anche, costi aggiuntivi saranno sostenuti tooauthenticate locale utenti.</span><span class="sxs-lookup"><span data-stu-id="d6422-343">If hello AD FS servers are deployed on Azure virtual machines as well, additional costs will be incurred tooauthenticate on-premises users.</span></span> <span data-ttu-id="d6422-344">Traffico in uscita comporta un costo indipendentemente dal fatto che attraversi hello ExpressRoute o hello connessione site-to-site VPN.</span><span class="sxs-lookup"><span data-stu-id="d6422-344">Egress traffic incurs a cost regardless of whether or not it is traversing hello ExpressRoute or hello VPN site-to-site connection.</span></span>
* <span data-ttu-id="d6422-345">Se si decide server nativo funzionalità Bilanciamento del carico di Azure toouse per la disponibilità elevata dei server ADFS, si noti che il bilanciamento del carico offre probe vengono utilizzati toodetermine hello integrità delle macchine virtuali hello all'interno del servizio cloud hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-345">If you decide toouse Azure’s native server load balancing capabilities for high availability of AD FS servers, note that load balancing provides probes that are used toodetermine hello health of hello virtual machines within hello cloud service.</span></span> <span data-ttu-id="d6422-346">In caso di hello macchine virtuali di Azure (come i ruoli di lavoro o tooweb anziché), è necessario utilizzare un probe personalizzato poiché agente hello risponde probe predefiniti toohello non è presente nelle macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-346">In hello case of Azure virtual machines (as opposed tooweb or worker roles), a custom probe must be used since hello agent that responds toohello default probes is not present on Azure virtual machines.</span></span> <span data-ttu-id="d6422-347">Per semplicità, è possibile utilizzare un probe TCP personalizzato, questo richiede solo che una connessione TCP (un segmento TCP SYN inviato e ha risposto toowith un segmento TCP SYN ACK) sia l'integrità della macchina virtuale toodetermine stabilita correttamente.</span><span class="sxs-lookup"><span data-stu-id="d6422-347">For simplicity, you might use a custom TCP probe — this requires only that a TCP connection (a TCP SYN segment sent and responded toowith a TCP SYN ACK segment) be successfully established toodetermine virtual machine health.</span></span> <span data-ttu-id="d6422-348">È possibile configurare hello probe personalizzato toouse qualsiasi toowhich porta TCP che le macchine virtuali sono attivamente in ascolto.</span><span class="sxs-lookup"><span data-stu-id="d6422-348">You can configure hello custom probe toouse any TCP port toowhich your virtual machines are actively listening.</span></span>

> [!NOTE]
> <span data-ttu-id="d6422-349">Macchine virtuali che richiedono hello tooexpose che stesso insieme di porte direttamente toohello Internet (ad esempio la porta 80 e 443) non è possibile condividere hello nello stesso servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="d6422-349">Machines that need tooexpose hello same set of ports directly toohello Internet (such as port 80 and 443) cannot share hello same cloud service.</span></span> <span data-ttu-id="d6422-350">Si raccomanda di conseguenza, creare un servizio cloud dedicato per i server ADFS di Windows Server in ordine tooavoid possibili sovrapposizioni tra i requisiti delle porte per un'applicazione e ADFS di Windows Server.</span><span class="sxs-lookup"><span data-stu-id="d6422-350">It is, therefore, recommended that you create a dedicated cloud service for your Windows Server AD FS servers in order tooavoid potential overlaps between port requirements for an application and Windows Server AD FS.</span></span>
> 
> 

## <a name="deployment-scenarios"></a><span data-ttu-id="d6422-351">Scenari di distribuzione</span><span class="sxs-lookup"><span data-stu-id="d6422-351">Deployment scenarios</span></span>
<span data-ttu-id="d6422-352">Hello seguente sezione vengono presentate distribuzione comuni scenari toodraw attenzione tooimportant considerazioni che devono essere presi in considerazione.</span><span class="sxs-lookup"><span data-stu-id="d6422-352">hello following section outlines commonplace deployment scenarios toodraw attention tooimportant considerations that must be taken into account.</span></span> <span data-ttu-id="d6422-353">Ogni scenario include i collegamenti toomore dettagli decisioni hello e tooconsider fattori.</span><span class="sxs-lookup"><span data-stu-id="d6422-353">Each scenario has links toomore details about hello decisions and factors tooconsider.</span></span>

1. [<span data-ttu-id="d6422-354">Servizi di dominio Active Directory: distribuire un'applicazione compatibile con Servizi di dominio Active Directory senza requisiti per la connettività di rete aziendale</span><span class="sxs-lookup"><span data-stu-id="d6422-354">AD DS: Deploy an AD DS-aware application with no requirement for corporate network connectivity</span></span>](#BKMK_CloudOnly)
   
    <span data-ttu-id="d6422-355">Ad esempio, un servizio SharePoint con connessione Internet viene distribuito in una macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-355">For example, an Internet-facing SharePoint service is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="d6422-356">un'applicazione Hello non presenta dipendenze sulle risorse di rete aziendale.</span><span class="sxs-lookup"><span data-stu-id="d6422-356">hello application has no dependencies on corporate-network resources.</span></span> <span data-ttu-id="d6422-357">Hello applicazione richiedono servizi di dominio di Windows Server Active Directory, ma non richiede hello DS di Windows Server Active Directory aziendale.</span><span class="sxs-lookup"><span data-stu-id="d6422-357">hello application does require Windows Server AD DS but does NOT require hello corporate Windows Server AD DS.</span></span>
2. [<span data-ttu-id="d6422-358">ADFS: Estendere un toohello applicazione front-end locale in grado di riconoscere attestazioni Internet</span><span class="sxs-lookup"><span data-stu-id="d6422-358">AD FS: Extend a claims-aware on-premises front-end application toohello Internet</span></span>](#BKMK_CloudOnlyFed)
   
    <span data-ttu-id="d6422-359">Ad esempio, un'applicazione in grado di riconoscere attestazioni distribuita correttamente in locale e utilizzata dagli utenti aziendali deve toobecome accessibile da Internet hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-359">For example, a claims-aware application that has been successfully deployed on-premises and used by corporate users needs toobecome accessible from hello Internet.</span></span> <span data-ttu-id="d6422-360">un'applicazione Hello deve toobe accessibili direttamente tramite Internet hello ai partner aziendali tramite le relative identità aziendali sia agli utenti aziendali esistenti.</span><span class="sxs-lookup"><span data-stu-id="d6422-360">hello application needs toobe accessed directly over hello Internet both by business partners using their own corporate identities and by existing corporate users.</span></span>
3. [<span data-ttu-id="d6422-361">Servizi di dominio Active Directory: Distribuire un'applicazione di Windows Server AD DS-aware che richiede una rete aziendale toohello di connettività</span><span class="sxs-lookup"><span data-stu-id="d6422-361">AD DS: Deploy a Windows Server AD DS-aware application that requires connectivity toohello corporate network</span></span>](#BKMK_HybridExt)
   
    <span data-ttu-id="d6422-362">Ad esempio, un'applicazione compatibile con LDAP, che supporta l'autenticazione integrata di Windows e usa Servizi di dominio Active Directory di Windows Server come archivio per i dati di configurazione e del profilo utente, viene distribuita in una macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-362">For example, an LDAP-aware application that supports Windows-integrated authentication and uses Windows Server AD DS as a repository for configuration and user-profile data is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="d6422-363">È consigliabile che hello tooleverage di applicazione hello DS di Windows Server Active Directory aziendale esistente e fornire accesso single sign-on.</span><span class="sxs-lookup"><span data-stu-id="d6422-363">It is desirable for hello application tooleverage hello existing corporate Windows Server AD DS and provide single sign-on.</span></span> <span data-ttu-id="d6422-364">un'applicazione Hello non è in grado di riconoscere attestazioni.</span><span class="sxs-lookup"><span data-stu-id="d6422-364">hello application is not claims-aware.</span></span>

### <span data-ttu-id="d6422-365"><a name="BKMK_CloudOnly"></a>1. Servizi di dominio Active Directory: distribuire un'applicazione compatibile con Servizi di dominio Active Directory senza requisiti per la connettività di rete aziendale</span><span class="sxs-lookup"><span data-stu-id="d6422-365"><a name="BKMK_CloudOnly"></a>1. AD DS: Deploy an AD DS-aware application with no requirement for corporate network connectivity</span></span>
<span data-ttu-id="d6422-366">![Distribuzione di Servizi di dominio Active Directory solo cloud](media/active-directory-deploying-ws-ad-guidelines/ADDS_cloud.png)
**Figura 1**</span><span class="sxs-lookup"><span data-stu-id="d6422-366">![Cloud-only AD DS deployment](media/active-directory-deploying-ws-ad-guidelines/ADDS_cloud.png)
**Figure 1**</span></span>

#### <a name="description"></a><span data-ttu-id="d6422-367">Descrizione</span><span class="sxs-lookup"><span data-stu-id="d6422-367">Description</span></span>
<span data-ttu-id="d6422-368">SharePoint è distribuito in una macchina virtuale di Azure e un'applicazione hello non ha dipendenze da risorse di rete aziendale.</span><span class="sxs-lookup"><span data-stu-id="d6422-368">SharePoint is deployed on an Azure virtual machine and hello application has no dependencies on corporate-network resources.</span></span> <span data-ttu-id="d6422-369">Hello applicazione richiedono servizi di dominio Windows Server Active Directory ma non *non* richiedono hello DS di Windows Server Active Directory aziendale.</span><span class="sxs-lookup"><span data-stu-id="d6422-369">hello application does require Windows Server AD DS but does *not* require hello corporate Windows Server AD DS.</span></span> <span data-ttu-id="d6422-370">Nessun Kerberos o trust federativi sono necessari poiché gli utenti vengono effettuati automaticamente tramite un'applicazione hello nel dominio hello servizi di dominio di Windows Server Active Directory che è ospitato anche in cloud hello in macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-370">No Kerberos or federated trusts are required because users are self-provisioned through hello application into hello Windows Server AD DS domain that is also hosted in hello cloud on Azure virtual machines.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-toohello-scenario"></a><span data-ttu-id="d6422-371">Considerazioni sullo scenario e come aree tecnologiche applicano toohello scenario</span><span class="sxs-lookup"><span data-stu-id="d6422-371">Scenario considerations and how technology areas apply toohello scenario</span></span>
* <span data-ttu-id="d6422-372">[Topologia di rete](#BKMK_NetworkTopology): creare una rete virtuale di Azure senza connettività cross-premise, nota anche come connettività da sito a sito.</span><span class="sxs-lookup"><span data-stu-id="d6422-372">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network without cross-premises connectivity (also known as site-to-site connectivity).</span></span>
* <span data-ttu-id="d6422-373">[Configurazione della distribuzione di un controller di dominio](#BKMK_DeploymentConfig): distribuire un nuovo controller di dominio in una nuova foresta Active Directory di Windows Server a dominio singolo.</span><span class="sxs-lookup"><span data-stu-id="d6422-373">[DC deployment configuration](#BKMK_DeploymentConfig): Deploy a new domain controller into a new, single-domain, Windows Server Active Directory forest.</span></span> <span data-ttu-id="d6422-374">Questo metodo deve essere distribuito insieme ai server DNS di Windows hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-374">This should be deployed along with hello Windows DNS server.</span></span>
* <span data-ttu-id="d6422-375">[Topologia del sito di Windows Server Active Directory](#BKMK_ADSiteTopology): utilizza sito di Windows Server Active Directory predefinito hello (tutti i computer saranno in nome-predefinito-primo-sito).</span><span class="sxs-lookup"><span data-stu-id="d6422-375">[Windows Server Active Directory site topology](#BKMK_ADSiteTopology): Use hello default Windows Server Active Directory site (all computers will be in Default-First-Site-Name).</span></span>
* <span data-ttu-id="d6422-376">[Indirizzamento IP e DNS](#BKMK_IPAddressDNS):</span><span class="sxs-lookup"><span data-stu-id="d6422-376">[IP addressing and DNS](#BKMK_IPAddressDNS):</span></span>
  
  * <span data-ttu-id="d6422-377">Impostare un indirizzo IP statico per hello controller di dominio utilizzando cmdlet Set-AzureStaticVNetIP di Azure PowerShell hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-377">Set a static IP address for hello DC by using hello Set-AzureStaticVNetIP Azure PowerShell cmdlet.</span></span>
  * <span data-ttu-id="d6422-378">Installare e configurare DNS di Windows Server nei controller di dominio hello in Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-378">Install and configure Windows Server DNS on hello domain controller(s) on Azure.</span></span>
  * <span data-ttu-id="d6422-379">Configurare le proprietà di rete virtuale hello con nome hello e l'indirizzo IP di macchina virtuale che ospita i ruoli del server DNS e controller di dominio hello hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-379">Configure hello virtual network properties with hello name and IP address of hello VM that hosts hello DC and DNS server roles.</span></span>
* <span data-ttu-id="d6422-380">[Catalogo globale](#BKMK_GC): hello primo controller di dominio nella foresta hello deve essere un server di catalogo globale.</span><span class="sxs-lookup"><span data-stu-id="d6422-380">[Global Catalog](#BKMK_GC): hello first DC in hello forest must be a global catalog server.</span></span> <span data-ttu-id="d6422-381">Controller di dominio aggiuntivi deve essere configurato anche come cataloghi globali perché in una foresta a dominio singolo catalogo globale hello non richiede operazioni aggiuntive da hello controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="d6422-381">Additional DCs should also be configured as GCs because in a single domain forest, hello global catalog does not require any additional work from hello DC.</span></span>
* <span data-ttu-id="d6422-382">[Posizione del database hello servizi di dominio di Windows Server Active Directory e SYSVOL](#BKMK_PlaceDB): aggiungere un tooDCs disco dati in esecuzione come macchine virtuali di Azure in ordine toostore hello Active Directory di Windows Server database, registri e SYSVOL.</span><span class="sxs-lookup"><span data-stu-id="d6422-382">[Placement of hello Windows Server AD DS database and SYSVOL](#BKMK_PlaceDB): Add a data disk tooDCs running as Azure VMs in order toostore hello Windows Server Active Directory database, logs, and SYSVOL.</span></span>
* <span data-ttu-id="d6422-383">[Backup e ripristino](#BKMK_BUR): stabilire dove si desidera toostore backup dello stato del sistema.</span><span class="sxs-lookup"><span data-stu-id="d6422-383">[Backup and Restore](#BKMK_BUR): Determine where you want toostore system state backups.</span></span> <span data-ttu-id="d6422-384">Se necessario, aggiungere un altro disco toohello macchina virtuale controller di dominio toostore backup dei dati.</span><span class="sxs-lookup"><span data-stu-id="d6422-384">If necessary, add another data disk toohello DC VM toostore backups.</span></span>

### <span data-ttu-id="d6422-385"><a name="BKMK_CloudOnlyFed"></a>2 ADFS: estendere un toohello applicazione front-end locale in grado di riconoscere attestazioni Internet</span><span class="sxs-lookup"><span data-stu-id="d6422-385"><a name="BKMK_CloudOnlyFed"></a>2 AD FS: Extend a claims-aware on-premises front-end application toohello Internet</span></span>
<span data-ttu-id="d6422-386">![Federazione con connettività cross-premise](media/active-directory-deploying-ws-ad-guidelines/Federation_xprem.png)
**Figura 2**</span><span class="sxs-lookup"><span data-stu-id="d6422-386">![Federation with cross-premises connectivity](media/active-directory-deploying-ws-ad-guidelines/Federation_xprem.png)
**Figure 2**</span></span>

#### <a name="description"></a><span data-ttu-id="d6422-387">Descrizione</span><span class="sxs-lookup"><span data-stu-id="d6422-387">Description</span></span>
<span data-ttu-id="d6422-388">Un'applicazione in grado di riconoscere attestazioni distribuita correttamente in locale e utilizzata da utenti aziendali esigenze toobecome accessibile direttamente da Internet hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-388">A claims-aware application that has been successfully deployed on-premises and used by corporate users needs toobecome accessible directly from hello Internet.</span></span> <span data-ttu-id="d6422-389">un'applicazione Hello funge da un database SQL tooa di front-end web in cui memorizza i dati.</span><span class="sxs-lookup"><span data-stu-id="d6422-389">hello application serves as a web frontend tooa SQL database in which it stores data.</span></span> <span data-ttu-id="d6422-390">Hello SQL Server utilizzato da un'applicazione hello sono inoltre presenti nella rete aziendale hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-390">hello SQL servers used by hello application are also located on hello corporate network.</span></span> <span data-ttu-id="d6422-391">Due ruoli STS ADFS di Windows Server Active Directory e un bilanciamento del carico sono stati distribuiti in locale tooprovide accesso toohello aziendale gli utenti.</span><span class="sxs-lookup"><span data-stu-id="d6422-391">Two Windows Server AD FS STSs and a load-balancer have been deployed on-premises tooprovide access toohello corporate users.</span></span> <span data-ttu-id="d6422-392">a questo punto l'applicazione Hello deve toobe inoltre accessibile direttamente su Internet hello ai partner aziendali tramite le relative identità aziendali sia agli utenti aziendali esistenti.</span><span class="sxs-lookup"><span data-stu-id="d6422-392">hello application now needs toobe additionally accessed directly over hello Internet both by business partners using their own corporate identities and by existing corporate users.</span></span>

<span data-ttu-id="d6422-393">Toosimplify un impegno e alle esigenze di distribuzione e configurazione soddisfa hello di questo nuovo requisito, si è deciso che altre due web server front-end e due server proxy ADFS di Windows Server installato in macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-393">In an effort toosimplify and meet hello deployment and configuration needs of this new requirement, it is decided that two additional web frontends and two Windows Server AD FS proxy servers be installed on Azure virtual machines.</span></span> <span data-ttu-id="d6422-394">Tutte le quattro macchine virtuali sarà esposto direttamente toohello Internet e verrà fornita la rete locale di connettività toohello tramite la funzionalità VPN da sito a sito della rete virtuale Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-394">All four VMs will be exposed directly toohello Internet and will be provided connectivity toohello on-premises network using Azure Virtual Network’s site-to-site VPN capability.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-toohello-scenario"></a><span data-ttu-id="d6422-395">Considerazioni sullo scenario e come aree tecnologiche applicano toohello scenario</span><span class="sxs-lookup"><span data-stu-id="d6422-395">Scenario considerations and how technology areas apply toohello scenario</span></span>
* <span data-ttu-id="d6422-396">[Topologia di rete](#BKMK_NetworkTopology): creare una rete virtuale di Azure e [configurare la connettività cross-premise](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="d6422-396">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network and [configure cross-premises connectivity](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>
  
  > [!NOTE]
  > <span data-ttu-id="d6422-397">Per ognuno dei certificati di ADFS di Windows Server hello, verificare che hello URL definito nel modello di certificato hello e certificati risultanti hello sia raggiungibile da istanze di hello ADFS di Windows Server in esecuzione in Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-397">For each of hello Windows Server AD FS certificates, ensure that hello URL defined within hello certificate template and hello resulting certificates can be reached by hello Windows Server AD FS instances running on Azure.</span></span> <span data-ttu-id="d6422-398">Tale operazione potrebbe richiedere tooparts connettività cross-premise dell'infrastruttura PKI.</span><span class="sxs-lookup"><span data-stu-id="d6422-398">This may require cross-premises connectivity tooparts of your PKI infrastructure.</span></span> <span data-ttu-id="d6422-399">Ad esempio se l'endpoint di CRL hello è basata su LDAP e ospitati esclusivamente in locale, quindi la connettività cross-premise obbligatorio.</span><span class="sxs-lookup"><span data-stu-id="d6422-399">For example if hello CRL's endpoint is LDAP-based and hosted exclusively on-premises, then cross-premises connectivity will be required.</span></span> <span data-ttu-id="d6422-400">Se ciò non è opportuno, potrebbe essere necessario toouse certificati emessi da un'autorità di certificazione i cui CRL sono accessibili su Internet hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-400">If this is not desirable, it may be necessary toouse certificates issued by a CA whose CRL is accessible over hello Internet.</span></span>
  > 
  > 
* <span data-ttu-id="d6422-401">[Configurazione di servizi cloud](#BKMK_CloudSvcConfig): assicurarsi di avere due servizi cloud per fornire due indirizzi IP virtuali con carico bilanciato.</span><span class="sxs-lookup"><span data-stu-id="d6422-401">[Cloud services configuration](#BKMK_CloudSvcConfig): Ensure you have two cloud services in order provide two load-balanced virtual IP addresses.</span></span> <span data-ttu-id="d6422-402">indirizzo IP virtuale Hello del primo servizio cloud sarà indirizzato toohello proxy di ADFS di Windows Server due macchine virtuali sulle porte 80 e 443.</span><span class="sxs-lookup"><span data-stu-id="d6422-402">hello first cloud service’s virtual IP address will be directed toohello two Windows Server AD FS proxy VMs on ports 80 and 443.</span></span> <span data-ttu-id="d6422-403">Hello proxy ADFS di Windows Server che le macchine virtuali saranno toopoint toohello indirizzo IP configurato di hello locale bilanciamento del carico che risulterà hello ruoli STS ADFS di Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d6422-403">hello Windows Server AD FS proxy VMs will be configured toopoint toohello IP address of hello on-premises load-balancer that fronts hello Windows Server AD FS STSs.</span></span> <span data-ttu-id="d6422-404">indirizzo IP virtuale Hello del secondo servizio cloud verrà indirizzato toohello due macchine virtuali front-end web hello nuovamente sulle porte 80 e 443.</span><span class="sxs-lookup"><span data-stu-id="d6422-404">hello second cloud service’s virtual IP address will be directed toohello two VMs running hello web frontend again on ports 80 and 443.</span></span> <span data-ttu-id="d6422-405">Configurare un probe personalizzato tooensure hello bilanciamento del carico venga indirizzato solo il traffico toofunctioning ADFS di Windows Server proxy e web front-end le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="d6422-405">Configure a custom probe tooensure hello load-balancer only directs traffic toofunctioning Windows Server AD FS proxy and web frontend VMs.</span></span>
* <span data-ttu-id="d6422-406">[Configurazione del server federativo](#BKMK_FedSrvConfig): configurare ADFS di Windows Server come protezione toogenerate federation server (STS) i token per la foresta di Active Directory di Windows Server hello creata nel cloud hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-406">[Federation server configuration](#BKMK_FedSrvConfig): Configure Windows Server AD FS as a federation server (STS) toogenerate security tokens for hello Windows Server Active Directory forest created in hello cloud.</span></span> <span data-ttu-id="d6422-407">Impostare relazioni di trust federative attestazioni del provider con partner diversi di hello desiderato tooaccept le identità e configurare le relazioni di trust relying party con diverse applicazioni hello desiderato toogenerate i token.</span><span class="sxs-lookup"><span data-stu-id="d6422-407">Set federation claims provider trust relationships with hello different partners you wish tooaccept identities from, and configure relying party trust relationships with hello different applications you want toogenerate tokens to.</span></span>
  
    <span data-ttu-id="d6422-408">In quasi tutti gli scenari i server proxy AD FS di Windows Server vengono distribuiti in una soluzione con connessione Internet per motivi di sicurezza, mentre le relative controparti federative di AD FS di Windows Server rimangono isolate dalla connettività Internet diretta.</span><span class="sxs-lookup"><span data-stu-id="d6422-408">In most scenarios, Windows Server AD FS proxy servers are deployed in an Internet-facing capacity for security purposes while their Windows Server AD FS federation counterparts remain isolated from direct Internet connectivity.</span></span> <span data-ttu-id="d6422-409">Indipendentemente dal proprio scenario di distribuzione, è necessario configurare il servizio cloud con un indirizzo IP virtuale che fornirà un indirizzo IP esposto pubblicamente e una porta che è in grado di tooload bilanciamento tra le due istanze STS ADFS di Windows Server o le istanze di proxy.</span><span class="sxs-lookup"><span data-stu-id="d6422-409">Regardless of your deployment scenario, you must configure your cloud service with a virtual IP address that will provide a publicly exposed IP address and port that is able tooload-balance across either your two Windows Server AD FS STS instances or proxy instances.</span></span>
* <span data-ttu-id="d6422-410">[Configurazione della disponibilità elevata di Windows Server AD FS](#BKMK_ADFSHighAvail): è consigliabile toodeploy una farm ADFS di Windows Server con almeno due server per il failover e bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="d6422-410">[Windows Server AD FS high availability configuration](#BKMK_ADFSHighAvail): It is advisable toodeploy a Windows Server AD FS farm with at least two servers for failover and load balancing.</span></span> <span data-ttu-id="d6422-411">Si potrebbe essere necessario tooconsider utilizzando hello Windows Internal Database (WID) dei dati di configurazione di Windows Server AD FS e utilizzare hello interno funzionalità Bilanciamento del carico delle richieste in ingresso toodistribute Azure in server hello hello farm.</span><span class="sxs-lookup"><span data-stu-id="d6422-411">You might want tooconsider using hello Windows Internal Database (WID) for Windows Server AD FS configuration data, and use hello internal load balancing capability of Azure toodistribute incoming requests across hello servers in hello farm.</span></span>

<span data-ttu-id="d6422-412">Per ulteriori informazioni, vedere hello [Guida alla distribuzione di Active Directory](https://technet.microsoft.com/library/cc753963).</span><span class="sxs-lookup"><span data-stu-id="d6422-412">For more information, see hello [AD DS Deployment Guide](https://technet.microsoft.com/library/cc753963).</span></span>

### <span data-ttu-id="d6422-413"><a name="BKMK_HybridExt"></a>3. Servizi di dominio Active Directory: Distribuire un'applicazione di Windows Server AD DS-aware che richiede una rete aziendale toohello di connettività</span><span class="sxs-lookup"><span data-stu-id="d6422-413"><a name="BKMK_HybridExt"></a>3. AD DS: Deploy a Windows Server AD DS-aware application that requires connectivity toohello corporate network</span></span>
<span data-ttu-id="d6422-414">![Distribuzione di Servizi di dominio Active Directory cross-premise](media/active-directory-deploying-ws-ad-guidelines/ADDS_xprem.png)
**Figura 3**</span><span class="sxs-lookup"><span data-stu-id="d6422-414">![Cross-premises AD DS deployment](media/active-directory-deploying-ws-ad-guidelines/ADDS_xprem.png)
**Figure 3**</span></span>

#### <a name="description"></a><span data-ttu-id="d6422-415">Descrizione</span><span class="sxs-lookup"><span data-stu-id="d6422-415">Description</span></span>
<span data-ttu-id="d6422-416">Un'applicazione compatibile con LDAP viene distribuita in una macchina virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-416">An LDAP-aware application is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="d6422-417">Supporta l'autenticazione integrata di Windows e usa Servizi di dominio Active Directory di Windows Server come archivio per i dati di configurazione e del profilo utente.</span><span class="sxs-lookup"><span data-stu-id="d6422-417">It supports Windows-integrated authentication and uses Windows Server AD DS as a repository for configuration and user profile data.</span></span> <span data-ttu-id="d6422-418">obiettivo di Hello per hello tooleverage di applicazione hello DS di Windows Server Active Directory aziendale esistente e fornire accesso single sign-on.</span><span class="sxs-lookup"><span data-stu-id="d6422-418">hello goal is for hello application tooleverage hello existing corporate Windows Server AD DS and provide single sign-on.</span></span> <span data-ttu-id="d6422-419">un'applicazione Hello non è in grado di riconoscere attestazioni.</span><span class="sxs-lookup"><span data-stu-id="d6422-419">hello application is not claims-aware.</span></span> <span data-ttu-id="d6422-420">Gli utenti devono inoltre l'applicazione hello tooaccess direttamente da Internet hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-420">Users also need tooaccess hello application directly from hello Internet.</span></span> <span data-ttu-id="d6422-421">toooptimize per prestazioni e costi, si è deciso di distribuire due controller di dominio aggiuntivi che fanno parte del dominio aziendale hello insieme a un'applicazione hello in Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-421">toooptimize for performance and cost, it is decided that two additional domain controllers that are part of hello corporate domain be deployed alongside hello application on Azure.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-toohello-scenario"></a><span data-ttu-id="d6422-422">Considerazioni sullo scenario e come aree tecnologiche applicano toohello scenario</span><span class="sxs-lookup"><span data-stu-id="d6422-422">Scenario considerations and how technology areas apply toohello scenario</span></span>
* <span data-ttu-id="d6422-423">[Topologia di rete](#BKMK_NetworkTopology): creare una rete virtuale di Azure con la [connettività cross-premise](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="d6422-423">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network with [cross-premises connectivity](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>
* <span data-ttu-id="d6422-424">[Metodo di installazione](#BKMK_InstallMethod): distribuire controller di dominio di replica dal dominio di Windows Server Active Directory aziendale hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-424">[Installation method](#BKMK_InstallMethod): Deploy replica DCs from hello corporate Windows Server Active Directory domain.</span></span> <span data-ttu-id="d6422-425">Per un controller di dominio di replica, è possibile installare servizi di dominio di Windows Server Active Directory in hello VM e, facoltativamente, utilizzare hello installa da supporto funzionalità tooreduce hello quantità di dati che devono toobe replicati toohello nuovo controller di dominio durante l'installazione.</span><span class="sxs-lookup"><span data-stu-id="d6422-425">For a replica DC, you can install Windows Server AD DS on hello VM, and optionally use hello Install From Media (IFM) feature tooreduce hello amount of data that needs toobe replicated toohello new DC during installation.</span></span> <span data-ttu-id="d6422-426">Per un'esercitazione, vedere [Installazione di un controller di dominio Active Directory di replica in una rete virtuale di Azure](active-directory-install-replica-active-directory-domain-controller.md).</span><span class="sxs-lookup"><span data-stu-id="d6422-426">For a tutorial, see [Install a replica Active Directory domain controller on Azure](active-directory-install-replica-active-directory-domain-controller.md).</span></span> <span data-ttu-id="d6422-427">Anche se si utilizza l'installazione da supporto, potrebbe essere più efficiente hello toobuild controller di dominio virtuale locale e spostare hello intero disco rigido virtuale (VHD) toohello cloud anziché replicare servizi di dominio di Windows Server Active Directory durante l'installazione.</span><span class="sxs-lookup"><span data-stu-id="d6422-427">Even if you use IFM, it may be more efficient toobuild hello virtual DC on-premises and move hello entire Virtual Hard Disk (VHD) toohello cloud instead of replicating Windows Server AD DS during installation.</span></span> <span data-ttu-id="d6422-428">Per motivi di sicurezza, è consigliabile eliminare hello disco rigido virtuale dalla rete locale hello dopo che è stato copiato tooAzure.</span><span class="sxs-lookup"><span data-stu-id="d6422-428">For safety, it is recommended that you delete hello VHD from hello on-premises network once it has been copied tooAzure.</span></span>
* <span data-ttu-id="d6422-429">[Topologia del sito Active Directory di Windows Server](#BKMK_ADSiteTopology): creare un nuovo sito di Azure in Siti e servizi di Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d6422-429">[Windows Server Active Directory site topology](#BKMK_ADSiteTopology): Create a new Azure site in Active Directory Sites and Services.</span></span> <span data-ttu-id="d6422-430">Creare un hello di toorepresent di oggetto subnet rete virtuale di Azure Active Directory di Windows Server e aggiungere hello subnet toohello sito.</span><span class="sxs-lookup"><span data-stu-id="d6422-430">Create a Windows Server Active Directory subnet object toorepresent hello Azure virtual network and add hello subnet toohello site.</span></span> <span data-ttu-id="d6422-431">Creare un nuovo collegamento di sito che include hello nuovo sito di Azure e il sito di hello in cui hello Azure endpoint VPN della rete virtuale si trova in ordine toocontrol e ottimizza tooand il traffico di Windows Server Active Directory da Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-431">Create a new site link that includes hello new Azure site and hello site in which hello Azure virtual network VPN endpoint is located in order toocontrol and optimize Windows Server Active Directory traffic tooand from Azure.</span></span>
* <span data-ttu-id="d6422-432">[Indirizzamento IP e DNS](#BKMK_IPAddressDNS):</span><span class="sxs-lookup"><span data-stu-id="d6422-432">[IP addressing and DNS](#BKMK_IPAddressDNS):</span></span>
  
  * <span data-ttu-id="d6422-433">Impostare un indirizzo IP statico per hello controller di dominio utilizzando cmdlet Set-AzureStaticVNetIP di Azure PowerShell hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-433">Set a static IP address for hello DC by using hello Set-AzureStaticVNetIP Azure PowerShell cmdlet.</span></span>
  * <span data-ttu-id="d6422-434">Installare e configurare DNS di Windows Server nei controller di dominio hello in Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-434">Install and configure Windows Server DNS on hello domain controller(s) on Azure.</span></span>
  * <span data-ttu-id="d6422-435">Configurare le proprietà di rete virtuale hello con nome hello e l'indirizzo IP di macchina virtuale che ospita i ruoli del server DNS e controller di dominio hello hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-435">Configure hello virtual network properties with hello name and IP address of hello VM that hosts hello DC and DNS server roles.</span></span>
* <span data-ttu-id="d6422-436">[Controller di dominio con distribuzione geografica](#BKMK_DistributedDCs): configurare reti virtuali aggiuntive in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="d6422-436">[Geo-distributed DCs](#BKMK_DistributedDCs): Configure additional virtual networks as needed.</span></span> <span data-ttu-id="d6422-437">Se la topologia del sito di Active Directory richiede un controller di dominio in aree geografiche che corrispondono toodifferent Azure aree, rispetto a quelle desidera toocreate siti di Active Directory, di conseguenza.</span><span class="sxs-lookup"><span data-stu-id="d6422-437">If your Active Directory site topology requires DCs in geographies that correspond toodifferent Azure regions, than you want toocreate Active Directory sites accordingly.</span></span>
* <span data-ttu-id="d6422-438">[I controller di dominio di sola lettura](#BKMK_RODC): È possibile distribuire un controller di dominio nel sito di Azure hello, a seconda dei requisiti per l'esecuzione le operazioni di scrittura su hello compatibilità hello e controller di dominio di applicazioni e servizi nel sito di hello con controller.</span><span class="sxs-lookup"><span data-stu-id="d6422-438">[Read-only DCs](#BKMK_RODC): You might deploy an RODC in hello Azure site, depending on your requirements for performing write operations against hello DC and hello compatibility of applications and services in hello site with RODCs.</span></span> <span data-ttu-id="d6422-439">Per ulteriori informazioni sulla compatibilità delle applicazioni, vedere hello [Guida compatibilità dell'applicazione controller di dominio di sola lettura](https://technet.microsoft.com/library/cc755190).</span><span class="sxs-lookup"><span data-stu-id="d6422-439">For more information about application compatibility, see hello [Read-Only domain controllers application compatibility guide](https://technet.microsoft.com/library/cc755190).</span></span>
* <span data-ttu-id="d6422-440">[Catalogo globale](#BKMK_GC): i cataloghi globali sono necessari tooservice le richieste di accesso in foreste multidominio.</span><span class="sxs-lookup"><span data-stu-id="d6422-440">[Global Catalog](#BKMK_GC): GCs are needed tooservice logon requests in multidomain forests.</span></span> <span data-ttu-id="d6422-441">Se non si distribuisce un catalogo globale nel sito di Azure hello, si incorrerà in costi di traffico in uscita come le richieste di autenticazione vengono generate query sui cataloghi globali in altri siti.</span><span class="sxs-lookup"><span data-stu-id="d6422-441">If you do not deploy a GC in hello Azure site, you will incur egress traffic costs as authentication requests cause queries GCs in other sites.</span></span> <span data-ttu-id="d6422-442">toominimize che il traffico, è possibile abilitare la memorizzazione nella cache di hello Azure sito in Active Directory, siti e servizi di appartenenza a gruppi universali.</span><span class="sxs-lookup"><span data-stu-id="d6422-442">toominimize that traffic, you can enable universal group membership caching for hello Azure site in Active Directory Sites and Services.</span></span>
  
    <span data-ttu-id="d6422-443">Se si distribuisce un catalogo globale, configurare i collegamenti di sito e i costi di collegamenti di sito in modo che GC hello in hello Azure site non sia scelto come un controller di dominio di origine preferito da altri cataloghi globali che devono tooreplicate hello stesse partizioni di dominio parziali.</span><span class="sxs-lookup"><span data-stu-id="d6422-443">If you deploy a GC, configure site links and site links costs so that hello GC in hello Azure site is not preferred as a source DC by other GCs that need tooreplicate hello same partial domain partitions.</span></span>
* <span data-ttu-id="d6422-444">[Posizione del database hello servizi di dominio di Windows Server Active Directory e SYSVOL](#BKMK_PlaceDB): aggiungere un tooDCs disco dati in esecuzione in macchine virtuali di Azure in ordine toostore hello Active Directory di Windows Server database, registri e SYSVOL.</span><span class="sxs-lookup"><span data-stu-id="d6422-444">[Placement of hello Windows Server AD DS database and SYSVOL](#BKMK_PlaceDB): Add a data disk tooDCs running on Azure VMs in order toostore hello Windows Server Active Directory database, logs, and SYSVOL.</span></span>
* <span data-ttu-id="d6422-445">[Backup e ripristino](#BKMK_BUR): stabilire dove si desidera toostore backup dello stato del sistema.</span><span class="sxs-lookup"><span data-stu-id="d6422-445">[Backup and Restore](#BKMK_BUR): Determine where you want toostore system state backups.</span></span> <span data-ttu-id="d6422-446">Se necessario, aggiungere un altro disco toohello macchina virtuale controller di dominio toostore backup dei dati.</span><span class="sxs-lookup"><span data-stu-id="d6422-446">If necessary, add another data disk toohello DC VM toostore backups.</span></span>

## <a name="deployment-decisions-and-factors"></a><span data-ttu-id="d6422-447">Decisioni e fattori relativi alla distribuzione</span><span class="sxs-lookup"><span data-stu-id="d6422-447">Deployment decisions and factors</span></span>
<span data-ttu-id="d6422-448">Questa tabella riepiloga le aree tecnologiche di Active Directory di Windows Server hello che sono interessate in scenari precedenti hello e hello corrispondente tooconsider decisioni, con collegamenti toomore seguito.</span><span class="sxs-lookup"><span data-stu-id="d6422-448">This table summarizes hello Windows Server Active Directory technology areas that are impacted in hello preceding scenarios and hello corresponding decisions tooconsider, with links toomore detail below.</span></span> <span data-ttu-id="d6422-449">Alcune aree tecnologiche potrebbero non essere applicabile tooevery scenario di distribuzione e alcune aree tecnologiche potrebbero essere uno scenario di distribuzione tooa prioritaria rispetto ad altre.</span><span class="sxs-lookup"><span data-stu-id="d6422-449">Some technology areas might not be applicable tooevery deployment scenario, and some technology areas might be more critical tooa deployment scenario than other technology areas.</span></span>

<span data-ttu-id="d6422-450">Ad esempio, se si distribuisce una controller di dominio di replica in una rete virtuale e la foresta dispone di un solo dominio, scegliendo toodeploy un server di catalogo globale in questo caso non sarà critica toohello scenario di distribuzione perché non creerà qualsiasi replica aggiuntive requisiti.</span><span class="sxs-lookup"><span data-stu-id="d6422-450">For example, if you deploy a replica DC on a virtual network and your forest has only a single domain, then choosing toodeploy a global catalog server in that case will not be critical toohello deployment scenario because it will not create any additional replication requirements.</span></span> <span data-ttu-id="d6422-451">In hello altra parte, se la foresta hello dispone di più domini, quindi hello decisione toodeploy un catalogo globale in una rete virtuale possono influire sulla larghezza di banda disponibile, prestazioni, l'autenticazione, ricerche nella directory e così via.</span><span class="sxs-lookup"><span data-stu-id="d6422-451">On hello other hand, if hello forest has several domains, then hello decision toodeploy a global catalog on a virtual network could affect available bandwidth, performance, authentication, directory lookups, and so on.</span></span>

| <span data-ttu-id="d6422-452">Active Directory di Windows Server in macchine virtuali di Azure</span><span class="sxs-lookup"><span data-stu-id="d6422-452">Windows Server Active Directory technology area</span></span> | <span data-ttu-id="d6422-453">Decisioni</span><span class="sxs-lookup"><span data-stu-id="d6422-453">Decisions</span></span> | <span data-ttu-id="d6422-454">Fattori</span><span class="sxs-lookup"><span data-stu-id="d6422-454">Factors</span></span> |
| --- | --- | --- |
| [<span data-ttu-id="d6422-455">Topologia di rete</span><span class="sxs-lookup"><span data-stu-id="d6422-455">Network topology</span></span>](#BKMK_NetworkTopology) |<span data-ttu-id="d6422-456">Si crea una rete virtuale?</span><span class="sxs-lookup"><span data-stu-id="d6422-456">Do you create a virtual network?</span></span> |<li><span data-ttu-id="d6422-457">Requisiti tooaccess alle risorse aziendali</span><span class="sxs-lookup"><span data-stu-id="d6422-457">Requirements tooaccess Corp resources</span></span></li> <li><span data-ttu-id="d6422-458">Autenticazione</span><span class="sxs-lookup"><span data-stu-id="d6422-458">Authentication</span></span></li> <li><span data-ttu-id="d6422-459">Account Management</span><span class="sxs-lookup"><span data-stu-id="d6422-459">Account management</span></span></li> |
| [<span data-ttu-id="d6422-460">Configurazione della distribuzione di un controller di dominio</span><span class="sxs-lookup"><span data-stu-id="d6422-460">DC deployment configuration</span></span>](#BKMK_DeploymentConfig) |<li><span data-ttu-id="d6422-461">Distribuire una foresta separata senza trust?</span><span class="sxs-lookup"><span data-stu-id="d6422-461">Deploy a separate forest without any trusts?</span></span></li> <li><span data-ttu-id="d6422-462">Distribuire una nuova foresta con federazione?</span><span class="sxs-lookup"><span data-stu-id="d6422-462">Deploy a new forest with federation?</span></span></li> <li><span data-ttu-id="d6422-463">Distribuire una nuova foresta con trust tra foreste di Active Directory di Windows Server o Kerberos?</span><span class="sxs-lookup"><span data-stu-id="d6422-463">Deploy a new forest with Windows Server Active Directory forest trust or Kerberos?</span></span></li> <li><span data-ttu-id="d6422-464">Estendere la foresta aziendale distribuendo una controller di dominio di replica?</span><span class="sxs-lookup"><span data-stu-id="d6422-464">Extend Corp forest by deploying a replica DC?</span></span></li> <li><span data-ttu-id="d6422-465">Estendere la foresta aziendale distribuendo un nuovo dominio figlio o albero di dominio?</span><span class="sxs-lookup"><span data-stu-id="d6422-465">Extend Corp forest by deploying a new child domain or domain tree?</span></span></li> |<li><span data-ttu-id="d6422-466">Sicurezza</span><span class="sxs-lookup"><span data-stu-id="d6422-466">Security</span></span></li> <li><span data-ttu-id="d6422-467">Conformità</span><span class="sxs-lookup"><span data-stu-id="d6422-467">Compliance</span></span></li> <li><span data-ttu-id="d6422-468">Costi</span><span class="sxs-lookup"><span data-stu-id="d6422-468">Cost</span></span></li> <li><span data-ttu-id="d6422-469">Resilienza e tolleranza di errore</span><span class="sxs-lookup"><span data-stu-id="d6422-469">Resiliency and fault-tolerance</span></span></li> <li><span data-ttu-id="d6422-470">Compatibilità tra le versioni</span><span class="sxs-lookup"><span data-stu-id="d6422-470">Application compatibility</span></span></li> |
| [<span data-ttu-id="d6422-471">Topologia del sito Active Directory di Windows Server</span><span class="sxs-lookup"><span data-stu-id="d6422-471">Windows Server Active Directory site topology</span></span>](#BKMK_ADSiteTopology) |<span data-ttu-id="d6422-472">Come si configurare subnet, siti e collegamenti di sito con il traffico di rete virtuale di Azure toooptimize e ridurre al minimo il costo?</span><span class="sxs-lookup"><span data-stu-id="d6422-472">How do you configure subnets, sites, and site links with Azure Virtual Network toooptimize traffic and minimize cost?</span></span> |<li><span data-ttu-id="d6422-473">Definizioni di sito e subnet</span><span class="sxs-lookup"><span data-stu-id="d6422-473">Subnet and site definitions</span></span></li> <li><span data-ttu-id="d6422-474">Proprietà dei collegamenti di sito e notifica delle modifiche</span><span class="sxs-lookup"><span data-stu-id="d6422-474">Site link properties and change notification</span></span></li> <li><span data-ttu-id="d6422-475">Compressione della replica</span><span class="sxs-lookup"><span data-stu-id="d6422-475">Replication compression</span></span></li> |
| [<span data-ttu-id="d6422-476">Indirizzamento IP e DNS</span><span class="sxs-lookup"><span data-stu-id="d6422-476">IP addressing and DNS</span></span>](#BKMK_IPAddressDNS) |<span data-ttu-id="d6422-477">Come indirizzi IP tooconfigure e la risoluzione dei nomi?</span><span class="sxs-lookup"><span data-stu-id="d6422-477">How tooconfigure IP addresses and name resolution?</span></span> |<li><span data-ttu-id="d6422-478">Utilizzare hello cmdlet Set-AzureStaticVNetIP di utilizzare hello tooassign un indirizzo IP statico</span><span class="sxs-lookup"><span data-stu-id="d6422-478">Use hello Use hello Set-AzureStaticVNetIP cmdlet tooassign a static IP address</span></span></li> <li><span data-ttu-id="d6422-479">Installare il server DNS di Windows Server e configurare le proprietà di rete virtuale hello con nome hello e l'indirizzo IP di macchina virtuale che ospita i ruoli del server DNS e controller di dominio hello hello</span><span class="sxs-lookup"><span data-stu-id="d6422-479">Install Windows Server DNS server and configure hello virtual network properties with hello name and IP address of hello VM that hosts hello DC and DNS server roles</span></span></li> |
| [<span data-ttu-id="d6422-480">Controller di dominio con distribuzione geografica</span><span class="sxs-lookup"><span data-stu-id="d6422-480">Geo-distributed DCs</span></span>](#BKMK_DistributedDCs) |<span data-ttu-id="d6422-481">TooDCs tooreplicate su separati come reti virtuali?</span><span class="sxs-lookup"><span data-stu-id="d6422-481">How tooreplicate tooDCs on separate virtual networks?</span></span> |<span data-ttu-id="d6422-482">Se la topologia del sito di Active Directory richiede un controller di dominio in aree geografiche corrispondente toodifferent Azure aree, rispetto a quelle desidera toocreate siti di Active Directory, di conseguenza.</span><span class="sxs-lookup"><span data-stu-id="d6422-482">If your Active Directory site topology requires DCs in geographies that corresponds toodifferent Azure regions, than you want toocreate Active Directory sites accordingly.</span></span> <span data-ttu-id="d6422-483">[Configurare la rete virtuale toovirtual rete connettività](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) tooreplicate tra controller di dominio in reti virtuali separate.</span><span class="sxs-lookup"><span data-stu-id="d6422-483">[Configure virtual network toovirtual network Connectivity](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) tooreplicate between domain controllers on separate virtual networks.</span></span> |
| [<span data-ttu-id="d6422-484">Controller di dominio di sola lettura</span><span class="sxs-lookup"><span data-stu-id="d6422-484">Read-only DCs</span></span>](#BKMK_RODC) |<span data-ttu-id="d6422-485">Usare controller di dominio di sola lettura o scrivibili?</span><span class="sxs-lookup"><span data-stu-id="d6422-485">Use read-only or writeable DCs?</span></span> |<li><span data-ttu-id="d6422-486">Filtrare gli attributi HBI/PII</span><span class="sxs-lookup"><span data-stu-id="d6422-486">Filter HBI/PII attributes</span></span></li> <li><span data-ttu-id="d6422-487">Filtrare le chiavi private</span><span class="sxs-lookup"><span data-stu-id="d6422-487">Filter secrets</span></span></li> <li><span data-ttu-id="d6422-488">Limitare il traffico in uscita</span><span class="sxs-lookup"><span data-stu-id="d6422-488">Limit outbound traffic</span></span></li> |
| [<span data-ttu-id="d6422-489">Catalogo globale</span><span class="sxs-lookup"><span data-stu-id="d6422-489">Global catalog</span></span>](#BKMK_GC) |<span data-ttu-id="d6422-490">Installare il catalogo globale?</span><span class="sxs-lookup"><span data-stu-id="d6422-490">Install global catalog?</span></span> |<li><span data-ttu-id="d6422-491">Per una foresta con dominio singolo, convertire tutti i controller di dominio in cataloghi globali</span><span class="sxs-lookup"><span data-stu-id="d6422-491">For single-domain forest, make all DCs GCs</span></span></li> <li><span data-ttu-id="d6422-492">Per una foresta a più domini, i cataloghi globali sono necessari per l'autenticazione</span><span class="sxs-lookup"><span data-stu-id="d6422-492">For multidomain forest, GCs are required for authentication</span></span></li> |
| [<span data-ttu-id="d6422-493">Metodo di installazione</span><span class="sxs-lookup"><span data-stu-id="d6422-493">Installation method</span></span>](#BKMK_InstallMethod) |<span data-ttu-id="d6422-494">Come tooinstall controller di dominio in Azure?</span><span class="sxs-lookup"><span data-stu-id="d6422-494">How tooinstall DC in Azure?</span></span> |<span data-ttu-id="d6422-495">È possibile: </span><span class="sxs-lookup"><span data-stu-id="d6422-495">Either:</span></span> <li><span data-ttu-id="d6422-496">Installare Servizi di dominio Active Directory usando Windows PowerShell o Dcpromo</span><span class="sxs-lookup"><span data-stu-id="d6422-496">Install AD DS using Windows PowerShell or Dcpromo</span></span></li> <li><span data-ttu-id="d6422-497">Spostare il disco rigido virtuale di un controller di dominio virtuale locale</span><span class="sxs-lookup"><span data-stu-id="d6422-497">Move VHD of an on-premises virtual DC</span></span></li> |
| [<span data-ttu-id="d6422-498">Posizione del database hello servizi di dominio di Windows Server Active Directory e SYSVOL</span><span class="sxs-lookup"><span data-stu-id="d6422-498">Placement of hello Windows Server AD DS database and SYSVOL</span></span>](#BKMK_PlaceDB) |<span data-ttu-id="d6422-499">Dove toostore servizi di dominio di Windows Server Active Directory di database, log e SYSVOL?</span><span class="sxs-lookup"><span data-stu-id="d6422-499">Where toostore Windows Server AD DS database, logs, and SYSVOL?</span></span> |<span data-ttu-id="d6422-500">Modificare i valori predefiniti di Dcpromo.exe.</span><span class="sxs-lookup"><span data-stu-id="d6422-500">Change Dcpromo.exe default values.</span></span> <span data-ttu-id="d6422-501">Questi file critici di Active Directory *devono* trovarsi su dischi dati di Azure invece che su dischi del sistema operativo che implementano la memorizzazione nella cache in scrittura.</span><span class="sxs-lookup"><span data-stu-id="d6422-501">These critical Active Directory files *must* be placed on Azure Data Disks instead of Operating System disks that implement write caching.</span></span> |
| [<span data-ttu-id="d6422-502">Backup e ripristino</span><span class="sxs-lookup"><span data-stu-id="d6422-502">Backup and Restore</span></span>](#BKMK_BUR) |<span data-ttu-id="d6422-503">Come toosafeguard e il recupero dei dati?</span><span class="sxs-lookup"><span data-stu-id="d6422-503">How toosafeguard and recover data?</span></span> |<span data-ttu-id="d6422-504">Creare backup dello stato del sistema.</span><span class="sxs-lookup"><span data-stu-id="d6422-504">Create system state backups</span></span> |
| [<span data-ttu-id="d6422-505">Configurazione del server federativo</span><span class="sxs-lookup"><span data-stu-id="d6422-505">Federation server configuration</span></span>](#BKMK_FedSrvConfig) |<li><span data-ttu-id="d6422-506">Distribuire una nuova foresta con federazione nel cloud hello?</span><span class="sxs-lookup"><span data-stu-id="d6422-506">Deploy a new forest with federation in hello cloud?</span></span></li> <li><span data-ttu-id="d6422-507">Distribuire ADFS locale ed esporre un proxy nel cloud hello?</span><span class="sxs-lookup"><span data-stu-id="d6422-507">Deploy AD FS on-premises and expose a proxy in hello cloud?</span></span></li> |<li><span data-ttu-id="d6422-508">Sicurezza</span><span class="sxs-lookup"><span data-stu-id="d6422-508">Security</span></span></li> <li><span data-ttu-id="d6422-509">Conformità</span><span class="sxs-lookup"><span data-stu-id="d6422-509">Compliance</span></span></li> <li><span data-ttu-id="d6422-510">Costi</span><span class="sxs-lookup"><span data-stu-id="d6422-510">Cost</span></span></li> <li><span data-ttu-id="d6422-511">Accesso tooapplications ai partner aziendali</span><span class="sxs-lookup"><span data-stu-id="d6422-511">Access tooapplications by business partners</span></span></li> |
| [<span data-ttu-id="d6422-512">Configurazione di servizi cloud</span><span class="sxs-lookup"><span data-stu-id="d6422-512">Cloud services configuration</span></span>](#BKMK_CloudSvcConfig) |<span data-ttu-id="d6422-513">Un servizio cloud viene distribuito in modo implicito hello prima volta che si crea una macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="d6422-513">A cloud service is implicitly deployed hello first time you create a virtual machine.</span></span> <span data-ttu-id="d6422-514">È necessario servizi cloud aggiuntivi toodeploy?</span><span class="sxs-lookup"><span data-stu-id="d6422-514">Do you need toodeploy additional cloud services?</span></span> |<li><span data-ttu-id="d6422-515">Macchine virtuali o una macchina virtuale richiede l'esposizione diretta toohello Internet?</span><span class="sxs-lookup"><span data-stu-id="d6422-515">Does a VM or VMs require direct exposure toohello Internet?</span></span></li> <li> <span data-ttu-id="d6422-516">Servizio hello richiede il bilanciamento del carico?</span><span class="sxs-lookup"><span data-stu-id="d6422-516">Does hello service require load-balancing?</span></span></li> |
| [<span data-ttu-id="d6422-517">Requisiti del server federativo per l'indirizzamento IP pubblico e privato (confronto tra indirizzo IP dinamico e indirizzo IP virtuale)</span><span class="sxs-lookup"><span data-stu-id="d6422-517">Federation server requirements for public and private IP addressing (dynamic IP vs. virtual IP)</span></span>](#BKMK_FedReqVIPDIP) |<li><span data-ttu-id="d6422-518">Istanza di ADFS di Windows Server hello necessita toobe raggiungibile direttamente da Internet hello?</span><span class="sxs-lookup"><span data-stu-id="d6422-518">Does hello Windows Server AD FS instance need toobe reached directly from hello Internet?</span></span></li> <li><span data-ttu-id="d6422-519">L'applicazione hello distribuita nel cloud hello richiede il proprio indirizzo IP con connessione Internet e la porta?</span><span class="sxs-lookup"><span data-stu-id="d6422-519">Does hello application being deployed in hello cloud require its own Internet-facing IP address and port?</span></span></li> |<span data-ttu-id="d6422-520">Creare un servizio cloud per ogni indirizzo IP virtuale necessario per la distribuzione</span><span class="sxs-lookup"><span data-stu-id="d6422-520">Create one cloud-service for each virtual IP address that is required by your deployment</span></span> |
| [<span data-ttu-id="d6422-521">Configurazione con disponibilità elevata di AD FS di Windows Server</span><span class="sxs-lookup"><span data-stu-id="d6422-521">Windows Server AD FS high availability configuration</span></span>](#BKMK_ADFSHighAvail) |<li><span data-ttu-id="d6422-522">Quanti nodi sono necessari nella server farm AD FS di Windows Server?</span><span class="sxs-lookup"><span data-stu-id="d6422-522">How many nodes in my Windows Server AD FS server farm?</span></span></li> <li><span data-ttu-id="d6422-523">Toodeploy il numero di nodi nella farm Windows Server AD FS proxy?</span><span class="sxs-lookup"><span data-stu-id="d6422-523">How many nodes toodeploy in my Windows Server AD FS proxy farm?</span></span></li> |<span data-ttu-id="d6422-524">Resilienza e tolleranza di errore</span><span class="sxs-lookup"><span data-stu-id="d6422-524">Resiliency and fault tolerance</span></span> |

### <span data-ttu-id="d6422-525"><a name="BKMK_NetworkTopology"></a>Topologia di rete</span><span class="sxs-lookup"><span data-stu-id="d6422-525"><a name="BKMK_NetworkTopology"></a>Network topology</span></span>
<span data-ttu-id="d6422-526">Coerenza di indirizzi IP hello toomeet ordine e i requisiti DNS di dominio Active Directory di Windows Server Active Directory, è necessario creare toofirst un [rete virtuale di Azure](../virtual-network/virtual-networks-overview.md) e allegare il tooit macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="d6422-526">In order toomeet hello IP address consistency and DNS requirements of Windows Server AD DS, it is necessary toofirst create an [Azure virtual network](../virtual-network/virtual-networks-overview.md) and attach your virtual machines tooit.</span></span> <span data-ttu-id="d6422-527">Durante la creazione, è necessario decidere se toooptionally estendere connettività tooyour locali aziendali rete, che connette in modo trasparente virtuali di Azure macchine macchine tooon locali, questa operazione viene eseguita utilizzando le tecnologie VPN tradizionali e richiede l'esposizione di un endpoint VPN sul perimetro di hello della rete aziendale di hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-527">During its creation, you must decide whether toooptionally extend connectivity tooyour on-premises corporate network, which transparently connects Azure virtual machines tooon-premises machines — this is achieved using traditional VPN technologies and requires that a VPN endpoint be exposed on hello edge of hello corporate network.</span></span> <span data-ttu-id="d6422-528">Hello VPN viene avviata dalla rete aziendale di Azure toohello, non viceversa.</span><span class="sxs-lookup"><span data-stu-id="d6422-528">That is, hello VPN is initiated from Azure toohello corporate network, not vice-versa.</span></span>

<span data-ttu-id="d6422-529">Si noti che i costi aggiuntivi si applicano quando si estende una rete locale di rete virtuale tooyour oltre hello addebiti standard tooeach macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="d6422-529">Note that additional charges apply when extending a virtual network tooyour on-premises network beyond hello standard charges that apply tooeach VM.</span></span> <span data-ttu-id="d6422-530">In particolare, vi sono addebiti per il tempo di CPU del gateway di rete virtuale di Azure hello e per il traffico in uscita hello generati da ogni macchina virtuale che comunica con il computer locale tramite VPN hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-530">Specifically, there are charges for CPU time of hello Azure Virtual Network gateway and for hello egress traffic generated by each VM that communicates with on-premises machines across hello VPN.</span></span> <span data-ttu-id="d6422-531">Per altre informazioni sugli addebiti per il traffico di rete, vedere [Prezzi di Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="d6422-531">For more information about network traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>

### <span data-ttu-id="d6422-532"><a name="BKMK_DeploymentConfig"></a>Configurazione della distribuzione di un controller di dominio</span><span class="sxs-lookup"><span data-stu-id="d6422-532"><a name="BKMK_DeploymentConfig"></a>DC deployment configuration</span></span>
<span data-ttu-id="d6422-533">modalità di Hello configurazione hello controller di dominio dipende dai requisiti di hello per hello del servizio è necessario toorun in Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-533">hello way you configure hello DC depends on hello requirements for hello service you want toorun on Azure.</span></span> <span data-ttu-id="d6422-534">Ad esempio, è possibile distribuire una nuova foresta, isolata dalla propria foresta aziendale, per il testing proof of concept, una nuova applicazione o un altro progetto a breve termine che richiede i servizi di directory ma alle risorse aziendali toointernal non specifiche di accesso.</span><span class="sxs-lookup"><span data-stu-id="d6422-534">For example, you might deploy a new forest, isolated from your own corporate forest, for testing a proof-of-concept, a new application, or some other short term project that requires directory services but not specific access toointernal corporate resources.</span></span>

<span data-ttu-id="d6422-535">Il vantaggio, una foresta isolata che con non viene replicato i controller di dominio locale i controller di dominio, causando il traffico di rete in uscita generato dal sistema hello, direttamente riducendo i costi.</span><span class="sxs-lookup"><span data-stu-id="d6422-535">As a benefit, an isolated forest DC does not replicate with on-premises DCs, resulting in less outbound network traffic generated by hello system itself, directly reducing costs.</span></span> <span data-ttu-id="d6422-536">Per altre informazioni sugli addebiti per il traffico di rete, vedere [Prezzi di Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="d6422-536">For more information about network traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>

<span data-ttu-id="d6422-537">Ad esempio, si supponga che i requisiti sulla privacy per un servizio, ma dipende dal servizio hello tooyour accesso interno Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d6422-537">As another example, suppose you have privacy requirements for a service, but hello service depends on access tooyour internal Windows Server Active Directory.</span></span> <span data-ttu-id="d6422-538">Se è consentito toohost dati per il servizio di hello in hello cloud, è possibile distribuire un nuovo dominio figlio per la foresta interna in Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-538">If you are allowed toohost data for hello service in hello cloud, you might deploy a new child domain for your internal forest on Azure.</span></span> <span data-ttu-id="d6422-539">In questo caso, è possibile distribuire un controller di dominio nuovo dominio figlio hello (senza catalogo globale di hello in problemi di privacy indirizzo toohelp ordine).</span><span class="sxs-lookup"><span data-stu-id="d6422-539">In this case, you can deploy a DC for hello new child domain (without hello global catalog in order toohelp address privacy concerns).</span></span> <span data-ttu-id="d6422-540">Questo scenario richiede una rete virtuale per la connettività ai controller di dominio locali, insieme alla distribuzione di un controller di dominio di replica.</span><span class="sxs-lookup"><span data-stu-id="d6422-540">This scenario, along with a replica DC deployment, requires a virtual network for connectivity with your on-premises DCs.</span></span>

<span data-ttu-id="d6422-541">Se si crea una nuova foresta, scegliere se toouse [e trust di Active Directory](https://technet.microsoft.com/library/cc771397) o [relazioni di trust federative](https://technet.microsoft.com/library/dd807036).</span><span class="sxs-lookup"><span data-stu-id="d6422-541">If you create a new forest, choose whether toouse [Active Directory trusts](https://technet.microsoft.com/library/cc771397) or [Federation trusts](https://technet.microsoft.com/library/dd807036).</span></span> <span data-ttu-id="d6422-542">Bilanciare l'esigenza di hello dipende dalla compatibilità, sicurezza, conformità, costo e resilienza.</span><span class="sxs-lookup"><span data-stu-id="d6422-542">Balance hello requirements dictated by compatibility, security, compliance, cost, and resiliency.</span></span> <span data-ttu-id="d6422-543">Ad esempio, tootake sfruttare [autenticazione selettiva](https://technet.microsoft.com/library/cc755844) si potrebbe scegliere toodeploy una nuova foresta in Azure e creare un trust di Active Directory di Windows Server tra foresta locale di hello e hello cloud.</span><span class="sxs-lookup"><span data-stu-id="d6422-543">For example, tootake advantage of [selective authentication](https://technet.microsoft.com/library/cc755844) you might choose toodeploy a new forest on Azure and create a Windows Server Active Directory trust between hello on-premises forest and hello cloud forest.</span></span> <span data-ttu-id="d6422-544">Se l'applicazione hello è in grado di riconoscere attestazioni, tuttavia, è possibile distribuire trust federativi anziché trust tra foreste di Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d6422-544">If hello application is claims-aware, however, you might deploy federation trusts instead of Active Directory forest trusts.</span></span> <span data-ttu-id="d6422-545">Un altro fattore verrà hello costo tooeither replicate più dati estendendo locale cloud toohello di Windows Server Active Directory o generare più traffico in uscita come risultato dell'autenticazione e il carico di query.</span><span class="sxs-lookup"><span data-stu-id="d6422-545">Another factor will be hello cost tooeither replicate more data by extending your on-premises Windows Server Active Directory toohello cloud or generate more outbound traffic as a result of authentication and query load.</span></span>

<span data-ttu-id="d6422-546">Anche i requisiti di disponibilità e tolleranza di errore influiscono sulla scelta,</span><span class="sxs-lookup"><span data-stu-id="d6422-546">Requirements for availability and fault tolerance also affect your choice.</span></span> <span data-ttu-id="d6422-547">Ad esempio, se hello collegamento viene interrotto, applicazioni in cui un trust Kerberos o una relazione di trust federativa sono tutti probabilmente completamente suddivisa a meno che non è stata distribuita un'infrastruttura sufficiente in Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-547">For example, if hello link is interrupted, applications leveraging either a Kerberos trust or a federation trust are all likely entirely broken unless you have deployed sufficient infrastructure on Azure.</span></span> <span data-ttu-id="d6422-548">Configurazioni di distribuzione alternativi, ad esempio i controller di dominio di replica (scrivibile o scrivibili) aumentare hello probabilità di essere in grado di tootolerate malfunzionamenti del collegamento.</span><span class="sxs-lookup"><span data-stu-id="d6422-548">Alternative deployment configurations such as replica DCs (writeable or RODCs) increase hello likelihood of being able tootolerate link outages.</span></span>

### <span data-ttu-id="d6422-549"><a name="BKMK_ADSiteTopology"></a>Topologia del sito Active Directory di Windows Server</span><span class="sxs-lookup"><span data-stu-id="d6422-549"><a name="BKMK_ADSiteTopology"></a>Windows Server Active Directory site topology</span></span>
<span data-ttu-id="d6422-550">È necessario toocorrectly definire siti e collegamenti di sito in ordine toooptimize traffico e ridurre il costo.</span><span class="sxs-lookup"><span data-stu-id="d6422-550">You need toocorrectly define sites and site links in order toooptimize traffic and minimize cost.</span></span> <span data-ttu-id="d6422-551">Siti, collegamenti di sito e subnet influiscono sulla topologia di replica hello tra i controller di dominio e il flusso di hello del traffico di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="d6422-551">Sites, site-links, and subnets affect hello replication topology between DCs and hello flow of authentication traffic.</span></span> <span data-ttu-id="d6422-552">Considerare i seguenti addebiti di traffico hello e quindi distribuire e configurare i controller di dominio in base a requisiti toohello del proprio scenario di distribuzione:</span><span class="sxs-lookup"><span data-stu-id="d6422-552">Consider hello following traffic charges and then deploy and configure DCs according toohello requirements of your deployment scenario:</span></span>

* <span data-ttu-id="d6422-553">È disponibile una tariffa nominale per ora per il gateway hello stesso:</span><span class="sxs-lookup"><span data-stu-id="d6422-553">There is a nominal fee per hour for hello gateway itself:</span></span>
  
  * <span data-ttu-id="d6422-554">Può essere avviato e arrestato nel modo desiderato</span><span class="sxs-lookup"><span data-stu-id="d6422-554">It can be started and stopped as you see fit</span></span>
  * <span data-ttu-id="d6422-555">Se arrestato, macchine virtuali di Azure sono isolate dalla rete aziendale hello</span><span class="sxs-lookup"><span data-stu-id="d6422-555">If stopped, Azure VMs are isolated from hello corporate network</span></span>
* <span data-ttu-id="d6422-556">Il traffico in ingresso è gratuito</span><span class="sxs-lookup"><span data-stu-id="d6422-556">Inbound traffic is free</span></span>
* <span data-ttu-id="d6422-557">Traffico in uscita viene addebitato in base troppo[Azure prezzi in immediate](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="d6422-557">Outbound traffic is charged, according too[Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span> <span data-ttu-id="d6422-558">È possibile ottimizzare le proprietà di collegamento di sito tra siti locali e cloud hello come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="d6422-558">You can optimize site link properties between on-premises sites and hello cloud sites as follows:</span></span>
  
  * <span data-ttu-id="d6422-559">Se si utilizza più reti virtuali, configurare i collegamenti di sito hello e i relativi costi in modo appropriato tooprevent servizi di dominio di Windows Server Active Directory da classificare hello Azure del sito su uno in grado di fornire hello stessi livelli di servizio senza alcun costo.</span><span class="sxs-lookup"><span data-stu-id="d6422-559">If you are using multiple virtual networks, configure hello site-links and their costs appropriately tooprevent Windows Server AD DS from prioritizing hello Azure site over one that can provide hello same levels of service at no charge.</span></span> <span data-ttu-id="d6422-560">È inoltre possibile disattivare Bridge hello tutti i siti di opzione di collegamento (relativa) (che è abilitato per impostazione predefinita).</span><span class="sxs-lookup"><span data-stu-id="d6422-560">You might also consider disabling hello Bridge all site link (BASL) option (which is enabled by default).</span></span> <span data-ttu-id="d6422-561">Ciò garantisce che la replica venga eseguita solo tra i siti connessi direttamente.</span><span class="sxs-lookup"><span data-stu-id="d6422-561">This ensures that only directly-connected sites replicate with one another.</span></span> <span data-ttu-id="d6422-562">Controller di dominio in siti connessi in modo transitivo non sono più in grado di tooreplicate direttamente tra loro, ma deve essere replicata tramite uno o più siti comuni.</span><span class="sxs-lookup"><span data-stu-id="d6422-562">DCs in transitively connected sites are no longer able tooreplicate directly with each other, but must replicate through a common site or sites.</span></span> <span data-ttu-id="d6422-563">Se i siti intermedi hello diventano non disponibili per qualche motivo, è possibile che la replica tra controller di dominio in siti connessi in modo transitivo non verrà eseguita anche se è disponibile la connettività tra i siti di hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-563">If hello intermediary sites become unavailable for some reason, replication between DCs in transitively connected sites will not occur even if connectivity between hello sites is available.</span></span> <span data-ttu-id="d6422-564">Infine, in cui le sezioni del processo di replica transitiva rimangono utili, creare sito ponti di collegamenti che contengono collegamenti di sito appropriati hello e siti, ad esempio in locale, siti di rete aziendale.</span><span class="sxs-lookup"><span data-stu-id="d6422-564">Finally, where sections of transitive replication behavior remain desirable, create site link bridges that contain hello appropriate site-links and sites, such as on-premises, corporate network sites.</span></span>
  * <span data-ttu-id="d6422-565">[Configurare i costi di collegamento di sito](https://technet.microsoft.com/library/cc794882) tooavoid in modo appropriato il traffico indesiderato.</span><span class="sxs-lookup"><span data-stu-id="d6422-565">[Configure site link costs](https://technet.microsoft.com/library/cc794882) appropriately tooavoid unintended traffic.</span></span> <span data-ttu-id="d6422-566">Ad esempio, se **prova sito più vicino successivo** impostazione è abilitata, assicurarsi di rete virtuale che hello siti non sono hello accanto più vicino aumentando il costo di hello associato dell'oggetto collegamento di sito hello che si connette hello Azure sito indietro toohello rete aziendale.</span><span class="sxs-lookup"><span data-stu-id="d6422-566">For example, if **Try Next Closest Site** setting is enabled, make sure hello virtual network sites are not hello next closest by increasing hello cost associated of hello site-link object that connects hello Azure site back toohello corporate network.</span></span>
  * <span data-ttu-id="d6422-567">Configurare il collegamento di sito [intervalli](https://technet.microsoft.com/library/cc794878) e [pianificazioni](https://technet.microsoft.com/library/cc816906) in base a requisiti tooconsistency e frequenza di modifiche di oggetti.</span><span class="sxs-lookup"><span data-stu-id="d6422-567">Configure site link [intervals](https://technet.microsoft.com/library/cc794878) and [schedules](https://technet.microsoft.com/library/cc816906) according tooconsistency requirements and rate of object changes.</span></span> <span data-ttu-id="d6422-568">Allineare la pianificazione di replica alla tolleranza della latenza.</span><span class="sxs-lookup"><span data-stu-id="d6422-568">Align replication schedule with latency tolerance.</span></span> <span data-ttu-id="d6422-569">I controller di dominio vengono replicate solo hello ultimo stato di un valore, in modo decrescente intervallo di replica hello può ridurre i costi se è presente una frequenza di modifica oggetto sufficienti.</span><span class="sxs-lookup"><span data-stu-id="d6422-569">DCs replicate only hello last state of a value, so decreasing hello replication interval can save costs if there is a sufficient object change rate.</span></span>
* <span data-ttu-id="d6422-570">Se la riduzione dei costi è una priorità, assicurarsi che la replica venga pianificata e che la notifica delle modifiche non sia abilitata.</span><span class="sxs-lookup"><span data-stu-id="d6422-570">If minimizing costs is a priority, ensure replication is scheduled and change notification is not enabled.</span></span> <span data-ttu-id="d6422-571">Si tratta di configurazione predefinita di hello quando la replica tra siti.</span><span class="sxs-lookup"><span data-stu-id="d6422-571">This is hello default configuration when replicating between sites.</span></span> <span data-ttu-id="d6422-572">Non è importante se si distribuisce un controller di dominio in una rete virtuale perché hello RODC non verrà replicate le modifiche in uscita.</span><span class="sxs-lookup"><span data-stu-id="d6422-572">This is not important if you are deploying an RODC on a virtual network because hello RODC will not replicate any changes outbound.</span></span> <span data-ttu-id="d6422-573">Ma se si distribuisce un controller di dominio scrivibile, assicurarsi che il collegamento di sito hello non è configurato tooreplicate aggiornamenti con frequenza non necessaria.</span><span class="sxs-lookup"><span data-stu-id="d6422-573">But if you deploy a writable DC, you should make sure hello site link is not configured tooreplicate updates with unnecessary frequency.</span></span> <span data-ttu-id="d6422-574">Se si distribuisce un server di catalogo globale (GC), assicurarsi che tutti gli altri siti che contiene un catalogo globale vengano replicate le partizioni di dominio da un controller di dominio in un sito connesso con un collegamento di sito di origine o di collegamenti di sito aventi un costo inferiore rispetto a hello catalogo globale nel sito di Azure hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-574">If you deploy a global catalog server (GC), make sure that every other site that contains a GC replicates domain partitions from a source DC in a site that is connected with a site-link or site-links that have a lower cost than hello GC in hello Azure site.</span></span>
* <span data-ttu-id="d6422-575">È possibile comunque toofurther ridurre il traffico di rete generato dalla replica tra siti modificando l'algoritmo di compressione della replica hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-575">It is possible toofurther still reduce network traffic generated by replication between sites by changing hello replication compression algorithm.</span></span> <span data-ttu-id="d6422-576">algoritmo di compressione Hello è controllata dall'algoritmo di compressione hkey_local_machine\system\currentcontrolset\services\ntds\parameters\replicator della voce del Registro di sistema REG_DWORD hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-576">hello compression algorithm is controlled by hello REG_DWORD registry entry HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters\Replicator compression algorithm.</span></span> <span data-ttu-id="d6422-577">valore predefinito di Hello è 3, che mette in correlazione toohello algoritmo di compressione Xpress.</span><span class="sxs-lookup"><span data-stu-id="d6422-577">hello default value is 3, which correlates toohello Xpress Compress algorithm.</span></span> <span data-ttu-id="d6422-578">È possibile modificare too2 valore hello, quali modifiche hello tooMSZip algoritmo.</span><span class="sxs-lookup"><span data-stu-id="d6422-578">You can change hello value too2, which changes hello algorithm tooMSZip.</span></span> <span data-ttu-id="d6422-579">Nella maggior parte dei casi, ciò consentirà di migliorare la compressione di hello, ma a tale scopo spese hello dell'utilizzo della CPU.</span><span class="sxs-lookup"><span data-stu-id="d6422-579">In most cases, this will increase hello compression, but it does so at hello expense of CPU utilization.</span></span> <span data-ttu-id="d6422-580">Per altre informazioni, vedere l'articolo relativo al [funzionamento della topologia di replica di Active Directory](https://technet.microsoft.com/library/cc755994).</span><span class="sxs-lookup"><span data-stu-id="d6422-580">For more information, see [How Active Directory replication topology works](https://technet.microsoft.com/library/cc755994).</span></span>

### <span data-ttu-id="d6422-581"><a name="BKMK_IPAddressDNS"></a>Indirizzamento IP e DNS</span><span class="sxs-lookup"><span data-stu-id="d6422-581"><a name="BKMK_IPAddressDNS"></a>IP addressing and DNS</span></span>
<span data-ttu-id="d6422-582">Alle macchine virtuali di Azure vengono allocati "indirizzi con lease DHCP" per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="d6422-582">Azure virtual machines are allocated “DHCP-leased addresses” by default.</span></span> <span data-ttu-id="d6422-583">Poiché gli indirizzi dinamici di rete virtuale di Azure sono persistenti con una macchina virtuale per la durata di hello della macchina virtuale hello, hello directory di Windows Server Active Directory i requisiti.</span><span class="sxs-lookup"><span data-stu-id="d6422-583">Because Azure virtual network dynamic addresses persist with a virtual machine for hello lifetime of hello virtual machine, hello requirements of Windows Server AD DS are met.</span></span>

<span data-ttu-id="d6422-584">Di conseguenza, quando si usa un indirizzo dinamico in Azure, vengono di fatto un indirizzo IP statico poiché è indirizzabile per il periodo di hello di lease hello e periodo hello lease hello è uguale toohello durata del servizio cloud hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-584">As a result, when you use a dynamic address on Azure, you are in effect using a static IP address because it is routable for hello period of hello lease, and hello period of hello lease is equal toohello lifetime of hello cloud service.</span></span>

<span data-ttu-id="d6422-585">Tuttavia, indirizzo dinamico hello viene deallocato se hello VM viene chiusa.</span><span class="sxs-lookup"><span data-stu-id="d6422-585">However, hello dynamic address is deallocated if hello VM is shutdown.</span></span> <span data-ttu-id="d6422-586">indirizzo IP di hello tooprevent venga deallocato, è possibile [utilizzare Set-AzureStaticVNetIP tooassign un indirizzo IP statico](http://social.technet.microsoft.com/wiki/contents/articles/23447.how-to-assign-a-private-static-ip-to-an-azure-vm.aspx).</span><span class="sxs-lookup"><span data-stu-id="d6422-586">tooprevent hello IP address from being deallocated, you can [use Set-AzureStaticVNetIP tooassign a static IP address](http://social.technet.microsoft.com/wiki/contents/articles/23447.how-to-assign-a-private-static-ip-to-an-azure-vm.aspx).</span></span>

<span data-ttu-id="d6422-587">Per la risoluzione dei nomi, distribuire la propria (o utilizzare quella esistente) infrastruttura del server DNS DNS fornito da Azure non soddisfa hello avanzate requisiti di risoluzione dei nomi di dominio Active Directory di Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d6422-587">For name resolution, deploy your own (or leverage your existing) DNS server infrastructure; Azure-provided DNS does not meet hello advanced name resolution needs of Windows Server AD DS.</span></span> <span data-ttu-id="d6422-588">Ad esempio, non supporta i record SRV dinamici e così via.</span><span class="sxs-lookup"><span data-stu-id="d6422-588">For example, it does not support dynamic SRV records, and so on.</span></span> <span data-ttu-id="d6422-589">La risoluzione dei nomi è un elemento di configurazione critico per i controller di domino e i client aggiunti a un dominio.</span><span class="sxs-lookup"><span data-stu-id="d6422-589">Name resolution is a critical configuration item for DCs and domain-joined clients.</span></span> <span data-ttu-id="d6422-590">I controller di dominio devono essere in grado di registrare i record di risorse e di risolvere altri record di risorse del controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="d6422-590">DCs must be capable of registering resource records and resolving other DC’s resource records.</span></span>
<span data-ttu-id="d6422-591">Per motivi di prestazioni e tolleranza d'errore, è servizio di Server DNS di Windows hello tooinstall ottimale nei controller di dominio hello in esecuzione in Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-591">For fault tolerance and performance reasons, it is optimal tooinstall hello Windows Server DNS service on hello DCs running on Azure.</span></span> <span data-ttu-id="d6422-592">Quindi configurare le proprietà di rete virtuale di Azure hello con nome hello e indirizzo IP del server DNS hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-592">Then configure hello Azure virtual network properties with hello name and IP address of hello DNS server.</span></span> <span data-ttu-id="d6422-593">Avvio di altre macchine virtuali nella rete virtuale hello, le impostazioni del resolver DNS client verranno configurate con il server DNS come parte dell'allocazione di indirizzi IP dinamico hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-593">When other VMs on hello virtual network start, their DNS client resolver settings will be configured with DNS server as part of hello dynamic IP address allocation.</span></span>

> [!NOTE]
> <span data-ttu-id="d6422-594">È possibile unire i domini di Active Directory di Windows Server Active Directory di dominio Active Directory con i tooa computer locale che sono ospitato in Azure direttamente su Internet hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-594">You cannot join on-premises computers tooa Windows Server AD DS Active Directory domain that is hosted on Azure directly over hello Internet.</span></span> <span data-ttu-id="d6422-595">Hello requisiti delle porte per Active Directory e l'operazione di aggiunta al dominio hello ne esegue il rendering le porte necessarie toodirectly poco espongono hello e lo stato attivo, un intero toohello di controller di dominio Internet.</span><span class="sxs-lookup"><span data-stu-id="d6422-595">hello port requirements for Active Directory and hello domain-join operation render it impractical toodirectly expose hello necessary ports and in effect, an entire DC toohello Internet.</span></span>
> 
> 

<span data-ttu-id="d6422-596">Le VM registrano il relativo nome DNS automaticamente all'avvio o in caso di modifica di un nome.</span><span class="sxs-lookup"><span data-stu-id="d6422-596">VMs register their DNS name automatically on startup or when there is a name change.</span></span>

<span data-ttu-id="d6422-597">Per ulteriori informazioni su questo esempio e un altro esempio che illustra come tooprovision hello prima macchina virtuale e installare di dominio Active Directory su di esso, vedere [installare una nuova foresta di Active Directory in Microsoft Azure](active-directory-new-forest-virtual-machine.md).</span><span class="sxs-lookup"><span data-stu-id="d6422-597">For more information about this example and another example that shows how tooprovision hello first VM and install AD DS on it, see [Install a new Active Directory forest on Microsoft Azure](active-directory-new-forest-virtual-machine.md).</span></span> <span data-ttu-id="d6422-598">Per altre informazioni sull'uso di Windows PowerShell, vedere [Come installare e configurare Azure PowerShell](/powershell/azureps-cmdlets-docs) e [Cmdlet di gestione di Azure](/powershell/module/azurerm.compute/#virtual_machines).</span><span class="sxs-lookup"><span data-stu-id="d6422-598">For more information about using Windows PowerShell, see [Install Azure PowerShell](/powershell/azureps-cmdlets-docs) and [Azure Management Cmdlets](/powershell/module/azurerm.compute/#virtual_machines).</span></span>

### <span data-ttu-id="d6422-599"><a name="BKMK_DistributedDCs"></a>Controller di dominio con distribuzione geografica</span><span class="sxs-lookup"><span data-stu-id="d6422-599"><a name="BKMK_DistributedDCs"></a>Geo-distributed DCs</span></span>
<span data-ttu-id="d6422-600">Azure offre vantaggi quando si ospitano più controller di dominio in reti virtuali diverse:</span><span class="sxs-lookup"><span data-stu-id="d6422-600">Azure offers advantages when hosting multiple DCs on different virtual networks:</span></span>

* <span data-ttu-id="d6422-601">Tolleranza di errore multisito</span><span class="sxs-lookup"><span data-stu-id="d6422-601">Multi-site fault-tolerance</span></span>
* <span data-ttu-id="d6422-602">Uffici toobranch prossimità fisica (latenza più bassa)</span><span class="sxs-lookup"><span data-stu-id="d6422-602">Physical proximity toobranch offices (lower latency)</span></span>

<span data-ttu-id="d6422-603">Per informazioni sulla configurazione della comunicazione diretta tra reti virtuali, vedere [configurare la connettività di rete di rete virtuale toovirtual](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span><span class="sxs-lookup"><span data-stu-id="d6422-603">For information about configuring direct communication between virtual networks, see [Configure virtual network toovirtual network connectivity](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span></span>

### <span data-ttu-id="d6422-604"><a name="BKMK_RODC"></a>Controller di dominio di sola lettura</span><span class="sxs-lookup"><span data-stu-id="d6422-604"><a name="BKMK_RODC"></a>Read-only DCs</span></span>
<span data-ttu-id="d6422-605">È necessario toochoose se leggere toodeploy-scrivibile o solo i controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="d6422-605">You need toochoose whether toodeploy read-only or writeable DCs.</span></span> <span data-ttu-id="d6422-606">È possibile toodeploy inclinata lettura perché non è un controllo fisico su di essi, ma i RODC sono progettate toobe distribuito nelle posizioni in cui la sicurezza fisica è a rischio, ad esempio le succursali.</span><span class="sxs-lookup"><span data-stu-id="d6422-606">You might be inclined toodeploy RODCs because you will not have physical control over them, but RODCs are designed toobe deployed in locations where their physical security is at risk, such as branch offices.</span></span>

<span data-ttu-id="d6422-607">Azure non presenta hello rischi di sicurezza fisica di una succursale, tuttavia lettura potrebbe comunque risultare toobe economicamente più vantaggioso perché funzionalità hello che forniscono sono particolarmente adatte toothese ambienti anche se per motivi molto diversi.</span><span class="sxs-lookup"><span data-stu-id="d6422-607">Azure does not present hello physical security risk of a branch office, but RODCs might still prove toobe more cost effective because hello features they provide are well-suited toothese environments albeit for very different reasons.</span></span> <span data-ttu-id="d6422-608">Ad esempio, controller non dispone di alcuna replica in uscita e sono tooselectively in grado di popolare i segreti (password).</span><span class="sxs-lookup"><span data-stu-id="d6422-608">For example, RODCs have no outbound replication and are able tooselectively populate secrets (passwords).</span></span> <span data-ttu-id="d6422-609">In svantaggio hello, mancanza di hello di questi segreti potrebbe richiedere traffico in uscita su richiesta toovalidate usarle come autentica un utente o computer.</span><span class="sxs-lookup"><span data-stu-id="d6422-609">On hello downside, hello lack of these secrets might require on-demand outbound traffic toovalidate them as a user or computer authenticates.</span></span> <span data-ttu-id="d6422-610">I segreti possono però essere prepopolati e memorizzati nella cache in modo selettivo.</span><span class="sxs-lookup"><span data-stu-id="d6422-610">But secrets can be selectively prepopulated and cached.</span></span>

<span data-ttu-id="d6422-611">Poiché è possibile aggiungere gli attributi che contengono dati sensibili toohello RODC filtrato il set di attributi (/FAs) offre un vantaggio aggiuntivo intorno a problemi di PII e HBI.</span><span class="sxs-lookup"><span data-stu-id="d6422-611">RODCs provide an additional advantage in and around HBI and PII concerns because you can add attributes that contain sensitive data toohello RODC filtered attribute set (FAS).</span></span> <span data-ttu-id="d6422-612">Hello /FAs è un set personalizzabile di attributi che non sono replicati tooRODCs.</span><span class="sxs-lookup"><span data-stu-id="d6422-612">hello FAS is a customizable set of attributes that are not replicated tooRODCs.</span></span> <span data-ttu-id="d6422-613">Nel caso in cui non sia possibile o non si desidera toostore PII o HBI in Azure, è possibile utilizzare hello /FAs come misura di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="d6422-613">You can use hello FAS as a safeguard in case you are not permitted or do not want toostore PII or HBI on Azure.</span></span> <span data-ttu-id="d6422-614">Per altre informazioni, vedere [set di attributi con filtro per controller di dominio di sola lettura[(https://technet.microsoft.com/library/cc753459)].</span><span class="sxs-lookup"><span data-stu-id="d6422-614">For more information, see [RODC filtered attribute set[(https://technet.microsoft.com/library/cc753459)].</span></span>

<span data-ttu-id="d6422-615">Assicurarsi che le applicazioni siano compatibili con lettura Prevedi toouse.</span><span class="sxs-lookup"><span data-stu-id="d6422-615">Make sure that applications will be compatible with RODCs you plan toouse.</span></span> <span data-ttu-id="d6422-616">Molte applicazioni abilitate per Active Directory di Windows Server funzionano bene con lettura, ma alcune applicazioni possono risultare inefficiente o non riuscire se non hanno accesso tooa controller di dominio scrivibile.</span><span class="sxs-lookup"><span data-stu-id="d6422-616">Many Windows Server Active Directory-enabled applications work well with RODCs, but some applications can perform inefficiently or fail if they do not have access tooa writable DC.</span></span> <span data-ttu-id="d6422-617">Per altre informazioni, vedere la Guida alla [Compatibilità delle applicazioni con i controller di dominio di sola lettura](https://technet.microsoft.com/library/cc755190).</span><span class="sxs-lookup"><span data-stu-id="d6422-617">For more information, see [Read-Only DCs application compatibility guide](https://technet.microsoft.com/library/cc755190).</span></span>

### <span data-ttu-id="d6422-618"><a name="BKMK_GC"></a>Catalogo globale</span><span class="sxs-lookup"><span data-stu-id="d6422-618"><a name="BKMK_GC"></a>Global catalog</span></span>
<span data-ttu-id="d6422-619">È necessario se toochoose tooinstall un catalogo globale (GC).</span><span class="sxs-lookup"><span data-stu-id="d6422-619">You need toochoose whether tooinstall a global catalog (GC).</span></span> <span data-ttu-id="d6422-620">In una foresta a dominio singolo è necessario configurare tutti i controller di dominio come server di catalogo globale.</span><span class="sxs-lookup"><span data-stu-id="d6422-620">In a single domain forest, you should configure all DCs as global catalog servers.</span></span> <span data-ttu-id="d6422-621">I costi non aumenteranno perché non vi sarà alcun traffico di replica aggiuntivo.</span><span class="sxs-lookup"><span data-stu-id="d6422-621">It will not increase costs because there will be no additional replication traffic.</span></span>

<span data-ttu-id="d6422-622">In una foresta con più domini, i cataloghi globali sono necessari tooexpand Universal appartenenze durante il processo di autenticazione hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-622">In a multidomain forest, GCs are necessary tooexpand Universal Group memberships during hello authentication process.</span></span> <span data-ttu-id="d6422-623">Se non si distribuisce un catalogo globale, i carichi di lavoro nella rete virtuale hello utilizzato per autenticare un controller di dominio in Azure genereranno indirettamente traffico di autenticazione in uscita tooquery cataloghi globali locali durante ogni tentativo di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="d6422-623">If you do not deploy a GC, workloads on hello virtual network that authenticate against a DC on Azure will indirectly generate outbound authentication traffic tooquery GCs on-premises during each authentication attempt.</span></span>

<span data-ttu-id="d6422-624">i costi di Hello associati ai cataloghi globali sono meno prevedibili perché essi viene ospitato ogni dominio (in parte).</span><span class="sxs-lookup"><span data-stu-id="d6422-624">hello costs associated with GCs are less-predictable because they host every domain (in-part).</span></span> <span data-ttu-id="d6422-625">Se il carico di lavoro hello ospita un servizio con connessione Internet e autentica gli utenti in servizi di dominio di Windows Server Active Directory, i costi di hello potrebbe essere difficile calcolare.</span><span class="sxs-lookup"><span data-stu-id="d6422-625">If hello workload hosts an Internet-facing service and authenticates users against Windows Server AD DS, hello costs could be completely unpredictable.</span></span> <span data-ttu-id="d6422-626">toohelp ridurre le query di catalogo globale di fuori del sito cloud hello durante l'autenticazione, è possibile [Abilita Caching appartenenza a gruppo universale](https://technet.microsoft.com/library/cc816928).</span><span class="sxs-lookup"><span data-stu-id="d6422-626">toohelp reduce GC queries outside of hello cloud site during authentication, you can [enable Universal Group Membership Caching](https://technet.microsoft.com/library/cc816928).</span></span>

### <span data-ttu-id="d6422-627"><a name="BKMK_InstallMethod"></a>Metodo di installazione</span><span class="sxs-lookup"><span data-stu-id="d6422-627"><a name="BKMK_InstallMethod"></a>Installation method</span></span>
<span data-ttu-id="d6422-628">È necessario come toochoose tooinstall hello, i controller di dominio nella rete virtuale hello:</span><span class="sxs-lookup"><span data-stu-id="d6422-628">You need toochoose how tooinstall hello DCs on hello virtual network:</span></span>

* <span data-ttu-id="d6422-629">Alzare di livello nuovi controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="d6422-629">Promote new DCs.</span></span> <span data-ttu-id="d6422-630">Per altre informazioni, vedere [Installare una nuova foresta Active Directory in una rete virtuale di Azure](active-directory-new-forest-virtual-machine.md).</span><span class="sxs-lookup"><span data-stu-id="d6422-630">For more information, see [Install a new Active Directory forest on an Azure virtual network](active-directory-new-forest-virtual-machine.md).</span></span>
* <span data-ttu-id="d6422-631">Spostare hello disco rigido virtuale di un cloud di toohello controller di dominio virtuale locale.</span><span class="sxs-lookup"><span data-stu-id="d6422-631">Move hello VHD of an on-premises virtual DC toohello cloud.</span></span> <span data-ttu-id="d6422-632">In questo caso, è necessario assicurarsi che hello locale controller di dominio virtuale venga "spostato" non "copiato" o "clonato".</span><span class="sxs-lookup"><span data-stu-id="d6422-632">In this case, you must ensure that hello on-premises virtual DC is “moved,” not “copied” or “cloned.”</span></span>

<span data-ttu-id="d6422-633">Utilizzare macchine virtuali di Azure solo per i controller di dominio (come tooAzure anziché ruolo "web" o "lavoro" le macchine virtuali).</span><span class="sxs-lookup"><span data-stu-id="d6422-633">Use only Azure virtual machines for DCs (as opposed tooAzure “web” or “worker” role VMs).</span></span> <span data-ttu-id="d6422-634">Sono durevoli e la durabilità di stato per un controller di dominio è essenziale.</span><span class="sxs-lookup"><span data-stu-id="d6422-634">They are durable and durability of state for a DC is required.</span></span> <span data-ttu-id="d6422-635">Le macchine virtuali di Azure sono progettate per i carichi di lavoro, ad esempio i controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="d6422-635">Azure virtual machines are designed for workloads such as DCs.</span></span>

<span data-ttu-id="d6422-636">Non utilizzare SYSPREP toodeploy o clonare i controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="d6422-636">Do not use SYSPREP toodeploy or clone DCs.</span></span> <span data-ttu-id="d6422-637">possibilità di Hello tooclone i controller di dominio è solo disponibile a partire da Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="d6422-637">hello ability tooclone DCs is only available beginning in Windows Server 2012.</span></span> <span data-ttu-id="d6422-638">funzionalità di clonazione Hello richiede il supporto per VMGenerationID nell'hypervisor sottostante hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-638">hello cloning feature requires support for VMGenerationID in hello underlying hypervisor.</span></span> <span data-ttu-id="d6422-639">Hyper-V in Windows Server 2012 e le reti virtuali di Azure supportano entrambi VMGenerationID, come fanno i fornitori di software di virtualizzazione di terze parti.</span><span class="sxs-lookup"><span data-stu-id="d6422-639">Hyper-V in Windows Server 2012 and Azure virtual networks both support VMGenerationID, as do third-party virtualization software vendors.</span></span>

### <span data-ttu-id="d6422-640"><a name="BKMK_PlaceDB"></a>Posizione del database hello servizi di dominio di Windows Server Active Directory e SYSVOL</span><span class="sxs-lookup"><span data-stu-id="d6422-640"><a name="BKMK_PlaceDB"></a>Placement of hello Windows Server AD DS database and SYSVOL</span></span>
<span data-ttu-id="d6422-641">Selezionare dove toolocate hello database di Windows Server Active Directory, i registri e SYSVOL.</span><span class="sxs-lookup"><span data-stu-id="d6422-641">Select where toolocate hello Windows Server AD DS database, logs, and SYSVOL.</span></span> <span data-ttu-id="d6422-642">Devono essere distribuiti nei dischi dati di Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-642">They must be deployed on Azure Data disks.</span></span>

> [!NOTE]
> <span data-ttu-id="d6422-643">Dischi dati di Azure sono vincolate too1 TB.</span><span class="sxs-lookup"><span data-stu-id="d6422-643">Azure Data disks are constrained too1 TB.</span></span>
> 
> 

<span data-ttu-id="d6422-644">Per impostazione predefinita, le unità disco dati non memorizzano le scritture nella cache.</span><span class="sxs-lookup"><span data-stu-id="d6422-644">Data disk drives do not cache writes by default.</span></span> <span data-ttu-id="d6422-645">Unità disco dati che sono collegato tooa VM usare caching write-through.</span><span class="sxs-lookup"><span data-stu-id="d6422-645">Data disk drives that are attached tooa VM use write-through caching.</span></span> <span data-ttu-id="d6422-646">Rende cache write-through che scrittura hello sia eseguito il commit toodurable archiviazione di Azure prima di hello è stata completata dal punto di vista di hello del sistema operativo della macchina virtuale di hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-646">Write-through caching makes sure hello write is committed toodurable Azure storage before hello transaction is complete from hello perspective of hello VM’s operating system.</span></span> <span data-ttu-id="d6422-647">Fornisce durabilità, spese di hello di scritture leggermente più lente.</span><span class="sxs-lookup"><span data-stu-id="d6422-647">It provides durability, at hello expense of slightly slower writes.</span></span>

<span data-ttu-id="d6422-648">Questo è importante per servizi di dominio di Windows Server Active Directory perché la cache del disco write-behind Invalidate le interpretazioni da hello controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="d6422-648">This is important for Windows Server AD DS because write-behind disk-caching invalidates assumptions made by hello DC.</span></span> <span data-ttu-id="d6422-649">Servizi di dominio di Windows Server Active Directory tenta toodisable caching in scrittura, ma è attivo toohello disco i/o sistema toohonor è.</span><span class="sxs-lookup"><span data-stu-id="d6422-649">Windows Server AD DS attempts toodisable write caching but it is up toohello disk IO system toohonor it.</span></span> <span data-ttu-id="d6422-650">Errore toodisable caching in scrittura può, in determinate circostanze, introdurre il rollback USN causando oggetti residui e altri problemi.</span><span class="sxs-lookup"><span data-stu-id="d6422-650">Failure toodisable write caching may, under certain circumstances, introduce USN rollback resulting in lingering objects and other problems.</span></span>

<span data-ttu-id="d6422-651">Come procedura consigliata per i controller di dominio virtuali, hello seguenti:</span><span class="sxs-lookup"><span data-stu-id="d6422-651">As a best practice for virtual DCs, do hello following:</span></span>

* <span data-ttu-id="d6422-652">Impostare hello preferenze Cache dell'Host su disco di dati di Azure hello per nessuno.</span><span class="sxs-lookup"><span data-stu-id="d6422-652">Set hello Host Cache Preference setting on hello Azure data disk for NONE.</span></span> <span data-ttu-id="d6422-653">In questo modo si evitano problemi di memorizzazione nella cache in scrittura per le operazioni di Servizi di dominio Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d6422-653">This prevents issues with write caching for AD DS operations.</span></span>
* <span data-ttu-id="d6422-654">Archiviare il database di hello, log e SYSVOL in hello dati stesso disco o dischi dati separano.</span><span class="sxs-lookup"><span data-stu-id="d6422-654">Store hello database, logs, and SYSVOL on hello either same data disk or separate data disks.</span></span> <span data-ttu-id="d6422-655">In genere si tratta di un disco separato dal disco hello utilizzato dal sistema operativo hello stesso.</span><span class="sxs-lookup"><span data-stu-id="d6422-655">Typically, this is a separate disk from hello disk used for hello operating system itself.</span></span> <span data-ttu-id="d6422-656">informazioni chiave Hello sono database hello Windows Server Active Directory e SYSVOL non devono essere archiviati in un tipo di disco del sistema operativo Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-656">hello key takeaway is that hello Windows Server AD DS database and SYSVOL must not be stored on an Azure Operating System disk type.</span></span> <span data-ttu-id="d6422-657">Per impostazione predefinita, hello il processo di installazione di Active Directory consente di installare questi componenti nella cartella % systemroot %, non è consigliata per Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-657">By default, hello AD DS installation process installs these components in %systemroot% folder, which is NOT recommended for Azure.</span></span>

### <span data-ttu-id="d6422-658"><a name="BKMK_BUR"></a>Backup e ripristino</span><span class="sxs-lookup"><span data-stu-id="d6422-658"><a name="BKMK_BUR"></a>Backup and restore</span></span>
<span data-ttu-id="d6422-659">Tenere presente quali elementi sono o meno supportati per il backup e ripristino di un controller di dominio in generale e, più in particolare, quelli in esecuzione in una VM.</span><span class="sxs-lookup"><span data-stu-id="d6422-659">Be aware of what is and is not supported for backup and restore of a DC in general, and more specifically, those running in a VM.</span></span> <span data-ttu-id="d6422-660">Vedere [Considerazioni sul backup e il ripristino dei controller di dominio virtualizzati](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv#backup_and_restore_considerations_for_virtualized_domain_controllers).</span><span class="sxs-lookup"><span data-stu-id="d6422-660">See [Backup and Restore Considerations for Virtualized DCs](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv#backup_and_restore_considerations_for_virtualized_domain_controllers).</span></span>

<span data-ttu-id="d6422-661">Creare backup dello stato del sistema usando solo software per backup che riconosca specificatamente i requisiti di backup per Servizi di dominio Active Directory di Windows Server, ad esempio Windows Server Backup.</span><span class="sxs-lookup"><span data-stu-id="d6422-661">Create system state backups by using only backup software that is specifically aware of backup requirements for Windows Server AD DS, such as Windows Server Backup.</span></span>

<span data-ttu-id="d6422-662">Non copiare o clonare file VHD di controller di dominio invece di eseguire backup regolari.</span><span class="sxs-lookup"><span data-stu-id="d6422-662">Do not copy or clone VHD files of DCs instead of performing regular backups.</span></span> <span data-ttu-id="d6422-663">Se è necessario un ripristino e l'operazione viene eseguita usando VHD clonati o copiati senza Windows Server 2012 e un hypervisor supportato, verranno introdotti gap USN.</span><span class="sxs-lookup"><span data-stu-id="d6422-663">Should a restore ever be required, doing so using cloned or copied VHDs without Windows Server 2012 and a supported hypervisor will introduce USN bubbles.</span></span>

### <span data-ttu-id="d6422-664"><a name="BKMK_FedSrvConfig"></a>Configurazione del server federativo</span><span class="sxs-lookup"><span data-stu-id="d6422-664"><a name="BKMK_FedSrvConfig"></a>Federation server configuration</span></span>
<span data-ttu-id="d6422-665">la configurazione di Hello del server federativi ADFS di Windows Server (STS) dipende in parte che hello applicazioni che si desidera toodeploy in Azure richiedano tooaccess risorse di rete locale.</span><span class="sxs-lookup"><span data-stu-id="d6422-665">hello configuration of Windows Server AD FS federation servers (STSs) depends in part on whether hello applications that you want toodeploy on Azure need tooaccess resources on your on-premises network.</span></span>

<span data-ttu-id="d6422-666">Se le applicazioni di hello soddisfano hello seguenti criteri, è possibile distribuire applicazioni hello in isolamento dalla rete locale.</span><span class="sxs-lookup"><span data-stu-id="d6422-666">If hello applications meet hello following criteria, you could deploy hello applications in isolation from your on-premises network.</span></span>

* <span data-ttu-id="d6422-667">Accettano token di sicurezza SAML</span><span class="sxs-lookup"><span data-stu-id="d6422-667">They accept SAML security tokens</span></span>
* <span data-ttu-id="d6422-668">Sono toohello essere esposte Internet</span><span class="sxs-lookup"><span data-stu-id="d6422-668">They are exposable toohello Internet</span></span>
* <span data-ttu-id="d6422-669">Non accedono alle risorse locali</span><span class="sxs-lookup"><span data-stu-id="d6422-669">They do not access on-premises resources</span></span>

<span data-ttu-id="d6422-670">In questo caso, configurare i servizi token di sicurezza di AD FS di Windows Server come segue:</span><span class="sxs-lookup"><span data-stu-id="d6422-670">In this case, configure Windows Server AD FS STSs as follows:</span></span>

1. <span data-ttu-id="d6422-671">Configurare una foresta a dominio singolo isolata in Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-671">Configure an isolated single-domain forest on Azure.</span></span>
2. <span data-ttu-id="d6422-672">Fornire l'accesso federato ai toohello foresta configurando una server farm federativa di Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="d6422-672">Provide federated access toohello forest by configuring a Windows Server AD FS federation server farm.</span></span>
3. <span data-ttu-id="d6422-673">Configurare ADFS di Windows Server (server farm federativa e farm proxy server federativo) nella foresta locale hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-673">Configure Windows Server AD FS (federation server farm and federation server proxy farm) in hello on-premises forest.</span></span>
4. <span data-ttu-id="d6422-674">Stabilire una relazione di trust federativa tra hello sedi locali e istanze di Azure di Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="d6422-674">Establish a federation trust relationship between hello on-premises and Azure instances of Windows Server AD FS.</span></span>

<span data-ttu-id="d6422-675">In hello altra parte, se le applicazioni di hello richiedono tooon locale di accedere alle risorse, è possibile configurare ADFS di Windows Server con un'applicazione hello in Azure come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="d6422-675">On hello other hand, if hello applications require access tooon-premises resources, you could configure Windows Server AD FS with hello application on Azure as follows:</span></span>

1. <span data-ttu-id="d6422-676">Configurare la connettività tra le reti locali e Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-676">Configure connectivity between on-premises networks and Azure.</span></span>
2. <span data-ttu-id="d6422-677">Configurare una server farm federativa ADFS di Windows Server nella foresta locale hello.</span><span class="sxs-lookup"><span data-stu-id="d6422-677">Configure a Windows Server AD FS federation server farm in hello on-premises forest.</span></span>
3. <span data-ttu-id="d6422-678">Configurare una farm proxy server federativo AD FS di Windows Server in Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-678">Configure a Windows Server AD FS federation server proxy farm on Azure.</span></span>

<span data-ttu-id="d6422-679">Questa configurazione presenta il vantaggio di hello di ridurre l'esposizione di hello delle risorse locali, simile tooconfiguring ADFS di Windows Server con le applicazioni in una rete perimetrale.</span><span class="sxs-lookup"><span data-stu-id="d6422-679">This configuration has hello advantage of reducing hello exposure of on-premises resources, similar tooconfiguring Windows Server AD FS with applications in a perimeter network.</span></span>

<span data-ttu-id="d6422-680">Si noti che in entrambi gli scenari è possibile stabilire relazioni di trust con più provider di identità, se è necessaria la collaborazione business-to-business.</span><span class="sxs-lookup"><span data-stu-id="d6422-680">Note that in either scenario, you can establish trusts relationships with more identity providers, if business-to-business collaboration is needed.</span></span>

### <span data-ttu-id="d6422-681"><a name="BKMK_CloudSvcConfig"></a>Configurazione di servizi cloud</span><span class="sxs-lookup"><span data-stu-id="d6422-681"><a name="BKMK_CloudSvcConfig"></a>Cloud services configuration</span></span>
<span data-ttu-id="d6422-682">Servizi cloud sono necessari se si desidera che una macchina virtuale tooexpose direttamente toohello Internet o tooexpose con una connessione Internet con bilanciamento del carico dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d6422-682">Cloud services are necessary if you want tooexpose a VM directly toohello Internet or tooexpose an Internet-facing load-balanced application.</span></span> <span data-ttu-id="d6422-683">Ciò è possibile perché ogni servizio cloud offre un singolo indirizzo IP virtuale configurabile.</span><span class="sxs-lookup"><span data-stu-id="d6422-683">This is possible because each cloud service offers a single configurable virtual IP address.</span></span>

### <span data-ttu-id="d6422-684"><a name="BKMK_FedReqVIPDIP"></a>Requisiti del server federativo per l'indirizzamento IP pubblico e privato (confronto tra indirizzo IP dinamico e indirizzo IP virtuale)</span><span class="sxs-lookup"><span data-stu-id="d6422-684"><a name="BKMK_FedReqVIPDIP"></a>Federation server requirements for public and private IP addressing (dynamic IP vs. virtual IP)</span></span>
<span data-ttu-id="d6422-685">Ogni macchina virtuale di Azure riceve un indirizzo IP dinamico.</span><span class="sxs-lookup"><span data-stu-id="d6422-685">Each Azure virtual machine receives a dynamic IP address.</span></span> <span data-ttu-id="d6422-686">Un indirizzo IP dinamico è un indirizzo privato accessibile solo all'interno di Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-686">A dynamic IP address is a private address accessible only within Azure.</span></span> <span data-ttu-id="d6422-687">Nella maggior parte dei casi, tuttavia, sarà necessario tooconfigure un indirizzo IP virtuale per le distribuzioni di Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="d6422-687">In most cases, however, it will be necessary tooconfigure a virtual IP address for your Windows Server AD FS deployments.</span></span> <span data-ttu-id="d6422-688">indirizzo IP virtuale Hello è necessario tooexpose toohello gli endpoint ADFS di Windows Server Internet e verrà utilizzato dai partner federati e dai client per l'autenticazione e la gestione continuativa.</span><span class="sxs-lookup"><span data-stu-id="d6422-688">hello virtual IP is necessary tooexpose Windows Server AD FS endpoints toohello Internet, and will be used by federated partners and clients for authentication and ongoing management.</span></span> <span data-ttu-id="d6422-689">Un indirizzo IP virtuale è una proprietà di un servizio cloud che contiene una o più macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-689">A virtual IP address is a property of a cloud service which contains one or more Azure virtual machines.</span></span> <span data-ttu-id="d6422-690">Se un'applicazione hello grado di riconoscere attestazioni distribuita in Azure e ADFS di Windows Server è entrambi con connessione Internet e condivisione porte comuni, ognuna richiederà un indirizzo IP virtuale del proprio e sarà pertanto necessario toocreate un servizio cloud per un'applicazione hello e una in secondo luogo, per ADFS di Windows Server.</span><span class="sxs-lookup"><span data-stu-id="d6422-690">If hello claims-aware application deployed on Azure and Windows Server AD FS are both Internet-facing and share common ports, each will require a virtual IP address of its own and it will therefore be necessary toocreate one cloud service for hello application and a second for Windows Server AD FS.</span></span>

<span data-ttu-id="d6422-691">Per le definizioni di indirizzo IP dinamico e l'indirizzo IP virtuale di hello termini, vedere [termini e definizioni](#BKMK_Glossary).</span><span class="sxs-lookup"><span data-stu-id="d6422-691">For definitions of hello terms virtual IP address and dynamic IP address, see [Terms and definitions](#BKMK_Glossary).</span></span>

### <span data-ttu-id="d6422-692"><a name="BKMK_ADFSHighAvail"></a>Configurazione con disponibilità elevata di AD FS di Windows Server</span><span class="sxs-lookup"><span data-stu-id="d6422-692"><a name="BKMK_ADFSHighAvail"></a>Windows Server AD FS high availability configuration</span></span>
<span data-ttu-id="d6422-693">Sebbene sia i servizi di federazione ADFS di Windows Server autonomo toodeploy possibili, è consigliabile toodeploy una farm con almeno due nodi per STS ADFS e proxy per gli ambienti di produzione.</span><span class="sxs-lookup"><span data-stu-id="d6422-693">While it is possible toodeploy standalone Windows Server AD FS federation services, it is recommended toodeploy a farm with at least two nodes for both AD FS STS and proxies for production environments.</span></span>

<span data-ttu-id="d6422-694">Vedere [considerazioni relative alla topologia di AD FS 2.0 deployment](https://technet.microsoft.com/library/gg982489) in hello [AD Guida alla progettazione di ADFS 2.0](https://technet.microsoft.com/library/dd807036) toodecide migliori opzioni di configurazione di distribuzione in base alle esigenze specifiche.</span><span class="sxs-lookup"><span data-stu-id="d6422-694">See [AD FS 2.0 deployment topology considerations](https://technet.microsoft.com/library/gg982489) in hello [AD FS 2.0 Design Guide](https://technet.microsoft.com/library/dd807036) toodecide which deployment configuration options best suit your particular needs.</span></span>

> [!NOTE]
> <span data-ttu-id="d6422-695">Nel bilanciamento del carico di ordine tooget per gli endpoint ADFS di Windows Server Active Directory in Azure, configurare tutti i membri della farm ADFS di Windows Server hello in hello stesso servizio cloud e usare hello funzionalità Bilanciamento del carico di Azure per (impostazione predefinita 80) porte HTTP e HTTPS (443 per impostazione predefinita).</span><span class="sxs-lookup"><span data-stu-id="d6422-695">In order tooget load balancing for Windows Server AD FS endpoints on Azure, configure all members of hello Windows Server AD FS farm in hello same cloud service, and use hello load balancing capability of Azure for HTTP (default 80) and HTTPS ports (default 443).</span></span> <span data-ttu-id="d6422-696">Per altre informazioni, vedere l'articolo relativo al [probe di bilanciamento del carico di Azure](https://msdn.microsoft.com/library/azure/jj151530).</span><span class="sxs-lookup"><span data-stu-id="d6422-696">For more information, see [Azure load-balancer probe](https://msdn.microsoft.com/library/azure/jj151530).</span></span>
> <span data-ttu-id="d6422-697">Il bilanciamento del carico di rete di Windows Server non è supportato in Azure.</span><span class="sxs-lookup"><span data-stu-id="d6422-697">Windows Server Network Load Balancing (NLB) is not supported on Azure.</span></span>
> 
> 

