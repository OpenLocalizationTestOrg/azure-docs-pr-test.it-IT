---
title: aaaUsing Elasticsearch come archivio di analisi applicazione di Service Fabric | Documenti Microsoft
description: "Descrive come è possono utilizzare le applicazioni di Service Fabric toostore Elasticsearch e Kibana, indicizzazione e ricerca tramite tracce di applicazione (log)"
services: service-fabric
documentationcenter: .net
author: karolz-ms
manager: adegeo
editor: 
ms.assetid: e59b0c39-e468-4d9e-b453-d5f2a8ad20d8
ms.service: service-fabric
ms.devlang: dotNet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/07/2017
ms.author: karolz@microsoft.com
redirect_url: /azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow
ms.openlocfilehash: b5977c54e69319e3caa376e44a02f971b66a3254
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="use-elasticsearch-as-a-service-fabric-application-trace-store"></a><span data-ttu-id="0448a-103">Usare ElasticSearch come archivio di traccia delle applicazioni di Service Fabric</span><span class="sxs-lookup"><span data-stu-id="0448a-103">Use Elasticsearch as a Service Fabric application trace store</span></span>
## <a name="introduction"></a><span data-ttu-id="0448a-104">Introduzione</span><span class="sxs-lookup"><span data-stu-id="0448a-104">Introduction</span></span>
<span data-ttu-id="0448a-105">Questo articolo descrive le modalità in cui le applicazioni di [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) possono usare **ElasticSearch** e **Kibana** per l'archiviazione delle tracce, l'indicizzazione e la ricerca.</span><span class="sxs-lookup"><span data-stu-id="0448a-105">This article describes how [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) applications can use **Elasticsearch** and **Kibana** for application trace storage, indexing, and search.</span></span> <span data-ttu-id="0448a-106">[ElasticSearch](https://www.elastic.co/guide/index.html) è un motore di ricerca e analisi open source, distribuito e scalabile in tempo reale, nonché particolarmente adatto per questa attività,</span><span class="sxs-lookup"><span data-stu-id="0448a-106">[Elasticsearch](https://www.elastic.co/guide/index.html) is an open-source, distributed, and scalable real-time search and analytics engine that is well-suited for this task.</span></span> <span data-ttu-id="0448a-107">che può essere installato in macchine virtuali Windows o Linux con Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="0448a-107">It can be installed on Windows and Linux virtual machines running in Microsoft Azure.</span></span> <span data-ttu-id="0448a-108">Elasticsearch può elaborare in modo efficiente tracce *strutturate* create con tecnologie come **Event Tracing for Windows (ETW)**.</span><span class="sxs-lookup"><span data-stu-id="0448a-108">Elasticsearch can efficiently process *structured* traces produced using technologies such as **Event Tracing for Windows (ETW)**.</span></span>

<span data-ttu-id="0448a-109">ETW è usato da informazioni di diagnostica toosource runtime Service Fabric (tracce).</span><span class="sxs-lookup"><span data-stu-id="0448a-109">ETW is used by Service Fabric runtime toosource diagnostic information (traces).</span></span> <span data-ttu-id="0448a-110">È hello metodo consigliato per Service Fabric applicazioni toosource le informazioni di diagnostica, troppo.</span><span class="sxs-lookup"><span data-stu-id="0448a-110">It is hello recommended method for Service Fabric applications toosource their diagnostic information, too.</span></span> <span data-ttu-id="0448a-111">Utilizzo di hello consente stesso meccanismo per la correlazione tra tracce fornito dal runtime e fornita dall'applicazione e facilita la risoluzione dei problemi semplificata.</span><span class="sxs-lookup"><span data-stu-id="0448a-111">Using hello same mechanism allows for correlation between runtime-supplied and application-supplied traces and makes troubleshooting easier.</span></span> <span data-ttu-id="0448a-112">Modelli di progetto Service Fabric in Visual Studio includono un'API di registrazione (in base a hello .NET **EventSource** classe) che emette le tracce ETW per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="0448a-112">Service Fabric project templates in Visual Studio include a logging API (based on hello .NET **EventSource** class) that emits ETW traces by default.</span></span> <span data-ttu-id="0448a-113">Per una panoramica generale sulla definizione delle tracce delle applicazioni di Service Fabric con ETW, vedere [Monitorare e diagnosticare servizi in una configurazione di sviluppo con computer locale](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span><span class="sxs-lookup"><span data-stu-id="0448a-113">For a general overview of Service Fabric application tracing using ETW, see [Monitoring and diagnosing services in a local machine development setup](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span></span>

<span data-ttu-id="0448a-114">Per tooshow tracce hello backup in Elasticsearch, hanno bisogno toobe acquisiti nei nodi del cluster di Service Fabric hello in tempo reale (quando è in esecuzione un'applicazione hello) e inviati tooan Elasticsearch endpoint.</span><span class="sxs-lookup"><span data-stu-id="0448a-114">For hello traces tooshow up in Elasticsearch, they need toobe captured at hello Service Fabric cluster nodes in real time (while hello application is running) and sent tooan Elasticsearch endpoint.</span></span> <span data-ttu-id="0448a-115">Per l'acquisizione di tracce sono disponibili due opzioni principali:</span><span class="sxs-lookup"><span data-stu-id="0448a-115">There are two major options for trace capturing:</span></span>

* <span data-ttu-id="0448a-116">**Acquisizione di tracce in-process**</span><span class="sxs-lookup"><span data-stu-id="0448a-116">**In-process trace capturing**</span></span>  
  <span data-ttu-id="0448a-117">un'applicazione Hello o più precisamente, processo del servizio, è responsabile per l'invio all'archivio di analisi hello dati di diagnostica toohello (Elasticsearch).</span><span class="sxs-lookup"><span data-stu-id="0448a-117">hello application, or more precisely, service process, is responsible for sending out hello diagnostic data toohello trace store (Elasticsearch).</span></span>
* <span data-ttu-id="0448a-118">**Acquisizione di tracce out-of-process**</span><span class="sxs-lookup"><span data-stu-id="0448a-118">**Out-of-process trace capturing**</span></span>  
  <span data-ttu-id="0448a-119">Un agente distinto è acquisire tracce da servizio hello o più processi e inviarli toohello archivio di analisi.</span><span class="sxs-lookup"><span data-stu-id="0448a-119">A separate agent is capturing traces from hello service process or processes and sending them toohello trace store.</span></span>

<span data-ttu-id="0448a-120">Di seguito, viene descritto come tooset backup Elasticsearch in Azure, discutere i professionisti hello e gli svantaggi di entrambe le opzioni di acquisizione e spiegano come tooconfigure un'infrastruttura di servizio del servizio toosend dati tooElasticsearch.</span><span class="sxs-lookup"><span data-stu-id="0448a-120">Below, we describe how tooset up Elasticsearch on Azure, discuss hello pros and cons for both capture options, and explain how tooconfigure a Service Fabric service toosend data tooElasticsearch.</span></span>

## <a name="set-up-elasticsearch-on-azure"></a><span data-ttu-id="0448a-121">Configurare ElasticSearch in Azure</span><span class="sxs-lookup"><span data-stu-id="0448a-121">Set up Elasticsearch on Azure</span></span>
<span data-ttu-id="0448a-122">Hello tooset modo più semplice il servizio Elasticsearch hello in Azure viene eseguita tramite [ **modelli di gestione risorse di Azure**](../azure-resource-manager/resource-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="0448a-122">hello most straightforward way tooset up hello Elasticsearch service on Azure is through [**Azure Resource Manager templates**](../azure-resource-manager/resource-group-overview.md).</span></span> <span data-ttu-id="0448a-123">Un [modello di avvio rapido di Azure Resource Manager per ElasticSearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) è disponibile nel repository dei modelli di avvio rapido di Azure.</span><span class="sxs-lookup"><span data-stu-id="0448a-123">A comprehensive [Quickstart Azure Resource Manager template for Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) is available from Azure Quickstart templates repository.</span></span> <span data-ttu-id="0448a-124">Questo modello usa account di archiviazione separati per le unità di scala (gruppi di nodi)</span><span class="sxs-lookup"><span data-stu-id="0448a-124">This template uses separate storage accounts for scale units (groups of nodes).</span></span> <span data-ttu-id="0448a-125">e può effettuare il provisioning di nodi client e server distinti con configurazioni diverse e un numero variabile di dischi dati collegati.</span><span class="sxs-lookup"><span data-stu-id="0448a-125">It can also provision separate client and server nodes with different configurations and various numbers of data disks attached.</span></span>

<span data-ttu-id="0448a-126">Qui, si utilizza un modello diverso, denominato **ES MultiNode** da hello [archivio degli strumenti di diagnostica Azure](https://github.com/Azure/azure-diagnostics-tools).</span><span class="sxs-lookup"><span data-stu-id="0448a-126">Here, we use another template, called **ES-MultiNode** from hello [Azure diagnostic tools repository](https://github.com/Azure/azure-diagnostics-tools).</span></span> <span data-ttu-id="0448a-127">Questo modello è più facile toouse e viene creato un cluster Elasticsearch protetto dall'autenticazione di base HTTP.</span><span class="sxs-lookup"><span data-stu-id="0448a-127">This template is easier toouse, and it creates an Elasticsearch cluster protected by HTTP basic authentication.</span></span> <span data-ttu-id="0448a-128">Prima di continuare, scaricare repository hello dalla macchina tooyour GitHub (per la clonazione del repository hello o download di un file zip).</span><span class="sxs-lookup"><span data-stu-id="0448a-128">Before you proceed, download hello repository from GitHub tooyour machine (by either cloning hello repository or downloading a zip file).</span></span> <span data-ttu-id="0448a-129">Hello ES MultiNode modello si trova nella cartella hello con hello stesso nome.</span><span class="sxs-lookup"><span data-stu-id="0448a-129">hello ES-MultiNode template is located in hello folder with hello same name.</span></span>

### <a name="prepare-a-machine-toorun-elasticsearch-installation-scripts"></a><span data-ttu-id="0448a-130">Preparare un toorun macchina Elasticsearch gli script di installazione</span><span class="sxs-lookup"><span data-stu-id="0448a-130">Prepare a machine toorun Elasticsearch installation scripts</span></span>
<span data-ttu-id="0448a-131">Hello modello di hello ES MultiNode toouse modo più semplice è tramite uno script di PowerShell di Azure fornito denominato `CreateElasticSearchCluster`.</span><span class="sxs-lookup"><span data-stu-id="0448a-131">hello easiest way toouse hello ES-MultiNode template is through a provided Azure PowerShell script called `CreateElasticSearchCluster`.</span></span> <span data-ttu-id="0448a-132">toouse questo script, è necessario uno strumento denominato e moduli tooinstall **openssl**.</span><span class="sxs-lookup"><span data-stu-id="0448a-132">toouse this script, you need tooinstall PowerShell modules and a tool called **openssl**.</span></span> <span data-ttu-id="0448a-133">Hello quest'ultimo è necessaria per la creazione di una chiave SSH che può essere utilizzati tooadminister Elasticsearch cluster in modalità remota.</span><span class="sxs-lookup"><span data-stu-id="0448a-133">hello latter is needed for creating an SSH key that can be used tooadminister your Elasticsearch cluster remotely.</span></span>

<span data-ttu-id="0448a-134">`CreateElasticSearchCluster`script è progettato per facilitare l'utilizzo con il modello di hello ES MultiNode da un computer Windows.</span><span class="sxs-lookup"><span data-stu-id="0448a-134">`CreateElasticSearchCluster` script is designed for ease of use with hello ES-MultiNode template from a Windows machine.</span></span> <span data-ttu-id="0448a-135">È possibile toouse hello al modello in un computer non Windows, ma tale scenario esula dall'ambito di hello di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="0448a-135">It is possible toouse hello template on a non-Windows machine, but that scenario is beyond hello scope of this article.</span></span>

1. <span data-ttu-id="0448a-136">Se non sono già stati installati, installare i [**moduli di Azure PowerShell**](http://aka.ms/webpi-azps).</span><span class="sxs-lookup"><span data-stu-id="0448a-136">If you haven't installed them already, install [**Azure PowerShell modules**](http://aka.ms/webpi-azps).</span></span> <span data-ttu-id="0448a-137">Quando richiesto, fare clic su **Esegui** e su **Installa**.</span><span class="sxs-lookup"><span data-stu-id="0448a-137">When prompted, click **Run**, then **Install**.</span></span> <span data-ttu-id="0448a-138">È richiesto Azure PowerShell 1.3 o versioni successive.</span><span class="sxs-lookup"><span data-stu-id="0448a-138">Azure PowerShell 1.3 or newer is required.</span></span>
2. <span data-ttu-id="0448a-139">Hello **openssl** lo strumento è incluso nella distribuzione hello di [ **Git per Windows**](http://www.git-scm.com/downloads).</span><span class="sxs-lookup"><span data-stu-id="0448a-139">hello **openssl** tool is included in hello distribution of [**Git for Windows**](http://www.git-scm.com/downloads).</span></span> <span data-ttu-id="0448a-140">Se non è già stato fatto, installare [Git per Windows](http://www.git-scm.com/downloads) .</span><span class="sxs-lookup"><span data-stu-id="0448a-140">If you have not done so already, install [Git for Windows](http://www.git-scm.com/downloads) now.</span></span> <span data-ttu-id="0448a-141">le opzioni di installazione predefinite hello sono OK.</span><span class="sxs-lookup"><span data-stu-id="0448a-141">(hello default installation options are OK.)</span></span>
3. <span data-ttu-id="0448a-142">Supponendo che Git è stato installato ma non inclusi nel percorso di sistema hello, aprire una finestra di Microsoft Azure PowerShell ed eseguire hello seguenti comandi:</span><span class="sxs-lookup"><span data-stu-id="0448a-142">Assuming that Git has been installed but not included in hello system path, open a Microsoft Azure PowerShell window and run hello following commands:</span></span>
   
    ```powershell
    $ENV:PATH += ";<Git installation folder>\usr\bin"
    $ENV:OPENSSL_CONF = "<Git installation folder>\usr\ssl\openssl.cnf"
    ```
   
    <span data-ttu-id="0448a-143">Sostituire hello `<Git installation folder>` con percorso di hello Git nel computer; valore predefinito di hello è **"C:\Programmi\Microsoft Files\Git"**.</span><span class="sxs-lookup"><span data-stu-id="0448a-143">Replace hello `<Git installation folder>` with hello Git location on your machine; hello default is **"C:\Program Files\Git"**.</span></span> <span data-ttu-id="0448a-144">Si noti il carattere punto e virgola hello all'inizio di hello del primo percorso hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-144">Note hello semicolon character at hello beginning of hello first path.</span></span>
4. <span data-ttu-id="0448a-145">Verificare che si è connessi tooAzure (tramite [ `Add-AzureRmAccount` ](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) e di aver selezionato una sottoscrizione di hello che deve essere utilizzato il cluster di ricerca elastico toocreate.</span><span class="sxs-lookup"><span data-stu-id="0448a-145">Ensure that you are logged on tooAzure (via [`Add-AzureRmAccount`](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) and that you have selected hello subscription that should be used toocreate your Elastic Search cluster.</span></span> <span data-ttu-id="0448a-146">Per verificare che sia selezionata la sottoscrizione corretta, è possibile usare i cmdlet `Get-AzureRmContext` e `Get-AzureRmSubscription`.</span><span class="sxs-lookup"><span data-stu-id="0448a-146">You can verify that correct subscription is selected using `Get-AzureRmContext` and `Get-AzureRmSubscription` cmdlets.</span></span>
5. <span data-ttu-id="0448a-147">Se non è già fatto, Modifica cartella toohello ES MultiNode della directory corrente hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-147">If you haven't done so already, change hello current directory toohello ES-MultiNode folder.</span></span>

### <a name="run-hello-createelasticsearchcluster-script"></a><span data-ttu-id="0448a-148">Eseguire script CreateElasticSearchCluster hello</span><span class="sxs-lookup"><span data-stu-id="0448a-148">Run hello CreateElasticSearchCluster script</span></span>
<span data-ttu-id="0448a-149">Prima di eseguire script hello, aprire hello `azuredeploy-parameters.json` file e verificare o fornire valori per parametri di script hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-149">Before you run hello script, open hello `azuredeploy-parameters.json` file and verify or provide values for hello script parameters.</span></span> <span data-ttu-id="0448a-150">viene fornito Hello seguenti parametri:</span><span class="sxs-lookup"><span data-stu-id="0448a-150">hello following parameters are provided:</span></span>

| <span data-ttu-id="0448a-151">Nome parametro</span><span class="sxs-lookup"><span data-stu-id="0448a-151">Parameter Name</span></span> | <span data-ttu-id="0448a-152">Description</span><span class="sxs-lookup"><span data-stu-id="0448a-152">Description</span></span> |
| --- | --- |
| <span data-ttu-id="0448a-153">dnsNameForLoadBalancerIP</span><span class="sxs-lookup"><span data-stu-id="0448a-153">dnsNameForLoadBalancerIP</span></span> |<span data-ttu-id="0448a-154">Hello nome toocreate utilizzati hello visibili pubblicamente nome DNS cluster ricerca elastico hello (aggiungendo toohello fornito di dominio di hello regione di Azure).</span><span class="sxs-lookup"><span data-stu-id="0448a-154">hello name that is used toocreate hello publicly visible DNS name for hello Elastic Search cluster (by appending hello Azure region domain toohello provided name).</span></span> <span data-ttu-id="0448a-155">Ad esempio, se il valore del parametro è "myBigCluster" e area di Azure hello scelto è Stati Uniti occidentali, hello risultante nome DNS cluster hello è myBigCluster.westus.cloudapp.azure.com.</span><span class="sxs-lookup"><span data-stu-id="0448a-155">For example, if this parameter value is "myBigCluster" and hello chosen Azure region is West US, hello resulting DNS name for hello cluster is myBigCluster.westus.cloudapp.azure.com.</span></span> <br /><br /><span data-ttu-id="0448a-156">Questo nome funge anche da un nome radice per tutti gli elementi associati hello ricerca elastico cluster, ad esempio i nomi dei nodi di dati.</span><span class="sxs-lookup"><span data-stu-id="0448a-156">This name also serves as a root name for many artifacts associated with hello Elastic Search cluster, such as data node names.</span></span> |
| <span data-ttu-id="0448a-157">adminUsername</span><span class="sxs-lookup"><span data-stu-id="0448a-157">adminUsername</span></span> |<span data-ttu-id="0448a-158">nome di Hello dell'account di amministratore hello per la gestione dei cluster di ricerca elastico hello (chiavi SSH corrispondenti vengono generate automaticamente).</span><span class="sxs-lookup"><span data-stu-id="0448a-158">hello name of hello administrator account for managing hello Elastic Search cluster (corresponding SSH keys are generated automatically).</span></span> |
| <span data-ttu-id="0448a-159">dataNodeCount</span><span class="sxs-lookup"><span data-stu-id="0448a-159">dataNodeCount</span></span> |<span data-ttu-id="0448a-160">numero di Hello di nodi nel cluster ricerca elastico hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-160">hello number of nodes in hello Elastic Search cluster.</span></span> <span data-ttu-id="0448a-161">la versione corrente di Hello dello script di hello non distingue tra nodi di dati e query. tutti i nodi riprodurre entrambi ruoli.</span><span class="sxs-lookup"><span data-stu-id="0448a-161">hello current version of hello script does not distinguish between data and query nodes; all nodes play both roles.</span></span> <span data-ttu-id="0448a-162">Nodi too3 valori predefiniti.</span><span class="sxs-lookup"><span data-stu-id="0448a-162">Defaults too3 nodes.</span></span> |
| <span data-ttu-id="0448a-163">dataDiskSize</span><span class="sxs-lookup"><span data-stu-id="0448a-163">dataDiskSize</span></span> |<span data-ttu-id="0448a-164">dimensione di Hello dei dischi di dati (in GB) allocata per ogni nodo di dati.</span><span class="sxs-lookup"><span data-stu-id="0448a-164">hello size of data disks (in GB) that is allocated for each data node.</span></span> <span data-ttu-id="0448a-165">Ogni nodo riceve 4 dischi dati, in modo esclusivo dedicato tooElastic servizio di ricerca.</span><span class="sxs-lookup"><span data-stu-id="0448a-165">Each node receives 4 data disks, exclusively dedicated tooElastic Search service.</span></span> |
| <span data-ttu-id="0448a-166">region</span><span class="sxs-lookup"><span data-stu-id="0448a-166">region</span></span> |<span data-ttu-id="0448a-167">nome Hello dell'area di Azure in cui deve essere collocato cluster ricerca elastico hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-167">hello name of Azure region where hello Elastic Search cluster should be located.</span></span> |
| <span data-ttu-id="0448a-168">esUserName</span><span class="sxs-lookup"><span data-stu-id="0448a-168">esUserName</span></span> |<span data-ttu-id="0448a-169">Hello nome utente dell'utente hello che viene configurato toohave accesso tooES cluster (soggetto tooHTTP l'autenticazione di base).</span><span class="sxs-lookup"><span data-stu-id="0448a-169">hello user name of hello user that is configured toohave access tooES cluster (subject tooHTTP basic authentication).</span></span> <span data-ttu-id="0448a-170">Hello password non fa parte del file di parametri e deve essere specificata quando `CreateElasticSearchCluster` script viene richiamato.</span><span class="sxs-lookup"><span data-stu-id="0448a-170">hello password is not part of parameters file and must be provided when `CreateElasticSearchCluster` script is invoked.</span></span> |
| <span data-ttu-id="0448a-171">vmSizeDataNodes</span><span class="sxs-lookup"><span data-stu-id="0448a-171">vmSizeDataNodes</span></span> |<span data-ttu-id="0448a-172">dimensioni di macchina virtuale di Azure per i nodi del cluster ricerca elastico Hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-172">hello Azure virtual machine size for Elastic Search cluster nodes.</span></span> <span data-ttu-id="0448a-173">TooStandard_D2 impostazioni predefinite.</span><span class="sxs-lookup"><span data-stu-id="0448a-173">Defaults tooStandard_D2.</span></span> |

<span data-ttu-id="0448a-174">Si è ora script hello toorun pronto.</span><span class="sxs-lookup"><span data-stu-id="0448a-174">Now you are ready toorun hello script.</span></span> <span data-ttu-id="0448a-175">Eseguire hello comando seguente:</span><span class="sxs-lookup"><span data-stu-id="0448a-175">Issue hello following command:</span></span>

```powershell
CreateElasticSearchCluster -ResourceGroupName <es-group-name> -Region <azure-region> -EsPassword <es-password>
```

<span data-ttu-id="0448a-176">dove</span><span class="sxs-lookup"><span data-stu-id="0448a-176">where</span></span> 

| <span data-ttu-id="0448a-177">Nome del parametro di script</span><span class="sxs-lookup"><span data-stu-id="0448a-177">Script Parameter Name</span></span> | <span data-ttu-id="0448a-178">Descrizione</span><span class="sxs-lookup"><span data-stu-id="0448a-178">Description</span></span> |
| --- | --- |
| `<es-group-name>` |<span data-ttu-id="0448a-179">nome Hello hello Azure del gruppo di risorse che conterrà tutte le risorse cluster ricerca elastico.</span><span class="sxs-lookup"><span data-stu-id="0448a-179">hello name of hello Azure resource group that will contain all Elastic Search cluster resources.</span></span> |
| `<azure-region>` |<span data-ttu-id="0448a-180">nome Hello dell'area di Azure in cui deve essere creato il cluster di ricerca elastico hello hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-180">hello name of hello Azure region where hello Elastic Search cluster should be created.</span></span> |
| `<es-password>` |<span data-ttu-id="0448a-181">password di Hello per hello elastico ricerca utente.</span><span class="sxs-lookup"><span data-stu-id="0448a-181">hello password for hello Elastic Search user.</span></span> |

> [!NOTE]
> <span data-ttu-id="0448a-182">Se si verifica un'eccezione NullReferenceException dal cmdlet hello AzureResourceGroup di Test, è stata dimenticata toolog su tooAzure (`Add-AzureRmAccount`).</span><span class="sxs-lookup"><span data-stu-id="0448a-182">If you get a NullReferenceException from hello Test-AzureResourceGroup cmdlet, you have forgotten toolog on tooAzure (`Add-AzureRmAccount`).</span></span>
> 
> 

<span data-ttu-id="0448a-183">Se si verifica un errore dell'esecuzione dello script hello e si stabilisce che l'errore hello è stato causato da un valore di parametro di modello errato, correggere il file di parametro hello ed eseguire script hello nuovamente con il nome di un gruppo di risorse diverso.</span><span class="sxs-lookup"><span data-stu-id="0448a-183">If you get an error from running hello script and you determine that hello error was caused by a wrong template parameter value, correct hello parameter file and run hello script again with a different resource group name.</span></span> <span data-ttu-id="0448a-184">È inoltre possibile riutilizzare hello stesso nome del gruppo di risorse e dispone di script hello pulizia hello precedente aggiungendo hello `-RemoveExistingResourceGroup` chiamata dello script toohello di parametro.</span><span class="sxs-lookup"><span data-stu-id="0448a-184">You can also reuse hello same resource group name and have hello script clean up hello old one by adding hello `-RemoveExistingResourceGroup` parameter toohello script invocation.</span></span>

### <a name="result-of-running-hello-createelasticsearchcluster-script"></a><span data-ttu-id="0448a-185">Risultato dell'esecuzione di script CreateElasticSearchCluster hello</span><span class="sxs-lookup"><span data-stu-id="0448a-185">Result of running hello CreateElasticSearchCluster script</span></span>
<span data-ttu-id="0448a-186">Dopo aver eseguito hello `CreateElasticSearchCluster` script, verrà creato hello segue gli elementi principali.</span><span class="sxs-lookup"><span data-stu-id="0448a-186">After you run hello `CreateElasticSearchCluster` script, hello following main artifacts will be created.</span></span> <span data-ttu-id="0448a-187">In questo esempio si presuppone che si usa "myBigCluster" come valore di hello di hello `dnsNameForLoadBalancerIP` parametro e tale area hello in cui è stato creato il cluster hello è Stati Uniti occidentali.</span><span class="sxs-lookup"><span data-stu-id="0448a-187">For this example we assume that you have used "myBigCluster" as hello value of hello `dnsNameForLoadBalancerIP` parameter and that hello region where you created hello cluster is West US.</span></span>

| <span data-ttu-id="0448a-188">Elemento</span><span class="sxs-lookup"><span data-stu-id="0448a-188">Artifact</span></span> | <span data-ttu-id="0448a-189">Nome, percorso e note</span><span class="sxs-lookup"><span data-stu-id="0448a-189">Name, location, and remarks</span></span> |
| --- | --- |
| <span data-ttu-id="0448a-190">Chiave SSH per l'amministrazione remota</span><span class="sxs-lookup"><span data-stu-id="0448a-190">SSH key for remote administration</span></span> |<span data-ttu-id="0448a-191">file myBigCluster.key (nella directory hello da quale hello è stato eseguito CreateElasticSearchCluster).</span><span class="sxs-lookup"><span data-stu-id="0448a-191">myBigCluster.key file (in hello directory from which hello CreateElasticSearchCluster was run).</span></span> <br /><br /><span data-ttu-id="0448a-192">Questo file di chiave può essere utilizzato tooconnect toohello admin nodo e (tramite nodo Amministrazione hello) toodata nodi nel cluster hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-192">This key file can be used tooconnect toohello admin node and (through hello admin node) toodata nodes in hello cluster.</span></span> |
| <span data-ttu-id="0448a-193">Nodo amministratore</span><span class="sxs-lookup"><span data-stu-id="0448a-193">Admin node</span></span> |<span data-ttu-id="0448a-194">myBigCluster admin.westus.cloudapp.azure.com </span><span class="sxs-lookup"><span data-stu-id="0448a-194">myBigCluster-admin.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="0448a-195">Una macchina virtuale dedicata per l'amministrazione remota del cluster di Elasticsearch - hello solo uno che consenta le connessioni SSH esterne.</span><span class="sxs-lookup"><span data-stu-id="0448a-195">A dedicated VM for remote Elasticsearch cluster administration--hello only one that allows external SSH connections.</span></span> <span data-ttu-id="0448a-196">Viene eseguito nella stessa rete virtuale come tutti i nodi del cluster Elasticsearch hello, ma non eseguita servizi Elasticsearch hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-196">It runs on hello same virtual network as all hello Elasticsearch cluster nodes, but it does not run any Elasticsearch services.</span></span> |
| <span data-ttu-id="0448a-197">Nodi dati</span><span class="sxs-lookup"><span data-stu-id="0448a-197">Data nodes</span></span> |<span data-ttu-id="0448a-198">myBigCluster1 …</span><span class="sxs-lookup"><span data-stu-id="0448a-198">myBigCluster1 …</span></span> <span data-ttu-id="0448a-199">myBigCluster*N*</span><span class="sxs-lookup"><span data-stu-id="0448a-199">myBigCluster*N*</span></span> <br /><br /><span data-ttu-id="0448a-200">Nodi di dati che eseguono servizi Elasticsearch e Kibana.</span><span class="sxs-lookup"><span data-stu-id="0448a-200">Data nodes that are running Elasticsearch and Kibana services.</span></span> <span data-ttu-id="0448a-201">È possibile connettersi tramite SSH tooeach nodo, ma solo tramite nodo Amministrazione hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-201">You can connect via SSH tooeach node, but only via hello admin node.</span></span> |
| <span data-ttu-id="0448a-202">Cluster Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="0448a-202">Elasticsearch cluster</span></span> |<span data-ttu-id="0448a-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span><span class="sxs-lookup"><span data-stu-id="0448a-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span></span> <br /><br /><span data-ttu-id="0448a-204">Hello endpoint primario per il cluster di Elasticsearch hello (suffisso /es di hello nota).</span><span class="sxs-lookup"><span data-stu-id="0448a-204">hello primary endpoint for hello Elasticsearch cluster (note hello /es suffix).</span></span> <span data-ttu-id="0448a-205">È protetta da autenticazione HTTP di base (hello credenziali hello specificato esUserName/esPassword parametri di modello hello ES MultiNode).</span><span class="sxs-lookup"><span data-stu-id="0448a-205">It is protected by basic HTTP authentication (hello credentials were hello specified esUserName/esPassword parameters of hello ES-MultiNode template).</span></span> <span data-ttu-id="0448a-206">cluster Hello presenta inoltre hello head plug-in installati (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) per l'amministrazione del cluster di base.</span><span class="sxs-lookup"><span data-stu-id="0448a-206">hello cluster has also hello head plug-in installed (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) for basic cluster administration.</span></span> |
| <span data-ttu-id="0448a-207">Servizio Kibana</span><span class="sxs-lookup"><span data-stu-id="0448a-207">Kibana service</span></span> |<span data-ttu-id="0448a-208">http://myBigCluster.westus.cloudapp.azure.com</span><span class="sxs-lookup"><span data-stu-id="0448a-208">http://myBigCluster.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="0448a-209">Hello Kibana servizio impostare dati tooshow da hello Elasticsearch cluster creato.</span><span class="sxs-lookup"><span data-stu-id="0448a-209">hello Kibana service is set up tooshow data from hello created Elasticsearch cluster.</span></span> <span data-ttu-id="0448a-210">È protetta da hello stesse credenziali di autenticazione come hello del cluster stesso.</span><span class="sxs-lookup"><span data-stu-id="0448a-210">It is protected by hello same authentication credentials as hello cluster itself.</span></span> |

## <a name="in-process-versus-out-of-process-trace-capturing"></a><span data-ttu-id="0448a-211">Acquisizione di tracce in-process e out-of-process</span><span class="sxs-lookup"><span data-stu-id="0448a-211">In-process versus out-of-process trace capturing</span></span>
<span data-ttu-id="0448a-212">Introduzione di hello, accennato in due modi fondamentali per la raccolta dei dati di diagnostica: in-process e out-of-process.</span><span class="sxs-lookup"><span data-stu-id="0448a-212">In hello introduction, we mentioned two fundamental ways of collecting diagnostic data: in-process and out-of-process.</span></span> <span data-ttu-id="0448a-213">Ognuna presenta vantaggi e svantaggi.</span><span class="sxs-lookup"><span data-stu-id="0448a-213">Each has strengths and weaknesses.</span></span>

<span data-ttu-id="0448a-214">Vantaggi di hello **nel processo di acquisizione traccia** includono:</span><span class="sxs-lookup"><span data-stu-id="0448a-214">Advantages of hello **in-process trace capturing** include:</span></span>

1. <span data-ttu-id="0448a-215">*Facilità di configurazione e distribuzione*</span><span class="sxs-lookup"><span data-stu-id="0448a-215">*Easy configuration and deployment*</span></span>
   
   * <span data-ttu-id="0448a-216">configurazione di Hello di raccolta dati di diagnostica è solo parte della configurazione dell'applicazione hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-216">hello configuration of diagnostic data collection is just part of hello application configuration.</span></span> <span data-ttu-id="0448a-217">È facile tooalways keep "sincronizzato" con hello il resto dell'applicazione hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-217">It is easy tooalways keep it "in sync" with hello rest of hello application.</span></span>
   * <span data-ttu-id="0448a-218">È facile ottenere la configurazione per ogni applicazione o servizio.</span><span class="sxs-lookup"><span data-stu-id="0448a-218">Per-application or per-service configuration is easily achievable.</span></span>
   * <span data-ttu-id="0448a-219">Acquisizione traccia out-of-process richiede in genere una distribuzione separata e la configurazione dell'agente, diagnostica hello è un'attività amministrativa extra e una potenziale fonte di errori.</span><span class="sxs-lookup"><span data-stu-id="0448a-219">Out-of-process trace capturing usually requires a separate deployment and configuration of hello diagnostic agent, which is an extra administrative task and a potential source of errors.</span></span> <span data-ttu-id="0448a-220">tecnologia di agente specifico Hello consente spesso di solo un'istanza dell'agente di hello per ogni macchina virtuale (nodo).</span><span class="sxs-lookup"><span data-stu-id="0448a-220">hello particular agent technology often allows only one instance of hello agent per virtual machine (node).</span></span> <span data-ttu-id="0448a-221">Ciò significa che la configurazione per la raccolta hello della configurazione di diagnostica hello viene condiviso tra tutte le applicazioni e servizi in esecuzione su tale nodo.</span><span class="sxs-lookup"><span data-stu-id="0448a-221">This means that configuration for hello collection of hello diagnostic configuration is shared among all applications and services running on that node.</span></span>
2. <span data-ttu-id="0448a-222">*Flessibilità*</span><span class="sxs-lookup"><span data-stu-id="0448a-222">*Flexibility*</span></span>
   
   * <span data-ttu-id="0448a-223">un'applicazione Hello può inviare dati di hello ogni volta che è necessario toogo, purché vi è una libreria client che supporta il sistema di archiviazione dati hello di destinazione.</span><span class="sxs-lookup"><span data-stu-id="0448a-223">hello application can send hello data wherever it needs toogo, as long as there is a client library that supports hello targeted data storage system.</span></span> <span data-ttu-id="0448a-224">Nuovi sink possono essere aggiunti secondo le esigenze.</span><span class="sxs-lookup"><span data-stu-id="0448a-224">New sinks can be added as desired.</span></span>
   * <span data-ttu-id="0448a-225">È possibile implementare complesse regole di acquisizione, filtro e aggregazione dati.</span><span class="sxs-lookup"><span data-stu-id="0448a-225">Complex capture, filtering, and data-aggregation rules can be implemented.</span></span>
   * <span data-ttu-id="0448a-226">Un'acquisizione della traccia out-of-process è spesso limitato dal sink dati hello che hello agente supporta.</span><span class="sxs-lookup"><span data-stu-id="0448a-226">An out-of-process trace capturing is often limited by hello data sinks that hello agent supports.</span></span> <span data-ttu-id="0448a-227">Alcuni agenti sono estendibili.</span><span class="sxs-lookup"><span data-stu-id="0448a-227">Some agents are extensible.</span></span>
3. <span data-ttu-id="0448a-228">*Contesto e accedere ai dati di applicazione toointernal*</span><span class="sxs-lookup"><span data-stu-id="0448a-228">*Access toointernal application data and context*</span></span>
   
   * <span data-ttu-id="0448a-229">sottosistema di diagnostica Hello in esecuzione nel processo di applicazioni o servizi hello possibile integrare facilmente le tracce di hello con informazioni contestuali.</span><span class="sxs-lookup"><span data-stu-id="0448a-229">hello diagnostic subsystem running inside hello application/service process can easily augment hello traces with contextual information.</span></span>
   * <span data-ttu-id="0448a-230">Nell'approccio a out-of-process hello, hello devono essere inviati dati agente tooan tramite un meccanismo di comunicazione tra processi, ad esempio Event Tracing for Windows.</span><span class="sxs-lookup"><span data-stu-id="0448a-230">In hello out-of-process approach, hello data must be sent tooan agent via some inter-process communication mechanism, such as Event Tracing for Windows.</span></span> <span data-ttu-id="0448a-231">Questo meccanismo può imporre limitazioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="0448a-231">This mechanism could impose additional limitations.</span></span>

<span data-ttu-id="0448a-232">Vantaggi di hello **acquisizione traccia out-of-process** includono:</span><span class="sxs-lookup"><span data-stu-id="0448a-232">Advantages of hello **out-of-process trace capturing** include:</span></span>

1. <span data-ttu-id="0448a-233">*un'applicazione hello toomonitor possibilità Hello e raccogliere i dump di arresto anomalo*</span><span class="sxs-lookup"><span data-stu-id="0448a-233">*hello ability toomonitor hello application and collect crash dumps*</span></span>
   
   * <span data-ttu-id="0448a-234">Acquisizione traccia in-process può essere esito negativo se un'applicazione hello toostart o arresti anomali.</span><span class="sxs-lookup"><span data-stu-id="0448a-234">In-process trace capturing may be unsuccessful if hello application fails toostart or crashes.</span></span> <span data-ttu-id="0448a-235">Un agente indipendente ha maggiori possibilità di acquisire informazioni cruciali sulla risoluzione dei problemi.</span><span class="sxs-lookup"><span data-stu-id="0448a-235">An independent agent has a much better chance of capturing crucial troubleshooting information.</span></span><br /><br />
2. <span data-ttu-id="0448a-236">*Maturità, affidabilità e prestazioni comprovate*</span><span class="sxs-lookup"><span data-stu-id="0448a-236">*Maturity, robustness, and proven performance*</span></span>
   
   * <span data-ttu-id="0448a-237">Un agente sviluppato da un fornitore di piattaforma (ad esempio, un agente di Microsoft Azure Diagnostics) è stata toorigorous oggetto test e la protezione avanzata di battaglia.</span><span class="sxs-lookup"><span data-stu-id="0448a-237">An agent developed by a platform vendor (such as a Microsoft Azure Diagnostics agent) has been subject toorigorous testing and battle-hardening.</span></span>
   * <span data-ttu-id="0448a-238">Con la traccia nel processo di acquisizione, prestare attenzione tooensure attività hello di invio dei dati di diagnostica da un processo dell'applicazione non interferire con l'attività principale dell'applicazione hello o introdurre problemi di temporizzazione o prestazioni.</span><span class="sxs-lookup"><span data-stu-id="0448a-238">With in-process trace capturing, care must be taken tooensure that hello activity of sending diagnostic data from an application process does not interfere with hello application's main tasks or introduce timing or performance problems.</span></span> <span data-ttu-id="0448a-239">Un agente in modo indipendente in esecuzione è meno soggetto a problemi toothese ed è specificamente progettato toolimit impatto sul sistema hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-239">An independently running agent is less prone toothese issues and is specifically designed toolimit its impact on hello system.</span></span>

<span data-ttu-id="0448a-240">È possibile toocombine e trarre vantaggio da entrambi gli approcci.</span><span class="sxs-lookup"><span data-stu-id="0448a-240">It is possible toocombine and benefit from both approaches.</span></span> <span data-ttu-id="0448a-241">Infatti, potrebbe essere la soluzione migliore di hello per molte applicazioni.</span><span class="sxs-lookup"><span data-stu-id="0448a-241">Indeed, it might be hello best solution for many applications.</span></span>

<span data-ttu-id="0448a-242">In questo caso, utilizziamo hello **Microsoft.Diagnostic.Listeners libreria** e di traccia in-process hello acquisizione dei dati toosend da un cluster di Service Fabric application tooan Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="0448a-242">Here, we use hello **Microsoft.Diagnostic.Listeners library** and hello in-process trace capturing toosend data from a Service Fabric application tooan Elasticsearch cluster.</span></span>

## <a name="use-hello-listeners-library-toosend-diagnostic-data-tooelasticsearch"></a><span data-ttu-id="0448a-243">Utilizzare hello listener libreria toosend dati di diagnostica tooElasticsearch</span><span class="sxs-lookup"><span data-stu-id="0448a-243">Use hello Listeners library toosend diagnostic data tooElasticsearch</span></span>
<span data-ttu-id="0448a-244">libreria Microsoft.Diagnostic.Listeners Hello è parte dell'applicazione di Service Fabric esempio PartyCluster.</span><span class="sxs-lookup"><span data-stu-id="0448a-244">hello Microsoft.Diagnostic.Listeners library is part of PartyCluster sample Service Fabric application.</span></span> <span data-ttu-id="0448a-245">toouse è:</span><span class="sxs-lookup"><span data-stu-id="0448a-245">toouse it:</span></span>

1. <span data-ttu-id="0448a-246">Scaricare [: esempio hello PartyCluster](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) da GitHub.</span><span class="sxs-lookup"><span data-stu-id="0448a-246">Download [hello PartyCluster sample](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) from GitHub.</span></span>
2. <span data-ttu-id="0448a-247">Copiare hello Microsoft.Diagnostics.Listeners e Microsoft.Diagnostics.Listeners.Fabric progetti (intere cartelle) dalla cartella di soluzione toohello per la directory esempio hello PartyCluster dell'applicazione hello che dovrebbe toosend hello dati tooElasticsearch .</span><span class="sxs-lookup"><span data-stu-id="0448a-247">Copy hello Microsoft.Diagnostics.Listeners and Microsoft.Diagnostics.Listeners.Fabric projects (whole folders) from hello PartyCluster sample directory toohello solution folder of hello application that is supposed toosend hello data tooElasticsearch.</span></span>
3. <span data-ttu-id="0448a-248">Aprire una soluzione di destinazione hello, fare doppio clic su nodo della soluzione in Esplora soluzioni hello hello e scegliere **Aggiungi progetto esistente**.</span><span class="sxs-lookup"><span data-stu-id="0448a-248">Open hello target solution, right-click hello solution node in hello Solution Explorer, and choose **Add Existing Project**.</span></span> <span data-ttu-id="0448a-249">Aggiunge una soluzione hello Microsoft.Diagnostics.Listeners progetto toohello.</span><span class="sxs-lookup"><span data-stu-id="0448a-249">Add hello Microsoft.Diagnostics.Listeners project toohello solution.</span></span> <span data-ttu-id="0448a-250">Ripetere il passaggio hello stesso per il progetto Microsoft.Diagnostics.Listeners.Fabric hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-250">Repeat hello same for hello Microsoft.Diagnostics.Listeners.Fabric project.</span></span>
4. <span data-ttu-id="0448a-251">Aggiungere un riferimento al progetto da uno o più progetti toohello due aggiunto progetti di servizi di.</span><span class="sxs-lookup"><span data-stu-id="0448a-251">Add a project reference from your service project(s) toohello two added projects.</span></span> <span data-ttu-id="0448a-252">(Ogni servizio che si suppone toosend dati tooElasticsearch deve fare riferimento a Microsoft.Diagnostics.EventListeners e Microsoft.Diagnostics.EventListeners.Fabric).</span><span class="sxs-lookup"><span data-stu-id="0448a-252">(Each service that is supposed toosend data tooElasticsearch should reference Microsoft.Diagnostics.EventListeners and Microsoft.Diagnostics.EventListeners.Fabric).</span></span>
   
    ![Progetto fa riferimento a tooMicrosoft.Diagnostics.EventListeners e librerie Microsoft.Diagnostics.EventListeners.Fabric][1]

### <a name="service-fabric-general-availability-release-and-microsoftdiagnosticstracing-nuget-package"></a><span data-ttu-id="0448a-254">Versione di disponibilità generale di Service Fabric e pacchetto NuGet Microsoft.Diagnostics.Tracing</span><span class="sxs-lookup"><span data-stu-id="0448a-254">Service Fabric General Availability release and Microsoft.Diagnostics.Tracing Nuget package</span></span>
<span data-ttu-id="0448a-255">Il framework di destinazione delle applicazioni compilate con la versione di disponibilità generale di Service Fabric (2.0.135, rilasciata il 31 marzo 2016) è **.NET Framework 4.5.2**.</span><span class="sxs-lookup"><span data-stu-id="0448a-255">Applications built with Service Fabric General Availability release (2.0.135, released March 31, 2016) target **.NET Framework 4.5.2**.</span></span> <span data-ttu-id="0448a-256">Questa versione è hello versione più recente di .NET Framework supportata da Azure in fase di hello della versione di hello GA hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-256">This version is hello highest version of hello .NET Framework supported by Azure at hello time of hello GA release.</span></span> <span data-ttu-id="0448a-257">Sfortunatamente, questa versione di hello framework non dispone di alcune APIs EventListener tale libreria deve Microsoft.Diagnostics.Listeners hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-257">Unfortunately, this version of hello framework lacks certain EventListener APIs that hello Microsoft.Diagnostics.Listeners library needs.</span></span> <span data-ttu-id="0448a-258">Poiché sono strettamente collegati EventSource (componente hello che costituisce la base hello di registrazione API nelle applicazioni di infrastruttura) ed EventListener, ogni progetto che utilizza hello Microsoft.Diagnostics.Listeners libreria deve utilizzare un'implementazione alternativa del EventSource.</span><span class="sxs-lookup"><span data-stu-id="0448a-258">Because EventSource (hello component that forms hello basis of logging APIs in Fabric applications) and EventListener are tightly coupled, every project that uses hello Microsoft.Diagnostics.Listeners library must use an alternative implementation of EventSource.</span></span> <span data-ttu-id="0448a-259">Questa implementazione è fornita dalla hello **pacchetto Microsoft.Diagnostics.Tracing Nuget**, creati da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="0448a-259">This implementation is provided by hello **Microsoft.Diagnostics.Tracing Nuget package**, authored by Microsoft.</span></span> <span data-ttu-id="0448a-260">pacchetto Hello è completamente compatibile con EventSource incluso nel framework di hello, pertanto alcuna modifica del codice non dovrebbe essere necessario oltre a cui viene fatto riferimento dello spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="0448a-260">hello package is fully backward-compatible with EventSource included in hello framework, so no code changes should be necessary other than referenced namespace changes.</span></span>

<span data-ttu-id="0448a-261">toostart utilizzando hello Microsoft.Diagnostics.Tracing implementazione della classe EventSource hello, seguire questi passaggi per ogni progetto di servizio che deve toosend dati tooElasticsearch:</span><span class="sxs-lookup"><span data-stu-id="0448a-261">toostart using hello Microsoft.Diagnostics.Tracing implementation of hello EventSource class, follow these steps for each service project that needs toosend data tooElasticsearch:</span></span>

1. <span data-ttu-id="0448a-262">Fare clic sul progetto di servizio hello e scegliere **Gestisci pacchetti Nuget**.</span><span class="sxs-lookup"><span data-stu-id="0448a-262">Right-click on hello service project and choose **Manage Nuget Packages**.</span></span>
2. <span data-ttu-id="0448a-263">Passare l'origine del pacchetto nuget.org toohello (se non è già selezionata) e cercare "**Microsoft.Diagnostics.Tracing**".</span><span class="sxs-lookup"><span data-stu-id="0448a-263">Switch toohello nuget.org package source (if it is not already selected) and search for "**Microsoft.Diagnostics.Tracing**".</span></span>
3. <span data-ttu-id="0448a-264">Installare hello `Microsoft.Diagnostics.Tracing.EventSource` pacchetto (e le relative dipendenze).</span><span class="sxs-lookup"><span data-stu-id="0448a-264">Install hello `Microsoft.Diagnostics.Tracing.EventSource` package (and its dependencies).</span></span>
4. <span data-ttu-id="0448a-265">Aprire hello **ServiceEventSource.cs** o **ActorEventSource.cs** file nel progetto di servizio e sostituire hello `using System.Diagnostics.Tracing` direttiva sopra file hello con hello `using Microsoft.Diagnostics.Tracing` direttiva.</span><span class="sxs-lookup"><span data-stu-id="0448a-265">Open hello **ServiceEventSource.cs** or **ActorEventSource.cs** file in your service project and replace hello `using System.Diagnostics.Tracing` directive on top of hello file with hello `using Microsoft.Diagnostics.Tracing` directive.</span></span>

<span data-ttu-id="0448a-266">Questi passaggi non sono necessari una volta hello **.NET Framework 4.6** è supportata da Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="0448a-266">These steps will not be necessary once hello **.NET Framework 4.6** is supported by Microsoft Azure.</span></span>

### <a name="elasticsearch-listener-instantiation-and-configuration"></a><span data-ttu-id="0448a-267">Creazione dell'istanza e configurazione del listener ElasticSearch</span><span class="sxs-lookup"><span data-stu-id="0448a-267">Elasticsearch listener instantiation and configuration</span></span>
<span data-ttu-id="0448a-268">Hello passaggio finale per l'invio di dati di diagnostica tooElasticsearch è toocreate un'istanza di `ElasticSearchListener` e configurarlo con i dati di connessione Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="0448a-268">hello final step for sending diagnostic data tooElasticsearch is toocreate an instance of `ElasticSearchListener` and configure it with Elasticsearch connection data.</span></span> <span data-ttu-id="0448a-269">listener Hello acquisisce automaticamente tutti gli eventi generati tramite classi EventSource definite nel progetto di servizio hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-269">hello listener automatically captures all events raised via EventSource classes defined in hello service project.</span></span> <span data-ttu-id="0448a-270">È necessario che toobe alive nel corso della durata hello del servizio di hello, in modo migliore hello inserire toocreate è presente nel codice di inizializzazione servizio hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-270">It needs toobe alive during hello lifetime of hello service, so hello best place toocreate it is in hello service initialization code.</span></span> <span data-ttu-id="0448a-271">Ecco come codice di inizializzazione hello per un servizio senza stato può apparire dopo le modifiche necessarie hello (aggiunte indicata nei commenti a partire da `****`):</span><span class="sxs-lookup"><span data-stu-id="0448a-271">Here is how hello initialization code for a stateless service could look after hello necessary changes (additions pointed out in comments starting with `****`):</span></span>

```csharp
using System;
using System.Diagnostics;
using System.Fabric;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.ServiceFabric.Services.Runtime;

// **** Add hello following directives
using Microsoft.Diagnostics.EventListeners;
using Microsoft.Diagnostics.EventListeners.Fabric;

namespace Stateless1
{
    internal static class Program
    {
        /// <summary>
        /// This is hello entry point of hello service host process.
        /// </summary>        
        private static void Main()
        {
            try
            {
                // **** Instantiate ElasticSearchListener
                var configProvider = new FabricConfigurationProvider("ElasticSearchEventListener");
                ElasticSearchListener esListener = null;
                if (configProvider.HasConfiguration)
                {
                    esListener = new ElasticSearchListener(configProvider, new FabricHealthReporter("ElasticSearchEventListener"));
                }

                // hello ServiceManifest.XML file defines one or more service type names.
                // Registering a service maps a service type name tooa .NET type.
                // When Service Fabric creates an instance of this service type,
                // an instance of hello class is created in this host process.

                ServiceRuntime.RegisterServiceAsync("Stateless1Type", 
                    context => new Stateless1(context)).GetAwaiter().GetResult();

                ServiceEventSource.Current.ServiceTypeRegistered(Process.GetCurrentProcess().Id, typeof(Stateless1).Name);

                // Prevents this host process from terminating so services keep running.
                Thread.Sleep(Timeout.Infinite);

                // **** Ensure that hello ElasticSearchListner instance is not garbage-collected prematurely
                GC.KeepAlive(esListener);
            }
            catch (Exception e)
            {
                ServiceEventSource.Current.ServiceHostInitializationFailed(e);
                throw;
            }
        }
    }
}
```

<span data-ttu-id="0448a-272">Dati di connessione Elasticsearch dovrebbero essere inseriti in una sezione distinta nel file di configurazione del servizio hello (**PackageRoot\Config\Settings.xml**).</span><span class="sxs-lookup"><span data-stu-id="0448a-272">Elasticsearch connection data should be put in a separate section in hello service configuration file (**PackageRoot\Config\Settings.xml**).</span></span> <span data-ttu-id="0448a-273">nome Hello della sezione di hello deve corrispondere il valore di toohello passato toohello `FabricConfigurationProvider` costruttore, ad esempio:</span><span class="sxs-lookup"><span data-stu-id="0448a-273">hello name of hello section must correspond toohello value passed toohello `FabricConfigurationProvider` constructor, for example:</span></span>

```xml
<Section Name="ElasticSearchEventListener">
  <Parameter Name="serviceUri" Value="http://myBigCluster.westus.cloudapp.azure.com/es/" />
  <Parameter Name="userName" Value="(ES user name)" />
  <Parameter Name="password" Value="(ES user password)" />
  <Parameter Name="indexNamePrefix" Value="myapp" />
</Section>
```
<span data-ttu-id="0448a-274">i valori di Hello `serviceUri`, `userName` e `password` parametri corrispondono toohello Elasticsearch indirizzo dell'endpoint del cluster, Elasticsearch nome di utente e password, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="0448a-274">hello values of `serviceUri`, `userName` and `password` parameters correspond toohello Elasticsearch cluster endpoint address, Elasticsearch user name, and password, respectively.</span></span> <span data-ttu-id="0448a-275">`indexNamePrefix`è un prefisso per gli indici Elasticsearch; hello libreria Microsoft.Diagnostics.Listeners Hello crea un nuovo indice per i propri dati ogni giorno.</span><span class="sxs-lookup"><span data-stu-id="0448a-275">`indexNamePrefix` is hello prefix for Elasticsearch indexes; hello Microsoft.Diagnostics.Listeners library creates a new index for its data daily.</span></span>

### <a name="verification"></a><span data-ttu-id="0448a-276">Verifica</span><span class="sxs-lookup"><span data-stu-id="0448a-276">Verification</span></span>
<span data-ttu-id="0448a-277">L'operazione è terminata.</span><span class="sxs-lookup"><span data-stu-id="0448a-277">That's it!</span></span> <span data-ttu-id="0448a-278">A questo punto, ogni volta che viene eseguito il servizio di hello, viene avviato l'invio del servizio di Elasticsearch toohello tracce specificato nella configurazione di hello.</span><span class="sxs-lookup"><span data-stu-id="0448a-278">Now, whenever hello service is run, it starts sending traces toohello Elasticsearch service specified in hello configuration.</span></span> <span data-ttu-id="0448a-279">È possibile verificarlo hello apertura che kibana UI associata hello destinazione Elasticsearch istanza.</span><span class="sxs-lookup"><span data-stu-id="0448a-279">You can verify this by opening hello Kibana UI associated with hello target Elasticsearch instance.</span></span> <span data-ttu-id="0448a-280">In questo esempio, l'indirizzo della pagina hello è http://myBigCluster.westus.cloudapp.azure.com/.</span><span class="sxs-lookup"><span data-stu-id="0448a-280">In our example, hello page address is http://myBigCluster.westus.cloudapp.azure.com/.</span></span> <span data-ttu-id="0448a-281">Verificare che gli indici con prefisso del nome hello scelto per hello `ElasticSearchListener` istanza effettivamente creato e popolato con i dati.</span><span class="sxs-lookup"><span data-stu-id="0448a-281">Check that indexes with hello name prefix chosen for hello `ElasticSearchListener` instance have indeed been created and populated with data.</span></span>

![Eventi di Kibana che mostrano l'applicazione PartyCluster][2]

## <a name="next-steps"></a><span data-ttu-id="0448a-283">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="0448a-283">Next steps</span></span>
* [<span data-ttu-id="0448a-284">Altre informazioni sulla diagnostica e il monitoraggio di un servizio di infrastruttura di servizi</span><span class="sxs-lookup"><span data-stu-id="0448a-284">Learn more about diagnosing and monitoring a Service Fabric service</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

<!--Image references-->
[1]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/listener-lib-references.png
[2]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/kibana.png
