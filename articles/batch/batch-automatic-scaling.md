---
title: Ridimensionare automaticamente i nodi di calcolo in un pool di Azure Batch | Microsoft Docs
description: Abilitare il ridimensionamento automatico in un pool cloud per adeguare dinamicamente il numero di nodi di calcolo nel pool.
services: batch
documentationcenter: 
author: tamram
manager: timlt
editor: tysonn
ms.assetid: c624cdfc-c5f2-4d13-a7d7-ae080833b779
ms.service: batch
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: multiple
ms.date: 06/20/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f0e49cd8a64a48c53f5b6104703164a597c797f0
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="create-an-automatic-scaling-formula-for-scaling-compute-nodes-in-a-batch-pool"></a><span data-ttu-id="d627a-103">Creare una formula di scalabilità automatica per la scalabilità dei nodi di calcolo in un pool Batch</span><span class="sxs-lookup"><span data-stu-id="d627a-103">Create an automatic scaling formula for scaling compute nodes in a Batch pool</span></span>

<span data-ttu-id="d627a-104">Azure Batch supporta la scalabilità automatica dei pool in base ai parametri definiti.</span><span class="sxs-lookup"><span data-stu-id="d627a-104">Azure Batch can automatically scale pools based on parameters that you define.</span></span> <span data-ttu-id="d627a-105">Con la scalabilità automatica, Batch aggiunge in modo dinamico nodi a un pool man mano che cresce la richiesta di attività e rimuove i nodi di calcolo in seguito alla riduzione delle richieste.</span><span class="sxs-lookup"><span data-stu-id="d627a-105">With automatic scaling, Batch dynamically adds nodes to a pool as task demands increase, and removes compute nodes as they decrease.</span></span> <span data-ttu-id="d627a-106">È possibile risparmiare tempo e denaro regolando automaticamente il numero dei nodi di calcolo usati dall'applicazione Batch.</span><span class="sxs-lookup"><span data-stu-id="d627a-106">You can save both time and money by automatically adjusting the number of compute nodes used by your Batch application.</span></span> 

<span data-ttu-id="d627a-107">Per abilitare la scalabilità automatica in un pool di nodi di calcolo, definire e associare al pool una *formula di scalabilità automatica*.</span><span class="sxs-lookup"><span data-stu-id="d627a-107">You enable automatic scaling on a pool of compute nodes by associating with it an *autoscale formula* that you define.</span></span> <span data-ttu-id="d627a-108">Il servizio Batch usa la formula di scalabilità automatica per determinare il numero di nodi di calcolo necessari per eseguire il carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="d627a-108">The Batch service uses the autoscale formula to determine the number of compute nodes that are needed to execute your workload.</span></span> <span data-ttu-id="d627a-109">I nodi di calcolo possono essere nodi dedicati o [nodi con priorità bassa](batch-low-pri-vms.md).</span><span class="sxs-lookup"><span data-stu-id="d627a-109">Compute nodes may be dedicated nodes or [low-priority nodes](batch-low-pri-vms.md).</span></span> <span data-ttu-id="d627a-110">Batch risponde ai dati delle metriche del servizio raccolti periodicamente.</span><span class="sxs-lookup"><span data-stu-id="d627a-110">Batch responds to service metrics data that is collected periodically.</span></span> <span data-ttu-id="d627a-111">Usando i dati delle metriche, Batch regola il numero di nodi di calcolo nel pool in base alla formula e a un intervallo configurabile.</span><span class="sxs-lookup"><span data-stu-id="d627a-111">Using this metrics data, Batch adjusts the number of compute nodes in the pool based on your formula and at a configurable interval.</span></span>

<span data-ttu-id="d627a-112">È possibile abilitare la scalabilità automatica al momento della creazione di un pool o in un pool esistente.</span><span class="sxs-lookup"><span data-stu-id="d627a-112">You can enable automatic scaling either when a pool is created, or on an existing pool.</span></span> <span data-ttu-id="d627a-113">Si può anche modificare una formula esistente in un pool configurato per la scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="d627a-113">You can also change an existing formula on a pool that is configured for autoscaling.</span></span> <span data-ttu-id="d627a-114">Batch consente di valutare le formule prima di assegnarle ai pool e di monitorare lo stato delle esecuzioni della scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="d627a-114">Batch enables you to evaluate your formulas before assigning them to pools and to monitor the status of automatic scaling runs.</span></span>

<span data-ttu-id="d627a-115">Questo articolo illustra le diverse entità che costituiranno le formule di scalabilità automatica, tra cui variabili, operatori, operazioni e funzioni.</span><span class="sxs-lookup"><span data-stu-id="d627a-115">This article discusses the various entities that make up your autoscale formulas, including variables, operators, operations, and functions.</span></span> <span data-ttu-id="d627a-116">Si scoprirà come ottenere varie metriche relative ad attività e a risorse di calcolo all'interno di Batch.</span><span class="sxs-lookup"><span data-stu-id="d627a-116">We discuss how to obtain various compute resource and task metrics within Batch.</span></span> <span data-ttu-id="d627a-117">È possibile usare queste metriche per adeguare il numero di nodi del pool in base all'utilizzo delle risorse e allo stato delle attività.</span><span class="sxs-lookup"><span data-stu-id="d627a-117">You can use these metrics to adjust your pool's node count based on resource usage and task status.</span></span> <span data-ttu-id="d627a-118">Verrà quindi illustrato come costruire una formula e abilitare la scalabilità automatica in un pool con le API REST e .NET per Batch,</span><span class="sxs-lookup"><span data-stu-id="d627a-118">We then describe how to construct a formula and enable automatic scaling on a pool by using both the Batch REST and .NET APIs.</span></span> <span data-ttu-id="d627a-119">concludendo con alcune formule di esempio.</span><span class="sxs-lookup"><span data-stu-id="d627a-119">Finally, we finish up with a few example formulas.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d627a-120">Quando si crea un account Batch, è possibile specificare la [configurazione dell'account](batch-api-basics.md#account) che determina se i pool devono essere allocati in una sottoscrizione del servizio Batch (impostazione predefinita) o nella sottoscrizione utente.</span><span class="sxs-lookup"><span data-stu-id="d627a-120">When you create a Batch account, you can specify the [account configuration](batch-api-basics.md#account), which determines whether pools are allocated in a Batch service subscription (the default), or in your user subscription.</span></span> <span data-ttu-id="d627a-121">Se l'account Batch è stato creato con la configurazione del servizio Batch predefinita, l'account è limitato a un numero massimo di core utilizzabili per l'elaborazione.</span><span class="sxs-lookup"><span data-stu-id="d627a-121">If you created your Batch account with the default Batch Service configuration, then your account is limited to a maximum number of cores that can be used for processing.</span></span> <span data-ttu-id="d627a-122">Il servizio Batch gestisce la scalabilità dei nodi di calcolo solo fino al raggiungimento del limite di core.</span><span class="sxs-lookup"><span data-stu-id="d627a-122">The Batch service scales compute nodes only up to that core limit.</span></span> <span data-ttu-id="d627a-123">Per questo motivo, il servizio Batch può non raggiungere il numero di nodi di calcolo specificato da una formula di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="d627a-123">For this reason, the Batch service may not reach the target number of compute nodes specified by an autoscale formula.</span></span> <span data-ttu-id="d627a-124">Per informazioni su come visualizzare e aumentare le quote dell'account, vedere [Quote e limiti per il servizio Azure Batch](batch-quota-limit.md) .</span><span class="sxs-lookup"><span data-stu-id="d627a-124">See [Quotas and limits for the Azure Batch service](batch-quota-limit.md) for information on viewing and increasing your account quotas.</span></span>
>
><span data-ttu-id="d627a-125">Se l'account è stato creato con la configurazione di sottoscrizione utente, l'account condivide la quota di core per la sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="d627a-125">If you created your account with the User Subscription configuration, then your account shares in the core quota for the subscription.</span></span> <span data-ttu-id="d627a-126">Per altre informazioni, vedere [Limiti relativi a Macchine virtuali](../azure-subscription-service-limits.md#virtual-machines-limits) in [Sottoscrizione di Azure e limiti, quote e vincoli dei servizi](../azure-subscription-service-limits.md).</span><span class="sxs-lookup"><span data-stu-id="d627a-126">For more information, see [Virtual Machines limits](../azure-subscription-service-limits.md#virtual-machines-limits) in [Azure subscription and service limits, quotas, and constraints](../azure-subscription-service-limits.md).</span></span>
>
>

## <a name="automatic-scaling-formulas"></a><span data-ttu-id="d627a-127">Formule di ridimensionamento automatico</span><span class="sxs-lookup"><span data-stu-id="d627a-127">Automatic scaling formulas</span></span>
<span data-ttu-id="d627a-128">Una formula di scalabilità automatica è un valore stringa definito che contiene una o più istruzioni.</span><span class="sxs-lookup"><span data-stu-id="d627a-128">An automatic scaling formula is a string value that you define that contains one or more statements.</span></span> <span data-ttu-id="d627a-129">La formula di scalabilità automatica viene assegnata all'elemento [autoScaleFormula][rest_autoscaleformula] di un pool (Batch REST) o alla proprietà [CloudPool.AutoScaleFormula][net_cloudpool_autoscaleformula] (Batch .NET).</span><span class="sxs-lookup"><span data-stu-id="d627a-129">The autoscale formula is assigned to a pool's [autoScaleFormula][rest_autoscaleformula] element (Batch REST) or [CloudPool.AutoScaleFormula][net_cloudpool_autoscaleformula] property (Batch .NET).</span></span> <span data-ttu-id="d627a-130">Il servizio Batch usa la formula per determinare il numero di nodi di calcolo di destinazione del pool per l'intervallo di elaborazione successivo.</span><span class="sxs-lookup"><span data-stu-id="d627a-130">The Batch service uses your formula to determine the target number of compute nodes in the pool for the next interval of processing.</span></span> <span data-ttu-id="d627a-131">La stringa della formula non può avere dimensioni maggiori di 8 KB, può includere fino a 100 istruzioni separate da punti e virgola e può contenere interruzioni di riga e commenti.</span><span class="sxs-lookup"><span data-stu-id="d627a-131">The formula string cannot exceed 8 KB, can include up to 100 statements that are separated by semicolons, and can include line breaks and comments.</span></span>

<span data-ttu-id="d627a-132">È possibile paragonare le formule di ridimensionamento automatico a un "linguaggio" di ridimensionamento automatico di Batch.</span><span class="sxs-lookup"><span data-stu-id="d627a-132">You can think of automatic scaling formulas as a Batch autoscale "language."</span></span> <span data-ttu-id="d627a-133">Le istruzioni nella formula sono espressioni in formato libero che possono includere variabili definite dal servizio Batch e variabili definite dall'utente.</span><span class="sxs-lookup"><span data-stu-id="d627a-133">Formula statements are free-formed expressions that can include both service-defined variables (variables defined by the Batch service) and user-defined variables (variables that you define).</span></span> <span data-ttu-id="d627a-134">Possono eseguire diverse operazioni su questi valori usando funzioni, operatori e tipi predefiniti.</span><span class="sxs-lookup"><span data-stu-id="d627a-134">They can perform various operations on these values by using built-in types, operators, and functions.</span></span> <span data-ttu-id="d627a-135">Ad esempio, un'istruzione può avere il formato seguente:</span><span class="sxs-lookup"><span data-stu-id="d627a-135">For example, a statement might take the following form:</span></span>

```
$myNewVariable = function($ServiceDefinedVariable, $myCustomVariable);
```

<span data-ttu-id="d627a-136">Le formule contengono in genere più istruzioni che eseguono operazioni su valori ottenuti nelle istruzioni precedenti.</span><span class="sxs-lookup"><span data-stu-id="d627a-136">Formulas generally contain multiple statements that perform operations on values that are obtained in previous statements.</span></span> <span data-ttu-id="d627a-137">Ad esempio, si ottiene prima di tutto un valore per `variable1`, quindi il valore viene passato a una funzione per popolare `variable2`:</span><span class="sxs-lookup"><span data-stu-id="d627a-137">For example, first we obtain a value for `variable1`, then pass it to a function to populate `variable2`:</span></span>

```
$variable1 = function1($ServiceDefinedVariable);
$variable2 = function2($OtherServiceDefinedVariable, $variable1);
```

<span data-ttu-id="d627a-138">Includere queste istruzioni nella formula di scalabilità automatica per arrivare al numero di nodi di calcolo di destinazione.</span><span class="sxs-lookup"><span data-stu-id="d627a-138">Include these statements in your autoscale formula to arrive at a target number of compute nodes.</span></span> <span data-ttu-id="d627a-139">I nodi dedicati e i nodi con priorità bassa hanno impostazioni proprie per la destinazione, in modo da poter definire una destinazione per ogni tipo di nodo.</span><span class="sxs-lookup"><span data-stu-id="d627a-139">Dedicated nodes and low-priority nodes each have their own target settings, so that you can define a target for each type of node.</span></span> <span data-ttu-id="d627a-140">Una formula di scalabilità automatica può includere un valore di destinazione per i nodi dedicati, un valore di destinazione per i nodi con priorità bassa o entrambi.</span><span class="sxs-lookup"><span data-stu-id="d627a-140">An autoscale formula can include a target value for dedicated nodes, a target value for low-priority nodes, or both.</span></span>

<span data-ttu-id="d627a-141">Il numero di nodi di destinazione può essere maggiore, minore o uguale al numero attuale di nodi di tale tipo nel pool.</span><span class="sxs-lookup"><span data-stu-id="d627a-141">The target number of nodes may be higher, lower, or the same as the current number of nodes of that type in the pool.</span></span> <span data-ttu-id="d627a-142">Batch valuta la formula di scalabilità automatica del pool a intervalli specifici (vedere gli [intervalli di scalabilità automatica](#automatic-scaling-interval)).</span><span class="sxs-lookup"><span data-stu-id="d627a-142">Batch evaluates a pool's autoscale formula at a specific interval (see [automatic scaling intervals](#automatic-scaling-interval)).</span></span> <span data-ttu-id="d627a-143">Batch regola quindi il numero di nodi di destinazione di ogni tipo nel pool in base al numero specificato dalla formula di scalabilità automatica al momento della valutazione.</span><span class="sxs-lookup"><span data-stu-id="d627a-143">Batch adjusts the target number of each type of node in the pool to the number that your autoscale formula specifies at the time of evaluation.</span></span>

### <a name="sample-autoscale-formula"></a><span data-ttu-id="d627a-144">Esempio di formula di scalabilità automatica</span><span class="sxs-lookup"><span data-stu-id="d627a-144">Sample autoscale formula</span></span>

<span data-ttu-id="d627a-145">Di seguito è riportato un esempio di formula di scalabilità automatica che può essere adattato alla maggior parte degli scenari.</span><span class="sxs-lookup"><span data-stu-id="d627a-145">Here is an example of an autoscale formula that can be adjusted to work for most scenarios.</span></span> <span data-ttu-id="d627a-146">Le variabili `startingNumberOfVMs` e `maxNumberofVMs` nell'esempio di formula possono essere modificate in base alle proprie esigenze.</span><span class="sxs-lookup"><span data-stu-id="d627a-146">The variables `startingNumberOfVMs` and `maxNumberofVMs` in the example formula can be adjusted to your needs.</span></span> <span data-ttu-id="d627a-147">Questa formula ridimensiona i nodi dedicati, ma può essere modificata per applicarla anche ai nodi con priorità bassa.</span><span class="sxs-lookup"><span data-stu-id="d627a-147">This formula scales dedicated nodes, but can be modified to apply to scale low-priority nodes as well.</span></span> 

```
startingNumberOfVMs = 1;
maxNumberofVMs = 25;
pendingTaskSamplePercent = $PendingTasks.GetSamplePercent(180 * TimeInterval_Second);
pendingTaskSamples = pendingTaskSamplePercent < 70 ? startingNumberOfVMs : avg($PendingTasks.GetSample(180 * TimeInterval_Second));
$TargetDedicatedNodes=min(maxNumberofVMs, pendingTaskSamples);
```

<span data-ttu-id="d627a-148">Con questa formula di scalabilità automatica il pool viene inizialmente creato con una singola macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="d627a-148">With this autoscale formula, the pool is initially created with a single VM.</span></span> <span data-ttu-id="d627a-149">La metrica `$PendingTasks` definisce il numero di attività in esecuzione o in coda.</span><span class="sxs-lookup"><span data-stu-id="d627a-149">The `$PendingTasks` metric defines the number of tasks that are running or queued.</span></span> <span data-ttu-id="d627a-150">La formula trova il numero medio di attività in sospeso negli ultimi 180 secondi e imposta la variabile `$TargetDedicatedNodes` di conseguenza.</span><span class="sxs-lookup"><span data-stu-id="d627a-150">The formula finds the average number of pending tasks in the last 180 seconds and sets the `$TargetDedicatedNodes` variable accordingly.</span></span> <span data-ttu-id="d627a-151">La formula garantisce che il numero di nodi dedicati di destinazione non superi mai 25 macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="d627a-151">The formula ensures that the target number of dedicated nodes never exceeds 25 VMs.</span></span> <span data-ttu-id="d627a-152">Man mano che vengono inviate nuove attività, il pool si espande automaticamente.</span><span class="sxs-lookup"><span data-stu-id="d627a-152">As new tasks are submitted, the pool automatically grows.</span></span> <span data-ttu-id="d627a-153">Al termine delle attività le macchine virtuali diventano libere una ad una e la formula di scalabilità automatica riduce il pool.</span><span class="sxs-lookup"><span data-stu-id="d627a-153">As tasks complete, VMs become free one by one and the autoscaling formula shrinks the pool.</span></span>

## <a name="variables"></a><span data-ttu-id="d627a-154">variables</span><span class="sxs-lookup"><span data-stu-id="d627a-154">Variables</span></span>
<span data-ttu-id="d627a-155">Nelle formule di scalabilità automatica è possibile usare sia **variabili definite dal servizio** sia **variabili definite dall'utente**.</span><span class="sxs-lookup"><span data-stu-id="d627a-155">You can use both **service-defined** and **user-defined** variables in your autoscale formulas.</span></span> <span data-ttu-id="d627a-156">Le variabili definite dal servizio sono incorporate nel servizio Batch.</span><span class="sxs-lookup"><span data-stu-id="d627a-156">The service-defined variables are built in to the Batch service.</span></span> <span data-ttu-id="d627a-157">Alcune sono in lettura/scrittura e altre di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="d627a-157">Some service-defined variables are read-write, and some are read-only.</span></span> <span data-ttu-id="d627a-158">Le variabili definite dall'utente vengono configurate dall'utente.</span><span class="sxs-lookup"><span data-stu-id="d627a-158">User-defined variables are variables that you define.</span></span> <span data-ttu-id="d627a-159">Nella formula di esempio della sezione precedente `$TargetDedicatedNodes` e `$PendingTasks` sono variabili definite dal servizio.</span><span class="sxs-lookup"><span data-stu-id="d627a-159">In the example formula shown in the previous section, `$TargetDedicatedNodes` and `$PendingTasks` are service-defined variables.</span></span> <span data-ttu-id="d627a-160">Le variabili `startingNumberOfVMs` e `maxNumberofVMs` sono definite dall'utente.</span><span class="sxs-lookup"><span data-stu-id="d627a-160">Variables `startingNumberOfVMs` and `maxNumberofVMs` are user-defined variables.</span></span>

> [!NOTE]
> <span data-ttu-id="d627a-161">Le variabili definite dal servizio sono sempre precedute da un segno di dollaro ($).</span><span class="sxs-lookup"><span data-stu-id="d627a-161">Service-defined variables are always preceded by a dollar sign ($).</span></span> <span data-ttu-id="d627a-162">Per le variabili definite dall'utente il segno di dollaro è facoltativo.</span><span class="sxs-lookup"><span data-stu-id="d627a-162">For user-defined variables, the dollar sign is optional.</span></span>
>
>

<span data-ttu-id="d627a-163">Le tabelle seguenti includono sia le variabili di lettura/scrittura che di sola lettura definite dal servizio Batch.</span><span class="sxs-lookup"><span data-stu-id="d627a-163">The following tables show both read-write and read-only variables that are defined by the Batch service.</span></span>

<span data-ttu-id="d627a-164">È possibile ottenere e impostare i valori di queste variabili definite dal servizio per gestire il numero di nodi di calcolo in un pool:</span><span class="sxs-lookup"><span data-stu-id="d627a-164">You can get and set the values of these service-defined variables to manage the number of compute nodes in a pool:</span></span>

| <span data-ttu-id="d627a-165">Variabili in lettura/scrittura definite dal servizio</span><span class="sxs-lookup"><span data-stu-id="d627a-165">Read-write service-defined variables</span></span> | <span data-ttu-id="d627a-166">Descrizione</span><span class="sxs-lookup"><span data-stu-id="d627a-166">Description</span></span> |
| --- | --- |
| <span data-ttu-id="d627a-167">$TargetDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="d627a-167">$TargetDedicatedNodes</span></span> |<span data-ttu-id="d627a-168">Numero di destinazione dei nodi di calcolo dedicati per il pool.</span><span class="sxs-lookup"><span data-stu-id="d627a-168">The target number of dedicated compute nodes for the pool.</span></span> <span data-ttu-id="d627a-169">Il numero di nodi dedicati viene specificato come destinazione, perché un pool potrebbe non ottenere sempre il numero desiderato di nodi.</span><span class="sxs-lookup"><span data-stu-id="d627a-169">The number of dedicated nodes is specified as a target because a pool may not always achieve the desired number of nodes.</span></span> <span data-ttu-id="d627a-170">Ad esempio, se il numero di nodi dedicati di destinazione viene modificato da una valutazione di scalabilità automatica prima che il pool raggiunga il valore di destinazione iniziale, è possibile che il pool non raggiunga il numero di nodi di destinazione.</span><span class="sxs-lookup"><span data-stu-id="d627a-170">For example, if the target number of dedicated nodes is modified by an autoscale evaluation before the pool has reached the initial target, then the pool may not reach the target.</span></span> <br /><br /> <span data-ttu-id="d627a-171">Un pool in un account creato con la configurazione del servizio Batch potrebbe non raggiungere il valore di destinazione se supera la quota di nodi o core di un account Batch.</span><span class="sxs-lookup"><span data-stu-id="d627a-171">A pool in an account created with the Batch Service configuration may not achieve its target if the target exceeds a Batch account node or core quota.</span></span> <span data-ttu-id="d627a-172">Un pool in un account creato con la configurazione di sottoscrizione utente potrebbe non raggiungere il valore di destinazione se supera la quota condivisa di nodi per la sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="d627a-172">A pool in an account created with the User Subscription configuration may not achieve its target if the target exceeds the shared core quota for the subscription.</span></span>|
| <span data-ttu-id="d627a-173">$TargetLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="d627a-173">$TargetLowPriorityNodes</span></span> |<span data-ttu-id="d627a-174">Numero di destinazione dei nodi di calcolo con priorità bassa per il pool.</span><span class="sxs-lookup"><span data-stu-id="d627a-174">The target number of low-priority compute nodes for the pool.</span></span> <span data-ttu-id="d627a-175">Il numero di nodi con priorità bassa viene specificato come destinazione, perché un pool potrebbe non ottenere sempre il numero desiderato di nodi.</span><span class="sxs-lookup"><span data-stu-id="d627a-175">The number of low-priority nodes is specified as a target because a pool may not always achieve the desired number of nodes.</span></span> <span data-ttu-id="d627a-176">Ad esempio, se il numero di nodi con priorità bassa di destinazione viene modificato da una valutazione di scalabilità automatica prima che il pool raggiunga il valore di destinazione iniziale, è possibile che il pool non raggiunga il numero di nodi di destinazione.</span><span class="sxs-lookup"><span data-stu-id="d627a-176">For example, if the target number of low-priority nodes is modified by an autoscale evaluation before the pool has reached the initial target, then the pool may not reach the target.</span></span> <span data-ttu-id="d627a-177">Un pool potrebbe anche non raggiungere il valore di destinazione se supera la quota di nodi o core di un account Batch.</span><span class="sxs-lookup"><span data-stu-id="d627a-177">A pool may also not achieve its target if the target exceeds a Batch account node or core quota.</span></span> <br /><br /> <span data-ttu-id="d627a-178">Per altre informazioni sui nodi calcolo con priorità bassa, vedere [Usare le VM con priorità bassa in Batch (anteprima)](batch-low-pri-vms.md).</span><span class="sxs-lookup"><span data-stu-id="d627a-178">For more information on low-priority compute nodes, see [Use low-priority VMs with Batch (Preview)](batch-low-pri-vms.md).</span></span> |
| <span data-ttu-id="d627a-179">$NodeDeallocationOption</span><span class="sxs-lookup"><span data-stu-id="d627a-179">$NodeDeallocationOption</span></span> |<span data-ttu-id="d627a-180">L'azione che si verifica quando i nodi di calcolo vengono rimossi da un pool.</span><span class="sxs-lookup"><span data-stu-id="d627a-180">The action that occurs when compute nodes are removed from a pool.</span></span> <span data-ttu-id="d627a-181">I valori possibili sono:</span><span class="sxs-lookup"><span data-stu-id="d627a-181">Possible values are:</span></span><ul><li><span data-ttu-id="d627a-182">**requeue**: termina immediatamente le attività e le reinserisce nella coda dei processi in modo che vengano ripianificate.</span><span class="sxs-lookup"><span data-stu-id="d627a-182">**requeue**--Terminates tasks immediately and puts them back on the job queue so that they are rescheduled.</span></span><li><span data-ttu-id="d627a-183">**terminate**: termina immediatamente le attività e le rimuove dalla coda dei processi.</span><span class="sxs-lookup"><span data-stu-id="d627a-183">**terminate**--Terminates tasks immediately and removes them from the job queue.</span></span><li><span data-ttu-id="d627a-184">**taskcompletion**: attende il completamento delle attività in esecuzione e quindi rimuove il nodo dal pool.</span><span class="sxs-lookup"><span data-stu-id="d627a-184">**taskcompletion**--Waits for currently running tasks to finish and then removes the node from the pool.</span></span><li><span data-ttu-id="d627a-185">**retaineddata**: attende che tutti i dati mantenuti per le attività locali nel nodo vengano ripuliti prima di rimuovere il nodo dal pool.</span><span class="sxs-lookup"><span data-stu-id="d627a-185">**retaineddata**--Waits for all the local task-retained data on the node to be cleaned up before removing the node from the pool.</span></span></ul> |

<span data-ttu-id="d627a-186">È possibile ottenere il valore di queste variabili definite dal servizio per eseguire adeguamenti basati sulla metrica del servizio Batch:</span><span class="sxs-lookup"><span data-stu-id="d627a-186">You can get the value of these service-defined variables to make adjustments that are based on metrics from the Batch service:</span></span>

| <span data-ttu-id="d627a-187">Variabili di sola lettura definite dal servizio</span><span class="sxs-lookup"><span data-stu-id="d627a-187">Read-only service-defined variables</span></span> | <span data-ttu-id="d627a-188">Descrizione</span><span class="sxs-lookup"><span data-stu-id="d627a-188">Description</span></span> |
| --- | --- |
| <span data-ttu-id="d627a-189">$CPUPercent</span><span class="sxs-lookup"><span data-stu-id="d627a-189">$CPUPercent</span></span> |<span data-ttu-id="d627a-190">Percentuale media di utilizzo della CPU.</span><span class="sxs-lookup"><span data-stu-id="d627a-190">The average percentage of CPU usage.</span></span> |
| <span data-ttu-id="d627a-191">$WallClockSeconds</span><span class="sxs-lookup"><span data-stu-id="d627a-191">$WallClockSeconds</span></span> |<span data-ttu-id="d627a-192">Numero di secondi utilizzati.</span><span class="sxs-lookup"><span data-stu-id="d627a-192">The number of seconds consumed.</span></span> |
| <span data-ttu-id="d627a-193">$MemoryBytes</span><span class="sxs-lookup"><span data-stu-id="d627a-193">$MemoryBytes</span></span> |<span data-ttu-id="d627a-194">Numero medio di megabyte usati.</span><span class="sxs-lookup"><span data-stu-id="d627a-194">The average number of megabytes used.</span></span> |
| <span data-ttu-id="d627a-195">$DiskBytes</span><span class="sxs-lookup"><span data-stu-id="d627a-195">$DiskBytes</span></span> |<span data-ttu-id="d627a-196">Numero medio di gigabyte usati sui dischi locali.</span><span class="sxs-lookup"><span data-stu-id="d627a-196">The average number of gigabytes used on the local disks.</span></span> |
| <span data-ttu-id="d627a-197">$DiskReadBytes</span><span class="sxs-lookup"><span data-stu-id="d627a-197">$DiskReadBytes</span></span> |<span data-ttu-id="d627a-198">Numero di byte letti.</span><span class="sxs-lookup"><span data-stu-id="d627a-198">The number of bytes read.</span></span> |
| <span data-ttu-id="d627a-199">$DiskWriteBytes</span><span class="sxs-lookup"><span data-stu-id="d627a-199">$DiskWriteBytes</span></span> |<span data-ttu-id="d627a-200">Numero di byte scritti.</span><span class="sxs-lookup"><span data-stu-id="d627a-200">The number of bytes written.</span></span> |
| <span data-ttu-id="d627a-201">$DiskReadOps</span><span class="sxs-lookup"><span data-stu-id="d627a-201">$DiskReadOps</span></span> |<span data-ttu-id="d627a-202">Numero di operazioni di lettura del disco eseguite.</span><span class="sxs-lookup"><span data-stu-id="d627a-202">The count of read disk operations performed.</span></span> |
| <span data-ttu-id="d627a-203">$DiskWriteOps</span><span class="sxs-lookup"><span data-stu-id="d627a-203">$DiskWriteOps</span></span> |<span data-ttu-id="d627a-204">Numero di operazioni di scrittura sul disco eseguite.</span><span class="sxs-lookup"><span data-stu-id="d627a-204">The count of write disk operations performed.</span></span> |
| <span data-ttu-id="d627a-205">$NetworkInBytes</span><span class="sxs-lookup"><span data-stu-id="d627a-205">$NetworkInBytes</span></span> |<span data-ttu-id="d627a-206">Numero di byte in ingresso.</span><span class="sxs-lookup"><span data-stu-id="d627a-206">The number of inbound bytes.</span></span> |
| <span data-ttu-id="d627a-207">$NetworkOutBytes</span><span class="sxs-lookup"><span data-stu-id="d627a-207">$NetworkOutBytes</span></span> |<span data-ttu-id="d627a-208">Numero di byte in uscita.</span><span class="sxs-lookup"><span data-stu-id="d627a-208">The number of outbound bytes.</span></span> |
| <span data-ttu-id="d627a-209">$SampleNodeCount</span><span class="sxs-lookup"><span data-stu-id="d627a-209">$SampleNodeCount</span></span> |<span data-ttu-id="d627a-210">Conteggio dei nodi di calcolo.</span><span class="sxs-lookup"><span data-stu-id="d627a-210">The count of compute nodes.</span></span> |
| <span data-ttu-id="d627a-211">$ActiveTasks</span><span class="sxs-lookup"><span data-stu-id="d627a-211">$ActiveTasks</span></span> |<span data-ttu-id="d627a-212">Numero di attività che sono pronte per l'esecuzione, ma non sono ancora in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="d627a-212">The number of tasks that are ready to execute but are not yet executing.</span></span> <span data-ttu-id="d627a-213">Il conteggio $ActiveTasks include tutte le attività che si trovano in stato attivo e le cui dipendenze sono state soddisfatte.</span><span class="sxs-lookup"><span data-stu-id="d627a-213">The $ActiveTasks count includes all tasks that are in the active state and whose dependencies have been satisfied.</span></span> <span data-ttu-id="d627a-214">Tutte le attività che sono nello stato attivo, ma per le quali le dipendenze non sono state soddisfatte vengono escluse dal conteggio per $ActiveTasks.</span><span class="sxs-lookup"><span data-stu-id="d627a-214">Any tasks that are in the active state but whose dependencies have not been satisfied are excluded from the $ActiveTasks count.</span></span>|
| <span data-ttu-id="d627a-215">$RunningTasks</span><span class="sxs-lookup"><span data-stu-id="d627a-215">$RunningTasks</span></span> |<span data-ttu-id="d627a-216">Numero di attività nello stato in corso di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="d627a-216">The number of tasks in a running state.</span></span> |
| <span data-ttu-id="d627a-217">$PendingTasks</span><span class="sxs-lookup"><span data-stu-id="d627a-217">$PendingTasks</span></span> |<span data-ttu-id="d627a-218">La somma di $ActiveTasks e $RunningTasks.</span><span class="sxs-lookup"><span data-stu-id="d627a-218">The sum of $ActiveTasks and $RunningTasks.</span></span> |
| <span data-ttu-id="d627a-219">$SucceededTasks</span><span class="sxs-lookup"><span data-stu-id="d627a-219">$SucceededTasks</span></span> |<span data-ttu-id="d627a-220">Numero di attività completate correttamente.</span><span class="sxs-lookup"><span data-stu-id="d627a-220">The number of tasks that finished successfully.</span></span> |
| <span data-ttu-id="d627a-221">$FailedTasks</span><span class="sxs-lookup"><span data-stu-id="d627a-221">$FailedTasks</span></span> |<span data-ttu-id="d627a-222">Numero di attività non riuscite.</span><span class="sxs-lookup"><span data-stu-id="d627a-222">The number of tasks that failed.</span></span> |
| <span data-ttu-id="d627a-223">$CurrentDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="d627a-223">$CurrentDedicatedNodes</span></span> |<span data-ttu-id="d627a-224">Numero corrente di nodi di calcolo dedicati.</span><span class="sxs-lookup"><span data-stu-id="d627a-224">The current number of dedicated compute nodes.</span></span> |
| <span data-ttu-id="d627a-225">$CurrentLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="d627a-225">$CurrentLowPriorityNodes</span></span> |<span data-ttu-id="d627a-226">Numero corrente di nodi di calcolo con priorità bassa, inclusi eventuali nodi annullati.</span><span class="sxs-lookup"><span data-stu-id="d627a-226">The current number of low-priority compute nodes, including any nodes that have been pre-empted.</span></span> |
| <span data-ttu-id="d627a-227">$PreemptedNodeCount</span><span class="sxs-lookup"><span data-stu-id="d627a-227">$PreemptedNodeCount</span></span> | <span data-ttu-id="d627a-228">Il numero di nodi nel pool che si trovano nello stato Annullato.</span><span class="sxs-lookup"><span data-stu-id="d627a-228">The number of nodes in the pool that are in a pre-empted state.</span></span> |

> [!TIP]
> <span data-ttu-id="d627a-229">Le variabili di sola lettura definite dal servizio illustrate nella tabella precedente sono *oggetti* che offrono vari metodi per accedere ai dati associati a ognuno.</span><span class="sxs-lookup"><span data-stu-id="d627a-229">The read-only, service-defined variables that are shown in the previous table are *objects* that provide various methods to access data associated with each.</span></span> <span data-ttu-id="d627a-230">Per altre informazioni, vedere [Ottenere dati di esempio](#getsampledata) più avanti in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="d627a-230">For more information, see [Obtain sample data](#getsampledata) later in this article.</span></span>
>
>

## <a name="types"></a><span data-ttu-id="d627a-231">Tipi</span><span class="sxs-lookup"><span data-stu-id="d627a-231">Types</span></span>
<span data-ttu-id="d627a-232">Questi sono i tipi supportati in una formula:</span><span class="sxs-lookup"><span data-stu-id="d627a-232">These types are supported in a formula:</span></span>

* <span data-ttu-id="d627a-233">double</span><span class="sxs-lookup"><span data-stu-id="d627a-233">double</span></span>
* <span data-ttu-id="d627a-234">doubleVec</span><span class="sxs-lookup"><span data-stu-id="d627a-234">doubleVec</span></span>
* <span data-ttu-id="d627a-235">doubleVecList</span><span class="sxs-lookup"><span data-stu-id="d627a-235">doubleVecList</span></span>
* <span data-ttu-id="d627a-236">string</span><span class="sxs-lookup"><span data-stu-id="d627a-236">string</span></span>
* <span data-ttu-id="d627a-237">timestamp, è una struttura composta che contiene i membri seguenti:</span><span class="sxs-lookup"><span data-stu-id="d627a-237">timestamp--timestamp is a compound structure that contains the following members:</span></span>

  * <span data-ttu-id="d627a-238">year</span><span class="sxs-lookup"><span data-stu-id="d627a-238">year</span></span>
  * <span data-ttu-id="d627a-239">month (1-12)</span><span class="sxs-lookup"><span data-stu-id="d627a-239">month (1-12)</span></span>
  * <span data-ttu-id="d627a-240">day (1-31)</span><span class="sxs-lookup"><span data-stu-id="d627a-240">day (1-31)</span></span>
  * <span data-ttu-id="d627a-241">weekday (in formato numero, ad esempio 1 per lunedì)</span><span class="sxs-lookup"><span data-stu-id="d627a-241">weekday (in the format of number; for example, 1 for Monday)</span></span>
  * <span data-ttu-id="d627a-242">hour (in formato 24 ore, ad esempio 13 per indicare le ore 13.00)</span><span class="sxs-lookup"><span data-stu-id="d627a-242">hour (in 24-hour number format; for example, 13 means 1 PM)</span></span>
  * <span data-ttu-id="d627a-243">minute (00-59)</span><span class="sxs-lookup"><span data-stu-id="d627a-243">minute (00-59)</span></span>
  * <span data-ttu-id="d627a-244">second (00-59)</span><span class="sxs-lookup"><span data-stu-id="d627a-244">second (00-59)</span></span>
* <span data-ttu-id="d627a-245">timeInterval</span><span class="sxs-lookup"><span data-stu-id="d627a-245">timeinterval</span></span>

  * <span data-ttu-id="d627a-246">TimeInterval_Zero</span><span class="sxs-lookup"><span data-stu-id="d627a-246">TimeInterval_Zero</span></span>
  * <span data-ttu-id="d627a-247">TimeInterval_100ns</span><span class="sxs-lookup"><span data-stu-id="d627a-247">TimeInterval_100ns</span></span>
  * <span data-ttu-id="d627a-248">TimeInterval_Microsecond</span><span class="sxs-lookup"><span data-stu-id="d627a-248">TimeInterval_Microsecond</span></span>
  * <span data-ttu-id="d627a-249">TimeInterval_Millisecond</span><span class="sxs-lookup"><span data-stu-id="d627a-249">TimeInterval_Millisecond</span></span>
  * <span data-ttu-id="d627a-250">TimeInterval_Second</span><span class="sxs-lookup"><span data-stu-id="d627a-250">TimeInterval_Second</span></span>
  * <span data-ttu-id="d627a-251">TimeInterval_Minute</span><span class="sxs-lookup"><span data-stu-id="d627a-251">TimeInterval_Minute</span></span>
  * <span data-ttu-id="d627a-252">TimeInterval_Hour</span><span class="sxs-lookup"><span data-stu-id="d627a-252">TimeInterval_Hour</span></span>
  * <span data-ttu-id="d627a-253">TimeInterval_Day</span><span class="sxs-lookup"><span data-stu-id="d627a-253">TimeInterval_Day</span></span>
  * <span data-ttu-id="d627a-254">TimeInterval_Week</span><span class="sxs-lookup"><span data-stu-id="d627a-254">TimeInterval_Week</span></span>
  * <span data-ttu-id="d627a-255">TimeInterval_Year</span><span class="sxs-lookup"><span data-stu-id="d627a-255">TimeInterval_Year</span></span>

## <a name="operations"></a><span data-ttu-id="d627a-256">Operazioni</span><span class="sxs-lookup"><span data-stu-id="d627a-256">Operations</span></span>
<span data-ttu-id="d627a-257">Queste operazioni sono consentite sui tipi elencati nella sezione precedente.</span><span class="sxs-lookup"><span data-stu-id="d627a-257">These operations are allowed on the types that are listed in the previous section.</span></span>

| <span data-ttu-id="d627a-258">Operazione</span><span class="sxs-lookup"><span data-stu-id="d627a-258">Operation</span></span> | <span data-ttu-id="d627a-259">Operatori supportati</span><span class="sxs-lookup"><span data-stu-id="d627a-259">Supported operators</span></span> | <span data-ttu-id="d627a-260">Tipo di risultato</span><span class="sxs-lookup"><span data-stu-id="d627a-260">Result type</span></span> |
| --- | --- | --- |
| <span data-ttu-id="d627a-261">double *operatore* double</span><span class="sxs-lookup"><span data-stu-id="d627a-261">double *operator* double</span></span> |<span data-ttu-id="d627a-262">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="d627a-262">+, -, *, /</span></span> |<span data-ttu-id="d627a-263">double</span><span class="sxs-lookup"><span data-stu-id="d627a-263">double</span></span> |
| <span data-ttu-id="d627a-264">double *operatore* timeinterval</span><span class="sxs-lookup"><span data-stu-id="d627a-264">double *operator* timeinterval</span></span> |* |<span data-ttu-id="d627a-265">timeInterval</span><span class="sxs-lookup"><span data-stu-id="d627a-265">timeinterval</span></span> |
| <span data-ttu-id="d627a-266">doubleVec *operatore* double</span><span class="sxs-lookup"><span data-stu-id="d627a-266">doubleVec *operator* double</span></span> |<span data-ttu-id="d627a-267">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="d627a-267">+, -, *, /</span></span> |<span data-ttu-id="d627a-268">doubleVec</span><span class="sxs-lookup"><span data-stu-id="d627a-268">doubleVec</span></span> |
| <span data-ttu-id="d627a-269">doubleVec *operatore* doubleVec</span><span class="sxs-lookup"><span data-stu-id="d627a-269">doubleVec *operator* doubleVec</span></span> |<span data-ttu-id="d627a-270">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="d627a-270">+, -, *, /</span></span> |<span data-ttu-id="d627a-271">doubleVec</span><span class="sxs-lookup"><span data-stu-id="d627a-271">doubleVec</span></span> |
| <span data-ttu-id="d627a-272">timeinterval *operatore* double</span><span class="sxs-lookup"><span data-stu-id="d627a-272">timeinterval *operator* double</span></span> |<span data-ttu-id="d627a-273">*, /</span><span class="sxs-lookup"><span data-stu-id="d627a-273">*, /</span></span> |<span data-ttu-id="d627a-274">timeInterval</span><span class="sxs-lookup"><span data-stu-id="d627a-274">timeinterval</span></span> |
| <span data-ttu-id="d627a-275">timeinterval *operatore* timeinterval</span><span class="sxs-lookup"><span data-stu-id="d627a-275">timeinterval *operator* timeinterval</span></span> |<span data-ttu-id="d627a-276">+, -</span><span class="sxs-lookup"><span data-stu-id="d627a-276">+, -</span></span> |<span data-ttu-id="d627a-277">timeInterval</span><span class="sxs-lookup"><span data-stu-id="d627a-277">timeinterval</span></span> |
| <span data-ttu-id="d627a-278">timeinterval *operatore* timestamp</span><span class="sxs-lookup"><span data-stu-id="d627a-278">timeinterval *operator* timestamp</span></span> |+ |<span data-ttu-id="d627a-279">timestamp</span><span class="sxs-lookup"><span data-stu-id="d627a-279">timestamp</span></span> |
| <span data-ttu-id="d627a-280">timestamp *operatore* timeinterval</span><span class="sxs-lookup"><span data-stu-id="d627a-280">timestamp *operator* timeinterval</span></span> |+ |<span data-ttu-id="d627a-281">timestamp</span><span class="sxs-lookup"><span data-stu-id="d627a-281">timestamp</span></span> |
| <span data-ttu-id="d627a-282">timestamp *operatore* timestamp</span><span class="sxs-lookup"><span data-stu-id="d627a-282">timestamp *operator* timestamp</span></span> |- |<span data-ttu-id="d627a-283">timeInterval</span><span class="sxs-lookup"><span data-stu-id="d627a-283">timeinterval</span></span> |
| <span data-ttu-id="d627a-284">*operatoree*double</span><span class="sxs-lookup"><span data-stu-id="d627a-284">*operator*double</span></span> |<span data-ttu-id="d627a-285">-, !</span><span class="sxs-lookup"><span data-stu-id="d627a-285">-, !</span></span> |<span data-ttu-id="d627a-286">double</span><span class="sxs-lookup"><span data-stu-id="d627a-286">double</span></span> |
| <span data-ttu-id="d627a-287">*operatoree*timeInterval</span><span class="sxs-lookup"><span data-stu-id="d627a-287">*operator*timeinterval</span></span> |- |<span data-ttu-id="d627a-288">timeInterval</span><span class="sxs-lookup"><span data-stu-id="d627a-288">timeinterval</span></span> |
| <span data-ttu-id="d627a-289">double *operatore* double</span><span class="sxs-lookup"><span data-stu-id="d627a-289">double *operator* double</span></span> |<span data-ttu-id="d627a-290"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="d627a-290"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="d627a-291">double</span><span class="sxs-lookup"><span data-stu-id="d627a-291">double</span></span> |
| <span data-ttu-id="d627a-292">string *operatore* string</span><span class="sxs-lookup"><span data-stu-id="d627a-292">string *operator* string</span></span> |<span data-ttu-id="d627a-293"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="d627a-293"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="d627a-294">double</span><span class="sxs-lookup"><span data-stu-id="d627a-294">double</span></span> |
| <span data-ttu-id="d627a-295">timestamp *operatore* timestamp</span><span class="sxs-lookup"><span data-stu-id="d627a-295">timestamp *operator* timestamp</span></span> |<span data-ttu-id="d627a-296"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="d627a-296"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="d627a-297">double</span><span class="sxs-lookup"><span data-stu-id="d627a-297">double</span></span> |
| <span data-ttu-id="d627a-298">timeinterval *operatore* timeinterval</span><span class="sxs-lookup"><span data-stu-id="d627a-298">timeinterval *operator* timeinterval</span></span> |<span data-ttu-id="d627a-299"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="d627a-299"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="d627a-300">double</span><span class="sxs-lookup"><span data-stu-id="d627a-300">double</span></span> |
| <span data-ttu-id="d627a-301">double *operatore* double</span><span class="sxs-lookup"><span data-stu-id="d627a-301">double *operator* double</span></span> |<span data-ttu-id="d627a-302">&&, &#124;&#124;</span><span class="sxs-lookup"><span data-stu-id="d627a-302">&&, &#124;&#124;</span></span> |<span data-ttu-id="d627a-303">double</span><span class="sxs-lookup"><span data-stu-id="d627a-303">double</span></span> |

<span data-ttu-id="d627a-304">Durante il test di un valore double con un operatore ternario (`double ? statement1 : statement2`), diverso da zero è **true** e zero è **false**.</span><span class="sxs-lookup"><span data-stu-id="d627a-304">When testing a double with a ternary operator (`double ? statement1 : statement2`), nonzero is **true**, and zero is **false**.</span></span>

## <a name="functions"></a><span data-ttu-id="d627a-305">Funzioni</span><span class="sxs-lookup"><span data-stu-id="d627a-305">Functions</span></span>
<span data-ttu-id="d627a-306">Queste **funzioni** predefinite sono disponibili per consentire la definizione di una formula di ridimensionamento automatico.</span><span class="sxs-lookup"><span data-stu-id="d627a-306">These predefined **functions** are available for you to use in defining an automatic scaling formula.</span></span>

| <span data-ttu-id="d627a-307">Funzione</span><span class="sxs-lookup"><span data-stu-id="d627a-307">Function</span></span> | <span data-ttu-id="d627a-308">Tipo restituito</span><span class="sxs-lookup"><span data-stu-id="d627a-308">Return type</span></span> | <span data-ttu-id="d627a-309">Descrizione</span><span class="sxs-lookup"><span data-stu-id="d627a-309">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="d627a-310">avg(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d627a-310">avg(doubleVecList)</span></span> |<span data-ttu-id="d627a-311">double</span><span class="sxs-lookup"><span data-stu-id="d627a-311">double</span></span> |<span data-ttu-id="d627a-312">Restituisce il valore medio per tutti i valori in doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d627a-312">Returns the average value for all values in the doubleVecList.</span></span> |
| <span data-ttu-id="d627a-313">len(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d627a-313">len(doubleVecList)</span></span> |<span data-ttu-id="d627a-314">double</span><span class="sxs-lookup"><span data-stu-id="d627a-314">double</span></span> |<span data-ttu-id="d627a-315">Restituisce la lunghezza del vettore creato da doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d627a-315">Returns the length of the vector that is created from the doubleVecList.</span></span> |
| <span data-ttu-id="d627a-316">lg(double)</span><span class="sxs-lookup"><span data-stu-id="d627a-316">lg(double)</span></span> |<span data-ttu-id="d627a-317">double</span><span class="sxs-lookup"><span data-stu-id="d627a-317">double</span></span> |<span data-ttu-id="d627a-318">Restituisce il logaritmo in base 2 di double.</span><span class="sxs-lookup"><span data-stu-id="d627a-318">Returns the log base 2 of the double.</span></span> |
| <span data-ttu-id="d627a-319">lg(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d627a-319">lg(doubleVecList)</span></span> |<span data-ttu-id="d627a-320">doubleVec</span><span class="sxs-lookup"><span data-stu-id="d627a-320">doubleVec</span></span> |<span data-ttu-id="d627a-321">Restituisce il logaritmo in base 2 a livello di componente di doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d627a-321">Returns the component-wise log base 2 of the doubleVecList.</span></span> <span data-ttu-id="d627a-322">vec(double) deve essere passato in modo esplicito per il parametro.</span><span class="sxs-lookup"><span data-stu-id="d627a-322">A vec(double) must be explicitly passed for the parameter.</span></span> <span data-ttu-id="d627a-323">In caso contrario viene usata la versione double lg(double).</span><span class="sxs-lookup"><span data-stu-id="d627a-323">Otherwise, the double lg(double) version is assumed.</span></span> |
| <span data-ttu-id="d627a-324">ln(double)</span><span class="sxs-lookup"><span data-stu-id="d627a-324">ln(double)</span></span> |<span data-ttu-id="d627a-325">double</span><span class="sxs-lookup"><span data-stu-id="d627a-325">double</span></span> |<span data-ttu-id="d627a-326">Restituisce il logaritmo naturale di double.</span><span class="sxs-lookup"><span data-stu-id="d627a-326">Returns the natural log of the double.</span></span> |
| <span data-ttu-id="d627a-327">ln(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d627a-327">ln(doubleVecList)</span></span> |<span data-ttu-id="d627a-328">doubleVec</span><span class="sxs-lookup"><span data-stu-id="d627a-328">doubleVec</span></span> |<span data-ttu-id="d627a-329">Restituisce il logaritmo in base 2 a livello di componente di doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d627a-329">Returns the component-wise log base 2 of the doubleVecList.</span></span> <span data-ttu-id="d627a-330">vec(double) deve essere passato in modo esplicito per il parametro.</span><span class="sxs-lookup"><span data-stu-id="d627a-330">A vec(double) must be explicitly passed for the parameter.</span></span> <span data-ttu-id="d627a-331">In caso contrario viene usata la versione double lg(double).</span><span class="sxs-lookup"><span data-stu-id="d627a-331">Otherwise, the double lg(double) version is assumed.</span></span> |
| <span data-ttu-id="d627a-332">log(double)</span><span class="sxs-lookup"><span data-stu-id="d627a-332">log(double)</span></span> |<span data-ttu-id="d627a-333">double</span><span class="sxs-lookup"><span data-stu-id="d627a-333">double</span></span> |<span data-ttu-id="d627a-334">Restituisce il logaritmo in base 10 di double.</span><span class="sxs-lookup"><span data-stu-id="d627a-334">Returns the log base 10 of the double.</span></span> |
| <span data-ttu-id="d627a-335">log(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d627a-335">log(doubleVecList)</span></span> |<span data-ttu-id="d627a-336">doubleVec</span><span class="sxs-lookup"><span data-stu-id="d627a-336">doubleVec</span></span> |<span data-ttu-id="d627a-337">Restituisce il logaritmo in base 10 a livello di componente di doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d627a-337">Returns the component-wise log base 10 of the doubleVecList.</span></span> <span data-ttu-id="d627a-338">vec(double) deve essere passato in modo esplicito per il singolo parametro double.</span><span class="sxs-lookup"><span data-stu-id="d627a-338">A vec(double) must be explicitly passed for the single double parameter.</span></span> <span data-ttu-id="d627a-339">In caso contrario, viene usata la versione double log(double).</span><span class="sxs-lookup"><span data-stu-id="d627a-339">Otherwise, the double log(double) version is assumed.</span></span> |
| <span data-ttu-id="d627a-340">max(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d627a-340">max(doubleVecList)</span></span> |<span data-ttu-id="d627a-341">double</span><span class="sxs-lookup"><span data-stu-id="d627a-341">double</span></span> |<span data-ttu-id="d627a-342">Restituisce il valore massimo in doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d627a-342">Returns the maximum value in the doubleVecList.</span></span> |
| <span data-ttu-id="d627a-343">min(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d627a-343">min(doubleVecList)</span></span> |<span data-ttu-id="d627a-344">double</span><span class="sxs-lookup"><span data-stu-id="d627a-344">double</span></span> |<span data-ttu-id="d627a-345">Restituisce il valore minimo in doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d627a-345">Returns the minimum value in the doubleVecList.</span></span> |
| <span data-ttu-id="d627a-346">norm(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d627a-346">norm(doubleVecList)</span></span> |<span data-ttu-id="d627a-347">double</span><span class="sxs-lookup"><span data-stu-id="d627a-347">double</span></span> |<span data-ttu-id="d627a-348">Restituisce la norma 2 del vettore creato da doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d627a-348">Returns the two-norm of the vector that is created from the doubleVecList.</span></span> |
| <span data-ttu-id="d627a-349">percentile(doubleVec v, double p)</span><span class="sxs-lookup"><span data-stu-id="d627a-349">percentile(doubleVec v, double p)</span></span> |<span data-ttu-id="d627a-350">double</span><span class="sxs-lookup"><span data-stu-id="d627a-350">double</span></span> |<span data-ttu-id="d627a-351">Restituisce l'elemento percentile del vettore v.</span><span class="sxs-lookup"><span data-stu-id="d627a-351">Returns the percentile element of the vector v.</span></span> |
| <span data-ttu-id="d627a-352">rand()</span><span class="sxs-lookup"><span data-stu-id="d627a-352">rand()</span></span> |<span data-ttu-id="d627a-353">double</span><span class="sxs-lookup"><span data-stu-id="d627a-353">double</span></span> |<span data-ttu-id="d627a-354">Restituisce un valore casuale compreso tra 0,0 e 1,0.</span><span class="sxs-lookup"><span data-stu-id="d627a-354">Returns a random value between 0.0 and 1.0.</span></span> |
| <span data-ttu-id="d627a-355">range(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d627a-355">range(doubleVecList)</span></span> |<span data-ttu-id="d627a-356">double</span><span class="sxs-lookup"><span data-stu-id="d627a-356">double</span></span> |<span data-ttu-id="d627a-357">Restituisce la differenza tra i valori minimo e massimo in doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d627a-357">Returns the difference between the min and max values in the doubleVecList.</span></span> |
| <span data-ttu-id="d627a-358">std(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d627a-358">std(doubleVecList)</span></span> |<span data-ttu-id="d627a-359">double</span><span class="sxs-lookup"><span data-stu-id="d627a-359">double</span></span> |<span data-ttu-id="d627a-360">Restituisce la deviazione standard del campione dei valori in doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d627a-360">Returns the sample standard deviation of the values in the doubleVecList.</span></span> |
| <span data-ttu-id="d627a-361">stop()</span><span class="sxs-lookup"><span data-stu-id="d627a-361">stop()</span></span> | |<span data-ttu-id="d627a-362">Arresta la valutazione dell'espressione per il ridimensionamento automatico.</span><span class="sxs-lookup"><span data-stu-id="d627a-362">Stops evaluation of the autoscaling expression.</span></span> |
| <span data-ttu-id="d627a-363">sum(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="d627a-363">sum(doubleVecList)</span></span> |<span data-ttu-id="d627a-364">double</span><span class="sxs-lookup"><span data-stu-id="d627a-364">double</span></span> |<span data-ttu-id="d627a-365">Restituisce la somma di tutti i componenti di doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="d627a-365">Returns the sum of all the components of the doubleVecList.</span></span> |
| <span data-ttu-id="d627a-366">time(string dateTime="")</span><span class="sxs-lookup"><span data-stu-id="d627a-366">time(string dateTime="")</span></span> |<span data-ttu-id="d627a-367">timestamp</span><span class="sxs-lookup"><span data-stu-id="d627a-367">timestamp</span></span> |<span data-ttu-id="d627a-368">Restituisce il timestamp dell'ora corrente se non vengono passati parametri oppure il timestamp della stringa dateTime, se è stata passata.</span><span class="sxs-lookup"><span data-stu-id="d627a-368">Returns the time stamp of the current time if no parameters are passed, or the time stamp of the dateTime string if it is passed.</span></span> <span data-ttu-id="d627a-369">I formati dateTime supportati sono W3C-DTF e RFC 1123.</span><span class="sxs-lookup"><span data-stu-id="d627a-369">Supported dateTime formats are W3C-DTF and RFC 1123.</span></span> |
| <span data-ttu-id="d627a-370">val(doubleVec v, double i)</span><span class="sxs-lookup"><span data-stu-id="d627a-370">val(doubleVec v, double i)</span></span> |<span data-ttu-id="d627a-371">double</span><span class="sxs-lookup"><span data-stu-id="d627a-371">double</span></span> |<span data-ttu-id="d627a-372">Restituisce il valore dell'elemento nella posizione i nel vettore v con un indice iniziale pari a zero.</span><span class="sxs-lookup"><span data-stu-id="d627a-372">Returns the value of the element that is at location i in vector v, with a starting index of zero.</span></span> |

<span data-ttu-id="d627a-373">Alcune delle funzioni descritte nella tabella precedente possono accettare un elenco come argomento.</span><span class="sxs-lookup"><span data-stu-id="d627a-373">Some of the functions that are described in the previous table can accept a list as an argument.</span></span> <span data-ttu-id="d627a-374">L'elenco con valori delimitati da virgole è una combinazione qualsiasi di *double* e *doubleVec*.</span><span class="sxs-lookup"><span data-stu-id="d627a-374">The comma-separated list is any combination of *double* and *doubleVec*.</span></span> <span data-ttu-id="d627a-375">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="d627a-375">For example:</span></span>

`doubleVecList := ( (double | doubleVec)+(, (double | doubleVec) )* )?`

<span data-ttu-id="d627a-376">Il valore *doubleVecList* viene convertito in un singolo *doubleVec* prima della valutazione.</span><span class="sxs-lookup"><span data-stu-id="d627a-376">The *doubleVecList* value is converted to a single *doubleVec* before evaluation.</span></span> <span data-ttu-id="d627a-377">Ad esempio, se `v = [1,2,3]`, la chiamata di `avg(v)` equivale alla chiamata di `avg(1,2,3)`.</span><span class="sxs-lookup"><span data-stu-id="d627a-377">For example, if `v = [1,2,3]`, then calling `avg(v)` is equivalent to calling `avg(1,2,3)`.</span></span> <span data-ttu-id="d627a-378">La chiamata di `avg(v, 7)` equivale alla chiamata di `avg(1,2,3,7)`.</span><span class="sxs-lookup"><span data-stu-id="d627a-378">Calling `avg(v, 7)` is equivalent to calling `avg(1,2,3,7)`.</span></span>

## <span data-ttu-id="d627a-379"><a name="getsampledata"></a>Ottenere dati di esempio</span><span class="sxs-lookup"><span data-stu-id="d627a-379"><a name="getsampledata"></a>Obtain sample data</span></span>
<span data-ttu-id="d627a-380">Le formule di ridimensionamento automatico agiscono sui dati di metrica (campioni) forniti dal servizio Batch.</span><span class="sxs-lookup"><span data-stu-id="d627a-380">Autoscale formulas act on metrics data (samples) that is provided by the Batch service.</span></span> <span data-ttu-id="d627a-381">Una formula aumenta o riduce le dimensioni del pool in base ai valori che ottiene dal servizio.</span><span class="sxs-lookup"><span data-stu-id="d627a-381">A formula grows or shrinks pool size based on the values that it obtains from the service.</span></span> <span data-ttu-id="d627a-382">Le variabili definite dal servizio descritte sopra sono oggetti che offrono vari metodi per accedere ai dati associati a un dato oggetto.</span><span class="sxs-lookup"><span data-stu-id="d627a-382">The service-defined variables that were described previously are objects that provide various methods to access data that is associated with that object.</span></span> <span data-ttu-id="d627a-383">Ad esempio, l'espressione seguente mostra una richiesta per recuperare gli ultimi 5 minuti di utilizzo della CPU:</span><span class="sxs-lookup"><span data-stu-id="d627a-383">For example, the following expression shows a request to get the last five minutes of CPU usage:</span></span>

```
$CPUPercent.GetSample(TimeInterval_Minute * 5)
```

| <span data-ttu-id="d627a-384">Metodo</span><span class="sxs-lookup"><span data-stu-id="d627a-384">Method</span></span> | <span data-ttu-id="d627a-385">Descrizione</span><span class="sxs-lookup"><span data-stu-id="d627a-385">Description</span></span> |
| --- | --- |
| <span data-ttu-id="d627a-386">GetSample()</span><span class="sxs-lookup"><span data-stu-id="d627a-386">GetSample()</span></span> |<span data-ttu-id="d627a-387">Il metodo `GetSample()` restituisce un vettore relativo ai campioni di dati.</span><span class="sxs-lookup"><span data-stu-id="d627a-387">The `GetSample()` method returns a vector of data samples.</span></span><br/><br/><span data-ttu-id="d627a-388">Un campione rappresenta 30 secondi di dati di metrica.</span><span class="sxs-lookup"><span data-stu-id="d627a-388">A sample is 30 seconds worth of metrics data.</span></span> <span data-ttu-id="d627a-389">In altre parole i campioni vengono raccolti ogni 30 secondi,</span><span class="sxs-lookup"><span data-stu-id="d627a-389">In other words, samples are obtained every 30 seconds.</span></span> <span data-ttu-id="d627a-390">ma come indicato di seguito si verifica un ritardo tra il momento in cui un campione viene raccolto e il momento in cui è disponibile per una formula.</span><span class="sxs-lookup"><span data-stu-id="d627a-390">But as noted below, there is a delay between when a sample is collected and when it is available to a formula.</span></span> <span data-ttu-id="d627a-391">Di conseguenza, i campioni per un determinato periodo di tempo potrebbero non essere tutti disponibili per la valutazione da parte di una formula.</span><span class="sxs-lookup"><span data-stu-id="d627a-391">As such, not all samples for a given time period may be available for evaluation by a formula.</span></span><ul><li>`doubleVec GetSample(double count)`<br/><span data-ttu-id="d627a-392">Specifica il numero di campioni da ottenere tra quelli raccolti più di recente.</span><span class="sxs-lookup"><span data-stu-id="d627a-392">Specifies the number of samples to obtain from the most recent samples that were collected.</span></span><br/><br/><span data-ttu-id="d627a-393">`GetSample(1)` restituisce l'ultimo campione disponibile.</span><span class="sxs-lookup"><span data-stu-id="d627a-393">`GetSample(1)` returns the last available sample.</span></span> <span data-ttu-id="d627a-394">Per le metriche come `$CPUPercent` non deve tuttavia essere usato perché non è possibile sapere *quando* è stato raccolto il campione.</span><span class="sxs-lookup"><span data-stu-id="d627a-394">For metrics like `$CPUPercent`, however, this should not be used because it is impossible to know *when* the sample was collected.</span></span> <span data-ttu-id="d627a-395">Potrebbe essere recente o risultare molto meno recente a causa di problemi di sistema.</span><span class="sxs-lookup"><span data-stu-id="d627a-395">It might be recent, or, because of system issues, it might be much older.</span></span> <span data-ttu-id="d627a-396">In questi casi è preferibile usare un intervallo di tempo, come illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="d627a-396">It is better in such cases to use a time interval as shown below.</span></span><li>`doubleVec GetSample((timestamp or timeinterval) startTime [, double samplePercent])`<br/><span data-ttu-id="d627a-397">Specifica un intervallo di tempo per la raccolta di dati di esempio.</span><span class="sxs-lookup"><span data-stu-id="d627a-397">Specifies a time frame for gathering sample data.</span></span> <span data-ttu-id="d627a-398">Facoltativamente specifica anche la percentuale di campioni che deve essere disponibile nell'intervallo di tempo richiesto.</span><span class="sxs-lookup"><span data-stu-id="d627a-398">Optionally, it also specifies the percentage of samples that must be available in the requested time frame.</span></span><br/><br/><span data-ttu-id="d627a-399">`$CPUPercent.GetSample(TimeInterval_Minute * 10)` restituisce 20 campioni se nella cronologia CPUPercent sono presenti tutti i campioni per gli ultimi 10 minuti.</span><span class="sxs-lookup"><span data-stu-id="d627a-399">`$CPUPercent.GetSample(TimeInterval_Minute * 10)` would return 20 samples if all samples for the last 10 minutes are present in the CPUPercent history.</span></span> <span data-ttu-id="d627a-400">Se l'ultimo minuto della cronologia non è disponibile, vengono tuttavia restituiti solo 18 campioni.</span><span class="sxs-lookup"><span data-stu-id="d627a-400">If the last minute of history was not available, however, only 18 samples would be returned.</span></span> <span data-ttu-id="d627a-401">In questo caso:</span><span class="sxs-lookup"><span data-stu-id="d627a-401">In this case:</span></span><br/><br/><span data-ttu-id="d627a-402">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 95)` avrà esito negativo poiché è disponibile solo il 90% dei campioni.</span><span class="sxs-lookup"><span data-stu-id="d627a-402">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 95)` would fail because only 90 percent of the samples are available.</span></span><br/><br/><span data-ttu-id="d627a-403">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 80)` avrà esito positivo.</span><span class="sxs-lookup"><span data-stu-id="d627a-403">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 80)` would succeed.</span></span><li>`doubleVec GetSample((timestamp or timeinterval) startTime, (timestamp or timeinterval) endTime [, double samplePercent])`<br/><span data-ttu-id="d627a-404">Specifica un intervallo di tempo per la raccolta dei dati, con un'ora di inizio e un'ora di fine.</span><span class="sxs-lookup"><span data-stu-id="d627a-404">Specifies a time frame for gathering data, with both a start time and an end time.</span></span><br/><br/><span data-ttu-id="d627a-405">Come indicato in precedenza, si verifica un ritardo tra il momento in cui un campione viene raccolto e il momento in cui è disponibile per una formula.</span><span class="sxs-lookup"><span data-stu-id="d627a-405">As mentioned above, there is a delay between when a sample is collected and when it is available to a formula.</span></span> <span data-ttu-id="d627a-406">È necessario tenere presente questo ritardo quando si usa il metodo `GetSample`.</span><span class="sxs-lookup"><span data-stu-id="d627a-406">Consider this delay when you use the `GetSample` method.</span></span> <span data-ttu-id="d627a-407">Vedere `GetSamplePercent` di seguito.</span><span class="sxs-lookup"><span data-stu-id="d627a-407">See `GetSamplePercent` below.</span></span> |
| <span data-ttu-id="d627a-408">GetSamplePeriod()</span><span class="sxs-lookup"><span data-stu-id="d627a-408">GetSamplePeriod()</span></span> |<span data-ttu-id="d627a-409">Restituisce il periodo dei campioni raccolti in un set di dati campione cronologici.</span><span class="sxs-lookup"><span data-stu-id="d627a-409">Returns the period of samples that were taken in a historical sample data set.</span></span> |
| <span data-ttu-id="d627a-410">Count()</span><span class="sxs-lookup"><span data-stu-id="d627a-410">Count()</span></span> |<span data-ttu-id="d627a-411">Restituisce il numero totale di campioni nella cronologia dei dati di metrica.</span><span class="sxs-lookup"><span data-stu-id="d627a-411">Returns the total number of samples in the metric history.</span></span> |
| <span data-ttu-id="d627a-412">HistoryBeginTime()</span><span class="sxs-lookup"><span data-stu-id="d627a-412">HistoryBeginTime()</span></span> |<span data-ttu-id="d627a-413">Restituisce il timestamp del campione di dati disponibile meno recente per la metrica.</span><span class="sxs-lookup"><span data-stu-id="d627a-413">Returns the time stamp of the oldest available data sample for the metric.</span></span> |
| <span data-ttu-id="d627a-414">GetSamplePercent()</span><span class="sxs-lookup"><span data-stu-id="d627a-414">GetSamplePercent()</span></span> |<span data-ttu-id="d627a-415">Restituisce la percentuale di campioni disponibili per un determinato intervallo di tempo.</span><span class="sxs-lookup"><span data-stu-id="d627a-415">Returns the percentage of samples that are available for a given time interval.</span></span> <span data-ttu-id="d627a-416">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="d627a-416">For example:</span></span><br/><br/>`doubleVec GetSamplePercent( (timestamp or timeinterval) startTime [, (timestamp or timeinterval) endTime] )`<br/><br/><span data-ttu-id="d627a-417">Poiché il metodo `GetSample` non riesce se la percentuale di campioni restituiti è minore del valore `samplePercent` specificato, è possibile eseguire prima il controllo con il metodo `GetSamplePercent`.</span><span class="sxs-lookup"><span data-stu-id="d627a-417">Because the `GetSample` method fails if the percentage of samples returned is less than the `samplePercent` specified, you can use the `GetSamplePercent` method to check first.</span></span> <span data-ttu-id="d627a-418">È quindi possibile eseguire un'azione alternativa se non sono presenti campioni sufficienti, senza interrompere la valutazione del ridimensionamento automatico.</span><span class="sxs-lookup"><span data-stu-id="d627a-418">Then you can perform an alternate action if insufficient samples are present, without halting the automatic scaling evaluation.</span></span> |

### <a name="samples-sample-percentage-and-the-getsample-method"></a><span data-ttu-id="d627a-419">Campioni, percentuale di campioni e metodo *GetSample()*</span><span class="sxs-lookup"><span data-stu-id="d627a-419">Samples, sample percentage, and the *GetSample()* method</span></span>
<span data-ttu-id="d627a-420">L'operazione di base per il funzionamento di una formula di ridimensionamento automatico consiste nell'ottenere i dati di metrica relativi a risorse ed attività e quindi l'adeguamento delle dimensioni del pool in base a tali dati.</span><span class="sxs-lookup"><span data-stu-id="d627a-420">The core operation of an autoscale formula is to obtain task and resource metric data and then adjust pool size based on that data.</span></span> <span data-ttu-id="d627a-421">Di conseguenza, è importante conoscere a fondo la modalità di interazione delle formule di scalabilità automatica con i dati di metrica (campioni).</span><span class="sxs-lookup"><span data-stu-id="d627a-421">As such, it is important to have a clear understanding of how autoscale formulas interact with metrics data (samples).</span></span>

<span data-ttu-id="d627a-422">**Esempi**</span><span class="sxs-lookup"><span data-stu-id="d627a-422">**Samples**</span></span>

<span data-ttu-id="d627a-423">Il servizio Batch acquisisce periodicamente campioni di metriche relative a risorse e attività e li rende disponibili per le formule di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="d627a-423">The Batch service periodically takes samples of task and resource metrics and makes them available to your autoscale formulas.</span></span> <span data-ttu-id="d627a-424">Questi campioni vengono registrati ogni 30 secondi dal servizio Batch.</span><span class="sxs-lookup"><span data-stu-id="d627a-424">These samples are recorded every 30 seconds by the Batch service.</span></span> <span data-ttu-id="d627a-425">In genere si verifica un ritardo tra il momento in cui i campioni sono stati registrati e il momento in cui vengono resi disponibili e possono essere letti dalle formule di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="d627a-425">However, there is typically a delay between when those samples were recorded and when they are made available to (and can be read by) your autoscale formulas.</span></span> <span data-ttu-id="d627a-426">Inoltre, a causa di vari fattori, ad esempio problemi di rete o dell'infrastruttura, è possibile che i campioni non vengano registrati per un particolare intervallo.</span><span class="sxs-lookup"><span data-stu-id="d627a-426">Additionally, due to various factors such as network or other infrastructure issues, samples may not be recorded for a particular interval.</span></span>

<span data-ttu-id="d627a-427">**Percentuale di campioni**</span><span class="sxs-lookup"><span data-stu-id="d627a-427">**Sample percentage**</span></span>

<span data-ttu-id="d627a-428">Quando si passa un oggetto `samplePercent` al metodo `GetSample()` o si chiama il metodo `GetSamplePercent()`, il termine _percentuale_ si riferisce a un confronto tra il possibile numero totale di campioni registrati dal servizio Batch e il numero di campioni disponibili per la formula di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="d627a-428">When `samplePercent` is passed to the `GetSample()` method or the `GetSamplePercent()` method is called, _percent_ refers to a comparison between the total possible number of samples that are recorded by the Batch service and the number of samples that are available to your autoscale formula.</span></span>

<span data-ttu-id="d627a-429">Come esempio, si esaminerà un intervallo di tempo di 10 minuti.</span><span class="sxs-lookup"><span data-stu-id="d627a-429">Let's look at a 10-minute timespan as an example.</span></span> <span data-ttu-id="d627a-430">Poiché i campioni vengono registrati ogni 30 secondi, in un intervallo di tempo di 10 minuti, il numero massimo totale di campioni registrati da Batch sarà di 20 campioni (2 al minuto).</span><span class="sxs-lookup"><span data-stu-id="d627a-430">Because samples are recorded every 30 seconds within a 10-minute timespan, the maximum total number of samples that are recorded by Batch would be 20 samples (2 per minute).</span></span> <span data-ttu-id="d627a-431">Tuttavia, a causa della latenza intrinseca del meccanismo di creazione di report e di altri problemi a all'interno di Azure, potrebbero essere disponibili solo 15 campioni per la lettura da parte della formula di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="d627a-431">However, due to the inherent latency of the reporting mechanism and other issues within Azure, there may be only 15 samples that are available to your autoscale formula for reading.</span></span> <span data-ttu-id="d627a-432">Per il periodo di 10 minuti, ad esempio, potrebbe essere quindi disponibile per la formula solo il 75% del numero totale di campioni registrati.</span><span class="sxs-lookup"><span data-stu-id="d627a-432">So, for example, for that 10-minute period, only 75% of the total number of samples recorded may be available to your formula.</span></span>

<span data-ttu-id="d627a-433">**GetSample() e intervalli di campioni**</span><span class="sxs-lookup"><span data-stu-id="d627a-433">**GetSample() and sample ranges**</span></span>

<span data-ttu-id="d627a-434">Le formule di scalabilità automatica+ aumentano e riducono i pool, aggiungendovi nodi o rimuovendoli.</span><span class="sxs-lookup"><span data-stu-id="d627a-434">Your autoscale formulas are going to be growing and shrinking your pools &mdash; adding nodes or removing nodes.</span></span> <span data-ttu-id="d627a-435">Poiché i nodi hanno un costo, si vuole garantire che le formule applichino decisioni intelligenti sulla base di dati sufficienti.</span><span class="sxs-lookup"><span data-stu-id="d627a-435">Because nodes cost you money, you want to ensure that your formulas use an intelligent method of analysis that is based on sufficient data.</span></span> <span data-ttu-id="d627a-436">È quindi consigliabile usare un tipo di analisi delle tendenze nelle formule,</span><span class="sxs-lookup"><span data-stu-id="d627a-436">Therefore, we recommend that you use a trending-type analysis in your formulas.</span></span> <span data-ttu-id="d627a-437">aumentando e riducendo i pool in base a un intervallo di campioni raccolti.</span><span class="sxs-lookup"><span data-stu-id="d627a-437">This type grows and shrinks your pools based on a range of collected samples.</span></span>

<span data-ttu-id="d627a-438">A tale scopo, usare `GetSample(interval look-back start, interval look-back end)` per restituire un vettore di campioni:</span><span class="sxs-lookup"><span data-stu-id="d627a-438">To do so, use `GetSample(interval look-back start, interval look-back end)` to return a vector of samples:</span></span>

```
$runningTasksSample = $RunningTasks.GetSample(1 * TimeInterval_Minute, 6 * TimeInterval_Minute);
```

<span data-ttu-id="d627a-439">Quando la riga precedente viene valutata da Batch, restituisce un intervallo di campioni come vettore di valori.</span><span class="sxs-lookup"><span data-stu-id="d627a-439">When the above line is evaluated by Batch, it returns a range of samples as a vector of values.</span></span> <span data-ttu-id="d627a-440">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="d627a-440">For example:</span></span>

```
$runningTasksSample=[1,1,1,1,1,1,1,1,1,1];
```

<span data-ttu-id="d627a-441">Dopo aver raccolto il vettore di campioni, è possibile usare funzioni come `min()`, `max()` e `avg()` per derivare valori significativi dall'intervallo raccolto.</span><span class="sxs-lookup"><span data-stu-id="d627a-441">Once you've collected the vector of samples, you can then use functions like `min()`, `max()`, and `avg()` to derive meaningful values from the collected range.</span></span>

<span data-ttu-id="d627a-442">Per maggiore sicurezza, è possibile fare in modo che la valutazione di una formula non riesca se per un determinato periodo di tempo è disponibile una quantità di campioni inferiore a una certa percentuale.</span><span class="sxs-lookup"><span data-stu-id="d627a-442">For additional security, you can force a formula evaluation to fail if less than a certain sample percentage is available for a particular time period.</span></span> <span data-ttu-id="d627a-443">L'impostazione di un esito negativo della valutazione della formula indica a Batch di interromperne l'ulteriore valutazione se la percentuale di campioni specificata non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="d627a-443">When you force a formula evaluation to fail, you instruct Batch to cease further evaluation of the formula if the specified percentage of samples is not available.</span></span> <span data-ttu-id="d627a-444">In questo caso non viene apportata alcuna modifica alla dimensione del pool.</span><span class="sxs-lookup"><span data-stu-id="d627a-444">In this case, no change is made to the pool size.</span></span> <span data-ttu-id="d627a-445">Per specificare una percentuale di campioni obbligatoria perché la valutazione riesca, specificarla come terzo parametro in `GetSample()`.</span><span class="sxs-lookup"><span data-stu-id="d627a-445">To specify a required percentage of samples for the evaluation to succeed, specify it as the third parameter to `GetSample()`.</span></span> <span data-ttu-id="d627a-446">Qui è specificato un requisito pari al 75% dei campioni:</span><span class="sxs-lookup"><span data-stu-id="d627a-446">Here, a requirement of 75 percent of samples is specified:</span></span>

```
$runningTasksSample = $RunningTasks.GetSample(60 * TimeInterval_Second, 120 * TimeInterval_Second, 75);
```

<span data-ttu-id="d627a-447">Poiché si può verificare un ritardo nella disponibilità dei campioni, è importante specificare sempre un intervallo di tempo con un'ora di inizio antecedente di almeno un minuto.</span><span class="sxs-lookup"><span data-stu-id="d627a-447">Because there may be a delay in sample availability, it is important to always specify a time range with a look-back start time that is older than one minute.</span></span> <span data-ttu-id="d627a-448">La propagazione dei campioni attraverso il sistema richiede circa un minuto, quindi i campioni nell'intervallo `(0 * TimeInterval_Second, 60 * TimeInterval_Second)` possono non essere disponibili.</span><span class="sxs-lookup"><span data-stu-id="d627a-448">It takes approximately one minute for samples to propagate through the system, so samples in the range `(0 * TimeInterval_Second, 60 * TimeInterval_Second)` may not be available.</span></span> <span data-ttu-id="d627a-449">Anche in questo caso, è possibile usare il parametro percentuale di `GetSample()` per imporre uno specifico requisito di percentuale dei campioni.</span><span class="sxs-lookup"><span data-stu-id="d627a-449">Again, you can use the percentage parameter of `GetSample()` to force a particular sample percentage requirement.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d627a-450">È **consigliabile** **evitare di basarsi *solo* su `GetSample(1)` nelle formule di scalabilità automatica**.</span><span class="sxs-lookup"><span data-stu-id="d627a-450">We **strongly recommend** that you **avoid relying *only* on `GetSample(1)` in your autoscale formulas**.</span></span> <span data-ttu-id="d627a-451">`GetSample(1)` indica infatti essenzialmente al servizio Batch di restituire l'ultimo campione disponibile, indipendentemente da quanto tempo prima è stato recuperato.</span><span class="sxs-lookup"><span data-stu-id="d627a-451">This is because `GetSample(1)` essentially says to the Batch service, "Give me the last sample you have, no matter how long ago you retrieved it."</span></span> <span data-ttu-id="d627a-452">Essendo solo un singolo campione, che potrebbe anche non essere recente, potrebbe non essere rappresentativo dell'immagine più ampia dello stato recente di attività o risorse.</span><span class="sxs-lookup"><span data-stu-id="d627a-452">Since it is only a single sample, and it may be an older sample, it may not be representative of the larger picture of recent task or resource state.</span></span> <span data-ttu-id="d627a-453">Se si usa `GetSample(1)`, accertarsi che faccia parte di un'istruzione di dimensioni maggiori e non sia il solo punto dati su cui si basa la formula.</span><span class="sxs-lookup"><span data-stu-id="d627a-453">If you do use `GetSample(1)`, make sure that it's part of a larger statement and not the only data point that your formula relies on.</span></span>
>
>

## <a name="metrics"></a><span data-ttu-id="d627a-454">Metriche</span><span class="sxs-lookup"><span data-stu-id="d627a-454">Metrics</span></span>
<span data-ttu-id="d627a-455">Quando si definisce una formula, è possibile usare metriche di risorse e di attività.</span><span class="sxs-lookup"><span data-stu-id="d627a-455">You can use both resource and task metrics when you're defining a formula.</span></span> <span data-ttu-id="d627a-456">Adeguare il numero di destinazione di nodi dedicati nel pool in base ai dati di metrica ottenuti e valutati.</span><span class="sxs-lookup"><span data-stu-id="d627a-456">You adjust the target number of dedicated nodes in the pool based on the metrics data that you obtain and evaluate.</span></span> <span data-ttu-id="d627a-457">Per altre informazioni su ogni metrica, vedere la sezione [Variabili](#variables) precedente.</span><span class="sxs-lookup"><span data-stu-id="d627a-457">See the [Variables](#variables) section above for more information on each metric.</span></span>

<table>
  <tr>
    <th><span data-ttu-id="d627a-458">Metrica</span><span class="sxs-lookup"><span data-stu-id="d627a-458">Metric</span></span></th>
    <th><span data-ttu-id="d627a-459">Descrizione</span><span class="sxs-lookup"><span data-stu-id="d627a-459">Description</span></span></th>
  </tr>
  <tr>
    <td><span data-ttu-id="d627a-460"><b>Risorsa</b></span><span class="sxs-lookup"><span data-stu-id="d627a-460"><b>Resource</b></span></span></td>
    <td><p><span data-ttu-id="d627a-461">La metrica delle risorse si basa sull'uso della memoria, della CPU e della larghezza di banda dei nodi di calcolo, nonché sul numero di nodi.</span><span class="sxs-lookup"><span data-stu-id="d627a-461">Resource metrics are based on the CPU, the bandwidth, the memory usage of compute nodes, and the number of nodes.</span></span></p>
        <p> <span data-ttu-id="d627a-462">Queste variabili definite dal servizio sono utili per eseguire adeguamenti in base al conteggio dei nodi:</span><span class="sxs-lookup"><span data-stu-id="d627a-462">These service-defined variables are useful for making adjustments based on node count:</span></span></p>
    <p><ul>
            <li><span data-ttu-id="d627a-463">$TargetDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="d627a-463">$TargetDedicatedNodes</span></span></li>
            <li><span data-ttu-id="d627a-464">$TargetLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="d627a-464">$TargetLowPriorityNodes</span></span></li>
            <li><span data-ttu-id="d627a-465">$CurrentDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="d627a-465">$CurrentDedicatedNodes</span></span></li>
            <li><span data-ttu-id="d627a-466">$CurrentLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="d627a-466">$CurrentLowPriorityNodes</span></span></li>
            <li><span data-ttu-id="d627a-467">$preemptedNodeCount</span><span class="sxs-lookup"><span data-stu-id="d627a-467">$preemptedNodeCount</span></span></li>
            <li><span data-ttu-id="d627a-468">$SampleNodeCount</span><span class="sxs-lookup"><span data-stu-id="d627a-468">$SampleNodeCount</span></span></li>
    </ul></p>
    <p><span data-ttu-id="d627a-469">Queste variabili definite dal servizio sono utili per eseguire adeguamenti in base all'utilizzo delle risorse dei nodi:</span><span class="sxs-lookup"><span data-stu-id="d627a-469">These service-defined variables are useful for making adjustments based on node resource usage:</span></span></p>
    <p><ul>
      <li><span data-ttu-id="d627a-470">$CPUPercent</span><span class="sxs-lookup"><span data-stu-id="d627a-470">$CPUPercent</span></span></li>
      <li><span data-ttu-id="d627a-471">$WallClockSeconds</span><span class="sxs-lookup"><span data-stu-id="d627a-471">$WallClockSeconds</span></span></li>
      <li><span data-ttu-id="d627a-472">$MemoryBytes</span><span class="sxs-lookup"><span data-stu-id="d627a-472">$MemoryBytes</span></span></li>
      <li><span data-ttu-id="d627a-473">$DiskBytes</span><span class="sxs-lookup"><span data-stu-id="d627a-473">$DiskBytes</span></span></li>
      <li><span data-ttu-id="d627a-474">$DiskReadBytes</span><span class="sxs-lookup"><span data-stu-id="d627a-474">$DiskReadBytes</span></span></li>
      <li><span data-ttu-id="d627a-475">$DiskWriteBytes</span><span class="sxs-lookup"><span data-stu-id="d627a-475">$DiskWriteBytes</span></span></li>
      <li><span data-ttu-id="d627a-476">$DiskReadOps</span><span class="sxs-lookup"><span data-stu-id="d627a-476">$DiskReadOps</span></span></li>
      <li><span data-ttu-id="d627a-477">$DiskWriteOps</span><span class="sxs-lookup"><span data-stu-id="d627a-477">$DiskWriteOps</span></span></li>
      <li><span data-ttu-id="d627a-478">$NetworkInBytes</span><span class="sxs-lookup"><span data-stu-id="d627a-478">$NetworkInBytes</span></span></li>
      <li><span data-ttu-id="d627a-479">$NetworkOutBytes</span><span class="sxs-lookup"><span data-stu-id="d627a-479">$NetworkOutBytes</span></span></li></ul></p>
  </tr>
  <tr>
    <td><span data-ttu-id="d627a-480"><b>Task</b></span><span class="sxs-lookup"><span data-stu-id="d627a-480"><b>Task</b></span></span></td>
    <td><p><span data-ttu-id="d627a-481">La metrica delle attività si basa sullo stato delle attività, ad esempio Attiva, In sospeso e Completata.</span><span class="sxs-lookup"><span data-stu-id="d627a-481">Task metrics are based on the status of tasks, such as Active, Pending, and Completed.</span></span> <span data-ttu-id="d627a-482">Le variabili definite dal servizio seguenti sono utili per gli adeguamenti delle dimensioni del pool basati sulla metrica delle attività:</span><span class="sxs-lookup"><span data-stu-id="d627a-482">The following service-defined variables are useful for making pool-size adjustments based on task metrics:</span></span></p>
    <p><ul>
      <li><span data-ttu-id="d627a-483">$ActiveTasks</span><span class="sxs-lookup"><span data-stu-id="d627a-483">$ActiveTasks</span></span></li>
      <li><span data-ttu-id="d627a-484">$RunningTasks</span><span class="sxs-lookup"><span data-stu-id="d627a-484">$RunningTasks</span></span></li>
      <li><span data-ttu-id="d627a-485">$PendingTasks</span><span class="sxs-lookup"><span data-stu-id="d627a-485">$PendingTasks</span></span></li>
      <li><span data-ttu-id="d627a-486">$SucceededTasks</span><span class="sxs-lookup"><span data-stu-id="d627a-486">$SucceededTasks</span></span></li>
            <li><span data-ttu-id="d627a-487">$FailedTasks</span><span class="sxs-lookup"><span data-stu-id="d627a-487">$FailedTasks</span></span></li></ul></p>
        </td>
  </tr>
</table>

## <a name="write-an-autoscale-formula"></a><span data-ttu-id="d627a-488">Scrivere una formula di scalabilità automatica</span><span class="sxs-lookup"><span data-stu-id="d627a-488">Write an autoscale formula</span></span>
<span data-ttu-id="d627a-489">La compilazione di una formula di scalabilità automatica prevede la composizione di istruzioni che usano i componenti precedenti e quindi la combinazione di tali istruzioni in una formula completa.</span><span class="sxs-lookup"><span data-stu-id="d627a-489">You build an autoscale formula by forming statements that use the above components, then combine those statements into a complete formula.</span></span> <span data-ttu-id="d627a-490">In questa sezione si crea una formula di scalabilità automatica di esempio che può assumere alcune decisioni di scalabilità in scenari del mondo reale.</span><span class="sxs-lookup"><span data-stu-id="d627a-490">In this section, we create an example autoscale formula that can perform some real-world scaling decisions.</span></span>

<span data-ttu-id="d627a-491">In primo luogo, definire i requisiti per la nuova formula di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="d627a-491">First, let's define the requirements for our new autoscale formula.</span></span> <span data-ttu-id="d627a-492">La formula deve:</span><span class="sxs-lookup"><span data-stu-id="d627a-492">The formula should:</span></span>

1. <span data-ttu-id="d627a-493">Aumentare il numero di destinazione dei nodi di calcolo dedicati in un pool se l'uso della CPU è elevato.</span><span class="sxs-lookup"><span data-stu-id="d627a-493">Increase the target number of dedicated compute nodes in a pool if CPU usage is high.</span></span>
2. <span data-ttu-id="d627a-494">Ridurre il numero di destinazione dei nodi di calcolo dedicati in un pool se l'uso della CPU è basso.</span><span class="sxs-lookup"><span data-stu-id="d627a-494">Decrease the target number of dedicated compute nodes in a pool when CPU usage is low.</span></span>
3. <span data-ttu-id="d627a-495">Limitare sempre il numero massimo di nodi dedicati a 400.</span><span class="sxs-lookup"><span data-stu-id="d627a-495">Always restrict the maximum number of dedicated nodes to 400.</span></span>

<span data-ttu-id="d627a-496">Per l'aumento del numero di nodi durante l'uso elevato della CPU, viene definita un'istruzione che popola una variabile definita dall'utente (`$totalDedicatedNodes`) con un valore pari al 110% dell'attuale numero di destinazione dei nodi dedicati, ma solo se l'uso minimo medio della CPU negli ultimi 10 minuti è superiore al 70%.</span><span class="sxs-lookup"><span data-stu-id="d627a-496">To increase the number of nodes during high CPU usage, define the statement that populates a user-defined variable (`$totalDedicatedNodes`) with a value that is 110 percent of the current target number of dedicated nodes, but only if the minimum average CPU usage during the last 10 minutes was above 70 percent.</span></span> <span data-ttu-id="d627a-497">In caso contrario, usare il valore per il numero corrente di nodi dedicati.</span><span class="sxs-lookup"><span data-stu-id="d627a-497">Otherwise, use the value for the current number of dedicated nodes.</span></span>

```
$totalDedicatedNodes =
    (min($CPUPercent.GetSample(TimeInterval_Minute * 10)) > 0.7) ?
    ($CurrentDedicatedNodes * 1.1) : $CurrentDedicatedNodes;
```

<span data-ttu-id="d627a-498">Per *ridurre* il numero di nodi dedicati durante l'uso non elevato della CPU, l'istruzione successiva nella formula imposta la stessa variabile `$totalDedicatedNodes` sul 90% dell'attuale numero di destinazione dei nodi dedicati, se l'uso medio della CPU negli ultimi 60 minuti è stato inferiore al 20%.</span><span class="sxs-lookup"><span data-stu-id="d627a-498">To *decrease* the number of dedicated nodes during low CPU usage, the next statement in our formula sets the same `$totalDedicatedNodes` variable to 90 percent of the current target number of dedicated nodes if the average CPU usage in the past 60 minutes was under 20 percent.</span></span> <span data-ttu-id="d627a-499">In caso contrario, usare il valore corrente di `$totalDedicatedNodes`, popolato nell'istruzione precedente.</span><span class="sxs-lookup"><span data-stu-id="d627a-499">Otherwise, use the current value of `$totalDedicatedNodes` that we populated in the statement above.</span></span>

```
$totalDedicatedNodes =
    (avg($CPUPercent.GetSample(TimeInterval_Minute * 60)) < 0.2) ?
    ($CurrentDedicatedNodes * 0.9) : $totalDedicatedNodes;
```

<span data-ttu-id="d627a-500">Limitare ora il numero di destinazione dei nodi di calcolo dedicati a un massimo di 400:</span><span class="sxs-lookup"><span data-stu-id="d627a-500">Now limit the target number of dedicated compute nodes to a maximum of 400:</span></span>

```
$TargetDedicatedNodes = min(400, $totalDedicatedNodes)
```

<span data-ttu-id="d627a-501">Ecco la formula completa:</span><span class="sxs-lookup"><span data-stu-id="d627a-501">Here's the complete formula:</span></span>

```
$totalDedicatedNodes =
    (min($CPUPercent.GetSample(TimeInterval_Minute * 10)) > 0.7) ?
    ($CurrentDedicatedNodes * 1.1) : $CurrentDedicatedNodes;
$totalDedicatedNodes =
    (avg($CPUPercent.GetSample(TimeInterval_Minute * 60)) < 0.2) ?
    ($CurrentDedicatedNodes * 0.9) : $totalDedicatedNodes;
$TargetDedicatedNodes = min(400, $totalDedicatedNodes)
```

## <a name="create-an-autoscale-enabled-pool-with-net"></a><span data-ttu-id="d627a-502">Creare un pool abilitato per la scalabilità automatica con .NET</span><span class="sxs-lookup"><span data-stu-id="d627a-502">Create an autoscale-enabled pool with .NET</span></span>

<span data-ttu-id="d627a-503">Per creare un pool con la scalabilità automatica abilitata in .NET, seguire questi passaggi:</span><span class="sxs-lookup"><span data-stu-id="d627a-503">To create a pool with autoscaling enabled in .NET, follow these steps:</span></span>

1. <span data-ttu-id="d627a-504">Creare il pool con [BatchClient.PoolOperations.CreatePool](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.createpool).</span><span class="sxs-lookup"><span data-stu-id="d627a-504">Create the pool with [BatchClient.PoolOperations.CreatePool](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.createpool).</span></span>
2. <span data-ttu-id="d627a-505">Impostare la proprietà [CloudPool.AutoScaleEnabled](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleenabled) su `true`.</span><span class="sxs-lookup"><span data-stu-id="d627a-505">Set the [CloudPool.AutoScaleEnabled](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleenabled) property to `true`.</span></span>
3. <span data-ttu-id="d627a-506">Impostare la proprietà [CloudPool.AutoScaleFormula](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula) con la formula di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="d627a-506">Set the [CloudPool.AutoScaleFormula](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula) property with your autoscale formula.</span></span>
4. <span data-ttu-id="d627a-507">(Facoltativo) Impostare la proprietà [CloudPool.AutoScaleEvaluationInterval](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval) (valore predefinito è 15 minuti).</span><span class="sxs-lookup"><span data-stu-id="d627a-507">(Optional) Set the [CloudPool.AutoScaleEvaluationInterval](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval) property (default is 15 minutes).</span></span>
5. <span data-ttu-id="d627a-508">Eseguire il commit del pool con [CloudPool.Commit](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commit) o [CommitAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commitasync).</span><span class="sxs-lookup"><span data-stu-id="d627a-508">Commit the pool with [CloudPool.Commit](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commit) or [CommitAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commitasync).</span></span>

<span data-ttu-id="d627a-509">Il frammento di codice seguente crea un pool abilitato per la scalabilità automatica in .NET.</span><span class="sxs-lookup"><span data-stu-id="d627a-509">The following code snippet creates an autoscale-enabled pool in .NET.</span></span> <span data-ttu-id="d627a-510">La formula di scalabilità automatica del pool imposta il numero di destinazione dei nodi dedicati su 5 il lunedì e su 1 per tutti gli altri giorni della settimana.</span><span class="sxs-lookup"><span data-stu-id="d627a-510">The pool's autoscale formula sets the target number of dedicated nodes to 5 on Mondays, and 1 on every other day of the week.</span></span> <span data-ttu-id="d627a-511">L'[intervallo di scalabilità automatica](#automatic-scaling-interval) è impostato su 30 minuti.</span><span class="sxs-lookup"><span data-stu-id="d627a-511">The [automatic scaling interval](#automatic-scaling-interval) is set to 30 minutes.</span></span> <span data-ttu-id="d627a-512">In questo e in altri frammenti di codice C# in questo articolo, `myBatchClient` è un'istanza correttamente inizializzata della classe [BatchClient][net_batchclient].</span><span class="sxs-lookup"><span data-stu-id="d627a-512">In this and the other C# snippets in this article, `myBatchClient` is a properly initialized instance of the [BatchClient][net_batchclient] class.</span></span>

```csharp
CloudPool pool = myBatchClient.PoolOperations.CreatePool(
                    poolId: "mypool",
                    virtualMachineSize: "small", // single-core, 1.75 GB memory, 225 GB disk
                    cloudServiceConfiguration: new CloudServiceConfiguration(osFamily: "5"));    
pool.AutoScaleEnabled = true;
pool.AutoScaleFormula = "$TargetDedicatedNodes = (time().weekday == 1 ? 5:1);";
pool.AutoScaleEvaluationInterval = TimeSpan.FromMinutes(30);
await pool.CommitAsync();
```

> [!IMPORTANT]
> <span data-ttu-id="d627a-513">Quando si crea un pool abilitato per la scalabilità automatica, non specificare il parametro _targetDedicatedComputeNodes_ o il parametro _targetLowPriorityComputeNodes_ nella chiamata a **CreatePool**.</span><span class="sxs-lookup"><span data-stu-id="d627a-513">When you create an autoscale-enabled pool, do not specify the _targetDedicatedComputeNodes_ parameter or the _targetLowPriorityComputeNodes_ parameter on the call to **CreatePool**.</span></span> <span data-ttu-id="d627a-514">Specificare invece le proprietà **AutoScaleEnabled** e **AutoScaleFormula** nel pool.</span><span class="sxs-lookup"><span data-stu-id="d627a-514">Instead, specify the **AutoScaleEnabled** and **AutoScaleFormula** properties on the pool.</span></span> <span data-ttu-id="d627a-515">I valori per queste proprietà determinano il numero di destinazione di ogni tipo di nodo.</span><span class="sxs-lookup"><span data-stu-id="d627a-515">The values for these properties determine the target number of each type of node.</span></span> <span data-ttu-id="d627a-516">Inoltre, per ridimensionare manualmente un pool abilitato per la scalabilità automatica, ad esempio con [BatchClient.PoolOperations.ResizePoolAsync][net_poolops_resizepoolasync], è prima necessario **disabilitare** la scalabilità automatica nel pool e quindi ridimensionarlo.</span><span class="sxs-lookup"><span data-stu-id="d627a-516">Also, to manually resize an autoscale-enabled pool (for example, with [BatchClient.PoolOperations.ResizePoolAsync][net_poolops_resizepoolasync]), first **disable** automatic scaling on the pool, then resize it.</span></span>
>
>

<span data-ttu-id="d627a-517">Oltre a Batch .NET, è possibile usare qualsiasi altro [SDK per Batch](batch-apis-tools.md#azure-accounts-for-batch-development), l'[API REST per Batch](https://docs.microsoft.com/rest/api/batchservice/), i [cmdlet di PowerShell per Batch](batch-powershell-cmdlets-get-started.md) e l'[interfaccia della riga di comando di Batch](batch-cli-get-started.md) per configurare la scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="d627a-517">In addition to Batch .NET, you can use any of the other [Batch SDKs](batch-apis-tools.md#azure-accounts-for-batch-development), [Batch REST](https://docs.microsoft.com/rest/api/batchservice/), [Batch PowerShell cmdlets](batch-powershell-cmdlets-get-started.md), and the [Batch CLI](batch-cli-get-started.md) to configure autoscaling.</span></span>


### <a name="automatic-scaling-interval"></a><span data-ttu-id="d627a-518">Intervallo di ridimensionamento automatico</span><span class="sxs-lookup"><span data-stu-id="d627a-518">Automatic scaling interval</span></span>
<span data-ttu-id="d627a-519">Per impostazione predefinita, il servizio Batch adegua le dimensioni di un pool in base alla relativa formula di ridimensionamento automatico ogni 15 minuti.</span><span class="sxs-lookup"><span data-stu-id="d627a-519">By default, the Batch service adjusts a pool's size according to its autoscale formula every 15 minutes.</span></span> <span data-ttu-id="d627a-520">Questo intervallo è configurabile usando le proprietà del pool seguenti:</span><span class="sxs-lookup"><span data-stu-id="d627a-520">This interval is configurable by using the following pool properties:</span></span>

* <span data-ttu-id="d627a-521">[CloudPool.AutoScaleEvaluationInterval][net_cloudpool_autoscaleevalinterval] (Batch .NET)</span><span class="sxs-lookup"><span data-stu-id="d627a-521">[CloudPool.AutoScaleEvaluationInterval][net_cloudpool_autoscaleevalinterval] (Batch .NET)</span></span>
* <span data-ttu-id="d627a-522">[autoScaleEvaluationInterval][rest_autoscaleinterval] (API REST)</span><span class="sxs-lookup"><span data-stu-id="d627a-522">[autoScaleEvaluationInterval][rest_autoscaleinterval] (REST API)</span></span>

<span data-ttu-id="d627a-523">L'intervallo minimo è di 5 minuti e il massimo di 168 ore.</span><span class="sxs-lookup"><span data-stu-id="d627a-523">The minimum interval is five minutes, and the maximum is 168 hours.</span></span> <span data-ttu-id="d627a-524">Se viene specificato un intervallo che non rientra in questi valori, il servizio Batch restituisce un errore di richiesta non valida (400).</span><span class="sxs-lookup"><span data-stu-id="d627a-524">If an interval outside this range is specified, the Batch service returns a Bad Request (400) error.</span></span>

> [!NOTE]
> <span data-ttu-id="d627a-525">La funzionalità di ridimensionamento automatico non è attualmente concepita come risposta alle modifiche in meno di un minuto, ma piuttosto per l'adeguamento graduale delle dimensioni del pool durante l'esecuzione di un carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="d627a-525">Autoscaling is not currently intended to respond to changes in less than a minute, but rather is intended to adjust the size of your pool gradually as you run a workload.</span></span>
>
>

## <a name="enable-autoscaling-on-an-existing-pool"></a><span data-ttu-id="d627a-526">Abilitare la scalabilità automatica in un pool esistente</span><span class="sxs-lookup"><span data-stu-id="d627a-526">Enable autoscaling on an existing pool</span></span>

<span data-ttu-id="d627a-527">Ogni SDK per Batch offre un modo per abilitare la scalabilità automatica,</span><span class="sxs-lookup"><span data-stu-id="d627a-527">Each Batch SDK provides a way to enable autoscaling.</span></span> <span data-ttu-id="d627a-528">ad esempio:</span><span class="sxs-lookup"><span data-stu-id="d627a-528">For example:</span></span>

* <span data-ttu-id="d627a-529">[BatchClient.PoolOperations.EnableAutoScaleAsync][net_enableautoscaleasync] (Batch .NET)</span><span class="sxs-lookup"><span data-stu-id="d627a-529">[BatchClient.PoolOperations.EnableAutoScaleAsync][net_enableautoscaleasync] (Batch .NET)</span></span>
* <span data-ttu-id="d627a-530">[Abilitare la scalabilità automatica in un pool][rest_enableautoscale] (API REST)</span><span class="sxs-lookup"><span data-stu-id="d627a-530">[Enable automatic scaling on a pool][rest_enableautoscale] (REST API)</span></span>

<span data-ttu-id="d627a-531">Quando si abilita la scalabilità automatica in un pool esistente, tenere presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="d627a-531">When you enable autoscaling on an existing pool, keep in mind the following points:</span></span>

* <span data-ttu-id="d627a-532">Se la scalabilità automatica è attualmente disabilitata nel pool quando si esegue la richiesta per l'abilitazione, è necessario specificare una formula di scalabilità automatica valida quando si esegue la richiesta.</span><span class="sxs-lookup"><span data-stu-id="d627a-532">If automatic scaling is currently disabled on the pool when you issue the request to enable autoscaling, you must specify a valid autoscale formula when you issue the request.</span></span> <span data-ttu-id="d627a-533">Facoltativamente, è possibile specificare un intervallo di valutazione della scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="d627a-533">You can optionally specify an autoscale evaluation interval.</span></span> <span data-ttu-id="d627a-534">Se non si specifica un intervallo, viene applicato il valore predefinito, pari a 15 minuti.</span><span class="sxs-lookup"><span data-stu-id="d627a-534">If you do not specify an interval, the default value of 15 minutes is used.</span></span>
* <span data-ttu-id="d627a-535">Se la scalabilità automatica è attualmente abilitata nel pool, è possibile specificare una formula di scalabilità automatica, un intervallo di valutazione o entrambi.</span><span class="sxs-lookup"><span data-stu-id="d627a-535">If autoscale is currently enabled on the pool, you can specify an autoscale formula, an evaluation interval, or both.</span></span> <span data-ttu-id="d627a-536">È necessario specificare almeno una di queste proprietà.</span><span class="sxs-lookup"><span data-stu-id="d627a-536">You must specify at least one of these properties.</span></span>

  * <span data-ttu-id="d627a-537">Se si specifica un nuovo intervallo per la valutazione della scalabilità automatica, la pianificazione esistente per la valutazione viene arrestata e viene avviata una nuova pianificazione.</span><span class="sxs-lookup"><span data-stu-id="d627a-537">If you specify a new autoscale evaluation interval, then the existing evaluation schedule is stopped and a new schedule is started.</span></span> <span data-ttu-id="d627a-538">L'ora di inizio della nuova pianificazione corrisponde al momento in cui è stata inviata la richiesta di abilitazione della scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="d627a-538">The new schedule's start time is the time at which the request to enable autoscaling was issued.</span></span>
  * <span data-ttu-id="d627a-539">Se si omette la formula di scalabilità automatica o l'intervallo di valutazione, il servizio Batch continuerà a usare il valore corrente.</span><span class="sxs-lookup"><span data-stu-id="d627a-539">If you omit either the autoscale formula or evaluation interval, the Batch service continues to use the current value of that setting.</span></span>

> [!NOTE]
> <span data-ttu-id="d627a-540">Se si specificano valori per i parametri *targetDedicatedComputeNodes* o *targetLowPriorityComputeNodes* del metodo **CreatePool** al momento della creazione del pool in .NET, o per parametri analoghi in un altro linguaggio, questi valori vengono ignorati quando viene valutata la formula di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="d627a-540">If you specified values for the *targetDedicatedComputeNodes* or *targetLowPriorityComputeNodes* parameters of the **CreatePool** method when you created the pool in .NET, or for the comparable parameters in another language, then those values are ignored when the automatic scaling formula is evaluated.</span></span>
>
>

<span data-ttu-id="d627a-541">Questo frammento di codice C# usa la libreria [Batch .NET][net_api] per abilitare la scalabilità automatica in un pool esistente:</span><span class="sxs-lookup"><span data-stu-id="d627a-541">This C# code snippet uses the [Batch .NET][net_api] library to enable autoscaling on an existing pool:</span></span>

```csharp
// Define the autoscaling formula. This formula sets the target number of nodes
// to 5 on Mondays, and 1 on every other day of the week
string myAutoScaleFormula = "$TargetDedicatedNodes = (time().weekday == 1 ? 5:1);";

// Set the autoscale formula on the existing pool
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleFormula: myAutoScaleFormula);
```

### <a name="update-an-autoscale-formula"></a><span data-ttu-id="d627a-542">Aggiornare una formula di scalabilità automatica</span><span class="sxs-lookup"><span data-stu-id="d627a-542">Update an autoscale formula</span></span>

<span data-ttu-id="d627a-543">Per aggiornare la formula in un pool esistente abilitato per la scalabilità automatica, chiamare l'operazione per abilitare di nuovo la scalabilità automatica con la nuova formula.</span><span class="sxs-lookup"><span data-stu-id="d627a-543">To update the formula on an existing autoscale-enabled pool, call the operation to enable autoscaling again with the new formula.</span></span> <span data-ttu-id="d627a-544">Ad esempio, se la scalabilità automatica è già abilitata su `myexistingpool` quando viene eseguito il codice .NET seguente, la relativa formula di scalabilità automatica viene sostituita con il contenuto di `myNewFormula`.</span><span class="sxs-lookup"><span data-stu-id="d627a-544">For example, if autoscaling is already enabled on `myexistingpool` when the following .NET code is executed, its autoscale formula is replaced with the contents of `myNewFormula`.</span></span>

```csharp
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleFormula: myNewFormula);
```

### <a name="update-the-autoscale-interval"></a><span data-ttu-id="d627a-545">Aggiornare l'intervallo di scalabilità automatica</span><span class="sxs-lookup"><span data-stu-id="d627a-545">Update the autoscale interval</span></span>

<span data-ttu-id="d627a-546">Per aggiornare l'intervallo di valutazione della scalabilità automatica in un pool esistente abilitato per la scalabilità automatica, chiamare l'operazione per abilitare di nuovo la scalabilità automatica con il nuovo intervallo.</span><span class="sxs-lookup"><span data-stu-id="d627a-546">To update the autoscale evaluation interval of an existing autoscale-enabled pool, call the operation to enable autoscaling again with the new interval.</span></span> <span data-ttu-id="d627a-547">Ad esempio, per impostare l'intervallo di valutazione della scalabilità automatica su 60 minuti per un pool già abilitato per la scalabilità automatica in .NET:</span><span class="sxs-lookup"><span data-stu-id="d627a-547">For example, to set the autoscale evaluation interval to 60 minutes for a pool that's already autoscale-enabled in .NET:</span></span>

```csharp
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleEvaluationInterval: TimeSpan.FromMinutes(60));
```

## <a name="evaluate-an-autoscale-formula"></a><span data-ttu-id="d627a-548">Valutare la formula di scalabilità automatica</span><span class="sxs-lookup"><span data-stu-id="d627a-548">Evaluate an autoscale formula</span></span>

<span data-ttu-id="d627a-549">È possibile valutare la formula prima di applicarla a un pool.</span><span class="sxs-lookup"><span data-stu-id="d627a-549">You can evaluate a formula before applying it to a pool.</span></span> <span data-ttu-id="d627a-550">In questo modo, è possibile testare la formula per vedere in che modo le relative istruzioni vengono valutate prima di inserire la formula nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="d627a-550">In this way, you can test the formula to see how its statements evaluate before you put the formula into production.</span></span>

<span data-ttu-id="d627a-551">Per valutare una formula di scalabilità automatica, è necessario avere abilitato prima la scalabilità automatica nel pool con una formula valida.</span><span class="sxs-lookup"><span data-stu-id="d627a-551">To evaluate an autoscale formula, you must first enable autoscaling on the pool with a valid formula.</span></span> <span data-ttu-id="d627a-552">Per testare una formula in un pool che non dispone ancora di scalabilità automatica abilitata, usare la formula `$TargetDedicatedNodes = 0` a una riga quando si abilita per la prima volta la scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="d627a-552">To test a formula on a pool that doesn't yet have autoscaling enabled, use the one-line formula `$TargetDedicatedNodes = 0` when you first enable autoscaling.</span></span> <span data-ttu-id="d627a-553">Usare quindi uno dei metodi seguenti per valutare la formula da testare:</span><span class="sxs-lookup"><span data-stu-id="d627a-553">Then, use one of the following to evaluate the formula you want to test:</span></span>

* <span data-ttu-id="d627a-554">[BatchClient.PoolOperations.EvaluateAutoScale](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscale) o [EvaluateAutoScaleAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscaleasync)</span><span class="sxs-lookup"><span data-stu-id="d627a-554">[BatchClient.PoolOperations.EvaluateAutoScale](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscale) or [EvaluateAutoScaleAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscaleasync)</span></span>

    <span data-ttu-id="d627a-555">Questi metodi .NET Batch richiedono l'ID di un pool esistente e una stringa contenente la formula di scalabilità automatica da valutare.</span><span class="sxs-lookup"><span data-stu-id="d627a-555">These Batch .NET methods require the ID of an existing pool and a string containing the autoscale formula to evaluate.</span></span>

* [<span data-ttu-id="d627a-556">Valutare la formula di scalabilità automatica</span><span class="sxs-lookup"><span data-stu-id="d627a-556">Evaluate an automatic scaling formula</span></span>](https://docs.microsoft.com/rest/api/batchservice/evaluate-an-automatic-scaling-formula)

    <span data-ttu-id="d627a-557">In questa richiesta di API REST specificare l'ID del pool nell'URI e la formula di scalabilità automatica nell'elemento *autoScaleFormula* del corpo della richiesta.</span><span class="sxs-lookup"><span data-stu-id="d627a-557">In this REST API request, specify the pool ID in the URI, and the autoscale formula in the *autoScaleFormula* element of the request body.</span></span> <span data-ttu-id="d627a-558">La risposta dell'operazione contiene eventuali informazioni sugli errori che potrebbero essere correlate alla formula.</span><span class="sxs-lookup"><span data-stu-id="d627a-558">The response of the operation contains any error information that might be related to the formula.</span></span>

<span data-ttu-id="d627a-559">Questo frammento di codice [Batch .NET][net_api] valuta una formula di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="d627a-559">In this [Batch .NET][net_api] code snippet, we evaluate an autoscale formula.</span></span> <span data-ttu-id="d627a-560">Se il pool non dispone di scalabilità automatica abilitata, è necessario abilitarla prima.</span><span class="sxs-lookup"><span data-stu-id="d627a-560">If the pool does not have autoscaling enabled, we enable it first.</span></span>

```csharp
// First obtain a reference to an existing pool
CloudPool pool = await batchClient.PoolOperations.GetPoolAsync("myExistingPool");

// If autoscaling isn't already enabled on the pool, enable it.
// You can't evaluate an autoscale formula on non-autoscale-enabled pool.
if (pool.AutoScaleEnabled == false)
{
    // We need a valid autoscale formula to enable autoscaling on the
    // pool. This formula is valid, but won't resize the pool:
    await pool.EnableAutoScaleAsync(
        autoscaleFormula: "$TargetDedicatedNodes = {pool.CurrentDedicatedNodes};",
        autoscaleEvaluationInterval: TimeSpan.FromMinutes(5));

    // Batch limits EnableAutoScaleAsync calls to once every 30 seconds.
    // Because we want to apply our new autoscale formula below if it
    // evaluates successfully, and we *just* enabled autoscaling on
    // this pool, we pause here to ensure we pass that threshold.
    Thread.Sleep(TimeSpan.FromSeconds(31));

    // Refresh the properties of the pool so that we've got the
    // latest value for AutoScaleEnabled
    await pool.RefreshAsync();
}

// We must ensure that autoscaling is enabled on the pool prior to
// evaluating a formula
if (pool.AutoScaleEnabled == true)
{
    // The formula to evaluate - adjusts target number of nodes based on
    // day of week and time of day
    string myFormula = @"
        $curTime = time();
        $workHours = $curTime.hour >= 8 && $curTime.hour < 18;
        $isWeekday = $curTime.weekday >= 1 && $curTime.weekday <= 5;
        $isWorkingWeekdayHour = $workHours && $isWeekday;
        $TargetDedicatedNodes = $isWorkingWeekdayHour ? 20:10;
    ";

    // Perform the autoscale formula evaluation. Note that this code does not
    // actually apply the formula to the pool.
    AutoScaleRun eval =
        await batchClient.PoolOperations.EvaluateAutoScaleAsync(pool.Id, myFormula);

    if (eval.Error == null)
    {
        // Evaluation success - print the results of the AutoScaleRun.
        // This will display the values of each variable as evaluated by the
        // autoscale formula.
        Console.WriteLine("AutoScaleRun.Results: " +
            eval.Results.Replace("$", "\n    $"));

        // Apply the formula to the pool since it evaluated successfully
        await batchClient.PoolOperations.EnableAutoScaleAsync(pool.Id, myFormula);
    }
    else
    {
        // Evaluation failed, output the message associated with the error
        Console.WriteLine("AutoScaleRun.Error.Message: " +
            eval.Error.Message);
    }
}
```

<span data-ttu-id="d627a-561">La valutazione corretta della formula in questo frammento di codice produce risultati simili ai seguenti:</span><span class="sxs-lookup"><span data-stu-id="d627a-561">Successful evaluation of the formula shown in this code snippet produces results similar to:</span></span>

```
AutoScaleRun.Results:
    $TargetDedicatedNodes=10;
    $NodeDeallocationOption=requeue;
    $curTime=2016-10-13T19:18:47.805Z;
    $isWeekday=1;
    $isWorkingWeekdayHour=0;
    $workHours=0
```

## <a name="get-information-about-autoscale-runs"></a><span data-ttu-id="d627a-562">Visualizzare informazioni sulle esecuzioni della scalabilità automatica</span><span class="sxs-lookup"><span data-stu-id="d627a-562">Get information about autoscale runs</span></span>

<span data-ttu-id="d627a-563">Per garantire che la formula funzioni come previsto, è consigliabile controllare periodicamente i risultati delle operazioni di scalabilità automatica eseguite da Batch sul pool.</span><span class="sxs-lookup"><span data-stu-id="d627a-563">To ensure that your formula is performing as expected, we recommend that you periodically check the results of the autoscaling runs that Batch performs on your pool.</span></span> <span data-ttu-id="d627a-564">A tale scopo, ottenere o aggiornare un riferimento al pool ed esaminare le proprietà dell'ultima esecuzione di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="d627a-564">To do so, get (or refresh) a reference to the pool, and examine the properties of its last autoscale run.</span></span>

<span data-ttu-id="d627a-565">In .NET di Batch la proprietà [CloudPool.AutoScaleRun](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscalerun) presenta varie proprietà che forniscono informazioni sull'ultima esecuzione di scalabilità automatica sul pool:</span><span class="sxs-lookup"><span data-stu-id="d627a-565">In Batch .NET, the [CloudPool.AutoScaleRun](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscalerun) property has several properties that provide information about the latest automatic scaling run performed on the pool:</span></span>

* [<span data-ttu-id="d627a-566">AutoScaleRun.Timestamp</span><span class="sxs-lookup"><span data-stu-id="d627a-566">AutoScaleRun.Timestamp</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.timestamp)
* [<span data-ttu-id="d627a-567">AutoScaleRun.Results</span><span class="sxs-lookup"><span data-stu-id="d627a-567">AutoScaleRun.Results</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.results)
* [<span data-ttu-id="d627a-568">AutoScaleRun.Error</span><span class="sxs-lookup"><span data-stu-id="d627a-568">AutoScaleRun.Error</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.error)

<span data-ttu-id="d627a-569">Nell'API REST la richiesta [Ottenere informazioni su un pool](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool) restituisce informazioni relative al pool, che includono l'ultima esecuzione della scalabilità automatica nella proprietà [autoScaleRun](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool#bk_autrun).</span><span class="sxs-lookup"><span data-stu-id="d627a-569">In the REST API, the [Get information about a pool](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool) request returns information about the pool, which includes the latest automatic scaling run information in the [autoScaleRun](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool#bk_autrun) property.</span></span>

<span data-ttu-id="d627a-570">Il frammento di codice C# seguente usa la libreria .NET di Batch per stampare informazioni sull'ultima esecuzione della scalabilità automatica nel pool _myPool_:</span><span class="sxs-lookup"><span data-stu-id="d627a-570">The following C# code snippet uses the Batch .NET library to print information about the last autoscaling run on pool _myPool_:</span></span>

```csharp
await Cloud pool = myBatchClient.PoolOperations.GetPoolAsync("myPool");
Console.WriteLine("Last execution: " + pool.AutoScaleRun.Timestamp);
Console.WriteLine("Result:" + pool.AutoScaleRun.Results.Replace("$", "\n  $"));
Console.WriteLine("Error: " + pool.AutoScaleRun.Error);
```

<span data-ttu-id="d627a-571">Esempio di output del frammento precedente:</span><span class="sxs-lookup"><span data-stu-id="d627a-571">Sample output of the preceding snippet:</span></span>

```
Last execution: 10/14/2016 18:36:43
Result:
  $TargetDedicatedNodes=10;
  $NodeDeallocationOption=requeue;
  $curTime=2016-10-14T18:36:43.282Z;
  $isWeekday=1;
  $isWorkingWeekdayHour=0;
  $workHours=0
Error:
```

## <a name="example-autoscale-formulas"></a><span data-ttu-id="d627a-572">Formule di scalabilità automatica di esempio</span><span class="sxs-lookup"><span data-stu-id="d627a-572">Example autoscale formulas</span></span>
<span data-ttu-id="d627a-573">Di seguito verranno esaminate alcune formule che mostrano diverse modalità per regolare la quantità di risorse di calcolo in un pool.</span><span class="sxs-lookup"><span data-stu-id="d627a-573">Let's look at a few formulas that show different ways to adjust the amount of compute resources in a pool.</span></span>

### <a name="example-1-time-based-adjustment"></a><span data-ttu-id="d627a-574">Esempio 1: Adeguamento basato sul tempo</span><span class="sxs-lookup"><span data-stu-id="d627a-574">Example 1: Time-based adjustment</span></span>
<span data-ttu-id="d627a-575">Si supponga di volte regolare le dimensioni del pool in base al giorno della settimana e all'ora del giorno.</span><span class="sxs-lookup"><span data-stu-id="d627a-575">Suppose you want to adjust the pool size based on the day of the week and time of day.</span></span> <span data-ttu-id="d627a-576">Questo esempio mostra come aumentare o ridurre il numero di nodi nel pool di conseguenza.</span><span class="sxs-lookup"><span data-stu-id="d627a-576">This example shows how to increase or decrease the number of nodes in the pool accordingly.</span></span>

<span data-ttu-id="d627a-577">La formula ottiene prima di tutto l'ora corrente.</span><span class="sxs-lookup"><span data-stu-id="d627a-577">The formula first obtains the current time.</span></span> <span data-ttu-id="d627a-578">Durante i giorni della settimana, da 1 a 5, e durante l'orario lavorativo, dalle 8.00 alle 18.00, le dimensioni del pool di destinazione sono impostate su 20 nodi.</span><span class="sxs-lookup"><span data-stu-id="d627a-578">If it's a weekday (1-5) and within working hours (8 AM to 6 PM), the target pool size is set to 20 nodes.</span></span> <span data-ttu-id="d627a-579">In caso contrario, vengono impostate su 10 nodi.</span><span class="sxs-lookup"><span data-stu-id="d627a-579">Otherwise, it's set to 10 nodes.</span></span>

```
$curTime = time();
$workHours = $curTime.hour >= 8 && $curTime.hour < 18;
$isWeekday = $curTime.weekday >= 1 && $curTime.weekday <= 5;
$isWorkingWeekdayHour = $workHours && $isWeekday;
$TargetDedicatedNodes = $isWorkingWeekdayHour ? 20:10;
```

### <a name="example-2-task-based-adjustment"></a><span data-ttu-id="d627a-580">Esempio 2: Adeguamento basato sulle attività</span><span class="sxs-lookup"><span data-stu-id="d627a-580">Example 2: Task-based adjustment</span></span>
<span data-ttu-id="d627a-581">In questo esempio le dimensioni del pool vengono regolate in base al numero di attività nella coda.</span><span class="sxs-lookup"><span data-stu-id="d627a-581">In this example, the pool size is adjusted based on the number of tasks in the queue.</span></span> <span data-ttu-id="d627a-582">Sia i commenti che le interruzioni di riga sono accettabili nelle stringhe della formula.</span><span class="sxs-lookup"><span data-stu-id="d627a-582">Both comments and line breaks are acceptable in formula strings.</span></span>

```csharp
// Get pending tasks for the past 15 minutes.
$samples = $ActiveTasks.GetSamplePercent(TimeInterval_Minute * 15);
// If we have fewer than 70 percent data points, we use the last sample point,
// otherwise we use the maximum of last sample point and the history average.
$tasks = $samples < 70 ? max(0,$ActiveTasks.GetSample(1)) : max( $ActiveTasks.GetSample(1), avg($ActiveTasks.GetSample(TimeInterval_Minute * 15)));
// If number of pending tasks is not 0, set targetVM to pending tasks, otherwise
// half of current dedicated.
$targetVMs = $tasks > 0? $tasks:max(0, $TargetDedicatedNodes/2);
// The pool size is capped at 20, if target VM value is more than that, set it
// to 20. This value should be adjusted according to your use case.
$TargetDedicatedNodes = max(0, min($targetVMs, 20));
// Set node deallocation mode - keep nodes active only until tasks finish
$NodeDeallocationOption = taskcompletion;
```

### <a name="example-3-accounting-for-parallel-tasks"></a><span data-ttu-id="d627a-583">Esempio 3: Considerazioni sulle attività parallele</span><span class="sxs-lookup"><span data-stu-id="d627a-583">Example 3: Accounting for parallel tasks</span></span>
<span data-ttu-id="d627a-584">Questo esempio adegua le dimensioni del pool in base al numero di attività.</span><span class="sxs-lookup"><span data-stu-id="d627a-584">This example adjusts the pool size based on the number of tasks.</span></span> <span data-ttu-id="d627a-585">Questa formula considera anche il valore [MaxTasksPerComputeNode][net_maxtasks] impostato per il pool.</span><span class="sxs-lookup"><span data-stu-id="d627a-585">This formula also takes into account the [MaxTasksPerComputeNode][net_maxtasks] value that has been set for the pool.</span></span> <span data-ttu-id="d627a-586">Questo approccio è utile nelle situazioni in cui l'[esecuzione di attività parallele](batch-parallel-node-tasks.md) è abilitata nel pool.</span><span class="sxs-lookup"><span data-stu-id="d627a-586">This approach is useful in situations where [parallel task execution](batch-parallel-node-tasks.md) has been enabled on your pool.</span></span>

```csharp
// Determine whether 70 percent of the samples have been recorded in the past
// 15 minutes; if not, use last sample
$samples = $ActiveTasks.GetSamplePercent(TimeInterval_Minute * 15);
$tasks = $samples < 70 ? max(0,$ActiveTasks.GetSample(1)) : max( $ActiveTasks.GetSample(1),avg($ActiveTasks.GetSample(TimeInterval_Minute * 15)));
// Set the number of nodes to add to one-fourth the number of active tasks (the
// MaxTasksPerComputeNode property on this pool is set to 4, adjust this number
// for your use case)
$cores = $TargetDedicatedNodes * 4;
$extraVMs = (($tasks - $cores) + 3) / 4;
$targetVMs = ($TargetDedicatedNodes + $extraVMs);
// Attempt to grow the number of compute nodes to match the number of active
// tasks, with a maximum of 3
$TargetDedicatedNodes = max(0,min($targetVMs,3));
// Keep the nodes active until the tasks finish
$NodeDeallocationOption = taskcompletion;
```

### <a name="example-4-setting-an-initial-pool-size"></a><span data-ttu-id="d627a-587">Esempio 4: Impostazione di dimensioni iniziali del pool</span><span class="sxs-lookup"><span data-stu-id="d627a-587">Example 4: Setting an initial pool size</span></span>
<span data-ttu-id="d627a-588">Questo esempio mostra un frammento di codice C# con una formula di scalabilità automatica che imposta le dimensioni del pool su un numero specificato di nodi per un periodo di tempo iniziale.</span><span class="sxs-lookup"><span data-stu-id="d627a-588">This example shows a C# code snippet with an autoscale formula that sets the pool size to a specified number of nodes for an initial time period.</span></span> <span data-ttu-id="d627a-589">Adegua quindi le dimensioni del pool in base al numero di attività in esecuzione e attive dopo la scadenza del periodo di tempo iniziale.</span><span class="sxs-lookup"><span data-stu-id="d627a-589">Then it adjusts the pool size based on the number of running and active tasks after the initial time period has elapsed.</span></span>

<span data-ttu-id="d627a-590">La formula nel frammento di codice seguente:</span><span class="sxs-lookup"><span data-stu-id="d627a-590">The formula in the following code snippet:</span></span>

* <span data-ttu-id="d627a-591">Imposta le dimensioni iniziali del pool su 4 nodi.</span><span class="sxs-lookup"><span data-stu-id="d627a-591">Sets the initial pool size to four nodes.</span></span>
* <span data-ttu-id="d627a-592">Non modifica le dimensioni del pool nei primi 10 minuti del relativo ciclo di vita.</span><span class="sxs-lookup"><span data-stu-id="d627a-592">Does not adjust the pool size within the first 10 minutes of the pool's lifecycle.</span></span>
* <span data-ttu-id="d627a-593">Dopo 10 minuti ottiene il valore massimo del numero di attività in esecuzione e attive negli ultimi 60 minuti.</span><span class="sxs-lookup"><span data-stu-id="d627a-593">After 10 minutes, obtains the max value of the number of running and active tasks within the past 60 minutes.</span></span>
  * <span data-ttu-id="d627a-594">Se entrambi i valori corrispondono a 0, ovvero nessuna attività era in esecuzione o attiva negli ultimi 60 minuti, le dimensioni del pool vengono impostate su 0.</span><span class="sxs-lookup"><span data-stu-id="d627a-594">If both values are 0 (indicating that no tasks were running or active in the last 60 minutes), the pool size is set to 0.</span></span>
  * <span data-ttu-id="d627a-595">Se uno dei valori è maggiore di zero, non viene apportata alcuna modifica.</span><span class="sxs-lookup"><span data-stu-id="d627a-595">If either value is greater than zero, no change is made.</span></span>

```csharp
string now = DateTime.UtcNow.ToString("r");
string formula = string.Format(@"
    $TargetDedicatedNodes = {1};
    lifespan         = time() - time(""{0}"");
    span             = TimeInterval_Minute * 60;
    startup          = TimeInterval_Minute * 10;
    ratio            = 50;

    $TargetDedicatedNodes = (lifespan > startup ? (max($RunningTasks.GetSample(span, ratio), $ActiveTasks.GetSample(span, ratio)) == 0 ? 0 : $TargetDedicatedNodes) : {1});
    ", now, 4);
```

## <a name="next-steps"></a><span data-ttu-id="d627a-596">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="d627a-596">Next steps</span></span>
* <span data-ttu-id="d627a-597">[Ottimizzare l'uso delle risorse di calcolo di Azure Batch con attività dei nodi simultanee](batch-parallel-node-tasks.md) contiene informazioni dettagliate su come è possibile eseguire più attività contemporaneamente sui nodi di calcolo nel pool.</span><span class="sxs-lookup"><span data-stu-id="d627a-597">[Maximize Azure Batch compute resource usage with concurrent node tasks](batch-parallel-node-tasks.md) contains details about how you can execute multiple tasks simultaneously on the compute nodes in your pool.</span></span> <span data-ttu-id="d627a-598">Oltre al ridimensionamento automatico, questa funzionalità può contribuire a ridurre la durata del processo per alcuni carichi di lavoro, riducendo i costi.</span><span class="sxs-lookup"><span data-stu-id="d627a-598">In addition to autoscaling, this feature may help to lower job duration for some workloads, saving you money.</span></span>
* <span data-ttu-id="d627a-599">Per ottimizzare ulteriormente l'efficienza, assicurarsi che l'applicazione Batch esegua query sul servizio Batch in modo ottimale.</span><span class="sxs-lookup"><span data-stu-id="d627a-599">For another efficiency booster, ensure that your Batch application queries the Batch service in the most optimal way.</span></span> <span data-ttu-id="d627a-600">Vedere [Eseguire query sul servizio Azure Batch in modo efficiente](batch-efficient-list-queries.md) per informazioni su come limitare la quantità dei dati trasmessi in rete quando si esegue una query sullo stato potenzialmente di migliaia di nodi di calcolo o attività.</span><span class="sxs-lookup"><span data-stu-id="d627a-600">See [Query the Azure Batch service efficiently](batch-efficient-list-queries.md) to learn how to limit the amount of data that crosses the wire when you query the status of potentially thousands of compute nodes or tasks.</span></span>

[net_api]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch
[net_batchclient]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.batchclient
[net_cloudpool_autoscaleformula]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula
[net_cloudpool_autoscaleevalinterval]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval
[net_enableautoscaleasync]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.enableautoscaleasync
[net_maxtasks]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.maxtaskspercomputenode
[net_poolops_resizepoolasync]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.resizepoolasync

[rest_api]: https://docs.microsoft.com/rest/api/batchservice/
[rest_autoscaleformula]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
[rest_autoscaleinterval]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
[rest_enableautoscale]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
