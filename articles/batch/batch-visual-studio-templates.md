---
title: Avviare la creazione di soluzioni Batch con i modelli di progetto di Visual Studio - Azure | Documentazione Microsoft
description: Informazioni su come questi modelli di progetto di Visual Studio consentono di implementare ed eseguire carichi di lavoro a elevato utilizzo di calcolo in Azure Batch.
services: batch
documentationcenter: .net
author: fayora
manager: timlt
editor: 
ms.assetid: 5e041ae2-25af-4882-a79e-3aa63c4bfb20
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 02/27/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: da77ce827c65deb18d9d84ce5cf768d89788e205
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="use-visual-studio-project-templates-to-jump-start-batch-solutions"></a><span data-ttu-id="b2ac6-103">Usare i modelli di progetto di Visual Studio per avviare rapidamente le soluzioni Batch</span><span class="sxs-lookup"><span data-stu-id="b2ac6-103">Use Visual Studio project templates to jump-start Batch solutions</span></span>

<span data-ttu-id="b2ac6-104">I modelli di Visual Studio **Gestore di processi** e **Task Processor** (Elaboratore di attività) per Batch forniscono il codice per implementare ed eseguire i carichi di lavoro a elevato utilizzo di calcolo in Batch con il minimo sforzo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-104">The **Job Manager** and **Task Processor Visual Studio templates** for Batch provide code to help you to implement and run your compute-intensive workloads on Batch with the least amount of effort.</span></span> <span data-ttu-id="b2ac6-105">Questo documento illustra tali modelli e fornisce le linee guida per usarli.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-105">This document describes these templates and provides guidance for how to use them.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b2ac6-106">Questo articolo illustra solo le informazioni applicabili a questi due modelli e presuppone che si abbia familiarità con il servizio Batch e con i concetti chiave correlati: pool, nodi di calcolo, processi e attività, attività del gestore di processi, variabili di ambiente e altre informazioni pertinenti.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-106">This article discusses only information applicable to these two templates, and assumes that you are familiar with the Batch service and key concepts related to it: pools, compute nodes, jobs and tasks, job manager tasks, environment variables, and other relevant information.</span></span> <span data-ttu-id="b2ac6-107">È possibile trovare altre informazioni in [Nozioni di base su Azure Batch](batch-technical-overview.md), [Panoramica delle funzionalità di Batch per sviluppatori](batch-api-basics.md) e [Introduzione alla libreria di Azure Batch per .NET](batch-dotnet-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="b2ac6-107">You can find more information in [Basics of Azure Batch](batch-technical-overview.md), [Batch feature overview for developers](batch-api-basics.md), and [Get started with the Azure Batch library for .NET](batch-dotnet-get-started.md).</span></span>
> 
> 

## <a name="high-level-overview"></a><span data-ttu-id="b2ac6-108">Panoramica generale</span><span class="sxs-lookup"><span data-stu-id="b2ac6-108">High-level overview</span></span>
<span data-ttu-id="b2ac6-109">I modelli Job Manager (Gestore di processi) e Task Processor (Elaboratore di attività) possono essere usati per creare due utili componenti:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-109">The Job Manager and Task Processor templates can be used to create two useful components:</span></span>

* <span data-ttu-id="b2ac6-110">Un'attività del gestore di processi che implementa un componente di suddivisione dei processi per suddividere un processo in più attività eseguibili in modo indipendente e parallelo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-110">A job manager task that implements a job splitter that can break a job down into multiple tasks that can run independently, in parallel.</span></span>
* <span data-ttu-id="b2ac6-111">Un elaboratore di attività che può essere usato per eseguire la pre-elaborazione e la post-elaborazione in una riga di comando dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-111">A task processor that can be used to perform pre-processing and post-processing around an application command line.</span></span>

<span data-ttu-id="b2ac6-112">Ad esempio, in uno scenario di rendering di un filmato, il componente di suddivisione dei processi convertirà un unico processo in centinaia o migliaia di attività distinte che elaboreranno i singoli fotogrammi separatamente.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-112">For example, in a movie rendering scenario, the job splitter would turn a single movie job into hundreds or thousands of separate tasks that would process individual frames separately.</span></span> <span data-ttu-id="b2ac6-113">Di conseguenza, l'elaboratore di attività richiamerà l'applicazione di rendering e tutti i processi dipendenti necessari per eseguire il rendering di ogni fotogramma, oltre che per eseguire eventuali azioni aggiuntive, ad esempio la copia del fotogramma sottoposto a rendering in una posizione di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-113">Correspondingly, the task processor would invoke the rendering application and all dependent processes that are needed to render each frame, as well as perform any additional actions (for example, copying the rendered frame to a storage location).</span></span>

> [!NOTE]
> <span data-ttu-id="b2ac6-114">I modelli Job Manager (Gestore di processi) e Task Processor (Elaboratore di attività) sono indipendenti tra loro e quindi è possibile scegliere di usarli entrambi o solo uno, in base ai requisiti del processo di calcolo e alle preferenze.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-114">The Job Manager and Task Processor templates are independent of each other, so you can choose to use both, or only one of them, depending on the requirements of your compute job and on your preferences.</span></span>
> 
> 

<span data-ttu-id="b2ac6-115">Come illustrato nel diagramma seguente, un processo di calcolo che usa questi modelli prevede tre fasi:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-115">As shown in the diagram below, a compute job that uses these templates will go through three stages:</span></span>

1. <span data-ttu-id="b2ac6-116">Un codice client (ad esempio, un'applicazione, un servizio Web e così via) invia un processo al servizio Batch in Azure, specificando come attività del gestore di processi il programma del gestore di processi.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-116">The client code (e.g., application, web service, etc.) submits a job to the Batch service on Azure, specifying as its job manager task the job manager program.</span></span>
2. <span data-ttu-id="b2ac6-117">Il servizio Batch esegue l'attività del gestore di processi in un nodo di calcolo e il componente di suddivisione dei processi avvia il numero specificato di attività dell'elaboratore di attività, in tutti i nodi di calcolo necessari, in base ai parametri e alle specifiche del codice del componente di suddivisione dei processi.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-117">The Batch service runs the job manager task on a compute node and the job splitter launches the specified number of task processor tasks, on as many compute nodes as required, based on the parameters and specifications in the job splitter code.</span></span>
3. <span data-ttu-id="b2ac6-118">Le attività dell'elaboratore di attività vengono eseguite in modo indipendente, in parallelo, per elaborare i dati di input e generare i dati di output.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-118">The task processor tasks run independently, in parallel, to process the input data and generate the output data.</span></span>

![Diagramma che illustra come il codice client interagisce con il servizio Batch][diagram01]

## <a name="prerequisites"></a><span data-ttu-id="b2ac6-120">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="b2ac6-120">Prerequisites</span></span>
<span data-ttu-id="b2ac6-121">Per usare i modelli di Batch, sarà necessario quanto segue:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-121">To use the Batch templates, you will need the following:</span></span>

* <span data-ttu-id="b2ac6-122">Un computer in cui è installato Visual Studio 2015.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-122">A computer with Visual Studio 2015 installed.</span></span> <span data-ttu-id="b2ac6-123">I modelli di Batch sono attualmente supportati solo per Visual Studio 2015.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-123">Batch templates are currently only supported for Visual Studio 2015.</span></span>
* <span data-ttu-id="b2ac6-124">I modelli di Batch, disponibili in [Visual Studio Gallery][vs_gallery] come estensioni di Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-124">The Batch templates, which are available from the [Visual Studio Gallery][vs_gallery] as Visual Studio extensions.</span></span> <span data-ttu-id="b2ac6-125">È possibile ottenere i modelli in due modi:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-125">There are two ways to get the templates:</span></span>
  
  * <span data-ttu-id="b2ac6-126">Installare i modelli usando la finestra di dialogo **Estensioni e aggiornamenti** in Visual Studio. Per altre informazioni, vedere [Ricerca e uso delle estensioni di Visual Studio][vs_find_use_ext].</span><span class="sxs-lookup"><span data-stu-id="b2ac6-126">Install the templates using the **Extensions and Updates** dialog box in Visual Studio (for more information, see [Finding and Using Visual Studio Extensions][vs_find_use_ext]).</span></span> <span data-ttu-id="b2ac6-127">Nella finestra di dialogo **Estensioni e aggiornamenti** cercare e scaricare le due estensioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-127">In the **Extensions and Updates** dialog box, search and download the following two extensions:</span></span>
    
    * <span data-ttu-id="b2ac6-128">Azure Batch Job Manager with Job Splitter (Gestore di processi di Azure Batch con componente di suddivisione dei processi)</span><span class="sxs-lookup"><span data-stu-id="b2ac6-128">Azure Batch Job Manager with Job Splitter</span></span>
    * <span data-ttu-id="b2ac6-129">Azure Batch Task Processor (Elaboratore di attività di Azure Batch)</span><span class="sxs-lookup"><span data-stu-id="b2ac6-129">Azure Batch Task Processor</span></span>
  * <span data-ttu-id="b2ac6-130">Scaricare i modelli dalla raccolta online per Visual Studio: [Microsoft Azure Batch Project Templates][vs_gallery_templates] (Modelli di progetto di Microsoft Azure Batch).</span><span class="sxs-lookup"><span data-stu-id="b2ac6-130">Download the templates from the online gallery for Visual Studio: [Microsoft Azure Batch Project Templates][vs_gallery_templates]</span></span>
* <span data-ttu-id="b2ac6-131">Se si prevede di usare la funzionalità [Pacchetti dell'applicazione](batch-application-packages.md) per distribuire il gestore di processi e l'elaboratore di attività nei nodi di calcolo di Batch, è necessario collegare un account di archiviazione all'account Batch.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-131">If you plan to use the [Application Packages](batch-application-packages.md) feature to deploy the job manager and task processor to the Batch compute nodes, you need to link a storage account to your Batch account.</span></span>

## <a name="preparation"></a><span data-ttu-id="b2ac6-132">Operazioni preliminari</span><span class="sxs-lookup"><span data-stu-id="b2ac6-132">Preparation</span></span>
<span data-ttu-id="b2ac6-133">Si consiglia di creare una soluzione che possa contenere il gestore di processi oltre all'elaboratore di attività, perché può semplificare la condivisione del codice tra i programmi del gestore di processi e dell'elaboratore di attività.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-133">We recommend creating a solution that can contain your job manager as well as your task processor, because this can make it easier to share code between your job manager and task processor programs.</span></span> <span data-ttu-id="b2ac6-134">Per creare la soluzione, seguire questi passaggi:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-134">To create this solution, follow these steps:</span></span>

1. <span data-ttu-id="b2ac6-135">Aprire Visual Studio e selezionare **File** > **Nuovo** > **Progetto**.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-135">Open Visual Studio and select **File** > **New** > **Project**.</span></span>
2. <span data-ttu-id="b2ac6-136">In **Modelli** espandere **Altri tipi di progetti**, fare clic su **Soluzioni di Visual Studio** e selezionare **Soluzione vuota**.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-136">Under **Templates**, expand **Other Project Types**, click **Visual Studio Solutions**, and then select **Blank Solution**.</span></span>
3. <span data-ttu-id="b2ac6-137">Digitare un nome che descriva l'applicazione e lo scopo di questa soluzione, ad esempio "ProgrammiAttivitàBatchLitware".</span><span class="sxs-lookup"><span data-stu-id="b2ac6-137">Type a name that describes your application and the purpose of this solution (e.g., "LitwareBatchTaskPrograms").</span></span>
4. <span data-ttu-id="b2ac6-138">Per creare la nuova soluzione, fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-138">To create the new solution, click **OK**.</span></span>

## <a name="job-manager-template"></a><span data-ttu-id="b2ac6-139">Modello Job Manager (Gestore di processi)</span><span class="sxs-lookup"><span data-stu-id="b2ac6-139">Job Manager template</span></span>
<span data-ttu-id="b2ac6-140">Il modello Job Manager (Gestore di processi) consente di implementare un'attività del gestore di processi che può eseguire queste azioni:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-140">The Job Manager template helps you to implement a job manager task that can perform the following actions:</span></span>

* <span data-ttu-id="b2ac6-141">Dividere un processo in più attività.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-141">Split a job into multiple tasks.</span></span>
* <span data-ttu-id="b2ac6-142">Inviare tali attività per l'esecuzione in Batch.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-142">Submit those tasks to run on Batch.</span></span>

> [!NOTE]
> <span data-ttu-id="b2ac6-143">Per altre informazioni sulle attività del gestore di processi, vedere [Panoramica delle funzionalità di Batch per sviluppatori](batch-api-basics.md#job-manager-task).</span><span class="sxs-lookup"><span data-stu-id="b2ac6-143">For more information about job manager tasks, see [Batch feature overview for developers](batch-api-basics.md#job-manager-task).</span></span>
> 
> 

### <a name="create-a-job-manager-using-the-template"></a><span data-ttu-id="b2ac6-144">Creare un gestore di processi usando il modello</span><span class="sxs-lookup"><span data-stu-id="b2ac6-144">Create a Job Manager using the template</span></span>
<span data-ttu-id="b2ac6-145">Per aggiungere un gestore di processi alla soluzione creata prima, seguire questi passaggi:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-145">To add a job manager to the solution that you created earlier, follow these steps:</span></span>

1. <span data-ttu-id="b2ac6-146">Aprire la soluzione esistente in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-146">Open your existing solution in Visual Studio.</span></span>
2. <span data-ttu-id="b2ac6-147">In Esplora soluzioni fare clic con il pulsante destro del mouse sulla soluzione e selezionare **Aggiungi** > **Nuovo progetto**.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-147">In Solution Explorer, right-click the solution, click **Add** > **New Project**.</span></span>
3. <span data-ttu-id="b2ac6-148">In **Visual C#** fare clic su **Cloud** e su **Azure Batch Job Manager with Job Splitter** (Gestore di processi di Azure Batch con componente di suddivisione dei processi).</span><span class="sxs-lookup"><span data-stu-id="b2ac6-148">Under **Visual C#**, click **Cloud**, and then click **Azure Batch Job Manager with Job Splitter**.</span></span>
4. <span data-ttu-id="b2ac6-149">Digitare un nome che descriva l'applicazione e identifichi questo progetto come gestore di processi, ad esempio "GestoreProcessiLitware".</span><span class="sxs-lookup"><span data-stu-id="b2ac6-149">Type a name that describes your application and identifies this project as the job manager (e.g. "LitwareJobManager").</span></span>
5. <span data-ttu-id="b2ac6-150">Per creare il progetto, fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-150">To create the project, click **OK**.</span></span>
6. <span data-ttu-id="b2ac6-151">Compilare infine il progetto per fare in modo che Visual Studio carichi tutti i pacchetti NuGet di riferimento e verificare che il progetto sia valido prima di iniziare a modificarlo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-151">Finally, build the project to force Visual Studio to load all referenced NuGet packages and to verify that the project is valid before you start modifying it.</span></span>

### <a name="job-manager-template-files-and-their-purpose"></a><span data-ttu-id="b2ac6-152">File del modello Job Manager (Gestore di processi) e relativo scopo</span><span class="sxs-lookup"><span data-stu-id="b2ac6-152">Job Manager template files and their purpose</span></span>
<span data-ttu-id="b2ac6-153">Quando si crea un progetto usando il modello Job Manager (Gestore di processi), questo genera tre gruppi di file di codice:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-153">When you create a project using the Job Manager template, it generates three groups of code files:</span></span>

* <span data-ttu-id="b2ac6-154">Il file di programma principale (Program.cs),</span><span class="sxs-lookup"><span data-stu-id="b2ac6-154">The main program file (Program.cs).</span></span> <span data-ttu-id="b2ac6-155">che contiene il punto di ingresso del programma e la gestione delle eccezioni di primo livello.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-155">This contains the program entry point and top-level exception handling.</span></span> <span data-ttu-id="b2ac6-156">In genere non è necessario modificarlo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-156">You shouldn't normally need to modify this.</span></span>
* <span data-ttu-id="b2ac6-157">La directory Framework,</span><span class="sxs-lookup"><span data-stu-id="b2ac6-157">The Framework directory.</span></span> <span data-ttu-id="b2ac6-158">che contiene i file responsabili delle operazioni del "boilerplate" eseguite dal programma del gestore di processi, ad esempio decompressione dei parametri, aggiunta di attività al processo batch e così via. In genere non è necessario modificare questi file.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-158">This contains the files responsible for the 'boilerplate' work done by the job manager program – unpacking parameters, adding tasks to the Batch job, etc. You shouldn't normally need to modify these files.</span></span>
* <span data-ttu-id="b2ac6-159">Il file del componente di suddivisione dei processi (JobSplitter.cs),</span><span class="sxs-lookup"><span data-stu-id="b2ac6-159">The job splitter file (JobSplitter.cs).</span></span> <span data-ttu-id="b2ac6-160">in cui si inserirà la logica specifica dell'applicazione per suddividere un processo in attività.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-160">This is where you will put your application-specific logic for splitting a job into tasks.</span></span>

<span data-ttu-id="b2ac6-161">Ovviamente è possibile aggiungere altri file, se necessari per supportare il codice del componente di suddivisione dei processi, in base alla complessità della logica di suddivisione dei processi.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-161">Of course you can add additional files as required to support your job splitter code, depending on the complexity of the job splitting logic.</span></span>

<span data-ttu-id="b2ac6-162">Il modello genera anche i file di progetto .NET standard, ad esempio un file CSPROJ, app.config, packages.config e così via.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-162">The template also generates standard .NET project files such as a .csproj file, app.config, packages.config, etc.</span></span>

<span data-ttu-id="b2ac6-163">La parte restante di questa sezione illustra i diversi file e la struttura del codice e spiega la funzione di ogni classe.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-163">The rest of this section describes the different files and their code structure, and explains what each class does.</span></span>

![Esplora soluzioni di Visual Studio che illustra la soluzione del modello Job Manager (Gestore di processi)][solution_explorer01]

<span data-ttu-id="b2ac6-165">**File di Framework**</span><span class="sxs-lookup"><span data-stu-id="b2ac6-165">**Framework files**</span></span>

* <span data-ttu-id="b2ac6-166">`Configuration.cs`: incapsula il caricamento dei dati di configurazione del processo, ad esempio i dettagli dell'account Batch, le credenziali dell'account di archiviazione collegato, le informazioni sul processo e sulle attività e i parametri del processo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-166">`Configuration.cs`: Encapsulates the loading of job configuration data such as Batch account details, linked storage account credentials, job and task information, and job parameters.</span></span> <span data-ttu-id="b2ac6-167">Fornisce anche l'accesso alle variabili di ambiente definite da Batch (vedere Impostazioni di ambiente per le attività nella documentazione di Batch) tramite la classe Configuration.EnvironmentVariable.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-167">It also provides access to Batch-defined environment variables (see Environment settings for tasks, in the Batch documentation) via the Configuration.EnvironmentVariable class.</span></span>
* <span data-ttu-id="b2ac6-168">`IConfiguration.cs`: astrae l'implementazione della classe Configuration, per poter eseguire uno unit test del componente di suddivisione dei processi usando un oggetto di configurazione falso o fittizio.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-168">`IConfiguration.cs`: Abstracts the implementation of the Configuration class, so that you can unit test your job splitter using a fake or mock configuration object.</span></span>
* <span data-ttu-id="b2ac6-169">`JobManager.cs`: orchestra i componenti del programma del gestore di processi.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-169">`JobManager.cs`: Orchestrates the components of the job manager program.</span></span> <span data-ttu-id="b2ac6-170">È responsabile dell'inizializzazione e della chiamata del componente di suddivisione dei processi e dell'invio delle attività restituite dal componente di suddivisione dei processi al mittente delle attività.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-170">It is responsible for the initializing the job splitter, invoking the job splitter, and dispatching the tasks returned by the job splitter to the task submitter.</span></span>
* <span data-ttu-id="b2ac6-171">`JobManagerException.cs`: rappresenta un errore che obbliga a terminare il gestore di processi.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-171">`JobManagerException.cs`: Represents an error that requires the job manager to terminate.</span></span> <span data-ttu-id="b2ac6-172">JobManagerException viene usata per eseguire il wrapping degli errori "previsti" dove possono essere fornite informazioni di diagnostica specifiche nell'ambito della terminazione.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-172">JobManagerException is used to wrap 'expected' errors where specific diagnostic information can be provided as part of termination.</span></span>
* <span data-ttu-id="b2ac6-173">`TaskSubmitter.cs`: questa classe è responsabile dell'aggiunta delle attività restituite dal componente di suddivisione dei processi al processo batch.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-173">`TaskSubmitter.cs`: This class is responsible to adding tasks returned by the job splitter to the Batch job.</span></span> <span data-ttu-id="b2ac6-174">La classe JobManager aggrega la sequenza di attività in batch per un'aggiunta efficiente, ma tempestiva, al processo, quindi chiama TaskSubmitter.SubmitTasks in un thread in background per ogni batch.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-174">The JobManager class aggregates the sequence of tasks into batches for efficient but timely addition to the job, then calls TaskSubmitter.SubmitTasks on a background thread for each batch.</span></span>

<span data-ttu-id="b2ac6-175">**Componente di suddivisione dei processi**</span><span class="sxs-lookup"><span data-stu-id="b2ac6-175">**Job Splitter**</span></span>

<span data-ttu-id="b2ac6-176">`JobSplitter.cs`: questa classe contiene la logica specifica dell'applicazione per la suddivisione del processo in attività.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-176">`JobSplitter.cs`: This class contains application-specific logic for splitting the job into tasks.</span></span> <span data-ttu-id="b2ac6-177">Il framework richiama il metodo JobSplitter.Split per ottenere una sequenza di attività che aggiunge al processo quando il metodo le restituisce.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-177">The framework invokes the JobSplitter.Split method to obtain a sequence of tasks, which it adds to the job as the method returns them.</span></span> <span data-ttu-id="b2ac6-178">Questa è la classe in cui si inserirà la logica del processo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-178">This is the class where you will inject the logic of your job.</span></span> <span data-ttu-id="b2ac6-179">Implementare il metodo Split per restituire una sequenza di istanze di CloudTask che rappresentano le attività in cui si vuole partizionare il processo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-179">Implement the Split method to return a sequence of CloudTask instances representing the tasks into which you want to partition the job.</span></span>

<span data-ttu-id="b2ac6-180">**File di progetto della riga di comando .NET standard**</span><span class="sxs-lookup"><span data-stu-id="b2ac6-180">**Standard .NET command line project files**</span></span>

* <span data-ttu-id="b2ac6-181">`App.config`: file di configurazione dell'applicazione .NET standard.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-181">`App.config`: Standard .NET application configuration file.</span></span>
* <span data-ttu-id="b2ac6-182">`Packages.config`: file di dipendenza del pacchetto NuGet standard.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-182">`Packages.config`: Standard NuGet package dependency file.</span></span>
* <span data-ttu-id="b2ac6-183">`Program.cs`: contiene il punto di ingresso del programma e la gestione delle eccezioni di primo livello.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-183">`Program.cs`: Contains the program entry point and top-level exception handling.</span></span>

### <a name="implementing-the-job-splitter"></a><span data-ttu-id="b2ac6-184">Implementazione del componente di suddivisione dei processi</span><span class="sxs-lookup"><span data-stu-id="b2ac6-184">Implementing the job splitter</span></span>
<span data-ttu-id="b2ac6-185">Quando si apre il progetto del modello Job Manager (Gestore di processi), il progetto avrà il file JobSplitter.cs aperto per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-185">When you open the Job Manager template project, the project will have the JobSplitter.cs file open by default.</span></span> <span data-ttu-id="b2ac6-186">È possibile implementare la logica di suddivisione per le attività del carico di lavoro usando il metodo Split() illustrato sotto:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-186">You can implement the split logic for the tasks in your workload by using the Split() method show below:</span></span>

```csharp
/// <summary>
/// Gets the tasks into which to split the job. This is where you inject
/// your application-specific logic for decomposing the job into tasks.
///
/// The job manager framework invokes the Split method for you; you need
/// only to implement it, not to call it yourself. Typically, your
/// implementation should return tasks lazily, for example using a C#
/// iterator and the "yield return" statement; this allows tasks to be added
/// and to start running while splitting is still in progress.
/// </summary>
/// <returns>The tasks to be added to the job. Tasks are added automatically
/// by the job manager framework as they are returned by this method.</returns>
public IEnumerable<CloudTask> Split()
{
    // Your code for the split logic goes here.
    int startFrame = Convert.ToInt32(_parameters["StartFrame"]);
    int endFrame = Convert.ToInt32(_parameters["EndFrame"]);

    for (int i = startFrame; i <= endFrame; i++)
    {
        yield return new CloudTask("myTask" + i, "cmd /c dir");
    }
}
```

> [!NOTE]
> <span data-ttu-id="b2ac6-187">La sezione con annotazioni nel metodo `Split()` è la sola del codice del modello Job Manager (Gestore di processi) che può essere modificata dall'utente aggiungendo la logica per suddividere i processi in attività diverse.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-187">The annotated section in the `Split()` method is the only section of the Job Manager template code that is intended for you to modify by adding the logic to split your jobs into different tasks.</span></span> <span data-ttu-id="b2ac6-188">Per modificare un'altra sezione del modello, assicurarsi di avere familiarità con il funzionamento di Batch e provare a usare alcuni [esempi di codice di Batch][github_samples].</span><span class="sxs-lookup"><span data-stu-id="b2ac6-188">If you want to modify a different section of the template, please ensure you are familiarized with how Batch works, and try out a few of the [Batch code samples][github_samples].</span></span>
> 
> 

<span data-ttu-id="b2ac6-189">L'implementazione di Split() ha accesso a:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-189">Your Split() implementation has access to:</span></span>

* <span data-ttu-id="b2ac6-190">Parametri del processo, tramite il campo `_parameters` .</span><span class="sxs-lookup"><span data-stu-id="b2ac6-190">The job parameters, via the `_parameters` field.</span></span>
* <span data-ttu-id="b2ac6-191">Oggetto CloudJob che rappresenta il processo, tramite il campo `_job` .</span><span class="sxs-lookup"><span data-stu-id="b2ac6-191">The CloudJob object representing the job, via the `_job` field.</span></span>
* <span data-ttu-id="b2ac6-192">Oggetto CloudTask che rappresenta l'attività del gestore di processi, tramite il campo `_jobManagerTask` .</span><span class="sxs-lookup"><span data-stu-id="b2ac6-192">The CloudTask object representing the job manager task, via the `_jobManagerTask` field.</span></span>

<span data-ttu-id="b2ac6-193">L'implementazione di `Split()` non richiede di aggiungere le attività direttamente al processo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-193">Your `Split()` implementation does not need to add tasks to the job directly.</span></span> <span data-ttu-id="b2ac6-194">Il codice deve invece restituire una sequenza di oggetti CloudTask che verranno aggiunti automaticamente al processo dalle classi del framework che richiamano il componente di suddivisione dei processi.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-194">Instead, your code should return a sequence of CloudTask objects, and these will be added to the job automatically by the framework classes that invoke the job splitter.</span></span> <span data-ttu-id="b2ac6-195">Di solito si usa la funzionalità dell'iteratore di C# (`yield return`) per implementare i componenti di suddivisione dei processi per poter iniziare a eseguire le attività il prima possibile invece di attendere che tutte le attività vengano calcolate.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-195">It's common to use C#'s iterator (`yield return`) feature to implement job splitters as this allows the tasks to start running as soon as possible rather than waiting for all tasks to be calculated.</span></span>

<span data-ttu-id="b2ac6-196">**Errore del componente di suddivisione dei processi**</span><span class="sxs-lookup"><span data-stu-id="b2ac6-196">**Job splitter failure**</span></span>

<span data-ttu-id="b2ac6-197">Se il componente di suddivisione dei processi rileva un errore, deve eseguire una di queste due operazioni:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-197">If your job splitter encounters an error, it should either:</span></span>

* <span data-ttu-id="b2ac6-198">Terminare la sequenza usando l'istruzione `yield break` C#, nel qual caso il gestore di processi verrà considerato correttamente eseguito.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-198">Terminate the sequence using the C# `yield break` statement, in which case the job manager will be treated as successful; or</span></span>
* <span data-ttu-id="b2ac6-199">Generare un'eccezione, nel qual caso il gestore di processi verrà considerato non correttamente eseguito e si potrà riprovare a eseguirlo a seconda di come è stato configurato dal client.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-199">Throw an exception, in which case the job manager will be treated as failed and may be retried depending on how the client has configured it).</span></span>

<span data-ttu-id="b2ac6-200">In entrambi i casi, le attività già restituite dal componente di suddivisione dei processi e aggiunte al processo batch potranno essere eseguite.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-200">In both cases, any tasks already returned by the job splitter and added to the Batch job will be eligible to run.</span></span> <span data-ttu-id="b2ac6-201">Per evitare che questo accada, è possibile:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-201">If you don't want this to happen, then you could:</span></span>

* <span data-ttu-id="b2ac6-202">Terminare il processo prima della restituzione dal componente di suddivisione dei processi</span><span class="sxs-lookup"><span data-stu-id="b2ac6-202">Terminate the job before returning from the job splitter</span></span>
* <span data-ttu-id="b2ac6-203">Fomulare l'intera raccolta di attività prima di restituirla, ovvero restituire `ICollection<CloudTask>` o `IList<CloudTask>` instead of implementing your job splitter using a C# iterato)</span><span class="sxs-lookup"><span data-stu-id="b2ac6-203">Formulate the entire task collection before returning it (that is, return an `ICollection<CloudTask>` or `IList<CloudTask>` instead of implementing your job splitter using a C# iterator)</span></span>
* <span data-ttu-id="b2ac6-204">Usare le relazioni tra attività per fare in modo che tutte le attività dipendano dal corretto completamento del gestore di processi</span><span class="sxs-lookup"><span data-stu-id="b2ac6-204">Use task dependencies to make all tasks depend on the successful completion of the job manager</span></span>

<span data-ttu-id="b2ac6-205">**Tentativi del gestore di processi**</span><span class="sxs-lookup"><span data-stu-id="b2ac6-205">**Job manager retries**</span></span>

<span data-ttu-id="b2ac6-206">Se il gestore di processi non riesce, è possibile riprovare con il servizio Batch in base alle impostazioni dei tentativi del client.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-206">If the job manager fails, it may be retried by the Batch service depending on the client retry settings.</span></span> <span data-ttu-id="b2ac6-207">Questo in genere è sicuro perché, quando il framework aggiunge le attività al processo, ignora quelle già esistenti.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-207">In general, this is safe, because when the framework adds tasks to the job, it ignores any tasks that already exist.</span></span> <span data-ttu-id="b2ac6-208">Se tuttavia il calcolo delle attività è costoso, è possibile che non si voglia sostenere i costi necessari per ricalcolare le attività già aggiunte al processo. Al contrario, se non esiste garanzia che la nuova esecuzione generi gli stessi ID attività, il comportamento che prevede di ignorare i duplicati non verrà applicato.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-208">However, if calculating tasks is expensive, you may not wish to incur the cost of recalculating tasks that have already been added to the job; conversely, if the re-run is not guaranteed to generate the same task IDs then the 'ignore duplicates' behavior will not kick in.</span></span> <span data-ttu-id="b2ac6-209">In questi casi è consigliabile progettare il componente di suddivisione dei processi per rilevare le operazioni già eseguite e non ripeterle, ad esempio eseguendo CloudJob.ListTasks prima di iniziare a restituire le attività.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-209">In these cases you should design your job splitter to detect the work that has already been done and not repeat it, for example by performing a CloudJob.ListTasks before starting to yield tasks.</span></span>

### <a name="exit-codes-and-exceptions-in-the-job-manager-template"></a><span data-ttu-id="b2ac6-210">Codici di uscita ed eccezioni nel modello Job Manager (Gestione di processi)</span><span class="sxs-lookup"><span data-stu-id="b2ac6-210">Exit codes and exceptions in the Job Manager template</span></span>
<span data-ttu-id="b2ac6-211">I codici di uscita e le eccezioni forniscono un meccanismo per determinare il risultato dell'esecuzione di un programma e consentono di identificare eventuali problemi di esecuzione del programma.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-211">Exit codes and exceptions provide a mechanism to determine the outcome of running a program, and they can help to identify any problems with the execution of the program.</span></span> <span data-ttu-id="b2ac6-212">Il modello Job Manager (Gestore di processi) implementa i codici di uscita e le eccezioni descritte in questa sezione.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-212">The Job Manager template implements the exit codes and exceptions described in this section.</span></span>

<span data-ttu-id="b2ac6-213">Un'attività del gestore di processi implementata con il modello Job Manager (Gestore di processi) può restituire tre possibili codici di uscita:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-213">A job manager task that is implemented with the Job Manager template can return three possible exit codes:</span></span>

| <span data-ttu-id="b2ac6-214">Codice</span><span class="sxs-lookup"><span data-stu-id="b2ac6-214">Code</span></span> | <span data-ttu-id="b2ac6-215">Descrizione</span><span class="sxs-lookup"><span data-stu-id="b2ac6-215">Description</span></span> |
| --- | --- |
| <span data-ttu-id="b2ac6-216">0</span><span class="sxs-lookup"><span data-stu-id="b2ac6-216">0</span></span> |<span data-ttu-id="b2ac6-217">Il gestore di processi è stato completato.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-217">The job manager completed successfully.</span></span> <span data-ttu-id="b2ac6-218">Il codice del componente di suddivisione dei processi è stato eseguito fino al completamento e tutte le attività sono state aggiunte al processo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-218">Your job splitter code ran to completion, and all tasks were added to the job.</span></span> |
| <span data-ttu-id="b2ac6-219">1</span><span class="sxs-lookup"><span data-stu-id="b2ac6-219">1</span></span> |<span data-ttu-id="b2ac6-220">L'attività del gestore di processi non è riuscita con un'eccezione in una parte "prevista" del programma.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-220">The job manager task failed with an exception in an 'expected' part of the program.</span></span> <span data-ttu-id="b2ac6-221">L'eccezione è stata convertita in JobManagerException con informazioni di diagnostica e, dove possibile, suggerimenti per la risoluzione dell'errore.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-221">The exception was translated to a JobManagerException with diagnostic information and, where possible, suggestions for resolving the failure.</span></span> |
| <span data-ttu-id="b2ac6-222">2</span><span class="sxs-lookup"><span data-stu-id="b2ac6-222">2</span></span> |<span data-ttu-id="b2ac6-223">L'attività del gestore di processi non è riuscita con un'eccezione "non prevista".</span><span class="sxs-lookup"><span data-stu-id="b2ac6-223">The job manager task failed with an 'unexpected' exception.</span></span> <span data-ttu-id="b2ac6-224">L'eccezione è stata registrata nell'output standard, ma il gestore di processi non è riuscito ad aggiungere altre informazioni di diagnostica o correzione.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-224">The exception was logged to standard output, but the job manager was unable to add any additional diagnostic or remediation information.</span></span> |

<span data-ttu-id="b2ac6-225">In caso di errore dell'attività del gestore di processi, alcune attività potrebbero essere state ugualmente aggiunte al servizio prima che si verificasse l'errore.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-225">In the case of job manager task failure, some tasks may still have been added to the service before the error occurred.</span></span> <span data-ttu-id="b2ac6-226">Queste attività verranno eseguite normalmente.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-226">These tasks will run as normal.</span></span> <span data-ttu-id="b2ac6-227">Per informazioni su questo percorso del codice, vedere sopra "Errore del componente di suddivisione dei processi".</span><span class="sxs-lookup"><span data-stu-id="b2ac6-227">See "Job Splitter Failure" above for discussion of this code path.</span></span>

<span data-ttu-id="b2ac6-228">Tutte le informazioni restituite dalle eccezioni vengono scritte nei file stdout.txt e stderr.txt.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-228">All the information returned by exceptions is written into stdout.txt and stderr.txt files.</span></span> <span data-ttu-id="b2ac6-229">Per altre informazioni, vedere [Gestione degli errori](batch-api-basics.md#error-handling).</span><span class="sxs-lookup"><span data-stu-id="b2ac6-229">For more information, see [Error Handling](batch-api-basics.md#error-handling).</span></span>

### <a name="client-considerations"></a><span data-ttu-id="b2ac6-230">Considerazioni sul client</span><span class="sxs-lookup"><span data-stu-id="b2ac6-230">Client considerations</span></span>
<span data-ttu-id="b2ac6-231">Questa sezione illustra alcuni requisiti dell'implementazione client quando si richiama un gestore di processi basato su questo modello.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-231">This section describes some client implementation requirements when invoking a job manager based on this template.</span></span> <span data-ttu-id="b2ac6-232">Per informazioni dettagliate sul passaggio dei parametri e delle impostazioni di ambiente, vedere [Passare i parametri e le variabili di ambiente dal codice client](#pass-environment-settings) .</span><span class="sxs-lookup"><span data-stu-id="b2ac6-232">See [How to pass parameters and environment variables from the client code](#pass-environment-settings) for details on passing parameters and environment settings.</span></span>

<span data-ttu-id="b2ac6-233">**Credenziali obbligatorie**</span><span class="sxs-lookup"><span data-stu-id="b2ac6-233">**Mandatory credentials**</span></span>

<span data-ttu-id="b2ac6-234">Per aggiungere attività al processo di Azure Batch, l'attività del gestore di processi richiede l'URL e la chiave dell'account Azure Batch.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-234">In order to add tasks to the Azure Batch job, the job manager task requires your Azure Batch account URL and key.</span></span> <span data-ttu-id="b2ac6-235">È necessario passarli nelle variabili di ambiente denominate YOUR_BATCH_URL e YOUR_BATCH_KEY.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-235">You must pass these in environment variables named YOUR_BATCH_URL and YOUR_BATCH_KEY.</span></span> <span data-ttu-id="b2ac6-236">È possibile impostarle nelle impostazioni di ambiente dell'attività del gestore di processi.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-236">You can set these in the Job Manager task environment settings.</span></span> <span data-ttu-id="b2ac6-237">Ad esempio, in un client C#:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-237">For example, in a C# client:</span></span>

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    new EnvironmentSetting("YOUR_BATCH_URL", "https://account.region.batch.azure.com"),
    new EnvironmentSetting("YOUR_BATCH_KEY", "{your_base64_encoded_account_key}"),
};
```
<span data-ttu-id="b2ac6-238">**Credenziali di archiviazione**</span><span class="sxs-lookup"><span data-stu-id="b2ac6-238">**Storage credentials**</span></span>

<span data-ttu-id="b2ac6-239">In genere, non è necessario che il client fornisca all'attività del gestore di processi le credenziali dell'account di archiviazione collegato perché (a) la maggior parte dei gestori di processi non deve accedere in modo esplicito all'account di archiviazione collegato e (b) l'account di archiviazione collegato viene spesso fornito a tutte le attività come impostazione di ambiente comune per il processo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-239">Typically, the client does not need to provide the linked storage account credentials to the job manager task because (a) most job managers do not need to explicitly access the linked storage account and (b) the linked storage account is often provided to all tasks as a common environment setting for the job.</span></span> <span data-ttu-id="b2ac6-240">Se non si specifica l'account di archiviazione collegato tramite le impostazioni di ambiente comuni e il gestore di processi deve accedere alla risorsa di archiviazione collegata, è consigliabile fornire le credenziali di archiviazione collegate, come segue:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-240">If you are not providing the linked storage account via the common environment settings, and the job manager requires access to linked storage, then you should supply the linked storage credentials as follows:</span></span>

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    /* other environment settings */
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

<span data-ttu-id="b2ac6-241">**Impostazioni dell'attività del gestore di processi**</span><span class="sxs-lookup"><span data-stu-id="b2ac6-241">**Job manager task settings**</span></span>

<span data-ttu-id="b2ac6-242">Il client deve impostare il flag *killJobOnCompletion* del gestore di processi su **false**.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-242">The client should set the job manager *killJobOnCompletion* flag to **false**.</span></span>

<span data-ttu-id="b2ac6-243">In genere per il client è sicuro impostare *runExclusive* su **false**.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-243">It is usually safe for the client to set *runExclusive* to **false**.</span></span>

<span data-ttu-id="b2ac6-244">Il client deve usare la raccolta *resourceFiles* o *applicationPackageReferences* per distribuire l'eseguibile del gestore di processi (e le DLL necessarie) nel nodo di calcolo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-244">The client should use the *resourceFiles* or *applicationPackageReferences* collection to have the job manager executable (and its required DLLs) deployed to the compute node.</span></span>

<span data-ttu-id="b2ac6-245">Per impostazione predefinita, l'esecuzione del gestore di processi non verrà riprovata in caso di errore.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-245">By default, the job manager will not be retried if it fails.</span></span> <span data-ttu-id="b2ac6-246">A seconda della logica del gestore di processi, il client può consentire i tentativi tramite *constraints*/*maxTaskRetryCount*.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-246">Depending on your job manager logic, the client may want to enable retries via *constraints*/*maxTaskRetryCount*.</span></span>

<span data-ttu-id="b2ac6-247">**Impostazioni del processo**</span><span class="sxs-lookup"><span data-stu-id="b2ac6-247">**Job settings**</span></span>

<span data-ttu-id="b2ac6-248">Se il componente di suddivisione dei processi crea attività con dipendenze, il client deve impostare usesTaskDependencies del processo su true.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-248">If the job splitter emits tasks with dependencies, the client must set the job's usesTaskDependencies to true.</span></span>

<span data-ttu-id="b2ac6-249">Nel modello del componente di suddivisione dei processi in genere i client non aggiungono attività ai processi oltre a quelle create dal componente di suddivisione dei processi.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-249">In the job splitter model, it is unusual for clients to wish to add tasks to jobs over and above what the job splitter creates.</span></span> <span data-ttu-id="b2ac6-250">In genere il client deve quindi impostare *onAllTasksComplete* del processo su **terminatejob**.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-250">The client should therefore normally set the job's *onAllTasksComplete* to **terminatejob**.</span></span>

## <a name="task-processor-template"></a><span data-ttu-id="b2ac6-251">Modello Task Processor (Elaboratore di attività)</span><span class="sxs-lookup"><span data-stu-id="b2ac6-251">Task Processor template</span></span>
<span data-ttu-id="b2ac6-252">Un modello Task Processor (Elaboratore di attività) consente di implementare un elaboratore di attività che può eseguire queste azioni:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-252">A Task Processor template helps you to implement a task processor that can perform the following actions:</span></span>

* <span data-ttu-id="b2ac6-253">Configurare le informazioni necessarie per l'esecuzione di ogni attività batch.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-253">Set up the information required by each Batch task to run.</span></span>
* <span data-ttu-id="b2ac6-254">Eseguire tutte le azioni necessarie per ogni attività batch.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-254">Run all actions required by each Batch task.</span></span>
* <span data-ttu-id="b2ac6-255">Salvare l'output di un'attività in una risorsa di archiviazione permanente.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-255">Save task outputs to persistent storage.</span></span>

<span data-ttu-id="b2ac6-256">Anche se non è necessario un elaboratore di attività per eseguire le attività in Batch, il vantaggio principale di usare un elaboratore di attività è che fornisce un wrapper per implementare tutte le azioni di esecuzione di un'attività in un'unica posizione,</span><span class="sxs-lookup"><span data-stu-id="b2ac6-256">Although a task processor is not required to run tasks on Batch, the key advantage of using a task processor is that it provides a wrapper to implement all task execution actions in one location.</span></span> <span data-ttu-id="b2ac6-257">ad esempio, se è necessario eseguire più applicazioni nel contesto di ogni attività o se è necessario copiare i dati in una risorsa di archiviazione permanente dopo avere completato ogni attività.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-257">For example, if you need to run several applications in the context of each task, or if you need to copy data to persistent storage after completing each task.</span></span>

<span data-ttu-id="b2ac6-258">Le azioni eseguite dall'elaboratore di attività possono essere semplici o complesse e più o meno numerose a seconda del carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-258">The actions performed by the task processor can be as simple or complex, and as many or as few, as required by your workload.</span></span> <span data-ttu-id="b2ac6-259">Implementando tutte le azioni di un'attività in un unico elaboratore di attività, è anche possibile aggiornare o aggiungere facilmente azioni in base alle modifiche apportate alle applicazioni o ai requisiti del carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-259">Additionally, by implementing all task actions into one task processor, you can readily update or add actions based on changes to applications or workload requirements.</span></span> <span data-ttu-id="b2ac6-260">In alcuni casi, tuttavia, è meglio non usare un elaboratore di attività per l'implementazione perché può creare inutili difficoltà, ad esempio quando si eseguono processi che possono essere avviati rapidamente da una semplice riga di comando.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-260">However, in some cases a task processor might not be the optimal solution for your implementation as it can add unnecessary complexity, for example when running jobs that can be quickly started from a simple command line.</span></span>

### <a name="create-a-task-processor-using-the-template"></a><span data-ttu-id="b2ac6-261">Creare un elaboratore delle attività usando il modello</span><span class="sxs-lookup"><span data-stu-id="b2ac6-261">Create a Task Processor using the template</span></span>
<span data-ttu-id="b2ac6-262">Per aggiungere un elaboratore di attività alla soluzione creata prima, seguire questi passaggi:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-262">To add a task processor to the solution that you created earlier, follow these steps:</span></span>

1. <span data-ttu-id="b2ac6-263">Aprire la soluzione esistente in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-263">Open your existing solution in Visual Studio.</span></span>
2. <span data-ttu-id="b2ac6-264">In Esplora soluzioni fare clic con il pulsante destro del mouse sulla soluzione scegliere **Aggiungi**, quindi fare clic su **Nuovo progetto**.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-264">In Solution Explorer, right-click the solution, click **Add**, and then click **New Project**.</span></span>
3. <span data-ttu-id="b2ac6-265">In **Visual C#** fare clic su **Cloud** e su **Azure Batch Task Processor** (Elaboratore di attività di Azure Batch).</span><span class="sxs-lookup"><span data-stu-id="b2ac6-265">Under **Visual C#**, click **Cloud**, and then click **Azure Batch Task Processor**.</span></span>
4. <span data-ttu-id="b2ac6-266">Digitare un nome che descriva l'applicazione e identifichi questo progetto come elaboratore di attività, ad esempio "ElaboratoreAttivitàLitware".</span><span class="sxs-lookup"><span data-stu-id="b2ac6-266">Type a name that describes your application and identifies this project as the task processor (e.g. "LitwareTaskProcessor").</span></span>
5. <span data-ttu-id="b2ac6-267">Per creare il progetto, fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-267">To create the project, click **OK**.</span></span>
6. <span data-ttu-id="b2ac6-268">Compilare infine il progetto per fare in modo che Visual Studio carichi tutti i pacchetti NuGet di riferimento e verificare che il progetto sia valido prima di iniziare a modificarlo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-268">Finally, build the project to force Visual Studio to load all referenced NuGet packages and to verify that the project is valid before you start modifying it.</span></span>

### <a name="task-processor-template-files-and-their-purpose"></a><span data-ttu-id="b2ac6-269">File del modello Task Processor (Elaboratore di attività) e relativo scopo</span><span class="sxs-lookup"><span data-stu-id="b2ac6-269">Task Processor template files and their purpose</span></span>
<span data-ttu-id="b2ac6-270">Quando si crea un progetto usando il modello di elaboratore di attività, questo genera tre gruppi di file di codice:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-270">When you create a project using the task processor template, it generates three groups of code files:</span></span>

* <span data-ttu-id="b2ac6-271">Il file di programma principale (Program.cs),</span><span class="sxs-lookup"><span data-stu-id="b2ac6-271">The main program file (Program.cs).</span></span> <span data-ttu-id="b2ac6-272">che contiene il punto di ingresso del programma e la gestione delle eccezioni di primo livello.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-272">This contains the program entry point and top-level exception handling.</span></span> <span data-ttu-id="b2ac6-273">In genere non è necessario modificarlo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-273">You shouldn't normally need to modify this.</span></span>
* <span data-ttu-id="b2ac6-274">La directory Framework,</span><span class="sxs-lookup"><span data-stu-id="b2ac6-274">The Framework directory.</span></span> <span data-ttu-id="b2ac6-275">che contiene i file responsabili delle operazioni del "boilerplate" eseguite dal programma del gestore di processi, ad esempio decompressione dei parametri, aggiunta di attività al processo batch e così via. In genere non è necessario modificare questi file.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-275">This contains the files responsible for the 'boilerplate' work done by the job manager program – unpacking parameters, adding tasks to the Batch job, etc. You shouldn't normally need to modify these files.</span></span>
* <span data-ttu-id="b2ac6-276">Il file dell'elaboratore di attività (TaskProcessor.cs),</span><span class="sxs-lookup"><span data-stu-id="b2ac6-276">The task processor file (TaskProcessor.cs).</span></span> <span data-ttu-id="b2ac6-277">in cui si inserirà la logica specifica dell'applicazione per l'esecuzione di un'attività, in genere chiamando un eseguibile esistente.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-277">This is where you will put your application-specific logic for executing a task (typically by calling out to an existing executable).</span></span> <span data-ttu-id="b2ac6-278">Anche il codice di pre-elaborazione e post-elaborazione, ad esempio per il download di dati aggiuntivi o il caricamento dei file dei risultati, viene inserito qui.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-278">Pre- and post-processing code, such as downloading additional data or uploading result files, also goes here.</span></span>

<span data-ttu-id="b2ac6-279">Ovviamente è possibile aggiungere altri file, se necessari per supportare il codice dell'elaboratore di attività, in base alla complessità della logica di suddivisione dei processi.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-279">Of course you can add additional files as required to support your task processor code, depending on the complexity of the job splitting logic.</span></span>

<span data-ttu-id="b2ac6-280">Il modello genera anche i file di progetto .NET standard, ad esempio un file CSPROJ, app.config, packages.config e così via.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-280">The template also generates standard .NET project files such as a .csproj file, app.config, packages.config, etc.</span></span>

<span data-ttu-id="b2ac6-281">La parte restante di questa sezione illustra i diversi file e la struttura del codice e spiega la funzione di ogni classe.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-281">The rest of this section describes the different files and their code structure, and explains what each class does.</span></span>

![Esplora soluzioni di Visual Studio che illustra la soluzione del modello Task Processor (Elaboratore di attività)][solution_explorer02]

<span data-ttu-id="b2ac6-283">**File di Framework**</span><span class="sxs-lookup"><span data-stu-id="b2ac6-283">**Framework files**</span></span>

* <span data-ttu-id="b2ac6-284">`Configuration.cs`: incapsula il caricamento dei dati di configurazione del processo, ad esempio i dettagli dell'account Batch, le credenziali dell'account di archiviazione collegato, le informazioni sul processo e sulle attività e i parametri del processo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-284">`Configuration.cs`: Encapsulates the loading of job configuration data such as Batch account details, linked storage account credentials, job and task information, and job parameters.</span></span> <span data-ttu-id="b2ac6-285">Fornisce anche l'accesso alle variabili di ambiente definite da Batch (vedere Impostazioni di ambiente per le attività nella documentazione di Batch) tramite la classe Configuration.EnvironmentVariable.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-285">It also provides access to Batch-defined environment variables (see Environment settings for tasks, in the Batch documentation) via the Configuration.EnvironmentVariable class.</span></span>
* <span data-ttu-id="b2ac6-286">`IConfiguration.cs`: astrae l'implementazione della classe Configuration, per poter eseguire uno unit test del componente di suddivisione dei processi usando un oggetto di configurazione falso o fittizio.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-286">`IConfiguration.cs`: Abstracts the implementation of the Configuration class, so that you can unit test your job splitter using a fake or mock configuration object.</span></span>
* <span data-ttu-id="b2ac6-287">`TaskProcessorException.cs`: rappresenta un errore che obbliga a terminare il gestore di processi.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-287">`TaskProcessorException.cs`: Represents an error that requires the job manager to terminate.</span></span> <span data-ttu-id="b2ac6-288">TaskProcessorException viene usata per eseguire il wrapping degli errori "previsti" dove possono essere fornite informazioni di diagnostica specifiche nell'ambito della terminazione.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-288">TaskProcessorException is used to wrap 'expected' errors where specific diagnostic information can be provided as part of termination.</span></span>

<span data-ttu-id="b2ac6-289">**Elaboratore di attività**</span><span class="sxs-lookup"><span data-stu-id="b2ac6-289">**Task Processor**</span></span>

* <span data-ttu-id="b2ac6-290">`TaskProcessor.cs`: esegue l'attività.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-290">`TaskProcessor.cs`: Runs the task.</span></span> <span data-ttu-id="b2ac6-291">Il framework chiama il metodo TaskProcessor.Run.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-291">The framework invokes the TaskProcessor.Run method.</span></span> <span data-ttu-id="b2ac6-292">Questa è la classe in cui si inserirà la logica dell'applicazione dell'attività.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-292">This is the class where you will inject the application-specific logic of your task.</span></span> <span data-ttu-id="b2ac6-293">Implementare il metodo Run per:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-293">Implement the Run method to:</span></span>
  * <span data-ttu-id="b2ac6-294">Analizzare e convalidare i parametri delle attività</span><span class="sxs-lookup"><span data-stu-id="b2ac6-294">Parse and validate any task parameters</span></span>
  * <span data-ttu-id="b2ac6-295">Scrivere la riga di comando per i programmi esterni che si vuole richiamare</span><span class="sxs-lookup"><span data-stu-id="b2ac6-295">Compose the command line for any external program you want to invoke</span></span>
  * <span data-ttu-id="b2ac6-296">Registrare le informazioni di diagnostica che potrebbero essere necessarie a scopo di debug</span><span class="sxs-lookup"><span data-stu-id="b2ac6-296">Log any diagnostic information you may require for debugging purposes</span></span>
  * <span data-ttu-id="b2ac6-297">Avviare un processo usando tale riga di comando</span><span class="sxs-lookup"><span data-stu-id="b2ac6-297">Start a process using that command line</span></span>
  * <span data-ttu-id="b2ac6-298">Attendere la chiusura del processo</span><span class="sxs-lookup"><span data-stu-id="b2ac6-298">Wait for the process to exit</span></span>
  * <span data-ttu-id="b2ac6-299">Acquisire il codice di uscita del processo per determinare se ha avuto esito positivo o negativo</span><span class="sxs-lookup"><span data-stu-id="b2ac6-299">Capture the exit code of the process to determine if it succeeded or failed</span></span>
  * <span data-ttu-id="b2ac6-300">Salvare i file di output che si vuole mantenere in una risorsa di archiviazione permanente</span><span class="sxs-lookup"><span data-stu-id="b2ac6-300">Save any output files you want to keep to persistent storage</span></span>

<span data-ttu-id="b2ac6-301">**File di progetto della riga di comando .NET standard**</span><span class="sxs-lookup"><span data-stu-id="b2ac6-301">**Standard .NET command line project files**</span></span>

* <span data-ttu-id="b2ac6-302">`App.config`: file di configurazione dell'applicazione .NET standard.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-302">`App.config`: Standard .NET application configuration file.</span></span>
* <span data-ttu-id="b2ac6-303">`Packages.config`: file di dipendenza del pacchetto NuGet standard.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-303">`Packages.config`: Standard NuGet package dependency file.</span></span>
* <span data-ttu-id="b2ac6-304">`Program.cs`: contiene il punto di ingresso del programma e la gestione delle eccezioni di primo livello.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-304">`Program.cs`: Contains the program entry point and top-level exception handling.</span></span>

## <a name="implementing-the-task-processor"></a><span data-ttu-id="b2ac6-305">Implementazione dell'elaboratore di attività</span><span class="sxs-lookup"><span data-stu-id="b2ac6-305">Implementing the task processor</span></span>
<span data-ttu-id="b2ac6-306">Quando si apre il progetto del modello Task Processor (Elaboratore di attività), il progetto avrà il file TaskProcessor.cs aperto per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-306">When you open the Task Processor template project, the project will have the TaskProcessor.cs file open by default.</span></span> <span data-ttu-id="b2ac6-307">È possibile implementare la logica di esecuzione per le attività del carico di lavoro usando il metodo Run() illustrato sotto:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-307">You can implement the run logic for the tasks in your workload by using the Run() method shown below:</span></span>

```csharp
/// <summary>
/// Runs the task processing logic. This is where you inject
/// your application-specific logic for decomposing the job into tasks.
///
/// The task processor framework invokes the Run method for you; you need
/// only to implement it, not to call it yourself. Typically, your
/// implementation will execute an external program (from resource files or
/// an application package), check the exit code of that program and
/// save output files to persistent storage.
/// </summary>
public async Task<int> Run()

{
    try
    {
        //Your code for the task processor goes here.
        var command = $"compare {_parameters["Frame1"]} {_parameters["Frame2"]} compare.gif";
        using (var process = Process.Start($"cmd /c {command}"))
        {
            process.WaitForExit();
            var taskOutputStorage = new TaskOutputStorage(
            _configuration.StorageAccount,
            _configuration.JobId,
            _configuration.TaskId
            );
            await taskOutputStorage.SaveAsync(
            TaskOutputKind.TaskOutput,
            @"..\stdout.txt",
            @"stdout.txt"
            );
            return process.ExitCode;
        }
    }
    catch (Exception ex)
    {
        throw new TaskProcessorException(
        $"{ex.GetType().Name} exception in run task processor: {ex.Message}",
        ex
        );
    }
}
```
> [!NOTE]
> <span data-ttu-id="b2ac6-308">La sezione con annotazioni nel metodo Run() è la sola del codice del modello Task Processor (Elaboratore di attività) che può essere modificata dall'utente aggiungendo la logica di esecuzione per le attività nel carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-308">The annotated section in the Run() method is the only section of the Task Processor template code that is intended for you to modify by adding the run logic for the tasks in your workload.</span></span> <span data-ttu-id="b2ac6-309">Per modificare un'altra sezione del modello, leggere prima la documentazione di Batch e provare a usare alcuni esempi di codice di Batch per familiarizzare con il funzionamento di Batch.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-309">If you want to modify a different section of the template, please first familiarize yourself with how Batch works by reviewing the Batch documentation and trying out a few of the Batch code samples.</span></span>
> 
> 

<span data-ttu-id="b2ac6-310">Il metodo Run() è responsabile dell'avvio della riga di comando, dell'avvio di uno o più processi, dell'attesa del completamento di tutti i processi, del salvataggio dei risultati e infine delle restituzione di un codice di uscita.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-310">The Run() method is responsible for launching the command line, starting one or more processes, waiting for all process to complete, saving the results, and finally returning with an exit code.</span></span> <span data-ttu-id="b2ac6-311">Nel metodo Run() si implementa la logica di elaborazione per le attività.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-311">The Run() method is where you implement the processing logic for your tasks.</span></span> <span data-ttu-id="b2ac6-312">Il framework dell'elaboratore di attività richiama il metodo Run() automaticamente. Non è necessario chiamarlo manualmente.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-312">The task processor framework invokes the Run() method for you; you do not need to call it yourself.</span></span>

<span data-ttu-id="b2ac6-313">L'implementazione di Run() ha accesso a:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-313">Your Run() implementation has access to:</span></span>

* <span data-ttu-id="b2ac6-314">Parametri dell'attività tramite il campo `_parameters`.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-314">The task parameters, via the `_parameters` field.</span></span>
* <span data-ttu-id="b2ac6-315">ID processo e attività, tramite i campi `_jobId` e `_taskId`.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-315">The job and task ids, via the `_jobId` and `_taskId` fields.</span></span>
* <span data-ttu-id="b2ac6-316">Configurazione dell'attività, tramite il campo `_configuration` .</span><span class="sxs-lookup"><span data-stu-id="b2ac6-316">The task configuration, via the `_configuration` field.</span></span>

<span data-ttu-id="b2ac6-317">**Errore dell'attività**</span><span class="sxs-lookup"><span data-stu-id="b2ac6-317">**Task failure**</span></span>

<span data-ttu-id="b2ac6-318">In caso di errore, è possibile uscire dal metodo Run() generando un'eccezione, ma in questo modo il gestore di eccezioni di primo livello rimane sotto il controllo del codice di uscita dell'attività.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-318">In case of failure, you can exit the Run() method by throwing an exception, but this leaves the top level exception handler in control of the task exit code.</span></span> <span data-ttu-id="b2ac6-319">Se è necessario controllare il codice di uscita per poter distinguere i diversi tipi di errore, ad esempio per finalità di diagnostica o perché alcune modalità di errore devono terminare il processo e altre no, è consigliabile uscire dal metodo Run() restituendo un codice di uscita diverso da zero,</span><span class="sxs-lookup"><span data-stu-id="b2ac6-319">If you need to control the exit code so that you can distinguish different types of failure, for example for diagnostic purposes or because some failure modes should terminate the job and others should not, then you should exit the Run() method by returning a non-zero exit code.</span></span> <span data-ttu-id="b2ac6-320">che diventa il codice di uscita dell'attività.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-320">This becomes the task exit code.</span></span>

### <a name="exit-codes-and-exceptions-in-the-task-processor-template"></a><span data-ttu-id="b2ac6-321">Codici di uscita ed eccezioni nel modello Task Processor (Elaboratore di attività)</span><span class="sxs-lookup"><span data-stu-id="b2ac6-321">Exit codes and exceptions in the Task Processor template</span></span>
<span data-ttu-id="b2ac6-322">I codici di uscita e le eccezioni forniscono un meccanismo per determinare il risultato dell'esecuzione di un programma e consentono di identificare eventuali problemi di esecuzione del programma.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-322">Exit codes and exceptions provide a mechanism to determine the outcome of running a program, and they can help identify any problems with the execution of the program.</span></span> <span data-ttu-id="b2ac6-323">Il modello Task Processor (Elaboratore di attività) implementa i codici di uscita e le eccezioni descritte in questa sezione.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-323">The Task Processor template implements the exit codes and exceptions described in this section.</span></span>

<span data-ttu-id="b2ac6-324">Un'attività dell'elaboratore di attività implementata con il modello Task Processor (Elaboratore di attività) può restituire tre possibili codici di uscita:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-324">A task processor task that is implemented with the Task Processor template can return three possible exit codes:</span></span>

| <span data-ttu-id="b2ac6-325">Codice</span><span class="sxs-lookup"><span data-stu-id="b2ac6-325">Code</span></span> | <span data-ttu-id="b2ac6-326">Descrizione</span><span class="sxs-lookup"><span data-stu-id="b2ac6-326">Description</span></span> |
| --- | --- |
| <span data-ttu-id="b2ac6-327">[Process.ExitCode][process_exitcode]</span><span class="sxs-lookup"><span data-stu-id="b2ac6-327">[Process.ExitCode][process_exitcode]</span></span> |<span data-ttu-id="b2ac6-328">L'elaboratore di attività è stato eseguito fino al completamento.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-328">The task processor ran to completion.</span></span> <span data-ttu-id="b2ac6-329">Si noti che questo non significa che il programma richiamato ha avuto esito positivo, ma solo che l'elaboratore di attività lo ha richiamato correttamente e ha eseguito le operazioni di post-elaborazione senza eccezioni.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-329">Note that this does not imply that the program you invoked was successful – only that the task processor invoked it successfully and performed any post-processing without exceptions.</span></span> <span data-ttu-id="b2ac6-330">Il significato del codice di uscita dipende dal programma richiamato: in genere il codice di uscita 0 indica che il programma ha avuto esito positivo, mentre gli altri codici di uscita indicano che il programma ha avuto esito negativo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-330">The meaning of the exit code depends on the invoked program – typically exit code 0 means the program succeeded and any other exit code means the program failed.</span></span> |
| <span data-ttu-id="b2ac6-331">1</span><span class="sxs-lookup"><span data-stu-id="b2ac6-331">1</span></span> |<span data-ttu-id="b2ac6-332">L'elaboratore di attività non è riuscito con un'eccezione in una parte "prevista" del programma.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-332">The task processor failed with an exception in an 'expected' part of the program.</span></span> <span data-ttu-id="b2ac6-333">L'eccezione è stata convertita in `TaskProcessorException` con informazioni di diagnostica e, dove possibile, suggerimenti per la risoluzione dell'errore.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-333">The exception was translated to a `TaskProcessorException` with diagnostic information and, where possible, suggestions for resolving the failure.</span></span> |
| <span data-ttu-id="b2ac6-334">2</span><span class="sxs-lookup"><span data-stu-id="b2ac6-334">2</span></span> |<span data-ttu-id="b2ac6-335">L'elaboratore di attività non è riuscito con un'eccezione "non prevista".</span><span class="sxs-lookup"><span data-stu-id="b2ac6-335">The task processor failed with an 'unexpected' exception.</span></span> <span data-ttu-id="b2ac6-336">L'eccezione è stata registrata nell'output standard, ma l'elaboratore di attività non è riuscito ad aggiungere altre informazioni di diagnostica o correzione.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-336">The exception was logged to standard output, but the task processor was unable to add any additional diagnostic or remediation information.</span></span> |

> [!NOTE]
> <span data-ttu-id="b2ac6-337">Se il programma richiamato usa i codici di uscita 1 e 2 per indicare specifiche modalità di errore, l'uso dei codici di uscita 1 e 2 per gli errori dell'elaboratore di attività è ambiguo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-337">If the program you invoke uses exit codes 1 and 2 to indicate specific failure modes, then using exit codes 1 and 2 for task processor errors is ambiguous.</span></span> <span data-ttu-id="b2ac6-338">È possibile sostituire questi codici di errore dell'elaboratore di attività con codici di uscita distintivi modificando le lettere maiuscole/minuscole delle eccezioni nel file Program.cs.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-338">You can change these task processor error codes to distinctive exit codes by editing the exception cases in the Program.cs file.</span></span>
> 
> 

<span data-ttu-id="b2ac6-339">Tutte le informazioni restituite dalle eccezioni vengono scritte nei file stdout.txt e stderr.txt.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-339">All the information returned by exceptions is written into stdout.txt and stderr.txt files.</span></span> <span data-ttu-id="b2ac6-340">Per altre informazioni, vedere Gestione degli errori nella documentazione di Batch.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-340">For more information, see Error Handling, in the Batch documentation.</span></span>

### <a name="client-considerations"></a><span data-ttu-id="b2ac6-341">Considerazioni sul client</span><span class="sxs-lookup"><span data-stu-id="b2ac6-341">Client considerations</span></span>
<span data-ttu-id="b2ac6-342">**Credenziali di archiviazione**</span><span class="sxs-lookup"><span data-stu-id="b2ac6-342">**Storage credentials**</span></span>

<span data-ttu-id="b2ac6-343">Se l'elaboratore di attività usa l'archivio BLOB di Azure per rendere persistenti gli output, ad esempio usando la libreria helper File Conventions, deve accedere *o* alle credenziali dell'account di archiviazione cloud *o* all'URL di un contenitore BLOB che include una firma di accesso condiviso.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-343">If your task processor uses Azure blob storage to persist outputs, for example using the file conventions helper library, then it needs access to *either* the cloud storage account credentials *or* a blob container URL that includes a shared access signature (SAS).</span></span> <span data-ttu-id="b2ac6-344">Il modello include il supporto per fornire le credenziali tramite le variabili di ambiente comuni.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-344">The template includes support for providing credentials via common environment variables.</span></span> <span data-ttu-id="b2ac6-345">Il client può passare le credenziali di archiviazione come segue:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-345">Your client can pass the storage credentials as follows:</span></span>

```csharp
job.CommonEnvironmentSettings = new [] {
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

<span data-ttu-id="b2ac6-346">L'account di archiviazione è quindi disponibile nella classe TaskProcessor tramite la proprietà `_configuration.StorageAccount` .</span><span class="sxs-lookup"><span data-stu-id="b2ac6-346">The storage account is then available in the TaskProcessor class via the `_configuration.StorageAccount` property.</span></span>

<span data-ttu-id="b2ac6-347">Se si preferisce usare l'URL di un contenitore con la firma di accesso condiviso, è anche possibile passarlo tramite un'impostazione di ambiente comune del processo, ma il modello di elaboratore di attività attualmente non include il supporto predefinito a questo scopo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-347">If you prefer to use a container URL with SAS, you can also pass this via an job common environment setting, but the task processor template does not currently include built-in support for this.</span></span>

<span data-ttu-id="b2ac6-348">**Configurazione dell'archiviazione**</span><span class="sxs-lookup"><span data-stu-id="b2ac6-348">**Storage setup**</span></span>

<span data-ttu-id="b2ac6-349">È consigliabile che il client o l'attività del gestore di processi crei i contenitori richiesti dalle attività prima di aggiungere le attività al processo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-349">It is recommended that the client or job manager task create any containers required by tasks before adding the tasks to the job.</span></span> <span data-ttu-id="b2ac6-350">Questo è obbligatorio se si usa l'URL di un contenitore con la firma di accesso condiviso, perché un URL di questo tipo non include l'autorizzazione per creare il contenitore.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-350">This is mandatory if you use a container URL with SAS, as such a URL does not include permission to create the container.</span></span> <span data-ttu-id="b2ac6-351">È consigliabile anche se si passano le credenziali dell'account di archiviazione, perché salva ogni attività dovendo chiamare CloudBlobContainer.CreateIfNotExistsAsync sul contenitore.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-351">It is recommended even if you pass storage account credentials, as it saves every task having to call CloudBlobContainer.CreateIfNotExistsAsync on the container.</span></span>

## <a name="pass-parameters-and-environment-variables"></a><span data-ttu-id="b2ac6-352">Passare i parametri e le variabili di ambiente</span><span class="sxs-lookup"><span data-stu-id="b2ac6-352">Pass parameters and environment variables</span></span>
### <a name="pass-environment-settings"></a><span data-ttu-id="b2ac6-353">Passare le impostazioni di ambiente</span><span class="sxs-lookup"><span data-stu-id="b2ac6-353">Pass environment settings</span></span>
<span data-ttu-id="b2ac6-354">Un client può passare informazioni all'attività del gestore di processi sotto forma di impostazioni di ambiente.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-354">A client can pass information to the job manager task in the form of environment settings.</span></span> <span data-ttu-id="b2ac6-355">Queste informazioni possono quindi essere usate dall'attività del gestore di processi quando si generano le attività dell'elaboratore di attività che verranno eseguite durante il processo di calcolo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-355">This information can then be used by the job manager task when generating the task processor tasks that will run as part of the compute job.</span></span> <span data-ttu-id="b2ac6-356">Alcuni esempi di informazioni che è possibile passare come impostazioni di ambiente sono:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-356">Examples of the information that you can pass as environment settings are:</span></span>

* <span data-ttu-id="b2ac6-357">Nome dell'account di archiviazione e chiavi dell'account</span><span class="sxs-lookup"><span data-stu-id="b2ac6-357">Storage account name and account keys</span></span>
* <span data-ttu-id="b2ac6-358">URL dell'account Batch</span><span class="sxs-lookup"><span data-stu-id="b2ac6-358">Batch account URL</span></span>
* <span data-ttu-id="b2ac6-359">Chiave dell'account Batch</span><span class="sxs-lookup"><span data-stu-id="b2ac6-359">Batch account key</span></span>

<span data-ttu-id="b2ac6-360">Il servizio Batch ha un semplice meccanismo per passare le impostazioni di ambiente a un'attività del gestore di processi usando la proprietà `EnvironmentSettings` in [Microsoft.Azure.Batch.JobManagerTask][net_jobmanagertask].</span><span class="sxs-lookup"><span data-stu-id="b2ac6-360">The Batch service has a simple mechanism to pass environment settings to a job manager task by using the `EnvironmentSettings` property in [Microsoft.Azure.Batch.JobManagerTask][net_jobmanagertask].</span></span>

<span data-ttu-id="b2ac6-361">Ad esempio, per ottenere l'istanza di `BatchClient` per un account Batch, è possibile passare come variabili di ambiente dal codice client l'URL e le credenziali con chiave condivisa per l'account Batch.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-361">For example, to get the `BatchClient` instance for a Batch account, you can pass as environment variables from the client code the URL and shared key credentials for the Batch account.</span></span> <span data-ttu-id="b2ac6-362">Analogamente, per accedere all'account di archiviazione collegato all'account Batch, è possibile passare il nome dell'account di archiviazione e la chiave dell'account di archiviazione come variabili di ambiente.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-362">Likewise, to access the storage account that is linked to the Batch account, you can pass the storage account name and the storage account key as environment variables.</span></span>

### <a name="pass-parameters-to-the-job-manager-template"></a><span data-ttu-id="b2ac6-363">Passare i parametri al modello Job Manager (Gestore di processi)</span><span class="sxs-lookup"><span data-stu-id="b2ac6-363">Pass parameters to the Job Manager template</span></span>
<span data-ttu-id="b2ac6-364">In molti casi, è utile passare i parametri per ogni processo all'attività del gestore di processi, per controllare la procedura di suddivisione del processo o per configurare le attività per il processo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-364">In many cases, it's useful to pass per-job parameters to the job manager task, either to control the job splitting process or to configure the tasks for the job.</span></span> <span data-ttu-id="b2ac6-365">A questo scopo, caricare un file JSON denominato parameters.json come file di risorse per l'attività del gestore di processi.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-365">You can do this by uploading a JSON file named parameters.json as a resource file for the job manager task.</span></span> <span data-ttu-id="b2ac6-366">I parametri possono quindi essere disponibili nel campo `JobSplitter._parameters` del modello Job Manager (Gestore di processi).</span><span class="sxs-lookup"><span data-stu-id="b2ac6-366">The parameters can then become available in the `JobSplitter._parameters` field in the Job Manager template.</span></span>

> [!NOTE]
> <span data-ttu-id="b2ac6-367">Il gestore di parametri predefinito supporta solo i dizionari da stringa a stringa.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-367">The built-in parameter handler supports only string-to-string dictionaries.</span></span> <span data-ttu-id="b2ac6-368">Per passare valori JSON complessi come valori di parametri, sarà necessario passarli come stringhe e quindi analizzarli nel componente di suddivisione dei processi o modificare il metodo `Configuration.GetJobParameters` del framework.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-368">If you want to pass complex JSON values as parameter values, you will need to pass these as strings and parse them in the job splitter, or modify the framework's `Configuration.GetJobParameters` method.</span></span>
> 
> 

### <a name="pass-parameters-to-the-task-processor-template"></a><span data-ttu-id="b2ac6-369">Passare i parametri al modello Task Processor (Elaboratore di attività)</span><span class="sxs-lookup"><span data-stu-id="b2ac6-369">Pass parameters to the Task Processor template</span></span>
<span data-ttu-id="b2ac6-370">È anche possibile passare i parametri alle singole attività implementate usando il modello Task Processor (Elaboratore di attività).</span><span class="sxs-lookup"><span data-stu-id="b2ac6-370">You can also pass parameters to individual tasks implemented using the Task Processor template.</span></span> <span data-ttu-id="b2ac6-371">Proprio come il modello di gestore di processi, il modello di elaboratore di attività cerca un file di risorse denominato</span><span class="sxs-lookup"><span data-stu-id="b2ac6-371">Just as with the job manager template, the task processor template looks for a resource file named</span></span>

<span data-ttu-id="b2ac6-372">parameters.json e, se lo trova, lo carica come dizionario di parametri.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-372">parameters.json, and if found it loads it as the parameters dictionary.</span></span> <span data-ttu-id="b2ac6-373">Per passare i parametri alle attività dell'elaboratore di attività, esistono due opzioni:</span><span class="sxs-lookup"><span data-stu-id="b2ac6-373">There are a couple of options for how to pass parameters to the task processor tasks:</span></span>

* <span data-ttu-id="b2ac6-374">Usare di nuovo il file JSON dei parametri del processo.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-374">Reuse the job parameters JSON.</span></span> <span data-ttu-id="b2ac6-375">Questa opzione funziona bene se i soli parametri sono quelli a livello di processo, ad esempio un'altezza e una larghezza di rendering.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-375">This works well if the only parameters are job-wide ones (for example, a render height and width).</span></span> <span data-ttu-id="b2ac6-376">A questo scopo, quando si crea CloudTask nel componente di suddivisione dei processi, aggiungere un riferimento all'oggetto file di risorse parameters.json da ResourceFiles (`JobSplitter._jobManagerTask.ResourceFiles`) dell'attività del gestore di processi alla raccolta ResourceFiles di CloudTask.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-376">To do this, when creating a CloudTask in the job splitter, add a reference to the parameters.json resource file object from the job manager task's ResourceFiles (`JobSplitter._jobManagerTask.ResourceFiles`) to the CloudTask's ResourceFiles collection.</span></span>
* <span data-ttu-id="b2ac6-377">Generare e caricare un documento parameters.json specifico dell'attività durante l'esecuzione del componente di suddivisione dei processi e fare riferimento a tale BLOB nella raccolta di file di risorse dell'attività.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-377">Generate and upload a task-specific parameters.json document as part of job splitter execution, and reference that blob in the task's resource files collection.</span></span> <span data-ttu-id="b2ac6-378">Ciò è necessario se i parametri sono diversi per ogni attività.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-378">This is necessary if different tasks have different parameters.</span></span> <span data-ttu-id="b2ac6-379">Come esempio si pensi a uno scenario di rendering 3D dove l'indice dei fotogrammi viene passato all'attività come parametro.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-379">An example might be a 3D rendering scenario where the frame index is passed to the task as a parameter.</span></span>

> [!NOTE]
> <span data-ttu-id="b2ac6-380">Il gestore di parametri predefinito supporta solo i dizionari da stringa a stringa.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-380">The built-in parameter handler supports only string-to-string dictionaries.</span></span> <span data-ttu-id="b2ac6-381">Per passare valori JSON complessi come valori di parametri, sarà necessario passarli come stringhe e quindi analizzarli nell'elaboratore di attività o modificare il metodo `Configuration.GetTaskParameters` del framework.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-381">If you want to pass complex JSON values as parameter values, you will need to pass these as strings and parse them in the task processor, or modify the framework's `Configuration.GetTaskParameters` method.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="b2ac6-382">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="b2ac6-382">Next steps</span></span>
### <a name="persist-job-and-task-output-to-azure-storage"></a><span data-ttu-id="b2ac6-383">Rendere persistenti l'output di attività e processi in Archiviazione di Azure</span><span class="sxs-lookup"><span data-stu-id="b2ac6-383">Persist job and task output to Azure Storage</span></span>
<span data-ttu-id="b2ac6-384">Un altro strumento utile nello sviluppo di soluzioni Batch è [Azure Batch File Conventions][nuget_package].</span><span class="sxs-lookup"><span data-stu-id="b2ac6-384">Another helpful tool in Batch solution development is [Azure Batch File Conventions][nuget_package].</span></span> <span data-ttu-id="b2ac6-385">Usare questa libreria di classi .NET (attualmente in anteprima) nelle applicazioni Batch .NET per archiviare e recuperare facilmente gli output delle attività in e da Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-385">Use this .NET class library (currently in preview) in your Batch .NET applications to easily store and retrieve task outputs to and from Azure Storage.</span></span> <span data-ttu-id="b2ac6-386">[Salvare in modo permanente l'output dei processi e delle attività di Azure Batch](batch-task-output.md) contiene una descrizione completa della libreria e di come utilizzarla.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-386">[Persist Azure Batch job and task output](batch-task-output.md) contains a full discussion of the library and its usage.</span></span>

### <a name="batch-forum"></a><span data-ttu-id="b2ac6-387">Forum di Batch</span><span class="sxs-lookup"><span data-stu-id="b2ac6-387">Batch Forum</span></span>
<span data-ttu-id="b2ac6-388">Il [forum di Azure Batch][forum] su MSDN consente di seguire discussioni su Batch e inviare domande sul servizio.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-388">The [Azure Batch Forum][forum] on MSDN is a great place to discuss Batch and ask questions about the service.</span></span> <span data-ttu-id="b2ac6-389">Leggere i post contrassegnati e inviare domande durante le procedure di sviluppo delle soluzioni Batch.</span><span class="sxs-lookup"><span data-stu-id="b2ac6-389">Head on over for helpful "sticky" posts, and post your questions as they arise while you build your Batch solutions.</span></span>

[forum]: https://social.msdn.microsoft.com/forums/azure/en-US/home?forum=azurebatch
[net_jobmanagertask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.jobmanagertask.aspx
[github_samples]: https://github.com/Azure/azure-batch-samples
[nuget_package]: https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files
[process_exitcode]: https://msdn.microsoft.com/library/system.diagnostics.process.exitcode.aspx
[vs_gallery]: https://visualstudiogallery.msdn.microsoft.com/
[vs_gallery_templates]: https://go.microsoft.com/fwlink/?linkid=820714
[vs_find_use_ext]: https://msdn.microsoft.com/library/dd293638.aspx

[diagram01]: ./media/batch-visual-studio-templates/diagram01.png
[solution_explorer01]: ./media/batch-visual-studio-templates/solution_explorer01.png
[solution_explorer02]: ./media/batch-visual-studio-templates/solution_explorer02.png
