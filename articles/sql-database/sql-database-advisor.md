---
title: Raccomandazioni per le prestazioni - Database SQL di Azure | Microsoft Docs
description: Il database SQL di Azure offre raccomandazioni per i database SQL esistenti che consentono di migliorare le prestazioni correnti delle query.
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: monicar
ms.assetid: 1db441ff-58f5-45da-8d38-b54dc2aa6145
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 07/05/2017
ms.author: sstein
ms.openlocfilehash: 357a25a665894c86ddb0f93beeb4dd59d8837489
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="performance-recommendations"></a><span data-ttu-id="3845f-103">Raccomandazioni per le prestazioni</span><span class="sxs-lookup"><span data-stu-id="3845f-103">Performance recommendations</span></span>

<span data-ttu-id="3845f-104">Il database SQL di Azure apprende e si adatta all'applicazione e offre raccomandazioni personalizzate che consentono di ottimizzare le prestazioni dei database SQL.</span><span class="sxs-lookup"><span data-stu-id="3845f-104">Azure SQL Database learns and adapts with your application and provides customized recommendations enabling you to maximize the performance of your SQL databases.</span></span> <span data-ttu-id="3845f-105">Le prestazioni vengono valutate continuamente analizzando la cronologia relativa all'utilizzo del database SQL.</span><span class="sxs-lookup"><span data-stu-id="3845f-105">Your performance is continuously assessed by analyzing your SQL Database usage history.</span></span> <span data-ttu-id="3845f-106">Le raccomandazioni fornite si basano su un modello di carico di lavoro univoco del database e consentono di migliorarne le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="3845f-106">The recommendations that are provided are based on a database unique workload pattern and help improve its performance.</span></span>

> [!NOTE]
> <span data-ttu-id="3845f-107">Il modo consigliato per usare le raccomandazioni prevede l'abilitazione della funzionalità di 'Ottimizzazione automatica' nel database.</span><span class="sxs-lookup"><span data-stu-id="3845f-107">Recommended way of using recommendations is by enabling ‘Automatic tuning’ on your database.</span></span> <span data-ttu-id="3845f-108">Per altri dettagli, vedere [Ottimizzazione automatica](sql-database-automatic-tuning.md).</span><span class="sxs-lookup"><span data-stu-id="3845f-108">For details, see [Automatic tuning](sql-database-automatic-tuning.md).</span></span>
>

## <a name="create-index-recommendations"></a><span data-ttu-id="3845f-109">Raccomandazioni relative alla creazione di indici</span><span class="sxs-lookup"><span data-stu-id="3845f-109">Create index recommendations</span></span>
<span data-ttu-id="3845f-110">Il database SQL di Azure esegue un monitoraggio continuo delle query eseguite e identifica gli indici che potrebbero migliorare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="3845f-110">Azure SQL Database continuously monitors the queries being executed and identifies the indexes that could improve the performance.</span></span> <span data-ttu-id="3845f-111">Dopo aver raccolto dati sufficienti per confermare la mancanza di un determinato indice, verrà creata una nuova raccomandazione **Crea indice**.</span><span class="sxs-lookup"><span data-stu-id="3845f-111">Once enough confidence is built that a certain index is missing, a new **Create index** recommendation will be created.</span></span> <span data-ttu-id="3845f-112">Il database SQL di Azure conferma l'attendibilità dei rilevamenti stimando il miglioramento delle prestazioni che potrebbe offrire l'indice nel tempo.</span><span class="sxs-lookup"><span data-stu-id="3845f-112">Azure SQL Database builds confidence by estimating performance gain the index would bring through time.</span></span> <span data-ttu-id="3845f-113">A seconda del miglioramento delle prestazioni stimato, le raccomandazioni vengono classificate come Alta, Media o Bassa.</span><span class="sxs-lookup"><span data-stu-id="3845f-113">Depending on the estimated performance gain, recommendations are categorized as High, Medium,  or Low.</span></span> 

<span data-ttu-id="3845f-114">Gli indici creati usando le raccomandazioni vengono sempre contrassegnati come indici auto_created.</span><span class="sxs-lookup"><span data-stu-id="3845f-114">Indexes created using recommendations are always flagged as auto_created indexes.</span></span> <span data-ttu-id="3845f-115">È possibile scoprire quali indici sono auto_created esaminando la vista sys.indexes.</span><span class="sxs-lookup"><span data-stu-id="3845f-115">You can see which indexes are auto_created by looking at sys.indexes view.</span></span> <span data-ttu-id="3845f-116">Gli indici creati automaticamente non bloccano i comandi ALTER/RENAME.</span><span class="sxs-lookup"><span data-stu-id="3845f-116">Auto created indexes don’t block ALTER/RENAME commands.</span></span> <span data-ttu-id="3845f-117">Se si tenta di eliminare la colonna su cui si basa un indice creato automaticamente, il comando viene eseguito ed elimina anche l'indice creato automaticamente.</span><span class="sxs-lookup"><span data-stu-id="3845f-117">If you try to drop the column that has an auto created index over it, the command passes and the auto created index is dropped with the command as well.</span></span> <span data-ttu-id="3845f-118">Gli indici normali bloccano il comando ALTER/RENAME sulle colonne indicizzate.</span><span class="sxs-lookup"><span data-stu-id="3845f-118">Regular indexes would block the ALTER/RENAME command on columns that are indexed.</span></span>

<span data-ttu-id="3845f-119">Dopo aver applicato la raccomandazione per l'indice, il database SQL di Azure confronterà le prestazioni delle query con la baseline.</span><span class="sxs-lookup"><span data-stu-id="3845f-119">Once the create index recommendation is applied, Azure SQL Database will compare performance of the queries with the baseline performance.</span></span> <span data-ttu-id="3845f-120">Se il nuovo indice ha introdotto miglioramenti delle prestazioni, la raccomandazione verrà contrassegnata come positiva e sarà disponibile un report dell'impatto.</span><span class="sxs-lookup"><span data-stu-id="3845f-120">If new index brought improvements in the performance, recommendation will be flagged as successful and impact report will be available.</span></span> <span data-ttu-id="3845f-121">Se l'indice non offre vantaggi, verrà annullato automaticamente.</span><span class="sxs-lookup"><span data-stu-id="3845f-121">In case the index didn’t bring the benefits, it will be automatically reverted.</span></span> <span data-ttu-id="3845f-122">In questo modo il database SQL di Azure garantisce che l'uso delle raccomandazioni consenta solo di ottenere miglioramenti delle prestazioni del database.</span><span class="sxs-lookup"><span data-stu-id="3845f-122">This way Azure SQL Database ensures that using recommendations will only improve the database performance.</span></span>

<span data-ttu-id="3845f-123">Per qualsiasi raccomandazione **Crea indice** esiste un criterio di sicurezza che non consente di applicare la raccomandazione se l'utilizzo DTU del database o del pool è superiore all'80% negli ultimi 20 minuti oppure se l'utilizzo dello spazio di archiviazione è superiore al 90%.</span><span class="sxs-lookup"><span data-stu-id="3845f-123">Any **Create index** recommendation has a back off policy that won’t allow applying the recommendation if the database or pool DTU usage was above 80% in last 20 minutes or if the storage is above 90% of usage.</span></span> <span data-ttu-id="3845f-124">In questo caso, l'applicazione della raccomandazione verrà posticipata.</span><span class="sxs-lookup"><span data-stu-id="3845f-124">In this case, the recommendation will be postponed.</span></span>

## <a name="drop-index-recommendations"></a><span data-ttu-id="3845f-125">Raccomandazioni relative all'eliminazione di indici</span><span class="sxs-lookup"><span data-stu-id="3845f-125">Drop index recommendations</span></span>
<span data-ttu-id="3845f-126">Oltre a rilevare un indice mancante, i database SQL di Azure analizzano continuamente le prestazioni degli indici esistenti.</span><span class="sxs-lookup"><span data-stu-id="3845f-126">In addition to detecting a missing index, Azure SQL Database continuously analyzes the performance of existing indexes.</span></span> <span data-ttu-id="3845f-127">Se un indice è inutilizzato, il database SQL di Azure proporrà di eliminarlo.</span><span class="sxs-lookup"><span data-stu-id="3845f-127">If index is not used, Azure SQL Database will recommend dropping it.</span></span> <span data-ttu-id="3845f-128">L'eliminazione di un indice è consigliabile in due casi:</span><span class="sxs-lookup"><span data-stu-id="3845f-128">Dropping an index is recommended in two cases:</span></span>
* <span data-ttu-id="3845f-129">L'indice è un duplicato di un altro indice (include colonna, schema di partizione e filtri identici)</span><span class="sxs-lookup"><span data-stu-id="3845f-129">Index is a duplicate of another index (same indexed and included column, partition schema, and filters)</span></span>
* <span data-ttu-id="3845f-130">L'indice risulta inutilizzato per un periodo prolungato (93 giorni)</span><span class="sxs-lookup"><span data-stu-id="3845f-130">Index is unused for a prolonged period (93 days)</span></span>

<span data-ttu-id="3845f-131">Anche le raccomandazioni relative all'eliminazione di indici sono sottoposte a verifica dopo l'implementazione.</span><span class="sxs-lookup"><span data-stu-id="3845f-131">Drop index recommendations also go through the verification after implementation.</span></span> <span data-ttu-id="3845f-132">Se le prestazioni risultano migliorate sarà disponibile il report di impatto.</span><span class="sxs-lookup"><span data-stu-id="3845f-132">If the performance is improved the impact report will be available.</span></span> <span data-ttu-id="3845f-133">Se viene invece rilevata una riduzione delle prestazioni, la raccomandazione verrà annullata.</span><span class="sxs-lookup"><span data-stu-id="3845f-133">In case performance degradation is detected, recommendation will be reverted.</span></span>


## <a name="parameterize-queries-recommendations"></a><span data-ttu-id="3845f-134">Raccomandazioni relative alla creazione di query con parametri</span><span class="sxs-lookup"><span data-stu-id="3845f-134">Parameterize queries recommendations</span></span>
<span data-ttu-id="3845f-135">Le raccomandazioni relative alla **creazione di query con parametri** vengono visualizzate quando sono presenti una o più query che vengono ricompilate costantemente ma finiscono con lo stesso piano di esecuzione di query.</span><span class="sxs-lookup"><span data-stu-id="3845f-135">**Parameterize queries** recommendations appear when you have one or more queries that are constantly being recompiled but end up with the same query execution plan.</span></span> <span data-ttu-id="3845f-136">Questa condizione fa emergere l'opportunità di applicare l'impostazione forzata di parametri, in modo da permettere la memorizzazione nella cache e il riutilizzo delle query in futuro, con conseguente miglioramento delle prestazioni e riduzione dell'utilizzo delle risorse.</span><span class="sxs-lookup"><span data-stu-id="3845f-136">This condition opens up an opportunity to apply forced parameterization, which will allow query plans to be cached and reused in the future improving performance and reducing resource usage.</span></span> 

<span data-ttu-id="3845f-137">Ogni query eseguita inizialmente su SQL Server deve essere compilata per generare un piano di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="3845f-137">Every query issued against SQL Server initially needs to be compiled to generate an execution plan.</span></span> <span data-ttu-id="3845f-138">Ogni piano generato viene aggiunto alla cache dei piani e le esecuzioni successive della stessa query possono riusare il piano dalla cache, eliminando la necessità di un'ulteriore compilazione.</span><span class="sxs-lookup"><span data-stu-id="3845f-138">Each generated plan is added to the plan cache and subsequent executions of the same query can reuse this plan from the cache, eliminating the need for additional compilation.</span></span> 

<span data-ttu-id="3845f-139">Le applicazioni che inviano query che includono valori senza parametri possono causare un overhead delle prestazioni, in cui per ogni query di questo tipo con valori di parametri diversi viene compilato di nuovo il piano di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="3845f-139">Applications that send queries, which include non-parameterized values, can lead to a performance overhead, where for every such query with different parameter values the execution plan is compiled again.</span></span> <span data-ttu-id="3845f-140">In molti casi le stesse query con valori di parametri diversi generano gli stessi di piani di esecuzione, ma questi piani vengono comunque aggiunti separatamente alla cache dei piani.</span><span class="sxs-lookup"><span data-stu-id="3845f-140">In many cases the same queries with different parameter values generate the same execution plans, but these plans are still separately added to the plan cache.</span></span> <span data-ttu-id="3845f-141">La ricompilazione dei piani di esecuzione determina l'uso delle risorse del database, l'aumento della durata della query e l'overflow della cache dei piani con conseguente rimozione dei piani dalla cache.</span><span class="sxs-lookup"><span data-stu-id="3845f-141">Recompiling execution plans use database resources, increase the query duration time and overflow the plan cache causing plans to be evicted from the cache.</span></span> <span data-ttu-id="3845f-142">Questo comportamento di SQL Server può essere modificato impostando l'opzione di parametrizzazione forzata nel database.</span><span class="sxs-lookup"><span data-stu-id="3845f-142">This behavior of SQL Server can be altered by setting the forced parameterization option on the database.</span></span> 

<span data-ttu-id="3845f-143">Per stimare l'impatto di questa raccomandazione, viene illustrato un confronto tra l'uso effettivo e quello previsto della CPU (nel caso di applicazione della raccomandazione).</span><span class="sxs-lookup"><span data-stu-id="3845f-143">To help you estimate the impact of this recommendation, you are provided with a comparison between the actual CPU usage and the projected CPU usage (as if the recommendation was applied).</span></span> <span data-ttu-id="3845f-144">Oltre al risparmio della CPU, anche la durata della query diminuisce per il tempo impiegato nella compilazione.</span><span class="sxs-lookup"><span data-stu-id="3845f-144">In addition to CPU savings, your query duration decreases for the time spent in compilation.</span></span> <span data-ttu-id="3845f-145">Anche il sovraccarico della cache dei piani sarà nettamente ridotto, consentendo alla maggioranza dei piani di rimanere nella cache e di essere riusati.</span><span class="sxs-lookup"><span data-stu-id="3845f-145">There will also be much less overhead on plan cache, allowing majority of the plans to stay in cache and be reused.</span></span> <span data-ttu-id="3845f-146">Questa raccomandazione può essere applicata rapidamente e facilmente facendo clic sul comando **Applica**.</span><span class="sxs-lookup"><span data-stu-id="3845f-146">You can apply this recommendation quickly and easily by clicking on the **Apply** command.</span></span> 

<span data-ttu-id="3845f-147">Dopo l'applicazione, questa raccomandazione abiliterà la parametrizzazione forzata sul database entro pochi minuti e inizierà il processo di monitoraggio che dura circa 24 ore.</span><span class="sxs-lookup"><span data-stu-id="3845f-147">Once you apply this recommendation, it will enable forced parameterization within minutes on your database and it starts the monitoring process which approximately lasts for 24 hours.</span></span> <span data-ttu-id="3845f-148">Trascorso questo intervallo di tempo, sarà possibile visualizzare il report di convalida che mostra l'utilizzo della CPU del database nelle 24 ore prima e dopo l'applicazione la raccomandazione.</span><span class="sxs-lookup"><span data-stu-id="3845f-148">After this period, you will be able to see the validation report that shows CPU usage of your database 24 hours before and after the recommendation has been applied.</span></span> <span data-ttu-id="3845f-149">SQL Database Advisor include un meccanismo di sicurezza che ripristina automaticamente la raccomandazione applicata in caso di rilevamento di una regressione delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="3845f-149">SQL Database Advisor has a safety mechanism that automatically reverts the applied recommendation in case a performance regression has been detected.</span></span>

## <a name="fix-schema-issues-recommendations"></a><span data-ttu-id="3845f-150">Raccomandazioni relative alla correzione di problemi di schema</span><span class="sxs-lookup"><span data-stu-id="3845f-150">Fix schema issues recommendations</span></span>
<span data-ttu-id="3845f-151">Le raccomandazioni relative alla **correzione di problemi di schema** vengono visualizzate quando il servizio del database SQL rileva un'anomalia nel numero di errori SQL correlati allo schema nel database SQL di Azure.</span><span class="sxs-lookup"><span data-stu-id="3845f-151">**Fix schema issues** recommendations appear when the SQL Database service notices an anomaly in the number of schema-related SQL errors happening on your Azure SQL Database.</span></span> <span data-ttu-id="3845f-152">In genere questa indicazione viene visualizzata quando il database rileva più errori correlati allo schema (nome di colonna non valido, nome di oggetto non valido e così via) nell'arco di un'ora.</span><span class="sxs-lookup"><span data-stu-id="3845f-152">This recommendation typically appears when your database encounters multiple schema-related errors (invalid column name, invalid object name, etc.) within an hour.</span></span>

<span data-ttu-id="3845f-153">I "problemi di schema" rappresentano una classe di errori di sintassi in SQL Server che si verificano quando la definizione della query SQL e la definizione dello schema del database non sono allineate.</span><span class="sxs-lookup"><span data-stu-id="3845f-153">“Schema issues” are a class of syntax errors in SQL Server that happen when the definition of the SQL query and the definition of the database schema are not aligned.</span></span> <span data-ttu-id="3845f-154">Ad esempio, una delle colonne previste dalla query può essere assente nella tabella di destinazione o viceversa.</span><span class="sxs-lookup"><span data-stu-id="3845f-154">For example, one of the columns expected by the query may be missing in the target table, or vice versa.</span></span> 

<span data-ttu-id="3845f-155">Le raccomandazioni relative alla "correzione di problemi di schema" vengono visualizzate quando il servizio del database SQL di Azure rileva un'anomalia nel numero di errori SQL correlati allo schema nel database SQL di Azure.</span><span class="sxs-lookup"><span data-stu-id="3845f-155">“Fix schema issue” recommendation appears when Azure SQL Database service notices an anomaly in the number of schema-related SQL errors happening on your Azure SQL Database.</span></span> <span data-ttu-id="3845f-156">La tabella seguente illustra gli errori correlati ai problemi di schema:</span><span class="sxs-lookup"><span data-stu-id="3845f-156">The following table shows the errors that are related to schema issues:</span></span>

| <span data-ttu-id="3845f-157">Codice di errore SQL</span><span class="sxs-lookup"><span data-stu-id="3845f-157">SQL Error Code</span></span> | <span data-ttu-id="3845f-158">Message</span><span class="sxs-lookup"><span data-stu-id="3845f-158">Message</span></span> |
| --- | --- |
| <span data-ttu-id="3845f-159">201</span><span class="sxs-lookup"><span data-stu-id="3845f-159">201</span></span> |<span data-ttu-id="3845f-160">La procedura o funzione '*' richiede il parametro '*', che non è stato specificato.</span><span class="sxs-lookup"><span data-stu-id="3845f-160">Procedure or function '*' expects parameter '*', which was not supplied.</span></span> |
| <span data-ttu-id="3845f-161">207</span><span class="sxs-lookup"><span data-stu-id="3845f-161">207</span></span> |<span data-ttu-id="3845f-162">Il nome di colonna '*' non è valido.</span><span class="sxs-lookup"><span data-stu-id="3845f-162">Invalid column name '*'.</span></span> |
| <span data-ttu-id="3845f-163">208</span><span class="sxs-lookup"><span data-stu-id="3845f-163">208</span></span> |<span data-ttu-id="3845f-164">Il nome di oggetto '*' non è valido.</span><span class="sxs-lookup"><span data-stu-id="3845f-164">Invalid object name '*'.</span></span> |
| <span data-ttu-id="3845f-165">213</span><span class="sxs-lookup"><span data-stu-id="3845f-165">213</span></span> |<span data-ttu-id="3845f-166">Il nome della colonna o il numero dei valori specificati non corrisponde alla definizione della tabella.</span><span class="sxs-lookup"><span data-stu-id="3845f-166">Column name or number of supplied values does not match table definition.</span></span> |
| <span data-ttu-id="3845f-167">2812</span><span class="sxs-lookup"><span data-stu-id="3845f-167">2812</span></span> |<span data-ttu-id="3845f-168">Non è stato possibile trovare la stored procedure '*'.</span><span class="sxs-lookup"><span data-stu-id="3845f-168">Could not find stored procedure '*'.</span></span> |
| <span data-ttu-id="3845f-169">8144</span><span class="sxs-lookup"><span data-stu-id="3845f-169">8144</span></span> |<span data-ttu-id="3845f-170">Numero eccessivo di argomenti specificati per la procedura o la funzione *.</span><span class="sxs-lookup"><span data-stu-id="3845f-170">Procedure or function * has too many arguments specified.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="3845f-171">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="3845f-171">Next steps</span></span>
<span data-ttu-id="3845f-172">Monitorare le raccomandazioni e continuare ad applicarle in modo da migliorare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="3845f-172">Monitor your recommendations and continue to apply them to refine performance.</span></span> <span data-ttu-id="3845f-173">I carichi di lavoro dei database sono dinamici e cambiano in modo continuo.</span><span class="sxs-lookup"><span data-stu-id="3845f-173">Database workloads are dynamic and change continuously.</span></span> <span data-ttu-id="3845f-174">SQL Database Advisor continua a monitorare e offrire raccomandazioni potenzialmente utili per migliorare le prestazioni del database.</span><span class="sxs-lookup"><span data-stu-id="3845f-174">SQL Database advisor continues to monitor and provide recommendations that can potentially improve your database's performance.</span></span> 

* <span data-ttu-id="3845f-175">Vedere [Applicare le raccomandazioni per le prestazioni](sql-database-advisor-portal.md) per istruzioni su come usare le raccomandazioni per le prestazioni nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="3845f-175">See [Performance recommendations in the Azure portal](sql-database-advisor-portal.md) for steps on how to use performance recommendations in the Azure portal.</span></span>
* <span data-ttu-id="3845f-176">Per imparare a esaminare l'impatto sulle prestazioni delle query principali, vedere [Query Performance Insight del database SQL di Azure](sql-database-query-performance.md).</span><span class="sxs-lookup"><span data-stu-id="3845f-176">See [Query Performance Insights](sql-database-query-performance.md) to learn about and view the performance impact of your top queries.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="3845f-177">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="3845f-177">Additional resources</span></span>
* [<span data-ttu-id="3845f-178">Archivio query</span><span class="sxs-lookup"><span data-stu-id="3845f-178">Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx)
* [<span data-ttu-id="3845f-179">CREATE INDEX</span><span class="sxs-lookup"><span data-stu-id="3845f-179">CREATE INDEX</span></span>](https://msdn.microsoft.com/library/ms188783.aspx)
* [<span data-ttu-id="3845f-180">Controllo degli accessi in base al ruolo</span><span class="sxs-lookup"><span data-stu-id="3845f-180">Role-based access control</span></span>](../active-directory/role-based-access-control-what-is.md)

