---
title: un Runbook di automazione di Azure da un avviso di Log Analitica aaaCalling | Documenti Microsoft
description: In questo articolo viene fornita una panoramica di come tooinvoke un runbook di automazione da un avviso di Microsoft OMS Log Analitica.
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: 
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 01/31/2017
ms.author: magoedte
ms.openlocfilehash: 8b745d6e6c2b0294d676e010f52855cd51741cf9
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="calling-an-azure-automation-runbook-from-an-oms-log-analytics-alert"></a><span data-ttu-id="84b31-103">Chiamata di un runbook di un Automazione di Azure da un avviso di OMS Log Analytics</span><span class="sxs-lookup"><span data-stu-id="84b31-103">Calling an Azure Automation runbook from an OMS Log Analytics alert</span></span>

<span data-ttu-id="84b31-104">Quando un avviso è configurato in toocreate Analitica Log un record di avviso se i risultati corrispondono a determinati criteri, ad esempio un picco nell'utilizzo del processore o una funzionalità di un'applicazione aziendale toohello critici un processo particolare applicazione prolungato ha esito negativo e scrive un evento corrispondente nel registro eventi di Windows hello, tale avviso è possibile eseguire automaticamente un runbook di automazione in un tentativo tooauto-correggere il problema di hello.</span><span class="sxs-lookup"><span data-stu-id="84b31-104">When an alert is configured in Log Analytics toocreate an alert record if results match a particular criteria, such as a prolonged spike in processor utilization or a particular application process critical toohello functionality of a business application fails and writes a corresponding event in hello Windows event log, that alert can automatically run an Automation runbook in an attempt tooauto-remediate hello issue.</span></span>  

<span data-ttu-id="84b31-105">Esistono due opzioni toocall un runbook quando si configura avviso hello.</span><span class="sxs-lookup"><span data-stu-id="84b31-105">There are two options toocall a runbook when configuring hello alert.</span></span>  <span data-ttu-id="84b31-106">ovvero:</span><span class="sxs-lookup"><span data-stu-id="84b31-106">Specifically,</span></span>

1. <span data-ttu-id="84b31-107">Uso di un webhook.</span><span class="sxs-lookup"><span data-stu-id="84b31-107">Using a Webhook.</span></span>
   * <span data-ttu-id="84b31-108">Si tratta di hello unica opzione disponibile se l'area di lavoro OMS non è collegato tooan account di automazione.</span><span class="sxs-lookup"><span data-stu-id="84b31-108">This is hello only option available if your OMS workspace is not linked tooan Automation account.</span></span>
   * <span data-ttu-id="84b31-109">Se si dispone già di un'area di lavoro OMS di automazione account collegato tooan, questa opzione è ancora disponibile.</span><span class="sxs-lookup"><span data-stu-id="84b31-109">If you already have an Automation account linked tooan OMS workspace, this option is still available.</span></span>  

2. <span data-ttu-id="84b31-110">Selezione diretta di un runbook.</span><span class="sxs-lookup"><span data-stu-id="84b31-110">Select a runbook directly.</span></span>
   * <span data-ttu-id="84b31-111">Questa opzione è disponibile solo quando l'area di lavoro OMS hello è collegato tooan account di automazione.</span><span class="sxs-lookup"><span data-stu-id="84b31-111">This option is available only when hello OMS workspace is linked tooan Automation account.</span></span>  

## <a name="calling-a-runbook-using-a-webhook"></a><span data-ttu-id="84b31-112">Chiamata di un runbook mediante un webhook</span><span class="sxs-lookup"><span data-stu-id="84b31-112">Calling a runbook using a webhook</span></span>

<span data-ttu-id="84b31-113">Un webhook consente toostart un determinato runbook in automazione di Azure tramite una singola richiesta HTTP.</span><span class="sxs-lookup"><span data-stu-id="84b31-113">A webhook allows you toostart a particular runbook in Azure Automation through a single HTTP request.</span></span>  <span data-ttu-id="84b31-114">Prima di configurare hello [avviso Analitica Log](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbook utilizzando un webhook come un'azione di avviso, sarà necessario toofirst creare un webhook per runbook hello che verrà chiamato questo metodo.</span><span class="sxs-lookup"><span data-stu-id="84b31-114">Before configuring hello [Log Analytics alert](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbook using a webhook as an alert action, you will need toofirst create a webhook for hello runbook that will be called using this method.</span></span>  <span data-ttu-id="84b31-115">Esaminare e seguire i passaggi hello hello [creare un webhook](automation-webhooks.md#creating-a-webhook) articolo e ricordare l'URL del webhook toorecord hello in modo che sia possibile utilizzarlo come riferimento durante la configurazione della regola di avviso hello.</span><span class="sxs-lookup"><span data-stu-id="84b31-115">Review and follow hello steps in hello [create a webhook](automation-webhooks.md#creating-a-webhook) article and remember toorecord hello webhook URL so that you can reference it while configuring hello alert rule.</span></span>   

## <a name="calling-a-runbook-directly"></a><span data-ttu-id="84b31-116">Chiamata diretta di un runbook</span><span class="sxs-lookup"><span data-stu-id="84b31-116">Calling a runbook directly</span></span>

<span data-ttu-id="84b31-117">Se si dispone di hello automazione & offerta controllo installato e configurato nell'area di lavoro OMS, quando si configura l'opzione di azioni hello Runbook per l'avviso hello, è possibile visualizzare tutti i runbook da hello **selezionare un runbook** elenco a discesa Selezionare hello specifico del runbook desiderato toorun nell'avviso toohello di risposta.</span><span class="sxs-lookup"><span data-stu-id="84b31-117">If you have hello Automation & Control offering installed and configured in your OMS workspace, when configuring hello Runbook actions option for hello alert, you can view all runbooks from hello **Select a runbook** dropdown list and select hello specific runbook you want toorun in response toohello alert.</span></span>  <span data-ttu-id="84b31-118">Hello selezionato runbook può eseguire in un'area di lavoro in hello cloud di Azure o in un runbook worker ibrido.</span><span class="sxs-lookup"><span data-stu-id="84b31-118">hello selected runbook can run in a workspace in hello Azure cloud or on a hybrid runbook worker.</span></span>  <span data-ttu-id="84b31-119">Quando l'avviso di hello viene creato utilizzando l'opzione runbook hello, verrà creato un webhook per hello runbook.</span><span class="sxs-lookup"><span data-stu-id="84b31-119">When hello alert is created using hello runbook option, a webhook will be created for hello runbook.</span></span>  <span data-ttu-id="84b31-120">Se si passa toohello account di automazione e passa toohello webhook pannello dei runbook hello selezionata, è possibile visualizzare hello webhook.</span><span class="sxs-lookup"><span data-stu-id="84b31-120">You can see hello webhook if you go toohello Automation account and navigate toohello webhook blade of hello selected runbook.</span></span>  <span data-ttu-id="84b31-121">Se si elimina l'avviso hello, hello webhook non viene eliminato, ma l'utente hello può eliminare il webhook hello manualmente.</span><span class="sxs-lookup"><span data-stu-id="84b31-121">If you delete hello alert, hello webhook is not deleted, but hello user can delete hello webhook manually.</span></span>  <span data-ttu-id="84b31-122">Non è un problema se hello webhook non è stato eliminato, è solo un elemento orfano che sarà necessario toobe eliminato nell'ordine toomaintain organizzata di un account di automazione.</span><span class="sxs-lookup"><span data-stu-id="84b31-122">It is not a problem if hello webhook is not deleted, it is just an orphaned item that will eventually need toobe deleted in order toomaintain an organized Automation account.</span></span>  

## <a name="characteristics-of-a-runbook-for-both-options"></a><span data-ttu-id="84b31-123">Caratteristiche di un runbook (per entrambe le opzioni)</span><span class="sxs-lookup"><span data-stu-id="84b31-123">Characteristics of a runbook (for both options)</span></span>

<span data-ttu-id="84b31-124">Entrambi i metodi per chiamare hello runbook da avviso Log Analitica hello hanno caratteristiche di un comportamento diverso che è necessario comprendere prima di configurare le regole di avviso toobe.</span><span class="sxs-lookup"><span data-stu-id="84b31-124">Both methods for calling hello runbook from hello Log Analytics alert have different behavior characteristics that need toobe understood before you configure your alert rules.</span></span>  

* <span data-ttu-id="84b31-125">È necessario avere un parametro di input del runbook denominato **WebhookData**, di tipo **Object**.</span><span class="sxs-lookup"><span data-stu-id="84b31-125">You must have a runbook input parameter called **WebhookData** that is **Object** type.</span></span>  <span data-ttu-id="84b31-126">Questo parametro può essere obbligatorio o facoltativo.</span><span class="sxs-lookup"><span data-stu-id="84b31-126">It can be mandatory or optional.</span></span>  <span data-ttu-id="84b31-127">avviso di Hello passa hello ricerca risultati toohello runbook utilizzando il parametro di input.</span><span class="sxs-lookup"><span data-stu-id="84b31-127">hello alert passes hello search results toohello runbook using this input parameter.</span></span>

        param  
         (  
          [Parameter (Mandatory=$true)]  
          [object] $WebhookData  
         )

*  <span data-ttu-id="84b31-128">È necessario disporre di oggetto di codice tooconvert hello WebhookData tooa PowerShell.</span><span class="sxs-lookup"><span data-stu-id="84b31-128">You must have code tooconvert hello WebhookData tooa PowerShell object.</span></span>

    `$SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value`

    <span data-ttu-id="84b31-129">*$SearchResults* sarà una matrice di oggetti; ogni oggetto contiene campi hello con i valori di un risultato di ricerca</span><span class="sxs-lookup"><span data-stu-id="84b31-129">*$SearchResults* will be an array of objects; each object contains hello fields with values from one search result</span></span>

### <a name="webhookdata-inconsistencies-between-hello-webhook-option-and-runbook-option"></a><span data-ttu-id="84b31-130">WebhookData incoerenze tra runbook e hello webhook opzione</span><span class="sxs-lookup"><span data-stu-id="84b31-130">WebhookData inconsistencies between hello webhook option and runbook option</span></span>

* <span data-ttu-id="84b31-131">Quando si configura un avviso toocall un Webhook, immettere un URL del webhook creato per un runbook e fare clic su hello **Webhook Test** pulsante.</span><span class="sxs-lookup"><span data-stu-id="84b31-131">When configuring an alert toocall a Webhook, enter a webhook URL you created for a runbook, and click hello **Test Webhook** button.</span></span>  <span data-ttu-id="84b31-132">Hello WebhookData risulta inviato toohello runbook non contiene *. SearchResult* o *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="84b31-132">hello resulting WebhookData sent toohello runbook does not contain either *.SearchResult* or *.SearchResults*.</span></span>

*  <span data-ttu-id="84b31-133">Se si salva tale avviso, quando l'avviso hello attiva e chiama webhook hello, hello WebhookData inviati toohello runbook contiene *. SearchResult*.</span><span class="sxs-lookup"><span data-stu-id="84b31-133">If you save that alert, when hello alert triggers and calls hello webhook, hello WebhookData sent toohello runbook contains *.SearchResult*.</span></span>
* <span data-ttu-id="84b31-134">Se si crea un avviso e configurarlo toocall un runbook (che crea anche un webhook), quando hello allarmi invia WebhookData toohello runbook che contiene *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="84b31-134">If you create an alert, and configure it toocall a runbook (which also creates a webhook), when hello alert triggers it sends WebhookData toohello runbook that contains *.SearchResults*.</span></span>

<span data-ttu-id="84b31-135">Nell'esempio di codice hello sopra, sarà pertanto necessario tooget *. SearchResult* se chiama un webhook avviso hello e sarà necessario tooget *. SearchResults* se avviso hello chiama un runbook direttamente.</span><span class="sxs-lookup"><span data-stu-id="84b31-135">Thus in hello code example above, you will need tooget *.SearchResult* if hello alert calls a webhook, and will need tooget *.SearchResults* if hello alert calls a runbook directly.</span></span>

## <a name="example-walkthrough"></a><span data-ttu-id="84b31-136">Procedura dettagliata di esempio</span><span class="sxs-lookup"><span data-stu-id="84b31-136">Example walkthrough</span></span>

<span data-ttu-id="84b31-137">Verrà illustrato il funzionamento tramite hello seguente runbook grafico di esempio, che avvia un servizio Windows.</span><span class="sxs-lookup"><span data-stu-id="84b31-137">We will demonstrate how this works by using hello following example graphical runbook, which starts a Windows service.</span></span><br><br> ![Avviare il runbook grafico per il servizio di Windows](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice.png)<br>

<span data-ttu-id="84b31-139">Hello runbook dispone di un parametro di input di tipo **oggetto** che viene chiamato **WebhookData** e include dati webhook hello passati da hello avviso contenente *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="84b31-139">hello runbook has one input parameter of type **Object** that is called **WebhookData** and includes hello webhook data passed from hello alert containing *.SearchResults*.</span></span><br><br> <span data-ttu-id="84b31-140">![Parametri di input dei runbook](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span><span class="sxs-lookup"><span data-stu-id="84b31-140">![Runbook input parameters](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span></span><br>

<span data-ttu-id="84b31-141">Per questo esempio, negli Analitica di Log sono stati creati due campi personalizzati, *SvcDisplayName_CF* e *SvcState_CF*, tooextract hello servizio Visualizza nome e hello lo stato del servizio hello (ad esempio in esecuzione o arrestato) evento hello scritto toohello registro eventi di sistema.</span><span class="sxs-lookup"><span data-stu-id="84b31-141">For this example, in Log Analytics we created two custom fields, *SvcDisplayName_CF* and *SvcState_CF*, tooextract hello service display name and hello state of hello service (i.e. running or stopped) from hello event written toohello System event log.</span></span>  <span data-ttu-id="84b31-142">È quindi creare una regola di avviso con hello seguenti query di ricerca: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` in modo che è possibile rilevare quando hello servizio Spooler di stampa è stato arrestato sul sistema di Windows hello.</span><span class="sxs-lookup"><span data-stu-id="84b31-142">We then create an alert rule with hello following search query: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` so that we can detect when hello Print Spooler service is stopped on hello Windows system.</span></span>  <span data-ttu-id="84b31-143">Può trattarsi di qualsiasi servizio di interesse, ma per questo esempio si sta facendo riferimento a uno dei servizi preesistenti di hello inclusi con sistema operativo Windows hello.</span><span class="sxs-lookup"><span data-stu-id="84b31-143">It can be any service of interest, but for this example we are referencing one of hello pre-existing services that are included with hello Windows OS.</span></span>  <span data-ttu-id="84b31-144">Azione avviso Hello è tooexecute configurato il runbook usato in questo esempio ed eseguire in hello Runbook Worker ibrido, che sono abilitati sui sistemi di destinazione hello.</span><span class="sxs-lookup"><span data-stu-id="84b31-144">hello alert action is configured tooexecute our runbook used in this example and run on hello Hybrid Runbook Worker, which are enabled on hello target systems.</span></span>   

<span data-ttu-id="84b31-145">attività del runbook codice Hello **ottenere il nome di servizio da LA** convertirà stringa hello in formato JSON in un tipo di oggetto e il filtro sull'elemento hello *SvcDisplayName_CF* nome visualizzato di hello tooextract di hello Servizio di Windows e passare la variabile nell'attività successiva hello verificherà hello servizio viene arrestato prima di tentare di toorestart è.</span><span class="sxs-lookup"><span data-stu-id="84b31-145">hello runbook code activity **Get Service Name from LA** will convert hello JSON-formatted string into an object type and filter on hello item *SvcDisplayName_CF* tooextract hello display name of hello Windows service and pass this onto hello next activity which will verify hello service is stopped before attempting toorestart it.</span></span>  <span data-ttu-id="84b31-146">*SvcDisplayName_CF* è un [campo personalizzato](../log-analytics/log-analytics-custom-fields.md) creato nel Log Analitica toodemonstrate in questo esempio.</span><span class="sxs-lookup"><span data-stu-id="84b31-146">*SvcDisplayName_CF* is a [custom field](../log-analytics/log-analytics-custom-fields.md) created in Log Analytics toodemonstrate this example.</span></span>

    $SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value
    $SearchResults.SvcDisplayName_CF  

<span data-ttu-id="84b31-147">Quando si arresta il servizio di hello, regola di avviso nel Log Analitica hello rileverà una corrispondenza e attivare il runbook hello e inviare hello al contesto dell'avviso toohello runbook.</span><span class="sxs-lookup"><span data-stu-id="84b31-147">When hello service stops, hello alert rule in Log Analytics will detect a match and trigger hello runbook and send hello alert context toohello runbook.</span></span> <span data-ttu-id="84b31-148">Hello runbook eseguirà l'azione tooverify hello servizio viene arrestato, e, se così toorestart tentativo hello servizio e verificare è stato avviato correttamente e risultati di hello di output.</span><span class="sxs-lookup"><span data-stu-id="84b31-148">hello runbook will take action tooverify hello service is stopped, and if so attempt toorestart hello service and verify it started correctly and output hello results.</span></span>     

<span data-ttu-id="84b31-149">In alternativa se non si dispone di automazione account collegato tooyour OMS area di lavoro, si sarebbe configurare la regola di avviso hello con un runbook di webhook azione tootrigger hello e configurare hello runbook tooconvert hello stringa in formato JSON e filtrare *. SearchResult* istruzioni disponibili hello indicato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="84b31-149">Alternatively if you don't have your Automation account linked tooyour OMS workspace, you would configure hello alert rule with a webhook action tootrigger hello runbook and configure hello runbook tooconvert hello JSON-formatted string and filter on *.SearchResult* following hello guidance mentioned earlier.</span></span>    

## <a name="next-steps"></a><span data-ttu-id="84b31-150">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="84b31-150">Next steps</span></span>

* <span data-ttu-id="84b31-151">ulteriori informazioni sugli avvisi nel registro Analitica toolearn e toocreate uno, vedere [gli avvisi nel registro Analitica](../log-analytics/log-analytics-alerts.md).</span><span class="sxs-lookup"><span data-stu-id="84b31-151">toolearn more about alerts in Log Analytics and how toocreate one, see [Alerts in Log Analytics](../log-analytics/log-analytics-alerts.md).</span></span>

* <span data-ttu-id="84b31-152">i runbook tootrigger utilizzando un webhook, vedere toounderstand [webhook di automazione di Azure](automation-webhooks.md).</span><span class="sxs-lookup"><span data-stu-id="84b31-152">toounderstand how tootrigger runbooks using a webhook, see [Azure Automation webhooks](automation-webhooks.md).</span></span>
