---
title: Failover TSQL:Initiate per il database SQL di Azure | Microsoft Docs
description: Avviare un failover pianificato o non pianificato per il database SQL di Azure usando Transact-SQL
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5eb2d256-025d-4f5a-99d4-17f702b37f14
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: 418953e044ba84ce758063d56a371af45d5cdfe1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2017
---
# <a name="initiate-a-planned-or-unplanned-failover-for-azure-sql-database-with-transact-sql"></a><span data-ttu-id="97aa4-103">Avviare un failover pianificato o non pianificato per il database SQL di Azure con Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="97aa4-103">Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL</span></span>

<span data-ttu-id="97aa4-104">In questo articolo illustra come tooinitiate failover tooa Database SQL secondario tramite Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="97aa4-104">This article shows you how tooinitiate failover tooa secondary SQL Database using Transact-SQL.</span></span> <span data-ttu-id="97aa4-105">tooconfigure-replica geografica, vedere [configurare la replica geografica per il Database di SQL Azure](sql-database-geo-replication-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="97aa4-105">tooconfigure geo-replication, see [Configure geo-replication for Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span></span>

<span data-ttu-id="97aa4-106">tooinitiate failover, è necessario seguente hello:</span><span class="sxs-lookup"><span data-stu-id="97aa4-106">tooinitiate failover, you need hello following:</span></span>

* <span data-ttu-id="97aa4-107">Un account di accesso DBManager su hello primario</span><span class="sxs-lookup"><span data-stu-id="97aa4-107">A login that is DBManager on hello primary</span></span>
* <span data-ttu-id="97aa4-108">Avere db_ownership del database locale di hello che sia necessario abilitare la replica geografica</span><span class="sxs-lookup"><span data-stu-id="97aa4-108">Have db_ownership of hello local database that you will geo-replicate</span></span>
* <span data-ttu-id="97aa4-109">Essere DBManager in toowhich server partner di hello verrà configurata la replica geografica</span><span class="sxs-lookup"><span data-stu-id="97aa4-109">Be DBManager on hello partner server(s) toowhich you will configure geo-replication</span></span>
* <span data-ttu-id="97aa4-110">La versione più recente di SQL Server Management Studio (SSMS)</span><span class="sxs-lookup"><span data-stu-id="97aa4-110">Newest version of SQL Server Management Studio (SSMS)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="97aa4-111">È consigliabile utilizzare sempre hello versione più recente di Management Studio tooremain sincronizzati con gli aggiornamenti tooMicrosoft Azure e il Database SQL.</span><span class="sxs-lookup"><span data-stu-id="97aa4-111">It is recommended that you always use hello latest version of Management Studio tooremain synchronized with updates tooMicrosoft Azure and SQL Database.</span></span> <span data-ttu-id="97aa4-112">[Aggiornare SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="97aa4-112">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>
>  

## <a name="initiate-a-planned-failover-promoting-a-secondary-database-toobecome-hello-new-primary"></a><span data-ttu-id="97aa4-113">Avviare un failover pianificato la promozione di un database secondario toobecome hello nuovo database primario</span><span class="sxs-lookup"><span data-stu-id="97aa4-113">Initiate a planned failover promoting a secondary database toobecome hello new primary</span></span>
<span data-ttu-id="97aa4-114">È possibile utilizzare hello **ALTER DATABASE** istruzione toopromote un database secondario toobecome hello nuovo database primario del database in modo pianificato toobecome primario esistente hello l'abbassamento di livello un database secondario.</span><span class="sxs-lookup"><span data-stu-id="97aa4-114">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in a planned fashion, demoting hello existing primary toobecome a secondary.</span></span> <span data-ttu-id="97aa4-115">Questa istruzione viene eseguita nel database master hello il server logico di hello Database SQL di Azure in cui hello risiede database secondari con replica geografica che viene innalzato di livello.</span><span class="sxs-lookup"><span data-stu-id="97aa4-115">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span> <span data-ttu-id="97aa4-116">Questa funzionalità è progettata per il failover pianificato, ad esempio durante il drill di ripristino di emergenza hello e richiede che il database primario hello siano disponibili.</span><span class="sxs-lookup"><span data-stu-id="97aa4-116">This functionality is designed for planned failover, such as during hello DR drills, and requires that hello primary database be available.</span></span>

<span data-ttu-id="97aa4-117">comando Hello esegue hello del flusso di lavoro seguente:</span><span class="sxs-lookup"><span data-stu-id="97aa4-117">hello command performs hello following workflow:</span></span>

1. <span data-ttu-id="97aa4-118">Temporaneamente in modalità toosynchronous replica commutatori, causando tutte le transazioni in sospeso toobe scaricate toohello secondario e il blocco di tutte le nuove transazioni;</span><span class="sxs-lookup"><span data-stu-id="97aa4-118">Temporarily switches replication toosynchronous mode, causing all outstanding transactions toobe flushed toohello secondary and blocking all new transactions;</span></span>
2. <span data-ttu-id="97aa4-119">Commutatori hello ruoli di database di due hello nella relazione di replica geografica hello.</span><span class="sxs-lookup"><span data-stu-id="97aa4-119">Switches hello roles of hello two databases in hello geo-replication partnership.</span></span>  

<span data-ttu-id="97aa4-120">Questa sequenza garantisce che hello due database siano sincronizzati prima di passare i ruoli di hello e pertanto si verificherà alcuna perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="97aa4-120">This sequence guarantees that hello two databases are synchronized before hello roles switch and therefore no data loss will occur.</span></span> <span data-ttu-id="97aa4-121">È un breve periodo durante il quale entrambi i database non sono disponibili (in ordine di hello di 0 secondi too25) durante il cambio di ruolo hello.</span><span class="sxs-lookup"><span data-stu-id="97aa4-121">There is a short period during which both databases are unavailable (on hello order of 0 too25 seconds) while hello roles are switched.</span></span> <span data-ttu-id="97aa4-122">Se il database primario hello dispone di più database secondari, il comando hello verrà automaticamente reconfigure hello altri database secondari tooconnect toohello nuovo database primario.</span><span class="sxs-lookup"><span data-stu-id="97aa4-122">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>  <span data-ttu-id="97aa4-123">intera operazione Hello richiederà meno di un minuto toocomplete in circostanze normali.</span><span class="sxs-lookup"><span data-stu-id="97aa4-123">hello entire operation should take less than a minute toocomplete under normal circumstances.</span></span> <span data-ttu-id="97aa4-124">Per altre informazioni, vedere [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) e [Livelli di servizio](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="97aa4-124">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>

<span data-ttu-id="97aa4-125">Utilizzare hello seguendo i passaggi tooinitiate un failover pianificato.</span><span class="sxs-lookup"><span data-stu-id="97aa4-125">Use hello following steps tooinitiate a planned failover.</span></span>

1. <span data-ttu-id="97aa4-126">In Management Studio, connettere il server logico di toohello Database SQL di Azure in cui risiede un database secondario di replica geografica.</span><span class="sxs-lookup"><span data-stu-id="97aa4-126">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="97aa4-127">Aprire hello cartella del database, espandere hello **database di sistema** pulsante destro del mouse nella cartella **master**, quindi fare clic su **nuova Query**.</span><span class="sxs-lookup"><span data-stu-id="97aa4-127">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="97aa4-128">Utilizzare la seguente hello **ALTER DATABASE** ruolo primario di istruzione tooswitch hello database secondario toohello.</span><span class="sxs-lookup"><span data-stu-id="97aa4-128">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB> FAILOVER;
4. <span data-ttu-id="97aa4-129">Fare clic su **Execute** query hello toorun.</span><span class="sxs-lookup"><span data-stu-id="97aa4-129">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="97aa4-130">In rari casi, è possibile che operazione hello non è possibile completare e che risulti bloccato.</span><span class="sxs-lookup"><span data-stu-id="97aa4-130">In rare cases, it is possible that hello operation cannot complete and may appear stuck.</span></span> <span data-ttu-id="97aa4-131">In questo caso, utente hello può eseguire il comando di failover forzato hello e accettare la perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="97aa4-131">In this case, hello user can execute hello force failover command and accept data loss.</span></span>
> 
> 

## <a name="initiate-an-unplanned-failover-from-hello-primary-database-toohello-secondary-database"></a><span data-ttu-id="97aa4-132">Avviare un failover non pianificato da database secondario di hello database primario toohello</span><span class="sxs-lookup"><span data-stu-id="97aa4-132">Initiate an unplanned failover from hello primary database toohello secondary database</span></span>
<span data-ttu-id="97aa4-133">È possibile utilizzare hello **ALTER DATABASE** istruzione toopromote un database secondario toobecome hello nuovo database primario del database in modo non pianificato, imporre l'abbassamento di livello hello di toobecome primario esistente hello un database secondario in un momento quando hello database primario non è più disponibile.</span><span class="sxs-lookup"><span data-stu-id="97aa4-133">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in an unplanned fashion, forcing hello demotion of hello existing primary toobecome a secondary at a time when hello primary database is no longer available.</span></span> <span data-ttu-id="97aa4-134">Questa istruzione viene eseguita nel database master hello il server logico di hello Database SQL di Azure in cui hello risiede database secondari con replica geografica che viene innalzato di livello.</span><span class="sxs-lookup"><span data-stu-id="97aa4-134">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span>

<span data-ttu-id="97aa4-135">Questa funzionalità è progettata per il ripristino di emergenza quando la disponibilità di ripristino del database hello è critico e perdita di dati è accettabile.</span><span class="sxs-lookup"><span data-stu-id="97aa4-135">This functionality is designed for disaster recovery when restoring availability of hello database is critical and some data loss is acceptable.</span></span> <span data-ttu-id="97aa4-136">Quando viene richiamato il failover forzato, hello specificato immediatamente database secondario diventa hello database primario e inizia ad accettare transazioni di scrittura.</span><span class="sxs-lookup"><span data-stu-id="97aa4-136">When forced failover is invoked, hello specified secondary database immediately becomes hello primary database and begins accepting write transactions.</span></span> <span data-ttu-id="97aa4-137">Come database primario originale hello è in grado di tooreconnect con questo nuovo database primario, un backup incrementale viene eseguito sul database primario originale hello e database primario precedente hello viene trasformata in un database secondario per hello nuovo database primario; Successivamente, è semplicemente una replica di sincronizzazione del nuovo database primario di hello.</span><span class="sxs-lookup"><span data-stu-id="97aa4-137">As soon as hello original primary database is able tooreconnect with this new primary database, an incremental backup is taken on hello original primary database and hello old primary database is made into a secondary database for hello new primary database; subsequently, it is merely a synchronizing replica of hello new primary.</span></span>

<span data-ttu-id="97aa4-138">Tuttavia, poiché ripristino temporizzato non è supportato nei database secondari hello, se desidera hello toorecover dati eseguito il commit toohello database primario precedente che non fosse stata replicata toohello nuovo database primario prima che si è verificato il failover forzato hello, Salve, sarà necessario utente tooengage supporto toorecover questa perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="97aa4-138">However, because Point In Time Restore is not supported on hello secondary databases, if hello user wishes toorecover data committed toohello old primary database that had not been replicated toohello new primary database before hello forced failover occurred, hello user will need tooengage support toorecover this lost data.</span></span>

<span data-ttu-id="97aa4-139">Se il database primario hello dispone di più database secondari, il comando hello verrà automaticamente reconfigure hello altri database secondari tooconnect toohello nuovo database primario.</span><span class="sxs-lookup"><span data-stu-id="97aa4-139">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>

<span data-ttu-id="97aa4-140">Utilizzare hello seguendo i passaggi tooinitiate un failover non pianificato.</span><span class="sxs-lookup"><span data-stu-id="97aa4-140">Use hello following steps tooinitiate an unplanned failover.</span></span>

1. <span data-ttu-id="97aa4-141">In Management Studio, connettere il server logico di toohello Database SQL di Azure in cui risiede un database secondario di replica geografica.</span><span class="sxs-lookup"><span data-stu-id="97aa4-141">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="97aa4-142">Aprire hello cartella del database, espandere hello **database di sistema** pulsante destro del mouse nella cartella **master**, quindi fare clic su **nuova Query**.</span><span class="sxs-lookup"><span data-stu-id="97aa4-142">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="97aa4-143">Utilizzare la seguente hello **ALTER DATABASE** ruolo primario di istruzione tooswitch hello database secondario toohello.</span><span class="sxs-lookup"><span data-stu-id="97aa4-143">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB>   FORCE_FAILOVER_ALLOW_DATA_LOSS;
4. <span data-ttu-id="97aa4-144">Fare clic su **Execute** query hello toorun.</span><span class="sxs-lookup"><span data-stu-id="97aa4-144">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="97aa4-145">Se il comando hello viene emesso quando sia primario e secondario sono online primario precedente hello diventerà hello nuovo database secondario immediatamente senza la sincronizzazione dei dati.</span><span class="sxs-lookup"><span data-stu-id="97aa4-145">If hello command is issued when both primary and secondary are online hello old primary will become hello new secondary immediately without data synchronization.</span></span> <span data-ttu-id="97aa4-146">Se è hello primario possono verificarsi il commit delle transazioni quando il comando hello viene eseguito una perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="97aa4-146">If hello primary is committing transactions when hello command is issued some data loss may occur.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="97aa4-147">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="97aa4-147">Next steps</span></span>
* <span data-ttu-id="97aa4-148">Dopo il failover, verificare i requisiti di autenticazione hello per server e database sono configurati nel nuovo database primario di hello.</span><span class="sxs-lookup"><span data-stu-id="97aa4-148">After failover, ensure hello authentication requirements for your server and database are configured on hello new primary.</span></span> <span data-ttu-id="97aa4-149">Per tutti i dettagli, vedere l'articolo sulla [sicurezza del database SQL di Azure dopo il ripristino di emergenza](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="97aa4-149">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="97aa4-150">toolearn ripristino dopo un'emergenza mediante la replica geografica attiva, inclusi i passaggi di pre- ripristino di e post-ripristino e l'esecuzione di un'analisi di ripristino di emergenza, vedere [il ripristino di emergenza](sql-database-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="97aa4-150">toolearn recovering after a disaster using active geo-replication, including pre-recovery and post-recovery steps and performing a disaster recovery drill, see [Disaster Recovery](sql-database-disaster-recovery.md)</span></span>
* <span data-ttu-id="97aa4-151">Per un post di blog di Sasha Nosov sulla replica geografica attiva, vedere [Spotlight on new Geo-Replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/) (Le nuove capacità di replica geografica)</span><span class="sxs-lookup"><span data-stu-id="97aa4-151">For a Sasha Nosov blog post about active geo-replication, see [Spotlight on new geo-replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span></span>
* <span data-ttu-id="97aa4-152">Per informazioni sulla progettazione cloud applicazioni toouse replica geografica attiva, vedere [progettazione di applicazioni cloud per la continuità aziendale usando la replica geografica](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="97aa4-152">For information about designing cloud applications toouse active geo-replication, see [Designing cloud applications for business continuity using geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span></span>
* <span data-ttu-id="97aa4-153">Per informazioni sulla replica geografica attiva con i pool elastici, vedere [Strategie di ripristino di emergenza con pool elastico](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="97aa4-153">For information about using active geo-replication with elastic pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
* <span data-ttu-id="97aa4-154">Per un quadro generale, vedere la [panoramica della continuità aziendale](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="97aa4-154">For an overview of business continuity, see [Business Continuity Overview](sql-database-business-continuity.md)</span></span>

