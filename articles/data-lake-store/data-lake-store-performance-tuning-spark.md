---
title: Linee guida per l'ottimizzazione delle prestazioni di Spark in Azure Data Lake Store | Documentazione Microsoft
description: Linee guida per l'ottimizzazione delle prestazioni di Spark in Azure Data Lake Store
services: data-lake-store
documentationcenter: 
author: stewu
manager: amitkul
editor: stewu
ms.assetid: ebde7b9f-2e51-4d43-b7ab-566417221335
ms.service: data-lake-store
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 12/19/2016
ms.author: stewu
ms.openlocfilehash: 2109744fb7ffdfafb7a86bbea355e119718af099
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="performance-tuning-guidance-for-spark-on-hdinsight-and-azure-data-lake-store"></a><span data-ttu-id="39694-103">Linee guida per l'ottimizzazione delle prestazioni di Spark in HDInsight e di Azure Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="39694-103">Performance tuning guidance for Spark on HDInsight and Azure Data Lake Store</span></span>

<span data-ttu-id="39694-104">Per l'ottimizzazione delle prestazioni in Spark, è necessario considerare il numero di applicazioni che verranno eseguite nel cluster.</span><span class="sxs-lookup"><span data-stu-id="39694-104">When tuning performance on Spark, you need to consider the number of apps that will be running on your cluster.</span></span>  <span data-ttu-id="39694-105">Per impostazione predefinita, nel cluster HDI è possibile eseguire 4 app simultaneamente (nota: l'impostazione predefinita è soggetta a modifiche).</span><span class="sxs-lookup"><span data-stu-id="39694-105">By default, you can run 4 apps concurrently on your HDI cluster (Note: the default setting is subject to change).</span></span>  <span data-ttu-id="39694-106">È possibile decidere di usare un numero inferiore di app in modo da sostituire le impostazioni predefinite e usare una parte più ampia del cluster per tali applicazioni.</span><span class="sxs-lookup"><span data-stu-id="39694-106">You may decide to use fewer apps so you can override the default settings and use more of the cluster for those apps.</span></span>  

## <a name="prerequisites"></a><span data-ttu-id="39694-107">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="39694-107">Prerequisites</span></span>

* <span data-ttu-id="39694-108">**Una sottoscrizione di Azure**.</span><span class="sxs-lookup"><span data-stu-id="39694-108">**An Azure subscription**.</span></span> <span data-ttu-id="39694-109">Vedere [Ottenere una versione di valutazione gratuita di Azure](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="39694-109">See [Get Azure free trial](https://azure.microsoft.com/pricing/free-trial/).</span></span>
* <span data-ttu-id="39694-110">**Un account di Archivio Data Lake di Azure**.</span><span class="sxs-lookup"><span data-stu-id="39694-110">**An Azure Data Lake Store account**.</span></span> <span data-ttu-id="39694-111">Per istruzioni su come crearne uno, vedere [Introduzione ad Archivio Data Lake di Azure](data-lake-store-get-started-portal.md)</span><span class="sxs-lookup"><span data-stu-id="39694-111">For instructions on how to create one, see [Get started with Azure Data Lake Store](data-lake-store-get-started-portal.md)</span></span>
* <span data-ttu-id="39694-112">**Cluster Azure HDInsight** con accesso a un account di Archivio Data Lake.</span><span class="sxs-lookup"><span data-stu-id="39694-112">**Azure HDInsight cluster** with access to a Data Lake Store account.</span></span> <span data-ttu-id="39694-113">Vedere [Creare un cluster HDInsight con Data Lake Store tramite il portale di Azure](data-lake-store-hdinsight-hadoop-use-portal.md).</span><span class="sxs-lookup"><span data-stu-id="39694-113">See [Create an HDInsight cluster with Data Lake Store](data-lake-store-hdinsight-hadoop-use-portal.md).</span></span> <span data-ttu-id="39694-114">Assicurarsi di abilitare il Desktop remoto per il cluster.</span><span class="sxs-lookup"><span data-stu-id="39694-114">Make sure you enable Remote Desktop for the cluster.</span></span>
* <span data-ttu-id="39694-115">**Esecuzione di cluster Spark in Azure Data Lake Store**.</span><span class="sxs-lookup"><span data-stu-id="39694-115">**Running Spark cluster on Azure Data Lake Store**.</span></span>  <span data-ttu-id="39694-116">Per altre informazioni, vedere [Usare il cluster Spark di HDInsight per analizzare i dati in Data Lake Store](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-apache-spark-use-with-data-lake-store).</span><span class="sxs-lookup"><span data-stu-id="39694-116">For more information, see [Use HDInsight Spark cluster to analyze data in Data Lake Store](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-apache-spark-use-with-data-lake-store)</span></span>
* <span data-ttu-id="39694-117">**Linee guida per l'ottimizzazione delle prestazioni in ADLS**.</span><span class="sxs-lookup"><span data-stu-id="39694-117">**Performance tuning guidelines on ADLS**.</span></span>  <span data-ttu-id="39694-118">Per i concetti generali relativi alle prestazioni, vedere [Linee guida per l'ottimizzazione delle prestazioni in Data Lake Store](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance)</span><span class="sxs-lookup"><span data-stu-id="39694-118">For general performance concepts, see [Data Lake Store Performance Tuning Guidance](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance)</span></span> 

## <a name="parameters"></a><span data-ttu-id="39694-119">parameters</span><span class="sxs-lookup"><span data-stu-id="39694-119">Parameters</span></span>

<span data-ttu-id="39694-120">Si riportano di seguito le impostazioni più importanti che possono essere ottimizzate per migliorare le prestazioni in ADLS durante l'esecuzione di processi Spark:</span><span class="sxs-lookup"><span data-stu-id="39694-120">When running Spark jobs, here are the most important settings that can be tuned to increase performance on ADLS:</span></span>

* <span data-ttu-id="39694-121">**Num-executors**: numero di attività che è possibile eseguire simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="39694-121">**Num-executors** - The number of concurrent tasks that can be executed.</span></span>

* <span data-ttu-id="39694-122">**Executor-memory**: quantità di memoria allocata per ogni executor.</span><span class="sxs-lookup"><span data-stu-id="39694-122">**Executor-memory** - The amount of memory allocated to each executor.</span></span>

* <span data-ttu-id="39694-123">**Executor-cores**: numero di core allocati per ogni executor.</span><span class="sxs-lookup"><span data-stu-id="39694-123">**Executor-cores** - The number of cores allocated to each executor.</span></span>                     

<span data-ttu-id="39694-124">**Num-executors**. I Num-executors impostano il numero massimo di attività che è possibile eseguire in parallelo.</span><span class="sxs-lookup"><span data-stu-id="39694-124">**Num-executors** Num-executors will set the maximum number of tasks that can run in parallel.</span></span>  <span data-ttu-id="39694-125">Il numero effettivo di attività che possono essere eseguite in parallelo è limitato dalle risorse di memoria e CPU disponibili nel cluster.</span><span class="sxs-lookup"><span data-stu-id="39694-125">The actual number of tasks that can run in parallel is bounded by the memory and CPU resources available in your cluster.</span></span>

<span data-ttu-id="39694-126">**Executor-memory**. Si tratta della quantità di memoria che viene allocata per ogni executor.</span><span class="sxs-lookup"><span data-stu-id="39694-126">**Executor-memory** This is the amount of memory that is being allocated to each executor.</span></span>  <span data-ttu-id="39694-127">La memoria necessaria per ogni executor dipende dal processo.</span><span class="sxs-lookup"><span data-stu-id="39694-127">The memory needed for each executor is dependent on the job.</span></span>  <span data-ttu-id="39694-128">Per operazioni complesse, la quantità di memoria deve essere maggiore.</span><span class="sxs-lookup"><span data-stu-id="39694-128">For complex operations, the memory needs to be higher.</span></span>  <span data-ttu-id="39694-129">Per operazioni semplici come la lettura e la scrittura, la quantità di memoria richiesta è inferiore.</span><span class="sxs-lookup"><span data-stu-id="39694-129">For simple operations like read and write, memory requirements will be lower.</span></span>  <span data-ttu-id="39694-130">La quantità di memoria necessaria per ogni executor è disponibile in Ambari.</span><span class="sxs-lookup"><span data-stu-id="39694-130">The amount of memory for each executor can be viewed in Ambari.</span></span>  <span data-ttu-id="39694-131">In Ambari passare a Spark e visualizzare la scheda Configs (Configurazioni).</span><span class="sxs-lookup"><span data-stu-id="39694-131">In Ambari, navigate to Spark and view the Configs tab.</span></span>  

<span data-ttu-id="39694-132">**Executor-cores**. Definisce la quantità di core usati dall'executor predefinito, che determina il numero di thread paralleli che è possibile eseguire su ogni executor.</span><span class="sxs-lookup"><span data-stu-id="39694-132">**Executor-cores** This sets the amount of cores used per executor, which determines the number of parallel threads that can be run per executor.</span></span>  <span data-ttu-id="39694-133">Ad esempio, se executor-cores = 2, ogni executor può eseguire 2 attività parallele nell'executor.</span><span class="sxs-lookup"><span data-stu-id="39694-133">For example, if executor-cores = 2, then each executor can run 2 parallel tasks in the executor.</span></span>  <span data-ttu-id="39694-134">Gli executor-cores necessari dipendono dal processo.</span><span class="sxs-lookup"><span data-stu-id="39694-134">The executor-cores needed will be dependent on the job.</span></span>  <span data-ttu-id="39694-135">I processi I/O intensivi non richiedono una grande quantità di memoria per ogni attività. In questo modo, ogni executor può gestire più attività in parallelo.</span><span class="sxs-lookup"><span data-stu-id="39694-135">I/O heavy jobs do not require a large amount of memory per task so each executor can handle more parallel tasks.</span></span>

<span data-ttu-id="39694-136">Per impostazione predefinita, durante l'esecuzione di Spark in HDInsight, vengono definiti due core YARN virtuali per ogni core fisico.</span><span class="sxs-lookup"><span data-stu-id="39694-136">By default, two virtual YARN cores are defined for each physical core when running Spark on HDInsight.</span></span>  <span data-ttu-id="39694-137">Questo numero fornisce un buon bilanciamento tra concorrenza e quantità di contesto nel passaggio tra più thread.</span><span class="sxs-lookup"><span data-stu-id="39694-137">This number provides a good balance of concurrecy and amount of context switching from multiple threads.</span></span>  

## <a name="guidance"></a><span data-ttu-id="39694-138">Indicazioni</span><span class="sxs-lookup"><span data-stu-id="39694-138">Guidance</span></span>

<span data-ttu-id="39694-139">Durante l'esecuzione di carichi di lavoro analitici di Spark per l'elaborazione dei dati in Data Lake Store, si consiglia di usare la versione più recente del cluster HDInsight per ottenere prestazioni ottimali con Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="39694-139">While running Spark analytic workloads to work with data in Data Lake Store, we recommend that you use the most recent HDInsight version to get the best performance with Data Lake Store.</span></span> <span data-ttu-id="39694-140">Quando il processo prevede un I/O più intensivo, è possibile configurare alcuni parametri per migliorare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="39694-140">When your job is more I/O intensive, then certain parameters can be configured to improve performance.</span></span>  <span data-ttu-id="39694-141">Azure Data Lake Store è una piattaforma di archiviazione altamente scalabile in grado di gestire un'elevata velocità effettiva.</span><span class="sxs-lookup"><span data-stu-id="39694-141">Azure Data Lake Store is a highly scalable storage platform that can handle high throughput.</span></span>  <span data-ttu-id="39694-142">Se il processo è costituito principalmente da lettura o scrittura, l'aumento della concorrenza di I/O da e verso Azure Data Lake Store potrebbe migliorare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="39694-142">If the job mainly consists of read or writes, then increasing concurrency for I/O to and from Azure Data Lake Store could increase performance.</span></span>

<span data-ttu-id="39694-143">Esistono alcuni modi generali per aumentare la concorrenza per i processi con I/O intensivo.</span><span class="sxs-lookup"><span data-stu-id="39694-143">There are a few general ways to increase concurrency for I/O intensive jobs.</span></span>

<span data-ttu-id="39694-144">**Passaggio 1: Determinare il numero di app in esecuzione nel cluster**. È necessario conoscere il numero di applicazioni in esecuzione nel cluster, inclusa quella corrente.</span><span class="sxs-lookup"><span data-stu-id="39694-144">**Step 1: Determine how many apps are running on your cluster** – You should know how many apps are running on the cluster including the current one.</span></span>  <span data-ttu-id="39694-145">I valori predefiniti per ogni impostazione Spark presumono che siano presenti 4 applicazioni in esecuzione contemporanea.</span><span class="sxs-lookup"><span data-stu-id="39694-145">The default values for each Spark setting assumes that there are 4 apps running concurrently.</span></span>  <span data-ttu-id="39694-146">Pertanto, si disporrà solo del 25% del cluster per ogni applicazione.</span><span class="sxs-lookup"><span data-stu-id="39694-146">Therefore, you will only have 25% of the cluster available for each app.</span></span>  <span data-ttu-id="39694-147">Per ottenere prestazioni migliori, è possibile sostituire le impostazioni predefinite modificando il numero di executor.</span><span class="sxs-lookup"><span data-stu-id="39694-147">To get better performance, you can override the defaults by changing the number of executors.</span></span>  

<span data-ttu-id="39694-148">**Passaggio 2: Impostare executor-memory**. La prima cosa da impostare è la memoria dell'executor.</span><span class="sxs-lookup"><span data-stu-id="39694-148">**Step 2: Set executor-memory** – the first thing to set is the executor-memory.</span></span>  <span data-ttu-id="39694-149">La memoria dipende dal processo da eseguire.</span><span class="sxs-lookup"><span data-stu-id="39694-149">The memory will be dependent on the job that you are going to run.</span></span>  <span data-ttu-id="39694-150">È possibile aumentare la concorrenza allocando una quantità inferiore di memoria per ogni executor.</span><span class="sxs-lookup"><span data-stu-id="39694-150">You can increase concurrency by allocating less memory per executor.</span></span>  <span data-ttu-id="39694-151">Se vengono visualizzate eccezioni di memoria insufficiente quando si esegue il processo, è necessario aumentare il valore di questo parametro.</span><span class="sxs-lookup"><span data-stu-id="39694-151">If you see out of memory exceptions when you run your job, then you should increase the value for this parameter.</span></span>  <span data-ttu-id="39694-152">In alternativa è possibile ottenere una maggiore quantità di memoria usando un cluster con maggiore memoria oppure aumentando le dimensioni del cluster.</span><span class="sxs-lookup"><span data-stu-id="39694-152">One alternative is to get more memory by using a cluster that has higher amounts of memory or increasing the size of your cluster.</span></span>  <span data-ttu-id="39694-153">Una maggiore quantità di memoria consentirà di usare più executor, ottenendo così più concorrenza.</span><span class="sxs-lookup"><span data-stu-id="39694-153">More memory will enable more executors to be used, which means more concurrency.</span></span>

<span data-ttu-id="39694-154">**Passaggio 3: Impostare executor-cores**. Per carichi di lavoro I/O intensivi che non prevedono operazioni complesse, è consigliabile iniziare con un numero elevato di core per ogni executor al fine di aumentare il numero di attività parallele per ognuno di essi.</span><span class="sxs-lookup"><span data-stu-id="39694-154">**Step 3: Set executor-cores** – For I/O intensive workloads that do not have complex operations, it’s good to start with a high number of executor-cores to increase the number of parallel tasks per executor.</span></span>  <span data-ttu-id="39694-155">Per iniziare, è consigliabile impostare executor-cores su 4.</span><span class="sxs-lookup"><span data-stu-id="39694-155">Setting executor-cores to 4 is a good start.</span></span>   

    executor-cores = 4
<span data-ttu-id="39694-156">L'aumento del numero di core dell'executor offrirà maggior parallelismo in modo che sia possibile sperimentare diversi core dell'executor.</span><span class="sxs-lookup"><span data-stu-id="39694-156">Increasing the number of executor-cores will give you more parallelism so you can experiment with different executor-cores.</span></span>  <span data-ttu-id="39694-157">Per i processi che includono operazioni più complesse, è necessario ridurre il numero di core per ogni executor.</span><span class="sxs-lookup"><span data-stu-id="39694-157">For jobs that have more complex operations, you should reduce the number of cores per executor.</span></span>  <span data-ttu-id="39694-158">Se executor-cores viene impostato su un valore superiore a 4, la Garbage Collection può diventare inefficiente e incidere negativamente sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="39694-158">If executor-cores is set higher than 4, then garbage collection may become inefficient and degrade performance.</span></span>

<span data-ttu-id="39694-159">**Passaggio 4: Determinare la quantità di memoria YARN nel cluster**. Queste informazioni sono disponibili in Ambari.</span><span class="sxs-lookup"><span data-stu-id="39694-159">**Step 4: Determine amount of YARN memory in cluster** – This information is available in Ambari.</span></span>  <span data-ttu-id="39694-160">Passare a YARN e visualizzare la scheda Configs (Configurazioni).</span><span class="sxs-lookup"><span data-stu-id="39694-160">Navigate to YARN and view the Configs tab.</span></span>  <span data-ttu-id="39694-161">La memoria YARN è visualizzata in questa finestra.</span><span class="sxs-lookup"><span data-stu-id="39694-161">The YARN memory is displayed in this window.</span></span>  
<span data-ttu-id="39694-162">Nota: nella finestra è possibile anche visualizzare anche le dimensioni predefinite del contenitore YARN.</span><span class="sxs-lookup"><span data-stu-id="39694-162">Note: while you are in the window, you can also see the default YARN container size.</span></span>  <span data-ttu-id="39694-163">Le dimensioni del contenitore YARN sono uguali alle dimensioni della memoria per ogni parametro executor.</span><span class="sxs-lookup"><span data-stu-id="39694-163">The YARN container size is the same as memory per executor paramter.</span></span>

    Total YARN memory = nodes * YARN memory per node
<span data-ttu-id="39694-164">**Passaggio 5: Calcolare num-executors**</span><span class="sxs-lookup"><span data-stu-id="39694-164">**Step 5: Calculate num-executors**</span></span>

<span data-ttu-id="39694-165">**Calcolare il vincolo della memoria**. Il parametro num-executors è vincolato dalla memoria o dalla CPU.</span><span class="sxs-lookup"><span data-stu-id="39694-165">**Calculate memory constraint** - The num-executors parameter is constrained either by memory or by CPU.</span></span>  <span data-ttu-id="39694-166">Il vincolo di memoria è determinato dalla quantità di memoria YARN disponibile per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="39694-166">The memory constraint is determined by the amount of available YARN memory for your application.</span></span>  <span data-ttu-id="39694-167">Prendere il valore della memoria totale di YARN e dividerlo per il valore executor-memory.</span><span class="sxs-lookup"><span data-stu-id="39694-167">You should take total YARN memory and divide that by executor-memory.</span></span>  <span data-ttu-id="39694-168">Il vincolo deve essere diviso per il numero di applicazioni.</span><span class="sxs-lookup"><span data-stu-id="39694-168">The constraint needs to be de-scaled for the number of apps so we divide by the number of apps.</span></span>

    Memory constraint = (total YARN memory / executor memory) / # of apps   
<span data-ttu-id="39694-169">**Calcolare il vincolo della CPU**. Il vincolo della CPU viene calcolato come il numero totale dei core virtuali diviso per il numero di core per ogni executor.</span><span class="sxs-lookup"><span data-stu-id="39694-169">**Calculate CPU constraint** - The CPU constraint is calculated as the total virtual cores divided by the number of cores per executor.</span></span>  <span data-ttu-id="39694-170">Per ogni core fisico sono presenti 2 core virtuali.</span><span class="sxs-lookup"><span data-stu-id="39694-170">There are 2 virtual cores for each physical core.</span></span>  <span data-ttu-id="39694-171">Come per il vincolo di memoria, questo valore viene diviso per il numero di applicazioni.</span><span class="sxs-lookup"><span data-stu-id="39694-171">Similar to the memory constraint, we have divide by the number of apps.</span></span>

    virtual cores = (nodes in cluster * # of physical cores in node * 2)
    CPU constraint = (total virtual cores / # of cores per executor) / # of apps
<span data-ttu-id="39694-172">**Impostare num-executors**. Il parametro num-executors viene determinato dal valore minimo del vincolo della memoria e del vincolo della CPU.</span><span class="sxs-lookup"><span data-stu-id="39694-172">**Set num-executors** – The num-executors parameter is determined by taking the minimum of the memory constraint and the CPU constraint.</span></span> 

    num-executors = Min (total virtual Cores / # of cores per executor, available YARN memory / executor-memory)   
<span data-ttu-id="39694-173">Impostare un numero maggiore di num-executors non si traduce necessariamente in un miglioramento delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="39694-173">Setting a higher number of num-executors does not necessarily increase performance.</span></span>  <span data-ttu-id="39694-174">Si noti che l'aggiunta di esecutori può comportare un carico extra per ciascuno di questi ultimi, con una potenziale diminuzione delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="39694-174">You should consider that adding more executors will add extra overhead for each additional executor, which can potentially degrade performance.</span></span>  <span data-ttu-id="39694-175">I num-executors sono limitati dalle risorse del cluster.</span><span class="sxs-lookup"><span data-stu-id="39694-175">Num-executors is bounded by the cluster resources.</span></span>    

## <a name="example-calculation"></a><span data-ttu-id="39694-176">Calcolo di esempio</span><span class="sxs-lookup"><span data-stu-id="39694-176">Example Calculation</span></span>

<span data-ttu-id="39694-177">Si supponga di disporre di un cluster costituito da 8 nodi D4v2 che eseguono 2 applicazioni, inclusa quella che si è in procinto di eseguire.</span><span class="sxs-lookup"><span data-stu-id="39694-177">Let’s say you currently have a cluster composed of 8 D4v2 nodes that is running 2 apps including the one you are going to run.</span></span>  

<span data-ttu-id="39694-178">**Passaggio 1: Determinare il numero di app in esecuzione nel cluster**. L'utente sa di avere 2 app nel cluster, inclusa quella corrente.</span><span class="sxs-lookup"><span data-stu-id="39694-178">**Step 1: Determine how many apps are running on your cluster** – you know that you have 2 apps on your cluster, including the one you are going to run.</span></span>  

<span data-ttu-id="39694-179">**Passaggio 2: Impostare executor-memory**. Per questo esempio, si stabilisce che 6 GB di memoria per executor saranno sufficienti per il processo I/O intensivo.</span><span class="sxs-lookup"><span data-stu-id="39694-179">**Step 2: Set executor-memory** – for this example, we determine that 6GB of executor-memory will be sufficient for I/O intensive job.</span></span>  

    executor-memory = 6GB
<span data-ttu-id="39694-180">**Passaggio 3: Impostare executor-cores**. Poiché si tratta di un processo I/O intensivo, è possibile impostare su 4 il numero di core per ogni executor.</span><span class="sxs-lookup"><span data-stu-id="39694-180">**Step 3: Set executor-cores** – Since this is an I/O intensive job, we can set the number of cores for each executor to 4.</span></span>  <span data-ttu-id="39694-181">L'impostazione di un numero di core per executor superiore a 4 può causare problemi alla Garbage Collection.</span><span class="sxs-lookup"><span data-stu-id="39694-181">Setting cores per executor to larger than 4 may cause garbage collection problems.</span></span>  

    executor-cores = 4
<span data-ttu-id="39694-182">**Passaggio 4: Determinare la quantità di memoria YARN nel cluster**. Aprendo Ambari, si scopre che ogni D4v2 dispone di 25 GB di memoria YARN.</span><span class="sxs-lookup"><span data-stu-id="39694-182">**Step 4: Determine amount of YARN memory in cluster** – We navigate to Ambari to find out that each D4v2 has 25GB of YARN memory.</span></span>  <span data-ttu-id="39694-183">Poiché sono presenti 8 nodi, la memoria di YARN disponibile viene moltiplicata per 8.</span><span class="sxs-lookup"><span data-stu-id="39694-183">Since there are 8 nodes, the available YARN memory is multiplied by 8.</span></span>

    Total YARN memory = nodes * YARN memory* per node
    Total YARN memory = 8 nodes * 25GB = 200GB
<span data-ttu-id="39694-184">**Passaggio 5: Impostare num-executors**. Il parametro num-executors viene determinato dal valore minimo del vincolo della memoria e del vincolo della CPU, divisi per il numero di app in esecuzione su Spark.</span><span class="sxs-lookup"><span data-stu-id="39694-184">**Step 5: Calculate num-executors** – The num-executors parameter is determined by taking the minimum of the memory constraint and the CPU constraint divided by the # of apps running on Spark.</span></span>    

<span data-ttu-id="39694-185">**Calcolare il vincolo della memoria**. Il vincolo della memoria viene calcolato come la memoria totale di YARN divisa per la memoria di ogni executor.</span><span class="sxs-lookup"><span data-stu-id="39694-185">**Calculate memory constraint** – The memory constraint is calculated as the total YARN memory divided by the memory per executor.</span></span>

    Memory constraint = (total YARN memory / executor memory) / # of apps   
    Memory constraint = (200GB / 6GB) / 2   
    Memory constraint = 16 (rounded)
<span data-ttu-id="39694-186">**Calcolare il vincolo della CPU**. Il vincolo della CPU viene calcolato come il numero totale dei core di YARN diviso per il numero di core per ogni executor.</span><span class="sxs-lookup"><span data-stu-id="39694-186">**Calculate CPU constraint** - The CPU constraint is calculated as the total yarn cores divided by the number of cores per executor.</span></span>
    
    YARN cores = nodes in cluster * # of cores per node * 2   
    YARN cores = 8 nodes * 8 cores per D14 * 2 = 128
    CPU constraint = (total YARN cores / # of cores per executor) / # of apps
    CPU constraint = (128 / 4) / 2
    CPU constraint = 16
<span data-ttu-id="39694-187">**Impostare num-executors**</span><span class="sxs-lookup"><span data-stu-id="39694-187">**Set num-executors**</span></span>

    num-executors = Min (memory constraint, CPU constraint)
    num-executors = Min (16, 16)
    num-executors = 16    

