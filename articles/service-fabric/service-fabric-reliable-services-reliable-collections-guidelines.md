---
title: Linee guida e consigli per Reliable Collections in Azure Service Fabric | Microsoft Docs
description: Linee guida e consigli per l'uso di Reliable Collections in Service Fabric
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/3/2017
ms.author: mcoskun
ms.openlocfilehash: 053a7bca76362035e428fc11806b3e4f83d00946
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/11/2017
---
# <a name="guidelines-and-recommendations-for-reliable-collections-in-azure-service-fabric"></a><span data-ttu-id="8cb52-103">Linee guida e consigli per Reliable Collections in Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="8cb52-103">Guidelines and recommendations for Reliable Collections in Azure Service Fabric</span></span>
<span data-ttu-id="8cb52-104">Questa sezione fornisce le linee guida per l'uso di Reliable State Manager e Reliable Collections.</span><span class="sxs-lookup"><span data-stu-id="8cb52-104">This section provides guidelines for using Reliable State Manager and Reliable Collections.</span></span> <span data-ttu-id="8cb52-105">L'obiettivo è quello di aiutare gli utenti a evitare errori comuni.</span><span class="sxs-lookup"><span data-stu-id="8cb52-105">The goal is to help users avoid common pitfalls.</span></span>

<span data-ttu-id="8cb52-106">Le linee guida sono organizzate come semplici consigli*su cosa fare* , *prendere in considerazione* , *evitare* e*non fare*.</span><span class="sxs-lookup"><span data-stu-id="8cb52-106">The guidelines are organized as simple recommendations prefixed with the terms *Do*, *Consider*, *Avoid* and *Do not*.</span></span>

* <span data-ttu-id="8cb52-107">Non modificare un oggetto di tipo personalizzato restituito dalle operazioni di lettura, ad esempio `TryPeekAsync` o `TryGetValueAsync`.</span><span class="sxs-lookup"><span data-stu-id="8cb52-107">Do not modify an object of custom type returned by read operations (for example, `TryPeekAsync` or `TryGetValueAsync`).</span></span> <span data-ttu-id="8cb52-108">Le raccolte Reliable Collections, così come le raccolte Concurrent Collections, restituiscono un riferimento agli oggetti, non una copia.</span><span class="sxs-lookup"><span data-stu-id="8cb52-108">Reliable Collections, just like Concurrent Collections, return a reference to the objects and not a copy.</span></span>
* <span data-ttu-id="8cb52-109">Eseguire una copia completa dell'oggetto di tipo personalizzato restituito prima di modificarlo.</span><span class="sxs-lookup"><span data-stu-id="8cb52-109">Do deep copy the returned object of a custom type before modifying it.</span></span> <span data-ttu-id="8cb52-110">Poiché le strutture e i tipi predefiniti vengono passati per valore, non è necessario eseguirne una copia completa.</span><span class="sxs-lookup"><span data-stu-id="8cb52-110">Since structs and built-in types are pass-by-value, you do not need to do a deep copy on them.</span></span>
* <span data-ttu-id="8cb52-111">Non usare `TimeSpan.MaxValue` per i timeout.</span><span class="sxs-lookup"><span data-stu-id="8cb52-111">Do not use `TimeSpan.MaxValue` for time-outs.</span></span> <span data-ttu-id="8cb52-112">I timeout devono essere usati per rilevare i deadlock.</span><span class="sxs-lookup"><span data-stu-id="8cb52-112">Time-outs should be used to detect deadlocks.</span></span>
* <span data-ttu-id="8cb52-113">Non usare una transazione dopo che ne è stato eseguito il commit, è stata interrotta o eliminata.</span><span class="sxs-lookup"><span data-stu-id="8cb52-113">Do not use a transaction after it has been committed, aborted, or disposed.</span></span>
* <span data-ttu-id="8cb52-114">Non usare un'enumerazione all'esterno dell'ambito di transazione nella quale è stata creata.</span><span class="sxs-lookup"><span data-stu-id="8cb52-114">Do not use an enumeration outside of the transaction scope it was created in.</span></span>
* <span data-ttu-id="8cb52-115">Non creare una transazione all'interno dell'istruzione `using` di un'altra transazione. Questa operazione può causare deadlock.</span><span class="sxs-lookup"><span data-stu-id="8cb52-115">Do not create a transaction within another transaction’s `using` statement because it can cause deadlocks.</span></span>
* <span data-ttu-id="8cb52-116">Verificare che l'implementazione di `IComparable<TKey>` sia corretta.</span><span class="sxs-lookup"><span data-stu-id="8cb52-116">Do ensure that your `IComparable<TKey>` implementation is correct.</span></span> <span data-ttu-id="8cb52-117">Il sistema presenta dipendenze su `IComparable<TKey>` per l'unione di checkpoint e righe.</span><span class="sxs-lookup"><span data-stu-id="8cb52-117">The system takes dependency on `IComparable<TKey>` for merging checkpoints and rows.</span></span>
* <span data-ttu-id="8cb52-118">Usare il blocco di aggiornamento durante la lettura di un elemento con l'intenzione di aggiornarlo in modo da evitare una determinata classe di deadlock.</span><span class="sxs-lookup"><span data-stu-id="8cb52-118">Do use Update lock when reading an item with an intention to update it to prevent a certain class of deadlocks.</span></span>
* <span data-ttu-id="8cb52-119">Prendere in considerazione l'opportunità di mantenere gli elementi (ad esempio TKey + TValue per Reliable Dictionary) sotto gli 80 Kbyte: più sono piccoli, meglio è.</span><span class="sxs-lookup"><span data-stu-id="8cb52-119">Consider keeping your items (for example, TKey + TValue for Reliable Dictionary) below 80 KBytes: smaller the better.</span></span> <span data-ttu-id="8cb52-120">In questo modo, è possibile ridurre l'uso di heap di oggetti di grandi dimensioni, oltre che i requisiti di dischi e I/O di rete.</span><span class="sxs-lookup"><span data-stu-id="8cb52-120">This reduces the amount of Large Object Heap usage as well as disk and network IO requirements.</span></span> <span data-ttu-id="8cb52-121">Spesso si riduce anche la replica dei dati duplicati quando viene aggiornata solo una piccola parte del valore.</span><span class="sxs-lookup"><span data-stu-id="8cb52-121">Often, it reduces replicating duplicate data when only one small part of the value is being updated.</span></span> <span data-ttu-id="8cb52-122">Un modo comune per ottenere questo in Reliable Dictionary è interrompere le righe in più righe.</span><span class="sxs-lookup"><span data-stu-id="8cb52-122">Common way to achieve this in Reliable Dictionary, is to break your rows in to multiple rows.</span></span>
* <span data-ttu-id="8cb52-123">Prendere in considerazione l'uso della funzionalità di backup e ripristino per il ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="8cb52-123">Consider using backup and restore functionality to have disaster recovery.</span></span>
* <span data-ttu-id="8cb52-124">Evitare di combinare nella stessa transazione le operazioni a singola entità e a più entità, ad esempio `GetCountAsync`, `CreateEnumerableAsync`, a causa dei diversi livelli di isolamento.</span><span class="sxs-lookup"><span data-stu-id="8cb52-124">Avoid mixing single entity operations and multi-entity operations (e.g `GetCountAsync`, `CreateEnumerableAsync`) in the same transaction due to the different isolation levels.</span></span>
* <span data-ttu-id="8cb52-125">Gestire InvalidOperationException.</span><span class="sxs-lookup"><span data-stu-id="8cb52-125">Do handle InvalidOperationException.</span></span> <span data-ttu-id="8cb52-126">Le transazioni utente possono essere interrotte dal sistema per diversi motivi.</span><span class="sxs-lookup"><span data-stu-id="8cb52-126">User transactions can be aborted by the system for variety of reasons.</span></span> <span data-ttu-id="8cb52-127">Ad esempio, quando cambia il Gestore dello stato affidabile cambia il proprio ruolo da ruolo primario o quando una transazione a esecuzione prolungata blocca il troncamento del log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="8cb52-127">For example, when the Reliable State Manager is changing its role out of Primary or when a long-running transaction is blocking truncation of the transactional log.</span></span> <span data-ttu-id="8cb52-128">In questi casi, l'utente può ricevere un evento InvalidOperationException, che indica che la transazione è già stata terminata.</span><span class="sxs-lookup"><span data-stu-id="8cb52-128">In such cases, user may receive InvalidOperationException indicating that their transaction has already been terminated.</span></span> <span data-ttu-id="8cb52-129">Supponendo che l'interruzione della transazione non è stata richiesta dall'utente, il modo migliore per gestire questa eccezione è di eliminare la transazione, verificare se il token di annullamento è stato segnalato (o se il ruolo della replica è stato modificato) e in caso contrario creare una nuova transazione e riprovare.</span><span class="sxs-lookup"><span data-stu-id="8cb52-129">Assuming, the termination of the transaction was not requested by the user, best way to handle this exception is to dispose the transaction, check if the cancellation token has been signaled (or the role of the replica has been changed), and if not create a new transaction and retry.</span></span>  

<span data-ttu-id="8cb52-130">Occorre tenere presente i concetti seguenti:</span><span class="sxs-lookup"><span data-stu-id="8cb52-130">Here are some things to keep in mind:</span></span>

* <span data-ttu-id="8cb52-131">Il timeout predefinito di tutte le API Reliable Collections è di quattro secondi.</span><span class="sxs-lookup"><span data-stu-id="8cb52-131">The default time-out is four seconds for all the Reliable Collection APIs.</span></span> <span data-ttu-id="8cb52-132">La maggior parte degli utenti deve usare il timeout predefinito.</span><span class="sxs-lookup"><span data-stu-id="8cb52-132">Most users should use the default time-out.</span></span>
* <span data-ttu-id="8cb52-133">Il token di annullamento predefinito è `CancellationToken.None` in tutte le API di Reliable Collections.</span><span class="sxs-lookup"><span data-stu-id="8cb52-133">The default cancellation token is `CancellationToken.None` in all Reliable Collections APIs.</span></span>
* <span data-ttu-id="8cb52-134">Il parametro di tipo di chiave (*TKey*) per un oggetto ReliableDictionary deve implementare correttamente `GetHashCode()` e `Equals()`.</span><span class="sxs-lookup"><span data-stu-id="8cb52-134">The key type parameter (*TKey*) for a Reliable Dictionary must correctly implement `GetHashCode()` and `Equals()`.</span></span> <span data-ttu-id="8cb52-135">Le chiavi non devono essere modificabili.</span><span class="sxs-lookup"><span data-stu-id="8cb52-135">Keys must be immutable.</span></span>
* <span data-ttu-id="8cb52-136">Per ottenere una disponibilità elevata per le raccolte Reliable Collections, ogni servizio deve avere almeno un set di repliche di destinazione costituito da un minimo di 3 repliche.</span><span class="sxs-lookup"><span data-stu-id="8cb52-136">To achieve high availability for the Reliable Collections, each service should have at least a target and minimum replica set size of 3.</span></span>
* <span data-ttu-id="8cb52-137">Le operazioni di lettura sul secondario possono leggere le versioni che non sono vincolate a un quorum.</span><span class="sxs-lookup"><span data-stu-id="8cb52-137">Read operations on the secondary may read versions that are not quorum committed.</span></span>
  <span data-ttu-id="8cb52-138">Ciò significa che una versione dei dati che viene letta da un singolo secondario potrebbe essere elaborata in modo non corretto.</span><span class="sxs-lookup"><span data-stu-id="8cb52-138">This means that a version of data that is read from a single secondary might be false progressed.</span></span>
  <span data-ttu-id="8cb52-139">Le letture della replica primaria sono sempre stabili: non sono mai elaborate in modo non corretto.</span><span class="sxs-lookup"><span data-stu-id="8cb52-139">Reads from Primary are always stable: can never be false progressed.</span></span>

### <a name="next-steps"></a><span data-ttu-id="8cb52-140">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="8cb52-140">Next steps</span></span>
* [<span data-ttu-id="8cb52-141">Lavorare con le raccolte Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="8cb52-141">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="8cb52-142">Transazioni e blocchi</span><span class="sxs-lookup"><span data-stu-id="8cb52-142">Transactions and Locks</span></span>](service-fabric-reliable-services-reliable-collections-transactions-locks.md)
* [<span data-ttu-id="8cb52-143">Elementi interni di Reliable Collections e Reliable State Manager</span><span class="sxs-lookup"><span data-stu-id="8cb52-143">Reliable State Manager and Collection Internals</span></span>](service-fabric-reliable-services-reliable-collections-internals.md)
* <span data-ttu-id="8cb52-144">Gestione dei dati</span><span class="sxs-lookup"><span data-stu-id="8cb52-144">Managing Data</span></span>
  * [<span data-ttu-id="8cb52-145">Backup e ripristino</span><span class="sxs-lookup"><span data-stu-id="8cb52-145">Backup and Restore</span></span>](service-fabric-reliable-services-backup-restore.md)
  * [<span data-ttu-id="8cb52-146">Notifications</span><span class="sxs-lookup"><span data-stu-id="8cb52-146">Notifications</span></span>](service-fabric-reliable-services-notifications.md)
  * [<span data-ttu-id="8cb52-147">Serializzazione e aggiornamento</span><span class="sxs-lookup"><span data-stu-id="8cb52-147">Serialization and Upgrade</span></span>](service-fabric-application-upgrade-data-serialization.md)
  * [<span data-ttu-id="8cb52-148">Reliable State Manager configuration (Configurazione di Reliable State Manager)</span><span class="sxs-lookup"><span data-stu-id="8cb52-148">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* <span data-ttu-id="8cb52-149">Altro</span><span class="sxs-lookup"><span data-stu-id="8cb52-149">Others</span></span>
  * [<span data-ttu-id="8cb52-150">Guida introduttiva a Reliable Services di Microsoft Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="8cb52-150">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
  * [<span data-ttu-id="8cb52-151">Guida di riferimento per gli sviluppatori per Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="8cb52-151">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)
